# 版本更新日誌

## v1.13.0 (2025-12-25)
### 更新內容：
- **任務備註視覺標注** 📝：
  - 任務列表中，有填寫備註的任務會顯示文件圖示標注，方便快速識別。
- **智能 Inbox 過濾** 🎯：
  - Inbox 現在會自動排除已標記為 Prompt 或 Journal 的任務。
  - 同時排除已設定日期的任務（包括其根任務有日期的子任務）。
  - **Inbox 計數優化**：側邊欄顯示所有符合 Inbox 條件的任務數量（包含子任務）。
- **Logbook 歸檔系統** 📦：
  - 新增 Logbook 側邊欄項目，專門顯示已歸檔的任務。
  - 歸檔操作現在支持 Undo/Redo，誤操作可以輕鬆還原。
  - 側邊欄顯示已歸檔任務的數量。
- **大綱模式智能修復** ✨：
  - 完全重構備註編輯器的大綱模式處理邏輯。
  - 當在列表起始位置按 Backspace 時，會將列表項轉回普通段落，並保留原始標記（如 `1. ` 或 `- `）作為可編輯文字。
  - 確保大綱符號不會消失，用戶可以繼續刪除文字內容。
  - 支持有序列表（1. 2. 3.）和無序列表（- • ）的智能轉換。
- **檔案上傳功能** 📎：
  - 新增通用檔案上傳功能，支持所有類型的文件附件。
  - 簡約美觀的附件列表顯示，包含檔名、大小和刪除按鈕。
  - 附件可點擊下載或在新分頁開啟。
  - 無檔案大小或數量限制（由 Supabase 儲存空間決定）。
  - **⚠️ 需要數據庫遷移**：請參閱 `DATABASE_MIGRATION.md` 執行 SQL 遷移。

## v1.13.1 (2025-12-25)
### 更新內容：
- **檔案管理優化** 🗂️：
  - **修復下載檔名問題**：上傳時在存儲中保留原始檔名（加上時間戳前綴避免衝突），下載時會使用正確的檔名。
  - **檔名清理**：自動將特殊字符替換為下劃線，確保檔名在所有系統中都能正常使用。
  - **自動清理存儲空間**：刪除任務時會自動刪除關聯的所有附件和圖片，避免佔用存儲空間。
  - **即時刪除**：在編輯器中移除附件或圖片時，會立即從 Supabase Storage 中刪除文件。
  - 所有刪除操作都包含錯誤處理，確保不會因為刪除失敗而影響任務操作。

## v1.13.2 (2025-12-25)
### 更新內容：
- **修復 Supabase Storage 中文檔名問題** 🔧：
  - **改用 UUID 存儲方案**：存儲檔名使用 `時間戳_UUID.副檔名` 格式，完全避免編碼問題。
  - **原始檔名保留**：原始檔名（包括中文）保存在任務的 `attachments` 元數據中。
  - **界面顯示**：用戶在界面上看到的仍然是原始中文檔名。
  - **下載保留原名**：點擊附件時會自動下載，並使用原始檔名（如 `059告知客人最新情況.pdf`）。
  - **存儲檔名範例**：`1735088400000_a1b2c3d4-e5f6-7890-abcd-ef1234567890.pdf`
  - 這個方案確保了與 Supabase Storage 的完全兼容性，同時保持了良好的用戶體驗。
- **任務完成視覺優化** ✨：
  - 任務完成時不再顯示刪除線（line-through），改為文字平滑變淡（降低透明度）。
  - 提供更整潔、美緻的視覺回饋。
- **編輯器優化** 🖋️：
  - 備註欄（Note Editor）最高限縮為 10 行高度，超過時會自動顯示滾動條，保持編輯界面簡潔。
- **任務時間顯示優化** 🕒：
  - 現在僅透過按住 **Ctrl** 或 **Win** 鍵（Mac 則限定為 **Control** 鍵，不再支援 Cmd）來即時查看任務的詳細時間段。
  - **全天任務顯示優化**：在未按下快捷鍵前，若任務為「全天」，僅會顯示日期，不再顯示 00:00 等預設時間。
  - **時間範圍顯示**：顯示 `開始時間 → 結束時間` (例如 `09:00 → 10:00`)，並使用箭頭圖示。
  - **視覺更新**：按下按鍵後使用時鐘圖示代替日曆圖示，數據更具語義化。

- **側邊欄標籤快速新增** 🏷️ (創意功能)：
  - **動態標籤欄位**：現在導覽列的「TAGS」區塊新增了動態輸入功能。當鼠標懸停在標頭時會出現 `+` 按鈕。
  - **流暢動畫**：使用了 `framer-motion` 打造絲滑的輸入框展開動畫。
  - **幽靈輸入模式**：標籤列表底部新增了隱形的「新增標籤...」按鈕，僅在懸停時顯現，保持介面純淨。
  - **智能操作**：支援 Enter 快速儲存、ESC 取消，並自動聚焦，極大地提升了標籤管理的效率。

- **自由度極高的 AI 專家指令** 🧠：
  - **移除預設框架**：當使用自定義指令時，AI 不再被限制於「兒家安置機構主管」的視角，也不再強制分為優點、盲點等固定欄位。
  - **完全自定義**：AI 將完全依照您輸入的指令進行分析與回應，並以大區塊呈現結果。
  - **視覺自我適應**：介面會自動判別回應格式，若為自由格式則呈現完整內容，若為預設指令則保留四象限分析，靈活切換。

## v1.12.2 (2025-12-25)
### 更新內容：
- **修復 Prompt 專屬頁面顯示問題** 🔍：
  - 修復了任務過濾邏輯中的緩存同步問題，現在點擊「Prompt」頁面能即時反映最新的指令任務。
  - **側邊欄數字顯示**：現在「Prompt」導航項旁會即時顯示目前保存的指令總數。
  - **更穩定的標籤比對**：優化了標籤名稱的識別 logic，自動處理前後空格與大小寫。

## v1.12.1 (2025-12-25)
### 更新內容：
- **修正 AI 分析邏輯** 🎯：
  - 修正了自定義指令的處理方式，確保 AI 真正將指令視為「分析工具」，轉而深入分析任務細節，而非評價指令本身。

## v1.12.0 (2025-12-25)
### 更新內容：
- **完整支援 ChatGPT/OpenAI API** 🤖：
  - AI 專家分析與指令自動命名現在全面支援 OpenAI API 相容介面。

## v1.11.3 (2025-12-25)
### 更新內容：
- **優化免費額度使用效率**：
  - 預設改用 **Gemini 1.5 Flash** 作為首選模型，擁有更高頻率的免費額度。
  - **友善的額度提示**：觸發限制時會顯示建議稍後再試的訊息。

## v1.11.2 (2025-12-25)
### 更新內容：
- **大幅提升 AI 穩定性**：
  - 擴充模型備援清單，減少因單一模型維護或限制導致的錯誤。
  - 優化 JSON 解析邏輯：即使 AI 回傳包含雜訊，系統也能精確提取結果。
  - 新增自動容錯機制：若格式解析失敗，將改以文字模式呈現。

## v1.11.1 (2025-12-25)
### 更新內容：
- **優化指令庫儲存機制**：
  - 現在儲存 AI 指令時，會自動由 AI 為指令命名簡短標題。
  - 完整的指令內容將自動存入任務的「備註/Notes」中，保持介面整潔。
  - 點選歷史指令時，會自動載入備註中的完整 Prompt。

## v1.11.0 (2025-12-25)
### 更新內容：
- **AI 專家自定義指令**：
  - 現在點擊「AI 專家」會先彈出指令視窗，允許您輸入自定義問題
  - **指令庫功能**：勾選「儲存到指令庫」會將目前的指令保存為任務（帶有 `prompt` 標籤）
  - **歷史指令參考**：視窗下方會顯示過往使用過或保存過的指令，點擊可直接複用
- **新增 Prompt 側邊欄位**：
  - 左側導航新增「Prompt」頁面，自動篩選所有標註為 `prompt` 的指令任務
  - 在 Prompt 視圖下按下 `Space` 鍵會自動創建帶有 `prompt` 標籤的新指令任務

## v1.10.0 (2025-12-25)
### 更新內容：
- **全面文件附件支援**：編輯器現在支援多種文件類型上傳
  - 上傳限制提升至 **100MB**
  - 支援 **拖曳上傳**：可直接將檔案拖入編輯器區域
  - 優化預覽：非圖片檔案顯示通用圖示及原始檔名
  - 保留大圖（>2MB）自動壓縮功能以節省儲存空間
- **Focus View 行事曆優化**：
  - **拖曳至整日區**：在 Focus 模式下，將任務拖入行事曆最上方的「All-day」區，會自動將其設為整日任務
  - **快捷鍵改動**：Ctrl+T、Ctrl+[、Ctrl+] 分配日期時，預設改為開啟「整日」勾選

## v1.9.4 (2025-12-25)
### 更新內容：
- **完全隔離編輯器操作**：退出編輯模式後，編輯器內的修改不會進入全局 Undo/Redo 歷史
  - 為 `updateTask` 添加 `skipHistory` 選項
  - `TaskInput` 提交修改時使用 `skipHistory: true`
  - 確保全局 Ctrl/Cmd+Z 不會還原已保存的備註內容和名稱改動

## v1.9.3 (2025-12-25)
### 更新內容：
- **隔離編輯模式的 Undo/Redo**：編輯任務時，Ctrl/Cmd+Z 只作用於編輯器內容
  - 在 `AppContext` 全局 undo/redo 處理器中添加 `editingTaskId` 檢查
  - 在 `TaskInput` 中阻止 undo/redo 事件冒泡（`e.stopPropagation()`）
  - TipTap 編輯器和標題輸入框使用各自的原生 undo/redo
  - 避免編輯時誤觸發任務層級的還原/重作

## v1.9.2 (2025-12-25)
### 更新內容：
- **修復 Markdown 輸入問題**：修復備註欄開頭使用 Markdown 格式時文字消失的問題
  - 添加 `editor.isFocused` 檢查，避免在用戶輸入時重置內容
  - 改進 `initialContent` 同步邏輯，只在編輯器失焦時更新
  - 確保 InputRules（如 `- ` 轉列表）正常工作

## v1.9.1 (2025-12-25)
### 更新內容：
- **整日模式 Tab 順序**：打勾整日時的 Tab 鍵導航順序優化
  - 新順序：任務名稱 → 備註（空時）→ 開始日 → 整日勾選框 → 標籤 → 循環
  - 為整日勾選框添加 ref 和 Tab 流程支援
  - 支援正向（Tab）和反向（Shift+Tab）導航
- **日期選擇器行為**：按 Enter 確認日期後不退出編輯
  - 關閉日期選擇器並保持焦點在日期欄位
  - 已有邏輯確保 Enter 事件不會冒泡到父組件

## v1.9.0 (2025-12-25)
### 更新內容：
- **底部區域重新設計**：優化任務編輯器底部的排版和視覺層次
  - 添加分隔線區分內容區和元數據區
  - 第一行：日期、時間、標籤選擇器
  - 第二行：圖片上傳、母任務選擇、顏色選擇器
  - 改善按鈕樣式，添加邊框和 hover 效果
  - 顏色選擇器改用圓角矩形容器，增大色點尺寸
- **母任務防呆**：已有邏輯確保不會顯示自己和自己的子任務

## v1.8.4 (2025-12-25)
### 更新內容：
- **修復 Tab 焦點問題**：修復從耗時欄位按 Tab 無法跳轉到標籤的問題
  - 為 duration → tags 的焦點切換添加 `setTimeout`

## v1.8.3 (2025-12-24)
### 更新內容：
- **修復 Tab 焦點問題**：修復從結束時間按 Tab 無法跳轉到耗時欄位的問題
  - 為所有時間欄位間的焦點切換添加 `setTimeout`，確保 focus 和 select 正確執行
  - 同時修復正向（Tab）和反向（Shift+Tab）的焦點切換

## v1.8.2 (2025-12-24)
### 更新內容：
- **修復 Tab 跳轉問題**：修復從開始時間按 Tab 無法跳轉到結束時間的問題
  - 在 startTime → endTime 的焦點切換中添加 `setTimeout`

## v1.8.1 (2025-12-24)
### 更新內容：
- **Tab 順序優化**：調整時間欄位的 Tab 鍵導航順序
  - 新順序：任務名稱 → 備註（空時） → 開始日 → 開始時間 → 結束時間 → 耗時 → 標籤 → 循環
  - 所有時間相關欄位（開始時間、結束時間、耗時）在 focus 時自動選中文字
- **UI 對齊修正**：任務編輯器打勾框與標題靠下對齊，左邊距從 ml-1 增加到 ml-3

## v1.8.0 (2025-12-24)
### 更新內容：
1. **備註編輯器升級**：整合 TipTap Markdown 編輯器，支援即時格式化（`#` 標題、`*` 列表、`**粗體**`）
2. **Tab 鍵智能處理**：備註欄為空時 Tab 跳轉到下一欄位，有內容時用於縮排
3. **Cmd+Enter 快捷鍵**：從備註欄快速跳出到日期欄位
4. **空列表支援**：Inbox 無任務時可按空白鍵創建第一筆任務
5. **任務插入順序修復**：使用 `view_orders` 確保拖曳重排後新任務插入位置正確
6. **麵包屑顯示**：Focus 和 Today 視圖顯示任務父層級路徑（彩色氣泡樣式）
7. **UI 對齊優化**：任務編輯器打勾框與標題靠下對齊，左邊距增加
