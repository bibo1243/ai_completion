(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var jp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lg(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var xE={exports:{}},cg={},bE={exports:{}},bn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $f=Symbol.for("react.element"),qR=Symbol.for("react.portal"),YR=Symbol.for("react.fragment"),JR=Symbol.for("react.strict_mode"),XR=Symbol.for("react.profiler"),QR=Symbol.for("react.provider"),ZR=Symbol.for("react.context"),eO=Symbol.for("react.forward_ref"),tO=Symbol.for("react.suspense"),nO=Symbol.for("react.memo"),rO=Symbol.for("react.lazy"),vk=Symbol.iterator;function sO(t){return t===null||typeof t!="object"?null:(t=vk&&t[vk]||t["@@iterator"],typeof t=="function"?t:null)}var wE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},vE=Object.assign,kE={};function Tu(t,e,n){this.props=t,this.context=e,this.refs=kE,this.updater=n||wE}Tu.prototype.isReactComponent={};Tu.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Tu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function SE(){}SE.prototype=Tu.prototype;function yb(t,e,n){this.props=t,this.context=e,this.refs=kE,this.updater=n||wE}var xb=yb.prototype=new SE;xb.constructor=yb;vE(xb,Tu.prototype);xb.isPureReactComponent=!0;var kk=Array.isArray,_E=Object.prototype.hasOwnProperty,bb={current:null},TE={key:!0,ref:!0,__self:!0,__source:!0};function CE(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)_E.call(e,r)&&!TE.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:$f,type:t,key:i,ref:o,props:s,_owner:bb.current}}function iO(t,e){return{$$typeof:$f,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function wb(t){return typeof t=="object"&&t!==null&&t.$$typeof===$f}function oO(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Sk=/\/+/g;function s0(t,e){return typeof t=="object"&&t!==null&&t.key!=null?oO(""+t.key):e.toString(36)}function Jh(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case $f:case qR:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+s0(o,0):r,kk(s)?(n="",t!=null&&(n=t.replace(Sk,"$&/")+"/"),Jh(s,e,n,"",function(u){return u})):s!=null&&(wb(s)&&(s=iO(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Sk,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",kk(t))for(var a=0;a<t.length;a++){i=t[a];var l=r+s0(i,a);o+=Jh(i,e,n,l,s)}else if(l=sO(t),typeof l=="function")for(t=l.call(t),a=0;!(i=t.next()).done;)i=i.value,l=r+s0(i,a++),o+=Jh(i,e,n,l,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function oh(t,e,n){if(t==null)return t;var r=[],s=0;return Jh(t,r,"","",function(i){return e.call(n,i,s++)}),r}function aO(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ts={current:null},Xh={transition:null},lO={ReactCurrentDispatcher:Ts,ReactCurrentBatchConfig:Xh,ReactCurrentOwner:bb};function EE(){throw Error("act(...) is not supported in production builds of React.")}bn.Children={map:oh,forEach:function(t,e,n){oh(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return oh(t,function(){e++}),e},toArray:function(t){return oh(t,function(e){return e})||[]},only:function(t){if(!wb(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};bn.Component=Tu;bn.Fragment=YR;bn.Profiler=XR;bn.PureComponent=yb;bn.StrictMode=JR;bn.Suspense=tO;bn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=lO;bn.act=EE;bn.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=vE({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=bb.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)_E.call(e,l)&&!TE.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:$f,type:t.type,key:s,ref:i,props:r,_owner:o}};bn.createContext=function(t){return t={$$typeof:ZR,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:QR,_context:t},t.Consumer=t};bn.createElement=CE;bn.createFactory=function(t){var e=CE.bind(null,t);return e.type=t,e};bn.createRef=function(){return{current:null}};bn.forwardRef=function(t){return{$$typeof:eO,render:t}};bn.isValidElement=wb;bn.lazy=function(t){return{$$typeof:rO,_payload:{_status:-1,_result:t},_init:aO}};bn.memo=function(t,e){return{$$typeof:nO,type:t,compare:e===void 0?null:e}};bn.startTransition=function(t){var e=Xh.transition;Xh.transition={};try{t()}finally{Xh.transition=e}};bn.unstable_act=EE;bn.useCallback=function(t,e){return Ts.current.useCallback(t,e)};bn.useContext=function(t){return Ts.current.useContext(t)};bn.useDebugValue=function(){};bn.useDeferredValue=function(t){return Ts.current.useDeferredValue(t)};bn.useEffect=function(t,e){return Ts.current.useEffect(t,e)};bn.useId=function(){return Ts.current.useId()};bn.useImperativeHandle=function(t,e,n){return Ts.current.useImperativeHandle(t,e,n)};bn.useInsertionEffect=function(t,e){return Ts.current.useInsertionEffect(t,e)};bn.useLayoutEffect=function(t,e){return Ts.current.useLayoutEffect(t,e)};bn.useMemo=function(t,e){return Ts.current.useMemo(t,e)};bn.useReducer=function(t,e,n){return Ts.current.useReducer(t,e,n)};bn.useRef=function(t){return Ts.current.useRef(t)};bn.useState=function(t){return Ts.current.useState(t)};bn.useSyncExternalStore=function(t,e,n){return Ts.current.useSyncExternalStore(t,e,n)};bn.useTransition=function(){return Ts.current.useTransition()};bn.version="18.3.1";bE.exports=bn;var b=bE.exports;const Dn=lg(b);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cO=b,uO=Symbol.for("react.element"),dO=Symbol.for("react.fragment"),fO=Object.prototype.hasOwnProperty,hO=cO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,pO={key:!0,ref:!0,__self:!0,__source:!0};function NE(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)fO.call(e,r)&&!pO.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:uO,type:t,key:i,ref:o,props:s,_owner:hO.current}}cg.Fragment=dO;cg.jsx=NE;cg.jsxs=NE;xE.exports=cg;var c=xE.exports,Wy={},jE={exports:{}},ti={},IE={exports:{}},DE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(X,Q){var A=X.length;X.push(Q);e:for(;0<A;){var Te=A-1>>>1,we=X[Te];if(0<s(we,Q))X[Te]=Q,X[A]=we,A=Te;else break e}}function n(X){return X.length===0?null:X[0]}function r(X){if(X.length===0)return null;var Q=X[0],A=X.pop();if(A!==Q){X[0]=A;e:for(var Te=0,we=X.length,B=we>>>1;Te<B;){var F=2*(Te+1)-1,ne=X[F],We=F+1,ft=X[We];if(0>s(ne,A))We<we&&0>s(ft,ne)?(X[Te]=ft,X[We]=A,Te=We):(X[Te]=ne,X[F]=A,Te=F);else if(We<we&&0>s(ft,A))X[Te]=ft,X[We]=A,Te=We;else break e}}return Q}function s(X,Q){var A=X.sortIndex-Q.sortIndex;return A!==0?A:X.id-Q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],u=[],d=1,f=null,h=3,p=!1,m=!1,y=!1,x=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(X){for(var Q=n(u);Q!==null;){if(Q.callback===null)r(u);else if(Q.startTime<=X)r(u),Q.sortIndex=Q.expirationTime,e(l,Q);else break;Q=n(u)}}function T(X){if(y=!1,w(X),!m)if(n(l)!==null)m=!0,R(D);else{var Q=n(u);Q!==null&&M(T,Q.startTime-X)}}function D(X,Q){m=!1,y&&(y=!1,g(C),C=-1),p=!0;var A=h;try{for(w(Q),f=n(l);f!==null&&(!(f.expirationTime>Q)||X&&!N());){var Te=f.callback;if(typeof Te=="function"){f.callback=null,h=f.priorityLevel;var we=Te(f.expirationTime<=Q);Q=t.unstable_now(),typeof we=="function"?f.callback=we:f===n(l)&&r(l),w(Q)}else r(l);f=n(l)}if(f!==null)var B=!0;else{var F=n(u);F!==null&&M(T,F.startTime-Q),B=!1}return B}finally{f=null,h=A,p=!1}}var k=!1,I=null,C=-1,S=5,_=-1;function N(){return!(t.unstable_now()-_<S)}function j(){if(I!==null){var X=t.unstable_now();_=X;var Q=!0;try{Q=I(!0,X)}finally{Q?O():(k=!1,I=null)}}else k=!1}var O;if(typeof v=="function")O=function(){v(j)};else if(typeof MessageChannel<"u"){var P=new MessageChannel,W=P.port2;P.port1.onmessage=j,O=function(){W.postMessage(null)}}else O=function(){x(j,0)};function R(X){I=X,k||(k=!0,O())}function M(X,Q){C=x(function(){X(t.unstable_now())},Q)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(X){X.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,R(D))},t.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<X?Math.floor(1e3/X):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(X){switch(h){case 1:case 2:case 3:var Q=3;break;default:Q=h}var A=h;h=Q;try{return X()}finally{h=A}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(X,Q){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var A=h;h=X;try{return Q()}finally{h=A}},t.unstable_scheduleCallback=function(X,Q,A){var Te=t.unstable_now();switch(typeof A=="object"&&A!==null?(A=A.delay,A=typeof A=="number"&&0<A?Te+A:Te):A=Te,X){case 1:var we=-1;break;case 2:we=250;break;case 5:we=1073741823;break;case 4:we=1e4;break;default:we=5e3}return we=A+we,X={id:d++,callback:Q,priorityLevel:X,startTime:A,expirationTime:we,sortIndex:-1},A>Te?(X.sortIndex=A,e(u,X),n(l)===null&&X===n(u)&&(y?(g(C),C=-1):y=!0,M(T,A-Te))):(X.sortIndex=we,e(l,X),m||p||(m=!0,R(D))),X},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(X){var Q=h;return function(){var A=h;h=Q;try{return X.apply(this,arguments)}finally{h=A}}}})(DE);IE.exports=DE;var mO=IE.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gO=b,Zs=mO;function Et(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var ME=new Set,Vd={};function tc(t,e){du(t,e),du(t+"Capture",e)}function du(t,e){for(Vd[t]=e,t=0;t<e.length;t++)ME.add(e[t])}var Uo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ky=Object.prototype.hasOwnProperty,yO=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,_k={},Tk={};function xO(t){return Ky.call(Tk,t)?!0:Ky.call(_k,t)?!1:yO.test(t)?Tk[t]=!0:(_k[t]=!0,!1)}function bO(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function wO(t,e,n,r){if(e===null||typeof e>"u"||bO(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Cs(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var ts={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ts[t]=new Cs(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ts[e]=new Cs(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ts[t]=new Cs(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ts[t]=new Cs(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ts[t]=new Cs(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ts[t]=new Cs(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ts[t]=new Cs(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ts[t]=new Cs(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ts[t]=new Cs(t,5,!1,t.toLowerCase(),null,!1,!1)});var vb=/[\-:]([a-z])/g;function kb(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(vb,kb);ts[e]=new Cs(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(vb,kb);ts[e]=new Cs(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(vb,kb);ts[e]=new Cs(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ts[t]=new Cs(t,1,!1,t.toLowerCase(),null,!1,!1)});ts.xlinkHref=new Cs("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ts[t]=new Cs(t,1,!1,t.toLowerCase(),null,!0,!0)});function Sb(t,e,n,r){var s=ts.hasOwnProperty(e)?ts[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(wO(e,n,s,r)&&(n=null),r||s===null?xO(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Jo=gO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ah=Symbol.for("react.element"),Nc=Symbol.for("react.portal"),jc=Symbol.for("react.fragment"),_b=Symbol.for("react.strict_mode"),Gy=Symbol.for("react.profiler"),AE=Symbol.for("react.provider"),RE=Symbol.for("react.context"),Tb=Symbol.for("react.forward_ref"),qy=Symbol.for("react.suspense"),Yy=Symbol.for("react.suspense_list"),Cb=Symbol.for("react.memo"),la=Symbol.for("react.lazy"),OE=Symbol.for("react.offscreen"),Ck=Symbol.iterator;function Uu(t){return t===null||typeof t!="object"?null:(t=Ck&&t[Ck]||t["@@iterator"],typeof t=="function"?t:null)}var ur=Object.assign,i0;function sd(t){if(i0===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);i0=e&&e[1]||""}return`
`+i0+t}var o0=!1;function a0(t,e){if(!t||o0)return"";o0=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{o0=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?sd(t):""}function vO(t){switch(t.tag){case 5:return sd(t.type);case 16:return sd("Lazy");case 13:return sd("Suspense");case 19:return sd("SuspenseList");case 0:case 2:case 15:return t=a0(t.type,!1),t;case 11:return t=a0(t.type.render,!1),t;case 1:return t=a0(t.type,!0),t;default:return""}}function Jy(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case jc:return"Fragment";case Nc:return"Portal";case Gy:return"Profiler";case _b:return"StrictMode";case qy:return"Suspense";case Yy:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case RE:return(t.displayName||"Context")+".Consumer";case AE:return(t._context.displayName||"Context")+".Provider";case Tb:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Cb:return e=t.displayName||null,e!==null?e:Jy(t.type)||"Memo";case la:e=t._payload,t=t._init;try{return Jy(t(e))}catch{}}return null}function kO(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Jy(e);case 8:return e===_b?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function za(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function PE(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function SO(t){var e=PE(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function lh(t){t._valueTracker||(t._valueTracker=SO(t))}function LE(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=PE(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Ip(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Xy(t,e){var n=e.checked;return ur({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Ek(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=za(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function $E(t,e){e=e.checked,e!=null&&Sb(t,"checked",e,!1)}function Qy(t,e){$E(t,e);var n=za(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Zy(t,e.type,n):e.hasOwnProperty("defaultValue")&&Zy(t,e.type,za(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Nk(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Zy(t,e,n){(e!=="number"||Ip(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var id=Array.isArray;function Jc(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+za(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function ex(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Et(91));return ur({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function jk(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Et(92));if(id(n)){if(1<n.length)throw Error(Et(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:za(n)}}function zE(t,e){var n=za(e.value),r=za(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Ik(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function FE(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function tx(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?FE(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ch,BE=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ch=ch||document.createElement("div"),ch.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ch.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Wd(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var md={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},_O=["Webkit","ms","Moz","O"];Object.keys(md).forEach(function(t){_O.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),md[e]=md[t]})});function UE(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||md.hasOwnProperty(t)&&md[t]?(""+e).trim():e+"px"}function HE(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=UE(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var TO=ur({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function nx(t,e){if(e){if(TO[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Et(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Et(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Et(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Et(62))}}function rx(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var sx=null;function Eb(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ix=null,Xc=null,Qc=null;function Dk(t){if(t=Bf(t)){if(typeof ix!="function")throw Error(Et(280));var e=t.stateNode;e&&(e=pg(e),ix(t.stateNode,t.type,e))}}function VE(t){Xc?Qc?Qc.push(t):Qc=[t]:Xc=t}function WE(){if(Xc){var t=Xc,e=Qc;if(Qc=Xc=null,Dk(t),e)for(t=0;t<e.length;t++)Dk(e[t])}}function KE(t,e){return t(e)}function GE(){}var l0=!1;function qE(t,e,n){if(l0)return t(e,n);l0=!0;try{return KE(t,e,n)}finally{l0=!1,(Xc!==null||Qc!==null)&&(GE(),WE())}}function Kd(t,e){var n=t.stateNode;if(n===null)return null;var r=pg(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Et(231,e,typeof n));return n}var ox=!1;if(Uo)try{var Hu={};Object.defineProperty(Hu,"passive",{get:function(){ox=!0}}),window.addEventListener("test",Hu,Hu),window.removeEventListener("test",Hu,Hu)}catch{ox=!1}function CO(t,e,n,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(d){this.onError(d)}}var gd=!1,Dp=null,Mp=!1,ax=null,EO={onError:function(t){gd=!0,Dp=t}};function NO(t,e,n,r,s,i,o,a,l){gd=!1,Dp=null,CO.apply(EO,arguments)}function jO(t,e,n,r,s,i,o,a,l){if(NO.apply(this,arguments),gd){if(gd){var u=Dp;gd=!1,Dp=null}else throw Error(Et(198));Mp||(Mp=!0,ax=u)}}function nc(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function YE(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Mk(t){if(nc(t)!==t)throw Error(Et(188))}function IO(t){var e=t.alternate;if(!e){if(e=nc(t),e===null)throw Error(Et(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return Mk(s),t;if(i===r)return Mk(s),e;i=i.sibling}throw Error(Et(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o)throw Error(Et(189))}}if(n.alternate!==r)throw Error(Et(190))}if(n.tag!==3)throw Error(Et(188));return n.stateNode.current===n?t:e}function JE(t){return t=IO(t),t!==null?XE(t):null}function XE(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=XE(t);if(e!==null)return e;t=t.sibling}return null}var QE=Zs.unstable_scheduleCallback,Ak=Zs.unstable_cancelCallback,DO=Zs.unstable_shouldYield,MO=Zs.unstable_requestPaint,br=Zs.unstable_now,AO=Zs.unstable_getCurrentPriorityLevel,Nb=Zs.unstable_ImmediatePriority,ZE=Zs.unstable_UserBlockingPriority,Ap=Zs.unstable_NormalPriority,RO=Zs.unstable_LowPriority,eN=Zs.unstable_IdlePriority,ug=null,fo=null;function OO(t){if(fo&&typeof fo.onCommitFiberRoot=="function")try{fo.onCommitFiberRoot(ug,t,void 0,(t.current.flags&128)===128)}catch{}}var Gi=Math.clz32?Math.clz32:$O,PO=Math.log,LO=Math.LN2;function $O(t){return t>>>=0,t===0?32:31-(PO(t)/LO|0)|0}var uh=64,dh=4194304;function od(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Rp(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~s;a!==0?r=od(a):(i&=o,i!==0&&(r=od(i)))}else o=n&~s,o!==0?r=od(o):i!==0&&(r=od(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Gi(e),s=1<<n,r|=t[n],e&=~s;return r}function zO(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function FO(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-Gi(i),a=1<<o,l=s[o];l===-1?(!(a&n)||a&r)&&(s[o]=zO(a,e)):l<=e&&(t.expiredLanes|=a),i&=~a}}function lx(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function tN(){var t=uh;return uh<<=1,!(uh&4194240)&&(uh=64),t}function c0(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function zf(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Gi(e),t[e]=n}function BO(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Gi(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function jb(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Gi(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var Mn=0;function nN(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var rN,Ib,sN,iN,oN,cx=!1,fh=[],Ta=null,Ca=null,Ea=null,Gd=new Map,qd=new Map,ma=[],UO="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Rk(t,e){switch(t){case"focusin":case"focusout":Ta=null;break;case"dragenter":case"dragleave":Ca=null;break;case"mouseover":case"mouseout":Ea=null;break;case"pointerover":case"pointerout":Gd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":qd.delete(e.pointerId)}}function Vu(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Bf(e),e!==null&&Ib(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function HO(t,e,n,r,s){switch(e){case"focusin":return Ta=Vu(Ta,t,e,n,r,s),!0;case"dragenter":return Ca=Vu(Ca,t,e,n,r,s),!0;case"mouseover":return Ea=Vu(Ea,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Gd.set(i,Vu(Gd.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,qd.set(i,Vu(qd.get(i)||null,t,e,n,r,s)),!0}return!1}function aN(t){var e=Sl(t.target);if(e!==null){var n=nc(e);if(n!==null){if(e=n.tag,e===13){if(e=YE(n),e!==null){t.blockedOn=e,oN(t.priority,function(){sN(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Qh(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=ux(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);sx=r,n.target.dispatchEvent(r),sx=null}else return e=Bf(n),e!==null&&Ib(e),t.blockedOn=n,!1;e.shift()}return!0}function Ok(t,e,n){Qh(t)&&n.delete(e)}function VO(){cx=!1,Ta!==null&&Qh(Ta)&&(Ta=null),Ca!==null&&Qh(Ca)&&(Ca=null),Ea!==null&&Qh(Ea)&&(Ea=null),Gd.forEach(Ok),qd.forEach(Ok)}function Wu(t,e){t.blockedOn===e&&(t.blockedOn=null,cx||(cx=!0,Zs.unstable_scheduleCallback(Zs.unstable_NormalPriority,VO)))}function Yd(t){function e(s){return Wu(s,t)}if(0<fh.length){Wu(fh[0],t);for(var n=1;n<fh.length;n++){var r=fh[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Ta!==null&&Wu(Ta,t),Ca!==null&&Wu(Ca,t),Ea!==null&&Wu(Ea,t),Gd.forEach(e),qd.forEach(e),n=0;n<ma.length;n++)r=ma[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<ma.length&&(n=ma[0],n.blockedOn===null);)aN(n),n.blockedOn===null&&ma.shift()}var Zc=Jo.ReactCurrentBatchConfig,Op=!0;function WO(t,e,n,r){var s=Mn,i=Zc.transition;Zc.transition=null;try{Mn=1,Db(t,e,n,r)}finally{Mn=s,Zc.transition=i}}function KO(t,e,n,r){var s=Mn,i=Zc.transition;Zc.transition=null;try{Mn=4,Db(t,e,n,r)}finally{Mn=s,Zc.transition=i}}function Db(t,e,n,r){if(Op){var s=ux(t,e,n,r);if(s===null)b0(t,e,r,Pp,n),Rk(t,r);else if(HO(s,t,e,n,r))r.stopPropagation();else if(Rk(t,r),e&4&&-1<UO.indexOf(t)){for(;s!==null;){var i=Bf(s);if(i!==null&&rN(i),i=ux(t,e,n,r),i===null&&b0(t,e,r,Pp,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else b0(t,e,r,null,n)}}var Pp=null;function ux(t,e,n,r){if(Pp=null,t=Eb(r),t=Sl(t),t!==null)if(e=nc(t),e===null)t=null;else if(n=e.tag,n===13){if(t=YE(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Pp=t,null}function lN(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(AO()){case Nb:return 1;case ZE:return 4;case Ap:case RO:return 16;case eN:return 536870912;default:return 16}default:return 16}}var wa=null,Mb=null,Zh=null;function cN(){if(Zh)return Zh;var t,e=Mb,n=e.length,r,s="value"in wa?wa.value:wa.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return Zh=s.slice(t,1<r?1-r:void 0)}function ep(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function hh(){return!0}function Pk(){return!1}function ni(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?hh:Pk,this.isPropagationStopped=Pk,this}return ur(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=hh)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=hh)},persist:function(){},isPersistent:hh}),e}var Cu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ab=ni(Cu),Ff=ur({},Cu,{view:0,detail:0}),GO=ni(Ff),u0,d0,Ku,dg=ur({},Ff,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Rb,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ku&&(Ku&&t.type==="mousemove"?(u0=t.screenX-Ku.screenX,d0=t.screenY-Ku.screenY):d0=u0=0,Ku=t),u0)},movementY:function(t){return"movementY"in t?t.movementY:d0}}),Lk=ni(dg),qO=ur({},dg,{dataTransfer:0}),YO=ni(qO),JO=ur({},Ff,{relatedTarget:0}),f0=ni(JO),XO=ur({},Cu,{animationName:0,elapsedTime:0,pseudoElement:0}),QO=ni(XO),ZO=ur({},Cu,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),eP=ni(ZO),tP=ur({},Cu,{data:0}),$k=ni(tP),nP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},rP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},sP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function iP(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=sP[t])?!!e[t]:!1}function Rb(){return iP}var oP=ur({},Ff,{key:function(t){if(t.key){var e=nP[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=ep(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?rP[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Rb,charCode:function(t){return t.type==="keypress"?ep(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ep(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),aP=ni(oP),lP=ur({},dg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zk=ni(lP),cP=ur({},Ff,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Rb}),uP=ni(cP),dP=ur({},Cu,{propertyName:0,elapsedTime:0,pseudoElement:0}),fP=ni(dP),hP=ur({},dg,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),pP=ni(hP),mP=[9,13,27,32],Ob=Uo&&"CompositionEvent"in window,yd=null;Uo&&"documentMode"in document&&(yd=document.documentMode);var gP=Uo&&"TextEvent"in window&&!yd,uN=Uo&&(!Ob||yd&&8<yd&&11>=yd),Fk=String.fromCharCode(32),Bk=!1;function dN(t,e){switch(t){case"keyup":return mP.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fN(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ic=!1;function yP(t,e){switch(t){case"compositionend":return fN(e);case"keypress":return e.which!==32?null:(Bk=!0,Fk);case"textInput":return t=e.data,t===Fk&&Bk?null:t;default:return null}}function xP(t,e){if(Ic)return t==="compositionend"||!Ob&&dN(t,e)?(t=cN(),Zh=Mb=wa=null,Ic=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return uN&&e.locale!=="ko"?null:e.data;default:return null}}var bP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Uk(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!bP[t.type]:e==="textarea"}function hN(t,e,n,r){VE(r),e=Lp(e,"onChange"),0<e.length&&(n=new Ab("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var xd=null,Jd=null;function wP(t){_N(t,0)}function fg(t){var e=Ac(t);if(LE(e))return t}function vP(t,e){if(t==="change")return e}var pN=!1;if(Uo){var h0;if(Uo){var p0="oninput"in document;if(!p0){var Hk=document.createElement("div");Hk.setAttribute("oninput","return;"),p0=typeof Hk.oninput=="function"}h0=p0}else h0=!1;pN=h0&&(!document.documentMode||9<document.documentMode)}function Vk(){xd&&(xd.detachEvent("onpropertychange",mN),Jd=xd=null)}function mN(t){if(t.propertyName==="value"&&fg(Jd)){var e=[];hN(e,Jd,t,Eb(t)),qE(wP,e)}}function kP(t,e,n){t==="focusin"?(Vk(),xd=e,Jd=n,xd.attachEvent("onpropertychange",mN)):t==="focusout"&&Vk()}function SP(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return fg(Jd)}function _P(t,e){if(t==="click")return fg(e)}function TP(t,e){if(t==="input"||t==="change")return fg(e)}function CP(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Yi=typeof Object.is=="function"?Object.is:CP;function Xd(t,e){if(Yi(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Ky.call(e,s)||!Yi(t[s],e[s]))return!1}return!0}function Wk(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Kk(t,e){var n=Wk(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Wk(n)}}function gN(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?gN(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function yN(){for(var t=window,e=Ip();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ip(t.document)}return e}function Pb(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function EP(t){var e=yN(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&gN(n.ownerDocument.documentElement,n)){if(r!==null&&Pb(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=Kk(n,i);var o=Kk(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var NP=Uo&&"documentMode"in document&&11>=document.documentMode,Dc=null,dx=null,bd=null,fx=!1;function Gk(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;fx||Dc==null||Dc!==Ip(r)||(r=Dc,"selectionStart"in r&&Pb(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),bd&&Xd(bd,r)||(bd=r,r=Lp(dx,"onSelect"),0<r.length&&(e=new Ab("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Dc)))}function ph(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Mc={animationend:ph("Animation","AnimationEnd"),animationiteration:ph("Animation","AnimationIteration"),animationstart:ph("Animation","AnimationStart"),transitionend:ph("Transition","TransitionEnd")},m0={},xN={};Uo&&(xN=document.createElement("div").style,"AnimationEvent"in window||(delete Mc.animationend.animation,delete Mc.animationiteration.animation,delete Mc.animationstart.animation),"TransitionEvent"in window||delete Mc.transitionend.transition);function hg(t){if(m0[t])return m0[t];if(!Mc[t])return t;var e=Mc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in xN)return m0[t]=e[n];return t}var bN=hg("animationend"),wN=hg("animationiteration"),vN=hg("animationstart"),kN=hg("transitionend"),SN=new Map,qk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ka(t,e){SN.set(t,e),tc(e,[t])}for(var g0=0;g0<qk.length;g0++){var y0=qk[g0],jP=y0.toLowerCase(),IP=y0[0].toUpperCase()+y0.slice(1);Ka(jP,"on"+IP)}Ka(bN,"onAnimationEnd");Ka(wN,"onAnimationIteration");Ka(vN,"onAnimationStart");Ka("dblclick","onDoubleClick");Ka("focusin","onFocus");Ka("focusout","onBlur");Ka(kN,"onTransitionEnd");du("onMouseEnter",["mouseout","mouseover"]);du("onMouseLeave",["mouseout","mouseover"]);du("onPointerEnter",["pointerout","pointerover"]);du("onPointerLeave",["pointerout","pointerover"]);tc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));tc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));tc("onBeforeInput",["compositionend","keypress","textInput","paste"]);tc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));tc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));tc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ad="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),DP=new Set("cancel close invalid load scroll toggle".split(" ").concat(ad));function Yk(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,jO(r,e,void 0,t),t.currentTarget=null}function _N(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;Yk(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;Yk(s,a,u),i=l}}}if(Mp)throw t=ax,Mp=!1,ax=null,t}function Vn(t,e){var n=e[yx];n===void 0&&(n=e[yx]=new Set);var r=t+"__bubble";n.has(r)||(TN(e,t,2,!1),n.add(r))}function x0(t,e,n){var r=0;e&&(r|=4),TN(n,t,r,e)}var mh="_reactListening"+Math.random().toString(36).slice(2);function Qd(t){if(!t[mh]){t[mh]=!0,ME.forEach(function(n){n!=="selectionchange"&&(DP.has(n)||x0(n,!1,t),x0(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[mh]||(e[mh]=!0,x0("selectionchange",!1,e))}}function TN(t,e,n,r){switch(lN(e)){case 1:var s=WO;break;case 4:s=KO;break;default:s=Db}n=s.bind(null,e,n,t),s=void 0,!ox||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function b0(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Sl(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}qE(function(){var u=i,d=Eb(n),f=[];e:{var h=SN.get(t);if(h!==void 0){var p=Ab,m=t;switch(t){case"keypress":if(ep(n)===0)break e;case"keydown":case"keyup":p=aP;break;case"focusin":m="focus",p=f0;break;case"focusout":m="blur",p=f0;break;case"beforeblur":case"afterblur":p=f0;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Lk;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=YO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=uP;break;case bN:case wN:case vN:p=QO;break;case kN:p=fP;break;case"scroll":p=GO;break;case"wheel":p=pP;break;case"copy":case"cut":case"paste":p=eP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=zk}var y=(e&4)!==0,x=!y&&t==="scroll",g=y?h!==null?h+"Capture":null:h;y=[];for(var v=u,w;v!==null;){w=v;var T=w.stateNode;if(w.tag===5&&T!==null&&(w=T,g!==null&&(T=Kd(v,g),T!=null&&y.push(Zd(v,T,w)))),x)break;v=v.return}0<y.length&&(h=new p(h,m,null,n,d),f.push({event:h,listeners:y}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",h&&n!==sx&&(m=n.relatedTarget||n.fromElement)&&(Sl(m)||m[Ho]))break e;if((p||h)&&(h=d.window===d?d:(h=d.ownerDocument)?h.defaultView||h.parentWindow:window,p?(m=n.relatedTarget||n.toElement,p=u,m=m?Sl(m):null,m!==null&&(x=nc(m),m!==x||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=u),p!==m)){if(y=Lk,T="onMouseLeave",g="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(y=zk,T="onPointerLeave",g="onPointerEnter",v="pointer"),x=p==null?h:Ac(p),w=m==null?h:Ac(m),h=new y(T,v+"leave",p,n,d),h.target=x,h.relatedTarget=w,T=null,Sl(d)===u&&(y=new y(g,v+"enter",m,n,d),y.target=w,y.relatedTarget=x,T=y),x=T,p&&m)t:{for(y=p,g=m,v=0,w=y;w;w=cc(w))v++;for(w=0,T=g;T;T=cc(T))w++;for(;0<v-w;)y=cc(y),v--;for(;0<w-v;)g=cc(g),w--;for(;v--;){if(y===g||g!==null&&y===g.alternate)break t;y=cc(y),g=cc(g)}y=null}else y=null;p!==null&&Jk(f,h,p,y,!1),m!==null&&x!==null&&Jk(f,x,m,y,!0)}}e:{if(h=u?Ac(u):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var D=vP;else if(Uk(h))if(pN)D=TP;else{D=SP;var k=kP}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(D=_P);if(D&&(D=D(t,u))){hN(f,D,n,d);break e}k&&k(t,h,u),t==="focusout"&&(k=h._wrapperState)&&k.controlled&&h.type==="number"&&Zy(h,"number",h.value)}switch(k=u?Ac(u):window,t){case"focusin":(Uk(k)||k.contentEditable==="true")&&(Dc=k,dx=u,bd=null);break;case"focusout":bd=dx=Dc=null;break;case"mousedown":fx=!0;break;case"contextmenu":case"mouseup":case"dragend":fx=!1,Gk(f,n,d);break;case"selectionchange":if(NP)break;case"keydown":case"keyup":Gk(f,n,d)}var I;if(Ob)e:{switch(t){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else Ic?dN(t,n)&&(C="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(C="onCompositionStart");C&&(uN&&n.locale!=="ko"&&(Ic||C!=="onCompositionStart"?C==="onCompositionEnd"&&Ic&&(I=cN()):(wa=d,Mb="value"in wa?wa.value:wa.textContent,Ic=!0)),k=Lp(u,C),0<k.length&&(C=new $k(C,t,null,n,d),f.push({event:C,listeners:k}),I?C.data=I:(I=fN(n),I!==null&&(C.data=I)))),(I=gP?yP(t,n):xP(t,n))&&(u=Lp(u,"onBeforeInput"),0<u.length&&(d=new $k("onBeforeInput","beforeinput",null,n,d),f.push({event:d,listeners:u}),d.data=I))}_N(f,e)})}function Zd(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Lp(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Kd(t,n),i!=null&&r.unshift(Zd(t,i,s)),i=Kd(t,e),i!=null&&r.push(Zd(t,i,s))),t=t.return}return r}function cc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Jk(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=Kd(n,i),l!=null&&o.unshift(Zd(n,l,a))):s||(l=Kd(n,i),l!=null&&o.push(Zd(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var MP=/\r\n?/g,AP=/\u0000|\uFFFD/g;function Xk(t){return(typeof t=="string"?t:""+t).replace(MP,`
`).replace(AP,"")}function gh(t,e,n){if(e=Xk(e),Xk(t)!==e&&n)throw Error(Et(425))}function $p(){}var hx=null,px=null;function mx(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var gx=typeof setTimeout=="function"?setTimeout:void 0,RP=typeof clearTimeout=="function"?clearTimeout:void 0,Qk=typeof Promise=="function"?Promise:void 0,OP=typeof queueMicrotask=="function"?queueMicrotask:typeof Qk<"u"?function(t){return Qk.resolve(null).then(t).catch(PP)}:gx;function PP(t){setTimeout(function(){throw t})}function w0(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Yd(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Yd(e)}function Na(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Zk(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Eu=Math.random().toString(36).slice(2),io="__reactFiber$"+Eu,ef="__reactProps$"+Eu,Ho="__reactContainer$"+Eu,yx="__reactEvents$"+Eu,LP="__reactListeners$"+Eu,$P="__reactHandles$"+Eu;function Sl(t){var e=t[io];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Ho]||n[io]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Zk(t);t!==null;){if(n=t[io])return n;t=Zk(t)}return e}t=n,n=t.parentNode}return null}function Bf(t){return t=t[io]||t[Ho],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ac(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Et(33))}function pg(t){return t[ef]||null}var xx=[],Rc=-1;function Ga(t){return{current:t}}function qn(t){0>Rc||(t.current=xx[Rc],xx[Rc]=null,Rc--)}function Fn(t,e){Rc++,xx[Rc]=t.current,t.current=e}var Fa={},hs=Ga(Fa),Ls=Ga(!1),Vl=Fa;function fu(t,e){var n=t.type.contextTypes;if(!n)return Fa;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function $s(t){return t=t.childContextTypes,t!=null}function zp(){qn(Ls),qn(hs)}function eS(t,e,n){if(hs.current!==Fa)throw Error(Et(168));Fn(hs,e),Fn(Ls,n)}function CN(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Et(108,kO(t)||"Unknown",s));return ur({},n,r)}function Fp(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Fa,Vl=hs.current,Fn(hs,t),Fn(Ls,Ls.current),!0}function tS(t,e,n){var r=t.stateNode;if(!r)throw Error(Et(169));n?(t=CN(t,e,Vl),r.__reactInternalMemoizedMergedChildContext=t,qn(Ls),qn(hs),Fn(hs,t)):qn(Ls),Fn(Ls,n)}var Ao=null,mg=!1,v0=!1;function EN(t){Ao===null?Ao=[t]:Ao.push(t)}function zP(t){mg=!0,EN(t)}function qa(){if(!v0&&Ao!==null){v0=!0;var t=0,e=Mn;try{var n=Ao;for(Mn=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Ao=null,mg=!1}catch(s){throw Ao!==null&&(Ao=Ao.slice(t+1)),QE(Nb,qa),s}finally{Mn=e,v0=!1}}return null}var Oc=[],Pc=0,Bp=null,Up=0,fi=[],hi=0,Wl=null,Oo=1,Po="";function dl(t,e){Oc[Pc++]=Up,Oc[Pc++]=Bp,Bp=t,Up=e}function NN(t,e,n){fi[hi++]=Oo,fi[hi++]=Po,fi[hi++]=Wl,Wl=t;var r=Oo;t=Po;var s=32-Gi(r)-1;r&=~(1<<s),n+=1;var i=32-Gi(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Oo=1<<32-Gi(e)+s|n<<s|r,Po=i+t}else Oo=1<<i|n<<s|r,Po=t}function Lb(t){t.return!==null&&(dl(t,1),NN(t,1,0))}function $b(t){for(;t===Bp;)Bp=Oc[--Pc],Oc[Pc]=null,Up=Oc[--Pc],Oc[Pc]=null;for(;t===Wl;)Wl=fi[--hi],fi[hi]=null,Po=fi[--hi],fi[hi]=null,Oo=fi[--hi],fi[hi]=null}var Qs=null,Js=null,er=!1,Wi=null;function jN(t,e){var n=gi(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function nS(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Qs=t,Js=Na(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Qs=t,Js=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Wl!==null?{id:Oo,overflow:Po}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=gi(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Qs=t,Js=null,!0):!1;default:return!1}}function bx(t){return(t.mode&1)!==0&&(t.flags&128)===0}function wx(t){if(er){var e=Js;if(e){var n=e;if(!nS(t,e)){if(bx(t))throw Error(Et(418));e=Na(n.nextSibling);var r=Qs;e&&nS(t,e)?jN(r,n):(t.flags=t.flags&-4097|2,er=!1,Qs=t)}}else{if(bx(t))throw Error(Et(418));t.flags=t.flags&-4097|2,er=!1,Qs=t}}}function rS(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Qs=t}function yh(t){if(t!==Qs)return!1;if(!er)return rS(t),er=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!mx(t.type,t.memoizedProps)),e&&(e=Js)){if(bx(t))throw IN(),Error(Et(418));for(;e;)jN(t,e),e=Na(e.nextSibling)}if(rS(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Et(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Js=Na(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Js=null}}else Js=Qs?Na(t.stateNode.nextSibling):null;return!0}function IN(){for(var t=Js;t;)t=Na(t.nextSibling)}function hu(){Js=Qs=null,er=!1}function zb(t){Wi===null?Wi=[t]:Wi.push(t)}var FP=Jo.ReactCurrentBatchConfig;function Gu(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Et(309));var r=n.stateNode}if(!r)throw Error(Et(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(Et(284));if(!n._owner)throw Error(Et(290,t))}return t}function xh(t,e){throw t=Object.prototype.toString.call(e),Error(Et(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function sS(t){var e=t._init;return e(t._payload)}function DN(t){function e(g,v){if(t){var w=g.deletions;w===null?(g.deletions=[v],g.flags|=16):w.push(v)}}function n(g,v){if(!t)return null;for(;v!==null;)e(g,v),v=v.sibling;return null}function r(g,v){for(g=new Map;v!==null;)v.key!==null?g.set(v.key,v):g.set(v.index,v),v=v.sibling;return g}function s(g,v){return g=Ma(g,v),g.index=0,g.sibling=null,g}function i(g,v,w){return g.index=w,t?(w=g.alternate,w!==null?(w=w.index,w<v?(g.flags|=2,v):w):(g.flags|=2,v)):(g.flags|=1048576,v)}function o(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,v,w,T){return v===null||v.tag!==6?(v=N0(w,g.mode,T),v.return=g,v):(v=s(v,w),v.return=g,v)}function l(g,v,w,T){var D=w.type;return D===jc?d(g,v,w.props.children,T,w.key):v!==null&&(v.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===la&&sS(D)===v.type)?(T=s(v,w.props),T.ref=Gu(g,v,w),T.return=g,T):(T=ap(w.type,w.key,w.props,null,g.mode,T),T.ref=Gu(g,v,w),T.return=g,T)}function u(g,v,w,T){return v===null||v.tag!==4||v.stateNode.containerInfo!==w.containerInfo||v.stateNode.implementation!==w.implementation?(v=j0(w,g.mode,T),v.return=g,v):(v=s(v,w.children||[]),v.return=g,v)}function d(g,v,w,T,D){return v===null||v.tag!==7?(v=Ol(w,g.mode,T,D),v.return=g,v):(v=s(v,w),v.return=g,v)}function f(g,v,w){if(typeof v=="string"&&v!==""||typeof v=="number")return v=N0(""+v,g.mode,w),v.return=g,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case ah:return w=ap(v.type,v.key,v.props,null,g.mode,w),w.ref=Gu(g,null,v),w.return=g,w;case Nc:return v=j0(v,g.mode,w),v.return=g,v;case la:var T=v._init;return f(g,T(v._payload),w)}if(id(v)||Uu(v))return v=Ol(v,g.mode,w,null),v.return=g,v;xh(g,v)}return null}function h(g,v,w,T){var D=v!==null?v.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return D!==null?null:a(g,v,""+w,T);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case ah:return w.key===D?l(g,v,w,T):null;case Nc:return w.key===D?u(g,v,w,T):null;case la:return D=w._init,h(g,v,D(w._payload),T)}if(id(w)||Uu(w))return D!==null?null:d(g,v,w,T,null);xh(g,w)}return null}function p(g,v,w,T,D){if(typeof T=="string"&&T!==""||typeof T=="number")return g=g.get(w)||null,a(v,g,""+T,D);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case ah:return g=g.get(T.key===null?w:T.key)||null,l(v,g,T,D);case Nc:return g=g.get(T.key===null?w:T.key)||null,u(v,g,T,D);case la:var k=T._init;return p(g,v,w,k(T._payload),D)}if(id(T)||Uu(T))return g=g.get(w)||null,d(v,g,T,D,null);xh(v,T)}return null}function m(g,v,w,T){for(var D=null,k=null,I=v,C=v=0,S=null;I!==null&&C<w.length;C++){I.index>C?(S=I,I=null):S=I.sibling;var _=h(g,I,w[C],T);if(_===null){I===null&&(I=S);break}t&&I&&_.alternate===null&&e(g,I),v=i(_,v,C),k===null?D=_:k.sibling=_,k=_,I=S}if(C===w.length)return n(g,I),er&&dl(g,C),D;if(I===null){for(;C<w.length;C++)I=f(g,w[C],T),I!==null&&(v=i(I,v,C),k===null?D=I:k.sibling=I,k=I);return er&&dl(g,C),D}for(I=r(g,I);C<w.length;C++)S=p(I,g,C,w[C],T),S!==null&&(t&&S.alternate!==null&&I.delete(S.key===null?C:S.key),v=i(S,v,C),k===null?D=S:k.sibling=S,k=S);return t&&I.forEach(function(N){return e(g,N)}),er&&dl(g,C),D}function y(g,v,w,T){var D=Uu(w);if(typeof D!="function")throw Error(Et(150));if(w=D.call(w),w==null)throw Error(Et(151));for(var k=D=null,I=v,C=v=0,S=null,_=w.next();I!==null&&!_.done;C++,_=w.next()){I.index>C?(S=I,I=null):S=I.sibling;var N=h(g,I,_.value,T);if(N===null){I===null&&(I=S);break}t&&I&&N.alternate===null&&e(g,I),v=i(N,v,C),k===null?D=N:k.sibling=N,k=N,I=S}if(_.done)return n(g,I),er&&dl(g,C),D;if(I===null){for(;!_.done;C++,_=w.next())_=f(g,_.value,T),_!==null&&(v=i(_,v,C),k===null?D=_:k.sibling=_,k=_);return er&&dl(g,C),D}for(I=r(g,I);!_.done;C++,_=w.next())_=p(I,g,C,_.value,T),_!==null&&(t&&_.alternate!==null&&I.delete(_.key===null?C:_.key),v=i(_,v,C),k===null?D=_:k.sibling=_,k=_);return t&&I.forEach(function(j){return e(g,j)}),er&&dl(g,C),D}function x(g,v,w,T){if(typeof w=="object"&&w!==null&&w.type===jc&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case ah:e:{for(var D=w.key,k=v;k!==null;){if(k.key===D){if(D=w.type,D===jc){if(k.tag===7){n(g,k.sibling),v=s(k,w.props.children),v.return=g,g=v;break e}}else if(k.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===la&&sS(D)===k.type){n(g,k.sibling),v=s(k,w.props),v.ref=Gu(g,k,w),v.return=g,g=v;break e}n(g,k);break}else e(g,k);k=k.sibling}w.type===jc?(v=Ol(w.props.children,g.mode,T,w.key),v.return=g,g=v):(T=ap(w.type,w.key,w.props,null,g.mode,T),T.ref=Gu(g,v,w),T.return=g,g=T)}return o(g);case Nc:e:{for(k=w.key;v!==null;){if(v.key===k)if(v.tag===4&&v.stateNode.containerInfo===w.containerInfo&&v.stateNode.implementation===w.implementation){n(g,v.sibling),v=s(v,w.children||[]),v.return=g,g=v;break e}else{n(g,v);break}else e(g,v);v=v.sibling}v=j0(w,g.mode,T),v.return=g,g=v}return o(g);case la:return k=w._init,x(g,v,k(w._payload),T)}if(id(w))return m(g,v,w,T);if(Uu(w))return y(g,v,w,T);xh(g,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,v!==null&&v.tag===6?(n(g,v.sibling),v=s(v,w),v.return=g,g=v):(n(g,v),v=N0(w,g.mode,T),v.return=g,g=v),o(g)):n(g,v)}return x}var pu=DN(!0),MN=DN(!1),Hp=Ga(null),Vp=null,Lc=null,Fb=null;function Bb(){Fb=Lc=Vp=null}function Ub(t){var e=Hp.current;qn(Hp),t._currentValue=e}function vx(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function eu(t,e){Vp=t,Fb=Lc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Rs=!0),t.firstContext=null)}function Ti(t){var e=t._currentValue;if(Fb!==t)if(t={context:t,memoizedValue:e,next:null},Lc===null){if(Vp===null)throw Error(Et(308));Lc=t,Vp.dependencies={lanes:0,firstContext:t}}else Lc=Lc.next=t;return e}var _l=null;function Hb(t){_l===null?_l=[t]:_l.push(t)}function AN(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,Hb(e)):(n.next=s.next,s.next=n),e.interleaved=n,Vo(t,r)}function Vo(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var ca=!1;function Vb(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function RN(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function $o(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ja(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,_n&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Vo(t,n)}return s=r.interleaved,s===null?(e.next=e,Hb(r)):(e.next=s.next,s.next=e),r.interleaved=e,Vo(t,n)}function tp(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,jb(t,n)}}function iS(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Wp(t,e,n,r){var s=t.updateQueue;ca=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var d=t.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=u:a.next=u,d.lastBaseUpdate=l))}if(i!==null){var f=s.baseState;o=0,d=u=l=null,a=i;do{var h=a.lane,p=a.eventTime;if((r&h)===h){d!==null&&(d=d.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=t,y=a;switch(h=e,p=n,y.tag){case 1:if(m=y.payload,typeof m=="function"){f=m.call(p,f,h);break e}f=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=y.payload,h=typeof m=="function"?m.call(p,f,h):m,h==null)break e;f=ur({},f,h);break e;case 2:ca=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=s.effects,h===null?s.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(u=d=p,l=f):d=d.next=p,o|=h;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;h=a,a=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(1);if(d===null&&(l=f),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=d,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Gl|=o,t.lanes=o,t.memoizedState=f}}function oS(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(Et(191,s));s.call(r)}}}var Uf={},ho=Ga(Uf),tf=Ga(Uf),nf=Ga(Uf);function Tl(t){if(t===Uf)throw Error(Et(174));return t}function Wb(t,e){switch(Fn(nf,e),Fn(tf,t),Fn(ho,Uf),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:tx(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=tx(e,t)}qn(ho),Fn(ho,e)}function mu(){qn(ho),qn(tf),qn(nf)}function ON(t){Tl(nf.current);var e=Tl(ho.current),n=tx(e,t.type);e!==n&&(Fn(tf,t),Fn(ho,n))}function Kb(t){tf.current===t&&(qn(ho),qn(tf))}var ar=Ga(0);function Kp(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var k0=[];function Gb(){for(var t=0;t<k0.length;t++)k0[t]._workInProgressVersionPrimary=null;k0.length=0}var np=Jo.ReactCurrentDispatcher,S0=Jo.ReactCurrentBatchConfig,Kl=0,cr=null,Dr=null,Lr=null,Gp=!1,wd=!1,rf=0,BP=0;function ss(){throw Error(Et(321))}function qb(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Yi(t[n],e[n]))return!1;return!0}function Yb(t,e,n,r,s,i){if(Kl=i,cr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,np.current=t===null||t.memoizedState===null?WP:KP,t=n(r,s),wd){i=0;do{if(wd=!1,rf=0,25<=i)throw Error(Et(301));i+=1,Lr=Dr=null,e.updateQueue=null,np.current=GP,t=n(r,s)}while(wd)}if(np.current=qp,e=Dr!==null&&Dr.next!==null,Kl=0,Lr=Dr=cr=null,Gp=!1,e)throw Error(Et(300));return t}function Jb(){var t=rf!==0;return rf=0,t}function Zi(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Lr===null?cr.memoizedState=Lr=t:Lr=Lr.next=t,Lr}function Ci(){if(Dr===null){var t=cr.alternate;t=t!==null?t.memoizedState:null}else t=Dr.next;var e=Lr===null?cr.memoizedState:Lr.next;if(e!==null)Lr=e,Dr=t;else{if(t===null)throw Error(Et(310));Dr=t,t={memoizedState:Dr.memoizedState,baseState:Dr.baseState,baseQueue:Dr.baseQueue,queue:Dr.queue,next:null},Lr===null?cr.memoizedState=Lr=t:Lr=Lr.next=t}return Lr}function sf(t,e){return typeof e=="function"?e(t):e}function _0(t){var e=Ci(),n=e.queue;if(n===null)throw Error(Et(311));n.lastRenderedReducer=t;var r=Dr,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var d=u.lane;if((Kl&d)===d)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var f={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,cr.lanes|=d,Gl|=d}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,Yi(r,e.memoizedState)||(Rs=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,cr.lanes|=i,Gl|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function T0(t){var e=Ci(),n=e.queue;if(n===null)throw Error(Et(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);Yi(i,e.memoizedState)||(Rs=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function PN(){}function LN(t,e){var n=cr,r=Ci(),s=e(),i=!Yi(r.memoizedState,s);if(i&&(r.memoizedState=s,Rs=!0),r=r.queue,Xb(FN.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Lr!==null&&Lr.memoizedState.tag&1){if(n.flags|=2048,of(9,zN.bind(null,n,r,s,e),void 0,null),Fr===null)throw Error(Et(349));Kl&30||$N(n,e,s)}return s}function $N(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=cr.updateQueue,e===null?(e={lastEffect:null,stores:null},cr.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function zN(t,e,n,r){e.value=n,e.getSnapshot=r,BN(e)&&UN(t)}function FN(t,e,n){return n(function(){BN(e)&&UN(t)})}function BN(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Yi(t,n)}catch{return!0}}function UN(t){var e=Vo(t,1);e!==null&&qi(e,t,1,-1)}function aS(t){var e=Zi();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:sf,lastRenderedState:t},e.queue=t,t=t.dispatch=VP.bind(null,cr,t),[e.memoizedState,t]}function of(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=cr.updateQueue,e===null?(e={lastEffect:null,stores:null},cr.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function HN(){return Ci().memoizedState}function rp(t,e,n,r){var s=Zi();cr.flags|=t,s.memoizedState=of(1|e,n,void 0,r===void 0?null:r)}function gg(t,e,n,r){var s=Ci();r=r===void 0?null:r;var i=void 0;if(Dr!==null){var o=Dr.memoizedState;if(i=o.destroy,r!==null&&qb(r,o.deps)){s.memoizedState=of(e,n,i,r);return}}cr.flags|=t,s.memoizedState=of(1|e,n,i,r)}function lS(t,e){return rp(8390656,8,t,e)}function Xb(t,e){return gg(2048,8,t,e)}function VN(t,e){return gg(4,2,t,e)}function WN(t,e){return gg(4,4,t,e)}function KN(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function GN(t,e,n){return n=n!=null?n.concat([t]):null,gg(4,4,KN.bind(null,e,t),n)}function Qb(){}function qN(t,e){var n=Ci();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&qb(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function YN(t,e){var n=Ci();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&qb(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function JN(t,e,n){return Kl&21?(Yi(n,e)||(n=tN(),cr.lanes|=n,Gl|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Rs=!0),t.memoizedState=n)}function UP(t,e){var n=Mn;Mn=n!==0&&4>n?n:4,t(!0);var r=S0.transition;S0.transition={};try{t(!1),e()}finally{Mn=n,S0.transition=r}}function XN(){return Ci().memoizedState}function HP(t,e,n){var r=Da(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},QN(t))ZN(e,n);else if(n=AN(t,e,n,r),n!==null){var s=ks();qi(n,t,r,s),ej(n,e,r)}}function VP(t,e,n){var r=Da(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(QN(t))ZN(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(s.hasEagerState=!0,s.eagerState=a,Yi(a,o)){var l=e.interleaved;l===null?(s.next=s,Hb(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}n=AN(t,e,s,r),n!==null&&(s=ks(),qi(n,t,r,s),ej(n,e,r))}}function QN(t){var e=t.alternate;return t===cr||e!==null&&e===cr}function ZN(t,e){wd=Gp=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function ej(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,jb(t,n)}}var qp={readContext:Ti,useCallback:ss,useContext:ss,useEffect:ss,useImperativeHandle:ss,useInsertionEffect:ss,useLayoutEffect:ss,useMemo:ss,useReducer:ss,useRef:ss,useState:ss,useDebugValue:ss,useDeferredValue:ss,useTransition:ss,useMutableSource:ss,useSyncExternalStore:ss,useId:ss,unstable_isNewReconciler:!1},WP={readContext:Ti,useCallback:function(t,e){return Zi().memoizedState=[t,e===void 0?null:e],t},useContext:Ti,useEffect:lS,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,rp(4194308,4,KN.bind(null,e,t),n)},useLayoutEffect:function(t,e){return rp(4194308,4,t,e)},useInsertionEffect:function(t,e){return rp(4,2,t,e)},useMemo:function(t,e){var n=Zi();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Zi();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=HP.bind(null,cr,t),[r.memoizedState,t]},useRef:function(t){var e=Zi();return t={current:t},e.memoizedState=t},useState:aS,useDebugValue:Qb,useDeferredValue:function(t){return Zi().memoizedState=t},useTransition:function(){var t=aS(!1),e=t[0];return t=UP.bind(null,t[1]),Zi().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=cr,s=Zi();if(er){if(n===void 0)throw Error(Et(407));n=n()}else{if(n=e(),Fr===null)throw Error(Et(349));Kl&30||$N(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,lS(FN.bind(null,r,i,t),[t]),r.flags|=2048,of(9,zN.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Zi(),e=Fr.identifierPrefix;if(er){var n=Po,r=Oo;n=(r&~(1<<32-Gi(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=rf++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=BP++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},KP={readContext:Ti,useCallback:qN,useContext:Ti,useEffect:Xb,useImperativeHandle:GN,useInsertionEffect:VN,useLayoutEffect:WN,useMemo:YN,useReducer:_0,useRef:HN,useState:function(){return _0(sf)},useDebugValue:Qb,useDeferredValue:function(t){var e=Ci();return JN(e,Dr.memoizedState,t)},useTransition:function(){var t=_0(sf)[0],e=Ci().memoizedState;return[t,e]},useMutableSource:PN,useSyncExternalStore:LN,useId:XN,unstable_isNewReconciler:!1},GP={readContext:Ti,useCallback:qN,useContext:Ti,useEffect:Xb,useImperativeHandle:GN,useInsertionEffect:VN,useLayoutEffect:WN,useMemo:YN,useReducer:T0,useRef:HN,useState:function(){return T0(sf)},useDebugValue:Qb,useDeferredValue:function(t){var e=Ci();return Dr===null?e.memoizedState=t:JN(e,Dr.memoizedState,t)},useTransition:function(){var t=T0(sf)[0],e=Ci().memoizedState;return[t,e]},useMutableSource:PN,useSyncExternalStore:LN,useId:XN,unstable_isNewReconciler:!1};function Fi(t,e){if(t&&t.defaultProps){e=ur({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function kx(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:ur({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var yg={isMounted:function(t){return(t=t._reactInternals)?nc(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=ks(),s=Da(t),i=$o(r,s);i.payload=e,n!=null&&(i.callback=n),e=ja(t,i,s),e!==null&&(qi(e,t,s,r),tp(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=ks(),s=Da(t),i=$o(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=ja(t,i,s),e!==null&&(qi(e,t,s,r),tp(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=ks(),r=Da(t),s=$o(n,r);s.tag=2,e!=null&&(s.callback=e),e=ja(t,s,r),e!==null&&(qi(e,t,r,n),tp(e,t,r))}};function cS(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!Xd(n,r)||!Xd(s,i):!0}function tj(t,e,n){var r=!1,s=Fa,i=e.contextType;return typeof i=="object"&&i!==null?i=Ti(i):(s=$s(e)?Vl:hs.current,r=e.contextTypes,i=(r=r!=null)?fu(t,s):Fa),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=yg,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function uS(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&yg.enqueueReplaceState(e,e.state,null)}function Sx(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Vb(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Ti(i):(i=$s(e)?Vl:hs.current,s.context=fu(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(kx(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&yg.enqueueReplaceState(s,s.state,null),Wp(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function gu(t,e){try{var n="",r=e;do n+=vO(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function C0(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function _x(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var qP=typeof WeakMap=="function"?WeakMap:Map;function nj(t,e,n){n=$o(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Jp||(Jp=!0,Rx=r),_x(t,e)},n}function rj(t,e,n){n=$o(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){_x(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){_x(t,e),typeof r!="function"&&(Ia===null?Ia=new Set([this]):Ia.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function dS(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new qP;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=l4.bind(null,t,e,n),e.then(t,t))}function fS(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function hS(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=$o(-1,1),e.tag=2,ja(n,e,1))),n.lanes|=1),t)}var YP=Jo.ReactCurrentOwner,Rs=!1;function ws(t,e,n,r){e.child=t===null?MN(e,null,n,r):pu(e,t.child,n,r)}function pS(t,e,n,r,s){n=n.render;var i=e.ref;return eu(e,s),r=Yb(t,e,n,r,i,s),n=Jb(),t!==null&&!Rs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Wo(t,e,s)):(er&&n&&Lb(e),e.flags|=1,ws(t,e,r,s),e.child)}function mS(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!ow(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,sj(t,e,i,r,s)):(t=ap(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:Xd,n(o,r)&&t.ref===e.ref)return Wo(t,e,s)}return e.flags|=1,t=Ma(i,r),t.ref=e.ref,t.return=e,e.child=t}function sj(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(Xd(i,r)&&t.ref===e.ref)if(Rs=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Rs=!0);else return e.lanes=t.lanes,Wo(t,e,s)}return Tx(t,e,n,r,s)}function ij(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Fn(zc,Ks),Ks|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Fn(zc,Ks),Ks|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Fn(zc,Ks),Ks|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Fn(zc,Ks),Ks|=r;return ws(t,e,s,n),e.child}function oj(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Tx(t,e,n,r,s){var i=$s(n)?Vl:hs.current;return i=fu(e,i),eu(e,s),n=Yb(t,e,n,r,i,s),r=Jb(),t!==null&&!Rs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Wo(t,e,s)):(er&&r&&Lb(e),e.flags|=1,ws(t,e,n,s),e.child)}function gS(t,e,n,r,s){if($s(n)){var i=!0;Fp(e)}else i=!1;if(eu(e,s),e.stateNode===null)sp(t,e),tj(e,n,r),Sx(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=Ti(u):(u=$s(n)?Vl:hs.current,u=fu(e,u));var d=n.getDerivedStateFromProps,f=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&uS(e,o,r,u),ca=!1;var h=e.memoizedState;o.state=h,Wp(e,r,o,s),l=e.memoizedState,a!==r||h!==l||Ls.current||ca?(typeof d=="function"&&(kx(e,n,d,r),l=e.memoizedState),(a=ca||cS(e,n,a,r,h,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,RN(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:Fi(e.type,a),o.props=u,f=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Ti(l):(l=$s(n)?Vl:hs.current,l=fu(e,l));var p=n.getDerivedStateFromProps;(d=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||h!==l)&&uS(e,o,r,l),ca=!1,h=e.memoizedState,o.state=h,Wp(e,r,o,s);var m=e.memoizedState;a!==f||h!==m||Ls.current||ca?(typeof p=="function"&&(kx(e,n,p,r),m=e.memoizedState),(u=ca||cS(e,n,u,r,h,m,l)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),o.props=r,o.state=m,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return Cx(t,e,n,r,i,s)}function Cx(t,e,n,r,s,i){oj(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&tS(e,n,!1),Wo(t,e,i);r=e.stateNode,YP.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=pu(e,t.child,null,i),e.child=pu(e,null,a,i)):ws(t,e,a,i),e.memoizedState=r.state,s&&tS(e,n,!0),e.child}function aj(t){var e=t.stateNode;e.pendingContext?eS(t,e.pendingContext,e.pendingContext!==e.context):e.context&&eS(t,e.context,!1),Wb(t,e.containerInfo)}function yS(t,e,n,r,s){return hu(),zb(s),e.flags|=256,ws(t,e,n,r),e.child}var Ex={dehydrated:null,treeContext:null,retryLane:0};function Nx(t){return{baseLanes:t,cachePool:null,transitions:null}}function lj(t,e,n){var r=e.pendingProps,s=ar.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Fn(ar,s&1),t===null)return wx(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=wg(o,r,0,null),t=Ol(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Nx(n),e.memoizedState=Ex,t):Zb(e,o));if(s=t.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return JP(t,e,o,r,a,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Ma(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Ma(a,i):(i=Ol(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?Nx(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=Ex,r}return i=t.child,t=i.sibling,r=Ma(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Zb(t,e){return e=wg({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function bh(t,e,n,r){return r!==null&&zb(r),pu(e,t.child,null,n),t=Zb(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function JP(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=C0(Error(Et(422))),bh(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=wg({mode:"visible",children:r.children},s,0,null),i=Ol(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&pu(e,t.child,null,o),e.child.memoizedState=Nx(o),e.memoizedState=Ex,i);if(!(e.mode&1))return bh(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(Et(419)),r=C0(i,r,void 0),bh(t,e,o,r)}if(a=(o&t.childLanes)!==0,Rs||a){if(r=Fr,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Vo(t,s),qi(r,t,s,-1))}return iw(),r=C0(Error(Et(421))),bh(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=c4.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Js=Na(s.nextSibling),Qs=e,er=!0,Wi=null,t!==null&&(fi[hi++]=Oo,fi[hi++]=Po,fi[hi++]=Wl,Oo=t.id,Po=t.overflow,Wl=e),e=Zb(e,r.children),e.flags|=4096,e)}function xS(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),vx(t.return,e,n)}function E0(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function cj(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(ws(t,e,r.children,n),r=ar.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&xS(t,n,e);else if(t.tag===19)xS(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Fn(ar,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Kp(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),E0(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Kp(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}E0(e,!0,n,null,i);break;case"together":E0(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function sp(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Wo(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Gl|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Et(153));if(e.child!==null){for(t=e.child,n=Ma(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ma(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function XP(t,e,n){switch(e.tag){case 3:aj(e),hu();break;case 5:ON(e);break;case 1:$s(e.type)&&Fp(e);break;case 4:Wb(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Fn(Hp,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Fn(ar,ar.current&1),e.flags|=128,null):n&e.child.childLanes?lj(t,e,n):(Fn(ar,ar.current&1),t=Wo(t,e,n),t!==null?t.sibling:null);Fn(ar,ar.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return cj(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Fn(ar,ar.current),r)break;return null;case 22:case 23:return e.lanes=0,ij(t,e,n)}return Wo(t,e,n)}var uj,jx,dj,fj;uj=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};jx=function(){};dj=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Tl(ho.current);var i=null;switch(n){case"input":s=Xy(t,s),r=Xy(t,r),i=[];break;case"select":s=ur({},s,{value:void 0}),r=ur({},r,{value:void 0}),i=[];break;case"textarea":s=ex(t,s),r=ex(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=$p)}nx(n,r);var o;n=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Vd.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(i||(i=[]),i.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Vd.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Vn("scroll",t),i||a===l||(i=[])):(i=i||[]).push(u,l))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};fj=function(t,e,n,r){n!==r&&(e.flags|=4)};function qu(t,e){if(!er)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function is(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function QP(t,e,n){var r=e.pendingProps;switch($b(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return is(e),null;case 1:return $s(e.type)&&zp(),is(e),null;case 3:return r=e.stateNode,mu(),qn(Ls),qn(hs),Gb(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(yh(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Wi!==null&&(Lx(Wi),Wi=null))),jx(t,e),is(e),null;case 5:Kb(e);var s=Tl(nf.current);if(n=e.type,t!==null&&e.stateNode!=null)dj(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Et(166));return is(e),null}if(t=Tl(ho.current),yh(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[io]=e,r[ef]=i,t=(e.mode&1)!==0,n){case"dialog":Vn("cancel",r),Vn("close",r);break;case"iframe":case"object":case"embed":Vn("load",r);break;case"video":case"audio":for(s=0;s<ad.length;s++)Vn(ad[s],r);break;case"source":Vn("error",r);break;case"img":case"image":case"link":Vn("error",r),Vn("load",r);break;case"details":Vn("toggle",r);break;case"input":Ek(r,i),Vn("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Vn("invalid",r);break;case"textarea":jk(r,i),Vn("invalid",r)}nx(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&gh(r.textContent,a,t),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&gh(r.textContent,a,t),s=["children",""+a]):Vd.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Vn("scroll",r)}switch(n){case"input":lh(r),Nk(r,i,!0);break;case"textarea":lh(r),Ik(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=$p)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=FE(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[io]=e,t[ef]=r,uj(t,e,!1,!1),e.stateNode=t;e:{switch(o=rx(n,r),n){case"dialog":Vn("cancel",t),Vn("close",t),s=r;break;case"iframe":case"object":case"embed":Vn("load",t),s=r;break;case"video":case"audio":for(s=0;s<ad.length;s++)Vn(ad[s],t);s=r;break;case"source":Vn("error",t),s=r;break;case"img":case"image":case"link":Vn("error",t),Vn("load",t),s=r;break;case"details":Vn("toggle",t),s=r;break;case"input":Ek(t,r),s=Xy(t,r),Vn("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=ur({},r,{value:void 0}),Vn("invalid",t);break;case"textarea":jk(t,r),s=ex(t,r),Vn("invalid",t);break;default:s=r}nx(n,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?HE(t,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&BE(t,l)):i==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Wd(t,l):typeof l=="number"&&Wd(t,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Vd.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Vn("scroll",t):l!=null&&Sb(t,i,l,o))}switch(n){case"input":lh(t),Nk(t,r,!1);break;case"textarea":lh(t),Ik(t);break;case"option":r.value!=null&&t.setAttribute("value",""+za(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?Jc(t,!!r.multiple,i,!1):r.defaultValue!=null&&Jc(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=$p)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return is(e),null;case 6:if(t&&e.stateNode!=null)fj(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Et(166));if(n=Tl(nf.current),Tl(ho.current),yh(e)){if(r=e.stateNode,n=e.memoizedProps,r[io]=e,(i=r.nodeValue!==n)&&(t=Qs,t!==null))switch(t.tag){case 3:gh(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&gh(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[io]=e,e.stateNode=r}return is(e),null;case 13:if(qn(ar),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(er&&Js!==null&&e.mode&1&&!(e.flags&128))IN(),hu(),e.flags|=98560,i=!1;else if(i=yh(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(Et(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Et(317));i[io]=e}else hu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;is(e),i=!1}else Wi!==null&&(Lx(Wi),Wi=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||ar.current&1?Ar===0&&(Ar=3):iw())),e.updateQueue!==null&&(e.flags|=4),is(e),null);case 4:return mu(),jx(t,e),t===null&&Qd(e.stateNode.containerInfo),is(e),null;case 10:return Ub(e.type._context),is(e),null;case 17:return $s(e.type)&&zp(),is(e),null;case 19:if(qn(ar),i=e.memoizedState,i===null)return is(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)qu(i,!1);else{if(Ar!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Kp(t),o!==null){for(e.flags|=128,qu(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Fn(ar,ar.current&1|2),e.child}t=t.sibling}i.tail!==null&&br()>yu&&(e.flags|=128,r=!0,qu(i,!1),e.lanes=4194304)}else{if(!r)if(t=Kp(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),qu(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!er)return is(e),null}else 2*br()-i.renderingStartTime>yu&&n!==1073741824&&(e.flags|=128,r=!0,qu(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=br(),e.sibling=null,n=ar.current,Fn(ar,r?n&1|2:n&1),e):(is(e),null);case 22:case 23:return sw(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Ks&1073741824&&(is(e),e.subtreeFlags&6&&(e.flags|=8192)):is(e),null;case 24:return null;case 25:return null}throw Error(Et(156,e.tag))}function ZP(t,e){switch($b(e),e.tag){case 1:return $s(e.type)&&zp(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return mu(),qn(Ls),qn(hs),Gb(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Kb(e),null;case 13:if(qn(ar),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Et(340));hu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return qn(ar),null;case 4:return mu(),null;case 10:return Ub(e.type._context),null;case 22:case 23:return sw(),null;case 24:return null;default:return null}}var wh=!1,us=!1,e4=typeof WeakSet=="function"?WeakSet:Set,Ut=null;function $c(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){pr(t,e,r)}else n.current=null}function Ix(t,e,n){try{n()}catch(r){pr(t,e,r)}}var bS=!1;function t4(t,e){if(hx=Op,t=yN(),Pb(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,u=0,d=0,f=t,h=null;t:for(;;){for(var p;f!==n||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(p=f.firstChild)!==null;)h=f,f=p;for(;;){if(f===t)break t;if(h===n&&++u===s&&(a=o),h===i&&++d===r&&(l=o),(p=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=p}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(px={focusedElem:t,selectionRange:n},Op=!1,Ut=e;Ut!==null;)if(e=Ut,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ut=t;else for(;Ut!==null;){e=Ut;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var y=m.memoizedProps,x=m.memoizedState,g=e.stateNode,v=g.getSnapshotBeforeUpdate(e.elementType===e.type?y:Fi(e.type,y),x);g.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Et(163))}}catch(T){pr(e,e.return,T)}if(t=e.sibling,t!==null){t.return=e.return,Ut=t;break}Ut=e.return}return m=bS,bS=!1,m}function vd(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Ix(e,n,i)}s=s.next}while(s!==r)}}function xg(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Dx(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function hj(t){var e=t.alternate;e!==null&&(t.alternate=null,hj(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[io],delete e[ef],delete e[yx],delete e[LP],delete e[$P])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function pj(t){return t.tag===5||t.tag===3||t.tag===4}function wS(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||pj(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Mx(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=$p));else if(r!==4&&(t=t.child,t!==null))for(Mx(t,e,n),t=t.sibling;t!==null;)Mx(t,e,n),t=t.sibling}function Ax(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Ax(t,e,n),t=t.sibling;t!==null;)Ax(t,e,n),t=t.sibling}var qr=null,Ui=!1;function ea(t,e,n){for(n=n.child;n!==null;)mj(t,e,n),n=n.sibling}function mj(t,e,n){if(fo&&typeof fo.onCommitFiberUnmount=="function")try{fo.onCommitFiberUnmount(ug,n)}catch{}switch(n.tag){case 5:us||$c(n,e);case 6:var r=qr,s=Ui;qr=null,ea(t,e,n),qr=r,Ui=s,qr!==null&&(Ui?(t=qr,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):qr.removeChild(n.stateNode));break;case 18:qr!==null&&(Ui?(t=qr,n=n.stateNode,t.nodeType===8?w0(t.parentNode,n):t.nodeType===1&&w0(t,n),Yd(t)):w0(qr,n.stateNode));break;case 4:r=qr,s=Ui,qr=n.stateNode.containerInfo,Ui=!0,ea(t,e,n),qr=r,Ui=s;break;case 0:case 11:case 14:case 15:if(!us&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Ix(n,e,o),s=s.next}while(s!==r)}ea(t,e,n);break;case 1:if(!us&&($c(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){pr(n,e,a)}ea(t,e,n);break;case 21:ea(t,e,n);break;case 22:n.mode&1?(us=(r=us)||n.memoizedState!==null,ea(t,e,n),us=r):ea(t,e,n);break;default:ea(t,e,n)}}function vS(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new e4),e.forEach(function(r){var s=u4.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Mi(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:qr=a.stateNode,Ui=!1;break e;case 3:qr=a.stateNode.containerInfo,Ui=!0;break e;case 4:qr=a.stateNode.containerInfo,Ui=!0;break e}a=a.return}if(qr===null)throw Error(Et(160));mj(i,o,s),qr=null,Ui=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){pr(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)gj(e,t),e=e.sibling}function gj(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Mi(e,t),Qi(t),r&4){try{vd(3,t,t.return),xg(3,t)}catch(y){pr(t,t.return,y)}try{vd(5,t,t.return)}catch(y){pr(t,t.return,y)}}break;case 1:Mi(e,t),Qi(t),r&512&&n!==null&&$c(n,n.return);break;case 5:if(Mi(e,t),Qi(t),r&512&&n!==null&&$c(n,n.return),t.flags&32){var s=t.stateNode;try{Wd(s,"")}catch(y){pr(t,t.return,y)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&$E(s,i),rx(a,o);var u=rx(a,i);for(o=0;o<l.length;o+=2){var d=l[o],f=l[o+1];d==="style"?HE(s,f):d==="dangerouslySetInnerHTML"?BE(s,f):d==="children"?Wd(s,f):Sb(s,d,f,u)}switch(a){case"input":Qy(s,i);break;case"textarea":zE(s,i);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?Jc(s,!!i.multiple,p,!1):h!==!!i.multiple&&(i.defaultValue!=null?Jc(s,!!i.multiple,i.defaultValue,!0):Jc(s,!!i.multiple,i.multiple?[]:"",!1))}s[ef]=i}catch(y){pr(t,t.return,y)}}break;case 6:if(Mi(e,t),Qi(t),r&4){if(t.stateNode===null)throw Error(Et(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(y){pr(t,t.return,y)}}break;case 3:if(Mi(e,t),Qi(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Yd(e.containerInfo)}catch(y){pr(t,t.return,y)}break;case 4:Mi(e,t),Qi(t);break;case 13:Mi(e,t),Qi(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(nw=br())),r&4&&vS(t);break;case 22:if(d=n!==null&&n.memoizedState!==null,t.mode&1?(us=(u=us)||d,Mi(e,t),us=u):Mi(e,t),Qi(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!d&&t.mode&1)for(Ut=t,d=t.child;d!==null;){for(f=Ut=d;Ut!==null;){switch(h=Ut,p=h.child,h.tag){case 0:case 11:case 14:case 15:vd(4,h,h.return);break;case 1:$c(h,h.return);var m=h.stateNode;if(typeof m.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(y){pr(r,n,y)}}break;case 5:$c(h,h.return);break;case 22:if(h.memoizedState!==null){SS(f);continue}}p!==null?(p.return=h,Ut=p):SS(f)}d=d.sibling}e:for(d=null,f=t;;){if(f.tag===5){if(d===null){d=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=UE("display",o))}catch(y){pr(t,t.return,y)}}}else if(f.tag===6){if(d===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(y){pr(t,t.return,y)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Mi(e,t),Qi(t),r&4&&vS(t);break;case 21:break;default:Mi(e,t),Qi(t)}}function Qi(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(pj(n)){var r=n;break e}n=n.return}throw Error(Et(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Wd(s,""),r.flags&=-33);var i=wS(t);Ax(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=wS(t);Mx(t,a,o);break;default:throw Error(Et(161))}}catch(l){pr(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function n4(t,e,n){Ut=t,yj(t)}function yj(t,e,n){for(var r=(t.mode&1)!==0;Ut!==null;){var s=Ut,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||wh;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||us;a=wh;var u=us;if(wh=o,(us=l)&&!u)for(Ut=s;Ut!==null;)o=Ut,l=o.child,o.tag===22&&o.memoizedState!==null?_S(s):l!==null?(l.return=o,Ut=l):_S(s);for(;i!==null;)Ut=i,yj(i),i=i.sibling;Ut=s,wh=a,us=u}kS(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,Ut=i):kS(t)}}function kS(t){for(;Ut!==null;){var e=Ut;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:us||xg(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!us)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Fi(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&oS(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}oS(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var f=d.dehydrated;f!==null&&Yd(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Et(163))}us||e.flags&512&&Dx(e)}catch(h){pr(e,e.return,h)}}if(e===t){Ut=null;break}if(n=e.sibling,n!==null){n.return=e.return,Ut=n;break}Ut=e.return}}function SS(t){for(;Ut!==null;){var e=Ut;if(e===t){Ut=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Ut=n;break}Ut=e.return}}function _S(t){for(;Ut!==null;){var e=Ut;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{xg(4,e)}catch(l){pr(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){pr(e,s,l)}}var i=e.return;try{Dx(e)}catch(l){pr(e,i,l)}break;case 5:var o=e.return;try{Dx(e)}catch(l){pr(e,o,l)}}}catch(l){pr(e,e.return,l)}if(e===t){Ut=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ut=a;break}Ut=e.return}}var r4=Math.ceil,Yp=Jo.ReactCurrentDispatcher,ew=Jo.ReactCurrentOwner,wi=Jo.ReactCurrentBatchConfig,_n=0,Fr=null,_r=null,Zr=0,Ks=0,zc=Ga(0),Ar=0,af=null,Gl=0,bg=0,tw=0,kd=null,Ds=null,nw=0,yu=1/0,Io=null,Jp=!1,Rx=null,Ia=null,vh=!1,va=null,Xp=0,Sd=0,Ox=null,ip=-1,op=0;function ks(){return _n&6?br():ip!==-1?ip:ip=br()}function Da(t){return t.mode&1?_n&2&&Zr!==0?Zr&-Zr:FP.transition!==null?(op===0&&(op=tN()),op):(t=Mn,t!==0||(t=window.event,t=t===void 0?16:lN(t.type)),t):1}function qi(t,e,n,r){if(50<Sd)throw Sd=0,Ox=null,Error(Et(185));zf(t,n,r),(!(_n&2)||t!==Fr)&&(t===Fr&&(!(_n&2)&&(bg|=n),Ar===4&&ga(t,Zr)),zs(t,r),n===1&&_n===0&&!(e.mode&1)&&(yu=br()+500,mg&&qa()))}function zs(t,e){var n=t.callbackNode;FO(t,e);var r=Rp(t,t===Fr?Zr:0);if(r===0)n!==null&&Ak(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Ak(n),e===1)t.tag===0?zP(TS.bind(null,t)):EN(TS.bind(null,t)),OP(function(){!(_n&6)&&qa()}),n=null;else{switch(nN(r)){case 1:n=Nb;break;case 4:n=ZE;break;case 16:n=Ap;break;case 536870912:n=eN;break;default:n=Ap}n=Tj(n,xj.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function xj(t,e){if(ip=-1,op=0,_n&6)throw Error(Et(327));var n=t.callbackNode;if(tu()&&t.callbackNode!==n)return null;var r=Rp(t,t===Fr?Zr:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Qp(t,r);else{e=r;var s=_n;_n|=2;var i=wj();(Fr!==t||Zr!==e)&&(Io=null,yu=br()+500,Rl(t,e));do try{o4();break}catch(a){bj(t,a)}while(1);Bb(),Yp.current=i,_n=s,_r!==null?e=0:(Fr=null,Zr=0,e=Ar)}if(e!==0){if(e===2&&(s=lx(t),s!==0&&(r=s,e=Px(t,s))),e===1)throw n=af,Rl(t,0),ga(t,r),zs(t,br()),n;if(e===6)ga(t,r);else{if(s=t.current.alternate,!(r&30)&&!s4(s)&&(e=Qp(t,r),e===2&&(i=lx(t),i!==0&&(r=i,e=Px(t,i))),e===1))throw n=af,Rl(t,0),ga(t,r),zs(t,br()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(Et(345));case 2:fl(t,Ds,Io);break;case 3:if(ga(t,r),(r&130023424)===r&&(e=nw+500-br(),10<e)){if(Rp(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){ks(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=gx(fl.bind(null,t,Ds,Io),e);break}fl(t,Ds,Io);break;case 4:if(ga(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-Gi(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=br()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*r4(r/1960))-r,10<r){t.timeoutHandle=gx(fl.bind(null,t,Ds,Io),r);break}fl(t,Ds,Io);break;case 5:fl(t,Ds,Io);break;default:throw Error(Et(329))}}}return zs(t,br()),t.callbackNode===n?xj.bind(null,t):null}function Px(t,e){var n=kd;return t.current.memoizedState.isDehydrated&&(Rl(t,e).flags|=256),t=Qp(t,e),t!==2&&(e=Ds,Ds=n,e!==null&&Lx(e)),t}function Lx(t){Ds===null?Ds=t:Ds.push.apply(Ds,t)}function s4(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!Yi(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ga(t,e){for(e&=~tw,e&=~bg,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Gi(e),r=1<<n;t[n]=-1,e&=~r}}function TS(t){if(_n&6)throw Error(Et(327));tu();var e=Rp(t,0);if(!(e&1))return zs(t,br()),null;var n=Qp(t,e);if(t.tag!==0&&n===2){var r=lx(t);r!==0&&(e=r,n=Px(t,r))}if(n===1)throw n=af,Rl(t,0),ga(t,e),zs(t,br()),n;if(n===6)throw Error(Et(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,fl(t,Ds,Io),zs(t,br()),null}function rw(t,e){var n=_n;_n|=1;try{return t(e)}finally{_n=n,_n===0&&(yu=br()+500,mg&&qa())}}function ql(t){va!==null&&va.tag===0&&!(_n&6)&&tu();var e=_n;_n|=1;var n=wi.transition,r=Mn;try{if(wi.transition=null,Mn=1,t)return t()}finally{Mn=r,wi.transition=n,_n=e,!(_n&6)&&qa()}}function sw(){Ks=zc.current,qn(zc)}function Rl(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,RP(n)),_r!==null)for(n=_r.return;n!==null;){var r=n;switch($b(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&zp();break;case 3:mu(),qn(Ls),qn(hs),Gb();break;case 5:Kb(r);break;case 4:mu();break;case 13:qn(ar);break;case 19:qn(ar);break;case 10:Ub(r.type._context);break;case 22:case 23:sw()}n=n.return}if(Fr=t,_r=t=Ma(t.current,null),Zr=Ks=e,Ar=0,af=null,tw=bg=Gl=0,Ds=kd=null,_l!==null){for(e=0;e<_l.length;e++)if(n=_l[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}_l=null}return t}function bj(t,e){do{var n=_r;try{if(Bb(),np.current=qp,Gp){for(var r=cr.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Gp=!1}if(Kl=0,Lr=Dr=cr=null,wd=!1,rf=0,ew.current=null,n===null||n.return===null){Ar=1,af=e,_r=null;break}e:{var i=t,o=n.return,a=n,l=e;if(e=Zr,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,d=a,f=d.tag;if(!(d.mode&1)&&(f===0||f===11||f===15)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=fS(o);if(p!==null){p.flags&=-257,hS(p,o,a,i,e),p.mode&1&&dS(i,u,e),e=p,l=u;var m=e.updateQueue;if(m===null){var y=new Set;y.add(l),e.updateQueue=y}else m.add(l);break e}else{if(!(e&1)){dS(i,u,e),iw();break e}l=Error(Et(426))}}else if(er&&a.mode&1){var x=fS(o);if(x!==null){!(x.flags&65536)&&(x.flags|=256),hS(x,o,a,i,e),zb(gu(l,a));break e}}i=l=gu(l,a),Ar!==4&&(Ar=2),kd===null?kd=[i]:kd.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var g=nj(i,l,e);iS(i,g);break e;case 1:a=l;var v=i.type,w=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Ia===null||!Ia.has(w)))){i.flags|=65536,e&=-e,i.lanes|=e;var T=rj(i,a,e);iS(i,T);break e}}i=i.return}while(i!==null)}kj(n)}catch(D){e=D,_r===n&&n!==null&&(_r=n=n.return);continue}break}while(1)}function wj(){var t=Yp.current;return Yp.current=qp,t===null?qp:t}function iw(){(Ar===0||Ar===3||Ar===2)&&(Ar=4),Fr===null||!(Gl&268435455)&&!(bg&268435455)||ga(Fr,Zr)}function Qp(t,e){var n=_n;_n|=2;var r=wj();(Fr!==t||Zr!==e)&&(Io=null,Rl(t,e));do try{i4();break}catch(s){bj(t,s)}while(1);if(Bb(),_n=n,Yp.current=r,_r!==null)throw Error(Et(261));return Fr=null,Zr=0,Ar}function i4(){for(;_r!==null;)vj(_r)}function o4(){for(;_r!==null&&!DO();)vj(_r)}function vj(t){var e=_j(t.alternate,t,Ks);t.memoizedProps=t.pendingProps,e===null?kj(t):_r=e,ew.current=null}function kj(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=ZP(n,e),n!==null){n.flags&=32767,_r=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ar=6,_r=null;return}}else if(n=QP(n,e,Ks),n!==null){_r=n;return}if(e=e.sibling,e!==null){_r=e;return}_r=e=t}while(e!==null);Ar===0&&(Ar=5)}function fl(t,e,n){var r=Mn,s=wi.transition;try{wi.transition=null,Mn=1,a4(t,e,n,r)}finally{wi.transition=s,Mn=r}return null}function a4(t,e,n,r){do tu();while(va!==null);if(_n&6)throw Error(Et(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Et(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(BO(t,i),t===Fr&&(_r=Fr=null,Zr=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||vh||(vh=!0,Tj(Ap,function(){return tu(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=wi.transition,wi.transition=null;var o=Mn;Mn=1;var a=_n;_n|=4,ew.current=null,t4(t,n),gj(n,t),EP(px),Op=!!hx,px=hx=null,t.current=n,n4(n),MO(),_n=a,Mn=o,wi.transition=i}else t.current=n;if(vh&&(vh=!1,va=t,Xp=s),i=t.pendingLanes,i===0&&(Ia=null),OO(n.stateNode),zs(t,br()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Jp)throw Jp=!1,t=Rx,Rx=null,t;return Xp&1&&t.tag!==0&&tu(),i=t.pendingLanes,i&1?t===Ox?Sd++:(Sd=0,Ox=t):Sd=0,qa(),null}function tu(){if(va!==null){var t=nN(Xp),e=wi.transition,n=Mn;try{if(wi.transition=null,Mn=16>t?16:t,va===null)var r=!1;else{if(t=va,va=null,Xp=0,_n&6)throw Error(Et(331));var s=_n;for(_n|=4,Ut=t.current;Ut!==null;){var i=Ut,o=i.child;if(Ut.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(Ut=u;Ut!==null;){var d=Ut;switch(d.tag){case 0:case 11:case 15:vd(8,d,i)}var f=d.child;if(f!==null)f.return=d,Ut=f;else for(;Ut!==null;){d=Ut;var h=d.sibling,p=d.return;if(hj(d),d===u){Ut=null;break}if(h!==null){h.return=p,Ut=h;break}Ut=p}}}var m=i.alternate;if(m!==null){var y=m.child;if(y!==null){m.child=null;do{var x=y.sibling;y.sibling=null,y=x}while(y!==null)}}Ut=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,Ut=o;else e:for(;Ut!==null;){if(i=Ut,i.flags&2048)switch(i.tag){case 0:case 11:case 15:vd(9,i,i.return)}var g=i.sibling;if(g!==null){g.return=i.return,Ut=g;break e}Ut=i.return}}var v=t.current;for(Ut=v;Ut!==null;){o=Ut;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,Ut=w;else e:for(o=v;Ut!==null;){if(a=Ut,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:xg(9,a)}}catch(D){pr(a,a.return,D)}if(a===o){Ut=null;break e}var T=a.sibling;if(T!==null){T.return=a.return,Ut=T;break e}Ut=a.return}}if(_n=s,qa(),fo&&typeof fo.onPostCommitFiberRoot=="function")try{fo.onPostCommitFiberRoot(ug,t)}catch{}r=!0}return r}finally{Mn=n,wi.transition=e}}return!1}function CS(t,e,n){e=gu(n,e),e=nj(t,e,1),t=ja(t,e,1),e=ks(),t!==null&&(zf(t,1,e),zs(t,e))}function pr(t,e,n){if(t.tag===3)CS(t,t,n);else for(;e!==null;){if(e.tag===3){CS(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ia===null||!Ia.has(r))){t=gu(n,t),t=rj(e,t,1),e=ja(e,t,1),t=ks(),e!==null&&(zf(e,1,t),zs(e,t));break}}e=e.return}}function l4(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=ks(),t.pingedLanes|=t.suspendedLanes&n,Fr===t&&(Zr&n)===n&&(Ar===4||Ar===3&&(Zr&130023424)===Zr&&500>br()-nw?Rl(t,0):tw|=n),zs(t,e)}function Sj(t,e){e===0&&(t.mode&1?(e=dh,dh<<=1,!(dh&130023424)&&(dh=4194304)):e=1);var n=ks();t=Vo(t,e),t!==null&&(zf(t,e,n),zs(t,n))}function c4(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Sj(t,n)}function u4(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Et(314))}r!==null&&r.delete(e),Sj(t,n)}var _j;_j=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ls.current)Rs=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Rs=!1,XP(t,e,n);Rs=!!(t.flags&131072)}else Rs=!1,er&&e.flags&1048576&&NN(e,Up,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;sp(t,e),t=e.pendingProps;var s=fu(e,hs.current);eu(e,n),s=Yb(null,e,r,t,s,n);var i=Jb();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,$s(r)?(i=!0,Fp(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Vb(e),s.updater=yg,e.stateNode=s,s._reactInternals=e,Sx(e,r,t,n),e=Cx(null,e,r,!0,i,n)):(e.tag=0,er&&i&&Lb(e),ws(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(sp(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=f4(r),t=Fi(r,t),s){case 0:e=Tx(null,e,r,t,n);break e;case 1:e=gS(null,e,r,t,n);break e;case 11:e=pS(null,e,r,t,n);break e;case 14:e=mS(null,e,r,Fi(r.type,t),n);break e}throw Error(Et(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Fi(r,s),Tx(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Fi(r,s),gS(t,e,r,s,n);case 3:e:{if(aj(e),t===null)throw Error(Et(387));r=e.pendingProps,i=e.memoizedState,s=i.element,RN(t,e),Wp(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=gu(Error(Et(423)),e),e=yS(t,e,r,n,s);break e}else if(r!==s){s=gu(Error(Et(424)),e),e=yS(t,e,r,n,s);break e}else for(Js=Na(e.stateNode.containerInfo.firstChild),Qs=e,er=!0,Wi=null,n=MN(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(hu(),r===s){e=Wo(t,e,n);break e}ws(t,e,r,n)}e=e.child}return e;case 5:return ON(e),t===null&&wx(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,mx(r,s)?o=null:i!==null&&mx(r,i)&&(e.flags|=32),oj(t,e),ws(t,e,o,n),e.child;case 6:return t===null&&wx(e),null;case 13:return lj(t,e,n);case 4:return Wb(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=pu(e,null,r,n):ws(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Fi(r,s),pS(t,e,r,s,n);case 7:return ws(t,e,e.pendingProps,n),e.child;case 8:return ws(t,e,e.pendingProps.children,n),e.child;case 12:return ws(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Fn(Hp,r._currentValue),r._currentValue=o,i!==null)if(Yi(i.value,o)){if(i.children===s.children&&!Ls.current){e=Wo(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=$o(-1,n&-n),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}i.lanes|=n,l=i.alternate,l!==null&&(l.lanes|=n),vx(i.return,n,e),a.lanes|=n;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(Et(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),vx(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}ws(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,eu(e,n),s=Ti(s),r=r(s),e.flags|=1,ws(t,e,r,n),e.child;case 14:return r=e.type,s=Fi(r,e.pendingProps),s=Fi(r.type,s),mS(t,e,r,s,n);case 15:return sj(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Fi(r,s),sp(t,e),e.tag=1,$s(r)?(t=!0,Fp(e)):t=!1,eu(e,n),tj(e,r,s),Sx(e,r,s,n),Cx(null,e,r,!0,t,n);case 19:return cj(t,e,n);case 22:return ij(t,e,n)}throw Error(Et(156,e.tag))};function Tj(t,e){return QE(t,e)}function d4(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gi(t,e,n,r){return new d4(t,e,n,r)}function ow(t){return t=t.prototype,!(!t||!t.isReactComponent)}function f4(t){if(typeof t=="function")return ow(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Tb)return 11;if(t===Cb)return 14}return 2}function Ma(t,e){var n=t.alternate;return n===null?(n=gi(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function ap(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")ow(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case jc:return Ol(n.children,s,i,e);case _b:o=8,s|=8;break;case Gy:return t=gi(12,n,e,s|2),t.elementType=Gy,t.lanes=i,t;case qy:return t=gi(13,n,e,s),t.elementType=qy,t.lanes=i,t;case Yy:return t=gi(19,n,e,s),t.elementType=Yy,t.lanes=i,t;case OE:return wg(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case AE:o=10;break e;case RE:o=9;break e;case Tb:o=11;break e;case Cb:o=14;break e;case la:o=16,r=null;break e}throw Error(Et(130,t==null?t:typeof t,""))}return e=gi(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Ol(t,e,n,r){return t=gi(7,t,r,e),t.lanes=n,t}function wg(t,e,n,r){return t=gi(22,t,r,e),t.elementType=OE,t.lanes=n,t.stateNode={isHidden:!1},t}function N0(t,e,n){return t=gi(6,t,null,e),t.lanes=n,t}function j0(t,e,n){return e=gi(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function h4(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=c0(0),this.expirationTimes=c0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=c0(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function aw(t,e,n,r,s,i,o,a,l){return t=new h4(t,e,n,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=gi(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Vb(i),t}function p4(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Nc,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Cj(t){if(!t)return Fa;t=t._reactInternals;e:{if(nc(t)!==t||t.tag!==1)throw Error(Et(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if($s(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Et(171))}if(t.tag===1){var n=t.type;if($s(n))return CN(t,n,e)}return e}function Ej(t,e,n,r,s,i,o,a,l){return t=aw(n,r,!0,t,s,i,o,a,l),t.context=Cj(null),n=t.current,r=ks(),s=Da(n),i=$o(r,s),i.callback=e??null,ja(n,i,s),t.current.lanes=s,zf(t,s,r),zs(t,r),t}function vg(t,e,n,r){var s=e.current,i=ks(),o=Da(s);return n=Cj(n),e.context===null?e.context=n:e.pendingContext=n,e=$o(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=ja(s,e,o),t!==null&&(qi(t,s,o,i),tp(t,s,o)),o}function Zp(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function ES(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function lw(t,e){ES(t,e),(t=t.alternate)&&ES(t,e)}function m4(){return null}var Nj=typeof reportError=="function"?reportError:function(t){console.error(t)};function cw(t){this._internalRoot=t}kg.prototype.render=cw.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Et(409));vg(t,e,null,null)};kg.prototype.unmount=cw.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;ql(function(){vg(null,t,null,null)}),e[Ho]=null}};function kg(t){this._internalRoot=t}kg.prototype.unstable_scheduleHydration=function(t){if(t){var e=iN();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ma.length&&e!==0&&e<ma[n].priority;n++);ma.splice(n,0,t),n===0&&aN(t)}};function uw(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Sg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function NS(){}function g4(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Zp(o);i.call(u)}}var o=Ej(e,r,t,0,null,!1,!1,"",NS);return t._reactRootContainer=o,t[Ho]=o.current,Qd(t.nodeType===8?t.parentNode:t),ql(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=Zp(l);a.call(u)}}var l=aw(t,0,!1,null,null,!1,!1,"",NS);return t._reactRootContainer=l,t[Ho]=l.current,Qd(t.nodeType===8?t.parentNode:t),ql(function(){vg(e,l,n,r)}),l}function _g(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=Zp(o);a.call(l)}}vg(e,o,t,s)}else o=g4(n,e,t,s,r);return Zp(o)}rN=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=od(e.pendingLanes);n!==0&&(jb(e,n|1),zs(e,br()),!(_n&6)&&(yu=br()+500,qa()))}break;case 13:ql(function(){var r=Vo(t,1);if(r!==null){var s=ks();qi(r,t,1,s)}}),lw(t,1)}};Ib=function(t){if(t.tag===13){var e=Vo(t,134217728);if(e!==null){var n=ks();qi(e,t,134217728,n)}lw(t,134217728)}};sN=function(t){if(t.tag===13){var e=Da(t),n=Vo(t,e);if(n!==null){var r=ks();qi(n,t,e,r)}lw(t,e)}};iN=function(){return Mn};oN=function(t,e){var n=Mn;try{return Mn=t,e()}finally{Mn=n}};ix=function(t,e,n){switch(e){case"input":if(Qy(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=pg(r);if(!s)throw Error(Et(90));LE(r),Qy(r,s)}}}break;case"textarea":zE(t,n);break;case"select":e=n.value,e!=null&&Jc(t,!!n.multiple,e,!1)}};KE=rw;GE=ql;var y4={usingClientEntryPoint:!1,Events:[Bf,Ac,pg,VE,WE,rw]},Yu={findFiberByHostInstance:Sl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},x4={bundleType:Yu.bundleType,version:Yu.version,rendererPackageName:Yu.rendererPackageName,rendererConfig:Yu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Jo.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=JE(t),t===null?null:t.stateNode},findFiberByHostInstance:Yu.findFiberByHostInstance||m4,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var kh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!kh.isDisabled&&kh.supportsFiber)try{ug=kh.inject(x4),fo=kh}catch{}}ti.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=y4;ti.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!uw(e))throw Error(Et(200));return p4(t,e,null,n)};ti.createRoot=function(t,e){if(!uw(t))throw Error(Et(299));var n=!1,r="",s=Nj;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=aw(t,1,!1,null,null,n,!1,r,s),t[Ho]=e.current,Qd(t.nodeType===8?t.parentNode:t),new cw(e)};ti.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Et(188)):(t=Object.keys(t).join(","),Error(Et(268,t)));return t=JE(e),t=t===null?null:t.stateNode,t};ti.flushSync=function(t){return ql(t)};ti.hydrate=function(t,e,n){if(!Sg(e))throw Error(Et(200));return _g(null,t,e,!0,n)};ti.hydrateRoot=function(t,e,n){if(!uw(t))throw Error(Et(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=Nj;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Ej(e,null,t,1,n??null,s,!1,i,o),t[Ho]=e.current,Qd(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new kg(e)};ti.render=function(t,e,n){if(!Sg(e))throw Error(Et(200));return _g(null,t,e,!1,n)};ti.unmountComponentAtNode=function(t){if(!Sg(t))throw Error(Et(40));return t._reactRootContainer?(ql(function(){_g(null,null,t,!1,function(){t._reactRootContainer=null,t[Ho]=null})}),!0):!1};ti.unstable_batchedUpdates=rw;ti.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Sg(n))throw Error(Et(200));if(t==null||t._reactInternals===void 0)throw Error(Et(38));return _g(t,e,n,!1,r)};ti.version="18.3.1-next-f1338f8080-20240426";function jj(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(jj)}catch(t){console.error(t)}}jj(),jE.exports=ti;var tr=jE.exports;const b4=lg(tr);var jS=tr;Wy.createRoot=jS.createRoot,Wy.hydrateRoot=jS.hydrateRoot;const w4="modulepreload",v4=function(t){return"/"+t},IS={},dw=function(e,n,r){if(!n||n.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(n.map(i=>{if(i=v4(i),i in IS)return;IS[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":w4,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((d,f)=>{u.addEventListener("load",d),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};var DS="popstate";function k4(t={}){function e(r,s){let{pathname:i,search:o,hash:a}=r.location;return $x("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:lf(s)}return _4(e,n,null,t)}function nr(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ei(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function S4(){return Math.random().toString(36).substring(2,10)}function MS(t,e){return{usr:t.state,key:t.key,idx:e}}function $x(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Nu(e):e,state:n,key:e&&e.key||r||S4()}}function lf({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Nu(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function _4(t,e,n,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a="POP",l=null,u=d();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function d(){return(o.state||{idx:null}).idx}function f(){a="POP";let x=d(),g=x==null?null:x-u;u=x,l&&l({action:a,location:y.location,delta:g})}function h(x,g){a="PUSH";let v=$x(y.location,x,g);n&&n(v,x),u=d()+1;let w=MS(v,u),T=y.createHref(v);try{o.pushState(w,"",T)}catch(D){if(D instanceof DOMException&&D.name==="DataCloneError")throw D;s.location.assign(T)}i&&l&&l({action:a,location:y.location,delta:1})}function p(x,g){a="REPLACE";let v=$x(y.location,x,g);n&&n(v,x),u=d();let w=MS(v,u),T=y.createHref(v);o.replaceState(w,"",T),i&&l&&l({action:a,location:y.location,delta:0})}function m(x){return T4(x)}let y={get action(){return a},get location(){return t(s,o)},listen(x){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(DS,f),l=x,()=>{s.removeEventListener(DS,f),l=null}},createHref(x){return e(s,x)},createURL:m,encodeLocation(x){let g=m(x);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:h,replace:p,go(x){return o.go(x)}};return y}function T4(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),nr(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:lf(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function Ij(t,e,n="/"){return C4(t,e,n,!1)}function C4(t,e,n,r){let s=typeof e=="string"?Nu(e):e,i=Ko(s.pathname||"/",n);if(i==null)return null;let o=Dj(t);E4(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let u=$4(i);a=P4(o[l],u,r)}return a}function Dj(t,e=[],n=[],r="",s=!1){let i=(o,a,l=s,u)=>{let d={relativePath:u===void 0?o.path||"":u,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};if(d.relativePath.startsWith("/")){if(!d.relativePath.startsWith(r)&&l)return;nr(d.relativePath.startsWith(r),`Absolute route path "${d.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),d.relativePath=d.relativePath.slice(r.length)}let f=zo([r,d.relativePath]),h=n.concat(d);o.children&&o.children.length>0&&(nr(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${f}".`),Dj(o.children,e,h,f,l)),!(o.path==null&&!o.index)&&e.push({path:f,score:R4(f,o.index),routesMeta:h})};return t.forEach((o,a)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))i(o,a);else for(let u of Mj(o.path))i(o,a,!0,u)}),e}function Mj(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=Mj(r.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function E4(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:O4(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var N4=/^:[\w-]+$/,j4=3,I4=2,D4=1,M4=10,A4=-2,AS=t=>t==="*";function R4(t,e){let n=t.split("/"),r=n.length;return n.some(AS)&&(r+=A4),e&&(r+=I4),n.filter(s=>!AS(s)).reduce((s,i)=>s+(N4.test(i)?j4:i===""?D4:M4),r)}function O4(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function P4(t,e,n=!1){let{routesMeta:r}=t,s={},i="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],u=a===r.length-1,d=i==="/"?e:e.slice(i.length)||"/",f=em({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},d),h=l.route;if(!f&&u&&n&&!r[r.length-1].route.index&&(f=em({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},d)),!f)return null;Object.assign(s,f.params),o.push({params:s,pathname:zo([i,f.pathname]),pathnameBase:U4(zo([i,f.pathnameBase])),route:h}),f.pathnameBase!=="/"&&(i=zo([i,f.pathnameBase]))}return o}function em(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=L4(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((u,{paramName:d,isOptional:f},h)=>{if(d==="*"){let m=a[h]||"";o=i.slice(0,i.length-m.length).replace(/(.)\/+$/,"$1")}const p=a[h];return f&&!p?u[d]=void 0:u[d]=(p||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:t}}function L4(t,e=!1,n=!0){Ei(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function $4(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ei(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Ko(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var Aj=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,z4=t=>Aj.test(t);function F4(t,e="/"){let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?Nu(t):t,i;if(n)if(z4(n))i=n;else{if(n.includes("//")){let o=n;n=n.replace(/\/\/+/g,"/"),Ei(!1,`Pathnames cannot have embedded double slashes - normalizing ${o} -> ${n}`)}n.startsWith("/")?i=RS(n.substring(1),"/"):i=RS(n,e)}else i=e;return{pathname:i,search:H4(r),hash:V4(s)}}function RS(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function I0(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function B4(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function fw(t){let e=B4(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function hw(t,e,n,r=!1){let s;typeof t=="string"?s=Nu(t):(s={...t},nr(!s.pathname||!s.pathname.includes("?"),I0("?","pathname","search",s)),nr(!s.pathname||!s.pathname.includes("#"),I0("#","pathname","hash",s)),nr(!s.search||!s.search.includes("#"),I0("#","search","hash",s)));let i=t===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=n;else{let f=e.length-1;if(!r&&o.startsWith("..")){let h=o.split("/");for(;h[0]==="..";)h.shift(),f-=1;s.pathname=h.join("/")}a=f>=0?e[f]:"/"}let l=F4(s,a),u=o&&o!=="/"&&o.endsWith("/"),d=(i||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(u||d)&&(l.pathname+="/"),l}var zo=t=>t.join("/").replace(/\/\/+/g,"/"),U4=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),H4=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,V4=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,W4=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function K4(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function G4(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Rj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Oj(t,e){let n=t;if(typeof n!="string"||!Aj.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,s=!1;if(Rj)try{let i=new URL(window.location.href),o=n.startsWith("//")?new URL(i.protocol+n):new URL(n),a=Ko(o.pathname,e);o.origin===i.origin&&a!=null?n=a+o.search+o.hash:s=!0}catch{Ei(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:s,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Pj=["POST","PUT","PATCH","DELETE"];new Set(Pj);var q4=["GET",...Pj];new Set(q4);var ju=b.createContext(null);ju.displayName="DataRouter";var Tg=b.createContext(null);Tg.displayName="DataRouterState";var Y4=b.createContext(!1),Lj=b.createContext({isTransitioning:!1});Lj.displayName="ViewTransition";var J4=b.createContext(new Map);J4.displayName="Fetchers";var X4=b.createContext(null);X4.displayName="Await";var ri=b.createContext(null);ri.displayName="Navigation";var Hf=b.createContext(null);Hf.displayName="Location";var vo=b.createContext({outlet:null,matches:[],isDataRoute:!1});vo.displayName="Route";var pw=b.createContext(null);pw.displayName="RouteError";var $j="REACT_ROUTER_ERROR",Q4="REDIRECT",Z4="ROUTE_ERROR_RESPONSE";function e3(t){if(t.startsWith(`${$j}:${Q4}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function t3(t){if(t.startsWith(`${$j}:${Z4}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new W4(e.status,e.statusText,e.data)}catch{}}function n3(t,{relative:e}={}){nr(Iu(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=b.useContext(ri),{hash:s,pathname:i,search:o}=Vf(t,{relative:e}),a=i;return n!=="/"&&(a=i==="/"?n:zo([n,i])),r.createHref({pathname:a,search:o,hash:s})}function Iu(){return b.useContext(Hf)!=null}function Ya(){return nr(Iu(),"useLocation() may be used only in the context of a <Router> component."),b.useContext(Hf).location}var zj="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Fj(t){b.useContext(ri).static||b.useLayoutEffect(t)}function Bj(){let{isDataRoute:t}=b.useContext(vo);return t?m3():r3()}function r3(){nr(Iu(),"useNavigate() may be used only in the context of a <Router> component.");let t=b.useContext(ju),{basename:e,navigator:n}=b.useContext(ri),{matches:r}=b.useContext(vo),{pathname:s}=Ya(),i=JSON.stringify(fw(r)),o=b.useRef(!1);return Fj(()=>{o.current=!0}),b.useCallback((l,u={})=>{if(Ei(o.current,zj),!o.current)return;if(typeof l=="number"){n.go(l);return}let d=hw(l,JSON.parse(i),s,u.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:zo([e,d.pathname])),(u.replace?n.replace:n.push)(d,u.state,u)},[e,n,i,s,t])}b.createContext(null);function Vf(t,{relative:e}={}){let{matches:n}=b.useContext(vo),{pathname:r}=Ya(),s=JSON.stringify(fw(n));return b.useMemo(()=>hw(t,JSON.parse(s),r,e==="path"),[t,s,r,e])}function s3(t,e){return Uj(t,e)}function Uj(t,e,n,r,s){var v;nr(Iu(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=b.useContext(ri),{matches:o}=b.useContext(vo),a=o[o.length-1],l=a?a.params:{},u=a?a.pathname:"/",d=a?a.pathnameBase:"/",f=a&&a.route;{let w=f&&f.path||"";Vj(u,!f||w.endsWith("*")||w.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${w}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${w}"> to <Route path="${w==="/"?"*":`${w}/*`}">.`)}let h=Ya(),p;if(e){let w=typeof e=="string"?Nu(e):e;nr(d==="/"||((v=w.pathname)==null?void 0:v.startsWith(d)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${w.pathname}" was given in the \`location\` prop.`),p=w}else p=h;let m=p.pathname||"/",y=m;if(d!=="/"){let w=d.replace(/^\//,"").split("/");y="/"+m.replace(/^\//,"").split("/").slice(w.length).join("/")}let x=Ij(t,{pathname:y});Ei(f||x!=null,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),Ei(x==null||x[x.length-1].route.element!==void 0||x[x.length-1].route.Component!==void 0||x[x.length-1].route.lazy!==void 0,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let g=c3(x&&x.map(w=>Object.assign({},w,{params:Object.assign({},l,w.params),pathname:zo([d,i.encodeLocation?i.encodeLocation(w.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?d:zo([d,i.encodeLocation?i.encodeLocation(w.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathnameBase])})),o,n,r,s);return e&&g?b.createElement(Hf.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...p},navigationType:"POP"}},g):g}function i3(){let t=p3(),e=K4(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=b.createElement(b.Fragment,null,b.createElement("p",null," Hey developer "),b.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",b.createElement("code",{style:i},"ErrorBoundary")," or"," ",b.createElement("code",{style:i},"errorElement")," prop on your route.")),b.createElement(b.Fragment,null,b.createElement("h2",null,"Unexpected Application Error!"),b.createElement("h3",{style:{fontStyle:"italic"}},e),n?b.createElement("pre",{style:s},n):null,o)}var o3=b.createElement(i3,null),Hj=class extends b.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=t3(t.digest);n&&(t=n)}let e=t!==void 0?b.createElement(vo.Provider,{value:this.props.routeContext},b.createElement(pw.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?b.createElement(a3,{error:t},e):e}};Hj.contextType=Y4;var D0=new WeakMap;function a3({children:t,error:e}){let{basename:n}=b.useContext(ri);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=e3(e.digest);if(r){let s=D0.get(e);if(s)throw s;let i=Oj(r.location,n);if(Rj&&!D0.get(e))if(i.isExternal||r.reloadDocument)window.location.href=i.absoluteURL||i.to;else{const o=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(i.to,{replace:r.replace}));throw D0.set(e,o),o}return b.createElement("meta",{httpEquiv:"refresh",content:`0;url=${i.absoluteURL||i.to}`})}}return t}function l3({routeContext:t,match:e,children:n}){let r=b.useContext(ju);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),b.createElement(vo.Provider,{value:t},n)}function c3(t,e=[],n=null,r=null,s=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,o=n==null?void 0:n.errors;if(o!=null){let d=i.findIndex(f=>f.route.id&&(o==null?void 0:o[f.route.id])!==void 0);nr(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,d+1))}let a=!1,l=-1;if(n)for(let d=0;d<i.length;d++){let f=i[d];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(l=d),f.route.id){let{loaderData:h,errors:p}=n,m=f.route.loader&&!h.hasOwnProperty(f.route.id)&&(!p||p[f.route.id]===void 0);if(f.route.lazy||m){a=!0,l>=0?i=i.slice(0,l+1):i=[i[0]];break}}}let u=n&&r?(d,f)=>{var h,p;r(d,{location:n.location,params:((p=(h=n.matches)==null?void 0:h[0])==null?void 0:p.params)??{},unstable_pattern:G4(n.matches),errorInfo:f})}:void 0;return i.reduceRight((d,f,h)=>{let p,m=!1,y=null,x=null;n&&(p=o&&f.route.id?o[f.route.id]:void 0,y=f.route.errorElement||o3,a&&(l<0&&h===0?(Vj("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),m=!0,x=null):l===h&&(m=!0,x=f.route.hydrateFallbackElement||null)));let g=e.concat(i.slice(0,h+1)),v=()=>{let w;return p?w=y:m?w=x:f.route.Component?w=b.createElement(f.route.Component,null):f.route.element?w=f.route.element:w=d,b.createElement(l3,{match:f,routeContext:{outlet:d,matches:g,isDataRoute:n!=null},children:w})};return n&&(f.route.ErrorBoundary||f.route.errorElement||h===0)?b.createElement(Hj,{location:n.location,revalidation:n.revalidation,component:y,error:p,children:v(),routeContext:{outlet:null,matches:g,isDataRoute:!0},onError:u}):v()},null)}function mw(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function u3(t){let e=b.useContext(ju);return nr(e,mw(t)),e}function d3(t){let e=b.useContext(Tg);return nr(e,mw(t)),e}function f3(t){let e=b.useContext(vo);return nr(e,mw(t)),e}function gw(t){let e=f3(t),n=e.matches[e.matches.length-1];return nr(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function h3(){return gw("useRouteId")}function p3(){var r;let t=b.useContext(pw),e=d3("useRouteError"),n=gw("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function m3(){let{router:t}=u3("useNavigate"),e=gw("useNavigate"),n=b.useRef(!1);return Fj(()=>{n.current=!0}),b.useCallback(async(s,i={})=>{Ei(n.current,zj),n.current&&(typeof s=="number"?await t.navigate(s):await t.navigate(s,{fromRouteId:e,...i}))},[t,e])}var OS={};function Vj(t,e,n){!e&&!OS[t]&&(OS[t]=!0,Ei(!1,n))}b.memo(g3);function g3({routes:t,future:e,state:n,onError:r}){return Uj(t,void 0,n,r,e)}function PS({to:t,replace:e,state:n,relative:r}){nr(Iu(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=b.useContext(ri);Ei(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=b.useContext(vo),{pathname:o}=Ya(),a=Bj(),l=hw(t,fw(i),o,r==="path"),u=JSON.stringify(l);return b.useEffect(()=>{a(JSON.parse(u),{replace:e,state:n,relative:r})},[a,u,r,e,n]),null}function lp(t){nr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function y3({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:s,static:i=!1,unstable_useTransitions:o}){nr(!Iu(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=t.replace(/^\/*/,"/"),l=b.useMemo(()=>({basename:a,navigator:s,static:i,unstable_useTransitions:o,future:{}}),[a,s,i,o]);typeof n=="string"&&(n=Nu(n));let{pathname:u="/",search:d="",hash:f="",state:h=null,key:p="default"}=n,m=b.useMemo(()=>{let y=Ko(u,a);return y==null?null:{location:{pathname:y,search:d,hash:f,state:h,key:p},navigationType:r}},[a,u,d,f,h,p,r]);return Ei(m!=null,`<Router basename="${a}"> is not able to match the URL "${u}${d}${f}" because it does not start with the basename, so the <Router> won't render anything.`),m==null?null:b.createElement(ri.Provider,{value:l},b.createElement(Hf.Provider,{children:e,value:m}))}function x3({children:t,location:e}){return s3(zx(t),e)}function zx(t,e=[]){let n=[];return b.Children.forEach(t,(r,s)=>{if(!b.isValidElement(r))return;let i=[...e,s];if(r.type===b.Fragment){n.push.apply(n,zx(r.props.children,i));return}nr(r.type===lp,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),nr(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=zx(r.props.children,i)),n.push(o)}),n}var cp="get",up="application/x-www-form-urlencoded";function Cg(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function b3(t){return Cg(t)&&t.tagName.toLowerCase()==="button"}function w3(t){return Cg(t)&&t.tagName.toLowerCase()==="form"}function v3(t){return Cg(t)&&t.tagName.toLowerCase()==="input"}function k3(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function S3(t,e){return t.button===0&&(!e||e==="_self")&&!k3(t)}var Sh=null;function _3(){if(Sh===null)try{new FormData(document.createElement("form"),0),Sh=!1}catch{Sh=!0}return Sh}var T3=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function M0(t){return t!=null&&!T3.has(t)?(Ei(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${up}"`),null):t}function C3(t,e){let n,r,s,i,o;if(w3(t)){let a=t.getAttribute("action");r=a?Ko(a,e):null,n=t.getAttribute("method")||cp,s=M0(t.getAttribute("enctype"))||up,i=new FormData(t)}else if(b3(t)||v3(t)&&(t.type==="submit"||t.type==="image")){let a=t.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=t.getAttribute("formaction")||a.getAttribute("action");if(r=l?Ko(l,e):null,n=t.getAttribute("formmethod")||a.getAttribute("method")||cp,s=M0(t.getAttribute("formenctype"))||M0(a.getAttribute("enctype"))||up,i=new FormData(a,t),!_3()){let{name:u,type:d,value:f}=t;if(d==="image"){let h=u?`${u}.`:"";i.append(`${h}x`,"0"),i.append(`${h}y`,"0")}else u&&i.append(u,f)}}else{if(Cg(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=cp,r=null,s=up,o=t}return i&&s==="text/plain"&&(o=i,i=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function yw(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function E3(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&Ko(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function N3(t,e){if(t.id in e)return e[t.id];try{let n=await dw(()=>import(t.module),[]);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function j3(t){return t!=null&&typeof t.page=="string"}function I3(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function D3(t,e,n){let r=await Promise.all(t.map(async s=>{let i=e.routes[s.route.id];if(i){let o=await N3(i,n);return o.links?o.links():[]}return[]}));return O3(r.flat(1).filter(I3).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function LS(t,e,n,r,s,i){let o=(l,u)=>n[u]?l.route.id!==n[u].route.id:!0,a=(l,u)=>{var d;return n[u].pathname!==l.pathname||((d=n[u].route.path)==null?void 0:d.endsWith("*"))&&n[u].params["*"]!==l.params["*"]};return i==="assets"?e.filter((l,u)=>o(l,u)||a(l,u)):i==="data"?e.filter((l,u)=>{var f;let d=r.routes[l.route.id];if(!d||!d.hasLoader)return!1;if(o(l,u)||a(l,u))return!0;if(l.route.shouldRevalidate){let h=l.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((f=n[0])==null?void 0:f.params)||{},nextUrl:new URL(t,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function M3(t,e,{includeHydrateFallback:n}={}){return A3(t.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function A3(t){return[...new Set(t)]}function R3(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function O3(t,e){let n=new Set,r=new Set(e);return t.reduce((s,i)=>{if(e&&!j3(i)&&i.as==="script"&&i.href&&r.has(i.href))return s;let a=JSON.stringify(R3(i));return n.has(a)||(n.add(a),s.push({key:a,link:i})),s},[])}function Wj(){let t=b.useContext(ju);return yw(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function P3(){let t=b.useContext(Tg);return yw(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var xw=b.createContext(void 0);xw.displayName="FrameworkContext";function Kj(){let t=b.useContext(xw);return yw(t,"You must render this element inside a <HydratedRouter> element"),t}function L3(t,e){let n=b.useContext(xw),[r,s]=b.useState(!1),[i,o]=b.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:u,onMouseLeave:d,onTouchStart:f}=e,h=b.useRef(null);b.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let y=g=>{g.forEach(v=>{o(v.isIntersecting)})},x=new IntersectionObserver(y,{threshold:.5});return h.current&&x.observe(h.current),()=>{x.disconnect()}}},[t]),b.useEffect(()=>{if(r){let y=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(y)}}},[r]);let p=()=>{s(!0)},m=()=>{s(!1),o(!1)};return n?t!=="intent"?[i,h,{}]:[i,h,{onFocus:Ju(a,p),onBlur:Ju(l,m),onMouseEnter:Ju(u,p),onMouseLeave:Ju(d,m),onTouchStart:Ju(f,p)}]:[!1,h,{}]}function Ju(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function $3({page:t,...e}){let{router:n}=Wj(),r=b.useMemo(()=>Ij(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?b.createElement(F3,{page:t,matches:r,...e}):null}function z3(t){let{manifest:e,routeModules:n}=Kj(),[r,s]=b.useState([]);return b.useEffect(()=>{let i=!1;return D3(t,e,n).then(o=>{i||s(o)}),()=>{i=!0}},[t,e,n]),r}function F3({page:t,matches:e,...n}){let r=Ya(),{manifest:s,routeModules:i}=Kj(),{basename:o}=Wj(),{loaderData:a,matches:l}=P3(),u=b.useMemo(()=>LS(t,e,l,s,r,"data"),[t,e,l,s,r]),d=b.useMemo(()=>LS(t,e,l,s,r,"assets"),[t,e,l,s,r]),f=b.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let m=new Set,y=!1;if(e.forEach(g=>{var w;let v=s.routes[g.route.id];!v||!v.hasLoader||(!u.some(T=>T.route.id===g.route.id)&&g.route.id in a&&((w=i[g.route.id])!=null&&w.shouldRevalidate)||v.hasClientLoader?y=!0:m.add(g.route.id))}),m.size===0)return[];let x=E3(t,o,"data");return y&&m.size>0&&x.searchParams.set("_routes",e.filter(g=>m.has(g.route.id)).map(g=>g.route.id).join(",")),[x.pathname+x.search]},[o,a,r,s,u,e,t,i]),h=b.useMemo(()=>M3(d,s),[d,s]),p=z3(d);return b.createElement(b.Fragment,null,f.map(m=>b.createElement("link",{key:m,rel:"prefetch",as:"fetch",href:m,...n})),h.map(m=>b.createElement("link",{key:m,rel:"modulepreload",href:m,...n})),p.map(({key:m,link:y})=>b.createElement("link",{key:m,nonce:n.nonce,...y})))}function B3(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var U3=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{U3&&(window.__reactRouterVersion="7.11.0")}catch{}function H3({basename:t,children:e,unstable_useTransitions:n,window:r}){let s=b.useRef();s.current==null&&(s.current=k4({window:r,v5Compat:!0}));let i=s.current,[o,a]=b.useState({action:i.action,location:i.location}),l=b.useCallback(u=>{n===!1?a(u):b.startTransition(()=>a(u))},[n]);return b.useLayoutEffect(()=>i.listen(l),[i,l]),b.createElement(y3,{basename:t,children:e,location:o.location,navigationType:o.action,navigator:i,unstable_useTransitions:n})}var Gj=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,qj=b.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:s,reloadDocument:i,replace:o,state:a,target:l,to:u,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:h,...p},m){let{basename:y,unstable_useTransitions:x}=b.useContext(ri),g=typeof u=="string"&&Gj.test(u),v=Oj(u,y);u=v.to;let w=n3(u,{relative:s}),[T,D,k]=L3(r,p),I=G3(u,{replace:o,state:a,target:l,preventScrollReset:d,relative:s,viewTransition:f,unstable_defaultShouldRevalidate:h,unstable_useTransitions:x});function C(_){e&&e(_),_.defaultPrevented||I(_)}let S=b.createElement("a",{...p,...k,href:v.absoluteURL||w,onClick:v.isExternal||i?e:C,ref:B3(m,D),target:l,"data-discover":!g&&n==="render"?"true":void 0});return T&&!g?b.createElement(b.Fragment,null,S,b.createElement($3,{page:w})):S});qj.displayName="Link";var V3=b.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:s=!1,style:i,to:o,viewTransition:a,children:l,...u},d){let f=Vf(o,{relative:u.relative}),h=Ya(),p=b.useContext(Tg),{navigator:m,basename:y}=b.useContext(ri),x=p!=null&&Q3(f)&&a===!0,g=m.encodeLocation?m.encodeLocation(f).pathname:f.pathname,v=h.pathname,w=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;n||(v=v.toLowerCase(),w=w?w.toLowerCase():null,g=g.toLowerCase()),w&&y&&(w=Ko(w,y)||w);const T=g!=="/"&&g.endsWith("/")?g.length-1:g.length;let D=v===g||!s&&v.startsWith(g)&&v.charAt(T)==="/",k=w!=null&&(w===g||!s&&w.startsWith(g)&&w.charAt(g.length)==="/"),I={isActive:D,isPending:k,isTransitioning:x},C=D?e:void 0,S;typeof r=="function"?S=r(I):S=[r,D?"active":null,k?"pending":null,x?"transitioning":null].filter(Boolean).join(" ");let _=typeof i=="function"?i(I):i;return b.createElement(qj,{...u,"aria-current":C,className:S,ref:d,style:_,to:o,viewTransition:a},typeof l=="function"?l(I):l)});V3.displayName="NavLink";var W3=b.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:s,state:i,method:o=cp,action:a,onSubmit:l,relative:u,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:h,...p},m)=>{let{unstable_useTransitions:y}=b.useContext(ri),x=J3(),g=X3(a,{relative:u}),v=o.toLowerCase()==="get"?"get":"post",w=typeof a=="string"&&Gj.test(a),T=D=>{if(l&&l(D),D.defaultPrevented)return;D.preventDefault();let k=D.nativeEvent.submitter,I=(k==null?void 0:k.getAttribute("formmethod"))||o,C=()=>x(k||D.currentTarget,{fetcherKey:e,method:I,navigate:n,replace:s,state:i,relative:u,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:h});y&&n!==!1?b.startTransition(()=>C()):C()};return b.createElement("form",{ref:m,method:v,action:g,onSubmit:r?l:T,...p,"data-discover":!w&&t==="render"?"true":void 0})});W3.displayName="Form";function K3(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Yj(t){let e=b.useContext(ju);return nr(e,K3(t)),e}function G3(t,{target:e,replace:n,state:r,preventScrollReset:s,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:a,unstable_useTransitions:l}={}){let u=Bj(),d=Ya(),f=Vf(t,{relative:i});return b.useCallback(h=>{if(S3(h,e)){h.preventDefault();let p=n!==void 0?n:lf(d)===lf(f),m=()=>u(t,{replace:p,state:r,preventScrollReset:s,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:a});l?b.startTransition(()=>m()):m()}},[d,u,f,n,r,e,t,s,i,o,a,l])}var q3=0,Y3=()=>`__${String(++q3)}__`;function J3(){let{router:t}=Yj("useSubmit"),{basename:e}=b.useContext(ri),n=h3(),r=t.fetch,s=t.navigate;return b.useCallback(async(i,o={})=>{let{action:a,method:l,encType:u,formData:d,body:f}=C3(i,e);if(o.navigate===!1){let h=o.fetcherKey||Y3();await r(h,n,o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:d,body:f,formMethod:o.method||l,formEncType:o.encType||u,flushSync:o.flushSync})}else await s(o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:d,body:f,formMethod:o.method||l,formEncType:o.encType||u,replace:o.replace,state:o.state,fromRouteId:n,flushSync:o.flushSync,viewTransition:o.viewTransition})},[r,s,e,n])}function X3(t,{relative:e}={}){let{basename:n}=b.useContext(ri),r=b.useContext(vo);nr(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...Vf(t||".",{relative:e})},o=Ya();if(t==null){i.search=o.search;let a=new URLSearchParams(i.search),l=a.getAll("index");if(l.some(d=>d==="")){a.delete("index"),l.filter(f=>f).forEach(f=>a.append("index",f));let d=a.toString();i.search=d?`?${d}`:""}}return(!t||t===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(i.pathname=i.pathname==="/"?n:zo([n,i.pathname])),lf(i)}function Q3(t,{relative:e}={}){let n=b.useContext(Lj);nr(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=Yj("useViewTransitionState"),s=Vf(t,{relative:e});if(!n.isTransitioning)return!1;let i=Ko(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=Ko(n.nextLocation.pathname,r)||n.nextLocation.pathname;return em(s.pathname,o)!=null||em(s.pathname,i)!=null}function Eg(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function Z3(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(d){try{u(r.next(d))}catch(f){o(f)}}function l(d){try{u(r.throw(d))}catch(f){o(f)}}function u(d){d.done?i(d.value):s(d.value).then(a,l)}u((r=r.apply(t,e||[])).next())})}const eL=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class bw extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class tL extends bw{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class $S extends bw{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class zS extends bw{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Fx;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Fx||(Fx={}));class nL{constructor(e,{headers:n={},customFetch:r,region:s=Fx.Any}={}){this.url=e,this.headers=n,this.region=s,this.fetch=eL(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return Z3(this,arguments,void 0,function*(n,r={}){var s;let i,o;try{const{headers:a,method:l,body:u,signal:d,timeout:f}=r;let h={},{region:p}=r;p||(p=this.region);const m=new URL(`${this.url}/${n}`);p&&p!=="any"&&(h["x-region"]=p,m.searchParams.set("forceFunctionRegion",p));let y;u&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",y=u):typeof u=="string"?(h["Content-Type"]="text/plain",y=u):typeof FormData<"u"&&u instanceof FormData?y=u:(h["Content-Type"]="application/json",y=JSON.stringify(u)):y=u;let x=d;f&&(o=new AbortController,i=setTimeout(()=>o.abort(),f),d?(x=o.signal,d.addEventListener("abort",()=>o.abort())):x=o.signal);const g=yield this.fetch(m.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),a),body:y,signal:x}).catch(D=>{throw new tL(D)}),v=g.headers.get("x-relay-error");if(v&&v==="true")throw new $S(g);if(!g.ok)throw new zS(g);let w=((s=g.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),T;return w==="application/json"?T=yield g.json():w==="application/octet-stream"||w==="application/pdf"?T=yield g.blob():w==="text/event-stream"?T=g:w==="multipart/form-data"?T=yield g.formData():T=yield g.text(),{data:T,error:null,response:g}}catch(a){return{data:null,error:a,response:a instanceof zS||a instanceof $S?a.context:void 0}}finally{i&&clearTimeout(i)}})}}var rL=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},sL=class{constructor(t){var e,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var n=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let o=null,a=null,l=null,u=i.status,d=i.statusText;if(i.ok){var f,h;if(n.method!=="HEAD"){var p;const g=await i.text();g===""||(n.headers.get("Accept")==="text/csv"||n.headers.get("Accept")&&(!((p=n.headers.get("Accept"))===null||p===void 0)&&p.includes("application/vnd.pgrst.plan+text"))?a=g:a=JSON.parse(g))}const y=(f=n.headers.get("Prefer"))===null||f===void 0?void 0:f.match(/count=(exact|planned|estimated)/),x=(h=i.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");y&&x&&x.length>1&&(l=parseInt(x[1])),n.isMaybeSingle&&n.method==="GET"&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,u=406,d="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var m;const y=await i.text();try{o=JSON.parse(y),Array.isArray(o)&&i.status===404&&(a=[],o=null,u=200,d="OK")}catch{i.status===404&&y===""?(u=204,d="No Content"):o={message:y}}if(o&&n.isMaybeSingle&&(!(o==null||(m=o.details)===null||m===void 0)&&m.includes("0 rows"))&&(o=null,u=200,d="OK"),o&&n.shouldThrowOnError)throw new rL(o)}return{error:o,data:a,count:l,status:u,statusText:d}});return this.shouldThrowOnError||(s=s.catch(i=>{var o;let a="";const l=i==null?void 0:i.cause;if(l){var u,d,f,h;const m=(u=l==null?void 0:l.message)!==null&&u!==void 0?u:"",y=(d=l==null?void 0:l.code)!==null&&d!==void 0?d:"";a=`${(f=i==null?void 0:i.name)!==null&&f!==void 0?f:"FetchError"}: ${i==null?void 0:i.message}`,a+=`

Caused by: ${(h=l==null?void 0:l.name)!==null&&h!==void 0?h:"Error"}: ${m}`,y&&(a+=` (${y})`),l!=null&&l.stack&&(a+=`
${l.stack}`)}else{var p;a=(p=i==null?void 0:i.stack)!==null&&p!==void 0?p:""}return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:a,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),s.then(t,e)}returns(){return this}overrideTypes(){return this}},iL=class extends sL{select(t){let e=!1;const n=(t??"*").split("").map(r=>/\s/.test(r)&&!e?"":(r==='"'&&(e=!e),r)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:n,foreignTable:r,referencedTable:s=r}={}){const i=s?`${s}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:n=e}={}){const r=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${t}`),this}range(t,e,{foreignTable:n,referencedTable:r=n}={}){const s=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${t}`),this.url.searchParams.set(i,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:n=!1,buffers:r=!1,wal:s=!1,format:i="text"}={}){var o;const a=[t?"analyze":null,e?"verbose":null,n?"settings":null,r?"buffers":null,s?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const FS=new RegExp("[,()]");var kc=class extends iL{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&FS.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}notIn(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&FS.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`not.in.(${n})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:n,type:r}={}){let s="";r==="plain"?s="pl":r==="phrase"?s="ph":r==="websearch"&&(s="w");const i=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${s}fts${i}.${e}`),this}match(t){return Object.entries(t).forEach(([e,n])=>{this.url.searchParams.append(e,`eq.${n}`)}),this}not(t,e,n){return this.url.searchParams.append(t,`not.${e}.${n}`),this}or(t,{foreignTable:e,referencedTable:n=e}={}){const r=n?`${n}.or`:"or";return this.url.searchParams.append(r,`(${t})`),this}filter(t,e,n){return this.url.searchParams.append(t,`${e}.${n}`),this}},oL=class{constructor(t,{headers:e={},schema:n,fetch:r}){this.url=t,this.headers=new Headers(e),this.schema=n,this.fetch=r}select(t,e){const{head:n=!1,count:r}=e??{},s=n?"HEAD":"GET";let i=!1;const o=(t??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),r&&this.headers.append("Prefer",`count=${r}`),new kc({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:n=!0}={}){var r;const s="POST";if(e&&this.headers.append("Prefer",`count=${e}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const i=t.reduce((o,a)=>o.concat(Object.keys(a)),[]);if(i.length>0){const o=[...new Set(i)].map(a=>`"${a}"`);this.url.searchParams.set("columns",o.join(","))}}return new kc({method:s,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:n=!1,count:r,defaultToNull:s=!0}={}){var i;const o="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),e!==void 0&&this.url.searchParams.set("on_conflict",e),r&&this.headers.append("Prefer",`count=${r}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const a=t.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(a.length>0){const l=[...new Set(a)].map(u=>`"${u}"`);this.url.searchParams.set("columns",l.join(","))}}return new kc({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(t,{count:e}={}){var n;const r="PATCH";return e&&this.headers.append("Prefer",`count=${e}`),new kc({method:r,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:t}={}){var e;const n="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new kc({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},aL=class Jj{constructor(e,{headers:n={},schema:r,fetch:s}={}){this.url=e,this.headers=new Headers(n),this.schemaName=r,this.fetch=s}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new oL(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Jj(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,n={},{head:r=!1,get:s=!1,count:i}={}){var o;let a;const l=new URL(`${this.url}/rpc/${e}`);let u;r||s?(a=r?"HEAD":"GET",Object.entries(n).filter(([f,h])=>h!==void 0).map(([f,h])=>[f,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([f,h])=>{l.searchParams.append(f,h)})):(a="POST",u=n);const d=new Headers(this.headers);return i&&d.set("Prefer",`count=${i}`),new kc({method:a,url:l,headers:d,schema:this.schemaName,body:u,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};class lL{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const r=n.node,s=parseInt(r.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const r=this.getWebSocketConstructor();return new r(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const cL="2.89.0",uL=`realtime-js/${cL}`,Xj="1.0.0",dL="2.0.0",BS=Xj,Bx=1e4,fL=1e3,hL=100;var ua;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(ua||(ua={}));var jr;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(jr||(jr={}));var Hi;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Hi||(Hi={}));var Ux;(function(t){t.websocket="websocket"})(Ux||(Ux={}));var yl;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(yl||(yl={}));class pL{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,n){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,r;const s=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(e){var n,r;const s=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:{},o=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,n,r){var s,i;const o=e.topic,a=(s=e.ref)!==null&&s!==void 0?s:"",l=(i=e.join_ref)!==null&&i!==void 0?i:"",u=e.payload.event,d=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},f=Object.keys(d).length===0?"":JSON.stringify(d);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`userEvent length ${u.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`metadata length ${f.length} exceeds maximum of 255`);const h=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+u.length+f.length,p=new ArrayBuffer(this.HEADER_LENGTH+h);let m=new DataView(p),y=0;m.setUint8(y++,this.KINDS.userBroadcastPush),m.setUint8(y++,l.length),m.setUint8(y++,a.length),m.setUint8(y++,o.length),m.setUint8(y++,u.length),m.setUint8(y++,f.length),m.setUint8(y++,n),Array.from(l,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(a,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(o,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(u,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(f,g=>m.setUint8(y++,g.charCodeAt(0)));var x=new Uint8Array(p.byteLength+r.byteLength);return x.set(new Uint8Array(p),0),x.set(new Uint8Array(r),p.byteLength),x.buffer}decode(e,n){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return n(r)}if(typeof e=="string"){const r=JSON.parse(e),[s,i,o,a,l]=r;return n({join_ref:s,ref:i,topic:o,event:a,payload:l})}return n({})}_binaryDecode(e){const n=new DataView(e),r=n.getUint8(0),s=new TextDecoder;switch(r){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,n,s)}}_decodeUserBroadcast(e,n,r){const s=n.getUint8(1),i=n.getUint8(2),o=n.getUint8(3),a=n.getUint8(4);let l=this.HEADER_LENGTH+4;const u=r.decode(e.slice(l,l+s));l=l+s;const d=r.decode(e.slice(l,l+i));l=l+i;const f=r.decode(e.slice(l,l+o));l=l+o;const h=e.slice(l,e.byteLength),p=a===this.JSON_ENCODING?JSON.parse(r.decode(h)):h,m={type:this.BROADCAST_EVENT,event:d,payload:p};return o>0&&(m.meta=JSON.parse(f)),{join_ref:null,ref:null,topic:u,event:this.BROADCAST_EVENT,payload:m}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e==null?void 0:e.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}_pick(e,n){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([r])=>n.includes(r)))}}class Qj{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var $n;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})($n||($n={}));const US=(t,e,n={})=>{var r;const s=(r=n.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=mL(o,t,e,s),i),{}):{}},mL=(t,e,n,r)=>{const s=e.find(a=>a.name===t),i=s==null?void 0:s.type,o=n[t];return i&&!r.includes(i)?Zj(i,o):Hx(o)},Zj=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return bL(e,n)}switch(t){case $n.bool:return gL(e);case $n.float4:case $n.float8:case $n.int2:case $n.int4:case $n.int8:case $n.numeric:case $n.oid:return yL(e);case $n.json:case $n.jsonb:return xL(e);case $n.timestamp:return wL(e);case $n.abstime:case $n.date:case $n.daterange:case $n.int4range:case $n.int8range:case $n.money:case $n.reltime:case $n.text:case $n.time:case $n.timestamptz:case $n.timetz:case $n.tsrange:case $n.tstzrange:return Hx(e);default:return Hx(e)}},Hx=t=>t,gL=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},yL=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},xL=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},bL=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let i;const o=t.slice(1,n);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>Zj(e,a))}return t},wL=t=>typeof t=="string"?t.replace(" ","T"):t,eI=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class A0{constructor(e,n,r={},s=Bx){this.channel=e,this.event=n,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var HS;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(HS||(HS={}));class _d{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=_d.syncState(this.state,s,i,o),this.pendingDiffs.forEach(l=>{this.state=_d.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=_d.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,s){const i=this.cloneDeep(e),o=this.transformState(n),a={},l={};return this.map(i,(u,d)=>{o[u]||(l[u]=d)}),this.map(o,(u,d)=>{const f=i[u];if(f){const h=d.map(x=>x.presence_ref),p=f.map(x=>x.presence_ref),m=d.filter(x=>p.indexOf(x.presence_ref)<0),y=f.filter(x=>h.indexOf(x.presence_ref)<0);m.length>0&&(a[u]=m),y.length>0&&(l[u]=y)}else a[u]=d}),this.syncDiff(i,{joins:a,leaves:l},r,s)}static syncDiff(e,n,r,s){const{joins:i,leaves:o}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(a,l)=>{var u;const d=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(l),d.length>0){const f=e[a].map(p=>p.presence_ref),h=d.filter(p=>f.indexOf(p.presence_ref)<0);e[a].unshift(...h)}r(a,d,l)}),this.map(o,(a,l)=>{let u=e[a];if(!u)return;const d=l.map(f=>f.presence_ref);u=u.filter(f=>d.indexOf(f.presence_ref)<0),e[a]=u,s(a,u,l),u.length===0&&delete e[a]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const s=e[r];return"metas"in s?n[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):n[r]=s,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var VS;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(VS||(VS={}));var Td;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Td||(Td={}));var Do;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Do||(Do={}));class Fc{constructor(e,n={config:{}},r){var s,i;if(this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=jr.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new A0(this,Hi.join,this.params,this.timeout),this.rejoinTimer=new Qj(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=jr.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=jr.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=jr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=jr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=jr.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Hi.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new _d(this),this.broadcastEndpointURL=eI(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var r,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==jr.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,u=(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(p=>p.filter))!==null&&s!==void 0?s:[],d=!!this.bindings[Td.PRESENCE]&&this.bindings[Td.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,f={},h={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:d}),postgres_changes:u,private:l};this.socket.accessTokenValue&&(f.access_token=this.socket.accessTokenValue),this._onError(p=>e==null?void 0:e(Do.CHANNEL_ERROR,p)),this._onClose(()=>e==null?void 0:e(Do.CLOSED)),this.updateJoinPayload(Object.assign({config:h},f)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:p})=>{var m;if(this.socket._isManualToken()||this.socket.setAuth(),p===void 0){e==null||e(Do.SUBSCRIBED);return}else{const y=this.bindings.postgres_changes,x=(m=y==null?void 0:y.length)!==null&&m!==void 0?m:0,g=[];for(let v=0;v<x;v++){const w=y[v],{filter:{event:T,schema:D,table:k,filter:I}}=w,C=p&&p[v];if(C&&C.event===T&&Fc.isFilterValueEqual(C.schema,D)&&Fc.isFilterValueEqual(C.table,k)&&Fc.isFilterValueEqual(C.filter,I))g.push(Object.assign(Object.assign({},w),{id:C.id}));else{this.unsubscribe(),this.state=jr.errored,e==null||e(Do.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(Do.SUBSCRIBED);return}}).receive("error",p=>{this.state=jr.errored,e==null||e(Do.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Do.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this.state===jr.joined&&e===Td.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,n,r)}async httpSend(e,n,r={}){var s;if(n==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(s=r.timeout)!==null&&s!==void 0?s:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const u=await a.json();l=u.error||u.message||l}catch{}return Promise.reject(new Error(l))}async send(e,n={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=u.body)===null||s===void 0?void 0:s.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const u=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=jr.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Hi.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new A0(this,Hi.leave,{},e),r.receive("ok",()=>{n(),s("ok")}).receive("timeout",()=>{n(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=jr.closed,this.bindings={}}async _fetchWithTimeout(e,n,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:s.signal}));return clearTimeout(i),o}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new A0(this,e,n,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>hL){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:u,join:d}=Hi;if(r&&[a,l,u,d].indexOf(o)>=0&&r!==this._joinRef())return;let h=this._onMessage(o,n,r);if(n&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(p=>{var m,y,x;return((m=p.filter)===null||m===void 0?void 0:m.event)==="*"||((x=(y=p.filter)===null||y===void 0?void 0:y.event)===null||x===void 0?void 0:x.toLocaleLowerCase())===o}).map(p=>p.callback(h,r)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var m,y,x,g,v,w;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const T=p.id,D=(m=p.filter)===null||m===void 0?void 0:m.event;return T&&((y=n.ids)===null||y===void 0?void 0:y.includes(T))&&(D==="*"||(D==null?void 0:D.toLocaleLowerCase())===((x=n.data)===null||x===void 0?void 0:x.type.toLocaleLowerCase()))}else{const T=(v=(g=p==null?void 0:p.filter)===null||g===void 0?void 0:g.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return T==="*"||T===((w=n==null?void 0:n.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof h=="object"&&"ids"in h){const m=h.data,{schema:y,table:x,commit_timestamp:g,type:v,errors:w}=m;h=Object.assign(Object.assign({},{schema:y,table:x,commit_timestamp:g,eventType:v,new:{},old:{},errors:w}),this._getPayloadRecords(m))}p.callback(h,r)})}_isClosed(){return this.state===jr.closed}_isJoined(){return this.state===jr.joined}_isJoining(){return this.state===jr.joining}_isLeaving(){return this.state===jr.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const s=e.toLocaleLowerCase(),i={type:s,filter:n,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Fc.isEqual(s.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}static isFilterValueEqual(e,n){return(e??void 0)===(n??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Hi.close,{},e)}_onError(e){this._on(Hi.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=jr.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=US(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=US(e.columns,e.old_record)),n}}const R0=()=>{},_h={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},vL=[1e3,2e3,5e3,1e4],kL=1e4,SL=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class _L{constructor(e,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Bx,this.transport=null,this.heartbeatIntervalMs=_h.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=R0,this.ref=0,this.reconnectTimer=null,this.vsn=BS,this.logger=R0,this.conn=null,this.sendBuffer=[],this.serializer=new pL,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>s?(...i)=>s(...i):(...i)=>fetch(...i),!(!((r=n==null?void 0:n.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${Ux.websocket}`,this.httpEndpoint=eI(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=lL.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case ua.connecting:return yl.Connecting;case ua.open:return yl.Open;case ua.closing:return yl.Closing;default:return yl.Closed}}isConnected(){return this.connectionState()===yl.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===r);if(s)return s;{const i=new Fc(`realtime:${e}`,n,this);return this.channels.push(i),i}}push(e){const{topic:n,event:r,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${n} ${r} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(fL,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},_h.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:s,payload:i,ref:o}=n,a=o?`(${o})`:"",l=i.status||"";this.log("receive",`${l} ${r} ${s} ${a}`.trim(),i),this.channels.filter(u=>u._isMember(r)).forEach(u=>u._trigger(s,i,o)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===ua.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===ua.open||this.conn.readyState===ua.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this._terminateWorker()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Hi.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(n);return`${e}${r}${s}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([SL],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n,r=!1;if(e)n=e,r=!0;else if(this.accessToken)try{n=await this.accessToken()}catch(s){this.log("error","Error fetching access token from callback",s),n=this.accessTokenValue}else n=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(s=>{const i={access_token:n,version:uL};n&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(Hi.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(n=>{this.log("error",`Error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(n)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new Qj(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},_h.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,r,s,i,o,a,l,u,d,f,h,p;switch(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:Bx,this.heartbeatIntervalMs=(s=e==null?void 0:e.heartbeatIntervalMs)!==null&&s!==void 0?s:_h.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e==null?void 0:e.heartbeatCallback)!==null&&a!==void 0?a:R0,this.vsn=(l=e==null?void 0:e.vsn)!==null&&l!==void 0?l:BS,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(u=e==null?void 0:e.reconnectAfterMs)!==null&&u!==void 0?u:m=>vL[m-1]||kL,this.vsn){case Xj:this.encode=(d=e==null?void 0:e.encode)!==null&&d!==void 0?d:(m,y)=>y(JSON.stringify(m)),this.decode=(f=e==null?void 0:e.decode)!==null&&f!==void 0?f:(m,y)=>y(JSON.parse(m));break;case dL:this.encode=(h=e==null?void 0:e.encode)!==null&&h!==void 0?h:this.serializer.encode.bind(this.serializer),this.decode=(p=e==null?void 0:e.decode)!==null&&p!==void 0?p:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var cf=class extends Error{constructor(t,e){var n;super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((n=e.icebergType)==null?void 0:n.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function TL(t,e,n){const r=new URL(e,t);if(n)for(const[s,i]of Object.entries(n))i!==void 0&&r.searchParams.set(s,i);return r.toString()}async function CL(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function EL(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:n,path:r,query:s,body:i,headers:o}){const a=TL(t.baseUrl,r,s),l=await CL(t.auth),u=await e(a,{method:n,headers:{...i?{"Content-Type":"application/json"}:{},...l,...o},body:i?JSON.stringify(i):void 0}),d=await u.text(),f=(u.headers.get("content-type")||"").includes("application/json"),h=f&&d?JSON.parse(d):d;if(!u.ok){const p=f?h:void 0,m=p==null?void 0:p.error;throw new cf((m==null?void 0:m.message)??`Request failed with status ${u.status}`,{status:u.status,icebergType:m==null?void 0:m.type,icebergCode:m==null?void 0:m.code,details:p})}return{status:u.status,headers:u.headers,data:h}}}}function Th(t){return t.join("")}var NL=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:Th(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(r=>({namespace:r}))}async createNamespace(t,e){const n={namespace:t.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Th(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Th(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Th(t.namespace)}`}),!0}catch(e){if(e instanceof cf&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(n){if(n instanceof cf&&n.status===409)return;throw n}}};function uc(t){return t.join("")}var jL=class{constructor(t,e="",n){this.client=t,this.prefix=e,this.accessDelegation=n}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${uc(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const n={};return this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${uc(t.namespace)}/tables`,body:e,headers:n})).data.metadata}async updateTable(t,e){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${uc(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${uc(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${uc(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${uc(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(n){if(n instanceof cf&&n.status===404)return!1;throw n}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(n){if(n instanceof cf&&n.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw n}}},IL=class{constructor(t){var r;let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const n=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=EL({baseUrl:n,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(r=t.accessDelegation)==null?void 0:r.join(","),this.namespaceOps=new NL(this.client,e),this.tableOps=new jL(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},Ng=class extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}};function or(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var DL=class extends Ng{constructor(t,e,n){super(t),this.name="StorageApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Vx=class extends Ng{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}};const ww=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),ML=()=>Response,Wx=t=>{if(Array.isArray(t))return t.map(n=>Wx(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const s=n.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=Wx(r)}),e},AL=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},RL=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function uf(t){"@babel/helpers - typeof";return uf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uf(t)}function OL(t,e){if(uf(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(uf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function PL(t){var e=OL(t,"string");return uf(e)=="symbol"?e:e+""}function LL(t,e,n){return(e=PL(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function WS(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Jt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?WS(Object(n),!0).forEach(function(r){LL(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):WS(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const O0=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},$L=async(t,e,n)=>{t instanceof await ML()&&!(n!=null&&n.noResolveJson)?t.json().then(r=>{const s=t.status||500,i=(r==null?void 0:r.statusCode)||s+"";e(new DL(O0(r),s,i))}).catch(r=>{e(new Vx(O0(r),r))}):e(new Vx(O0(t),t))},zL=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?s:(AL(r)?(s.headers=Jt({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,e!=null&&e.duplex&&(s.duplex=e.duplex),Jt(Jt({},s),n))};async function Wf(t,e,n,r,s,i){return new Promise((o,a)=>{t(n,zL(e,r,s,i)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>$L(l,a,r))})}async function df(t,e,n,r){return Wf(t,"GET",e,n,r)}async function Bi(t,e,n,r,s){return Wf(t,"POST",e,r,s,n)}async function Kx(t,e,n,r,s){return Wf(t,"PUT",e,r,s,n)}async function FL(t,e,n,r){return Wf(t,"HEAD",e,Jt(Jt({},n),{},{noResolveJson:!0}),r)}async function vw(t,e,n,r,s){return Wf(t,"DELETE",e,r,s,n)}var BL=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(or(e))return{data:null,error:e};throw e}}};let tI;tI=Symbol.toStringTag;var UL=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[tI]="BlobDownloadBuilder",this.promise=null}asStream(){return new BL(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(or(e))return{data:null,error:e};throw e}}};const HL={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},KS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var VL=class{constructor(t,e={},n,r){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.bucketId=n,this.fetch=ww(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(t,e,n,r){var s=this;try{let i;const o=Jt(Jt({},KS),r);let a=Jt(Jt({},s.headers),t==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",s.encodeMetadata(l)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),l&&!i.has("metadata")&&i.append("metadata",s.encodeMetadata(l))):(i=n,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=s.toBase64(s.encodeMetadata(l))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),r!=null&&r.headers&&(a=Jt(Jt({},a),r.headers));const u=s._removeEmptyFolders(e),d=s._getFinalPath(u),f=await(t=="PUT"?Kx:Bi)(s.fetch,`${s.url}/object/${d}`,i,Jt({headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:u,id:f.Id,fullPath:f.Key},error:null}}catch(i){if(s.shouldThrowOnError)throw i;if(or(i))return{data:null,error:i};throw i}}async upload(t,e,n){return this.uploadOrUpdate("POST",t,e,n)}async uploadToSignedUrl(t,e,n,r){var s=this;const i=s._removeEmptyFolders(t),o=s._getFinalPath(i),a=new URL(s.url+`/object/upload/sign/${o}`);a.searchParams.set("token",e);try{let l;const u=Jt({upsert:KS.upsert},r),d=Jt(Jt({},s.headers),{"x-upsert":String(u.upsert)});return typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",u.cacheControl)):(l=n,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType),{data:{path:i,fullPath:(await Kx(s.fetch,a.toString(),l,{headers:d})).Key},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(or(l))return{data:null,error:l};throw l}}async createSignedUploadUrl(t,e){var n=this;try{let r=n._getFinalPath(t);const s=Jt({},n.headers);e!=null&&e.upsert&&(s["x-upsert"]="true");const i=await Bi(n.fetch,`${n.url}/object/upload/sign/${r}`,{},{headers:s}),o=new URL(n.url+i.url),a=o.searchParams.get("token");if(!a)throw new Ng("No token returned by API");return{data:{signedUrl:o.toString(),path:t,token:a},error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(or(r))return{data:null,error:r};throw r}}async update(t,e,n){return this.uploadOrUpdate("PUT",t,e,n)}async move(t,e,n){var r=this;try{return{data:await Bi(r.fetch,`${r.url}/object/move`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers}),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(or(s))return{data:null,error:s};throw s}}async copy(t,e,n){var r=this;try{return{data:{path:(await Bi(r.fetch,`${r.url}/object/copy`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers})).Key},error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(or(s))return{data:null,error:s};throw s}}async createSignedUrl(t,e,n){var r=this;try{let s=r._getFinalPath(t),i=await Bi(r.fetch,`${r.url}/object/sign/${s}`,Jt({expiresIn:e},n!=null&&n.transform?{transform:n.transform}:{}),{headers:r.headers});const o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${r.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(or(s))return{data:null,error:s};throw s}}async createSignedUrls(t,e,n){var r=this;try{const s=await Bi(r.fetch,`${r.url}/object/sign/${r.bucketId}`,{expiresIn:e,paths:t},{headers:r.headers}),i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(o=>Jt(Jt({},o),{},{signedUrl:o.signedURL?encodeURI(`${r.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(or(s))return{data:null,error:s};throw s}}download(t,e){const n=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",r=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),s=r?`?${r}`:"",i=this._getFinalPath(t),o=()=>df(this.fetch,`${this.url}/${n}/${i}${s}`,{headers:this.headers,noResolveJson:!0});return new UL(o,this.shouldThrowOnError)}async info(t){var e=this;const n=e._getFinalPath(t);try{return{data:Wx(await df(e.fetch,`${e.url}/object/info/${n}`,{headers:e.headers})),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(or(r))return{data:null,error:r};throw r}}async exists(t){var e=this;const n=e._getFinalPath(t);try{return await FL(e.fetch,`${e.url}/object/${n}`,{headers:e.headers}),{data:!0,error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(or(r)&&r instanceof Vx){const s=r.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:r}}throw r}}getPublicUrl(t,e){const n=this._getFinalPath(t),r=[],s=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";s!==""&&r.push(s);const i=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",o=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});o!==""&&r.push(o);let a=r.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${n}${a}`)}}}async remove(t){var e=this;try{return{data:await vw(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(or(n))return{data:null,error:n};throw n}}async list(t,e,n){var r=this;try{const s=Jt(Jt(Jt({},HL),e),{},{prefix:t||""});return{data:await Bi(r.fetch,`${r.url}/object/list/${r.bucketId}`,s,{headers:r.headers},n),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(or(s))return{data:null,error:s};throw s}}async listV2(t,e){var n=this;try{const r=Jt({},t);return{data:await Bi(n.fetch,`${n.url}/object/list-v2/${n.bucketId}`,r,{headers:n.headers},e),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(or(r))return{data:null,error:r};throw r}}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const nI="2.89.0",rI={"X-Client-Info":`storage-js/${nI}`};var WL=class{constructor(t,e={},n,r){this.shouldThrowOnError=!1;const s=new URL(t);r!=null&&r.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href.replace(/\/$/,""),this.headers=Jt(Jt({},rI),e),this.fetch=ww(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(t){var e=this;try{const n=e.listBucketOptionsToQueryString(t);return{data:await df(e.fetch,`${e.url}/bucket${n}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(or(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await df(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(or(n))return{data:null,error:n};throw n}}async createBucket(t,e={public:!1}){var n=this;try{return{data:await Bi(n.fetch,`${n.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(or(r))return{data:null,error:r};throw r}}async updateBucket(t,e){var n=this;try{return{data:await Kx(n.fetch,`${n.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(or(r))return{data:null,error:r};throw r}}async emptyBucket(t){var e=this;try{return{data:await Bi(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(or(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await vw(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(or(n))return{data:null,error:n};throw n}}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},KL=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Jt(Jt({},rI),e),this.fetch=ww(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await Bi(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(or(n))return{data:null,error:n};throw n}}async listBuckets(t){var e=this;try{const n=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&n.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&n.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&n.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&n.set("sortOrder",t.sortOrder),t!=null&&t.search&&n.set("search",t.search);const r=n.toString(),s=r?`${e.url}/bucket?${r}`:`${e.url}/bucket`;return{data:await df(e.fetch,s,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(or(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await vw(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(or(n))return{data:null,error:n};throw n}}from(t){var e=this;if(!RL(t))throw new Ng("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new IL({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(n,{get(s,i){const o=s[i];return typeof o!="function"?o:async(...a)=>{try{return{data:await o.apply(s,a),error:null}}catch(l){if(r)throw l;return{data:null,error:l}}}}})}};const kw={"X-Client-Info":`storage-js/${nI}`,"Content-Type":"application/json"};var sI=class extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Gs(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}var P0=class extends sI{constructor(t,e,n){super(t),this.name="StorageVectorsApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},GL=class extends sI{constructor(t,e){super(t),this.name="StorageVectorsUnknownError",this.originalError=e}};const Sw=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),qL=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},GS=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),YL=async(t,e,n)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const r=t.status||500,s=t;if(typeof s.json=="function")s.json().then(i=>{const o=(i==null?void 0:i.statusCode)||(i==null?void 0:i.code)||r+"";e(new P0(GS(i),r,o))}).catch(()=>{const i=r+"";e(new P0(s.statusText||`HTTP ${r} error`,r,i))});else{const i=r+"";e(new P0(s.statusText||`HTTP ${r} error`,r,i))}}else e(new GL(GS(t),t))},JL=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?s:(qL(r)?(s.headers=Jt({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,Jt(Jt({},s),n))};async function XL(t,e,n,r,s,i){return new Promise((o,a)=>{t(n,JL(e,r,s,i)).then(l=>{if(!l.ok)throw l;if(r!=null&&r.noResolveJson)return l;const u=l.headers.get("content-type");return!u||!u.includes("application/json")?{}:l.json()}).then(l=>o(l)).catch(l=>YL(l,a,r))})}async function qs(t,e,n,r,s){return XL(t,"POST",e,r,s,n)}var QL=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Jt(Jt({},kw),e),this.fetch=Sw(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(t){var e=this;try{return{data:await qs(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async getIndex(t,e){var n=this;try{return{data:await qs(n.fetch,`${n.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(Gs(r))return{data:null,error:r};throw r}}async listIndexes(t){var e=this;try{return{data:await qs(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async deleteIndex(t,e){var n=this;try{return{data:await qs(n.fetch,`${n.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers})||{},error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(Gs(r))return{data:null,error:r};throw r}}},ZL=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Jt(Jt({},kw),e),this.fetch=Sw(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(t){var e=this;try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await qs(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async getVectors(t){var e=this;try{return{data:await qs(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async listVectors(t){var e=this;try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:await qs(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async queryVectors(t){var e=this;try{return{data:await qs(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async deleteVectors(t){var e=this;try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await qs(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}},e$=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Jt(Jt({},kw),e),this.fetch=Sw(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await qs(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await qs(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async listBuckets(t={}){var e=this;try{return{data:await qs(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await qs(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}},t$=class extends e${constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new n$(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,n=this;return e().call(n,t)}async getBucket(t){var e=()=>super.getBucket,n=this;return e().call(n,t)}async listBuckets(t={}){var e=()=>super.listBuckets,n=this;return e().call(n,t)}async deleteBucket(t){var e=()=>super.deleteBucket,n=this;return e().call(n,t)}},n$=class extends QL{constructor(t,e,n,r){super(t,e,r),this.vectorBucketName=n}async createIndex(t){var e=()=>super.createIndex,n=this;return e().call(n,Jt(Jt({},t),{},{vectorBucketName:n.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,n=this;return e().call(n,Jt(Jt({},t),{},{vectorBucketName:n.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,n=this;return e().call(n,n.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,n=this;return e().call(n,n.vectorBucketName,t)}index(t){return new r$(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},r$=class extends ZL{constructor(t,e,n,r,s){super(t,e,s),this.vectorBucketName=n,this.indexName=r}async putVectors(t){var e=()=>super.putVectors,n=this;return e().call(n,Jt(Jt({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async getVectors(t){var e=()=>super.getVectors,n=this;return e().call(n,Jt(Jt({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,n=this;return e().call(n,Jt(Jt({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,n=this;return e().call(n,Jt(Jt({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,n=this;return e().call(n,Jt(Jt({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}},s$=class extends WL{constructor(t,e={},n,r){super(t,e,n,r)}from(t){return new VL(this.url,this.headers,t,this.fetch)}get vectors(){return new t$(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new KL(this.url+"/iceberg",this.headers,this.fetch)}};const iI="2.89.0",Sc=30*1e3,Gx=3,L0=Gx*Sc,i$="http://localhost:9999",o$="supabase.auth.token",a$={"X-Client-Info":`gotrue-js/${iI}`},qx="X-Supabase-Api-Version",oI={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},l$=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,c$=10*60*1e3;class ff extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function Vt(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class u$ extends ff{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function d$(t){return Vt(t)&&t.name==="AuthApiError"}class xl extends ff{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class Xo extends ff{constructor(e,n,r,s){super(e,r,s),this.name=n,this.status=r}}class Vs extends Xo{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function f$(t){return Vt(t)&&t.name==="AuthSessionMissingError"}class dc extends Xo{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ch extends Xo{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Eh extends Xo{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function h$(t){return Vt(t)&&t.name==="AuthImplicitGrantRedirectError"}class qS extends Xo{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class p$ extends Xo{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Yx extends Xo{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function $0(t){return Vt(t)&&t.name==="AuthRetryableFetchError"}class YS extends Xo{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class Jx extends Xo{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const tm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),JS=` 	
\r=`.split(""),m$=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<JS.length;e+=1)t[JS[e].charCodeAt(0)]=-2;for(let e=0;e<tm.length;e+=1)t[tm[e].charCodeAt(0)]=e;return t})();function XS(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(tm[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(tm[r]),e.queuedBits-=6}}function aI(t,e,n){const r=m$[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function QS(t){const e=[],n=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{x$(o,r,n)};for(let o=0;o<t.length;o+=1)aI(t.charCodeAt(o),s,i);return e.join("")}function g$(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function y$(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|s)+65536,n+=1}g$(r,e)}}function x$(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if(!(t>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function nu(t){const e=[],n={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<t.length;s+=1)aI(t.charCodeAt(s),n,r);return new Uint8Array(e)}function b$(t){const e=[];return y$(t,n=>e.push(n)),new Uint8Array(e)}function Cl(t){const e=[],n={queue:0,queuedBits:0},r=s=>{e.push(s)};return t.forEach(s=>XS(s,n,r)),XS(null,n,r),e.join("")}function w$(t){return Math.round(Date.now()/1e3)+t}function v$(){return Symbol("auth-callback")}const Gr=()=>typeof window<"u"&&typeof document<"u",ol={tested:!1,writable:!1},lI=()=>{if(!Gr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ol.tested)return ol.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),ol.tested=!0,ol.writable=!0}catch{ol.tested=!0,ol.writable=!1}return ol.writable};function k$(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return n.searchParams.forEach((r,s)=>{e[s]=r}),e}const cI=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),S$=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",_c=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},al=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Kr=async(t,e)=>{await t.removeItem(e)};class jg{constructor(){this.promise=new jg.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}jg.promiseConstructor=Promise;function z0(t){const e=t.split(".");if(e.length!==3)throw new Jx("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!l$.test(e[r]))throw new Jx("JWT not in base64url format");return{header:JSON.parse(QS(e[0])),payload:JSON.parse(QS(e[1])),signature:nu(e[2]),raw:{header:e[0],payload:e[1]}}}async function _$(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function T$(t,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await t(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function C$(t){return("0"+t.toString(16)).substr(-2)}function E$(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let s="";for(let i=0;i<56;i++)s+=n.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,C$).join("")}async function N$(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function j$(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await N$(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function fc(t,e,n=!1){const r=E$();let s=r;n&&(s+="/PASSWORD_RECOVERY"),await _c(t,`${e}-code-verifier`,s);const i=await j$(r);return[i,r===i?"plain":"s256"]}const I$=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function D$(t){const e=t.headers.get(qx);if(!e||!e.match(I$))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function M$(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function A$(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const R$=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function hc(t){if(!R$.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function F0(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function O$(t,e){return new Proxy(t,{get:(n,r,s)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,s)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,r,s)}})}function ZS(t){return JSON.parse(JSON.stringify(t))}const hl=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),P$=[502,503,504];async function e2(t){var e;if(!S$(t))throw new Yx(hl(t),0);if(P$.includes(t.status))throw new Yx(hl(t),t.status);let n;try{n=await t.json()}catch(i){throw new xl(hl(i),i)}let r;const s=D$(t);if(s&&s.getTime()>=oI["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new YS(hl(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Vs}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new YS(hl(n),t.status,n.weak_password.reasons);throw new u$(hl(n),t.status||500,r)}const L$=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),n))};async function Yt(t,e,n,r){var s;const i=Object.assign({},r==null?void 0:r.headers);i[qx]||(i[qx]=oI["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await $$(t,e,n+a,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function $$(t,e,n,r,s,i){const o=L$(e,r,s,i);let a;try{a=await t(n,Object.assign({},o))}catch(l){throw console.error(l),new Yx(hl(l),0)}if(a.ok||await e2(a),r!=null&&r.noResolveJson)return a;try{return await a.json()}catch(l){await e2(l)}}function Li(t){var e;let n=null;B$(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=w$(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function t2(t){const e=Li(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function ya(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function z$(t){return{data:t,error:null}}function F$(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i}=t,o=Eg(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function n2(t){return t}function B$(t){return t.access_token&&t.refresh_token&&t.expires_in}const B0=["global","local","others"];class U${constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=cI(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=B0[0]){if(B0.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${B0.join(", ")}`);try{return await Yt(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Vt(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await Yt(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:ya})}catch(r){if(Vt(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=Eg(e,["options"]),s=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await Yt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:F$,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(Vt(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await Yt(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ya})}catch(n){if(Vt(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,s,i,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},d=await Yt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:n2});if(d.error)throw d.error;const f=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),x=JSON.parse(m.split(";")[1].split("=")[1]);u[`${x}Page`]=y}),u.total=parseInt(h)),{data:Object.assign(Object.assign({},f),u),error:null}}catch(u){if(Vt(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){hc(e);try{return await Yt(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ya})}catch(n){if(Vt(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){hc(e);try{return await Yt(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:ya})}catch(r){if(Vt(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){hc(e);try{return await Yt(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:ya})}catch(r){if(Vt(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){hc(e.userId);try{const{data:n,error:r}=await Yt(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:n,error:r}}catch(n){if(Vt(n))return{data:null,error:n};throw n}}async _deleteFactor(e){hc(e.userId),hc(e.id);try{return{data:await Yt(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Vt(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,r,s,i,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},d=await Yt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:n2});if(d.error)throw d.error;const f=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),x=JSON.parse(m.split(";")[1].split("=")[1]);u[`${x}Page`]=y}),u.total=parseInt(h)),{data:Object.assign(Object.assign({},f),u),error:null}}catch(u){if(Vt(u))return{data:{clients:[]},error:u};throw u}}async _createOAuthClient(e){try{return await Yt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Vt(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await Yt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Vt(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await Yt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Vt(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await Yt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Vt(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await Yt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Vt(n))return{data:null,error:n};throw n}}}function r2(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const pc={debug:!!(globalThis&&lI()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class uI extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class H$ extends uI{}async function V$(t,e,n){pc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),pc.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){pc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,s.name);try{return await n()}finally{pc.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,s.name)}}else{if(e===0)throw pc.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new H$(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(pc.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function W$(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function dI(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function K$(t){return parseInt(t,16)}function G$(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function q$(t){var e;const{chainId:n,domain:r,expirationTime:s,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:l,resources:u,scheme:d,uri:f,version:h}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!f)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const p=dI(t.address),m=d?`${d}://${r}`:r,y=t.statement?`${t.statement}
`:"",x=`${m} wants you to sign in with your Ethereum account:
${p}

${y}`;let g=`URI: ${f}
Version: ${h}
Chain ID: ${n}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(s&&(g+=`
Expiration Time: ${s.toISOString()}`),a&&(g+=`
Not Before: ${a.toISOString()}`),l&&(g+=`
Request ID: ${l}`),u){let v=`
Resources:`;for(const w of u){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);v+=`
- ${w}`}g+=v}return`${x}
${g}`}class kr extends Error{constructor({message:e,code:n,cause:r,name:s}){var i;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(i=s??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=n}}class nm extends kr{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function Y$({error:t,options:e}){var n,r,s;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new kr({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new kr({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new kr({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new kr({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new kr({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new kr({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new kr({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new kr({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const o=window.location.hostname;if(fI(o)){if(i.rp.id!==o)return new kr({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new kr({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new kr({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new kr({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new kr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function J$({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new kr({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new kr({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(fI(r)){if(n.rpId!==r)return new kr({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new kr({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new kr({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new kr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class X${createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const Q$=new X$;function Z$(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:r}=t,s=Eg(t,["challenge","user","excludeCredentials"]),i=nu(e).buffer,o=Object.assign(Object.assign({},n),{id:nu(n.id).buffer}),a=Object.assign(Object.assign({},s),{challenge:i,user:o});if(r&&r.length>0){a.excludeCredentials=new Array(r.length);for(let l=0;l<r.length;l++){const u=r[l];a.excludeCredentials[l]=Object.assign(Object.assign({},u),{id:nu(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return a}function e6(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,r=Eg(t,["challenge","allowCredentials"]),s=nu(e).buffer,i=Object.assign(Object.assign({},r),{challenge:s});if(n&&n.length>0){i.allowCredentials=new Array(n.length);for(let o=0;o<n.length;o++){const a=n[o];i.allowCredentials[o]=Object.assign(Object.assign({},a),{id:nu(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return i}function t6(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:Cl(new Uint8Array(t.response.attestationObject)),clientDataJSON:Cl(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function n6(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,r=t.getClientExtensionResults(),s=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Cl(new Uint8Array(s.authenticatorData)),clientDataJSON:Cl(new Uint8Array(s.clientDataJSON)),signature:Cl(new Uint8Array(s.signature)),userHandle:s.userHandle?Cl(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function fI(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function s2(){var t,e;return!!(Gr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function r6(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new nm("Browser returned unexpected credential type",e)}:{data:null,error:new nm("Empty credential response",e)}}catch(e){return{data:null,error:Y$({error:e,options:t})}}}async function s6(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new nm("Browser returned unexpected credential type",e)}:{data:null,error:new nm("Empty credential response",e)}}catch(e){return{data:null,error:J$({error:e,options:t})}}}const i6={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},o6={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function rm(...t){const e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),n=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),r={};for(const s of t)if(s)for(const i in s){const o=s[i];if(o!==void 0)if(Array.isArray(o))r[i]=o;else if(n(o))r[i]=o;else if(e(o)){const a=r[i];e(a)?r[i]=rm(a,o):r[i]=rm(o)}else r[i]=o}return r}function a6(t,e){return rm(i6,t,e||{})}function l6(t,e){return rm(o6,t,e||{})}class c6{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:r,signal:s},i){try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!o)return{data:null,error:a};const l=s??Q$.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:u}=o.webauthn.credential_options.publicKey;u.name||(u.name=`${u.id}:${r}`),u.displayName||(u.displayName=u.name)}switch(o.webauthn.type){case"create":{const u=a6(o.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:d,error:f}=await r6({publicKey:u,signal:l});return d?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:f}}case"request":{const u=l6(o.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:d,error:f}=await s6(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:u,signal:l}));return d?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:f}}}}catch(o){return Vt(o)?{data:null,error:o}:{data:null,error:new xl("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!n)return{data:null,error:new ff("rpId is required for WebAuthn authentication")};try{if(!s2())return{data:null,error:new xl("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:r},signal:s},{request:i});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:n,rpOrigins:r,credential_response:l.credential_response}})}catch(o){return Vt(o)?{data:null,error:o}:{data:null,error:new xl("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!n)return{data:null,error:new ff("rpId is required for WebAuthn registration")};try{if(!s2())return{data:null,error:new xl("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(d=>{var f;return(f=d.data)===null||f===void 0?void 0:f.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===e&&h.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d==null?void 0:d.id}):void 0),{data:null,error:a};const{data:l,error:u}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:s},{create:i});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:n,rpOrigins:r,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:u}}catch(o){return Vt(o)?{data:null,error:o}:{data:null,error:new xl("Unexpected error in register",o)}}}}W$();const u6={url:i$,storageKey:o$,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:a$,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function i2(t,e,n){return await n()}const mc={};class hf{get jwks(){var e,n;return(n=(e=mc[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){mc[this.storageKey]=Object.assign(Object.assign({},mc[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=mc[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){mc[this.storageKey]=Object.assign(Object.assign({},mc[this.storageKey]),{cachedAt:e})}constructor(e){var n,r,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},u6),e);if(this.storageKey=i.storageKey,this.instanceID=(n=hf.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,hf.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&Gr()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new U$({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=cI(i.fetch),this.lock=i.lock||i2,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:this.persistSession&&Gr()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=V$:this.lock=i2,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new c6(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:lI()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=r2(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=r2(this.memoryStorage)),Gr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${iI}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},r="none";if(Gr()&&(n=k$(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),Gr()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:i}=await this._getSessionFromURL(n,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),h$(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Vt(n)?this._returnResult({error:n}):this._returnResult({error:new xl("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,s;try{const i=await Yt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:Li}),{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(i){if(Vt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var n,r,s;try{let i;if("email"in e){const{email:d,password:f,options:h}=e;let p=null,m=null;this.flowType==="pkce"&&([p,m]=await fc(this.storage,this.storageKey)),i=await Yt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:d,password:f,data:(n=h==null?void 0:h.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:p,code_challenge_method:m},xform:Li})}else if("phone"in e){const{phone:d,password:f,options:h}=e;i=await Yt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:f,data:(r=h==null?void 0:h.data)!==null&&r!==void 0?r:{},channel:(s=h==null?void 0:h.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:Li})}else throw new Ch("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return await Kr(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(i){if(await Kr(this.storage,`${this.storageKey}-code-verifier`),Vt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let n;if("email"in e){const{email:i,password:o,options:a}=e;n=await Yt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:t2})}else if("phone"in e){const{phone:i,password:o,options:a}=e;n=await Yt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:t2})}else throw new Ch("You must provide either an email or phone number and a password");const{data:r,error:s}=n;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!r||!r.session||!r.user){const i=new dc;return this._returnResult({data:{user:null,session:null},error:i})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(n){if(Vt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,r,s,i,o,a,l,u,d,f,h;let p,m;if("message"in e)p=e.message,m=e.signature;else{const{chain:y,wallet:x,statement:g,options:v}=e;let w;if(Gr())if(typeof x=="object")w=x;else{const S=window;if("ethereum"in S&&typeof S.ethereum=="object"&&"request"in S.ethereum&&typeof S.ethereum.request=="function")w=S.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof x!="object"||!(v!=null&&v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=x}const T=new URL((n=v==null?void 0:v.url)!==null&&n!==void 0?n:window.location.href),D=await w.request({method:"eth_requestAccounts"}).then(S=>S).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!D||D.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const k=dI(D[0]);let I=(r=v==null?void 0:v.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!I){const S=await w.request({method:"eth_chainId"});I=K$(S)}const C={domain:T.host,address:k,statement:g,uri:T.href,version:"1",chainId:I,nonce:(s=v==null?void 0:v.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(o=(i=v==null?void 0:v.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=v==null?void 0:v.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=v==null?void 0:v.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(u=v==null?void 0:v.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(d=v==null?void 0:v.signInWithEthereum)===null||d===void 0?void 0:d.resources};p=q$(C),m=await w.request({method:"personal_sign",params:[G$(p),k]})}try{const{data:y,error:x}=await Yt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:m},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:Li});if(x)throw x;if(!y||!y.session||!y.user){const g=new dc;return this._returnResult({data:{user:null,session:null},error:g})}return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),this._returnResult({data:Object.assign({},y),error:x})}catch(y){if(Vt(y))return this._returnResult({data:{user:null,session:null},error:y});throw y}}async signInWithSolana(e){var n,r,s,i,o,a,l,u,d,f,h,p;let m,y;if("message"in e)m=e.message,y=e.signature;else{const{chain:x,wallet:g,statement:v,options:w}=e;let T;if(Gr())if(typeof g=="object")T=g;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))T=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof g!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");T=g}const D=new URL((n=w==null?void 0:w.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in T&&T.signIn){const k=await T.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:D.host,uri:D.href}),v?{statement:v}:null));let I;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")I=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)I=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in I&&"signature"in I&&(typeof I.signedMessage=="string"||I.signedMessage instanceof Uint8Array)&&I.signature instanceof Uint8Array)m=typeof I.signedMessage=="string"?I.signedMessage:new TextDecoder().decode(I.signedMessage),y=I.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in T)||typeof T.signMessage!="function"||!("publicKey"in T)||typeof T!="object"||!T.publicKey||!("toBase58"in T.publicKey)||typeof T.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${D.host} wants you to sign in with your Solana account:`,T.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${D.href}`,`Issued At: ${(s=(r=w==null?void 0:w.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=w==null?void 0:w.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((a=w==null?void 0:w.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((u=w==null?void 0:w.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((f=(d=w==null?void 0:w.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||f===void 0)&&f.length?["Resources",...w.signInWithSolana.resources.map(I=>`- ${I}`)]:[]].join(`
`);const k=await T.signMessage(new TextEncoder().encode(m),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=k}}try{const{data:x,error:g}=await Yt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:Cl(y)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Li});if(g)throw g;if(!x||!x.session||!x.user){const v=new dc;return this._returnResult({data:{user:null,session:null},error:v})}return x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("SIGNED_IN",x.session)),this._returnResult({data:Object.assign({},x),error:g})}catch(x){if(Vt(x))return this._returnResult({data:{user:null,session:null},error:x});throw x}}async _exchangeCodeForSession(e){const n=await al(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(n??"").split("/");try{if(!r&&this.flowType==="pkce")throw new p$;const{data:i,error:o}=await Yt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Li});if(await Kr(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const a=new dc;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(await Kr(this.storage,`${this.storageKey}-code-verifier`),Vt(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:n,provider:r,token:s,access_token:i,nonce:o}=e,a=await Yt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:Li}),{data:l,error:u}=a;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!l||!l.session||!l.user){const d=new dc;return this._returnResult({data:{user:null,session:null},error:d})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:u})}catch(n){if(Vt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,r,s,i,o;try{if("email"in e){const{email:a,options:l}=e;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await fc(this.storage,this.storageKey));const{error:f}=await Yt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:f})}if("phone"in e){const{phone:a,options:l}=e,{data:u,error:d}=await Yt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:d})}throw new Ch("You must provide either an email or phone number.")}catch(a){if(await Kr(this.storage,`${this.storageKey}-code-verifier`),Vt(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var n,r;try{let s,i;"options"in e&&(s=(n=e.options)===null||n===void 0?void 0:n.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await Yt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Li});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,u=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(s){if(Vt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(e){var n,r,s,i,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await fc(this.storage,this.storageKey));const u=await Yt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:z$});return!((i=u.data)===null||i===void 0)&&i.url&&Gr()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(u.data.url),this._returnResult(u)}catch(a){if(await Kr(this.storage,`${this.storageKey}-code-verifier`),Vt(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Vs;const{error:s}=await Yt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(Vt(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:o}=await Yt(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:o,error:a}=await Yt(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a})}throw new Ch("You must provide either an email or phone number and a type")}catch(n){if(Vt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await al(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<L0:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const o=await al(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=F0()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=O$(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const n=await this._acquireLock(-1,async()=>await this._getUser());return n.data.user&&(this.suppressGetSessionWarning=!0),n}async _getUser(e){try{return e?await Yt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ya}):await this._useSession(async n=>{var r,s,i;const{data:o,error:a}=n;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Vs}:await Yt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:ya})})}catch(n){if(Vt(n))return f$(n)&&(await this._removeSession(),await Kr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new Vs;const o=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await fc(this.storage,this.storageKey));const{data:u,error:d}=await Yt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:ya});if(d)throw d;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(r){if(await Kr(this.storage,`${this.storageKey}-code-verifier`),Vt(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Vs;const n=Date.now()/1e3;let r=n,s=!0,i=null;const{payload:o}=z0(e.access_token);if(o.exp&&(r=o.exp,s=r<=n),s){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(n){if(Vt(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:o,error:a}=n;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Vs;const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(Vt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!Gr())throw new Eh("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Eh(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new qS("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Eh("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new qS("No code detected.");const{data:v,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const T=new URL(window.location.href);return T.searchParams.delete("code"),window.history.replaceState(window.history.state,"",T.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:u}=e;if(!i||!a||!o||!u)throw new Eh("No session defined in URL");const d=Math.round(Date.now()/1e3),f=parseInt(a);let h=d+f;l&&(h=parseInt(l));const p=h-d;p*1e3<=Sc&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${f}s`);const m=h-f;d-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,h,d):d-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,h,d);const{data:y,error:x}=await this._getUser(i);if(x)throw x;const g={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:f,expires_at:h,refresh_token:o,token_type:u,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:g,redirectType:e.type},error:null})}catch(r){if(Vt(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await al(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({error:i});const o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(d$(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await Kr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=v$(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,s;try{const{data:{session:i},error:o}=n;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,n={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await fc(this.storage,this.storageKey,!0));try{return await Yt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(i){if(await Kr(this.storage,`${this.storageKey}-code-verifier`),Vt(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:r,error:s}=await this._useSession(async i=>{var o,a,l,u,d;const{data:f,error:h}=i;if(h)throw h;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await Yt(this.fetch,"GET",p,{headers:this.headers,jwt:(d=(u=f.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(s)throw s;return Gr()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(Vt(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var r;try{const{error:s,data:{session:i}}=n;if(s)throw s;const{options:o,provider:a,token:l,access_token:u,nonce:d}=e,f=await Yt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=i==null?void 0:i.access_token)!==null&&r!==void 0?r:void 0,body:{provider:a,id_token:l,access_token:u,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Li}),{data:h,error:p}=f;return p?this._returnResult({data:{user:null,session:null},error:p}):!h||!h.session||!h.user?this._returnResult({data:{user:null,session:null},error:new dc}):(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:p}))}catch(s){if(await Kr(this.storage,`${this.storageKey}-code-verifier`),Vt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,s;const{data:i,error:o}=n;if(o)throw o;return await Yt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await T$(async s=>(s>0&&await _$(200*Math.pow(2,s-1)),this._debug(n,"refreshing attempt",s),await Yt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Li})),(s,i)=>{const o=200*Math.pow(2,s);return i&&$0(i)&&Date.now()+o-r<Sc})}catch(r){if(this._debug(n,"error",r),Vt(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),Gr()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const s=await al(this.storage,this.storageKey);if(s&&this.userStorage){let o=await al(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:s.user},await _c(this.userStorage,this.storageKey+"-user",o)),s.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:F0()}else if(s&&!s.user&&!s.user){const o=await al(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(s.user=o.user,await Kr(this.storage,this.storageKey+"-user"),await _c(this.storage,this.storageKey,s)):s.user=F0()}if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),s!==null&&await this._removeSession();return}const i=((n=s.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<L0;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${L0}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:o}=await this._callRefreshToken(s.refresh_token);o&&(console.error(o),$0(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(s.access_token);!a&&(o!=null&&o.user)?(s.user=o.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(r,"error",s),console.error(s);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Vs;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new jg;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Vs;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={data:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),Vt(i)){const o={data:null,error:i};return $0(i)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,n,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,n)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Kr(this.storage,`${this.storageKey}-code-verifier`);const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await _c(this.userStorage,this.storageKey+"-user",{user:n.user});const s=Object.assign({},n);delete s.user;const i=ZS(s);await _c(this.storage,this.storageKey,i)}else{const s=ZS(n);await _c(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Kr(this.storage,this.storageKey),await Kr(this.storage,this.storageKey+"-code-verifier"),await Kr(this.storage,this.storageKey+"-user"),this.userStorage&&await Kr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Gr()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Sc);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/Sc);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Sc}ms, refresh threshold is ${Gx} ticks`),s<=Gx&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof uI)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Gr()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const s=[`provider=${encodeURIComponent(n)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await fc(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;return i?this._returnResult({data:null,error:i}):await Yt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,s;const{data:i,error:o}=n;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:u}=await Yt(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return u?this._returnResult({data:null,error:u}):(e.factorType==="totp"&&l.type==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?t6(e.webauthn.credential_response):n6(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await Yt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({data:null,error:i});const o=await Yt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Z$(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:e6(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const s={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])s.all.push(i),i.status==="verified"&&s[i.factor_type].push(i);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var e,n;const{data:{session:r},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=z0(r.access_token);let o=null;i.aal&&(o=i.aal);let a=o;((n=(e=r.user.factors)===null||e===void 0?void 0:e.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(a="aal2");const u=i.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:u},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;return s?this._returnResult({data:null,error:s}):r?await Yt(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Vs})})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:s},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Vs});const o=await Yt(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&Gr()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Vt(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:s},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Vs});const o=await Yt(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&Gr()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Vt(r))return this._returnResult({data:null,error:r});throw r}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;return r?this._returnResult({data:null,error:r}):n?await Yt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new Vs})})}catch(e){if(Vt(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;return s?this._returnResult({data:null,error:s}):r?(await Yt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Vs})})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(a=>a.kid===e);if(r)return r;const s=Date.now();if(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+c$>s)return r;const{data:i,error:o}=await Yt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,r=i.keys.find(a=>a.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:p,error:m}=await this.getSession();if(m||!p.session)return this._returnResult({data:null,error:m});r=p.session.access_token}const{header:s,payload:i,signature:o,raw:{header:a,payload:l}}=z0(r);n!=null&&n.allowExpired||M$(i.exp);const u=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!u){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:i,header:s,signature:o},error:null}}const d=A$(s.alg),f=await crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!await crypto.subtle.verify(d,f,o,b$(`${a}.${l}`)))throw new Jx("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(r){if(Vt(r))return this._returnResult({data:null,error:r});throw r}}}hf.nextInstanceID={};const d6=hf,f6="2.89.0";let ld="";typeof Deno<"u"?ld="deno":typeof document<"u"?ld="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ld="react-native":ld="node";const h6={"X-Client-Info":`supabase-js-${ld}/${f6}`},p6={headers:h6},m6={schema:"public"},g6={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},y6={};function pf(t){"@babel/helpers - typeof";return pf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pf(t)}function x6(t,e){if(pf(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(pf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function b6(t){var e=x6(t,"string");return pf(e)=="symbol"?e:e+""}function w6(t,e,n){return(e=b6(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function fr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?o2(Object(n),!0).forEach(function(r){w6(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o2(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const v6=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),k6=()=>Headers,S6=(t,e,n)=>{const r=v6(n),s=k6();return async(i,o)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:t;let u=new s(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",t),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),r(i,fr(fr({},o),{},{headers:u}))}};function _6(t){return t.endsWith("/")?t:t+"/"}function T6(t,e){var n,r;const{db:s,auth:i,realtime:o,global:a}=t,{db:l,auth:u,realtime:d,global:f}=e,h={db:fr(fr({},l),s),auth:fr(fr({},u),i),realtime:fr(fr({},d),o),storage:{},global:fr(fr(fr({},f),a),{},{headers:fr(fr({},(n=f==null?void 0:f.headers)!==null&&n!==void 0?n:{}),(r=a==null?void 0:a.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return t.accessToken?h.accessToken=t.accessToken:delete h.accessToken,h}function C6(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(_6(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var E6=class extends d6{constructor(t){super(t)}},N6=class{constructor(t,e,n){var r,s;this.supabaseUrl=t,this.supabaseKey=e;const i=C6(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,a={db:m6,realtime:y6,auth:fr(fr({},g6),{},{storageKey:o}),global:p6},l=T6(n??{},a);if(this.storageKey=(r=l.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(s=l.global.headers)!==null&&s!==void 0?s:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(d,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}});else{var u;this.auth=this._initSupabaseAuthClient((u=l.auth)!==null&&u!==void 0?u:{},this.headers,l.global.fetch)}this.fetch=S6(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(fr({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(d=>this.realtime.setAuth(d)).catch(d=>console.warn("Failed to set initial Realtime auth token:",d)),this.rest=new aL(new URL("rest/v1",i).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new s$(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new nL(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,n)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,n;if(t.accessToken)return await t.accessToken();const{data:r}=await t.auth.getSession();return(e=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:s,storageKey:i,flowType:o,lock:a,debug:l,throwOnError:u},d,f){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new E6({url:this.authUrl.href,headers:fr(fr({},h),d),storageKey:i,autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:s,flowType:o,lock:a,debug:l,throwOnError:u,fetch:f,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new _L(this.realtimeUrl.href,fr(fr({},t),{},{params:fr(fr({},{apikey:this.supabaseKey}),t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(t,e,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const j6=(t,e,n)=>new N6(t,e,n);function I6(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}I6()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const hI="https://acrkclmderqewcwugsnl.supabase.co",dp="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFjcmtjbG1kZXJxZXdjd3Vnc25sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNTc0MzAsImV4cCI6MjA4MTgzMzQzMH0.UT2vJTXpPO5tR9sUD8YU0gJ_47Zpe3yJiLzllUljPDw";console.log("Supabase Config:",{url:hI,keyLength:dp==null?void 0:dp.length});let pI=null;try{pI=j6(hI,dp)}catch(t){console.error("Error creating Supabase client:",t)}const je=pI,D6=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),M6=(t,e)=>{const n=new Date,r=t.toLowerCase().trim();if(/^\d+$/.test(r)){const i=parseInt(r,10);let o=n.getMonth(),a=n.getFullYear();i<n.getDate()&&(o++,o>11&&(o=0,a++));const l=new Date(a,o,i);if(l.getMonth()===o)return l}if(["","today","td"].includes(r))return n;if(["","tmr","tm"].includes(r))return new Date(n.setDate(n.getDate()+1));if([""].includes(r))return new Date(n.setDate(n.getDate()+2));const s=r.match(/^\+(\d+)$/);return s?new Date(n.setDate(n.getDate()+parseInt(s[1]))):null},A6=(t,e="zh")=>t?new Date(t).toLocaleDateString(e==="zh"?"zh-TW":"en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",mI=(t,e=!0,n="zh")=>{if(!t)return"";const r=new Date(t),s=new Date;s.setHours(0,0,0,0);const i=new Date(r.getTime());i.setHours(0,0,0,0);const o=Math.floor((i.getTime()-s.getTime())/(1e3*60*60*24));let a="";if(o===0?a=n==="zh"?"":"Today":o===1?a=n==="zh"?"":"Tomorrow":o===-1?a=n==="zh"?"":"Yesterday":o<0?a=n==="zh"?`${Math.abs(o)} `:`${Math.abs(o)}d ago`:a=n==="zh"?`${r.getMonth()+1}${r.getDate()}`:r.toLocaleDateString("en-US",{month:"short",day:"numeric"}),e){const l=r.getHours(),u=r.getMinutes();(l!==0||u!==0)&&(a+=` ${String(l).padStart(2,"0")}:${String(u).padStart(2,"0")}`)}return a},yi=(t,e)=>t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate(),_w=t=>t?yi(new Date(t),new Date):!1,Xx=t=>t?new Date(t).getTime()<new Date().setHours(0,0,0,0):!1,Tw=(t,e,n)=>{if(!t)return!1;const r=n.filter(s=>s.parent_id===t);for(const s of r)if(s.id===e||Tw(s.id,e,n))return!0;return!1},R6=t=>{if(!t)return[];const e=/data-type="mention"[^>]*data-id="([^"]+)"/g,n=[];let r;for(;(r=e.exec(t))!==null;)n.push(r[1]);return n},O6=(t,e)=>{var r;return(r=t.tags)!=null&&r.some(s=>e.includes(s))?!0:R6(t.description).some(s=>e.includes(s))},fp=(t,e)=>{let n=t,r=t.parent_id;const s=new Set([t.id]);for(;r&&!s.has(r);){s.add(r);const i=e.find(o=>o.id===r);if(i)n=i,r=i.parent_id;else break}return n},P6=(t,e)=>{const n=new Date(t),r=new Date(n);switch(e.type){case"daily":r.setDate(r.getDate()+e.interval);break;case"weekly":if(e.weekdays&&e.weekdays.length>0){let s=!1;for(let i=1;i<=7*e.interval;i++){const o=new Date(n);if(o.setDate(o.getDate()+i),e.weekdays.includes(o.getDay())){r.setTime(o.getTime()),s=!0;break}}s||r.setDate(r.getDate()+7*e.interval)}else r.setDate(r.getDate()+7*e.interval);break;case"monthly":if(r.setMonth(r.getMonth()+e.interval),e.monthDay){const s=Math.min(e.monthDay,a2(r));r.setDate(s)}break;case"yearly":if(r.setFullYear(r.getFullYear()+e.interval),e.yearMonth!==void 0&&e.yearDay!==void 0){r.setMonth(e.yearMonth-1);const s=Math.min(e.yearDay,a2(r));r.setDate(s)}break}if(e.endDate){const s=new Date(e.endDate);if(r>s)return null}return r.toISOString()},a2=t=>new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),L6=(t,e="zh")=>{if(t.originalText)return t.originalText;const n=t.interval;let r="";if(e==="zh")switch(t.type){case"daily":r=n===1?"":`${n}`;break;case"weekly":r=n===1?"":`${n}`;break;case"monthly":t.monthDay?r=n===1?`${t.monthDay}`:`${n}${t.monthDay}`:r=n===1?"":`${n}`;break;case"yearly":t.yearMonth&&t.yearDay?r=`${t.yearMonth}${t.yearDay}`:r=n===1?"":`${n}`;break}else switch(t.type){case"daily":r=n===1?"Every day":`Every ${n} days`;break;case"weekly":r=n===1?"Every week":`Every ${n} weeks`;break;case"monthly":t.monthDay?r=n===1?`Monthly on day ${t.monthDay}`:`Every ${n} months on day ${t.monthDay}`:r=n===1?"Every month":`Every ${n} months`;break;case"yearly":r=n===1?"Every year":`Every ${n} years`;break}if(t.endDate){const s=new Date(t.endDate).toLocaleDateString(e==="zh"?"zh-TW":"en-US");r+=e==="zh"?` (${s})`:` (until ${s})`}return r},gI=()=>new Promise((t,e)=>{var r;if((r=window.google)!=null&&r.accounts){t();return}document.querySelector('script[src="https://accounts.google.com/gsi/client"]');const n=document.createElement("script");n.src="https://accounts.google.com/gsi/client",n.async=!0,n.defer=!0,n.onload=()=>t(),n.onerror=e,document.body.appendChild(n)}),bl=async t=>{const e=await fetch("https://www.googleapis.com/calendar/v3/users/me/calendarList",{headers:{Authorization:`Bearer ${t}`}});if(!e.ok)throw new Error("Failed to fetch calendar list");return(await e.json()).items||[]},yI=async(t,e,n,r)=>{var u;const s=new Date(n).toISOString(),i=new Date(r),o=new URLSearchParams({timeMin:s,timeMax:i.toISOString(),singleEvents:"true",orderBy:"startTime",maxResults:"2500"}),a=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events?${o}`,{headers:{Authorization:`Bearer ${t}`}}),l=await a.json();if(!a.ok)throw new Error(((u=l.error)==null?void 0:u.message)||"Failed to fetch calendar events");return l.items||[]},Qx=async(t,e,n,r)=>{var o,a;let i=0;for(;i<3;){i++;const l=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events/${encodeURIComponent(n)}`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(l.ok)return;if(l.status===403||l.status===429){const f=(((o=(await l.clone().json().catch(()=>({}))).error)==null?void 0:o.message)||"").toLowerCase();if((f.includes("rate limit")||f.includes("quota")||l.status===429)&&i<3){const h=i*1500;console.warn(`[Google Sync] Rate Limit Hit. Retrying update in ${h}ms... (Attempt ${i}/3)`),await new Promise(p=>setTimeout(p,h));continue}}const u=await l.json();throw new Error(((a=u.error)==null?void 0:a.message)||"Failed to update Google event")}},ia=async(t,e,n)=>{var s;const r=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events/${encodeURIComponent(n)}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!r.ok){const i=await r.json();throw new Error(((s=i.error)==null?void 0:s.message)||"Failed to delete Google event")}},No=async(t,e,n)=>{var i;const r=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){const o=await r.json();throw new Error(((i=o.error)==null?void 0:i.message)||"Failed to create Google event")}return(await r.json()).id},xI=async(t,e,n)=>{let r={singleEvents:"true",maxResults:"2500"};const s=new Date,i=new Date;if(i.setFullYear(s.getFullYear()+2),n)r.syncToken=n;else{const u=new Date;u.setMonth(u.getMonth()-1),r.timeMin=u.toISOString(),r.timeMax=i.toISOString()}let o=[],a,l;try{do{const u=new URLSearchParams({...r,...l?{pageToken:l}:{}}),d=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events?${u}`,{headers:{Authorization:`Bearer ${t}`}});if(d.status===410)return{events:[],fullSyncRequired:!0};if(!d.ok)throw new Error("Sync Request Failed");const f=await d.json();if(f.items){const h=i.getTime(),p=f.items.filter(m=>m.recurringEventId?!1:m.start&&(m.start.dateTime||m.start.date)?new Date(m.start.dateTime||m.start.date).getTime()<h:!0);o.push(...p)}l=f.nextPageToken,a=f.nextSyncToken}while(l);return{events:o,nextSyncToken:a}}catch(u){throw console.error(u),u}},$6=Object.freeze(Object.defineProperty({__proto__:null,createGoogleEvent:No,deleteGoogleEvent:ia,fetchCalendarList:bl,fetchGoogleEvents:yI,fetchUpdatedGoogleEvents:xI,loadGoogleScript:gI,updateGoogleEvent:Qx},Symbol.toStringTag,{value:"Module"})),z6="v1.6.0",hp=28,bI=new Image;bI.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";const Kn={slate:{color:"#64748b",bg:"bg-slate-50",text:"text-slate-600",accent:"text-slate-600",badge:"bg-slate-100 text-slate-600 border-slate-200",border:"border-slate-500",ring:"focus-within:ring-slate-200",buttonRing:"focus:ring-slate-200 focus:border-slate-300",dot:"bg-slate-400",breadcrumb:"bg-slate-50 text-slate-600 hover:bg-slate-100",indicator:"bg-slate-500",ringColor:"ring-slate-400"},gray:{color:"#6b7280",bg:"bg-gray-50",text:"text-gray-600",accent:"text-gray-600",badge:"bg-gray-100 text-gray-600 border-gray-200",border:"border-gray-300",ring:"focus-within:ring-gray-200",buttonRing:"focus:ring-gray-200 focus:border-gray-300",dot:"bg-gray-400",breadcrumb:"bg-gray-50 text-gray-600 hover:bg-gray-100",indicator:"bg-gray-500",ringColor:"ring-gray-400"},zinc:{color:"#71717a",bg:"bg-zinc-50",text:"text-zinc-600",accent:"text-zinc-600",badge:"bg-zinc-100 text-zinc-600 border-zinc-200",border:"border-zinc-500",ring:"focus-within:ring-zinc-200",buttonRing:"focus:ring-zinc-200 focus:border-zinc-300",dot:"bg-zinc-400",breadcrumb:"bg-zinc-50 text-zinc-600 hover:bg-zinc-100",indicator:"bg-zinc-500",ringColor:"ring-zinc-400"},neutral:{color:"#737373",bg:"bg-neutral-50",text:"text-neutral-600",accent:"text-neutral-600",badge:"bg-neutral-100 text-neutral-600 border-neutral-200",border:"border-neutral-500",ring:"focus-within:ring-neutral-200",buttonRing:"focus:ring-neutral-200 focus:border-neutral-300",dot:"bg-neutral-400",breadcrumb:"bg-neutral-50 text-neutral-600 hover:bg-neutral-100",indicator:"bg-neutral-500",ringColor:"ring-neutral-400"},stone:{color:"#78716c",bg:"bg-stone-50",text:"text-stone-600",accent:"text-stone-600",badge:"bg-stone-100 text-stone-600 border-stone-200",border:"border-stone-500",ring:"focus-within:ring-stone-200",buttonRing:"focus:ring-stone-200 focus:border-stone-300",dot:"bg-stone-400",breadcrumb:"bg-stone-50 text-stone-600 hover:bg-stone-100",indicator:"bg-stone-500",ringColor:"ring-stone-400"},red:{color:"#ef4444",bg:"bg-red-50",text:"text-red-600",accent:"text-red-600",badge:"bg-red-100 text-red-600 border-red-200",border:"border-red-500",ring:"focus-within:ring-red-200",buttonRing:"focus:ring-red-200 focus:border-red-300",dot:"bg-red-400",breadcrumb:"bg-red-50 text-red-600 hover:bg-red-100",indicator:"bg-red-500",ringColor:"ring-red-400"},orange:{color:"#f97316",bg:"bg-orange-50",text:"text-orange-600",accent:"text-orange-600",badge:"bg-orange-100 text-orange-600 border-orange-200",border:"border-orange-500",ring:"focus-within:ring-orange-200",buttonRing:"focus:ring-orange-200 focus:border-orange-300",dot:"bg-orange-400",breadcrumb:"bg-orange-50 text-orange-600 hover:bg-orange-100",indicator:"bg-orange-500",ringColor:"ring-orange-400"},amber:{color:"#f59e0b",bg:"bg-amber-50",text:"text-amber-600",accent:"text-amber-600",badge:"bg-amber-100 text-amber-600 border-amber-200",border:"border-amber-500",ring:"focus-within:ring-amber-200",buttonRing:"focus:ring-amber-200 focus:border-amber-300",dot:"bg-amber-400",breadcrumb:"bg-amber-50 text-amber-600 hover:bg-amber-100",indicator:"bg-amber-500",ringColor:"ring-amber-400"},yellow:{color:"#eab308",bg:"bg-yellow-50",text:"text-yellow-600",accent:"text-yellow-600",badge:"bg-yellow-100 text-yellow-600 border-yellow-200",border:"border-yellow-500",ring:"focus-within:ring-yellow-200",buttonRing:"focus:ring-yellow-200 focus:border-yellow-300",dot:"bg-yellow-400",breadcrumb:"bg-yellow-50 text-yellow-600 hover:bg-yellow-100",indicator:"bg-yellow-500",ringColor:"ring-yellow-400"},lime:{color:"#84cc16",bg:"bg-lime-50",text:"text-lime-600",accent:"text-lime-600",badge:"bg-lime-100 text-lime-600 border-lime-200",border:"border-lime-500",ring:"focus-within:ring-lime-200",buttonRing:"focus:ring-lime-200 focus:border-lime-300",dot:"bg-lime-400",breadcrumb:"bg-lime-50 text-lime-600 hover:bg-lime-100",indicator:"bg-lime-500",ringColor:"ring-lime-400"},green:{color:"#10b981",bg:"bg-green-50",text:"text-green-600",accent:"text-green-600",badge:"bg-green-100 text-green-600 border-green-200",border:"border-green-500",ring:"focus-within:ring-green-200",buttonRing:"focus:ring-green-200 focus:border-green-300",dot:"bg-green-400",breadcrumb:"bg-green-50 text-green-600 hover:bg-green-100",indicator:"bg-green-500",ringColor:"ring-green-400"},emerald:{color:"#10b981",bg:"bg-emerald-50",text:"text-emerald-600",accent:"text-emerald-600",badge:"bg-emerald-100 text-emerald-600 border-emerald-200",border:"border-emerald-500",ring:"focus-within:ring-emerald-200",buttonRing:"focus:ring-emerald-200 focus:border-emerald-300",dot:"bg-emerald-400",breadcrumb:"bg-emerald-50 text-emerald-600 hover:bg-emerald-100",indicator:"bg-emerald-500",ringColor:"ring-emerald-400"},teal:{color:"#14b8a6",bg:"bg-teal-50",text:"text-teal-600",accent:"text-teal-600",badge:"bg-teal-100 text-teal-600 border-teal-200",border:"border-teal-500",ring:"focus-within:ring-teal-200",buttonRing:"focus:ring-teal-200 focus:border-teal-300",dot:"bg-teal-400",breadcrumb:"bg-teal-50 text-teal-600 hover:bg-teal-100",indicator:"bg-teal-500",ringColor:"ring-teal-400"},cyan:{color:"#06b6d4",bg:"bg-cyan-50",text:"text-cyan-600",accent:"text-cyan-600",badge:"bg-cyan-100 text-cyan-600 border-cyan-200",border:"border-cyan-500",ring:"focus-within:ring-cyan-200",buttonRing:"focus:ring-cyan-200 focus:border-cyan-300",dot:"bg-cyan-400",breadcrumb:"bg-cyan-50 text-cyan-600 hover:bg-cyan-100",indicator:"bg-cyan-500",ringColor:"ring-cyan-400"},sky:{color:"#0ea5e9",bg:"bg-sky-50",text:"text-sky-600",accent:"text-sky-600",badge:"bg-sky-100 text-sky-600 border-sky-200",border:"border-sky-500",ring:"focus-within:ring-sky-200",buttonRing:"focus:ring-sky-200 focus:border-sky-300",dot:"bg-sky-400",breadcrumb:"bg-sky-50 text-sky-600 hover:bg-sky-100",indicator:"bg-sky-500",ringColor:"ring-sky-400"},blue:{color:"#3b82f6",bg:"bg-blue-50",text:"text-blue-600",accent:"text-blue-600",badge:"bg-blue-100 text-blue-600 border-blue-200",border:"border-blue-500",ring:"focus-within:ring-blue-200",buttonRing:"focus:ring-blue-200 focus:border-blue-300",dot:"bg-blue-400",breadcrumb:"bg-blue-50 text-blue-600 hover:bg-blue-100",indicator:"bg-blue-500",ringColor:"ring-blue-400"},indigo:{color:"#6366f1",bg:"bg-indigo-50",text:"text-indigo-600",accent:"text-indigo-600",badge:"bg-indigo-100 text-indigo-600 border-indigo-200",border:"border-indigo-500",ring:"focus-within:ring-indigo-200",buttonRing:"focus:ring-indigo-200 focus:border-indigo-300",dot:"bg-indigo-400",breadcrumb:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100",indicator:"bg-indigo-500",ringColor:"ring-indigo-400"},violet:{color:"#8b5cf6",bg:"bg-violet-50",text:"text-violet-600",accent:"text-violet-600",badge:"bg-violet-100 text-violet-600 border-violet-200",border:"border-violet-500",ring:"focus-within:ring-violet-200",buttonRing:"focus:ring-violet-200 focus:border-violet-300",dot:"bg-violet-400",breadcrumb:"bg-violet-50 text-violet-600 hover:bg-violet-100",indicator:"bg-violet-500",ringColor:"ring-violet-400"},purple:{color:"#a855f7",bg:"bg-purple-50",text:"text-purple-600",accent:"text-purple-600",badge:"bg-purple-100 text-purple-600 border-purple-200",border:"border-purple-500",ring:"focus-within:ring-purple-200",buttonRing:"focus:ring-purple-200 focus:border-purple-300",dot:"bg-purple-400",breadcrumb:"bg-purple-50 text-purple-600 hover:bg-purple-100",indicator:"bg-purple-500",ringColor:"ring-purple-400"},fuchsia:{color:"#d946ef",bg:"bg-fuchsia-50",text:"text-fuchsia-600",accent:"text-fuchsia-600",badge:"bg-fuchsia-100 text-fuchsia-600 border-fuchsia-200",border:"border-fuchsia-500",ring:"focus-within:ring-fuchsia-200",buttonRing:"focus:ring-fuchsia-200 focus:border-fuchsia-300",dot:"bg-fuchsia-400",breadcrumb:"bg-fuchsia-50 text-fuchsia-600 hover:bg-fuchsia-100",indicator:"bg-fuchsia-500",ringColor:"ring-fuchsia-400"},pink:{color:"#ec4899",bg:"bg-pink-50",text:"text-pink-600",accent:"text-pink-600",badge:"bg-pink-100 text-pink-600 border-pink-200",border:"border-pink-500",ring:"focus-within:ring-pink-200",buttonRing:"focus:ring-pink-200 focus:border-pink-300",dot:"bg-pink-400",breadcrumb:"bg-pink-50 text-pink-600 hover:bg-pink-100",indicator:"bg-pink-500",ringColor:"ring-pink-400"},rose:{color:"#f43f5e",bg:"bg-rose-50",text:"text-rose-600",accent:"text-rose-600",badge:"bg-rose-100 text-rose-600 border-rose-200",border:"border-rose-500",ring:"focus-within:ring-rose-200",buttonRing:"focus:ring-rose-200 focus:border-rose-300",dot:"bg-rose-400",breadcrumb:"bg-rose-50 text-rose-600 hover:bg-rose-100",indicator:"bg-rose-500",ringColor:"ring-rose-400"}},F6={zh:{inbox:"",today:"",upcoming:"",anytime:"",someday:"",logbook:"",trash:"",tags:"",focus:"",journal:"",prompt:"",newTag:"",subTagPlaceholder:"...",tagStyle:"",selectTagColor:"",addSubTag:"",rename:"",deleteTagConfirm:"",deleteTag:"",settings:"",logout:"",emptyTrash:"",emptyTrashConfirm:"",trashEmptyTitle:"",restoreTrash:"",restoreTrashConfirm:"",putBack:"",delete:"",archive:"",notesPlaceholder:"...",addTagPlaceholder:"...",attachFiles:"",aiPolishSuggestions:"AI ",suggestedTitle:" ()",suggestedContent:" ()",aiPolishApplied:" AI ",confirmReplace:"",dateInputPlaceholder:": 5, , ...",identified:"",scheduleTitle:"",noSchedule:"",confirmDate:"",addNotePlaceholder:"...",from:"",addNewTag:"",presentationMode:"",editMode:"",linkAttachments:"",linkedTo:"",noParagraphs:"",clickToLink:"",paragraph:"",noAttachmentsLinked:"",save:"",cancel:"",share:"",aiPolish:"AI ",aiAssistant:"AI ",undo:"",redo:"",dismiss:"",permanentlyDeleted:"",restored:"",appearance:"",fontSize:"",fontWeight:"",fontFamily:"",language:"",timeFormat:"",calendarSettings:"",showLunar:"",showTaiwanHolidays:"",aiSettings:"AI ",provider:"",fontNormal:"",fontThin:"",sizeSmall:"",sizeNormal:"",sizeLarge:"",fontSystem:"",fontThings:"",theme:""},en:{inbox:"Inbox",today:"Today",upcoming:"Upcoming",anytime:"Anytime",someday:"Inspiration",logbook:"Logbook",trash:"Trash",tags:"Tags",focus:"Focus",journal:"Note",prompt:"Prompt",newTag:"New Tag",subTagPlaceholder:"Subtag name...",tagStyle:"Tag Style",selectTagColor:"Select tag color",addSubTag:"Add Subtag",rename:"Rename",deleteTagConfirm:"Are you sure you want to delete this tag?",deleteTag:"Delete Tag",settings:"Settings",logout:"Logout",emptyTrash:"Empty Trash",emptyTrashConfirm:"Are you sure you want to permanently delete all items in the trash? This action is irreversible.",trashEmptyTitle:"Trash",restoreTrash:"Restore All",restoreTrashConfirm:"Are you sure you want to restore all items in the trash?",putBack:"Put Back",delete:"Delete",archive:"Archive",notesPlaceholder:"Notes...",addTagPlaceholder:"Add tag...",attachFiles:"Files",aiPolishSuggestions:"AI Polish Suggestions",suggestedTitle:"Suggested Title (Editable)",suggestedContent:"Suggested Content (Editable)",aiPolishApplied:"AI polish applied",confirmReplace:"Confirm Replace",dateInputPlaceholder:"Type: 5, tomorrow, next Fri...",identified:"Identified",scheduleTitle:"Schedule",noSchedule:"No tasks scheduled",confirmDate:"Confirm Date",addNotePlaceholder:"Add a note...",from:"From",addNewTag:"Add",presentationMode:"Presentation Mode",editMode:"Edit Mode",linkAttachments:"Link Attachments",linkedTo:"Linked to",noParagraphs:"No paragraphs yet",clickToLink:"Click to link attachments",paragraph:"Paragraph",noAttachmentsLinked:"No attachments linked",save:"Save",cancel:"Cancel",share:"Share",aiPolish:"AI Polish",aiAssistant:"AI Assistant",undo:"Undo",redo:"Redo",dismiss:"Dismiss",permanentlyDeleted:"Permanently deleted",restored:"Restored",appearance:"Appearance",fontSize:"Font Size",fontWeight:"Font Weight",fontFamily:"Font Family",language:"Language",timeFormat:"Time Format",calendarSettings:"Calendar Settings",showLunar:"Show Lunar",showTaiwanHolidays:"Show Holidays",aiSettings:"AI Settings",provider:"Provider",fontNormal:"Normal",fontThin:"Thin",sizeSmall:"Small",sizeNormal:"Normal",sizeLarge:"Large",fontSystem:"Default",fontThings:"Thin",theme:"Theme"}},ll=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),Tn=b.createContext({}),B6=({children:t})=>{const[e,n]=b.useState(null),[r,s]=b.useState([]),[i,o]=b.useState([]),[a,l]=b.useState([]),[u,d]=b.useState(!0),[f,h]=b.useState(null),[p,m]=b.useState("synced"),[y,x]=b.useState(null),[g,v]=b.useState([]),[w,T]=b.useState(null),[D,k]=b.useState(null),[I,C]=b.useState(null),[S,_]=b.useState([]),N=$=>{if(typeof $=="function")C(z=>{const L=$(z);if(L===null)return null;const V=G.current.find(U=>U.id===L);return V!=null&&V.is_locked&&!S.includes(L)?(console.warn("Blocked editing locked task:",L),z):L});else{if($===null){C(null);return}const z=G.current.find(L=>L.id===$);if(z!=null&&z.is_locked&&!S.includes($)){console.warn("Blocked editing locked task:",$);return}C($)}},j=I,O=$=>{_(z=>[...z,$]),setTimeout(()=>{_(z=>z.filter(L=>L!==$))},3e4)},[P,W]=b.useState(()=>{const $=localStorage.getItem(`expanded_tasks_${e==null?void 0:e.id}`);return $?JSON.parse($):[]}),[R,M]=b.useState({}),[X,Q]=b.useState([]),[A,Te]=b.useState(!1),[we,B]=b.useState(!1),[F,ne]=b.useState(()=>{const $=localStorage.getItem("locked_google_tag_ids");return $?JSON.parse($):[]}),We=b.useCallback($=>{ne(z=>{const V=z.includes($)?z.filter(U=>U!==$):[...z,$];return localStorage.setItem("locked_google_tag_ids",JSON.stringify(V)),V})},[]),ft=b.useCallback($=>{if(!$.tags||$.tags.length===0)return!1;for(const z of $.tags)if(F.includes(z)){const L=a.find(V=>V.id===z);if(L&&L.name.startsWith("Google:"))return!0}return!1},[F,a]);b.useEffect(()=>{const $=localStorage.getItem("viewTagFilters");if($)try{const z=JSON.parse($),L={};Object.keys(z).forEach(V=>{Array.isArray(z[V])?L[V]={include:z[V],exclude:[]}:L[V]=z[V]}),M(L)}catch(z){console.error("Failed to parse viewTagFilters",z)}},[]);const le=($,z)=>{M(L=>{const V={...L,[$]:z};return localStorage.setItem("viewTagFilters",JSON.stringify(V)),V})},De=b.useMemo(()=>{const $={},z=L=>{if($[L])return $[L];const V=a.find(U=>U.id===L);return V?V.parent_id?V.color==="#6366f1"||!V.color?($[L]=z(V.parent_id),$[L]):($[L]=V.color,$[L]):($[L]=V.color||"#6366f1",$[L]):"#6366f1"};return a.forEach(L=>z(L.id)),$},[a]),[ie,Fe]=b.useState(()=>localStorage.getItem(`last_view_${e==null?void 0:e.id}`)||"inbox"),[_e,tt]=b.useState(null),[Xe,Ve]=b.useState([]),it=b.useRef([]);it.current=Xe;const[Ue,K]=b.useState({additionalTags:[],startDate:null,dueDate:null,color:null}),[ue,re]=b.useState(()=>{const $=localStorage.getItem(`theme_settings_${e==null?void 0:e.id}`),z={fontWeight:"thin",fontSize:"normal",fontFamily:"system",timeFormat:"24h",showLunar:!1,showTaiwanHolidays:!1,language:"zh"};return $?{...z,...JSON.parse($)}:z}),oe=ue.language||"zh",pe=$=>{re(z=>({...z,language:$}))};b.useEffect(()=>{ue.themeMode&&ue.themeMode!=="light"?document.documentElement.setAttribute("data-theme",ue.themeMode):document.documentElement.removeAttribute("data-theme")},[ue.themeMode]),b.useEffect(()=>{const $=ue.fontFamily||"system";document.documentElement.setAttribute("data-font",$)},[ue.fontFamily]);const se=b.useCallback($=>F6[oe][$]||$,[oe]),[Se,Pe]=b.useState(null),[ye,ze]=b.useState(null),[Ze,gt]=b.useState(()=>{const $=localStorage.getItem(`calendar_current_date_${e==null?void 0:e.id}`);return $?new Date($):new Date}),[vt,me]=b.useState(()=>parseInt(localStorage.getItem(`sidebar_width_${e==null?void 0:e.id}`)||"260")),[He,qe]=b.useState(()=>localStorage.getItem(`sidebar_collapsed_${e==null?void 0:e.id}`)==="true"),[nt,Me]=b.useState(()=>parseInt(localStorage.getItem(`focus_split_width_${e==null?void 0:e.id}`)||"400")),[ut,ee]=b.useState(!1);b.useEffect(()=>{e!=null&&e.id&&localStorage.setItem(`sidebar_collapsed_${e.id}`,He.toString())},[He]),b.useEffect(()=>{ie==="focus"&&(v([]),k(null))},[ie]),b.useEffect(()=>{const $=V=>{const U=/Mac|iPod|iPhone|iPad/.test(navigator.userAgent);(V.ctrlKey||V.metaKey&&!U)&&ee(!0)},z=V=>{const U=/Mac|iPod|iPhone|iPad/.test(navigator.userAgent);!V.ctrlKey&&!(V.metaKey&&!U)&&ee(!1)},L=()=>ee(!1);return window.addEventListener("keydown",$),window.addEventListener("keyup",z),window.addEventListener("blur",L),()=>{window.removeEventListener("keydown",$),window.removeEventListener("keyup",z),window.removeEventListener("blur",L)}},[]),b.useEffect(()=>{e!=null&&e.id&&localStorage.setItem(`calendar_current_date_${e.id}`,Ze.toISOString())},[Ze]),b.useEffect(()=>{if(e!=null&&e.id){const $=localStorage.getItem(`focus_split_width_${e.id}`);$&&Me(parseInt($))}},[e==null?void 0:e.id]),b.useEffect(()=>{e!=null&&e.id&&localStorage.setItem(`focus_split_width_${e.id}`,nt.toString())},[nt,e==null?void 0:e.id]),b.useEffect(()=>{e&&console.warn("[AppContext] Current User ID:",e.id,"Email:",e.email)},[e]);const fe=b.useMemo(()=>{const $={};return r.forEach(z=>{if(z.status==="deleted"||z.status==="logged")return;const L=z.start_date||z.due_date;if(L){const V=L.split("T")[0];$[V]=($[V]||0)+1}}),$},[r]),[q,Z]=b.useState(()=>{const $=localStorage.getItem(`expanded_tags_${e==null?void 0:e.id}`);return $?JSON.parse($):[]}),[ge,xe]=b.useState([]),[be,ve]=b.useState([]),[ot,et]=b.useState([]),G=b.useRef([]),[ae,Ae]=b.useState({isDragging:!1,draggedId:null,originalDepth:0,dragOffsetX:0,dropIndex:null,dropDepth:0,indicatorTop:0,indicatorLeft:0,indicatorWidth:0,ghostPosition:{x:0,y:0},anchorTaskIndex:null}),Y=b.useRef({}),Ie=b.useRef(null),Le=b.useRef(null);b.useEffect(()=>{if(!je){h("Supabase client not initialized"),d(!1);return}(async()=>{try{let L=localStorage.getItem("gtd_user_id");(!L||!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(L))&&(console.warn("Invalid or missing User ID, resetting to default."),L="00000000-0000-0000-0000-000000000000",localStorage.setItem("gtd_user_id",L));let U;if(je){const{data:{session:J},error:he}=await je.auth.getSession();if(he)throw he;U=(J==null?void 0:J.user)||{id:L},n(U)}else U={id:L},n(U);if(U!=null&&U.id){const J=localStorage.getItem(`expanded_tasks_${U.id}`);J&&W(JSON.parse(J));const he=localStorage.getItem(`last_view_${U.id}`);he&&Fe(he);const Oe=localStorage.getItem(`sidebar_width_${U.id}`);Oe&&me(parseInt(Oe));const Ke=localStorage.getItem(`expanded_tags_${U.id}`);Ke&&Z(JSON.parse(Ke));const Qe=localStorage.getItem(`theme_settings_${U.id}`);Qe&&re(JSON.parse(Qe))}}catch(L){console.error("Initialization error:",L),h(L.message||"Failed to initialize app"),d(!1)}})();const{data:z}=(je==null?void 0:je.auth.onAuthStateChange(async(L,V)=>{L==="SIGNED_IN"?n(V==null?void 0:V.user):L==="SIGNED_OUT"&&n(null)}))||{data:{subscription:{unsubscribe:()=>{}}}};return()=>{z.subscription.unsubscribe()}},[]),b.useEffect(()=>{G.current=r},[r]),b.useEffect(()=>{if(!e||!je)return;(async()=>{try{if(je){let V=[],U=0;const J=1e3;let he=!0;for(;he;){const{data:Ne,error:Be}=await je.from("tasks").select("*").eq("user_id",e.id).order("order_index",{ascending:!0}).order("created_at",{ascending:!0}).range(U,U+J-1);if(Be){console.error("[Debug] Fetch Error:",Be);break}Ne&&Ne.length>0?(V=[...V,...Ne],Ne.length<J?he=!1:U+=J):he=!1}const Oe=V,{data:Ke,error:Qe}=await je.from("tags").select("*").eq("user_id",e.id);Qe&&console.error("Tags fetch error:",Qe);const at=(Ke||[]).sort((Ne,Be)=>(Ne.order_index||0)-(Be.order_index||0));if(l(at||[]),Oe){const Ne=Oe.map(Be=>({...Be,parent_id:Be.parent_id||null,tags:Be.tags||[],images:Be.images||[],attachments:Be.attachments||[],attachment_links:Be.attachment_links||[],view_orders:Be.view_orders||{}}));s(Ne),G.current=Ne}const{data:xt,error:lt}=await je.from("archived_tasks").select("*").eq("user_id",e.id).order("archived_at",{ascending:!1});if(lt)console.warn("Failed to fetch archived tasks (table may not exist yet):",lt);else if(xt){const Ne=xt.map(Be=>({...Be,parent_id:Be.parent_id||null,original_parent_id:Be.original_parent_id||null,tags:Be.tags||[],images:Be.images||[],attachments:Be.attachments||[],view_orders:Be.view_orders||{},is_all_day:!0,start_time:null,end_time:null,duration:null}));o(Ne)}const{data:mt,error:Ye}=await je.from("search_history").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(50);Ye?console.warn("Failed to fetch search history (table may not exist yet):",Ye):mt&&Q(mt)}}catch(V){console.error("Error fetching data:",V)}finally{d(!1)}})();const z=je.channel("tasks_changes").on("postgres_changes",{event:"*",schema:"public",table:"tasks",filter:`user_id=eq.${e.id}`},V=>{if(!(V.new&&Y.current[V.new.id]&&Date.now()-Y.current[V.new.id]<2e3))if(V.eventType==="INSERT"){const U={...V.new,parent_id:V.new.parent_id||null,tags:V.new.tags||[],images:V.new.images||[],attachments:V.new.attachments||[],attachment_links:V.new.attachment_links||[],view_orders:V.new.view_orders||{}};s(J=>{if(J.some(Oe=>Oe.id===U.id))return J;const he=[U,...J].sort((Oe,Ke)=>(Oe.order_index||0)-(Ke.order_index||0)||Oe.created_at.localeCompare(Ke.created_at));return G.current=he,he})}else if(V.eventType==="UPDATE"){const U={...V.new,tags:V.new.tags||[],images:V.new.images||[],attachments:V.new.attachments||[],attachment_links:V.new.attachment_links||[],view_orders:V.new.view_orders||{}};s(J=>{const he=J.map(Oe=>Oe.id===U.id?U:Oe).sort((Oe,Ke)=>(Oe.order_index||0)-(Ke.order_index||0)||Oe.created_at.localeCompare(Ke.created_at));return G.current=he,he})}else V.eventType==="DELETE"&&s(U=>{const J=U.filter(he=>he.id!==V.old.id);return G.current=J,J})}).subscribe(),L=je.channel("tags_changes").on("postgres_changes",{event:"*",schema:"public",table:"tags",filter:`user_id=eq.${e.id}`},V=>{V.eventType==="INSERT"?l(U=>U.some(J=>J.id===V.new.id)?U:[...U,V.new]):V.eventType==="DELETE"&&l(U=>U.filter(J=>J.id!==V.old.id))}).subscribe();return()=>{z.unsubscribe(),L.unsubscribe()}},[e]);const ct=$=>{console.error($),m("error"),x({msg:`Sync Failed: ${$.message||"Unknown error"}`,type:"error"})},Rt=$=>{Y.current[$]=Date.now()};b.useEffect(()=>{if(!e||!je)return;const $=async z=>{const L=z.detail;if(!L||!L.taskId||!L.file)return;const V=L.taskId,U=L.file,J=L.markers||[],he=L.recordingId,Oe=G.current.find(Ke=>Ke.id===V);if(!Oe){console.warn("[AppContext] Task not found for recording:",V),x({msg:"",type:"error"});return}try{const Ke=`${Date.now()}_${ll()}.${U.name.split(".").pop()}`,at=`${(e==null?void 0:e.id)||"anonymous"}/${Ke}`,{error:xt}=await je.storage.from("attachments").upload(at,U,{contentType:U.type,upsert:!1});if(xt){console.error("Upload voice error:",xt),x({msg:"",type:"error"});return}const{data:lt}=je.storage.from("attachments").getPublicUrl(at);if(lt){const mt={name:U.name,url:lt.publicUrl,size:U.size,type:U.type,markers:J,recordingId:he},Ne=[...Oe.attachments||[],mt];Rt(V),s(ke=>{const Re=ke.map(Ge=>Ge.id===V?{...Ge,attachments:Ne}:Ge);return G.current=Re,Re});const{error:Be}=await je.from("tasks").update({attachments:Ne}).eq("id",V);if(Be)console.error("Failed to update task attachments:",Be),x({msg:"",type:"error"});else{window.dispatchEvent(new CustomEvent("recording-saved",{detail:{taskId:V,attachment:mt}}));const ke=V;x({msg:"",type:"info",onClick:()=>{window.dispatchEvent(new CustomEvent("navigate-to-task",{detail:{taskId:ke,openForEdit:!0}}))},actionLabel:""})}}}catch(Ke){console.error("[AppContext] Error saving recording:",Ke),x({msg:"",type:"error"})}};return window.addEventListener("audio-recording-completed",$),()=>window.removeEventListener("audio-recording-completed",$)},[e]);const Cn=async $=>{const z=new Date,L=[];for(let he=1;he<=10;he++){const Oe=new Date(z);Oe.setDate(z.getDate()+he),Oe.setHours(0,0,0,0);const Ke=r.filter(Qe=>{if(!Qe.start_date)return!1;const at=new Date(Qe.start_date);return yi(at,Oe)&&!Qe.completed_at}).length;L.push({date:Oe,count:Ke})}const V=Math.min(...L.map(he=>he.count)),U=L.filter(he=>he.count===V),J=U[Math.floor(Math.random()*U.length)];await Pr($,{start_date:J.date.toISOString()}),x({msg:` ${J.date.getMonth()+1}/${J.date.getDate()} (: ${J.count})`,type:"info"})},Ot=$=>{const z=[$],L=V=>{r.filter(J=>J.parent_id===V).forEach(J=>{z.push(J.id),L(J.id)})};return L($),z},nn=async($,z)=>{if(!je)return;const L=Ot($);s(U=>{const J=U.map(he=>he.id===$?{...he,is_locked:!0,lock_password:z}:L.includes(he.id)?{...he,is_locked:!0,lock_password:void 0}:he);return G.current=J,J}),await je.from("tasks").update({is_locked:!0,lock_password:z}).eq("id",$);const V=L.filter(U=>U!==$);if(V.length>0)for(const U of V)await je.from("tasks").update({is_locked:!0,lock_password:null}).eq("id",U);x({msg:` ${L.length-1} `,type:"info"})},cn=async($,z)=>{if(!je)return!1;const L=r.find(he=>he.id===$);if(!L||!L.is_locked)return!0;let V=L,U=L;for(;U.parent_id;){const he=r.find(Oe=>Oe.id===U.parent_id);if(he&&he.is_locked&&he.lock_password&&(V=he),!he)break;U=he}if(V.lock_password!==z)return x({msg:"",type:"error"}),!1;const J=Ot($);s(he=>{const Oe=he.map(Ke=>J.includes(Ke.id)?{...Ke,is_locked:!1,lock_password:void 0}:Ke);return G.current=Oe,Oe});for(const he of J)await je.from("tasks").update({is_locked:!1,lock_password:null}).eq("id",he);return x({msg:"",type:"info"}),!0},Ee=($,z)=>{const L=r.find(J=>J.id===$);if(!L||!L.is_locked)return!0;let V=L,U=L;for(;U.parent_id;){const J=r.find(he=>he.id===U.parent_id);if(J&&J.is_locked&&J.lock_password&&(V=J),!J)break;U=J}return V.lock_password===z},Tt=async()=>{const $=r.filter(V=>!!V.completed_at&&V.status!=="logged"&&V.status!=="deleted");if($.length===0)return;const z=$.map(V=>V.id),L=$.map(V=>({...V,status:"logged",original_parent_id:V.parent_id,archived_at:new Date().toISOString()}));if(s(V=>{const U=V.filter(J=>!z.includes(J.id));return G.current=U,U}),o(V=>[...V,...L]),je){const{error:V}=await je.from("archived_tasks").insert(L.map(J=>({id:J.id,user_id:J.user_id,title:J.title,description:J.description,status:J.status,original_parent_id:J.original_parent_id,parent_id:J.parent_id,is_project:J.is_project,order_index:J.order_index,view_orders:J.view_orders,tags:J.tags,color:J.color,start_date:J.start_date,due_date:J.due_date,completed_at:J.completed_at,reviewed_at:J.reviewed_at,images:J.images,attachments:J.attachments,created_at:J.created_at,archived_at:J.archived_at})));if(V){ct(V);return}const{error:U}=await je.from("tasks").delete().in("id",z);U&&ct(U)}Pn({type:"ARCHIVE",payload:{originalTasks:$,archivedRecords:L}}),x({msg:` ${z.length} `,type:"info",undo:Jn})},Ft=async $=>{const z=i.find(U=>U.id===$);if(!z)return;let L=z.original_parent_id;L&&(r.find(J=>J.id===L)||(L=null));const V={id:z.id,user_id:z.user_id,title:z.title,description:z.description,status:"completed",parent_id:L,is_project:z.is_project,order_index:z.order_index,view_orders:z.view_orders,tags:z.tags,color:z.color,start_date:z.start_date,due_date:z.due_date,completed_at:z.completed_at,reviewed_at:z.reviewed_at,images:z.images,attachments:z.attachments,created_at:z.created_at,is_all_day:!0,start_time:null,end_time:null,duration:null};if(o(U=>U.filter(J=>J.id!==$)),s(U=>{const J=[...U,V];return G.current=J,J}),je){const{error:U}=await je.from("tasks").insert({id:V.id,user_id:V.user_id,title:V.title,description:V.description,status:V.status,parent_id:V.parent_id,is_project:V.is_project,order_index:V.order_index,view_orders:V.view_orders,tags:V.tags,color:V.color,start_date:V.start_date,due_date:V.due_date,completed_at:V.completed_at,reviewed_at:V.reviewed_at,images:V.images,created_at:V.created_at});if(U){ct(U);return}const{error:J}=await je.from("archived_tasks").delete().eq("id",$);J&&ct(J)}x({msg:"",type:"info"})},Lt=async $=>{if(i.find(L=>L.id===$)){if(o(L=>L.filter(V=>V.id!==$)),je){const{error:L}=await je.from("archived_tasks").delete().eq("id",$);L&&ct(L)}x({msg:"",type:"info"})}},Wt=async($,z)=>{const L=i.find(U=>U.id===$);if(!L)return;const V={...L,...z};if(o(U=>U.map(J=>J.id===$?V:J)),je){const{error:U}=await je.from("archived_tasks").update(z).eq("id",$);U&&ct(U)}},un=async $=>{if($.length!==0){if(o(z=>z.filter(L=>!$.includes(L.id))),je){const{error:z}=await je.from("archived_tasks").delete().in("id",$);z&&ct(z)}x({msg:` ${$.length} `,type:"info"})}},rr=async($,z,L)=>{if(!je||!e)return;const V={id:ll(),user_id:e.id,query:$,filters:z,name:L||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};Q(J=>[V,...J].slice(0,50));const{error:U}=await je.from("search_history").insert({id:V.id,user_id:V.user_id,query:V.query,filters:V.filters,name:V.name,created_at:V.created_at,updated_at:V.updated_at});U&&console.warn("Failed to save search history:",U)},ys=async $=>{if(!je)return;Q(L=>L.filter(V=>V.id!==$));const{error:z}=await je.from("search_history").delete().eq("id",$);z&&console.warn("Failed to delete search history:",z)},wn=async()=>{yn(),m("syncing");const $=[...r];if(s([]),G.current=[],xe([]),ve([]),je){const{error:z}=await je.from("tasks").delete().neq("id","00000000-0000-0000-0000-000000000000");if(z){ct(z),s($);return}}m("synced"),x({msg:"",type:"info"})},yn=()=>{const $={tasks:r,tags:a,user_id:e.id,version:1,exported_at:new Date().toISOString()},z=new Blob([JSON.stringify($,null,2)],{type:"application/json"}),L=URL.createObjectURL(z),V=document.createElement("a");V.href=L,V.download=`things-clone-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(V),V.click(),document.body.removeChild(V),URL.revokeObjectURL(L),x({msg:"",type:"info"})},Er=async $=>{if(!je)return;const z=new FileReader;z.onload=async L=>{var V;try{const U=(V=L.target)==null?void 0:V.result,J=JSON.parse(U);if(!J.tasks||!J.tags)throw new Error("");if(m("syncing"),J.tags.length>0){const{error:he}=await je.from("tags").upsert(J.tags.map(Oe=>({...Oe,user_id:e.id})));if(he)throw he}if(J.tasks.length>0){const{error:he}=await je.from("tasks").upsert(J.tasks.map(Oe=>({...Oe,user_id:e.id})));if(he)throw he}x({msg:"...",type:"info"}),setTimeout(()=>window.location.reload(),1e3)}catch(U){ct(U)}},z.readAsText($)},Pn=$=>{xe(z=>[...z,$]),ve([])},Jn=async()=>{if(ge.length===0)return;const $=ge[ge.length-1];if(xe(ge.slice(0,-1)),ve(z=>[...z,$]),$.type==="ADD"){const z=$.payload.data.id;Rt(z),s(L=>L.filter(V=>V.id!==z)),je&&await je.from("tasks").delete().eq("id",z)}else if($.type==="DELETE"){const z=$.payload.data;Rt(z.id),s(L=>[...L,z].sort((V,U)=>(V.order_index||0)-(U.order_index||0)||V.created_at.localeCompare(U.created_at))),je&&await je.from("tasks").insert([z])}else if($.type==="UPDATE"){const{id:z,before:L}=$.payload;await Pr(z,L,[],{skipHistory:!0})}else if($.type==="BATCH_UPDATE"){const L=$.payload.map(V=>({id:V.id,data:V.before}));await Un(L,{skipHistory:!0})}else if($.type==="ADD_TAG"){const z=$.payload.data.id;l(L=>L.filter(V=>V.id!==z)),je&&await je.from("tags").delete().eq("id",z)}else if($.type==="DELETE_TAG"){const z=$.payload.data;l(L=>[...L,z].sort((V,U)=>(V.order_index||0)-(U.order_index||0))),je&&await je.from("tags").insert([z])}else if($.type==="UPDATE_TAG"){const{id:z,before:L}=$.payload;l(V=>V.map(U=>U.id===z?{...U,...L}:U).sort((U,J)=>(U.order_index||0)-(J.order_index||0))),je&&await je.from("tags").update(L).eq("id",z)}else if($.type==="ARCHIVE"){const{originalTasks:z,archivedRecords:L}=$.payload,V=L.map(U=>U.id);o(U=>U.filter(J=>!V.includes(J.id))),s(U=>{const J=[...U,...z].sort((he,Oe)=>(he.order_index||0)-(Oe.order_index||0)||he.created_at.localeCompare(Oe.created_at));return G.current=J,J}),je&&(await je.from("archived_tasks").delete().in("id",V),await je.from("tasks").insert(z))}else if($.type==="BATCH_DELETE"){const z=$.payload.data;s(L=>[...L,...z].sort((V,U)=>(V.order_index||0)-(U.order_index||0)||V.created_at.localeCompare(U.created_at))),je&&await je.from("tasks").insert(z)}x({msg:"",type:"info"})},Nn=async()=>{if(be.length===0)return;const $=be[be.length-1];if(ve(be.slice(0,-1)),xe(z=>[...z,$]),$.type==="ADD"){const z=$.payload.data;Rt(z.id),s(L=>[...L,z].sort((V,U)=>(V.order_index||0)-(U.order_index||0)||V.created_at.localeCompare(U.created_at))),je&&await je.from("tasks").insert([z])}else if($.type==="DELETE"){const z=$.payload.data.id;Rt(z),s(L=>L.filter(V=>V.id!==z)),je&&await je.from("tasks").delete().eq("id",z)}else if($.type==="UPDATE"){const{id:z,after:L}=$.payload;await Pr(z,L,[],{skipHistory:!0})}else if($.type==="BATCH_UPDATE"){const L=$.payload.map(V=>({id:V.id,data:V.after}));await Un(L,{skipHistory:!0})}else if($.type==="ADD_TAG"){const z=$.payload.data;l(L=>[...L,z].sort((V,U)=>(V.order_index||0)-(U.order_index||0))),je&&await je.from("tags").insert([z])}else if($.type==="DELETE_TAG"){const z=$.payload.data.id;l(L=>L.filter(V=>V.id!==z)),je&&await je.from("tags").delete().eq("id",z)}else if($.type==="UPDATE_TAG"){const{id:z,after:L}=$.payload;l(V=>V.map(U=>U.id===z?{...U,...L}:U).sort((U,J)=>(U.order_index||0)-(J.order_index||0))),je&&await je.from("tags").update(L).eq("id",z)}else if($.type==="ARCHIVE"){const{originalTasks:z,archivedRecords:L}=$.payload,V=z.map(U=>U.id);s(U=>{const J=U.filter(he=>!V.includes(he.id));return G.current=J,J}),o(U=>[...U,...L]),je&&(await je.from("archived_tasks").insert(L.map(U=>({id:U.id,user_id:U.user_id,title:U.title,description:U.description,status:U.status,original_parent_id:U.original_parent_id,parent_id:U.parent_id,is_project:U.is_project,order_index:U.order_index,view_orders:U.view_orders,tags:U.tags,color:U.color,start_date:U.start_date,due_date:U.due_date,completed_at:U.completed_at,reviewed_at:U.reviewed_at,images:U.images,attachments:U.attachments,created_at:U.created_at,archived_at:U.archived_at}))),await je.from("tasks").delete().in("id",V))}else if($.type==="BATCH_DELETE"){const L=$.payload.data.map(V=>V.id);s(V=>V.filter(U=>!L.includes(U.id))),je&&await je.from("tasks").delete().in("id",L)}x({msg:"",type:"info"})},Or=async()=>{if(!je)return;const{error:$}=await je.auth.signOut();$?ct($):x({msg:"",type:"info"})};b.useEffect(()=>{const $=z=>{j||(z.metaKey||z.ctrlKey)&&z.key==="z"&&(z.preventDefault(),z.shiftKey?Nn():Jn())};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)},[ge,be,r,j]);const Ni=($,z=!1,L)=>{const V=r.find(mt=>mt.id===$);if(!V)return;const U=mt=>a.find(Ye=>mt.some(Ne=>Ye.name.trim().toLowerCase()===Ne.toLowerCase())),J=U(["note","journal","",""]),he=U(["prompt",""]),Oe=J,Ke=U(["someday","inspiration","","/"]),Qe=U(["project",""]),at=U(["schedule",""]);let xt=L||"inbox";L||(J&&V.tags.includes(J.id)?xt="journal":he&&V.tags.includes(he.id)?xt="prompt":Oe&&V.tags.includes(Oe.id)?xt="journal":Ke&&V.tags.includes(Ke.id)?xt="waiting":Qe&&V.tags.includes(Qe.id)?r.some(Ye=>Ye.parent_id===$&&Ye.status!=="deleted")&&(xt="projects"):at&&V.tags.includes(at.id)?xt="focus":(V.start_date||V.due_date)&&(xt="today")),et(mt=>[...mt,{view:ie,focusedId:D,editingId:j,searchOpen:A}]),Fe(xt),k($);let lt=r.find(mt=>mt.id===$);for(;lt&&lt.parent_id;)P.includes(lt.parent_id)||Zt(lt.parent_id,!0),lt=r.find(mt=>mt.id===(lt==null?void 0:lt.parent_id));z&&setTimeout(()=>N($),100)},tl=()=>{if(ot.length===0)return;const $=ot[ot.length-1];et(L=>L.slice(0,-1)),Fe($.view),k($.focusedId);const z=$.editingId||$.focusedId;z&&setTimeout(()=>N(z),150),$.searchOpen!==void 0&&Te($.searchOpen)};b.useEffect(()=>{const $=z=>{const L=z.detail;L!=null&&L.taskId&&Ni(L.taskId,L.openForEdit||!1)};return window.addEventListener("navigate-to-task",$),()=>window.removeEventListener("navigate-to-task",$)},[r,a,ie,D,P]);const Qo=b.useCallback(($,z,L,V,U,J)=>{var bt;if(ue.showImportedGoogleEvents===!1){const Je=a.filter(te=>te.name.startsWith("Google:")).map(te=>te.id);Je.length>0&&($=$.filter(te=>!te.tags.some($e=>Je.includes($e))))}const he=Je=>{var te;return(te=a.find($e=>Je.some(rt=>$e.name.trim().toLowerCase()===rt.toLowerCase())))==null?void 0:te.id},Oe=he(["prompt",""]),Ke=he(["journal","note","",""]),Qe=he(["someday","inspiration","","/"]),at=he(["project",""]),xt=(bt=a.find(Je=>Je.name==="#prompt"))==null?void 0:bt.id,lt=he(["schedule",""]),mt=he(["annual","annualplan","",""]);if(z==="schedule")return $.filter(Je=>(!!Je.due_date||!!Je.start_date)&&Je.status!=="deleted"&&Je.status!=="logged").sort((Je,te)=>{const $e=new Date(Je.start_date||Je.due_date||0).getTime(),rt=new Date(te.start_date||te.due_date||0).getTime();return $e-rt}).map((Je,te)=>({data:Je,depth:0,hasChildren:!1,isExpanded:!1,path:[],index:te}));if(z==="recent")return $.filter(Je=>Je.status!=="deleted").sort((Je,te)=>{const $e=new Date(Je.updated_at||Je.created_at||0).getTime();return new Date(te.updated_at||te.created_at||0).getTime()-$e}).slice(0,100).map((Je,te)=>({data:Je,depth:0,hasChildren:!1,isExpanded:!1,path:[],index:te}));const Ne=(()=>{if(L){const Je=$e=>{const rt=a.filter(st=>st.parent_id===$e);return[$e,...rt.flatMap(st=>Je(st.id))]},te=Je(L);return $e=>{if(!O6($e,te))return!1;const rt=J[L]||{include:[],exclude:[]},{include:st,exclude:yt}=Array.isArray(rt)?{include:rt,exclude:[]}:rt;return st.length>0&&!$e.tags.some(It=>st.includes(It))||yt.length>0&&$e.tags.some(It=>yt.includes(It))||U.additionalTags.length>0&&!U.additionalTags.every(It=>{var Dt;return(Dt=$e.tags)==null?void 0:Dt.includes(It)})||U.color&&$e.color!==U.color||U.startDate&&(!$e.start_date||new Date($e.start_date)<new Date(U.startDate))||U.dueDate&&(!$e.due_date||new Date($e.due_date)>new Date(U.dueDate))?!1:$e.status!=="deleted"&&$e.status!=="logged"}}switch(z){case"inbox":return $.filter(te=>te.status==="inbox").forEach(te=>{te.parent_id&&console.log(`[Inbox Debug] Hidden task "${te.title}": has parent_id ${te.parent_id}`)}),te=>{if(te.parent_id||te.status==="deleted"||te.status==="logged")return!1;const $e=!!te.completed_at,rt=!te.start_date&&!te.due_date&&(!te.tags||te.tags.length===0),st=te.status==="inbox";if(rt){const Bt=J.inbox||{include:[],exclude:[]};return!((Array.isArray(Bt)?Bt:Bt.include||[]).length>0)}if(!st&&!$e||!$e&&(te.start_date||te.due_date)||!$e&&(lt&&te.tags.includes(lt)||te.tags.some(Bt=>{const Xt=a.find(on=>on.id===Bt);return Xt&&["schedule",""].includes(Xt.name.trim().toLowerCase())}))||!$e&&(at&&te.tags.includes(at)||mt&&te.tags.includes(mt)||Qe&&te.tags.includes(Qe)||Ke&&te.tags.includes(Ke)||Oe&&te.tags.includes(Oe)||xt&&te.tags.includes(xt)))return!1;const yt=J.inbox||{include:[],exclude:[]},{include:It,exclude:Dt}=Array.isArray(yt)?{include:yt,exclude:[]}:yt;return!(It.length>0&&!te.tags.some(Bt=>It.includes(Bt))||Dt.length>0&&te.tags.some(Bt=>Dt.includes(Bt)))};case"allview":return te=>{if(te.parent_id||te.status==="deleted"||lt&&te.tags.includes(lt))return!1;const $e=J.allview||{include:[],exclude:[]},{include:rt,exclude:st}=Array.isArray($e)?{include:$e,exclude:[]}:$e;return!(rt.length>0&&!te.tags.some(yt=>rt.includes(yt))||st.length>0&&te.tags.some(yt=>st.includes(yt)))};case"newtable":return te=>{if(te.parent_id||te.status==="deleted"||te.status==="logged"||Oe&&te.tags.includes(Oe)||Ke&&te.tags.includes(Ke)||Qe&&te.tags.includes(Qe)||!te.start_date&&!te.due_date)return!1;const $e=new Date;$e.setHours(23,59,59,999);const rt=te.start_date?new Date(te.start_date):te.due_date?new Date(te.due_date):null;return!(!rt||rt>$e)};case"focus":return te=>!(te.status==="deleted"||te.status==="logged"||te.start_date||te.due_date||Oe&&te.tags.includes(Oe)||Ke&&te.tags.includes(Ke)||Qe&&te.tags.includes(Qe)||te.status==="waiting"||$.some(rt=>rt.parent_id===te.id&&rt.status!=="deleted"&&rt.status!=="logged"));case"today":return te=>{if(te.status==="logged"||te.status==="deleted"||te.status==="waiting"||te.status==="someday"||lt&&te.tags.includes(lt)||te.tags.some(Dt=>{const Bt=a.find(Xt=>Xt.id===Dt);return Bt&&["schedule",""].includes(Bt.name.trim().toLowerCase())}))return!1;const $e=J.today||{include:[],exclude:[]},{include:rt,exclude:st}=Array.isArray($e)?{include:$e,exclude:[]}:$e;if(rt.length>0&&!te.tags.some(Dt=>rt.includes(Dt))||st.length>0&&te.tags.some(Dt=>st.includes(Dt)))return!1;const yt=["note","project"],It=a.filter(Dt=>yt.includes(Dt.name.trim().toLowerCase())).map(Dt=>Dt.id);return!(te.tags&&te.tags.some(Dt=>It.includes(Dt))||!te.start_date&&!te.due_date)};case"waiting":return te=>{const $e=J.waiting||{include:[],exclude:[]},{include:rt,exclude:st}=Array.isArray($e)?{include:$e,exclude:[]}:$e;if(rt.length>0&&!te.tags.some(Bt=>rt.includes(Bt))||st.length>0&&te.tags.some(Bt=>st.includes(Bt))||te.status==="deleted"||te.status==="logged")return!1;const yt=te.status==="waiting",It=te.status==="someday",Dt=te.tags.some(Bt=>{const Xt=a.find(an=>an.id===Bt);return Xt?Xt.name.trim().toLowerCase()==="someday":!1});return yt||It||Dt};case"journal":return te=>{if(!Ke)return!1;const $e=J.journal||{include:[],exclude:[]},{include:rt,exclude:st}=Array.isArray($e)?{include:$e,exclude:[]}:$e;return rt.length>0&&!te.tags.some(yt=>rt.includes(yt))||st.length>0&&te.tags.some(yt=>st.includes(yt))?!1:te.status!=="deleted"&&te.status!=="logged"&&te.tags.includes(Ke)};case"prompt":return te=>{const $e=a.find(It=>It.name.trim().toLowerCase()==="prompt");if(!$e)return!1;const rt=J.prompt||{include:[],exclude:[]},{include:st,exclude:yt}=Array.isArray(rt)?{include:rt,exclude:[]}:rt;return st.length>0&&!te.tags.some(It=>st.includes(It))||yt.length>0&&te.tags.some(It=>yt.includes(It))?!1:te.status!=="deleted"&&te.status!=="logged"&&te.tags.includes($e.id)};case"log":case"logbook":return te=>{if(te.status!=="logged")return!1;const $e=J.logbook||J.log||{include:[],exclude:[]},{include:rt,exclude:st}=Array.isArray($e)?{include:$e,exclude:[]}:$e;return!(rt.length>0&&!te.tags.some(yt=>rt.includes(yt))||st.length>0&&te.tags.some(yt=>st.includes(yt)))};case"recent":return te=>{if(te.status==="deleted")return!1;const $e=J.recent||{include:[],exclude:[]},{include:rt,exclude:st}=Array.isArray($e)?{include:$e,exclude:[]}:$e;return!(rt.length>0&&!te.tags.some(yt=>rt.includes(yt))||st.length>0&&te.tags.some(yt=>st.includes(yt)))};case"trash":return te=>{if(te.status!=="deleted")return!1;const $e=J.trash||{include:[],exclude:[]},{include:rt,exclude:st}=Array.isArray($e)?{include:$e,exclude:[]}:$e;return!(rt.length>0&&!te.tags.some(yt=>rt.includes(yt))||st.length>0&&te.tags.some(yt=>st.includes(yt)))};default:return te=>{if(te.status==="deleted"||te.status==="logged"||lt&&te.tags.includes(lt)||te.tags.some(It=>{const Dt=a.find(Bt=>Bt.id===It);return Dt&&["schedule",""].includes(Dt.name.trim().toLowerCase())}))return!1;const rt=J[z]||{include:[],exclude:[]},{include:st,exclude:yt}=Array.isArray(rt)?{include:rt,exclude:[]}:rt;return!(st.length>0&&!te.tags.some(It=>st.includes(It))||yt.length>0&&te.tags.some(It=>yt.includes(It)))}}})(),Be=z==="allview"||z==="project"?"inbox":z,ke=Je=>Je.view_orders&&Je.view_orders[Be]!==void 0?Je.view_orders[Be]:Je.order_index||0;if(z==="focus"||z==="today"){const Je=rt=>{const st=rt.start_date||rt.due_date;if(st){const It=new Date(st);return`${It.getFullYear()}-${String(It.getMonth()+1).padStart(2,"0")}-${String(It.getDate()).padStart(2,"0")}`}const yt=new Date;return`${yt.getFullYear()}-${String(yt.getMonth()+1).padStart(2,"0")}-${String(yt.getDate()).padStart(2,"0")}`},te=rt=>rt.view_orders&&rt.view_orders.today!==void 0?rt.view_orders.today:9e8+new Date(rt.created_at).getTime()/1e3;return $.filter(Ne).sort((rt,st)=>{if(z==="today"){const yt=Je(rt),It=Je(st);return yt!==It?yt.localeCompare(It):te(rt)-te(st)}return ke(rt)-ke(st)||rt.created_at.localeCompare(st.created_at)}).map((rt,st)=>({data:rt,depth:0,hasChildren:!1,isExpanded:!1,path:[rt.id],index:st}))}const Re=$.filter(Je=>{if(!Ne(Je))return!1;const te=Je.parent_id||null;if(!te)return!0;const $e=$.find(rt=>rt.id===te);return!$e||!Ne($e)}).sort((Je,te)=>ke(Je)-ke(te)||Je.created_at.localeCompare(te.created_at)),Ge=new Set;let kt=0;const dt=(Je,te=0,$e=[])=>{let rt=[];return Je.forEach(st=>{if(Ge.has(st.id))return;Ge.add(st.id);const yt=$.filter(Xt=>Xt.parent_id===st.id&&Xt.status!=="logged"&&Xt.status!=="deleted").sort((Xt,on)=>ke(Xt)-ke(on)||Xt.created_at.localeCompare(on.created_at)),It=yt.length>0,Dt=V.includes(st.id),Bt=[...$e,st.id];rt.push({data:st,depth:te,hasChildren:It,isExpanded:Dt,path:Bt,index:kt++}),It&&Dt&&(rt=[...rt,...dt(yt,te+1,Bt)])}),rt};return dt(Re)},[a,ue.showImportedGoogleEvents]),mn=b.useMemo(()=>Qo(r,ie,_e,P,Ue,R),[r,ie,_e,P,Ue,R,Qo,a]);b.useEffect(()=>{if(ie!=="today"||!je)return;let $=mn.filter(he=>{var Ke;return((Ke=he.data.view_orders)==null?void 0:Ke.today)===void 0});const z=new Map;mn.forEach(he=>{var Ke;const Oe=(Ke=he.data.view_orders)==null?void 0:Ke.today;if(Oe!==void 0){const Qe=z.get(Oe)||[];Qe.push(he.data.id),z.set(Oe,Qe)}});const L=new Set;if(z.forEach(he=>{if(he.length>1)for(let Oe=1;Oe<he.length;Oe++)L.add(he[Oe])}),L.size>0){const he=mn.filter(Oe=>L.has(Oe.data.id));console.warn("[Today] Found duplicate orders, re-assigning:",he.map(Oe=>Oe.data.title)),$=[...$,...he]}if($.length===0)return;let V=0;mn.forEach(he=>{var Ke;const Oe=(Ke=he.data.view_orders)==null?void 0:Ke.today;Oe!==void 0&&Oe>V&&(V=Oe)});const J=[...$].sort((he,Oe)=>he.data.created_at.localeCompare(Oe.data.created_at)).map((he,Oe)=>({id:he.data.id,view_orders:{...he.data.view_orders||{},today:V+1e4*(Oe+1)}}));s(he=>{const Oe=he.map(Ke=>{const Qe=J.find(at=>at.id===Ke.id);return Qe?{...Ke,view_orders:Qe.view_orders}:Ke});return G.current=Oe,Oe}),J.forEach(async({id:he,view_orders:Oe})=>{je&&await je.from("tasks").update({view_orders:Oe}).eq("id",he)})},[ie,mn,je]),b.useEffect(()=>{if(ie!=="waiting"||!je)return;let $=mn.filter(U=>{var he;return((he=U.data.view_orders)==null?void 0:he.waiting)===void 0});if($.length===0)return;let z=0;mn.forEach(U=>{var he;const J=(he=U.data.view_orders)==null?void 0:he.waiting;J!==void 0&&J>z&&(z=J)});const V=[...$].sort((U,J)=>U.data.created_at.localeCompare(J.data.created_at)).map((U,J)=>({id:U.data.id,view_orders:{...U.data.view_orders||{},waiting:z+1e4*(J+1)}}));s(U=>{const J=U.map(he=>{const Oe=V.find(Ke=>Ke.id===he.id);return Oe?{...he,view_orders:Oe.view_orders}:he});return G.current=J,J}),V.forEach(async({id:U,view_orders:J})=>{je&&await je.from("tasks").update({view_orders:J}).eq("id",U)})},[ie,mn,je]);const ko=($,z)=>{k(z);const L=$.shiftKey||$.shiftKey,V=$.ctrlKey||$.metaKey;if(L){const U=w||D||z;T(U);const J=mn.findIndex(Oe=>Oe.data.id===U),he=mn.findIndex(Oe=>Oe.data.id===z);if(J!==-1&&he!==-1){const[Oe,Ke]=J<he?[J,he]:[he,J],Qe=mn.slice(Oe,Ke+1).map(at=>at.data.id);v(Qe)}}else V?(T(z),v(U=>U.includes(z)?U.filter(J=>J!==z):[...U,z])):(T(z),v([z]))},Zo=b.useCallback(($,z)=>{const L=document.getElementById("drag-ghost");L&&(L.style.left=`${$}px`,L.style.top=`${z}px`)},[]);b.useEffect(()=>{Le.current=document.querySelector("main")},[]);const si=($,z)=>{if(ie==="schedule"){$.preventDefault();return}const L=g.includes(z.data.id)?g:[z.data.id];g.includes(z.data.id)||v([z.data.id]),$.dataTransfer.setData("text/plain",z.data.id),$.dataTransfer.setData("application/json",JSON.stringify(L)),$.dataTransfer.effectAllowed="move",$.dataTransfer.setDragImage(bI,0,0);const V=$.currentTarget.getBoundingClientRect(),U=$.clientX-V.left;Ae(J=>({...J,isDragging:!0,draggedId:z.data.id,originalDepth:z.depth,dragOffsetX:U,ghostPosition:{x:$.clientX,y:$.clientY}}))},nl=$=>{Ae(z=>({...z,...$}))},rl=async $=>{Ie.current&&(clearInterval(Ie.current),Ie.current=null);const{draggedId:z,dropIndex:L,dropDepth:V}=ae;if(Ae(ke=>({...ke,isDragging:!1,draggedId:null,dropIndex:null})),!z||L===null)return;const U=$||mn,J=ie==="allview"||ie==="project"?"inbox":ie,he=g.includes(z)?g:[z],Oe=ke=>J==="today"?9e8+new Date(ke.created_at).getTime()/1e3:ke.order_index||0,Ke=r.filter(ke=>he.includes(ke.id)).sort((ke,Re)=>{var dt,bt;const Ge=((dt=ke.view_orders)==null?void 0:dt[J])!==void 0?ke.view_orders[J]:Oe(ke),kt=((bt=Re.view_orders)==null?void 0:bt[J])!==void 0?Re.view_orders[J]:Oe(Re);return Ge-kt});let Qe=null;if(ie!=="today"&&L>0){const ke=U[L-1];if(V>ke.depth)Qe=ke.data.id,Zt(Qe,!0);else if(V===ke.depth)Qe=ke.data.parent_id;else{let Re=L-1;for(;Re>=0;){if(U[Re].depth===V-1){Qe=U[Re].data.id;break}if(U[Re].depth<V-1)break;Re--}if(V===0){const Ge=U.find(kt=>kt.depth===0&&!he.includes(kt.data.id));Qe=Ge?Ge.data.parent_id:null}}}else Qe=null;for(const ke of Ke){if(Qe&&Tw(ke.id,Qe,r)){x({msg:"",type:"error"});return}if(Qe){const Re=r.find(Ge=>Ge.id===Qe);if(Re&&!Re.is_project&&ke.is_project){x({msg:"",type:"error"});return}}}let at=-1e4,xt=9999999999;const lt=ke=>ke.view_orders&&ke.view_orders[J]!==void 0?ke.view_orders[J]:J==="today"?9e8+new Date(ke.created_at).getTime()/1e3:ke.order_index||0;let mt=null;if(ie==="today"){const ke=te=>te.start_date?new Date(te.start_date).toISOString().split("T")[0]:te.due_date?new Date(te.due_date).toISOString().split("T")[0]:null;let Re=null;for(let te=L-1;te>=0&&!(!he.includes(U[te].data.id)&&(Re=ke(U[te].data),Re));te--);let Ge=null;for(let te=L;te<U.length&&!(!he.includes(U[te].data.id)&&(Ge=ke(U[te].data),Ge));te++);const kt=ae.anchorTaskIndex;if(kt!==null&&kt>=0&&kt<U.length){const te=U[kt].data;he.includes(te.id)||(mt=ke(te))}mt||(mt=Re||Ge),mt||(mt=new Date().toISOString().split("T")[0]);const dt=U.map((te,$e)=>({...te,originalIndex:$e})).filter(te=>!he.includes(te.data.id)&&ke(te.data)===mt),bt=dt.filter(te=>te.originalIndex<L),Je=dt.filter(te=>te.originalIndex>=L);if(bt.length>0){const te=bt[bt.length-1];at=lt(te.data)}if(Je.length>0){const te=Je[0];xt=lt(te.data)}}else{for(let ke=L-1;ke>=0;ke--){const Re=U[ke];if(!he.includes(Re.data.id)){if(Re.depth===V){at=lt(Re.data);break}else if(Re.depth<V)break}}for(let ke=L;ke<U.length;ke++){const Re=U[ke];if(!he.includes(Re.data.id)){if(Re.depth===V){xt=lt(Re.data);break}else if(Re.depth<V)break}}}at===-1e4&&xt===9999999999?(at=0,xt=2e4):at===-1e4?at=xt-2e4:xt===9999999999&&(xt=at+2e4);const Ye=Ke.length,Ne=(xt-at)/(Ye+1),Be=Ke.map((ke,Re)=>{const Ge=at+Ne*(Re+1),kt={...ke.view_orders||{},[J]:Ge},dt={id:ke.id,view_orders:kt};return ie!=="today"&&(dt.parent_id=Qe),ie==="today"&&mt&&(dt.start_date=mt,dt.is_all_day=!0),dt});xs(Be)},So=async($,z)=>{const L=G.current,V=L.find(Qe=>Qe.id===$);if(!V)return;Rt($);const U=ie==="allview"||ie==="project"?"inbox":ie,J=Qe=>Qe.view_orders&&Qe.view_orders[U]!==void 0?Qe.view_orders[U]:U==="today"?9e8+new Date(Qe.created_at).getTime()/1e3:Qe.order_index||0,Oe=g.includes($)?ie==="today"?g:g.filter(Qe=>{const at=L.find(xt=>xt.id===Qe);return at&&(at.parent_id||null)===(V.parent_id||null)}):[$],Ke=L.filter(Qe=>Oe.includes(Qe.id)).sort((Qe,at)=>J(Qe)-J(at));if(z==="up"||z==="down"){const Qe=ie==="today";let at=[];if(ie==="project")at=L.filter(Ye=>(Ye.parent_id||null)===(V.parent_id||null)&&Ye.status!=="deleted"&&Ye.status!=="logged").sort((Ye,Ne)=>J(Ye)-J(Ne));else if(Qe){const Ye=ke=>ke.start_date?new Date(ke.start_date).toISOString().split("T")[0]:ke.due_date?new Date(ke.due_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],Ne=Ye(V),Be=new Set(mn.map(ke=>ke.data.id));Be.add(V.id),at=L.filter(ke=>Be.has(ke.id)&&Ye(ke)===Ne).sort((ke,Re)=>J(ke)-J(Re))}else at=mn.filter(Ye=>(Ye.data.parent_id||null)===(V.parent_id||null)).map(Ye=>Ye.data);const xt=Ke.map(Ye=>at.findIndex(Ne=>Ne.id===Ye.id)).filter(Ye=>Ye!==-1);if(xt.length===0)return;const lt=Math.min(...xt),mt=Math.max(...xt);if(z==="up"){if(lt===0){if(Qe){const Ge=Je=>{const te=Je.start_date||Je.due_date;if(te){const rt=new Date(te);return`${rt.getFullYear()}-${String(rt.getMonth()+1).padStart(2,"0")}-${String(rt.getDate()).padStart(2,"0")}`}const $e=new Date;return`${$e.getFullYear()}-${String($e.getMonth()+1).padStart(2,"0")}-${String($e.getDate()).padStart(2,"0")}`},kt=Ge(V),dt=Array.from(new Set(mn.map(Je=>Ge(Je.data)))).sort(),bt=dt.indexOf(kt);if(bt>0){const Je=dt[bt-1],te=mn.filter(st=>Ge(st.data)===Je).map(st=>st.data).sort((st,yt)=>J(st)-J(yt));let $e;te.length>0?$e=J(te[te.length-1])+1e4:$e=0;const rt=Ke.map((st,yt)=>({id:st.id,start_date:Je,view_orders:{...st.view_orders||{},[U]:$e+1e4*yt}}));xs(rt);return}}return}const Ye=lt-1,Ne=lt-2,Be=J(at[Ye]),ke=Ne>=0?J(at[Ne]):Be-2e4;if(Be-ke<.1){console.log("[Task Reorder] Gap too small, rebalancing list...");const Ge=new Set(Ke.map($e=>$e.id)),kt=at.filter($e=>!Ge.has($e.id)),dt=at[Ye];let bt=kt.findIndex($e=>$e.id===dt.id);bt===-1&&(bt=0);const Je=[...kt];Je.splice(bt,0,...Ke);const te=Je.map(($e,rt)=>({id:$e.id,view_orders:{...$e.view_orders||{},[U]:1e4*(rt+1)}}));xs(te)}else{const Ge=(Be-ke)/(Ke.length+1),kt=Ke.map((dt,bt)=>({id:dt.id,view_orders:{...dt.view_orders||{},[U]:ke+Ge*(bt+1)}}));xs(kt)}}else{if(mt===at.length-1){if(Qe){const Ge=Je=>{const te=Je.start_date||Je.due_date;if(te){const rt=new Date(te);return`${rt.getFullYear()}-${String(rt.getMonth()+1).padStart(2,"0")}-${String(rt.getDate()).padStart(2,"0")}`}const $e=new Date;return`${$e.getFullYear()}-${String($e.getMonth()+1).padStart(2,"0")}-${String($e.getDate()).padStart(2,"0")}`},kt=Ge(V),dt=Array.from(new Set(mn.map(Je=>Ge(Je.data)))).sort(),bt=dt.indexOf(kt);if(bt<dt.length-1){const Je=dt[bt+1],te=mn.filter(st=>Ge(st.data)===Je).map(st=>st.data).sort((st,yt)=>J(st)-J(yt));let $e;te.length>0?$e=J(te[0])-1e4*Ke.length:$e=0;const rt=Ke.map((st,yt)=>({id:st.id,start_date:Je,view_orders:{...st.view_orders||{},[U]:$e+1e4*yt}}));xs(rt);return}}return}const Ye=mt+1,Ne=mt+2,Be=J(at[Ye]),ke=Ne<at.length?J(at[Ne]):Be+2e4;if(ke-Be<.1){console.log("[Task Reorder] Gap too small (down), rebalancing list...");const Ge=new Set(Ke.map($e=>$e.id)),kt=at.filter($e=>!Ge.has($e.id)),dt=at[Ye];let bt=kt.findIndex($e=>$e.id===dt.id);bt===-1&&(bt=kt.length);const Je=[...kt];Je.splice(bt+1,0,...Ke);const te=Je.map(($e,rt)=>({id:$e.id,view_orders:{...$e.view_orders||{},[U]:1e4*(rt+1)}}));xs(te)}else{const Ge=(ke-Be)/(Ke.length+1),kt=Ke.map((dt,bt)=>({id:dt.id,view_orders:{...dt.view_orders||{},[U]:Be+Ge*(bt+1)}}));xs(kt)}}}else if(z==="right"){if(ie==="today"){const Ye=Ke[0],Ne=mn.findIndex(Ge=>Ge.data.id===Ye.id);if(Ne<=0){x({msg:"",type:"info"});return}const Be=mn[Ne-1].data.id,ke=(Ge,kt)=>{let dt=r.find(bt=>bt.id===Ge);for(;dt&&dt.parent_id;){if(dt.parent_id===kt)return!0;dt=r.find(bt=>bt.id===dt.parent_id)}return!1};for(const Ge of Ke)if(Be===Ge.id||ke(Be,Ge.id)){x({msg:"",type:"error"});return}const Re=Ke.map(Ge=>({id:Ge.id,parent_id:Be}));xs(Re),x({msg:` ${Ke.length} `,type:"info"});return}let Qe=null;const at=Ke[0];if(ie==="project"){const Ye=L.filter(Be=>(Be.parent_id||null)===(at.parent_id||null)&&Be.status!=="deleted"&&Be.status!=="logged").sort((Be,ke)=>J(Be)-J(ke)),Ne=Ye.findIndex(Be=>Be.id===at.id);Ne>0&&(Qe=Ye[Ne-1].id)}else{const Ye=mn.findIndex(Ne=>Ne.data.id===at.id);if(Ye>0){const Ne=mn[Ye];for(let Be=Ye-1;Be>=0;Be--){if(mn[Be].depth===Ne.depth){Qe=mn[Be].data.id;break}if(mn[Be].depth<Ne.depth)break}}}if(!Qe)return;const xt=L.filter(Ye=>Ye.parent_id===Qe&&Ye.status!=="deleted"&&Ye.status!=="logged").sort((Ye,Ne)=>J(Ye)-J(Ne));let lt=(xt[xt.length-1]?J(xt[xt.length-1]):0)+1e4;P.includes(Qe)||Zt(Qe,!0);const mt=Ke.map(Ye=>{const Ne=lt;return lt+=1e4,{id:Ye.id,parent_id:Qe,order_index:Ne,view_orders:{...Ye.view_orders||{},[U]:Ne}}});xs(mt),x({msg:` ${Ke.length} `,type:"info"})}else if(z==="left"){if(ie==="today"){const xt=[];let lt=0;for(const mt of Ke){if(!mt.parent_id)continue;const Ye=L.find(Be=>Be.id===mt.parent_id);if(!Ye)continue;const Ne=Ye.parent_id||null;xt.push({id:mt.id,parent_id:Ne}),lt++}xt.length>0?(xs(xt),x({msg:` ${lt} `,type:"info"})):x({msg:"",type:"info"});return}const Qe=[];let at=0;for(const xt of Ke){if(!xt.parent_id)continue;const lt=L.find(Re=>Re.id===xt.parent_id);if(!lt)continue;if(ie==="project"){const Re=a.find(Ge=>Ge.name.trim().toLowerCase()==="project");if(Re&&lt.tags.includes(Re.id)){x({msg:" ",type:"info"});continue}}const mt=lt.parent_id,Ye=L.filter(Re=>Re.parent_id===mt&&Re.status!=="deleted"&&Re.status!=="logged").sort((Re,Ge)=>J(Re)-J(Ge)),Ne=Ye.findIndex(Re=>Re.id===lt.id),Be=Ye[Ne+1];let ke;Be?ke=(J(lt)+J(Be))/2:ke=J(lt)+1e4,Qe.push({id:xt.id,parent_id:mt,order_index:ke,view_orders:{...xt.view_orders||{},[U]:ke}}),at++}Qe.length>0&&(xs(Qe),x({msg:` ${at} `,type:"info"}))}},xs=async $=>{const z=$.map(J=>{const he=G.current.find(Qe=>Qe.id===J.id),Oe={},Ke={};return he&&Object.keys(J).forEach(Qe=>{Qe!=="id"&&(Oe[Qe]=he[Qe],Ke[Qe]=J[Qe])}),{id:J.id,before:Oe,after:Ke}});Pn({type:"BATCH_UPDATE",payload:z});const L=G.current.map(J=>{const he=$.find(Oe=>Oe.id===J.id);return he?{...J,...he}:J}).sort((J,he)=>(J.order_index||0)-(he.order_index||0)||J.created_at.localeCompare(he.created_at));if(G.current=L,s(L),je){const J=je;await Promise.all($.map(he=>J.from("tasks").update(he).eq("id",he.id)))}const V=JSON.parse(localStorage.getItem("task_google_map")||"{}"),U=$.filter(J=>V[J.id]&&(J.start_date!==void 0||J.is_all_day!==void 0));U.length>0&&Promise.resolve(localStorage.getItem("google_access_token")).then(async J=>{J&&await Promise.all(U.map(async he=>{const Oe=V[he.id],Ke=L.find(Ye=>Ye.id===he.id);if(!Ke)return;const Qe={},at=he.is_all_day!==void 0?he.is_all_day:Ke.is_all_day,xt=he.start_date||Ke.start_date;if(!xt)return;const lt=new Date(xt);if(isNaN(lt.getTime()))return;const mt=lt.toLocaleDateString("en-CA");if(at){Qe.start={date:mt};const Ye=new Date(lt);Ye.setDate(Ye.getDate()+1),Qe.end={date:Ye.toLocaleDateString("en-CA")}}else{const Ye=Re=>Re.length===5?Re+":00":Re,Ne=Ye(he.start_time||Ke.start_time||"09:00:00");let Be=Ke.end_time?Ye(Ke.end_time):null;if(!Be){const[Re,Ge]=Ne.split(":").map(Number);Be=`${String((Re+1)%24).padStart(2,"0")}:${String(Ge).padStart(2,"0")}:00`}const ke=Intl.DateTimeFormat().resolvedOptions().timeZone;Qe.start={dateTime:`${mt}T${Ne}`,timeZone:ke},Qe.end={dateTime:`${mt}T${Be}`,timeZone:ke}}try{const Ye=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${Oe.calId}/events/${Oe.evtId}`,{method:"PATCH",headers:{Authorization:`Bearer ${J}`,"Content-Type":"application/json"},body:JSON.stringify(Qe)});if(!Ye.ok){const Ne=await Ye.text();console.error("Batch Google Sync Failed",Ne),Ye.status===401&&x({msg:"Google  Google",type:"error"})}}catch(Ye){console.error("Google Batch Sync Error",Ye)}}))})},_o=async($,z=[],L)=>{if(!je)return"";m("syncing");const V=L||ll(),U=r.length>0?Math.max(...r.map(at=>at.order_index||0)):0,J=$.order_index!==void 0?$.order_index:U+1e4;Rt(V);const he={...$,id:V,user_id:e.id,parent_id:$.parent_id||null,created_at:new Date().toISOString(),tags:$.tags||[],images:$.images||[],order_index:J,view_orders:$.view_orders||{},is_all_day:$.is_all_day||!1,start_time:$.start_time||null,end_time:$.end_time||null,duration:$.duration||null,reviewed_at:null,dependencies:$.dependencies||[]};Pn({type:"ADD",payload:{data:he}}),s(at=>{const xt=[...at,he].sort((lt,mt)=>(lt.order_index||0)-(mt.order_index||0)||lt.created_at.localeCompare(mt.created_at));return G.current=xt,xt});const{error:Oe}=await je.from("tasks").insert([he]);if(Oe)return console.error("Task Insert Error:",Oe),s(at=>at.filter(xt=>xt.id!==V)),ct(Oe),"";const Ke=a.find(at=>(he.tags||[]).includes(at.id)&&at.name.startsWith("Google:")),Qe=he.start_date&&(he.start_time||he.is_all_day);if(Ke&&Qe){const at=localStorage.getItem("google_access_token");if(at){console.log("[Google Sync] New task has Google tag, creating event...");const xt=Ke.name.replace("Google:","").trim();bl(at).then(async lt=>{const mt=lt.find(Re=>Re.summary===xt),Ye=mt?mt.id:"primary",Ne={summary:he.title,description:he.description||""},Be=new Date(he.start_date).toLocaleDateString("en-CA"),ke=Intl.DateTimeFormat().resolvedOptions().timeZone;if(he.is_all_day){Ne.start={date:Be};const Re=new Date(Be),Ge=new Date(Re);Ge.setDate(Ge.getDate()+1),Ne.end={date:Ge.toLocaleDateString("en-CA")}}else if(he.start_time){const Re=he.start_time.length>5?he.start_time.substring(0,5):he.start_time,Ge=`${Be}T${Re}:00`;let kt="";if(he.end_time)kt=he.end_time.length>5?he.end_time.substring(0,5):he.end_time;else{const dt=new Date(Ge);dt.setHours(dt.getHours()+1),kt=`${String(dt.getHours()).padStart(2,"0")}:${String(dt.getMinutes()).padStart(2,"0")}`}Ne.start={dateTime:Ge,timeZone:ke},Ne.end={dateTime:`${Be}T${kt}:00`,timeZone:ke}}if(Ne.start)try{const Re=await No(at,Ye,Ne);if(Re){const Ge=JSON.parse(localStorage.getItem("task_google_map")||"{}");Ge[V]={evtId:Re,calId:Ye},localStorage.setItem("task_google_map",JSON.stringify(Ge)),console.log("[Google Sync] Created event for new task:",V,"eventId:",Re),x({msg:"Google ",type:"info"})}}catch(Re){console.error("[Google Sync] Failed to create event for new task:",Re)}}).catch(lt=>console.error("[Google Sync] Calendar list fetch failed:",lt))}}return m("synced"),V},sl=async($,z=null,L)=>{if(!je)return;m("syncing");let V=G.current.length>0?Math.max(...G.current.map(at=>at.order_index||0)):0;const U=[],J=new Date().toISOString(),he=(at,xt)=>{for(const lt of at){V+=1e4;const mt=lt.id||ll();Rt(mt);const Ye={id:mt,user_id:e.id,parent_id:xt,created_at:J,title:lt.title,description:lt.description,start_date:lt.start_date||null,due_date:lt.due_date||null,order_index:V,view_orders:{today:0},dependencies:lt.dependencies||[],is_all_day:lt.is_all_day!==void 0?lt.is_all_day:!0,start_time:lt.start_time||null,end_time:lt.end_time||null,duration:lt.duration||null,color:lt.color,tags:lt.tags||[],status:lt.status||"todo",images:lt.images||[],reviewed_at:null,reminder_minutes:lt.reminder_minutes||null,google_event_id:lt.google_event_id||null,google_calendar_id:lt.google_calendar_id||null};U.push(Ye),lt.subtasks&&lt.subtasks.length>0&&he(lt.subtasks,mt)}};if(he($,z),U.length===0)return;s(at=>{const xt=[...at,...U].sort((lt,mt)=>(lt.order_index||0)-(mt.order_index||0)||lt.created_at.localeCompare(mt.created_at));return G.current=xt,xt});const Oe=500;let Ke=0;const Qe=U.length;try{const at=JSON.parse(localStorage.getItem("task_google_map")||"{}");for(let xt=0;xt<Qe;xt+=Oe){const lt=U.slice(xt,xt+Oe),mt=lt.map(Ne=>{const{google_event_id:Be,google_calendar_id:ke,...Re}=Ne;return Re}),{error:Ye}=await je.from("tasks").insert(mt);if(Ye){console.error("Batch insert error in chunk "+xt,Ye),ct(Ye);break}lt.forEach(Ne=>{Ne.google_event_id&&Ne.google_calendar_id&&(at[Ne.id]={evtId:Ne.google_event_id,calId:Ne.google_calendar_id})}),Ke+=lt.length,L&&L(Ke,Qe),await new Promise(Ne=>setTimeout(Ne,10))}localStorage.setItem("task_google_map",JSON.stringify(at))}catch(at){console.error("Batch process failed",at)}m("synced")},Xn=async $=>{if(!je||$.length===0)return[];m("syncing");const z=[],L=new Map,V=J=>{const he=G.current.filter(Ke=>Ke.parent_id===J);let Oe=[];return he.forEach(Ke=>{Oe.push(Ke),Oe=[...Oe,...V(Ke.id)]}),Oe};let U=G.current.length>0?Math.max(...G.current.map(J=>J.order_index||0)):0;try{for(const J of $){const he=G.current.find(at=>at.id===J);if(!he)continue;const Oe=V(J);U+=1e4;const Ke=ll();L.set(J,Ke);const Qe={...he,id:Ke,title:he.title+" ()",created_at:new Date().toISOString(),order_index:U,view_orders:{},reviewed_at:null};delete Qe.user_id,await _o(Qe,[],Ke),z.push(Ke);for(const at of Oe){U+=1e4;const xt=ll();L.set(at.id,xt);const lt=L.get(at.parent_id)||at.parent_id,mt={...at,id:xt,parent_id:lt,created_at:new Date().toISOString(),order_index:U,view_orders:{},reviewed_at:null};delete mt.user_id,await _o(mt,[],xt)}}}catch(J){ct(J)}finally{m("synced")}return z},Pr=async($,z,L=[],V)=>{var mt,Ye;if(console.warn("[updateTask] CALLED:",$,"status:",z.status),!je)return;const U=r.find(Ne=>Ne.id===$);if(U&&ft(U)&&!(V!=null&&V.skipGoogleLockCheck)){console.warn("[updateTask] BLOCKED: Task is locked via Google tag:",$),x({msg:" Google ",type:"error"});return}if(m("syncing"),Rt($),ie==="inbox"&&U&&!U.parent_id){const Ne=a.find(It=>It.name.trim().toLowerCase()==="project"),Be=a.find(It=>It.name.includes("")),ke=a.find(It=>It.name.trim().toLowerCase()==="note"),Re=a.find(It=>It.name.trim().toLowerCase()==="prompt"),Ge=a.find(It=>It.name==="#prompt"),kt=a.find(It=>It.name.trim().toLowerCase()==="journal"),dt=a.find(It=>It.name.trim().toLowerCase()==="someday"),bt=a.find(It=>["annual","annualplan","",""].some(Dt=>It.name.trim().toLowerCase().includes(Dt))),Je=a.find(It=>["schedule",""].includes(It.name.trim().toLowerCase())),te=z.tags||U.tags||[],$e=U.tags||[],rt=z.tags&&(Ne&&te.includes(Ne.id)&&!$e.includes(Ne.id)||Be&&te.includes(Be.id)&&!$e.includes(Be.id)||ke&&te.includes(ke.id)&&!$e.includes(ke.id)||Re&&te.includes(Re.id)&&!$e.includes(Re.id)||Ge&&te.includes(Ge.id)&&!$e.includes(Ge.id)||kt&&te.includes(kt.id)&&!$e.includes(kt.id)||dt&&te.includes(dt.id)&&!$e.includes(dt.id)||bt&&te.includes(bt.id)&&!$e.includes(bt.id)||Je&&te.includes(Je.id)&&!$e.includes(Je.id)),st=z.status&&(z.status==="someday"||z.status==="waiting")&&U.status!=="someday"&&U.status!=="waiting";(z.start_date&&!U.start_date||z.due_date&&!U.due_date||z.parent_id&&!U.parent_id||rt||st)&&!it.current.includes($)&&hn($)}if(U&&!(V!=null&&V.skipHistory)){const Ne={};let Be=!1;Object.keys(z).forEach(ke=>{const Re=U[ke],Ge=z[ke];Ne[ke]=Re,Array.isArray(Re)||Array.isArray(Ge)||Re&&typeof Re=="object"?JSON.stringify(Re)!==JSON.stringify(Ge)&&(Be=!0):Re!==Ge&&(Be=!0)}),Be&&Pn({type:"UPDATE",payload:{id:$,before:Ne,after:z}})}if(z.start_date&&U){const Ne=new Date().toISOString().split("T")[0],Be=z.start_date===Ne||z.start_date.startsWith(Ne),ke=((mt=U.view_orders)==null?void 0:mt.today)!==void 0;if(Be&&!ke){const Re=G.current.filter(dt=>{const bt=dt.start_date||dt.due_date;return bt&&(bt===Ne||bt.startsWith(Ne))});let Ge=0;Re.forEach(dt=>{var Je;const bt=((Je=dt.view_orders)==null?void 0:Je.today)??dt.order_index??0;bt>Ge&&(Ge=bt)});const kt=Ge+1e4;z.view_orders={...U.view_orders||{},...z.view_orders||{},today:kt}}}const J=z.completed_at&&(!U||!U.completed_at);let he=[];if(J){const Ne=Be=>{const Re=G.current.filter(kt=>kt.parent_id===Be&&!kt.completed_at).map(kt=>kt.id),Ge=Re.flatMap(kt=>Ne(kt));return[...Re,...Ge]};he=Ne($)}s(Ne=>{const Be=new Date().toISOString();let ke=Ne.map(Re=>Re.id===$?{...Re,...z,updated_at:Be}:Re);return he.length>0&&(ke=ke.map(Re=>he.includes(Re.id)?{...Re,completed_at:z.completed_at,status:"completed",updated_at:Be}:Re)),G.current=ke,ke});const{google_event_id:Oe,google_calendar_id:Ke,...Qe}=z,{error:at}=await je.from("tasks").update(Qe).eq("id",$);if(at){U&&s(Ne=>{const Be=Ne.map(ke=>ke.id===$?U:ke);return G.current=Be,Be}),ct(at);return}else{console.log("[updateTask] Database update successful, proceeding to Google sync check");const Ne=JSON.parse(localStorage.getItem("task_google_map")||"{}");Oe&&Ke&&(Ne[$]={evtId:Oe,calId:Ke},localStorage.setItem("task_google_map",JSON.stringify(Ne)));const Be=Ne[$];if(z.status==="deleted"&&console.log("[Google Sync Check] Task being deleted:",$,"Has Google mapping:",!!Be),U&&Be&&Be.evtId!=="PENDING"){const ke=localStorage.getItem("google_access_token");if(ke){const Re={...U,...z},Ge={};if(z.tags!==void 0){const dt=a.find(Je=>(U.tags||[]).includes(Je.id)&&Je.name.startsWith("Google:")),bt=a.find(Je=>(z.tags||[]).includes(Je.id)&&Je.name.startsWith("Google:"));if(dt&&bt&&dt.id!==bt.id){console.log("[Google Sync] Calendar tag changed from",dt.name,"to",bt.name),dt.name.replace("Google:","").trim();const Je=bt.name.replace("Google:","").trim();bl(ke).then(async te=>{var rt;const $e=te.find(st=>st.summary===Je);if($e)try{await ia(ke,Be.calId,Be.evtId),console.log("[Google Sync] Deleted event from old calendar:",Be.calId);const st={summary:Re.title,description:Re.description||""},yt=(rt=Re.start_date)==null?void 0:rt.split("T")[0],It=Intl.DateTimeFormat().resolvedOptions().timeZone;if(Re.is_all_day&&yt){st.start={date:yt};const Dt=new Date(yt);Dt.setDate(Dt.getDate()+1),st.end={date:Dt.toISOString().split("T")[0]}}else if(Re.start_time&&yt){const Dt=(Re.start_time||"").substring(0,5);st.start={dateTime:`${yt}T${Dt}:00`,timeZone:It};const Bt=Re.end_time?Re.end_time.substring(0,5):(()=>{const Xt=new Date(`${yt}T${Dt}:00`);return Xt.setHours(Xt.getHours()+1),`${String(Xt.getHours()).padStart(2,"0")}:${String(Xt.getMinutes()).padStart(2,"0")}`})();st.end={dateTime:`${yt}T${Bt}:00`,timeZone:It}}if(st.start){const Dt=await No(ke,$e.id,st);if(Dt){const Bt=JSON.parse(localStorage.getItem("task_google_map")||"{}");Bt[$]={evtId:Dt,calId:$e.id},localStorage.setItem("task_google_map",JSON.stringify(Bt)),console.log("[Google Sync] Moved event to new calendar:",$e.id,"new event ID:",Dt),x({msg:` ${Je}`,type:"info"})}}}catch(st){console.error("[Google Sync] Calendar move failed:",st),x({msg:"",type:"error"})}}).catch(te=>console.error("[Google Sync] Failed to fetch calendars for move:",te));return}}if(!(z.title!==void 0||z.status!==void 0||z.start_date!==void 0||z.start_time!==void 0||z.end_time!==void 0||z.is_all_day!==void 0))return;if(z.title!==void 0&&z.title!==U.title&&(Ge.summary=Re.title),z.description!==void 0&&z.description!==U.description&&(Ge.description=Re.description||""),z.status==="deleted"){console.log("[Google Sync] Task moved to trash, calling DELETE API"),ia(ke,Be.calId,Be.evtId).then(()=>{x({msg:"Google ",type:"info"});const dt=JSON.parse(localStorage.getItem("task_google_map")||"{}");delete dt[$],localStorage.setItem("task_google_map",JSON.stringify(dt))}).catch(dt=>console.error("Google Delete Error",dt));return}else z.status&&U.status==="deleted"&&(Ge.status="confirmed",console.log("[Google Sync] Task restored, setting event status to confirmed"),Ge.status="confirmed",console.log("[Google Sync] Task restored, setting event status to confirmed"));try{const dt=st=>{if(!st)return null;if(typeof st=="string"){const yt=st.match(/^(\d{4}-\d{2}-\d{2})/);return yt?yt[1]:null}return null},bt=st=>{if(!st)return null;if(typeof st=="string"){const yt=st.match(/^(\d{1,2}):(\d{2})/);if(yt)return`${yt[1].padStart(2,"0")}:${yt[2]}`}return null};if((z.start_date!==void 0&&dt(z.start_date)!==dt(U.start_date)||z.start_time!==void 0&&bt(z.start_time)!==bt(U.start_time)||z.end_time!==void 0&&bt(z.end_time)!==bt(U.end_time)||z.is_all_day!==void 0&&z.is_all_day!==U.is_all_day)&&Re.start_date){const st=Intl.DateTimeFormat().resolvedOptions().timeZone,yt=dt(Re.start_date),It=Dt=>{if(!Dt)return null;if(typeof Dt=="string"){const Bt=Dt.match(/^(\d{1,2}):(\d{2})(?::(\d{2}))?/);if(Bt){const Xt=Bt[1].padStart(2,"0"),on=Bt[2],an=Bt[3]||"00";return`${Xt}:${on}:${an}`}}return null};if(Re.is_all_day&&yt){Ge.start={date:yt};const Dt=new Date(yt);Dt.setDate(Dt.getDate()+1);const Bt=Dt.toISOString().split("T")[0];Ge.end={date:Bt}}else if(yt&&Re.start_time){const Dt=It(Re.start_time);if(Dt){const Bt=`${yt}T${Dt}`;Ge.start={dateTime:Bt,timeZone:st};let Xt="";const on=It(Re.end_time);if(on)Xt=`${yt}T${on}`;else{const an=new Date(Bt),Rn=new Date(an.getTime()+60*60*1e3),yr=String(Rn.getHours()).padStart(2,"0"),Qn=String(Rn.getMinutes()).padStart(2,"0");Xt=`${yt}T${yr}:${Qn}:00`}Ge.end={dateTime:Xt,timeZone:st}}}}if(Ge.start||Ge.end){const st=Ge.start&&(Ge.start.date||Ge.start.dateTime),yt=Ge.end&&(Ge.end.date||Ge.end.dateTime);(!st||!yt)&&(delete Ge.start,delete Ge.end,console.log("[Google Sync] Removed invalid date objects from payload"))}const $e=Object.keys(Ge).length>0&&(Ge.summary||Ge.status||Ge.start&&Ge.end);if(z.is_all_day!==void 0&&U.is_all_day!==z.is_all_day&&Ge.start&&Ge.end){console.log("[Google Sync] Event TYPE change detected (is_all_day:",U.is_all_day,"->",z.is_all_day,"), using delete+create"),jn.current=!0;const st=Be.evtId;Ln.current.add(st),(async()=>{try{await ia(ke,Be.calId,st);const yt={summary:Re.title,description:Re.description||"",start:Ge.start,end:Ge.end},It=await No(ke,Be.calId,yt);Ln.current.add(It);const Dt=JSON.parse(localStorage.getItem("task_google_map")||"{}");Dt[$]={evtId:It,calId:Be.calId},localStorage.setItem("task_google_map",JSON.stringify(Dt)),x({msg:"Google ",type:"info"}),console.log("[Google Sync] Event type change completed with new ID:",It)}catch(yt){console.error("Failed to recreate event:",yt),x({msg:"Google : ",type:"error"})}finally{jn.current=!1}})()}else $e&&(console.log("[Google Sync] Updating event:",Be.evtId),console.log("[Google Sync] Full payload:",JSON.stringify(Ge,null,2)),Qx(ke,Be.calId,Be.evtId,Ge).then(()=>x({msg:"Google ",type:"info"})).catch(async st=>{console.error("Google Update Error",st,"Payload:",Ge),(st.message||"").includes("conflict")||x({msg:`Google : ${st.message}`,type:"error"})}))}catch(dt){console.error("Date parsing error",dt)}}}}const lt=JSON.parse(localStorage.getItem("task_google_map")||"{}")[$];if(U&&!lt&&U.status==="deleted"&&z.status&&z.status!=="deleted"){const Ne=localStorage.getItem("google_access_token"),Be={...U,...z},ke=Be.start_date&&(Be.start_time||Be.is_all_day);if(Ne&&ke){console.log("[Google Sync] Task restored from trash. Recreating Google Event..."),x({msg:" Google ...",type:"info"});const Re={summary:Be.title,description:Be.description||""},Ge=Be.start_date.split("T")[0];if(Be.is_all_day){Re.start={date:Ge};const kt=new Date(Ge);kt.setDate(kt.getDate()+1),Re.end={date:kt.toISOString().split("T")[0]}}else if(Be.start_time){const kt=Be.start_time.length>5?Be.start_time.substring(0,5):Be.start_time,dt=`${Ge}T${kt}:00`;let bt="";if(Be.end_time)bt=Be.end_time.length>5?Be.end_time.substring(0,5):Be.end_time;else{const $e=new Date(dt);$e.setHours($e.getHours()+1);const rt=String($e.getHours()).padStart(2,"0"),st=String($e.getMinutes()).padStart(2,"0");bt=`${rt}:${st}`}const Je=`${Ge}T${bt}:00`,te=Intl.DateTimeFormat().resolvedOptions().timeZone;Re.start={dateTime:dt,timeZone:te},Re.end={dateTime:Je,timeZone:te}}Re.start&&No(Ne,"primary",Re).then(kt=>{if(kt){const dt=JSON.parse(localStorage.getItem("task_google_map")||"{}");dt[$]={evtId:kt,calId:"primary"},localStorage.setItem("task_google_map",JSON.stringify(dt)),x({msg:"Google ",type:"info"})}}).catch(kt=>console.error("Restore Google Error:",kt))}}if(U&&!lt){const Ne={...U,...z,completed_at:null},Be=z.tags!==void 0?z.tags:U.tags||[],ke=a.find(Ge=>Be.includes(Ge.id)&&Ge.name.startsWith("Google:")),Re=Ne.start_date&&(Ne.start_time||Ne.is_all_day);if(ke&&Re&&Ne.status!=="deleted"){const Ge=localStorage.getItem("google_access_token");if(Ge){const kt=JSON.parse(localStorage.getItem("task_google_map")||"{}");if(((Ye=kt[$])==null?void 0:Ye.evtId)==="PENDING")return;kt[$]={evtId:"PENDING",calId:"primary"},localStorage.setItem("task_google_map",JSON.stringify(kt)),console.log("[Google Sync] Found Google Tag:",ke.name,"Creating event..."),x({msg:" Google ...",type:"info"});const dt=ke.name.replace("Google:","").trim();let bt="primary";bl(Ge).then(async Je=>{var yt;const te=Je.find(It=>It.summary===dt);te?(bt=te.id,console.log("[Google Sync] Resolved Calendar ID:",bt)):console.warn("[Google Sync] Calendar not found:",dt,"Using primary.");const $e={summary:Ne.title,description:Ne.description||""},rt=new Date(Ne.start_date).toLocaleDateString("en-CA"),st=Intl.DateTimeFormat().resolvedOptions().timeZone;if(Ne.is_all_day){$e.start={date:rt};const It=new Date(rt),Dt=new Date(It);Dt.setDate(Dt.getDate()+1),$e.end={date:Dt.toLocaleDateString("en-CA")}}else if(Ne.start_time){const It=Ne.start_time.length>5?Ne.start_time.substring(0,5):Ne.start_time,Dt=`${rt}T${It}:00`;let Bt="";if(Ne.end_time)Bt=Ne.end_time.length>5?Ne.end_time.substring(0,5):Ne.end_time;else{const on=new Date(Dt);on.setHours(on.getHours()+1);const an=String(on.getHours()).padStart(2,"0"),Rn=String(on.getMinutes()).padStart(2,"0");Bt=`${an}:${Rn}`}const Xt=`${rt}T${Bt}:00`;$e.start={dateTime:Dt,timeZone:st},$e.end={dateTime:Xt,timeZone:st}}if($e.start)try{const It=await No(Ge,bt,$e);if(It){const Dt=JSON.parse(localStorage.getItem("task_google_map")||"{}");Dt[$]={evtId:It,calId:bt},localStorage.setItem("task_google_map",JSON.stringify(Dt)),x({msg:"Google ",type:"info"})}}catch(It){console.error("[Google Sync] Creation failed",It);const Dt=JSON.parse(localStorage.getItem("task_google_map")||"{}");((yt=Dt[$])==null?void 0:yt.evtId)==="PENDING"&&(delete Dt[$],localStorage.setItem("task_google_map",JSON.stringify(Dt))),x({msg:"Google ",type:"error"})}}).catch(Je=>{var $e;console.error("Fetch calendars failed",Je);const te=JSON.parse(localStorage.getItem("task_google_map")||"{}");(($e=te[$])==null?void 0:$e.evtId)==="PENDING"&&(delete te[$],localStorage.setItem("task_google_map",JSON.stringify(te)))})}}}if(he.length>0&&await je.from("tasks").update({completed_at:z.completed_at,status:"completed"}).in("id",he),L.length>0&&await je.from("tasks").update({parent_id:$}).in("id",L),J&&(U!=null&&U.repeat_rule)&&U.repeat_rule.triggerMode!=="on_schedule"){const Ne=P6(U.start_date||new Date().toISOString(),U.repeat_rule);if(Ne){const Be={user_id:U.user_id,title:U.title,description:U.repeat_rule.copyDescription!==!1?U.description:null,status:"todo",parent_id:U.parent_id,start_date:Ne,due_date:null,is_project:U.is_project,tags:U.tags,color:U.color,order_index:U.order_index,is_all_day:U.is_all_day,start_time:U.is_all_day?null:U.start_time,end_time:U.is_all_day?null:U.end_time,duration:U.duration,reminder_minutes:U.reminder_minutes!==void 0?U.reminder_minutes:null,repeat_rule:U.repeat_rule},{data:ke,error:Re}=await je.from("tasks").insert(Be).select().single();if(ke&&!Re){s(kt=>{const dt=[...kt,ke];return G.current=dt,dt});const Ge=L6(U.repeat_rule,(ue==null?void 0:ue.language)||"zh");x({msg:`  (${Ge})`,type:"info"})}}}m("synced")},Un=async($,z)=>{if(!je||$.length===0)return;const L=$.filter(({id:Ye})=>{const Ne=G.current.find(Be=>Be.id===Ye);return Ne&&ft(Ne)});L.length>0&&(console.warn("[batchUpdateTasks] BLOCKED:",L.length,"tasks are locked via Google tag"),x({msg:`${L.length}  Google `,type:"error"}));const V=$.filter(({id:Ye})=>{const Ne=G.current.find(Be=>Be.id===Ye);return!Ne||!ft(Ne)});if(V.length===0)return;const U=V;if(m("syncing"),ie==="inbox"){const Ye=a.find(dt=>dt.name.trim().toLowerCase()==="project"),Ne=a.find(dt=>dt.name.includes("")),Be=a.find(dt=>dt.name.trim().toLowerCase()==="note"),ke=a.find(dt=>dt.name.trim().toLowerCase()==="prompt"),Re=a.find(dt=>dt.name==="#prompt"),Ge=a.find(dt=>dt.name.trim().toLowerCase()==="journal"),kt=a.find(dt=>dt.name.trim().toLowerCase()==="someday");U.forEach(({id:dt,data:bt})=>{const Je=G.current.find(te=>te.id===dt);if(Je&&!Je.parent_id){const te=bt.tags||Je.tags||[],$e=Je.tags||[],rt=bt.tags&&(Ye&&te.includes(Ye.id)&&!$e.includes(Ye.id)||Ne&&te.includes(Ne.id)&&!$e.includes(Ne.id)||Be&&te.includes(Be.id)&&!$e.includes(Be.id)||ke&&te.includes(ke.id)&&!$e.includes(ke.id)||Re&&te.includes(Re.id)&&!$e.includes(Re.id)||Ge&&te.includes(Ge.id)&&!$e.includes(Ge.id)||kt&&te.includes(kt.id)&&!$e.includes(kt.id)),st=bt.status&&(bt.status==="someday"||bt.status==="waiting")&&Je.status!=="someday"&&Je.status!=="waiting";(bt.start_date&&!Je.start_date||bt.due_date&&!Je.due_date||bt.parent_id&&!Je.parent_id||rt||st)&&!it.current.includes(dt)&&hn(dt)}})}const J=JSON.parse(localStorage.getItem("task_google_map")||"{}"),he=U.map(Ye=>{const{google_event_id:Ne,google_calendar_id:Be,...ke}=Ye.data;return Ne&&Be&&(J[Ye.id]={evtId:Ne,calId:Be}),{id:Ye.id,data:ke}});localStorage.setItem("task_google_map",JSON.stringify(J));const Oe=localStorage.getItem("google_access_token"),Ke=[];let Qe=!1;Oe&&$.forEach(({id:Ye,data:Ne})=>{const Be=G.current.find(ke=>ke.id===Ye);if(Be&&Be.status==="deleted"&&Ne.status&&Ne.status!=="deleted"&&!J[Ye]){const ke={...Be,...Ne};ke.start_date&&(ke.start_time||ke.is_all_day)&&(Qe=!0,Ke.push((async()=>{try{console.log("[batchUpdateTasks] Restoring Google Event for:",Ye);const Ge={summary:ke.title,description:ke.description||""},kt=ke.start_date.split("T")[0];if(ke.is_all_day){Ge.start={date:kt};const dt=new Date(kt);dt.setDate(dt.getDate()+1),Ge.end={date:dt.toISOString().split("T")[0]}}else if(ke.start_time){const dt=ke.start_time.length>5?ke.start_time.substring(0,5):ke.start_time,bt=`${kt}T${dt}:00`;let Je="";if(ke.end_time)Je=ke.end_time.length>5?ke.end_time.substring(0,5):ke.end_time;else{const rt=new Date(bt);rt.setHours(rt.getHours()+1);const st=String(rt.getHours()).padStart(2,"0"),yt=String(rt.getMinutes()).padStart(2,"0");Je=`${st}:${yt}`}const te=`${kt}T${Je}:00`,$e=Intl.DateTimeFormat().resolvedOptions().timeZone;Ge.start={dateTime:bt,timeZone:$e},Ge.end={dateTime:te,timeZone:$e}}if(Ge.start){const dt=await No(Oe,"primary",Ge);dt&&(J[Ye]={evtId:dt,calId:"primary"})}}catch(Ge){console.error("[batchUpdateTasks] Restore Error",Ge)}})()))}}),Qe&&(x({msg:" Google ...",type:"info"}),await Promise.all(Ke),localStorage.setItem("task_google_map",JSON.stringify(J)));const at=[];let xt=!1;Oe&&$.forEach(({id:Ye,data:Ne})=>{const Be=G.current.find(kt=>kt.id===Ye);if(!Be||Ne.status==="deleted"||Be.status==="deleted"&&Ne.status&&Ne.status!=="deleted")return;const Re={...Be,...Ne},Ge=J[Ye];if(Ge){const kt={};if(Ne.title&&(kt.summary=Ne.title),Ne.description!==void 0&&(kt.description=Ne.description),Ne.start_date||Ne.start_time||Ne.end_time||Ne.is_all_day!==void 0){const Je=new Date(Re.start_date).toLocaleDateString("en-CA"),te=Intl.DateTimeFormat().resolvedOptions().timeZone;if(console.log("[Batch Sync] Date change detected:",{taskId:Ye,is_all_day:Re.is_all_day,start_time:Re.start_time,end_time:Re.end_time,dateStr:Je}),Re.is_all_day){kt.start={date:Je};const $e=new Date(Je);$e.setDate($e.getDate()+1),kt.end={date:$e.toLocaleDateString("en-CA")}}else{const $e=Re.start_time||"09:00",rt=Re.end_time||"10:00",st=$e.length>5?$e.substring(0,5):$e,yt=`${Je}T${st}:00`,It=rt.length>5?rt.substring(0,5):rt;kt.end={dateTime:`${Je}T${It}:00`,timeZone:te},kt.start={dateTime:yt,timeZone:te}}console.log("[Batch Sync] Payload constructed:",JSON.stringify(kt,null,2))}if(Ne.is_all_day!==void 0&&Be.is_all_day!==Ne.is_all_day&&kt.start&&kt.end){console.log("[Batch Sync] Event TYPE change detected (is_all_day:",Be.is_all_day,"->",Ne.is_all_day,"), using delete+create"),xt=!0,jn.current=!0;const Je=Ge.evtId;Ln.current.add(Je),console.log("[Batch Sync] Marked old event as replaced:",Je),at.push((async()=>{try{await ia(Oe,Ge.calId,Je),console.log("[Batch Sync] Old event deleted");const te={summary:Re.title,description:Re.description||"",start:kt.start,end:kt.end},$e=await No(Oe,Ge.calId,te);console.log("[Batch Sync] New event created:",$e),Ln.current.add($e),console.log("[Batch Sync] Marked new event to skip in sync:",$e);const rt=JSON.parse(localStorage.getItem("task_google_map")||"{}");rt[Ye]={evtId:$e,calId:Ge.calId},localStorage.setItem("task_google_map",JSON.stringify(rt)),J[Ye]={evtId:$e,calId:Ge.calId},console.log("[Batch Sync] Event type change completed successfully")}catch(te){console.error("[Batch Sync] Failed to recreate event:",te.message)}finally{jn.current=!1}})())}else Object.keys(kt).length>0&&(xt=!0,at.push(Qx(Oe,Ge.calId,Ge.evtId,kt).then(()=>console.log("[Batch Sync] Update success for task:",Ye)).catch(async Je=>{const te=Je.message||"";console.error("[Batch Sync] Update failed for task:",Ye,"Error:",te)})))}else{const kt=Ne.tags!==void 0?Ne.tags:Be.tags||[],dt=a.find(Je=>kt.includes(Je.id)&&Je.name.startsWith("Google:")),bt=Re.start_date&&(Re.start_time||Re.is_all_day);dt&&bt&&(xt=!0,at.push((async()=>{try{const Je=dt.name.replace("Google:","").trim();let te="primary";const rt=(await bl(Oe)).find(Dt=>Dt.summary===Je);rt&&(te=rt.id);const st={summary:Re.title,description:Re.description||""},yt=new Date(Re.start_date).toLocaleDateString("en-CA"),It=Intl.DateTimeFormat().resolvedOptions().timeZone;if(Re.is_all_day){st.start={date:yt};const Dt=new Date(yt);Dt.setDate(Dt.getDate()+1),st.end={date:Dt.toLocaleDateString("en-CA")}}else if(Re.start_time){const Dt=Re.start_time.length>5?Re.start_time.substring(0,5):Re.start_time,Bt=`${yt}T${Dt}:00`;let Xt="";if(Re.end_time)Xt=Re.end_time.length>5?Re.end_time.substring(0,5):Re.end_time;else{const on=new Date(Bt);on.setHours(on.getHours()+1);const an=String(on.getHours()).padStart(2,"0"),Rn=String(on.getMinutes()).padStart(2,"0");Xt=`${an}:${Rn}`}st.start={dateTime:Bt,timeZone:It},st.end={dateTime:`${yt}T${Xt}:00`,timeZone:It}}if(st.start){const Dt=await No(Oe,te,st);Dt&&(J[Ye]={evtId:Dt,calId:te})}}catch(Je){console.error("Batch Create Fail",Je)}})()))}}),xt&&(x({msg:" Google...",type:"info"}),await Promise.all(at),localStorage.setItem("task_google_map",JSON.stringify(J)));const lt=[];he.forEach(({id:Ye,data:Ne})=>{Rt(Ye);const Be=G.current.find(ke=>ke.id===Ye);if(Be){const ke={};Object.keys(Ne).forEach(Re=>{ke[Re]=Be[Re]}),lt.push({id:Ye,before:ke,after:Ne})}}),lt.length>0&&!(z!=null&&z.skipHistory)&&Pn({type:"BATCH_UPDATE",payload:lt});const mt=new Date().toISOString();s(Ye=>{const Ne=Ye.map(Be=>{const ke=he.find(Re=>Re.id===Be.id);return ke?{...Be,...ke.data,updated_at:mt}:Be});return G.current=Ne,Ne}),await Promise.all(he.map(({id:Ye,data:Ne})=>je.from("tasks").update(Ne).eq("id",Ye))),m("synced")},ji=async($,z=!1)=>{if($.length===0)return;const L=$.filter(he=>{const Oe=G.current.find(Ke=>Ke.id===he);return Oe&&ft(Oe)});L.length>0&&(console.warn("[batchDeleteTasks] BLOCKED:",L.length,"tasks are locked via Google tag"),x({msg:`${L.length}  Google `,type:"error"}));const V=$.filter(he=>{const Oe=G.current.find(Ke=>Ke.id===he);return!Oe||!ft(Oe)});if(V.length===0)return;const U=V;if(m("syncing"),!z){const he=JSON.parse(localStorage.getItem("task_google_map")||"{}"),Oe=localStorage.getItem("google_access_token");let Ke=0;if(Oe){const xt=U.map(async lt=>{const mt=he[lt];if(mt)try{console.log("[batchDeleteTasks] Deleting Google Event:",mt.evtId),await ia(Oe,mt.calId,mt.evtId),delete he[lt],Ke++}catch(Ye){console.error("[batchDeleteTasks] Google Delete Error:",Ye)}});await Promise.all(xt),Ke>0&&localStorage.setItem("task_google_map",JSON.stringify(he))}const Qe=U.map(xt=>({id:xt,data:{status:"deleted"}}));await Un(Qe);const at=Ke>0?` ${U.length}  ( ${Ke}  Google )`:` ${U.length} `;x({msg:at,undo:()=>Jn()});return}const J=G.current.filter(he=>U.includes(he.id));if(J.length===0){m("synced");return}if(je)for(const he of J){if(he.attachments&&he.attachments.length>0)for(const Oe of he.attachments)try{const Qe=new URL(Oe.url).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(Qe){const at=Qe[1];await je.storage.from("attachments").remove([at])}}catch(Ke){console.warn("Failed to delete attachment:",Ke)}if(he.images&&he.images.length>0)for(const Oe of he.images)try{const Qe=new URL(Oe).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(Qe){const at=Qe[1];await je.storage.from("attachments").remove([at])}}catch(Ke){console.warn("Failed to delete image:",Ke)}}if(Pn({type:"BATCH_DELETE",payload:{data:J}}),s(he=>{const Oe=he.filter(Ke=>!$.includes(Ke.id));return G.current=Oe,Oe}),je)for(let Oe=0;Oe<$.length;Oe+=100){const Ke=$.slice(Oe,Oe+100),{error:Qe}=await je.from("tasks").delete().in("id",Ke);Qe&&console.error("Batch delete chunk error:",Qe)}m("synced"),x({msg:` ${$.length} `,type:"info"})},oc=async($,z=!1)=>{console.warn("[deleteTask] CALLED! id:",$,"permanent:",z);const L=r.find(V=>V.id===$);if(L&&ft(L)){console.warn("[deleteTask] BLOCKED: Task is locked via Google tag:",$),x({msg:" Google ",type:"error"});return}if(m("syncing"),Rt($),!z){if(L){console.log("[deleteTask] Soft deleting task:",$);const V=JSON.parse(localStorage.getItem("task_google_map")||"{}"),U=V[$];if(U){x({msg:" Google ...",type:"info"});const J=localStorage.getItem("google_access_token");J&&(console.log("[deleteTask] Found Google Event, deleting:",U.evtId),ia(J,U.calId,U.evtId).then(()=>{console.log("[deleteTask] Google Event deleted successfully"),x({msg:"Google ",type:"info"}),delete V[$],localStorage.setItem("task_google_map",JSON.stringify(V))}).catch(he=>{console.error("[deleteTask] Google Delete Error:",he),x({msg:"Google : "+he.message,type:"error"})}))}else console.warn("[deleteTask] No Google mapping found for task:",$);await Pr($,{status:"deleted"}),x({msg:" (v2)",undo:()=>Jn()})}return}if(L!=null&&L.attachments&&L.attachments.length>0&&je)for(const V of L.attachments)try{const J=new URL(V.url).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(J){const he=J[1];await je.storage.from("attachments").remove([he])}}catch(U){console.warn("Failed to delete attachment:",U)}if(L!=null&&L.images&&L.images.length>0&&je)for(const V of L.images)try{const J=new URL(V).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(J){const he=J[1];await je.storage.from("attachments").remove([he])}}catch(U){console.warn("Failed to delete image:",U)}if(L&&Pn({type:"DELETE",payload:{data:L}}),s(V=>{const U=V.filter(J=>J.id!==$);return G.current=U,U}),je){const{error:V}=await je.from("tasks").delete().eq("id",$);if(V){ct(V),L&&s(U=>{const J=[L,...U];return G.current=J,J});return}else if(L){const J=JSON.parse(localStorage.getItem("task_google_map")||"{}")[L.id];if(J){const he=localStorage.getItem("google_access_token");he&&ia(he,J.calId,J.evtId).then(()=>x({msg:"Google ",type:"info"})).catch(Oe=>console.error("Google Delete Error",Oe))}}}m("synced"),x({msg:"",type:"info"})},ii=async $=>{const z=r.find(L=>L.id===$);z&&z.status==="deleted"&&(await Pr($,{status:"inbox"}),x({msg:" Inbox",type:"info"}))},Nr=async()=>{const $=r.filter(L=>L.status==="deleted");if($.length===0)return;const z=$.map(L=>({id:L.id,data:{status:"inbox"}}));await Un(z),x({msg:"",type:"info",undo:()=>Jn()})},ce=async()=>{const $=r.filter(z=>z.status==="deleted");$.length!==0&&await ji($.map(z=>z.id),!0)},St=async $=>{if(!je)return;const z=new Date().toISOString();s(L=>L.map(V=>V.id===$?{...V,reviewed_at:z}:V)),await je.from("tasks").update({reviewed_at:z}).eq("id",$),x({msg:"",type:"info"})},At=async($,z=null)=>{if(!je||!$.trim())return null;const L=ll(),U=a.filter(at=>at.parent_id===z).reduce((at,xt)=>Math.max(at,xt.order_index||0),0)+1e4,J=a.find(at=>at.id===z),he=(J==null?void 0:J.color)||"#6366f1",Oe={id:L,name:$,parent_id:z,user_id:e.id,color:he,order_index:U};Pn({type:"ADD_TAG",payload:{data:Oe}}),l(at=>[...at,Oe].sort((xt,lt)=>(xt.order_index||0)-(lt.order_index||0)));const{data:Ke,error:Qe}=await je.from("tags").insert([{name:$,parent_id:z,user_id:e.id,color:he,order_index:U}]).select();return Qe?(l(at=>at.filter(xt=>xt.id!==L)),null):(l(at=>{const xt=Ke[0];return at.some(mt=>mt.id===xt.id)?at.filter(mt=>mt.id!==L):at.map(mt=>mt.id===L?xt:mt).sort((mt,Ye)=>(mt.order_index||0)-(Ye.order_index||0))}),Ke[0].id)},Pt=async($,z)=>{if(!je)return;const L=a.find(V=>V.id===$);if(L){const V={};Object.keys(z).forEach(U=>V[U]=L[U]),Pn({type:"UPDATE_TAG",payload:{id:$,before:V,after:z}})}l(V=>V.map(U=>U.id===$?{...U,...z}:U).sort((U,J)=>(U.order_index||0)-(J.order_index||0))),await je.from("tags").update(z).eq("id",$)},jt=async $=>{if(!je)return;const z=a.find(L=>L.id===$);z&&Pn({type:"DELETE_TAG",payload:{data:z}}),l(L=>L.filter(V=>V.id!==$)),await je.from("tags").delete().eq("id",$)},Zt=($,z)=>{W(L=>{const V=L.includes($),U=z!==void 0?z?V?L:[...L,$]:L.filter(J=>J!==$):V?L.filter(J=>J!==$):[...L,$];return e!=null&&e.id&&localStorage.setItem(`expanded_tasks_${e.id}`,JSON.stringify(U)),U})},kn=$=>{Fe(z=>{const L=typeof $=="function"?$(z):$;return e!=null&&e.id&&localStorage.setItem(`last_view_${e.id}`,L),L!==z&&Ve([]),L})},sr=$=>{me($),e!=null&&e.id&&localStorage.setItem(`sidebar_width_${e.id}`,$.toString())},An=()=>qe($=>!$),xn=$=>{Z(z=>{const L=typeof $=="function"?$(z):$;return e!=null&&e.id&&localStorage.setItem(`expanded_tags_${e.id}`,JSON.stringify(L)),L})},hn=$=>{Ve(z=>z.includes($)?z:[...z,$])},Hn=()=>{Ve([])},ir=$=>{re(z=>{const L=typeof $=="function"?$(z):$;return e!=null&&e.id&&localStorage.setItem(`theme_settings_${e.id}`,JSON.stringify(L)),L})},Ii=async($,z)=>{const L=new Date,V=L.getFullYear(),U=String(L.getMonth()+1).padStart(2,"0"),J=String(L.getDate()).padStart(2,"0"),he=`${V}-${U}-${J}`,Oe=mt=>a.find(Ye=>mt.some(Ne=>Ye.name.trim().toLowerCase()===Ne.toLowerCase())),Ke=Oe(["project",""]),Qe=Oe(["someday"]),at=Oe(["journal","note","",""]),xt=Oe(["prompt",""]);for(const mt of $){const Ye=G.current.find(Ne=>Ne.id===mt);if(Ye)switch(z){case"today":case"newtable":await Pr(mt,{start_date:he});break;case"project":if(Ke){const Ne=Ye.tags.includes(Ke.id)?Ye.tags:[...Ye.tags,Ke.id];await Pr(mt,{tags:Ne}),G.current.some(ke=>ke.parent_id===mt&&ke.status!=="deleted")||await _o({title:"",parent_id:mt,status:"active",importance:null,tags:[],notes:"",start_date:null,due_date:null})}break;case"waiting":if(Qe){const Ne=Ye.tags.includes(Qe.id)?Ye.tags:[...Ye.tags,Qe.id];await Pr(mt,{tags:Ne,status:"someday"})}else await Pr(mt,{status:"someday"});break;case"journal":if(at){const Ne=Ye.tags.includes(at.id)?Ye.tags:[...Ye.tags,at.id];await Pr(mt,{tags:Ne})}break;case"prompt":if(xt){const Ne=Ye.tags.includes(xt.id)?Ye.tags:[...Ye.tags,xt.id];await Pr(mt,{tags:Ne})}break}}v([]),k(null);const lt={today:"",newtable:"",project:"",waiting:"/",journal:"",prompt:""};x({msg:` ${$.length} ${lt[z]||z}`,type:"info"})},oi=b.useRef(!1),jn=b.useRef(!1),Ln=b.useRef(new Set),gr=async()=>{var z,L,V,U,J,he;if(console.log("[Google Sync] Attempting sync..."),oi.current){console.log("[Google Sync] Already syncing, skipping.");return}if(jn.current){console.log("[Google Sync] Event recreation in progress, skipping to avoid conflicts.");return}let $=localStorage.getItem("google_access_token");if(!$){console.log("[Google Sync] No token found, skipping.");return}try{const Oe=await fetch("https://www.googleapis.com/calendar/v3/users/me/calendarList?maxResults=1",{headers:{Authorization:`Bearer ${$}`}});if(Oe.status===401){console.log("[Google Sync] Token expired, attempting silent refresh...");const Ke=localStorage.getItem("google_client_id");if(Ke&&((L=(z=window.google)==null?void 0:z.accounts)!=null&&L.oauth2))try{const Qe=await new Promise(at=>{window.google.accounts.oauth2.initTokenClient({client_id:Ke,scope:"https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar.readonly",callback:lt=>{lt.error?(console.log("[Google Sync] Silent refresh failed:",lt.error),at(null)):(console.log("[Google Sync] Silent refresh successful!"),at(lt.access_token))}}).requestAccessToken({prompt:""}),setTimeout(()=>at(null),5e3)});if(Qe)$=Qe,localStorage.setItem("google_access_token",Qe),console.log("[Google Sync] Token refreshed successfully");else{console.error("[Google Sync] Silent refresh returned no token"),x({msg:"Google  Google ",type:"error"}),localStorage.removeItem("google_access_token");return}}catch(Qe){console.error("[Google Sync] Silent refresh error:",Qe),x({msg:"Google  Google ",type:"error"}),localStorage.removeItem("google_access_token");return}else{console.log("[Google Sync] Google script not loaded, attempting to load...");try{const{loadGoogleScript:Qe}=await dw(()=>Promise.resolve().then(()=>$6),void 0);await Qe(),x({msg:"Google  Google ",type:"error"})}catch{x({msg:"Google  Google ",type:"error"})}localStorage.removeItem("google_access_token");return}}else if(!Oe.ok){console.error("[Google Sync] Token validation failed:",Oe.status),x({msg:"Google API ",type:"error"});return}}catch(Oe){console.error("[Google Sync] Token validation error:",Oe),x({msg:" Google ",type:"error"});return}console.log("[Google Sync] Starting sync..."),console.log("[Google Sync] replacedEventIdsRef has",Ln.current.size,"entries:",Array.from(Ln.current)),oi.current=!0;try{const Oe=JSON.parse(localStorage.getItem("task_google_map")||"{}"),Ke=new Set;Object.values(Oe).forEach(ke=>{ke.calId&&Ke.add(ke.calId)});let Qe=[];try{window.google_calendar_list_cache?Qe=window.google_calendar_list_cache:(Qe=await bl($),window.google_calendar_list_cache=Qe)}catch(ke){console.error("[Google Sync] List Calendars Check failed",ke)}const at=a.filter(ke=>ke.name.startsWith("Google:"));if(console.log("[Google Sync] Found Google tags:",at.map(ke=>ke.name)),Qe.length>0){const ke=a.filter(Re=>Re.name.startsWith("Google:")).map(Re=>Re.name.replace("Google:","").trim());console.log("[Google Sync] Tag names to match:",ke),ke.forEach(Re=>{const Ge=Qe.find(kt=>kt.summary===Re);console.log(`[Google Sync] Matching "${Re}" -> ${Ge?Ge.id:"NOT FOUND"}`),Ge&&Ke.add(Ge.id)})}else console.log("[Google Sync] No calendars to match against");const xt=JSON.parse(localStorage.getItem("google_sync_tokens")||"{}");let lt=[...G.current];const mt={...Oe};let Ye=!1;console.log("[Google Sync] Syncing calendars:",Array.from(Ke));for(const ke of Array.from(Ke)){const Re=xt[ke];console.log(`[Google Sync] Checking calendar: ${ke}, hasToken: ${!!Re}`);try{const{events:Ge,nextSyncToken:kt,fullSyncRequired:dt}=await xI($,ke,Re);if(console.log(`[Google Sync] Calendar ${ke}: ${Ge.length} events, fullSyncRequired: ${dt}`),dt){console.log(`[Google Sync] Full sync required for ${ke}, will retry next time.`),delete xt[ke];continue}if(kt&&(xt[ke]=kt),Ge.length>0){console.log(`[Google Sync] Got ${Ge.length} updates for ${ke}:`,Ge.map(bt=>({id:bt.id,summary:bt.summary,status:bt.status}))),Ye=!0;for(const bt of Ge){if(Ln.current.has(bt.id)){console.log("[Google Sync] Ignoring replaced event (type change in progress):",bt.id);continue}const Je=Object.keys(mt).find(te=>mt[te].evtId===bt.id);if(console.log(`[Google Sync] Processing event: "${bt.summary}" (${bt.id})`,{hasMapping:!!Je,mappedTaskId:Je||"none",eventStatus:bt.status}),bt.status==="cancelled"){if(Je){const te=mt[Je];if(te&&te.calId===ke){const $e=lt.find(rt=>rt.id===Je);$e&&$e.status!=="deleted"&&(Rt(Je),lt=lt.map(rt=>rt.id===Je?{...rt,status:"deleted"}:rt),je&&await je.from("tasks").update({status:"deleted"}).eq("id",Je),console.log("[Google Auto-Sync] Deleted Task",Je,"from calendar",ke))}else console.log(`[Google Sync] Ignored deletion of ${Je} from ${ke} (mapped to ${te==null?void 0:te.calId})`)}}else{const te=bt.summary||"(No Title)",$e=bt.description||"";let rt=null,st=null,yt=null,It=!1;if(bt.start.date)It=!0,rt=bt.start.date;else if(bt.start.dateTime){const Dt=new Date(bt.start.dateTime);rt=Dt.toLocaleDateString("en-CA"),st=Dt.toTimeString().substring(0,5),bt.end.dateTime&&(yt=new Date(bt.end.dateTime).toTimeString().substring(0,5))}if(rt)if(Je){const Dt=lt.findIndex(Bt=>Bt.id===Je);if(Dt!==-1){const Bt=lt[Dt],Xt=Bt.status==="deleted",on=Bt.title!==te||Bt.description!==$e||((V=Bt.start_date)==null?void 0:V.split("T")[0])!==rt||(Bt.start_time||"").substring(0,5)!==(st||"")||(Bt.end_time||"").substring(0,5)!==(yt||"")||Bt.is_all_day!==It||Xt;console.log(`[Google Sync] Checking update for "${te}": changed=${on}, isDeleted=${Xt}`,{oldTitle:Bt.title,newTitle:te,oldDate:(U=Bt.start_date)==null?void 0:U.split("T")[0],newDate:rt,oldIsAllDay:Bt.is_all_day,newIsAllDay:It,oldStartTime:Bt.start_time,newStartTime:st});const an=(J=mt[Je])==null?void 0:J.calId,Rn=an&&an!==ke;if(on||Rn){const yr={title:te,description:$e,start_date:rt,is_all_day:It,status:"todo"};st&&(yr.start_time=st),yt&&(yr.end_time=yt);let Qn=[...Bt.tags||[]];if(Qe.length>0){const ac=Qe.find(Xi=>Xi.id===ke)||(ke==="primary"?Qe.find(Xi=>Xi.primary):null);if(ac){const Xi=`Google:${ac.summary}`,Fu=a.find(lc=>lc.name===Xi);if(Rn){const lc=a.filter(il=>il.name.startsWith("Google:")).map(il=>il.id);Qn=Qn.filter(il=>!lc.includes(il)),console.log("[Google Sync] Calendar changed from",an,"to",ke)}Fu&&!Qn.includes(Fu.id)&&(Qn.push(Fu.id),console.log("[Google Sync] Switched tag to:",Xi)),yr.tags=Qn,mt[Je]={evtId:bt.id,calId:ke}}}lt[Dt]={...Bt,...yr},Rt(Je),je&&await je.from("tasks").update(yr).eq("id",Je),console.log("[Google Sync] Updated Task",Je,"with",yr),Ye=!0}}else{console.log(`[Google Sync] Stale mapping for "${te}" (taskId: ${Je}), trying to find by title...`),delete mt[Je];const Bt=a.filter(on=>on.name.startsWith("Google:")).map(on=>on.id),Xt=lt.find(on=>{var an;return on.title===te&&on.status!=="deleted"&&((an=on.tags)==null?void 0:an.some(Rn=>Bt.includes(Rn)))});if(Xt){console.log(`[Google Sync] Found matching task by title: "${te}" -> ${Xt.id}`);const on=lt.findIndex(an=>an.id===Xt.id);if(on!==-1){const an=lt[on],Rn=an.status==="deleted",yr=an.title!==te||an.description!==$e||((he=an.start_date)==null?void 0:he.split("T")[0])!==rt||(an.start_time||"").substring(0,5)!==(st||"")||(an.end_time||"").substring(0,5)!==(yt||"")||an.is_all_day!==It||Rn;if(console.log(`[Google Sync] (Recovered) Checking update for "${te}": changed=${yr}`),yr){const Qn={title:te,description:$e,start_date:rt,is_all_day:It,status:"todo"};st&&(Qn.start_time=st),yt&&(Qn.end_time=yt),lt[on]={...an,...Qn},Rt(Xt.id),je&&await je.from("tasks").update(Qn).eq("id",Xt.id),console.log("[Google Sync] (Recovered) Updated Task",Xt.id,"with",Qn),Ye=!0}mt[Xt.id]={evtId:bt.id,calId:ke},console.log("[Google Sync] Updated mapping:",Xt.id,"->",bt.id)}}else console.log(`[Google Sync] No matching task found for "${te}", will be created on next sync if tag exists`)}}else{const Dt=JSON.parse(localStorage.getItem("task_google_map")||"{}");if(Object.values(Dt).some(Rn=>Rn.evtId===bt.id)){console.log("[Google Sync] Event already mapped (found in fresh check), skipping creation:",bt.id);continue}let Xt=[],on=!1;if(Qe.length>0){let Rn=Qe.find(yr=>yr.id===ke);if(!Rn&&ke==="primary"&&(Rn=Qe.find(yr=>yr.primary===!0)),Rn){const yr=`Google:${Rn.summary}`,Qn=a.find(ac=>ac.name===yr);Qn?(Xt.push(Qn.id),console.log("[Google Sync] Assigned tag:",yr,"to new task:",te),on=!0):console.log("[Google Sync] Tag not found:",yr,"- skipping creation")}}if(!on)continue;const an={user_id:e==null?void 0:e.id,title:te,description:$e,status:"todo",start_date:rt,start_time:st,end_time:yt,is_all_day:It,tags:Xt,order_index:0};if(je&&e){const{data:Rn}=await je.from("tasks").insert(an).select().single();Rn&&(lt.push(Rn),mt[Rn.id]={evtId:bt.id,calId:ke},console.log("[Google Sync] Created Task",Rn.id,"with mapping:",{evtId:bt.id,calId:ke},"title:",te))}}}}}}catch{}}Ye&&(lt.sort((ke,Re)=>(ke.order_index||0)-(Re.order_index||0)||ke.created_at.localeCompare(Re.created_at)),s(lt),x({msg:"Google ",type:"info"}));const Be={...JSON.parse(localStorage.getItem("task_google_map")||"{}"),...mt};localStorage.setItem("task_google_map",JSON.stringify(Be)),localStorage.setItem("google_sync_tokens",JSON.stringify(xt)),console.log("[Google Sync] Saved",Object.keys(mt).length,"mappings. Total:",Object.keys(Be).length)}finally{console.log("[Google Sync] Sync completed."),oi.current=!1,Ln.current.size>0&&(console.log("[Google Sync] Cleared",Ln.current.size,"replaced event IDs"),Ln.current.clear())}};return b.useEffect(()=>{if(console.log("[Google Sync] useEffect running, user:",!!e),!e)return;console.log("[Google Sync] Setting up 60s interval and 3s initial timeout...");const $=setInterval(()=>{console.log("[Google Sync] 60s interval triggered"),gr()},6e4),z=setTimeout(()=>{console.log("[Google Sync] Initial 3s timeout triggered"),gr()},3e3);return()=>{console.log("[Google Sync] Cleaning up interval and timeout"),clearInterval($),clearTimeout(z)}},[e,a]),c.jsx(Tn.Provider,{value:{user:e,tasks:r,tags:a,visibleTasks:mn,loading:u,syncStatus:p,dragState:ae,startDrag:si,updateDropState:nl,endDrag:rl,updateGhostPosition:Zo,addTask:_o,batchAddTasks:sl,duplicateTasks:Xn,updateTask:Pr,batchUpdateTasks:Un,deleteTask:oc,batchDeleteTasks:ji,addTag:At,updateTag:Pt,deleteTag:jt,keyboardMove:So,smartReschedule:Cn,lockTask:nn,unlockTask:cn,verifyTaskPassword:Ee,temporarilyUnlockTask:O,archiveCompletedTasks:Tt,archivedTasks:i,restoreArchivedTask:Ft,deleteArchivedTask:Lt,updateArchivedTask:Wt,batchDeleteArchivedTasks:un,clearAllTasks:wn,exportData:yn,importData:Er,syncGoogleToApp:gr,undo:Jn,redo:Nn,canUndo:ge.length>0,canRedo:be.length>0,logout:Or,navigateToTask:Ni,navigateBack:tl,canNavigateBack:ot.length>0,toast:y,setToast:x,selectedTaskIds:g,setSelectedTaskIds:v,handleSelection:ko,selectionAnchor:w,setSelectionAnchor:T,focusedTaskId:D,setFocusedTaskId:k,editingTaskId:j,setEditingTaskId:N,inlineEditingTaskId:ye,setInlineEditingTaskId:ze,expandedTaskIds:P,setExpandedTaskIds:W,toggleExpansion:Zt,view:ie,setView:kn,tagFilter:_e,setTagFilter:tt,advancedFilters:Ue,setAdvancedFilters:K,themeSettings:ue,setThemeSettings:ir,calculateVisibleTasks:Qo,pendingFocusTaskId:Se,setPendingFocusTaskId:Pe,leavingTaskIds:Xe,addLeavingTask:hn,dismissLeavingTasks:Hn,initError:f,sidebarWidth:vt,setSidebarWidth:sr,sidebarCollapsed:He,toggleSidebar:An,expandedTags:q,setExpandedTags:xn,calendarDate:Ze,setCalendarDate:gt,taskCounts:fe,focusSplitWidth:nt,setFocusSplitWidth:Me,reviewTask:St,restoreTask:ii,restoreTrash:Nr,emptyTrash:ce,moveTaskToView:Ii,isCmdPressed:ut,tagsWithResolvedColors:De,language:oe,setLanguage:pe,t:se,viewTagFilters:R,updateViewTagFilter:le,constructionModeEnabled:we,setConstructionModeEnabled:B,searchHistory:X,addSearchHistory:rr,deleteSearchHistory:ys,searchOpen:A,setSearchOpen:Te,lockedGoogleTagIds:F,toggleGoogleTagLock:We,isTaskGoogleLocked:ft},children:t})},Du=b.createContext({isRecording:!1,recordingTime:0,startRecording:async()=>{},stopRecording:()=>{},cancelRecording:()=>{},addMarker:()=>null,recordingTaskId:null,audioMarkers:[],currentRecordingId:null,analyser:null,audioContext:null}),U6=({children:t})=>{b.useContext(Tn);const[e,n]=b.useState(!1),[r,s]=b.useState(0),[i,o]=b.useState(null),[a,l]=b.useState([]),[u,d]=b.useState(null),f=b.useRef(null),h=b.useRef(null),p=b.useRef(null),m=b.useRef(null),y=b.useRef(null),x=b.useRef([]),g=b.useRef(null),v=b.useRef(0),w=b.useRef(e),T=b.useRef(r),D=b.useRef(i),k=b.useRef(a);b.useEffect(()=>{w.current=e,T.current=r,D.current=i,k.current=a},[e,r,i,a]);const I=async N=>{if(e){console.warn("[RecordingContext] Cannot start recording - another recording is already in progress for task:",i);return}try{const j=await navigator.mediaDevices.getUserMedia({audio:!0});y.current=j;const O=new(window.AudioContext||window.webkitAudioContext);h.current=O;const P=O.createAnalyser();P.fftSize=2048,p.current=P;const W=O.createMediaStreamSource(j);W.connect(P),m.current=W;const R=MediaRecorder.isTypeSupported("audio/mp4")?"audio/mp4":"audio/webm",M=new MediaRecorder(j,{mimeType:R,audioBitsPerSecond:32e3});f.current=M,x.current=[];const X=`rec_${Date.now()}_${crypto.randomUUID()}`;d(X),M.ondataavailable=Q=>{Q.data.size>0&&x.current.push(Q.data)},M.onstop=async()=>{const Q=new Blob(x.current,{type:R}),A=R.split("/")[1],Te=new Date,B=`Recording ${`${Te.getFullYear()}.${String(Te.getMonth()+1).padStart(2,"0")}.${String(Te.getDate()).padStart(2,"0")} ${String(Te.getHours()).padStart(2,"0")}:${String(Te.getMinutes()).padStart(2,"0")}`}.${A}`,F=new File([Q],B,{type:R});y.current&&y.current.getTracks().forEach(ft=>ft.stop()),h.current&&h.current.state!=="closed"&&h.current.close();const ne=D.current,We=k.current;ne?(console.log(`[RecordingContext] Saving recording for Task ${ne}`,F,We),window.dispatchEvent(new CustomEvent("audio-recording-completed",{detail:{file:F,taskId:ne,markers:We,duration:T.current,recordingId:X}}))):console.warn("Recording stopped but no Task ID associated."),n(!1),o(null),l([]),s(0),d(null)},M.start(100),n(!0),o(N||null),s(0),l([]),v.current=Date.now(),g.current=setInterval(()=>{const Q=Date.now()-v.current;s(Q)},100)}catch(j){console.error("[RecordingContext] Failed to start recording",j)}},C=()=>{f.current&&f.current.state!=="inactive"&&f.current.stop(),g.current&&(clearInterval(g.current),g.current=null)},S=()=>{f.current&&f.current.state!=="inactive"&&(f.current.onstop=null,f.current.stop()),g.current&&(clearInterval(g.current),g.current=null),y.current&&y.current.getTracks().forEach(N=>N.stop()),h.current&&h.current.state!=="closed"&&h.current.close(),n(!1),o(null),l([]),s(0)},_=()=>{if(!e)return null;const N=r,O={id:`rec-marker-${Date.now()}`,time:N};return l(P=>[...P,O]),O};return c.jsx(Du.Provider,{value:{isRecording:e,recordingTime:r,startRecording:I,stopRecording:C,cancelRecording:S,addMarker:_,recordingTaskId:i,audioMarkers:a,currentRecordingId:u,analyser:p.current,audioContext:h.current},children:t})},wI=b.createContext({reminders:[],addReminder:()=>{},markAsSeen:()=>{},snoozeReminder:()=>{},clearAllSeen:()=>{},clearAllUnseen:()=>{},clearAll:()=>{},unseenCount:0,isReminderPanelOpen:!1,setIsReminderPanelOpen:()=>{}}),l2="app_reminders",c2="app_reminder_signatures",H6=1e4,V6=({children:t})=>{const{tasks:e,setToast:n,user:r}=b.useContext(Tn),[s,i]=b.useState([]),[o,a]=b.useState(!1),[l,u]=b.useState({}),[d,f]=b.useState(!1),h=b.useRef(null),p=b.useRef(!1),m=b.useRef(null),y=b.useRef([]),x=b.useRef({}),g=b.useRef([]),v=b.useRef(!1);b.useEffect(()=>{y.current=s},[s]),b.useEffect(()=>{x.current=l},[l]),b.useEffect(()=>{g.current=e},[e]),b.useEffect(()=>{v.current=d},[d]),b.useEffect(()=>{(async()=>{const N=(r==null?void 0:r.id)||null;if(!(m.current===N&&p.current)){if(!N){i([]),u({}),f(!1),m.current=null,p.current=!0;return}if(m.current=N,je)try{const{data:j,error:O}=await je.from("reminders").select("*").eq("user_id",N).order("triggered_at",{ascending:!1});if(!O&&j){f(!0);const P=j.map(R=>({id:R.id,task_id:R.task_id,task_title:R.task_title,task_color:R.task_color||"gray",triggered_at:R.triggered_at,due_time:R.due_time,seen:R.seen||!1,snoozed_until:R.snoozed_until||null}));i(P);const{data:W}=await je.from("reminder_signatures").select("*").eq("user_id",N);if(W){const R={};W.forEach(M=>{R[M.task_id]=M.signature}),u(R),x.current=R}console.log("[Reminder] Loaded from Supabase:",P.length),p.current=!0;return}}catch(j){console.warn("[Reminder] Supabase load failed, falling back to local:",j)}f(!1);try{const j=localStorage.getItem(l2);j&&i(JSON.parse(j));const O=localStorage.getItem(c2);if(O){const P=JSON.parse(O);u(P),x.current=P}}catch(j){console.error(j)}p.current=!0}})()},[r==null?void 0:r.id]),b.useEffect(()=>{if(!(r!=null&&r.id)||!je)return;if(!d){console.log("[Reminder] Sync disabled, skipping subscription");return}console.log("[Reminder] Subscribing to realtime channels...");const _=je.channel("reminders-sync",{config:{broadcast:{self:!1}}}).on("postgres_changes",{event:"*",schema:"public",table:"reminders",filter:`user_id=eq.${r.id}`},j=>{if(j.eventType==="INSERT"){const O=j.new;i(P=>P.some(W=>W.id===O.id)?P:[{id:O.id,task_id:O.task_id,task_title:O.task_title,task_color:O.task_color||"gray",triggered_at:O.triggered_at,due_time:O.due_time,seen:O.seen||!1,snoozed_until:O.snoozed_until||null},...P])}else if(j.eventType==="UPDATE"){const O=j.new;i(P=>P.map(W=>W.id===O.id?{...W,seen:O.seen||!1,snoozed_until:O.snoozed_until||null}:W))}else if(j.eventType==="DELETE"){const O=j.old;i(P=>P.filter(W=>W.id!==O.id))}}).on("broadcast",{event:"clear-action"},j=>{j.payload.type==="clearSeen"?i(O=>O.filter(P=>!P.seen)):j.payload.type==="clearUnseen"?i(O=>O.filter(P=>P.seen)):j.payload.type==="clearAll"&&i([])}).subscribe(j=>{j==="SUBSCRIBED"&&console.log("[Reminder] Reminders channel subscribed")}),N=je.channel("signatures-sync").on("postgres_changes",{event:"INSERT",schema:"public",table:"reminder_signatures",filter:`user_id=eq.${r.id}`},j=>{const O=j.new;u(P=>P[O.task_id]===O.signature?P:{...P,[O.task_id]:O.signature})}).subscribe(j=>{j==="SUBSCRIBED"&&console.log("[Reminder] Signatures channel subscribed")});return()=>{console.log("[Reminder] Unsubscribing..."),je.removeChannel(_),je.removeChannel(N)}},[r==null?void 0:r.id,d]),b.useEffect(()=>{!p.current||d||localStorage.setItem(l2,JSON.stringify(s))},[s,d]),b.useEffect(()=>{!p.current||d||localStorage.setItem(c2,JSON.stringify(l))},[l,d]);const w=b.useCallback(async(_,N,j=!0)=>{const O=g.current.find(W=>W.id===_);if(!O)return;const P=O.start_date||O.due_date;if(P){if(v.current&&je&&(r!=null&&r.id)){const{error:W}=await je.from("reminder_signatures").insert([{user_id:r.id,task_id:_,signature:N}]);if(W){const{data:M}=await je.from("reminder_signatures").select("signature").eq("user_id",r.id).eq("task_id",_).single();if(M&&M.signature===N){u(X=>({...X,[_]:N}));return}M&&await je.from("reminder_signatures").update({signature:N}).eq("user_id",r.id).eq("task_id",_)}const R=(await dw(()=>import("./index-c620dda6.js"),[])).v4();await je.from("reminders").insert([{id:R,user_id:r.id,task_id:_,task_title:O.title,task_color:O.color,triggered_at:new Date().toISOString(),due_time:P,seen:!1}]),u(M=>({...M,[_]:N}))}else{const W={id:`${_}_${Date.now()}`,task_id:_,task_title:O.title,task_color:O.color,triggered_at:new Date().toISOString(),due_time:P,seen:!1,snoozed_until:null};i(R=>[W,...R]),u(R=>({...R,[_]:N})),j&&(n({type:"info",msg:` : ${O.title}`,actionLabel:"",onClick:()=>a(!0)}),"Notification"in window&&Notification.permission==="granted"&&(new Notification("",{body:O.title,icon:"/favicon.ico"}).onclick=()=>{window.focus(),a(!0)}),a(!0))}v.current&&j&&(n({type:"info",msg:` : ${O.title}`,actionLabel:"",onClick:()=>a(!0)}),"Notification"in window&&Notification.permission==="granted"&&(new Notification("",{body:O.title,icon:"/favicon.ico"}).onclick=()=>{window.focus(),a(!0)}),a(!0))}},[n,r==null?void 0:r.id]),T=b.useCallback(async _=>{i(N=>N.map(j=>j.id===_?{...j,seen:!0}:j)),v.current&&je&&await je.from("reminders").update({seen:!0}).eq("id",_)},[]),D=b.useCallback(async(_,N)=>{const j=new Date(Date.now()+N*60*1e3).toISOString();i(O=>O.map(P=>P.id===_?{...P,snoozed_until:j,seen:!0}:P)),n({type:"info",msg:`  ${N} `}),v.current&&je&&await je.from("reminders").update({snoozed_until:j,seen:!0}).eq("id",_)},[n]),k=b.useCallback(async()=>{const N=y.current.filter(j=>j.seen).map(j=>j.id);i(j=>j.filter(O=>!O.seen)),v.current&&je&&N.length>0&&(await je.channel("reminders-sync").send({type:"broadcast",event:"clear-action",payload:{type:"clearSeen"}}),await je.from("reminders").delete().in("id",N))},[]),I=b.useCallback(async()=>{const N=y.current.filter(j=>!j.seen).map(j=>j.id);i(j=>j.filter(O=>O.seen)),v.current&&je&&N.length>0&&(await je.channel("reminders-sync").send({type:"broadcast",event:"clear-action",payload:{type:"clearUnseen"}}),await je.from("reminders").delete().in("id",N))},[]),C=b.useCallback(async()=>{i([]),v.current&&je&&(r!=null&&r.id)&&(await je.channel("reminders-sync").send({type:"broadcast",event:"clear-action",payload:{type:"clearAll"}}),await je.from("reminders").delete().eq("user_id",r.id))},[r==null?void 0:r.id]),S=b.useCallback(()=>{if(!p.current)return;const _=new Date,N=g.current,j=x.current;N.forEach(O=>{if(["completed","deleted","canceled"].includes(O.status))return;const P=O.start_date||O.due_date;if(!P)return;let W;if(O.is_all_day||!O.start_time)W=new Date(P),P.includes("T")||W.setHours(0,0,0,0);else{const[Q,A]=(O.start_time||"00:00").split(":").map(Number),Te=P.split("T")[0];W=new Date(Te),W.setHours(Q,A,0,0)}let R=O.reminder_minutes;if(R===void 0)try{const Q=localStorage.getItem(`task_reminder_${O.id}`);Q&&(R=JSON.parse(Q))}catch{}if(R===void 0&&!O.is_all_day&&O.start_time&&(R=0),R==null)return;const M=new Date(W.getTime()-R*60*1e3),X=`${W.getTime()}_${R}`;j[O.id]!==X&&_>=M&&w(O.id,X,!0)}),y.current.forEach(async O=>{if(O.snoozed_until){const P=new Date(O.snoozed_until);_>=P&&(N.find(R=>R.id===O.task_id)&&(n({type:"info",msg:` : ${O.task_title}`,actionLabel:"",onClick:()=>a(!0)}),"Notification"in window&&Notification.permission==="granted"&&(new Notification("",{body:O.task_title}).onclick=()=>{window.focus(),a(!0)}),a(!0)),i(R=>R.map(M=>M.id===O.id?{...M,snoozed_until:null,seen:!1}:M)),v.current&&je&&await je.from("reminders").update({snoozed_until:null,seen:!1}).eq("id",O.id))}})},[w,n]);return b.useEffect(()=>{const _=setTimeout(S,2e3);return h.current=setInterval(S,H6),()=>{clearTimeout(_),h.current&&clearInterval(h.current)}},[S]),c.jsx(wI.Provider,{value:{reminders:s,addReminder:w,markAsSeen:T,snoozeReminder:D,clearAllSeen:k,clearAllUnseen:I,clearAll:C,unseenCount:s.filter(_=>!_.seen).length,isReminderPanelOpen:o,setIsReminderPanelOpen:a},children:t})};var W6={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const K6=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),G6=(t,e)=>{const n=b.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:a,...l},u)=>b.createElement("svg",{ref:u,...W6,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:`lucide lucide-${K6(t)}`,...l},[...e.map(([d,f])=>b.createElement(d,f)),...(Array.isArray(a)?a:[a])||[]]));return n.displayName=`${t}`,n};var wt=G6;const Kf=wt("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),q6=wt("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),sm=wt("Archive",[["rect",{width:"20",height:"5",x:"2",y:"4",rx:"2",key:"uhwcea"}],["path",{d:"M4 9v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9",key:"shkvi4"}],["path",{d:"M10 13h4",key:"ytezjc"}]]),vI=wt("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Cw=wt("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),Y6=wt("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),J6=wt("AtSign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),Zx=wt("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Ba=wt("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),mf=wt("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]),X6=wt("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}]]),Q6=wt("Bot",[["rect",{width:"18",height:"10",x:"3",y:"11",rx:"2",key:"1ofdy3"}],["circle",{cx:"12",cy:"5",r:"2",key:"f1ur92"}],["path",{d:"M12 7v4",key:"xawao1"}],["line",{x1:"8",x2:"8",y1:"16",y2:"16",key:"h6x27f"}],["line",{x1:"16",x2:"16",y1:"16",y2:"16",key:"5lty7f"}]]),cd=wt("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),Z6=wt("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]),kI=wt("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]),Go=wt("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),gf=wt("CheckCircle2",[["path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",key:"14v8dr"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),ez=wt("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),Gn=wt("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),es=wt("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Mu=wt("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),ns=wt("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),pp=wt("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),tz=wt("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Ji=wt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),nz=wt("CloudLightning",[["path",{d:"M6 16.326A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 .5 8.973",key:"1cez44"}],["path",{d:"m13 12-3 5h4l-3 5",key:"1t22er"}]]),rz=wt("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),sz=wt("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]),iz=wt("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]),SI=wt("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),oz=wt("CornerDownRight",[["polyline",{points:"15 10 20 15 15 20",key:"1q7qjw"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),_I=wt("CornerUpLeft",[["polyline",{points:"9 14 4 9 9 4",key:"881910"}],["path",{d:"M20 20v-7a4 4 0 0 0-4-4H4",key:"1nkjon"}]]),az=wt("Crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]),ru=wt("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),TI=wt("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),lz=wt("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Gf=wt("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),cz=wt("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),uz=wt("FolderKanban",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]]),dz=wt("FolderOpen",[["path",{d:"m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.93a2 2 0 0 1 1.66.9l.82 1.2a2 2 0 0 0 1.66.9H18a2 2 0 0 1 2 2v2",key:"1nmvlm"}]]),fz=wt("FolderPlus",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["line",{x1:"12",x2:"12",y1:"10",y2:"16",key:"3c25pp"}],["line",{x1:"9",x2:"15",y1:"13",y2:"13",key:"10hoct"}]]),hz=wt("FolderTree",[["path",{d:"M13 10h7a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"10jzg2"}],["path",{d:"M13 21h7a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.88a1 1 0 0 1-.9-.55l-.44-.9a1 1 0 0 0-.9-.55H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"1b9nqm"}],["path",{d:"M3 3v2c0 1.1.9 2 2 2h3",key:"1wqwis"}],["path",{d:"M3 3v13c0 1.1.9 2 2 2h3",key:"1bqeom"}]]),pz=wt("GanttChartSquare",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 8h7",key:"kbo1nt"}],["path",{d:"M8 12h6",key:"ikassy"}],["path",{d:"M11 16h5",key:"oq65wt"}]]),CI=wt("GripHorizontal",[["circle",{cx:"12",cy:"9",r:"1",key:"124mty"}],["circle",{cx:"19",cy:"9",r:"1",key:"1ruzo2"}],["circle",{cx:"5",cy:"9",r:"1",key:"1a8b28"}],["circle",{cx:"12",cy:"15",r:"1",key:"1e56xg"}],["circle",{cx:"19",cy:"15",r:"1",key:"1a92ep"}],["circle",{cx:"5",cy:"15",r:"1",key:"5r1jwy"}]]),EI=wt("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),mz=wt("Hammer",[["path",{d:"m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9",key:"1afvon"}],["path",{d:"M17.64 15 22 10.64",key:"zsji6s"}],["path",{d:"m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25v-.86L16.01 4.6a5.56 5.56 0 0 0-3.94-1.64H9l.92.82A6.18 6.18 0 0 1 12 8.4v1.56l2 2h2.47l2.26 1.91",key:"lehyy1"}]]),im=wt("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),gz=wt("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),yz=wt("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),om=wt("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),e1=wt("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]),NI=wt("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),jI=wt("Layers",[["polygon",{points:"12 2 2 7 12 12 22 7 12 2",key:"1b0ttc"}],["polyline",{points:"2 17 12 22 22 17",key:"imjtdl"}],["polyline",{points:"2 12 12 17 22 12",key:"5dexcv"}]]),II=wt("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),t1=wt("Layout",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"3",x2:"21",y1:"9",y2:"9",key:"1vqk6q"}],["line",{x1:"9",x2:"9",y1:"21",y2:"9",key:"wpwpyp"}]]),xz=wt("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),bz=wt("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),wz=wt("ListTodo",[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]),vz=wt("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),Vi=wt("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),kz=wt("LocateFixed",[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Aa=wt("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Sz=wt("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),_z=wt("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Tz=wt("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),DI=wt("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Cz=wt("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),Ez=wt("MoveRight",[["path",{d:"M18 8L22 12L18 16",key:"1r0oui"}],["path",{d:"M2 12H22",key:"1m8cig"}]]),Ew=wt("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),Nz=wt("PanelLeftClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]]),jz=wt("PanelLeftOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]]),co=wt("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),MI=wt("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),Nw=wt("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),Ig=wt("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),AI=wt("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),xi=wt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),jw=wt("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]),n1=wt("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),RI=wt("Repeat2",[["path",{d:"m2 9 3-3 3 3",key:"1ltn5i"}],["path",{d:"M13 18H7a2 2 0 0 1-2-2V6",key:"1r6tfw"}],["path",{d:"m22 15-3 3-3-3",key:"4rnwn2"}],["path",{d:"M11 6h6a2 2 0 0 1 2 2v10",key:"2f72bc"}]]),Iz=wt("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]),OI=wt("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Dz=wt("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),PI=wt("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Bc=wt("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Mz=wt("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Az=wt("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),LI=wt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Rz=wt("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),Oz=wt("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]),Is=wt("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),Pz=wt("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),$I=wt("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Pl=wt("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),zI=wt("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Mr=wt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Lz=wt("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),Dg=wt("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]),r1=wt("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),$z=wt("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),FI=wt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),zz=wt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),s1=wt("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),Fz=wt("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]),i1=wt("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),Bz=wt("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),rn=wt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function o1(t,e){b.useEffect(()=>{const n=r=>{!t.current||t.current.contains(r.target)||e(r)};return document.addEventListener("mousedown",n),document.addEventListener("touchstart",n),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)}},[t,e])}const yf=b.createContext({});function Iw(t){const e=b.useRef(null);return e.current===null&&(e.current=t()),e.current}const Dw=typeof window<"u",Mw=Dw?b.useLayoutEffect:b.useEffect,Mg=b.createContext(null);function Aw(t,e){t.indexOf(e)===-1&&t.push(e)}function Rw(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const qo=(t,e,n)=>n>e?e:n<t?t:n;let Ow=()=>{};const Yo={},BI=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function UI(t){return typeof t=="object"&&t!==null}const HI=t=>/^0[^.\s]+$/u.test(t);function Pw(t){let e;return()=>(e===void 0&&(e=t()),e)}const vi=t=>t,Uz=(t,e)=>n=>e(t(n)),qf=(...t)=>t.reduce(Uz),xf=(t,e,n)=>{const r=e-t;return r===0?1:(n-t)/r};class Lw{constructor(){this.subscriptions=[]}add(e){return Aw(this.subscriptions,e),()=>Rw(this.subscriptions,e)}notify(e,n,r){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](e,n,r);else for(let i=0;i<s;i++){const o=this.subscriptions[i];o&&o(e,n,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const po=t=>t*1e3,bi=t=>t/1e3;function VI(t,e){return e?t*(1e3/e):0}const WI=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,Hz=1e-7,Vz=12;function Wz(t,e,n,r,s){let i,o,a=0;do o=e+(n-e)/2,i=WI(o,r,s)-t,i>0?n=o:e=o;while(Math.abs(i)>Hz&&++a<Vz);return o}function Yf(t,e,n,r){if(t===e&&n===r)return vi;const s=i=>Wz(i,0,1,t,n);return i=>i===0||i===1?i:WI(s(i),e,r)}const KI=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,GI=t=>e=>1-t(1-e),qI=Yf(.33,1.53,.69,.99),$w=GI(qI),YI=KI($w),JI=t=>(t*=2)<1?.5*$w(t):.5*(2-Math.pow(2,-10*(t-1))),zw=t=>1-Math.sin(Math.acos(t)),XI=GI(zw),QI=KI(zw),Kz=Yf(.42,0,1,1),Gz=Yf(0,0,.58,1),ZI=Yf(.42,0,.58,1),qz=t=>Array.isArray(t)&&typeof t[0]!="number",eD=t=>Array.isArray(t)&&typeof t[0]=="number",Yz={linear:vi,easeIn:Kz,easeInOut:ZI,easeOut:Gz,circIn:zw,circInOut:QI,circOut:XI,backIn:$w,backInOut:YI,backOut:qI,anticipate:JI},Jz=t=>typeof t=="string",u2=t=>{if(eD(t)){Ow(t.length===4);const[e,n,r,s]=t;return Yf(e,n,r,s)}else if(Jz(t))return Yz[t];return t},Nh=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],d2={value:null,addProjectionMetrics:null};function Xz(t,e){let n=new Set,r=new Set,s=!1,i=!1;const o=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1},l=0;function u(f){o.has(f)&&(d.schedule(f),t()),l++,f(a)}const d={schedule:(f,h=!1,p=!1)=>{const y=p&&s?n:r;return h&&o.add(f),y.has(f)||y.add(f),f},cancel:f=>{r.delete(f),o.delete(f)},process:f=>{if(a=f,s){i=!0;return}s=!0,[n,r]=[r,n],n.forEach(u),e&&d2.value&&d2.value.frameloop[e].push(l),l=0,n.clear(),s=!1,i&&(i=!1,d.process(f))}};return d}const Qz=40;function tD(t,e){let n=!1,r=!0;const s={delta:0,timestamp:0,isProcessing:!1},i=()=>n=!0,o=Nh.reduce((w,T)=>(w[T]=Xz(i,e?T:void 0),w),{}),{setup:a,read:l,resolveKeyframes:u,preUpdate:d,update:f,preRender:h,render:p,postRender:m}=o,y=()=>{const w=Yo.useManualTiming?s.timestamp:performance.now();n=!1,Yo.useManualTiming||(s.delta=r?1e3/60:Math.max(Math.min(w-s.timestamp,Qz),1)),s.timestamp=w,s.isProcessing=!0,a.process(s),l.process(s),u.process(s),d.process(s),f.process(s),h.process(s),p.process(s),m.process(s),s.isProcessing=!1,n&&e&&(r=!1,t(y))},x=()=>{n=!0,r=!0,s.isProcessing||t(y)};return{schedule:Nh.reduce((w,T)=>{const D=o[T];return w[T]=(k,I=!1,C=!1)=>(n||x(),D.schedule(k,I,C)),w},{}),cancel:w=>{for(let T=0;T<Nh.length;T++)o[Nh[T]].cancel(w)},state:s,steps:o}}const{schedule:Yn,cancel:Ua,state:Jr,steps:U0}=tD(typeof requestAnimationFrame<"u"?requestAnimationFrame:vi,!0);let mp;function Zz(){mp=void 0}const Os={now:()=>(mp===void 0&&Os.set(Jr.isProcessing||Yo.useManualTiming?Jr.timestamp:performance.now()),mp),set:t=>{mp=t,queueMicrotask(Zz)}},nD=t=>e=>typeof e=="string"&&e.startsWith(t),rD=nD("--"),eF=nD("var(--"),Fw=t=>eF(t)?tF.test(t.split("/*")[0].trim()):!1,tF=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Au={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},bf={...Au,transform:t=>qo(0,1,t)},jh={...Au,default:1},Cd=t=>Math.round(t*1e5)/1e5,Bw=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function nF(t){return t==null}const rF=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Uw=(t,e)=>n=>!!(typeof n=="string"&&rF.test(n)&&n.startsWith(t)||e&&!nF(n)&&Object.prototype.hasOwnProperty.call(n,e)),sD=(t,e,n)=>r=>{if(typeof r!="string")return r;const[s,i,o,a]=r.match(Bw);return{[t]:parseFloat(s),[e]:parseFloat(i),[n]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},sF=t=>qo(0,255,t),H0={...Au,transform:t=>Math.round(sF(t))},El={test:Uw("rgb","red"),parse:sD("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:r=1})=>"rgba("+H0.transform(t)+", "+H0.transform(e)+", "+H0.transform(n)+", "+Cd(bf.transform(r))+")"};function iF(t){let e="",n="",r="",s="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),r=t.substring(5,7),s=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),r=t.substring(3,4),s=t.substring(4,5),e+=e,n+=n,r+=r,s+=s),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:s?parseInt(s,16)/255:1}}const a1={test:Uw("#"),parse:iF,transform:El.transform},Jf=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),oa=Jf("deg"),mo=Jf("%"),Qt=Jf("px"),oF=Jf("vh"),aF=Jf("vw"),f2=(()=>({...mo,parse:t=>mo.parse(t)/100,transform:t=>mo.transform(t*100)}))(),Uc={test:Uw("hsl","hue"),parse:sD("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:r=1})=>"hsla("+Math.round(t)+", "+mo.transform(Cd(e))+", "+mo.transform(Cd(n))+", "+Cd(bf.transform(r))+")"},Sr={test:t=>El.test(t)||a1.test(t)||Uc.test(t),parse:t=>El.test(t)?El.parse(t):Uc.test(t)?Uc.parse(t):a1.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?El.transform(t):Uc.transform(t),getAnimatableNone:t=>{const e=Sr.parse(t);return e.alpha=0,Sr.transform(e)}},lF=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function cF(t){var e,n;return isNaN(t)&&typeof t=="string"&&(((e=t.match(Bw))==null?void 0:e.length)||0)+(((n=t.match(lF))==null?void 0:n.length)||0)>0}const iD="number",oD="color",uF="var",dF="var(",h2="${}",fF=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function wf(t){const e=t.toString(),n=[],r={color:[],number:[],var:[]},s=[];let i=0;const a=e.replace(fF,l=>(Sr.test(l)?(r.color.push(i),s.push(oD),n.push(Sr.parse(l))):l.startsWith(dF)?(r.var.push(i),s.push(uF),n.push(l)):(r.number.push(i),s.push(iD),n.push(parseFloat(l))),++i,h2)).split(h2);return{values:n,split:a,indexes:r,types:s}}function aD(t){return wf(t).values}function lD(t){const{split:e,types:n}=wf(t),r=e.length;return s=>{let i="";for(let o=0;o<r;o++)if(i+=e[o],s[o]!==void 0){const a=n[o];a===iD?i+=Cd(s[o]):a===oD?i+=Sr.transform(s[o]):i+=s[o]}return i}}const hF=t=>typeof t=="number"?0:Sr.test(t)?Sr.getAnimatableNone(t):t;function pF(t){const e=aD(t);return lD(t)(e.map(hF))}const Ha={test:cF,parse:aD,createTransformer:lD,getAnimatableNone:pF};function V0(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function mF({hue:t,saturation:e,lightness:n,alpha:r}){t/=360,e/=100,n/=100;let s=0,i=0,o=0;if(!e)s=i=o=n;else{const a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;s=V0(l,a,t+1/3),i=V0(l,a,t),o=V0(l,a,t-1/3)}return{red:Math.round(s*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:r}}function am(t,e){return n=>n>0?e:t}const lr=(t,e,n)=>t+(e-t)*n,W0=(t,e,n)=>{const r=t*t,s=n*(e*e-r)+r;return s<0?0:Math.sqrt(s)},gF=[a1,El,Uc],yF=t=>gF.find(e=>e.test(t));function p2(t){const e=yF(t);if(!e)return!1;let n=e.parse(t);return e===Uc&&(n=mF(n)),n}const m2=(t,e)=>{const n=p2(t),r=p2(e);if(!n||!r)return am(t,e);const s={...n};return i=>(s.red=W0(n.red,r.red,i),s.green=W0(n.green,r.green,i),s.blue=W0(n.blue,r.blue,i),s.alpha=lr(n.alpha,r.alpha,i),El.transform(s))},l1=new Set(["none","hidden"]);function xF(t,e){return l1.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function bF(t,e){return n=>lr(t,e,n)}function Hw(t){return typeof t=="number"?bF:typeof t=="string"?Fw(t)?am:Sr.test(t)?m2:kF:Array.isArray(t)?cD:typeof t=="object"?Sr.test(t)?m2:wF:am}function cD(t,e){const n=[...t],r=n.length,s=t.map((i,o)=>Hw(i)(i,e[o]));return i=>{for(let o=0;o<r;o++)n[o]=s[o](i);return n}}function wF(t,e){const n={...t,...e},r={};for(const s in n)t[s]!==void 0&&e[s]!==void 0&&(r[s]=Hw(t[s])(t[s],e[s]));return s=>{for(const i in r)n[i]=r[i](s);return n}}function vF(t,e){const n=[],r={color:0,var:0,number:0};for(let s=0;s<e.values.length;s++){const i=e.types[s],o=t.indexes[i][r[i]],a=t.values[o]??0;n[s]=a,r[i]++}return n}const kF=(t,e)=>{const n=Ha.createTransformer(e),r=wf(t),s=wf(e);return r.indexes.var.length===s.indexes.var.length&&r.indexes.color.length===s.indexes.color.length&&r.indexes.number.length>=s.indexes.number.length?l1.has(t)&&!s.values.length||l1.has(e)&&!r.values.length?xF(t,e):qf(cD(vF(r,s),s.values),n):am(t,e)};function uD(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?lr(t,e,n):Hw(t)(t,e)}const SF=t=>{const e=({timestamp:n})=>t(n);return{start:(n=!0)=>Yn.update(e,n),stop:()=>Ua(e),now:()=>Jr.isProcessing?Jr.timestamp:Os.now()}},dD=(t,e,n=10)=>{let r="";const s=Math.max(Math.round(e/n),2);for(let i=0;i<s;i++)r+=Math.round(t(i/(s-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},lm=2e4;function Vw(t){let e=0;const n=50;let r=t.next(e);for(;!r.done&&e<lm;)e+=n,r=t.next(e);return e>=lm?1/0:e}function _F(t,e=100,n){const r=n({...t,keyframes:[0,e]}),s=Math.min(Vw(r),lm);return{type:"keyframes",ease:i=>r.next(s*i).value/e,duration:bi(s)}}const TF=5;function fD(t,e,n){const r=Math.max(e-TF,0);return VI(n-t(r),e-r)}const hr={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},K0=.001;function CF({duration:t=hr.duration,bounce:e=hr.bounce,velocity:n=hr.velocity,mass:r=hr.mass}){let s,i,o=1-e;o=qo(hr.minDamping,hr.maxDamping,o),t=qo(hr.minDuration,hr.maxDuration,bi(t)),o<1?(s=u=>{const d=u*o,f=d*t,h=d-n,p=c1(u,o),m=Math.exp(-f);return K0-h/p*m},i=u=>{const f=u*o*t,h=f*n+n,p=Math.pow(o,2)*Math.pow(u,2)*t,m=Math.exp(-f),y=c1(Math.pow(u,2),o);return(-s(u)+K0>0?-1:1)*((h-p)*m)/y}):(s=u=>{const d=Math.exp(-u*t),f=(u-n)*t+1;return-K0+d*f},i=u=>{const d=Math.exp(-u*t),f=(n-u)*(t*t);return d*f});const a=5/t,l=NF(s,i,a);if(t=po(t),isNaN(l))return{stiffness:hr.stiffness,damping:hr.damping,duration:t};{const u=Math.pow(l,2)*r;return{stiffness:u,damping:o*2*Math.sqrt(r*u),duration:t}}}const EF=12;function NF(t,e,n){let r=n;for(let s=1;s<EF;s++)r=r-t(r)/e(r);return r}function c1(t,e){return t*Math.sqrt(1-e*e)}const jF=["duration","bounce"],IF=["stiffness","damping","mass"];function g2(t,e){return e.some(n=>t[n]!==void 0)}function DF(t){let e={velocity:hr.velocity,stiffness:hr.stiffness,damping:hr.damping,mass:hr.mass,isResolvedFromDuration:!1,...t};if(!g2(t,IF)&&g2(t,jF))if(t.visualDuration){const n=t.visualDuration,r=2*Math.PI/(n*1.2),s=r*r,i=2*qo(.05,1,1-(t.bounce||0))*Math.sqrt(s);e={...e,mass:hr.mass,stiffness:s,damping:i}}else{const n=CF(t);e={...e,...n,mass:hr.mass},e.isResolvedFromDuration=!0}return e}function cm(t=hr.visualDuration,e=hr.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:r,restDelta:s}=n;const i=n.keyframes[0],o=n.keyframes[n.keyframes.length-1],a={done:!1,value:i},{stiffness:l,damping:u,mass:d,duration:f,velocity:h,isResolvedFromDuration:p}=DF({...n,velocity:-bi(n.velocity||0)}),m=h||0,y=u/(2*Math.sqrt(l*d)),x=o-i,g=bi(Math.sqrt(l/d)),v=Math.abs(x)<5;r||(r=v?hr.restSpeed.granular:hr.restSpeed.default),s||(s=v?hr.restDelta.granular:hr.restDelta.default);let w;if(y<1){const D=c1(g,y);w=k=>{const I=Math.exp(-y*g*k);return o-I*((m+y*g*x)/D*Math.sin(D*k)+x*Math.cos(D*k))}}else if(y===1)w=D=>o-Math.exp(-g*D)*(x+(m+g*x)*D);else{const D=g*Math.sqrt(y*y-1);w=k=>{const I=Math.exp(-y*g*k),C=Math.min(D*k,300);return o-I*((m+y*g*x)*Math.sinh(C)+D*x*Math.cosh(C))/D}}const T={calculatedDuration:p&&f||null,next:D=>{const k=w(D);if(p)a.done=D>=f;else{let I=D===0?m:0;y<1&&(I=D===0?po(m):fD(w,D,k));const C=Math.abs(I)<=r,S=Math.abs(o-k)<=s;a.done=C&&S}return a.value=a.done?o:k,a},toString:()=>{const D=Math.min(Vw(T),lm),k=dD(I=>T.next(D*I).value,D,30);return D+"ms "+k},toTransition:()=>{}};return T}cm.applyToOptions=t=>{const e=_F(t,100,cm);return t.ease=e.ease,t.duration=po(e.duration),t.type="keyframes",t};function u1({keyframes:t,velocity:e=0,power:n=.8,timeConstant:r=325,bounceDamping:s=10,bounceStiffness:i=500,modifyTarget:o,min:a,max:l,restDelta:u=.5,restSpeed:d}){const f=t[0],h={done:!1,value:f},p=C=>a!==void 0&&C<a||l!==void 0&&C>l,m=C=>a===void 0?l:l===void 0||Math.abs(a-C)<Math.abs(l-C)?a:l;let y=n*e;const x=f+y,g=o===void 0?x:o(x);g!==x&&(y=g-f);const v=C=>-y*Math.exp(-C/r),w=C=>g+v(C),T=C=>{const S=v(C),_=w(C);h.done=Math.abs(S)<=u,h.value=h.done?g:_};let D,k;const I=C=>{p(h.value)&&(D=C,k=cm({keyframes:[h.value,m(h.value)],velocity:fD(w,C,h.value),damping:s,stiffness:i,restDelta:u,restSpeed:d}))};return I(0),{calculatedDuration:null,next:C=>{let S=!1;return!k&&D===void 0&&(S=!0,T(C),I(C)),D!==void 0&&C>=D?k.next(C-D):(!S&&T(C),h)}}}function MF(t,e,n){const r=[],s=n||Yo.mix||uD,i=t.length-1;for(let o=0;o<i;o++){let a=s(t[o],t[o+1]);if(e){const l=Array.isArray(e)?e[o]||vi:e;a=qf(l,a)}r.push(a)}return r}function AF(t,e,{clamp:n=!0,ease:r,mixer:s}={}){const i=t.length;if(Ow(i===e.length),i===1)return()=>e[0];if(i===2&&e[0]===e[1])return()=>e[1];const o=t[0]===t[1];t[0]>t[i-1]&&(t=[...t].reverse(),e=[...e].reverse());const a=MF(e,r,s),l=a.length,u=d=>{if(o&&d<t[0])return e[0];let f=0;if(l>1)for(;f<t.length-2&&!(d<t[f+1]);f++);const h=xf(t[f],t[f+1],d);return a[f](h)};return n?d=>u(qo(t[0],t[i-1],d)):u}function RF(t,e){const n=t[t.length-1];for(let r=1;r<=e;r++){const s=xf(0,e,r);t.push(lr(n,1,s))}}function OF(t){const e=[0];return RF(e,t.length-1),e}function PF(t,e){return t.map(n=>n*e)}function LF(t,e){return t.map(()=>e||ZI).splice(0,t.length-1)}function Ed({duration:t=300,keyframes:e,times:n,ease:r="easeInOut"}){const s=qz(r)?r.map(u2):u2(r),i={done:!1,value:e[0]},o=PF(n&&n.length===e.length?n:OF(e),t),a=AF(o,e,{ease:Array.isArray(s)?s:LF(e,s)});return{calculatedDuration:t,next:l=>(i.value=a(l),i.done=l>=t,i)}}const $F=t=>t!==null;function Ww(t,{repeat:e,repeatType:n="loop"},r,s=1){const i=t.filter($F),a=s<0||e&&n!=="loop"&&e%2===1?0:i.length-1;return!a||r===void 0?i[a]:r}const zF={decay:u1,inertia:u1,tween:Ed,keyframes:Ed,spring:cm};function hD(t){typeof t.type=="string"&&(t.type=zF[t.type])}class Kw{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,n){return this.finished.then(e,n)}}const FF=t=>t/100;class Gw extends Kw{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var r,s;const{motionValue:n}=this.options;n&&n.updatedAt!==Os.now()&&this.tick(Os.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(s=(r=this.options).onStop)==null||s.call(r))},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;hD(e);const{type:n=Ed,repeat:r=0,repeatDelay:s=0,repeatType:i,velocity:o=0}=e;let{keyframes:a}=e;const l=n||Ed;l!==Ed&&typeof a[0]!="number"&&(this.mixKeyframes=qf(FF,uD(a[0],a[1])),a=[0,100]);const u=l({...e,keyframes:a});i==="mirror"&&(this.mirroredGenerator=l({...e,keyframes:[...a].reverse(),velocity:-o})),u.calculatedDuration===null&&(u.calculatedDuration=Vw(u));const{calculatedDuration:d}=u;this.calculatedDuration=d,this.resolvedDuration=d+s,this.totalDuration=this.resolvedDuration*(r+1)-s,this.generator=u}updateTime(e){const n=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(e,n=!1){const{generator:r,totalDuration:s,mixKeyframes:i,mirroredGenerator:o,resolvedDuration:a,calculatedDuration:l}=this;if(this.startTime===null)return r.next(0);const{delay:u=0,keyframes:d,repeat:f,repeatType:h,repeatDelay:p,type:m,onUpdate:y,finalKeyframe:x}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-s/this.speed,this.startTime)),n?this.currentTime=e:this.updateTime(e);const g=this.currentTime-u*(this.playbackSpeed>=0?1:-1),v=this.playbackSpeed>=0?g<0:g>s;this.currentTime=Math.max(g,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=s);let w=this.currentTime,T=r;if(f){const C=Math.min(this.currentTime,s)/a;let S=Math.floor(C),_=C%1;!_&&C>=1&&(_=1),_===1&&S--,S=Math.min(S,f+1),!!(S%2)&&(h==="reverse"?(_=1-_,p&&(_-=p/a)):h==="mirror"&&(T=o)),w=qo(0,1,_)*a}const D=v?{done:!1,value:d[0]}:T.next(w);i&&(D.value=i(D.value));let{done:k}=D;!v&&l!==null&&(k=this.playbackSpeed>=0?this.currentTime>=s:this.currentTime<=0);const I=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&k);return I&&m!==u1&&(D.value=Ww(d,this.options,x,this.speed)),y&&y(D.value),I&&this.finish(),D}then(e,n){return this.finished.then(e,n)}get duration(){return bi(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+bi(e)}get time(){return bi(this.currentTime)}set time(e){var n;e=po(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),(n=this.driver)==null||n.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Os.now());const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=bi(this.currentTime))}play(){var s,i;if(this.isStopped)return;const{driver:e=SF,startTime:n}=this.options;this.driver||(this.driver=e(o=>this.tick(o))),(i=(s=this.options).onPlay)==null||i.call(s);const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=n??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Os.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,n;this.notifyFinished(),this.teardown(),this.state="finished",(n=(e=this.options).onComplete)==null||n.call(e)}cancel(){var e,n;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(n=(e=this.options).onCancel)==null||n.call(e)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var n;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(n=this.driver)==null||n.stop(),e.observe(this)}}function BF(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const Nl=t=>t*180/Math.PI,d1=t=>{const e=Nl(Math.atan2(t[1],t[0]));return f1(e)},UF={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:d1,rotateZ:d1,skewX:t=>Nl(Math.atan(t[1])),skewY:t=>Nl(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},f1=t=>(t=t%360,t<0&&(t+=360),t),y2=d1,x2=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),b2=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),HF={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:x2,scaleY:b2,scale:t=>(x2(t)+b2(t))/2,rotateX:t=>f1(Nl(Math.atan2(t[6],t[5]))),rotateY:t=>f1(Nl(Math.atan2(-t[2],t[0]))),rotateZ:y2,rotate:y2,skewX:t=>Nl(Math.atan(t[4])),skewY:t=>Nl(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function h1(t){return t.includes("scale")?1:0}function p1(t,e){if(!t||t==="none")return h1(e);const n=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,s;if(n)r=HF,s=n;else{const a=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=UF,s=a}if(!s)return h1(e);const i=r[e],o=s[1].split(",").map(WF);return typeof i=="function"?i(o):o[i]}const VF=(t,e)=>{const{transform:n="none"}=getComputedStyle(t);return p1(n,e)};function WF(t){return parseFloat(t.trim())}const Ru=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Ou=(()=>new Set(Ru))(),w2=t=>t===Au||t===Qt,KF=new Set(["x","y","z"]),GF=Ru.filter(t=>!KF.has(t));function qF(t){const e=[];return GF.forEach(n=>{const r=t.getValue(n);r!==void 0&&(e.push([n,r.get()]),r.set(n.startsWith("scale")?1:0))}),e}const Ll={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>p1(e,"x"),y:(t,{transform:e})=>p1(e,"y")};Ll.translateX=Ll.x;Ll.translateY=Ll.y;const $l=new Set;let m1=!1,g1=!1,y1=!1;function pD(){if(g1){const t=Array.from($l).filter(r=>r.needsMeasurement),e=new Set(t.map(r=>r.element)),n=new Map;e.forEach(r=>{const s=qF(r);s.length&&(n.set(r,s),r.render())}),t.forEach(r=>r.measureInitialState()),e.forEach(r=>{r.render();const s=n.get(r);s&&s.forEach(([i,o])=>{var a;(a=r.getValue(i))==null||a.set(o)})}),t.forEach(r=>r.measureEndState()),t.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}g1=!1,m1=!1,$l.forEach(t=>t.complete(y1)),$l.clear()}function mD(){$l.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(g1=!0)})}function YF(){y1=!0,mD(),pD(),y1=!1}class qw{constructor(e,n,r,s,i,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=r,this.motionValue=s,this.element=i,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?($l.add(this),m1||(m1=!0,Yn.read(mD),Yn.resolveKeyframes(pD))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:r,motionValue:s}=this;if(e[0]===null){const i=s==null?void 0:s.get(),o=e[e.length-1];if(i!==void 0)e[0]=i;else if(r&&n){const a=r.readValue(n,o);a!=null&&(e[0]=a)}e[0]===void 0&&(e[0]=o),s&&i===void 0&&s.set(e[0])}BF(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),$l.delete(this)}cancel(){this.state==="scheduled"&&($l.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const JF=t=>t.startsWith("--");function XF(t,e,n){JF(e)?t.style.setProperty(e,n):t.style[e]=n}const QF=Pw(()=>window.ScrollTimeline!==void 0),ZF={};function eB(t,e){const n=Pw(t);return()=>ZF[e]??n()}const gD=eB(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),ud=([t,e,n,r])=>`cubic-bezier(${t}, ${e}, ${n}, ${r})`,v2={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ud([0,.65,.55,1]),circOut:ud([.55,0,1,.45]),backIn:ud([.31,.01,.66,-.59]),backOut:ud([.33,1.53,.69,.99])};function yD(t,e){if(t)return typeof t=="function"?gD()?dD(t,e):"ease-out":eD(t)?ud(t):Array.isArray(t)?t.map(n=>yD(n,e)||v2.easeOut):v2[t]}function tB(t,e,n,{delay:r=0,duration:s=300,repeat:i=0,repeatType:o="loop",ease:a="easeOut",times:l}={},u=void 0){const d={[e]:n};l&&(d.offset=l);const f=yD(a,s);Array.isArray(f)&&(d.easing=f);const h={delay:r,duration:s,easing:Array.isArray(f)?"linear":f,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"};return u&&(h.pseudoElement=u),t.animate(d,h)}function xD(t){return typeof t=="function"&&"applyToOptions"in t}function nB({type:t,...e}){return xD(t)&&gD()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class rB extends Kw{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:n,name:r,keyframes:s,pseudoElement:i,allowFlatten:o=!1,finalKeyframe:a,onComplete:l}=e;this.isPseudoElement=!!i,this.allowFlatten=o,this.options=e,Ow(typeof e.type!="string");const u=nB(e);this.animation=tB(n,r,s,u,i),u.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!i){const d=Ww(s,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(d):XF(n,r,d),this.animation.cancel()}l==null||l(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,n;(n=(e=this.animation).finish)==null||n.call(e)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,n;this.isPseudoElement||(n=(e=this.animation).commitStyles)==null||n.call(e)}get duration(){var n,r;const e=((r=(n=this.animation.effect)==null?void 0:n.getComputedTiming)==null?void 0:r.call(n).duration)||0;return bi(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+bi(e)}get time(){return bi(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=po(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:n}){var r;return this.allowFlatten&&((r=this.animation.effect)==null||r.updateTiming({easing:"linear"})),this.animation.onfinish=null,e&&QF()?(this.animation.timeline=e,vi):n(this)}}const bD={anticipate:JI,backInOut:YI,circInOut:QI};function sB(t){return t in bD}function iB(t){typeof t.ease=="string"&&sB(t.ease)&&(t.ease=bD[t.ease])}const k2=10;class oB extends rB{constructor(e){iB(e),hD(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:n,onUpdate:r,onComplete:s,element:i,...o}=this.options;if(!n)return;if(e!==void 0){n.set(e);return}const a=new Gw({...o,autoplay:!1}),l=po(this.finishedTime??this.time);n.setWithVelocity(a.sample(l-k2).value,a.sample(l).value,k2),a.stop()}}const S2=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Ha.test(t)||t==="0")&&!t.startsWith("url("));function aB(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function lB(t,e,n,r){const s=t[0];if(s===null)return!1;if(e==="display"||e==="visibility")return!0;const i=t[t.length-1],o=S2(s,e),a=S2(i,e);return!o||!a?!1:aB(t)||(n==="spring"||xD(n))&&r}function x1(t){t.duration=0,t.type="keyframes"}const cB=new Set(["opacity","clipPath","filter","transform"]),uB=Pw(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function dB(t){var d;const{motionValue:e,name:n,repeatDelay:r,repeatType:s,damping:i,type:o}=t;if(!(((d=e==null?void 0:e.owner)==null?void 0:d.current)instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:u}=e.owner.getProps();return uB()&&n&&cB.has(n)&&(n!=="transform"||!u)&&!l&&!r&&s!=="mirror"&&i!==0&&o!=="inertia"}const fB=40;class hB extends Kw{constructor({autoplay:e=!0,delay:n=0,type:r="keyframes",repeat:s=0,repeatDelay:i=0,repeatType:o="loop",keyframes:a,name:l,motionValue:u,element:d,...f}){var m;super(),this.stop=()=>{var y,x;this._animation&&(this._animation.stop(),(y=this.stopTimeline)==null||y.call(this)),(x=this.keyframeResolver)==null||x.cancel()},this.createdAt=Os.now();const h={autoplay:e,delay:n,type:r,repeat:s,repeatDelay:i,repeatType:o,name:l,motionValue:u,element:d,...f},p=(d==null?void 0:d.KeyframeResolver)||qw;this.keyframeResolver=new p(a,(y,x,g)=>this.onKeyframesResolved(y,x,h,!g),l,u,d),(m=this.keyframeResolver)==null||m.scheduleResolve()}onKeyframesResolved(e,n,r,s){this.keyframeResolver=void 0;const{name:i,type:o,velocity:a,delay:l,isHandoff:u,onUpdate:d}=r;this.resolvedAt=Os.now(),lB(e,i,o,a)||((Yo.instantAnimations||!l)&&(d==null||d(Ww(e,r,n))),e[0]=e[e.length-1],x1(r),r.repeat=0);const h={startTime:s?this.resolvedAt?this.resolvedAt-this.createdAt>fB?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...r,keyframes:e},p=!u&&dB(h)?new oB({...h,element:h.motionValue.owner.current}):new Gw(h);p.finished.then(()=>this.notifyFinished()).catch(vi),this.pendingTimeline&&(this.stopTimeline=p.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=p}get finished(){return this._animation?this.animation.finished:this._finished}then(e,n){return this.finished.finally(e).then(()=>{})}get animation(){var e;return this._animation||((e=this.keyframeResolver)==null||e.resume(),YF()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),(e=this.keyframeResolver)==null||e.cancel()}}const pB=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function mB(t){const e=pB.exec(t);if(!e)return[,];const[,n,r,s]=e;return[`--${n??r}`,s]}function wD(t,e,n=1){const[r,s]=mB(t);if(!r)return;const i=window.getComputedStyle(e).getPropertyValue(r);if(i){const o=i.trim();return BI(o)?parseFloat(o):o}return Fw(s)?wD(s,e,n+1):s}function Yw(t,e){return(t==null?void 0:t[e])??(t==null?void 0:t.default)??t}const vD=new Set(["width","height","top","left","right","bottom",...Ru]),gB={test:t=>t==="auto",parse:t=>t},kD=t=>e=>e.test(t),SD=[Au,Qt,mo,oa,aF,oF,gB],_2=t=>SD.find(kD(t));function yB(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||HI(t):!0}const xB=new Set(["brightness","contrast","saturate","opacity"]);function bB(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[r]=n.match(Bw)||[];if(!r)return t;const s=n.replace(r,"");let i=xB.has(e)?1:0;return r!==n&&(i*=100),e+"("+i+s+")"}const wB=/\b([a-z-]*)\(.*?\)/gu,b1={...Ha,getAnimatableNone:t=>{const e=t.match(wB);return e?e.map(bB).join(" "):t}},T2={...Au,transform:Math.round},vB={rotate:oa,rotateX:oa,rotateY:oa,rotateZ:oa,scale:jh,scaleX:jh,scaleY:jh,scaleZ:jh,skew:oa,skewX:oa,skewY:oa,distance:Qt,translateX:Qt,translateY:Qt,translateZ:Qt,x:Qt,y:Qt,z:Qt,perspective:Qt,transformPerspective:Qt,opacity:bf,originX:f2,originY:f2,originZ:Qt},Jw={borderWidth:Qt,borderTopWidth:Qt,borderRightWidth:Qt,borderBottomWidth:Qt,borderLeftWidth:Qt,borderRadius:Qt,radius:Qt,borderTopLeftRadius:Qt,borderTopRightRadius:Qt,borderBottomRightRadius:Qt,borderBottomLeftRadius:Qt,width:Qt,maxWidth:Qt,height:Qt,maxHeight:Qt,top:Qt,right:Qt,bottom:Qt,left:Qt,padding:Qt,paddingTop:Qt,paddingRight:Qt,paddingBottom:Qt,paddingLeft:Qt,margin:Qt,marginTop:Qt,marginRight:Qt,marginBottom:Qt,marginLeft:Qt,backgroundPositionX:Qt,backgroundPositionY:Qt,...vB,zIndex:T2,fillOpacity:bf,strokeOpacity:bf,numOctaves:T2},kB={...Jw,color:Sr,backgroundColor:Sr,outlineColor:Sr,fill:Sr,stroke:Sr,borderColor:Sr,borderTopColor:Sr,borderRightColor:Sr,borderBottomColor:Sr,borderLeftColor:Sr,filter:b1,WebkitFilter:b1},_D=t=>kB[t];function TD(t,e){let n=_D(t);return n!==b1&&(n=Ha),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const SB=new Set(["auto","none","0"]);function _B(t,e,n){let r=0,s;for(;r<t.length&&!s;){const i=t[r];typeof i=="string"&&!SB.has(i)&&wf(i).values.length&&(s=t[r]),r++}if(s&&n)for(const i of e)t[i]=TD(n,s)}class TB extends qw{constructor(e,n,r,s,i){super(e,n,r,s,i,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:r}=this;if(!n||!n.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let u=e[l];if(typeof u=="string"&&(u=u.trim(),Fw(u))){const d=wD(u,n.current);d!==void 0&&(e[l]=d),l===e.length-1&&(this.finalKeyframe=u)}}if(this.resolveNoneKeyframes(),!vD.has(r)||e.length!==2)return;const[s,i]=e,o=_2(s),a=_2(i);if(o!==a)if(w2(o)&&w2(a))for(let l=0;l<e.length;l++){const u=e[l];typeof u=="string"&&(e[l]=parseFloat(u))}else Ll[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,r=[];for(let s=0;s<e.length;s++)(e[s]===null||yB(e[s]))&&r.push(s);r.length&&_B(e,r,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:r}=this;if(!e||!e.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Ll[r](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const s=n[n.length-1];s!==void 0&&e.getValue(r,s).jump(s,!1)}measureEndState(){var a;const{element:e,name:n,unresolvedKeyframes:r}=this;if(!e||!e.current)return;const s=e.getValue(n);s&&s.jump(this.measuredOrigin,!1);const i=r.length-1,o=r[i];r[i]=Ll[n](e.measureViewportBox(),window.getComputedStyle(e.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),(a=this.removedTransforms)!=null&&a.length&&this.removedTransforms.forEach(([l,u])=>{e.getValue(l).set(u)}),this.resolveNoneKeyframes()}}function CB(t,e,n){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let r=document;e&&(r=e.current);const s=(n==null?void 0:n[t])??r.querySelectorAll(t);return s?Array.from(s):[]}return Array.from(t)}const CD=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function ED(t){return UI(t)&&"offsetHeight"in t}const C2=30,EB=t=>!isNaN(parseFloat(t));class NB{constructor(e,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{var i;const s=Os.now();if(this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&((i=this.events.change)==null||i.notify(this.current),this.dependents))for(const o of this.dependents)o.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=Os.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=EB(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new Lw);const r=this.events[e].add(n);return e==="change"?()=>{r(),Yn.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,n,r){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;(e=this.events.change)==null||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Os.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>C2)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,C2);return VI(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,n;(e=this.dependents)==null||e.clear(),(n=this.events.destroy)==null||n.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function xu(t,e){return new NB(t,e)}const{schedule:Xw,cancel:lre}=tD(queueMicrotask,!1),zi={x:!1,y:!1};function ND(){return zi.x||zi.y}function jB(t){return t==="x"||t==="y"?zi[t]?null:(zi[t]=!0,()=>{zi[t]=!1}):zi.x||zi.y?null:(zi.x=zi.y=!0,()=>{zi.x=zi.y=!1})}function jD(t,e){const n=CB(t),r=new AbortController,s={passive:!0,...e,signal:r.signal};return[n,s,()=>r.abort()]}function E2(t){return!(t.pointerType==="touch"||ND())}function IB(t,e,n={}){const[r,s,i]=jD(t,n),o=a=>{if(!E2(a))return;const{target:l}=a,u=e(l,a);if(typeof u!="function"||!l)return;const d=f=>{E2(f)&&(u(f),l.removeEventListener("pointerleave",d))};l.addEventListener("pointerleave",d,s)};return r.forEach(a=>{a.addEventListener("pointerenter",o,s)}),i}const ID=(t,e)=>e?t===e?!0:ID(t,e.parentElement):!1,Qw=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,DB=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function MB(t){return DB.has(t.tagName)||t.tabIndex!==-1}const gp=new WeakSet;function N2(t){return e=>{e.key==="Enter"&&t(e)}}function G0(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const AB=(t,e)=>{const n=t.currentTarget;if(!n)return;const r=N2(()=>{if(gp.has(n))return;G0(n,"down");const s=N2(()=>{G0(n,"up")}),i=()=>G0(n,"cancel");n.addEventListener("keyup",s,e),n.addEventListener("blur",i,e)});n.addEventListener("keydown",r,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",r),e)};function j2(t){return Qw(t)&&!ND()}function RB(t,e,n={}){const[r,s,i]=jD(t,n),o=a=>{const l=a.currentTarget;if(!j2(a))return;gp.add(l);const u=e(l,a),d=(p,m)=>{window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",h),gp.has(l)&&gp.delete(l),j2(p)&&typeof u=="function"&&u(p,{success:m})},f=p=>{d(p,l===window||l===document||n.useGlobalTarget||ID(l,p.target))},h=p=>{d(p,!1)};window.addEventListener("pointerup",f,s),window.addEventListener("pointercancel",h,s)};return r.forEach(a=>{(n.useGlobalTarget?window:a).addEventListener("pointerdown",o,s),ED(a)&&(a.addEventListener("focus",u=>AB(u,s)),!MB(a)&&!a.hasAttribute("tabindex")&&(a.tabIndex=0))}),i}function DD(t){return UI(t)&&"ownerSVGElement"in t}function OB(t){return DD(t)&&t.tagName==="svg"}const fs=t=>!!(t&&t.getVelocity),PB=[...SD,Sr,Ha],LB=t=>PB.find(kD(t)),Zw=b.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function I2(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function $B(...t){return e=>{let n=!1;const r=t.map(s=>{const i=I2(s,e);return!n&&typeof i=="function"&&(n=!0),i});if(n)return()=>{for(let s=0;s<r.length;s++){const i=r[s];typeof i=="function"?i():I2(t[s],null)}}}}function zB(...t){return b.useCallback($B(...t),t)}class FB extends b.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const r=n.offsetParent,s=ED(r)&&r.offsetWidth||0,i=this.props.sizeRef.current;i.height=n.offsetHeight||0,i.width=n.offsetWidth||0,i.top=n.offsetTop,i.left=n.offsetLeft,i.right=s-i.width-i.left}return null}componentDidUpdate(){}render(){return this.props.children}}function BB({children:t,isPresent:e,anchorX:n,root:r}){const s=b.useId(),i=b.useRef(null),o=b.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=b.useContext(Zw),l=zB(i,t==null?void 0:t.ref);return b.useInsertionEffect(()=>{const{width:u,height:d,top:f,left:h,right:p}=o.current;if(e||!i.current||!u||!d)return;const m=n==="left"?`left: ${h}`:`right: ${p}`;i.current.dataset.motionPopId=s;const y=document.createElement("style");a&&(y.nonce=a);const x=r??document.head;return x.appendChild(y),y.sheet&&y.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${u}px !important;
            height: ${d}px !important;
            ${m}px !important;
            top: ${f}px !important;
          }
        `),()=>{x.contains(y)&&x.removeChild(y)}},[e]),c.jsx(FB,{isPresent:e,childRef:i,sizeRef:o,children:b.cloneElement(t,{ref:l})})}const UB=({children:t,initial:e,isPresent:n,onExitComplete:r,custom:s,presenceAffectsLayout:i,mode:o,anchorX:a,root:l})=>{const u=Iw(HB),d=b.useId();let f=!0,h=b.useMemo(()=>(f=!1,{id:d,initial:e,isPresent:n,custom:s,onExitComplete:p=>{u.set(p,!0);for(const m of u.values())if(!m)return;r&&r()},register:p=>(u.set(p,!1),()=>u.delete(p))}),[n,u,r]);return i&&f&&(h={...h}),b.useMemo(()=>{u.forEach((p,m)=>u.set(m,!1))},[n]),b.useEffect(()=>{!n&&!u.size&&r&&r()},[n]),o==="popLayout"&&(t=c.jsx(BB,{isPresent:n,anchorX:a,root:l,children:t})),c.jsx(Mg.Provider,{value:h,children:t})};function HB(){return new Map}function MD(t=!0){const e=b.useContext(Mg);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:r,register:s}=e,i=b.useId();b.useEffect(()=>{if(t)return s(i)},[t]);const o=b.useCallback(()=>t&&r&&r(i),[i,r,t]);return!n&&r?[!1,o]:[!0]}const Ih=t=>t.key||"";function D2(t){const e=[];return b.Children.forEach(t,n=>{b.isValidElement(n)&&e.push(n)}),e}const go=({children:t,custom:e,initial:n=!0,onExitComplete:r,presenceAffectsLayout:s=!0,mode:i="sync",propagate:o=!1,anchorX:a="left",root:l})=>{const[u,d]=MD(o),f=b.useMemo(()=>D2(t),[t]),h=o&&!u?[]:f.map(Ih),p=b.useRef(!0),m=b.useRef(f),y=Iw(()=>new Map),[x,g]=b.useState(f),[v,w]=b.useState(f);Mw(()=>{p.current=!1,m.current=f;for(let k=0;k<v.length;k++){const I=Ih(v[k]);h.includes(I)?y.delete(I):y.get(I)!==!0&&y.set(I,!1)}},[v,h.length,h.join("-")]);const T=[];if(f!==x){let k=[...f];for(let I=0;I<v.length;I++){const C=v[I],S=Ih(C);h.includes(S)||(k.splice(I,0,C),T.push(C))}return i==="wait"&&T.length&&(k=T),w(D2(k)),g(f),null}const{forceRender:D}=b.useContext(yf);return c.jsx(c.Fragment,{children:v.map(k=>{const I=Ih(k),C=o&&!u?!1:f===v||h.includes(I),S=()=>{if(y.has(I))y.set(I,!0);else return;let _=!0;y.forEach(N=>{N||(_=!1)}),_&&(D==null||D(),w(m.current),o&&(d==null||d()),r&&r())};return c.jsx(UB,{isPresent:C,initial:!p.current||n?void 0:!1,custom:e,presenceAffectsLayout:s,mode:i,root:l,onExitComplete:C?void 0:S,anchorX:a,children:k},I)})})},VB=b.createContext(null);function WB(){const t=b.useRef(!1);return Mw(()=>(t.current=!0,()=>{t.current=!1}),[]),t}function KB(){const t=WB(),[e,n]=b.useState(0),r=b.useCallback(()=>{t.current&&n(e+1)},[e]);return[b.useCallback(()=>Yn.postRender(r),[r]),e]}const GB=t=>!t.isLayoutDirty&&t.willUpdate(!1);function M2(){const t=new Set,e=new WeakMap,n=()=>t.forEach(GB);return{add:r=>{t.add(r),e.set(r,r.addEventListener("willUpdate",n))},remove:r=>{t.delete(r);const s=e.get(r);s&&(s(),e.delete(r)),n()},dirty:n}}const AD=t=>t===!0,qB=t=>AD(t===!0)||t==="id",YB=({children:t,id:e,inherit:n=!0})=>{const r=b.useContext(yf),s=b.useContext(VB),[i,o]=KB(),a=b.useRef(null),l=r.id||s;a.current===null&&(qB(n)&&l&&(e=e?l+"-"+e:l),a.current={id:e,group:AD(n)&&r.group||M2()});const u=b.useMemo(()=>({...a.current,forceRender:i}),[o]);return c.jsx(yf.Provider,{value:u,children:t})},RD=b.createContext({strict:!1}),A2={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},bu={};for(const t in A2)bu[t]={isEnabled:e=>A2[t].some(n=>!!e[n])};function JB(t){for(const e in t)bu[e]={...bu[e],...t[e]}}const XB=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function um(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||XB.has(t)}let OD=t=>!um(t);function QB(t){typeof t=="function"&&(OD=e=>e.startsWith("on")?!um(e):t(e))}try{QB(require("@emotion/is-prop-valid").default)}catch{}function ZB(t,e,n){const r={};for(const s in t)s==="values"&&typeof t.values=="object"||(OD(s)||n===!0&&um(s)||!e&&!um(s)||t.draggable&&s.startsWith("onDrag"))&&(r[s]=t[s]);return r}const Ag=b.createContext({});function Rg(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function vf(t){return typeof t=="string"||Array.isArray(t)}const ev=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],tv=["initial",...ev];function Og(t){return Rg(t.animate)||tv.some(e=>vf(t[e]))}function PD(t){return!!(Og(t)||t.variants)}function eU(t,e){if(Og(t)){const{initial:n,animate:r}=t;return{initial:n===!1||vf(n)?n:void 0,animate:vf(r)?r:void 0}}return t.inherit!==!1?e:{}}function tU(t){const{initial:e,animate:n}=eU(t,b.useContext(Ag));return b.useMemo(()=>({initial:e,animate:n}),[R2(e),R2(n)])}function R2(t){return Array.isArray(t)?t.join(" "):t}function O2(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Xu={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(Qt.test(t))t=parseFloat(t);else return t;const n=O2(t,e.target.x),r=O2(t,e.target.y);return`${n}% ${r}%`}},nU={correct:(t,{treeScale:e,projectionDelta:n})=>{const r=t,s=Ha.parse(t);if(s.length>5)return r;const i=Ha.createTransformer(t),o=typeof s[0]!="number"?1:0,a=n.x.scale*e.x,l=n.y.scale*e.y;s[0+o]/=a,s[1+o]/=l;const u=lr(a,l,.5);return typeof s[2+o]=="number"&&(s[2+o]/=u),typeof s[3+o]=="number"&&(s[3+o]/=u),i(s)}},w1={borderRadius:{...Xu,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Xu,borderTopRightRadius:Xu,borderBottomLeftRadius:Xu,borderBottomRightRadius:Xu,boxShadow:nU};function LD(t,{layout:e,layoutId:n}){return Ou.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!w1[t]||t==="opacity")}const rU={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},sU=Ru.length;function iU(t,e,n){let r="",s=!0;for(let i=0;i<sU;i++){const o=Ru[i],a=t[o];if(a===void 0)continue;let l=!0;if(typeof a=="number"?l=a===(o.startsWith("scale")?1:0):l=parseFloat(a)===0,!l||n){const u=CD(a,Jw[o]);if(!l){s=!1;const d=rU[o]||o;r+=`${d}(${u}) `}n&&(e[o]=u)}}return r=r.trim(),n?r=n(e,s?"":r):s&&(r="none"),r}function nv(t,e,n){const{style:r,vars:s,transformOrigin:i}=t;let o=!1,a=!1;for(const l in e){const u=e[l];if(Ou.has(l)){o=!0;continue}else if(rD(l)){s[l]=u;continue}else{const d=CD(u,Jw[l]);l.startsWith("origin")?(a=!0,i[l]=d):r[l]=d}}if(e.transform||(o||n?r.transform=iU(e,t.transform,n):r.transform&&(r.transform="none")),a){const{originX:l="50%",originY:u="50%",originZ:d=0}=i;r.transformOrigin=`${l} ${u} ${d}`}}const rv=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function $D(t,e,n){for(const r in e)!fs(e[r])&&!LD(r,n)&&(t[r]=e[r])}function oU({transformTemplate:t},e){return b.useMemo(()=>{const n=rv();return nv(n,e,t),Object.assign({},n.vars,n.style)},[e])}function aU(t,e){const n=t.style||{},r={};return $D(r,n,t),Object.assign(r,oU(t,e)),r}function lU(t,e){const n={},r=aU(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=r,n}const cU={offset:"stroke-dashoffset",array:"stroke-dasharray"},uU={offset:"strokeDashoffset",array:"strokeDasharray"};function dU(t,e,n=1,r=0,s=!0){t.pathLength=1;const i=s?cU:uU;t[i.offset]=Qt.transform(-r);const o=Qt.transform(e),a=Qt.transform(n);t[i.array]=`${o} ${a}`}function zD(t,{attrX:e,attrY:n,attrScale:r,pathLength:s,pathSpacing:i=1,pathOffset:o=0,...a},l,u,d){if(nv(t,a,u),l){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:f,style:h}=t;f.transform&&(h.transform=f.transform,delete f.transform),(h.transform||f.transformOrigin)&&(h.transformOrigin=f.transformOrigin??"50% 50%",delete f.transformOrigin),h.transform&&(h.transformBox=(d==null?void 0:d.transformBox)??"fill-box",delete f.transformBox),e!==void 0&&(f.x=e),n!==void 0&&(f.y=n),r!==void 0&&(f.scale=r),s!==void 0&&dU(f,s,i,o,!1)}const FD=()=>({...rv(),attrs:{}}),BD=t=>typeof t=="string"&&t.toLowerCase()==="svg";function fU(t,e,n,r){const s=b.useMemo(()=>{const i=FD();return zD(i,e,BD(r),t.transformTemplate,t.style),{...i.attrs,style:{...i.style}}},[e]);if(t.style){const i={};$D(i,t.style,t),s.style={...i,...s.style}}return s}const hU=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function sv(t){return typeof t!="string"||t.includes("-")?!1:!!(hU.indexOf(t)>-1||/[A-Z]/u.test(t))}function pU(t,e,n,{latestValues:r},s,i=!1){const a=(sv(t)?fU:lU)(e,r,s,t),l=ZB(e,typeof t=="string",i),u=t!==b.Fragment?{...l,...a,ref:n}:{},{children:d}=e,f=b.useMemo(()=>fs(d)?d.get():d,[d]);return b.createElement(t,{...u,children:f})}function P2(t){const e=[{},{}];return t==null||t.values.forEach((n,r)=>{e[0][r]=n.get(),e[1][r]=n.getVelocity()}),e}function iv(t,e,n,r){if(typeof e=="function"){const[s,i]=P2(r);e=e(n!==void 0?n:t.custom,s,i)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[s,i]=P2(r);e=e(n!==void 0?n:t.custom,s,i)}return e}function yp(t){return fs(t)?t.get():t}function mU({scrapeMotionValuesFromProps:t,createRenderState:e},n,r,s){return{latestValues:gU(n,r,s,t),renderState:e()}}function gU(t,e,n,r){const s={},i=r(t,{});for(const h in i)s[h]=yp(i[h]);let{initial:o,animate:a}=t;const l=Og(t),u=PD(t);e&&u&&!l&&t.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let d=n?n.initial===!1:!1;d=d||o===!1;const f=d?a:o;if(f&&typeof f!="boolean"&&!Rg(f)){const h=Array.isArray(f)?f:[f];for(let p=0;p<h.length;p++){const m=iv(t,h[p]);if(m){const{transitionEnd:y,transition:x,...g}=m;for(const v in g){let w=g[v];if(Array.isArray(w)){const T=d?w.length-1:0;w=w[T]}w!==null&&(s[v]=w)}for(const v in y)s[v]=y[v]}}}return s}const UD=t=>(e,n)=>{const r=b.useContext(Ag),s=b.useContext(Mg),i=()=>mU(t,e,r,s);return n?i():Iw(i)};function ov(t,e,n){var i;const{style:r}=t,s={};for(const o in r)(fs(r[o])||e.style&&fs(e.style[o])||LD(o,t)||((i=n==null?void 0:n.getValue(o))==null?void 0:i.liveStyle)!==void 0)&&(s[o]=r[o]);return s}const yU=UD({scrapeMotionValuesFromProps:ov,createRenderState:rv});function HD(t,e,n){const r=ov(t,e,n);for(const s in t)if(fs(t[s])||fs(e[s])){const i=Ru.indexOf(s)!==-1?"attr"+s.charAt(0).toUpperCase()+s.substring(1):s;r[i]=t[s]}return r}const xU=UD({scrapeMotionValuesFromProps:HD,createRenderState:FD}),bU=Symbol.for("motionComponentSymbol");function Hc(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function wU(t,e,n){return b.useCallback(r=>{r&&t.onMount&&t.onMount(r),e&&(r?e.mount(r):e.unmount()),n&&(typeof n=="function"?n(r):Hc(n)&&(n.current=r))},[e])}const av=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),vU="framerAppearId",VD="data-"+av(vU),WD=b.createContext({});function kU(t,e,n,r,s){var y,x;const{visualElement:i}=b.useContext(Ag),o=b.useContext(RD),a=b.useContext(Mg),l=b.useContext(Zw).reducedMotion,u=b.useRef(null);r=r||o.renderer,!u.current&&r&&(u.current=r(t,{visualState:e,parent:i,props:n,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:l}));const d=u.current,f=b.useContext(WD);d&&!d.projection&&s&&(d.type==="html"||d.type==="svg")&&SU(u.current,n,s,f);const h=b.useRef(!1);b.useInsertionEffect(()=>{d&&h.current&&d.update(n,a)});const p=n[VD],m=b.useRef(!!p&&!((y=window.MotionHandoffIsComplete)!=null&&y.call(window,p))&&((x=window.MotionHasOptimisedAnimation)==null?void 0:x.call(window,p)));return Mw(()=>{d&&(h.current=!0,window.MotionIsMounted=!0,d.updateFeatures(),d.scheduleRenderMicrotask(),m.current&&d.animationState&&d.animationState.animateChanges())}),b.useEffect(()=>{d&&(!m.current&&d.animationState&&d.animationState.animateChanges(),m.current&&(queueMicrotask(()=>{var g;(g=window.MotionHandoffMarkAsComplete)==null||g.call(window,p)}),m.current=!1),d.enteringChildren=void 0)}),d}function SU(t,e,n,r){const{layoutId:s,layout:i,drag:o,dragConstraints:a,layoutScroll:l,layoutRoot:u,layoutCrossfade:d}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:KD(t.parent)),t.projection.setOptions({layoutId:s,layout:i,alwaysMeasureLayout:!!o||a&&Hc(a),visualElement:t,animationType:typeof i=="string"?i:"both",initialPromotionConfig:r,crossfade:d,layoutScroll:l,layoutRoot:u})}function KD(t){if(t)return t.options.allowProjection!==!1?t.projection:KD(t.parent)}function q0(t,{forwardMotionProps:e=!1}={},n,r){n&&JB(n);const s=sv(t)?xU:yU;function i(a,l){let u;const d={...b.useContext(Zw),...a,layoutId:_U(a)},{isStatic:f}=d,h=tU(a),p=s(a,f);if(!f&&Dw){TU();const m=CU(d);u=m.MeasureLayout,h.visualElement=kU(t,p,d,r,m.ProjectionNode)}return c.jsxs(Ag.Provider,{value:h,children:[u&&h.visualElement?c.jsx(u,{visualElement:h.visualElement,...d}):null,pU(t,a,wU(p,h.visualElement,l),p,f,e)]})}i.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const o=b.forwardRef(i);return o[bU]=t,o}function _U({layoutId:t}){const e=b.useContext(yf).id;return e&&t!==void 0?e+"-"+t:t}function TU(t,e){b.useContext(RD).strict}function CU(t){const{drag:e,layout:n}=bu;if(!e&&!n)return{};const r={...e,...n};return{MeasureLayout:e!=null&&e.isEnabled(t)||n!=null&&n.isEnabled(t)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function EU(t,e){if(typeof Proxy>"u")return q0;const n=new Map,r=(i,o)=>q0(i,o,t,e),s=(i,o)=>r(i,o);return new Proxy(s,{get:(i,o)=>o==="create"?r:(n.has(o)||n.set(o,q0(o,void 0,t,e)),n.get(o))})}function GD({top:t,left:e,right:n,bottom:r}){return{x:{min:e,max:n},y:{min:t,max:r}}}function NU({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function jU(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),r=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:r.y,right:r.x}}function Y0(t){return t===void 0||t===1}function v1({scale:t,scaleX:e,scaleY:n}){return!Y0(t)||!Y0(e)||!Y0(n)}function pl(t){return v1(t)||qD(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function qD(t){return L2(t.x)||L2(t.y)}function L2(t){return t&&t!=="0%"}function dm(t,e,n){const r=t-n,s=e*r;return n+s}function $2(t,e,n,r,s){return s!==void 0&&(t=dm(t,s,r)),dm(t,n,r)+e}function k1(t,e=0,n=1,r,s){t.min=$2(t.min,e,n,r,s),t.max=$2(t.max,e,n,r,s)}function YD(t,{x:e,y:n}){k1(t.x,e.translate,e.scale,e.originPoint),k1(t.y,n.translate,n.scale,n.originPoint)}const z2=.999999999999,F2=1.0000000000001;function IU(t,e,n,r=!1){const s=n.length;if(!s)return;e.x=e.y=1;let i,o;for(let a=0;a<s;a++){i=n[a],o=i.projectionDelta;const{visualElement:l}=i.options;l&&l.props.style&&l.props.style.display==="contents"||(r&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Wc(t,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,YD(t,o)),r&&pl(i.latestValues)&&Wc(t,i.latestValues))}e.x<F2&&e.x>z2&&(e.x=1),e.y<F2&&e.y>z2&&(e.y=1)}function Vc(t,e){t.min=t.min+e,t.max=t.max+e}function B2(t,e,n,r,s=.5){const i=lr(t.min,t.max,s);k1(t,e,n,i,r)}function Wc(t,e){B2(t.x,e.x,e.scaleX,e.scale,e.originX),B2(t.y,e.y,e.scaleY,e.scale,e.originY)}function JD(t,e){return GD(jU(t.getBoundingClientRect(),e))}function DU(t,e,n){const r=JD(t,n),{scroll:s}=e;return s&&(Vc(r.x,s.offset.x),Vc(r.y,s.offset.y)),r}const U2=()=>({translate:0,scale:1,origin:0,originPoint:0}),Kc=()=>({x:U2(),y:U2()}),H2=()=>({min:0,max:0}),Ir=()=>({x:H2(),y:H2()}),S1={current:null},XD={current:!1};function MU(){if(XD.current=!0,!!Dw)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>S1.current=t.matches;t.addEventListener("change",e),e()}else S1.current=!1}const AU=new WeakMap;function RU(t,e,n){for(const r in e){const s=e[r],i=n[r];if(fs(s))t.addValue(r,s);else if(fs(i))t.addValue(r,xu(s,{owner:t}));else if(i!==s)if(t.hasValue(r)){const o=t.getValue(r);o.liveStyle===!0?o.jump(s):o.hasAnimated||o.set(s)}else{const o=t.getStaticValue(r);t.addValue(r,xu(o!==void 0?o:s,{owner:t}))}}for(const r in n)e[r]===void 0&&t.removeValue(r);return e}const V2=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class OU{scrapeMotionValuesFromProps(e,n,r){return{}}constructor({parent:e,props:n,presenceContext:r,reducedMotionConfig:s,blockInitialAnimation:i,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=qw,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const h=Os.now();this.renderScheduledAt<h&&(this.renderScheduledAt=h,Yn.render(this.render,!1,!0))};const{latestValues:l,renderState:u}=o;this.latestValues=l,this.baseTarget={...l},this.initialValues=n.initial?{...l}:{},this.renderState=u,this.parent=e,this.props=n,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=s,this.options=a,this.blockInitialAnimation=!!i,this.isControllingVariants=Og(n),this.isVariantNode=PD(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...f}=this.scrapeMotionValuesFromProps(n,{},this);for(const h in f){const p=f[h];l[h]!==void 0&&fs(p)&&p.set(l[h])}}mount(e){var n;this.current=e,AU.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,s)=>this.bindToMotionValue(s,r)),XD.current||MU(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:S1.current,(n=this.parent)==null||n.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var e;this.projection&&this.projection.unmount(),Ua(this.notifyUpdate),Ua(this.render),this.valueSubscriptions.forEach(n=>n()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(e=this.parent)==null||e.removeChild(this);for(const n in this.events)this.events[n].clear();for(const n in this.features){const r=this.features[n];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=Ou.has(e);r&&this.onBindTransform&&this.onBindTransform();const s=n.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&Yn.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let i;window.MotionCheckAppearSync&&(i=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{s(),i&&i(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in bu){const n=bu[e];if(!n)continue;const{isEnabled:r,Feature:s}=n;if(!this.features[e]&&s&&r(this.props)&&(this.features[e]=new s(this)),this.features[e]){const i=this.features[e];i.isMounted?i.update():(i.mount(),i.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ir()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let r=0;r<V2.length;r++){const s=V2[r];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const i="on"+s,o=e[i];o&&(this.propEventSubscriptions[s]=this.on(s,o))}this.prevMotionValues=RU(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const r=this.values.get(e);n!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&n!==void 0&&(r=xu(n===null?void 0:n,{owner:this}),this.addValue(e,r)),r}readValue(e,n){let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(BI(r)||HI(r))?r=parseFloat(r):!LB(r)&&Ha.test(n)&&(r=TD(e,n)),this.setBaseTarget(e,fs(r)?r.get():r)),fs(r)?r.get():r}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var i;const{initial:n}=this.props;let r;if(typeof n=="string"||typeof n=="object"){const o=iv(this.props,n,(i=this.presenceContext)==null?void 0:i.custom);o&&(r=o[e])}if(n&&r!==void 0)return r;const s=this.getBaseTargetFromProps(this.props,e);return s!==void 0&&!fs(s)?s:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new Lw),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}scheduleRenderMicrotask(){Xw.render(this.render)}}class QD extends OU{constructor(){super(...arguments),this.KeyframeResolver=TB}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:r}){delete n[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;fs(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function ZD(t,{style:e,vars:n},r,s){const i=t.style;let o;for(o in e)i[o]=e[o];s==null||s.applyProjectionStyles(i,r);for(o in n)i.setProperty(o,n[o])}function PU(t){return window.getComputedStyle(t)}class LU extends QD{constructor(){super(...arguments),this.type="html",this.renderInstance=ZD}readValueFromInstance(e,n){var r;if(Ou.has(n))return(r=this.projection)!=null&&r.isProjecting?h1(n):VF(e,n);{const s=PU(e),i=(rD(n)?s.getPropertyValue(n):s[n])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:n}){return JD(e,n)}build(e,n,r){nv(e,n,r.transformTemplate)}scrapeMotionValuesFromProps(e,n,r){return ov(e,n,r)}}const eM=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function $U(t,e,n,r){ZD(t,e,void 0,r);for(const s in e.attrs)t.setAttribute(eM.has(s)?s:av(s),e.attrs[s])}class zU extends QD{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ir}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(Ou.has(n)){const r=_D(n);return r&&r.default||0}return n=eM.has(n)?n:av(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,r){return HD(e,n,r)}build(e,n,r){zD(e,n,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(e,n,r,s){$U(e,n,r,s)}mount(e){this.isSVGTag=BD(e.tagName),super.mount(e)}}const FU=(t,e)=>sv(t)?new zU(e):new LU(e,{allowProjection:t!==b.Fragment});function su(t,e,n){const r=t.getProps();return iv(r,e,n!==void 0?n:r.custom,t)}const _1=t=>Array.isArray(t);function BU(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,xu(n))}function UU(t){return _1(t)?t[t.length-1]||0:t}function HU(t,e){const n=su(t,e);let{transitionEnd:r={},transition:s={},...i}=n||{};i={...i,...r};for(const o in i){const a=UU(i[o]);BU(t,o,a)}}function VU(t){return!!(fs(t)&&t.add)}function T1(t,e){const n=t.getValue("willChange");if(VU(n))return n.add(e);if(!n&&Yo.WillChange){const r=new Yo.WillChange("auto");t.addValue("willChange",r),r.add(e)}}function tM(t){return t.props[VD]}const WU=t=>t!==null;function KU(t,{repeat:e,repeatType:n="loop"},r){const s=t.filter(WU),i=e&&n!=="loop"&&e%2===1?0:s.length-1;return!i||r===void 0?s[i]:r}const GU={type:"spring",stiffness:500,damping:25,restSpeed:10},qU=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),YU={type:"keyframes",duration:.8},JU={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},XU=(t,{keyframes:e})=>e.length>2?YU:Ou.has(t)?t.startsWith("scale")?qU(e[1]):GU:JU;function QU({when:t,delay:e,delayChildren:n,staggerChildren:r,staggerDirection:s,repeat:i,repeatType:o,repeatDelay:a,from:l,elapsed:u,...d}){return!!Object.keys(d).length}const lv=(t,e,n,r={},s,i)=>o=>{const a=Yw(r,t)||{},l=a.delay||r.delay||0;let{elapsed:u=0}=r;u=u-po(l);const d={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-u,onUpdate:h=>{e.set(h),a.onUpdate&&a.onUpdate(h)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:t,motionValue:e,element:i?void 0:s};QU(a)||Object.assign(d,XU(t,d)),d.duration&&(d.duration=po(d.duration)),d.repeatDelay&&(d.repeatDelay=po(d.repeatDelay)),d.from!==void 0&&(d.keyframes[0]=d.from);let f=!1;if((d.type===!1||d.duration===0&&!d.repeatDelay)&&(x1(d),d.delay===0&&(f=!0)),(Yo.instantAnimations||Yo.skipAnimations)&&(f=!0,x1(d),d.delay=0),d.allowFlatten=!a.type&&!a.ease,f&&!i&&e.get()!==void 0){const h=KU(d.keyframes,a);if(h!==void 0){Yn.update(()=>{d.onUpdate(h),d.onComplete()});return}}return a.isSync?new Gw(d):new hB(d)};function ZU({protectedKeys:t,needsAnimating:e},n){const r=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,r}function nM(t,e,{delay:n=0,transitionOverride:r,type:s}={}){let{transition:i=t.getDefaultTransition(),transitionEnd:o,...a}=e;r&&(i=r);const l=[],u=s&&t.animationState&&t.animationState.getState()[s];for(const d in a){const f=t.getValue(d,t.latestValues[d]??null),h=a[d];if(h===void 0||u&&ZU(u,d))continue;const p={delay:n,...Yw(i||{},d)},m=f.get();if(m!==void 0&&!f.isAnimating&&!Array.isArray(h)&&h===m&&!p.velocity)continue;let y=!1;if(window.MotionHandoffAnimation){const g=tM(t);if(g){const v=window.MotionHandoffAnimation(g,d,Yn);v!==null&&(p.startTime=v,y=!0)}}T1(t,d),f.start(lv(d,f,h,t.shouldReduceMotion&&vD.has(d)?{type:!1}:p,t,y));const x=f.animation;x&&l.push(x)}return o&&Promise.all(l).then(()=>{Yn.update(()=>{o&&HU(t,o)})}),l}function rM(t,e,n,r=0,s=1){const i=Array.from(t).sort((u,d)=>u.sortNodePosition(d)).indexOf(e),o=t.size,a=(o-1)*r;return typeof n=="function"?n(i,o):s===1?i*r:a-i*r}function C1(t,e,n={}){var l;const r=su(t,e,n.type==="exit"?(l=t.presenceContext)==null?void 0:l.custom:void 0);let{transition:s=t.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(s=n.transitionOverride);const i=r?()=>Promise.all(nM(t,r,n)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?(u=0)=>{const{delayChildren:d=0,staggerChildren:f,staggerDirection:h}=s;return e8(t,e,u,d,f,h,n)}:()=>Promise.resolve(),{when:a}=s;if(a){const[u,d]=a==="beforeChildren"?[i,o]:[o,i];return u().then(()=>d())}else return Promise.all([i(),o(n.delay)])}function e8(t,e,n=0,r=0,s=0,i=1,o){const a=[];for(const l of t.variantChildren)l.notify("AnimationStart",e),a.push(C1(l,e,{...o,delay:n+(typeof r=="function"?0:r)+rM(t.variantChildren,l,r,s,i)}).then(()=>l.notify("AnimationComplete",e)));return Promise.all(a)}function t8(t,e,n={}){t.notify("AnimationStart",e);let r;if(Array.isArray(e)){const s=e.map(i=>C1(t,i,n));r=Promise.all(s)}else if(typeof e=="string")r=C1(t,e,n);else{const s=typeof e=="function"?su(t,e,n.custom):e;r=Promise.all(nM(t,s,n))}return r.then(()=>{t.notify("AnimationComplete",e)})}function sM(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}const n8=tv.length;function iM(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?iM(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<n8;n++){const r=tv[n],s=t.props[r];(vf(s)||s===!1)&&(e[r]=s)}return e}const r8=[...ev].reverse(),s8=ev.length;function i8(t){return e=>Promise.all(e.map(({animation:n,options:r})=>t8(t,n,r)))}function o8(t){let e=i8(t),n=W2(),r=!0;const s=l=>(u,d)=>{var h;const f=su(t,d,l==="exit"?(h=t.presenceContext)==null?void 0:h.custom:void 0);if(f){const{transition:p,transitionEnd:m,...y}=f;u={...u,...y,...m}}return u};function i(l){e=l(t)}function o(l){const{props:u}=t,d=iM(t.parent)||{},f=[],h=new Set;let p={},m=1/0;for(let x=0;x<s8;x++){const g=r8[x],v=n[g],w=u[g]!==void 0?u[g]:d[g],T=vf(w),D=g===l?v.isActive:null;D===!1&&(m=x);let k=w===d[g]&&w!==u[g]&&T;if(k&&r&&t.manuallyAnimateOnMount&&(k=!1),v.protectedKeys={...p},!v.isActive&&D===null||!w&&!v.prevProp||Rg(w)||typeof w=="boolean")continue;const I=a8(v.prevProp,w);let C=I||g===l&&v.isActive&&!k&&T||x>m&&T,S=!1;const _=Array.isArray(w)?w:[w];let N=_.reduce(s(g),{});D===!1&&(N={});const{prevResolvedValues:j={}}=v,O={...j,...N},P=M=>{C=!0,h.has(M)&&(S=!0,h.delete(M)),v.needsAnimating[M]=!0;const X=t.getValue(M);X&&(X.liveStyle=!1)};for(const M in O){const X=N[M],Q=j[M];if(p.hasOwnProperty(M))continue;let A=!1;_1(X)&&_1(Q)?A=!sM(X,Q):A=X!==Q,A?X!=null?P(M):h.add(M):X!==void 0&&h.has(M)?P(M):v.protectedKeys[M]=!0}v.prevProp=w,v.prevResolvedValues=N,v.isActive&&(p={...p,...N}),r&&t.blockInitialAnimation&&(C=!1);const W=k&&I;C&&(!W||S)&&f.push(..._.map(M=>{const X={type:g};if(typeof M=="string"&&r&&!W&&t.manuallyAnimateOnMount&&t.parent){const{parent:Q}=t,A=su(Q,M);if(Q.enteringChildren&&A){const{delayChildren:Te}=A.transition||{};X.delay=rM(Q.enteringChildren,t,Te)}}return{animation:M,options:X}}))}if(h.size){const x={};if(typeof u.initial!="boolean"){const g=su(t,Array.isArray(u.initial)?u.initial[0]:u.initial);g&&g.transition&&(x.transition=g.transition)}h.forEach(g=>{const v=t.getBaseTarget(g),w=t.getValue(g);w&&(w.liveStyle=!0),x[g]=v??null}),f.push({animation:x})}let y=!!f.length;return r&&(u.initial===!1||u.initial===u.animate)&&!t.manuallyAnimateOnMount&&(y=!1),r=!1,y?e(f):Promise.resolve()}function a(l,u){var f;if(n[l].isActive===u)return Promise.resolve();(f=t.variantChildren)==null||f.forEach(h=>{var p;return(p=h.animationState)==null?void 0:p.setActive(l,u)}),n[l].isActive=u;const d=o(l);for(const h in n)n[h].protectedKeys={};return d}return{animateChanges:o,setActive:a,setAnimateFunction:i,getState:()=>n,reset:()=>{n=W2()}}}function a8(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!sM(e,t):!1}function cl(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function W2(){return{animate:cl(!0),whileInView:cl(),whileHover:cl(),whileTap:cl(),whileDrag:cl(),whileFocus:cl(),exit:cl()}}class Ja{constructor(e){this.isMounted=!1,this.node=e}update(){}}class l8 extends Ja{constructor(e){super(e),e.animationState||(e.animationState=o8(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Rg(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)==null||e.call(this)}}let c8=0;class u8 extends Ja{constructor(){super(...arguments),this.id=c8++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const s=this.node.animationState.setActive("exit",!e);n&&!e&&s.then(()=>{n(this.id)})}mount(){const{register:e,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const d8={animation:{Feature:l8},exit:{Feature:u8}};function kf(t,e,n,r={passive:!0}){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n)}function Xf(t){return{point:{x:t.pageX,y:t.pageY}}}const f8=t=>e=>Qw(e)&&t(e,Xf(e));function Nd(t,e,n,r){return kf(t,e,f8(n),r)}const oM=1e-4,h8=1-oM,p8=1+oM,aM=.01,m8=0-aM,g8=0+aM;function vs(t){return t.max-t.min}function y8(t,e,n){return Math.abs(t-e)<=n}function K2(t,e,n,r=.5){t.origin=r,t.originPoint=lr(e.min,e.max,t.origin),t.scale=vs(n)/vs(e),t.translate=lr(n.min,n.max,t.origin)-t.originPoint,(t.scale>=h8&&t.scale<=p8||isNaN(t.scale))&&(t.scale=1),(t.translate>=m8&&t.translate<=g8||isNaN(t.translate))&&(t.translate=0)}function jd(t,e,n,r){K2(t.x,e.x,n.x,r?r.originX:void 0),K2(t.y,e.y,n.y,r?r.originY:void 0)}function G2(t,e,n){t.min=n.min+e.min,t.max=t.min+vs(e)}function x8(t,e,n){G2(t.x,e.x,n.x),G2(t.y,e.y,n.y)}function q2(t,e,n){t.min=e.min-n.min,t.max=t.min+vs(e)}function fm(t,e,n){q2(t.x,e.x,n.x),q2(t.y,e.y,n.y)}function ci(t){return[t("x"),t("y")]}const lM=({current:t})=>t?t.ownerDocument.defaultView:null,Y2=(t,e)=>Math.abs(t-e);function b8(t,e){const n=Y2(t.x,e.x),r=Y2(t.y,e.y);return Math.sqrt(n**2+r**2)}class cM{constructor(e,n,{transformPagePoint:r,contextWindow:s=window,dragSnapToOrigin:i=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=X0(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,m=b8(h.offset,{x:0,y:0})>=this.distanceThreshold;if(!p&&!m)return;const{point:y}=h,{timestamp:x}=Jr;this.history.push({...y,timestamp:x});const{onStart:g,onMove:v}=this.handlers;p||(g&&g(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),v&&v(this.lastMoveEvent,h)},this.handlePointerMove=(h,p)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=J0(p,this.transformPagePoint),Yn.update(this.updatePoint,!0)},this.handlePointerUp=(h,p)=>{this.end();const{onEnd:m,onSessionEnd:y,resumeAnimation:x}=this.handlers;if(this.dragSnapToOrigin&&x&&x(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=X0(h.type==="pointercancel"?this.lastMoveEventInfo:J0(p,this.transformPagePoint),this.history);this.startEvent&&m&&m(h,g),y&&y(h,g)},!Qw(e))return;this.dragSnapToOrigin=i,this.handlers=n,this.transformPagePoint=r,this.distanceThreshold=o,this.contextWindow=s||window;const a=Xf(e),l=J0(a,this.transformPagePoint),{point:u}=l,{timestamp:d}=Jr;this.history=[{...u,timestamp:d}];const{onSessionStart:f}=n;f&&f(e,X0(l,this.history)),this.removeListeners=qf(Nd(this.contextWindow,"pointermove",this.handlePointerMove),Nd(this.contextWindow,"pointerup",this.handlePointerUp),Nd(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Ua(this.updatePoint)}}function J0(t,e){return e?{point:e(t.point)}:t}function J2(t,e){return{x:t.x-e.x,y:t.y-e.y}}function X0({point:t},e){return{point:t,delta:J2(t,uM(e)),offset:J2(t,w8(e)),velocity:v8(e,.1)}}function w8(t){return t[0]}function uM(t){return t[t.length-1]}function v8(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,r=null;const s=uM(t);for(;n>=0&&(r=t[n],!(s.timestamp-r.timestamp>po(e)));)n--;if(!r)return{x:0,y:0};const i=bi(s.timestamp-r.timestamp);if(i===0)return{x:0,y:0};const o={x:(s.x-r.x)/i,y:(s.y-r.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function k8(t,{min:e,max:n},r){return e!==void 0&&t<e?t=r?lr(e,t,r.min):Math.max(t,e):n!==void 0&&t>n&&(t=r?lr(n,t,r.max):Math.min(t,n)),t}function X2(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function S8(t,{top:e,left:n,bottom:r,right:s}){return{x:X2(t.x,n,s),y:X2(t.y,e,r)}}function Q2(t,e){let n=e.min-t.min,r=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,r]=[r,n]),{min:n,max:r}}function _8(t,e){return{x:Q2(t.x,e.x),y:Q2(t.y,e.y)}}function T8(t,e){let n=.5;const r=vs(t),s=vs(e);return s>r?n=xf(e.min,e.max-r,t.min):r>s&&(n=xf(t.min,t.max-s,e.min)),qo(0,1,n)}function C8(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const E1=.35;function E8(t=E1){return t===!1?t=0:t===!0&&(t=E1),{x:Z2(t,"left","right"),y:Z2(t,"top","bottom")}}function Z2(t,e,n){return{min:e_(t,e),max:e_(t,n)}}function e_(t,e){return typeof t=="number"?t:t[e]||0}const N8=new WeakMap;class j8{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ir(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:n=!1,distanceThreshold:r}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const i=f=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(Xf(f).point)},o=(f,h)=>{const{drag:p,dragPropagation:m,onDragStart:y}=this.getProps();if(p&&!m&&(this.openDragLock&&this.openDragLock(),this.openDragLock=jB(p),!this.openDragLock))return;this.latestPointerEvent=f,this.latestPanInfo=h,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),ci(g=>{let v=this.getAxisMotionValue(g).get()||0;if(mo.test(v)){const{projection:w}=this.visualElement;if(w&&w.layout){const T=w.layout.layoutBox[g];T&&(v=vs(T)*(parseFloat(v)/100))}}this.originPoint[g]=v}),y&&Yn.postRender(()=>y(f,h)),T1(this.visualElement,"transform");const{animationState:x}=this.visualElement;x&&x.setActive("whileDrag",!0)},a=(f,h)=>{this.latestPointerEvent=f,this.latestPanInfo=h;const{dragPropagation:p,dragDirectionLock:m,onDirectionLock:y,onDrag:x}=this.getProps();if(!p&&!this.openDragLock)return;const{offset:g}=h;if(m&&this.currentDirection===null){this.currentDirection=I8(g),this.currentDirection!==null&&y&&y(this.currentDirection);return}this.updateAxis("x",h.point,g),this.updateAxis("y",h.point,g),this.visualElement.render(),x&&x(f,h)},l=(f,h)=>{this.latestPointerEvent=f,this.latestPanInfo=h,this.stop(f,h),this.latestPointerEvent=null,this.latestPanInfo=null},u=()=>ci(f=>{var h;return this.getAnimationState(f)==="paused"&&((h=this.getAxisMotionValue(f).animation)==null?void 0:h.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new cM(e,{onSessionStart:i,onStart:o,onMove:a,onSessionEnd:l,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,distanceThreshold:r,contextWindow:lM(this.visualElement)})}stop(e,n){const r=e||this.latestPointerEvent,s=n||this.latestPanInfo,i=this.isDragging;if(this.cancel(),!i||!s||!r)return;const{velocity:o}=s;this.startAnimation(o);const{onDragEnd:a}=this.getProps();a&&Yn.postRender(()=>a(r,s))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,r){const{drag:s}=this.getProps();if(!r||!Dh(e,s,this.currentDirection))return;const i=this.getAxisMotionValue(e);let o=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(o=k8(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){var i;const{dragConstraints:e,dragElastic:n}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(i=this.visualElement.projection)==null?void 0:i.layout,s=this.constraints;e&&Hc(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&r?this.constraints=S8(r.layoutBox,e):this.constraints=!1,this.elastic=E8(n),s!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&ci(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=C8(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!Hc(e))return!1;const r=e.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const i=DU(r,s.root,this.visualElement.getTransformPagePoint());let o=_8(s.layout.layoutBox,i);if(n){const a=n(NU(o));this.hasMutatedConstraints=!!a,a&&(o=GD(a))}return o}startAnimation(e){const{drag:n,dragMomentum:r,dragElastic:s,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),l=this.constraints||{},u=ci(d=>{if(!Dh(d,n,this.currentDirection))return;let f=l&&l[d]||{};o&&(f={min:0,max:0});const h=s?200:1e6,p=s?40:1e7,m={type:"inertia",velocity:r?e[d]:0,bounceStiffness:h,bounceDamping:p,timeConstant:750,restDelta:1,restSpeed:10,...i,...f};return this.startAxisValueAnimation(d,m)});return Promise.all(u).then(a)}startAxisValueAnimation(e,n){const r=this.getAxisMotionValue(e);return T1(this.visualElement,e),r.start(lv(e,r,0,n,this.visualElement,!1))}stopAnimation(){ci(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){ci(e=>{var n;return(n=this.getAxisMotionValue(e).animation)==null?void 0:n.pause()})}getAnimationState(e){var n;return(n=this.getAxisMotionValue(e).animation)==null?void 0:n.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps(),s=r[n];return s||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){ci(n=>{const{drag:r}=this.getProps();if(!Dh(n,r,this.currentDirection))return;const{projection:s}=this.visualElement,i=this.getAxisMotionValue(n);if(s&&s.layout){const{min:o,max:a}=s.layout.layoutBox[n];i.set(e[n]-lr(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:r}=this.visualElement;if(!Hc(n)||!r||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};ci(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const l=a.get();s[o]=T8({min:l,max:l},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),ci(o=>{if(!Dh(o,e,null))return;const a=this.getAxisMotionValue(o),{min:l,max:u}=this.constraints[o];a.set(lr(l,u,s[o]))})}addListeners(){if(!this.visualElement.current)return;N8.set(this.visualElement,this);const e=this.visualElement.current,n=Nd(e,"pointerdown",l=>{const{drag:u,dragListener:d=!0}=this.getProps();u&&d&&this.start(l)}),r=()=>{const{dragConstraints:l}=this.getProps();Hc(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,i=s.addEventListener("measure",r);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),Yn.read(r);const o=kf(window,"resize",()=>this.scalePositionWithinConstraints()),a=s.addEventListener("didUpdate",({delta:l,hasLayoutChanged:u})=>{this.isDragging&&u&&(ci(d=>{const f=this.getAxisMotionValue(d);f&&(this.originPoint[d]+=l[d].translate,f.set(f.get()+l[d].translate))}),this.visualElement.render())});return()=>{o(),n(),i(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:r=!1,dragPropagation:s=!1,dragConstraints:i=!1,dragElastic:o=E1,dragMomentum:a=!0}=e;return{...e,drag:n,dragDirectionLock:r,dragPropagation:s,dragConstraints:i,dragElastic:o,dragMomentum:a}}}function Dh(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function I8(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class D8 extends Ja{constructor(e){super(e),this.removeGroupControls=vi,this.removeListeners=vi,this.controls=new j8(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||vi}unmount(){this.removeGroupControls(),this.removeListeners()}}const t_=t=>(e,n)=>{t&&Yn.postRender(()=>t(e,n))};class M8 extends Ja{constructor(){super(...arguments),this.removePointerDownListener=vi}onPointerDown(e){this.session=new cM(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:lM(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:r,onPanEnd:s}=this.node.getProps();return{onSessionStart:t_(e),onStart:t_(n),onMove:r,onEnd:(i,o)=>{delete this.session,s&&Yn.postRender(()=>s(i,o))}}}mount(){this.removePointerDownListener=Nd(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const xp={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let Q0=!1;class A8 extends b.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r,layoutId:s}=this.props,{projection:i}=e;i&&(n.group&&n.group.add(i),r&&r.register&&s&&r.register(i),Q0&&i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),xp.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:r,drag:s,isPresent:i}=this.props,{projection:o}=r;return o&&(o.isPresent=i,Q0=!0,s||e.layoutDependency!==n||n===void 0||e.isPresent!==i?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||Yn.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Xw.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r}=this.props,{projection:s}=e;Q0=!0,s&&(s.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(s),r&&r.deregister&&r.deregister(s))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function dM(t){const[e,n]=MD(),r=b.useContext(yf);return c.jsx(A8,{...t,layoutGroup:r,switchLayoutGroup:b.useContext(WD),isPresent:e,safeToRemove:n})}function R8(t,e,n){const r=fs(t)?t:xu(t);return r.start(lv("",r,e,n)),r.animation}const O8=(t,e)=>t.depth-e.depth;class P8{constructor(){this.children=[],this.isDirty=!1}add(e){Aw(this.children,e),this.isDirty=!0}remove(e){Rw(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(O8),this.isDirty=!1,this.children.forEach(e)}}function L8(t,e){const n=Os.now(),r=({timestamp:s})=>{const i=s-n;i>=e&&(Ua(r),t(i-e))};return Yn.setup(r,!0),()=>Ua(r)}const fM=["TopLeft","TopRight","BottomLeft","BottomRight"],$8=fM.length,n_=t=>typeof t=="string"?parseFloat(t):t,r_=t=>typeof t=="number"||Qt.test(t);function z8(t,e,n,r,s,i){s?(t.opacity=lr(0,n.opacity??1,F8(r)),t.opacityExit=lr(e.opacity??1,0,B8(r))):i&&(t.opacity=lr(e.opacity??1,n.opacity??1,r));for(let o=0;o<$8;o++){const a=`border${fM[o]}Radius`;let l=s_(e,a),u=s_(n,a);if(l===void 0&&u===void 0)continue;l||(l=0),u||(u=0),l===0||u===0||r_(l)===r_(u)?(t[a]=Math.max(lr(n_(l),n_(u),r),0),(mo.test(u)||mo.test(l))&&(t[a]+="%")):t[a]=u}(e.rotate||n.rotate)&&(t.rotate=lr(e.rotate||0,n.rotate||0,r))}function s_(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const F8=hM(0,.5,XI),B8=hM(.5,.95,vi);function hM(t,e,n){return r=>r<t?0:r>e?1:n(xf(t,e,r))}function i_(t,e){t.min=e.min,t.max=e.max}function Ai(t,e){i_(t.x,e.x),i_(t.y,e.y)}function o_(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function a_(t,e,n,r,s){return t-=e,t=dm(t,1/n,r),s!==void 0&&(t=dm(t,1/s,r)),t}function U8(t,e=0,n=1,r=.5,s,i=t,o=t){if(mo.test(e)&&(e=parseFloat(e),e=lr(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=lr(i.min,i.max,r);t===i&&(a-=e),t.min=a_(t.min,e,n,a,s),t.max=a_(t.max,e,n,a,s)}function l_(t,e,[n,r,s],i,o){U8(t,e[n],e[r],e[s],e.scale,i,o)}const H8=["x","scaleX","originX"],V8=["y","scaleY","originY"];function c_(t,e,n,r){l_(t.x,e,H8,n?n.x:void 0,r?r.x:void 0),l_(t.y,e,V8,n?n.y:void 0,r?r.y:void 0)}function u_(t){return t.translate===0&&t.scale===1}function pM(t){return u_(t.x)&&u_(t.y)}function d_(t,e){return t.min===e.min&&t.max===e.max}function W8(t,e){return d_(t.x,e.x)&&d_(t.y,e.y)}function f_(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function mM(t,e){return f_(t.x,e.x)&&f_(t.y,e.y)}function h_(t){return vs(t.x)/vs(t.y)}function p_(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class K8{constructor(){this.members=[]}add(e){Aw(this.members,e),e.scheduleRender()}remove(e){if(Rw(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(s=>e===s);if(n===0)return!1;let r;for(let s=n;s>=0;s--){const i=this.members[s];if(i.isPresent!==!1){r=i;break}}return r?(this.promote(r),!0):!1}promote(e,n){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,n&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:s}=e.options;s===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:r}=e;n.onExitComplete&&n.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function G8(t,e,n){let r="";const s=t.x.translate/e.x,i=t.y.translate/e.y,o=(n==null?void 0:n.z)||0;if((s||i||o)&&(r=`translate3d(${s}px, ${i}px, ${o}px) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:u,rotate:d,rotateX:f,rotateY:h,skewX:p,skewY:m}=n;u&&(r=`perspective(${u}px) ${r}`),d&&(r+=`rotate(${d}deg) `),f&&(r+=`rotateX(${f}deg) `),h&&(r+=`rotateY(${h}deg) `),p&&(r+=`skewX(${p}deg) `),m&&(r+=`skewY(${m}deg) `)}const a=t.x.scale*e.x,l=t.y.scale*e.y;return(a!==1||l!==1)&&(r+=`scale(${a}, ${l})`),r||"none"}const Z0=["","X","Y","Z"],q8=1e3;let Y8=0;function ey(t,e,n,r){const{latestValues:s}=e;s[t]&&(n[t]=s[t],e.setStaticValue(t,0),r&&(r[t]=0))}function gM(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=tM(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:s,layoutId:i}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",Yn,!(s||i))}const{parent:r}=t;r&&!r.hasCheckedOptimisedAppear&&gM(r)}function yM({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:r,resetTransform:s}){return class{constructor(o={},a=e==null?void 0:e()){this.id=Y8++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Q8),this.nodes.forEach(n9),this.nodes.forEach(r9),this.nodes.forEach(Z8)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new P8)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new Lw),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const l=this.eventHandlers.get(o);l&&l.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=DD(o)&&!OB(o),this.instance=o;const{layoutId:a,layout:l,visualElement:u}=this.options;if(u&&!u.current&&u.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(l||a)&&(this.isLayoutDirty=!0),t){let d,f=0;const h=()=>this.root.updateBlockedByResize=!1;Yn.read(()=>{f=window.innerWidth}),t(o,()=>{const p=window.innerWidth;p!==f&&(f=p,this.root.updateBlockedByResize=!0,d&&d(),d=L8(h,250),xp.hasAnimatedSinceResize&&(xp.hasAnimatedSinceResize=!1,this.nodes.forEach(y_)))})}a&&this.root.registerSharedNode(a,this),this.options.animate!==!1&&u&&(a||l)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:f,hasRelativeLayoutChanged:h,layout:p})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const m=this.options.transition||u.getDefaultTransition()||l9,{onLayoutAnimationStart:y,onLayoutAnimationComplete:x}=u.getProps(),g=!this.targetLayout||!mM(this.targetLayout,p),v=!f&&h;if(this.options.layoutRoot||this.resumeFrom||v||f&&(g||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const w={...Yw(m,"layout"),onPlay:y,onComplete:x};(u.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w),this.setAnimationOrigin(d,v)}else f||y_(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=p})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Ua(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(s9),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&gM(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let d=0;d<this.path.length;d++){const f=this.path[d];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:a,layout:l}=this.options;if(a===void 0&&!l)return;const u=this.getTransformTemplate();this.prevTransformTemplateValue=u?u(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(m_);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(g_);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(t9),this.nodes.forEach(J8),this.nodes.forEach(X8)):this.nodes.forEach(g_),this.clearAllSnapshots();const a=Os.now();Jr.delta=qo(0,1e3/60,a-Jr.timestamp),Jr.timestamp=a,Jr.isProcessing=!0,U0.update.process(Jr),U0.preRender.process(Jr),U0.render.process(Jr),Jr.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Xw.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(e9),this.sharedNodes.forEach(i9)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Yn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Yn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!vs(this.snapshot.measuredBox.x)&&!vs(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=Ir(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a&&this.instance){const l=r(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:l,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!s)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!pM(this.projectionDelta),l=this.getTransformTemplate(),u=l?l(this.latestValues,""):void 0,d=u!==this.prevTransformTemplateValue;o&&this.instance&&(a||pl(this.latestValues)||d)&&(s(this.instance,u),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let l=this.removeElementScroll(a);return o&&(l=this.removeTransform(l)),c9(l),{animationId:this.root.animationId,measuredBox:a,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var u;const{visualElement:o}=this.options;if(!o)return Ir();const a=o.measureViewportBox();if(!(((u=this.scroll)==null?void 0:u.wasRoot)||this.path.some(u9))){const{scroll:d}=this.root;d&&(Vc(a.x,d.offset.x),Vc(a.y,d.offset.y))}return a}removeElementScroll(o){var l;const a=Ir();if(Ai(a,o),(l=this.scroll)!=null&&l.wasRoot)return a;for(let u=0;u<this.path.length;u++){const d=this.path[u],{scroll:f,options:h}=d;d!==this.root&&f&&h.layoutScroll&&(f.wasRoot&&Ai(a,o),Vc(a.x,f.offset.x),Vc(a.y,f.offset.y))}return a}applyTransform(o,a=!1){const l=Ir();Ai(l,o);for(let u=0;u<this.path.length;u++){const d=this.path[u];!a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&Wc(l,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),pl(d.latestValues)&&Wc(l,d.latestValues)}return pl(this.latestValues)&&Wc(l,this.latestValues),l}removeTransform(o){const a=Ir();Ai(a,o);for(let l=0;l<this.path.length;l++){const u=this.path[l];if(!u.instance||!pl(u.latestValues))continue;v1(u.latestValues)&&u.updateSnapshot();const d=Ir(),f=u.measurePageBox();Ai(d,f),c_(a,u.latestValues,u.snapshot?u.snapshot.layoutBox:void 0,d)}return pl(this.latestValues)&&c_(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Jr.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var p;const a=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=a.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=a.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=a.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==a;if(!(o||l&&this.isSharedProjectionDirty||this.isProjectionDirty||(p=this.parent)!=null&&p.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:f}=this.options;if(!this.layout||!(d||f))return;this.resolvedRelativeTargetAt=Jr.timestamp;const h=this.getClosestProjectingParent();h&&this.linkedParentVersion!==h.layoutVersion&&!h.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(h&&h.layout?this.createRelativeTarget(h,this.layout.layoutBox,h.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Ir(),this.targetWithTransforms=Ir()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),x8(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ai(this.target,this.layout.layoutBox),YD(this.target,this.targetDelta)):Ai(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,h&&!!h.resumingFrom==!!this.resumingFrom&&!h.options.layoutScroll&&h.target&&this.animationProgress!==1?this.createRelativeTarget(h,this.target,h.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||v1(this.parent.latestValues)||qD(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(o,a,l){this.relativeParent=o,this.linkedParentVersion=o.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ir(),this.relativeTargetOrigin=Ir(),fm(this.relativeTargetOrigin,a,l),Ai(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var m;const o=this.getLead(),a=!!this.resumingFrom||this!==o;let l=!0;if((this.isProjectionDirty||(m=this.parent)!=null&&m.isProjectionDirty)&&(l=!1),a&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===Jr.timestamp&&(l=!1),l)return;const{layout:u,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||d))return;Ai(this.layoutCorrected,this.layout.layoutBox);const f=this.treeScale.x,h=this.treeScale.y;IU(this.layoutCorrected,this.treeScale,this.path,a),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=Ir());const{target:p}=o;if(!p){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(o_(this.prevProjectionDelta.x,this.projectionDelta.x),o_(this.prevProjectionDelta.y,this.projectionDelta.y)),jd(this.projectionDelta,this.layoutCorrected,p,this.latestValues),(this.treeScale.x!==f||this.treeScale.y!==h||!p_(this.projectionDelta.x,this.prevProjectionDelta.x)||!p_(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",p))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var a;if((a=this.options.visualElement)==null||a.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Kc(),this.projectionDelta=Kc(),this.projectionDeltaWithTransform=Kc()}setAnimationOrigin(o,a=!1){const l=this.snapshot,u=l?l.latestValues:{},d={...this.latestValues},f=Kc();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const h=Ir(),p=l?l.source:void 0,m=this.layout?this.layout.source:void 0,y=p!==m,x=this.getStack(),g=!x||x.members.length<=1,v=!!(y&&!g&&this.options.crossfade===!0&&!this.path.some(a9));this.animationProgress=0;let w;this.mixTargetDelta=T=>{const D=T/1e3;x_(f.x,o.x,D),x_(f.y,o.y,D),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(fm(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),o9(this.relativeTarget,this.relativeTargetOrigin,h,D),w&&W8(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=Ir()),Ai(w,this.relativeTarget)),y&&(this.animationValues=d,z8(d,u,this.latestValues,D,v,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=D},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){var a,l,u;this.notifyListeners("animationStart"),(a=this.currentAnimation)==null||a.stop(),(u=(l=this.resumingFrom)==null?void 0:l.currentAnimation)==null||u.stop(),this.pendingAnimation&&(Ua(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Yn.update(()=>{xp.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=xu(0)),this.currentAnimation=R8(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:d=>{this.mixTargetDelta(d),o.onUpdate&&o.onUpdate(d)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(q8),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:l,layout:u,latestValues:d}=o;if(!(!a||!l||!u)){if(this!==o&&this.layout&&u&&xM(this.options.animationType,this.layout.layoutBox,u.layoutBox)){l=this.target||Ir();const f=vs(this.layout.layoutBox.x);l.x.min=o.target.x.min,l.x.max=l.x.min+f;const h=vs(this.layout.layoutBox.y);l.y.min=o.target.y.min,l.y.max=l.y.min+h}Ai(a,l),Wc(a,d),jd(this.projectionDeltaWithTransform,this.layoutCorrected,a,d)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new K8),this.sharedNodes.get(o).add(a);const u=a.options.initialPromotionConfig;a.promote({transition:u?u.transition:void 0,preserveFollowOpacity:u&&u.shouldPreserveFollowOpacity?u.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var a;const{layoutId:o}=this.options;return o?((a=this.getStack())==null?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:o}=this.options;return o?(a=this.getStack())==null?void 0:a.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:l}={}){const u=this.getStack();u&&u.promote(this,l),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:l}=o;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(a=!0),!a)return;const u={};l.z&&ey("z",o,u,this.animationValues);for(let d=0;d<Z0.length;d++)ey(`rotate${Z0[d]}`,o,u,this.animationValues),ey(`skew${Z0[d]}`,o,u,this.animationValues);o.render();for(const d in u)o.setStaticValue(d,u[d]),this.animationValues&&(this.animationValues[d]=u[d]);o.scheduleRender()}applyProjectionStyles(o,a){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const l=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=yp(a==null?void 0:a.pointerEvents)||"",o.transform=l?l(this.latestValues,""):"none";return}const u=this.getLead();if(!this.projectionDelta||!this.layout||!u.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=yp(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!pl(this.latestValues)&&(o.transform=l?l({},""):"none",this.hasProjected=!1);return}o.visibility="";const d=u.animationValues||u.latestValues;this.applyTransformsToTarget();let f=G8(this.projectionDeltaWithTransform,this.treeScale,d);l&&(f=l(d,f)),o.transform=f;const{x:h,y:p}=this.projectionDelta;o.transformOrigin=`${h.origin*100}% ${p.origin*100}% 0`,u.animationValues?o.opacity=u===this?d.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:o.opacity=u===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const m in w1){if(d[m]===void 0)continue;const{correct:y,applyTo:x,isCSSVariable:g}=w1[m],v=f==="none"?d[m]:y(d[m],u);if(x){const w=x.length;for(let T=0;T<w;T++)o[x[T]]=v}else g?this.options.visualElement.renderState.vars[m]=v:o[m]=v}this.options.layoutId&&(o.pointerEvents=u===this?yp(a==null?void 0:a.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var a;return(a=o.currentAnimation)==null?void 0:a.stop()}),this.root.nodes.forEach(m_),this.root.sharedNodes.clear()}}}function J8(t){t.updateLayout()}function X8(t){var n;const e=((n=t.resumeFrom)==null?void 0:n.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:s}=t.layout,{animationType:i}=t.options,o=e.source!==t.layout.source;i==="size"?ci(f=>{const h=o?e.measuredBox[f]:e.layoutBox[f],p=vs(h);h.min=r[f].min,h.max=h.min+p}):xM(i,e.layoutBox,r)&&ci(f=>{const h=o?e.measuredBox[f]:e.layoutBox[f],p=vs(r[f]);h.max=h.min+p,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[f].max=t.relativeTarget[f].min+p)});const a=Kc();jd(a,r,e.layoutBox);const l=Kc();o?jd(l,t.applyTransform(s,!0),e.measuredBox):jd(l,r,e.layoutBox);const u=!pM(a);let d=!1;if(!t.resumeFrom){const f=t.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:h,layout:p}=f;if(h&&p){const m=Ir();fm(m,e.layoutBox,h.layoutBox);const y=Ir();fm(y,r,p.layoutBox),mM(m,y)||(d=!0),f.options.layoutRoot&&(t.relativeTarget=y,t.relativeTargetOrigin=m,t.relativeParent=f)}}}t.notifyListeners("didUpdate",{layout:r,snapshot:e,delta:l,layoutDelta:a,hasLayoutChanged:u,hasRelativeLayoutChanged:d})}else if(t.isLead()){const{onExitComplete:r}=t.options;r&&r()}t.options.transition=void 0}function Q8(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function Z8(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function e9(t){t.clearSnapshot()}function m_(t){t.clearMeasurements()}function g_(t){t.isLayoutDirty=!1}function t9(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function y_(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function n9(t){t.resolveTargetDelta()}function r9(t){t.calcProjection()}function s9(t){t.resetSkewAndRotation()}function i9(t){t.removeLeadSnapshot()}function x_(t,e,n){t.translate=lr(e.translate,0,n),t.scale=lr(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function b_(t,e,n,r){t.min=lr(e.min,n.min,r),t.max=lr(e.max,n.max,r)}function o9(t,e,n,r){b_(t.x,e.x,n.x,r),b_(t.y,e.y,n.y,r)}function a9(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const l9={duration:.45,ease:[.4,0,.1,1]},w_=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),v_=w_("applewebkit/")&&!w_("chrome/")?Math.round:vi;function k_(t){t.min=v_(t.min),t.max=v_(t.max)}function c9(t){k_(t.x),k_(t.y)}function xM(t,e,n){return t==="position"||t==="preserve-aspect"&&!y8(h_(e),h_(n),.2)}function u9(t){var e;return t!==t.root&&((e=t.scroll)==null?void 0:e.wasRoot)}const d9=yM({attachResizeListener:(t,e)=>kf(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),ty={current:void 0},bM=yM({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!ty.current){const t=new d9({});t.mount(window),t.setOptions({layoutScroll:!0}),ty.current=t}return ty.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),f9={pan:{Feature:M8},drag:{Feature:D8,ProjectionNode:bM,MeasureLayout:dM}};function S_(t,e,n){const{props:r}=t;t.animationState&&r.whileHover&&t.animationState.setActive("whileHover",n==="Start");const s="onHover"+n,i=r[s];i&&Yn.postRender(()=>i(e,Xf(e)))}class h9 extends Ja{mount(){const{current:e}=this.node;e&&(this.unmount=IB(e,(n,r)=>(S_(this.node,r,"Start"),s=>S_(this.node,s,"End"))))}unmount(){}}class p9 extends Ja{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=qf(kf(this.node.current,"focus",()=>this.onFocus()),kf(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function __(t,e,n){const{props:r}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&r.whileTap&&t.animationState.setActive("whileTap",n==="Start");const s="onTap"+(n==="End"?"":n),i=r[s];i&&Yn.postRender(()=>i(e,Xf(e)))}class m9 extends Ja{mount(){const{current:e}=this.node;e&&(this.unmount=RB(e,(n,r)=>(__(this.node,r,"Start"),(s,{success:i})=>__(this.node,s,i?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const N1=new WeakMap,ny=new WeakMap,g9=t=>{const e=N1.get(t.target);e&&e(t)},y9=t=>{t.forEach(g9)};function x9({root:t,...e}){const n=t||document;ny.has(n)||ny.set(n,{});const r=ny.get(n),s=JSON.stringify(e);return r[s]||(r[s]=new IntersectionObserver(y9,{root:t,...e})),r[s]}function b9(t,e,n){const r=x9(e);return N1.set(t,n),r.observe(t),()=>{N1.delete(t),r.unobserve(t)}}const w9={some:0,all:1};class v9 extends Ja{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:r,amount:s="some",once:i}=e,o={root:n?n.current:void 0,rootMargin:r,threshold:typeof s=="number"?s:w9[s]},a=l=>{const{isIntersecting:u}=l;if(this.isInView===u||(this.isInView=u,i&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:d,onViewportLeave:f}=this.node.getProps(),h=u?d:f;h&&h(l)};return b9(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(k9(e,n))&&this.startObserver()}unmount(){}}function k9({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const S9={inView:{Feature:v9},tap:{Feature:m9},focus:{Feature:p9},hover:{Feature:h9}},_9={layout:{ProjectionNode:bM,MeasureLayout:dM}},T9={...d8,...S9,...f9,..._9},Rr=EU(T9,FU),C9=({url:t,fileName:e,autoPlay:n=!1,markers:r=[],onClose:s,seekToTime:i})=>{const o=b.useRef(null),[a,l]=b.useState(n),[u,d]=b.useState(0),[f,h]=b.useState(0);b.useEffect(()=>{n&&o.current&&o.current.play().catch(console.error)},[t,n]);const p=()=>{o.current&&(a?o.current.pause():o.current.play(),l(!a))},m=()=>{o.current&&h(o.current.currentTime)},y=()=>{o.current&&d(o.current.duration)},x=T=>{const D=parseFloat(T.target.value);o.current&&(o.current.currentTime=D,h(D))},g=T=>{if(o.current){const D=Math.min(Math.max(o.current.currentTime+T,0),u);o.current.currentTime=D,h(D)}},v=T=>{if(o.current){const D=T/1e3;o.current.currentTime=D,h(D),o.current.play().catch(console.error),l(!0)}};b.useEffect(()=>{i!=null&&o.current&&v(i)},[i]);const w=T=>{if(isNaN(T))return"0:00";const D=Math.floor(T/60),k=Math.floor(T%60);return`${D}:${k.toString().padStart(2,"0")}`};return c.jsxs("div",{className:"w-full bg-slate-50 border border-indigo-100 rounded-xl p-3 mb-4 animate-in fade-in slide-in-from-top-2 flex flex-col gap-2 shadow-sm sticky top-0 z-10 backdrop-blur-sm bg-slate-50/95",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 flex-shrink-0",children:c.jsx(s1,{size:16})}),c.jsx("span",{className:"text-xs font-medium text-slate-700 truncate",title:e,children:e||"Audio Recording"}),r.length>0&&c.jsxs("span",{className:"text-[10px] text-slate-400 bg-slate-200 px-1.5 py-0.5 rounded-full",children:[r.length," "]})]}),s&&c.jsx("button",{onClick:s,className:"p-1 hover:bg-slate-200 rounded-full text-slate-400 hover:text-slate-600 transition-colors",children:c.jsx(rn,{size:14})})]}),c.jsx("audio",{ref:o,src:t,onTimeUpdate:m,onLoadedMetadata:y,onEnded:()=>l(!1),className:"hidden"}),c.jsxs("div",{className:"flex items-center justify-between gap-3",children:[c.jsxs("button",{onClick:()=>g(-5),className:"flex items-center gap-0.5 px-2 py-1 text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors text-xs",title:" 5 ",children:[c.jsx(OI,{size:14}),c.jsx("span",{className:"font-mono text-[10px]",children:"5s"})]}),c.jsx("button",{onClick:p,className:"w-10 h-10 flex items-center justify-center bg-indigo-600 text-white rounded-full hover:bg-indigo-700 shadow-md transition-all active:scale-95",children:a?c.jsx(MI,{size:20,fill:"currentColor"}):c.jsx(AI,{size:20,fill:"currentColor",className:"ml-1"})}),c.jsxs("button",{onClick:()=>g(5),className:"flex items-center gap-0.5 px-2 py-1 text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors text-xs",title:" 5 ",children:[c.jsx("span",{className:"font-mono text-[10px]",children:"5s"}),c.jsx(Dz,{size:14})]}),c.jsxs("div",{className:"flex-1 flex items-center gap-2 min-w-0",children:[c.jsx("span",{className:"text-[10px] font-mono tabular-nums text-slate-500 w-8 text-right",children:w(f)}),c.jsxs("div",{className:"relative flex-1 h-8 flex items-center group select-none",children:[c.jsx("div",{className:"absolute inset-0 flex items-center pointer-events-none",children:c.jsx("div",{className:"w-full h-1 bg-slate-200 rounded-full overflow-visible relative",children:c.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-100 rounded-full",style:{width:`${f/(u||1)*100}%`}})})}),c.jsx("input",{type:"range",min:0,max:u||100,value:f,onChange:x,className:"absolute inset-0 w-full opacity-0 cursor-pointer z-10"})]}),c.jsx("span",{className:"text-[10px] font-mono tabular-nums text-slate-500 w-8",children:w(u)})]})]})]})},wM=({checked:t,isCanceled:e=!1,onChange:n,size:r=18,color:s="blue",isRoot:i=!1})=>{const o={gray:{root:"bg-gray-500 border-gray-500 text-white",sub:"bg-gray-100 border-gray-200 text-gray-500",hover:"hover:border-gray-500",border:"border-gray-400"},blue:{root:"bg-blue-500 border-blue-500 text-white",sub:"bg-blue-100 border-blue-200 text-blue-500",hover:"hover:border-blue-500",border:"border-blue-400"},indigo:{root:"bg-indigo-500 border-indigo-500 text-white",sub:"bg-indigo-100 border-indigo-200 text-indigo-500",hover:"hover:border-indigo-500",border:"border-indigo-400"},red:{root:"bg-red-500 border-red-500 text-white",sub:"bg-red-100 border-red-200 text-red-500",hover:"hover:border-red-500",border:"border-red-400"},orange:{root:"bg-orange-500 border-orange-500 text-white",sub:"bg-orange-100 border-orange-200 text-orange-500",hover:"hover:border-orange-500",border:"border-orange-400"},amber:{root:"bg-amber-500 border-amber-500 text-white",sub:"bg-amber-100 border-amber-200 text-amber-500",hover:"hover:border-amber-500",border:"border-amber-400"},green:{root:"bg-emerald-500 border-emerald-500 text-white",sub:"bg-emerald-100 border-emerald-200 text-emerald-500",hover:"hover:border-emerald-500",border:"border-emerald-400"},teal:{root:"bg-teal-500 border-teal-500 text-white",sub:"bg-teal-100 border-teal-200 text-teal-500",hover:"hover:border-teal-500",border:"border-teal-400"},cyan:{root:"bg-cyan-500 border-cyan-500 text-white",sub:"bg-cyan-100 border-cyan-200 text-cyan-500",hover:"hover:border-cyan-500",border:"border-cyan-400"},sky:{root:"bg-sky-500 border-sky-500 text-white",sub:"bg-sky-100 border-sky-200 text-sky-500",hover:"hover:border-sky-500",border:"border-sky-400"},purple:{root:"bg-purple-500 border-purple-500 text-white",sub:"bg-purple-100 border-purple-200 text-purple-500",hover:"hover:border-purple-500",border:"border-purple-400"},fuchsia:{root:"bg-fuchsia-500 border-fuchsia-500 text-white",sub:"bg-fuchsia-100 border-fuchsia-200 text-fuchsia-500",hover:"hover:border-fuchsia-500",border:"border-fuchsia-400"},pink:{root:"bg-pink-500 border-pink-500 text-white",sub:"bg-pink-100 border-pink-200 text-pink-500",hover:"hover:border-pink-500",border:"border-pink-400"},rose:{root:"bg-rose-500 border-rose-500 text-white",sub:"bg-rose-100 border-rose-200 text-rose-500",hover:"hover:border-rose-500",border:"border-rose-400"}},a=o[s]||o.gray,l=i?a.root:a.sub,d=`bg-transparent ${i?"border-2":""} ${a.border} ${a.hover}`;return c.jsx("div",{onClick:n,className:`group relative cursor-pointer flex items-center justify-center transition-all duration-200 ease-out border shadow-sm ${t||e?l:d}`,style:{width:r,height:r,borderRadius:r*.25},children:e?c.jsx(rn,{size:r*.7,className:"text-current scale-100 opacity-100",strokeWidth:3}):c.jsx(Gn,{size:r*.7,className:`transition-all duration-300 ease-back-out ${t?"scale-100 opacity-100":"scale-50 opacity-0"}`,strokeWidth:3})})},T_=({label:t,value:e,onChange:n,theme:r,tasks:s,innerRef:i,colorClass:o})=>{const{themeSettings:a,language:l,t:u}=b.useContext(Tn),[d,f]=b.useState(""),[h,p]=b.useState(!1),[m,y]=b.useState(new Date),[x,g]=b.useState(null),[v,w]=b.useState(null),[T,D]=b.useState({top:0,left:0}),k=b.useRef(null),I=b.useRef(null),C=b.useRef(!1),S=b.useRef(!1),_=b.useRef(null),N=i||_;b.useEffect(()=>{const le=De=>{h&&k.current&&!k.current.contains(De.target)&&I.current&&!I.current.contains(De.target)&&(p(!1),f(""),w(null))};return document.addEventListener("mousedown",le),()=>document.removeEventListener("mousedown",le)},[h]),b.useEffect(()=>{if(e){const le=new Date(e);isNaN(le.getTime())||y(le)}},[e]);const j=le=>{const De=le.target.value;f(De);const ie=M6(De);ie?(y(ie),w(ie),g(ie)):w(null)},O=()=>{var De;const le=v||x||m;if(le){if(e){const ie=new Date(e);le.setHours(ie.getHours(),ie.getMinutes())}n(le.toISOString()),p(!1),f(""),S.current=!0,(De=N.current)==null||De.focus(),setTimeout(()=>S.current=!1,200)}},P=()=>{if(N.current){const le=N.current.getBoundingClientRect(),De=window.innerWidth,ie=window.innerHeight,Fe=288,_e=400;let tt=le.left,Xe=le.bottom+8;Xe+_e>ie&&le.top-_e>0&&(Xe=le.top-_e-8),tt+Fe>De&&(tt=De-Fe-10),D({top:Xe,left:tt})}},W=le=>{var De;le.key==="Enter"?(le.preventDefault(),le.metaKey||le.ctrlKey||le.stopPropagation(),h?O():(P(),p(!0))):le.key==="Escape"?(le.preventDefault(),h&&(le.stopPropagation(),p(!1),f(""),S.current=!0,(De=N.current)==null||De.focus(),setTimeout(()=>S.current=!1,200))):le.key===" "&&(le.preventDefault(),le.stopPropagation(),P(),p(!0))},R=le=>{},M=le=>{C.current||S.current||(P(),p(!0))},X=()=>{h||P(),p(!h)},Q=le=>s.filter(De=>{if(De.status==="completed"||De.status==="deleted")return!1;const ie=De.start_date?new Date(De.start_date):null,Fe=De.due_date?new Date(De.due_date):null;return ie&&yi(ie,le)||Fe&&yi(Fe,le)}),A=le=>{const De=new Date(m.getFullYear(),m.getMonth(),le);y(De),g(De),w(De)},Te=()=>{const le=new Date(m.getFullYear(),m.getMonth()+1,0).getDate(),De=new Date(m.getFullYear(),m.getMonth(),1).getDay(),ie=[];for(let Fe=0;Fe<De;Fe++)ie.push(c.jsx("div",{className:"h-8 w-8"},`empty-${Fe}`));for(let Fe=1;Fe<=le;Fe++){const _e=new Date(m.getFullYear(),m.getMonth(),Fe),tt=e&&yi(new Date(e),_e),Xe=v&&yi(v,_e),it=Q(_e).length;let Ue="bg-transparent";it>=1&&it<=3?Ue="bg-green-400":it>=4&&it<=10?Ue="bg-yellow-400":it>10&&(Ue="bg-red-500");const K=_w(_e.toISOString());let ue="h-8 w-8 rounded-full flex items-center justify-center text-xs relative transition-all ";Xe?ue+="bg-indigo-600/80 text-white font-bold shadow-md":tt?ue+="bg-indigo-500 text-white font-bold":(ue+="hover:bg-theme-hover text-theme-primary",K&&(ue+=" text-red-500 font-bold")),K?ue+=" border-2 border-red-400":ue+=" border-2 border-transparent",ie.push(c.jsxs("button",{type:"button",onMouseDown:re=>re.preventDefault(),onClick:()=>A(Fe),onMouseEnter:()=>g(_e),className:ue,children:[Fe,!tt&&!Xe&&it>0&&c.jsx("div",{className:`absolute bottom-1 w-1 h-1 rounded-full ${Ue}`})]},Fe))}return ie},we=v||x||(e?new Date(e):null),B=we?Q(we):[],F=(r==null?void 0:r.buttonRing)||"focus:ring-indigo-300 focus:border-indigo-300",ne=o||(r==null?void 0:r.text)||"text-theme-tertiary",We={small:"text-[11px]",normal:"text-xs",large:"text-sm"}[a.fontSize]||"text-xs",ft=a.fontWeight==="thin"?"font-light":"font-medium";return c.jsxs("div",{className:"relative",ref:k,onBlur:R,children:[c.jsxs("button",{ref:N,type:"button",onMouseDown:()=>{C.current=!0,setTimeout(()=>C.current=!1,200)},onClick:X,onKeyDown:W,onFocus:M,className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border ${We} ${ft} ${F}
            ${e?`${ne} border-theme bg-theme-hover hover:border-theme-hover hover:scale-[1.02]`:"text-theme-tertiary border-transparent hover:bg-theme-hover hover:text-theme-secondary"}
            focus:outline-none focus:bg-theme-card focus:ring-1 focus:border-theme
        `,children:[c.jsx(Go,{size:13}),c.jsx("span",{children:e?mI(e,!1,l):t}),e&&c.jsx(rn,{size:12,className:"ml-1 hover:text-red-500",onClick:le=>{le.stopPropagation(),n(null)}})]}),h&&tr.createPortal(c.jsxs("div",{ref:I,className:"fixed bg-theme-card rounded-xl shadow-2xl border border-theme p-4 z-[99999] w-72 max-w-[90vw] animate-in fade-in zoom-in duration-100",style:{top:T.top,left:T.left},onClick:le=>le.stopPropagation(),onMouseDown:le=>le.stopPropagation(),children:[c.jsxs("div",{className:"mb-3 relative",children:[c.jsx("input",{autoFocus:!0,type:"text",placeholder:u("dateInputPlaceholder"),className:"w-full text-xs box-border bg-theme-main border border-theme rounded p-2 text-theme-primary focus:ring-2 focus:ring-indigo-500/50 outline-none pr-8",value:d,onChange:j,onKeyDown:W}),v&&c.jsxs("div",{className:"absolute right-2 top-2 text-[10px] text-indigo-500 font-bold bg-theme-hover px-1 rounded animate-pulse",children:[u("identified"),": ",A6(v.toISOString(),l)]})]}),c.jsxs("div",{className:"flex justify-between items-center mb-2 text-theme-primary",children:[c.jsx("button",{type:"button",onMouseDown:le=>le.preventDefault(),onClick:()=>y(new Date(m.getFullYear(),m.getMonth()-1,1)),className:"p-1 hover:bg-theme-hover rounded",children:c.jsx(Mu,{size:16})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"font-bold text-sm cursor-pointer hover:text-indigo-500 transition-colors",title:u("backToToday"),onClick:()=>y(new Date),children:m.toLocaleString(l==="zh"?"zh-TW":"en-US",{month:"long",year:"numeric"})}),c.jsx("button",{type:"button",onMouseDown:le=>le.preventDefault(),onClick:()=>y(new Date),className:"text-[10px] px-1.5 py-0.5 bg-indigo-50 text-indigo-600 rounded-full hover:bg-indigo-100 font-bold",children:""})]}),c.jsx("button",{type:"button",onMouseDown:le=>le.preventDefault(),onClick:()=>y(new Date(m.getFullYear(),m.getMonth()+1,1)),className:"p-1 hover:bg-theme-hover rounded",children:c.jsx(ns,{size:16})})]}),c.jsxs("div",{className:"grid grid-cols-7 gap-1 mb-2 text-center text-xs font-bold text-theme-tertiary",children:[(l==="zh"?["","","","","","",""]:["S","M","T","W","T","F","S"]).map(le=>c.jsx("span",{children:le},le)),Te()]}),c.jsxs("div",{className:"border-t border-theme pt-3 mt-3",children:[c.jsxs("div",{className:"text-[10px] font-bold text-theme-tertiary mb-2 flex justify-between items-center",children:[c.jsx("span",{children:we?`${we.getMonth()+1}/${we.getDate()} ${u("scheduleTitle")}`:u("scheduleTitle")}),c.jsx("span",{className:"bg-theme-hover px-1.5 rounded text-theme-secondary",children:B.length})]}),c.jsx("div",{className:"max-h-24 overflow-y-auto space-y-1 custom-scrollbar",children:B.length>0?B.map(le=>c.jsx("div",{className:"text-[10px] bg-theme-hover p-1 rounded truncate border-l-2 border-indigo-400 pl-2 text-theme-secondary",children:le.title},le.id)):c.jsx("div",{className:"text-[10px] text-theme-tertiary italic text-center py-2",children:u("noSchedule")})})]}),c.jsx("button",{type:"button",onMouseDown:le=>le.preventDefault(),onClick:O,className:"w-full mt-3 bg-indigo-600 text-white text-xs font-bold py-1.5 rounded hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-500/20",children:u("confirmDate")})]}),document.body)]})},j1=({icon:t,label:e,items:n,selectedIds:r,onSelect:s,onSearch:i,placeholder:o,allowAdd:a,onDeleteItem:l,innerRef:u,multiSelect:d=!1,theme:f})=>{const{themeSettings:h,t:p}=b.useContext(Tn),[m,y]=b.useState(!1),[x,g]=b.useState(""),[v,w]=b.useState(-1),[T,D]=b.useState({top:0,left:0}),[k,I]=b.useState(!1),[C,S]=b.useState(null),[_,N]=b.useState(null),[j,O]=b.useState(""),[P,W]=b.useState(-1),R=b.useRef(null),M=b.useRef(null),X=b.useRef(!1),Q=b.useRef(!1),A=b.useRef(null),Te=b.useRef(null),we=b.useRef(null),B=u||we;b.useEffect(()=>{const se=Se=>{m&&R.current&&!R.current.contains(Se.target)&&M.current&&!M.current.contains(Se.target)&&(y(!1),g(""),I(!1),S(null),N(null))};return document.addEventListener("mousedown",se),()=>document.removeEventListener("mousedown",se)},[m]);const F=b.useMemo(()=>!n||!Array.isArray(n)?[]:n.filter(se=>se?(se.title||se.name||"").toLowerCase().includes(x.toLowerCase()):!1),[n,x]),ne=b.useMemo(()=>!n||!Array.isArray(n)?[]:n.filter(se=>se?(se.title||se.name||"").toLowerCase().includes(j.toLowerCase()):!1),[n,j]),We=a&&x.trim()&&!F.some(se=>(se.title||se.name||"").toLowerCase()===x.trim().toLowerCase()),ft=F.length+(We?1:0),le=b.useMemo(()=>r.length===0?null:n.find(se=>r.includes(se.id)),[n,r]),De=le&&(le.title||le.name)||e,ie=(se,Se,Pe)=>{var ye;s(se,Se,Pe),d?(g(""),w(-1),y(!0),setTimeout(()=>{var ze;return(ze=A.current)==null?void 0:ze.focus()},0)):(g(""),y(!1),X.current=!0,(ye=B.current)==null||ye.focus(),setTimeout(()=>X.current=!1,200)),I(!1),S(null),N(null),O("")},Fe=()=>{S(x.trim()),I(!0),O(""),setTimeout(()=>{var se;return(se=Te.current)==null?void 0:se.focus()},50)},_e=()=>{C&&ie(null,C,_)},tt=()=>{I(!1),S(null),N(null),O(""),setTimeout(()=>{var se;return(se=A.current)==null?void 0:se.focus()},50)},Xe=()=>{if(B.current){const se=B.current.getBoundingClientRect(),Se=window.innerWidth,Pe=window.innerHeight,ye=280,ze=350;let Ze=se.left,gt=se.bottom+8;gt+ze>Pe&&se.top-ze>0&&(gt=se.top-ze-8),Ze+ye>Se&&(Ze=Se-ye-10),D({top:gt,left:Ze})}},Ve=se=>{var Se,Pe,ye;if(k){const ze=ne.length+1;if(se.key==="Escape")se.preventDefault(),se.stopPropagation(),tt();else if(se.key==="ArrowDown"){se.preventDefault();const Ze=P+1>=ze?-1:P+1;W(Ze),N(Ze===-1?null:((Se=ne[Ze])==null?void 0:Se.id)||null)}else if(se.key==="ArrowUp"){se.preventDefault();const Ze=P-1<-1?ze-1:P-1;W(Ze),N(Ze===-1?null:((Pe=ne[Ze])==null?void 0:Pe.id)||null)}else se.key==="Enter"&&(se.preventDefault(),se.stopPropagation(),_e());return}se.key==="ArrowDown"?(se.preventDefault(),m||(Xe(),y(!0)),w(ze=>ze===-1?0:(ze+1)%ft)):se.key==="ArrowUp"?(se.preventDefault(),m||(Xe(),y(!0)),w(ze=>ze<=0?ft-1:ze-1)):se.key==="Enter"?(se.preventDefault(),se.metaKey||se.ctrlKey||se.stopPropagation(),m?v>=0&&v<F.length?ie(F[v].id):We&&(v===F.length||v===-1)&&Fe():(Xe(),y(!0))):se.key==="Escape"&&(se.preventDefault(),m&&(se.stopPropagation(),y(!1),X.current=!0,(ye=B.current)==null||ye.focus(),setTimeout(()=>X.current=!1,200)))},it=se=>{},Ue=se=>{Q.current||X.current||(Xe(),y(!0))},K=()=>{m||Xe(),y(!m)},ue=(f==null?void 0:f.buttonRing)||"focus:ring-indigo-300 focus:border-indigo-300",re={small:"text-[11px]",normal:"text-xs",large:"text-sm"}[h.fontSize]||"text-xs",oe=h.fontWeight==="thin"?"font-light":"font-medium",pe=se=>{if(!se)return null;const Se=n.find(Pe=>Pe.id===se);return Se?Se.title||Se.name:null};return c.jsxs("div",{className:"relative",ref:R,onBlur:it,children:[c.jsxs("button",{ref:B,type:"button",onMouseDown:()=>{Q.current=!0,setTimeout(()=>Q.current=!1,200)},onClick:K,onKeyDown:Ve,onFocus:Ue,className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border ${re} ${oe}
                    ${r.length>0?"text-indigo-600 bg-theme-hover border-theme shadow-sm":"text-theme-tertiary border-transparent hover:bg-theme-hover hover:text-theme-secondary"}
                    focus:outline-none focus:bg-theme-card focus:ring-1 focus:border-theme ${ue}`,children:[c.jsx(t,{size:13})," ",c.jsx("span",{className:"truncate max-w-[80px]",children:De})]}),m&&tr.createPortal(c.jsx("div",{ref:M,className:"fixed bg-theme-card rounded-lg shadow-xl border border-theme z-[99999] w-72 p-2 animate-in fade-in zoom-in duration-100",style:{top:T.top,left:T.left},onClick:se=>se.stopPropagation(),onMouseDown:se=>se.stopPropagation(),children:k?c.jsxs("div",{className:"animate-in slide-in-from-right-2 duration-150",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-theme",children:[c.jsx("button",{type:"button",onClick:tt,className:"text-xs text-theme-tertiary hover:text-theme-primary transition-colors",children:" "}),c.jsxs("span",{className:"text-xs font-medium text-theme-primary",children:[' "',C,'"']})]}),c.jsxs("div",{className:"mb-2",children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-theme-tertiary mb-1",children:[c.jsx(hz,{size:11}),c.jsx("span",{children:""})]}),c.jsx("input",{ref:Te,type:"text",placeholder:"...",className:"w-full text-xs box-border bg-theme-main border border-theme rounded p-2 text-theme-primary focus:ring-1 focus:ring-indigo-500/50 outline-none",value:j,onChange:se=>O(se.target.value),onKeyDown:Ve})]}),c.jsxs("div",{className:"max-h-40 overflow-y-auto space-y-0.5 custom-scrollbar mb-2",children:[c.jsxs("div",{onMouseDown:se=>{se.preventDefault(),N(null),W(-1)},onMouseEnter:()=>W(-1),className:`px-2 py-1.5 text-xs rounded cursor-pointer flex items-center justify-between ${P===-1?"bg-indigo-50 text-indigo-700 ring-1 ring-indigo-200":"text-theme-secondary hover:bg-theme-hover"}`,children:[c.jsx("span",{className:"text-theme-tertiary italic",children:""}),_===null&&c.jsx(Gn,{size:12,className:"text-indigo-600"})]}),ne.map((se,Se)=>c.jsxs("div",{onMouseDown:Pe=>{Pe.preventDefault(),N(se.id),W(Se)},onMouseEnter:()=>W(Se),className:`px-2 py-1.5 text-xs rounded cursor-pointer flex items-center justify-between ${P===Se?"bg-indigo-50 text-indigo-700 ring-1 ring-indigo-200":"text-theme-secondary hover:bg-theme-hover"}`,style:{paddingLeft:se.depth?`${se.depth*12+8}px`:"8px"},children:[c.jsxs("div",{className:"flex items-center gap-1.5 truncate",children:[c.jsx("span",{className:"truncate",children:se.title||se.name}),se.parentName&&c.jsx("span",{className:"text-[9px] text-theme-tertiary font-normal bg-theme-hover px-1 rounded truncate",children:se.parentName})]}),_===se.id&&c.jsx(Gn,{size:12,className:"text-indigo-600"})]},se.id))]}),_&&c.jsxs("div",{className:"text-[10px] text-theme-tertiary mb-2 px-1",children:[" ",c.jsx("span",{className:"font-medium text-indigo-600",children:pe(_)})," "]}),c.jsxs("button",{type:"button",onClick:_e,className:"w-full py-2 px-3 bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-medium rounded-lg transition-colors flex items-center justify-center gap-1.5",children:[c.jsx(xi,{size:14}),""]})]}):c.jsxs(c.Fragment,{children:[c.jsx("input",{ref:A,autoFocus:!0,type:"text",placeholder:o,className:"w-full text-xs box-border bg-theme-main border-none rounded p-2 mb-1 text-theme-primary focus:ring-1 focus:ring-indigo-500/50 outline-none",value:x,onChange:se=>{g(se.target.value),w(-1),i&&i(se.target.value)},onKeyDown:Ve}),c.jsxs("div",{className:"max-h-48 overflow-y-auto space-y-0.5 custom-scrollbar",children:[F.map((se,Se)=>c.jsxs("div",{onMouseDown:Pe=>{Pe.preventDefault(),ie(se.id)},onMouseEnter:()=>w(Se),className:`px-2 py-1.5 text-xs rounded cursor-pointer flex items-center justify-between group ${Se===v?"bg-theme-selection text-theme-primary":"text-theme-secondary hover:bg-theme-hover"}`,style:{paddingLeft:se.depth?`${se.depth*12+8}px`:"8px"},children:[c.jsxs("div",{className:"flex items-center gap-1.5 truncate",children:[c.jsx("span",{className:"truncate",children:se.title||se.name}),se.parentName&&c.jsxs("span",{className:"text-[9px] text-theme-tertiary font-normal bg-theme-hover px-1 rounded truncate",children:[p("from"),": ",se.parentName]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[r.includes(se.id)&&c.jsx(Gn,{size:12,className:"text-indigo-600"}),l&&c.jsx(Mr,{size:12,className:"text-gray-400 opacity-0 group-hover:opacity-100 hover:text-red-500",onClick:Pe=>{Pe.stopPropagation(),l(se.id)}})]})]},se.id)),We&&c.jsxs("div",{onMouseEnter:()=>w(F.length),className:`px-2 py-1.5 text-xs cursor-pointer rounded flex items-center gap-1 ${v===F.length?"bg-theme-selection text-theme-primary":"text-indigo-600 hover:bg-theme-hover"}`,onMouseDown:se=>{se.preventDefault(),Fe()},children:[c.jsx(xi,{size:12})," ",p("addNewTag"),' "',x,'"',c.jsx(ns,{size:12,className:"ml-auto opacity-50"})]})]})]})}),document.body)]})},vM=({tag:t,onRemove:e,size:n="normal"})=>{const{themeSettings:r,tagsWithResolvedColors:s}=b.useContext(Tn),i={small:{text:{small:"text-[8px]",normal:"text-[9px]",large:"text-[10px]"},padding:"px-1.5 py-0.5"},normal:{text:{small:"text-[9px]",normal:"text-[10px]",large:"text-xs"},padding:"px-2 py-0.5"}},o=i[n].text[r.fontSize]||i[n].text.normal,a=i[n].padding,l=r.fontWeight==="thin"?"font-light":"font-normal";return c.jsxs("div",{className:`inline-flex items-center gap-1 bg-theme-hover text-theme-secondary ${a} rounded-md border border-theme ${o} ${l}`,children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:s[t.id]||t.color}}),c.jsx("span",{children:t.name}),e&&c.jsx("button",{type:"button",onClick:e,className:"hover:text-theme-primary",children:c.jsx(rn,{size:10})})]})};function E9(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in t)){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(t)}function kM(t,e){return new Promise(function(n,r){let s;return N9(t).then(function(i){try{return s=i,n(new Blob([e.slice(0,2),s,e.slice(2)],{type:"image/jpeg"}))}catch(o){return r(o)}},r)})}const N9=t=>new Promise((e,n)=>{const r=new FileReader;r.addEventListener("load",({target:{result:s}})=>{const i=new DataView(s);let o=0;if(i.getUint16(o)!==65496)return n("not a valid JPEG");for(o+=2;;){const a=i.getUint16(o);if(a===65498)break;const l=i.getUint16(o+2);if(a===65505&&i.getUint32(o+4)===1165519206){const u=o+10;let d;switch(i.getUint16(u)){case 18761:d=!0;break;case 19789:d=!1;break;default:return n("TIFF header contains invalid endian")}if(i.getUint16(u+2,d)!==42)return n("TIFF header contains invalid version");const f=i.getUint32(u+4,d),h=u+f+2+12*i.getUint16(u+f,d);for(let p=u+f+2;p<h;p+=12)if(i.getUint16(p,d)==274){if(i.getUint16(p+2,d)!==3)return n("Orientation data type is invalid");if(i.getUint32(p+4,d)!==1)return n("Orientation data count is invalid");i.setUint16(p+8,1,d);break}return e(s.slice(o,o+2+l))}o+=2+l}return e(new Blob)}),r.readAsArrayBuffer(t)});var hm={},j9={get exports(){return hm},set exports(t){hm=t}};(function(t){var e,n,r={};j9.exports=r,r.parse=function(s,i){for(var o=r.bin.readUshort,a=r.bin.readUint,l=0,u={},d=new Uint8Array(s),f=d.length-4;a(d,f)!=101010256;)f--;l=f,l+=4;var h=o(d,l+=4);o(d,l+=2);var p=a(d,l+=2),m=a(d,l+=4);l+=4,l=m;for(var y=0;y<h;y++){a(d,l),l+=4,l+=4,l+=4,a(d,l+=4),p=a(d,l+=4);var x=a(d,l+=4),g=o(d,l+=4),v=o(d,l+2),w=o(d,l+4);l+=6;var T=a(d,l+=8);l+=4,l+=g+v+w,r._readLocal(d,T,u,p,x,i)}return u},r._readLocal=function(s,i,o,a,l,u){var d=r.bin.readUshort,f=r.bin.readUint;f(s,i),d(s,i+=4),d(s,i+=2);var h=d(s,i+=2);f(s,i+=2),f(s,i+=4),i+=4;var p=d(s,i+=8),m=d(s,i+=2);i+=2;var y=r.bin.readUTF8(s,i,p);if(i+=p,i+=m,u)o[y]={size:l,csize:a};else{var x=new Uint8Array(s.buffer,i);if(h==0)o[y]=new Uint8Array(x.buffer.slice(i,i+a));else{if(h!=8)throw"unknown compression method: "+h;var g=new Uint8Array(l);r.inflateRaw(x,g),o[y]=g}}},r.inflateRaw=function(s,i){return r.F.inflate(s,i)},r.inflate=function(s,i){return s[0],s[1],r.inflateRaw(new Uint8Array(s.buffer,s.byteOffset+2,s.length-6),i)},r.deflate=function(s,i){i==null&&(i={level:6});var o=0,a=new Uint8Array(50+Math.floor(1.1*s.length));a[o]=120,a[o+1]=156,o+=2,o=r.F.deflateRaw(s,a,o,i.level);var l=r.adler(s,0,s.length);return a[o+0]=l>>>24&255,a[o+1]=l>>>16&255,a[o+2]=l>>>8&255,a[o+3]=l>>>0&255,new Uint8Array(a.buffer,0,o+4)},r.deflateRaw=function(s,i){i==null&&(i={level:6});var o=new Uint8Array(50+Math.floor(1.1*s.length)),a=r.F.deflateRaw(s,o,a,i.level);return new Uint8Array(o.buffer,0,a)},r.encode=function(s,i){i==null&&(i=!1);var o=0,a=r.bin.writeUint,l=r.bin.writeUshort,u={};for(var d in s){var f=!r._noNeed(d)&&!i,h=s[d],p=r.crc.crc(h,0,h.length);u[d]={cpr:f,usize:h.length,crc:p,file:f?r.deflateRaw(h):h}}for(var d in u)o+=u[d].file.length+30+46+2*r.bin.sizeUTF8(d);o+=22;var m=new Uint8Array(o),y=0,x=[];for(var d in u){var g=u[d];x.push(y),y=r._writeHeader(m,y,d,g,0)}var v=0,w=y;for(var d in u)g=u[d],x.push(y),y=r._writeHeader(m,y,d,g,1,x[v++]);var T=y-w;return a(m,y,101010256),y+=4,l(m,y+=4,v),l(m,y+=2,v),a(m,y+=2,T),a(m,y+=4,w),y+=4,y+=2,m.buffer},r._noNeed=function(s){var i=s.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(i)!=-1},r._writeHeader=function(s,i,o,a,l,u){var d=r.bin.writeUint,f=r.bin.writeUshort,h=a.file;return d(s,i,l==0?67324752:33639248),i+=4,l==1&&(i+=2),f(s,i,20),f(s,i+=2,0),f(s,i+=2,a.cpr?8:0),d(s,i+=2,0),d(s,i+=4,a.crc),d(s,i+=4,h.length),d(s,i+=4,a.usize),f(s,i+=4,r.bin.sizeUTF8(o)),f(s,i+=2,0),i+=2,l==1&&(i+=2,i+=2,d(s,i+=6,u),i+=4),i+=r.bin.writeUTF8(s,i,o),l==0&&(s.set(h,i),i+=h.length),i},r.crc={table:function(){for(var s=new Uint32Array(256),i=0;i<256;i++){for(var o=i,a=0;a<8;a++)1&o?o=3988292384^o>>>1:o>>>=1;s[i]=o}return s}(),update:function(s,i,o,a){for(var l=0;l<a;l++)s=r.crc.table[255&(s^i[o+l])]^s>>>8;return s},crc:function(s,i,o){return 4294967295^r.crc.update(4294967295,s,i,o)}},r.adler=function(s,i,o){for(var a=1,l=0,u=i,d=i+o;u<d;){for(var f=Math.min(u+5552,d);u<f;)l+=a+=s[u++];a%=65521,l%=65521}return l<<16|a},r.bin={readUshort:function(s,i){return s[i]|s[i+1]<<8},writeUshort:function(s,i,o){s[i]=255&o,s[i+1]=o>>8&255},readUint:function(s,i){return 16777216*s[i+3]+(s[i+2]<<16|s[i+1]<<8|s[i])},writeUint:function(s,i,o){s[i]=255&o,s[i+1]=o>>8&255,s[i+2]=o>>16&255,s[i+3]=o>>24&255},readASCII:function(s,i,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(s[i+l]);return a},writeASCII:function(s,i,o){for(var a=0;a<o.length;a++)s[i+a]=o.charCodeAt(a)},pad:function(s){return s.length<2?"0"+s:s},readUTF8:function(s,i,o){for(var a,l="",u=0;u<o;u++)l+="%"+r.bin.pad(s[i+u].toString(16));try{a=decodeURIComponent(l)}catch{return r.bin.readASCII(s,i,o)}return a},writeUTF8:function(s,i,o){for(var a=o.length,l=0,u=0;u<a;u++){var d=o.charCodeAt(u);if(!(4294967168&d))s[i+l]=d,l++;else if(!(4294965248&d))s[i+l]=192|d>>6,s[i+l+1]=128|d>>0&63,l+=2;else if(!(4294901760&d))s[i+l]=224|d>>12,s[i+l+1]=128|d>>6&63,s[i+l+2]=128|d>>0&63,l+=3;else{if(4292870144&d)throw"e";s[i+l]=240|d>>18,s[i+l+1]=128|d>>12&63,s[i+l+2]=128|d>>6&63,s[i+l+3]=128|d>>0&63,l+=4}}return l},sizeUTF8:function(s){for(var i=s.length,o=0,a=0;a<i;a++){var l=s.charCodeAt(a);if(!(4294967168&l))o++;else if(!(4294965248&l))o+=2;else if(!(4294901760&l))o+=3;else{if(4292870144&l)throw"e";o+=4}}return o}},r.F={},r.F.deflateRaw=function(s,i,o,a){var l=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],u=r.F.U,d=r.F._goodIndex;r.F._hash;var f=r.F._putsE,h=0,p=o<<3,m=0,y=s.length;if(a==0){for(;h<y;)f(i,p,h+(N=Math.min(65535,y-h))==y?1:0),p=r.F._copyExact(s,h,N,i,p+8),h+=N;return p>>>3}var x=u.lits,g=u.strt,v=u.prev,w=0,T=0,D=0,k=0,I=0,C=0;for(y>2&&(g[C=r.F._hash(s,0)]=0),h=0;h<y;h++){if(I=C,h+1<y-2){C=r.F._hash(s,h+1);var S=h+1&32767;v[S]=g[C],g[C]=S}if(m<=h){(w>14e3||T>26697)&&y-h>100&&(m<h&&(x[w]=h-m,w+=2,m=h),p=r.F._writeBlock(h==y-1||m==y?1:0,x,w,k,s,D,h-D,i,p),w=T=k=0,D=h);var _=0;h<y-2&&(_=r.F._bestMatch(s,h,v,I,Math.min(l[2],y-h),l[3]));var N=_>>>16,j=65535&_;if(_!=0){j=65535&_;var O=d(N=_>>>16,u.of0);u.lhst[257+O]++;var P=d(j,u.df0);u.dhst[P]++,k+=u.exb[O]+u.dxb[P],x[w]=N<<23|h-m,x[w+1]=j<<16|O<<8|P,w+=2,m=h+N}else u.lhst[s[h]]++;T++}}for(D==h&&s.length!=0||(m<h&&(x[w]=h-m,w+=2,m=h),p=r.F._writeBlock(1,x,w,k,s,D,h-D,i,p),w=0,T=0,w=T=k=0,D=h);7&p;)p++;return p>>>3},r.F._bestMatch=function(s,i,o,a,l,u){var d=32767&i,f=o[d],h=d-f+32768&32767;if(f==d||a!=r.F._hash(s,i-h))return 0;for(var p=0,m=0,y=Math.min(32767,i);h<=y&&--u!=0&&f!=d;){if(p==0||s[i+p]==s[i+p-h]){var x=r.F._howLong(s,i,h);if(x>p){if(m=h,(p=x)>=l)break;h+2<x&&(x=h+2);for(var g=0,v=0;v<x-2;v++){var w=i-h+v+32768&32767,T=w-o[w]+32768&32767;T>g&&(g=T,f=w)}}}h+=(d=f)-(f=o[d])+32768&32767}return p<<16|m},r.F._howLong=function(s,i,o){if(s[i]!=s[i-o]||s[i+1]!=s[i+1-o]||s[i+2]!=s[i+2-o])return 0;var a=i,l=Math.min(s.length,i+258);for(i+=3;i<l&&s[i]==s[i-o];)i++;return i-a},r.F._hash=function(s,i){return(s[i]<<8|s[i+1])+(s[i+2]<<4)&65535},r.saved=0,r.F._writeBlock=function(s,i,o,a,l,u,d,f,h){var p,m,y,x,g,v,w,T,D,k=r.F.U,I=r.F._putsF,C=r.F._putsE;k.lhst[256]++,m=(p=r.F.getTrees())[0],y=p[1],x=p[2],g=p[3],v=p[4],w=p[5],T=p[6],D=p[7];var S=32+(h+3&7?8-(h+3&7):0)+(d<<3),_=a+r.F.contSize(k.fltree,k.lhst)+r.F.contSize(k.fdtree,k.dhst),N=a+r.F.contSize(k.ltree,k.lhst)+r.F.contSize(k.dtree,k.dhst);N+=14+3*w+r.F.contSize(k.itree,k.ihst)+(2*k.ihst[16]+3*k.ihst[17]+7*k.ihst[18]);for(var j=0;j<286;j++)k.lhst[j]=0;for(j=0;j<30;j++)k.dhst[j]=0;for(j=0;j<19;j++)k.ihst[j]=0;var O=S<_&&S<N?0:_<N?1:2;if(I(f,h,s),I(f,h+1,O),h+=3,O==0){for(;7&h;)h++;h=r.F._copyExact(l,u,d,f,h)}else{var P,W;if(O==1&&(P=k.fltree,W=k.fdtree),O==2){r.F.makeCodes(k.ltree,m),r.F.revCodes(k.ltree,m),r.F.makeCodes(k.dtree,y),r.F.revCodes(k.dtree,y),r.F.makeCodes(k.itree,x),r.F.revCodes(k.itree,x),P=k.ltree,W=k.dtree,C(f,h,g-257),C(f,h+=5,v-1),C(f,h+=5,w-4),h+=4;for(var R=0;R<w;R++)C(f,h+3*R,k.itree[1+(k.ordr[R]<<1)]);h+=3*w,h=r.F._codeTiny(T,k.itree,f,h),h=r.F._codeTiny(D,k.itree,f,h)}for(var M=u,X=0;X<o;X+=2){for(var Q=i[X],A=Q>>>23,Te=M+(8388607&Q);M<Te;)h=r.F._writeLit(l[M++],P,f,h);if(A!=0){var we=i[X+1],B=we>>16,F=we>>8&255,ne=255&we;C(f,h=r.F._writeLit(257+F,P,f,h),A-k.of0[F]),h+=k.exb[F],I(f,h=r.F._writeLit(ne,W,f,h),B-k.df0[ne]),h+=k.dxb[ne],M+=A}}h=r.F._writeLit(256,P,f,h)}return h},r.F._copyExact=function(s,i,o,a,l){var u=l>>>3;return a[u]=o,a[u+1]=o>>>8,a[u+2]=255-a[u],a[u+3]=255-a[u+1],u+=4,a.set(new Uint8Array(s.buffer,i,o),u),l+(o+4<<3)},r.F.getTrees=function(){for(var s=r.F.U,i=r.F._hufTree(s.lhst,s.ltree,15),o=r.F._hufTree(s.dhst,s.dtree,15),a=[],l=r.F._lenCodes(s.ltree,a),u=[],d=r.F._lenCodes(s.dtree,u),f=0;f<a.length;f+=2)s.ihst[a[f]]++;for(f=0;f<u.length;f+=2)s.ihst[u[f]]++;for(var h=r.F._hufTree(s.ihst,s.itree,7),p=19;p>4&&s.itree[1+(s.ordr[p-1]<<1)]==0;)p--;return[i,o,h,l,d,p,a,u]},r.F.getSecond=function(s){for(var i=[],o=0;o<s.length;o+=2)i.push(s[o+1]);return i},r.F.nonZero=function(s){for(var i="",o=0;o<s.length;o+=2)s[o+1]!=0&&(i+=(o>>1)+",");return i},r.F.contSize=function(s,i){for(var o=0,a=0;a<i.length;a++)o+=i[a]*s[1+(a<<1)];return o},r.F._codeTiny=function(s,i,o,a){for(var l=0;l<s.length;l+=2){var u=s[l],d=s[l+1];a=r.F._writeLit(u,i,o,a);var f=u==16?2:u==17?3:7;u>15&&(r.F._putsE(o,a,d,f),a+=f)}return a},r.F._lenCodes=function(s,i){for(var o=s.length;o!=2&&s[o-1]==0;)o-=2;for(var a=0;a<o;a+=2){var l=s[a+1],u=a+3<o?s[a+3]:-1,d=a+5<o?s[a+5]:-1,f=a==0?-1:s[a-1];if(l==0&&u==l&&d==l){for(var h=a+5;h+2<o&&s[h+2]==l;)h+=2;(p=Math.min(h+1-a>>>1,138))<11?i.push(17,p-3):i.push(18,p-11),a+=2*p-2}else if(l==f&&u==l&&d==l){for(h=a+5;h+2<o&&s[h+2]==l;)h+=2;var p=Math.min(h+1-a>>>1,6);i.push(16,p-3),a+=2*p-2}else i.push(l,0)}return o>>>1},r.F._hufTree=function(s,i,o){var a=[],l=s.length,u=i.length,d=0;for(d=0;d<u;d+=2)i[d]=0,i[d+1]=0;for(d=0;d<l;d++)s[d]!=0&&a.push({lit:d,f:s[d]});var f=a.length,h=a.slice(0);if(f==0)return 0;if(f==1){var p=a[0].lit;return h=p==0?1:0,i[1+(p<<1)]=1,i[1+(h<<1)]=1,1}a.sort(function(T,D){return T.f-D.f});var m=a[0],y=a[1],x=0,g=1,v=2;for(a[0]={lit:-1,f:m.f+y.f,l:m,r:y,d:0};g!=f-1;)m=x!=g&&(v==f||a[x].f<a[v].f)?a[x++]:a[v++],y=x!=g&&(v==f||a[x].f<a[v].f)?a[x++]:a[v++],a[g++]={lit:-1,f:m.f+y.f,l:m,r:y};var w=r.F.setDepth(a[g-1],0);for(w>o&&(r.F.restrictDepth(h,o,w),w=o),d=0;d<f;d++)i[1+(h[d].lit<<1)]=h[d].d;return w},r.F.setDepth=function(s,i){return s.lit!=-1?(s.d=i,i):Math.max(r.F.setDepth(s.l,i+1),r.F.setDepth(s.r,i+1))},r.F.restrictDepth=function(s,i,o){var a=0,l=1<<o-i,u=0;for(s.sort(function(f,h){return h.d==f.d?f.f-h.f:h.d-f.d}),a=0;a<s.length&&s[a].d>i;a++){var d=s[a].d;s[a].d=i,u+=l-(1<<o-d)}for(u>>>=o-i;u>0;)(d=s[a].d)<i?(s[a].d++,u-=1<<i-d-1):a++;for(;a>=0;a--)s[a].d==i&&u<0&&(s[a].d--,u++);u!=0&&console.log("debt left")},r.F._goodIndex=function(s,i){var o=0;return i[16|o]<=s&&(o|=16),i[8|o]<=s&&(o|=8),i[4|o]<=s&&(o|=4),i[2|o]<=s&&(o|=2),i[1|o]<=s&&(o|=1),o},r.F._writeLit=function(s,i,o,a){return r.F._putsF(o,a,i[s<<1]),a+i[1+(s<<1)]},r.F.inflate=function(s,i){var o=Uint8Array;if(s[0]==3&&s[1]==0)return i||new o(0);var a=r.F,l=a._bitsF,u=a._bitsE,d=a._decodeTiny,f=a.makeCodes,h=a.codes2map,p=a._get17,m=a.U,y=i==null;y&&(i=new o(s.length>>>2<<3));for(var x,g,v=0,w=0,T=0,D=0,k=0,I=0,C=0,S=0,_=0;v==0;)if(v=l(s,_,1),w=l(s,_+1,2),_+=3,w!=0){if(y&&(i=r.F._check(i,S+(1<<17))),w==1&&(x=m.flmap,g=m.fdmap,I=511,C=31),w==2){T=u(s,_,5)+257,D=u(s,_+5,5)+1,k=u(s,_+10,4)+4,_+=14;for(var N=0;N<38;N+=2)m.itree[N]=0,m.itree[N+1]=0;var j=1;for(N=0;N<k;N++){var O=u(s,_+3*N,3);m.itree[1+(m.ordr[N]<<1)]=O,O>j&&(j=O)}_+=3*k,f(m.itree,j),h(m.itree,j,m.imap),x=m.lmap,g=m.dmap,_=d(m.imap,(1<<j)-1,T+D,s,_,m.ttree);var P=a._copyOut(m.ttree,0,T,m.ltree);I=(1<<P)-1;var W=a._copyOut(m.ttree,T,D,m.dtree);C=(1<<W)-1,f(m.ltree,P),h(m.ltree,P,x),f(m.dtree,W),h(m.dtree,W,g)}for(;;){var R=x[p(s,_)&I];_+=15&R;var M=R>>>4;if(!(M>>>8))i[S++]=M;else{if(M==256)break;var X=S+M-254;if(M>264){var Q=m.ldef[M-257];X=S+(Q>>>3)+u(s,_,7&Q),_+=7&Q}var A=g[p(s,_)&C];_+=15&A;var Te=A>>>4,we=m.ddef[Te],B=(we>>>4)+l(s,_,15&we);for(_+=15&we,y&&(i=r.F._check(i,S+(1<<17)));S<X;)i[S]=i[S++-B],i[S]=i[S++-B],i[S]=i[S++-B],i[S]=i[S++-B];S=X}}}else{7&_&&(_+=8-(7&_));var F=4+(_>>>3),ne=s[F-4]|s[F-3]<<8;y&&(i=r.F._check(i,S+ne)),i.set(new o(s.buffer,s.byteOffset+F,ne),S),_=F+ne<<3,S+=ne}return i.length==S?i:i.slice(0,S)},r.F._check=function(s,i){var o=s.length;if(i<=o)return s;var a=new Uint8Array(Math.max(o<<1,i));return a.set(s,0),a},r.F._decodeTiny=function(s,i,o,a,l,u){for(var d=r.F._bitsE,f=r.F._get17,h=0;h<o;){var p=s[f(a,l)&i];l+=15&p;var m=p>>>4;if(m<=15)u[h]=m,h++;else{var y=0,x=0;m==16?(x=3+d(a,l,2),l+=2,y=u[h-1]):m==17?(x=3+d(a,l,3),l+=3):m==18&&(x=11+d(a,l,7),l+=7);for(var g=h+x;h<g;)u[h]=y,h++}}return l},r.F._copyOut=function(s,i,o,a){for(var l=0,u=0,d=a.length>>>1;u<o;){var f=s[u+i];a[u<<1]=0,a[1+(u<<1)]=f,f>l&&(l=f),u++}for(;u<d;)a[u<<1]=0,a[1+(u<<1)]=0,u++;return l},r.F.makeCodes=function(s,i){for(var o,a,l,u,d=r.F.U,f=s.length,h=d.bl_count,p=0;p<=i;p++)h[p]=0;for(p=1;p<f;p+=2)h[s[p]]++;var m=d.next_code;for(o=0,h[0]=0,a=1;a<=i;a++)o=o+h[a-1]<<1,m[a]=o;for(l=0;l<f;l+=2)(u=s[l+1])!=0&&(s[l]=m[u],m[u]++)},r.F.codes2map=function(s,i,o){for(var a=s.length,l=r.F.U.rev15,u=0;u<a;u+=2)if(s[u+1]!=0)for(var d=u>>1,f=s[u+1],h=d<<4|f,p=i-f,m=s[u]<<p,y=m+(1<<p);m!=y;)o[l[m]>>>15-i]=h,m++},r.F.revCodes=function(s,i){for(var o=r.F.U.rev15,a=15-i,l=0;l<s.length;l+=2){var u=s[l]<<i-s[l+1];s[l]=o[u]>>>a}},r.F._putsE=function(s,i,o){o<<=7&i;var a=i>>>3;s[a]|=o,s[a+1]|=o>>>8},r.F._putsF=function(s,i,o){o<<=7&i;var a=i>>>3;s[a]|=o,s[a+1]|=o>>>8,s[a+2]|=o>>>16},r.F._bitsE=function(s,i,o){return(s[i>>>3]|s[1+(i>>>3)]<<8)>>>(7&i)&(1<<o)-1},r.F._bitsF=function(s,i,o){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16)>>>(7&i)&(1<<o)-1},r.F._get17=function(s,i){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16)>>>(7&i)},r.F._get25=function(s,i){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16|s[3+(i>>>3)]<<24)>>>(7&i)},r.F.U=(e=Uint16Array,n=Uint32Array,{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new n(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new n(286),dhst:new n(30),ihst:new n(19),lits:new n(15e3),strt:new e(65536),prev:new e(32768)}),function(){for(var s=r.F.U,i=0;i<32768;i++){var o=i;o=(4278255360&(o=(4042322160&(o=(3435973836&(o=(2863311530&o)>>>1|(1431655765&o)<<1))>>>2|(858993459&o)<<2))>>>4|(252645135&o)<<4))>>>8|(16711935&o)<<8,s.rev15[i]=(o>>>16|o<<16)>>>17}function a(l,u,d){for(;u--!=0;)l.push(0,d)}for(i=0;i<32;i++)s.ldef[i]=s.of0[i]<<3|s.exb[i],s.ddef[i]=s.df0[i]<<4|s.dxb[i];a(s.fltree,144,8),a(s.fltree,112,9),a(s.fltree,24,7),a(s.fltree,8,8),r.F.makeCodes(s.fltree,9),r.F.codes2map(s.fltree,9,s.flmap),r.F.revCodes(s.fltree,9),a(s.fdtree,32,5),r.F.makeCodes(s.fdtree,5),r.F.codes2map(s.fdtree,5,s.fdmap),r.F.revCodes(s.fdtree,5),a(s.itree,19,0),a(s.ltree,286,0),a(s.dtree,30,0),a(s.ttree,320,0)}()})();var I9=E9({__proto__:null,default:hm},[hm]);const $i=function(){var t={nextZero(d,f){for(;d[f]!=0;)f++;return f},readUshort:(d,f)=>d[f]<<8|d[f+1],writeUshort(d,f,h){d[f]=h>>8&255,d[f+1]=255&h},readUint:(d,f)=>16777216*d[f]+(d[f+1]<<16|d[f+2]<<8|d[f+3]),writeUint(d,f,h){d[f]=h>>24&255,d[f+1]=h>>16&255,d[f+2]=h>>8&255,d[f+3]=255&h},readASCII(d,f,h){let p="";for(let m=0;m<h;m++)p+=String.fromCharCode(d[f+m]);return p},writeASCII(d,f,h){for(let p=0;p<h.length;p++)d[f+p]=h.charCodeAt(p)},readBytes(d,f,h){const p=[];for(let m=0;m<h;m++)p.push(d[f+m]);return p},pad:d=>d.length<2?`0${d}`:d,readUTF8(d,f,h){let p,m="";for(let y=0;y<h;y++)m+=`%${t.pad(d[f+y].toString(16))}`;try{p=decodeURIComponent(m)}catch{return t.readASCII(d,f,h)}return p}};function e(d,f,h,p){const m=f*h,y=i(p),x=Math.ceil(f*y/8),g=new Uint8Array(4*m),v=new Uint32Array(g.buffer),{ctype:w}=p,{depth:T}=p,D=t.readUshort;if(w==6){const Q=m<<2;if(T==8)for(var k=0;k<Q;k+=4)g[k]=d[k],g[k+1]=d[k+1],g[k+2]=d[k+2],g[k+3]=d[k+3];if(T==16)for(k=0;k<Q;k++)g[k]=d[k<<1]}else if(w==2){const Q=p.tabs.tRNS;if(Q==null){if(T==8)for(k=0;k<m;k++){var I=3*k;v[k]=255<<24|d[I+2]<<16|d[I+1]<<8|d[I]}if(T==16)for(k=0;k<m;k++)I=6*k,v[k]=255<<24|d[I+4]<<16|d[I+2]<<8|d[I]}else{var C=Q[0];const A=Q[1],Te=Q[2];if(T==8)for(k=0;k<m;k++){var S=k<<2;I=3*k,v[k]=255<<24|d[I+2]<<16|d[I+1]<<8|d[I],d[I]==C&&d[I+1]==A&&d[I+2]==Te&&(g[S+3]=0)}if(T==16)for(k=0;k<m;k++)S=k<<2,I=6*k,v[k]=255<<24|d[I+4]<<16|d[I+2]<<8|d[I],D(d,I)==C&&D(d,I+2)==A&&D(d,I+4)==Te&&(g[S+3]=0)}}else if(w==3){const Q=p.tabs.PLTE,A=p.tabs.tRNS,Te=A?A.length:0;if(T==1)for(var _=0;_<h;_++){var N=_*x,j=_*f;for(k=0;k<f;k++){S=j+k<<2;var O=3*(P=d[N+(k>>3)]>>7-((7&k)<<0)&1);g[S]=Q[O],g[S+1]=Q[O+1],g[S+2]=Q[O+2],g[S+3]=P<Te?A[P]:255}}if(T==2)for(_=0;_<h;_++)for(N=_*x,j=_*f,k=0;k<f;k++)S=j+k<<2,O=3*(P=d[N+(k>>2)]>>6-((3&k)<<1)&3),g[S]=Q[O],g[S+1]=Q[O+1],g[S+2]=Q[O+2],g[S+3]=P<Te?A[P]:255;if(T==4)for(_=0;_<h;_++)for(N=_*x,j=_*f,k=0;k<f;k++)S=j+k<<2,O=3*(P=d[N+(k>>1)]>>4-((1&k)<<2)&15),g[S]=Q[O],g[S+1]=Q[O+1],g[S+2]=Q[O+2],g[S+3]=P<Te?A[P]:255;if(T==8)for(k=0;k<m;k++){var P;S=k<<2,O=3*(P=d[k]),g[S]=Q[O],g[S+1]=Q[O+1],g[S+2]=Q[O+2],g[S+3]=P<Te?A[P]:255}}else if(w==4){if(T==8)for(k=0;k<m;k++){S=k<<2;var W=d[R=k<<1];g[S]=W,g[S+1]=W,g[S+2]=W,g[S+3]=d[R+1]}if(T==16)for(k=0;k<m;k++){var R;S=k<<2,W=d[R=k<<2],g[S]=W,g[S+1]=W,g[S+2]=W,g[S+3]=d[R+2]}}else if(w==0)for(C=p.tabs.tRNS?p.tabs.tRNS:-1,_=0;_<h;_++){const Q=_*x,A=_*f;if(T==1)for(var M=0;M<f;M++){var X=(W=255*(d[Q+(M>>>3)]>>>7-(7&M)&1))==255*C?0:255;v[A+M]=X<<24|W<<16|W<<8|W}else if(T==2)for(M=0;M<f;M++)X=(W=85*(d[Q+(M>>>2)]>>>6-((3&M)<<1)&3))==85*C?0:255,v[A+M]=X<<24|W<<16|W<<8|W;else if(T==4)for(M=0;M<f;M++)X=(W=17*(d[Q+(M>>>1)]>>>4-((1&M)<<2)&15))==17*C?0:255,v[A+M]=X<<24|W<<16|W<<8|W;else if(T==8)for(M=0;M<f;M++)X=(W=d[Q+M])==C?0:255,v[A+M]=X<<24|W<<16|W<<8|W;else if(T==16)for(M=0;M<f;M++)W=d[Q+(M<<1)],X=D(d,Q+(M<<1))==C?0:255,v[A+M]=X<<24|W<<16|W<<8|W}return g}function n(d,f,h,p){const m=i(d),y=Math.ceil(h*m/8),x=new Uint8Array((y+1+d.interlace)*p);return f=d.tabs.CgBI?s(f,x):r(f,x),d.interlace==0?f=o(f,d,0,h,p):d.interlace==1&&(f=function(v,w){const T=w.width,D=w.height,k=i(w),I=k>>3,C=Math.ceil(T*k/8),S=new Uint8Array(D*C);let _=0;const N=[0,0,4,0,2,0,1],j=[0,4,0,2,0,1,0],O=[8,8,8,4,4,2,2],P=[8,8,4,4,2,2,1];let W=0;for(;W<7;){const M=O[W],X=P[W];let Q=0,A=0,Te=N[W];for(;Te<D;)Te+=M,A++;let we=j[W];for(;we<T;)we+=X,Q++;const B=Math.ceil(Q*k/8);o(v,w,_,Q,A);let F=0,ne=N[W];for(;ne<D;){let We=j[W],ft=_+F*B<<3;for(;We<T;){var R;if(k==1&&(R=(R=v[ft>>3])>>7-(7&ft)&1,S[ne*C+(We>>3)]|=R<<7-((7&We)<<0)),k==2&&(R=(R=v[ft>>3])>>6-(7&ft)&3,S[ne*C+(We>>2)]|=R<<6-((3&We)<<1)),k==4&&(R=(R=v[ft>>3])>>4-(7&ft)&15,S[ne*C+(We>>1)]|=R<<4-((1&We)<<2)),k>=8){const le=ne*C+We*I;for(let De=0;De<I;De++)S[le+De]=v[(ft>>3)+De]}ft+=k,We+=X}F++,ne+=M}Q*A!=0&&(_+=A*(1+B)),W+=1}return S}(f,d)),f}function r(d,f){return s(new Uint8Array(d.buffer,2,d.length-6),f)}var s=function(){const d={H:{}};return d.H.N=function(f,h){const p=Uint8Array;let m,y,x=0,g=0,v=0,w=0,T=0,D=0,k=0,I=0,C=0;if(f[0]==3&&f[1]==0)return h||new p(0);const S=d.H,_=S.b,N=S.e,j=S.R,O=S.n,P=S.A,W=S.Z,R=S.m,M=h==null;for(M&&(h=new p(f.length>>>2<<5));x==0;)if(x=_(f,C,1),g=_(f,C+1,2),C+=3,g!=0){if(M&&(h=d.H.W(h,I+(1<<17))),g==1&&(m=R.J,y=R.h,D=511,k=31),g==2){v=N(f,C,5)+257,w=N(f,C+5,5)+1,T=N(f,C+10,4)+4,C+=14;let Q=1;for(var X=0;X<38;X+=2)R.Q[X]=0,R.Q[X+1]=0;for(X=0;X<T;X++){const we=N(f,C+3*X,3);R.Q[1+(R.X[X]<<1)]=we,we>Q&&(Q=we)}C+=3*T,O(R.Q,Q),P(R.Q,Q,R.u),m=R.w,y=R.d,C=j(R.u,(1<<Q)-1,v+w,f,C,R.v);const A=S.V(R.v,0,v,R.C);D=(1<<A)-1;const Te=S.V(R.v,v,w,R.D);k=(1<<Te)-1,O(R.C,A),P(R.C,A,m),O(R.D,Te),P(R.D,Te,y)}for(;;){const Q=m[W(f,C)&D];C+=15&Q;const A=Q>>>4;if(!(A>>>8))h[I++]=A;else{if(A==256)break;{let Te=I+A-254;if(A>264){const We=R.q[A-257];Te=I+(We>>>3)+N(f,C,7&We),C+=7&We}const we=y[W(f,C)&k];C+=15&we;const B=we>>>4,F=R.c[B],ne=(F>>>4)+_(f,C,15&F);for(C+=15&F;I<Te;)h[I]=h[I++-ne],h[I]=h[I++-ne],h[I]=h[I++-ne],h[I]=h[I++-ne];I=Te}}}}else{7&C&&(C+=8-(7&C));const Q=4+(C>>>3),A=f[Q-4]|f[Q-3]<<8;M&&(h=d.H.W(h,I+A)),h.set(new p(f.buffer,f.byteOffset+Q,A),I),C=Q+A<<3,I+=A}return h.length==I?h:h.slice(0,I)},d.H.W=function(f,h){const p=f.length;if(h<=p)return f;const m=new Uint8Array(p<<1);return m.set(f,0),m},d.H.R=function(f,h,p,m,y,x){const g=d.H.e,v=d.H.Z;let w=0;for(;w<p;){const T=f[v(m,y)&h];y+=15&T;const D=T>>>4;if(D<=15)x[w]=D,w++;else{let k=0,I=0;D==16?(I=3+g(m,y,2),y+=2,k=x[w-1]):D==17?(I=3+g(m,y,3),y+=3):D==18&&(I=11+g(m,y,7),y+=7);const C=w+I;for(;w<C;)x[w]=k,w++}}return y},d.H.V=function(f,h,p,m){let y=0,x=0;const g=m.length>>>1;for(;x<p;){const v=f[x+h];m[x<<1]=0,m[1+(x<<1)]=v,v>y&&(y=v),x++}for(;x<g;)m[x<<1]=0,m[1+(x<<1)]=0,x++;return y},d.H.n=function(f,h){const p=d.H.m,m=f.length;let y,x,g,v;const w=p.j;for(var T=0;T<=h;T++)w[T]=0;for(T=1;T<m;T+=2)w[f[T]]++;const D=p.K;for(y=0,w[0]=0,x=1;x<=h;x++)y=y+w[x-1]<<1,D[x]=y;for(g=0;g<m;g+=2)v=f[g+1],v!=0&&(f[g]=D[v],D[v]++)},d.H.A=function(f,h,p){const m=f.length,y=d.H.m.r;for(let x=0;x<m;x+=2)if(f[x+1]!=0){const g=x>>1,v=f[x+1],w=g<<4|v,T=h-v;let D=f[x]<<T;const k=D+(1<<T);for(;D!=k;)p[y[D]>>>15-h]=w,D++}},d.H.l=function(f,h){const p=d.H.m.r,m=15-h;for(let y=0;y<f.length;y+=2){const x=f[y]<<h-f[y+1];f[y]=p[x]>>>m}},d.H.M=function(f,h,p){p<<=7&h;const m=h>>>3;f[m]|=p,f[m+1]|=p>>>8},d.H.I=function(f,h,p){p<<=7&h;const m=h>>>3;f[m]|=p,f[m+1]|=p>>>8,f[m+2]|=p>>>16},d.H.e=function(f,h,p){return(f[h>>>3]|f[1+(h>>>3)]<<8)>>>(7&h)&(1<<p)-1},d.H.b=function(f,h,p){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16)>>>(7&h)&(1<<p)-1},d.H.Z=function(f,h){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16)>>>(7&h)},d.H.i=function(f,h){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16|f[3+(h>>>3)]<<24)>>>(7&h)},d.H.m=function(){const f=Uint16Array,h=Uint32Array;return{K:new f(16),j:new f(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new f(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new h(32),J:new f(512),_:[],h:new f(32),$:[],w:new f(32768),C:[],v:[],d:new f(32768),D:[],u:new f(512),Q:[],r:new f(32768),s:new h(286),Y:new h(30),a:new h(19),t:new h(15e3),k:new f(65536),g:new f(32768)}}(),function(){const f=d.H.m;for(var h=0;h<32768;h++){let m=h;m=(2863311530&m)>>>1|(1431655765&m)<<1,m=(3435973836&m)>>>2|(858993459&m)<<2,m=(4042322160&m)>>>4|(252645135&m)<<4,m=(4278255360&m)>>>8|(16711935&m)<<8,f.r[h]=(m>>>16|m<<16)>>>17}function p(m,y,x){for(;y--!=0;)m.push(0,x)}for(h=0;h<32;h++)f.q[h]=f.S[h]<<3|f.T[h],f.c[h]=f.p[h]<<4|f.z[h];p(f._,144,8),p(f._,112,9),p(f._,24,7),p(f._,8,8),d.H.n(f._,9),d.H.A(f._,9,f.J),d.H.l(f._,9),p(f.$,32,5),d.H.n(f.$,5),d.H.A(f.$,5,f.h),d.H.l(f.$,5),p(f.Q,19,0),p(f.C,286,0),p(f.D,30,0),p(f.v,320,0)}(),d.H.N}();function i(d){return[1,null,3,1,2,null,4][d.ctype]*d.depth}function o(d,f,h,p,m){let y=i(f);const x=Math.ceil(p*y/8);let g,v;y=Math.ceil(y/8);let w=d[h],T=0;if(w>1&&(d[h]=[0,0,1][w-2]),w==3)for(T=y;T<x;T++)d[T+1]=d[T+1]+(d[T+1-y]>>>1)&255;for(let D=0;D<m;D++)if(g=h+D*x,v=g+D+1,w=d[v-1],T=0,w==0)for(;T<x;T++)d[g+T]=d[v+T];else if(w==1){for(;T<y;T++)d[g+T]=d[v+T];for(;T<x;T++)d[g+T]=d[v+T]+d[g+T-y]}else if(w==2)for(;T<x;T++)d[g+T]=d[v+T]+d[g+T-x];else if(w==3){for(;T<y;T++)d[g+T]=d[v+T]+(d[g+T-x]>>>1);for(;T<x;T++)d[g+T]=d[v+T]+(d[g+T-x]+d[g+T-y]>>>1)}else{for(;T<y;T++)d[g+T]=d[v+T]+a(0,d[g+T-x],0);for(;T<x;T++)d[g+T]=d[v+T]+a(d[g+T-y],d[g+T-x],d[g+T-y-x])}return d}function a(d,f,h){const p=d+f-h,m=p-d,y=p-f,x=p-h;return m*m<=y*y&&m*m<=x*x?d:y*y<=x*x?f:h}function l(d,f,h){h.width=t.readUint(d,f),f+=4,h.height=t.readUint(d,f),f+=4,h.depth=d[f],f++,h.ctype=d[f],f++,h.compress=d[f],f++,h.filter=d[f],f++,h.interlace=d[f],f++}function u(d,f,h,p,m,y,x,g,v){const w=Math.min(f,m),T=Math.min(h,y);let D=0,k=0;for(let W=0;W<T;W++)for(let R=0;R<w;R++)if(x>=0&&g>=0?(D=W*f+R<<2,k=(g+W)*m+x+R<<2):(D=(-g+W)*f-x+R<<2,k=W*m+R<<2),v==0)p[k]=d[D],p[k+1]=d[D+1],p[k+2]=d[D+2],p[k+3]=d[D+3];else if(v==1){var I=d[D+3]*.00392156862745098,C=d[D]*I,S=d[D+1]*I,_=d[D+2]*I,N=p[k+3]*(1/255),j=p[k]*N,O=p[k+1]*N,P=p[k+2]*N;const M=1-I,X=I+N*M,Q=X==0?0:1/X;p[k+3]=255*X,p[k+0]=(C+j*M)*Q,p[k+1]=(S+O*M)*Q,p[k+2]=(_+P*M)*Q}else if(v==2)I=d[D+3],C=d[D],S=d[D+1],_=d[D+2],N=p[k+3],j=p[k],O=p[k+1],P=p[k+2],I==N&&C==j&&S==O&&_==P?(p[k]=0,p[k+1]=0,p[k+2]=0,p[k+3]=0):(p[k]=C,p[k+1]=S,p[k+2]=_,p[k+3]=I);else if(v==3){if(I=d[D+3],C=d[D],S=d[D+1],_=d[D+2],N=p[k+3],j=p[k],O=p[k+1],P=p[k+2],I==N&&C==j&&S==O&&_==P)continue;if(I<220&&N>20)return!1}return!0}return{decode:function(f){const h=new Uint8Array(f);let p=8;const m=t,y=m.readUshort,x=m.readUint,g={tabs:{},frames:[]},v=new Uint8Array(h.length);let w,T=0,D=0;const k=[137,80,78,71,13,10,26,10];for(var I=0;I<8;I++)if(h[I]!=k[I])throw"The input is not a PNG file!";for(;p<h.length;){const W=m.readUint(h,p);p+=4;const R=m.readASCII(h,p,4);if(p+=4,R=="IHDR")l(h,p,g);else if(R=="iCCP"){for(var C=p;h[C]!=0;)C++;m.readASCII(h,p,C-p),h[C+1];const M=h.slice(C+2,p+W);let X=null;try{X=r(M)}catch{X=s(M)}g.tabs[R]=X}else if(R=="CgBI")g.tabs[R]=h.slice(p,p+4);else if(R=="IDAT"){for(I=0;I<W;I++)v[T+I]=h[p+I];T+=W}else if(R=="acTL")g.tabs[R]={num_frames:x(h,p),num_plays:x(h,p+4)},w=new Uint8Array(h.length);else if(R=="fcTL"){D!=0&&((P=g.frames[g.frames.length-1]).data=n(g,w.slice(0,D),P.rect.width,P.rect.height),D=0);const M={x:x(h,p+12),y:x(h,p+16),width:x(h,p+4),height:x(h,p+8)};let X=y(h,p+22);X=y(h,p+20)/(X==0?100:X);const Q={rect:M,delay:Math.round(1e3*X),dispose:h[p+24],blend:h[p+25]};g.frames.push(Q)}else if(R=="fdAT"){for(I=0;I<W-4;I++)w[D+I]=h[p+I+4];D+=W-4}else if(R=="pHYs")g.tabs[R]=[m.readUint(h,p),m.readUint(h,p+4),h[p+8]];else if(R=="cHRM")for(g.tabs[R]=[],I=0;I<8;I++)g.tabs[R].push(m.readUint(h,p+4*I));else if(R=="tEXt"||R=="zTXt"){g.tabs[R]==null&&(g.tabs[R]={});var S=m.nextZero(h,p),_=m.readASCII(h,p,S-p),N=p+W-S-1;if(R=="tEXt")O=m.readASCII(h,S+1,N);else{var j=r(h.slice(S+2,S+2+N));O=m.readUTF8(j,0,j.length)}g.tabs[R][_]=O}else if(R=="iTXt"){g.tabs[R]==null&&(g.tabs[R]={}),S=0,C=p,S=m.nextZero(h,C),_=m.readASCII(h,C,S-C);const M=h[C=S+1];var O;h[C+1],C+=2,S=m.nextZero(h,C),m.readASCII(h,C,S-C),C=S+1,S=m.nextZero(h,C),m.readUTF8(h,C,S-C),N=W-((C=S+1)-p),M==0?O=m.readUTF8(h,C,N):(j=r(h.slice(C,C+N)),O=m.readUTF8(j,0,j.length)),g.tabs[R][_]=O}else if(R=="PLTE")g.tabs[R]=m.readBytes(h,p,W);else if(R=="hIST"){const M=g.tabs.PLTE.length/3;for(g.tabs[R]=[],I=0;I<M;I++)g.tabs[R].push(y(h,p+2*I))}else if(R=="tRNS")g.ctype==3?g.tabs[R]=m.readBytes(h,p,W):g.ctype==0?g.tabs[R]=y(h,p):g.ctype==2&&(g.tabs[R]=[y(h,p),y(h,p+2),y(h,p+4)]);else if(R=="gAMA")g.tabs[R]=m.readUint(h,p)/1e5;else if(R=="sRGB")g.tabs[R]=h[p];else if(R=="bKGD")g.ctype==0||g.ctype==4?g.tabs[R]=[y(h,p)]:g.ctype==2||g.ctype==6?g.tabs[R]=[y(h,p),y(h,p+2),y(h,p+4)]:g.ctype==3&&(g.tabs[R]=h[p]);else if(R=="IEND")break;p+=W,m.readUint(h,p),p+=4}var P;return D!=0&&((P=g.frames[g.frames.length-1]).data=n(g,w.slice(0,D),P.rect.width,P.rect.height)),g.data=n(g,v,g.width,g.height),delete g.compress,delete g.interlace,delete g.filter,g},toRGBA8:function(f){const h=f.width,p=f.height;if(f.tabs.acTL==null)return[e(f.data,h,p,f).buffer];const m=[];f.frames[0].data==null&&(f.frames[0].data=f.data);const y=h*p*4,x=new Uint8Array(y),g=new Uint8Array(y),v=new Uint8Array(y);for(let T=0;T<f.frames.length;T++){const D=f.frames[T],k=D.rect.x,I=D.rect.y,C=D.rect.width,S=D.rect.height,_=e(D.data,C,S,f);if(T!=0)for(var w=0;w<y;w++)v[w]=x[w];if(D.blend==0?u(_,C,S,x,h,p,k,I,0):D.blend==1&&u(_,C,S,x,h,p,k,I,1),m.push(x.buffer.slice(0)),D.dispose!=0){if(D.dispose==1)u(g,C,S,x,h,p,k,I,0);else if(D.dispose==2)for(w=0;w<y;w++)x[w]=v[w]}}return m},_paeth:a,_copyTile:u,_bin:t}}();(function(){const{_copyTile:t}=$i,{_bin:e}=$i,n=$i._paeth;var r={table:function(){const C=new Uint32Array(256);for(let S=0;S<256;S++){let _=S;for(let N=0;N<8;N++)1&_?_=3988292384^_>>>1:_>>>=1;C[S]=_}return C}(),update(C,S,_,N){for(let j=0;j<N;j++)C=r.table[255&(C^S[_+j])]^C>>>8;return C},crc:(C,S,_)=>4294967295^r.update(4294967295,C,S,_)};function s(C,S,_,N){S[_]+=C[0]*N>>4,S[_+1]+=C[1]*N>>4,S[_+2]+=C[2]*N>>4,S[_+3]+=C[3]*N>>4}function i(C){return Math.max(0,Math.min(255,C))}function o(C,S){const _=C[0]-S[0],N=C[1]-S[1],j=C[2]-S[2],O=C[3]-S[3];return _*_+N*N+j*j+O*O}function a(C,S,_,N,j,O,P){P==null&&(P=1);const W=N.length,R=[];for(var M=0;M<W;M++){const ne=N[M];R.push([ne>>>0&255,ne>>>8&255,ne>>>16&255,ne>>>24&255])}for(M=0;M<W;M++){let ne=4294967295;for(var X=0,Q=0;Q<W;Q++){var A=o(R[M],R[Q]);Q!=M&&A<ne&&(ne=A,X=Q)}}const Te=new Uint32Array(j.buffer),we=new Int16Array(S*_*4),B=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(M=0;M<B.length;M++)B[M]=255*((B[M]+.5)/16-.5);for(let ne=0;ne<_;ne++)for(let We=0;We<S;We++){var F;M=4*(ne*S+We),P!=2?F=[i(C[M]+we[M]),i(C[M+1]+we[M+1]),i(C[M+2]+we[M+2]),i(C[M+3]+we[M+3])]:(A=B[4*(3&ne)+(3&We)],F=[i(C[M]+A),i(C[M+1]+A),i(C[M+2]+A),i(C[M+3]+A)]),X=0;let ft=16777215;for(Q=0;Q<W;Q++){const ie=o(F,R[Q]);ie<ft&&(ft=ie,X=Q)}const le=R[X],De=[F[0]-le[0],F[1]-le[1],F[2]-le[2],F[3]-le[3]];P==1&&(We!=S-1&&s(De,we,M+4,7),ne!=_-1&&(We!=0&&s(De,we,M+4*S-4,3),s(De,we,M+4*S,5),We!=S-1&&s(De,we,M+4*S+4,1))),O[M>>2]=X,Te[M>>2]=N[X]}}function l(C,S,_,N,j){j==null&&(j={});const{crc:O}=r,P=e.writeUint,W=e.writeUshort,R=e.writeASCII;let M=8;const X=C.frames.length>1;let Q,A=!1,Te=33+(X?20:0);if(j.sRGB!=null&&(Te+=13),j.pHYs!=null&&(Te+=21),j.iCCP!=null&&(Q=pako.deflate(j.iCCP),Te+=21+Q.length+4),C.ctype==3){for(var we=C.plte.length,B=0;B<we;B++)C.plte[B]>>>24!=255&&(A=!0);Te+=8+3*we+4+(A?8+1*we+4:0)}for(var F=0;F<C.frames.length;F++)X&&(Te+=38),Te+=(le=C.frames[F]).cimg.length+12,F!=0&&(Te+=4);Te+=12;const ne=new Uint8Array(Te),We=[137,80,78,71,13,10,26,10];for(B=0;B<8;B++)ne[B]=We[B];if(P(ne,M,13),M+=4,R(ne,M,"IHDR"),M+=4,P(ne,M,S),M+=4,P(ne,M,_),M+=4,ne[M]=C.depth,M++,ne[M]=C.ctype,M++,ne[M]=0,M++,ne[M]=0,M++,ne[M]=0,M++,P(ne,M,O(ne,M-17,17)),M+=4,j.sRGB!=null&&(P(ne,M,1),M+=4,R(ne,M,"sRGB"),M+=4,ne[M]=j.sRGB,M++,P(ne,M,O(ne,M-5,5)),M+=4),j.iCCP!=null){const De=13+Q.length;P(ne,M,De),M+=4,R(ne,M,"iCCP"),M+=4,R(ne,M,"ICC profile"),M+=11,M+=2,ne.set(Q,M),M+=Q.length,P(ne,M,O(ne,M-(De+4),De+4)),M+=4}if(j.pHYs!=null&&(P(ne,M,9),M+=4,R(ne,M,"pHYs"),M+=4,P(ne,M,j.pHYs[0]),M+=4,P(ne,M,j.pHYs[1]),M+=4,ne[M]=j.pHYs[2],M++,P(ne,M,O(ne,M-13,13)),M+=4),X&&(P(ne,M,8),M+=4,R(ne,M,"acTL"),M+=4,P(ne,M,C.frames.length),M+=4,P(ne,M,j.loop!=null?j.loop:0),M+=4,P(ne,M,O(ne,M-12,12)),M+=4),C.ctype==3){for(P(ne,M,3*(we=C.plte.length)),M+=4,R(ne,M,"PLTE"),M+=4,B=0;B<we;B++){const De=3*B,ie=C.plte[B],Fe=255&ie,_e=ie>>>8&255,tt=ie>>>16&255;ne[M+De+0]=Fe,ne[M+De+1]=_e,ne[M+De+2]=tt}if(M+=3*we,P(ne,M,O(ne,M-3*we-4,3*we+4)),M+=4,A){for(P(ne,M,we),M+=4,R(ne,M,"tRNS"),M+=4,B=0;B<we;B++)ne[M+B]=C.plte[B]>>>24&255;M+=we,P(ne,M,O(ne,M-we-4,we+4)),M+=4}}let ft=0;for(F=0;F<C.frames.length;F++){var le=C.frames[F];X&&(P(ne,M,26),M+=4,R(ne,M,"fcTL"),M+=4,P(ne,M,ft++),M+=4,P(ne,M,le.rect.width),M+=4,P(ne,M,le.rect.height),M+=4,P(ne,M,le.rect.x),M+=4,P(ne,M,le.rect.y),M+=4,W(ne,M,N[F]),M+=2,W(ne,M,1e3),M+=2,ne[M]=le.dispose,M++,ne[M]=le.blend,M++,P(ne,M,O(ne,M-30,30)),M+=4);const De=le.cimg;P(ne,M,(we=De.length)+(F==0?0:4)),M+=4;const ie=M;R(ne,M,F==0?"IDAT":"fdAT"),M+=4,F!=0&&(P(ne,M,ft++),M+=4),ne.set(De,M),M+=we,P(ne,M,O(ne,ie,M-ie)),M+=4}return P(ne,M,0),M+=4,R(ne,M,"IEND"),M+=4,P(ne,M,O(ne,M-4,4)),M+=4,ne.buffer}function u(C,S,_){for(let N=0;N<C.frames.length;N++){const j=C.frames[N];j.rect.width;const O=j.rect.height,P=new Uint8Array(O*j.bpl+O);j.cimg=p(j.img,O,j.bpp,j.bpl,P,S,_)}}function d(C,S,_,N,j){const O=j[0],P=j[1],W=j[2],R=j[3],M=j[4],X=j[5];let Q=6,A=8,Te=255;for(var we=0;we<C.length;we++){const it=new Uint8Array(C[we]);for(var B=it.length,F=0;F<B;F+=4)Te&=it[F+3]}const ne=Te!=255,We=function(Ue,K,ue,re,oe,pe){const se=[];for(var Se=0;Se<Ue.length;Se++){const vt=new Uint8Array(Ue[Se]),me=new Uint32Array(vt.buffer);var Pe;let He=0,qe=0,nt=K,Me=ue,ut=re?1:0;if(Se!=0){const ee=pe||re||Se==1||se[Se-2].dispose!=0?1:2;let fe=0,q=1e9;for(let Z=0;Z<ee;Z++){var ye=new Uint8Array(Ue[Se-1-Z]);const ge=new Uint32Array(Ue[Se-1-Z]);let xe=K,be=ue,ve=-1,ot=-1;for(let G=0;G<ue;G++)for(let ae=0;ae<K;ae++)me[Ze=G*K+ae]!=ge[Ze]&&(ae<xe&&(xe=ae),ae>ve&&(ve=ae),G<be&&(be=G),G>ot&&(ot=G));ve==-1&&(xe=be=ve=ot=0),oe&&((1&xe)==1&&xe--,(1&be)==1&&be--);const et=(ve-xe+1)*(ot-be+1);et<q&&(q=et,fe=Z,He=xe,qe=be,nt=ve-xe+1,Me=ot-be+1)}ye=new Uint8Array(Ue[Se-1-fe]),fe==1&&(se[Se-1].dispose=2),Pe=new Uint8Array(nt*Me*4),t(ye,K,ue,Pe,nt,Me,-He,-qe,0),ut=t(vt,K,ue,Pe,nt,Me,-He,-qe,3)?1:0,ut==1?h(vt,K,ue,Pe,{x:He,y:qe,width:nt,height:Me}):t(vt,K,ue,Pe,nt,Me,-He,-qe,0)}else Pe=vt.slice(0);se.push({rect:{x:He,y:qe,width:nt,height:Me},img:Pe,blend:ut,dispose:0})}if(re)for(Se=0;Se<se.length;Se++){if((gt=se[Se]).blend==1)continue;const vt=gt.rect,me=se[Se-1].rect,He=Math.min(vt.x,me.x),qe=Math.min(vt.y,me.y),nt={x:He,y:qe,width:Math.max(vt.x+vt.width,me.x+me.width)-He,height:Math.max(vt.y+vt.height,me.y+me.height)-qe};se[Se-1].dispose=1,Se-1!=0&&f(Ue,K,ue,se,Se-1,nt,oe),f(Ue,K,ue,se,Se,nt,oe)}let ze=0;if(Ue.length!=1)for(var Ze=0;Ze<se.length;Ze++){var gt;ze+=(gt=se[Ze]).rect.width*gt.rect.height}return se}(C,S,_,O,P,W),ft={},le=[],De=[];if(N!=0){const it=[];for(F=0;F<We.length;F++)it.push(We[F].img.buffer);const Ue=function(oe){let pe=0;for(var se=0;se<oe.length;se++)pe+=oe[se].byteLength;const Se=new Uint8Array(pe);let Pe=0;for(se=0;se<oe.length;se++){const ye=new Uint8Array(oe[se]),ze=ye.length;for(let Ze=0;Ze<ze;Ze+=4){let gt=ye[Ze],vt=ye[Ze+1],me=ye[Ze+2];const He=ye[Ze+3];He==0&&(gt=vt=me=0),Se[Pe+Ze]=gt,Se[Pe+Ze+1]=vt,Se[Pe+Ze+2]=me,Se[Pe+Ze+3]=He}Pe+=ze}return Se.buffer}(it),K=y(Ue,N);for(F=0;F<K.plte.length;F++)le.push(K.plte[F].est.rgba);let ue=0;for(F=0;F<We.length;F++){const re=(Fe=We[F]).img.length;var ie=new Uint8Array(K.inds.buffer,ue>>2,re>>2);De.push(ie);const oe=new Uint8Array(K.abuf,ue,re);X&&a(Fe.img,Fe.rect.width,Fe.rect.height,le,oe,ie),Fe.img.set(oe),ue+=re}}else for(we=0;we<We.length;we++){var Fe=We[we];const it=new Uint32Array(Fe.img.buffer);var _e=Fe.rect.width;for(B=it.length,ie=new Uint8Array(B),De.push(ie),F=0;F<B;F++){const Ue=it[F];if(F!=0&&Ue==it[F-1])ie[F]=ie[F-1];else if(F>_e&&Ue==it[F-_e])ie[F]=ie[F-_e];else{let K=ft[Ue];if(K==null&&(ft[Ue]=K=le.length,le.push(Ue),le.length>=300))break;ie[F]=K}}}const tt=le.length;for(tt<=256&&M==0&&(A=tt<=2?1:tt<=4?2:tt<=16?4:8,A=Math.max(A,R)),we=0;we<We.length;we++){(Fe=We[we]).rect.x,Fe.rect.y,_e=Fe.rect.width;const it=Fe.rect.height;let Ue=Fe.img;new Uint32Array(Ue.buffer);let K=4*_e,ue=4;if(tt<=256&&M==0){K=Math.ceil(A*_e/8);var Xe=new Uint8Array(K*it);const re=De[we];for(let oe=0;oe<it;oe++){F=oe*K;const pe=oe*_e;if(A==8)for(var Ve=0;Ve<_e;Ve++)Xe[F+Ve]=re[pe+Ve];else if(A==4)for(Ve=0;Ve<_e;Ve++)Xe[F+(Ve>>1)]|=re[pe+Ve]<<4-4*(1&Ve);else if(A==2)for(Ve=0;Ve<_e;Ve++)Xe[F+(Ve>>2)]|=re[pe+Ve]<<6-2*(3&Ve);else if(A==1)for(Ve=0;Ve<_e;Ve++)Xe[F+(Ve>>3)]|=re[pe+Ve]<<7-1*(7&Ve)}Ue=Xe,Q=3,ue=1}else if(ne==0&&We.length==1){Xe=new Uint8Array(_e*it*3);const re=_e*it;for(F=0;F<re;F++){const oe=3*F,pe=4*F;Xe[oe]=Ue[pe],Xe[oe+1]=Ue[pe+1],Xe[oe+2]=Ue[pe+2]}Ue=Xe,Q=2,ue=3,K=3*_e}Fe.img=Ue,Fe.bpl=K,Fe.bpp=ue}return{ctype:Q,depth:A,plte:le,frames:We}}function f(C,S,_,N,j,O,P){const W=Uint8Array,R=Uint32Array,M=new W(C[j-1]),X=new R(C[j-1]),Q=j+1<C.length?new W(C[j+1]):null,A=new W(C[j]),Te=new R(A.buffer);let we=S,B=_,F=-1,ne=-1;for(let ft=0;ft<O.height;ft++)for(let le=0;le<O.width;le++){const De=O.x+le,ie=O.y+ft,Fe=ie*S+De,_e=Te[Fe];_e==0||N[j-1].dispose==0&&X[Fe]==_e&&(Q==null||Q[4*Fe+3]!=0)||(De<we&&(we=De),De>F&&(F=De),ie<B&&(B=ie),ie>ne&&(ne=ie))}F==-1&&(we=B=F=ne=0),P&&((1&we)==1&&we--,(1&B)==1&&B--),O={x:we,y:B,width:F-we+1,height:ne-B+1};const We=N[j];We.rect=O,We.blend=1,We.img=new Uint8Array(O.width*O.height*4),N[j-1].dispose==0?(t(M,S,_,We.img,O.width,O.height,-O.x,-O.y,0),h(A,S,_,We.img,O)):t(A,S,_,We.img,O.width,O.height,-O.x,-O.y,0)}function h(C,S,_,N,j){t(C,S,_,N,j.width,j.height,-j.x,-j.y,2)}function p(C,S,_,N,j,O,P){const W=[];let R,M=[0,1,2,3,4];O!=-1?M=[O]:(S*N>5e5||_==1)&&(M=[0]),P&&(R={level:0});const X=I9;for(var Q=0;Q<M.length;Q++){for(let we=0;we<S;we++)m(j,C,we,N,_,M[Q]);W.push(X.deflate(j,R))}let A,Te=1e9;for(Q=0;Q<W.length;Q++)W[Q].length<Te&&(A=Q,Te=W[Q].length);return W[A]}function m(C,S,_,N,j,O){const P=_*N;let W=P+_;if(C[W]=O,W++,O==0)if(N<500)for(var R=0;R<N;R++)C[W+R]=S[P+R];else C.set(new Uint8Array(S.buffer,P,N),W);else if(O==1){for(R=0;R<j;R++)C[W+R]=S[P+R];for(R=j;R<N;R++)C[W+R]=S[P+R]-S[P+R-j]+256&255}else if(_==0){for(R=0;R<j;R++)C[W+R]=S[P+R];if(O==2)for(R=j;R<N;R++)C[W+R]=S[P+R];if(O==3)for(R=j;R<N;R++)C[W+R]=S[P+R]-(S[P+R-j]>>1)+256&255;if(O==4)for(R=j;R<N;R++)C[W+R]=S[P+R]-n(S[P+R-j],0,0)+256&255}else{if(O==2)for(R=0;R<N;R++)C[W+R]=S[P+R]+256-S[P+R-N]&255;if(O==3){for(R=0;R<j;R++)C[W+R]=S[P+R]+256-(S[P+R-N]>>1)&255;for(R=j;R<N;R++)C[W+R]=S[P+R]+256-(S[P+R-N]+S[P+R-j]>>1)&255}if(O==4){for(R=0;R<j;R++)C[W+R]=S[P+R]+256-n(0,S[P+R-N],0)&255;for(R=j;R<N;R++)C[W+R]=S[P+R]+256-n(S[P+R-j],S[P+R-N],S[P+R-j-N])&255}}}function y(C,S){const _=new Uint8Array(C),N=_.slice(0),j=new Uint32Array(N.buffer),O=x(N,S),P=O[0],W=O[1],R=_.length,M=new Uint8Array(R>>2);let X;if(_.length<2e7)for(var Q=0;Q<R;Q+=4)X=g(P,A=_[Q]*(1/255),Te=_[Q+1]*(1/255),we=_[Q+2]*(1/255),B=_[Q+3]*(1/255)),M[Q>>2]=X.ind,j[Q>>2]=X.est.rgba;else for(Q=0;Q<R;Q+=4){var A=_[Q]*.00392156862745098,Te=_[Q+1]*(1/255),we=_[Q+2]*(1/255),B=_[Q+3]*(1/255);for(X=P;X.left;)X=v(X.est,A,Te,we,B)<=0?X.left:X.right;M[Q>>2]=X.ind,j[Q>>2]=X.est.rgba}return{abuf:N.buffer,inds:M,plte:W}}function x(C,S,_){_==null&&(_=1e-4);const N=new Uint32Array(C.buffer),j={i0:0,i1:C.length,bst:null,est:null,tdst:0,left:null,right:null};j.bst=D(C,j.i0,j.i1),j.est=k(j.bst);const O=[j];for(;O.length<S;){let W=0,R=0;for(var P=0;P<O.length;P++)O[P].est.L>W&&(W=O[P].est.L,R=P);if(W<_)break;const M=O[R],X=w(C,N,M.i0,M.i1,M.est.e,M.est.eMq255);if(M.i0>=X||M.i1<=X){M.est.L=0;continue}const Q={i0:M.i0,i1:X,bst:null,est:null,tdst:0,left:null,right:null};Q.bst=D(C,Q.i0,Q.i1),Q.est=k(Q.bst);const A={i0:X,i1:M.i1,bst:null,est:null,tdst:0,left:null,right:null};for(A.bst={R:[],m:[],N:M.bst.N-Q.bst.N},P=0;P<16;P++)A.bst.R[P]=M.bst.R[P]-Q.bst.R[P];for(P=0;P<4;P++)A.bst.m[P]=M.bst.m[P]-Q.bst.m[P];A.est=k(A.bst),M.left=Q,M.right=A,O[R]=Q,O.push(A)}for(O.sort((W,R)=>R.bst.N-W.bst.N),P=0;P<O.length;P++)O[P].ind=P;return[j,O]}function g(C,S,_,N,j){if(C.left==null)return C.tdst=function(Q,A,Te,we,B){const F=A-Q[0],ne=Te-Q[1],We=we-Q[2],ft=B-Q[3];return F*F+ne*ne+We*We+ft*ft}(C.est.q,S,_,N,j),C;const O=v(C.est,S,_,N,j);let P=C.left,W=C.right;O>0&&(P=C.right,W=C.left);const R=g(P,S,_,N,j);if(R.tdst<=O*O)return R;const M=g(W,S,_,N,j);return M.tdst<R.tdst?M:R}function v(C,S,_,N,j){const{e:O}=C;return O[0]*S+O[1]*_+O[2]*N+O[3]*j-C.eMq}function w(C,S,_,N,j,O){for(N-=4;_<N;){for(;T(C,_,j)<=O;)_+=4;for(;T(C,N,j)>O;)N-=4;if(_>=N)break;const P=S[_>>2];S[_>>2]=S[N>>2],S[N>>2]=P,_+=4,N-=4}for(;T(C,_,j)>O;)_-=4;return _+4}function T(C,S,_){return C[S]*_[0]+C[S+1]*_[1]+C[S+2]*_[2]+C[S+3]*_[3]}function D(C,S,_){const N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],j=[0,0,0,0],O=_-S>>2;for(let P=S;P<_;P+=4){const W=C[P]*.00392156862745098,R=C[P+1]*(1/255),M=C[P+2]*(1/255),X=C[P+3]*(1/255);j[0]+=W,j[1]+=R,j[2]+=M,j[3]+=X,N[0]+=W*W,N[1]+=W*R,N[2]+=W*M,N[3]+=W*X,N[5]+=R*R,N[6]+=R*M,N[7]+=R*X,N[10]+=M*M,N[11]+=M*X,N[15]+=X*X}return N[4]=N[1],N[8]=N[2],N[9]=N[6],N[12]=N[3],N[13]=N[7],N[14]=N[11],{R:N,m:j,N:O}}function k(C){const{R:S}=C,{m:_}=C,{N}=C,j=_[0],O=_[1],P=_[2],W=_[3],R=N==0?0:1/N,M=[S[0]-j*j*R,S[1]-j*O*R,S[2]-j*P*R,S[3]-j*W*R,S[4]-O*j*R,S[5]-O*O*R,S[6]-O*P*R,S[7]-O*W*R,S[8]-P*j*R,S[9]-P*O*R,S[10]-P*P*R,S[11]-P*W*R,S[12]-W*j*R,S[13]-W*O*R,S[14]-W*P*R,S[15]-W*W*R],X=M,Q=I;let A=[Math.random(),Math.random(),Math.random(),Math.random()],Te=0,we=0;if(N!=0)for(let F=0;F<16&&(A=Q.multVec(X,A),we=Math.sqrt(Q.dot(A,A)),A=Q.sml(1/we,A),!(F!=0&&Math.abs(we-Te)<1e-9));F++)Te=we;const B=[j*R,O*R,P*R,W*R];return{Cov:M,q:B,e:A,L:Te,eMq255:Q.dot(Q.sml(255,B),A),eMq:Q.dot(A,B),rgba:(Math.round(255*B[3])<<24|Math.round(255*B[2])<<16|Math.round(255*B[1])<<8|Math.round(255*B[0])<<0)>>>0}}var I={multVec:(C,S)=>[C[0]*S[0]+C[1]*S[1]+C[2]*S[2]+C[3]*S[3],C[4]*S[0]+C[5]*S[1]+C[6]*S[2]+C[7]*S[3],C[8]*S[0]+C[9]*S[1]+C[10]*S[2]+C[11]*S[3],C[12]*S[0]+C[13]*S[1]+C[14]*S[2]+C[15]*S[3]],dot:(C,S)=>C[0]*S[0]+C[1]*S[1]+C[2]*S[2]+C[3]*S[3],sml:(C,S)=>[C*S[0],C*S[1],C*S[2],C*S[3]]};$i.encode=function(S,_,N,j,O,P,W){j==null&&(j=0),W==null&&(W=!1);const R=d(S,_,N,j,[!1,!1,!1,0,W,!1]);return u(R,-1),l(R,_,N,O,P)},$i.encodeLL=function(S,_,N,j,O,P,W,R){const M={ctype:0+(j==1?0:2)+(O==0?0:4),depth:P,frames:[]},X=(j+O)*P,Q=X*_;for(let A=0;A<S.length;A++)M.frames.push({rect:{x:0,y:0,width:_,height:N},img:new Uint8Array(S[A]),blend:0,dispose:1,bpp:Math.ceil(X/8),bpl:Math.ceil(Q/8)});return u(M,0,!0),l(M,_,N,W,R)},$i.encode.compress=d,$i.encode.dither=a,$i.quantize=y,$i.quantize.getKDtree=x,$i.quantize.getNearest=g})();const SM={toArrayBuffer(t,e){const n=t.width,r=t.height,s=n<<2,i=t.getContext("2d").getImageData(0,0,n,r),o=new Uint32Array(i.data.buffer),a=(32*n+31)/32<<2,l=a*r,u=122+l,d=new ArrayBuffer(u),f=new DataView(d),h=1<<20;let p,m,y,x,g=h,v=0,w=0,T=0;function D(C){f.setUint16(w,C,!0),w+=2}function k(C){f.setUint32(w,C,!0),w+=4}function I(C){w+=C}D(19778),k(u),I(4),k(122),k(108),k(n),k(-r>>>0),D(1),D(32),k(3),k(l),k(2835),k(2835),I(8),k(16711680),k(65280),k(255),k(4278190080),k(1466527264),function C(){for(;v<r&&g>0;){for(x=122+v*a,p=0;p<s;)g--,m=o[T++],y=m>>>24,f.setUint32(x+p,m<<8|y),p+=4;v++}T<o.length?(g=h,setTimeout(C,SM._dly)):e(d)}()},toBlob(t,e){this.toArrayBuffer(t,n=>{e(new Blob([n],{type:"image/bmp"}))})},_dly:9};var Ms={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},D9={[Ms.CHROME]:16384,[Ms.FIREFOX]:11180,[Ms.DESKTOP_SAFARI]:16384,[Ms.IE]:8192,[Ms.IOS]:4096,[Ms.ETC]:8192};const cv=typeof window<"u",_M=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,pm=cv&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),M9=(cv||_M)&&(pm&&pm.getOriginalSymbol(window,"File")||typeof File<"u"&&File),TM=(cv||_M)&&(pm&&pm.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function uv(t,e,n=Date.now()){return new Promise(r=>{const s=t.split(","),i=s[0].match(/:(.*?);/)[1],o=globalThis.atob(s[1]);let a=o.length;const l=new Uint8Array(a);for(;a--;)l[a]=o.charCodeAt(a);const u=new Blob([l],{type:i});u.name=e,u.lastModified=n,r(u)})}function CM(t){return new Promise((e,n)=>{const r=new TM;r.onload=()=>e(r.result),r.onerror=s=>n(s),r.readAsDataURL(t)})}function EM(t){return new Promise((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=s=>n(s),r.src=t})}function jl(){if(jl.cachedResult!==void 0)return jl.cachedResult;let t=Ms.ETC;const{userAgent:e}=navigator;return/Chrom(e|ium)/i.test(e)?t=Ms.CHROME:/iP(ad|od|hone)/i.test(e)&&/WebKit/i.test(e)?t=Ms.IOS:/Safari/i.test(e)?t=Ms.DESKTOP_SAFARI:/Firefox/i.test(e)?t=Ms.FIREFOX:(/MSIE/i.test(e)||document.documentMode)&&(t=Ms.IE),jl.cachedResult=t,jl.cachedResult}function NM(t,e){const n=jl(),r=D9[n];let s=t,i=e,o=s*i;const a=s>i?i/s:s/i;for(;o>r*r;){const l=(r+s)/2,u=(r+i)/2;l<u?(i=u,s=u*a):(i=l*a,s=l),o=s*i}return{width:s,height:i}}function Pg(t,e){let n,r;try{if(n=new OffscreenCanvas(t,e),r=n.getContext("2d"),r===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{n=document.createElement("canvas"),r=n.getContext("2d")}return n.width=t,n.height=e,[n,r]}function jM(t,e){const{width:n,height:r}=NM(t.width,t.height),[s,i]=Pg(n,r);return e&&/jpe?g/.test(e)&&(i.fillStyle="white",i.fillRect(0,0,s.width,s.height)),i.drawImage(t,0,0,s.width,s.height),s}function bp(){return bp.cachedResult!==void 0||(bp.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),bp.cachedResult}function mm(t,e={}){return new Promise(function(n,r){let s,i;var o=function(){try{return i=jM(s,e.fileType||t.type),n([s,i])}catch(l){return r(l)}},a=function(l){try{var u=function(d){try{throw d}catch(f){return r(f)}};try{let d;return CM(t).then(function(f){try{return d=f,EM(d).then(function(h){try{return s=h,function(){try{return o()}catch(p){return r(p)}}()}catch(p){return u(p)}},u)}catch(h){return u(h)}},u)}catch(d){u(d)}}catch(d){return r(d)}};try{if(bp()||[Ms.DESKTOP_SAFARI,Ms.MOBILE_SAFARI].includes(jl()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(t).then(function(l){try{return s=l,o()}catch{return a()}},a)}catch{a()}})}function gm(t,e,n,r,s=1){return new Promise(function(i,o){let a;if(e==="image/png"){let f,h,p;return f=t.getContext("2d"),{data:h}=f.getImageData(0,0,t.width,t.height),p=$i.encode([h.buffer],t.width,t.height,4096*s),a=new Blob([p],{type:e}),a.name=n,a.lastModified=r,l.call(this)}{let f=function(){return l.call(this)};var u=f;if(e==="image/bmp")return new Promise(h=>SM.toBlob(t,h)).then((function(h){try{return a=h,a.name=n,a.lastModified=r,f.call(this)}catch(p){return o(p)}}).bind(this),o);{let h=function(){return f.call(this)};var d=h;if(typeof OffscreenCanvas=="function"&&t instanceof OffscreenCanvas)return t.convertToBlob({type:e,quality:s}).then((function(p){try{return a=p,a.name=n,a.lastModified=r,h.call(this)}catch(m){return o(m)}}).bind(this),o);{let p;return p=t.toDataURL(e,s),uv(p,n,r).then((function(m){try{return a=m,h.call(this)}catch(y){return o(y)}}).bind(this),o)}}}function l(){return i(a)}})}function so(t){t.width=0,t.height=0}function Gc(){return new Promise(function(t,e){let n,r,s,i;return Gc.cachedResult!==void 0?t(Gc.cachedResult):uv("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(o){try{return n=o,mm(n).then(function(a){try{return r=a[1],gm(r,n.type,n.name,n.lastModified).then(function(l){try{return s=l,so(r),mm(s).then(function(u){try{return i=u[0],Gc.cachedResult=i.width===1&&i.height===2,t(Gc.cachedResult)}catch(d){return e(d)}},e)}catch(u){return e(u)}},e)}catch(l){return e(l)}},e)}catch(a){return e(a)}},e)})}function IM(t){return new Promise((e,n)=>{const r=new TM;r.onload=s=>{const i=new DataView(s.target.result);if(i.getUint16(0,!1)!=65496)return e(-2);const o=i.byteLength;let a=2;for(;a<o;){if(i.getUint16(a+2,!1)<=8)return e(-1);const l=i.getUint16(a,!1);if(a+=2,l==65505){if(i.getUint32(a+=2,!1)!=1165519206)return e(-1);const u=i.getUint16(a+=6,!1)==18761;a+=i.getUint32(a+4,u);const d=i.getUint16(a,u);a+=2;for(let f=0;f<d;f++)if(i.getUint16(a+12*f,u)==274)return e(i.getUint16(a+12*f+8,u))}else{if((65280&l)!=65280)break;a+=i.getUint16(a,!1)}}return e(-1)},r.onerror=s=>n(s),r.readAsArrayBuffer(t)})}function DM(t,e){const{width:n}=t,{height:r}=t,{maxWidthOrHeight:s}=e;let i,o=t;return isFinite(s)&&(n>s||r>s)&&([o,i]=Pg(n,r),n>r?(o.width=s,o.height=r/n*s):(o.width=n/r*s,o.height=s),i.drawImage(t,0,0,o.width,o.height),so(t)),o}function MM(t,e){const{width:n}=t,{height:r}=t,[s,i]=Pg(n,r);switch(e>4&&e<9?(s.width=r,s.height=n):(s.width=n,s.height=r),e){case 2:i.transform(-1,0,0,1,n,0);break;case 3:i.transform(-1,0,0,-1,n,r);break;case 4:i.transform(1,0,0,-1,0,r);break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,r,0);break;case 7:i.transform(0,-1,-1,0,r,n);break;case 8:i.transform(0,-1,1,0,0,n)}return i.drawImage(t,0,0,n,r),so(t),s}function C_(t,e,n=0){return new Promise(function(r,s){let i,o,a,l,u,d,f,h,p,m,y,x,g,v,w,T,D,k,I,C;function S(N=5){if(e.signal&&e.signal.aborted)throw e.signal.reason;i+=N,e.onProgress(Math.min(i,100))}function _(N){if(e.signal&&e.signal.aborted)throw e.signal.reason;i=Math.min(Math.max(N,i),100),e.onProgress(i)}return i=n,o=e.maxIteration||10,a=1024*e.maxSizeMB*1024,S(),mm(t,e).then((function(N){try{return[,l]=N,S(),u=DM(l,e),S(),new Promise(function(j,O){var P;if(!(P=e.exifOrientation))return IM(t).then((function(R){try{return P=R,W.call(this)}catch(M){return O(M)}}).bind(this),O);function W(){return j(P)}return W.call(this)}).then((function(j){try{return d=j,S(),Gc().then((function(O){try{return f=O?u:MM(u,d),S(),h=e.initialQuality||1,p=e.fileType||t.type,gm(f,p,t.name,t.lastModified,h).then((function(P){try{{let X=function(){if(o--&&(w>a||w>g)){let A,Te;return A=C?.95*I.width:I.width,Te=C?.95*I.height:I.height,[D,k]=Pg(A,Te),k.drawImage(I,0,0,A,Te),h*=p==="image/png"?.85:.95,gm(D,p,t.name,t.lastModified,h).then(function(we){try{return T=we,so(I),I=D,w=T.size,_(Math.min(99,Math.floor((v-w)/(v-a)*100))),X}catch(B){return s(B)}},s)}return[1]},Q=function(){return so(I),so(D),so(u),so(f),so(l),_(100),r(T)};var R=X,M=Q;if(m=P,S(),y=m.size>a,x=m.size>t.size,!y&&!x)return _(100),r(m);var W;return g=t.size,v=m.size,w=v,I=f,C=!e.alwaysKeepResolution&&y,(W=(function(A){for(;A;){if(A.then)return void A.then(W,s);try{if(A.pop){if(A.length)return A.pop()?Q.call(this):A;A=X}else A=A.call(this)}catch(Te){return s(Te)}}}).bind(this))(X)}}catch(X){return s(X)}}).bind(this),s)}catch(P){return s(P)}}).bind(this),s)}catch(O){return s(O)}}).bind(this),s)}catch(j){return s(j)}}).bind(this),s)})}const A9=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let ry;function R9(t,e){return new Promise((n,r)=>{ry||(ry=function(o){const a=[];return typeof o=="function"?a.push(`(${o})()`):a.push(o),URL.createObjectURL(new Blob(a))}(A9));const s=new Worker(ry);s.addEventListener("message",function(o){if(e.signal&&e.signal.aborted)s.terminate();else if(o.data.progress===void 0){if(o.data.error)return r(new Error(o.data.error)),void s.terminate();n(o.data.file),s.terminate()}else e.onProgress(o.data.progress)}),s.addEventListener("error",r),e.signal&&e.signal.addEventListener("abort",()=>{r(e.signal.reason),s.terminate()}),s.postMessage({file:t,imageCompressionLibUrl:e.libURL,options:{...e,onProgress:void 0,signal:void 0}})})}function ls(t,e){return new Promise(function(n,r){let s,i,o,a,l,u;if(s={...e},o=0,{onProgress:a}=s,s.maxSizeMB=s.maxSizeMB||Number.POSITIVE_INFINITY,l=typeof s.useWebWorker!="boolean"||s.useWebWorker,delete s.useWebWorker,s.onProgress=p=>{o=p,typeof a=="function"&&a(o)},!(t instanceof Blob||t instanceof M9))return r(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(t.type))return r(new Error("The file given is not an image"));if(u=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!l||typeof Worker!="function"||u)return C_(t,s).then((function(p){try{return i=p,h.call(this)}catch(m){return r(m)}}).bind(this),r);var d=(function(){try{return h.call(this)}catch(p){return r(p)}}).bind(this),f=function(p){try{return C_(t,s).then(function(m){try{return i=m,d()}catch(y){return r(y)}},r)}catch(m){return r(m)}};try{return s.libURL=s.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",R9(t,s).then(function(p){try{return i=p,d()}catch{return f()}},f)}catch{f()}function h(){try{i.name=t.name,i.lastModified=t.lastModified}catch{}try{s.preserveExif&&t.type==="image/jpeg"&&(!s.fileType||s.fileType&&s.fileType===t.type)&&(i=kM(t,i))}catch{}return n(i)}})}ls.getDataUrlFromFile=CM,ls.getFilefromDataUrl=uv,ls.loadImage=EM,ls.drawImageInCanvas=jM,ls.drawFileInCanvas=mm,ls.canvasToFile=gm,ls.getExifOrientation=IM,ls.handleMaxWidthOrHeight=DM,ls.followExifOrientation=MM,ls.cleanupCanvasMemory=so,ls.isAutoOrientationInBrowser=Gc,ls.approximateBelowMaximumCanvasSizeOfBrowser=NM,ls.copyExifWithoutOrientation=kM,ls.getBrowserName=jl,ls.version="2.0.2";function Yr(t){this.content=t}Yr.prototype={constructor:Yr,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,s=r.find(t),i=r.content.slice();return s==-1?i.push(n||t,e):(i[s+1]=e,n&&(i[s]=n)),new Yr(i)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new Yr(n)},addToStart:function(t,e){return new Yr([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new Yr(n)},addBefore:function(t,e,n){var r=this.remove(e),s=r.content.slice(),i=r.find(t);return s.splice(i==-1?s.length:i,0,e,n),new Yr(s)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=Yr.from(t),t.size?new Yr(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Yr.from(t),t.size?new Yr(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Yr.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};Yr.from=function(t){if(t instanceof Yr)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new Yr(e)};function AM(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let s=t.child(r),i=e.child(r);if(s==i){n+=s.nodeSize;continue}if(!s.sameMarkup(i))return n;if(s.isText&&s.text!=i.text){for(let o=0;s.text[o]==i.text[o];o++)n++;return n}if(s.content.size||i.content.size){let o=AM(s.content,i.content,n+1);if(o!=null)return o}n+=s.nodeSize}}function RM(t,e,n,r){for(let s=t.childCount,i=e.childCount;;){if(s==0||i==0)return s==i?null:{a:n,b:r};let o=t.child(--s),a=e.child(--i),l=o.nodeSize;if(o==a){n-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let u=0,d=Math.min(o.text.length,a.text.length);for(;u<d&&o.text[o.text.length-u-1]==a.text[a.text.length-u-1];)u++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let u=RM(o.content,a.content,n-1,r-1);if(u)return u}n-=l,r-=l}}class _t{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,s=0,i){for(let o=0,a=0;a<n;o++){let l=this.content[o],u=a+l.nodeSize;if(u>e&&r(l,s+a,i||null,o)!==!1&&l.content.size){let d=a+1;l.nodesBetween(Math.max(0,e-d),Math.min(l.content.size,n-d),r,s+d)}a=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,s){let i="",o=!0;return this.nodesBetween(e,n,(a,l)=>{let u=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?s?typeof s=="function"?s(a):s:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&u||a.isTextblock)&&r&&(o?o=!1:i+=r),i+=u},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,s=this.content.slice(),i=0;for(n.isText&&n.sameMarkup(r)&&(s[s.length-1]=n.withText(n.text+r.text),i=1);i<e.content.length;i++)s.push(e.content[i]);return new _t(s,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],s=0;if(n>e)for(let i=0,o=0;o<n;i++){let a=this.content[i],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),r.push(a),s+=a.nodeSize),o=l}return new _t(r,s)}cutByIndex(e,n){return e==n?_t.empty:e==0&&n==this.content.length?this:new _t(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let s=this.content.slice(),i=this.size+n.nodeSize-r.nodeSize;return s[e]=n,new _t(s,i)}addToStart(e){return new _t([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new _t(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let s=this.content[n];e(s,r,n),r+=s.nodeSize}}findDiffStart(e,n=0){return AM(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return RM(this,e,n,r)}findIndex(e){if(e==0)return Mh(0,e);if(e==this.size)return Mh(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let s=this.child(n),i=r+s.nodeSize;if(i>=e)return i==e?Mh(n+1,i):Mh(n,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return _t.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new _t(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return _t.empty;let n,r=0;for(let s=0;s<e.length;s++){let i=e[s];r+=i.nodeSize,s&&i.isText&&e[s-1].sameMarkup(i)?(n||(n=e.slice(0,s)),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new _t(n||e,r)}static from(e){if(!e)return _t.empty;if(e instanceof _t)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new _t([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}_t.empty=new _t([],0);const sy={index:0,offset:0};function Mh(t,e){return sy.index=t,sy.offset=e,sy}function ym(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!ym(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!ym(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let On=class I1{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let s=0;s<e.length;s++){let i=e[s];if(this.eq(i))return e;if(this.type.excludes(i.type))n||(n=e.slice(0,s));else{if(i.type.excludes(this.type))return e;!r&&i.type.rank>this.type.rank&&(n||(n=e.slice(0,s)),n.push(this),r=!0),n&&n.push(i)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&ym(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let s=r.create(n.attrs);return r.checkAttrs(s.attrs),s}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return I1.none;if(e instanceof I1)return[e];let n=e.slice();return n.sort((r,s)=>r.type.rank-s.type.rank),n}};On.none=[];class xm extends Error{}class zt{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=PM(this.content,e+this.openStart,n);return r&&new zt(r,this.openStart,this.openEnd)}removeBetween(e,n){return new zt(OM(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return zt.empty;let r=n.openStart||0,s=n.openEnd||0;if(typeof r!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new zt(_t.fromJSON(e,n.content),r,s)}static maxOpen(e,n=!0){let r=0,s=0;for(let i=e.firstChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.firstChild)r++;for(let i=e.lastChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.lastChild)s++;return new zt(e,r,s)}}zt.empty=new zt(_t.empty,0,0);function OM(t,e,n){let{index:r,offset:s}=t.findIndex(e),i=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(s==e||i.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,i.copy(OM(i.content,e-s-1,n-s-1)))}function PM(t,e,n,r){let{index:s,offset:i}=t.findIndex(e),o=t.maybeChild(s);if(i==e||o.isText)return r&&!r.canReplace(s,s,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=PM(o.content,e-i-1,n,o);return a&&t.replaceChild(s,o.copy(a))}function O9(t,e,n){if(n.openStart>t.depth)throw new xm("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new xm("Inconsistent open depths");return LM(t,e,n,0)}function LM(t,e,n,r){let s=t.index(r),i=t.node(r);if(s==e.index(r)&&r<t.depth-n.openStart){let o=LM(t,e,n,r+1);return i.copy(i.content.replaceChild(s,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,a=o.content;return Fl(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=P9(n,t);return Fl(i,zM(t,o,a,e,r))}else return Fl(i,bm(t,e,r))}function $M(t,e){if(!e.type.compatibleContent(t.type))throw new xm("Cannot join "+e.type.name+" onto "+t.type.name)}function D1(t,e,n){let r=t.node(n);return $M(r,e.node(n)),r}function zl(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Id(t,e,n,r){let s=(e||t).node(n),i=0,o=e?e.index(n):s.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(zl(t.nodeAfter,r),i++));for(let a=i;a<o;a++)zl(s.child(a),r);e&&e.depth==n&&e.textOffset&&zl(e.nodeBefore,r)}function Fl(t,e){return t.type.checkContent(e),t.copy(e)}function zM(t,e,n,r,s){let i=t.depth>s&&D1(t,e,s+1),o=r.depth>s&&D1(n,r,s+1),a=[];return Id(null,t,s,a),i&&o&&e.index(s)==n.index(s)?($M(i,o),zl(Fl(i,zM(t,e,n,r,s+1)),a)):(i&&zl(Fl(i,bm(t,e,s+1)),a),Id(e,n,s,a),o&&zl(Fl(o,bm(n,r,s+1)),a)),Id(r,null,s,a),new _t(a)}function bm(t,e,n){let r=[];if(Id(null,t,n,r),t.depth>n){let s=D1(t,e,n+1);zl(Fl(s,bm(t,e,n+1)),r)}return Id(e,null,n,r),new _t(r)}function P9(t,e){let n=e.depth-t.openStart,s=e.node(n).copy(t.content);for(let i=n-1;i>=0;i--)s=e.node(i).copy(_t.from(s));return{start:s.resolveNoCache(t.openStart+n),end:s.resolveNoCache(s.content.size-t.openEnd-n)}}class Sf{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],s=e.child(n);return r?e.child(n).cut(r):s}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],s=n==0?0:this.path[n*3-1]+1;for(let i=0;i<e;i++)s+=r.child(i).nodeSize;return s}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return On.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),s=e.maybeChild(n);if(!r){let a=r;r=s,s=a}let i=r.marks;for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!s||!i[o].isInSet(s.marks))&&(i=i[o--].removeFromSet(i));return i}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,s=e.parent.maybeChild(e.index());for(var i=0;i<r.length;i++)r[i].type.spec.inclusive===!1&&(!s||!r[i].isInSet(s.marks))&&(r=r[i--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new wm(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],s=0,i=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(i),u=i-l;if(r.push(o,a,s+l),!u||(o=o.child(a),o.isText))break;i=u-1,s+=l+1}return new Sf(n,r,i)}static resolveCached(e,n){let r=E_.get(e);if(r)for(let i=0;i<r.elts.length;i++){let o=r.elts[i];if(o.pos==n)return o}else E_.set(e,r=new L9);let s=r.elts[r.i]=Sf.resolve(e,n);return r.i=(r.i+1)%$9,s}}class L9{constructor(){this.elts=[],this.i=0}}const $9=12,E_=new WeakMap;class wm{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const z9=Object.create(null);let Fo=class M1{constructor(e,n,r,s=On.none){this.type=e,this.attrs=n,this.marks=s,this.content=r||_t.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,s=0){this.content.nodesBetween(e,n,r,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,s){return this.content.textBetween(e,n,r,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&ym(this.attrs,n||e.defaultAttrs||z9)&&On.sameSet(this.marks,r||On.none)}copy(e=null){return e==this.content?this:new M1(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new M1(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return zt.empty;let s=this.resolve(e),i=this.resolve(n),o=r?0:s.sharedDepth(n),a=s.start(o),u=s.node(o).content.cut(s.pos-a,i.pos-a);return new zt(u,s.depth-o,i.depth-o)}replace(e,n,r){return O9(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:s}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(s==e||n.isText)return n;e-=s+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let s=this.content.child(n-1);return{node:s,index:n-1,offset:r-s.nodeSize}}resolve(e){return Sf.resolveCached(this,e)}resolveNoCache(e){return Sf.resolve(this,e)}rangeHasMark(e,n,r){let s=!1;return n>e&&this.nodesBetween(e,n,i=>(r.isInSet(i.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),FM(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=_t.empty,s=0,i=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,s,i),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=s;l<i;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,s){if(s&&!this.type.allowsMarks(s))return!1;let i=this.contentMatchAt(e).matchType(r),o=i&&i.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=On.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!On.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let s=_t.fromJSON(e,n.content),i=e.nodeType(n.type).create(n.attrs,s,r);return i.type.checkAttrs(i.attrs),i}};Fo.prototype.text=void 0;class vm extends Fo{constructor(e,n,r,s){if(super(e,n,null,s),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):FM(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new vm(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new vm(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function FM(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class Yl{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new F9(e,n);if(r.next==null)return Yl.empty;let s=BM(r);r.next&&r.err("Unexpected trailing text");let i=G9(K9(s));return q9(i,r),i}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let s=this;for(let i=n;s&&i<r;i++)s=s.matchType(e.child(i).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let s=[this];function i(o,a){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return _t.from(a.map(u=>u.createAndFill()));for(let u=0;u<o.next.length;u++){let{type:d,next:f}=o.next[u];if(!(d.isText||d.hasRequiredAttrs())&&s.indexOf(f)==-1){s.push(f);let h=i(f,a.concat(d));if(h)return h}}return null}return i(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let s=r.shift(),i=s.match;if(i.matchType(e)){let o=[];for(let a=s;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<i.next.length;o++){let{type:a,next:l}=i.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!s.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:s}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let s=0;s<r.next.length;s++)e.indexOf(r.next[s].next)==-1&&n(r.next[s].next)}return n(this),e.map((r,s)=>{let i=s+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)i+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return i}).join(`
`)}}Yl.empty=new Yl(!0);class F9{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function BM(t){let e=[];do e.push(B9(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function B9(t){let e=[];do e.push(U9(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function U9(t){let e=W9(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=H9(t,e);else break;return e}function N_(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function H9(t,e){let n=N_(t),r=n;return t.eat(",")&&(t.next!="}"?r=N_(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function V9(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let s=[];for(let i in n){let o=n[i];o.isInGroup(e)&&s.push(o)}return s.length==0&&t.err("No node type or group '"+e+"' found"),s}function W9(t){if(t.eat("(")){let e=BM(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=V9(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function K9(t){let e=[[]];return s(i(t,0),n()),e;function n(){return e.push([])-1}function r(o,a,l){let u={term:l,to:a};return e[o].push(u),u}function s(o,a){o.forEach(l=>l.to=a)}function i(o,a){if(o.type=="choice")return o.exprs.reduce((l,u)=>l.concat(i(u,a)),[]);if(o.type=="seq")for(let l=0;;l++){let u=i(o.exprs[l],a);if(l==o.exprs.length-1)return u;s(u,a=n())}else if(o.type=="star"){let l=n();return r(a,l),s(i(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return s(i(o.expr,a),l),s(i(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(i(o.expr,a));if(o.type=="range"){let l=a;for(let u=0;u<o.min;u++){let d=n();s(i(o.expr,l),d),l=d}if(o.max==-1)s(i(o.expr,l),l);else for(let u=o.min;u<o.max;u++){let d=n();r(l,d),s(i(o.expr,l),d),l=d}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function UM(t,e){return e-t}function j_(t,e){let n=[];return r(e),n.sort(UM);function r(s){let i=t[s];if(i.length==1&&!i[0].term)return r(i[0].to);n.push(s);for(let o=0;o<i.length;o++){let{term:a,to:l}=i[o];!a&&n.indexOf(l)==-1&&r(l)}}}function G9(t){let e=Object.create(null);return n(j_(t,0));function n(r){let s=[];r.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let u;for(let d=0;d<s.length;d++)s[d][0]==a&&(u=s[d][1]);j_(t,l).forEach(d=>{u||s.push([a,u=[]]),u.indexOf(d)==-1&&u.push(d)})})});let i=e[r.join(",")]=new Yl(r.indexOf(t.length-1)>-1);for(let o=0;o<s.length;o++){let a=s[o][1].sort(UM);i.next.push({type:s[o][0],next:e[a.join(",")]||n(a)})}return i}}function q9(t,e){for(let n=0,r=[t];n<r.length;n++){let s=r[n],i=!s.validEnd,o=[];for(let a=0;a<s.next.length;a++){let{type:l,next:u}=s.next[a];o.push(l.name),i&&!(l.isText||l.hasRequiredAttrs())&&(i=!1),r.indexOf(u)==-1&&r.push(u)}i&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function HM(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function VM(t,e){let n=Object.create(null);for(let r in t){let s=e&&e[r];if(s===void 0){let i=t[r];if(i.hasDefault)s=i.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=s}return n}function WM(t,e,n,r){for(let s in e)if(!(s in t))throw new RangeError(`Unsupported attribute ${s} for ${n} of type ${s}`);for(let s in t){let i=t[s];i.validate&&i.validate(e[s])}}function KM(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new J9(t,r,e[r]);return n}let I_=class GM{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=KM(e,r.attrs),this.defaultAttrs=HM(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Yl.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:VM(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Fo(this,this.computeAttrs(e),_t.from(n),On.setFrom(r))}createChecked(e=null,n,r){return n=_t.from(n),this.checkContent(n),new Fo(this,this.computeAttrs(e),n,On.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=_t.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let s=this.contentMatch.matchFragment(n),i=s&&s.fillBefore(_t.empty,!0);return i?new Fo(this,e,n.append(i),On.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){WM(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:On.none:e}static compile(e,n){let r=Object.create(null);e.forEach((i,o)=>r[i]=new GM(i,n,o));let s=n.spec.topNode||"doc";if(!r[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function Y9(t,e,n){let r=n.split("|");return s=>{let i=s===null?"null":typeof s;if(r.indexOf(i)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${i}`)}}class J9{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?Y9(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class Lg{constructor(e,n,r,s){this.name=e,this.rank=n,this.schema=r,this.spec=s,this.attrs=KM(e,s.attrs),this.excluded=null;let i=HM(this.attrs);this.instance=i?new On(this,i):null}create(e=null){return!e&&this.instance?this.instance:new On(this,VM(this.attrs,e))}static compile(e,n){let r=Object.create(null),s=0;return e.forEach((i,o)=>r[i]=new Lg(i,s++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){WM(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}let qM=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let s in e)n[s]=e[s];n.nodes=Yr.from(e.nodes),n.marks=Yr.from(e.marks||{}),this.nodes=I_.compile(this.spec.nodes,this),this.marks=Lg.compile(this.spec.marks,this);let r=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let i=this.nodes[s],o=i.spec.content||"",a=i.spec.marks;if(i.contentMatch=r[o]||(r[o]=Yl.parse(o,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=a=="_"?null:a?D_(this,a.split(" ")):a==""||!i.inlineContent?[]:null}for(let s in this.marks){let i=this.marks[s],o=i.spec.excludes;i.excluded=o==null?[i]:o==""?[]:D_(this,o.split(" "))}this.nodeFromJSON=s=>Fo.fromJSON(this,s),this.markFromJSON=s=>On.fromJSON(this,s),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,s){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof I_){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,s)}text(e,n){let r=this.nodes.text;return new vm(r,r.defaultAttrs,e,On.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}};function D_(t,e){let n=[];for(let r=0;r<e.length;r++){let s=e[r],i=t.marks[s],o=i;if(i)n.push(i);else for(let a in t.marks){let l=t.marks[a];(s=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(s)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function X9(t){return t.tag!=null}function Q9(t){return t.style!=null}class Ra{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(s=>{if(X9(s))this.tags.push(s);else if(Q9(s)){let i=/[^=]*/.exec(s.style)[0];r.indexOf(i)<0&&r.push(i),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let i=e.nodes[s.node];return i.contentMatch.matchType(i)})}parse(e,n={}){let r=new A_(this,n,!1);return r.addAll(e,On.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new A_(this,n,!0);return r.addAll(e,On.none,n.from,n.to),zt.maxOpen(r.finish())}matchTag(e,n,r){for(let s=r?this.tags.indexOf(r)+1:0;s<this.tags.length;s++){let i=this.tags[s];if(tH(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||n.matchesContext(i.context))){if(i.getAttrs){let o=i.getAttrs(e);if(o===!1)continue;i.attrs=o||void 0}return i}}}matchStyle(e,n,r,s){for(let i=s?this.styles.indexOf(s)+1:0;i<this.styles.length;i++){let o=this.styles[i],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(s){let i=s.priority==null?50:s.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<i)break}n.splice(o,0,s)}for(let s in e.marks){let i=e.marks[s].spec.parseDOM;i&&i.forEach(o=>{r(o=R_(o)),o.mark||o.ignore||o.clearMark||(o.mark=s)})}for(let s in e.nodes){let i=e.nodes[s].spec.parseDOM;i&&i.forEach(o=>{r(o=R_(o)),o.node||o.ignore||o.mark||(o.node=s)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Ra(e,Ra.schemaRules(e)))}}const YM={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Z9={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},JM={ol:!0,ul:!0},_f=1,A1=2,Dd=4;function M_(t,e,n){return e!=null?(e?_f:0)|(e==="full"?A1:0):t&&t.whitespace=="pre"?_f|A1:n&~Dd}class Ah{constructor(e,n,r,s,i,o){this.type=e,this.attrs=n,this.marks=r,this.solid=s,this.options=o,this.content=[],this.activeMarks=On.none,this.match=i||(o&Dd?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(_t.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,s;return(s=r.findWrapping(e.type))?(this.match=r,s):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&_f)){let r=this.content[this.content.length-1],s;if(r&&r.isText&&(s=/[ \t\r\n\u000c]+$/.exec(r.text))){let i=r;r.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-s[0].length))}}let n=_t.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(_t.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!YM.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class A_{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let s=n.topNode,i,o=M_(null,n.preserveWhitespace,0)|(r?Dd:0);s?i=new Ah(s.type,s.attrs,On.none,!0,n.topMatch||s.type.contentMatch,o):r?i=new Ah(null,null,On.none,!0,null,o):i=new Ah(e.schema.topNodeType,null,On.none,!0,null,o),this.nodes=[i],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,s=this.top,i=s.options&A1?"full":this.localPreserveWS||(s.options&_f)>0,{schema:o}=this.parser;if(i==="full"||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(i)if(i==="full")r=r.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=r.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),n,!0),a[l]&&this.insertNode(o.text(a[l]),n,!/\S/.test(a[l]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let a=s.content[s.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(o.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let s=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;JM.hasOwnProperty(o)&&this.parser.normalizeLists&&eH(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:Z9.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let u,d=this.needsBlock;if(YM.hasOwnProperty(o))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),u=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let f=l&&l.skip?n:this.readStyles(e,n);f&&this.addAll(e,f),u&&this.sync(i),this.needsBlock=d}else{let u=this.readStyles(e,n);u&&this.addElementByRule(e,l,u,l.consuming===!1?a:void 0)}this.localPreserveWS=s}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let i=this.parser.matchedStyles[s],o=r.getPropertyValue(i);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(i,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(u=>!l.clearMark(u)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,s){let i,o;if(n.node)if(o=this.parser.schema.nodes[n.node],o.isLeaf)this.insertNode(o.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,n.attrs||null,r,n.preserveWhitespace);l&&(i=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(s)this.addElement(e,r,s);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}i&&this.sync(a)&&this.open--}addAll(e,n,r,s){let i=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=s==null?null:e.childNodes[s];o!=a;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o,n);this.findAtPoint(e,i)}findPlace(e,n,r){let s,i;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],u=l.findWrapping(e);if(u&&(!s||s.length>u.length+a)&&(s=u,i=l,!u.length))break;if(l.solid){if(r)break;a+=2}}if(!s)return null;this.sync(i);for(let o=0;o<s.length;o++)n=this.enterInner(s[o],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(n=this.enterInner(i,null,n))}let s=this.findPlace(e,n,r);if(s){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let o=On.none;for(let a of s.concat(e.marks))(i.type?i.type.allowsMarkType(a.type):O_(a.type,e.type))&&(o=a.addToSet(o));return i.content.push(e.mark(o)),!0}return!1}enter(e,n,r,s){let i=this.findPlace(e.create(n),r,!1);return i&&(i=this.enterInner(e,n,r,!0,s)),i}enterInner(e,n,r,s=!1,i){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=M_(e,i,o.options);o.options&Dd&&o.content.length==0&&(a|=Dd);let l=On.none;return r=r.filter(u=>(o.type?o.type.allowsMarkType(u.type):O_(u.type,e))?(l=u.addToSet(l),!1):!0),this.nodes.push(new Ah(e,n,l,s,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=_f)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let s=r.length-1;s>=0;s--)e+=r[s].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&e.nodeType==1&&e.contains(this.find[s].node)&&n.compareDocumentPosition(this.find[s].node)&(r?2:4)&&(this.find[s].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,s=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(s?0:1),o=(a,l)=>{for(;a>=0;a--){let u=n[a];if(u==""){if(a==n.length-1||a==0)continue;for(;l>=i;l--)if(o(a-1,l))return!0;return!1}else{let d=l>0||l==0&&s?this.nodes[l].type:r&&l>=i?r.node(l-i).type:null;if(!d||d.name!=u&&!d.isInGroup(u))return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function eH(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&JM.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function tH(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function R_(t){let e={};for(let n in t)e[n]=t[n];return e}function O_(t,e){let n=e.schema.nodes;for(let r in n){let s=n[r];if(!s.allowsMarkType(t))continue;let i=[],o=a=>{i.push(a);for(let l=0;l<a.edgeCount;l++){let{type:u,next:d}=a.edge(l);if(u==e||i.indexOf(d)<0&&o(d))return!0}};if(o(s.contentMatch))return!0}}class rc{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=iy(n).createDocumentFragment());let s=r,i=[];return e.forEach(o=>{if(i.length||o.marks.length){let a=0,l=0;for(;a<i.length&&l<o.marks.length;){let u=o.marks[l];if(!this.marks[u.type.name]){l++;continue}if(!u.eq(i[a][0])||u.type.spec.spanning===!1)break;a++,l++}for(;a<i.length;)s=i.pop()[1];for(;l<o.marks.length;){let u=o.marks[l++],d=this.serializeMark(u,o.isInline,n);d&&(i.push([u,s]),s.appendChild(d.dom),s=d.contentDOM||d.dom)}}s.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:s}=wp(iy(n),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,s)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let s=e.marks.length-1;s>=0;s--){let i=this.serializeMark(e.marks[s],e.isInline,n);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(e,n,r={}){let s=this.marks[e.type.name];return s&&wp(iy(r),s(e,n),null,e.attrs)}static renderSpec(e,n,r=null,s){return wp(e,n,r,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new rc(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=P_(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return P_(e.marks)}}function P_(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function iy(t){return t.document||window.document}const L_=new WeakMap;function nH(t){let e=L_.get(t);return e===void 0&&L_.set(t,e=rH(t)),e}function rH(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let s=0;s<r.length;s++)n(r[s]);else for(let s in r)n(r[s])}return n(t),e}function wp(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let s=e[0],i;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(i=nH(r))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=s.indexOf(" ");o>0&&(n=s.slice(0,o),s=s.slice(o+1));let a,l=n?t.createElementNS(n,s):t.createElement(s),u=e[1],d=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){d=2;for(let f in u)if(u[f]!=null){let h=f.indexOf(" ");h>0?l.setAttributeNS(f.slice(0,h),f.slice(h+1),u[f]):f=="style"&&l.style?l.style.cssText=u[f]:l.setAttribute(f,u[f])}}for(let f=d;f<e.length;f++){let h=e[f];if(h===0){if(f<e.length-1||f>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:p,contentDOM:m}=wp(t,h,n,r);if(l.appendChild(p),m){if(a)throw new RangeError("Multiple content holes");a=m}}}return{dom:l,contentDOM:a}}const XM=65535,QM=Math.pow(2,16);function sH(t,e){return t+e*QM}function $_(t){return t&XM}function iH(t){return(t-(t&XM))/QM}const ZM=1,eA=2,vp=4,tA=8;class R1{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&tA)>0}get deletedBefore(){return(this.delInfo&(ZM|vp))>0}get deletedAfter(){return(this.delInfo&(eA|vp))>0}get deletedAcross(){return(this.delInfo&vp)>0}}class Ys{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&Ys.empty)return Ys.empty}recover(e){let n=0,r=$_(e);if(!this.inverted)for(let s=0;s<r;s++)n+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[r*3]+n+iH(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let s=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?s:0);if(l>e)break;let u=this.ranges[a+i],d=this.ranges[a+o],f=l+u;if(e<=f){let h=u?e==l?-1:e==f?1:n:n,p=l+s+(h<0?0:d);if(r)return p;let m=e==(n<0?l:f)?null:sH(a/3,e-l),y=e==l?eA:e==f?ZM:vp;return(n<0?e!=l:e!=f)&&(y|=tA),new R1(p,y,m)}s+=d-u}return r?e+s:new R1(e+s,0,null)}touches(e,n){let r=0,s=$_(n),i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let u=this.ranges[a+i],d=l+u;if(e<=d&&a==s*3)return!0;r+=this.ranges[a+o]-u}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let s=0,i=0;s<this.ranges.length;s+=3){let o=this.ranges[s],a=o-(this.inverted?i:0),l=o+(this.inverted?0:i),u=this.ranges[s+n],d=this.ranges[s+r];e(a,a+u,l,l+d),i+=d-u}}invert(){return new Ys(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Ys.empty:new Ys(e<0?[0,-e,0]:[0,0,e])}}Ys.empty=new Ys([]);class Tf{constructor(e,n,r=0,s=e?e.length:0){this.mirror=n,this.from=r,this.to=s,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new Tf(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let s=e.getMirror(n);this.appendMap(e._maps[n],s!=null&&s<n?r+s:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let s=e.getMirror(n);this.appendMap(e._maps[n].invert(),s!=null&&s>n?r-s-1:void 0)}}invert(){let e=new Tf;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let s=0;for(let i=this.from;i<this.to;i++){let o=this._maps[i],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(i);if(l!=null&&l>i&&l<this.to){i=l,e=this._maps[l].recover(a.recover);continue}}s|=a.delInfo,e=a.pos}return r?e:new R1(e,s,null)}}const oy=Object.create(null);class ms{getMap(){return Ys.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=oy[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in oy)throw new RangeError("Duplicate use of step JSON ID "+e);return oy[e]=n,n.prototype.jsonID=e,n}}class Tr{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new Tr(e,null)}static fail(e){return new Tr(null,e)}static fromReplace(e,n,r,s){try{return Tr.ok(e.replace(n,r,s))}catch(i){if(i instanceof xm)return Tr.fail(i.message);throw i}}}function dv(t,e,n){let r=[];for(let s=0;s<t.childCount;s++){let i=t.child(s);i.content.size&&(i=i.copy(dv(i.content,e,i))),i.isInline&&(i=e(i,n,s)),r.push(i)}return _t.fromArray(r)}class ka extends ms{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),s=r.node(r.sharedDepth(this.to)),i=new zt(dv(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),s),n.openStart,n.openEnd);return Tr.fromReplace(e,this.from,this.to,i)}invert(){return new uo(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new ka(n.pos,r.pos,this.mark)}merge(e){return e instanceof ka&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new ka(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new ka(n.from,n.to,e.markFromJSON(n.mark))}}ms.jsonID("addMark",ka);class uo extends ms{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new zt(dv(n.content,s=>s.mark(this.mark.removeFromSet(s.marks)),e),n.openStart,n.openEnd);return Tr.fromReplace(e,this.from,this.to,r)}invert(){return new ka(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new uo(n.pos,r.pos,this.mark)}merge(e){return e instanceof uo&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new uo(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new uo(n.from,n.to,e.markFromJSON(n.mark))}}ms.jsonID("removeMark",uo);class Sa extends ms{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return Tr.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return Tr.fromReplace(e,this.pos,this.pos+1,new zt(_t.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let s=0;s<n.marks.length;s++)if(!n.marks[s].isInSet(r))return new Sa(this.pos,n.marks[s]);return new Sa(this.pos,this.mark)}}return new Jl(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Sa(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Sa(n.pos,e.markFromJSON(n.mark))}}ms.jsonID("addNodeMark",Sa);class Jl extends ms{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return Tr.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return Tr.fromReplace(e,this.pos,this.pos+1,new zt(_t.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new Sa(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Jl(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Jl(n.pos,e.markFromJSON(n.mark))}}ms.jsonID("removeNodeMark",Jl);class $r extends ms{constructor(e,n,r,s=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=s}apply(e){return this.structure&&O1(e,this.from,this.to)?Tr.fail("Structure replace would overwrite content"):Tr.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Ys([this.from,this.to-this.from,this.slice.size])}invert(e){return new $r(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new $r(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof $r)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?zt.empty:new zt(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new $r(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?zt.empty:new zt(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new $r(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new $r(n.from,n.to,zt.fromJSON(e,n.slice),!!n.structure)}}ms.jsonID("replace",$r);class Br extends ms{constructor(e,n,r,s,i,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=s,this.slice=i,this.insert=o,this.structure=a}apply(e){if(this.structure&&(O1(e,this.from,this.gapFrom)||O1(e,this.gapTo,this.to)))return Tr.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return Tr.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?Tr.fromReplace(e,this.from,this.to,r):Tr.fail("Content does not fit in gap")}getMap(){return new Ys([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new Br(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),s=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||s<n.pos||i>r.pos?null:new Br(n.pos,r.pos,s,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Br(n.from,n.to,n.gapFrom,n.gapTo,zt.fromJSON(e,n.slice),n.insert,!!n.structure)}}ms.jsonID("replaceAround",Br);function O1(t,e,n){let r=t.resolve(e),s=n-e,i=r.depth;for(;s>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,s--;if(s>0){let o=r.node(i).maybeChild(r.indexAfter(i));for(;s>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,s--}}return!1}function oH(t,e,n,r){let s=[],i=[],o,a;t.doc.nodesBetween(e,n,(l,u,d)=>{if(!l.isInline)return;let f=l.marks;if(!r.isInSet(f)&&d.type.allowsMarkType(r.type)){let h=Math.max(u,e),p=Math.min(u+l.nodeSize,n),m=r.addToSet(f);for(let y=0;y<f.length;y++)f[y].isInSet(m)||(o&&o.to==h&&o.mark.eq(f[y])?o.to=p:s.push(o=new uo(h,p,f[y])));a&&a.to==h?a.to=p:i.push(a=new ka(h,p,r))}}),s.forEach(l=>t.step(l)),i.forEach(l=>t.step(l))}function aH(t,e,n,r){let s=[],i=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;i++;let l=null;if(r instanceof Lg){let u=o.marks,d;for(;d=r.isInSet(u);)(l||(l=[])).push(d),u=d.removeFromSet(u)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let u=Math.min(a+o.nodeSize,n);for(let d=0;d<l.length;d++){let f=l[d],h;for(let p=0;p<s.length;p++){let m=s[p];m.step==i-1&&f.eq(s[p].style)&&(h=m)}h?(h.to=u,h.step=i):s.push({style:f,from:Math.max(a,e),to:u,step:i})}}}),s.forEach(o=>t.step(new uo(o.from,o.to,o.style)))}function fv(t,e,n,r=n.contentMatch,s=!0){let i=t.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<i.childCount;l++){let u=i.child(l),d=a+u.nodeSize,f=r.matchType(u.type);if(!f)o.push(new $r(a,d,zt.empty));else{r=f;for(let h=0;h<u.marks.length;h++)n.allowsMarkType(u.marks[h].type)||t.step(new uo(a,d,u.marks[h]));if(s&&u.isText&&n.whitespace!="pre"){let h,p=/\r?\n|\r/g,m;for(;h=p.exec(u.text);)m||(m=new zt(_t.from(n.schema.text(" ",n.allowedMarks(u.marks))),0,0)),o.push(new $r(a+h.index,a+h.index+h[0].length,m))}}a=d}if(!r.validEnd){let l=r.fillBefore(_t.empty,!0);t.replace(a,a,new zt(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function lH(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function Pu(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth,s=0,i=0;;--r){let o=t.$from.node(r),a=t.$from.index(r)+s,l=t.$to.indexAfter(r)-i;if(r<t.depth&&o.canReplace(a,l,n))return r;if(r==0||o.type.spec.isolating||!lH(o,a,l))break;a&&(s=1),l<o.childCount&&(i=1)}return null}function cH(t,e,n){let{$from:r,$to:s,depth:i}=e,o=r.before(i+1),a=s.after(i+1),l=o,u=a,d=_t.empty,f=0;for(let m=i,y=!1;m>n;m--)y||r.index(m)>0?(y=!0,d=_t.from(r.node(m).copy(d)),f++):l--;let h=_t.empty,p=0;for(let m=i,y=!1;m>n;m--)y||s.after(m+1)<s.end(m)?(y=!0,h=_t.from(s.node(m).copy(h)),p++):u++;t.step(new Br(l,u,o,a,new zt(d.append(h),f,p),d.size-f,!0))}function hv(t,e,n=null,r=t){let s=uH(t,e),i=s&&dH(r,e);return i?s.map(z_).concat({type:e,attrs:n}).concat(i.map(z_)):null}function z_(t){return{type:t,attrs:null}}function uH(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.contentMatchAt(r).findWrapping(e);if(!i)return null;let o=i.length?i[0]:e;return n.canReplaceWith(r,s,o)?i:null}function dH(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.child(r),o=e.contentMatch.findWrapping(i.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let u=r;l&&u<s;u++)l=l.matchType(n.child(u).type);return!l||!l.validEnd?null:o}function fH(t,e,n){let r=_t.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let a=n[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=_t.from(n[o].type.create(n[o].attrs,r))}let s=e.start,i=e.end;t.step(new Br(s,i,s,i,new zt(r,0,0),n.length,!0))}function hH(t,e,n,r,s){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{let l=typeof s=="function"?s(o):s;if(o.isTextblock&&!o.hasMarkup(r,l)&&pH(t.doc,t.mapping.slice(i).map(a),r)){let u=null;if(r.schema.linebreakReplacement){let p=r.whitespace=="pre",m=!!r.contentMatch.matchType(r.schema.linebreakReplacement);p&&!m?u=!1:!p&&m&&(u=!0)}u===!1&&rA(t,o,a,i),fv(t,t.mapping.slice(i).map(a,1),r,void 0,u===null);let d=t.mapping.slice(i),f=d.map(a,1),h=d.map(a+o.nodeSize,1);return t.step(new Br(f,h,f+1,h-1,new zt(_t.from(r.create(l,null,o.marks)),0,0),1,!0)),u===!0&&nA(t,o,a,i),!1}})}function nA(t,e,n,r){e.forEach((s,i)=>{if(s.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(s.text);){let l=t.mapping.slice(r).map(n+1+i+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function rA(t,e,n,r){e.forEach((s,i)=>{if(s.type==s.type.schema.linebreakReplacement){let o=t.mapping.slice(r).map(n+1+i);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function pH(t,e,n){let r=t.resolve(e),s=r.index();return r.parent.canReplaceWith(s,s+1,n)}function mH(t,e,n,r,s){let i=t.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let o=n.create(r,null,s||i.marks);if(i.isLeaf)return t.replaceWith(e,e+i.nodeSize,o);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new Br(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new zt(_t.from(o),0,0),1,!0))}function iu(t,e,n=1,r){let s=t.resolve(e),i=s.depth-n,o=r&&r[r.length-1]||s.parent;if(i<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!o.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let u=s.depth-1,d=n-2;u>i;u--,d--){let f=s.node(u),h=s.index(u);if(f.type.spec.isolating)return!1;let p=f.content.cutByIndex(h,f.childCount),m=r&&r[d+1];m&&(p=p.replaceChild(0,m.type.create(m.attrs)));let y=r&&r[d]||f;if(!f.canReplace(h+1,f.childCount)||!y.type.validContent(p))return!1}let a=s.indexAfter(i),l=r&&r[0];return s.node(i).canReplaceWith(a,a,l?l.type:s.node(i+1).type)}function gH(t,e,n=1,r){let s=t.doc.resolve(e),i=_t.empty,o=_t.empty;for(let a=s.depth,l=s.depth-n,u=n-1;a>l;a--,u--){i=_t.from(s.node(a).copy(i));let d=r&&r[u];o=_t.from(d?d.type.create(d.attrs,o):s.node(a).copy(o))}t.step(new $r(e,e,new zt(i.append(o),n,n),!0))}function Xa(t,e){let n=t.resolve(e),r=n.index();return sA(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function yH(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let s=0;s<e.childCount;s++){let i=e.child(s),o=i.type==r?t.type.schema.nodes.text:i.type;if(n=n.matchType(o),!n||!t.type.allowsMarks(i.marks))return!1}return n.validEnd}function sA(t,e){return!!(t&&e&&!t.isLeaf&&yH(t,e))}function $g(t,e,n=-1){let r=t.resolve(e);for(let s=r.depth;;s--){let i,o,a=r.index(s);if(s==r.depth?(i=r.nodeBefore,o=r.nodeAfter):n>0?(i=r.node(s+1),a++,o=r.node(s).maybeChild(a)):(i=r.node(s).maybeChild(a-1),o=r.node(s+1)),i&&!i.isTextblock&&sA(i,o)&&r.node(s).canReplace(a,a+1))return e;if(s==0)break;e=n<0?r.before(s):r.after(s)}}function xH(t,e,n){let r=null,{linebreakReplacement:s}=t.doc.type.schema,i=t.doc.resolve(e-n),o=i.node().type;if(s&&o.inlineContent){let d=o.whitespace=="pre",f=!!o.contentMatch.matchType(s);d&&!f?r=!1:!d&&f&&(r=!0)}let a=t.steps.length;if(r===!1){let d=t.doc.resolve(e+n);rA(t,d.node(),d.before(),a)}o.inlineContent&&fv(t,e+n-1,o,i.node().contentMatchAt(i.index()),r==null);let l=t.mapping.slice(a),u=l.map(e-n);if(t.step(new $r(u,l.map(e+n,-1),zt.empty,!0)),r===!0){let d=t.doc.resolve(u);nA(t,d.node(),d.before(),t.steps.length)}return t}function bH(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let s=r.depth-1;s>=0;s--){let i=r.index(s);if(r.node(s).canReplaceWith(i,i,n))return r.before(s+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(let s=r.depth-1;s>=0;s--){let i=r.indexAfter(s);if(r.node(s).canReplaceWith(i,i,n))return r.after(s+1);if(i<r.node(s).childCount)return null}return null}function iA(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let s=n.content;for(let i=0;i<n.openStart;i++)s=s.firstChild.content;for(let i=1;i<=(n.openStart==0&&n.size?2:1);i++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),u=r.node(o),d=!1;if(i==1)d=u.canReplace(l,l,s);else{let f=u.contentMatchAt(l).findWrapping(s.firstChild.type);d=f&&u.canReplaceWith(l,l,f[0])}if(d)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function zg(t,e,n=e,r=zt.empty){if(e==n&&!r.size)return null;let s=t.resolve(e),i=t.resolve(n);return oA(s,i,r)?new $r(e,n,r):new wH(s,i,r).fit()}function oA(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class wH{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=_t.empty;for(let s=0;s<=e.depth;s++){let i=e.node(s);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=_t.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,s=this.close(e<0?this.$to:r.doc.resolve(e));if(!s)return null;let i=this.placed,o=r.depth,a=s.depth;for(;o&&a&&i.childCount==1;)i=i.firstChild.content,o--,a--;let l=new zt(i,o,a);return e>-1?new Br(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new $r(r.pos,s.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,s=this.unplaced.openEnd;r<e;r++){let i=n.firstChild;if(n.childCount>1&&(s=0),i.type.spec.isolating&&s<=r){e=r;break}n=i.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let s,i=null;r?(i=ay(this.unplaced.content,r-1).firstChild,s=i.content):s=this.unplaced.content;let o=s.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:u}=this.frontier[a],d,f=null;if(n==1&&(o?u.matchType(o.type)||(f=u.fillBefore(_t.from(o),!1)):i&&l.compatibleContent(i.type)))return{sliceDepth:r,frontierDepth:a,parent:i,inject:f};if(n==2&&o&&(d=u.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:i,wrap:d};if(i&&u.matchType(i.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=ay(e,n);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new zt(e,n+1,Math.max(r,s.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=ay(e,n);if(s.childCount<=1&&n>0){let i=e.size-n<=n+s.size;this.unplaced=new zt(dd(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new zt(dd(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:s,wrap:i}){for(;this.depth>n;)this.closeFrontierNode();if(i)for(let y=0;y<i.length;y++)this.openFrontierNode(i[y]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,u=0,d=[],{match:f,type:h}=this.frontier[n];if(s){for(let y=0;y<s.childCount;y++)d.push(s.child(y));f=f.matchFragment(s)}let p=a.size+e-(o.content.size-o.openEnd);for(;u<a.childCount;){let y=a.child(u),x=f.matchType(y.type);if(!x)break;u++,(u>1||l==0||y.content.size)&&(f=x,d.push(aA(y.mark(h.allowedMarks(y.marks)),u==1?l:0,u==a.childCount?p:-1)))}let m=u==a.childCount;m||(p=-1),this.placed=fd(this.placed,n,_t.from(d)),this.frontier[n].match=f,m&&p<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let y=0,x=a;y<p;y++){let g=x.lastChild;this.frontier.push({type:g.type,match:g.contentMatchAt(g.childCount)}),x=g.content}this.unplaced=m?e==0?zt.empty:new zt(dd(o.content,e-1,1),e-1,p<0?o.openEnd:e-1):new zt(dd(o.content,e,u),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!ly(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,s=this.$to.after(r);for(;r>1&&s==this.$to.end(--r);)++s;return s}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:s}=this.frontier[n],i=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=ly(e,n,s,r,i);if(o){for(let a=n-1;a>=0;a--){let{match:l,type:u}=this.frontier[a],d=ly(e,a,u,l,!0);if(!d||d.childCount)continue e}return{depth:n,fit:o,move:i?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=fd(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let s=e.node(r),i=s.type.contentMatch.fillBefore(s.content,!0,e.index(r));this.openFrontierNode(s.type,s.attrs,i)}return e}openFrontierNode(e,n=null,r){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=fd(this.placed,this.depth,_t.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(_t.empty,!0);n.childCount&&(this.placed=fd(this.placed,this.frontier.length,n))}}function dd(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(dd(t.firstChild.content,e-1,n)))}function fd(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(fd(t.lastChild.content,e-1,n)))}function ay(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function aA(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,aA(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(_t.empty,!0)))),t.copy(r)}function ly(t,e,n,r,s){let i=t.node(e),o=s?t.indexAfter(e):t.index(e);if(o==i.childCount&&!n.compatibleContent(i.type))return null;let a=r.fillBefore(i.content,!0,o);return a&&!vH(n,i.content,o)?a:null}function vH(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function kH(t){return t.spec.defining||t.spec.definingForContent}function SH(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let s=t.doc.resolve(e),i=t.doc.resolve(n);if(oA(s,i,r))return t.step(new $r(e,n,r));let o=cA(s,i);o[o.length-1]==0&&o.pop();let a=-(s.depth+1);o.unshift(a);for(let h=s.depth,p=s.pos-1;h>0;h--,p--){let m=s.node(h).type.spec;if(m.defining||m.definingAsContext||m.isolating)break;o.indexOf(h)>-1?a=h:s.before(h)==p&&o.splice(1,0,-h)}let l=o.indexOf(a),u=[],d=r.openStart;for(let h=r.content,p=0;;p++){let m=h.firstChild;if(u.push(m),p==r.openStart)break;h=m.content}for(let h=d-1;h>=0;h--){let p=u[h],m=kH(p.type);if(m&&!p.sameMarkup(s.node(Math.abs(a)-1)))d=h;else if(m||!p.type.isTextblock)break}for(let h=r.openStart;h>=0;h--){let p=(h+d+1)%(r.openStart+1),m=u[p];if(m)for(let y=0;y<o.length;y++){let x=o[(y+l)%o.length],g=!0;x<0&&(g=!1,x=-x);let v=s.node(x-1),w=s.index(x-1);if(v.canReplaceWith(w,w,m.type,m.marks))return t.replace(s.before(x),g?i.after(x):n,new zt(lA(r.content,0,r.openStart,p),p,r.openEnd))}}let f=t.steps.length;for(let h=o.length-1;h>=0&&(t.replace(e,n,r),!(t.steps.length>f));h--){let p=o[h];p<0||(e=s.before(p),n=i.after(p))}}function lA(t,e,n,r,s){if(e<n){let i=t.firstChild;t=t.replaceChild(0,i.copy(lA(i.content,e+1,n,r,i)))}if(e>r){let i=s.contentMatchAt(0),o=i.fillBefore(t).append(t);t=o.append(i.matchFragment(o).fillBefore(_t.empty,!0))}return t}function _H(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let s=bH(t.doc,e,r.type);s!=null&&(e=n=s)}t.replaceRange(e,n,new zt(_t.from(r),0,0))}function TH(t,e,n){let r=t.doc.resolve(e),s=t.doc.resolve(n),i=cA(r,s);for(let o=0;o<i.length;o++){let a=i[o],l=o==i.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),s.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),s.indexAfter(a-1))))return t.delete(r.before(a),s.after(a))}for(let o=1;o<=r.depth&&o<=s.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&s.end(o)-n!=s.depth-o&&r.start(o-1)==s.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),s.index(o-1)))return t.delete(r.before(o),n);t.delete(e,n)}function cA(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let s=r;s>=0;s--){let i=t.start(s);if(i<t.pos-(t.depth-s)||e.end(s)>e.pos+(e.depth-s)||t.node(s).type.spec.isolating||e.node(s).type.spec.isolating)break;(i==e.start(s)||s==t.depth&&s==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&s&&e.start(s-1)==i-1)&&n.push(s)}return n}class ou extends ms{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return Tr.fail("No node at attribute step's position");let r=Object.create(null);for(let i in n.attrs)r[i]=n.attrs[i];r[this.attr]=this.value;let s=n.type.create(r,null,n.marks);return Tr.fromReplace(e,this.pos,this.pos+1,new zt(_t.from(s),0,n.isLeaf?0:1))}getMap(){return Ys.empty}invert(e){return new ou(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new ou(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new ou(n.pos,n.attr,n.value)}}ms.jsonID("attr",ou);class Cf extends ms{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let s in e.attrs)n[s]=e.attrs[s];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return Tr.ok(r)}getMap(){return Ys.empty}invert(e){return new Cf(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Cf(n.attr,n.value)}}ms.jsonID("docAttr",Cf);let wu=class extends Error{};wu=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};wu.prototype=Object.create(Error.prototype);wu.prototype.constructor=wu;wu.prototype.name="TransformError";class uA{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Tf}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new wu(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=zt.empty){let s=zg(this.doc,e,n,r);return s&&this.step(s),this}replaceWith(e,n,r){return this.replace(e,n,new zt(_t.from(r),0,0))}delete(e,n){return this.replace(e,n,zt.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return SH(this,e,n,r),this}replaceRangeWith(e,n,r){return _H(this,e,n,r),this}deleteRange(e,n){return TH(this,e,n),this}lift(e,n){return cH(this,e,n),this}join(e,n=1){return xH(this,e,n),this}wrap(e,n){return fH(this,e,n),this}setBlockType(e,n=e,r,s=null){return hH(this,e,n,r,s),this}setNodeMarkup(e,n,r=null,s){return mH(this,e,n,r,s),this}setNodeAttribute(e,n,r){return this.step(new ou(e,n,r)),this}setDocAttribute(e,n){return this.step(new Cf(e,n)),this}addNodeMark(e,n){return this.step(new Sa(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof On)n.isInSet(r.marks)&&this.step(new Jl(e,n));else{let s=r.marks,i,o=[];for(;i=n.isInSet(s);)o.push(new Jl(e,i)),s=i.removeFromSet(s);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,n=1,r){return gH(this,e,n,r),this}addMark(e,n,r){return oH(this,e,n,r),this}removeMark(e,n,r){return aH(this,e,n,r),this}clearIncompatible(e,n,r){return fv(this,e,n,r),this}}const cy=Object.create(null);class ln{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new CH(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=zt.empty){let r=n.content.lastChild,s=null;for(let a=0;a<n.openEnd;a++)s=r,r=r.lastChild;let i=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:u}=o[a],d=e.mapping.slice(i);e.replaceRange(d.map(l.pos),d.map(u.pos),a?zt.empty:n),a==0&&U_(e,i,(r?r.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){let{$from:o,$to:a}=s[i],l=e.mapping.slice(r),u=l.map(o.pos),d=l.map(a.pos);i?e.deleteRange(u,d):(e.replaceRangeWith(u,d,n),U_(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let s=e.parent.inlineContent?new sn(e):Tc(e.node(0),e.parent,e.pos,e.index(),n,r);if(s)return s;for(let i=e.depth-1;i>=0;i--){let o=n<0?Tc(e.node(0),e.node(i),e.before(i+1),e.index(i),n,r):Tc(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new ki(e.node(0))}static atStart(e){return Tc(e,e,0,0,1)||new ki(e)}static atEnd(e){return Tc(e,e,e.content.size,e.childCount,-1)||new ki(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=cy[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in cy)throw new RangeError("Duplicate use of selection JSON ID "+e);return cy[e]=n,n.prototype.jsonID=e,n}getBookmark(){return sn.between(this.$anchor,this.$head).getBookmark()}}ln.prototype.visible=!0;class CH{constructor(e,n){this.$from=e,this.$to=n}}let F_=!1;function B_(t){!F_&&!t.parent.inlineContent&&(F_=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class sn extends ln{constructor(e,n=e){B_(e),B_(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return ln.near(r);let s=e.resolve(n.map(this.anchor));return new sn(s.parent.inlineContent?s:r,r)}replace(e,n=zt.empty){if(super.replace(e,n),n==zt.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof sn&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Fg(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new sn(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let s=e.resolve(n);return new this(s,r==n?s:e.resolve(r))}static between(e,n,r){let s=e.pos-n.pos;if((!r||s)&&(r=s>=0?1:-1),!n.parent.inlineContent){let i=ln.findFrom(n,r,!0)||ln.findFrom(n,-r,!0);if(i)n=i.$head;else return ln.near(n,r)}return e.parent.inlineContent||(s==0?e=n:(e=(ln.findFrom(e,-r,!0)||ln.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=s<0&&(e=n))),new sn(e,n)}}ln.jsonID("text",sn);class Fg{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Fg(e.map(this.anchor),e.map(this.head))}resolve(e){return sn.between(e.resolve(this.anchor),e.resolve(this.head))}}class Gt extends ln{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:s}=n.mapResult(this.anchor),i=e.resolve(s);return r?ln.near(i):new Gt(i)}content(){return new zt(_t.from(this.node),0,0)}eq(e){return e instanceof Gt&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new pv(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Gt(e.resolve(n.anchor))}static create(e,n){return new Gt(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}Gt.prototype.visible=!1;ln.jsonID("node",Gt);class pv{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new Fg(r,r):new pv(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&Gt.isSelectable(r)?new Gt(n):ln.near(n)}}class ki extends ln{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=zt.empty){if(n==zt.empty){e.delete(0,e.doc.content.size);let r=ln.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new ki(e)}map(e){return new ki(e)}eq(e){return e instanceof ki}getBookmark(){return EH}}ln.jsonID("all",ki);const EH={map(){return this},resolve(t){return new ki(t)}};function Tc(t,e,n,r,s,i=!1){if(e.inlineContent)return sn.create(t,n);for(let o=r-(s>0?0:1);s>0?o<e.childCount:o>=0;o+=s){let a=e.child(o);if(a.isAtom){if(!i&&Gt.isSelectable(a))return Gt.create(t,n-(s<0?a.nodeSize:0))}else{let l=Tc(t,a,n+s,s<0?a.childCount:0,s,i);if(l)return l}n+=a.nodeSize*s}return null}function U_(t,e,n){let r=t.steps.length-1;if(r<e)return;let s=t.steps[r];if(!(s instanceof $r||s instanceof Br))return;let i=t.mapping.maps[r],o;i.forEach((a,l,u,d)=>{o==null&&(o=d)}),t.setSelection(ln.near(t.doc.resolve(o),n))}const H_=1,Rh=2,V_=4;class NH extends uA{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|H_)&~Rh,this.storedMarks=null,this}get selectionSet(){return(this.updated&H_)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Rh,this}ensureMarks(e){return On.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Rh)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~Rh,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||On.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let s=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(s.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),!e)return this.deleteRange(n,r);let i=this.storedMarks;if(!i){let o=this.doc.resolve(n);i=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,s.text(e,i)),!this.selection.empty&&this.selection.to==n+e.length&&this.setSelection(ln.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=V_,this}get scrolledIntoView(){return(this.updated&V_)>0}}function W_(t,e){return!e||!t?t:t.bind(e)}class hd{constructor(e,n,r){this.name=e,this.init=W_(n.init,r),this.apply=W_(n.apply,r)}}const jH=[new hd("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new hd("selection",{init(t,e){return t.selection||ln.atStart(e.doc)},apply(t){return t.selection}}),new hd("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new hd("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class uy{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=jH.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new hd(r.key,r.spec.state,r))})}}class qc{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let s=this.config.plugins[r];if(s.spec.filterTransaction&&!s.spec.filterTransaction.call(s,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),s=null;for(;;){let i=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=s?s[o].n:0,u=s?s[o].state:this,d=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,u,r);if(d&&r.filterTransaction(d,o)){if(d.setMeta("appendedTransaction",e),!s){s=[];for(let f=0;f<this.config.plugins.length;f++)s.push(f<o?{state:r,n:n.length}:{state:this,n:0})}n.push(d),r=r.applyInner(d),i=!0}s&&(s[o]={state:r,n:n.length})}}if(!i)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new qc(this.config),r=this.config.fields;for(let s=0;s<r.length;s++){let i=r[s];n[i.name]=i.apply(e,this[i.name],this,n)}return n}get tr(){return new NH(this)}static create(e){let n=new uy(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new qc(n);for(let s=0;s<n.fields.length;s++)r[n.fields[s].name]=n.fields[s].init(e,r);return r}reconfigure(e){let n=new uy(this.schema,e.plugins),r=n.fields,s=new qc(n);for(let i=0;i<r.length;i++){let o=r[i].name;s[o]=this.hasOwnProperty(o)?this[o]:r[i].init(e,s)}return s}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[r],i=s.spec.state;i&&i.toJSON&&(n[r]=i.toJSON.call(s,this[s.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new uy(e.schema,e.plugins),i=new qc(s);return s.fields.forEach(o=>{if(o.name=="doc")i.doc=Fo.fromJSON(e.schema,n.doc);else if(o.name=="selection")i.selection=ln.fromJSON(i.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(i.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],u=l.spec.state;if(l.key==o.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){i[o.name]=u.fromJSON.call(l,e,n[a],i);return}}i[o.name]=o.init(e,i)}}),i}}function dA(t,e,n){for(let r in t){let s=t[r];s instanceof Function?s=s.bind(e):r=="handleDOMEvents"&&(s=dA(s,e,{})),n[r]=s}return n}class Cr{constructor(e){this.spec=e,this.props={},e.props&&dA(e.props,this,this.props),this.key=e.key?e.key.key:fA("plugin")}getState(e){return e[this.key]}}const dy=Object.create(null);function fA(t){return t in dy?t+"$"+ ++dy[t]:(dy[t]=0,t+"$")}class rs{constructor(e="key"){this.key=fA(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Xr=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},vu=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let P1=null;const Mo=function(t,e,n){let r=P1||(P1=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},IH=function(){P1=null},Xl=function(t,e,n,r){return n&&(K_(t,e,n,r,-1)||K_(t,e,n,r,1))},DH=/^(img|br|input|textarea|hr)$/i;function K_(t,e,n,r,s){for(var i;;){if(t==n&&e==r)return!0;if(e==(s<0?0:mi(t))){let o=t.parentNode;if(!o||o.nodeType!=1||Qf(t)||DH.test(t.nodeName)||t.contentEditable=="false")return!1;e=Xr(t)+(s<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(s<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((i=o.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=s;else return!1;else t=o,e=s<0?mi(t):0}else return!1}}function mi(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function MH(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=mi(t)}else if(t.parentNode&&!Qf(t))e=Xr(t),t=t.parentNode;else return null}}function AH(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!Qf(t))e=Xr(t)+1,t=t.parentNode;else return null}}function RH(t,e,n){for(let r=e==0,s=e==mi(t);r||s;){if(t==n)return!0;let i=Xr(t);if(t=t.parentNode,!t)return!1;r=r&&i==0,s=s&&i==mi(t)}}function Qf(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Bg=function(t){return t.focusNode&&Xl(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function wl(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function OH(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function PH(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(mi(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(mi(r.startContainer),r.startOffset)}}}const yo=typeof navigator<"u"?navigator:null,G_=typeof document<"u"?document:null,Qa=yo&&yo.userAgent||"",L1=/Edge\/(\d+)/.exec(Qa),hA=/MSIE \d/.exec(Qa),$1=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Qa),Fs=!!(hA||$1||L1),Oa=hA?document.documentMode:$1?+$1[1]:L1?+L1[1]:0,Si=!Fs&&/gecko\/(\d+)/i.test(Qa);Si&&+(/Firefox\/(\d+)/.exec(Qa)||[0,0])[1];const z1=!Fs&&/Chrome\/(\d+)/.exec(Qa),zr=!!z1,pA=z1?+z1[1]:0,ps=!Fs&&!!yo&&/Apple Computer/.test(yo.vendor),ku=ps&&(/Mobile\/\w+/.test(Qa)||!!yo&&yo.maxTouchPoints>2),di=ku||(yo?/Mac/.test(yo.platform):!1),mA=yo?/Win/.test(yo.platform):!1,Lo=/Android \d/.test(Qa),Zf=!!G_&&"webkitFontSmoothing"in G_.documentElement.style,LH=Zf?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function $H(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function To(t,e){return typeof t=="number"?t:t[e]}function zH(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function q_(t,e,n){let r=t.someProp("scrollThreshold")||0,s=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument;for(let o=n||t.dom;o;){if(o.nodeType!=1){o=vu(o);continue}let a=o,l=a==i.body,u=l?$H(i):zH(a),d=0,f=0;if(e.top<u.top+To(r,"top")?f=-(u.top-e.top+To(s,"top")):e.bottom>u.bottom-To(r,"bottom")&&(f=e.bottom-e.top>u.bottom-u.top?e.top+To(s,"top")-u.top:e.bottom-u.bottom+To(s,"bottom")),e.left<u.left+To(r,"left")?d=-(u.left-e.left+To(s,"left")):e.right>u.right-To(r,"right")&&(d=e.right-u.right+To(s,"right")),d||f)if(l)i.defaultView.scrollBy(d,f);else{let p=a.scrollLeft,m=a.scrollTop;f&&(a.scrollTop+=f),d&&(a.scrollLeft+=d);let y=a.scrollLeft-p,x=a.scrollTop-m;e={left:e.left-y,top:e.top-x,right:e.right-y,bottom:e.bottom-x}}let h=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(h))break;o=h=="absolute"?o.offsetParent:vu(o)}}function FH(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,s;for(let i=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(i,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,s=l.top;break}}return{refDOM:r,refTop:s,stack:gA(t.dom)}}function gA(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=vu(r));return e}function BH({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;yA(n,r==0?0:r-e)}function yA(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:s,left:i}=t[n];r.scrollTop!=s+e&&(r.scrollTop=s+e),r.scrollLeft!=i&&(r.scrollLeft=i)}}let gc=null;function UH(t){if(t.setActive)return t.setActive();if(gc)return t.focus(gc);let e=gA(t);t.focus(gc==null?{get preventScroll(){return gc={preventScroll:!0},!0}}:void 0),gc||(gc=!1,yA(e,0))}function xA(t,e){let n,r=2e8,s,i=0,o=e.top,a=e.top,l,u;for(let d=t.firstChild,f=0;d;d=d.nextSibling,f++){let h;if(d.nodeType==1)h=d.getClientRects();else if(d.nodeType==3)h=Mo(d).getClientRects();else continue;for(let p=0;p<h.length;p++){let m=h[p];if(m.top<=o&&m.bottom>=a){o=Math.max(m.bottom,o),a=Math.min(m.top,a);let y=m.left>e.left?m.left-e.left:m.right<e.left?e.left-m.right:0;if(y<r){n=d,r=y,s=y&&n.nodeType==3?{left:m.right<e.left?m.right:m.left,top:e.top}:e,d.nodeType==1&&y&&(i=f+(e.left>=(m.left+m.right)/2?1:0));continue}}else m.top>e.top&&!l&&m.left<=e.left&&m.right>=e.left&&(l=d,u={left:Math.max(m.left,Math.min(m.right,e.left)),top:m.top});!n&&(e.left>=m.right&&e.top>=m.top||e.left>=m.left&&e.top>=m.bottom)&&(i=f+1)}}return!n&&l&&(n=l,s=u,r=0),n&&n.nodeType==3?HH(n,s):!n||r&&n.nodeType==1?{node:t,offset:i}:xA(n,s)}function HH(t,e){let n=t.nodeValue.length,r=document.createRange(),s;for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let o=aa(r,1);if(o.top!=o.bottom&&mv(e,o)){s={node:t,offset:i+(e.left>=(o.left+o.right)/2?1:0)};break}}return r.detach(),s||{node:t,offset:0}}function mv(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function VH(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function WH(t,e,n){let{node:r,offset:s}=xA(e,n),i=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();i=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,s,i)}function KH(t,e,n,r){let s=-1;for(let i=e,o=!1;i!=t.dom;){let a=t.docView.nearestDesc(i,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>r.left||l.top>r.top?s=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(s=a.posAfter),o=!0),!a.contentDOM&&s<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;i=a.dom.parentNode}return s>-1?s:t.docView.posFromDOM(e,n,-1)}function bA(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let s=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),i=s;;){let o=t.childNodes[i];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let u=a[l];if(mv(e,u))return bA(o,e,u)}}if((i=(i+1)%r)==s)break}return t}function GH(t,e){let n=t.dom.ownerDocument,r,s=0,i=PH(n,e.left,e.top);i&&({node:r,offset:s}=i);let o=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),a;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let u=t.dom.getBoundingClientRect();if(!mv(e,u)||(o=bA(t.dom,e,u),!o))return null}if(ps)for(let u=o;r&&u;u=vu(u))u.draggable&&(r=void 0);if(o=VH(o,e),r){if(Si&&r.nodeType==1&&(s=Math.min(s,r.childNodes.length),s<r.childNodes.length)){let d=r.childNodes[s],f;d.nodeName=="IMG"&&(f=d.getBoundingClientRect()).right<=e.left&&f.bottom>e.top&&s++}let u;Zf&&s&&r.nodeType==1&&(u=r.childNodes[s-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&s--,r==t.dom&&s==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(s==0||r.nodeType!=1||r.childNodes[s-1].nodeName!="BR")&&(a=KH(t,r,s,e))}a==null&&(a=WH(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function Y_(t){return t.top<t.bottom||t.left<t.right}function aa(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(Y_(r))return r}return Array.prototype.find.call(n,Y_)||t.getBoundingClientRect()}const qH=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function wA(t,e,n){let{node:r,offset:s,atom:i}=t.docView.domFromPos(e,n<0?-1:1),o=Zf||Si;if(r.nodeType==3)if(o&&(qH.test(r.nodeValue)||(n<0?!s:s==r.nodeValue.length))){let l=aa(Mo(r,s,s),n);if(Si&&s&&/\s/.test(r.nodeValue[s-1])&&s<r.nodeValue.length){let u=aa(Mo(r,s-1,s-1),-1);if(u.top==l.top){let d=aa(Mo(r,s,s+1),-1);if(d.top!=l.top)return Qu(d,d.left<u.left)}}return l}else{let l=s,u=s,d=n<0?1:-1;return n<0&&!s?(u++,d=-1):n>=0&&s==r.nodeValue.length?(l--,d=1):n<0?l--:u++,Qu(aa(Mo(r,l,u),d),d<0)}if(!t.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&s&&(n<0||s==mi(r))){let l=r.childNodes[s-1];if(l.nodeType==1)return fy(l.getBoundingClientRect(),!1)}if(i==null&&s<mi(r)){let l=r.childNodes[s];if(l.nodeType==1)return fy(l.getBoundingClientRect(),!0)}return fy(r.getBoundingClientRect(),n>=0)}if(i==null&&s&&(n<0||s==mi(r))){let l=r.childNodes[s-1],u=l.nodeType==3?Mo(l,mi(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(u)return Qu(aa(u,1),!1)}if(i==null&&s<mi(r)){let l=r.childNodes[s];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let u=l?l.nodeType==3?Mo(l,0,o?0:1):l.nodeType==1?l:null:null;if(u)return Qu(aa(u,-1),!0)}return Qu(aa(r.nodeType==3?Mo(r):r,-n),n>=0)}function Qu(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function fy(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function vA(t,e,n){let r=t.state,s=t.root.activeElement;r!=e&&t.updateState(e),s!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),s!=t.dom&&s&&s.focus()}}function YH(t,e,n){let r=e.selection,s=n=="up"?r.$from:r.$to;return vA(t,e,()=>{let{node:i}=t.docView.domFromPos(s.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(i,!0);if(!a)break;if(a.node.isBlock){i=a.contentDOM||a.dom;break}i=a.dom.parentNode}let o=wA(t,s.pos,1);for(let a=i.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=Mo(a,0,a.nodeValue.length).getClientRects();else continue;for(let u=0;u<l.length;u++){let d=l[u];if(d.bottom>d.top+1&&(n=="up"?o.top-d.top>(d.bottom-o.top)*2:d.bottom-o.bottom>(o.bottom-d.top)*2))return!1}}return!0})}const JH=/[\u0590-\u08ac]/;function XH(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let s=r.parentOffset,i=!s,o=s==r.parent.content.size,a=t.domSelection();return a?!JH.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?i:o:vA(t,e,()=>{let{focusNode:l,focusOffset:u,anchorNode:d,anchorOffset:f}=t.domSelectionRange(),h=a.caretBidiLevel;a.modify("move",n,"character");let p=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:m,focusOffset:y}=t.domSelectionRange(),x=m&&!p.contains(m.nodeType==1?m:m.parentNode)||l==m&&u==y;try{a.collapse(d,f),l&&(l!=d||u!=f)&&a.extend&&a.extend(l,u)}catch{}return h!=null&&(a.caretBidiLevel=h),x}):r.pos==r.start()||r.pos==r.end()}let J_=null,X_=null,Q_=!1;function QH(t,e,n){return J_==e&&X_==n?Q_:(J_=e,X_=n,Q_=n=="up"||n=="down"?YH(t,e,n):XH(t,e,n))}const _i=0,Z_=1,Il=2,xo=3;class eh{constructor(e,n,r,s){this.parent=e,this.children=n,this.dom=r,this.contentDOM=s,this.dirty=_i,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let s=this.children[n];if(s==e)return r;r+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let i,o;if(e==this.contentDOM)i=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(o)+o.size:this.posAtStart}else{let i,o;if(e==this.contentDOM)i=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(o):this.posAtEnd}let s;if(e==this.dom&&this.contentDOM)s=n>Xr(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!1;break}if(i.previousSibling)break}if(s==null&&n==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!0;break}if(i.nextSibling)break}}return s??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,s=e;s;s=s.parentNode){let i=this.getDesc(s),o;if(i&&(!n||i.node))if(r&&(o=i.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return i}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let s=e;s;s=s.parentNode){let i=this.getDesc(s);if(i)return i.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let s=this.children[n],i=r+s.size;if(r==e&&i!=r){for(;!s.border&&s.children.length;)for(let o=0;o<s.children.length;o++){let a=s.children[o];if(a.size){s=a;break}}return s}if(e<i)return s.descAt(e-r-s.border);r=i}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,s=0;for(let i=0;r<this.children.length;r++){let o=this.children[r],a=i+o.size;if(a>e||o instanceof SA){s=e-i;break}i=a}if(s)return this.children[r].domFromPos(s-this.children[r].border,n);for(let i;r&&!(i=this.children[r-1]).size&&i instanceof kA&&i.side>=0;r--);if(n<=0){let i,o=!0;for(;i=r?this.children[r-1]:null,!(!i||i.dom.parentNode==this.contentDOM);r--,o=!1);return i&&n&&o&&!i.border&&!i.domAtom?i.domFromPos(i.size,n):{node:this.contentDOM,offset:i?Xr(i.dom)+1:0}}else{let i,o=!0;for(;i=r<this.children.length?this.children[r]:null,!(!i||i.dom.parentNode==this.contentDOM);r++,o=!1);return i&&o&&!i.border&&!i.domAtom?i.domFromPos(0,n):{node:this.contentDOM,offset:i?Xr(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,i=-1;for(let o=r,a=0;;a++){let l=this.children[a],u=o+l.size;if(s==-1&&e<=u){let d=o+l.border;if(e>=d&&n<=u-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,d);e=o;for(let f=a;f>0;f--){let h=this.children[f-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){s=Xr(h.dom)+1;break}e-=h.size}s==-1&&(s=0)}if(s>-1&&(u>n||a==this.children.length-1)){n=u;for(let d=a+1;d<this.children.length;d++){let f=this.children[d];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(-1)){i=Xr(f.dom);break}n+=f.size}i==-1&&(i=this.contentDOM.childNodes.length);break}o=u}return{node:this.contentDOM,from:e,to:n,fromOffset:s,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,s=!1){let i=Math.min(e,n),o=Math.max(e,n);for(let p=0,m=0;p<this.children.length;p++){let y=this.children[p],x=m+y.size;if(i>m&&o<x)return y.setSelection(e-m-y.border,n-m-y.border,r,s);m=x}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),u=r.root.getSelection(),d=r.domSelectionRange(),f=!1;if((Si||ps)&&e==n){let{node:p,offset:m}=a;if(p.nodeType==3){if(f=!!(m&&p.nodeValue[m-1]==`
`),f&&m==p.nodeValue.length)for(let y=p,x;y;y=y.parentNode){if(x=y.nextSibling){x.nodeName=="BR"&&(a=l={node:x.parentNode,offset:Xr(x)+1});break}let g=y.pmViewDesc;if(g&&g.node&&g.node.isBlock)break}}else{let y=p.childNodes[m-1];f=y&&(y.nodeName=="BR"||y.contentEditable=="false")}}if(Si&&d.focusNode&&d.focusNode!=l.node&&d.focusNode.nodeType==1){let p=d.focusNode.childNodes[d.focusOffset];p&&p.contentEditable=="false"&&(s=!0)}if(!(s||f&&ps)&&Xl(a.node,a.offset,d.anchorNode,d.anchorOffset)&&Xl(l.node,l.offset,d.focusNode,d.focusOffset))return;let h=!1;if((u.extend||e==n)&&!(f&&Si)){u.collapse(a.node,a.offset);try{e!=n&&u.extend(l.node,l.offset),h=!0}catch{}}if(!h){if(e>n){let m=a;a=l,l=m}let p=document.createRange();p.setEnd(l.node,l.offset),p.setStart(a.node,a.offset),u.removeAllRanges(),u.addRange(p)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,s=0;s<this.children.length;s++){let i=this.children[s],o=r+i.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let a=r+i.border,l=o-i.border;if(e>=a&&n<=l){this.dirty=e==r||n==o?Il:Z_,e==a&&n==l&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=xo:i.markDirty(e-a,n-a);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?Il:xo}r=o}this.dirty=Il}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?Il:Z_;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class kA extends eh{constructor(e,n,r,s){let i,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!i)return s;if(i.parent)return i.parent.posBeforeChild(i)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,i=this}matchesWidget(e){return this.dirty==_i&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class ZH extends eh{constructor(e,n,r,s){super(e,[],n,null),this.textDOM=r,this.text=s}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class Ql extends eh{constructor(e,n,r,s,i){super(e,[],r,s),this.mark=n,this.spec=i}static create(e,n,r,s){let i=s.nodeViews[n.type.name],o=i&&i(n,s,r);return(!o||!o.dom)&&(o=rc.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new Ql(e,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&xo||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=xo&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=_i){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=_i}}slice(e,n,r){let s=Ql.create(this.parent,this.mark,!0,r),i=this.children,o=this.size;n<o&&(i=B1(i,n,o,r)),e>0&&(i=B1(i,0,e,r));for(let a=0;a<i.length;a++)i[a].parent=s;return s.children=i,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Pa extends eh{constructor(e,n,r,s,i,o,a,l,u){super(e,[],i,o),this.node=n,this.outerDeco=r,this.innerDeco=s,this.nodeDOM=a}static create(e,n,r,s,i,o){let a=i.nodeViews[n.type.name],l,u=a&&a(n,i,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,s),d=u&&u.dom,f=u&&u.contentDOM;if(n.isText){if(!d)d=document.createTextNode(n.text);else if(d.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else d||({dom:d,contentDOM:f}=rc.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!f&&!n.isText&&d.nodeName!="BR"&&(d.hasAttribute("contenteditable")||(d.contentEditable="false"),n.type.spec.draggable&&(d.draggable=!0));let h=d;return d=CA(d,r,n),u?l=new eV(e,n,r,s,d,f||null,h,u,i,o+1):n.isText?new Ug(e,n,r,s,d,h,i):new Pa(e,n,r,s,d,f||null,h,i,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>_t.empty)}return e}matchesNode(e,n,r){return this.dirty==_i&&e.eq(this.node)&&km(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,s=n,i=e.composing?this.localCompositionInfo(e,n):null,o=i&&i.pos>-1?i:null,a=i&&i.pos<0,l=new nV(this,o&&o.node,e);iV(this.node,this.innerDeco,(u,d,f)=>{u.spec.marks?l.syncToMarks(u.spec.marks,r,e):u.type.side>=0&&!f&&l.syncToMarks(d==this.node.childCount?On.none:this.node.child(d).marks,r,e),l.placeWidget(u,e,s)},(u,d,f,h)=>{l.syncToMarks(u.marks,r,e);let p;l.findNodeMatch(u,d,f,h)||a&&e.state.selection.from>s&&e.state.selection.to<s+u.nodeSize&&(p=l.findIndexWithChild(i.node))>-1&&l.updateNodeAt(u,d,f,p,e)||l.updateNextNode(u,d,f,e,h,s)||l.addNode(u,d,f,e,s),s+=u.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==Il)&&(o&&this.protectLocalComposition(e,o),_A(this.contentDOM,this.children,e),ku&&oV(this.dom))}localCompositionInfo(e,n){let{from:r,to:s}=e.state.selection;if(!(e.state.selection instanceof sn)||r<n||s>n+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let o=i.nodeValue,a=aV(this.node.content,o,r-n,s-n);return a<0?null:{node:i,pos:a,text:o}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:s}){if(this.getDesc(n))return;let i=n;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let o=new ZH(this,i,n,s);e.input.compositionNodes.push(o),this.children=B1(this.children,r,r+s.length,e,o)}update(e,n,r,s){return this.dirty==xo||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,s),!0)}updateInner(e,n,r,s){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=_i}updateOuterDeco(e){if(km(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=TA(this.dom,this.nodeDOM,F1(this.outerDeco,this.node,n),F1(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function eT(t,e,n,r,s){CA(r,e,t);let i=new Pa(void 0,t,e,n,r,r,r,s,0);return i.contentDOM&&i.updateChildren(s,0),i}class Ug extends Pa{constructor(e,n,r,s,i,o,a){super(e,n,r,s,i,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,s){return this.dirty==xo||this.dirty!=_i&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=_i||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=_i,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let s=this.node.cut(e,n),i=document.createTextNode(s.text);return new Ug(this.parent,s,this.outerDeco,this.innerDeco,i,i,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=xo)}get domAtom(){return!1}isText(e){return this.node.text==e}}class SA extends eh{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==_i&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class eV extends Pa{constructor(e,n,r,s,i,o,a,l,u,d){super(e,n,r,s,i,o,a,u,d),this.spec=l}update(e,n,r,s){if(this.dirty==xo)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,n,r);return i&&this.updateInner(e,n,r,s),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,s){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function _A(t,e,n){let r=t.firstChild,s=!1;for(let i=0;i<e.length;i++){let o=e[i],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=tT(r),s=!0;r=r.nextSibling}else s=!0,t.insertBefore(a,r);if(o instanceof Ql){let l=r?r.previousSibling:t.lastChild;_A(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=tT(r),s=!0;s&&n.trackWrites==t&&(n.trackWrites=null)}const Md=function(t){t&&(this.nodeName=t)};Md.prototype=Object.create(null);const Dl=[new Md];function F1(t,e,n){if(t.length==0)return Dl;let r=n?Dl[0]:new Md,s=[r];for(let i=0;i<t.length;i++){let o=t[i].type.attrs;if(o){o.nodeName&&s.push(r=new Md(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&s.length==1&&s.push(r=new Md(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return s}function TA(t,e,n,r){if(n==Dl&&r==Dl)return e;let s=e;for(let i=0;i<r.length;i++){let o=r[i],a=n[i];if(i){let l;a&&a.nodeName==o.nodeName&&s!=t&&(l=s.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(s),a=Dl[0]),s=l}tV(s,a||Dl[0],o)}return s}function tV(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],s=n.class?n.class.split(" ").filter(Boolean):[];for(let i=0;i<r.length;i++)s.indexOf(r[i])==-1&&t.classList.remove(r[i]);for(let i=0;i<s.length;i++)r.indexOf(s[i])==-1&&t.classList.add(s[i]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,s;for(;s=r.exec(e.style);)t.style.removeProperty(s[1])}n.style&&(t.style.cssText+=n.style)}}function CA(t,e,n){return TA(t,t,Dl,F1(e,n,t.nodeType!=1))}function km(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function tT(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class nV{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=rV(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let s=0,i=this.stack.length>>1,o=Math.min(i,e.length);for(;s<o&&(s==i-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&e[s].type.spec.spanning!==!1;)s++;for(;s<i;)this.destroyRest(),this.top.dirty=_i,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let u=this.top.children[l];if(u.matchesMark(e[i])&&!this.isLocked(u.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=Ql.create(this.top,e[i],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,i++}}findNodeMatch(e,n,r,s){let i=-1,o;if(s>=this.preMatch.index&&(o=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))i=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let u=this.top.children[a];if(u.matchesNode(e,n,r)&&!this.preMatch.matched.has(u)){i=a;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,n,r,s,i){let o=this.top.children[s];return o.dirty==xo&&o.dom==o.contentDOM&&(o.dirty=Il),o.update(e,n,r,i)?(this.destroyBetween(this.index,s),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let s=this.index;s<this.top.children.length;s++)if(this.top.children[s]==r)return s}return-1}e=n}}updateNextNode(e,n,r,s,i,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof Pa){let u=this.preMatch.matched.get(l);if(u!=null&&u!=i)return!1;let d=l.dom,f,h=this.isLocked(d)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=xo&&km(n,l.outerDeco));if(!h&&l.update(e,n,r,s))return this.destroyBetween(this.index,a),l.dom!=d&&(this.changed=!0),this.index++,!0;if(!h&&(f=this.recreateWrapper(l,e,n,r,s,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=f,f.contentDOM&&(f.dirty=Il,f.updateChildren(s,o+1),f.dirty=_i),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,s,i,o){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!km(r,e.outerDeco)||!s.eq(e.innerDeco))return null;let a=Pa.create(this.top,n,r,s,i,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,n,r,s,i){let o=Pa.create(this.top,e,n,r,s,i);o.contentDOM&&o.updateChildren(s,i+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,n,r){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(s&&s.matchesWidget(e)&&(e==s.widget||!s.widget.type.toDOM.parentNode))this.index++;else{let i=new kA(this.top,e,n,r);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof Ql;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof Ug)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((ps||zr)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let s=new SA(this.top,[],r,null);n!=this.top?n.children.push(s):n.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function rV(t,e){let n=e,r=n.children.length,s=t.childCount,i=new Map,o=[];e:for(;s>0;){let a;for(;;)if(r){let u=n.children[r-1];if(u instanceof Ql)n=u,r=u.children.length;else{a=u,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(s-1))break;--s,i.set(a,s),o.push(a)}}return{index:s,matched:i,matches:o.reverse()}}function sV(t,e){return t.type.side-e.type.side}function iV(t,e,n,r){let s=e.locals(t),i=0;if(s.length==0){for(let u=0;u<t.childCount;u++){let d=t.child(u);r(d,s,e.forChild(i,d),u),i+=d.nodeSize}return}let o=0,a=[],l=null;for(let u=0;;){let d,f;for(;o<s.length&&s[o].to==i;){let x=s[o++];x.widget&&(d?(f||(f=[d])).push(x):d=x)}if(d)if(f){f.sort(sV);for(let x=0;x<f.length;x++)n(f[x],u,!!l)}else n(d,u,!!l);let h,p;if(l)p=-1,h=l,l=null;else if(u<t.childCount)p=u,h=t.child(u++);else break;for(let x=0;x<a.length;x++)a[x].to<=i&&a.splice(x--,1);for(;o<s.length&&s[o].from<=i&&s[o].to>i;)a.push(s[o++]);let m=i+h.nodeSize;if(h.isText){let x=m;o<s.length&&s[o].from<x&&(x=s[o].from);for(let g=0;g<a.length;g++)a[g].to<x&&(x=a[g].to);x<m&&(l=h.cut(x-i),h=h.cut(0,x-i),m=x,p=-1)}else for(;o<s.length&&s[o].to<m;)o++;let y=h.isInline&&!h.isLeaf?a.filter(x=>!x.inline):a.slice();r(h,y,e.forChild(i,h),p),i=m}}function oV(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function aV(t,e,n,r){for(let s=0,i=0;s<t.childCount&&i<=r;){let o=t.child(s++),a=i;if(i+=o.nodeSize,!o.isText)continue;let l=o.text;for(;s<t.childCount;){let u=t.child(s++);if(i+=u.nodeSize,!u.isText)break;l+=u.text}if(i>=n){if(i>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let u=a<r?l.lastIndexOf(e,r-a-1):-1;if(u>=0&&u+e.length+a>=n)return a+u;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function B1(t,e,n,r,s){let i=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],u=a,d=a+=l.size;u>=n||d<=e?i.push(l):(u<e&&i.push(l.slice(0,e-u,r)),s&&(i.push(s),s=void 0),d>n&&i.push(l.slice(n-u,l.size,r)))}return i}function gv(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let s=t.docView.nearestDesc(n.focusNode),i=s&&s.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,u;if(Bg(n)){for(l=o;s&&!s.node;)s=s.parent;let f=s.node;if(s&&f.isAtom&&Gt.isSelectable(f)&&s.parent&&!(f.isInline&&RH(n.focusNode,n.focusOffset,s.dom))){let h=s.posBefore;u=new Gt(o==h?a:r.resolve(h))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let f=o,h=o;for(let p=0;p<n.rangeCount;p++){let m=n.getRangeAt(p);f=Math.min(f,t.docView.posFromDOM(m.startContainer,m.startOffset,1)),h=Math.max(h,t.docView.posFromDOM(m.endContainer,m.endOffset,-1))}if(f<0)return null;[l,o]=h==t.state.selection.anchor?[h,f]:[f,h],a=r.resolve(o)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let d=r.resolve(l);if(!u){let f=e=="pointer"||t.state.selection.head<a.pos&&!i?1:-1;u=yv(t,d,a,f)}return u}function EA(t){return t.editable?t.hasFocus():jA(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Bo(t,e=!1){let n=t.state.selection;if(NA(t,n),!!EA(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&zr){let r=t.domSelectionRange(),s=t.domObserver.currentSelection;if(r.anchorNode&&s.anchorNode&&Xl(r.anchorNode,r.anchorOffset,s.anchorNode,s.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)cV(t);else{let{anchor:r,head:s}=n,i,o;nT&&!(n instanceof sn)&&(n.$from.parent.inlineContent||(i=rT(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=rT(t,n.to))),t.docView.setSelection(r,s,t,e),nT&&(i&&sT(i),o&&sT(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&lV(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const nT=ps||zr&&pA<63;function rT(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),s=r<n.childNodes.length?n.childNodes[r]:null,i=r?n.childNodes[r-1]:null;if(ps&&s&&s.contentEditable=="false")return hy(s);if((!s||s.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(s)return hy(s);if(i)return hy(i)}}function hy(t){return t.contentEditable="true",ps&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function sT(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function lV(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,s=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=s)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!EA(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function cV(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,Xr(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&Fs&&Oa<=11&&(n.disabled=!0,n.disabled=!1)}function NA(t,e){if(e instanceof Gt){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(iT(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else iT(t)}function iT(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function yv(t,e,n,r){return t.someProp("createSelectionBetween",s=>s(t,e,n))||sn.between(e,n,r)}function oT(t){return t.editable&&!t.hasFocus()?!1:jA(t)}function jA(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function uV(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return Xl(e.node,e.offset,n.anchorNode,n.anchorOffset)}function U1(t,e){let{$anchor:n,$head:r}=t.selection,s=e>0?n.max(r):n.min(r),i=s.parent.inlineContent?s.depth?t.doc.resolve(e>0?s.after():s.before()):null:s;return i&&ln.findFrom(i,e)}function da(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function aT(t,e,n){let r=t.state.selection;if(r instanceof sn)if(n.indexOf("s")>-1){let{$head:s}=r,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let o=t.state.doc.resolve(s.pos+i.nodeSize*(e<0?-1:1));return da(t,new sn(r.$anchor,o))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let s=U1(t.state,e);return s&&s instanceof Gt?da(t,s):!1}else if(!(di&&n.indexOf("m")>-1)){let s=r.$head,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter,o;if(!i||i.isText)return!1;let a=e<0?s.pos-i.nodeSize:s.pos;return i.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?Gt.isSelectable(i)?da(t,new Gt(e<0?t.state.doc.resolve(s.pos-i.nodeSize):s)):Zf?da(t,new sn(t.state.doc.resolve(e<0?a:a+i.nodeSize))):!1:!1}}else return!1;else{if(r instanceof Gt&&r.node.isInline)return da(t,new sn(e>0?r.$to:r.$from));{let s=U1(t.state,e);return s?da(t,s):!1}}}function Sm(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Ad(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function yc(t,e){return e<0?dV(t):fV(t)}function dV(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s,i,o=!1;for(Si&&n.nodeType==1&&r<Sm(n)&&Ad(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(Ad(a,-1))s=n,i=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(IA(n))break;{let a=n.previousSibling;for(;a&&Ad(a,-1);)s=n.parentNode,i=Xr(a),a=a.previousSibling;if(a)n=a,r=Sm(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?H1(t,n,r):s&&H1(t,s,i)}function fV(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s=Sm(n),i,o;for(;;)if(r<s){if(n.nodeType!=1)break;let a=n.childNodes[r];if(Ad(a,1))i=n,o=++r;else break}else{if(IA(n))break;{let a=n.nextSibling;for(;a&&Ad(a,1);)i=a.parentNode,o=Xr(a)+1,a=a.nextSibling;if(a)n=a,r=0,s=Sm(n);else{if(n=n.parentNode,n==t.dom)break;r=s=0}}}i&&H1(t,i,o)}function IA(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function hV(t,e){for(;t&&e==t.childNodes.length&&!Qf(t);)e=Xr(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function pV(t,e){for(;t&&!e&&!Qf(t);)e=Xr(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function H1(t,e,n){if(e.nodeType!=3){let i,o;(o=hV(e,n))?(e=o,n=0):(i=pV(e,n))&&(e=i,n=i.nodeValue.length)}let r=t.domSelection();if(!r)return;if(Bg(r)){let i=document.createRange();i.setEnd(e,n),i.setStart(e,n),r.removeAllRanges(),r.addRange(i)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:s}=t;setTimeout(()=>{t.state==s&&Bo(t)},50)}function lT(t,e){let n=t.state.doc.resolve(e);if(!(zr||mA)&&n.parent.inlineContent){let s=t.coordsAtPos(e);if(e>n.start()){let i=t.coordsAtPos(e-1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left<s.left?"ltr":"rtl"}if(e<n.end()){let i=t.coordsAtPos(e+1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left>s.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function cT(t,e,n){let r=t.state.selection;if(r instanceof sn&&!r.empty||n.indexOf("s")>-1||di&&n.indexOf("m")>-1)return!1;let{$from:s,$to:i}=r;if(!s.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=U1(t.state,e);if(o&&o instanceof Gt)return da(t,o)}if(!s.parent.inlineContent){let o=e<0?s:i,a=r instanceof ki?ln.near(o,e):ln.findFrom(o,e);return a?da(t,a):!1}return!1}function uT(t,e){if(!(t.state.selection instanceof sn))return!0;let{$head:n,$anchor:r,empty:s}=t.state.selection;if(!n.sameParent(r))return!0;if(!s)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let o=t.state.tr;return e<0?o.delete(n.pos-i.nodeSize,n.pos):o.delete(n.pos,n.pos+i.nodeSize),t.dispatch(o),!0}return!1}function dT(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function mV(t){if(!ps||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;dT(t,r,"true"),setTimeout(()=>dT(t,r,"false"),20)}return!1}function gV(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function yV(t,e){let n=e.keyCode,r=gV(e);if(n==8||di&&n==72&&r=="c")return uT(t,-1)||yc(t,-1);if(n==46&&!e.shiftKey||di&&n==68&&r=="c")return uT(t,1)||yc(t,1);if(n==13||n==27)return!0;if(n==37||di&&n==66&&r=="c"){let s=n==37?lT(t,t.state.selection.from)=="ltr"?-1:1:-1;return aT(t,s,r)||yc(t,s)}else if(n==39||di&&n==70&&r=="c"){let s=n==39?lT(t,t.state.selection.from)=="ltr"?1:-1:1;return aT(t,s,r)||yc(t,s)}else{if(n==38||di&&n==80&&r=="c")return cT(t,-1,r)||yc(t,-1);if(n==40||di&&n==78&&r=="c")return mV(t)||cT(t,1,r)||yc(t,1);if(r==(di?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function xv(t,e){t.someProp("transformCopied",p=>{e=p(e,t)});let n=[],{content:r,openStart:s,openEnd:i}=e;for(;s>1&&i>1&&r.childCount==1&&r.firstChild.childCount==1;){s--,i--;let p=r.firstChild;n.push(p.type.name,p.attrs!=p.type.defaultAttrs?p.attrs:null),r=p.content}let o=t.someProp("clipboardSerializer")||rc.fromSchema(t.state.schema),a=PA(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let u=l.firstChild,d,f=0;for(;u&&u.nodeType==1&&(d=OA[u.nodeName.toLowerCase()]);){for(let p=d.length-1;p>=0;p--){let m=a.createElement(d[p]);for(;l.firstChild;)m.appendChild(l.firstChild);l.appendChild(m),f++}u=l.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${s} ${i}${f?` -${f}`:""} ${JSON.stringify(n)}`);let h=t.someProp("clipboardTextSerializer",p=>p(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:h,slice:e}}function DA(t,e,n,r,s){let i=s.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=!!e&&(r||i||!n);if(l){if(t.someProp("transformPastedText",h=>{e=h(e,i||r,t)}),i)return a=new zt(_t.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",h=>{a=h(a,t,!0)}),a;let f=t.someProp("clipboardTextParser",h=>h(e,s,r,t));if(f)a=f;else{let h=s.marks(),{schema:p}=t.state,m=rc.fromSchema(p);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(y=>{let x=o.appendChild(document.createElement("p"));y&&x.appendChild(m.serializeNode(p.text(y,h)))})}}else t.someProp("transformPastedHTML",f=>{n=f(n,t)}),o=vV(n),Zf&&kV(o);let u=o&&o.querySelector("[data-pm-slice]"),d=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let f=+d[3];f>0;f--){let h=o.firstChild;for(;h&&h.nodeType!=1;)h=h.nextSibling;if(!h)break;o=h}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||Ra.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||d),context:s,ruleFromNode(h){return h.nodeName=="BR"&&!h.nextSibling&&h.parentNode&&!xV.test(h.parentNode.nodeName)?{ignore:!0}:null}})),d)a=SV(fT(a,+d[1],+d[2]),d[4]);else if(a=zt.maxOpen(bV(a.content,s),!0),a.openStart||a.openEnd){let f=0,h=0;for(let p=a.content.firstChild;f<a.openStart&&!p.type.spec.isolating;f++,p=p.firstChild);for(let p=a.content.lastChild;h<a.openEnd&&!p.type.spec.isolating;h++,p=p.lastChild);a=fT(a,f,h)}return t.someProp("transformPasted",f=>{a=f(a,t,l)}),a}const xV=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function bV(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let s=e.node(n).contentMatchAt(e.index(n)),i,o=[];if(t.forEach(a=>{if(!o)return;let l=s.findWrapping(a.type),u;if(!l)return o=null;if(u=o.length&&i.length&&AA(l,i,a,o[o.length-1],0))o[o.length-1]=u;else{o.length&&(o[o.length-1]=RA(o[o.length-1],i.length));let d=MA(a,l);o.push(d),s=s.matchType(d.type),i=l}}),o)return _t.from(o)}return t}function MA(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,_t.from(t));return t}function AA(t,e,n,r,s){if(s<t.length&&s<e.length&&t[s]==e[s]){let i=AA(t,e,n,r.lastChild,s+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(s==t.length-1?n.type:t[s+1]))return r.copy(r.content.append(_t.from(MA(n,t,s+1))))}}function RA(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,RA(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(_t.empty,!0);return t.copy(n.append(r))}function V1(t,e,n,r,s,i){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(i=0),s<r-1&&(a=V1(a,e,n,r,s+1,i)),s>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,i<=s).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(_t.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function fT(t,e,n){return e<t.openStart&&(t=new zt(V1(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new zt(V1(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const OA={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let hT=null;function PA(){return hT||(hT=document.implementation.createHTMLDocument("title"))}let py=null;function wV(t){let e=window.trustedTypes;return e?(py||(py=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),py.createHTML(t)):t}function vV(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=PA().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),s;if((s=r&&OA[r[1].toLowerCase()])&&(t=s.map(i=>"<"+i+">").join("")+t+s.map(i=>"</"+i+">").reverse().join("")),n.innerHTML=wV(t),s)for(let i=0;i<s.length;i++)n=n.querySelector(s[i])||n;return n}function kV(t){let e=t.querySelectorAll(zr?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==""&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function SV(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:s,openStart:i,openEnd:o}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;s=_t.from(l.create(r[a+1],s)),i++,o++}return new zt(s,i,o)}const Ss={},_s={},_V={touchstart:!0,touchmove:!0};class TV{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function CV(t){for(let e in Ss){let n=Ss[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{NV(t,r)&&!bv(t,r)&&(t.editable||!(r.type in _s))&&n(t,r)},_V[e]?{passive:!0}:void 0)}ps&&t.dom.addEventListener("input",()=>null),W1(t)}function _a(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function EV(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function W1(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>bv(t,r))})}function bv(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function NV(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function jV(t,e){!bv(t,e)&&Ss[e.type]&&(t.editable||!(e.type in _s))&&Ss[e.type](t,e)}_s.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!$A(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(Lo&&zr&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),ku&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",s=>s(t,wl(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||yV(t,n)?n.preventDefault():_a(t,"key")};_s.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};_s.keypress=(t,e)=>{let n=e;if($A(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||di&&n.metaKey)return;if(t.someProp("handleKeyPress",s=>s(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof sn)||!r.$from.sameParent(r.$to)){let s=String.fromCharCode(n.charCode),i=()=>t.state.tr.insertText(s).scrollIntoView();!/[\r\n]/.test(s)&&!t.someProp("handleTextInput",o=>o(t,r.$from.pos,r.$to.pos,s,i))&&t.dispatch(i()),n.preventDefault()}};function Hg(t){return{left:t.clientX,top:t.clientY}}function IV(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function wv(t,e,n,r,s){if(r==-1)return!1;let i=t.state.doc.resolve(r);for(let o=i.depth+1;o>0;o--)if(t.someProp(e,a=>o>i.depth?a(t,n,i.nodeAfter,i.before(o),s,!0):a(t,n,i.node(o),i.before(o),s,!1)))return!0;return!1}function au(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);n=="pointer"&&r.setMeta("pointer",!0),t.dispatch(r)}function DV(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&Gt.isSelectable(r)?(au(t,new Gt(n),"pointer"),!0):!1}function MV(t,e){if(e==-1)return!1;let n=t.state.selection,r,s;n instanceof Gt&&(r=n.node);let i=t.state.doc.resolve(e);for(let o=i.depth+1;o>0;o--){let a=o>i.depth?i.nodeAfter:i.node(o);if(Gt.isSelectable(a)){r&&n.$from.depth>0&&o>=n.$from.depth&&i.before(n.$from.depth+1)==n.$from.pos?s=i.before(n.$from.depth):s=i.before(o);break}}return s!=null?(au(t,Gt.create(t.state.doc,s),"pointer"),!0):!1}function AV(t,e,n,r,s){return wv(t,"handleClickOn",e,n,r)||t.someProp("handleClick",i=>i(t,e,r))||(s?MV(t,n):DV(t,n))}function RV(t,e,n,r){return wv(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",s=>s(t,e,r))}function OV(t,e,n,r){return wv(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",s=>s(t,e,r))||PV(t,n,r)}function PV(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(au(t,sn.create(r,0,r.content.size),"pointer"),!0):!1;let s=r.resolve(e);for(let i=s.depth+1;i>0;i--){let o=i>s.depth?s.nodeAfter:s.node(i),a=s.before(i);if(o.inlineContent)au(t,sn.create(r,a+1,a+1+o.content.size),"pointer");else if(Gt.isSelectable(o))au(t,Gt.create(r,a),"pointer");else continue;return!0}}function vv(t){return _m(t)}const LA=di?"metaKey":"ctrlKey";Ss.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=vv(t),s=Date.now(),i="singleClick";s-t.input.lastClick.time<500&&IV(n,t.input.lastClick)&&!n[LA]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?i="doubleClick":t.input.lastClick.type=="doubleClick"&&(i="tripleClick")),t.input.lastClick={time:s,x:n.clientX,y:n.clientY,type:i,button:n.button};let o=t.posAtCoords(Hg(n));o&&(i=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new LV(t,o,n,!!r)):(i=="doubleClick"?RV:OV)(t,o.pos,o.inside,n)?n.preventDefault():_a(t,"pointer"))};class LV{constructor(e,n,r,s){this.view=e,this.pos=n,this.event=r,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[LA],this.allowDefault=r.shiftKey;let i,o;if(n.inside>-1)i=e.state.doc.nodeAt(n.inside),o=n.inside;else{let d=e.state.doc.resolve(n.pos);i=d.parent,o=d.depth?d.before():0}const a=s?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:u}=e.state;(r.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||u instanceof Gt&&u.from<=o&&u.to>o)&&(this.mightDrag={node:i,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Si&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),_a(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Bo(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(Hg(e))),this.updateAllowDefault(e),this.allowDefault||!n?_a(this.view,"pointer"):AV(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||ps&&this.mightDrag&&!this.mightDrag.node.isAtom||zr&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(au(this.view,ln.near(this.view.state.doc.resolve(n.pos)),"pointer"),e.preventDefault()):_a(this.view,"pointer")}move(e){this.updateAllowDefault(e),_a(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Ss.touchstart=t=>{t.input.lastTouch=Date.now(),vv(t),_a(t,"pointer")};Ss.touchmove=t=>{t.input.lastTouch=Date.now(),_a(t,"pointer")};Ss.contextmenu=t=>vv(t);function $A(t,e){return t.composing?!0:ps&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const $V=Lo?5e3:-1;_s.compositionstart=_s.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof sn&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)||zr&&mA&&zV(t)))t.markCursor=t.state.storedMarks||n.marks(),_m(t,!0),t.markCursor=null;else if(_m(t,!e.selection.empty),Si&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let s=r.focusNode,i=r.focusOffset;s&&s.nodeType==1&&i!=0;){let o=i<0?s.lastChild:s.childNodes[i-1];if(!o)break;if(o.nodeType==3){let a=t.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else s=o,i=-1}}t.input.composing=!0}zA(t,$V)};function zV(t){let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(!e||e.nodeType!=1||n>=e.childNodes.length)return!1;let r=e.childNodes[n];return r.nodeType==1&&r.contentEditable=="false"}_s.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,zA(t,20))};function zA(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>_m(t),e))}function FA(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=BV());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function FV(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=MH(e.focusNode,e.focusOffset),r=AH(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let s=r.pmViewDesc,i=t.domObserver.lastChangedTextNode;if(n==i||r==i)return i;if(!s||!s.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let o=n.pmViewDesc;if(!(!o||!o.isText(n.nodeValue)))return r}}return n||r}function BV(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function _m(t,e=!1){if(!(Lo&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),FA(t),e||t.docView&&t.docView.dirty){let n=gv(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function UV(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),s=document.createRange();s.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(s),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const Ef=Fs&&Oa<15||ku&&LH<604;Ss.copy=_s.cut=(t,e)=>{let n=e,r=t.state.selection,s=n.type=="cut";if(r.empty)return;let i=Ef?null:n.clipboardData,o=r.content(),{dom:a,text:l}=xv(t,o);i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):UV(t,a),s&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function HV(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function VV(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let s=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?Nf(t,r.value,null,s,e):Nf(t,r.textContent,r.innerHTML,s,e)},50)}function Nf(t,e,n,r,s){let i=DA(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,s,i||zt.empty)))return!0;if(!i)return!1;let o=HV(i),a=o?t.state.tr.replaceSelectionWith(o,r):t.state.tr.replaceSelection(i);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function BA(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}_s.paste=(t,e)=>{let n=e;if(t.composing&&!Lo)return;let r=Ef?null:n.clipboardData,s=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&Nf(t,BA(r),r.getData("text/html"),s,n)?n.preventDefault():VV(t,n)};class UA{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const WV=di?"altKey":"ctrlKey";function HA(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[WV]}Ss.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let s=t.state.selection,i=s.empty?null:t.posAtCoords(Hg(n)),o;if(!(i&&i.pos>=s.from&&i.pos<=(s instanceof Gt?s.to-1:s.to))){if(r&&r.mightDrag)o=Gt.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let f=t.docView.nearestDesc(n.target,!0);f&&f.node.type.spec.draggable&&f!=t.docView&&(o=Gt.create(t.state.doc,f.posBefore))}}let a=(o||t.state.selection).content(),{dom:l,text:u,slice:d}=xv(t,a);(!n.dataTransfer.files.length||!zr||pA>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(Ef?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",Ef||n.dataTransfer.setData("text/plain",u),t.dragging=new UA(d,HA(t,n),o)};Ss.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};_s.dragover=_s.dragenter=(t,e)=>e.preventDefault();_s.drop=(t,e)=>{try{KV(t,e,t.dragging)}finally{t.dragging=null}};function KV(t,e,n){if(!e.dataTransfer)return;let r=t.posAtCoords(Hg(e));if(!r)return;let s=t.state.doc.resolve(r.pos),i=n&&n.slice;i?t.someProp("transformPasted",p=>{i=p(i,t,!1)}):i=DA(t,BA(e.dataTransfer),Ef?null:e.dataTransfer.getData("text/html"),!1,s);let o=!!(n&&HA(t,e));if(t.someProp("handleDrop",p=>p(t,e,i||zt.empty,o))){e.preventDefault();return}if(!i)return;e.preventDefault();let a=i?iA(t.state.doc,s.pos,i):s.pos;a==null&&(a=s.pos);let l=t.state.tr;if(o){let{node:p}=n;p?p.replace(l):l.deleteSelection()}let u=l.mapping.map(a),d=i.openStart==0&&i.openEnd==0&&i.content.childCount==1,f=l.doc;if(d?l.replaceRangeWith(u,u,i.content.firstChild):l.replaceRange(u,u,i),l.doc.eq(f))return;let h=l.doc.resolve(u);if(d&&Gt.isSelectable(i.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(i.content.firstChild))l.setSelection(new Gt(h));else{let p=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach((m,y,x,g)=>p=g),l.setSelection(yv(t,h,l.doc.resolve(p)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}Ss.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&Bo(t)},20))};Ss.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Ss.beforeinput=(t,e)=>{if(zr&&Lo&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",i=>i(t,wl(8,"Backspace")))))return;let{$cursor:s}=t.state.selection;s&&s.pos>0&&t.dispatch(t.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let t in _s)Ss[t]=_s[t];function jf(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class Tm{constructor(e,n){this.toDOM=e,this.spec=n||Bl,this.side=this.spec.side||0}map(e,n,r,s){let{pos:i,deleted:o}=e.mapResult(n.from+s,this.side<0?-1:1);return o?null:new Ps(i-r,i-r,this)}valid(){return!0}eq(e){return this==e||e instanceof Tm&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&jf(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class La{constructor(e,n){this.attrs=e,this.spec=n||Bl}map(e,n,r,s){let i=e.map(n.from+s,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+s,this.spec.inclusiveEnd?1:-1)-r;return i>=o?null:new Ps(i,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof La&&jf(this.attrs,e.attrs)&&jf(this.spec,e.spec)}static is(e){return e.type instanceof La}destroy(){}}class kv{constructor(e,n){this.attrs=e,this.spec=n||Bl}map(e,n,r,s){let i=e.mapResult(n.from+s,1);if(i.deleted)return null;let o=e.mapResult(n.to+s,-1);return o.deleted||o.pos<=i.pos?null:new Ps(i.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:s}=e.content.findIndex(n.from),i;return s==n.from&&!(i=e.child(r)).isText&&s+i.nodeSize==n.to}eq(e){return this==e||e instanceof kv&&jf(this.attrs,e.attrs)&&jf(this.spec,e.spec)}destroy(){}}class Ps{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new Ps(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new Ps(e,e,new Tm(n,r))}static inline(e,n,r,s){return new Ps(e,n,new La(r,s))}static node(e,n,r,s){return new Ps(e,n,new kv(r,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof La}get widget(){return this.type instanceof Tm}}const Cc=[],Bl={};class xr{constructor(e,n){this.local=e.length?e:Cc,this.children=n.length?n:Cc}static create(e,n){return n.length?Cm(n,e,0,Bl):cs}find(e,n,r){let s=[];return this.findInner(e??0,n??1e9,s,0,r),s}findInner(e,n,r,s,i){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!i||i(a.spec))&&r.push(a.copy(a.from+s,a.to+s))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,r,s+a,i)}}map(e,n,r){return this==cs||e.maps.length==0?this:this.mapInner(e,n,0,0,r||Bl)}mapInner(e,n,r,s,i){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,s);l&&l.type.valid(n,l)?(o||(o=[])).push(l):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?GV(this.children,o||[],e,n,r,s,i):o?new xr(o.sort(Ul),Cc):cs}add(e,n){return n.length?this==cs?xr.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let s,i=0;e.forEach((a,l)=>{let u=l+r,d;if(d=WA(n,a,u)){for(s||(s=this.children.slice());i<s.length&&s[i]<l;)i+=3;s[i]==l?s[i+2]=s[i+2].addInner(a,d,u+1):s.splice(i,0,l,l+a.nodeSize,Cm(d,a,u+1,Bl)),i+=3}});let o=VA(i?KA(n):n,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new xr(o.length?this.local.concat(o).sort(Ul):this.local,s||this.children)}remove(e){return e.length==0||this==cs?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,s=this.local;for(let i=0;i<r.length;i+=3){let o,a=r[i]+n,l=r[i+1]+n;for(let d=0,f;d<e.length;d++)(f=e[d])&&f.from>a&&f.to<l&&(e[d]=null,(o||(o=[])).push(f));if(!o)continue;r==this.children&&(r=this.children.slice());let u=r[i+2].removeInner(o,a+1);u!=cs?r[i+2]=u:(r.splice(i,3),i-=3)}if(s.length){for(let i=0,o;i<e.length;i++)if(o=e[i])for(let a=0;a<s.length;a++)s[a].eq(o,n)&&(s==this.local&&(s=this.local.slice()),s.splice(a--,1))}return r==this.children&&s==this.local?this:s.length||r.length?new xr(s,r):cs}forChild(e,n){if(this==cs)return this;if(n.isLeaf)return xr.empty;let r,s;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let i=e+1,o=i+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>i&&l.type instanceof La){let u=Math.max(i,l.from)-i,d=Math.min(o,l.to)-i;u<d&&(s||(s=[])).push(l.copy(u,d))}}if(s){let a=new xr(s.sort(Ul),Cc);return r?new xa([a,r]):a}return r||cs}eq(e){if(this==e)return!0;if(!(e instanceof xr)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return Sv(this.localsInner(e))}localsInner(e){if(this==cs)return Cc;if(e.inlineContent||!this.local.some(La.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof La||n.push(this.local[r]);return n}forEachSet(e){e(this)}}xr.empty=new xr([],[]);xr.removeOverlap=Sv;const cs=xr.empty;class xa{constructor(e){this.members=e}map(e,n){const r=this.members.map(s=>s.map(e,n,Bl));return xa.from(r)}forChild(e,n){if(n.isLeaf)return xr.empty;let r=[];for(let s=0;s<this.members.length;s++){let i=this.members[s].forChild(e,n);i!=cs&&(i instanceof xa?r=r.concat(i.members):r.push(i))}return xa.from(r)}eq(e){if(!(e instanceof xa)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let s=0;s<this.members.length;s++){let i=this.members[s].localsInner(e);if(i.length)if(!n)n=i;else{r&&(n=n.slice(),r=!1);for(let o=0;o<i.length;o++)n.push(i[o])}}return n?Sv(r?n:n.sort(Ul)):Cc}static from(e){switch(e.length){case 0:return cs;case 1:return e[0];default:return new xa(e.every(n=>n instanceof xr)?e:e.reduce((n,r)=>n.concat(r instanceof xr?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function GV(t,e,n,r,s,i,o){let a=t.slice();for(let u=0,d=i;u<n.maps.length;u++){let f=0;n.maps[u].forEach((h,p,m,y)=>{let x=y-m-(p-h);for(let g=0;g<a.length;g+=3){let v=a[g+1];if(v<0||h>v+d-f)continue;let w=a[g]+d-f;p>=w?a[g+1]=h<=w?-2:-1:h>=d&&x&&(a[g]+=x,a[g+1]+=x)}f+=x}),d=n.maps[u].map(d,-1)}let l=!1;for(let u=0;u<a.length;u+=3)if(a[u+1]<0){if(a[u+1]==-2){l=!0,a[u+1]=-1;continue}let d=n.map(t[u]+i),f=d-s;if(f<0||f>=r.content.size){l=!0;continue}let h=n.map(t[u+1]+i,-1),p=h-s,{index:m,offset:y}=r.content.findIndex(f),x=r.maybeChild(m);if(x&&y==f&&y+x.nodeSize==p){let g=a[u+2].mapInner(n,x,d+1,t[u]+i+1,o);g!=cs?(a[u]=f,a[u+1]=p,a[u+2]=g):(a[u+1]=-2,l=!0)}else l=!0}if(l){let u=qV(a,t,e,n,s,i,o),d=Cm(u,r,0,o);e=d.local;for(let f=0;f<a.length;f+=3)a[f+1]<0&&(a.splice(f,3),f-=3);for(let f=0,h=0;f<d.children.length;f+=3){let p=d.children[f];for(;h<a.length&&a[h]<p;)h+=3;a.splice(h,0,d.children[f],d.children[f+1],d.children[f+2])}}return new xr(e.sort(Ul),a)}function VA(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let s=t[r];n.push(new Ps(s.from+e,s.to+e,s.type))}return n}function qV(t,e,n,r,s,i,o){function a(l,u){for(let d=0;d<l.local.length;d++){let f=l.local[d].map(r,s,u);f?n.push(f):o.onRemove&&o.onRemove(l.local[d].spec)}for(let d=0;d<l.children.length;d+=3)a(l.children[d+2],l.children[d]+u+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+i+1);return n}function WA(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,s=null;for(let i=0,o;i<t.length;i++)(o=t[i])&&o.from>n&&o.to<r&&((s||(s=[])).push(o),t[i]=null);return s}function KA(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function Cm(t,e,n,r){let s=[],i=!1;e.forEach((a,l)=>{let u=WA(t,a,l+n);if(u){i=!0;let d=Cm(u,a,n+l+1,r);d!=cs&&s.push(l,l+a.nodeSize,d)}});let o=VA(i?KA(t):t,-n).sort(Ul);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||s.length?new xr(o,s):cs}function Ul(t,e){return t.from-e.from||t.to-e.to}function Sv(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let s=n+1;s<e.length;s++){let i=e[s];if(i.from==r.from){i.to!=r.to&&(e==t&&(e=t.slice()),e[s]=i.copy(i.from,r.to),pT(e,s+1,i.copy(r.to,i.to)));continue}else{i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),pT(e,s,r.copy(i.from,r.to)));break}}}return e}function pT(t,e,n){for(;e<t.length&&Ul(n,t[e])>0;)e++;t.splice(e,0,n)}function my(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=cs&&e.push(r)}),t.cursorWrapper&&e.push(xr.create(t.state.doc,[t.cursorWrapper.deco])),xa.from(e)}const YV={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},JV=Fs&&Oa<=11;class XV{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class QV{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new XV,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let s=0;s<r.length;s++)this.queue.push(r[s]);Fs&&Oa<=11&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),JV&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,YV)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(oT(this.view)){if(this.suppressingSelectionUpdates)return Bo(this.view);if(Fs&&Oa<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Xl(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let i=e.focusNode;i;i=vu(i))n.add(i);for(let i=e.anchorNode;i;i=vu(i))if(n.has(i)){r=i;break}let s=r&&this.view.docView.nearestDesc(r);if(s&&s.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&oT(e)&&!this.ignoreSelectionChange(r),i=-1,o=-1,a=!1,l=[];if(e.editable)for(let d=0;d<n.length;d++){let f=this.registerMutation(n[d],l);f&&(i=i<0?f.from:Math.min(f.from,i),o=o<0?f.to:Math.max(f.to,o),f.typeOver&&(a=!0))}if(Si&&l.length){let d=l.filter(f=>f.nodeName=="BR");if(d.length==2){let[f,h]=d;f.parentNode&&f.parentNode.parentNode==h.parentNode?h.remove():f.remove()}else{let{focusNode:f}=this.currentSelection;for(let h of d){let p=h.parentNode;p&&p.nodeName=="LI"&&(!f||t7(e,f)!=p)&&h.remove()}}}else if((zr||ps)&&l.some(d=>d.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let d of l)if(d.nodeName=="BR"&&d.parentNode){let f=d.nextSibling;f&&f.nodeType==1&&f.contentEditable=="false"&&d.parentNode.removeChild(d)}}let u=null;i<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Bg(r)&&(u=gv(e))&&u.eq(ln.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Bo(e),this.currentSelection.set(r),e.scrollToSelection()):(i>-1||s)&&(i>-1&&(e.docView.markDirty(i,o),ZV(e)),this.handleDOMChange(i,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||Bo(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let d=0;d<e.addedNodes.length;d++){let f=e.addedNodes[d];n.push(f),f.nodeType==3&&(this.lastChangedTextNode=f)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let s=e.previousSibling,i=e.nextSibling;if(Fs&&Oa<=11&&e.addedNodes.length)for(let d=0;d<e.addedNodes.length;d++){let{previousSibling:f,nextSibling:h}=e.addedNodes[d];(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(s=f),(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(i=h)}let o=s&&s.parentNode==e.target?Xr(s)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=i&&i.parentNode==e.target?Xr(i):e.target.childNodes.length,u=r.localPosFromDOM(e.target,l,1);return{from:a,to:u}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let mT=new WeakMap,gT=!1;function ZV(t){if(!mT.has(t)&&(mT.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=Si,gT)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),gT=!0}}function yT(t,e){let n=e.startContainer,r=e.startOffset,s=e.endContainer,i=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return Xl(o.node,o.offset,s,i)&&([n,r,s,i]=[s,i,n,r]),{anchorNode:n,anchorOffset:r,focusNode:s,focusOffset:i}}function e7(t,e){if(e.getComposedRanges){let s=e.getComposedRanges(t.root)[0];if(s)return yT(t,s)}let n;function r(s){s.preventDefault(),s.stopImmediatePropagation(),n=s.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?yT(t,n):null}function t7(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function n7(t,e,n){let{node:r,fromOffset:s,toOffset:i,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),u,d=l.anchorNode;if(d&&t.dom.contains(d.nodeType==1?d:d.parentNode)&&(u=[{node:d,offset:l.anchorOffset}],Bg(l)||u.push({node:l.focusNode,offset:l.focusOffset})),zr&&t.input.lastKeyCode===8)for(let x=i;x>s;x--){let g=r.childNodes[x-1],v=g.pmViewDesc;if(g.nodeName=="BR"&&!v){i=x;break}if(!v||v.size)break}let f=t.state.doc,h=t.someProp("domParser")||Ra.fromSchema(t.state.schema),p=f.resolve(o),m=null,y=h.parse(r,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:s,to:i,preserveWhitespace:p.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:r7,context:p});if(u&&u[0].pos!=null){let x=u[0].pos,g=u[1]&&u[1].pos;g==null&&(g=x),m={anchor:x+o,head:g+o}}return{doc:y,sel:m,from:o,to:a}}function r7(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(ps&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||ps&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const s7=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function i7(t,e,n,r,s){let i=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let I=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,C=gv(t,I);if(C&&!t.state.selection.eq(C)){if(zr&&Lo&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",_=>_(t,wl(13,"Enter"))))return;let S=t.state.tr.setSelection(C);I=="pointer"?S.setMeta("pointer",!0):I=="key"&&S.scrollIntoView(),i&&S.setMeta("composition",i),t.dispatch(S)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l=t.state.selection,u=n7(t,e,n),d=t.state.doc,f=d.slice(u.from,u.to),h,p;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(h=t.state.selection.to,p="end"):(h=t.state.selection.from,p="start"),t.input.lastKeyCode=null;let m=l7(f.content,u.doc.content,u.from,h,p);if(m&&t.input.domChangeCount++,(ku&&t.input.lastIOSEnter>Date.now()-225||Lo)&&s.some(I=>I.nodeType==1&&!s7.test(I.nodeName))&&(!m||m.endA>=m.endB)&&t.someProp("handleKeyDown",I=>I(t,wl(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!m)if(r&&l instanceof sn&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))m={start:l.from,endA:l.to,endB:l.to};else{if(u.sel){let I=xT(t,t.state.doc,u.sel);if(I&&!I.eq(t.state.selection)){let C=t.state.tr.setSelection(I);i&&C.setMeta("composition",i),t.dispatch(C)}}return}t.state.selection.from<t.state.selection.to&&m.start==m.endB&&t.state.selection instanceof sn&&(m.start>t.state.selection.from&&m.start<=t.state.selection.from+2&&t.state.selection.from>=u.from?m.start=t.state.selection.from:m.endA<t.state.selection.to&&m.endA>=t.state.selection.to-2&&t.state.selection.to<=u.to&&(m.endB+=t.state.selection.to-m.endA,m.endA=t.state.selection.to)),Fs&&Oa<=11&&m.endB==m.start+1&&m.endA==m.start&&m.start>u.from&&u.doc.textBetween(m.start-u.from-1,m.start-u.from+1)==" "&&(m.start--,m.endA--,m.endB--);let y=u.doc.resolveNoCache(m.start-u.from),x=u.doc.resolveNoCache(m.endB-u.from),g=d.resolve(m.start),v=y.sameParent(x)&&y.parent.inlineContent&&g.end()>=m.endA;if((ku&&t.input.lastIOSEnter>Date.now()-225&&(!v||s.some(I=>I.nodeName=="DIV"||I.nodeName=="P"))||!v&&y.pos<u.doc.content.size&&(!y.sameParent(x)||!y.parent.inlineContent)&&y.pos<x.pos&&!/\S/.test(u.doc.textBetween(y.pos,x.pos,"","")))&&t.someProp("handleKeyDown",I=>I(t,wl(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>m.start&&a7(d,m.start,m.endA,y,x)&&t.someProp("handleKeyDown",I=>I(t,wl(8,"Backspace")))){Lo&&zr&&t.domObserver.suppressSelectionUpdates();return}zr&&m.endB==m.start&&(t.input.lastChromeDelete=Date.now()),Lo&&!v&&y.start()!=x.start()&&x.parentOffset==0&&y.depth==x.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==m.endA&&(m.endB-=2,x=u.doc.resolveNoCache(m.endB-u.from),setTimeout(()=>{t.someProp("handleKeyDown",function(I){return I(t,wl(13,"Enter"))})},20));let w=m.start,T=m.endA,D=I=>{let C=I||t.state.tr.replace(w,T,u.doc.slice(m.start-u.from,m.endB-u.from));if(u.sel){let S=xT(t,C.doc,u.sel);S&&!(zr&&t.composing&&S.empty&&(m.start!=m.endB||t.input.lastChromeDelete<Date.now()-100)&&(S.head==w||S.head==C.mapping.map(T)-1)||Fs&&S.empty&&S.head==w)&&C.setSelection(S)}return i&&C.setMeta("composition",i),C.scrollIntoView()},k;if(v)if(y.pos==x.pos){Fs&&Oa<=11&&y.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>Bo(t),20));let I=D(t.state.tr.delete(w,T)),C=d.resolve(m.start).marksAcross(d.resolve(m.endA));C&&I.ensureMarks(C),t.dispatch(I)}else if(m.endA==m.endB&&(k=o7(y.parent.content.cut(y.parentOffset,x.parentOffset),g.parent.content.cut(g.parentOffset,m.endA-g.start())))){let I=D(t.state.tr);k.type=="add"?I.addMark(w,T,k.mark):I.removeMark(w,T,k.mark),t.dispatch(I)}else if(y.parent.child(y.index()).isText&&y.index()==x.index()-(x.textOffset?0:1)){let I=y.parent.textBetween(y.parentOffset,x.parentOffset),C=()=>D(t.state.tr.insertText(I,w,T));t.someProp("handleTextInput",S=>S(t,w,T,I,C))||t.dispatch(C())}else t.dispatch(D());else t.dispatch(D())}function xT(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:yv(t,e.resolve(n.anchor),e.resolve(n.head))}function o7(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,s=n,i=r,o,a,l;for(let d=0;d<r.length;d++)s=r[d].removeFromSet(s);for(let d=0;d<n.length;d++)i=n[d].removeFromSet(i);if(s.length==1&&i.length==0)a=s[0],o="add",l=d=>d.mark(a.addToSet(d.marks));else if(s.length==0&&i.length==1)a=i[0],o="remove",l=d=>d.mark(a.removeFromSet(d.marks));else return null;let u=[];for(let d=0;d<e.childCount;d++)u.push(l(e.child(d)));if(_t.from(u).eq(t))return{mark:a,type:o}}function a7(t,e,n,r,s){if(n-e<=s.pos-r.pos||gy(r,!0,!1)<s.pos)return!1;let i=t.resolve(e);if(!r.parent.isTextblock){let a=i.nodeAfter;return a!=null&&n==e+a.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=t.resolve(gy(i,!0,!0));return!o.parent.isTextblock||o.pos>n||gy(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function gy(t,e,n){let r=t.depth,s=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,s++,e=!1;if(n){let i=t.node(r).maybeChild(t.indexAfter(r));for(;i&&!i.isLeaf;)i=i.firstChild,s++}return s}function l7(t,e,n,r,s){let i=t.findDiffStart(e,n);if(i==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(s=="end"){let l=Math.max(0,i-Math.min(o,a));r-=o+l-i}if(o<i&&t.size<e.size){let l=r<=i&&r>=o?i-r:0;i-=l,i&&i<e.size&&bT(e.textBetween(i-1,i+1))&&(i+=l?1:-1),a=i+(a-o),o=i}else if(a<i){let l=r<=i&&r>=a?i-r:0;i-=l,i&&i<t.size&&bT(t.textBetween(i-1,i+1))&&(i+=l?1:-1),o=i+(o-a),a=i}return{start:i,endA:o,endB:a}}function bT(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class GA{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new TV,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(_T),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=kT(this),vT(this),this.nodeViews=ST(this),this.docView=eT(this.state.doc,wT(this),my(this),this.dom,this),this.domObserver=new QV(this,(r,s,i,o)=>i7(this,r,s,i,o)),this.domObserver.start(),CV(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&W1(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(_T),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let s=this.state,i=!1,o=!1;e.storedMarks&&this.composing&&(FA(this),o=!0),this.state=e;let a=s.plugins!=e.plugins||this._props.plugins!=n.plugins;if(a||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let p=ST(this);u7(p,this.nodeViews)&&(this.nodeViews=p,i=!0)}(a||n.handleDOMEvents!=this._props.handleDOMEvents)&&W1(this),this.editable=kT(this),vT(this);let l=my(this),u=wT(this),d=s.plugins!=e.plugins&&!s.doc.eq(e.doc)?"reset":e.scrollToSelection>s.scrollToSelection?"to selection":"preserve",f=i||!this.docView.matchesNode(e.doc,u,l);(f||!e.selection.eq(s.selection))&&(o=!0);let h=d=="preserve"&&o&&this.dom.style.overflowAnchor==null&&FH(this);if(o){this.domObserver.stop();let p=f&&(Fs||zr)&&!this.composing&&!s.selection.empty&&!e.selection.empty&&c7(s.selection,e.selection);if(f){let m=zr?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=FV(this)),(i||!this.docView.update(e.doc,u,l,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=eT(e.doc,u,l,this.dom,this)),m&&!this.trackWrites&&(p=!0)}p||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&uV(this))?Bo(this,p):(NA(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),!((r=this.dragging)===null||r===void 0)&&r.node&&!s.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,s),d=="reset"?this.dom.scrollTop=0:d=="to selection"?this.scrollToSelection():h&&BH(h)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof Gt){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&q_(this,n.getBoundingClientRect(),e)}else q_(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,s=-1;if(this.state.doc.nodeAt(r.from)==r.node)s=r.from;else{let i=r.from+(this.state.doc.content.size-n.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==r.node&&(s=i)}this.dragging=new UA(e.slice,e.move,s<0?void 0:Gt.create(this.state.doc,s))}someProp(e,n){let r=this._props&&this._props[e],s;if(r!=null&&(s=n?n(r):r))return s;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(s=n?n(a):a))return s}let i=this.state.plugins;if(i)for(let o=0;o<i.length;o++){let a=i[o].props[e];if(a!=null&&(s=n?n(a):a))return s}}hasFocus(){if(Fs){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&UH(this.dom),Bo(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return GH(this,e)}coordsAtPos(e,n=1){return wA(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let s=this.docView.posFromDOM(e,n,r);if(s==null)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(e,n){return QH(this,n||this.state,e)}pasteHTML(e,n){return Nf(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return Nf(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return xv(this,e)}destroy(){this.docView&&(EV(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],my(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,IH())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return jV(this,e)}domSelectionRange(){let e=this.domSelection();return e?ps&&this.root.nodeType===11&&OH(this.dom.ownerDocument)==this.dom&&e7(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}GA.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function wT(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[Ps.node(0,t.state.doc.content.size,e)]}function vT(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:Ps.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function kT(t){return!t.someProp("editable",e=>e(t.state)===!1)}function c7(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function ST(t){let e=Object.create(null);function n(r){for(let s in r)Object.prototype.hasOwnProperty.call(e,s)||(e[s]=r[s])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function u7(t,e){let n=0,r=0;for(let s in t){if(t[s]!=e[s])return!0;n++}for(let s in e)r++;return n!=r}function _T(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Va={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Em={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},d7=typeof navigator<"u"&&/Mac/.test(navigator.platform),f7=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Qr=0;Qr<10;Qr++)Va[48+Qr]=Va[96+Qr]=String(Qr);for(var Qr=1;Qr<=24;Qr++)Va[Qr+111]="F"+Qr;for(var Qr=65;Qr<=90;Qr++)Va[Qr]=String.fromCharCode(Qr+32),Em[Qr]=String.fromCharCode(Qr);for(var yy in Va)Em.hasOwnProperty(yy)||(Em[yy]=Va[yy]);function h7(t){var e=d7&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||f7&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?Em:Va)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const p7=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),m7=typeof navigator<"u"&&/Win/.test(navigator.platform);function g7(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,s,i,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))p7?o=!0:s=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),s&&(n="Ctrl-"+n),o&&(n="Meta-"+n),i&&(n="Shift-"+n),n}function y7(t){let e=Object.create(null);for(let n in t)e[g7(n)]=t[n];return e}function xy(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function x7(t){return new Cr({props:{handleKeyDown:qA(t)}})}function qA(t){let e=y7(t);return function(n,r){let s=h7(r),i,o=e[xy(s,r)];if(o&&o(n.state,n.dispatch,n))return!0;if(s.length==1&&s!=" "){if(r.shiftKey){let a=e[xy(s,r,!1)];if(a&&a(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(m7&&r.ctrlKey&&r.altKey)&&(i=Va[r.keyCode])&&i!=s){let a=e[xy(i,r)];if(a&&a(n.state,n.dispatch,n))return!0}}return!1}}const b7=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function YA(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const w7=(t,e,n)=>{let r=YA(t,n);if(!r)return!1;let s=_v(r);if(!s){let o=r.blockRange(),a=o&&Pu(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let i=s.nodeBefore;if(ZA(t,s,e,-1))return!0;if(r.parent.content.size==0&&(Su(i,"end")||Gt.isSelectable(i)))for(let o=r.depth;;o--){let a=zg(t.doc,r.before(o),r.after(o),zt.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(Su(i,"end")?ln.findFrom(l.doc.resolve(l.mapping.map(s.pos,-1)),-1):Gt.create(l.doc,s.pos-i.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos-i.nodeSize,s.pos).scrollIntoView()),!0):!1},v7=(t,e,n)=>{let r=YA(t,n);if(!r)return!1;let s=_v(r);return s?JA(t,s,e):!1},k7=(t,e,n)=>{let r=XA(t,n);if(!r)return!1;let s=Tv(r);return s?JA(t,s,e):!1};function JA(t,e,n){let r=e.nodeBefore,s=r,i=e.pos-1;for(;!s.isTextblock;i--){if(s.type.spec.isolating)return!1;let d=s.lastChild;if(!d)return!1;s=d}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let d=a.firstChild;if(!d)return!1;a=d}let u=zg(t.doc,i,l,zt.empty);if(!u||u.from!=i||u instanceof $r&&u.slice.size>=l-i)return!1;if(n){let d=t.tr.step(u);d.setSelection(sn.create(d.doc,i)),n(d.scrollIntoView())}return!0}function Su(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const S7=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;i=_v(r)}let o=i&&i.nodeBefore;return!o||!Gt.isSelectable(o)?!1:(e&&e(t.tr.setSelection(Gt.create(t.doc,i.pos-o.nodeSize)).scrollIntoView()),!0)};function _v(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function XA(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const _7=(t,e,n)=>{let r=XA(t,n);if(!r)return!1;let s=Tv(r);if(!s)return!1;let i=s.nodeAfter;if(ZA(t,s,e,1))return!0;if(r.parent.content.size==0&&(Su(i,"start")||Gt.isSelectable(i))){let o=zg(t.doc,r.before(),r.after(),zt.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(Su(i,"start")?ln.findFrom(a.doc.resolve(a.mapping.map(s.pos)),1):Gt.create(a.doc,a.mapping.map(s.pos))),e(a.scrollIntoView())}return!0}}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos,s.pos+i.nodeSize).scrollIntoView()),!0):!1},T7=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;i=Tv(r)}let o=i&&i.nodeAfter;return!o||!Gt.isSelectable(o)?!1:(e&&e(t.tr.setSelection(Gt.create(t.doc,i.pos)).scrollIntoView()),!0)};function Tv(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const C7=(t,e)=>{let n=t.selection,r=n instanceof Gt,s;if(r){if(n.node.isTextblock||!Xa(t.doc,n.from))return!1;s=n.from}else if(s=$g(t.doc,n.from,-1),s==null)return!1;if(e){let i=t.tr.join(s);r&&i.setSelection(Gt.create(i.doc,s-t.doc.resolve(s).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},E7=(t,e)=>{let n=t.selection,r;if(n instanceof Gt){if(n.node.isTextblock||!Xa(t.doc,n.to))return!1;r=n.to}else if(r=$g(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},N7=(t,e)=>{let{$from:n,$to:r}=t.selection,s=n.blockRange(r),i=s&&Pu(s);return i==null?!1:(e&&e(t.tr.lift(s,i).scrollIntoView()),!0)},j7=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function QA(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const I7=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let s=n.node(-1),i=n.indexAfter(-1),o=QA(s.contentMatchAt(i));if(!o||!s.canReplaceWith(i,i,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(ln.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},D7=(t,e)=>{let n=t.selection,{$from:r,$to:s}=n;if(n instanceof ki||r.parent.inlineContent||s.parent.inlineContent)return!1;let i=QA(s.parent.contentMatchAt(s.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let o=(!r.parentOffset&&s.index()<s.parent.childCount?r:s).pos,a=t.tr.insert(o,i.createAndFill());a.setSelection(sn.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},M7=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let i=n.before();if(iu(t.doc,i))return e&&e(t.tr.split(i).scrollIntoView()),!0}let r=n.blockRange(),s=r&&Pu(r);return s==null?!1:(e&&e(t.tr.lift(r,s).scrollIntoView()),!0)},A7=(t,e)=>{let{$from:n,to:r}=t.selection,s,i=n.sharedDepth(r);return i==0?!1:(s=n.before(i),e&&e(t.tr.setSelection(Gt.create(t.doc,s))),!0)};function R7(t,e,n){let r=e.nodeBefore,s=e.nodeAfter,i=e.index();return!r||!s||!r.type.compatibleContent(s.type)?!1:!r.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(s.isTextblock||Xa(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function ZA(t,e,n,r){let s=e.nodeBefore,i=e.nodeAfter,o,a,l=s.type.spec.isolating||i.type.spec.isolating;if(!l&&R7(t,e,n))return!0;let u=!l&&e.parent.canReplace(e.index(),e.index()+1);if(u&&(o=(a=s.contentMatchAt(s.childCount)).findWrapping(i.type))&&a.matchType(o[0]||i.type).validEnd){if(n){let p=e.pos+i.nodeSize,m=_t.empty;for(let g=o.length-1;g>=0;g--)m=_t.from(o[g].create(null,m));m=_t.from(s.copy(m));let y=t.tr.step(new Br(e.pos-1,p,e.pos,p,new zt(m,1,0),o.length,!0)),x=y.doc.resolve(p+2*o.length);x.nodeAfter&&x.nodeAfter.type==s.type&&Xa(y.doc,x.pos)&&y.join(x.pos),n(y.scrollIntoView())}return!0}let d=i.type.spec.isolating||r>0&&l?null:ln.findFrom(e,1),f=d&&d.$from.blockRange(d.$to),h=f&&Pu(f);if(h!=null&&h>=e.depth)return n&&n(t.tr.lift(f,h).scrollIntoView()),!0;if(u&&Su(i,"start",!0)&&Su(s,"end")){let p=s,m=[];for(;m.push(p),!p.isTextblock;)p=p.lastChild;let y=i,x=1;for(;!y.isTextblock;y=y.firstChild)x++;if(p.canReplace(p.childCount,p.childCount,y.content)){if(n){let g=_t.empty;for(let w=m.length-1;w>=0;w--)g=_t.from(m[w].copy(g));let v=t.tr.step(new Br(e.pos-m.length,e.pos+i.nodeSize,e.pos+x,e.pos+i.nodeSize-x,new zt(g,m.length,0),0,!0));n(v.scrollIntoView())}return!0}}return!1}function e5(t){return function(e,n){let r=e.selection,s=t<0?r.$from:r.$to,i=s.depth;for(;s.node(i).isInline;){if(!i)return!1;i--}return s.node(i).isTextblock?(n&&n(e.tr.setSelection(sn.create(e.doc,t<0?s.start(i):s.end(i)))),!0):!1}}const O7=e5(-1),P7=e5(1);function L7(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,o=s.blockRange(i),a=o&&hv(o,t,e);return a?(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function TT(t,e=null){return function(n,r){let s=!1;for(let i=0;i<n.selection.ranges.length&&!s;i++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[i];n.doc.nodesBetween(o,a,(l,u)=>{if(s)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)s=!0;else{let d=n.doc.resolve(u),f=d.index();s=d.parent.canReplaceWith(f,f+1,t)}})}if(!s)return!1;if(r){let i=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[o];i.setBlockType(a,l,t,e)}r(i.scrollIntoView())}return!0}}typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function $7(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,o=s.blockRange(i);if(!o)return!1;let a=r?n.tr:null;return z7(a,o,t,e)?(r&&r(a.scrollIntoView()),!0):!1}}function z7(t,e,n,r=null){let s=!1,i=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);i=new wm(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new wm(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),s=!0}let a=hv(i,n,r,e);return a?(t&&F7(t,e,a,s,n),!0):!1}function F7(t,e,n,r,s){let i=_t.empty;for(let d=n.length-1;d>=0;d--)i=_t.from(n[d].type.create(n[d].attrs,i));t.step(new Br(e.start-(r?2:0),e.end,e.start,e.end,new zt(i,0,0),n.length,!0));let o=0;for(let d=0;d<n.length;d++)n[d].type==s&&(o=d+1);let a=n.length-o,l=e.start+n.length-(r?2:0),u=e.parent;for(let d=e.startIndex,f=e.endIndex,h=!0;d<f;d++,h=!1)!h&&iu(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=u.child(d).nodeSize;return t}function B7(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,o=>o.childCount>0&&o.firstChild.type==t);return i?n?r.node(i.depth-1).type==t?U7(e,n,t,i):H7(e,n,i):!0:!1}}function U7(t,e,n,r){let s=t.tr,i=r.end,o=r.$to.end(r.depth);i<o&&(s.step(new Br(i-1,o,i,o,new zt(_t.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new wm(s.doc.resolve(r.$from.pos),s.doc.resolve(o),r.depth));const a=Pu(r);if(a==null)return!1;s.lift(r,a);let l=s.doc.resolve(s.mapping.map(i,-1)-1);return Xa(s.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&s.join(l.pos),e(s.scrollIntoView()),!0}function H7(t,e,n){let r=t.tr,s=n.parent;for(let p=n.end,m=n.endIndex-1,y=n.startIndex;m>y;m--)p-=s.child(m).nodeSize,r.delete(p-1,p+1);let i=r.doc.resolve(n.start),o=i.nodeAfter;if(r.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==s.childCount,u=i.node(-1),d=i.index(-1);if(!u.canReplace(d+(a?0:1),d+1,o.content.append(l?_t.empty:_t.from(s))))return!1;let f=i.pos,h=f+o.nodeSize;return r.step(new Br(f-(a?1:0),h+(l?1:0),f+1,h-1,new zt((a?_t.empty:_t.from(s.copy(_t.empty))).append(l?_t.empty:_t.from(s.copy(_t.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function V7(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,u=>u.childCount>0&&u.firstChild.type==t);if(!i)return!1;let o=i.startIndex;if(o==0)return!1;let a=i.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let u=l.lastChild&&l.lastChild.type==a.type,d=_t.from(u?t.create():null),f=new zt(_t.from(t.create(null,_t.from(a.type.create(null,d)))),u?3:1,0),h=i.start,p=i.end;n(e.tr.step(new Br(h-(u?3:1),p,h,p,f,1,!0)).scrollIntoView())}return!0}}function Vg(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:s}=n,{storedMarks:i}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return r},get doc(){return s},get tr(){return r=n.selection,s=n.doc,i=n.storedMarks,n}}}class Wg{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:r}=this,{view:s}=n,{tr:i}=r,o=this.buildProps(i);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...d)=>{const f=l(...d)(o);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(i),f}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,a=[],l=!!e,u=e||i.tr,d=()=>(!l&&n&&!u.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(u),a.every(h=>h===!0)),f={...Object.fromEntries(Object.entries(r).map(([h,p])=>[h,(...y)=>{const x=this.buildProps(u,n),g=p(...y)(x);return a.push(g),f}])),run:d};return f}createCan(e){const{rawCommands:n,state:r}=this,s=!1,i=e||r.tr,o=this.buildProps(i,s);return{...Object.fromEntries(Object.entries(n).map(([l,u])=>[l,(...d)=>u(...d)({...o,dispatch:void 0})])),chain:()=>this.createChain(i,s)}}buildProps(e,n=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,a={tr:e,editor:s,view:o,state:Vg({state:i,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e,n),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([l,u])=>[l,(...d)=>u(...d)(a)]))}};return a}}class W7{constructor(){this.callbacks={}}on(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),this}emit(e,...n){const r=this.callbacks[e];return r&&r.forEach(s=>s.apply(this,n)),this}off(e,n){const r=this.callbacks[e];return r&&(n?this.callbacks[e]=r.filter(s=>s!==n):delete this.callbacks[e]),this}once(e,n){const r=(...s)=>{this.off(e,r),n.apply(this,s)};return this.on(e,r)}removeAllListeners(){this.callbacks={}}}function Ht(t,e,n){return t.config[e]===void 0&&t.parent?Ht(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?Ht(t.parent,e,n):null}):t.config[e]}function Kg(t){const e=t.filter(s=>s.type==="extension"),n=t.filter(s=>s.type==="node"),r=t.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function t5(t){const e=[],{nodeExtensions:n,markExtensions:r}=Kg(t),s=[...n,...r],i={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:s},l=Ht(o,"addGlobalAttributes",a);if(!l)return;l().forEach(d=>{d.types.forEach(f=>{Object.entries(d.attributes).forEach(([h,p])=>{e.push({type:f,name:h,attribute:{...i,...p}})})})})}),s.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=Ht(o,"addAttributes",a);if(!l)return;const u=l();Object.entries(u).forEach(([d,f])=>{const h={...i,...f};typeof(h==null?void 0:h.default)=="function"&&(h.default=h.default()),h!=null&&h.isRequired&&(h==null?void 0:h.default)===void 0&&delete h.default,e.push({type:o.name,name:d,attribute:h})})}),e}function Hr(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function Sn(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([s,i])=>{if(!r[s]){r[s]=i;return}if(s==="class"){const a=i?String(i).split(" "):[],l=r[s]?r[s].split(" "):[],u=a.filter(d=>!l.includes(d));r[s]=[...l,...u].join(" ")}else if(s==="style"){const a=i?i.split(";").map(d=>d.trim()).filter(Boolean):[],l=r[s]?r[s].split(";").map(d=>d.trim()).filter(Boolean):[],u=new Map;l.forEach(d=>{const[f,h]=d.split(":").map(p=>p.trim());u.set(f,h)}),a.forEach(d=>{const[f,h]=d.split(":").map(p=>p.trim());u.set(f,h)}),r[s]=Array.from(u.entries()).map(([d,f])=>`${d}: ${f}`).join("; ")}else r[s]=i}),r},{})}function K1(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>Sn(n,r),{})}function n5(t){return typeof t=="function"}function pn(t,e=void 0,...n){return n5(t)?e?t.bind(e)(...n):t(...n):t}function K7(t={}){return Object.keys(t).length===0&&t.constructor===Object}function G7(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function CT(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const s=e.reduce((i,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):G7(n.getAttribute(o.name));return a==null?i:{...i,[o.name]:a}},{});return{...r,...s}}}}function ET(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&K7(n)?!1:n!=null))}function q7(t,e){var n;const r=t5(t),{nodeExtensions:s,markExtensions:i}=Kg(t),o=(n=s.find(u=>Ht(u,"topNode")))===null||n===void 0?void 0:n.name,a=Object.fromEntries(s.map(u=>{const d=r.filter(g=>g.type===u.name),f={name:u.name,options:u.options,storage:u.storage,editor:e},h=t.reduce((g,v)=>{const w=Ht(v,"extendNodeSchema",f);return{...g,...w?w(u):{}}},{}),p=ET({...h,content:pn(Ht(u,"content",f)),marks:pn(Ht(u,"marks",f)),group:pn(Ht(u,"group",f)),inline:pn(Ht(u,"inline",f)),atom:pn(Ht(u,"atom",f)),selectable:pn(Ht(u,"selectable",f)),draggable:pn(Ht(u,"draggable",f)),code:pn(Ht(u,"code",f)),whitespace:pn(Ht(u,"whitespace",f)),linebreakReplacement:pn(Ht(u,"linebreakReplacement",f)),defining:pn(Ht(u,"defining",f)),isolating:pn(Ht(u,"isolating",f)),attrs:Object.fromEntries(d.map(g=>{var v;return[g.name,{default:(v=g==null?void 0:g.attribute)===null||v===void 0?void 0:v.default}]}))}),m=pn(Ht(u,"parseHTML",f));m&&(p.parseDOM=m.map(g=>CT(g,d)));const y=Ht(u,"renderHTML",f);y&&(p.toDOM=g=>y({node:g,HTMLAttributes:K1(g,d)}));const x=Ht(u,"renderText",f);return x&&(p.toText=x),[u.name,p]})),l=Object.fromEntries(i.map(u=>{const d=r.filter(x=>x.type===u.name),f={name:u.name,options:u.options,storage:u.storage,editor:e},h=t.reduce((x,g)=>{const v=Ht(g,"extendMarkSchema",f);return{...x,...v?v(u):{}}},{}),p=ET({...h,inclusive:pn(Ht(u,"inclusive",f)),excludes:pn(Ht(u,"excludes",f)),group:pn(Ht(u,"group",f)),spanning:pn(Ht(u,"spanning",f)),code:pn(Ht(u,"code",f)),attrs:Object.fromEntries(d.map(x=>{var g;return[x.name,{default:(g=x==null?void 0:x.attribute)===null||g===void 0?void 0:g.default}]}))}),m=pn(Ht(u,"parseHTML",f));m&&(p.parseDOM=m.map(x=>CT(x,d)));const y=Ht(u,"renderHTML",f);return y&&(p.toDOM=x=>y({mark:x,HTMLAttributes:K1(x,d)})),[u.name,p]}));return new qM({topNode:o,nodes:a,marks:l})}function by(t,e){return e.nodes[t]||e.marks[t]||null}function NT(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function Cv(t,e){const n=rc.fromSchema(e).serializeFragment(t),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(n),s.innerHTML}const Y7=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(s,i,o,a)=>{var l,u;const d=((u=(l=s.type.spec).toText)===null||u===void 0?void 0:u.call(l,{node:s,pos:i,parent:o,index:a}))||s.textContent||"%leaf%";n+=s.isAtom&&!s.isText?d:d.slice(0,Math.max(0,r-i))}),n};function Ev(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class Gg{constructor(e){this.find=e.find,this.handler=e.handler}}const J7=(t,e)=>{if(Ev(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function Oh(t){var e;const{editor:n,from:r,to:s,text:i,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const u=l.state.doc.resolve(r);if(u.parent.type.spec.code||!((e=u.nodeBefore||u.nodeAfter)===null||e===void 0)&&e.marks.find(h=>h.type.spec.code))return!1;let d=!1;const f=Y7(u)+i;return o.forEach(h=>{if(d)return;const p=J7(f,h.find);if(!p)return;const m=l.state.tr,y=Vg({state:l.state,transaction:m}),x={from:r-(p[0].length-i.length),to:s},{commands:g,chain:v,can:w}=new Wg({editor:n,state:y});h.handler({state:y,range:x,match:p,commands:g,chain:v,can:w})===null||!m.steps.length||(m.setMeta(a,{transform:m,from:r,to:s,text:i}),l.dispatch(m),d=!0)}),d}function X7(t){const{editor:e,rules:n}=t,r=new Cr({state:{init(){return null},apply(s,i,o){const a=s.getMeta(r);if(a)return a;const l=s.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:d}=l;typeof d=="string"?d=d:d=Cv(_t.from(d),o.schema);const{from:f}=l,h=f+d.length;Oh({editor:e,from:f,to:h,text:d,rules:n,plugin:r})}),s.selectionSet||s.docChanged?null:i}},props:{handleTextInput(s,i,o,a){return Oh({editor:e,from:i,to:o,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:i}=s.state.selection;i&&Oh({editor:e,from:i.pos,to:i.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(s,i){if(i.key!=="Enter")return!1;const{$cursor:o}=s.state.selection;return o?Oh({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function Q7(t){return Object.prototype.toString.call(t).slice(8,-1)}function Ph(t){return Q7(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function qg(t,e){const n={...t};return Ph(t)&&Ph(e)&&Object.keys(e).forEach(r=>{Ph(e[r])&&Ph(t[r])?n[r]=qg(t[r],e[r]):n[r]=e[r]}),n}class ei{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=pn(Ht(this,"addOptions",{name:this.name}))),this.storage=pn(Ht(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new ei(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>qg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new ei(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=pn(Ht(n,"addOptions",{name:n.name})),n.storage=pn(Ht(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const o=s.marks();if(!!!o.find(u=>(u==null?void 0:u.type.name)===n.name))return!1;const l=o.find(u=>(u==null?void 0:u.type.name)===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",s.pos),e.view.dispatch(r),!0}return!1}}function Z7(t){return typeof t=="number"}class eW{constructor(e){this.find=e.find,this.handler=e.handler}}const tW=(t,e,n)=>{if(Ev(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(s=>{const i=[s.text];return i.index=s.index,i.input=t,i.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(s.replaceWith)),i}):[]};function nW(t){const{editor:e,state:n,from:r,to:s,rule:i,pasteEvent:o,dropEvent:a}=t,{commands:l,chain:u,can:d}=new Wg({editor:e,state:n}),f=[];return n.doc.nodesBetween(r,s,(p,m)=>{if(!p.isTextblock||p.type.spec.code)return;const y=Math.max(r,m),x=Math.min(s,m+p.content.size),g=p.textBetween(y-m,x-m,void 0,"");tW(g,i.find,o).forEach(w=>{if(w.index===void 0)return;const T=y+w.index+1,D=T+w[0].length,k={from:n.tr.mapping.map(T),to:n.tr.mapping.map(D)},I=i.handler({state:n,range:k,match:w,commands:l,chain:u,can:d,pasteEvent:o,dropEvent:a});f.push(I)})}),f.every(p=>p!==null)}let Lh=null;const rW=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)===null||e===void 0||e.setData("text/html",t),n};function sW(t){const{editor:e,rules:n}=t;let r=null,s=!1,i=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:d,from:f,to:h,rule:p,pasteEvt:m})=>{const y=d.tr,x=Vg({state:d,transaction:y});if(!(!nW({editor:e,state:x,from:Math.max(f-1,0),to:h.b-1,rule:p,pasteEvent:m,dropEvent:a})||!y.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,y}};return n.map(d=>new Cr({view(f){const h=m=>{var y;r=!((y=f.dom.parentElement)===null||y===void 0)&&y.contains(m.target)?f.dom.parentElement:null,r&&(Lh=e)},p=()=>{Lh&&(Lh=null)};return window.addEventListener("dragstart",h),window.addEventListener("dragend",p),{destroy(){window.removeEventListener("dragstart",h),window.removeEventListener("dragend",p)}}},props:{handleDOMEvents:{drop:(f,h)=>{if(i=r===f.dom.parentElement,a=h,!i){const p=Lh;p!=null&&p.isEditable&&setTimeout(()=>{const m=p.state.selection;m&&p.commands.deleteRange({from:m.from,to:m.to})},10)}return!1},paste:(f,h)=>{var p;const m=(p=h.clipboardData)===null||p===void 0?void 0:p.getData("text/html");return o=h,s=!!(m!=null&&m.includes("data-pm-slice")),!1}}},appendTransaction:(f,h,p)=>{const m=f[0],y=m.getMeta("uiEvent")==="paste"&&!s,x=m.getMeta("uiEvent")==="drop"&&!i,g=m.getMeta("applyPasteRules"),v=!!g;if(!y&&!x&&!v)return;if(v){let{text:D}=g;typeof D=="string"?D=D:D=Cv(_t.from(D),p.schema);const{from:k}=g,I=k+D.length,C=rW(D);return l({rule:d,state:p,from:k,to:{b:I},pasteEvt:C})}const w=h.doc.content.findDiffStart(p.doc.content),T=h.doc.content.findDiffEnd(p.doc.content);if(!(!Z7(w)||!T||w===T.b))return l({rule:d,state:p,from:w,to:T,pasteEvt:o})}}))}function iW(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}class Yc{constructor(e,n){this.splittableMarks=[],this.editor=n,this.extensions=Yc.resolve(e),this.schema=q7(this.extensions,n),this.setupExtensions()}static resolve(e){const n=Yc.sort(Yc.flatten(e)),r=iW(n.map(s=>s.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(s=>`'${s}'`).join(", ")}]. This can lead to issues.`),n}static flatten(e){return e.map(n=>{const r={name:n.name,options:n.options,storage:n.storage},s=Ht(n,"addExtensions",r);return s?[n,...this.flatten(s())]:n}).flat(10)}static sort(e){return e.sort((r,s)=>{const i=Ht(r,"priority")||100,o=Ht(s,"priority")||100;return i>o?-1:i<o?1:0})}get commands(){return this.extensions.reduce((e,n)=>{const r={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:by(n.name,this.schema)},s=Ht(n,"addCommands",r);return s?{...e,...s()}:e},{})}get plugins(){const{editor:e}=this,n=Yc.sort([...this.extensions].reverse()),r=[],s=[],i=n.map(o=>{const a={name:o.name,options:o.options,storage:o.storage,editor:e,type:by(o.name,this.schema)},l=[],u=Ht(o,"addKeyboardShortcuts",a);let d={};if(o.type==="mark"&&Ht(o,"exitable",a)&&(d.ArrowRight=()=>ei.handleExit({editor:e,mark:o})),u){const y=Object.fromEntries(Object.entries(u()).map(([x,g])=>[x,()=>g({editor:e})]));d={...d,...y}}const f=x7(d);l.push(f);const h=Ht(o,"addInputRules",a);NT(o,e.options.enableInputRules)&&h&&r.push(...h());const p=Ht(o,"addPasteRules",a);NT(o,e.options.enablePasteRules)&&p&&s.push(...p());const m=Ht(o,"addProseMirrorPlugins",a);if(m){const y=m();l.push(...y)}return l}).flat();return[X7({editor:e,rules:r}),...sW({editor:e,rules:s}),...i]}get attributes(){return t5(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:n}=Kg(this.extensions);return Object.fromEntries(n.filter(r=>!!Ht(r,"addNodeView")).map(r=>{const s=this.attributes.filter(l=>l.type===r.name),i={name:r.name,options:r.options,storage:r.storage,editor:e,type:Hr(r.name,this.schema)},o=Ht(r,"addNodeView",i);if(!o)return[];const a=(l,u,d,f,h)=>{const p=K1(l,s);return o()({node:l,view:u,getPos:d,decorations:f,innerDecorations:h,editor:e,extension:r,HTMLAttributes:p})};return[r.name,a]}))}setupExtensions(){this.extensions.forEach(e=>{var n;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:by(e.name,this.schema)};e.type==="mark"&&(!((n=pn(Ht(e,"keepOnSplit",r)))!==null&&n!==void 0)||n)&&this.splittableMarks.push(e.name);const s=Ht(e,"onBeforeCreate",r),i=Ht(e,"onCreate",r),o=Ht(e,"onUpdate",r),a=Ht(e,"onSelectionUpdate",r),l=Ht(e,"onTransaction",r),u=Ht(e,"onFocus",r),d=Ht(e,"onBlur",r),f=Ht(e,"onDestroy",r);s&&this.editor.on("beforeCreate",s),i&&this.editor.on("create",i),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),u&&this.editor.on("focus",u),d&&this.editor.on("blur",d),f&&this.editor.on("destroy",f)})}}class Vr{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=pn(Ht(this,"addOptions",{name:this.name}))),this.storage=pn(Ht(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Vr(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>qg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new Vr({...this.config,...e});return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=pn(Ht(n,"addOptions",{name:n.name})),n.storage=pn(Ht(n,"addStorage",{name:n.name,options:n.options})),n}}function r5(t,e,n){const{from:r,to:s}=e,{blockSeparator:i=`

`,textSerializers:o={}}=n||{};let a="";return t.nodesBetween(r,s,(l,u,d,f)=>{var h;l.isBlock&&u>r&&(a+=i);const p=o==null?void 0:o[l.type.name];if(p)return d&&(a+=p({node:l,pos:u,parent:d,index:f,range:e})),!1;l.isText&&(a+=(h=l==null?void 0:l.text)===null||h===void 0?void 0:h.slice(Math.max(r,u)-u,s-u))}),a}function s5(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}const oW=Vr.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Cr({key:new rs("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:s}=e,{ranges:i}=s,o=Math.min(...i.map(d=>d.$from.pos)),a=Math.max(...i.map(d=>d.$to.pos)),l=s5(n);return r5(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),aW=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window==null?void 0:window.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),lW=(t=!1)=>({commands:e})=>e.setContent("",t),cW=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:s}=r;return n&&s.forEach(({$from:i,$to:o})=>{t.doc.nodesBetween(i.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:u,mapping:d}=e,f=u.resolve(d.map(l)),h=u.resolve(d.map(l+a.nodeSize)),p=f.blockRange(h);if(!p)return;const m=Pu(p);if(a.type.isTextblock){const{defaultType:y}=f.parent.contentMatchAt(f.index());e.setNodeMarkup(p.start,y)}(m||m===0)&&e.lift(p,m)})}),!0},uW=t=>e=>t(e),dW=()=>({state:t,dispatch:e})=>D7(t,e),fW=(t,e)=>({editor:n,tr:r})=>{const{state:s}=n,i=s.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const o=r.mapping.map(e);return r.insert(o,i.content),r.setSelection(new sn(r.doc.resolve(Math.max(o-1,0)))),!0},hW=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const s=t.selection.$anchor;for(let i=s.depth;i>0;i-=1)if(s.node(i).type===r.type){if(e){const a=s.before(i),l=s.after(i);t.delete(a,l).scrollIntoView()}return!0}return!1},pW=t=>({tr:e,state:n,dispatch:r})=>{const s=Hr(t,n.schema),i=e.selection.$anchor;for(let o=i.depth;o>0;o-=1)if(i.node(o).type===s){if(r){const l=i.before(o),u=i.after(o);e.delete(l,u).scrollIntoView()}return!0}return!1},mW=t=>({tr:e,dispatch:n})=>{const{from:r,to:s}=t;return n&&e.delete(r,s),!0},gW=()=>({state:t,dispatch:e})=>b7(t,e),yW=()=>({commands:t})=>t.keyboardShortcut("Enter"),xW=()=>({state:t,dispatch:e})=>I7(t,e);function Nm(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(s=>n.strict?e[s]===t[s]:Ev(e[s])?e[s].test(t[s]):e[s]===t[s]):!0}function i5(t,e,n={}){return t.find(r=>r.type===e&&Nm(Object.fromEntries(Object.keys(n).map(s=>[s,r.attrs[s]])),n))}function jT(t,e,n={}){return!!i5(t,e,n)}function Nv(t,e,n){var r;if(!t||!e)return;let s=t.parent.childAfter(t.parentOffset);if((!s.node||!s.node.marks.some(d=>d.type===e))&&(s=t.parent.childBefore(t.parentOffset)),!s.node||!s.node.marks.some(d=>d.type===e)||(n=n||((r=s.node.marks[0])===null||r===void 0?void 0:r.attrs),!i5([...s.node.marks],e,n)))return;let o=s.index,a=t.start()+s.offset,l=o+1,u=a+s.node.nodeSize;for(;o>0&&jT([...t.parent.child(o-1).marks],e,n);)o-=1,a-=t.parent.child(o).nodeSize;for(;l<t.parent.childCount&&jT([...t.parent.child(l).marks],e,n);)u+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:u}}function Za(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const bW=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const i=Za(t,r.schema),{doc:o,selection:a}=n,{$from:l,from:u,to:d}=a;if(s){const f=Nv(l,i,e);if(f&&f.from<=u&&f.to>=d){const h=sn.create(o,f.from,f.to);n.setSelection(h)}}return!0},wW=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function o5(t){return t instanceof sn}function Ml(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function a5(t,e=null){if(!e)return null;const n=ln.atStart(t),r=ln.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const s=n.from,i=r.to;return e==="all"?sn.create(t,Ml(0,s,i),Ml(t.content.size,s,i)):sn.create(t,Ml(e,s,i),Ml(e,s,i))}function l5(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Yg(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const vW=(t=null,e={})=>({editor:n,view:r,tr:s,dispatch:i})=>{e={scrollIntoView:!0,...e};const o=()=>{(Yg()||l5())&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e!=null&&e.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(i&&t===null&&!o5(n.state.selection))return o(),!0;const a=a5(s.doc,t)||n.state.selection,l=n.state.selection.eq(a);return i&&(l||s.setSelection(a),l&&s.storedMarks&&s.setStoredMarks(s.storedMarks),o()),!0},kW=(t,e)=>n=>t.every((r,s)=>e(r,{...n,index:s})),SW=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),c5=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&c5(r)}return t};function $h(t){const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return c5(n)}function If(t,e,n){if(t instanceof Fo||t instanceof _t)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,s=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return _t.fromArray(t.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(i){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",i),If("",e,n)}if(s){if(n.errorOnInvalidContent){let o=!1,a="";const l=new qM({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(o=!0,a=typeof u=="string"?u:u.outerHTML,null)}]}})});if(n.slice?Ra.fromSchema(l).parseSlice($h(t),n.parseOptions):Ra.fromSchema(l).parse($h(t),n.parseOptions),n.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const i=Ra.fromSchema(e);return n.slice?i.parseSlice($h(t),n.parseOptions).content:i.parse($h(t),n.parseOptions)}return If("",e,n)}function _W(t,e,n){const r=t.steps.length-1;if(r<e)return;const s=t.steps[r];if(!(s instanceof $r||s instanceof Br))return;const i=t.mapping.maps[r];let o=0;i.forEach((a,l,u,d)=>{o===0&&(o=d)}),t.setSelection(ln.near(t.doc.resolve(o),n))}const TW=t=>!("type"in t),CW=(t,e,n)=>({tr:r,dispatch:s,editor:i})=>{var o;if(s){n={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=x=>{i.emit("contentError",{editor:i,error:x,disableCollaboration:()=>{i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{If(e,i.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(x){l(x)}try{a=If(e,i.schema,{parseOptions:u,errorOnInvalidContent:(o=n.errorOnInvalidContent)!==null&&o!==void 0?o:i.options.enableContentCheck})}catch(x){return l(x),!1}let{from:d,to:f}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},h=!0,p=!0;if((TW(a)?a:[a]).forEach(x=>{x.check(),h=h?x.isText&&x.marks.length===0:!1,p=p?x.isBlock:!1}),d===f&&p){const{parent:x}=r.doc.resolve(d);x.isTextblock&&!x.type.spec.code&&!x.childCount&&(d-=1,f+=1)}let y;if(h){if(Array.isArray(e))y=e.map(x=>x.text||"").join("");else if(e instanceof _t){let x="";e.forEach(g=>{g.text&&(x+=g.text)}),y=x}else typeof e=="object"&&e&&e.text?y=e.text:y=e;r.insertText(y,d,f)}else y=a,r.replaceWith(d,f,y);n.updateSelection&&_W(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:d,text:y}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:d,text:y})}return!0},EW=()=>({state:t,dispatch:e})=>C7(t,e),NW=()=>({state:t,dispatch:e})=>E7(t,e),jW=()=>({state:t,dispatch:e})=>w7(t,e),IW=()=>({state:t,dispatch:e})=>_7(t,e),DW=()=>({state:t,dispatch:e,tr:n})=>{try{const r=$g(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},MW=()=>({state:t,dispatch:e,tr:n})=>{try{const r=$g(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},AW=()=>({state:t,dispatch:e})=>v7(t,e),RW=()=>({state:t,dispatch:e})=>k7(t,e);function u5(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function OW(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,s,i,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))Yg()||u5()?o=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),s&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),i&&(n=`Shift-${n}`),n}const PW=t=>({editor:e,view:n,tr:r,dispatch:s})=>{const i=OW(t).split(/-(?!$)/),o=i.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",u=>u(n,a))});return l==null||l.steps.forEach(u=>{const d=u.map(r.mapping);d&&s&&r.maybeStep(d)}),!0};function Df(t,e,n={}){const{from:r,to:s,empty:i}=t.selection,o=e?Hr(e,t.schema):null,a=[];t.doc.nodesBetween(r,s,(f,h)=>{if(f.isText)return;const p=Math.max(r,h),m=Math.min(s,h+f.nodeSize);a.push({node:f,from:p,to:m})});const l=s-r,u=a.filter(f=>o?o.name===f.node.type.name:!0).filter(f=>Nm(f.node.attrs,n,{strict:!1}));return i?!!u.length:u.reduce((f,h)=>f+h.to-h.from,0)>=l}const LW=(t,e={})=>({state:n,dispatch:r})=>{const s=Hr(t,n.schema);return Df(n,s,e)?N7(n,r):!1},$W=()=>({state:t,dispatch:e})=>M7(t,e),zW=t=>({state:e,dispatch:n})=>{const r=Hr(t,e.schema);return B7(r)(e,n)},FW=()=>({state:t,dispatch:e})=>j7(t,e);function Jg(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function IT(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,s)=>(n.includes(s)||(r[s]=t[s]),r),{})}const BW=(t,e)=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=Jg(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(i=Hr(t,r.schema)),a==="mark"&&(o=Za(t,r.schema)),s&&n.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(u,d)=>{i&&i===u.type&&n.setNodeMarkup(d,void 0,IT(u.attrs,e)),o&&u.marks.length&&u.marks.forEach(f=>{o===f.type&&n.addMark(d,d+u.nodeSize,o.create(IT(f.attrs,e)))})})}),!0):!1},UW=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),HW=()=>({tr:t,dispatch:e})=>{if(e){const n=new ki(t.doc);t.setSelection(n)}return!0},VW=()=>({state:t,dispatch:e})=>S7(t,e),WW=()=>({state:t,dispatch:e})=>T7(t,e),KW=()=>({state:t,dispatch:e})=>A7(t,e),GW=()=>({state:t,dispatch:e})=>P7(t,e),qW=()=>({state:t,dispatch:e})=>O7(t,e);function G1(t,e,n={},r={}){return If(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}const YW=(t,e=!1,n={},r={})=>({editor:s,tr:i,dispatch:o,commands:a})=>{var l,u;const{doc:d}=i;if(n.preserveWhitespace!=="full"){const f=G1(t,s.schema,n,{errorOnInvalidContent:(l=r.errorOnInvalidContent)!==null&&l!==void 0?l:s.options.enableContentCheck});return o&&i.replaceWith(0,d.content.size,f).setMeta("preventUpdate",!e),!0}return o&&i.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:d.content.size},t,{parseOptions:n,errorOnInvalidContent:(u=r.errorOnInvalidContent)!==null&&u!==void 0?u:s.options.enableContentCheck})};function d5(t,e){const n=Za(e,t.schema),{from:r,to:s,empty:i}=t.selection,o=[];i?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,s,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function JW(t,e){const n=new uA(t);return e.forEach(r=>{r.steps.forEach(s=>{n.step(s)})}),n}function jv(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function kp(t,e){const n=[];return t.descendants((r,s)=>{e(r)&&n.push({node:r,pos:s})}),n}function XW(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(s,i)=>{n(s)&&r.push({node:s,pos:i})}),r}function QW(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function Lu(t){return e=>QW(e.$from,t)}function ZW(t,e){const n={from:0,to:t.content.size};return r5(t,n,e)}function eK(t,e){const n=Hr(e,t.schema),{from:r,to:s}=t.selection,i=[];t.doc.nodesBetween(r,s,a=>{i.push(a)});const o=i.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function f5(t,e){const n=Jg(typeof e=="string"?e:e.name,t.schema);return n==="node"?eK(t,e):n==="mark"?d5(t,e):{}}function tK(t,e=JSON.stringify){const n={};return t.filter(r=>{const s=e(r);return Object.prototype.hasOwnProperty.call(n,s)?!1:n[s]=!0})}function nK(t){const e=tK(t);return e.length===1?e:e.filter((n,r)=>!e.filter((i,o)=>o!==r).some(i=>n.oldRange.from>=i.oldRange.from&&n.oldRange.to<=i.oldRange.to&&n.newRange.from>=i.newRange.from&&n.newRange.to<=i.newRange.to))}function rK(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((s,i)=>{const o=[];if(s.ranges.length)s.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=n[i];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const u=e.slice(i).map(a,-1),d=e.slice(i).map(l),f=e.invert().map(u,-1),h=e.invert().map(d);r.push({oldRange:{from:f,to:h},newRange:{from:u,to:d}})})}),nK(r)}function Iv(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(s=>{const i=n.resolve(t),o=Nv(i,s.type);o&&r.push({mark:s,...o})}):n.nodesBetween(t,e,(s,i)=>{!s||(s==null?void 0:s.nodeSize)===void 0||r.push(...s.marks.map(o=>({from:i,to:i+s.nodeSize,mark:o})))}),r}function Sp(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const s=t.find(i=>i.type===e&&i.name===r);return s?s.attribute.keepOnSplit:!1}))}function q1(t,e,n={}){const{empty:r,ranges:s}=t.selection,i=e?Za(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(f=>i?i.name===f.type.name:!0).find(f=>Nm(f.attrs,n,{strict:!1}));let o=0;const a=[];if(s.forEach(({$from:f,$to:h})=>{const p=f.pos,m=h.pos;t.doc.nodesBetween(p,m,(y,x)=>{if(!y.isText&&!y.marks.length)return;const g=Math.max(p,x),v=Math.min(m,x+y.nodeSize),w=v-g;o+=w,a.push(...y.marks.map(T=>({mark:T,from:g,to:v})))})}),o===0)return!1;const l=a.filter(f=>i?i.name===f.mark.type.name:!0).filter(f=>Nm(f.mark.attrs,n,{strict:!1})).reduce((f,h)=>f+h.to-h.from,0),u=a.filter(f=>i?f.mark.type!==i&&f.mark.type.excludes(i):!0).reduce((f,h)=>f+h.to-h.from,0);return(l>0?l+u:l)>=o}function h5(t,e,n={}){if(!e)return Df(t,null,n)||q1(t,null,n);const r=Jg(e,t.schema);return r==="node"?Df(t,e,n):r==="mark"?q1(t,e,n):!1}function DT(t,e){const{nodeExtensions:n}=Kg(e),r=n.find(o=>o.name===t);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},i=pn(Ht(r,"group",s));return typeof i!="string"?!1:i.split(" ").includes("list")}function Dv(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!==null&&r!==void 0?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let s=!0;return t.content.forEach(i=>{s!==!1&&(Dv(i,{ignoreWhitespace:n,checkChildren:e})||(s=!1))}),s}return!1}function sK(t){return t instanceof Gt}function iK(t,e,n){var r;const{selection:s}=e;let i=null;if(o5(s)&&(i=s.$cursor),i){const a=(r=t.storedMarks)!==null&&r!==void 0?r:i.marks();return!!n.isInSet(a)||!a.some(l=>l.type.excludes(n))}const{ranges:o}=s;return o.some(({$from:a,$to:l})=>{let u=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(d,f,h)=>{if(u)return!1;if(d.isInline){const p=!h||h.type.allowsMarkType(n),m=!!n.isInSet(d.marks)||!d.marks.some(y=>y.type.excludes(n));u=p&&m}return!u}),u})}const oK=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const{selection:i}=n,{empty:o,ranges:a}=i,l=Za(t,r.schema);if(s)if(o){const u=d5(r,l);n.addStoredMark(l.create({...u,...e}))}else a.forEach(u=>{const d=u.$from.pos,f=u.$to.pos;r.doc.nodesBetween(d,f,(h,p)=>{const m=Math.max(p,d),y=Math.min(p+h.nodeSize,f);h.marks.find(g=>g.type===l)?h.marks.forEach(g=>{l===g.type&&n.addMark(m,y,l.create({...g.attrs,...e}))}):n.addMark(m,y,l.create(e))})});return iK(r,n,l)},aK=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),lK=(t,e={})=>({state:n,dispatch:r,chain:s})=>{const i=Hr(t,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),i.isTextblock?s().command(({commands:a})=>TT(i,{...o,...e})(n)?!0:a.clearNodes()).command(({state:a})=>TT(i,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},cK=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,s=Ml(t,0,r.content.size),i=Gt.create(r,s);e.setSelection(i)}return!0},uK=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:s,to:i}=typeof t=="number"?{from:t,to:t}:t,o=sn.atStart(r).from,a=sn.atEnd(r).to,l=Ml(s,o,a),u=Ml(i,o,a),d=sn.create(r,l,u);e.setSelection(d)}return!0},dK=t=>({state:e,dispatch:n})=>{const r=Hr(t,e.schema);return V7(r)(e,n)};function MT(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(s=>e==null?void 0:e.includes(s.type.name));t.tr.ensureMarks(r)}}const fK=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:s})=>{const{selection:i,doc:o}=e,{$from:a,$to:l}=i,u=s.extensionManager.attributes,d=Sp(u,a.node().type.name,a.node().attrs);if(i instanceof Gt&&i.node.isBlock)return!a.parentOffset||!iu(o,a.pos)?!1:(r&&(t&&MT(n,s.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const f=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:jv(a.node(-1).contentMatchAt(a.indexAfter(-1)));let p=f&&h?[{type:h,attrs:d}]:void 0,m=iu(e.doc,e.mapping.map(a.pos),1,p);if(!p&&!m&&iu(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(m=!0,p=h?[{type:h,attrs:d}]:void 0),r){if(m&&(i instanceof sn&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,p),h&&!f&&!a.parentOffset&&a.parent.type!==h)){const y=e.mapping.map(a.before()),x=e.doc.resolve(y);a.node(-1).canReplaceWith(x.index(),x.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}t&&MT(n,s.extensionManager.splittableMarks),e.scrollIntoView()}return m},hK=(t,e={})=>({tr:n,state:r,dispatch:s,editor:i})=>{var o;const a=Hr(t,r.schema),{$from:l,$to:u}=r.selection,d=r.selection.node;if(d&&d.isBlock||l.depth<2||!l.sameParent(u))return!1;const f=l.node(-1);if(f.type!==a)return!1;const h=i.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(s){let g=_t.empty;const v=l.index(-1)?1:l.index(-2)?2:3;for(let C=l.depth-v;C>=l.depth-3;C-=1)g=_t.from(l.node(C).copy(g));const w=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,T={...Sp(h,l.node().type.name,l.node().attrs),...e},D=((o=a.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(T))||void 0;g=g.append(_t.from(a.createAndFill(null,D)||void 0));const k=l.before(l.depth-(v-1));n.replace(k,l.after(-w),new zt(g,4-v,0));let I=-1;n.doc.nodesBetween(k,n.doc.content.size,(C,S)=>{if(I>-1)return!1;C.isTextblock&&C.content.size===0&&(I=S+1)}),I>-1&&n.setSelection(sn.near(n.doc.resolve(I))),n.scrollIntoView()}return!0}const p=u.pos===l.end()?f.contentMatchAt(0).defaultType:null,m={...Sp(h,f.type.name,f.attrs),...e},y={...Sp(h,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,u.pos);const x=p?[{type:a,attrs:m},{type:p,attrs:y}]:[{type:a,attrs:m}];if(!iu(n.doc,l.pos,2))return!1;if(s){const{selection:g,storedMarks:v}=r,{splittableMarks:w}=i.extensionManager,T=v||g.$to.parentOffset&&g.$from.marks();if(n.split(l.pos,2,x).scrollIntoView(),!T||!s)return!0;const D=T.filter(k=>w.includes(k.type.name));n.ensureMarks(D)}return!0},wy=(t,e)=>{const n=Lu(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&Xa(t.doc,n.pos)&&t.join(n.pos),!0},vy=(t,e)=>{const n=Lu(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&Xa(t.doc,r)&&t.join(r),!0},pK=(t,e,n,r={})=>({editor:s,tr:i,state:o,dispatch:a,chain:l,commands:u,can:d})=>{const{extensions:f,splittableMarks:h}=s.extensionManager,p=Hr(t,o.schema),m=Hr(e,o.schema),{selection:y,storedMarks:x}=o,{$from:g,$to:v}=y,w=g.blockRange(v),T=x||y.$to.parentOffset&&y.$from.marks();if(!w)return!1;const D=Lu(k=>DT(k.type.name,f))(y);if(w.depth>=1&&D&&w.depth-D.depth<=1){if(D.node.type===p)return u.liftListItem(m);if(DT(D.node.type.name,f)&&p.validContent(D.node.content)&&a)return l().command(()=>(i.setNodeMarkup(D.pos,p),!0)).command(()=>wy(i,p)).command(()=>vy(i,p)).run()}return!n||!T||!a?l().command(()=>d().wrapInList(p,r)?!0:u.clearNodes()).wrapInList(p,r).command(()=>wy(i,p)).command(()=>vy(i,p)).run():l().command(()=>{const k=d().wrapInList(p,r),I=T.filter(C=>h.includes(C.type.name));return i.ensureMarks(I),k?!0:u.clearNodes()}).wrapInList(p,r).command(()=>wy(i,p)).command(()=>vy(i,p)).run()},mK=(t,e={},n={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:i=!1}=n,o=Za(t,r.schema);return q1(r,o,e)?s.unsetMark(o,{extendEmptyMarkRange:i}):s.setMark(o,e)},gK=(t,e,n={})=>({state:r,commands:s})=>{const i=Hr(t,r.schema),o=Hr(e,r.schema),a=Df(r,i,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?s.setNode(o,l):s.setNode(i,{...l,...n})},yK=(t,e={})=>({state:n,commands:r})=>{const s=Hr(t,n.schema);return Df(n,s,e)?r.lift(s):r.wrapIn(s,e)},xK=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const s=n[r];let i;if(s.spec.isInputRules&&(i=s.getState(t))){if(e){const o=t.tr,a=i.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(i.text){const l=o.doc.resolve(i.from).marks();o.replaceWith(i.from,i.to,t.schema.text(i.text,l))}else o.delete(i.from,i.to)}return!0}}return!1},bK=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:s}=n;return r||e&&s.forEach(i=>{t.removeMark(i.$from.pos,i.$to.pos)}),!0},wK=(t,e={})=>({tr:n,state:r,dispatch:s})=>{var i;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=Za(t,r.schema),{$from:u,empty:d,ranges:f}=a;if(!s)return!0;if(d&&o){let{from:h,to:p}=a;const m=(i=u.marks().find(x=>x.type===l))===null||i===void 0?void 0:i.attrs,y=Nv(u,l,m);y&&(h=y.from,p=y.to),n.removeMark(h,p,l)}else f.forEach(h=>{n.removeMark(h.$from.pos,h.$to.pos,l)});return n.removeStoredMark(l),!0},vK=(t,e={})=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=Jg(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(i=Hr(t,r.schema)),a==="mark"&&(o=Za(t,r.schema)),s&&n.selection.ranges.forEach(l=>{const u=l.$from.pos,d=l.$to.pos;let f,h,p,m;n.selection.empty?r.doc.nodesBetween(u,d,(y,x)=>{i&&i===y.type&&(p=Math.max(x,u),m=Math.min(x+y.nodeSize,d),f=x,h=y)}):r.doc.nodesBetween(u,d,(y,x)=>{x<u&&i&&i===y.type&&(p=Math.max(x,u),m=Math.min(x+y.nodeSize,d),f=x,h=y),x>=u&&x<=d&&(i&&i===y.type&&n.setNodeMarkup(x,void 0,{...y.attrs,...e}),o&&y.marks.length&&y.marks.forEach(g=>{if(o===g.type){const v=Math.max(x,u),w=Math.min(x+y.nodeSize,d);n.addMark(v,w,o.create({...g.attrs,...e}))}}))}),h&&(f!==void 0&&n.setNodeMarkup(f,void 0,{...h.attrs,...e}),o&&h.marks.length&&h.marks.forEach(y=>{o===y.type&&n.addMark(p,m,o.create({...y.attrs,...e}))}))}),!0):!1},kK=(t,e={})=>({state:n,dispatch:r})=>{const s=Hr(t,n.schema);return L7(s,e)(n,r)},SK=(t,e={})=>({state:n,dispatch:r})=>{const s=Hr(t,n.schema);return $7(s,e)(n,r)};var _K=Object.freeze({__proto__:null,blur:aW,clearContent:lW,clearNodes:cW,command:uW,createParagraphNear:dW,cut:fW,deleteCurrentNode:hW,deleteNode:pW,deleteRange:mW,deleteSelection:gW,enter:yW,exitCode:xW,extendMarkRange:bW,first:wW,focus:vW,forEach:kW,insertContent:SW,insertContentAt:CW,joinBackward:jW,joinDown:NW,joinForward:IW,joinItemBackward:DW,joinItemForward:MW,joinTextblockBackward:AW,joinTextblockForward:RW,joinUp:EW,keyboardShortcut:PW,lift:LW,liftEmptyBlock:$W,liftListItem:zW,newlineInCode:FW,resetAttributes:BW,scrollIntoView:UW,selectAll:HW,selectNodeBackward:VW,selectNodeForward:WW,selectParentNode:KW,selectTextblockEnd:GW,selectTextblockStart:qW,setContent:YW,setMark:oK,setMeta:aK,setNode:lK,setNodeSelection:cK,setTextSelection:uK,sinkListItem:dK,splitBlock:fK,splitListItem:hK,toggleList:pK,toggleMark:mK,toggleNode:gK,toggleWrap:yK,undoInputRule:xK,unsetAllMarks:bK,unsetMark:wK,updateAttributes:vK,wrapIn:kK,wrapInList:SK});const TK=Vr.create({name:"commands",addCommands(){return{..._K}}}),CK=Vr.create({name:"drop",addProseMirrorPlugins(){return[new Cr({key:new rs("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),EK=Vr.create({name:"editable",addProseMirrorPlugins(){return[new Cr({key:new rs("editable"),props:{editable:()=>this.editor.options.editable}})]}}),NK=new rs("focusEvents"),jK=Vr.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Cr({key:NK,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),IK=Vr.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:u}=a,{empty:d,$anchor:f}=l,{pos:h,parent:p}=f,m=f.parent.isTextblock&&h>0?a.doc.resolve(h-1):f,y=m.parent.type.spec.isolating,x=f.pos-f.parentOffset,g=y&&m.parent.childCount===1?x===f.pos:ln.atStart(u).from===h;return!d||!p.type.isTextblock||p.textContent.length||!g||g&&f.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...r},i={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Yg()||u5()?i:s},addProseMirrorPlugins(){return[new Cr({key:new rs("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(y=>y.getMeta("composition")))return;const r=t.some(y=>y.docChanged)&&!e.doc.eq(n.doc),s=t.some(y=>y.getMeta("preventClearDocument"));if(!r||s)return;const{empty:i,from:o,to:a}=e.selection,l=ln.atStart(e.doc).from,u=ln.atEnd(e.doc).to;if(i||!(o===l&&a===u)||!Dv(n.doc))return;const h=n.tr,p=Vg({state:n,transaction:h}),{commands:m}=new Wg({editor:this.editor,state:p});if(m.clearNodes(),!!h.steps.length)return h}})]}}),DK=Vr.create({name:"paste",addProseMirrorPlugins(){return[new Cr({key:new rs("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),MK=Vr.create({name:"tabindex",addProseMirrorPlugins(){return[new Cr({key:new rs("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class vl{get name(){return this.node.type.name}constructor(e,n,r=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=s}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new vl(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new vl(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new vl(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const s=n.isBlock&&!n.isTextblock,i=n.isAtom&&!n.isText,o=this.pos+r+(i?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!s&&a.depth<=this.depth)return;const l=new vl(a,this.editor,s,s?n:null);s&&(l.actualDepth=this.depth+1),e.push(new vl(a,this.editor,s,s?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,s=this.parent;for(;s&&!r;){if(s.node.type.name===e)if(Object.keys(n).length>0){const i=s.node.attrs,o=Object.keys(n);for(let a=0;a<o.length;a+=1){const l=o[a];if(i[l]!==n[l])break}}else r=s;s=s.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let s=[];if(!this.children||this.children.length===0)return s;const i=Object.keys(n);return this.children.forEach(o=>{r&&s.length>0||(o.node.type.name===e&&i.every(l=>n[l]===o.node.attrs[l])&&s.push(o),!(r&&s.length>0)&&(s=s.concat(o.querySelectorAll(e,n,r))))}),s}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}}const AK=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function RK(t,e,n){const r=document.querySelector(`style[data-tiptap-style${n?`-${n}`:""}]`);if(r!==null)return r;const s=document.createElement("style");return e&&s.setAttribute("nonce",e),s.setAttribute(`data-tiptap-style${n?`-${n}`:""}`,""),s.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(s),s}let OK=class extends W7{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:r,moved:s})=>this.options.onDrop(n,r,s)),this.on("paste",({event:n,slice:r})=>this.options.onPaste(n,r)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=RK(AK,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,n){const r=n5(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let r=n;if([].concat(e).forEach(i=>{const o=typeof i=="string"?`${i}$`:i.key;r=r.filter(a=>!a.key.startsWith(o))}),n.length===r.length)return;const s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}createExtensionManager(){var e,n;const s=[...this.options.enableCoreExtensions?[EK,oW.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||n===void 0?void 0:n.blockSeparator}),TK,jK,IK,MK,CK,DK].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i==null?void 0:i.type));this.extensionManager=new Yc(s,this)}createCommandManager(){this.commandManager=new Wg({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let n;try{n=G1(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>a.name!=="collaboration"),this.createExtensionManager()}}),n=G1(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const r=a5(n,this.options.autofocus);this.view=new GA(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:qc.create({doc:n,selection:r||void 0})});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(o)});return}const n=this.state.apply(e),r=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const s=e.getMeta("focus"),i=e.getMeta("blur");s&&this.emit("focus",{editor:this,event:s.event,transaction:e}),i&&this.emit("blur",{editor:this,event:i.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return f5(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,s=typeof e=="string"?n:e;return h5(this.state,r,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Cv(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return ZW(this.state.doc,{blockSeparator:n,textSerializers:{...s5(this.schema),...r}})}get isEmpty(){return Dv(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelector(e,n))||null}$nodes(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new vl(n,this)}get $doc(){return this.$pos(0)}};function Zl(t){return new Gg({find:t.find,handler:({state:e,range:n,match:r})=>{const s=pn(t.getAttributes,void 0,r);if(s===!1||s===null)return null;const{tr:i}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),u=n.from+a.indexOf(o),d=u+o.length;if(Iv(n.from,n.to,e.doc).filter(p=>p.mark.type.excluded.find(y=>y===t.type&&y!==p.mark.type)).filter(p=>p.to>u).length)return null;d<n.to&&i.delete(d,n.to),u>n.from&&i.delete(n.from+l,u);const h=n.from+l+o.length;i.addMark(n.from+l,h,t.type.create(s||{})),i.removeStoredMark(t.type)}}})}function PK(t){return new Gg({find:t.find,handler:({state:e,range:n,match:r})=>{const s=pn(t.getAttributes,void 0,r)||{},{tr:i}=e,o=n.from;let a=n.to;const l=t.type.create(s);if(r[1]){const u=r[0].lastIndexOf(r[1]);let d=o+u;d>a?d=a:a=d+r[1].length;const f=r[0][r[0].length-1];i.insertText(f,o+r[0].length-1),i.replaceWith(d,a,l)}else if(r[0]){const u=t.type.isInline?o:o-1;i.insert(u,t.type.create(s)).delete(i.mapping.map(o),i.mapping.map(a))}i.scrollIntoView()}})}function Y1(t){return new Gg({find:t.find,handler:({state:e,range:n,match:r})=>{const s=e.doc.resolve(n.from),i=pn(t.getAttributes,void 0,r)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,i)}})}function _u(t){return new Gg({find:t.find,handler:({state:e,range:n,match:r,chain:s})=>{const i=pn(t.getAttributes,void 0,r)||{},o=e.tr.delete(n.from,n.to),l=o.doc.resolve(n.from).blockRange(),u=l&&hv(l,t.type,i);if(!u)return null;if(o.wrap(l,u),t.keepMarks&&t.editor){const{selection:f,storedMarks:h}=e,{splittableMarks:p}=t.editor.extensionManager,m=h||f.$to.parentOffset&&f.$from.marks();if(m){const y=m.filter(x=>p.includes(x.type.name));o.ensureMarks(y)}}if(t.keepAttributes){const f=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(f,i).run()}const d=o.doc.resolve(n.from-1).nodeBefore;d&&d.type===t.type&&Xa(o.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,d))&&o.join(n.from-1)}})}class mr{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=pn(Ht(this,"addOptions",{name:this.name}))),this.storage=pn(Ht(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new mr(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>qg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new mr(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=pn(Ht(n,"addOptions",{name:n.name})),n.storage=pn(Ht(n,"addStorage",{name:n.name,options:n.options})),n}}class LK{constructor(e,n,r){this.isDragging=!1,this.component=e,this.editor=n.editor,this.options={stopEvent:null,ignoreMutation:null,...r},this.extension=n.extension,this.node=n.node,this.decorations=n.decorations,this.innerDecorations=n.innerDecorations,this.view=n.view,this.HTMLAttributes=n.HTMLAttributes,this.getPos=n.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(e){var n,r,s,i,o,a,l;const{view:u}=this.editor,d=e.target,f=d.nodeType===3?(n=d.parentElement)===null||n===void 0?void 0:n.closest("[data-drag-handle]"):d.closest("[data-drag-handle]");if(!this.dom||!((r=this.contentDOM)===null||r===void 0)&&r.contains(d)||!f)return;let h=0,p=0;if(this.dom!==f){const v=this.dom.getBoundingClientRect(),w=f.getBoundingClientRect(),T=(s=e.offsetX)!==null&&s!==void 0?s:(i=e.nativeEvent)===null||i===void 0?void 0:i.offsetX,D=(o=e.offsetY)!==null&&o!==void 0?o:(a=e.nativeEvent)===null||a===void 0?void 0:a.offsetY;h=w.x-v.x+T,p=w.y-v.y+D}const m=this.dom.cloneNode(!0);(l=e.dataTransfer)===null||l===void 0||l.setDragImage(m,h,p);const y=this.getPos();if(typeof y!="number")return;const x=Gt.create(u.state.doc,y),g=u.state.tr.setSelection(x);u.dispatch(g)}stopEvent(e){var n;if(!this.dom)return!1;if(typeof this.options.stopEvent=="function")return this.options.stopEvent({event:e});const r=e.target;if(!(this.dom.contains(r)&&!(!((n=this.contentDOM)===null||n===void 0)&&n.contains(r))))return!1;const i=e.type.startsWith("drag"),o=e.type==="drop";if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(r.tagName)||r.isContentEditable)&&!o&&!i)return!0;const{isEditable:l}=this.editor,{isDragging:u}=this,d=!!this.node.type.spec.draggable,f=Gt.isSelectable(this.node),h=e.type==="copy",p=e.type==="paste",m=e.type==="cut",y=e.type==="mousedown";if(!d&&f&&i&&e.target===this.dom&&e.preventDefault(),d&&i&&!u&&e.target===this.dom)return e.preventDefault(),!1;if(d&&l&&!u&&y){const x=r.closest("[data-drag-handle]");x&&(this.dom===x||this.dom.contains(x))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!(u||o||h||p||m||y&&f)}ignoreMutation(e){return!this.dom||!this.contentDOM?!0:typeof this.options.ignoreMutation=="function"?this.options.ignoreMutation({mutation:e}):this.node.isLeaf||this.node.isAtom?!0:e.type==="selection"||this.dom.contains(e.target)&&e.type==="childList"&&(Yg()||l5())&&this.editor.isFocused&&[...Array.from(e.addedNodes),...Array.from(e.removedNodes)].every(r=>r.isContentEditable)?!1:this.contentDOM===e.target&&e.type==="attributes"?!0:!this.contentDOM.contains(e.target)}updateAttributes(e){this.editor.commands.command(({tr:n})=>{const r=this.getPos();return typeof r!="number"?!1:(n.setNodeMarkup(r,void 0,{...this.node.attrs,...e}),!0)})}deleteNode(){const e=this.getPos();if(typeof e!="number")return;const n=e+this.node.nodeSize;this.editor.commands.deleteRange({from:e,to:n})}}function Wa(t){return new eW({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:s})=>{const i=pn(t.getAttributes,void 0,r,s);if(i===!1||i===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let u=n.to;if(a){const d=l.search(/\S/),f=n.from+l.indexOf(a),h=f+a.length;if(Iv(n.from,n.to,e.doc).filter(m=>m.mark.type.excluded.find(x=>x===t.type&&x!==m.mark.type)).filter(m=>m.to>f).length)return null;h<n.to&&o.delete(h,n.to),f>n.from&&o.delete(n.from+d,f),u=n.from+d+a.length,o.addMark(n.from+d,u,t.type.create(i||{})),o.removeStoredMark(t.type)}}})}function $K(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof Gt){const i=r.index();return r.parent.canReplaceWith(i,i+1,e)}let s=r.depth;for(;s>=0;){const i=r.index(s);if(r.node(s).contentMatchAt(i).matchType(e))return!0;s-=1}return!1}function zK(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}const FK=(...t)=>e=>{t.forEach(n=>{typeof n=="function"?n(e):n&&(n.current=e)})},BK=({renderers:t})=>Dn.createElement(Dn.Fragment,null,Object.entries(t).map(([e,n])=>b4.createPortal(n.reactElement,n.element,e)));class UK extends Dn.Component{constructor(e){super(e),this.editorContentRef=Dn.createRef(),this.initialized=!1,this.state={renderers:{}}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const{editor:e}=this.props;if(e&&e.options.element){if(e.contentComponent)return;const n=this.editorContentRef.current;n.append(...e.options.element.childNodes),e.setOptions({element:n}),e.contentComponent=this,e.createNodeViews(),this.initialized=!0}}maybeFlushSync(e){this.initialized?tr.flushSync(e):e()}setRenderer(e,n){this.maybeFlushSync(()=>{this.setState(({renderers:r})=>({renderers:{...r,[e]:n}}))})}removeRenderer(e){this.maybeFlushSync(()=>{this.setState(({renderers:n})=>{const r={...n};return delete r[e],{renderers:r}})})}componentWillUnmount(){const{editor:e}=this.props;if(!e||(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),e.contentComponent=null,!e.options.element.firstChild))return;const n=document.createElement("div");n.append(...e.options.element.childNodes),e.setOptions({element:n})}render(){const{editor:e,innerRef:n,...r}=this.props;return Dn.createElement(Dn.Fragment,null,Dn.createElement("div",{ref:FK(n,this.editorContentRef),...r}),Dn.createElement(BK,{renderers:this.state.renderers}))}}const HK=b.forwardRef((t,e)=>{const n=Dn.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return Dn.createElement(UK,{key:n,innerRef:e,...t})}),VK=Dn.memo(HK);class WK extends OK{constructor(){super(...arguments),this.contentComponent=null}}const KK=(t={},e=[])=>{const n=b.useRef(null),[,r]=b.useState({}),{onBeforeCreate:s,onBlur:i,onCreate:o,onDestroy:a,onFocus:l,onSelectionUpdate:u,onTransaction:d,onUpdate:f}=t,h=b.useRef(s),p=b.useRef(i),m=b.useRef(o),y=b.useRef(a),x=b.useRef(l),g=b.useRef(u),v=b.useRef(d),w=b.useRef(f);return b.useEffect(()=>{n.current&&(s&&(n.current.off("beforeCreate",h.current),n.current.on("beforeCreate",s),h.current=s),i&&(n.current.off("blur",p.current),n.current.on("blur",i),p.current=i),o&&(n.current.off("create",m.current),n.current.on("create",o),m.current=o),a&&(n.current.off("destroy",y.current),n.current.on("destroy",a),y.current=a),l&&(n.current.off("focus",x.current),n.current.on("focus",l),x.current=l),u&&(n.current.off("selectionUpdate",g.current),n.current.on("selectionUpdate",u),g.current=u),d&&(n.current.off("transaction",v.current),n.current.on("transaction",d),v.current=d),f&&(n.current.off("update",w.current),n.current.on("update",f),w.current=f))},[s,i,o,a,l,u,d,f,n.current]),b.useEffect(()=>{let T=!0;return n.current=new WK(t),n.current.on("transaction",()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{T&&r({})})})}),()=>{T=!1}},e),b.useEffect(()=>()=>{var T;return(T=n.current)===null||T===void 0?void 0:T.destroy()},[]),n.current},GK=b.createContext({editor:null});GK.Consumer;const p5=b.createContext({onDragStart:void 0}),qK=()=>b.useContext(p5);Dn.forwardRef((t,e)=>{const{onDragStart:n}=qK(),r=t.as||"div";return Dn.createElement(r,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:n,style:{whiteSpace:"normal",...t.style}})});function YK(t){return!!(typeof t=="function"&&t.prototype&&t.prototype.isReactComponent)}function JK(t){var e;return typeof t=="object"&&((e=t.$$typeof)===null||e===void 0?void 0:e.toString())==="Symbol(react.forward_ref)"}class XK{constructor(e,{editor:n,props:r={},as:s="div",className:i="",attrs:o}){this.ref=null,this.id=Math.floor(Math.random()*4294967295).toString(),this.component=e,this.editor=n,this.props=r,this.element=document.createElement(s),this.element.classList.add("react-renderer"),i&&this.element.classList.add(...i.split(" ")),o&&Object.keys(o).forEach(a=>{this.element.setAttribute(a,o[a])}),this.render()}render(){var e,n;const r=this.component,s=this.props;(YK(r)||JK(r))&&(s.ref=i=>{this.ref=i}),this.reactElement=Dn.createElement(r,{...s}),(n=(e=this.editor)===null||e===void 0?void 0:e.contentComponent)===null||n===void 0||n.setRenderer(this.id,this)}updateProps(e={}){this.props={...this.props,...e},this.render()}destroy(){var e,n;(n=(e=this.editor)===null||e===void 0?void 0:e.contentComponent)===null||n===void 0||n.removeRenderer(this.id)}}class QK extends LK{mount(){const e={editor:this.editor,node:this.node,decorations:this.decorations,selected:!1,extension:this.extension,getPos:()=>this.getPos(),updateAttributes:(i={})=>this.updateAttributes(i),deleteNode:()=>this.deleteNode()};if(!this.component.displayName){const i=o=>o.charAt(0).toUpperCase()+o.substring(1);this.component.displayName=i(this.extension.name)}const n=i=>{const o=this.component,a=this.onDragStart.bind(this),l=u=>{u&&this.contentDOMElement&&u.firstChild!==this.contentDOMElement&&u.appendChild(this.contentDOMElement)};return Dn.createElement(Dn.Fragment,null,Dn.createElement(p5.Provider,{value:{onDragStart:a,nodeViewContentRef:l}},Dn.createElement(o,{...i})))};n.displayName="ReactNodeView",this.node.isLeaf?this.contentDOMElement=null:this.options.contentDOMElementTag?this.contentDOMElement=document.createElement(this.options.contentDOMElementTag):this.contentDOMElement=document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.style.whiteSpace="inherit");let r=this.node.isInline?"span":"div";this.options.as&&(r=this.options.as);const{className:s=""}=this.options;this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.editor.on("selectionUpdate",this.handleSelectionUpdate),this.renderer=new XK(n,{editor:this.editor,props:e,as:r,className:`node-${this.node.type.name} ${s}`.trim(),attrs:this.options.attrs})}get dom(){var e;if(this.renderer.element.firstElementChild&&!(!((e=this.renderer.element.firstElementChild)===null||e===void 0)&&e.hasAttribute("data-node-view-wrapper")))throw Error("Please use the NodeViewWrapper component for your node view.");return this.renderer.element}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){const{from:e,to:n}=this.editor.state.selection;if(e<=this.getPos()&&n>=this.getPos()+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(e,n){const r=s=>{this.renderer.updateProps(s)};if(e.type!==this.node.type)return!1;if(typeof this.options.update=="function"){const s=this.node,i=this.decorations;return this.node=e,this.decorations=n,this.options.update({oldNode:s,oldDecorations:i,newNode:e,newDecorations:n,updateProps:()=>r({node:e,decorations:n})})}return e===this.node&&this.decorations===n||(this.node=e,this.decorations=n,r({node:e,decorations:n})),!0}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.element.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.element.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}}function ZK(t,e){return n=>n.editor.contentComponent?new QK(t,n,e):{}}const eG=/^\s*>\s$/,tG=mr.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",Sn(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[_u({find:eG,type:this.type})]}}),nG=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,rG=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,sG=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,iG=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,oG=ei.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",Sn(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Zl({find:nG,type:this.type}),Zl({find:sG,type:this.type})]},addPasteRules(){return[Wa({find:rG,type:this.type}),Wa({find:iG,type:this.type})]}}),aG="listItem",AT="textStyle",RT=/^\s*([-+*])\s$/,lG=mr.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",Sn(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(aG,this.editor.getAttributes(AT)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=_u({find:RT,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=_u({find:RT,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(AT),editor:this.editor})),[t]}}),cG=/(^|[^`])`([^`]+)`(?!`)/,uG=/(^|[^`])`([^`]+)`(?!`)/g,dG=ei.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",Sn(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Zl({find:cG,type:this.type})]},addPasteRules(){return[Wa({find:uG,type:this.type})]}}),fG=/^```([a-z]+)?[\s\n]$/,hG=/^~~~([a-z]+)?[\s\n]$/,pG=mr.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,i=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",Sn(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:s}=n;if(!s||r.parent.type!==this.type)return!1;const i=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!i||!o?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:s,empty:i}=n;if(!i||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const a=s.after();return a===void 0?!1:r.nodeAt(a)?t.commands.command(({tr:u})=>(u.setSelection(ln.near(r.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[Y1({find:fG,type:this.type,getAttributes:t=>({language:t[1]})}),Y1({find:hG,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Cr({key:new rs("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,i=s==null?void 0:s.mode;if(!n||!i)return!1;const{tr:o,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:i},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(sn.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),mG=mr.create({name:"doc",topNode:!0,content:"block+"});function gG(t={}){return new Cr({view(e){return new yG(e,t)}})}class yG{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let i=o=>{this[s](o)};return e.dom.addEventListener(s,i),{name:s,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,s=this.editorView.dom,i=s.getBoundingClientRect(),o=i.width/s.offsetWidth,a=i.height/s.offsetHeight;if(n){let f=e.nodeBefore,h=e.nodeAfter;if(f||h){let p=this.editorView.nodeDOM(this.cursorPos-(f?f.nodeSize:0));if(p){let m=p.getBoundingClientRect(),y=f?m.bottom:m.top;f&&h&&(y=(y+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let x=this.width/2*a;r={left:m.left,right:m.right,top:y-x,bottom:y+x}}}}if(!r){let f=this.editorView.coordsAtPos(this.cursorPos),h=this.width/2*o;r={left:f.left-h,right:f.left+h,top:f.top,bottom:f.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let u,d;if(!l||l==document.body&&getComputedStyle(l).position=="static")u=-pageXOffset,d=-pageYOffset;else{let f=l.getBoundingClientRect(),h=f.width/l.offsetWidth,p=f.height/l.offsetHeight;u=f.left-l.scrollLeft*h,d=f.top-l.scrollTop*p}this.element.style.left=(r.left-u)/o+"px",this.element.style.top=(r.top-d)/a+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),s=r&&r.type.spec.disableDropCursor,i=typeof s=="function"?s(this.editorView,n,e):s;if(n&&!i){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=iA(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const xG=Vr.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[gG(this.options)]}});class Zn extends ln{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return Zn.valid(r)?new Zn(r):ln.near(r)}content(){return zt.empty}eq(e){return e instanceof Zn&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Zn(e.resolve(n.pos))}getBookmark(){return new Mv(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!bG(e)||!wG(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let s=n.contentMatchAt(e.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&Zn.valid(e))return e;let s=e.pos,i=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){i=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;s+=n;let l=e.doc.resolve(s);if(Zn.valid(l))return l}for(;;){let o=n>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!Gt.isSelectable(i)){e=e.doc.resolve(s+i.nodeSize*n),r=!1;continue e}break}i=o,s+=n;let a=e.doc.resolve(s);if(Zn.valid(a))return a}return null}}}Zn.prototype.visible=!1;Zn.findFrom=Zn.findGapCursorFrom;ln.jsonID("gapcursor",Zn);class Mv{constructor(e){this.pos=e}map(e){return new Mv(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return Zn.valid(n)?new Zn(n):ln.near(n)}}function m5(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function bG(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n-1);;s=s.lastChild){if(s.childCount==0&&!s.inlineContent||m5(s.type))return!0;if(s.inlineContent)return!1}}return!0}function wG(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n);;s=s.firstChild){if(s.childCount==0&&!s.inlineContent||m5(s.type))return!0;if(s.inlineContent)return!1}}return!0}function vG(){return new Cr({props:{decorations:TG,createSelectionBetween(t,e,n){return e.pos==n.pos&&Zn.valid(n)?new Zn(n):null},handleClick:SG,handleKeyDown:kG,handleDOMEvents:{beforeinput:_G}}})}const kG=qA({ArrowLeft:zh("horiz",-1),ArrowRight:zh("horiz",1),ArrowUp:zh("vert",-1),ArrowDown:zh("vert",1)});function zh(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,s,i){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof sn){if(!i.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let u=Zn.findGapCursorFrom(a,e,l);return u?(s&&s(r.tr.setSelection(new Zn(u))),!0):!1}}function SG(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!Zn.valid(r))return!1;let s=t.posAtCoords({left:n.clientX,top:n.clientY});return s&&s.inside>-1&&Gt.isSelectable(t.state.doc.nodeAt(s.inside))?!1:(t.dispatch(t.state.tr.setSelection(new Zn(r))),!0)}function _G(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof Zn))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let s=_t.empty;for(let o=r.length-1;o>=0;o--)s=_t.from(r[o].createAndFill(null,s));let i=t.state.tr.replace(n.pos,n.pos,new zt(s,0,0));return i.setSelection(sn.near(i.doc.resolve(n.pos+1))),t.dispatch(i),!1}function TG(t){if(!(t.selection instanceof Zn))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",xr.create(t.doc,[Ps.widget(t.selection.head,e,{key:"gapcursor"})])}const CG=Vr.create({name:"gapCursor",addProseMirrorPlugins(){return[vG()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=pn(Ht(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),EG=mr.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",Sn(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:s,storedMarks:i}=n;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=i||s.$to.parentOffset&&s.$from.marks();return e().insertContent({type:this.name}).command(({tr:u,dispatch:d})=>{if(d&&l&&o){const f=l.filter(h=>a.includes(h.type.name));u.ensureMarks(f)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),NG=mr.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,Sn(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>Y1({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var jm=200,Ur=function(){};Ur.prototype.append=function(e){return e.length?(e=Ur.from(e),!this.length&&e||e.length<jm&&this.leafAppend(e)||this.length<jm&&e.leafPrepend(this)||this.appendInner(e)):this};Ur.prototype.prepend=function(e){return e.length?Ur.from(e).append(this):this};Ur.prototype.appendInner=function(e){return new jG(this,e)};Ur.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?Ur.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};Ur.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Ur.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};Ur.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var s=[];return this.forEach(function(i,o){return s.push(e(i,o))},n,r),s};Ur.from=function(e){return e instanceof Ur?e:e&&e.length?new g5(e):Ur.empty};var g5=function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(s,i){return s==0&&i==this.length?this:new e(this.values.slice(s,i))},e.prototype.getInner=function(s){return this.values[s]},e.prototype.forEachInner=function(s,i,o,a){for(var l=i;l<o;l++)if(s(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(s,i,o,a){for(var l=i-1;l>=o;l--)if(s(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(s){if(this.length+s.length<=jm)return new e(this.values.concat(s.flatten()))},e.prototype.leafPrepend=function(s){if(this.length+s.length<=jm)return new e(s.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(Ur);Ur.empty=new g5([]);var jG=function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,s,i,o){var a=this.left.length;if(s<a&&this.left.forEachInner(r,s,Math.min(i,a),o)===!1||i>a&&this.right.forEachInner(r,Math.max(s-a,0),Math.min(this.length,i)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,s,i,o){var a=this.left.length;if(s>a&&this.right.forEachInvertedInner(r,s-a,Math.max(i,a)-a,o+a)===!1||i<a&&this.left.forEachInvertedInner(r,Math.min(s,a),i,o)===!1)return!1},e.prototype.sliceInner=function(r,s){if(r==0&&s==this.length)return this;var i=this.left.length;return s<=i?this.left.slice(r,s):r>=i?this.right.slice(r-i,s-i):this.left.slice(r,i).append(this.right.slice(0,s-i))},e.prototype.leafAppend=function(r){var s=this.right.leafAppend(r);if(s)return new e(this.left,s)},e.prototype.leafPrepend=function(r){var s=this.left.leafPrepend(r);if(s)return new e(s,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(Ur);const IG=500;class Ki{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let s,i;n&&(s=this.remapping(r,this.items.length),i=s.maps.length);let o=e.tr,a,l,u=[],d=[];return this.items.forEach((f,h)=>{if(!f.step){s||(s=this.remapping(r,h+1),i=s.maps.length),i--,d.push(f);return}if(s){d.push(new eo(f.map));let p=f.step.map(s.slice(i)),m;p&&o.maybeStep(p).doc&&(m=o.mapping.maps[o.mapping.maps.length-1],u.push(new eo(m,void 0,void 0,u.length+d.length))),i--,m&&s.appendMap(m,i)}else o.maybeStep(f.step);if(f.selection)return a=s?f.selection.map(s.slice(i)):f.selection,l=new Ki(this.items.slice(0,r).append(d.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,r,s){let i=[],o=this.eventCount,a=this.items,l=!s&&a.length?a.get(a.length-1):null;for(let d=0;d<e.steps.length;d++){let f=e.steps[d].invert(e.docs[d]),h=new eo(e.mapping.maps[d],f,n),p;(p=l&&l.merge(h))&&(h=p,d?i.pop():a=a.slice(0,a.length-1)),i.push(h),n&&(o++,n=void 0),s||(l=h)}let u=o-r.depth;return u>MG&&(a=DG(a,u),o-=u),new Ki(a.append(i),o)}remapping(e,n){let r=new Tf;return this.items.forEach((s,i)=>{let o=s.mirrorOffset!=null&&i-s.mirrorOffset>=e?r.maps.length-s.mirrorOffset:void 0;r.appendMap(s.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new Ki(this.items.append(e.map(n=>new eo(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],s=Math.max(0,this.items.length-n),i=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(h=>{h.selection&&a--},s);let l=n;this.items.forEach(h=>{let p=i.getMirror(--l);if(p==null)return;o=Math.min(o,p);let m=i.maps[p];if(h.step){let y=e.steps[p].invert(e.docs[p]),x=h.selection&&h.selection.map(i.slice(l+1,p));x&&a++,r.push(new eo(m,y,x))}else r.push(new eo(m))},s);let u=[];for(let h=n;h<o;h++)u.push(new eo(i.maps[h]));let d=this.items.slice(0,s).append(u).append(r),f=new Ki(d,a);return f.emptyItemCount()>IG&&(f=f.compress(this.items.length-r.length)),f}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,s=[],i=0;return this.items.forEach((o,a)=>{if(a>=e)s.push(o),o.selection&&i++;else if(o.step){let l=o.step.map(n.slice(r)),u=l&&l.getMap();if(r--,u&&n.appendMap(u,r),l){let d=o.selection&&o.selection.map(n.slice(r));d&&i++;let f=new eo(u.invert(),l,d),h,p=s.length-1;(h=s.length&&s[p].merge(f))?s[p]=h:s.push(f)}}else o.map&&r--},this.items.length,0),new Ki(Ur.from(s.reverse()),i)}}Ki.empty=new Ki(Ur.empty,0);function DG(t,e){let n;return t.forEach((r,s)=>{if(r.selection&&e--==0)return n=s,!1}),t.slice(n)}class eo{constructor(e,n,r,s){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new eo(n.getMap().invert(),n,this.selection)}}}class fa{constructor(e,n,r,s,i){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=s,this.prevComposition=i}}const MG=20;function AG(t,e,n,r){let s=n.getMeta(Hl),i;if(s)return s.historyState;n.getMeta(PG)&&(t=new fa(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(Hl))return o.getMeta(Hl).redo?new fa(t.done.addTransform(n,void 0,r,_p(e)),t.undone,OT(n.mapping.maps),t.prevTime,t.prevComposition):new fa(t.done,t.undone.addTransform(n,void 0,r,_p(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!RG(n,t.prevRanges)),u=o?ky(t.prevRanges,n.mapping):OT(n.mapping.maps);return new fa(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,_p(e)),Ki.empty,u,n.time,a??t.prevComposition)}else return(i=n.getMeta("rebased"))?new fa(t.done.rebased(n,i),t.undone.rebased(n,i),ky(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new fa(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),ky(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function RG(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,s)=>{for(let i=0;i<e.length;i+=2)r<=e[i+1]&&s>=e[i]&&(n=!0)}),n}function OT(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,s,i,o)=>e.push(i,o));return e}function ky(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let s=e.map(t[r],1),i=e.map(t[r+1],-1);s<=i&&n.push(s,i)}return n}function OG(t,e,n){let r=_p(e),s=Hl.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,r);if(!i)return null;let o=i.selection.resolve(i.transform.doc),a=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),s,r),l=new fa(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(o).setMeta(Hl,{redo:n,historyState:l})}let Sy=!1,PT=null;function _p(t){let e=t.plugins;if(PT!=e){Sy=!1,PT=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){Sy=!0;break}}return Sy}const Hl=new rs("history"),PG=new rs("closeHistory");function LG(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Cr({key:Hl,state:{init(){return new fa(Ki.empty,Ki.empty,null,0,-1)},apply(e,n,r){return AG(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,s=r=="historyUndo"?x5:r=="historyRedo"?b5:null;return!s||!e.editable?!1:(n.preventDefault(),s(e.state,e.dispatch))}}}})}function y5(t,e){return(n,r)=>{let s=Hl.getState(n);if(!s||(t?s.undone:s.done).eventCount==0)return!1;if(r){let i=OG(s,n,t);i&&r(e?i.scrollIntoView():i)}return!0}}const x5=y5(!1,!0),b5=y5(!0,!0),$G=Vr.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>x5(t,e),redo:()=>({state:t,dispatch:e})=>b5(t,e)}},addProseMirrorPlugins(){return[LG(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),zG=mr.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",Sn(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!$K(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$from:r,$to:s}=n,i=t();return r.parentOffset===0?i.insertContentAt({from:Math.max(r.pos-1,0),to:s.pos},{type:this.name}):sK(n)?i.insertContentAt(s.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({tr:o,dispatch:a})=>{var l;if(a){const{$to:u}=o.selection,d=u.end();if(u.nodeAfter)u.nodeAfter.isTextblock?o.setSelection(sn.create(o.doc,u.pos+1)):u.nodeAfter.isBlock?o.setSelection(Gt.create(o.doc,u.pos)):o.setSelection(sn.create(o.doc,u.pos));else{const f=(l=u.parent.type.contentMatch.defaultType)===null||l===void 0?void 0:l.create();f&&(o.insert(d,f),o.setSelection(sn.create(o.doc,d+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[PK({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),FG=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,BG=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,UG=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,HG=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,VG=ei.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",Sn(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Zl({find:FG,type:this.type}),Zl({find:UG,type:this.type})]},addPasteRules(){return[Wa({find:BG,type:this.type}),Wa({find:HG,type:this.type})]}}),WG=mr.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",Sn(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),KG="listItem",LT="textStyle",$T=/^(\d+)\.\s$/,GG=mr.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",Sn(this.options.HTMLAttributes,n),0]:["ol",Sn(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(KG,this.editor.getAttributes(LT)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=_u({find:$T,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=_u({find:$T,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(LT)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),qG=mr.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",Sn(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),YG=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,JG=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,XG=ei.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",Sn(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Zl({find:YG,type:this.type})]},addPasteRules(){return[Wa({find:JG,type:this.type})]}}),QG=mr.create({name:"text",group:"inline"}),ZG=Vr.create({name:"starterKit",addExtensions(){var t,e,n,r,s,i,o,a,l,u,d,f,h,p,m,y,x,g;const v=[];return this.options.blockquote!==!1&&v.push(tG.configure((t=this.options)===null||t===void 0?void 0:t.blockquote)),this.options.bold!==!1&&v.push(oG.configure((e=this.options)===null||e===void 0?void 0:e.bold)),this.options.bulletList!==!1&&v.push(lG.configure((n=this.options)===null||n===void 0?void 0:n.bulletList)),this.options.code!==!1&&v.push(dG.configure((r=this.options)===null||r===void 0?void 0:r.code)),this.options.codeBlock!==!1&&v.push(pG.configure((s=this.options)===null||s===void 0?void 0:s.codeBlock)),this.options.document!==!1&&v.push(mG.configure((i=this.options)===null||i===void 0?void 0:i.document)),this.options.dropcursor!==!1&&v.push(xG.configure((o=this.options)===null||o===void 0?void 0:o.dropcursor)),this.options.gapcursor!==!1&&v.push(CG.configure((a=this.options)===null||a===void 0?void 0:a.gapcursor)),this.options.hardBreak!==!1&&v.push(EG.configure((l=this.options)===null||l===void 0?void 0:l.hardBreak)),this.options.heading!==!1&&v.push(NG.configure((u=this.options)===null||u===void 0?void 0:u.heading)),this.options.history!==!1&&v.push($G.configure((d=this.options)===null||d===void 0?void 0:d.history)),this.options.horizontalRule!==!1&&v.push(zG.configure((f=this.options)===null||f===void 0?void 0:f.horizontalRule)),this.options.italic!==!1&&v.push(VG.configure((h=this.options)===null||h===void 0?void 0:h.italic)),this.options.listItem!==!1&&v.push(WG.configure((p=this.options)===null||p===void 0?void 0:p.listItem)),this.options.orderedList!==!1&&v.push(GG.configure((m=this.options)===null||m===void 0?void 0:m.orderedList)),this.options.paragraph!==!1&&v.push(qG.configure((y=this.options)===null||y===void 0?void 0:y.paragraph)),this.options.strike!==!1&&v.push(XG.configure((x=this.options)===null||x===void 0?void 0:x.strike)),this.options.text!==!1&&v.push(QG.configure((g=this.options)===null||g===void 0?void 0:g.text)),v}}),eq="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",tq="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",J1="numeric",X1="ascii",Q1="alpha",Rd="asciinumeric",pd="alphanumeric",Z1="domain",w5="emoji",nq="scheme",rq="slashscheme",_y="whitespace";function sq(t,e){return t in e||(e[t]=[]),e[t]}function Al(t,e,n){e[J1]&&(e[Rd]=!0,e[pd]=!0),e[X1]&&(e[Rd]=!0,e[Q1]=!0),e[Rd]&&(e[pd]=!0),e[Q1]&&(e[pd]=!0),e[pd]&&(e[Z1]=!0),e[w5]&&(e[Z1]=!0);for(const r in e){const s=sq(r,n);s.indexOf(t)<0&&s.push(t)}}function iq(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function As(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}As.groups={};As.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const s=e.jr[r][0],i=e.jr[r][1];if(i&&s.test(t))return i}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let s=0;s<t.length;s++)this.tt(t[s],e,n,r)},tr(t,e,n,r){r=r||As.groups;let s;return e&&e.j?s=e:(s=new As(e),n&&r&&Al(e,n,r)),this.jr.push([t,s]),s},ts(t,e,n,r){let s=this;const i=t.length;if(!i)return s;for(let o=0;o<i-1;o++)s=s.tt(t[o]);return s.tt(t[i-1],e,n,r)},tt(t,e,n,r){r=r||As.groups;const s=this;if(e&&e.j)return s.j[t]=e,e;const i=e;let o,a=s.go(t);if(a?(o=new As,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new As,i){if(r)if(o.t&&typeof o.t=="string"){const l=Object.assign(iq(o.t,r),n);Al(i,l,r)}else n&&Al(i,n,r);o.t=i}return s.j[t]=o,o}};const fn=(t,e,n,r,s)=>t.ta(e,n,r,s),dr=(t,e,n,r,s)=>t.tr(e,n,r,s),zT=(t,e,n,r,s)=>t.ts(e,n,r,s),Ct=(t,e,n,r,s)=>t.tt(e,n,r,s),jo="WORD",eb="UWORD",v5="ASCIINUMERICAL",k5="ALPHANUMERICAL",Mf="LOCALHOST",tb="TLD",nb="UTLD",Tp="SCHEME",Ec="SLASH_SCHEME",Av="NUM",rb="WS",Rv="NL",Od="OPENBRACE",Pd="CLOSEBRACE",Im="OPENBRACKET",Dm="CLOSEBRACKET",Mm="OPENPAREN",Am="CLOSEPAREN",Rm="OPENANGLEBRACKET",Om="CLOSEANGLEBRACKET",Pm="FULLWIDTHLEFTPAREN",Lm="FULLWIDTHRIGHTPAREN",$m="LEFTCORNERBRACKET",zm="RIGHTCORNERBRACKET",Fm="LEFTWHITECORNERBRACKET",Bm="RIGHTWHITECORNERBRACKET",Um="FULLWIDTHLESSTHAN",Hm="FULLWIDTHGREATERTHAN",Vm="AMPERSAND",Wm="APOSTROPHE",Km="ASTERISK",ha="AT",Gm="BACKSLASH",qm="BACKTICK",Ym="CARET",ba="COLON",Ov="COMMA",Jm="DOLLAR",to="DOT",Xm="EQUALS",Pv="EXCLAMATION",ui="HYPHEN",Ld="PERCENT",Qm="PIPE",Zm="PLUS",eg="POUND",$d="QUERY",Lv="QUOTE",S5="FULLWIDTHMIDDLEDOT",$v="SEMI",no="SLASH",zd="TILDE",tg="UNDERSCORE",_5="EMOJI",ng="SYM";var T5=Object.freeze({__proto__:null,ALPHANUMERICAL:k5,AMPERSAND:Vm,APOSTROPHE:Wm,ASCIINUMERICAL:v5,ASTERISK:Km,AT:ha,BACKSLASH:Gm,BACKTICK:qm,CARET:Ym,CLOSEANGLEBRACKET:Om,CLOSEBRACE:Pd,CLOSEBRACKET:Dm,CLOSEPAREN:Am,COLON:ba,COMMA:Ov,DOLLAR:Jm,DOT:to,EMOJI:_5,EQUALS:Xm,EXCLAMATION:Pv,FULLWIDTHGREATERTHAN:Hm,FULLWIDTHLEFTPAREN:Pm,FULLWIDTHLESSTHAN:Um,FULLWIDTHMIDDLEDOT:S5,FULLWIDTHRIGHTPAREN:Lm,HYPHEN:ui,LEFTCORNERBRACKET:$m,LEFTWHITECORNERBRACKET:Fm,LOCALHOST:Mf,NL:Rv,NUM:Av,OPENANGLEBRACKET:Rm,OPENBRACE:Od,OPENBRACKET:Im,OPENPAREN:Mm,PERCENT:Ld,PIPE:Qm,PLUS:Zm,POUND:eg,QUERY:$d,QUOTE:Lv,RIGHTCORNERBRACKET:zm,RIGHTWHITECORNERBRACKET:Bm,SCHEME:Tp,SEMI:$v,SLASH:no,SLASH_SCHEME:Ec,SYM:ng,TILDE:zd,TLD:tb,UNDERSCORE:tg,UTLD:nb,UWORD:eb,WORD:jo,WS:rb});const Co=/[a-z]/,Zu=/\p{L}/u,Ty=/\p{Emoji}/u,Eo=/\d/,Cy=/\s/,FT="\r",Ey=`
`,oq="",aq="",Ny="";let Fh=null,Bh=null;function lq(t=[]){const e={};As.groups=e;const n=new As;Fh==null&&(Fh=BT(eq)),Bh==null&&(Bh=BT(tq)),Ct(n,"'",Wm),Ct(n,"{",Od),Ct(n,"}",Pd),Ct(n,"[",Im),Ct(n,"]",Dm),Ct(n,"(",Mm),Ct(n,")",Am),Ct(n,"<",Rm),Ct(n,">",Om),Ct(n,"",Pm),Ct(n,"",Lm),Ct(n,"",$m),Ct(n,"",zm),Ct(n,"",Fm),Ct(n,"",Bm),Ct(n,"",Um),Ct(n,"",Hm),Ct(n,"&",Vm),Ct(n,"*",Km),Ct(n,"@",ha),Ct(n,"`",qm),Ct(n,"^",Ym),Ct(n,":",ba),Ct(n,",",Ov),Ct(n,"$",Jm),Ct(n,".",to),Ct(n,"=",Xm),Ct(n,"!",Pv),Ct(n,"-",ui),Ct(n,"%",Ld),Ct(n,"|",Qm),Ct(n,"+",Zm),Ct(n,"#",eg),Ct(n,"?",$d),Ct(n,'"',Lv),Ct(n,"/",no),Ct(n,";",$v),Ct(n,"~",zd),Ct(n,"_",tg),Ct(n,"\\",Gm),Ct(n,"",S5);const r=dr(n,Eo,Av,{[J1]:!0});dr(r,Eo,r);const s=dr(r,Co,v5,{[Rd]:!0}),i=dr(r,Zu,k5,{[pd]:!0}),o=dr(n,Co,jo,{[X1]:!0});dr(o,Eo,s),dr(o,Co,o),dr(s,Eo,s),dr(s,Co,s);const a=dr(n,Zu,eb,{[Q1]:!0});dr(a,Co),dr(a,Eo,i),dr(a,Zu,a),dr(i,Eo,i),dr(i,Co),dr(i,Zu,i);const l=Ct(n,Ey,Rv,{[_y]:!0}),u=Ct(n,FT,rb,{[_y]:!0}),d=dr(n,Cy,rb,{[_y]:!0});Ct(n,Ny,d),Ct(u,Ey,l),Ct(u,Ny,d),dr(u,Cy,d),Ct(d,FT),Ct(d,Ey),dr(d,Cy,d),Ct(d,Ny,d);const f=dr(n,Ty,_5,{[w5]:!0});Ct(f,"#"),dr(f,Ty,f),Ct(f,oq,f);const h=Ct(f,aq);Ct(h,"#"),dr(h,Ty,f);const p=[[Co,o],[Eo,s]],m=[[Co,null],[Zu,a],[Eo,i]];for(let y=0;y<Fh.length;y++)ta(n,Fh[y],tb,jo,p);for(let y=0;y<Bh.length;y++)ta(n,Bh[y],nb,eb,m);Al(tb,{tld:!0,ascii:!0},e),Al(nb,{utld:!0,alpha:!0},e),ta(n,"file",Tp,jo,p),ta(n,"mailto",Tp,jo,p),ta(n,"http",Ec,jo,p),ta(n,"https",Ec,jo,p),ta(n,"ftp",Ec,jo,p),ta(n,"ftps",Ec,jo,p),Al(Tp,{scheme:!0,ascii:!0},e),Al(Ec,{slashscheme:!0,ascii:!0},e),t=t.sort((y,x)=>y[0]>x[0]?1:-1);for(let y=0;y<t.length;y++){const x=t[y][0],v=t[y][1]?{[nq]:!0}:{[rq]:!0};x.indexOf("-")>=0?v[Z1]=!0:Co.test(x)?Eo.test(x)?v[Rd]=!0:v[X1]=!0:v[J1]=!0,zT(n,x,x,v)}return zT(n,"localhost",Mf,{ascii:!0}),n.jd=new As(ng),{start:n,tokens:Object.assign({groups:e},T5)}}function C5(t,e){const n=cq(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=n.length,s=[];let i=0,o=0;for(;o<r;){let a=t,l=null,u=0,d=null,f=-1,h=-1;for(;o<r&&(l=a.go(n[o]));)a=l,a.accepts()?(f=0,h=0,d=a):f>=0&&(f+=n[o].length,h++),u+=n[o].length,i+=n[o].length,o++;i-=f,o-=h,u-=f,s.push({t:d.t,v:e.slice(i-u,i),s:i-u,e:i})}return s}function cq(t){const e=[],n=t.length;let r=0;for(;r<n;){let s=t.charCodeAt(r),i,o=s<55296||s>56319||r+1===n||(i=t.charCodeAt(r+1))<56320||i>57343?t[r]:t.slice(r,r+2);e.push(o),r+=o.length}return e}function ta(t,e,n,r,s){let i;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];t.j[l]?i=t.j[l]:(i=new As(r),i.jr=s.slice(),t.j[l]=i),t=i}return i=new As(n),i.jr=s.slice(),t.j[e[o-1]]=i,i}function BT(t){const e=[],n=[];let r=0,s="0123456789";for(;r<t.length;){let i=0;for(;s.indexOf(t[r+i])>=0;)i++;if(i>0){e.push(n.join(""));for(let o=parseInt(t.substring(r,r+i),10);o>0;o--)n.pop();r+=i}else n.push(t[r]),r++}return e}const Af={defaultProtocol:"http",events:null,format:UT,formatHref:UT,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function zv(t,e=null){let n=Object.assign({},Af);t&&(n=Object.assign(n,t instanceof zv?t.o:t));const r=n.ignoreTags,s=[];for(let i=0;i<r.length;i++)s.push(r[i].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=s}zv.prototype={o:Af,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let s=this.o[t];return s&&(typeof s=="object"?(s=n.t in s?s[n.t]:Af[t],typeof s=="function"&&r&&(s=s(e,n))):typeof s=="function"&&r&&(s=s(e,n.t,n)),s)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function UT(t){return t}function E5(t,e){this.t="token",this.v=t,this.tk=e}E5.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=Af.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),s=t.get("tagName",n,e),i=this.toFormattedString(t),o={},a=t.get("className",n,e),l=t.get("target",n,e),u=t.get("rel",n,e),d=t.getObj("attributes",n,e),f=t.getObj("events",n,e);return o.href=r,a&&(o.class=a),l&&(o.target=l),u&&(o.rel=u),d&&Object.assign(o,d),{tagName:s,attributes:o,content:i,eventListeners:f}}};function Xg(t,e){class n extends E5{constructor(s,i){super(s,i),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const HT=Xg("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),VT=Xg("text"),uq=Xg("nl"),Uh=Xg("url",{isLink:!0,toHref(t=Af.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==Mf&&t[1].t===ba}}),li=t=>new As(t);function dq({groups:t}){const e=t.domain.concat([Vm,Km,ha,Gm,qm,Ym,Jm,Xm,ui,Av,Ld,Qm,Zm,eg,no,ng,zd,tg]),n=[Wm,ba,Ov,to,Pv,Ld,$d,Lv,$v,Rm,Om,Od,Pd,Dm,Im,Mm,Am,Pm,Lm,$m,zm,Fm,Bm,Um,Hm],r=[Vm,Wm,Km,Gm,qm,Ym,Jm,Xm,ui,Od,Pd,Ld,Qm,Zm,eg,$d,no,ng,zd,tg],s=li(),i=Ct(s,zd);fn(i,r,i),fn(i,t.domain,i);const o=li(),a=li(),l=li();fn(s,t.domain,o),fn(s,t.scheme,a),fn(s,t.slashscheme,l),fn(o,r,i),fn(o,t.domain,o);const u=Ct(o,ha);Ct(i,ha,u),Ct(a,ha,u),Ct(l,ha,u);const d=Ct(i,to);fn(d,r,i),fn(d,t.domain,i);const f=li();fn(u,t.domain,f),fn(f,t.domain,f);const h=Ct(f,to);fn(h,t.domain,f);const p=li(HT);fn(h,t.tld,p),fn(h,t.utld,p),Ct(u,Mf,p);const m=Ct(f,ui);Ct(m,ui,m),fn(m,t.domain,f),fn(p,t.domain,f),Ct(p,to,h),Ct(p,ui,m);const y=Ct(p,ba);fn(y,t.numeric,HT);const x=Ct(o,ui),g=Ct(o,to);Ct(x,ui,x),fn(x,t.domain,o),fn(g,r,i),fn(g,t.domain,o);const v=li(Uh);fn(g,t.tld,v),fn(g,t.utld,v),fn(v,t.domain,o),fn(v,r,i),Ct(v,to,g),Ct(v,ui,x),Ct(v,ha,u);const w=Ct(v,ba),T=li(Uh);fn(w,t.numeric,T);const D=li(Uh),k=li();fn(D,e,D),fn(D,n,k),fn(k,e,D),fn(k,n,k),Ct(v,no,D),Ct(T,no,D);const I=Ct(a,ba),C=Ct(l,ba),S=Ct(C,no),_=Ct(S,no);fn(a,t.domain,o),Ct(a,to,g),Ct(a,ui,x),fn(l,t.domain,o),Ct(l,to,g),Ct(l,ui,x),fn(I,t.domain,D),Ct(I,no,D),Ct(I,$d,D),fn(_,t.domain,D),fn(_,e,D),Ct(_,no,D);const N=[[Od,Pd],[Im,Dm],[Mm,Am],[Rm,Om],[Pm,Lm],[$m,zm],[Fm,Bm],[Um,Hm]];for(let j=0;j<N.length;j++){const[O,P]=N[j],W=Ct(D,O);Ct(k,O,W),Ct(W,P,D);const R=li(Uh);fn(W,e,R);const M=li();fn(W,n),fn(R,e,R),fn(R,n,M),fn(M,e,R),fn(M,n,M),Ct(R,P,D),Ct(M,P,D)}return Ct(s,Mf,v),Ct(s,Rv,uq),{start:s,tokens:T5}}function fq(t,e,n){let r=n.length,s=0,i=[],o=[];for(;s<r;){let a=t,l=null,u=null,d=0,f=null,h=-1;for(;s<r&&!(l=a.go(n[s].t));)o.push(n[s++]);for(;s<r&&(u=l||a.go(n[s].t));)l=null,a=u,a.accepts()?(h=0,f=a):h>=0&&h++,s++,d++;if(h<0)s-=d,s<r&&(o.push(n[s]),s++);else{o.length>0&&(i.push(jy(VT,e,o)),o=[]),s-=h,d-=h;const p=f.t,m=n.slice(s-d,s);i.push(jy(p,e,m))}}return o.length>0&&i.push(jy(VT,e,o)),i}function jy(t,e,n){const r=n[0].s,s=n[n.length-1].e,i=e.slice(r,s);return new t(i,n)}const hq=typeof console<"u"&&console&&console.warn||(()=>{}),pq="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Wn={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function mq(){return As.groups={},Wn.scanner=null,Wn.parser=null,Wn.tokenQueue=[],Wn.pluginQueue=[],Wn.customSchemes=[],Wn.initialized=!1,Wn}function WT(t,e=!1){if(Wn.initialized&&hq(`linkifyjs: already initialized - will not register custom scheme "${t}" ${pq}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Wn.customSchemes.push([t,e])}function gq(){Wn.scanner=lq(Wn.customSchemes);for(let t=0;t<Wn.tokenQueue.length;t++)Wn.tokenQueue[t][1]({scanner:Wn.scanner});Wn.parser=dq(Wn.scanner.tokens);for(let t=0;t<Wn.pluginQueue.length;t++)Wn.pluginQueue[t][1]({scanner:Wn.scanner,parser:Wn.parser});return Wn.initialized=!0,Wn}function N5(t){return Wn.initialized||gq(),fq(Wn.parser.start,t,C5(Wn.scanner.start,t))}N5.scan=C5;function Fv(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new zv(n),s=N5(t),i=[];for(let o=0;o<s.length;o++){const a=s[o];a.isLink&&(!e||a.t===e)&&r.check(a)&&i.push(a.toFormattedObject(r))}return i}function yq(t){return new Cr({key:new rs("autolink"),appendTransaction:(e,n,r)=>{const s=e.some(u=>u.docChanged)&&!n.doc.eq(r.doc),i=e.some(u=>u.getMeta("preventAutolink"));if(!s||i)return;const{tr:o}=r,a=JW(n.doc,[...e]);if(rK(a).forEach(({newRange:u})=>{const d=XW(r.doc,u,p=>p.isTextblock);let f,h;if(d.length>1?(f=d[0],h=r.doc.textBetween(f.pos,f.pos+f.node.nodeSize,void 0," ")):d.length&&r.doc.textBetween(u.from,u.to," "," ").endsWith(" ")&&(f=d[0],h=r.doc.textBetween(f.pos,u.to,void 0," ")),f&&h){const p=h.split(" ").filter(x=>x!=="");if(p.length<=0)return!1;const m=p[p.length-1],y=f.pos+h.lastIndexOf(m);if(!m)return!1;Fv(m).filter(x=>x.isLink).map(x=>({...x,from:y+x.start+1,to:y+x.end+1})).filter(x=>r.schema.marks.code?!r.doc.rangeHasMark(x.from,x.to,r.schema.marks.code):!0).filter(x=>t.validate?t.validate(x.value):!0).forEach(x=>{Iv(x.from,x.to,r.doc).some(g=>g.mark.type===t.type)||o.addMark(x.from,x.to,t.type.create({href:x.href}))})}}),!!o.steps.length)return o}})}function xq(t){return new Cr({key:new rs("handleClickLink"),props:{handleClick:(e,n,r)=>{var s,i;if(r.button!==0)return!1;let o=r.target;const a=[];for(;o.nodeName!=="DIV";)a.push(o),o=o.parentNode;if(!a.find(h=>h.nodeName==="A"))return!1;const l=f5(e.state,t.type.name),u=r.target,d=(s=u==null?void 0:u.href)!==null&&s!==void 0?s:l.href,f=(i=u==null?void 0:u.target)!==null&&i!==void 0?i:l.target;return u&&d?(window.open(d,f),!0):!1}}})}function bq(t){return new Cr({key:new rs("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{state:s}=e,{selection:i}=s,{empty:o}=i;if(o)return!1;let a="";r.content.forEach(u=>{a+=u.textContent});const l=Fv(a).find(u=>u.isLink&&u.value===a);return!a||!l?!1:(t.editor.commands.setMark(t.type,{href:l.href}),!0)}}})}const wq=ei.create({name:"link",priority:1e3,keepOnSplit:!1,onCreate(){this.options.protocols.forEach(t=>{if(typeof t=="string"){WT(t);return}WT(t.scheme,t.optionalSlashes)})},onDestroy(){mq()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},validate:void 0}},addAttributes(){return{href:{default:null},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:'a[href]:not([href *= "javascript:" i])'}]},renderHTML({HTMLAttributes:t}){var e;return!((e=t.href)===null||e===void 0)&&e.startsWith("javascript:")?["a",Sn(this.options.HTMLAttributes,{...t,href:""}),0]:["a",Sn(this.options.HTMLAttributes,t),0]},addCommands(){return{setLink:t=>({chain:e})=>e().setMark(this.name,t).setMeta("preventAutolink",!0).run(),toggleLink:t=>({chain:e})=>e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run(),unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Wa({find:t=>{const e=[];if(t){const n=Fv(t).filter(r=>r.isLink);n.length&&n.forEach(r=>e.push({text:r.value,data:{href:r.href},index:r.start}))}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[];return this.options.autolink&&t.push(yq({type:this.type,validate:this.options.validate})),this.options.openOnClick&&t.push(xq({type:this.type})),this.options.linkOnPaste&&t.push(bq({editor:this.editor,type:this.type})),t}}),vq=Vr.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,considerAnyAsEmpty:!1,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new Cr({key:new rs("placeholder"),props:{decorations:({doc:t,selection:e})=>{var n;const r=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:s}=e,i=[];if(!r)return null;const{firstChild:o}=t.content,a=o&&o.type.isLeaf,l=o&&o.isAtom,u=this.options.considerAnyAsEmpty?!0:o&&o.type.name===((n=t.type.contentMatch.defaultType)===null||n===void 0?void 0:n.name),d=t.content.childCount<=1&&o&&u&&o.nodeSize<=2&&(!a||!l);return t.descendants((f,h)=>{const p=s>=h&&s<=h+f.nodeSize,m=!f.isLeaf&&!f.childCount;if((p||!this.options.showOnlyCurrent)&&m){const y=[this.options.emptyNodeClass];d&&y.push(this.options.emptyEditorClass);const x=Ps.node(h,h+f.nodeSize,{class:y.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:f,pos:h,hasAnchor:p}):this.options.placeholder});i.push(x)}return this.options.includeChildren}),xr.create(t,i)}}})]}}),kq=mr.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",Sn(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}}),Sq=/^\s*(\[([( |x])?\])\s$/,_q=mr.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList"}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>t.getAttribute("data-checked")==="true",renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",Sn(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:n,editor:r})=>{const s=document.createElement("li"),i=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div");return i.contentEditable="false",a.type="checkbox",a.addEventListener("change",u=>{if(!r.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:d}=u.target;r.isEditable&&typeof n=="function"&&r.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:f})=>{const h=n(),p=f.doc.nodeAt(h);return f.setNodeMarkup(h,void 0,{...p==null?void 0:p.attrs,checked:d}),!0}).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,d)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([u,d])=>{s.setAttribute(u,d)}),s.dataset.checked=t.attrs.checked,t.attrs.checked&&a.setAttribute("checked","checked"),i.append(a,o),s.append(i,l),Object.entries(e).forEach(([u,d])=>{s.setAttribute(u,d)}),{dom:s,contentDOM:l,update:u=>u.type!==this.type?!1:(s.dataset.checked=u.attrs.checked,u.attrs.checked?a.setAttribute("checked","checked"):a.removeAttribute("checked"),!0)}}},addInputRules(){return[_u({find:Sq,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),Tq=t=>{if(!t.children.length)return;const e=t.querySelectorAll("span");e&&e.forEach(n=>{var r,s;const i=n.getAttribute("style"),o=(s=(r=n.parentElement)===null||r===void 0?void 0:r.closest("span"))===null||s===void 0?void 0:s.getAttribute("style");n.setAttribute("style",`${o};${i}`)})},Cq=ei.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{},mergeNestedSpanStyles:!1}},parseHTML(){return[{tag:"span",getAttrs:t=>t.hasAttribute("style")?(this.options.mergeNestedSpanStyles&&Tq(t),{}):!1}]},renderHTML({HTMLAttributes:t}){return["span",Sn(this.options.HTMLAttributes,t),0]},addCommands(){return{removeEmptyTextStyle:()=>({tr:t})=>{const{selection:e}=t;return t.doc.nodesBetween(e.from,e.to,(n,r)=>{if(n.isTextblock)return!0;n.marks.filter(s=>s.type===this.type).some(s=>Object.values(s.attrs).some(i=>!!i))||t.removeMark(r,r+n.nodeSize,this.type)}),!0}}}}),Eq=Vr.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:t=>{var e;return(e=t.style.color)===null||e===void 0?void 0:e.replace(/['"]+/g,"")},renderHTML:t=>t.color?{style:`color: ${t.color}`}:{}}}}]},addCommands(){return{setColor:t=>({chain:e})=>e().setMark("textStyle",{color:t}).run(),unsetColor:()=>({chain:t})=>t().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}),Nq=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))$/,jq=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))/g,Iq=ei.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",Sn(this.options.HTMLAttributes,t),0]},addCommands(){return{setHighlight:t=>({commands:e})=>e.setMark(this.name,t),toggleHighlight:t=>({commands:e})=>e.toggleMark(this.name,t),unsetHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[Zl({find:Nq,type:this.type})]},addPasteRules(){return[Wa({find:jq,type:this.type})]}}),rg=(t,e)=>e.view.domAtPos(t).node.offsetParent!==null,Dq=(t,e,n)=>{for(let r=t.depth;r>0;r-=1){const s=t.node(r),i=e(s),o=rg(t.start(r),n);if(i&&o)return{pos:r>0?t.before(r):0,start:t.start(r),depth:r,node:s}}},KT=(t,e)=>{const{state:n,view:r,extensionManager:s}=t,{schema:i,selection:o}=n,{empty:a,$anchor:l}=o,u=!!s.extensions.find(g=>g.name==="gapCursor");if(!a||l.parent.type!==i.nodes.detailsSummary||!u||e==="right"&&l.parentOffset!==l.parent.nodeSize-2)return!1;const d=Lu(g=>g.type===i.nodes.details)(o);if(!d)return!1;const f=kp(d.node,g=>g.type===i.nodes.detailsContent);if(!f.length||rg(d.start+f[0].pos+1,t))return!1;const p=n.doc.resolve(d.pos+d.node.nodeSize),m=Zn.findFrom(p,1,!1);if(!m)return!1;const{tr:y}=n,x=new Zn(m);return y.setSelection(x),y.scrollIntoView(),r.dispatch(y),!0},Mq=mr.create({name:"details",content:"detailsSummary detailsContent",group:"block",defining:!0,isolating:!0,allowGapCursor:!1,addOptions(){return{persist:!1,openClassName:"is-open",HTMLAttributes:{}}},addAttributes(){return this.options.persist?{open:{default:!1,parseHTML:t=>t.hasAttribute("open"),renderHTML:({open:t})=>t?{open:""}:{}}}:[]},parseHTML(){return[{tag:"details"}]},renderHTML({HTMLAttributes:t}){return["details",Sn(this.options.HTMLAttributes,t),0]},addNodeView(){return({editor:t,getPos:e,node:n,HTMLAttributes:r})=>{const s=document.createElement("div"),i=Sn(this.options.HTMLAttributes,r,{"data-type":this.name});Object.entries(i).forEach(([u,d])=>s.setAttribute(u,d));const o=document.createElement("button");o.type="button",s.append(o);const a=document.createElement("div");s.append(a);const l=u=>{if(u!==void 0)if(u){if(s.classList.contains(this.options.openClassName))return;s.classList.add(this.options.openClassName)}else{if(!s.classList.contains(this.options.openClassName))return;s.classList.remove(this.options.openClassName)}else s.classList.toggle(this.options.openClassName);const d=new Event("toggleDetailsContent"),f=a.querySelector(':scope > div[data-type="detailsContent"]');f==null||f.dispatchEvent(d)};return n.attrs.open&&setTimeout(()=>l()),o.addEventListener("click",()=>{if(l(),!this.options.persist){t.commands.focus(void 0,{scrollIntoView:!1});return}if(t.isEditable&&typeof e=="function"){const{from:u,to:d}=t.state.selection;t.chain().command(({tr:f})=>{const h=e(),p=f.doc.nodeAt(h);return(p==null?void 0:p.type)!==this.type?!1:(f.setNodeMarkup(h,void 0,{open:!p.attrs.open}),!0)}).setTextSelection({from:u,to:d}).focus(void 0,{scrollIntoView:!1}).run()}}),{dom:s,contentDOM:a,ignoreMutation(u){return u.type==="selection"?!1:!s.contains(u.target)||s===u.target},update:u=>u.type!==this.type?!1:(u.attrs.open!==void 0&&l(u.attrs.open),!0)}}},addCommands(){return{setDetails:()=>({state:t,chain:e})=>{var n;const{schema:r,selection:s}=t,{$from:i,$to:o}=s,a=i.blockRange(o);if(!a)return!1;const l=t.doc.slice(a.start,a.end);if(!r.nodes.detailsContent.contentMatch.matchFragment(l.content))return!1;const d=((n=l.toJSON())===null||n===void 0?void 0:n.content)||[];return e().insertContentAt({from:a.start,to:a.end},{type:this.name,content:[{type:"detailsSummary"},{type:"detailsContent",content:d}]}).setTextSelection(a.start+2).run()},unsetDetails:()=>({state:t,chain:e})=>{const{selection:n,schema:r}=t,s=Lu(g=>g.type===this.type)(n);if(!s)return!1;const i=kp(s.node,g=>g.type===r.nodes.detailsSummary),o=kp(s.node,g=>g.type===r.nodes.detailsContent);if(!i.length||!o.length)return!1;const a=i[0],l=o[0],u=s.pos,d=t.doc.resolve(u),f=u+s.node.nodeSize,h={from:u,to:f},p=l.node.content.toJSON()||[],m=d.parent.type.contentMatch.defaultType,x=[m==null?void 0:m.create(null,a.node.content).toJSON(),...p];return e().insertContentAt(h,x).setTextSelection(u+1).run()}}},addKeyboardShortcuts(){return{Backspace:()=>{const{schema:t,selection:e}=this.editor.state,{empty:n,$anchor:r}=e;return!n||r.parent.type!==t.nodes.detailsSummary?!1:r.parentOffset!==0?this.editor.commands.command(({tr:s})=>{const i=r.pos-1,o=r.pos;return s.delete(i,o),!0}):this.editor.commands.unsetDetails()},Enter:({editor:t})=>{const{state:e,view:n}=t,{schema:r,selection:s}=e,{$head:i}=s;if(i.parent.type!==r.nodes.detailsSummary)return!1;const o=rg(i.after()+1,t),a=o?e.doc.nodeAt(i.after()):i.node(-2);if(!a)return!1;const l=o?0:i.indexAfter(-1),u=jv(a.contentMatchAt(l));if(!u||!a.canReplaceWith(l,l,u))return!1;const d=u.createAndFill();if(!d)return!1;const f=o?i.after()+1:i.after(-1),h=e.tr.replaceWith(f,f,d),p=h.doc.resolve(f),m=ln.near(p,1);return h.setSelection(m),h.scrollIntoView(),n.dispatch(h),!0},ArrowRight:({editor:t})=>KT(t,"right"),ArrowDown:({editor:t})=>KT(t,"down")}},addProseMirrorPlugins(){return[new Cr({key:new rs("detailsSelection"),appendTransaction:(t,e,n)=>{const{editor:r,type:s}=this;if(!t.some(x=>x.selectionSet)||!e.selection.empty||!n.selection.empty||!h5(n,s.name))return;const{$from:a}=n.selection;if(rg(a.pos,r))return;const u=Dq(a,x=>x.type===s,r);if(!u)return;const d=kp(u.node,x=>x.type===n.schema.nodes.detailsSummary);if(!d.length)return;const f=d[0],p=(e.selection.from<n.selection.from?"forward":"backward")==="forward"?u.start+f.pos:u.pos+f.pos+f.node.nodeSize,m=sn.create(n.doc,p);return n.tr.setSelection(m)}})]}}),Aq=mr.create({name:"detailsSummary",content:"text*",defining:!0,selectable:!1,isolating:!0,addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"summary"}]},renderHTML({HTMLAttributes:t}){return["summary",Sn(this.options.HTMLAttributes,t),0]}}),Rq=mr.create({name:"detailsContent",content:"block+",defining:!0,selectable:!1,addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:`div[data-type="${this.name}"]`}]},renderHTML({HTMLAttributes:t}){return["div",Sn(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},addNodeView(){return({HTMLAttributes:t})=>{const e=document.createElement("div"),n=Sn(this.options.HTMLAttributes,t,{"data-type":this.name,hidden:"hidden"});return Object.entries(n).forEach(([r,s])=>e.setAttribute(r,s)),e.addEventListener("toggleDetailsContent",()=>{e.toggleAttribute("hidden")}),{dom:e,contentDOM:e,ignoreMutation(r){return r.type==="selection"?!1:!e.contains(r.target)||e===r.target},update:r=>r.type===this.type}}},addKeyboardShortcuts(){return{Enter:({editor:t})=>{const{state:e,view:n}=t,{selection:r}=e,{$from:s,empty:i}=r,o=Lu(N=>N.type===this.type)(r);if(!i||!o||!o.node.childCount)return!1;const a=s.index(o.depth),{childCount:l}=o.node;if(!(l===a+1))return!1;const d=o.node.type.contentMatch.defaultType,f=d==null?void 0:d.createAndFill();if(!f)return!1;const h=e.doc.resolve(o.pos+1),p=l-1,m=o.node.child(p),y=h.posAtIndex(p,o.depth);if(!m.eq(f))return!1;const g=s.node(-3);if(!g)return!1;const v=s.indexAfter(-3),w=jv(g.contentMatchAt(v));if(!w||!g.canReplaceWith(v,v,w))return!1;const T=w.createAndFill();if(!T)return!1;const{tr:D}=e,k=s.after(-2);D.replaceWith(k,k,T);const I=D.doc.resolve(k),C=ln.near(I,1);D.setSelection(C);const S=y,_=y+m.nodeSize;return D.delete(S,_),D.scrollIntoView(),n.dispatch(D),!0}}}});function Oq(t){var e;const{char:n,allowSpaces:r,allowToIncludeChar:s,allowedPrefixes:i,startOfLine:o,$position:a}=t,l=r&&!s,u=zK(n),d=new RegExp(`\\s${u}$`),f=o?"^":"",h=s?"":u,p=l?new RegExp(`${f}${u}.*?(?=\\s${h}|$)`,"gm"):new RegExp(`${f}(?:^)?${u}[^\\s${h}]*`,"gm"),m=((e=a.nodeBefore)===null||e===void 0?void 0:e.isText)&&a.nodeBefore.text;if(!m)return null;const y=a.pos-m.length,x=Array.from(m.matchAll(p)).pop();if(!x||x.input===void 0||x.index===void 0)return null;const g=x.input.slice(Math.max(0,x.index-1),x.index),v=new RegExp(`^[${i==null?void 0:i.join("")}\0]?$`).test(g);if(i!==null&&!v)return null;const w=y+x.index;let T=w+x[0].length;return l&&d.test(m.slice(T-1,T+1))&&(x[0]+=" ",T+=1),w<a.pos&&T>=a.pos?{range:{from:w,to:T},query:x[0].slice(n.length),text:x[0]}:null}const Pq=new rs("suggestion");function Lq({pluginKey:t=Pq,editor:e,char:n="@",allowSpaces:r=!1,allowToIncludeChar:s=!1,allowedPrefixes:i=[" "],startOfLine:o=!1,decorationTag:a="span",decorationClass:l="suggestion",decorationContent:u="",decorationEmptyClass:d="is-empty",command:f=()=>null,items:h=()=>[],render:p=()=>({}),allow:m=()=>!0,findSuggestionMatch:y=Oq}){let x;const g=p==null?void 0:p(),v=new Cr({key:t,view(){return{update:async(w,T)=>{var D,k,I,C,S,_,N;const j=(D=this.key)===null||D===void 0?void 0:D.getState(T),O=(k=this.key)===null||k===void 0?void 0:k.getState(w.state),P=j.active&&O.active&&j.range.from!==O.range.from,W=!j.active&&O.active,R=j.active&&!O.active,M=!W&&!R&&j.query!==O.query,X=W||P&&M,Q=M||P,A=R||P&&M;if(!X&&!Q&&!A)return;const Te=A&&!X?j:O,we=w.dom.querySelector(`[data-decoration-id="${Te.decorationId}"]`);x={editor:e,range:Te.range,query:Te.query,text:Te.text,items:[],command:B=>f({editor:e,range:Te.range,props:B}),decorationNode:we,clientRect:we?()=>{var B;const{decorationId:F}=(B=this.key)===null||B===void 0?void 0:B.getState(e.state),ne=w.dom.querySelector(`[data-decoration-id="${F}"]`);return(ne==null?void 0:ne.getBoundingClientRect())||null}:null},X&&((I=g==null?void 0:g.onBeforeStart)===null||I===void 0||I.call(g,x)),Q&&((C=g==null?void 0:g.onBeforeUpdate)===null||C===void 0||C.call(g,x)),(Q||X)&&(x.items=await h({editor:e,query:Te.query})),A&&((S=g==null?void 0:g.onExit)===null||S===void 0||S.call(g,x)),Q&&((_=g==null?void 0:g.onUpdate)===null||_===void 0||_.call(g,x)),X&&((N=g==null?void 0:g.onStart)===null||N===void 0||N.call(g,x))},destroy:()=>{var w;x&&((w=g==null?void 0:g.onExit)===null||w===void 0||w.call(g,x))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(w,T,D,k){const{isEditable:I}=e,{composing:C}=e.view,{selection:S}=w,{empty:_,from:N}=S,j={...T};if(j.composing=C,I&&(_||e.view.composing)){(N<T.range.from||N>T.range.to)&&!C&&!T.composing&&(j.active=!1);const O=y({char:n,allowSpaces:r,allowToIncludeChar:s,allowedPrefixes:i,startOfLine:o,$position:S.$from}),P=`id_${Math.floor(Math.random()*4294967295)}`;O&&m({editor:e,state:k,range:O.range,isActive:T.active})?(j.active=!0,j.decorationId=T.decorationId?T.decorationId:P,j.range=O.range,j.query=O.query,j.text=O.text):j.active=!1}else j.active=!1;return j.active||(j.decorationId=null,j.range={from:0,to:0},j.query=null,j.text=null),j}},props:{handleKeyDown(w,T){var D;const{active:k,range:I}=v.getState(w.state);return k&&((D=g==null?void 0:g.onKeyDown)===null||D===void 0?void 0:D.call(g,{view:w,event:T,range:I}))||!1},decorations(w){const{active:T,range:D,decorationId:k,query:I}=v.getState(w);if(!T)return null;const C=!(I!=null&&I.length),S=[l];return C&&S.push(d),xr.create(w.doc,[Ps.inline(D.from,D.to,{nodeName:a,class:S.join(" "),"data-decoration-id":k,"data-decoration-content":u})])}}});return v}function $q({editor:t,overrideSuggestionOptions:e,extensionName:n,char:r="@"}){const s=new rs;return{editor:t,char:r,pluginKey:s,command:({editor:i,range:o,props:a})=>{var l,u,d;const f=i.view.state.selection.$to.nodeAfter;((l=f==null?void 0:f.text)===null||l===void 0?void 0:l.startsWith(" "))&&(o.to+=1),i.chain().focus().insertContentAt(o,[{type:n,attrs:{...a,mentionSuggestionChar:r}},{type:"text",text:" "}]).run(),(d=(u=i.view.dom.ownerDocument.defaultView)===null||u===void 0?void 0:u.getSelection())===null||d===void 0||d.collapseToEnd()},allow:({state:i,range:o})=>{const a=i.doc.resolve(o.from),l=i.schema.nodes[n];return!!a.parent.type.contentMatch.matchType(l)},...e}}function j5(t){return(t.options.suggestions.length?t.options.suggestions:[t.options.suggestion]).map(e=>$q({editor:t.editor,overrideSuggestionOptions:e,extensionName:t.name,char:e.char}))}function GT(t,e){const n=j5(t),r=n.find(s=>s.char===e);return r||(n.length?n[0]:null)}const zq=mr.create({name:"mention",priority:101,addOptions(){return{HTMLAttributes:{},renderText({node:t,suggestion:e}){var n,r;return`${(n=e==null?void 0:e.char)!==null&&n!==void 0?n:"@"}${(r=t.attrs.label)!==null&&r!==void 0?r:t.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:t,node:e,suggestion:n}){var r,s;return["span",Sn(this.HTMLAttributes,t.HTMLAttributes),`${(r=n==null?void 0:n.char)!==null&&r!==void 0?r:"@"}${(s=e.attrs.label)!==null&&s!==void 0?s:e.attrs.id}`]},suggestions:[],suggestion:{}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}},mentionSuggestionChar:{default:"@",parseHTML:t=>t.getAttribute("data-mention-suggestion-char"),renderHTML:t=>({"data-mention-suggestion-char":t.mentionSuggestionChar})}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:e}){const n=GT(this,t.attrs.mentionSuggestionChar);if(this.options.renderLabel!==void 0)return console.warn("renderLabel is deprecated use renderText and renderHTML instead"),["span",Sn({"data-type":this.name},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:t,suggestion:n})];const r={...this.options};r.HTMLAttributes=Sn({"data-type":this.name},this.options.HTMLAttributes,e);const s=this.options.renderHTML({options:r,node:t,suggestion:n});return typeof s=="string"?["span",Sn({"data-type":this.name},this.options.HTMLAttributes,e),s]:s},renderText({node:t}){const e={options:this.options,node:t,suggestion:GT(this,t.attrs.mentionSuggestionChar)};return this.options.renderLabel!==void 0?(console.warn("renderLabel is deprecated use renderText and renderHTML instead"),this.options.renderLabel(e)):this.options.renderText(e)},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:t,state:e})=>{let n=!1;const{selection:r}=e,{empty:s,anchor:i}=r;if(!s)return!1;e.doc.nodesBetween(i-1,i,(l,u)=>{if(l.type.name===this.name)return n=!0,t.insertText(this.options.deleteTriggerWithBackspace?"":this.options.suggestion.char||"",u,u+l.nodeSize),!1});let o=new Fo,a=0;return e.doc.nodesBetween(i-1,i,(l,u)=>{if(l.type.name===this.name)return n=!0,o=l,a=u,!1}),n&&t.insertText(this.options.deleteTriggerWithBackspace?"":o.attrs.mentionSuggestionChar,a,a+o.nodeSize),n})}},addProseMirrorPlugins(){return j5(this).map(Lq)}}),Fq=(t,e)=>Vr.create({name:"keyboardNavigation",addKeyboardShortcuts(){return{Enter:()=>(e&&e(),!1),Tab:({editor:n})=>{var a;if(n.isEmpty)return!1;const{state:r}=n,{selection:s}=r,{$from:i}=s;return((a=i.node(-1))==null?void 0:a.type.name)==="listItem"?n.commands.sinkListItem("listItem"):n.commands.insertContent("")},"Shift-Tab":({editor:n})=>{var a;if(n.isEmpty)return!1;const{state:r}=n,{selection:s}=r,{$from:i}=s;if(((a=i.node(-1))==null?void 0:a.type.name)==="listItem")return n.commands.liftListItem("listItem");{const{$anchor:l}=s,d=l.parent.textContent.substring(0,l.parentOffset).match(/[\u00A0 ]{1,4}$/);if(d){const f=l.pos-d[0].length,h=l.pos;return n.commands.deleteRange({from:f,to:h}),!0}}return!0},"Mod-Enter":()=>t?(t(),!0):!1,Escape:()=>!1,"Mod-Alt-5":({editor:n})=>n.chain().focus().toggleBulletList().run(),"Mod-Alt-6":({editor:n})=>n.chain().focus().toggleOrderedList().run(),"Mod-Alt-7":({editor:n})=>n.isActive("details")?n.chain().focus().unsetDetails().run():n.chain().focus().setDetails().run()}}}),Bq=ei.create({name:"timestamp",inclusive:!1,excludes:"",addAttributes(){return{time:{default:0,parseHTML:t=>parseInt(t.getAttribute("data-time")||"0",10),renderHTML:t=>t.time?{"data-time":t.time}:{}},recordingId:{default:null,parseHTML:t=>t.getAttribute("data-recording-id"),renderHTML:t=>t.recordingId?{"data-recording-id":t.recordingId,class:"timestamp-marker cursor-pointer hover:bg-indigo-100/50 hover:text-indigo-800 transition-colors rounded-sm px-[1px]",title:`Jump to ${Math.floor(t.time/1e3)}s`}:{}}}},parseHTML(){return[{tag:"span[data-time]"}]},renderHTML({HTMLAttributes:t}){return["span",Sn(t),0]}}),Uq=mr.create({name:"paragraph",priority:1e3,group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",Sn(t),0]},addAttributes(){return{"data-paragraph-id":{default:null,parseHTML:t=>t.getAttribute("data-paragraph-id"),renderHTML:t=>t["data-paragraph-id"]?{"data-paragraph-id":t["data-paragraph-id"]}:{}},"data-timestamp":{default:null,parseHTML:t=>t.getAttribute("data-timestamp"),renderHTML:t=>t["data-timestamp"]?{"data-timestamp":t["data-timestamp"],class:"cursor-pointer hover:bg-indigo-50/50 transition-colors rounded px-1 -mx-1",title:"Click to play audio"}:{}}}}}),Hq=ei.create({name:"attachmentLink",addAttributes(){return{attachmentUrls:{default:[],parseHTML:t=>{const e=t.getAttribute("data-attachment-urls");return e?JSON.parse(e):[]},renderHTML:t=>!t.attachmentUrls||t.attachmentUrls.length===0?{}:{"data-attachment-urls":JSON.stringify(t.attachmentUrls)}}}},parseHTML(){return[{tag:"span[data-attachment-link]"}]},renderHTML({HTMLAttributes:t}){return["span",Sn(t,{"data-attachment-link":"true",class:"attachment-link-text cursor-pointer"}),0]}}),Vq=({node:t})=>null,Wq=mr.create({name:"audioMarker",group:"inline",inline:!0,atom:!0,addAttributes(){return{id:{default:null},time:{default:null},label:{default:"0:00"},fileName:{default:null}}},parseHTML(){return[{tag:'span[data-type="audio-marker"]'}]},renderHTML({HTMLAttributes:t}){return["span",Sn(t,{"data-type":"audio-marker"})]},addNodeView(){return ZK(Vq)}}),Bv=b.forwardRef(({initialContent:t,onChange:e,onExit:n,onPolish:r,onEditorReady:s,editable:i=!0,className:o="",placeholder:a="",textSizeClass:l="text-base",descFontClass:u="font-normal",autoFocus:d=!1,onAudioMarkerClick:f,activeMarkerIds:h,onMarkersChange:p,attachments:m=[],taskColor:y="#6366f1",availableTags:x=[],onCreateTag:g},v)=>{const{t:w}=b.useContext(Tn),[T,D]=b.useState(!1),[k,I]=b.useState({top:0,left:0}),C=b.useRef(null),S=b.useRef(x),_=b.useRef(g),N=b.useRef(!1),j=b.useRef(e);b.useEffect(()=>{S.current=x},[x]),b.useEffect(()=>{_.current=g},[g]),b.useEffect(()=>{j.current=e},[e]);const[O,P]=b.useState(!1),[W,R]=b.useState({top:0,left:0}),[M,X]=b.useState(null),[Q,A]=b.useState([]),[Te,we]=b.useState(!1),[B,F]=b.useState({top:0,left:0}),[ne,We]=b.useState([]);b.useImperativeHandle(v,()=>({toggleRecording:()=>{},chain:()=>{var K;return(K=Xe.current)==null?void 0:K.chain()},focus:()=>{var K;return(K=Xe.current)==null?void 0:K.commands.focus()},insertContent:K=>{var ue;return(ue=Xe.current)==null?void 0:ue.commands.insertContent(K)},getEditor:()=>Xe.current}));const{isRecording:ft,recordingTime:le,addMarker:De,currentRecordingId:ie}=b.useContext(Du),Fe=b.useRef(le),_e=b.useRef(ie),tt=b.useRef(ft);b.useEffect(()=>{Fe.current=le,_e.current=ie,tt.current=ft},[le,ie,ft]);const Xe=b.useRef(null);b.useEffect(()=>{window.__activeMarkerIds=h,window.dispatchEvent(new CustomEvent("active-markers-change",{detail:{ids:h}}))},[h]),b.useEffect(()=>{const K=ue=>{var re;f&&((re=ue.detail)==null?void 0:re.time)!==void 0&&f(ue.detail.time)};return window.addEventListener("audio-marker-click",K),()=>{window.removeEventListener("audio-marker-click",K)}},[f]);const Ve=K=>{const ue=Math.floor(K/1e3),re=Math.floor(ue/60),oe=ue%60;return`${re.toString().padStart(2,"0")}:${oe.toString().padStart(2,"0")}`},it=()=>{if(ft&&Xe.current){const K=De();if(K){const{id:ue,time:re}=K;console.log("Enter pressed during recording at:",re);const oe=Ve(re);Xe.current.chain().insertContent({type:"audioMarker",attrs:{id:ue,time:re,label:oe}}).insertContent(" ").run()}}},Ue=KK({extensions:[ZG.configure({paragraph:!1,bulletList:{keepMarks:!0,keepAttributes:!1},orderedList:{keepMarks:!0,keepAttributes:!1}}),Uq,Bq,Wq,Cq,Eq,Iq.configure({multicolor:!0}),wq.configure({openOnClick:!1,autolink:!0}),vq.configure({placeholder:a||w("addNotePlaceholder"),emptyEditorClass:"is-editor-empty before:content-[attr(data-placeholder)] before:text-slate-300 before:float-left before:pointer-events-none before:h-0"}),kq,_q.configure({nested:!0}),Mq.configure({persist:!0,HTMLAttributes:{class:"details"}}),Aq,Rq,Hq,zq.configure({HTMLAttributes:{class:"tag-mention"},renderLabel({node:K}){return K.attrs.label??K.attrs.id},suggestion:{char:"@",allowSpaces:!1,items:({query:K})=>{const ue=S.current;if(!K)return ue.slice(0,10);const re=K.toLowerCase();return ue.filter(pe=>pe.name.toLowerCase().includes(re)).slice(0,10)},render:()=>{let K=null,ue=0,re=[],oe=null;return{onStart:pe=>{var Se;N.current=!0,re=pe.items,ue=0,K=document.createElement("div"),K.className="mention-suggestion-popup fixed z-[99999] bg-white dark:bg-gray-800 shadow-lg rounded-lg border border-gray-200 dark:border-gray-700 py-1 min-w-[200px] max-w-[300px] max-h-[300px] overflow-y-auto",document.body.appendChild(K),oe={command:pe.command,query:pe.query,range:pe.range,onKeyDown:({event:Pe})=>{if(Pe.key==="ArrowDown"){Pe.preventDefault();const ye=re.length>0?re.length:0,Ze=(oe==null?void 0:oe.query)&&oe.query.trim().length>0?ye+1:ye;return ue=(ue+1)%Ze,oe==null||oe.updateItems(re,oe.query),!0}if(Pe.key==="ArrowUp"){Pe.preventDefault();const ze=(oe==null?void 0:oe.query)&&oe.query.trim().length>0?re.length+1:re.length;return ue=(ue-1+ze)%ze,oe==null||oe.updateItems(re,oe.query),!0}return Pe.key==="Enter"?(Pe.preventDefault(),oe==null||oe.selectItem(ue),!0):Pe.key==="Escape"?(Pe.preventDefault(),!0):!1},updateItems:(Pe,ye)=>{if(re=Pe,!K)return;const ze=ye&&ye.trim().length>0&&!Pe.some(Ze=>Ze.name.toLowerCase()===ye.toLowerCase());if(K.innerHTML="",Pe.length===0&&!ze){K.innerHTML='<div class="px-3 py-2 text-sm text-gray-400"></div>';return}if(Pe.forEach((Ze,gt)=>{const vt=document.createElement("div");vt.className=`px-3 py-2 cursor-pointer flex items-center gap-2 text-sm ${gt===ue?"bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,vt.innerHTML=`
                                                <span class="w-2 h-2 rounded-full" style="background-color: ${Ze.color||"#6366f1"}"></span>
                                                <span class="truncate">${Ze.name}</span>
                                            `,vt.addEventListener("mouseenter",()=>{ue=gt,oe==null||oe.updateItems(re,ye)}),vt.addEventListener("mousedown",me=>{me.preventDefault(),oe==null||oe.selectItem(gt)}),K.appendChild(vt)}),ze){const Ze=Pe.length,gt=document.createElement("div");gt.className=`px-3 py-2 cursor-pointer flex items-center gap-2 text-sm border-t border-gray-100 dark:border-gray-700 ${ue===Ze?"bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,gt.innerHTML=`
                                                <span class="text-green-500">+</span>
                                                <span> "<strong>${ye}</strong>"</span>
                                            `,gt.addEventListener("mouseenter",()=>{ue=Ze,oe==null||oe.updateItems(re,ye)}),gt.addEventListener("mousedown",vt=>{vt.preventDefault(),oe==null||oe.selectItem(Ze)}),K.appendChild(gt)}},selectItem:async Pe=>{const ye=(oe==null?void 0:oe.query)&&oe.query.trim().length>0&&!re.some(vt=>vt.name.toLowerCase()===oe.query.toLowerCase()),ze=oe==null?void 0:oe.command,Ze=oe==null?void 0:oe.range,gt=Xe.current;if(Pe<re.length){const vt=re[Pe];ze&&ze({id:vt.id,label:vt.name})}else if(ye&&_.current&&Ze&&gt){const vt=oe.query.trim(),{from:me,to:He}=Ze;K&&(K.remove(),K=null),N.current=!1;const qe=await _.current(vt);qe&&Xe.current&&Xe.current.chain().focus().deleteRange({from:me,to:He}).insertContentAt(me,{type:"mention",attrs:{id:qe.id,label:qe.name}}).run()}}},oe.updateItems(re,pe.query);const se=(Se=pe.clientRect)==null?void 0:Se.call(pe);se&&K&&(K.style.left=`${se.left}px`,K.style.top=`${se.bottom+5}px`)},onUpdate:pe=>{var Se;re=pe.items,oe&&(oe.query=pe.query,oe.range=pe.range,ue=0,oe.updateItems(re,pe.query));const se=(Se=pe.clientRect)==null?void 0:Se.call(pe);se&&K&&(K.style.left=`${se.left}px`,K.style.top=`${se.bottom+5}px`)},onKeyDown:pe=>(oe==null?void 0:oe.onKeyDown(pe))??!1,onExit:()=>{N.current=!1,K&&(K.remove(),K=null),oe=null}}}}}),Fq(n,it)],content:t,editable:i,editorProps:{attributes:{class:`prose prose-sm max-w-none focus:outline-none min-h-[100px] text-theme-secondary ${l} ${u} leading-relaxed custom-scrollbar selection:bg-indigo-100`,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"}},onUpdate:({editor:K})=>{if(!window.__imeComposing){if(e){const ue=K.getHTML();e(K.isEmpty?"":ue)}if(p){const ue=[];K.state.doc.descendants(re=>{re.type.name==="audioMarker"&&re.attrs.id&&ue.push({id:re.attrs.id,time:re.attrs.time||0})}),p(ue)}}},onCreate:({editor:K})=>{if(s&&s(K),p){const ue=[];K.state.doc.descendants(re=>{re.type.name==="audioMarker"&&re.attrs.id&&ue.push({id:re.attrs.id,time:re.attrs.time||0})}),p(ue)}},onSelectionUpdate:({editor:K})=>{if(window.__imeComposing)return;C.current&&clearTimeout(C.current);const{from:ue,to:re}=K.state.selection;ue!==re&&i?C.current=setTimeout(()=>{const oe=window.getSelection();if(oe&&oe.rangeCount>0){const se=oe.getRangeAt(0).getBoundingClientRect(),Se={top:se.bottom+5,left:se.left+se.width/2};I(Se),R(Se),D(!0)}},500):(D(!1),P(!1))}});return b.useEffect(()=>{if(!Ue)return;const K=({transaction:se})=>{if(!window.__imeComposing&&tt.current&&Fe.current>=0&&se.docChanged){const Se=Fe.current,{selection:Pe}=Ue.state;if(!Pe.empty)return;const ye=Pe.$from,ze=ye.parent.textContent.substring(0,ye.parentOffset),Ze=ze.lastIndexOf("@");if(Ze!==-1&&!ze.substring(Ze+1).includes(" ")||N.current)return;const vt=ye.marks().find(He=>He.type.name==="timestamp");let me=!0;if(vt){const He=vt.attrs.time;Se-He<2e3&&(me=!1)}if(me){const He=_e.current;Ue.commands.setMark("timestamp",{time:Se,recordingId:He})}else vt&&Ue.commands.setMark("timestamp",vt.attrs)}};let ue=null;const re=()=>{window.__imeComposing=!0,Ue&&(ue=Ue.state.selection.from)},oe=()=>{if(window.__imeComposing=!1,tt.current&&Fe.current>=0&&Ue&&ue!==null){const se=Fe.current,Se=_e.current,Pe=ue;ue=null,setTimeout(()=>{if(!Ue)return;const{selection:ye}=Ue.state,ze=ye.from;if(ze>Pe){const Ze=ye.$from,gt=Ze.parent.textContent.substring(0,Ze.parentOffset),vt=gt.lastIndexOf("@");if(vt!==-1&&!gt.substring(vt+1).includes(" ")){if(j.current){const He=Ue.getHTML();j.current(Ue.isEmpty?"":He)}return}try{Ue.chain().setTextSelection({from:Pe,to:ze}).setMark("timestamp",{time:se,recordingId:Se}).setTextSelection(ze).run()}catch(me){console.warn("Failed to apply timestamp mark:",me)}}if(j.current){const Ze=Ue.getHTML();j.current(Ue.isEmpty?"":Ze)}},50)}else ue=null,Ue&&j.current&&setTimeout(()=>{if(Ue&&j.current){const se=Ue.getHTML();j.current(Ue.isEmpty?"":se)}},50)},pe=Ue.view.dom;return pe.addEventListener("compositionstart",re),pe.addEventListener("compositionend",oe),Ue.on("selectionUpdate",K),Ue.on("update",K),()=>{Ue.off("update",K),Ue.off("selectionUpdate",K),pe.removeEventListener("compositionstart",re),pe.removeEventListener("compositionend",oe),window.__imeComposing=!1}},[Ue,ft]),b.useEffect(()=>{if(Ue&&t!==void 0){const K=Ue.getHTML(),ue=re=>re==="<p></p>"||re==="";if(ue(K)&&ue(t)||Ue.isFocused)return;K!==t&&Ue.commands.setContent(t,!1)}},[t,Ue]),b.useEffect(()=>{Ue&&(Xe.current=Ue,Ue.toggleRecording=()=>{},Ue.isRecording=!1,Ue.scrollToParagraph=K=>{if(!K)return;let ue=null,re=null,oe=null;Ue.state.doc.descendants((Se,Pe)=>{if(Se.type.name==="audioMarker"&&Se.attrs.id===K)return ue=Pe,!1}),ue!==null&&Ue.state.doc.descendants((Se,Pe)=>{if(Se.type.name==="audioMarker"&&Pe>ue&&re===null)return re=Pe,oe=Se.attrs.id,!1});const pe=re!==null?re:ue,se=oe!==null?oe:K;pe!==null&&(Ue.chain().setTextSelection(pe).scrollIntoView().focus().run(),setTimeout(()=>{const Se=document.querySelector(`[data-id="${se}"]`);Se&&(Se.style.transition="all 0.3s ease",Se.style.backgroundColor="#fef08a",Se.style.color="#854d0e",Se.style.borderColor="#fbbf24",Se.style.transform="scale(1.2)",setTimeout(()=>{Se.style.transition="all 1s ease",Se.style.backgroundColor="",Se.style.color="",Se.style.borderColor="",Se.style.transform=""},2e3))},50))})},[Ue]),b.useEffect(()=>{Ue&&d&&Ue.commands.focus("end")},[Ue,d]),b.useEffect(()=>{Ue&&s&&s(Ue)},[Ue,s]),Ue?c.jsxs("div",{className:`note-editor-wrapper ${o} relative bg-transparent border-none`,style:{"--attachment-link-color":y},onClickCapture:K=>{const ue=K.target,re=ue.closest("[data-time]");if(re){const se=re.getAttribute("data-time"),Se=re.getAttribute("data-recording-id")||void 0,Pe=parseInt(se||"0",10);if(!isNaN(Pe)&&f){f(Pe,Se);return}}const oe=ue.closest("[data-timestamp]");if(oe){const se=parseInt(oe.getAttribute("data-timestamp")||"0",10);if(!isNaN(se)&&f){f(se);return}}const pe=ue.closest("[data-attachment-link]");if(pe){K.preventDefault(),K.stopPropagation();const se=pe.getAttribute("data-attachment-urls");if(se)try{const Se=JSON.parse(se);if(Array.isArray(Se)&&Se.length>0){const Pe=pe.getBoundingClientRect();F({top:Pe.bottom+5,left:Math.min(Pe.left,window.innerWidth-340)}),We(Se),we(!0)}}catch(Se){console.error("Failed to parse attachment URLs",Se)}}else ue.closest(".attachment-popup")||we(!1)},children:[c.jsx(VK,{editor:Ue}),T&&c.jsxs("div",{className:"fixed z-50 bg-white rounded-lg shadow-2xl border border-gray-200 p-2 flex gap-1.5 animate-in fade-in zoom-in-95 duration-200 items-center",style:{top:`${k.top}px`,left:`${k.left}px`,transform:"translateX(-50%)"},children:[c.jsx("button",{type:"button",onMouseDown:K=>{K.preventDefault(),K.stopPropagation();const{from:ue,to:re}=Ue.state.selection,oe=Ue.state.doc.textBetween(ue,re," ");r==null||r(oe,{from:ue,to:re},k),D(!1)},className:"w-8 h-8 rounded-lg bg-indigo-50 hover:bg-indigo-100 text-indigo-600 shadow-sm hover:scale-105 hover:ring-2 hover:ring-indigo-300 transition-all active:scale-95 flex items-center justify-center cursor-pointer",title:"AI  (Polish Selection)",children:c.jsx(Is,{size:16})}),m.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"h-4 w-[1px] bg-gray-200 mx-1"}),c.jsx("button",{type:"button",onMouseDown:K=>{K.preventDefault(),K.stopPropagation();const{from:ue,to:re}=Ue.state.selection;if(ue!==re){X({from:ue,to:re});const oe=Ue.getAttributes("attachmentLink");A((oe==null?void 0:oe.attachmentUrls)||[]),P(!0),D(!1)}},className:"w-8 h-8 rounded-lg bg-amber-50 hover:bg-amber-100 text-amber-600 shadow-sm hover:scale-105 hover:ring-2 hover:ring-amber-300 transition-all active:scale-95 flex items-center justify-center cursor-pointer",title:" (Alt+A)",children:c.jsx(co,{size:16})})]}),c.jsx("div",{className:"h-4 w-[1px] bg-gray-200 mx-1"}),[{color:"#000000",label:""},{color:"#ef4444",label:""},{color:"#f97316",label:""},{color:"#f59e0b",label:""},{color:"#10b981",label:""},{color:"#3b82f6",label:""},{color:"#8b5cf6",label:""},{color:"#ec4899",label:""},{color:"#64748b",label:""}].map(({color:K,label:ue})=>c.jsx("button",{type:"button",onMouseDown:re=>{re.preventDefault(),re.stopPropagation(),Ue==null||Ue.chain().focus().setColor(K).run(),D(!1)},className:"w-7 h-7 rounded-full border-2 border-white shadow-md hover:scale-110 hover:ring-2 hover:ring-indigo-300 transition-all active:scale-95 cursor-pointer",style:{backgroundColor:K},title:ue},K))]}),O&&m.length>0&&c.jsxs("div",{className:"fixed z-[99999] bg-white rounded-xl shadow-2xl border border-gray-100 p-3 min-w-[220px] max-w-[300px] animate-in fade-in zoom-in-95 duration-150",style:{top:W.top,left:W.left},children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("span",{className:"text-xs font-bold text-gray-600",children:""}),c.jsx("button",{type:"button",onClick:()=>{P(!1),A([])},className:"p-0.5 text-gray-400 hover:text-gray-600",children:c.jsx(rn,{size:14})})]}),c.jsx("div",{className:"space-y-1 max-h-[200px] overflow-y-auto mb-2",children:m.map((K,ue)=>{const re=Q.includes(K.url);return c.jsxs("button",{type:"button",onClick:()=>{A(re?oe=>oe.filter(pe=>pe!==K.url):oe=>[...oe,K.url])},className:`w-full text-left px-2 py-1.5 rounded-lg flex items-center gap-2 text-xs transition-colors ${re?"bg-indigo-50 text-indigo-700 border border-indigo-200":"hover:bg-gray-50 text-gray-600"}`,children:[c.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center flex-shrink-0 ${re?"bg-indigo-500 border-indigo-500 text-white":"border-gray-300"}`,children:re&&c.jsx(Gn,{size:12})}),c.jsx(co,{size:12,className:re?"text-indigo-400":"text-gray-400"}),c.jsx("span",{className:"truncate",children:K.name})]},ue)})}),c.jsxs("div",{className:"flex gap-2 pt-2 border-t border-gray-100",children:[c.jsx("button",{type:"button",onClick:()=>{P(!1),A([])},className:"flex-1 px-3 py-1.5 text-xs text-gray-500 hover:bg-gray-50 rounded-lg transition-colors",children:""}),c.jsxs("button",{type:"button",onClick:()=>{M&&Ue&&(Q.length>0?Ue.chain().focus().setTextSelection(M).setMark("attachmentLink",{attachmentUrls:Q}).run():Ue.chain().focus().setTextSelection(M).unsetMark("attachmentLink").run(),P(!1),X(null),A([]))},className:"flex-1 px-3 py-1.5 text-xs bg-indigo-500 text-white hover:bg-indigo-600 rounded-lg transition-colors font-medium",children:[" ",Q.length>0&&`(${Q.length})`]})]})]}),Te&&ne.length>0&&c.jsxs("div",{className:"fixed z-[99999] bg-white rounded-xl shadow-2xl border border-gray-100 p-3 min-w-[220px] max-w-[320px] animate-in fade-in zoom-in-95 duration-150",style:{top:B.top,left:B.left},children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("span",{className:"text-xs font-bold text-gray-600",children:""}),c.jsx("button",{type:"button",onClick:()=>we(!1),className:"p-0.5 text-gray-400 hover:text-gray-600",children:c.jsx(rn,{size:14})})]}),c.jsx("div",{className:"space-y-1.5",children:ne.map((K,ue)=>{const re=m.find(oe=>oe.url===K);return re?c.jsxs("div",{className:"flex items-center justify-between gap-2 px-2 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[c.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[c.jsx(co,{size:12,className:"text-gray-400 flex-shrink-0"}),c.jsx("span",{className:"text-xs text-gray-600 truncate",children:re.name})]}),c.jsx("button",{type:"button",onClick:()=>{fetch(K).then(oe=>oe.blob()).then(oe=>{const pe=window.URL.createObjectURL(oe),se=document.createElement("a");se.href=pe,se.download=re.name,document.body.appendChild(se),se.click(),document.body.removeChild(se),window.URL.revokeObjectURL(pe)})},className:"p-1 text-indigo-500 hover:text-indigo-700 hover:bg-indigo-50 rounded transition-colors",title:"",children:c.jsx(ru,{size:14})})]},ue):null})})]}),c.jsx("style",{dangerouslySetInnerHTML:{__html:`
                .ProseMirror p.is-editor-empty:first-child::before {
                    content: attr(data-placeholder);
                    float: left;
                    color: #cbd5e1;
                    pointer-events: none;
                    height: 0;
                }
                .ProseMirror {
                    word-break: break-word;
                    max-height: calc(30 * 1.625em);
                    overflow-y: auto;
                }
                .note-editor-wrapper.h-full .ProseMirror {
                    height: 100%;
                    max-height: 100%;
                }
                .ProseMirror h1 { font-size: 1.25rem; font-weight: 700; margin-top: 0.5rem; margin-bottom: 0.5rem; color: #334155; }
                .ProseMirror h2 { font-size: 1.1rem; font-weight: 700; margin-top: 0.5rem; margin-bottom: 0.5rem; color: #475569; }
                .ProseMirror ul { list-style-type: disc; list-style-position: outside; padding-left: 2rem; margin-top: 0.25rem; margin-left: 0; }
                .ProseMirror ol { list-style-type: decimal; list-style-position: outside; padding-left: 2rem; margin-top: 0.25rem; margin-left: 0; }
                .ProseMirror li { padding-left: 0.25rem; }
            `}})]}):null});var qT;(function(t){t.STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object"})(qT||(qT={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var YT;(function(t){t.LANGUAGE_UNSPECIFIED="language_unspecified",t.PYTHON="python"})(YT||(YT={}));var JT;(function(t){t.OUTCOME_UNSPECIFIED="outcome_unspecified",t.OUTCOME_OK="outcome_ok",t.OUTCOME_FAILED="outcome_failed",t.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(JT||(JT={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XT=["user","model","function","system"];var QT;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(QT||(QT={}));var ZT;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(ZT||(ZT={}));var eC;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(eC||(eC={}));var tC;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER"})(tC||(tC={}));var Fd;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.OTHER="OTHER"})(Fd||(Fd={}));var nC;(function(t){t.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",t.RETRIEVAL_QUERY="RETRIEVAL_QUERY",t.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",t.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",t.CLASSIFICATION="CLASSIFICATION",t.CLUSTERING="CLUSTERING"})(nC||(nC={}));var rC;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(rC||(rC={}));var sC;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(sC||(sC={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ds extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class xc extends ds{constructor(e,n){super(e),this.response=n}}class I5 extends ds{constructor(e,n,r,s){super(e),this.status=n,this.statusText=r,this.errorDetails=s}}class $a extends ds{}class D5 extends ds{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kq="https://generativelanguage.googleapis.com",Gq="v1beta",qq="0.24.1",Yq="genai-js";var ec;(function(t){t.GENERATE_CONTENT="generateContent",t.STREAM_GENERATE_CONTENT="streamGenerateContent",t.COUNT_TOKENS="countTokens",t.EMBED_CONTENT="embedContent",t.BATCH_EMBED_CONTENTS="batchEmbedContents"})(ec||(ec={}));class Jq{constructor(e,n,r,s,i){this.model=e,this.task=n,this.apiKey=r,this.stream=s,this.requestOptions=i}toString(){var e,n;const r=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||Gq;let i=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||Kq}/${r}/${this.model}:${this.task}`;return this.stream&&(i+="?alt=sse"),i}}function Xq(t){const e=[];return t!=null&&t.apiClient&&e.push(t.apiClient),e.push(`${Yq}/${qq}`),e.join(" ")}async function Qq(t){var e;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",Xq(t.requestOptions)),n.append("x-goog-api-key",t.apiKey);let r=(e=t.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(s){throw new $a(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${s.message}`)}for(const[s,i]of r.entries()){if(s==="x-goog-api-key")throw new $a(`Cannot set reserved header name ${s}`);if(s==="x-goog-api-client")throw new $a(`Header name ${s} can only be set using the apiClient field`);n.append(s,i)}}return n}async function Zq(t,e,n,r,s,i){const o=new Jq(t,e,n,r,i);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},rY(i)),{method:"POST",headers:await Qq(o),body:s})}}async function th(t,e,n,r,s,i={},o=fetch){const{url:a,fetchOptions:l}=await Zq(t,e,n,r,s,i);return eY(a,l,o)}async function eY(t,e,n=fetch){let r;try{r=await n(t,e)}catch(s){tY(s,t)}return r.ok||await nY(r,t),r}function tY(t,e){let n=t;throw n.name==="AbortError"?(n=new D5(`Request aborted when fetching ${e.toString()}: ${t.message}`),n.stack=t.stack):t instanceof I5||t instanceof $a||(n=new ds(`Error fetching from ${e.toString()}: ${t.message}`),n.stack=t.stack),n}async function nY(t,e){let n="",r;try{const s=await t.json();n=s.error.message,s.error.details&&(n+=` ${JSON.stringify(s.error.details)}`,r=s.error.details)}catch{}throw new I5(`Error fetching from ${e.toString()}: [${t.status} ${t.statusText}] ${n}`,t.status,t.statusText,r)}function rY(t){const e={};if((t==null?void 0:t.signal)!==void 0||(t==null?void 0:t.timeout)>=0){const n=new AbortController;(t==null?void 0:t.timeout)>=0&&setTimeout(()=>n.abort(),t.timeout),t!=null&&t.signal&&t.signal.addEventListener("abort",()=>{n.abort()}),e.signal=n.signal}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uv(t){return t.text=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Cp(t.candidates[0]))throw new xc(`${pa(t)}`,t);return sY(t)}else if(t.promptFeedback)throw new xc(`Text not available. ${pa(t)}`,t);return""},t.functionCall=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Cp(t.candidates[0]))throw new xc(`${pa(t)}`,t);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),iC(t)[0]}else if(t.promptFeedback)throw new xc(`Function call not available. ${pa(t)}`,t)},t.functionCalls=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Cp(t.candidates[0]))throw new xc(`${pa(t)}`,t);return iC(t)}else if(t.promptFeedback)throw new xc(`Function call not available. ${pa(t)}`,t)},t}function sY(t){var e,n,r,s;const i=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const o of(s=(r=t.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)o.text&&i.push(o.text),o.executableCode&&i.push("\n```"+o.executableCode.language+`
`+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&i.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}function iC(t){var e,n,r,s;const i=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const o of(s=(r=t.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)o.functionCall&&i.push(o.functionCall);if(i.length>0)return i}const iY=[Fd.RECITATION,Fd.SAFETY,Fd.LANGUAGE];function Cp(t){return!!t.finishReason&&iY.includes(t.finishReason)}function pa(t){var e,n,r;let s="";if((!t.candidates||t.candidates.length===0)&&t.promptFeedback)s+="Response was blocked",!((e=t.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${t.promptFeedback.blockReason}`),!((n=t.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(s+=`: ${t.promptFeedback.blockReasonMessage}`);else if(!((r=t.candidates)===null||r===void 0)&&r[0]){const i=t.candidates[0];Cp(i)&&(s+=`Candidate was blocked due to ${i.finishReason}`,i.finishMessage&&(s+=`: ${i.finishMessage}`))}return s}function Rf(t){return this instanceof Rf?(this.v=t,this):new Rf(t)}function oY(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),s,i=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(h){r[h]&&(s[h]=function(p){return new Promise(function(m,y){i.push([h,p,m,y])>1||a(h,p)})})}function a(h,p){try{l(r[h](p))}catch(m){f(i[0][3],m)}}function l(h){h.value instanceof Rf?Promise.resolve(h.value.v).then(u,d):f(i[0][2],h)}function u(h){a("next",h)}function d(h){a("throw",h)}function f(h,p){h(p),i.shift(),i.length&&a(i[0][0],i[0][1])}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oC=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function aY(t){const e=t.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=uY(e),[r,s]=n.tee();return{stream:cY(r),response:lY(s)}}async function lY(t){const e=[],n=t.getReader();for(;;){const{done:r,value:s}=await n.read();if(r)return Uv(dY(e));e.push(s)}}function cY(t){return oY(this,arguments,function*(){const n=t.getReader();for(;;){const{value:r,done:s}=yield Rf(n.read());if(s)break;yield yield Rf(Uv(r))}})}function uY(t){const e=t.getReader();return new ReadableStream({start(r){let s="";return i();function i(){return e.read().then(({value:o,done:a})=>{if(a){if(s.trim()){r.error(new ds("Failed to parse stream"));return}r.close();return}s+=o;let l=s.match(oC),u;for(;l;){try{u=JSON.parse(l[1])}catch{r.error(new ds(`Error parsing JSON response: "${l[1]}"`));return}r.enqueue(u),s=s.substring(l[0].length),l=s.match(oC)}return i()}).catch(o=>{let a=o;throw a.stack=o.stack,a.name==="AbortError"?a=new D5("Request aborted when reading from the stream"):a=new ds("Error reading from the stream"),a})}}})}function dY(t){const e=t[t.length-1],n={promptFeedback:e==null?void 0:e.promptFeedback};for(const r of t){if(r.candidates){let s=0;for(const i of r.candidates)if(n.candidates||(n.candidates=[]),n.candidates[s]||(n.candidates[s]={index:s}),n.candidates[s].citationMetadata=i.citationMetadata,n.candidates[s].groundingMetadata=i.groundingMetadata,n.candidates[s].finishReason=i.finishReason,n.candidates[s].finishMessage=i.finishMessage,n.candidates[s].safetyRatings=i.safetyRatings,i.content&&i.content.parts){n.candidates[s].content||(n.candidates[s].content={role:i.content.role||"user",parts:[]});const o={};for(const a of i.content.parts)a.text&&(o.text=a.text),a.functionCall&&(o.functionCall=a.functionCall),a.executableCode&&(o.executableCode=a.executableCode),a.codeExecutionResult&&(o.codeExecutionResult=a.codeExecutionResult),Object.keys(o).length===0&&(o.text=""),n.candidates[s].content.parts.push(o)}s++}r.usageMetadata&&(n.usageMetadata=r.usageMetadata)}return n}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M5(t,e,n,r){const s=await th(e,ec.STREAM_GENERATE_CONTENT,t,!0,JSON.stringify(n),r);return aY(s)}async function A5(t,e,n,r){const i=await(await th(e,ec.GENERATE_CONTENT,t,!1,JSON.stringify(n),r)).json();return{response:Uv(i)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R5(t){if(t!=null){if(typeof t=="string")return{role:"system",parts:[{text:t}]};if(t.text)return{role:"system",parts:[t]};if(t.parts)return t.role?t:{role:"system",parts:t.parts}}}function Of(t){let e=[];if(typeof t=="string")e=[{text:t}];else for(const n of t)typeof n=="string"?e.push({text:n}):e.push(n);return fY(e)}function fY(t){const e={role:"user",parts:[]},n={role:"function",parts:[]};let r=!1,s=!1;for(const i of t)"functionResponse"in i?(n.parts.push(i),s=!0):(e.parts.push(i),r=!0);if(r&&s)throw new ds("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!s)throw new ds("No content is provided for sending chat message.");return r?e:n}function hY(t,e){var n;let r={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(n=e==null?void 0:e.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const s=t.generateContentRequest!=null;if(t.contents){if(s)throw new $a("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=t.contents}else if(s)r=Object.assign(Object.assign({},r),t.generateContentRequest);else{const i=Of(t);r.contents=[i]}return{generateContentRequest:r}}function aC(t){let e;return t.contents?e=t:e={contents:[Of(t)]},t.systemInstruction&&(e.systemInstruction=R5(t.systemInstruction)),e}function pY(t){return typeof t=="string"||Array.isArray(t)?{content:Of(t)}:t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lC=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],mY={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function gY(t){let e=!1;for(const n of t){const{role:r,parts:s}=n;if(!e&&r!=="user")throw new ds(`First content should be with role 'user', got ${r}`);if(!XT.includes(r))throw new ds(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(XT)}`);if(!Array.isArray(s))throw new ds("Content should have 'parts' property with an array of Parts");if(s.length===0)throw new ds("Each Content should have at least one part");const i={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const a of s)for(const l of lC)l in a&&(i[l]+=1);const o=mY[r];for(const a of lC)if(!o.includes(a)&&i[a]>0)throw new ds(`Content with role '${r}' can't contain '${a}' part`);e=!0}}function cC(t){var e;if(t.candidates===void 0||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;if(n===void 0||n.parts===void 0||n.parts.length===0)return!1;for(const r of n.parts)if(r===void 0||Object.keys(r).length===0||r.text!==void 0&&r.text==="")return!1;return!0}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uC="SILENT_ERROR";class yY{constructor(e,n,r,s={}){this.model=n,this.params=r,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,r!=null&&r.history&&(gY(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,n={}){var r,s,i,o,a,l;await this._sendPromise;const u=Of(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,u]},f=Object.assign(Object.assign({},this._requestOptions),n);let h;return this._sendPromise=this._sendPromise.then(()=>A5(this._apiKey,this.model,d,f)).then(p=>{var m;if(cC(p.response)){this._history.push(u);const y=Object.assign({parts:[],role:"model"},(m=p.response.candidates)===null||m===void 0?void 0:m[0].content);this._history.push(y)}else{const y=pa(p.response);y&&console.warn(`sendMessage() was unsuccessful. ${y}. Inspect response object for details.`)}h=p}).catch(p=>{throw this._sendPromise=Promise.resolve(),p}),await this._sendPromise,h}async sendMessageStream(e,n={}){var r,s,i,o,a,l;await this._sendPromise;const u=Of(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,u]},f=Object.assign(Object.assign({},this._requestOptions),n),h=M5(this._apiKey,this.model,d,f);return this._sendPromise=this._sendPromise.then(()=>h).catch(p=>{throw new Error(uC)}).then(p=>p.response).then(p=>{if(cC(p)){this._history.push(u);const m=Object.assign({},p.candidates[0].content);m.role||(m.role="model"),this._history.push(m)}else{const m=pa(p);m&&console.warn(`sendMessageStream() was unsuccessful. ${m}. Inspect response object for details.`)}}).catch(p=>{p.message!==uC&&console.error(p)}),h}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xY(t,e,n,r){return(await th(e,ec.COUNT_TOKENS,t,!1,JSON.stringify(n),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bY(t,e,n,r){return(await th(e,ec.EMBED_CONTENT,t,!1,JSON.stringify(n),r)).json()}async function wY(t,e,n,r){const s=n.requests.map(o=>Object.assign(Object.assign({},o),{model:e}));return(await th(e,ec.BATCH_EMBED_CONTENTS,t,!1,JSON.stringify({requests:s}),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dC{constructor(e,n,r={}){this.apiKey=e,this._requestOptions=r,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=R5(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(e,n={}){var r;const s=aC(e),i=Object.assign(Object.assign({},this._requestOptions),n);return A5(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}async generateContentStream(e,n={}){var r;const s=aC(e),i=Object.assign(Object.assign({},this._requestOptions),n);return M5(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}startChat(e){var n;return new yY(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},e),this._requestOptions)}async countTokens(e,n={}){const r=hY(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),n);return xY(this.apiKey,this.model,r,s)}async embedContent(e,n={}){const r=pY(e),s=Object.assign(Object.assign({},this._requestOptions),n);return bY(this.apiKey,this.model,r,s)}async batchEmbedContents(e,n={}){const r=Object.assign(Object.assign({},this._requestOptions),n);return wY(this.apiKey,this.model,e,r)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vY{constructor(e){this.apiKey=e}getGenerativeModel(e,n){if(!e.model)throw new ds("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new dC(this.apiKey,e,n)}getGenerativeModelFromCachedContent(e,n,r){if(!e.name)throw new $a("Cached content must contain a `name` field.");if(!e.model)throw new $a("Cached content must contain a `model` field.");const s=["model","systemInstruction"];for(const o of s)if(n!=null&&n[o]&&e[o]&&(n==null?void 0:n[o])!==e[o]){if(o==="model"){const a=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,l=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(a===l)continue}throw new $a(`Different value for "${o}" specified in modelParams (${n[o]}) and cachedContent (${e[o]})`)}const i=Object.assign(Object.assign({},n),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new dC(this.apiKey,i,r)}}const kY="AIzaSyBbGFzQkwhEmNQduYxaZnnxxHR-DlQjj98",Hv=()=>({provider:localStorage.getItem("ai_provider")||"gemini",googleKey:localStorage.getItem("google_ai_key")||kY,openaiKey:localStorage.getItem("openai_api_key")||"",baseUrl:localStorage.getItem("ai_base_url")||"https://api.openai.com/v1",modelName:localStorage.getItem("ai_model")||"gpt-3.5-turbo"}),SY=()=>{const{googleKey:t}=Hv();if(!t)throw new Error("Google API Key is missing. Please set it in Settings.");return new vY(t)},_Y=async(t,e=!0)=>{var a,l;const{openaiKey:n,baseUrl:r,modelName:s}=Hv();if(!n)throw new Error("API Key is missing. Please set it in Settings.");let i=r.trim();i.endsWith("/")&&(i=i.slice(0,-1));const o=`${i}/chat/completions`;console.log(`Using OpenAI-compatible provider: ${i}, model: ${s}`);try{const u=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:s,messages:[{role:"system",content:e?"You are a helpful assistant. Output valid JSON only.":"You are a helpful assistant."},{role:"user",content:t}],temperature:.7})});if(!u.ok){const h=await u.text();throw new Error(`API Error: ${u.status} ${u.statusText} - ${h}`)}const f=((l=(a=(await u.json()).choices[0])==null?void 0:a.message)==null?void 0:l.content)||"";if(console.log("AI Raw Response:",f),!e)return f;try{let h=f;const p=f.match(/\{[\s\S]*\}/);p&&(h=p[0]);const m=h.replace(/```json/g,"").replace(/```/g,"").trim();try{return JSON.parse(m)}catch(y){if(m.includes('"fullResponse": "')){const x='"fullResponse": "',g=m.indexOf(x)+x.length,v=m.lastIndexOf('"');if(g>x.length-1&&v>g)return{fullResponse:m.substring(g,v).replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")}}throw y}}catch(h){throw console.warn("OpenAI JSON Parse failed"),h}}catch(u){throw console.error("OpenAI Provider Error:",u),u}},TY=async t=>{const e=SY(),n=["gemini-1.5-flash","gemini-2.0-flash-001","gemini-2.0-flash-lite-preview-02-05","gemini-1.5-pro","gemini-pro"];let r;for(const s of n)try{console.log(`[SimpleAI] Attempting to use model: ${s}`);const l=(await(await e.getGenerativeModel({model:s}).generateContent(t)).response).text();if(l)return l.trim()}catch(i){console.warn(`[SimpleAI] Model ${s} failed:`,i),r=i;continue}throw r||new Error("All AI models failed to respond")},sc=async t=>{const{provider:e}=Hv();if(e==="openai"){const n=await _Y(t,!1);return typeof n=="string"?n:JSON.stringify(n)}return await TY(t)},O5=async(t,e,n)=>{const r=` AI 
  
  ${e}
  ${t}
  
  `,s=n&&n.trim()?n:r,i=(n==null?void 0:n.includes(""))||(n==null?void 0:n.includes("")),o=e.trim()?`
"${e}"

`:"",a=!!(n&&n.trim()),l=["1. Traditional Chinese","2.  JSON "];i?(l.push("3. "),l.push("4. ")):a?(l.push("3. "),l.push("4. ......"),l.push("5.  Markdown ")):(l.push("3. "),l.push("4.  Markdown ****"),l.push("5. "));const u=`
${s}

${o}
"${t}"


${l.join(`
`)}`;try{if(!t.trim())throw new Error("");return{fullResponse:await sc(u)}}catch(d){throw console.error("AI Assistant Error:",d),d}},P5=async t=>{const e=` AI Prompt 10 

  
  "${t}"`;try{return(await sc(e)).trim().replace(/^"|"$/g,"")}catch(n){return console.error("Generate Prompt Title Error:",n),t.slice(0,15)+(t.length>15?"...":"")}},CY=async(t,e)=>{const n=t.length>3e3?t.slice(0,3e3)+"...":t;let r;e?r=`${e}

  
  ---
    ${n}
  ---

    `:r=`SEOSEO

  
  1. 
  2. 15 - 30
  3. 
  4. 
  5. 
  6. 
  7. 

  
  - "5"
    - "90%"
    - ""

  
  ---
    ${n}
  ---

    SEO`,console.log("Generating SEO title for content length:",t.length);try{const s=await sc(r);return console.log("SEO Title AI result:",s),s.trim().replace(/^["]/g,"").replace(/["]$/g,"").replace(/^\d+[\.\s]+/,"").replace(/^[:]\s*/i,"").trim()||s.trim()}catch(s){throw console.error("Generate SEO Title Error:",s),s}},EY=async(t,e)=>{const n=t.length>3e3?t.slice(0,3e3)+"...":t,s=`SEO


(SEO)

${e.length>0?`
${e.join(", ")}`:""}


1. ---
2. 
3.  3-7 
4.  10 
5. 
6. 
7. 


---
${n}
---

`;console.log("Generating SEO keywords for content length:",t.length),console.log("Content preview:",t.slice(0,200));try{const i=await sc(s);return console.log("SEO Keywords AI result:",i),i.split(/[,\n]/).map(a=>a.trim()).filter(a=>a.length>0&&a.length<=20).slice(0,7)}catch(i){throw console.error("Generate SEO Keywords Error:",i),i}},NY=async(t,e,n,r,s,i)=>{const o=s.existingSchedule&&s.existingSchedule.length>0?`
Existing Schedule (Potential Conflicts):
${s.existingSchedule.join(`
`)}`:"",a=s.pastExperiences&&s.pastExperiences.length>0?`
Relevant Past Experience:
${s.pastExperiences.join(`
`)}`:"",l=`
Role:  AI (Chief Administrative Officer)

Source Task:
- : "${t}"
- /: "${e||"()"}"
- : ${n||""}
- : ${r||""}
- : ${s.today}
${i?`
: "${i}"`:""}
${o}
${a}

Instructions:
1. 
2.  (Relevant Past Experience)() 
3.  (Existing Schedule)() description 
4. 
5. 
   - "title": 
   - "description": 
   - "start_date": YYYY-MM-DD 
   - "due_date": YYYY-MM-DD 
6. "subtasks": 

Output Rules:
-  JSON 
-  Markdown... JSON
- 
- description  title 

JSON Format:
[
  {
    "title": "",
    "description": "...",
    "start_date": "YYYY-MM-DD",
    "due_date": "YYYY-MM-DD",
    "subtasks": []
  }
]
`;try{const u=await sc(l);console.log("Mission 72 Raw Output:",u);let d=u;const f=u.match(/\[[\s\S]*\]/);return f&&(d=f[0]),d=d.replace(/```json/g,"").replace(/```/g,"").trim(),JSON.parse(d)}catch(u){throw console.error("Mission 72 Planning Error:",u),new Error("AI ")}},jY=async(t,e)=>{if(e.length===0)return null;const n=e.map(s=>`- ${s.name} (ID: ${s.id}, : ${s.depth})`).join(`
`),r=`${t}


${n}


1. 
2. 
3.  "NONE"
4. 

 ID "NONE"`;try{const i=(await sc(r)).trim().replace(/["""'']/g,"");if(i==="NONE"||i.toLowerCase()==="none")return null;const o=e.find(l=>l.id===i);if(o)return o.id;const a=e.find(l=>i.toLowerCase().includes(l.name.toLowerCase())||l.name.toLowerCase().includes(i.toLowerCase()));return a?a.id:null}catch(s){return console.error("Find Best Parent Keyword Error:",s),null}},IY=async(t,e,n,r=[])=>{const s=`
 GTD (Getting Things Done) **** GTD 



- ${t.title}
- ${t.description||"()"}
- ${t.status}
- ${t.created_at}
- ${t.due_date||""}
- ()${t.start_date||""}
- ${t.tags.join(", ")||""}
- ${t.project_title||" ()"}

 ()
${e.length>0?e.join(`
`):"()"}


${r.map(i=>`${i.role==="user"?"":"GTD"}: ${i.content}`).join(`
`)}


"${n}"

GTD  (current_stage)
1. capture (): 
2. clarify (): 
3. organize (): ** (start_date) start_time (HH:MM) (due_date)**
4. engage (): 


1. ******** \`actions\` JSON
2. ****
3. **** \`start_date\`
4. ************ \`actions\` JSON reminder_minutes

 (JSON Only)
{
  "reply": "...",
  "current_stage": "capture" | "clarify" | "organize" | "engage",
  "actions": [
    { "type": "update_task", "params": { "start_date": "YYYY-MM-DD", "start_time": "09:00", "reminder_minutes": 0 } },
    { "type": "add_subtasks", "params": { "tasks": [{ "title": "...", "start_date": "...", "reminder_minutes": 10 }] } }
  ]
}
* \`actions\` 

 JSON
`;try{const i=await sc(s);let o=i;const a=i.match(/\{[\s\S]*\}/);return a&&(o=a[0]),o=o.replace(/```json/g,"").replace(/```/g,"").trim(),JSON.parse(o)}catch(i){return console.error("GTD Coach Error:",i),{reply:"",current_stage:"capture",actions:[]}}};function DY(t,e){const n=e||{};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const MY=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,AY=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,RY={};function fC(t,e){return((e||RY).jsx?AY:MY).test(t)}const OY=/[ \t\n\f\r]/g;function PY(t){return typeof t=="object"?t.type==="text"?hC(t.value):!1:hC(t)}function hC(t){return t.replace(OY,"")===""}class nh{constructor(e,n,r){this.normal=n,this.property=e,r&&(this.space=r)}}nh.prototype.normal={};nh.prototype.property={};nh.prototype.space=void 0;function L5(t,e){const n={},r={};for(const s of t)Object.assign(n,s.property),Object.assign(r,s.normal);return new nh(n,r,e)}function sb(t){return t.toLowerCase()}class Hs{constructor(e,n){this.attribute=n,this.property=e}}Hs.prototype.attribute="";Hs.prototype.booleanish=!1;Hs.prototype.boolean=!1;Hs.prototype.commaOrSpaceSeparated=!1;Hs.prototype.commaSeparated=!1;Hs.prototype.defined=!1;Hs.prototype.mustUseProperty=!1;Hs.prototype.number=!1;Hs.prototype.overloadedBoolean=!1;Hs.prototype.property="";Hs.prototype.spaceSeparated=!1;Hs.prototype.space=void 0;let LY=0;const dn=ic(),vr=ic(),ib=ic(),Nt=ic(),zn=ic(),lu=ic(),Ws=ic();function ic(){return 2**++LY}const ob=Object.freeze(Object.defineProperty({__proto__:null,boolean:dn,booleanish:vr,commaOrSpaceSeparated:Ws,commaSeparated:lu,number:Nt,overloadedBoolean:ib,spaceSeparated:zn},Symbol.toStringTag,{value:"Module"})),Iy=Object.keys(ob);class Vv extends Hs{constructor(e,n,r,s){let i=-1;if(super(e,n),pC(this,"space",s),typeof r=="number")for(;++i<Iy.length;){const o=Iy[i];pC(this,Iy[i],(r&ob[o])===ob[o])}}}Vv.prototype.defined=!0;function pC(t,e,n){n&&(t[e]=n)}function $u(t){const e={},n={};for(const[r,s]of Object.entries(t.properties)){const i=new Vv(r,t.transform(t.attributes||{},r),s,t.space);t.mustUseProperty&&t.mustUseProperty.includes(r)&&(i.mustUseProperty=!0),e[r]=i,n[sb(r)]=r,n[sb(i.attribute)]=r}return new nh(e,n,t.space)}const $5=$u({properties:{ariaActiveDescendant:null,ariaAtomic:vr,ariaAutoComplete:null,ariaBusy:vr,ariaChecked:vr,ariaColCount:Nt,ariaColIndex:Nt,ariaColSpan:Nt,ariaControls:zn,ariaCurrent:null,ariaDescribedBy:zn,ariaDetails:null,ariaDisabled:vr,ariaDropEffect:zn,ariaErrorMessage:null,ariaExpanded:vr,ariaFlowTo:zn,ariaGrabbed:vr,ariaHasPopup:null,ariaHidden:vr,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:zn,ariaLevel:Nt,ariaLive:null,ariaModal:vr,ariaMultiLine:vr,ariaMultiSelectable:vr,ariaOrientation:null,ariaOwns:zn,ariaPlaceholder:null,ariaPosInSet:Nt,ariaPressed:vr,ariaReadOnly:vr,ariaRelevant:null,ariaRequired:vr,ariaRoleDescription:zn,ariaRowCount:Nt,ariaRowIndex:Nt,ariaRowSpan:Nt,ariaSelected:vr,ariaSetSize:Nt,ariaSort:null,ariaValueMax:Nt,ariaValueMin:Nt,ariaValueNow:Nt,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function z5(t,e){return e in t?t[e]:e}function F5(t,e){return z5(t,e.toLowerCase())}const $Y=$u({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:lu,acceptCharset:zn,accessKey:zn,action:null,allow:null,allowFullScreen:dn,allowPaymentRequest:dn,allowUserMedia:dn,alt:null,as:null,async:dn,autoCapitalize:null,autoComplete:zn,autoFocus:dn,autoPlay:dn,blocking:zn,capture:null,charSet:null,checked:dn,cite:null,className:zn,cols:Nt,colSpan:null,content:null,contentEditable:vr,controls:dn,controlsList:zn,coords:Nt|lu,crossOrigin:null,data:null,dateTime:null,decoding:null,default:dn,defer:dn,dir:null,dirName:null,disabled:dn,download:ib,draggable:vr,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:dn,formTarget:null,headers:zn,height:Nt,hidden:ib,high:Nt,href:null,hrefLang:null,htmlFor:zn,httpEquiv:zn,id:null,imageSizes:null,imageSrcSet:null,inert:dn,inputMode:null,integrity:null,is:null,isMap:dn,itemId:null,itemProp:zn,itemRef:zn,itemScope:dn,itemType:zn,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:dn,low:Nt,manifest:null,max:null,maxLength:Nt,media:null,method:null,min:null,minLength:Nt,multiple:dn,muted:dn,name:null,nonce:null,noModule:dn,noValidate:dn,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:dn,optimum:Nt,pattern:null,ping:zn,placeholder:null,playsInline:dn,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:dn,referrerPolicy:null,rel:zn,required:dn,reversed:dn,rows:Nt,rowSpan:Nt,sandbox:zn,scope:null,scoped:dn,seamless:dn,selected:dn,shadowRootClonable:dn,shadowRootDelegatesFocus:dn,shadowRootMode:null,shape:null,size:Nt,sizes:null,slot:null,span:Nt,spellCheck:vr,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Nt,step:null,style:null,tabIndex:Nt,target:null,title:null,translate:null,type:null,typeMustMatch:dn,useMap:null,value:vr,width:Nt,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:zn,axis:null,background:null,bgColor:null,border:Nt,borderColor:null,bottomMargin:Nt,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:dn,declare:dn,event:null,face:null,frame:null,frameBorder:null,hSpace:Nt,leftMargin:Nt,link:null,longDesc:null,lowSrc:null,marginHeight:Nt,marginWidth:Nt,noResize:dn,noHref:dn,noShade:dn,noWrap:dn,object:null,profile:null,prompt:null,rev:null,rightMargin:Nt,rules:null,scheme:null,scrolling:vr,standby:null,summary:null,text:null,topMargin:Nt,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Nt,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:dn,disableRemotePlayback:dn,prefix:null,property:null,results:Nt,security:null,unselectable:null},space:"html",transform:F5}),zY=$u({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Ws,accentHeight:Nt,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Nt,amplitude:Nt,arabicForm:null,ascent:Nt,attributeName:null,attributeType:null,azimuth:Nt,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Nt,by:null,calcMode:null,capHeight:Nt,className:zn,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Nt,diffuseConstant:Nt,direction:null,display:null,dur:null,divisor:Nt,dominantBaseline:null,download:dn,dx:null,dy:null,edgeMode:null,editable:null,elevation:Nt,enableBackground:null,end:null,event:null,exponent:Nt,externalResourcesRequired:null,fill:null,fillOpacity:Nt,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:lu,g2:lu,glyphName:lu,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Nt,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Nt,horizOriginX:Nt,horizOriginY:Nt,id:null,ideographic:Nt,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Nt,k:Nt,k1:Nt,k2:Nt,k3:Nt,k4:Nt,kernelMatrix:Ws,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Nt,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Nt,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Nt,overlineThickness:Nt,paintOrder:null,panose1:null,path:null,pathLength:Nt,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:zn,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Nt,pointsAtY:Nt,pointsAtZ:Nt,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Ws,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Ws,rev:Ws,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Ws,requiredFeatures:Ws,requiredFonts:Ws,requiredFormats:Ws,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Nt,specularExponent:Nt,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Nt,strikethroughThickness:Nt,string:null,stroke:null,strokeDashArray:Ws,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Nt,strokeOpacity:Nt,strokeWidth:null,style:null,surfaceScale:Nt,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Ws,tabIndex:Nt,tableValues:null,target:null,targetX:Nt,targetY:Nt,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Ws,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Nt,underlineThickness:Nt,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Nt,values:null,vAlphabetic:Nt,vMathematical:Nt,vectorEffect:null,vHanging:Nt,vIdeographic:Nt,version:null,vertAdvY:Nt,vertOriginX:Nt,vertOriginY:Nt,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Nt,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:z5}),B5=$u({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),U5=$u({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:F5}),H5=$u({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),FY={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},BY=/[A-Z]/g,mC=/-[a-z]/g,UY=/^data[-\w.:]+$/i;function HY(t,e){const n=sb(e);let r=e,s=Hs;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&UY.test(e)){if(e.charAt(4)==="-"){const i=e.slice(5).replace(mC,WY);r="data"+i.charAt(0).toUpperCase()+i.slice(1)}else{const i=e.slice(4);if(!mC.test(i)){let o=i.replace(BY,VY);o.charAt(0)!=="-"&&(o="-"+o),e="data"+o}}s=Vv}return new s(r,e)}function VY(t){return"-"+t.toLowerCase()}function WY(t){return t.charAt(1).toUpperCase()}const KY=L5([$5,$Y,B5,U5,H5],"html"),Wv=L5([$5,zY,B5,U5,H5],"svg");function GY(t){return t.join(" ").trim()}var Kv={},gC=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,qY=/\n/g,YY=/^\s*/,JY=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,XY=/^:\s*/,QY=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,ZY=/^[;\s]*/,eJ=/^\s+|\s+$/g,tJ=`
`,yC="/",xC="*",kl="",nJ="comment",rJ="declaration";function sJ(t,e){if(typeof t!="string")throw new TypeError("First argument must be a string");if(!t)return[];e=e||{};var n=1,r=1;function s(m){var y=m.match(qY);y&&(n+=y.length);var x=m.lastIndexOf(tJ);r=~x?m.length-x:r+m.length}function i(){var m={line:n,column:r};return function(y){return y.position=new o(m),u(),y}}function o(m){this.start=m,this.end={line:n,column:r},this.source=e.source}o.prototype.content=t;function a(m){var y=new Error(e.source+":"+n+":"+r+": "+m);if(y.reason=m,y.filename=e.source,y.line=n,y.column=r,y.source=t,!e.silent)throw y}function l(m){var y=m.exec(t);if(y){var x=y[0];return s(x),t=t.slice(x.length),y}}function u(){l(YY)}function d(m){var y;for(m=m||[];y=f();)y!==!1&&m.push(y);return m}function f(){var m=i();if(!(yC!=t.charAt(0)||xC!=t.charAt(1))){for(var y=2;kl!=t.charAt(y)&&(xC!=t.charAt(y)||yC!=t.charAt(y+1));)++y;if(y+=2,kl===t.charAt(y-1))return a("End of comment missing");var x=t.slice(2,y-2);return r+=2,s(x),t=t.slice(y),r+=2,m({type:nJ,comment:x})}}function h(){var m=i(),y=l(JY);if(y){if(f(),!l(XY))return a("property missing ':'");var x=l(QY),g=m({type:rJ,property:bC(y[0].replace(gC,kl)),value:x?bC(x[0].replace(gC,kl)):kl});return l(ZY),g}}function p(){var m=[];d(m);for(var y;y=h();)y!==!1&&(m.push(y),d(m));return m}return u(),p()}function bC(t){return t?t.replace(eJ,kl):kl}var iJ=sJ,oJ=jp&&jp.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Kv,"__esModule",{value:!0});Kv.default=lJ;const aJ=oJ(iJ);function lJ(t,e){let n=null;if(!t||typeof t!="string")return n;const r=(0,aJ.default)(t),s=typeof e=="function";return r.forEach(i=>{if(i.type!=="declaration")return;const{property:o,value:a}=i;s?e(o,a,i):a&&(n=n||{},n[o]=a)}),n}var Qg={};Object.defineProperty(Qg,"__esModule",{value:!0});Qg.camelCase=void 0;var cJ=/^--[a-zA-Z0-9_-]+$/,uJ=/-([a-z])/g,dJ=/^[^-]+$/,fJ=/^-(webkit|moz|ms|o|khtml)-/,hJ=/^-(ms)-/,pJ=function(t){return!t||dJ.test(t)||cJ.test(t)},mJ=function(t,e){return e.toUpperCase()},wC=function(t,e){return"".concat(e,"-")},gJ=function(t,e){return e===void 0&&(e={}),pJ(t)?t:(t=t.toLowerCase(),e.reactCompat?t=t.replace(hJ,wC):t=t.replace(fJ,wC),t.replace(uJ,mJ))};Qg.camelCase=gJ;var yJ=jp&&jp.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},xJ=yJ(Kv),bJ=Qg;function ab(t,e){var n={};return!t||typeof t!="string"||(0,xJ.default)(t,function(r,s){r&&s&&(n[(0,bJ.camelCase)(r,e)]=s)}),n}ab.default=ab;var wJ=ab;const vJ=lg(wJ),V5=W5("end"),Gv=W5("start");function W5(t){return e;function e(n){const r=n&&n.position&&n.position[t]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function kJ(t){const e=Gv(t),n=V5(t);if(e&&n)return{start:e,end:n}}function Bd(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?vC(t.position):"start"in t||"end"in t?vC(t):"line"in t||"column"in t?lb(t):""}function lb(t){return kC(t&&t.line)+":"+kC(t&&t.column)}function vC(t){return lb(t&&t.start)+"-"+lb(t&&t.end)}function kC(t){return t&&typeof t=="number"?t:1}class gs extends Error{constructor(e,n,r){super(),typeof n=="string"&&(r=n,n=void 0);let s="",i={},o=!1;if(n&&("line"in n&&"column"in n?i={place:n}:"start"in n&&"end"in n?i={place:n}:"type"in n?i={ancestors:[n],place:n.position}:i={...n}),typeof e=="string"?s=e:!i.cause&&e&&(o=!0,s=e.message,i.cause=e),!i.ruleId&&!i.source&&typeof r=="string"){const l=r.indexOf(":");l===-1?i.ruleId=r:(i.source=r.slice(0,l),i.ruleId=r.slice(l+1))}if(!i.place&&i.ancestors&&i.ancestors){const l=i.ancestors[i.ancestors.length-1];l&&(i.place=l.position)}const a=i.place&&"start"in i.place?i.place.start:i.place;this.ancestors=i.ancestors||void 0,this.cause=i.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file="",this.message=s,this.line=a?a.line:void 0,this.name=Bd(i.place)||"1:1",this.place=i.place||void 0,this.reason=this.message,this.ruleId=i.ruleId||void 0,this.source=i.source||void 0,this.stack=o&&i.cause&&typeof i.cause.stack=="string"?i.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}gs.prototype.file="";gs.prototype.name="";gs.prototype.reason="";gs.prototype.message="";gs.prototype.stack="";gs.prototype.column=void 0;gs.prototype.line=void 0;gs.prototype.ancestors=void 0;gs.prototype.cause=void 0;gs.prototype.fatal=void 0;gs.prototype.place=void 0;gs.prototype.ruleId=void 0;gs.prototype.source=void 0;const qv={}.hasOwnProperty,SJ=new Map,_J=/[A-Z]/g,TJ=new Set(["table","tbody","thead","tfoot","tr"]),CJ=new Set(["td","th"]),K5="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function EJ(t,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=e.filePath||void 0;let r;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=OJ(n,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=RJ(n,e.jsx,e.jsxs)}const s={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:r,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?Wv:KY,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},i=G5(s,t,void 0);return i&&typeof i!="string"?i:s.create(t,s.Fragment,{children:i||void 0},void 0)}function G5(t,e,n){if(e.type==="element")return NJ(t,e,n);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return jJ(t,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return DJ(t,e,n);if(e.type==="mdxjsEsm")return IJ(t,e);if(e.type==="root")return MJ(t,e,n);if(e.type==="text")return AJ(t,e)}function NJ(t,e,n){const r=t.schema;let s=r;e.tagName.toLowerCase()==="svg"&&r.space==="html"&&(s=Wv,t.schema=s),t.ancestors.push(e);const i=Y5(t,e.tagName,!1),o=PJ(t,e);let a=Jv(t,e);return TJ.has(e.tagName)&&(a=a.filter(function(l){return typeof l=="string"?!PY(l):!0})),q5(t,o,i,e),Yv(o,a),t.ancestors.pop(),t.schema=r,t.create(e,i,o,n)}function jJ(t,e){if(e.data&&e.data.estree&&t.evaluater){const r=e.data.estree.body[0];return r.type,t.evaluater.evaluateExpression(r.expression)}Pf(t,e.position)}function IJ(t,e){if(e.data&&e.data.estree&&t.evaluater)return t.evaluater.evaluateProgram(e.data.estree);Pf(t,e.position)}function DJ(t,e,n){const r=t.schema;let s=r;e.name==="svg"&&r.space==="html"&&(s=Wv,t.schema=s),t.ancestors.push(e);const i=e.name===null?t.Fragment:Y5(t,e.name,!0),o=LJ(t,e),a=Jv(t,e);return q5(t,o,i,e),Yv(o,a),t.ancestors.pop(),t.schema=r,t.create(e,i,o,n)}function MJ(t,e,n){const r={};return Yv(r,Jv(t,e)),t.create(e,t.Fragment,r,n)}function AJ(t,e){return e.value}function q5(t,e,n,r){typeof n!="string"&&n!==t.Fragment&&t.passNode&&(e.node=r)}function Yv(t,e){if(e.length>0){const n=e.length>1?e:e[0];n&&(t.children=n)}}function RJ(t,e,n){return r;function r(s,i,o,a){const u=Array.isArray(o.children)?n:e;return a?u(i,o,a):u(i,o)}}function OJ(t,e){return n;function n(r,s,i,o){const a=Array.isArray(i.children),l=Gv(r);return e(s,i,o,a,{columnNumber:l?l.column-1:void 0,fileName:t,lineNumber:l?l.line:void 0},void 0)}}function PJ(t,e){const n={};let r,s;for(s in e.properties)if(s!=="children"&&qv.call(e.properties,s)){const i=$J(t,s,e.properties[s]);if(i){const[o,a]=i;t.tableCellAlignToStyle&&o==="align"&&typeof a=="string"&&CJ.has(e.tagName)?r=a:n[o]=a}}if(r){const i=n.style||(n.style={});i[t.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return n}function LJ(t,e){const n={};for(const r of e.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&t.evaluater){const i=r.data.estree.body[0];i.type;const o=i.expression;o.type;const a=o.properties[0];a.type,Object.assign(n,t.evaluater.evaluateExpression(a.argument))}else Pf(t,e.position);else{const s=r.name;let i;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&t.evaluater){const a=r.value.data.estree.body[0];a.type,i=t.evaluater.evaluateExpression(a.expression)}else Pf(t,e.position);else i=r.value===null?!0:r.value;n[s]=i}return n}function Jv(t,e){const n=[];let r=-1;const s=t.passKeys?new Map:SJ;for(;++r<e.children.length;){const i=e.children[r];let o;if(t.passKeys){const l=i.type==="element"?i.tagName:i.type==="mdxJsxFlowElement"||i.type==="mdxJsxTextElement"?i.name:void 0;if(l){const u=s.get(l)||0;o=l+"-"+u,s.set(l,u+1)}}const a=G5(t,i,o);a!==void 0&&n.push(a)}return n}function $J(t,e,n){const r=HY(t.schema,e);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?DY(n):GY(n)),r.property==="style"){let s=typeof n=="object"?n:zJ(t,String(n));return t.stylePropertyNameCase==="css"&&(s=FJ(s)),["style",s]}return[t.elementAttributeNameCase==="react"&&r.space?FY[r.property]||r.property:r.attribute,n]}}function zJ(t,e){try{return vJ(e,{reactCompat:!0})}catch(n){if(t.ignoreInvalidStyle)return{};const r=n,s=new gs("Cannot parse `style` attribute",{ancestors:t.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw s.file=t.filePath||void 0,s.url=K5+"#cannot-parse-style-attribute",s}}function Y5(t,e,n){let r;if(!n)r={type:"Literal",value:e};else if(e.includes(".")){const s=e.split(".");let i=-1,o;for(;++i<s.length;){const a=fC(s[i])?{type:"Identifier",name:s[i]}:{type:"Literal",value:s[i]};o=o?{type:"MemberExpression",object:o,property:a,computed:!!(i&&a.type==="Literal"),optional:!1}:a}r=o}else r=fC(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(r.type==="Literal"){const s=r.value;return qv.call(t.components,s)?t.components[s]:s}if(t.evaluater)return t.evaluater.evaluateExpression(r);Pf(t)}function Pf(t,e){const n=new gs("Cannot handle MDX estrees without `createEvaluater`",{ancestors:t.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=t.filePath||void 0,n.url=K5+"#cannot-handle-mdx-estrees-without-createevaluater",n}function FJ(t){const e={};let n;for(n in t)qv.call(t,n)&&(e[BJ(n)]=t[n]);return e}function BJ(t){let e=t.replace(_J,UJ);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function UJ(t){return"-"+t.toLowerCase()}const Dy={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},HJ={};function VJ(t,e){const n=e||HJ,r=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,s=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return J5(t,r,s)}function J5(t,e,n){if(WJ(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return SC(t.children,e,n)}return Array.isArray(t)?SC(t,e,n):""}function SC(t,e,n){const r=[];let s=-1;for(;++s<t.length;)r[s]=J5(t[s],e,n);return r.join("")}function WJ(t){return!!(t&&typeof t=="object")}const _C=document.createElement("i");function Xv(t){const e="&"+t+";";_C.innerHTML=e;const n=_C.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===e?!1:n}function bo(t,e,n,r){const s=t.length;let i=0,o;if(e<0?e=-e>s?0:s+e:e=e>s?s:e,n=n>0?n:0,r.length<1e4)o=Array.from(r),o.unshift(e,n),t.splice(...o);else for(n&&t.splice(e,n);i<r.length;)o=r.slice(i,i+1e4),o.unshift(e,0),t.splice(...o),i+=1e4,e+=1e4}function pi(t,e){return t.length>0?(bo(t,t.length,0,e),t):e}const TC={}.hasOwnProperty;function KJ(t){const e={};let n=-1;for(;++n<t.length;)GJ(e,t[n]);return e}function GJ(t,e){let n;for(n in e){const s=(TC.call(t,n)?t[n]:void 0)||(t[n]={}),i=e[n];let o;if(i)for(o in i){TC.call(s,o)||(s[o]=[]);const a=i[o];qJ(s[o],Array.isArray(a)?a:a?[a]:[])}}}function qJ(t,e){let n=-1;const r=[];for(;++n<e.length;)(e[n].add==="after"?t:r).push(e[n]);bo(t,0,0,r)}function X5(t,e){const n=Number.parseInt(t,e);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function cu(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const oo=el(/[A-Za-z]/),Xs=el(/[\dA-Za-z]/),YJ=el(/[#-'*+\--9=?A-Z^-~]/);function cb(t){return t!==null&&(t<32||t===127)}const ub=el(/\d/),JJ=el(/[\dA-Fa-f]/),XJ=el(/[!-/:-@[-`{-~]/);function tn(t){return t!==null&&t<-2}function Bs(t){return t!==null&&(t<0||t===32)}function En(t){return t===-2||t===-1||t===32}const QJ=el(/\p{P}|\p{S}/u),ZJ=el(/\s/);function el(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function zu(t){const e=[];let n=-1,r=0,s=0;for(;++n<t.length;){const i=t.charCodeAt(n);let o="";if(i===37&&Xs(t.charCodeAt(n+1))&&Xs(t.charCodeAt(n+2)))s=2;else if(i<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(i))||(o=String.fromCharCode(i));else if(i>55295&&i<57344){const a=t.charCodeAt(n+1);i<56320&&a>56319&&a<57344?(o=String.fromCharCode(i,a),s=1):o=""}else o=String.fromCharCode(i);o&&(e.push(t.slice(r,n),encodeURIComponent(o)),r=n+s+1,o=""),s&&(n+=s,s=0)}return e.join("")+t.slice(r)}function Bn(t,e,n,r){const s=r?r-1:Number.POSITIVE_INFINITY;let i=0;return o;function o(l){return En(l)?(t.enter(n),a(l)):e(l)}function a(l){return En(l)&&i++<s?(t.consume(l),a):(t.exit(n),e(l))}}const eX={tokenize:tX};function tX(t){const e=t.attempt(this.parser.constructs.contentInitial,r,s);let n;return e;function r(a){if(a===null){t.consume(a);return}return t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),Bn(t,e,"linePrefix")}function s(a){return t.enter("paragraph"),i(a)}function i(a){const l=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=l),n=l,o(a)}function o(a){if(a===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(a);return}return tn(a)?(t.consume(a),t.exit("chunkText"),i):(t.consume(a),o)}}const nX={tokenize:rX},CC={tokenize:sX};function rX(t){const e=this,n=[];let r=0,s,i,o;return a;function a(w){if(r<n.length){const T=n[r];return e.containerState=T[1],t.attempt(T[0].continuation,l,u)(w)}return u(w)}function l(w){if(r++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,s&&v();const T=e.events.length;let D=T,k;for(;D--;)if(e.events[D][0]==="exit"&&e.events[D][1].type==="chunkFlow"){k=e.events[D][1].end;break}g(r);let I=T;for(;I<e.events.length;)e.events[I][1].end={...k},I++;return bo(e.events,D+1,0,e.events.slice(T)),e.events.length=I,u(w)}return a(w)}function u(w){if(r===n.length){if(!s)return h(w);if(s.currentConstruct&&s.currentConstruct.concrete)return m(w);e.interrupt=!!(s.currentConstruct&&!s._gfmTableDynamicInterruptHack)}return e.containerState={},t.check(CC,d,f)(w)}function d(w){return s&&v(),g(r),h(w)}function f(w){return e.parser.lazy[e.now().line]=r!==n.length,o=e.now().offset,m(w)}function h(w){return e.containerState={},t.attempt(CC,p,m)(w)}function p(w){return r++,n.push([e.currentConstruct,e.containerState]),h(w)}function m(w){if(w===null){s&&v(),g(0),t.consume(w);return}return s=s||e.parser.flow(e.now()),t.enter("chunkFlow",{_tokenizer:s,contentType:"flow",previous:i}),y(w)}function y(w){if(w===null){x(t.exit("chunkFlow"),!0),g(0),t.consume(w);return}return tn(w)?(t.consume(w),x(t.exit("chunkFlow")),r=0,e.interrupt=void 0,a):(t.consume(w),y)}function x(w,T){const D=e.sliceStream(w);if(T&&D.push(null),w.previous=i,i&&(i.next=w),i=w,s.defineSkip(w.start),s.write(D),e.parser.lazy[w.start.line]){let k=s.events.length;for(;k--;)if(s.events[k][1].start.offset<o&&(!s.events[k][1].end||s.events[k][1].end.offset>o))return;const I=e.events.length;let C=I,S,_;for(;C--;)if(e.events[C][0]==="exit"&&e.events[C][1].type==="chunkFlow"){if(S){_=e.events[C][1].end;break}S=!0}for(g(r),k=I;k<e.events.length;)e.events[k][1].end={..._},k++;bo(e.events,C+1,0,e.events.slice(I)),e.events.length=k}}function g(w){let T=n.length;for(;T-- >w;){const D=n[T];e.containerState=D[1],D[0].exit.call(e,t)}n.length=w}function v(){s.write([null]),i=void 0,s=void 0,e.containerState._closeFlow=void 0}}function sX(t,e,n){return Bn(t,t.attempt(this.parser.constructs.document,e,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function EC(t){if(t===null||Bs(t)||ZJ(t))return 1;if(QJ(t))return 2}function Qv(t,e,n){const r=[];let s=-1;for(;++s<t.length;){const i=t[s].resolveAll;i&&!r.includes(i)&&(e=i(e,n),r.push(i))}return e}const db={name:"attention",resolveAll:iX,tokenize:oX};function iX(t,e){let n=-1,r,s,i,o,a,l,u,d;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(r=n;r--;)if(t[r][0]==="exit"&&t[r][1].type==="attentionSequence"&&t[r][1]._open&&e.sliceSerialize(t[r][1]).charCodeAt(0)===e.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[r][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[r][1].end.offset-t[r][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;l=t[r][1].end.offset-t[r][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const f={...t[r][1].end},h={...t[n][1].start};NC(f,-l),NC(h,l),o={type:l>1?"strongSequence":"emphasisSequence",start:f,end:{...t[r][1].end}},a={type:l>1?"strongSequence":"emphasisSequence",start:{...t[n][1].start},end:h},i={type:l>1?"strongText":"emphasisText",start:{...t[r][1].end},end:{...t[n][1].start}},s={type:l>1?"strong":"emphasis",start:{...o.start},end:{...a.end}},t[r][1].end={...o.start},t[n][1].start={...a.end},u=[],t[r][1].end.offset-t[r][1].start.offset&&(u=pi(u,[["enter",t[r][1],e],["exit",t[r][1],e]])),u=pi(u,[["enter",s,e],["enter",o,e],["exit",o,e],["enter",i,e]]),u=pi(u,Qv(e.parser.constructs.insideSpan.null,t.slice(r+1,n),e)),u=pi(u,[["exit",i,e],["enter",a,e],["exit",a,e],["exit",s,e]]),t[n][1].end.offset-t[n][1].start.offset?(d=2,u=pi(u,[["enter",t[n][1],e],["exit",t[n][1],e]])):d=0,bo(t,r-1,n-r+3,u),n=r+u.length-d-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function oX(t,e){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,s=EC(r);let i;return o;function o(l){return i=l,t.enter("attentionSequence"),a(l)}function a(l){if(l===i)return t.consume(l),a;const u=t.exit("attentionSequence"),d=EC(l),f=!d||d===2&&s||n.includes(l),h=!s||s===2&&d||n.includes(r);return u._open=!!(i===42?f:f&&(s||!h)),u._close=!!(i===42?h:h&&(d||!f)),e(l)}}function NC(t,e){t.column+=e,t.offset+=e,t._bufferIndex+=e}const aX={name:"autolink",tokenize:lX};function lX(t,e,n){let r=0;return s;function s(p){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),i}function i(p){return oo(p)?(t.consume(p),o):p===64?n(p):u(p)}function o(p){return p===43||p===45||p===46||Xs(p)?(r=1,a(p)):u(p)}function a(p){return p===58?(t.consume(p),r=0,l):(p===43||p===45||p===46||Xs(p))&&r++<32?(t.consume(p),a):(r=0,u(p))}function l(p){return p===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.exit("autolink"),e):p===null||p===32||p===60||cb(p)?n(p):(t.consume(p),l)}function u(p){return p===64?(t.consume(p),d):YJ(p)?(t.consume(p),u):n(p)}function d(p){return Xs(p)?f(p):n(p)}function f(p){return p===46?(t.consume(p),r=0,d):p===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.exit("autolink"),e):h(p)}function h(p){if((p===45||Xs(p))&&r++<63){const m=p===45?h:f;return t.consume(p),m}return n(p)}}const Zg={partial:!0,tokenize:cX};function cX(t,e,n){return r;function r(i){return En(i)?Bn(t,s,"linePrefix")(i):s(i)}function s(i){return i===null||tn(i)?e(i):n(i)}}const Q5={continuation:{tokenize:dX},exit:fX,name:"blockQuote",tokenize:uX};function uX(t,e,n){const r=this;return s;function s(o){if(o===62){const a=r.containerState;return a.open||(t.enter("blockQuote",{_container:!0}),a.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(o),t.exit("blockQuoteMarker"),i}return n(o)}function i(o){return En(o)?(t.enter("blockQuotePrefixWhitespace"),t.consume(o),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),e):(t.exit("blockQuotePrefix"),e(o))}}function dX(t,e,n){const r=this;return s;function s(o){return En(o)?Bn(t,i,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o):i(o)}function i(o){return t.attempt(Q5,e,n)(o)}}function fX(t){t.exit("blockQuote")}const Z5={name:"characterEscape",tokenize:hX};function hX(t,e,n){return r;function r(i){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(i),t.exit("escapeMarker"),s}function s(i){return XJ(i)?(t.enter("characterEscapeValue"),t.consume(i),t.exit("characterEscapeValue"),t.exit("characterEscape"),e):n(i)}}const eR={name:"characterReference",tokenize:pX};function pX(t,e,n){const r=this;let s=0,i,o;return a;function a(f){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(f),t.exit("characterReferenceMarker"),l}function l(f){return f===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(f),t.exit("characterReferenceMarkerNumeric"),u):(t.enter("characterReferenceValue"),i=31,o=Xs,d(f))}function u(f){return f===88||f===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(f),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),i=6,o=JJ,d):(t.enter("characterReferenceValue"),i=7,o=ub,d(f))}function d(f){if(f===59&&s){const h=t.exit("characterReferenceValue");return o===Xs&&!Xv(r.sliceSerialize(h))?n(f):(t.enter("characterReferenceMarker"),t.consume(f),t.exit("characterReferenceMarker"),t.exit("characterReference"),e)}return o(f)&&s++<i?(t.consume(f),d):n(f)}}const jC={partial:!0,tokenize:gX},IC={concrete:!0,name:"codeFenced",tokenize:mX};function mX(t,e,n){const r=this,s={partial:!0,tokenize:D};let i=0,o=0,a;return l;function l(k){return u(k)}function u(k){const I=r.events[r.events.length-1];return i=I&&I[1].type==="linePrefix"?I[2].sliceSerialize(I[1],!0).length:0,a=k,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),d(k)}function d(k){return k===a?(o++,t.consume(k),d):o<3?n(k):(t.exit("codeFencedFenceSequence"),En(k)?Bn(t,f,"whitespace")(k):f(k))}function f(k){return k===null||tn(k)?(t.exit("codeFencedFence"),r.interrupt?e(k):t.check(jC,y,T)(k)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),h(k))}function h(k){return k===null||tn(k)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),f(k)):En(k)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),Bn(t,p,"whitespace")(k)):k===96&&k===a?n(k):(t.consume(k),h)}function p(k){return k===null||tn(k)?f(k):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),m(k))}function m(k){return k===null||tn(k)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),f(k)):k===96&&k===a?n(k):(t.consume(k),m)}function y(k){return t.attempt(s,T,x)(k)}function x(k){return t.enter("lineEnding"),t.consume(k),t.exit("lineEnding"),g}function g(k){return i>0&&En(k)?Bn(t,v,"linePrefix",i+1)(k):v(k)}function v(k){return k===null||tn(k)?t.check(jC,y,T)(k):(t.enter("codeFlowValue"),w(k))}function w(k){return k===null||tn(k)?(t.exit("codeFlowValue"),v(k)):(t.consume(k),w)}function T(k){return t.exit("codeFenced"),e(k)}function D(k,I,C){let S=0;return _;function _(W){return k.enter("lineEnding"),k.consume(W),k.exit("lineEnding"),N}function N(W){return k.enter("codeFencedFence"),En(W)?Bn(k,j,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(W):j(W)}function j(W){return W===a?(k.enter("codeFencedFenceSequence"),O(W)):C(W)}function O(W){return W===a?(S++,k.consume(W),O):S>=o?(k.exit("codeFencedFenceSequence"),En(W)?Bn(k,P,"whitespace")(W):P(W)):C(W)}function P(W){return W===null||tn(W)?(k.exit("codeFencedFence"),I(W)):C(W)}}}function gX(t,e,n){const r=this;return s;function s(o){return o===null?n(o):(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),i)}function i(o){return r.parser.lazy[r.now().line]?n(o):e(o)}}const My={name:"codeIndented",tokenize:xX},yX={partial:!0,tokenize:bX};function xX(t,e,n){const r=this;return s;function s(u){return t.enter("codeIndented"),Bn(t,i,"linePrefix",4+1)(u)}function i(u){const d=r.events[r.events.length-1];return d&&d[1].type==="linePrefix"&&d[2].sliceSerialize(d[1],!0).length>=4?o(u):n(u)}function o(u){return u===null?l(u):tn(u)?t.attempt(yX,o,l)(u):(t.enter("codeFlowValue"),a(u))}function a(u){return u===null||tn(u)?(t.exit("codeFlowValue"),o(u)):(t.consume(u),a)}function l(u){return t.exit("codeIndented"),e(u)}}function bX(t,e,n){const r=this;return s;function s(o){return r.parser.lazy[r.now().line]?n(o):tn(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),s):Bn(t,i,"linePrefix",4+1)(o)}function i(o){const a=r.events[r.events.length-1];return a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):tn(o)?s(o):n(o)}}const wX={name:"codeText",previous:kX,resolve:vX,tokenize:SX};function vX(t){let e=t.length-4,n=3,r,s;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[e][1].type==="lineEnding"||t[e][1].type==="space")){for(r=n;++r<e;)if(t[r][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[e][1].type="codeTextPadding",n+=2,e-=2;break}}for(r=n-1,e++;++r<=e;)s===void 0?r!==e&&t[r][1].type!=="lineEnding"&&(s=r):(r===e||t[r][1].type==="lineEnding")&&(t[s][1].type="codeTextData",r!==s+2&&(t[s][1].end=t[r-1][1].end,t.splice(s+2,r-s-2),e-=r-s-2,r=s+2),s=void 0);return t}function kX(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function SX(t,e,n){let r=0,s,i;return o;function o(f){return t.enter("codeText"),t.enter("codeTextSequence"),a(f)}function a(f){return f===96?(t.consume(f),r++,a):(t.exit("codeTextSequence"),l(f))}function l(f){return f===null?n(f):f===32?(t.enter("space"),t.consume(f),t.exit("space"),l):f===96?(i=t.enter("codeTextSequence"),s=0,d(f)):tn(f)?(t.enter("lineEnding"),t.consume(f),t.exit("lineEnding"),l):(t.enter("codeTextData"),u(f))}function u(f){return f===null||f===32||f===96||tn(f)?(t.exit("codeTextData"),l(f)):(t.consume(f),u)}function d(f){return f===96?(t.consume(f),s++,d):s===r?(t.exit("codeTextSequence"),t.exit("codeText"),e(f)):(i.type="codeTextData",u(f))}}class _X{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,n){const r=n??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(e,r):e>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(e,n,r){const s=n||0;this.setCursor(Math.trunc(e));const i=this.right.splice(this.right.length-s,Number.POSITIVE_INFINITY);return r&&ed(this.left,r),i.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),ed(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),ed(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const n=this.left.splice(e,Number.POSITIVE_INFINITY);ed(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);ed(this.left,n.reverse())}}}function ed(t,e){let n=0;if(e.length<1e4)t.push(...e);else for(;n<e.length;)t.push(...e.slice(n,n+1e4)),n+=1e4}function tR(t){const e={};let n=-1,r,s,i,o,a,l,u;const d=new _X(t);for(;++n<d.length;){for(;n in e;)n=e[n];if(r=d.get(n),n&&r[1].type==="chunkFlow"&&d.get(n-1)[1].type==="listItemPrefix"&&(l=r[1]._tokenizer.events,i=0,i<l.length&&l[i][1].type==="lineEndingBlank"&&(i+=2),i<l.length&&l[i][1].type==="content"))for(;++i<l.length&&l[i][1].type!=="content";)l[i][1].type==="chunkText"&&(l[i][1]._isInFirstContentOfListItem=!0,i++);if(r[0]==="enter")r[1].contentType&&(Object.assign(e,TX(d,n)),n=e[n],u=!0);else if(r[1]._container){for(i=n,s=void 0;i--;)if(o=d.get(i),o[1].type==="lineEnding"||o[1].type==="lineEndingBlank")o[0]==="enter"&&(s&&(d.get(s)[1].type="lineEndingBlank"),o[1].type="lineEnding",s=i);else if(!(o[1].type==="linePrefix"||o[1].type==="listItemIndent"))break;s&&(r[1].end={...d.get(s)[1].start},a=d.slice(s,n),a.unshift(r),d.splice(s,n-s+1,a))}}return bo(t,0,Number.POSITIVE_INFINITY,d.slice(0)),!u}function TX(t,e){const n=t.get(e)[1],r=t.get(e)[2];let s=e-1;const i=[];let o=n._tokenizer;o||(o=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(o._contentTypeTextTrailing=!0));const a=o.events,l=[],u={};let d,f,h=-1,p=n,m=0,y=0;const x=[y];for(;p;){for(;t.get(++s)[1]!==p;);i.push(s),p._tokenizer||(d=r.sliceStream(p),p.next||d.push(null),f&&o.defineSkip(p.start),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(d),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),f=p,p=p.next}for(p=n;++h<a.length;)a[h][0]==="exit"&&a[h-1][0]==="enter"&&a[h][1].type===a[h-1][1].type&&a[h][1].start.line!==a[h][1].end.line&&(y=h+1,x.push(y),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(o.events=[],p?(p._tokenizer=void 0,p.previous=void 0):x.pop(),h=x.length;h--;){const g=a.slice(x[h],x[h+1]),v=i.pop();l.push([v,v+g.length-1]),t.splice(v,2,g)}for(l.reverse(),h=-1;++h<l.length;)u[m+l[h][0]]=m+l[h][1],m+=l[h][1]-l[h][0]-1;return u}const CX={resolve:NX,tokenize:jX},EX={partial:!0,tokenize:IX};function NX(t){return tR(t),t}function jX(t,e){let n;return r;function r(a){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),s(a)}function s(a){return a===null?i(a):tn(a)?t.check(EX,o,i)(a):(t.consume(a),s)}function i(a){return t.exit("chunkContent"),t.exit("content"),e(a)}function o(a){return t.consume(a),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,s}}function IX(t,e,n){const r=this;return s;function s(o){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),Bn(t,i,"linePrefix")}function i(o){if(o===null||tn(o))return n(o);const a=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):t.interrupt(r.parser.constructs.flow,n,e)(o)}}function nR(t,e,n,r,s,i,o,a,l){const u=l||Number.POSITIVE_INFINITY;let d=0;return f;function f(g){return g===60?(t.enter(r),t.enter(s),t.enter(i),t.consume(g),t.exit(i),h):g===null||g===32||g===41||cb(g)?n(g):(t.enter(r),t.enter(o),t.enter(a),t.enter("chunkString",{contentType:"string"}),y(g))}function h(g){return g===62?(t.enter(i),t.consume(g),t.exit(i),t.exit(s),t.exit(r),e):(t.enter(a),t.enter("chunkString",{contentType:"string"}),p(g))}function p(g){return g===62?(t.exit("chunkString"),t.exit(a),h(g)):g===null||g===60||tn(g)?n(g):(t.consume(g),g===92?m:p)}function m(g){return g===60||g===62||g===92?(t.consume(g),p):p(g)}function y(g){return!d&&(g===null||g===41||Bs(g))?(t.exit("chunkString"),t.exit(a),t.exit(o),t.exit(r),e(g)):d<u&&g===40?(t.consume(g),d++,y):g===41?(t.consume(g),d--,y):g===null||g===32||g===40||cb(g)?n(g):(t.consume(g),g===92?x:y)}function x(g){return g===40||g===41||g===92?(t.consume(g),y):y(g)}}function rR(t,e,n,r,s,i){const o=this;let a=0,l;return u;function u(p){return t.enter(r),t.enter(s),t.consume(p),t.exit(s),t.enter(i),d}function d(p){return a>999||p===null||p===91||p===93&&!l||p===94&&!a&&"_hiddenFootnoteSupport"in o.parser.constructs?n(p):p===93?(t.exit(i),t.enter(s),t.consume(p),t.exit(s),t.exit(r),e):tn(p)?(t.enter("lineEnding"),t.consume(p),t.exit("lineEnding"),d):(t.enter("chunkString",{contentType:"string"}),f(p))}function f(p){return p===null||p===91||p===93||tn(p)||a++>999?(t.exit("chunkString"),d(p)):(t.consume(p),l||(l=!En(p)),p===92?h:f)}function h(p){return p===91||p===92||p===93?(t.consume(p),a++,f):f(p)}}function sR(t,e,n,r,s,i){let o;return a;function a(h){return h===34||h===39||h===40?(t.enter(r),t.enter(s),t.consume(h),t.exit(s),o=h===40?41:h,l):n(h)}function l(h){return h===o?(t.enter(s),t.consume(h),t.exit(s),t.exit(r),e):(t.enter(i),u(h))}function u(h){return h===o?(t.exit(i),l(o)):h===null?n(h):tn(h)?(t.enter("lineEnding"),t.consume(h),t.exit("lineEnding"),Bn(t,u,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),d(h))}function d(h){return h===o||h===null||tn(h)?(t.exit("chunkString"),u(h)):(t.consume(h),h===92?f:d)}function f(h){return h===o||h===92?(t.consume(h),d):d(h)}}function Ud(t,e){let n;return r;function r(s){return tn(s)?(t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),n=!0,r):En(s)?Bn(t,r,n?"linePrefix":"lineSuffix")(s):e(s)}}const DX={name:"definition",tokenize:AX},MX={partial:!0,tokenize:RX};function AX(t,e,n){const r=this;let s;return i;function i(p){return t.enter("definition"),o(p)}function o(p){return rR.call(r,t,a,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(p)}function a(p){return s=cu(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),p===58?(t.enter("definitionMarker"),t.consume(p),t.exit("definitionMarker"),l):n(p)}function l(p){return Bs(p)?Ud(t,u)(p):u(p)}function u(p){return nR(t,d,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(p)}function d(p){return t.attempt(MX,f,f)(p)}function f(p){return En(p)?Bn(t,h,"whitespace")(p):h(p)}function h(p){return p===null||tn(p)?(t.exit("definition"),r.parser.defined.push(s),e(p)):n(p)}}function RX(t,e,n){return r;function r(a){return Bs(a)?Ud(t,s)(a):n(a)}function s(a){return sR(t,i,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(a)}function i(a){return En(a)?Bn(t,o,"whitespace")(a):o(a)}function o(a){return a===null||tn(a)?e(a):n(a)}}const OX={name:"hardBreakEscape",tokenize:PX};function PX(t,e,n){return r;function r(i){return t.enter("hardBreakEscape"),t.consume(i),s}function s(i){return tn(i)?(t.exit("hardBreakEscape"),e(i)):n(i)}}const LX={name:"headingAtx",resolve:$X,tokenize:zX};function $X(t,e){let n=t.length-2,r=3,s,i;return t[r][1].type==="whitespace"&&(r+=2),n-2>r&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(r===n-1||n-4>r&&t[n-2][1].type==="whitespace")&&(n-=r+1===n?2:4),n>r&&(s={type:"atxHeadingText",start:t[r][1].start,end:t[n][1].end},i={type:"chunkText",start:t[r][1].start,end:t[n][1].end,contentType:"text"},bo(t,r,n-r+1,[["enter",s,e],["enter",i,e],["exit",i,e],["exit",s,e]])),t}function zX(t,e,n){let r=0;return s;function s(d){return t.enter("atxHeading"),i(d)}function i(d){return t.enter("atxHeadingSequence"),o(d)}function o(d){return d===35&&r++<6?(t.consume(d),o):d===null||Bs(d)?(t.exit("atxHeadingSequence"),a(d)):n(d)}function a(d){return d===35?(t.enter("atxHeadingSequence"),l(d)):d===null||tn(d)?(t.exit("atxHeading"),e(d)):En(d)?Bn(t,a,"whitespace")(d):(t.enter("atxHeadingText"),u(d))}function l(d){return d===35?(t.consume(d),l):(t.exit("atxHeadingSequence"),a(d))}function u(d){return d===null||d===35||Bs(d)?(t.exit("atxHeadingText"),a(d)):(t.consume(d),u)}}const FX=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],DC=["pre","script","style","textarea"],BX={concrete:!0,name:"htmlFlow",resolveTo:VX,tokenize:WX},UX={partial:!0,tokenize:GX},HX={partial:!0,tokenize:KX};function VX(t){let e=t.length;for(;e--&&!(t[e][0]==="enter"&&t[e][1].type==="htmlFlow"););return e>1&&t[e-2][1].type==="linePrefix"&&(t[e][1].start=t[e-2][1].start,t[e+1][1].start=t[e-2][1].start,t.splice(e-2,2)),t}function WX(t,e,n){const r=this;let s,i,o,a,l;return u;function u(B){return d(B)}function d(B){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(B),f}function f(B){return B===33?(t.consume(B),h):B===47?(t.consume(B),i=!0,y):B===63?(t.consume(B),s=3,r.interrupt?e:A):oo(B)?(t.consume(B),o=String.fromCharCode(B),x):n(B)}function h(B){return B===45?(t.consume(B),s=2,p):B===91?(t.consume(B),s=5,a=0,m):oo(B)?(t.consume(B),s=4,r.interrupt?e:A):n(B)}function p(B){return B===45?(t.consume(B),r.interrupt?e:A):n(B)}function m(B){const F="CDATA[";return B===F.charCodeAt(a++)?(t.consume(B),a===F.length?r.interrupt?e:j:m):n(B)}function y(B){return oo(B)?(t.consume(B),o=String.fromCharCode(B),x):n(B)}function x(B){if(B===null||B===47||B===62||Bs(B)){const F=B===47,ne=o.toLowerCase();return!F&&!i&&DC.includes(ne)?(s=1,r.interrupt?e(B):j(B)):FX.includes(o.toLowerCase())?(s=6,F?(t.consume(B),g):r.interrupt?e(B):j(B)):(s=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(B):i?v(B):w(B))}return B===45||Xs(B)?(t.consume(B),o+=String.fromCharCode(B),x):n(B)}function g(B){return B===62?(t.consume(B),r.interrupt?e:j):n(B)}function v(B){return En(B)?(t.consume(B),v):_(B)}function w(B){return B===47?(t.consume(B),_):B===58||B===95||oo(B)?(t.consume(B),T):En(B)?(t.consume(B),w):_(B)}function T(B){return B===45||B===46||B===58||B===95||Xs(B)?(t.consume(B),T):D(B)}function D(B){return B===61?(t.consume(B),k):En(B)?(t.consume(B),D):w(B)}function k(B){return B===null||B===60||B===61||B===62||B===96?n(B):B===34||B===39?(t.consume(B),l=B,I):En(B)?(t.consume(B),k):C(B)}function I(B){return B===l?(t.consume(B),l=null,S):B===null||tn(B)?n(B):(t.consume(B),I)}function C(B){return B===null||B===34||B===39||B===47||B===60||B===61||B===62||B===96||Bs(B)?D(B):(t.consume(B),C)}function S(B){return B===47||B===62||En(B)?w(B):n(B)}function _(B){return B===62?(t.consume(B),N):n(B)}function N(B){return B===null||tn(B)?j(B):En(B)?(t.consume(B),N):n(B)}function j(B){return B===45&&s===2?(t.consume(B),R):B===60&&s===1?(t.consume(B),M):B===62&&s===4?(t.consume(B),Te):B===63&&s===3?(t.consume(B),A):B===93&&s===5?(t.consume(B),Q):tn(B)&&(s===6||s===7)?(t.exit("htmlFlowData"),t.check(UX,we,O)(B)):B===null||tn(B)?(t.exit("htmlFlowData"),O(B)):(t.consume(B),j)}function O(B){return t.check(HX,P,we)(B)}function P(B){return t.enter("lineEnding"),t.consume(B),t.exit("lineEnding"),W}function W(B){return B===null||tn(B)?O(B):(t.enter("htmlFlowData"),j(B))}function R(B){return B===45?(t.consume(B),A):j(B)}function M(B){return B===47?(t.consume(B),o="",X):j(B)}function X(B){if(B===62){const F=o.toLowerCase();return DC.includes(F)?(t.consume(B),Te):j(B)}return oo(B)&&o.length<8?(t.consume(B),o+=String.fromCharCode(B),X):j(B)}function Q(B){return B===93?(t.consume(B),A):j(B)}function A(B){return B===62?(t.consume(B),Te):B===45&&s===2?(t.consume(B),A):j(B)}function Te(B){return B===null||tn(B)?(t.exit("htmlFlowData"),we(B)):(t.consume(B),Te)}function we(B){return t.exit("htmlFlow"),e(B)}}function KX(t,e,n){const r=this;return s;function s(o){return tn(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),i):n(o)}function i(o){return r.parser.lazy[r.now().line]?n(o):e(o)}}function GX(t,e,n){return r;function r(s){return t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),t.attempt(Zg,e,n)}}const qX={name:"htmlText",tokenize:YX};function YX(t,e,n){const r=this;let s,i,o;return a;function a(A){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(A),l}function l(A){return A===33?(t.consume(A),u):A===47?(t.consume(A),D):A===63?(t.consume(A),w):oo(A)?(t.consume(A),C):n(A)}function u(A){return A===45?(t.consume(A),d):A===91?(t.consume(A),i=0,m):oo(A)?(t.consume(A),v):n(A)}function d(A){return A===45?(t.consume(A),p):n(A)}function f(A){return A===null?n(A):A===45?(t.consume(A),h):tn(A)?(o=f,M(A)):(t.consume(A),f)}function h(A){return A===45?(t.consume(A),p):f(A)}function p(A){return A===62?R(A):A===45?h(A):f(A)}function m(A){const Te="CDATA[";return A===Te.charCodeAt(i++)?(t.consume(A),i===Te.length?y:m):n(A)}function y(A){return A===null?n(A):A===93?(t.consume(A),x):tn(A)?(o=y,M(A)):(t.consume(A),y)}function x(A){return A===93?(t.consume(A),g):y(A)}function g(A){return A===62?R(A):A===93?(t.consume(A),g):y(A)}function v(A){return A===null||A===62?R(A):tn(A)?(o=v,M(A)):(t.consume(A),v)}function w(A){return A===null?n(A):A===63?(t.consume(A),T):tn(A)?(o=w,M(A)):(t.consume(A),w)}function T(A){return A===62?R(A):w(A)}function D(A){return oo(A)?(t.consume(A),k):n(A)}function k(A){return A===45||Xs(A)?(t.consume(A),k):I(A)}function I(A){return tn(A)?(o=I,M(A)):En(A)?(t.consume(A),I):R(A)}function C(A){return A===45||Xs(A)?(t.consume(A),C):A===47||A===62||Bs(A)?S(A):n(A)}function S(A){return A===47?(t.consume(A),R):A===58||A===95||oo(A)?(t.consume(A),_):tn(A)?(o=S,M(A)):En(A)?(t.consume(A),S):R(A)}function _(A){return A===45||A===46||A===58||A===95||Xs(A)?(t.consume(A),_):N(A)}function N(A){return A===61?(t.consume(A),j):tn(A)?(o=N,M(A)):En(A)?(t.consume(A),N):S(A)}function j(A){return A===null||A===60||A===61||A===62||A===96?n(A):A===34||A===39?(t.consume(A),s=A,O):tn(A)?(o=j,M(A)):En(A)?(t.consume(A),j):(t.consume(A),P)}function O(A){return A===s?(t.consume(A),s=void 0,W):A===null?n(A):tn(A)?(o=O,M(A)):(t.consume(A),O)}function P(A){return A===null||A===34||A===39||A===60||A===61||A===96?n(A):A===47||A===62||Bs(A)?S(A):(t.consume(A),P)}function W(A){return A===47||A===62||Bs(A)?S(A):n(A)}function R(A){return A===62?(t.consume(A),t.exit("htmlTextData"),t.exit("htmlText"),e):n(A)}function M(A){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(A),t.exit("lineEnding"),X}function X(A){return En(A)?Bn(t,Q,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(A):Q(A)}function Q(A){return t.enter("htmlTextData"),o(A)}}const Zv={name:"labelEnd",resolveAll:ZX,resolveTo:eQ,tokenize:tQ},JX={tokenize:nQ},XX={tokenize:rQ},QX={tokenize:sQ};function ZX(t){let e=-1;const n=[];for(;++e<t.length;){const r=t[e][1];if(n.push(t[e]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const s=r.type==="labelImage"?4:2;r.type="data",e+=s}}return t.length!==n.length&&bo(t,0,t.length,n),t}function eQ(t,e){let n=t.length,r=0,s,i,o,a;for(;n--;)if(s=t[n][1],i){if(s.type==="link"||s.type==="labelLink"&&s._inactive)break;t[n][0]==="enter"&&s.type==="labelLink"&&(s._inactive=!0)}else if(o){if(t[n][0]==="enter"&&(s.type==="labelImage"||s.type==="labelLink")&&!s._balanced&&(i=n,s.type!=="labelLink")){r=2;break}}else s.type==="labelEnd"&&(o=n);const l={type:t[i][1].type==="labelLink"?"link":"image",start:{...t[i][1].start},end:{...t[t.length-1][1].end}},u={type:"label",start:{...t[i][1].start},end:{...t[o][1].end}},d={type:"labelText",start:{...t[i+r+2][1].end},end:{...t[o-2][1].start}};return a=[["enter",l,e],["enter",u,e]],a=pi(a,t.slice(i+1,i+r+3)),a=pi(a,[["enter",d,e]]),a=pi(a,Qv(e.parser.constructs.insideSpan.null,t.slice(i+r+4,o-3),e)),a=pi(a,[["exit",d,e],t[o-2],t[o-1],["exit",u,e]]),a=pi(a,t.slice(o+1)),a=pi(a,[["exit",l,e]]),bo(t,i,t.length,a),t}function tQ(t,e,n){const r=this;let s=r.events.length,i,o;for(;s--;)if((r.events[s][1].type==="labelImage"||r.events[s][1].type==="labelLink")&&!r.events[s][1]._balanced){i=r.events[s][1];break}return a;function a(h){return i?i._inactive?f(h):(o=r.parser.defined.includes(cu(r.sliceSerialize({start:i.end,end:r.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(h),t.exit("labelMarker"),t.exit("labelEnd"),l):n(h)}function l(h){return h===40?t.attempt(JX,d,o?d:f)(h):h===91?t.attempt(XX,d,o?u:f)(h):o?d(h):f(h)}function u(h){return t.attempt(QX,d,f)(h)}function d(h){return e(h)}function f(h){return i._balanced=!0,n(h)}}function nQ(t,e,n){return r;function r(f){return t.enter("resource"),t.enter("resourceMarker"),t.consume(f),t.exit("resourceMarker"),s}function s(f){return Bs(f)?Ud(t,i)(f):i(f)}function i(f){return f===41?d(f):nR(t,o,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(f)}function o(f){return Bs(f)?Ud(t,l)(f):d(f)}function a(f){return n(f)}function l(f){return f===34||f===39||f===40?sR(t,u,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(f):d(f)}function u(f){return Bs(f)?Ud(t,d)(f):d(f)}function d(f){return f===41?(t.enter("resourceMarker"),t.consume(f),t.exit("resourceMarker"),t.exit("resource"),e):n(f)}}function rQ(t,e,n){const r=this;return s;function s(a){return rR.call(r,t,i,o,"reference","referenceMarker","referenceString")(a)}function i(a){return r.parser.defined.includes(cu(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(a):n(a)}function o(a){return n(a)}}function sQ(t,e,n){return r;function r(i){return t.enter("reference"),t.enter("referenceMarker"),t.consume(i),t.exit("referenceMarker"),s}function s(i){return i===93?(t.enter("referenceMarker"),t.consume(i),t.exit("referenceMarker"),t.exit("reference"),e):n(i)}}const iQ={name:"labelStartImage",resolveAll:Zv.resolveAll,tokenize:oQ};function oQ(t,e,n){const r=this;return s;function s(a){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(a),t.exit("labelImageMarker"),i}function i(a){return a===91?(t.enter("labelMarker"),t.consume(a),t.exit("labelMarker"),t.exit("labelImage"),o):n(a)}function o(a){return a===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(a):e(a)}}const aQ={name:"labelStartLink",resolveAll:Zv.resolveAll,tokenize:lQ};function lQ(t,e,n){const r=this;return s;function s(o){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(o),t.exit("labelMarker"),t.exit("labelLink"),i}function i(o){return o===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(o):e(o)}}const Ay={name:"lineEnding",tokenize:cQ};function cQ(t,e){return n;function n(r){return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),Bn(t,e,"linePrefix")}}const Ep={name:"thematicBreak",tokenize:uQ};function uQ(t,e,n){let r=0,s;return i;function i(u){return t.enter("thematicBreak"),o(u)}function o(u){return s=u,a(u)}function a(u){return u===s?(t.enter("thematicBreakSequence"),l(u)):r>=3&&(u===null||tn(u))?(t.exit("thematicBreak"),e(u)):n(u)}function l(u){return u===s?(t.consume(u),r++,l):(t.exit("thematicBreakSequence"),En(u)?Bn(t,a,"whitespace")(u):a(u))}}const js={continuation:{tokenize:pQ},exit:gQ,name:"list",tokenize:hQ},dQ={partial:!0,tokenize:yQ},fQ={partial:!0,tokenize:mQ};function hQ(t,e,n){const r=this,s=r.events[r.events.length-1];let i=s&&s[1].type==="linePrefix"?s[2].sliceSerialize(s[1],!0).length:0,o=0;return a;function a(p){const m=r.containerState.type||(p===42||p===43||p===45?"listUnordered":"listOrdered");if(m==="listUnordered"?!r.containerState.marker||p===r.containerState.marker:ub(p)){if(r.containerState.type||(r.containerState.type=m,t.enter(m,{_container:!0})),m==="listUnordered")return t.enter("listItemPrefix"),p===42||p===45?t.check(Ep,n,u)(p):u(p);if(!r.interrupt||p===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),l(p)}return n(p)}function l(p){return ub(p)&&++o<10?(t.consume(p),l):(!r.interrupt||o<2)&&(r.containerState.marker?p===r.containerState.marker:p===41||p===46)?(t.exit("listItemValue"),u(p)):n(p)}function u(p){return t.enter("listItemMarker"),t.consume(p),t.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||p,t.check(Zg,r.interrupt?n:d,t.attempt(dQ,h,f))}function d(p){return r.containerState.initialBlankLine=!0,i++,h(p)}function f(p){return En(p)?(t.enter("listItemPrefixWhitespace"),t.consume(p),t.exit("listItemPrefixWhitespace"),h):n(p)}function h(p){return r.containerState.size=i+r.sliceSerialize(t.exit("listItemPrefix"),!0).length,e(p)}}function pQ(t,e,n){const r=this;return r.containerState._closeFlow=void 0,t.check(Zg,s,i);function s(a){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,Bn(t,e,"listItemIndent",r.containerState.size+1)(a)}function i(a){return r.containerState.furtherBlankLines||!En(a)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,o(a)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,t.attempt(fQ,e,o)(a))}function o(a){return r.containerState._closeFlow=!0,r.interrupt=void 0,Bn(t,t.attempt(js,e,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a)}}function mQ(t,e,n){const r=this;return Bn(t,s,"listItemIndent",r.containerState.size+1);function s(i){const o=r.events[r.events.length-1];return o&&o[1].type==="listItemIndent"&&o[2].sliceSerialize(o[1],!0).length===r.containerState.size?e(i):n(i)}}function gQ(t){t.exit(this.containerState.type)}function yQ(t,e,n){const r=this;return Bn(t,s,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4+1);function s(i){const o=r.events[r.events.length-1];return!En(i)&&o&&o[1].type==="listItemPrefixWhitespace"?e(i):n(i)}}const MC={name:"setextUnderline",resolveTo:xQ,tokenize:bQ};function xQ(t,e){let n=t.length,r,s,i;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){r=n;break}t[n][1].type==="paragraph"&&(s=n)}else t[n][1].type==="content"&&t.splice(n,1),!i&&t[n][1].type==="definition"&&(i=n);const o={type:"setextHeading",start:{...t[r][1].start},end:{...t[t.length-1][1].end}};return t[s][1].type="setextHeadingText",i?(t.splice(s,0,["enter",o,e]),t.splice(i+1,0,["exit",t[r][1],e]),t[r][1].end={...t[i][1].end}):t[r][1]=o,t.push(["exit",o,e]),t}function bQ(t,e,n){const r=this;let s;return i;function i(u){let d=r.events.length,f;for(;d--;)if(r.events[d][1].type!=="lineEnding"&&r.events[d][1].type!=="linePrefix"&&r.events[d][1].type!=="content"){f=r.events[d][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||f)?(t.enter("setextHeadingLine"),s=u,o(u)):n(u)}function o(u){return t.enter("setextHeadingLineSequence"),a(u)}function a(u){return u===s?(t.consume(u),a):(t.exit("setextHeadingLineSequence"),En(u)?Bn(t,l,"lineSuffix")(u):l(u))}function l(u){return u===null||tn(u)?(t.exit("setextHeadingLine"),e(u)):n(u)}}const wQ={tokenize:vQ};function vQ(t){const e=this,n=t.attempt(Zg,r,t.attempt(this.parser.constructs.flowInitial,s,Bn(t,t.attempt(this.parser.constructs.flow,s,t.attempt(CX,s)),"linePrefix")));return n;function r(i){if(i===null){t.consume(i);return}return t.enter("lineEndingBlank"),t.consume(i),t.exit("lineEndingBlank"),e.currentConstruct=void 0,n}function s(i){if(i===null){t.consume(i);return}return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),e.currentConstruct=void 0,n}}const kQ={resolveAll:oR()},SQ=iR("string"),_Q=iR("text");function iR(t){return{resolveAll:oR(t==="text"?TQ:void 0),tokenize:e};function e(n){const r=this,s=this.parser.constructs[t],i=n.attempt(s,o,a);return o;function o(d){return u(d)?i(d):a(d)}function a(d){if(d===null){n.consume(d);return}return n.enter("data"),n.consume(d),l}function l(d){return u(d)?(n.exit("data"),i(d)):(n.consume(d),l)}function u(d){if(d===null)return!0;const f=s[d];let h=-1;if(f)for(;++h<f.length;){const p=f[h];if(!p.previous||p.previous.call(r,r.previous))return!0}return!1}}}function oR(t){return e;function e(n,r){let s=-1,i;for(;++s<=n.length;)i===void 0?n[s]&&n[s][1].type==="data"&&(i=s,s++):(!n[s]||n[s][1].type!=="data")&&(s!==i+2&&(n[i][1].end=n[s-1][1].end,n.splice(i+2,s-i-2),s=i+2),i=void 0);return t?t(n,r):n}}function TQ(t,e){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const r=t[n-1][1],s=e.sliceStream(r);let i=s.length,o=-1,a=0,l;for(;i--;){const u=s[i];if(typeof u=="string"){for(o=u.length;u.charCodeAt(o-1)===32;)a++,o--;if(o)break;o=-1}else if(u===-2)l=!0,a++;else if(u!==-1){i++;break}}if(e._contentTypeTextTrailing&&n===t.length&&(a=0),a){const u={type:n===t.length||l||a<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:i?o:r.start._bufferIndex+o,_index:r.start._index+i,line:r.end.line,column:r.end.column-a,offset:r.end.offset-a},end:{...r.end}};r.end={...u.start},r.start.offset===r.end.offset?Object.assign(r,u):(t.splice(n,0,["enter",u,e],["exit",u,e]),n+=2)}n++}return t}const CQ={42:js,43:js,45:js,48:js,49:js,50:js,51:js,52:js,53:js,54:js,55:js,56:js,57:js,62:Q5},EQ={91:DX},NQ={[-2]:My,[-1]:My,32:My},jQ={35:LX,42:Ep,45:[MC,Ep],60:BX,61:MC,95:Ep,96:IC,126:IC},IQ={38:eR,92:Z5},DQ={[-5]:Ay,[-4]:Ay,[-3]:Ay,33:iQ,38:eR,42:db,60:[aX,qX],91:aQ,92:[OX,Z5],93:Zv,95:db,96:wX},MQ={null:[db,kQ]},AQ={null:[42,95]},RQ={null:[]},OQ=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:AQ,contentInitial:EQ,disable:RQ,document:CQ,flow:jQ,flowInitial:NQ,insideSpan:MQ,string:IQ,text:DQ},Symbol.toStringTag,{value:"Module"}));function PQ(t,e,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const s={},i=[];let o=[],a=[];const l={attempt:I(D),check:I(k),consume:v,enter:w,exit:T,interrupt:I(k,{interrupt:!0})},u={code:null,containerState:{},defineSkip:y,events:[],now:m,parser:t,previous:null,sliceSerialize:h,sliceStream:p,write:f};let d=e.tokenize.call(u,l);return e.resolveAll&&i.push(e),u;function f(N){return o=pi(o,N),x(),o[o.length-1]!==null?[]:(C(e,0),u.events=Qv(i,u.events,u),u.events)}function h(N,j){return $Q(p(N),j)}function p(N){return LQ(o,N)}function m(){const{_bufferIndex:N,_index:j,line:O,column:P,offset:W}=r;return{_bufferIndex:N,_index:j,line:O,column:P,offset:W}}function y(N){s[N.line]=N.column,_()}function x(){let N;for(;r._index<o.length;){const j=o[r._index];if(typeof j=="string")for(N=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===N&&r._bufferIndex<j.length;)g(j.charCodeAt(r._bufferIndex));else g(j)}}function g(N){d=d(N)}function v(N){tn(N)?(r.line++,r.column=1,r.offset+=N===-3?2:1,_()):N!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===o[r._index].length&&(r._bufferIndex=-1,r._index++)),u.previous=N}function w(N,j){const O=j||{};return O.type=N,O.start=m(),u.events.push(["enter",O,u]),a.push(O),O}function T(N){const j=a.pop();return j.end=m(),u.events.push(["exit",j,u]),j}function D(N,j){C(N,j.from)}function k(N,j){j.restore()}function I(N,j){return O;function O(P,W,R){let M,X,Q,A;return Array.isArray(P)?we(P):"tokenize"in P?we([P]):Te(P);function Te(We){return ft;function ft(le){const De=le!==null&&We[le],ie=le!==null&&We.null,Fe=[...Array.isArray(De)?De:De?[De]:[],...Array.isArray(ie)?ie:ie?[ie]:[]];return we(Fe)(le)}}function we(We){return M=We,X=0,We.length===0?R:B(We[X])}function B(We){return ft;function ft(le){return A=S(),Q=We,We.partial||(u.currentConstruct=We),We.name&&u.parser.constructs.disable.null.includes(We.name)?ne():We.tokenize.call(j?Object.assign(Object.create(u),j):u,l,F,ne)(le)}}function F(We){return N(Q,A),W}function ne(We){return A.restore(),++X<M.length?B(M[X]):R}}}function C(N,j){N.resolveAll&&!i.includes(N)&&i.push(N),N.resolve&&bo(u.events,j,u.events.length-j,N.resolve(u.events.slice(j),u)),N.resolveTo&&(u.events=N.resolveTo(u.events,u))}function S(){const N=m(),j=u.previous,O=u.currentConstruct,P=u.events.length,W=Array.from(a);return{from:P,restore:R};function R(){r=N,u.previous=j,u.currentConstruct=O,u.events.length=P,a=W,_()}}function _(){r.line in s&&r.column<2&&(r.column=s[r.line],r.offset+=s[r.line]-1)}}function LQ(t,e){const n=e.start._index,r=e.start._bufferIndex,s=e.end._index,i=e.end._bufferIndex;let o;if(n===s)o=[t[n].slice(r,i)];else{if(o=t.slice(n,s),r>-1){const a=o[0];typeof a=="string"?o[0]=a.slice(r):o.shift()}i>0&&o.push(t[s].slice(0,i))}return o}function $Q(t,e){let n=-1;const r=[];let s;for(;++n<t.length;){const i=t[n];let o;if(typeof i=="string")o=i;else switch(i){case-5:{o="\r";break}case-4:{o=`
`;break}case-3:{o=`\r
`;break}case-2:{o=e?" ":"	";break}case-1:{if(!e&&s)continue;o=" ";break}default:o=String.fromCharCode(i)}s=i===-2,r.push(o)}return r.join("")}function zQ(t){const r={constructs:KJ([OQ,...(t||{}).extensions||[]]),content:s(eX),defined:[],document:s(nX),flow:s(wQ),lazy:{},string:s(SQ),text:s(_Q)};return r;function s(i){return o;function o(a){return PQ(r,i,a)}}}function FQ(t){for(;!tR(t););return t}const AC=/[\0\t\n\r]/g;function BQ(){let t=1,e="",n=!0,r;return s;function s(i,o,a){const l=[];let u,d,f,h,p;for(i=e+(typeof i=="string"?i.toString():new TextDecoder(o||void 0).decode(i)),f=0,e="",n&&(i.charCodeAt(0)===65279&&f++,n=void 0);f<i.length;){if(AC.lastIndex=f,u=AC.exec(i),h=u&&u.index!==void 0?u.index:i.length,p=i.charCodeAt(h),!u){e=i.slice(f);break}if(p===10&&f===h&&r)l.push(-3),r=void 0;else switch(r&&(l.push(-5),r=void 0),f<h&&(l.push(i.slice(f,h)),t+=h-f),p){case 0:{l.push(65533),t++;break}case 9:{for(d=Math.ceil(t/4)*4,l.push(-2);t++<d;)l.push(-1);break}case 10:{l.push(-4),t=1;break}default:r=!0,t=1}f=h+1}return a&&(r&&l.push(-5),e&&l.push(e),l.push(null)),l}}const UQ=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function HQ(t){return t.replace(UQ,VQ)}function VQ(t,e,n){if(e)return e;if(n.charCodeAt(0)===35){const s=n.charCodeAt(1),i=s===120||s===88;return X5(n.slice(i?2:1),i?16:10)}return Xv(n)||t}const aR={}.hasOwnProperty;function WQ(t,e,n){return typeof e!="string"&&(n=e,e=void 0),KQ(n)(FQ(zQ(n).document().write(BQ()(t,e,!0))))}function KQ(t){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:i(ue),autolinkProtocol:S,autolinkEmail:S,atxHeading:i(Ve),blockQuote:i(ie),characterEscape:S,characterReference:S,codeFenced:i(Fe),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:i(Fe,o),codeText:i(_e,o),codeTextData:S,data:S,codeFlowValue:S,definition:i(tt),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:i(Xe),hardBreakEscape:i(it),hardBreakTrailing:i(it),htmlFlow:i(Ue,o),htmlFlowData:S,htmlText:i(Ue,o),htmlTextData:S,image:i(K),label:o,link:i(ue),listItem:i(oe),listItemValue:h,listOrdered:i(re,f),listUnordered:i(re),paragraph:i(pe),reference:B,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:i(Ve),strong:i(se),thematicBreak:i(Pe)},exit:{atxHeading:l(),atxHeadingSequence:D,autolink:l(),autolinkEmail:De,autolinkProtocol:le,blockQuote:l(),characterEscapeValue:_,characterReferenceMarkerHexadecimal:ne,characterReferenceMarkerNumeric:ne,characterReferenceValue:We,characterReference:ft,codeFenced:l(x),codeFencedFence:y,codeFencedFenceInfo:p,codeFencedFenceMeta:m,codeFlowValue:_,codeIndented:l(g),codeText:l(W),codeTextData:_,data:_,definition:l(),definitionDestinationString:T,definitionLabelString:v,definitionTitleString:w,emphasis:l(),hardBreakEscape:l(j),hardBreakTrailing:l(j),htmlFlow:l(O),htmlFlowData:_,htmlText:l(P),htmlTextData:_,image:l(M),label:Q,labelText:X,lineEnding:N,link:l(R),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:F,resourceDestinationString:A,resourceTitleString:Te,resource:we,setextHeading:l(C),setextHeadingLineSequence:I,setextHeadingText:k,strong:l(),thematicBreak:l()}};lR(e,(t||{}).mdastExtensions||[]);const n={};return r;function r(ye){let ze={type:"root",children:[]};const Ze={stack:[ze],tokenStack:[],config:e,enter:a,exit:u,buffer:o,resume:d,data:n},gt=[];let vt=-1;for(;++vt<ye.length;)if(ye[vt][1].type==="listOrdered"||ye[vt][1].type==="listUnordered")if(ye[vt][0]==="enter")gt.push(vt);else{const me=gt.pop();vt=s(ye,me,vt)}for(vt=-1;++vt<ye.length;){const me=e[ye[vt][0]];aR.call(me,ye[vt][1].type)&&me[ye[vt][1].type].call(Object.assign({sliceSerialize:ye[vt][2].sliceSerialize},Ze),ye[vt][1])}if(Ze.tokenStack.length>0){const me=Ze.tokenStack[Ze.tokenStack.length-1];(me[1]||RC).call(Ze,void 0,me[0])}for(ze.position={start:na(ye.length>0?ye[0][1].start:{line:1,column:1,offset:0}),end:na(ye.length>0?ye[ye.length-2][1].end:{line:1,column:1,offset:0})},vt=-1;++vt<e.transforms.length;)ze=e.transforms[vt](ze)||ze;return ze}function s(ye,ze,Ze){let gt=ze-1,vt=-1,me=!1,He,qe,nt,Me;for(;++gt<=Ze;){const ut=ye[gt];switch(ut[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{ut[0]==="enter"?vt++:vt--,Me=void 0;break}case"lineEndingBlank":{ut[0]==="enter"&&(He&&!Me&&!vt&&!nt&&(nt=gt),Me=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Me=void 0}if(!vt&&ut[0]==="enter"&&ut[1].type==="listItemPrefix"||vt===-1&&ut[0]==="exit"&&(ut[1].type==="listUnordered"||ut[1].type==="listOrdered")){if(He){let ee=gt;for(qe=void 0;ee--;){const fe=ye[ee];if(fe[1].type==="lineEnding"||fe[1].type==="lineEndingBlank"){if(fe[0]==="exit")continue;qe&&(ye[qe][1].type="lineEndingBlank",me=!0),fe[1].type="lineEnding",qe=ee}else if(!(fe[1].type==="linePrefix"||fe[1].type==="blockQuotePrefix"||fe[1].type==="blockQuotePrefixWhitespace"||fe[1].type==="blockQuoteMarker"||fe[1].type==="listItemIndent"))break}nt&&(!qe||nt<qe)&&(He._spread=!0),He.end=Object.assign({},qe?ye[qe][1].start:ut[1].end),ye.splice(qe||gt,0,["exit",He,ut[2]]),gt++,Ze++}if(ut[1].type==="listItemPrefix"){const ee={type:"listItem",_spread:!1,start:Object.assign({},ut[1].start),end:void 0};He=ee,ye.splice(gt,0,["enter",ee,ut[2]]),gt++,Ze++,nt=void 0,Me=!0}}}return ye[ze][1]._spread=me,Ze}function i(ye,ze){return Ze;function Ze(gt){a.call(this,ye(gt),gt),ze&&ze.call(this,gt)}}function o(){this.stack.push({type:"fragment",children:[]})}function a(ye,ze,Ze){this.stack[this.stack.length-1].children.push(ye),this.stack.push(ye),this.tokenStack.push([ze,Ze||void 0]),ye.position={start:na(ze.start),end:void 0}}function l(ye){return ze;function ze(Ze){ye&&ye.call(this,Ze),u.call(this,Ze)}}function u(ye,ze){const Ze=this.stack.pop(),gt=this.tokenStack.pop();if(gt)gt[0].type!==ye.type&&(ze?ze.call(this,ye,gt[0]):(gt[1]||RC).call(this,ye,gt[0]));else throw new Error("Cannot close `"+ye.type+"` ("+Bd({start:ye.start,end:ye.end})+"): its not open");Ze.position.end=na(ye.end)}function d(){return VJ(this.stack.pop())}function f(){this.data.expectingFirstListItemValue=!0}function h(ye){if(this.data.expectingFirstListItemValue){const ze=this.stack[this.stack.length-2];ze.start=Number.parseInt(this.sliceSerialize(ye),10),this.data.expectingFirstListItemValue=void 0}}function p(){const ye=this.resume(),ze=this.stack[this.stack.length-1];ze.lang=ye}function m(){const ye=this.resume(),ze=this.stack[this.stack.length-1];ze.meta=ye}function y(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function x(){const ye=this.resume(),ze=this.stack[this.stack.length-1];ze.value=ye.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function g(){const ye=this.resume(),ze=this.stack[this.stack.length-1];ze.value=ye.replace(/(\r?\n|\r)$/g,"")}function v(ye){const ze=this.resume(),Ze=this.stack[this.stack.length-1];Ze.label=ze,Ze.identifier=cu(this.sliceSerialize(ye)).toLowerCase()}function w(){const ye=this.resume(),ze=this.stack[this.stack.length-1];ze.title=ye}function T(){const ye=this.resume(),ze=this.stack[this.stack.length-1];ze.url=ye}function D(ye){const ze=this.stack[this.stack.length-1];if(!ze.depth){const Ze=this.sliceSerialize(ye).length;ze.depth=Ze}}function k(){this.data.setextHeadingSlurpLineEnding=!0}function I(ye){const ze=this.stack[this.stack.length-1];ze.depth=this.sliceSerialize(ye).codePointAt(0)===61?1:2}function C(){this.data.setextHeadingSlurpLineEnding=void 0}function S(ye){const Ze=this.stack[this.stack.length-1].children;let gt=Ze[Ze.length-1];(!gt||gt.type!=="text")&&(gt=Se(),gt.position={start:na(ye.start),end:void 0},Ze.push(gt)),this.stack.push(gt)}function _(ye){const ze=this.stack.pop();ze.value+=this.sliceSerialize(ye),ze.position.end=na(ye.end)}function N(ye){const ze=this.stack[this.stack.length-1];if(this.data.atHardBreak){const Ze=ze.children[ze.children.length-1];Ze.position.end=na(ye.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(ze.type)&&(S.call(this,ye),_.call(this,ye))}function j(){this.data.atHardBreak=!0}function O(){const ye=this.resume(),ze=this.stack[this.stack.length-1];ze.value=ye}function P(){const ye=this.resume(),ze=this.stack[this.stack.length-1];ze.value=ye}function W(){const ye=this.resume(),ze=this.stack[this.stack.length-1];ze.value=ye}function R(){const ye=this.stack[this.stack.length-1];if(this.data.inReference){const ze=this.data.referenceType||"shortcut";ye.type+="Reference",ye.referenceType=ze,delete ye.url,delete ye.title}else delete ye.identifier,delete ye.label;this.data.referenceType=void 0}function M(){const ye=this.stack[this.stack.length-1];if(this.data.inReference){const ze=this.data.referenceType||"shortcut";ye.type+="Reference",ye.referenceType=ze,delete ye.url,delete ye.title}else delete ye.identifier,delete ye.label;this.data.referenceType=void 0}function X(ye){const ze=this.sliceSerialize(ye),Ze=this.stack[this.stack.length-2];Ze.label=HQ(ze),Ze.identifier=cu(ze).toLowerCase()}function Q(){const ye=this.stack[this.stack.length-1],ze=this.resume(),Ze=this.stack[this.stack.length-1];if(this.data.inReference=!0,Ze.type==="link"){const gt=ye.children;Ze.children=gt}else Ze.alt=ze}function A(){const ye=this.resume(),ze=this.stack[this.stack.length-1];ze.url=ye}function Te(){const ye=this.resume(),ze=this.stack[this.stack.length-1];ze.title=ye}function we(){this.data.inReference=void 0}function B(){this.data.referenceType="collapsed"}function F(ye){const ze=this.resume(),Ze=this.stack[this.stack.length-1];Ze.label=ze,Ze.identifier=cu(this.sliceSerialize(ye)).toLowerCase(),this.data.referenceType="full"}function ne(ye){this.data.characterReferenceType=ye.type}function We(ye){const ze=this.sliceSerialize(ye),Ze=this.data.characterReferenceType;let gt;Ze?(gt=X5(ze,Ze==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):gt=Xv(ze);const vt=this.stack[this.stack.length-1];vt.value+=gt}function ft(ye){const ze=this.stack.pop();ze.position.end=na(ye.end)}function le(ye){_.call(this,ye);const ze=this.stack[this.stack.length-1];ze.url=this.sliceSerialize(ye)}function De(ye){_.call(this,ye);const ze=this.stack[this.stack.length-1];ze.url="mailto:"+this.sliceSerialize(ye)}function ie(){return{type:"blockquote",children:[]}}function Fe(){return{type:"code",lang:null,meta:null,value:""}}function _e(){return{type:"inlineCode",value:""}}function tt(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Xe(){return{type:"emphasis",children:[]}}function Ve(){return{type:"heading",depth:0,children:[]}}function it(){return{type:"break"}}function Ue(){return{type:"html",value:""}}function K(){return{type:"image",title:null,url:"",alt:null}}function ue(){return{type:"link",title:null,url:"",children:[]}}function re(ye){return{type:"list",ordered:ye.type==="listOrdered",start:null,spread:ye._spread,children:[]}}function oe(ye){return{type:"listItem",spread:ye._spread,checked:null,children:[]}}function pe(){return{type:"paragraph",children:[]}}function se(){return{type:"strong",children:[]}}function Se(){return{type:"text",value:""}}function Pe(){return{type:"thematicBreak"}}}function na(t){return{line:t.line,column:t.column,offset:t.offset}}function lR(t,e){let n=-1;for(;++n<e.length;){const r=e[n];Array.isArray(r)?lR(t,r):GQ(t,r)}}function GQ(t,e){let n;for(n in e)if(aR.call(e,n))switch(n){case"canContainEols":{const r=e[n];r&&t[n].push(...r);break}case"transforms":{const r=e[n];r&&t[n].push(...r);break}case"enter":case"exit":{const r=e[n];r&&Object.assign(t[n],r);break}}}function RC(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+Bd({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+Bd({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+Bd({start:e.start,end:e.end})+") is still open")}function qQ(t){const e=this;e.parser=n;function n(r){return WQ(r,{...e.data("settings"),...t,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function YQ(t,e){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(e),!0)};return t.patch(e,n),t.applyData(e,n)}function JQ(t,e){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(e,n),[t.applyData(e,n),{type:"text",value:`
`}]}function XQ(t,e){const n=e.value?e.value+`
`:"",r={},s=e.lang?e.lang.split(/\s+/):[];s.length>0&&(r.className=["language-"+s[0]]);let i={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]};return e.meta&&(i.data={meta:e.meta}),t.patch(e,i),i=t.applyData(e,i),i={type:"element",tagName:"pre",properties:{},children:[i]},t.patch(e,i),i}function QQ(t,e){const n={type:"element",tagName:"del",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function ZQ(t,e){const n={type:"element",tagName:"em",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function eZ(t,e){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",r=String(e.identifier).toUpperCase(),s=zu(r.toLowerCase()),i=t.footnoteOrder.indexOf(r);let o,a=t.footnoteCounts.get(r);a===void 0?(a=0,t.footnoteOrder.push(r),o=t.footnoteOrder.length):o=i+1,a+=1,t.footnoteCounts.set(r,a);const l={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+s,id:n+"fnref-"+s+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};t.patch(e,l);const u={type:"element",tagName:"sup",properties:{},children:[l]};return t.patch(e,u),t.applyData(e,u)}function tZ(t,e){const n={type:"element",tagName:"h"+e.depth,properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function nZ(t,e){if(t.options.allowDangerousHtml){const n={type:"raw",value:e.value};return t.patch(e,n),t.applyData(e,n)}}function cR(t,e){const n=e.referenceType;let r="]";if(n==="collapsed"?r+="[]":n==="full"&&(r+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+r}];const s=t.all(e),i=s[0];i&&i.type==="text"?i.value="["+i.value:s.unshift({type:"text",value:"["});const o=s[s.length-1];return o&&o.type==="text"?o.value+=r:s.push({type:"text",value:r}),s}function rZ(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return cR(t,e);const s={src:zu(r.url||""),alt:e.alt};r.title!==null&&r.title!==void 0&&(s.title=r.title);const i={type:"element",tagName:"img",properties:s,children:[]};return t.patch(e,i),t.applyData(e,i)}function sZ(t,e){const n={src:zu(e.url)};e.alt!==null&&e.alt!==void 0&&(n.alt=e.alt),e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"img",properties:n,children:[]};return t.patch(e,r),t.applyData(e,r)}function iZ(t,e){const n={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};t.patch(e,n);const r={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(e,r),t.applyData(e,r)}function oZ(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return cR(t,e);const s={href:zu(r.url||"")};r.title!==null&&r.title!==void 0&&(s.title=r.title);const i={type:"element",tagName:"a",properties:s,children:t.all(e)};return t.patch(e,i),t.applyData(e,i)}function aZ(t,e){const n={href:zu(e.url)};e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"a",properties:n,children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function lZ(t,e,n){const r=t.all(e),s=n?cZ(n):uR(e),i={},o=[];if(typeof e.checked=="boolean"){const d=r[0];let f;d&&d.type==="element"&&d.tagName==="p"?f=d:(f={type:"element",tagName:"p",properties:{},children:[]},r.unshift(f)),f.children.length>0&&f.children.unshift({type:"text",value:" "}),f.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),i.className=["task-list-item"]}let a=-1;for(;++a<r.length;){const d=r[a];(s||a!==0||d.type!=="element"||d.tagName!=="p")&&o.push({type:"text",value:`
`}),d.type==="element"&&d.tagName==="p"&&!s?o.push(...d.children):o.push(d)}const l=r[r.length-1];l&&(s||l.type!=="element"||l.tagName!=="p")&&o.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:i,children:o};return t.patch(e,u),t.applyData(e,u)}function cZ(t){let e=!1;if(t.type==="list"){e=t.spread||!1;const n=t.children;let r=-1;for(;!e&&++r<n.length;)e=uR(n[r])}return e}function uR(t){const e=t.spread;return e??t.children.length>1}function uZ(t,e){const n={},r=t.all(e);let s=-1;for(typeof e.start=="number"&&e.start!==1&&(n.start=e.start);++s<r.length;){const o=r[s];if(o.type==="element"&&o.tagName==="li"&&o.properties&&Array.isArray(o.properties.className)&&o.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const i={type:"element",tagName:e.ordered?"ol":"ul",properties:n,children:t.wrap(r,!0)};return t.patch(e,i),t.applyData(e,i)}function dZ(t,e){const n={type:"element",tagName:"p",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function fZ(t,e){const n={type:"root",children:t.wrap(t.all(e))};return t.patch(e,n),t.applyData(e,n)}function hZ(t,e){const n={type:"element",tagName:"strong",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function pZ(t,e){const n=t.all(e),r=n.shift(),s=[];if(r){const o={type:"element",tagName:"thead",properties:{},children:t.wrap([r],!0)};t.patch(e.children[0],o),s.push(o)}if(n.length>0){const o={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},a=Gv(e.children[1]),l=V5(e.children[e.children.length-1]);a&&l&&(o.position={start:a,end:l}),s.push(o)}const i={type:"element",tagName:"table",properties:{},children:t.wrap(s,!0)};return t.patch(e,i),t.applyData(e,i)}function mZ(t,e,n){const r=n?n.children:void 0,i=(r?r.indexOf(e):1)===0?"th":"td",o=n&&n.type==="table"?n.align:void 0,a=o?o.length:e.children.length;let l=-1;const u=[];for(;++l<a;){const f=e.children[l],h={},p=o?o[l]:void 0;p&&(h.align=p);let m={type:"element",tagName:i,properties:h,children:[]};f&&(m.children=t.all(f),t.patch(f,m),m=t.applyData(f,m)),u.push(m)}const d={type:"element",tagName:"tr",properties:{},children:t.wrap(u,!0)};return t.patch(e,d),t.applyData(e,d)}function gZ(t,e){const n={type:"element",tagName:"td",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}const OC=9,PC=32;function yZ(t){const e=String(t),n=/\r?\n|\r/g;let r=n.exec(e),s=0;const i=[];for(;r;)i.push(LC(e.slice(s,r.index),s>0,!0),r[0]),s=r.index+r[0].length,r=n.exec(e);return i.push(LC(e.slice(s),s>0,!1)),i.join("")}function LC(t,e,n){let r=0,s=t.length;if(e){let i=t.codePointAt(r);for(;i===OC||i===PC;)r++,i=t.codePointAt(r)}if(n){let i=t.codePointAt(s-1);for(;i===OC||i===PC;)s--,i=t.codePointAt(s-1)}return s>r?t.slice(r,s):""}function xZ(t,e){const n={type:"text",value:yZ(String(e.value))};return t.patch(e,n),t.applyData(e,n)}function bZ(t,e){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(e,n),t.applyData(e,n)}const wZ={blockquote:YQ,break:JQ,code:XQ,delete:QQ,emphasis:ZQ,footnoteReference:eZ,heading:tZ,html:nZ,imageReference:rZ,image:sZ,inlineCode:iZ,linkReference:oZ,link:aZ,listItem:lZ,list:uZ,paragraph:dZ,root:fZ,strong:hZ,table:pZ,tableCell:gZ,tableRow:mZ,text:xZ,thematicBreak:bZ,toml:Hh,yaml:Hh,definition:Hh,footnoteDefinition:Hh};function Hh(){}const dR=-1,e0=0,Hd=1,sg=2,ek=3,tk=4,nk=5,rk=6,fR=7,hR=8,$C=typeof self=="object"?self:globalThis,vZ=(t,e)=>{const n=(s,i)=>(t.set(i,s),s),r=s=>{if(t.has(s))return t.get(s);const[i,o]=e[s];switch(i){case e0:case dR:return n(o,s);case Hd:{const a=n([],s);for(const l of o)a.push(r(l));return a}case sg:{const a=n({},s);for(const[l,u]of o)a[r(l)]=r(u);return a}case ek:return n(new Date(o),s);case tk:{const{source:a,flags:l}=o;return n(new RegExp(a,l),s)}case nk:{const a=n(new Map,s);for(const[l,u]of o)a.set(r(l),r(u));return a}case rk:{const a=n(new Set,s);for(const l of o)a.add(r(l));return a}case fR:{const{name:a,message:l}=o;return n(new $C[a](l),s)}case hR:return n(BigInt(o),s);case"BigInt":return n(Object(BigInt(o)),s);case"ArrayBuffer":return n(new Uint8Array(o).buffer,o);case"DataView":{const{buffer:a}=new Uint8Array(o);return n(new DataView(a),o)}}return n(new $C[i](o),s)};return r},zC=t=>vZ(new Map,t)(0),bc="",{toString:kZ}={},{keys:SZ}=Object,td=t=>{const e=typeof t;if(e!=="object"||!t)return[e0,e];const n=kZ.call(t).slice(8,-1);switch(n){case"Array":return[Hd,bc];case"Object":return[sg,bc];case"Date":return[ek,bc];case"RegExp":return[tk,bc];case"Map":return[nk,bc];case"Set":return[rk,bc];case"DataView":return[Hd,n]}return n.includes("Array")?[Hd,n]:n.includes("Error")?[fR,n]:[sg,n]},Vh=([t,e])=>t===e0&&(e==="function"||e==="symbol"),_Z=(t,e,n,r)=>{const s=(o,a)=>{const l=r.push(o)-1;return n.set(a,l),l},i=o=>{if(n.has(o))return n.get(o);let[a,l]=td(o);switch(a){case e0:{let d=o;switch(l){case"bigint":a=hR,d=o.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+l);d=null;break;case"undefined":return s([dR],o)}return s([a,d],o)}case Hd:{if(l){let h=o;return l==="DataView"?h=new Uint8Array(o.buffer):l==="ArrayBuffer"&&(h=new Uint8Array(o)),s([l,[...h]],o)}const d=[],f=s([a,d],o);for(const h of o)d.push(i(h));return f}case sg:{if(l)switch(l){case"BigInt":return s([l,o.toString()],o);case"Boolean":case"Number":case"String":return s([l,o.valueOf()],o)}if(e&&"toJSON"in o)return i(o.toJSON());const d=[],f=s([a,d],o);for(const h of SZ(o))(t||!Vh(td(o[h])))&&d.push([i(h),i(o[h])]);return f}case ek:return s([a,o.toISOString()],o);case tk:{const{source:d,flags:f}=o;return s([a,{source:d,flags:f}],o)}case nk:{const d=[],f=s([a,d],o);for(const[h,p]of o)(t||!(Vh(td(h))||Vh(td(p))))&&d.push([i(h),i(p)]);return f}case rk:{const d=[],f=s([a,d],o);for(const h of o)(t||!Vh(td(h)))&&d.push(i(h));return f}}const{message:u}=o;return s([a,{name:l,message:u}],o)};return i},FC=(t,{json:e,lossy:n}={})=>{const r=[];return _Z(!(e||n),!!e,new Map,r)(t),r},ig=typeof structuredClone=="function"?(t,e)=>e&&("json"in e||"lossy"in e)?zC(FC(t,e)):structuredClone(t):(t,e)=>zC(FC(t,e));function TZ(t,e){const n=[{type:"text",value:""}];return e>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),n}function CZ(t,e){return"Back to reference "+(t+1)+(e>1?"-"+e:"")}function EZ(t){const e=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||TZ,r=t.options.footnoteBackLabel||CZ,s=t.options.footnoteLabel||"Footnotes",i=t.options.footnoteLabelTagName||"h2",o=t.options.footnoteLabelProperties||{className:["sr-only"]},a=[];let l=-1;for(;++l<t.footnoteOrder.length;){const u=t.footnoteById.get(t.footnoteOrder[l]);if(!u)continue;const d=t.all(u),f=String(u.identifier).toUpperCase(),h=zu(f.toLowerCase());let p=0;const m=[],y=t.footnoteCounts.get(f);for(;y!==void 0&&++p<=y;){m.length>0&&m.push({type:"text",value:" "});let v=typeof n=="string"?n:n(l,p);typeof v=="string"&&(v={type:"text",value:v}),m.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+h+(p>1?"-"+p:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(l,p),className:["data-footnote-backref"]},children:Array.isArray(v)?v:[v]})}const x=d[d.length-1];if(x&&x.type==="element"&&x.tagName==="p"){const v=x.children[x.children.length-1];v&&v.type==="text"?v.value+=" ":x.children.push({type:"text",value:" "}),x.children.push(...m)}else d.push(...m);const g={type:"element",tagName:"li",properties:{id:e+"fn-"+h},children:t.wrap(d,!0)};t.patch(u,g),a.push(g)}if(a.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:i,properties:{...ig(o),id:"footnote-label"},children:[{type:"text",value:s}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(a,!0)},{type:"text",value:`
`}]}}const pR=function(t){if(t==null)return DZ;if(typeof t=="function")return t0(t);if(typeof t=="object")return Array.isArray(t)?NZ(t):jZ(t);if(typeof t=="string")return IZ(t);throw new Error("Expected function, string, or object as test")};function NZ(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=pR(t[n]);return t0(r);function r(...s){let i=-1;for(;++i<e.length;)if(e[i].apply(this,s))return!0;return!1}}function jZ(t){const e=t;return t0(n);function n(r){const s=r;let i;for(i in t)if(s[i]!==e[i])return!1;return!0}}function IZ(t){return t0(e);function e(n){return n&&n.type===t}}function t0(t){return e;function e(n,r,s){return!!(MZ(n)&&t.call(this,n,typeof r=="number"?r:void 0,s||void 0))}}function DZ(){return!0}function MZ(t){return t!==null&&typeof t=="object"&&"type"in t}const mR=[],AZ=!0,BC=!1,RZ="skip";function OZ(t,e,n,r){let s;typeof e=="function"&&typeof n!="function"?(r=n,n=e):s=e;const i=pR(s),o=r?-1:1;a(t,void 0,[])();function a(l,u,d){const f=l&&typeof l=="object"?l:{};if(typeof f.type=="string"){const p=typeof f.tagName=="string"?f.tagName:typeof f.name=="string"?f.name:void 0;Object.defineProperty(h,"name",{value:"node ("+(l.type+(p?"<"+p+">":""))+")"})}return h;function h(){let p=mR,m,y,x;if((!e||i(l,u,d[d.length-1]||void 0))&&(p=PZ(n(l,d)),p[0]===BC))return p;if("children"in l&&l.children){const g=l;if(g.children&&p[0]!==RZ)for(y=(r?g.children.length:-1)+o,x=d.concat(g);y>-1&&y<g.children.length;){const v=g.children[y];if(m=a(v,y,x)(),m[0]===BC)return m;y=typeof m[1]=="number"?m[1]:y+o}}return p}}}function PZ(t){return Array.isArray(t)?t:typeof t=="number"?[AZ,t]:t==null?mR:[t]}function gR(t,e,n,r){let s,i,o;typeof e=="function"&&typeof n!="function"?(i=void 0,o=e,s=n):(i=e,o=n,s=r),OZ(t,i,a,s);function a(l,u){const d=u[u.length-1],f=d?d.children.indexOf(l):void 0;return o(l,f,d)}}const fb={}.hasOwnProperty,LZ={};function $Z(t,e){const n=e||LZ,r=new Map,s=new Map,i=new Map,o={...wZ,...n.handlers},a={all:u,applyData:FZ,definitionById:r,footnoteById:s,footnoteCounts:i,footnoteOrder:[],handlers:o,one:l,options:n,patch:zZ,wrap:UZ};return gR(t,function(d){if(d.type==="definition"||d.type==="footnoteDefinition"){const f=d.type==="definition"?r:s,h=String(d.identifier).toUpperCase();f.has(h)||f.set(h,d)}}),a;function l(d,f){const h=d.type,p=a.handlers[h];if(fb.call(a.handlers,h)&&p)return p(a,d,f);if(a.options.passThrough&&a.options.passThrough.includes(h)){if("children"in d){const{children:y,...x}=d,g=ig(x);return g.children=a.all(d),g}return ig(d)}return(a.options.unknownHandler||BZ)(a,d,f)}function u(d){const f=[];if("children"in d){const h=d.children;let p=-1;for(;++p<h.length;){const m=a.one(h[p],d);if(m){if(p&&h[p-1].type==="break"&&(!Array.isArray(m)&&m.type==="text"&&(m.value=UC(m.value)),!Array.isArray(m)&&m.type==="element")){const y=m.children[0];y&&y.type==="text"&&(y.value=UC(y.value))}Array.isArray(m)?f.push(...m):f.push(m)}}}return f}}function zZ(t,e){t.position&&(e.position=kJ(t))}function FZ(t,e){let n=e;if(t&&t.data){const r=t.data.hName,s=t.data.hChildren,i=t.data.hProperties;if(typeof r=="string")if(n.type==="element")n.tagName=r;else{const o="children"in n?n.children:[n];n={type:"element",tagName:r,properties:{},children:o}}n.type==="element"&&i&&Object.assign(n.properties,ig(i)),"children"in n&&n.children&&s!==null&&s!==void 0&&(n.children=s)}return n}function BZ(t,e){const n=e.data||{},r="value"in e&&!(fb.call(n,"hProperties")||fb.call(n,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function UZ(t,e){const n=[];let r=-1;for(e&&n.push({type:"text",value:`
`});++r<t.length;)r&&n.push({type:"text",value:`
`}),n.push(t[r]);return e&&t.length>0&&n.push({type:"text",value:`
`}),n}function UC(t){let e=0,n=t.charCodeAt(e);for(;n===9||n===32;)e++,n=t.charCodeAt(e);return t.slice(e)}function HC(t,e){const n=$Z(t,e),r=n.one(t,void 0),s=EZ(n),i=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return s&&i.children.push({type:"text",value:`
`},s),i}function HZ(t,e){return t&&"run"in t?async function(n,r){const s=HC(n,{file:r,...e});await t.run(s,r)}:function(n,r){return HC(n,{file:r,...t||e})}}function VC(t){if(t)throw t}var Np=Object.prototype.hasOwnProperty,yR=Object.prototype.toString,WC=Object.defineProperty,KC=Object.getOwnPropertyDescriptor,GC=function(e){return typeof Array.isArray=="function"?Array.isArray(e):yR.call(e)==="[object Array]"},qC=function(e){if(!e||yR.call(e)!=="[object Object]")return!1;var n=Np.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&Np.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!r)return!1;var s;for(s in e);return typeof s>"u"||Np.call(e,s)},YC=function(e,n){WC&&n.name==="__proto__"?WC(e,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):e[n.name]=n.newValue},JC=function(e,n){if(n==="__proto__")if(Np.call(e,n)){if(KC)return KC(e,n).value}else return;return e[n]},VZ=function t(){var e,n,r,s,i,o,a=arguments[0],l=1,u=arguments.length,d=!1;for(typeof a=="boolean"&&(d=a,a=arguments[1]||{},l=2),(a==null||typeof a!="object"&&typeof a!="function")&&(a={});l<u;++l)if(e=arguments[l],e!=null)for(n in e)r=JC(a,n),s=JC(e,n),a!==s&&(d&&s&&(qC(s)||(i=GC(s)))?(i?(i=!1,o=r&&GC(r)?r:[]):o=r&&qC(r)?r:{},YC(a,{name:n,newValue:t(d,o,s)})):typeof s<"u"&&YC(a,{name:n,newValue:s}));return a};const Ry=lg(VZ);function hb(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function WZ(){const t=[],e={run:n,use:r};return e;function n(...s){let i=-1;const o=s.pop();if(typeof o!="function")throw new TypeError("Expected function as last argument, not "+o);a(null,...s);function a(l,...u){const d=t[++i];let f=-1;if(l){o(l);return}for(;++f<s.length;)(u[f]===null||u[f]===void 0)&&(u[f]=s[f]);s=u,d?KZ(d,a)(...u):o(null,...u)}}function r(s){if(typeof s!="function")throw new TypeError("Expected `middelware` to be a function, not "+s);return t.push(s),e}}function KZ(t,e){let n;return r;function r(...o){const a=t.length>o.length;let l;a&&o.push(s);try{l=t.apply(this,o)}catch(u){const d=u;if(a&&n)throw d;return s(d)}a||(l&&l.then&&typeof l.then=="function"?l.then(i,s):l instanceof Error?s(l):i(l))}function s(o,...a){n||(n=!0,e(o,...a))}function i(o){s(null,o)}}const ro={basename:GZ,dirname:qZ,extname:YZ,join:JZ,sep:"/"};function GZ(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');rh(t);let n=0,r=-1,s=t.length,i;if(e===void 0||e.length===0||e.length>t.length){for(;s--;)if(t.codePointAt(s)===47){if(i){n=s+1;break}}else r<0&&(i=!0,r=s+1);return r<0?"":t.slice(n,r)}if(e===t)return"";let o=-1,a=e.length-1;for(;s--;)if(t.codePointAt(s)===47){if(i){n=s+1;break}}else o<0&&(i=!0,o=s+1),a>-1&&(t.codePointAt(s)===e.codePointAt(a--)?a<0&&(r=s):(a=-1,r=o));return n===r?r=o:r<0&&(r=t.length),t.slice(n,r)}function qZ(t){if(rh(t),t.length===0)return".";let e=-1,n=t.length,r;for(;--n;)if(t.codePointAt(n)===47){if(r){e=n;break}}else r||(r=!0);return e<0?t.codePointAt(0)===47?"/":".":e===1&&t.codePointAt(0)===47?"//":t.slice(0,e)}function YZ(t){rh(t);let e=t.length,n=-1,r=0,s=-1,i=0,o;for(;e--;){const a=t.codePointAt(e);if(a===47){if(o){r=e+1;break}continue}n<0&&(o=!0,n=e+1),a===46?s<0?s=e:i!==1&&(i=1):s>-1&&(i=-1)}return s<0||n<0||i===0||i===1&&s===n-1&&s===r+1?"":t.slice(s,n)}function JZ(...t){let e=-1,n;for(;++e<t.length;)rh(t[e]),t[e]&&(n=n===void 0?t[e]:n+"/"+t[e]);return n===void 0?".":XZ(n)}function XZ(t){rh(t);const e=t.codePointAt(0)===47;let n=QZ(t,!e);return n.length===0&&!e&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),e?"/"+n:n}function QZ(t,e){let n="",r=0,s=-1,i=0,o=-1,a,l;for(;++o<=t.length;){if(o<t.length)a=t.codePointAt(o);else{if(a===47)break;a=47}if(a===47){if(!(s===o-1||i===1))if(s!==o-1&&i===2){if(n.length<2||r!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(l=n.lastIndexOf("/"),l!==n.length-1){l<0?(n="",r=0):(n=n.slice(0,l),r=n.length-1-n.lastIndexOf("/")),s=o,i=0;continue}}else if(n.length>0){n="",r=0,s=o,i=0;continue}}e&&(n=n.length>0?n+"/..":"..",r=2)}else n.length>0?n+="/"+t.slice(s+1,o):n=t.slice(s+1,o),r=o-s-1;s=o,i=0}else a===46&&i>-1?i++:i=-1}return n}function rh(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const ZZ={cwd:eee};function eee(){return"/"}function pb(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function tee(t){if(typeof t=="string")t=new URL(t);else if(!pb(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(t.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return nee(t)}function nee(t){if(t.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=t.pathname;let n=-1;for(;++n<e.length;)if(e.codePointAt(n)===37&&e.codePointAt(n+1)===50){const r=e.codePointAt(n+2);if(r===70||r===102){const s=new TypeError("File URL path must not include encoded / characters");throw s.code="ERR_INVALID_FILE_URL_PATH",s}}return decodeURIComponent(e)}const Oy=["history","path","basename","stem","extname","dirname"];class xR{constructor(e){let n;e?pb(e)?n={path:e}:typeof e=="string"||ree(e)?n={value:e}:n=e:n={},this.cwd="cwd"in n?"":ZZ.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<Oy.length;){const i=Oy[r];i in n&&n[i]!==void 0&&n[i]!==null&&(this[i]=i==="history"?[...n[i]]:n[i])}let s;for(s in n)Oy.includes(s)||(this[s]=n[s])}get basename(){return typeof this.path=="string"?ro.basename(this.path):void 0}set basename(e){Ly(e,"basename"),Py(e,"basename"),this.path=ro.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?ro.dirname(this.path):void 0}set dirname(e){XC(this.basename,"dirname"),this.path=ro.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?ro.extname(this.path):void 0}set extname(e){if(Py(e,"extname"),XC(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=ro.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){pb(e)&&(e=tee(e)),Ly(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?ro.basename(this.path,this.extname):void 0}set stem(e){Ly(e,"stem"),Py(e,"stem"),this.path=ro.join(this.dirname||"",e+(this.extname||""))}fail(e,n,r){const s=this.message(e,n,r);throw s.fatal=!0,s}info(e,n,r){const s=this.message(e,n,r);return s.fatal=void 0,s}message(e,n,r){const s=new gs(e,n,r);return this.path&&(s.name=this.path+":"+s.name,s.file=this.path),s.fatal=!1,this.messages.push(s),s}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function Py(t,e){if(t&&t.includes(ro.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+ro.sep+"`")}function Ly(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function XC(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}function ree(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const see=function(t){const r=this.constructor.prototype,s=r[t],i=function(){return s.apply(i,arguments)};return Object.setPrototypeOf(i,r),i},iee={}.hasOwnProperty;class sk extends see{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=WZ()}copy(){const e=new sk;let n=-1;for(;++n<this.attachers.length;){const r=this.attachers[n];e.use(...r)}return e.data(Ry(!0,{},this.namespace)),e}data(e,n){return typeof e=="string"?arguments.length===2?(Fy("data",this.frozen),this.namespace[e]=n,this):iee.call(this.namespace,e)&&this.namespace[e]||void 0:e?(Fy("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const s=n.call(e,...r);typeof s=="function"&&this.transformers.use(s)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=Wh(e),r=this.parser||this.Parser;return $y("parse",r),r(String(n),n)}process(e,n){const r=this;return this.freeze(),$y("process",this.parser||this.Parser),zy("process",this.compiler||this.Compiler),n?s(void 0,n):new Promise(s);function s(i,o){const a=Wh(e),l=r.parse(a);r.run(l,a,function(d,f,h){if(d||!f||!h)return u(d);const p=f,m=r.stringify(p,h);lee(m)?h.value=m:h.result=m,u(d,h)});function u(d,f){d||!f?o(d):i?i(f):n(void 0,f)}}}processSync(e){let n=!1,r;return this.freeze(),$y("processSync",this.parser||this.Parser),zy("processSync",this.compiler||this.Compiler),this.process(e,s),ZC("processSync","process",n),r;function s(i,o){n=!0,VC(i),r=o}}run(e,n,r){QC(e),this.freeze();const s=this.transformers;return!r&&typeof n=="function"&&(r=n,n=void 0),r?i(void 0,r):new Promise(i);function i(o,a){const l=Wh(n);s.run(e,l,u);function u(d,f,h){const p=f||e;d?a(d):o?o(p):r(void 0,p,h)}}}runSync(e,n){let r=!1,s;return this.run(e,n,i),ZC("runSync","run",r),s;function i(o,a){VC(o),s=a,r=!0}}stringify(e,n){this.freeze();const r=Wh(n),s=this.compiler||this.Compiler;return zy("stringify",s),QC(e),s(e,r)}use(e,...n){const r=this.attachers,s=this.namespace;if(Fy("use",this.frozen),e!=null)if(typeof e=="function")l(e,n);else if(typeof e=="object")Array.isArray(e)?a(e):o(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function i(u){if(typeof u=="function")l(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[d,...f]=u;l(d,f)}else o(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function o(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(u.plugins),u.settings&&(s.settings=Ry(!0,s.settings,u.settings))}function a(u){let d=-1;if(u!=null)if(Array.isArray(u))for(;++d<u.length;){const f=u[d];i(f)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function l(u,d){let f=-1,h=-1;for(;++f<r.length;)if(r[f][0]===u){h=f;break}if(h===-1)r.push([u,...d]);else if(d.length>0){let[p,...m]=d;const y=r[h][1];hb(y)&&hb(p)&&(p=Ry(!0,y,p)),r[h]=[u,p,...m]}}}}const oee=new sk().freeze();function $y(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function zy(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function Fy(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function QC(t){if(!hb(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function ZC(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function Wh(t){return aee(t)?t:new xR(t)}function aee(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function lee(t){return typeof t=="string"||cee(t)}function cee(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const uee="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",eE=[],tE={allowDangerousHtml:!0},dee=/^(https?|ircs?|mailto|xmpp)$/i,fee=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function ik(t){const e=hee(t),n=pee(t);return mee(e.runSync(e.parse(n),n),t)}function hee(t){const e=t.rehypePlugins||eE,n=t.remarkPlugins||eE,r=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...tE}:tE;return oee().use(qQ).use(n).use(HZ,r).use(e)}function pee(t){const e=t.children||"",n=new xR;return typeof e=="string"&&(n.value=e),n}function mee(t,e){const n=e.allowedElements,r=e.allowElement,s=e.components,i=e.disallowedElements,o=e.skipHtml,a=e.unwrapDisallowed,l=e.urlTransform||gee;for(const d of fee)Object.hasOwn(e,d.from)&&(""+d.from+(d.to?"use `"+d.to+"` instead":"remove it")+uee+d.id,void 0);return gR(t,u),EJ(t,{Fragment:c.Fragment,components:s,ignoreInvalidStyle:!0,jsx:c.jsx,jsxs:c.jsxs,passKeys:!0,passNode:!0});function u(d,f,h){if(d.type==="raw"&&h&&typeof f=="number")return o?h.children.splice(f,1):h.children[f]={type:"text",value:d.value},f;if(d.type==="element"){let p;for(p in Dy)if(Object.hasOwn(Dy,p)&&Object.hasOwn(d.properties,p)){const m=d.properties[p],y=Dy[p];(y===null||y.includes(d.tagName))&&(d.properties[p]=l(String(m||""),p,d))}}if(d.type==="element"){let p=n?!n.includes(d.tagName):i?i.includes(d.tagName):!1;if(!p&&r&&typeof f=="number"&&(p=!r(d,f,h)),p&&h&&typeof f=="number")return a&&d.children?h.children.splice(f,1,...d.children):h.children.splice(f,1),f}}}function gee(t){const e=t.indexOf(":"),n=t.indexOf("?"),r=t.indexOf("#"),s=t.indexOf("/");return e===-1||s!==-1&&e>s||n!==-1&&e>n||r!==-1&&e>r||dee.test(t.slice(0,e))?t:""}const yee=[{label:"",value:null},{label:"",value:0},{label:"5 ",value:5},{label:"15 ",value:15},{label:"30 ",value:30},{label:"1 ",value:60},{label:"2 ",value:120},{label:"1 ",value:1440}],xee=({value:t,onChange:e})=>{const[n,r]=b.useState(!1),[s,i]=b.useState(""),[o,a]=b.useState("minutes"),l=()=>t==null?"":t===0?"":t<60?`${t} `:t<1440?`${t/60} `:`${t/1440} `,u=()=>{const f=parseInt(s);if(isNaN(f)||f<=0)return;let h=f;o==="hours"&&(h=f*60),o==="days"&&(h=f*1440),e(h),r(!1),i("")},d=t!=null;return c.jsxs("div",{className:"relative",children:[c.jsxs("button",{type:"button",onClick:()=>r(!n),className:`flex items-center gap-1.5 px-2 py-1 rounded-lg text-xs transition-colors ${d?"bg-orange-100 text-orange-600 hover:bg-orange-200":"bg-gray-100 text-gray-500 hover:bg-gray-200"}`,title:"",children:[d?c.jsx(Ba,{size:12}):c.jsx(Zx,{size:12}),c.jsx("span",{children:l()}),c.jsx(es,{size:10})]}),n&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>r(!1)}),c.jsxs("div",{className:"absolute left-0 top-full mt-1 w-48 bg-white rounded-lg shadow-xl border border-gray-200 z-50 overflow-hidden",children:[yee.map(f=>c.jsxs("button",{type:"button",onClick:()=>{e(f.value),r(!1)},className:`w-full px-3 py-2 text-left text-sm hover:bg-orange-50 transition-colors flex items-center gap-2 ${t===f.value?"bg-orange-100 text-orange-700 font-medium":"text-gray-700"}`,children:[f.value===null?c.jsx(Zx,{size:12}):c.jsx(Ba,{size:12}),f.label]},f.value??"null")),c.jsxs("div",{className:"border-t border-gray-100 p-2",children:[c.jsx("div",{className:"text-[10px] text-gray-400 mb-1.5",children:""}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("input",{type:"number",value:s,onChange:f=>i(f.target.value),placeholder:"",className:"flex-1 px-2 py-1 text-xs border rounded w-14",min:1}),c.jsxs("select",{value:o,onChange:f=>a(f.target.value),className:"px-1 py-1 text-xs border rounded",children:[c.jsx("option",{value:"minutes",children:""}),c.jsx("option",{value:"hours",children:""}),c.jsx("option",{value:"days",children:""})]}),c.jsx("button",{type:"button",onClick:u,className:"px-2 py-1 text-xs bg-orange-500 text-white rounded hover:bg-orange-600",children:""})]})]}),d&&c.jsxs("button",{type:"button",onClick:()=>{e(null),r(!1)},className:"w-full px-3 py-2 text-left text-xs text-red-500 hover:bg-red-50 border-t border-gray-100 flex items-center gap-2",children:[c.jsx(rn,{size:12}),""]})]})]})]})},nE=t=>{if(!t)return"";let e=t;e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/^### (.*$)/gm,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gm,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gm,"<h1>$1</h1>");const n=e.split(`
`);let r=!1,s=[];for(let i=0;i<n.length;i++){const o=n[i];if(/^[*-] /.test(o)||/^\d+\. /.test(o)){r||(s.push("<ul>"),r=!0);const l=o.replace(/^[*-] |^\d+\. /,"");s.push(`<li>${l}</li>`)}else r&&(s.push("</ul>"),r=!1),o.trim()===""||(o.startsWith("<h")?s.push(o):s.push(`<p>${o}</p>`))}return r&&s.push("</ul>"),s.join("")},rE=t=>{if(!t)return"";if(!t.includes("<")||!t.includes(">"))return t;let e=t;return e=e.replace(/<\/p>/gi,`
`),e=e.replace(/<br\s*\/?>/gi,`
`),e=e.replace(/<\/div>/gi,`
`),e=e.replace(/<[^>]+>/g,""),e=e.replace(/&nbsp;/g," "),e=e.replace(/&amp;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e.trim()},bee="",Ro=({initialData:t,onClose:e,isQuickAdd:n=!1,isEmbedded:r=!1})=>{var uk,dk,fk;const{addTask:s,updateTask:i,tags:o,tasks:a,addTag:l,deleteTag:u,setFocusedTaskId:d,themeSettings:f,toggleExpansion:h,setSelectedTaskIds:p,deleteTask:m,visibleTasks:y,user:x,setToast:g,t:v,navigateToTask:w}=b.useContext(Tn),[T,D]=b.useState((t==null?void 0:t.title)||""),[k,I]=b.useState((t==null?void 0:t.description)||""),[C,S]=b.useState((t==null?void 0:t.due_date)||null),[_,N]=b.useState((t==null?void 0:t.start_date)||null),[j,O]=b.useState((t==null?void 0:t.tags)||[]),[P,W]=b.useState((t==null?void 0:t.images)||[]),[R,M]=b.useState((t==null?void 0:t.attachments)||[]),[X,Q]=b.useState(!1),[A,Te]=b.useState((t==null?void 0:t.parent_id)||null),[we,B]=b.useState([]),[F,ne]=b.useState((t==null?void 0:t.is_project)||!1),[We,ft]=b.useState((t==null?void 0:t.color)||"gray"),[le,De]=b.useState((t==null?void 0:t.importance)||"unplanned"),[ie,Fe]=b.useState((t==null?void 0:t.is_all_day)!==void 0?t.is_all_day:!0),[_e,tt]=b.useState(()=>{if(t!=null&&t.start_time)return t.start_time;if(t!=null&&t.start_date&&!(t!=null&&t.is_all_day)){const E=new Date(t.start_date);return`${String(E.getHours()).padStart(2,"0")}:${String(E.getMinutes()).padStart(2,"0")}`}return"09:00"}),[Xe,Ve]=b.useState(()=>{if(t!=null&&t.end_time)return t.end_time;if(t!=null&&t.start_date&&!(t!=null&&t.is_all_day)){const E=new Date(t.start_date),H=typeof t.duration=="number"?t.duration:60;return E.setMinutes(E.getMinutes()+H),`${String(E.getHours()).padStart(2,"0")}:${String(E.getMinutes()).padStart(2,"0")}`}return"10:00"}),[it,Ue]=b.useState((t==null?void 0:t.duration)||""),[K,ue]=b.useState((t==null?void 0:t.repeat_rule)||null),[re,oe]=b.useState(!1),[pe,se]=b.useState(()=>{if(t!=null&&t.id)try{const E=localStorage.getItem(`task_reminder_${t.id}`);if(E!==null)return JSON.parse(E)}catch{}return(t==null?void 0:t.reminder_minutes)??null});b.useEffect(()=>{if(t!=null&&t.id)try{pe!==null?localStorage.setItem(`task_reminder_${t.id}`,JSON.stringify(pe)):localStorage.removeItem(`task_reminder_${t.id}`)}catch{}},[pe,t==null?void 0:t.id]);const[Se,Pe]=b.useState(!1),[ye,ze]=b.useState(!1),[Ze,gt]=b.useState(!1),[vt,me]=b.useState(null),He=b.useRef(null),qe=b.useRef(null),nt=b.useRef(null),Me=b.useRef(null),[ut,ee]=b.useState(null),fe=b.useRef(null),q=b.useRef(null),[Z,ge]=b.useState(null),[xe,be]=b.useState(null),[ve,ot]=b.useState(null),[et,G]=b.useState(null),[ae,Ae]=b.useState(null),[Y,Ie]=b.useState(new Set),[Le,ct]=b.useState(!1),[Rt,Cn]=b.useState(!1),[Ot,nn]=b.useState(""),[cn,Ee]=b.useState(!1),[Tt,Ft]=b.useState(!1),[Lt,Wt]=b.useState(""),[un,rr]=b.useState(""),[ys,wn]=b.useState(0),[yn,Er]=b.useState(0),[Pn,Jn]=b.useState(!1),[Nn,Or]=b.useState({isOpen:!1,title:"",content:"",history:[],historyIndex:-1}),[Ni,tl]=b.useState(!1),[Qo,mn]=b.useState(!1),[ko,Zo]=b.useState([]),{isRecording:si,startRecording:nl,stopRecording:rl,recordingTaskId:So,recordingTime:xs}=b.useContext(Du),_o=E=>{const H=Math.floor(E/1e3),de=Math.floor(H/60),Ce=H%60;return`${de}:${Ce.toString().padStart(2,"0")}`},sl=async(E,H,de)=>{if(console.log("TaskInput handleSaveAudio called with:",E.name,H,de),!je)return;const Ce=`${Date.now()}_${crypto.randomUUID()}.${E.name.split(".").pop()}`,ht=`${(x==null?void 0:x.id)||"anonymous"}/${Ce}`;try{const{error:Mt}=await je.storage.from("attachments").upload(ht,E,{contentType:E.type,upsert:!1});if(Mt){console.error("Upload voice error:",Mt),g==null||g({msg:"",type:"error"});return}const{data:Kt}=je.storage.from("attachments").getPublicUrl(ht);if(Kt){const qt={name:E.name,url:Kt.publicUrl,size:E.size,type:E.type,markers:H,recordingId:de},en=[...R,qt];M(en),t&&i(t.id,{attachments:en},[],{skipHistory:!0}),g==null||g({msg:"",type:"info"})}}catch(Mt){console.error(Mt),g==null||g({msg:"",type:"error"})}};b.useEffect(()=>{const E=H=>{const de=H.detail;de&&de.taskId===(t==null?void 0:t.id)&&de.attachment&&(console.log("[TaskInput] Recording saved event - updating local attachments state"),M(Ce=>Ce.some(ht=>ht.url===de.attachment.url)?Ce:[...Ce,de.attachment]))};return window.addEventListener("recording-saved",E),()=>window.removeEventListener("recording-saved",E)},[t==null?void 0:t.id]);const[Xn,Pr]=b.useState((t==null?void 0:t.ai_history)||[]),[Un,ji]=b.useState(t!=null&&t.ai_history?t.ai_history.length-1:-1),[oc,ii]=b.useState(""),[Nr,ce]=b.useState(!1),[St,At]=b.useState(!1),[Pt,jt]=b.useState(!1),[Zt,kn]=b.useState(0),[sr,An]=b.useState((t==null?void 0:t.attachment_links)||[]),[xn,hn]=b.useState(!1),Hn=b.useMemo(()=>{const E=o.find(H=>H.name.trim().toLowerCase()==="prompt");return E?a.filter(H=>H.tags.includes(E.id)&&H.status!=="deleted"&&H.status!=="logged").sort((H,de)=>de.created_at.localeCompare(H.created_at)):[]},[a,o]),ir=b.useMemo(()=>{if(!un.trim())return Hn;const E=un.toLowerCase();return Hn.filter(H=>H.title.toLowerCase().includes(E)||H.description&&H.description.toLowerCase().includes(E))},[Hn,un]),Ii=b.useMemo(()=>Hn.slice(0,5),[Hn]);b.useEffect(()=>{if(!un.trim()){Er(0),wn(0);return}let E=0;ir.forEach(H=>{const de=(H.title.match(new RegExp(un,"gi"))||[]).length,Ce=H.description?(H.description.match(new RegExp(un,"gi"))||[]).length:0;E+=de+Ce}),Er(E),wn(0)},[un,ir]);const oi=E=>{Or(H=>{const de={title:H.title,content:E},Ce=[...H.history.slice(0,H.historyIndex+1),de];return{...H,content:E,history:Ce,historyIndex:Ce.length-1}})},jn=E=>{Or(H=>{const de={title:E,content:H.content},Ce=[...H.history.slice(0,H.historyIndex+1),de];return{...H,title:E,history:Ce,historyIndex:Ce.length-1}})},Ln=()=>{Or(E=>{if(E.historyIndex<=0)return E;const H=E.historyIndex-1;return{...E,title:E.history[H].title,content:E.history[H].content,historyIndex:H}})},gr=()=>{Or(E=>{if(E.historyIndex>=E.history.length-1)return E;const H=E.historyIndex+1;return{...E,title:E.history[H].title,content:E.history[H].content,historyIndex:H}})},$=t?!!t.completed_at:!1,z=b.useRef(null),L=b.useRef(null),V=b.useRef(null),U=b.useRef(null),J=b.useRef(null),he=b.useRef(null),Oe=b.useRef(null),Ke=b.useRef(null),[Qe,at]=b.useState([]),[xt,lt]=b.useState(!1),[mt,Ye]=b.useState(-1);b.useEffect(()=>{const E=setTimeout(()=>{if(t&&!n){const H={};let de=!1;if(T!==(t.title||"")&&(H.title=T,de=!0),k!==(t.description||"")&&(H.description=k,de=!0),_e&&_e!==(t.start_time||"")&&(H.start_time=_e,de=!0),Xe&&Xe!==(t.end_time||"")&&(H.end_time=Xe,de=!0),it&&String(it)!==String(t.duration||60)&&(H.duration=Number(it),de=!0),ie!==(t.is_all_day??!0)&&(H.is_all_day=ie,de=!0),_&&_!==t.start_date&&(H.start_date=_,de=!0),de){if((H.start_time||H.start_date)&&!ie){const Ce=H.start_date||_||t.start_date,pt=H.start_time||_e||t.start_time||"00:00";if(Ce){const ht=new Date(Ce),[Mt,Kt]=pt.split(":").map(Number);!isNaN(Mt)&&!isNaN(Kt)&&(ht.setHours(Mt,Kt,0,0),H.start_date=ht.toISOString())}}i(t.id,H,[],{skipHistory:!0})}}},800);return()=>clearTimeout(E)},[T,k,_e,Xe,it,_,ie,t,i,n]),b.useEffect(()=>{const E=H=>{(H.metaKey||H.ctrlKey)&&H.shiftKey&&(H.key==="v"||H.key==="V")&&(H.preventDefault(),H.stopPropagation(),si?rl():nl(t==null?void 0:t.id))};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[si,nl,rl,t==null?void 0:t.id]),b.useEffect(()=>{L.current},[k]),b.useEffect(()=>{if(!ve||!fe.current)return;const E=()=>{const de=fe.current;de&&ve&&(de.chain().setTextSelection({from:ve.from,to:ve.to}).unsetHighlight().setTextSelection(de.state.selection.to).run(),ot(null))},H=setTimeout(()=>{document.addEventListener("click",E,{once:!0})},100);return()=>{clearTimeout(H),document.removeEventListener("click",E)}},[ve]);const Ne=b.useRef(t);b.useEffect(()=>{const E=Ne.current;if(!t||!E){Ne.current=t;return}t.id!==E.id?(D(t.title||""),I(t.description||""),N(t.start_date||""),tt(t.start_time||""),Ve(t.end_time||""),Ue(t.duration||60),Fe(t.is_all_day??!0),O(t.tags||[]),W(t.images||[]),Te(t.parent_id||null),ne(t.is_project||!1),ft(t.color||"gray"),De(t.importance||"unplanned")):(t.title!==E.title&&D(t.title||""),t.description!==E.description&&I(t.description||""),t.start_date!==E.start_date&&N(t.start_date||""),t.start_time!==E.start_time&&tt(t.start_time||""),t.end_time!==E.end_time&&Ve(t.end_time||""),t.duration!==E.duration&&Ue(t.duration||60),t.is_all_day!==E.is_all_day&&Fe(t.is_all_day??!0),JSON.stringify(t.tags)!==JSON.stringify(E.tags)&&O(t.tags||[])),Ne.current=t},[t]);const Be=async E=>{let H;if(Z&&fe.current?H=fe.current.state.doc.textBetween(Z.from,Z.to," "):fe.current?H=fe.current.getText():H=k.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),!H||!H.trim()){g==null||g({msg:"Please enter or select some content first.",type:"error"});return}ct(!0),Ft(!1),At(!0);try{if(Pn&&Lt.trim()){let Mt=o.find(qt=>qt.name.trim().toLowerCase()==="prompt"),Kt=Mt==null?void 0:Mt.id;if(Kt||(Kt=await l("prompt")||void 0),Kt){const qt=await P5(Lt);await s({title:qt,description:Lt,tags:[Kt],status:"active"})}}const Ce=await O5(H,Z?"":T,E),pt={id:crypto.randomUUID(),role:"assistant",content:Ce.fullResponse,created_at:new Date().toISOString(),prompt:E||"AI Analysis",model:"gemini"},ht=[...Xn,pt];Pr(ht),ji(ht.length-1),ii(Ce.fullResponse),ce(!1),Wt(""),t&&i(t.id,{ai_history:ht},[],{skipHistory:!0})}catch(de){console.error(de);let Ce=de.message||"";(Ce.includes("429")||Ce.includes("quota"))&&(Ce="AI  1-2  API Key"),alert(`AI ${Ce}`),At(!1)}finally{ct(!1)}},ke=()=>{if(document.activeElement instanceof HTMLElement&&(q.current=document.activeElement),!k||!k.trim()){g==null||g({msg:"Please enter some content first.",type:"error"});return}if(St){At(!1);return}if(Xn.length>0){At(!0);return}Wt(""),Ft(!0)},Re=()=>{Ft(!1),ge(null)},[Ge,kt]=b.useState(!1),dt=b.useMemo(()=>{const E=o.find(H=>H.name.trim().toLowerCase().includes("for"));return E?a.filter(H=>H.tags.includes(E.id)&&H.status!=="deleted"&&H.status!=="logged").sort((H,de)=>de.created_at.localeCompare(H.created_at)):[]},[a,o]),bt=async E=>{document.activeElement instanceof HTMLElement&&(q.current=document.activeElement);let H;if(fe.current?H=fe.current.getText():H=k.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),console.log("Note content for title generation:",H.substring(0,200)+"..."),console.log("Content length:",H.length),!H||!H.trim()){g==null||g({msg:"",type:"error"});return}Cn(!0),kt(!1);try{const de=await CY(H,E);console.log("Generated SEO title:",de),nn(de),Ee(!0)}catch(de){console.error("Generate title error:",de),g==null||g({msg:"",type:"error"})}finally{Cn(!1)}},Je=async()=>{let E;if(fe.current?E=fe.current.getText():E=k.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),!E||!E.trim()){g==null||g({msg:"",type:"error"});return}dt.length>0?kt(!0):(console.log("No custom title prompts found. Using default."),bt())},te=()=>{D(Ot),Ee(!1),nn(""),g==null||g({msg:" SEO ",type:"info"})},$e=()=>{Ee(!1),nn("")},rt=b.useMemo(()=>{var E;return(E=t==null?void 0:t.dependencies)!=null&&E.length?a.filter(H=>{var de;return((de=t.dependencies)==null?void 0:de.includes(H.id))&&!H.completed_at}):[]},[t==null?void 0:t.dependencies,a]),st=b.useMemo(()=>o.filter(E=>E.name.startsWith("#")).map(E=>E.name.slice(1)),[o]),yt=async()=>{let E="";if(fe.current&&typeof fe.current.getText=="function"&&(E=fe.current.getText()),(!E||!E.trim())&&(E=k.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim()),!E||!E.trim()){g==null||g({msg:"",type:"error"});return}console.log("Generating keywords for current task content:",E.slice(0,100)+(E.length>100?"...":"")),tl(!0);try{const H=await EY(E,st);Zo(H),mn(!0),console.log("Generated keywords:",H)}catch(H){console.error("Generate keywords error:",H),g==null||g({msg:"",type:"error"})}finally{tl(!1)}},It=async E=>{const H=`#${E}`;let de=o.find(Ce=>Ce.name.toLowerCase()===H.toLowerCase());try{if(de)j.includes(de.id)?g==null||g({msg:` ${H} `,type:"info"}):(O(Ce=>[...Ce,de.id]),g==null||g({msg:`: ${H}`,type:"info"}));else{let Ce=o.find(en=>en.name==="#"),pt;if(Ce)pt=Ce.id;else{const en=await l("#");if(!en)throw new Error("Failed to create root keyword tag");pt=en}const ht=(en,gn=0)=>{const $t=o.find(vn=>vn.id===en);return!$t||!$t.parent_id||$t.parent_id===pt?gn:ht($t.parent_id,gn+1)},Mt=o.filter(en=>{if(en.parent_id===pt)return!0;let gn=en;const $t=new Set;for(;gn.parent_id&&!$t.has(gn.id);){if($t.add(gn.id),gn.parent_id===pt)return!0;const vn=o.find(wr=>wr.id===gn.parent_id);if(!vn)break;gn=vn}return!1}).map(en=>({id:en.id,name:en.name.replace(/^#/,""),parentId:en.parent_id,depth:ht(en.id)}));let Kt=pt;if(Mt.length>0){g==null||g({msg:"...",type:"info"});const en=await jY(E,Mt);if(en){Kt=en;const gn=o.find($t=>$t.id===en);console.log(`AI suggested parent for "${E}": ${gn==null?void 0:gn.name}`)}}const qt=await l(H,Kt);if(qt){j.includes(qt)||O($t=>[...$t,qt]);const en=o.find($t=>$t.id===Kt),gn=(en==null?void 0:en.name)||"#";g==null||g({msg:`: ${H} ( ${gn})`,type:"info"})}else throw new Error("Failed to create tag")}Zo(Ce=>Ce.filter(pt=>pt!==E))}catch(Ce){console.error("Error adding keyword tag:",Ce),g==null||g({msg:"",type:"error"})}},Dt=async()=>{const E=[...ko];let H=0,de=o.find(pt=>pt.name==="#"),Ce=null;if(de)Ce=de.id;else{const pt=await l("#");pt&&(Ce=pt)}for(const pt of E){const ht=`#${pt}`;let Mt=o.find(Kt=>Kt.name.toLowerCase()===ht.toLowerCase());try{if(Mt)j.includes(Mt.id)||(O(Kt=>[...Kt,Mt.id]),H++);else{const Kt=await l(ht,Ce);Kt&&!j.includes(Kt)&&(O(qt=>[...qt,Kt]),H++)}}catch(Kt){console.error("Error adding keyword tag:",pt,Kt)}}Zo([]),mn(!1),H>0?g==null||g({msg:` ${H}  #`,type:"info"}):g==null||g({msg:"",type:"info"})},Bt=E=>{Zo(H=>H.filter(de=>de!==E))},Xt=E=>{if(!E)return We;let H=a.find(Ce=>Ce.id===E);const de=new Set;for(;H&&H.parent_id&&!de.has(H.id);){de.add(H.id);const Ce=a.find(pt=>pt.id===H.parent_id);if(Ce)H=Ce;else break}return(H==null?void 0:H.color)||"blue"},on=b.useMemo(()=>Xt(A),[A,a,We]),an=Kn[on]||Kn.blue;o1(He,E=>{if(n||Tt||St&&xe||cn||Ge||Qo||E&&si&&So===(t==null?void 0:t.id)&&E.target.closest("[data-recording-capsule]"))return;const H=E==null?void 0:E.target;if(!(H&&H.closest('[data-app-header="true"]')))if(t&&e)if(T.trim())Qn();else{const de=y.findIndex(pt=>pt.data.id===t.id),Ce=y[de-1];m(t.id),e(Ce?Ce.data.id:null)}else e&&(T.trim()||k.replace(/<[^>]*>/g,"").trim()?Qn():e(null))});const Rn=b.useMemo(()=>{if(!(t!=null&&t.id))return a.filter(de=>de.status!=="deleted");const E=new Set,H=[t.id];for(;H.length>0;){const de=H.shift();for(const Ce of a)Ce.parent_id===de&&!E.has(Ce.id)&&(E.add(Ce.id),H.push(Ce.id))}return a.filter(de=>de.id!==t.id&&!E.has(de.id)&&de.status!=="deleted")},[a,t]),yr=b.useMemo(()=>{const E=(H=null,de=0,Ce=null)=>{const pt=o.filter(Mt=>Mt.parent_id===H);let ht=[];return pt.forEach(Mt=>{ht.push({...Mt,depth:de,parentName:Ce}),ht=[...ht,...E(Mt.id,de+1,Mt.name)]}),ht};return E()},[o]);b.useEffect(()=>{if(t!=null&&t.id){const E=a.filter(H=>H.parent_id===t.id).map(H=>H.id);B(E)}},[t,a]),b.useEffect(()=>{const E=!t||!t.title;if(T.length>=2&&E){const H=a.filter(de=>de.title.toLowerCase().includes(T.toLowerCase())&&de.id!==(t==null?void 0:t.id));at(H.slice(0,5)),lt(H.length>0),Ye(-1)}else lt(!1)},[T,a,t]),b.useEffect(()=>{!t&&z.current&&z.current.focus()},[t]);const Qn=async()=>{let E=T.trim();const H=k.replace(/<[^>]*>/g,"").trim();if(!E&&H&&(E=H.split(`
`)[0].substring(0,30)||"Untitled Note"),!E)return;let de=_;if(_&&!ie&&_e){const pt=new Date(_),[ht,Mt]=_e.split(":").map(Number);pt.setHours(ht,Mt,0,0),de=pt.toISOString()}else if(_&&ie){const pt=new Date(_);pt.setHours(12,0,0,0),de=pt.toISOString()}const Ce={title:E,description:k,due_date:C,start_date:de,parent_id:A,is_project:F||we.length>0,tags:j,status:(t==null?void 0:t.status)||"inbox",color:on,importance:le,images:P,is_all_day:ie,duration:it?Number(it):null,attachments:R,attachment_links:sr,ai_history:Xn,repeat_rule:K,reminder_minutes:pe};if(e?e((t==null?void 0:t.id)||null):ac(),t&&t.id&&t.id!=="new")await i(t.id,Ce,we);else{const pt=await s(Ce,we);d(pt),p([pt])}},ac=()=>{D(""),I(""),S(null),N(null),O([]),W([]),M([]),Te(null),B([]),ne(!1),Fe(!0),tt("09:00"),Ve("10:00"),Ue(""),ue(null),se(null)},Xi=async E=>{if(!(E.length===0||!je)){gt(!0);try{const H=[],de=[];for(const Mt of E){if(Mt.size>104857600){g==null||g({msg:`: ${Mt.name} ( 100MB)`,type:"error"});continue}const Kt=Mt.type.startsWith("image/");let qt=Mt;if(Kt&&Mt.size>2*1024*1024)try{qt=await ls(Mt,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0})}catch(bs){console.warn("Compression failed, using original file:",bs)}const en=Mt.name.split(".").pop()||(Kt?"jpg":"bin"),gn=`${Date.now()}_${crypto.randomUUID()}.${en}`,vn=`${(x==null?void 0:x.id)||"anonymous"}/${gn}`,{error:wr}=await je.storage.from("attachments").upload(vn,qt,{contentType:Mt.type,upsert:!1});if(wr){console.error("Upload error:",wr);continue}const{data:Es}=je.storage.from("attachments").getPublicUrl(vn);if(Es){const bs={name:Mt.name,url:Es.publicUrl,size:Mt.size,type:Mt.type};de.push(bs),Kt&&H.push(Es.publicUrl)}}const pt=[...P,...H],ht=[...R,...de];W(pt),M(ht),t&&(H.length>0||de.length>0)&&i(t.id,{images:pt,attachments:ht},[],{skipHistory:!0})}catch(H){console.error("Error uploading files:",H)}finally{gt(!1),qe.current&&(qe.current.value="")}}},Fu=async E=>{const H=E.target;if(H.tagName==="INPUT"||H.tagName==="TEXTAREA"||H.isContentEditable){if(E.clipboardData.files.length>0){E.preventDefault();const de=Array.from(E.clipboardData.files);await Xi(de);return}return}if(E.clipboardData.files.length>0){E.preventDefault();const de=Array.from(E.clipboardData.files);await Xi(de)}},lc=async E=>{let H=[];"files"in E.target&&E.target.files?H=Array.from(E.target.files):"dataTransfer"in E&&E.dataTransfer.files&&(H=Array.from(E.dataTransfer.files)),await Xi(H)},il=async E=>{const H=P.filter(Ce=>Ce!==E),de=R.filter(Ce=>Ce.url!==E);if(W(H),M(de),t&&i(t.id,{images:H,attachments:de},[],{skipHistory:!0}),je)try{const pt=new URL(E).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(pt){const ht=pt[1];await je.storage.from("attachments").remove([ht])}}catch(Ce){console.warn("Failed to delete image from storage:",Ce)}},LR=async E=>{const H=E.target.files;if(!(!H||H.length===0||!je)){gt(!0);try{const de=[],Ce=[];for(const Mt of Array.from(H)){const Kt=Mt.name.split(".").pop()||"bin",qt=`${Date.now()}_${crypto.randomUUID()}.${Kt}`,en=`${x.id}/${qt}`,{error:gn}=await je.storage.from("attachments").upload(en,Mt,{contentType:Mt.type,upsert:!1});if(gn){console.error("Upload error:",gn),g==null||g({msg:`: ${Mt.name}`,type:"error"});continue}const{data:$t}=je.storage.from("attachments").getPublicUrl(en);if($t){const vn=Mt.type.startsWith("image/"),wr={name:Mt.name,url:$t.publicUrl,size:Mt.size,type:Mt.type};de.push(wr),vn&&Ce.push($t.publicUrl)}}const pt=[...R,...de],ht=[...P,...Ce];M(pt),W(ht),t&&(de.length>0||Ce.length>0)&&i(t.id,{attachments:pt,images:ht},[],{skipHistory:!0}),de.length>0&&ee(de[de.length-1].url),g==null||g({msg:` ${de.length} `,type:"info"})}catch(de){console.error("Error uploading attachments:",de),g==null||g({msg:"",type:"error"})}finally{gt(!1),nt.current&&(nt.current.value="")}}},ai=b.useRef(null),$R=async E=>{const H=R.find(Mt=>Mt.url===E);if(!H)return;ai.current&&(clearTimeout(ai.current.timeoutId),r0(ai.current.url));const de=R.filter(Mt=>Mt.url!==E),Ce=P.filter(Mt=>Mt!==E);M(de),W(Ce),t&&i(t.id,{attachments:de,images:Ce},[],{skipHistory:!0});const pt=setTimeout(()=>{r0(E),sh.current.push({type:"delete",attachment:H}),ih.current=[],ai.current=null},1e4);ai.current={url:E,attachment:H,timeoutId:pt};const ht=H.name||"";g==null||g({msg:`: ${ht.length>20?ht.slice(0,20)+"...":ht}`,type:"info",undo:()=>{var Mt,Kt;if(ai.current&&ai.current.url===E){if(clearTimeout(ai.current.timeoutId),ai.current=null,M(qt=>[...qt,H]),(Mt=H.type)!=null&&Mt.startsWith("image/")&&W(qt=>[...qt,H.url]),t){const qt=[...de,H],en=(Kt=H.type)!=null&&Kt.startsWith("image/")?[...Ce,H.url]:Ce;i(t.id,{attachments:qt,images:en},[],{skipHistory:!0})}g==null||g({msg:"",type:"info"})}}})},r0=async E=>{if(je)try{const de=new URL(E).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(de){const Ce=de[1];await je.storage.from("attachments").remove([Ce]),console.log("[TaskInput] Attachment deleted from storage:",Ce)}}catch(H){console.warn("Failed to delete attachment from storage:",H)}},sh=b.useRef([]),ih=b.useRef([]),zR=()=>{var E,H;if(ai.current){const{attachment:de,timeoutId:Ce}=ai.current;if(clearTimeout(Ce),ai.current=null,M(pt=>pt.some(Mt=>Mt.url===de.url)?pt:[...pt,de]),(E=de.type)!=null&&E.startsWith("image/")&&W(pt=>pt.includes(de.url)?pt:[...pt,de.url]),t){const ht=[...R,de];i(t.id,{attachments:ht},[],{skipHistory:!0})}return g==null||g({msg:"",type:"info"}),!0}if(sh.current.length>0){const de=sh.current.pop();return ih.current.push(de),de.type==="delete"&&(M(Ce=>[...Ce,de.attachment]),(H=de.attachment.type)!=null&&H.startsWith("image/")&&W(Ce=>[...Ce,de.attachment.url]),t&&i(t.id,{attachments:[...R,de.attachment]},[],{skipHistory:!0}),g==null||g({msg:"",type:"info"})),!0}return!1},FR=()=>{if(ih.current.length>0){const E=ih.current.pop();return sh.current.push(E),E.type==="delete"&&(M(H=>H.filter(de=>de.url!==E.attachment.url)),W(H=>H.filter(de=>de!==E.attachment.url)),t&&i(t.id,{attachments:R.filter(H=>H.url!==E.attachment.url),images:P.filter(H=>H!==E.attachment.url)},[],{skipHistory:!0}),r0(E.attachment.url),g==null||g({msg:"",type:"info"})),!0}return!1};b.useEffect(()=>{const E=H=>{var de;(de=He.current)!=null&&de.contains(document.activeElement)&&((H.ctrlKey||H.metaKey)&&H.key==="z"&&!H.shiftKey&&zR()&&(H.preventDefault(),H.stopPropagation()),(H.ctrlKey||H.metaKey)&&H.key==="z"&&H.shiftKey&&FR()&&(H.preventDefault(),H.stopPropagation()))};return window.addEventListener("keydown",E,!0),()=>window.removeEventListener("keydown",E,!0)},[R,P,t]);const BR=E=>E<1024?E+" B":E<1024*1024?(E/1024).toFixed(1)+" KB":(E/(1024*1024)).toFixed(1)+" MB",Bu=E=>{var pt,ht,Mt,Kt,qt,en,gn,$t,vn,wr,Es,bs,Di,hk,pk,mk,gk,yk,xk,bk,wk;E.preventDefault();const H=document.activeElement,de=E.shiftKey,Ce=(pt=He.current)==null?void 0:pt.querySelector(".ProseMirror");de?H===z.current?(Es=Ke.current)==null||Es.focus():H!=null&&H.classList.contains("ProseMirror")?(bs=z.current)==null||bs.focus():Ke.current&&(H===Ke.current||(Di=Ke.current.parentElement)!=null&&Di.contains(H))?ie&&U.current?U.current.focus():!ie&&Oe.current?setTimeout(()=>{var Wr,Ns;(Wr=Oe.current)==null||Wr.focus(),(Ns=Oe.current)==null||Ns.select()},0):(hk=V.current)==null||hk.focus():H===U.current?(pk=V.current)==null||pk.focus():H===Oe.current?he.current?setTimeout(()=>{var Wr,Ns;(Wr=he.current)==null||Wr.focus(),(Ns=he.current)==null||Ns.select()},0):(mk=V.current)==null||mk.focus():H===he.current?J.current?setTimeout(()=>{var Wr,Ns;(Wr=J.current)==null||Wr.focus(),(Ns=J.current)==null||Ns.select()},0):(gk=V.current)==null||gk.focus():H===J.current?(yk=V.current)==null||yk.focus():V.current&&(H===V.current||(xk=V.current.parentElement)!=null&&xk.contains(H))?Ce?Ce.focus():(bk=z.current)==null||bk.focus():(wk=Ke.current)==null||wk.focus():H===z.current?Ce&&Ce.focus():H!=null&&H.classList.contains("ProseMirror")?(ht=V.current)==null||ht.focus():H===V.current||V.current&&((Mt=V.current.parentElement)!=null&&Mt.contains(H))?ie&&U.current?U.current.focus():!ie&&J.current?(J.current.focus(),J.current.select()):(Kt=Ke.current)==null||Kt.focus():H===U.current?(qt=Ke.current)==null||qt.focus():H===J.current?he.current?setTimeout(()=>{var Wr,Ns;(Wr=he.current)==null||Wr.focus(),(Ns=he.current)==null||Ns.select()},0):(en=Ke.current)==null||en.focus():H===he.current?Oe.current?setTimeout(()=>{var Wr,Ns;(Wr=Oe.current)==null||Wr.focus(),(Ns=Oe.current)==null||Ns.select()},0):(gn=Ke.current)==null||gn.focus():H===Oe.current?setTimeout(()=>{var Wr;(Wr=Ke.current)==null||Wr.focus()},0):Ke.current&&(H===Ke.current||($t=Ke.current.parentElement)!=null&&$t.contains(H))?(vn=z.current)==null||vn.focus():(wr=z.current)==null||wr.focus()},ok=()=>{t&&i(t.id,{completed_at:$?null:new Date().toISOString(),reminder_minutes:pe})},ak=E=>{var pt,ht,Mt,Kt,qt,en,gn;if((E.ctrlKey||E.metaKey)&&E.key==="z"){E.stopPropagation();return}if(E.shiftKey){if(E.key==="S"||E.key==="s"){E.preventDefault(),(pt=V.current)==null||pt.focus();return}if(E.key==="T"||E.key==="t"){E.preventDefault(),(ht=Ke.current)==null||ht.focus();return}}if(E.ctrlKey&&E.key==="."){E.preventDefault(),E.stopPropagation(),ok();return}if(Pt&&document.activeElement===z.current){if(E.key==="ArrowLeft"){E.preventDefault();const $t=Zt-1;kn($t);const vn=new Date;vn.setDate(vn.getDate()+$t);const wr=vn.toLocaleDateString("sv-SE"),bs=["","","","","","",""][vn.getDay()].replace("","");D(Di=>Di.replace(/\d{4}-\d{2}-\d{2}[]$/,`${wr}${bs}`));return}if(E.key==="ArrowRight"){E.preventDefault();const $t=Zt+1;kn($t);const vn=new Date;vn.setDate(vn.getDate()+$t);const wr=vn.toLocaleDateString("sv-SE"),bs=["","","","","","",""][vn.getDay()].replace("","");D(Di=>Di.replace(/\d{4}-\d{2}-\d{2}[]$/,`${wr}${bs}`));return}if(E.key==="Enter"){E.preventDefault(),jt(!1),kn(0);return}if(E.key==="Escape"){E.preventDefault(),jt(!1),kn(0),D($t=>$t.replace(/\d{4}-\d{2}-\d{2}[]$/,""));return}}const H=document.activeElement,de=(H==null?void 0:H.classList.contains("ProseMirror"))||(H==null?void 0:H.closest(".ProseMirror")),Ce=k&&k.trim()&&k!=="<p></p>";if(E.key==="Tab"&&!de){Bu(E);return}if(E.key==="Tab"&&de&&!Ce){Bu(E);return}if(xt){if(E.key==="ArrowDown"){E.preventDefault(),Ye($t=>$t===-1?0:($t+1)%Qe.length);return}if(E.key==="ArrowUp"){E.preventDefault(),Ye($t=>$t<=0?Qe.length-1:$t-1);return}if((E.ctrlKey||E.metaKey)&&E.key==="Enter"&&mt>=0&&(E.preventDefault(),D(Qe[mt].title),lt(!1)),E.key==="Escape"){E.preventDefault(),lt(!1);return}}if(!E.nativeEvent.isComposing){if((E.ctrlKey||E.metaKey)&&E.key==="Enter"&&!de){E.preventDefault(),E.stopPropagation(),Qn();return}if((E.ctrlKey||E.metaKey)&&E.key==="Enter"&&de){E.preventDefault(),E.stopPropagation(),(Mt=z.current)==null||Mt.focus();return}if(E.key==="Enter"&&!E.shiftKey){if(E.target.tagName==="TEXTAREA"||E.target.isContentEditable)return;E.preventDefault(),E.stopPropagation(),Qn()}if(E.key==="Escape"){if(St){E.preventDefault(),E.stopPropagation(),At(!1),(Kt=q.current)==null||Kt.focus();return}if(cn){E.preventDefault(),E.stopPropagation(),Ee(!1),(qt=q.current)==null||qt.focus();return}if(xt){E.preventDefault(),E.stopPropagation(),lt(!1);return}if(Tt){E.preventDefault(),E.stopPropagation(),Ft(!1),(en=q.current)==null||en.focus();return}if(Nn.isOpen){E.preventDefault(),E.stopPropagation(),Or($t=>({...$t,isOpen:!1}));return}if(Pt){E.preventDefault(),E.stopPropagation(),jt(!1);return}if(de){E.preventDefault(),E.stopPropagation(),(gn=z.current)==null||gn.focus();return}}if(E.key==="Escape"&&e)if(E.preventDefault(),t&&!T.trim()){const $t=y.findIndex(wr=>wr.data.id===t.id),vn=y[$t-1];m(t.id),e(vn?vn.data.id:null)}else Qn()}},lk=E=>{if(tt(E),E&&Xe){const[H,de]=E.split(":").map(Number),[Ce,pt]=Xe.split(":").map(Number);if(!isNaN(H)&&!isNaN(de)&&!isNaN(Ce)&&!isNaN(pt)){const ht=H*60+de,Mt=Ce*60+pt;if(ht<Mt)Ue((Mt-ht).toString());else{const Kt=Number(it)||60,qt=ht+Kt,en=Math.floor(qt/60)%24,gn=qt%60;Ve(`${String(en).padStart(2,"0")}:${String(gn).padStart(2,"0")}`)}}}},UR=E=>{if(Ve(E),E&&_e){const[H,de]=_e.split(":").map(Number),[Ce,pt]=E.split(":").map(Number);let ht=Ce*60+pt-(H*60+de);ht<0&&(ht+=1440),Ue(ht.toString())}},HR=E=>{if(Ue(E),E&&!isNaN(Number(E))&&_e){const H=Number(E),[de,Ce]=_e.split(":").map(Number),pt=new Date;pt.setHours(de,Ce+H),Ve(`${String(pt.getHours()).padStart(2,"0")}:${String(pt.getMinutes()).padStart(2,"0")}`)}},VR=f.fontWeight==="thin"?"font-extralight":"font-medium",WR=f.fontWeight==="thin"?"font-extralight":"font-normal",ck={small:"text-sm",normal:"text-base",large:"text-lg"}[f.fontSize]||"text-base",KR=t?`border-${on}-200`:"border-gray-100/50",GR=()=>{const E=xe?Math.max(10,Math.min(xe.top,window.innerHeight-500)):0,H=xe?Math.max(220,Math.min(xe.left,window.innerWidth-220)):0,de=c.jsxs(Rr.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:xe?"fixed bg-white rounded-xl shadow-2xl border border-gray-100 p-4 flex flex-col gap-4 overflow-hidden w-[400px]":"absolute top-[30px] right-0 w-[400px] bg-white rounded-xl shadow-2xl border border-gray-100 z-[100] p-4 flex flex-col gap-4 overflow-hidden",style:xe?{top:E,left:H,transform:"translateX(-50%)",zIndex:99999}:{},children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("h3",{className:"text-sm font-bold text-slate-800 flex items-center gap-2",children:[c.jsx(Is,{className:"text-indigo-500",size:16}),"AI "]}),c.jsx("button",{onClick:Re,className:"text-slate-400 hover:text-slate-600 transition-colors p-1 hover:bg-slate-100 rounded-full",children:c.jsx(rn,{size:16})})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("input",{type:"text",placeholder:"...",className:"w-full px-3 py-2 text-xs bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none transition-all",value:un,onChange:Ce=>rr(Ce.target.value)}),!un&&Ii.length>0&&c.jsxs("div",{children:[c.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2",children:""}),c.jsx("div",{className:"flex flex-wrap gap-1.5",children:Ii.map(Ce=>c.jsx("button",{type:"button",onClick:()=>{Wt(Ce.description||Ce.title),rr("")},className:"text-[10px] px-2 py-1 rounded-full bg-indigo-50 text-indigo-600 hover:bg-indigo-100 transition-all border border-indigo-100 font-medium",title:Ce.description||Ce.title,children:Ce.title},Ce.id))})]}),c.jsx("textarea",{className:"w-full h-32 p-3 text-sm bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none resize-none transition-all placeholder:text-slate-300",placeholder:"...",value:Lt,onChange:Ce=>Wt(Ce.target.value)}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"checkbox",id:"saveToLib",checked:Pn,onChange:Ce=>Jn(Ce.target.checked),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-slate-300"}),c.jsx("label",{htmlFor:"saveToLib",className:"text-xs text-slate-500 cursor-pointer select-none",children:""})]}),c.jsxs("div",{className:"flex gap-2 justify-end",children:[c.jsxs("button",{onClick:()=>Be(bee),className:"flex-1 py-2.5 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 rounded-xl text-[10px] font-bold transition-all border border-indigo-200 shadow-sm active:scale-95 flex flex-col items-center justify-center gap-0.5",title:"",children:[c.jsx(Is,{size:12}),c.jsx("span",{children:""})]}),c.jsxs("button",{onClick:()=>Be(),className:"flex-1 py-2.5 bg-slate-50 hover:bg-slate-100 text-slate-600 rounded-xl text-[10px] font-bold transition-all border border-slate-200 shadow-sm active:scale-95 flex flex-col items-center justify-center gap-0.5",children:[c.jsx(cd,{size:12}),c.jsx("span",{children:""})]}),c.jsx("button",{onClick:()=>Be(Lt),disabled:!Lt.trim(),className:"flex-[2] py-2 bg-slate-800 hover:bg-slate-900 text-white rounded-xl text-xs font-bold transition-all shadow-md shadow-slate-200 disabled:opacity-50 disabled:grayscale active:scale-95",children:""})]})]}),ir.length>0&&c.jsxs("div",{className:"border-t border-gray-50 pt-3 mt-1",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest",children:un?"":""}),un&&yn>0&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:"text-[10px] text-gray-500",children:[ys+1," / ",yn]}),c.jsxs("div",{className:"flex gap-0.5",children:[c.jsx("button",{onClick:()=>{wn(Ce=>Ce>0?Ce-1:yn-1)},className:"p-1 hover:bg-gray-100 rounded text-gray-400 hover:text-gray-600",title:" (Cmd+Shift+G)",children:c.jsx(pp,{size:12})}),c.jsx("button",{onClick:()=>{wn(Ce=>Ce<yn-1?Ce+1:0)},className:"p-1 hover:bg-gray-100 rounded text-gray-400 hover:text-gray-600",title:" (Cmd+G)",children:c.jsx(es,{size:12})})]})]})]}),c.jsx("div",{className:"flex flex-col gap-1.5 max-h-[160px] overflow-y-auto custom-scrollbar pr-1",onKeyDown:Ce=>{(Ce.metaKey||Ce.ctrlKey)&&Ce.key==="g"&&(Ce.preventDefault(),Ce.shiftKey?wn(pt=>pt>0?pt-1:yn-1):wn(pt=>pt<yn-1?pt+1:0))},children:ir.map((Ce,pt)=>{const ht=rE(Ce.description||""),Mt=(Kt,qt,en)=>{if(!qt.trim())return Kt;const gn=Kt.split(new RegExp(`(${qt})`,"gi"));let $t=0;for(let vn=0;vn<pt;vn++){const wr=ir[vn],Es=rE(wr.description||""),bs=(wr.title.match(new RegExp(qt,"gi"))||[]).length,Di=Es?(Es.match(new RegExp(qt,"gi"))||[]).length:0;$t+=bs+Di}if(!en){const vn=(Ce.title.match(new RegExp(qt,"gi"))||[]).length;$t+=vn}return gn.map((vn,wr)=>{if(vn.toLowerCase()===qt.toLowerCase()){const Es=$t===ys,bs=c.jsx("mark",{className:`${Es?"bg-orange-400 text-white ring-2 ring-orange-500":"bg-yellow-200 text-slate-900"} font-bold px-0.5 rounded`,ref:Es?Di=>{Di&&Di.scrollIntoView({behavior:"smooth",block:"center"})}:void 0,children:vn},wr);return $t++,bs}return vn})};return c.jsxs("button",{type:"button",onClick:()=>{Wt(ht||Ce.title),rr(""),wn(0)},className:"flex-shrink-0 text-left text-[11px] p-2 rounded-xl hover:bg-indigo-50 text-slate-600 hover:text-indigo-700 transition-all border border-slate-100 hover:border-indigo-100 shadow-sm bg-white active:scale-[0.98]",title:ht||Ce.title,children:[c.jsx("div",{className:"font-medium",children:Mt(Ce.title,un,!0)}),ht&&ht!==Ce.title&&c.jsx("div",{className:"text-[10px] text-gray-400 mt-0.5 whitespace-pre-wrap line-clamp-3",children:Mt(ht,un,!1)})]},Ce.id)})})]})]},"prompt-modal");return xe?tr.createPortal(c.jsx(go,{children:Tt&&de}),document.body):c.jsx(go,{children:Tt&&de})};return c.jsxs("div",{ref:He,className:`group transition-all w-full relative ${n||r?"bg-transparent":`mb-3 bg-white rounded-xl border ${KR} shadow-[0_4px_8px_rgba(0,0,0,0.08)]`} ${X?"ring-2 ring-indigo-400 border-indigo-400 bg-indigo-50/10":""}`,onKeyDown:ak,onPaste:Fu,onDragOver:E=>{E.preventDefault(),E.stopPropagation(),Q(!0)},onDragLeave:E=>{E.preventDefault(),E.stopPropagation(),Q(!1)},onDrop:E=>{E.preventDefault(),E.stopPropagation(),Q(!1),lc(E)},children:[X&&c.jsx("div",{className:"absolute inset-0 bg-indigo-500/10 backdrop-blur-[1px] z-[50] flex items-center justify-center rounded-xl pointer-events-none",children:c.jsxs("div",{className:"bg-white px-4 py-2 rounded-full shadow-lg border border-indigo-200 flex items-center gap-2",children:[c.jsx(om,{className:"text-indigo-500 animate-bounce",size:20}),c.jsx("span",{className:"text-sm font-bold text-indigo-600",children:""})]})}),t&&!r&&c.jsx("button",{onClick:E=>{E.stopPropagation(),window.open(`${window.location.origin}/share/${t.id}`,"_blank")},className:"absolute top-4 right-4 md:opacity-0 group-hover:opacity-100 transition-opacity p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg z-20",title:" (Share Task)",children:c.jsx(Oz,{size:16})}),c.jsxs("div",{className:`flex gap-4 ${t?"pl-5":"pl-6"} py-6`,children:[t?c.jsxs("div",{className:"mb-0.5",children:[" ",c.jsx(wM,{checked:$,onChange:E=>{E.stopPropagation(),ok()},size:20,color:on,isRoot:!A})," "]}):c.jsx("button",{type:"button",tabIndex:-1,onClick:()=>ne(!F),className:`mb-0.5 h-6 w-6 flex items-center justify-center transition-all ${F?an.accent:"text-gray-300 hover:text-gray-400"}`,children:F?c.jsx(jI,{size:18}):c.jsx(tz,{size:18})}),c.jsxs("div",{className:"flex-1 space-y-4 relative pr-6",children:[c.jsx("div",{className:"flex items-end justify-between",children:c.jsxs("div",{className:"flex-1 relative space-y-2",children:[A&&(()=>{const E=a.find(H=>H.id===A);return E?c.jsxs("button",{type:"button",onClick:H=>{H.stopPropagation(),t&&T.trim()&&Qn(),w(A,!0,"allview")},className:"flex items-center gap-1.5 text-xs text-theme-tertiary hover:text-indigo-600 transition-colors group/parent",children:[c.jsx(pp,{size:12,className:"opacity-50 group-hover/parent:opacity-100"}),c.jsx("span",{className:"truncate max-w-[200px] group-hover/parent:underline",children:E.title||""})]}):null})(),rt.length>0&&c.jsxs("div",{className:"flex items-center gap-2 text-xs text-amber-600 bg-amber-50 p-2 rounded-lg mb-2",children:[c.jsx(Kf,{size:14,className:"shrink-0"}),c.jsxs("span",{children:["",rt.map((E,H)=>c.jsxs("span",{children:[H>0&&", ",c.jsx("button",{type:"button",onClick:de=>{de.stopPropagation(),w(E.id,!0)},className:"hover:underline font-medium",children:E.title})]},E.id))]})]}),c.jsxs("div",{className:"flex items-center relative gap-2",children:[c.jsx("input",{ref:z,autoFocus:!0,type:"text",name:"data_task_input",autoComplete:"off",autoCorrect:"off",spellCheck:"false",value:T,onKeyDown:E=>{E.key==="Enter"&&console.log("[TaskInputDebug] Enter pressed",{isComposing:E.nativeEvent.isComposing,titleLen:T.length}),ak(E)},onFocus:()=>oe(T.length>0),onBlur:()=>setTimeout(()=>oe(!1),200),onChange:E=>{const H=E.target.value;if(oe(H.length>0),H.endsWith("@ ")&&!Pt){jt(!0),kn(0);const de=new Date,Ce=de.toLocaleDateString("sv-SE"),ht=["","","","","","",""][de.getDay()].replace("","");D(H.slice(0,-2)+`${Ce}${ht}`)}else Pt&&!H.match(/\d{4}-\d{2}-\d{2}[]$/)&&jt(!1),D(H)},placeholder:"...",className:`flex-1 ${ck} ${VR} transition-all duration-300 placeholder:font-light placeholder-gray-300 border-none bg-transparent focus:ring-0 outline-none p-0 leading-tight ${$?"opacity-30":Pt?"text-slate-400":"text-slate-800"}`}),re&&T.length>0&&(()=>{const E=a.filter(H=>H.id!==(t==null?void 0:t.id)&&H.title&&H.title.toLowerCase().includes(T.toLowerCase())&&H.title.toLowerCase()!==T.toLowerCase()).map(H=>H.title).filter((H,de,Ce)=>Ce.indexOf(H)===de).slice(0,5);return E.length===0?null:c.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 z-50 overflow-hidden animate-in slide-in-from-top-2 fade-in duration-200",children:E.map((H,de)=>c.jsxs("button",{type:"button",onMouseDown:Ce=>{Ce.preventDefault(),D(H),oe(!1)},className:"w-full text-left px-4 py-2.5 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700/50 border-b border-slate-100 dark:border-slate-700/50 last:border-b-0 transition-colors flex items-center gap-2 group",children:[c.jsx("span",{className:"text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity",children:""}),c.jsx("span",{className:"truncate",children:H})]},de))})})(),T.trim()&&c.jsx("button",{type:"button",onClick:E=>{E.preventDefault(),E.stopPropagation(),console.log("[TaskInput] Manual Button Submit"),Qn()},className:"p-1.5 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition-colors shadow-sm active:scale-95 flex-shrink-0 animate-in fade-in zoom-in duration-200",children:c.jsx(Y6,{size:18})})]}),Ge&&tr.createPortal(c.jsx("div",{className:"fixed inset-0 z-[9999999] flex items-center justify-center bg-black/20 backdrop-blur-sm",onClick:()=>kt(!1),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl border border-slate-200 p-4 w-[400px] max-w-[90vw] animate-in fade-in zoom-in-95 duration-200",onClick:E=>E.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between mb-3 border-b border-slate-100 pb-2",children:[c.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[c.jsx(Is,{size:16,className:"text-amber-500"}),c.jsx("h3",{className:"font-bold text-sm",children:" AI "})]}),c.jsx("button",{onClick:()=>kt(!1),className:"text-slate-400 hover:text-slate-600",children:c.jsx(rn,{size:16})})]}),c.jsxs("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:[c.jsxs("button",{onClick:()=>bt(),className:"w-full text-left p-3 rounded-lg border border-slate-100 hover:border-indigo-300 hover:bg-indigo-50 transition-all group",children:[c.jsx("div",{className:"font-medium text-sm text-slate-700 group-hover:text-indigo-700",children:" SEO "}),c.jsx("div",{className:"text-xs text-slate-500 mt-1",children:" SEO "})]}),dt.map(E=>c.jsxs("button",{onClick:()=>bt(E.description||""),className:"w-full text-left p-3 rounded-lg border border-slate-100 hover:border-amber-300 hover:bg-amber-50 transition-all group",children:[c.jsx("div",{className:"font-medium text-sm text-slate-700 group-hover:text-amber-700",children:E.title}),c.jsx("div",{className:"text-xs text-slate-500 mt-1 line-clamp-2",children:(E.description||"").replace(/<[^>]+>/g,"")})]},E.id))]})]})}),document.body),cn&&tr.createPortal(c.jsxs("div",{className:"fixed bg-theme-card rounded-xl shadow-2xl border border-theme p-4 animate-in fade-in zoom-in-95 duration-200",style:{top:z.current?z.current.getBoundingClientRect().bottom+8:100,left:z.current?z.current.getBoundingClientRect().left:100,width:z.current?z.current.getBoundingClientRect().width:300,zIndex:99999},children:[c.jsxs("div",{className:"flex items-center gap-2 text-indigo-400 mb-3",children:[c.jsx(i1,{size:14}),c.jsx("span",{className:"text-xs font-bold",children:"AI "})]}),c.jsx("input",{type:"text",autoFocus:!0,value:Ot,onChange:E=>nn(E.target.value),className:"w-full px-3 py-2 text-sm bg-theme-main border border-theme rounded-lg focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500/50 outline-none text-theme-primary",placeholder:"..."}),c.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[c.jsx("button",{type:"button",onClick:$e,className:"px-3 py-1.5 text-xs text-theme-tertiary hover:bg-theme-hover rounded-lg transition-colors",children:""}),c.jsx("button",{type:"button",onClick:te,className:"px-3 py-1.5 text-xs bg-indigo-600 text-white hover:bg-indigo-700 rounded-lg transition-colors font-medium",children:""})]})]}),document.body),Qo&&tr.createPortal(c.jsx("div",{className:"fixed inset-0 z-[9999999] flex items-center justify-center bg-black/20 backdrop-blur-sm",onClick:E=>{E.stopPropagation(),mn(!1)},onMouseDown:E=>E.stopPropagation(),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl border border-slate-200 p-5 w-[450px] max-w-[90vw] animate-in fade-in zoom-in-95 duration-200",onClick:E=>E.stopPropagation(),onMouseDown:E=>E.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between mb-4 border-b border-slate-100 pb-3",children:[c.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[c.jsx(Pl,{size:16,className:"text-emerald-500"}),c.jsx("h3",{className:"font-bold text-sm",children:"AI "})]}),c.jsx("button",{onClick:E=>{E.stopPropagation(),mn(!1)},onMouseDown:E=>E.stopPropagation(),className:"text-slate-400 hover:text-slate-600",children:c.jsx(rn,{size:16})})]}),ko.length>0&&c.jsxs("div",{className:"mb-4",children:[c.jsx("p",{className:"text-xs text-slate-500 mb-2",children:" SEO   "}),c.jsx("div",{className:"flex flex-wrap gap-2",children:ko.map((E,H)=>c.jsxs("div",{className:"group flex items-center gap-1 px-3 py-1.5 bg-emerald-50 text-emerald-700 rounded-full text-xs font-medium border border-emerald-200 hover:bg-emerald-100 transition-all",onClick:de=>de.stopPropagation(),onMouseDown:de=>de.stopPropagation(),children:[c.jsx("span",{className:"text-emerald-500",children:"#"}),c.jsx("span",{children:E}),c.jsx("button",{onClick:de=>{de.stopPropagation(),It(E)},onMouseDown:de=>de.stopPropagation(),className:"ml-1 text-emerald-600 hover:text-emerald-800 p-0.5 hover:bg-emerald-200 rounded",title:"",children:c.jsx(Gn,{size:12})}),c.jsx("button",{onClick:de=>{de.stopPropagation(),Bt(E)},onMouseDown:de=>de.stopPropagation(),className:"text-slate-400 hover:text-red-500 p-0.5 hover:bg-red-100 rounded",title:"",children:c.jsx(rn,{size:12})})]},H))})]}),Ni&&c.jsxs("div",{className:"flex items-center justify-center py-6 text-slate-500",children:[c.jsx(Vi,{size:20,className:"animate-spin mr-2"}),c.jsx("span",{className:"text-sm",children:"..."})]}),c.jsxs("div",{className:"flex gap-2 justify-end mt-4 pt-3 border-t border-slate-100",children:[c.jsx("button",{onClick:E=>{E.stopPropagation(),mn(!1)},onMouseDown:E=>E.stopPropagation(),className:"px-4 py-2 text-xs text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:""}),c.jsxs("button",{onClick:E=>{E.stopPropagation(),yt()},onMouseDown:E=>E.stopPropagation(),disabled:Ni,className:"px-4 py-2 text-xs bg-indigo-600 text-white hover:bg-indigo-700 rounded-lg transition-colors font-medium disabled:opacity-50 flex items-center gap-1",children:[Ni?c.jsx(Vi,{size:12,className:"animate-spin"}):c.jsx(Is,{size:12}),""]}),ko.length>0&&c.jsxs("button",{onClick:E=>{E.stopPropagation(),Dt()},onMouseDown:E=>E.stopPropagation(),className:"px-4 py-2 text-xs bg-emerald-600 text-white hover:bg-emerald-700 rounded-lg transition-colors font-medium flex items-center gap-1",children:[c.jsx(Gn,{size:12}),""]})]})]})}),document.body),xt&&c.jsx("div",{className:"w-full mt-1 mb-2",children:c.jsx("div",{className:"bg-theme-hover rounded-lg overflow-hidden border border-theme",children:Qe.map((E,H)=>c.jsxs("div",{className:`px-3 py-1.5 text-xs cursor-pointer transition-colors flex justify-between items-center ${H===mt?"bg-theme-selection text-theme-primary font-medium":"text-theme-secondary hover:bg-theme-hover"}`,onClick:()=>{D(E.title),lt(!1)},children:[c.jsx("span",{children:E.title}),H===mt&&c.jsx("span",{className:"text-[9px] text-indigo-400 font-normal",children:"Ctrl+Enter"})]},E.id))})}),c.jsxs("div",{className:"flex justify-end mb-1 gap-2",children:[c.jsxs("button",{type:"button",onClick:()=>{ke(),be(null)},disabled:Le,className:`flex items-center gap-1.5 text-xs transition-colors disabled:opacity-50 px-2 py-0.5 rounded-full ${St?"bg-indigo-500/20 text-indigo-400 font-bold shadow-sm ring-1 ring-indigo-500/30":"text-indigo-500 hover:text-indigo-400 hover:bg-indigo-500/10 font-medium"}`,title:"AI Assistant Brain",children:[Le?c.jsx(Vi,{size:12,className:"animate-spin"}):c.jsx(Is,{size:12}),c.jsx("span",{children:"AI "})]}),c.jsxs("button",{type:"button",onClick:Je,disabled:Rt,className:`flex items-center gap-1.5 text-xs transition-colors disabled:opacity-50 px-2 py-0.5 rounded-full ${Rt?"bg-amber-500/20 text-amber-400 font-bold shadow-sm ring-1 ring-amber-500/30":"text-amber-500 hover:text-amber-400 hover:bg-amber-500/10 font-medium"}`,title:" SEO ",children:[Rt?c.jsx(Vi,{size:12,className:"animate-spin"}):c.jsx(i1,{size:12}),c.jsx("span",{children:"AI "})]}),c.jsxs("button",{type:"button",onClick:()=>{mn(!0),yt()},disabled:Ni,className:`flex items-center gap-1.5 text-xs transition-colors disabled:opacity-50 px-2 py-0.5 rounded-full ${Ni?"bg-emerald-500/20 text-emerald-400 font-bold shadow-sm ring-1 ring-emerald-500/30":"text-emerald-500 hover:text-emerald-400 hover:bg-emerald-500/10 font-medium"}`,title:" SEO ",children:[Ni?c.jsx(Vi,{size:12,className:"animate-spin"}):c.jsx(Pl,{size:12}),c.jsx("span",{children:"AI "})]}),GR()]}),c.jsxs("div",{className:"flex flex-col md:flex-row gap-4 transition-all duration-300 items-stretch h-full",children:[c.jsxs("div",{className:"flex-1 transition-all duration-300 overflow-y-auto max-h-[55vh] flex flex-col no-scrollbar",children:[et&&c.jsx(C9,{url:et.url,fileName:et.name,autoPlay:!0,markers:(uk=et.markers)==null?void 0:uk.filter(E=>Y.has(E.id)),seekToTime:ae,onClose:()=>{G(null),Ae(null)},onMarkerClick:E=>{fe.current&&fe.current.scrollToParagraph&&fe.current.scrollToParagraph(E.id)}}),c.jsx(Bv,{onEditorReady:E=>{fe.current=E},onPolish:(E,H,de)=>{ge(H),de&&be(de),Ft(!0),Wt("")},initialContent:k,onChange:I,onExit:()=>{var E;return(E=V.current)==null?void 0:E.focus()},textSizeClass:ck,descFontClass:WR,className:"h-full",onSaveAudio:sl,onAudioMarkerClick:(E,H)=>{if(H){const Ce=R.find(pt=>pt.recordingId===H);if(Ce){G({url:Ce.url,name:Ce.name,markers:Ce.markers}),Ae(Math.max(0,E-4e3));return}}if(et){Ae(Math.max(0,E-4e3));return}const de=R.find(Ce=>{var pt,ht;return Ce.recordingId||((pt=Ce.type)==null?void 0:pt.startsWith("audio/"))||((ht=Ce.url)==null?void 0:ht.match(/\.(mp3|wav|webm|m4a|ogg)$/i))});de&&(G({url:de.url,name:de.name,markers:de.markers}),Ae(Math.max(0,E-4e3)))},activeMarkerIds:((dk=et==null?void 0:et.markers)==null?void 0:dk.filter(E=>Y.has(E.id)).map(E=>E.id))||null,onMarkersChange:E=>{Ie(new Set(E.map(H=>H.id)))},attachments:R,taskColor:on,availableTags:o.map(E=>({id:E.id,name:E.name,color:E.color,parent_id:E.parent_id,order_index:E.order_index})),onCreateTag:async E=>{if(!l)return null;try{const H=await l(E,null);if(H)return{id:H,name:E,color:"#6366f1"}}catch(H){console.error("Failed to create tag from editor",H),g==null||g({msg:"",type:"error"})}return null}})]}),St&&(()=>{var Ce,pt;const E=xe?Math.max(10,Math.min(xe.top,window.innerHeight-500)):0,H=xe?Math.min(xe.left+220,window.innerWidth-360):0,de=c.jsx("div",{className:xe?"fixed w-[340px] shrink-0 animate-in slide-in-from-right-4 fade-in duration-300 flex flex-col max-h-[80vh] overflow-hidden bg-white rounded-2xl shadow-2xl":"w-full md:w-[340px] shrink-0 animate-in slide-in-from-right-4 md:slide-in-from-bottom-4 fade-in duration-500 border-l border-indigo-50 pl-0 md:pl-4 flex flex-col h-full overflow-hidden",style:xe?{top:E,left:H,zIndex:99998}:{},children:Le?c.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400 gap-4 bg-slate-50/50 rounded-2xl border border-dashed border-slate-200",children:[c.jsxs("div",{className:"relative",children:[c.jsx(cd,{size:32,className:"text-indigo-400 animate-pulse"}),c.jsx(Is,{size:16,className:"absolute -top-1 -right-1 text-amber-400 animate-bounce"})]}),c.jsxs("div",{className:"flex flex-col items-center gap-1",children:[c.jsx("span",{className:"text-[11px] font-bold text-slate-500",children:"..."}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("div",{className:"w-1 h-1 bg-indigo-400 rounded-full animate-bounce [animation-delay:-0.3s]"}),c.jsx("div",{className:"w-1 h-1 bg-indigo-400 rounded-full animate-bounce [animation-delay:-0.15s]"}),c.jsx("div",{className:"w-1 h-1 bg-indigo-400 rounded-full animate-bounce"})]})]})]}):Xn.length>0?c.jsxs("div",{className:"flex flex-col gap-2 h-full",children:[c.jsxs("div",{className:"flex items-center justify-between px-2 pt-2",children:[c.jsxs("span",{className:"text-xs font-bold text-slate-400 ml-1",children:[" ",Un+1," / ",Xn.length]}),c.jsxs("div",{className:"flex items-center gap-1 bg-slate-100 rounded-lg p-0.5",children:[c.jsx("button",{onClick:()=>{const ht=Math.max(0,Un-1);ji(ht),ii(Xn[ht].content)},disabled:Un===0,className:"p-1 hover:bg-white rounded-md disabled:opacity-30 transition-all text-slate-600",title:"",children:c.jsx(Mu,{size:12})}),c.jsx("button",{onClick:()=>{const ht=Math.min(Xn.length-1,Un+1);ji(ht),ii(Xn[ht].content)},disabled:Un===Xn.length-1,className:"p-1 hover:bg-white rounded-md disabled:opacity-30 transition-all text-slate-600",title:"",children:c.jsx(ns,{size:12})}),c.jsx("div",{className:"w-px h-3 bg-slate-300 mx-0.5"}),c.jsx("button",{onClick:()=>{const ht=Xn.filter((Mt,Kt)=>Kt!==Un);if(Pr(ht),ht.length!==0){const Mt=Math.min(Un,ht.length-1);ji(Mt),ii(ht[Mt].content)}t&&i(t.id,{ai_history:ht},[],{skipHistory:!0})},className:"p-1 hover:bg-red-50 text-slate-400 hover:text-red-500 rounded-md transition-all",title:"",children:c.jsx(Mr,{size:12})})]})]}),c.jsxs("div",{className:"bg-white rounded-2xl shadow-xl shadow-indigo-100/20 border border-indigo-50 overflow-hidden flex flex-col animate-in zoom-in-95 duration-300 flex-1",children:[c.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 p-3 shrink-0",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2 text-white",children:[c.jsx(cd,{size:16,className:"animate-pulse"}),c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-xs font-bold tracking-wider",children:"AI "}),c.jsx("span",{className:"text-[10px] text-indigo-100 opacity-80 truncate max-w-[200px]",children:(Ce=Xn[Un])==null?void 0:Ce.prompt})]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:()=>{Wt(""),Ft(!0)},className:"p-1 text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-colors",title:"",children:c.jsx(Is,{size:14})}),c.jsx("button",{onClick:()=>{At(!1),ge(null)},className:"p-1 text-white/60 hover:text-white transition-colors",children:c.jsx(rn,{size:14})})]})]})}),c.jsxs("div",{className:"p-4 flex flex-col gap-3 overflow-hidden flex-1",children:[Nr?c.jsx("textarea",{value:oc,onChange:ht=>ii(ht.target.value),className:"w-full h-full min-h-[200px] p-3 text-[13px] text-slate-700 leading-relaxed border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none resize-none"}):c.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar pr-1",children:c.jsx("div",{className:"markdown-content text-[13px] text-slate-700 leading-relaxed prose prose-sm prose-indigo max-w-none",children:c.jsx(ik,{children:((pt=Xn[Un])==null?void 0:pt.content)||""})})}),c.jsx("div",{className:"flex flex-col gap-2 pt-2 border-t border-slate-50 shrink-0",children:Nr?c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:()=>{const ht=[...Xn];ht[Un]={...ht[Un],content:oc},Pr(ht),t&&i(t.id,{ai_history:ht},[],{skipHistory:!0}),ce(!1)},className:"flex-1 flex items-center justify-center gap-2 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-indigo-200 active:scale-95",children:[c.jsx(Gn,{size:14}),""]}),c.jsx("button",{onClick:()=>{var ht;ii(((ht=Xn[Un])==null?void 0:ht.content)||""),ce(!1)},className:"px-3 py-2 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-xl text-xs font-bold transition-all active:scale-95",children:""})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("button",{onClick:()=>{var ht;ii(((ht=Xn[Un])==null?void 0:ht.content)||""),ce(!0)},className:"flex items-center justify-center gap-1.5 py-2 bg-slate-50 hover:bg-slate-100 text-slate-600 rounded-xl text-[11px] font-bold transition-all border border-slate-200 active:scale-95",children:[c.jsx(Nw,{size:13}),""]}),c.jsxs("button",{onClick:async()=>{var Mt,Kt;const ht=((Mt=o.find(qt=>qt.name.includes("")))==null?void 0:Mt.id)||await l("");ht&&(await s({title:` ${T||""}`,description:((Kt=Xn[Un])==null?void 0:Kt.content)||"",tags:[ht],status:"active",color:"purple"}),g==null||g({msg:"",type:"info"}))},className:"flex items-center justify-center gap-1.5 py-2 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-xl text-[11px] font-bold transition-all border border-purple-200 shadow-sm active:scale-95",children:[c.jsx(ru,{size:13}),""]})]}),c.jsxs("button",{onClick:()=>{var en,gn;const ht=((en=Xn[Un])==null?void 0:en.content)||"",Mt=((gn=Xn[Un])==null?void 0:gn.prompt)||"",Kt=nE(ht);let qt="AI ";if(Mt){const $t=Mt.replace(/<[^>]*>/g,"").trim();$t.includes("")||$t.includes("")||$t.includes("")?qt="AI ":$t.includes("")||$t.includes("")||$t.includes("")?qt="AI ":$t.includes("")||$t.includes("")||$t.includes("")?qt="AI ":$t.includes("")||$t.includes("")?qt="AI ":$t.includes("")||$t.includes("")||$t.includes("translate")?qt="AI ":$t.includes("")||$t.includes("")||$t.includes("")?qt="AI ":$t.includes("")||$t.includes("")?qt="AI ":$t.includes("")||$t.includes("")?qt="AI ":$t.includes("")||$t.includes("")?qt="AI ":$t.length>0&&(qt="AI "+$t.slice(0,6).replace(/[]/g,""))}I($t=>$t+`<p><br><strong>--- ${qt} ---</strong></p>`+Kt),g==null||g({msg:"",type:"info"}),At(!1)},className:"flex items-center justify-center gap-2 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-indigo-200 active:scale-95",children:[c.jsx(Cw,{size:14}),""]}),Z&&c.jsxs("button",{onClick:()=>{var ht;if(fe.current){const Mt=fe.current,Kt=Z.from,qt=((ht=Xn[Un])==null?void 0:ht.content)||"",en=nE(qt),gn=Kt;Mt.commands.insertContentAt(Z,en),setTimeout(()=>{Mt.chain().setTextSelection({from:Kt,to:gn}).setHighlight({color:"#fef08a"}).setTextSelection(gn).focus().run(),ot({from:Kt,to:gn})},50),ge(null),be(null),At(!1),g==null||g({msg:"",type:"info"})}},className:"flex items-center justify-center gap-2 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-xl text-xs font-bold transition-all border border-green-200 shadow-sm active:scale-95",children:[c.jsx(Gn,{size:14}),""]})]})})]})]})]}):c.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400 gap-4 bg-slate-50/50 rounded-2xl border border-dashed border-slate-200",children:[c.jsx(cd,{size:32,className:"text-slate-300"}),c.jsx("span",{className:"text-xs text-slate-400",children:" AI "})]})});return xe?tr.createPortal(de,document.body):de})()]}),P.length>0&&c.jsx("div",{className:"grid grid-cols-4 gap-2 mt-2",children:P.map((E,H)=>{var ht;const de=R.find(Mt=>Mt.url===E),Ce=E.match(/\.(jpg|jpeg|png|gif|webp|avif)/i)||((ht=de==null?void 0:de.type)==null?void 0:ht.startsWith("image/")),pt=(de==null?void 0:de.name)||"Image";return c.jsxs("div",{className:"relative group aspect-square rounded-lg overflow-hidden border border-gray-100 shadow-sm cursor-pointer bg-gray-50 flex items-center justify-center",onClick:()=>Ce?me(E):window.open(E,"_blank"),children:[Ce?c.jsx("img",{src:E,alt:pt,className:"w-full h-full object-cover transition-transform group-hover:scale-105"}):c.jsxs("div",{className:"flex flex-col items-center gap-1 p-2",children:[c.jsx("div",{className:"w-8 h-8 rounded bg-white border border-gray-200 flex items-center justify-center shadow-sm",children:c.jsx(co,{size:16,className:"text-gray-400"})}),c.jsx("span",{className:"text-[9px] text-gray-500 truncate w-full px-1 text-center font-medium leading-tight",children:pt})]}),c.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors"}),c.jsx("button",{type:"button",onClick:Mt=>{Mt.stopPropagation(),il(E)},className:"absolute top-1 right-1 p-1 bg-black/50 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-500 z-10",children:c.jsx(rn,{size:10})})]},H)})}),R.length>0&&c.jsxs("div",{className:"mt-2",children:[c.jsxs("button",{type:"button",onClick:()=>hn(!xn),className:`w-full flex items-center justify-between gap-2 px-2.5 py-1.5 rounded-lg border transition-all ${xn?"bg-indigo-50 border-indigo-200":"bg-gray-50 border-gray-100 hover:bg-gray-100"}`,children:[c.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[c.jsx(co,{size:12,className:xn?"text-indigo-500":"text-gray-400"}),c.jsxs("span",{className:`text-xs font-medium ${xn?"text-indigo-700":"text-gray-600"}`,children:[R.length," "]}),R.filter(E=>{var H;return((H=E.type)==null?void 0:H.startsWith("audio/"))||E.name.match(/\.(mp3|wav|ogg|m4a|webm)$/i)}).length>0&&c.jsxs("span",{className:"text-[10px] text-indigo-500 bg-indigo-50 px-1.5 py-0.5 rounded-full flex items-center gap-1",children:[c.jsx(s1,{size:9}),R.filter(E=>{var H;return((H=E.type)==null?void 0:H.startsWith("audio/"))||E.name.match(/\.(mp3|wav|ogg|m4a|webm)$/i)}).length]}),!xn&&c.jsx("span",{className:"text-[10px] text-gray-400 truncate max-w-[200px]",children:R.map(E=>E.name.split(".")[0]).join(", ")})]}),c.jsx(es,{size:14,className:`text-gray-400 transition-transform ${xn?"rotate-180":""}`})]}),xn&&c.jsx("div",{className:"mt-1.5 space-y-1 animate-in slide-in-from-top-2 duration-200",children:R.map(E=>{var H;return c.jsxs("div",{className:`group flex items-center gap-2 px-2 py-1 rounded-md border transition-colors ${(et==null?void 0:et.url)===E.url?"bg-indigo-50 border-indigo-200 ring-1 ring-indigo-300/50":"bg-theme-card border-theme hover:border-theme"}`,children:[(H=E.type)!=null&&H.startsWith("audio/")||E.name.match(/\.(mp3|wav|ogg|m4a|webm|mp4)$/i)?c.jsx("button",{type:"button",onClick:de=>{de.preventDefault(),G({url:E.url,name:E.name,markers:E.markers})},className:"p-0.5 text-indigo-500 bg-indigo-50 rounded-full hover:bg-indigo-100",children:c.jsx(s1,{size:10})}):c.jsx(co,{size:10,className:"text-gray-400 flex-shrink-0"}),c.jsx("input",{ref:de=>{de&&ut===E.url&&(de.focus(),ee(null))},type:"text",value:E.name,onChange:de=>{const Ce=de.target.value;M(pt=>pt.map(ht=>ht.url===E.url?{...ht,name:Ce}:ht))},onBlur:()=>{t&&i(t.id,{attachments:R},[],{skipHistory:!0})},onKeyDown:de=>{var Ce;de.key==="Enter"&&(de.preventDefault(),de.stopPropagation(),de.target.blur(),(Ce=Me.current)==null||Ce.focus())},className:"flex-1 text-[11px] text-theme-secondary bg-transparent border-none focus:outline-none focus:bg-indigo-50/50 rounded px-1 truncate min-w-0"}),c.jsx("button",{type:"button",onClick:de=>{de.preventDefault(),fetch(E.url).then(Ce=>Ce.blob()).then(Ce=>{const pt=window.URL.createObjectURL(Ce),ht=document.createElement("a");ht.href=pt,ht.download=E.name,document.body.appendChild(ht),ht.click(),window.URL.revokeObjectURL(pt),document.body.removeChild(ht)}).catch(Ce=>console.error("Download failed:",Ce))},className:"p-0.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors opacity-0 group-hover:opacity-100",title:"",children:c.jsx(ru,{size:10})}),c.jsx("span",{className:"text-[9px] text-gray-400 flex-shrink-0",children:BR(E.size)}),c.jsx("button",{type:"button",onClick:()=>$R(E.url),className:"opacity-0 group-hover:opacity-100 p-0.5 hover:bg-red-50 rounded transition-all",children:c.jsx(rn,{size:10,className:"text-gray-400 hover:text-red-500"})})]},E.url)})})]})]})}),c.jsxs("div",{className:"flex items-center justify-between pt-1 flex-col items-start gap-2",children:[j.length>0&&(()=>{const E=j.filter(de=>{const Ce=o.find(pt=>pt.id===de);return Ce&&!Ce.name.startsWith("#")}),H=j.filter(de=>{const Ce=o.find(pt=>pt.id===de);return Ce&&Ce.name.startsWith("#")});return c.jsxs("div",{className:"flex flex-col gap-2 px-1 w-full",children:[E.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1",children:E.map(de=>{const Ce=o.find(pt=>pt.id===de);return Ce?c.jsx(vM,{tag:Ce,onRemove:()=>O(pt=>pt.filter(ht=>ht!==de))},de):null})}),H.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1 pt-1 border-t border-emerald-100",children:H.map(de=>{const Ce=o.find(pt=>pt.id===de);return Ce?c.jsxs("div",{className:"flex items-center gap-1 h-5 px-2 rounded-full text-[10px] font-medium bg-emerald-50 text-emerald-700 border border-emerald-200",children:[c.jsx("span",{children:Ce.name}),c.jsx("button",{type:"button",onClick:()=>O(pt=>pt.filter(ht=>ht!==de)),className:"hover:text-red-500 transition-colors",children:c.jsx(rn,{size:10})})]},de):null})})]})})(),c.jsxs("div",{className:"flex flex-col gap-3 w-full border-t border-gray-100 pt-3 mt-1",children:[c.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[!_&&c.jsxs("button",{type:"button",onClick:()=>N(new Date().toISOString()),className:"flex items-center gap-1 px-2 py-1.5 rounded-md bg-indigo-500/10 text-indigo-500 text-[10px] font-bold border border-indigo-500/20 hover:bg-indigo-500/20 transition-all animate-pulse hover:animate-none",title:"",children:[c.jsx(Is,{size:11})," "]}),c.jsx(T_,{innerRef:V,label:"",value:_||void 0,onChange:N,theme:an,tasks:a}),_&&c.jsx("div",{className:"flex items-center gap-2 bg-transparent rounded-md px-2 py-1 border border-theme",children:c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{ref:U,type:"checkbox",checked:ie,onChange:E=>{const H=E.target.checked;Fe(H),H||setTimeout(()=>{var de,Ce;(de=J.current)==null||de.focus(),(Ce=J.current)==null||Ce.select()},50)},className:"w-3 h-3 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-tighter",children:""})]})}),_&&c.jsx(xee,{value:pe,onChange:se}),c.jsx(T_,{tabIndex:-1,label:"",value:C||void 0,onChange:S,colorClass:"text-red-500",tasks:a,theme:an}),c.jsx(j1,{innerRef:Ke,icon:Pl,label:"",items:yr,selectedIds:j,placeholder:"...",allowAdd:!0,onDeleteItem:u,multiSelect:!0,theme:an,onSelect:async(E,H,de)=>{if(E)O(Ce=>Ce.includes(E)?Ce.filter(pt=>pt!==E):[...Ce,E]);else if(H){const Ce=await l(H,de??null);Ce&&O(pt=>[...pt,Ce])}}}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{type:"button",onClick:()=>Pe(!Se),className:`flex items-center gap-1 px-2 py-1.5 rounded-md text-[10px] font-bold border transition-all ${K?"bg-purple-50 text-purple-600 border-purple-200 hover:bg-purple-100":"bg-transparent text-theme-tertiary border-theme hover:bg-theme-hover"}`,title:"",children:[c.jsx(RI,{size:12}),K&&K.originalText||""]}),Se&&c.jsxs("div",{className:"absolute top-full left-0 mt-1 z-50 bg-white rounded-lg shadow-xl border border-gray-200 p-4 min-w-[280px]",children:[c.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-3",children:""}),c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsx("div",{className:"grid grid-cols-4 gap-1",children:[{type:"daily",label:""},{type:"weekly",label:""},{type:"monthly",label:""},{type:"yearly",label:""}].map(E=>c.jsx("button",{type:"button",onClick:()=>{ue(H=>({...H,type:E.type,interval:(H==null?void 0:H.interval)||1,originalText:`${(H==null?void 0:H.interval)||1}${E.type==="daily"?"":E.type==="weekly"?"":E.type==="monthly"?"":""}`,triggerMode:(H==null?void 0:H.triggerMode)||"on_complete"}))},className:`px-2 py-1.5 rounded text-xs font-medium transition-colors ${(K==null?void 0:K.type)===E.type?"bg-purple-500 text-white":"bg-gray-100 text-gray-600 hover:bg-purple-100"}`,children:E.label},E.type))})]}),K&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-sm text-gray-600",children:""}),c.jsx("input",{type:"number",min:1,max:365,value:K.interval,onChange:E=>{const H=Math.max(1,parseInt(E.target.value)||1);ue(de=>de?{...de,interval:H,originalText:`${H}${de.type==="daily"?"":de.type==="weekly"?"":de.type==="monthly"?"":""}`}:null)},className:"w-16 px-2 py-1 border border-gray-300 rounded text-sm text-center focus:border-purple-400 focus:outline-none"}),c.jsx("span",{className:"text-sm text-gray-600",children:K.type==="daily"?"":K.type==="weekly"?"":K.type==="monthly"?"":""})]})]}),(K==null?void 0:K.type)==="monthly"&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-sm text-gray-600",children:""}),c.jsx("input",{type:"number",min:1,max:31,value:K.monthDay||1,onChange:E=>{const H=Math.min(31,Math.max(1,parseInt(E.target.value)||1));ue(de=>de?{...de,monthDay:H,originalText:`${de.interval}${H}`}:null)},className:"w-16 px-2 py-1 border border-gray-300 rounded text-sm text-center focus:border-purple-400 focus:outline-none"}),c.jsx("span",{className:"text-sm text-gray-600",children:""})]})]}),K&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-gray-50",children:[c.jsx("input",{type:"radio",name:"triggerMode",checked:K.triggerMode!=="on_schedule",onChange:()=>ue(E=>E?{...E,triggerMode:"on_complete"}:null),className:"text-purple-500"}),c.jsxs("div",{children:[c.jsx("div",{className:"text-xs font-medium text-gray-700",children:""}),c.jsx("div",{className:"text-[10px] text-gray-400",children:""})]})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-gray-50",children:[c.jsx("input",{type:"radio",name:"triggerMode",checked:K.triggerMode==="on_schedule",onChange:()=>ue(E=>E?{...E,triggerMode:"on_schedule"}:null),className:"text-purple-500"}),c.jsxs("div",{children:[c.jsx("div",{className:"text-xs font-medium text-gray-700",children:""}),c.jsx("div",{className:"text-[10px] text-gray-400",children:""})]})]})]})]}),K&&c.jsx("div",{className:"mb-3",children:c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-gray-50",children:[c.jsx("input",{type:"checkbox",checked:K.copyDescription!==!1,onChange:E=>ue(H=>H?{...H,copyDescription:E.target.checked}:null),className:"w-3.5 h-3.5 text-purple-600 rounded border-gray-300 focus:ring-purple-500"}),c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-xs font-medium text-gray-700",children:""}),c.jsx("span",{className:"text-[10px] text-gray-400",children:""})]})]})}),K&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:" ()"}),c.jsx("input",{type:"date",value:K.endDate||"",onChange:E=>ue(H=>H?{...H,endDate:E.target.value||void 0}:null),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:border-purple-400 focus:outline-none",placeholder:""}),K.endDate&&c.jsx("button",{type:"button",onClick:()=>ue(E=>E?{...E,endDate:void 0}:null),className:"text-[10px] text-red-500 hover:underline mt-1",children:""})]}),c.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-100",children:[c.jsx("button",{type:"button",onClick:()=>{ue(null),Pe(!1)},className:"text-xs text-red-500 hover:text-red-600 font-medium",children:""}),c.jsx("button",{type:"button",onClick:()=>Pe(!1),className:"px-3 py-1 bg-purple-500 text-white text-xs font-medium rounded hover:bg-purple-600 transition-colors",children:""})]})]})]})]}),c.jsx(go,{children:!ie&&_&&c.jsxs(Rr.div,{initial:{height:0,opacity:0,marginTop:0},animate:{height:"auto",opacity:1,marginTop:0},exit:{height:0,opacity:0,marginTop:0},className:"overflow-hidden flex items-center gap-3 px-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ji,{size:12,className:"text-theme-tertiary"}),c.jsxs("div",{className:"flex items-center bg-transparent border border-theme rounded-md px-2 py-0.5",children:[c.jsx("input",{ref:J,type:"text",value:_e,onChange:E=>lk(E.target.value),onKeyDown:E=>{E.key==="Tab"?Bu(E):E.stopPropagation()},placeholder:"09:00",className:"bg-transparent border-none text-[11px] font-medium text-theme-primary focus:ring-0 outline-none p-0 w-12 placeholder:text-theme-tertiary"}),f.timeFormat==="12h"&&c.jsx("button",{onClick:()=>{const[E,H]=_e.split(" ");H&&lk(`${E} ${H==="AM"?"PM":"AM"}`)},className:"text-[10px] font-bold text-theme-tertiary hover:text-theme-secondary ml-1",children:_e.includes("PM")?"PM":"AM"})]}),c.jsx("span",{className:"text-theme-tertiary text-xs",children:""}),c.jsxs("div",{className:"flex items-center bg-transparent border border-theme rounded-md px-2 py-0.5",children:[c.jsx("input",{ref:he,type:"text",value:Xe,onChange:E=>UR(E.target.value),onKeyDown:E=>{E.key==="Tab"?Bu(E):E.stopPropagation()},placeholder:"10:00",className:"bg-transparent border-none text-[11px] font-medium text-theme-primary focus:ring-0 outline-none p-0 w-12 placeholder:text-theme-tertiary"}),f.timeFormat==="12h"&&c.jsx("span",{className:"text-[9px] font-bold text-indigo-400 ml-1",children:(()=>{const E=Xe.split(":");if(E.length!==2)return"";const H=parseInt(E[0]),de=parseInt(E[1]);return isNaN(H)||isNaN(de)?"":`${H%12||12}:${String(de).padStart(2,"0")}${H<12?"AM":"PM"}`})()})]})]}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsxs("div",{className:"relative",children:[c.jsx("input",{ref:Oe,type:"text",placeholder:"",value:it,onChange:E=>HR(E.target.value),onKeyDown:E=>{E.key==="Tab"?Bu(E):E.stopPropagation()},className:"w-14 bg-transparent border border-theme rounded-md px-2 py-0.5 text-[11px] font-medium text-theme-primary focus:ring-1 focus:ring-indigo-100 outline-none placeholder:text-theme-tertiary"}),c.jsx("span",{className:"absolute right-2 top-1.5 text-[8px] text-gray-400 font-bold pointer-events-none",children:"MIN"})]})})]})}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"file",ref:qe,className:"hidden",multiple:!0,accept:"image/*",onChange:lc}),c.jsxs("button",{type:"button",tabIndex:-1,onClick:()=>{var E;return(E=qe.current)==null?void 0:E.click()},className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border border-transparent hover:border-theme hover:bg-theme-hover text-theme-tertiary hover:text-theme-secondary focus:outline-none focus:bg-white focus:ring-1 ${(an==null?void 0:an.buttonRing)||"focus:ring-indigo-300"} focus:border-theme text-xs ${f.fontWeight==="thin"?"font-light":"font-medium"}`,children:[Ze?c.jsx(Vi,{size:13,className:"animate-spin"}):c.jsx(om,{size:13}),c.jsx("span",{children:""})]}),c.jsx("input",{ref:nt,type:"file",multiple:!0,className:"hidden",onChange:LR}),c.jsxs("button",{ref:Me,type:"button",tabIndex:-1,onClick:()=>{var E;return(E=nt.current)==null?void 0:E.click()},className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border border-transparent hover:border-theme hover:bg-theme-hover text-theme-tertiary hover:text-theme-secondary focus:outline-none focus:bg-white focus:ring-1 ${(an==null?void 0:an.buttonRing)||"focus:ring-indigo-300"} focus:border-theme text-xs ${f.fontWeight==="thin"?"font-light":"font-medium"}`,children:[Ze?c.jsx(Vi,{size:13,className:"animate-spin"}):c.jsx(co,{size:13}),c.jsx("span",{children:v("attachFiles")})]}),c.jsxs("button",{type:"button",tabIndex:-1,onMouseDown:E=>E.preventDefault(),onClick:()=>{si?So===(t==null?void 0:t.id)?rl():g==null||g({msg:"",type:"warning"}):t!=null&&t.id?nl(t.id):g==null||g({msg:"",type:"warning"})},className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border border-transparent hover:border-theme hover:bg-theme-hover text-theme-tertiary hover:text-theme-secondary focus:outline-none focus:bg-theme-card focus:ring-1 ${(an==null?void 0:an.buttonRing)||"focus:ring-indigo-300"} focus:border-theme text-xs ${f.fontWeight==="thin"?"font-light":"font-medium"} ${si&&So===(t==null?void 0:t.id)?"text-red-500 animate-pulse":""}`,title:si?"":"",children:[c.jsx(DI,{size:13,strokeWidth:si&&So===(t==null?void 0:t.id)?3:2}),c.jsx("span",{children:si&&So===(t==null?void 0:t.id)?_o(xs):""})]}),c.jsx(j1,{tabIndex:-1,icon:pp,label:"",items:Rn,allowAdd:!0,selectedIds:A?[A]:[],placeholder:"...",theme:an,onSelect:async(E,H)=>{let de=E;if(!de&&H&&(de=await s({title:H,is_project:!0,status:"inbox"})),!de&&!E)return;const Ce=de===A?null:de;Te(Ce),t&&(Ce&&h(Ce,!0),await i(t.id,{parent_id:Ce},[]))}})]}),!A&&c.jsxs("div",{className:"relative",children:[c.jsxs("button",{type:"button",onClick:()=>ze(!ye),className:"flex items-center gap-1.5 px-2 py-1.5 rounded-md border border-transparent hover:border-theme hover:bg-theme-hover transition-all group",title:"",children:[c.jsx("div",{className:`w-3 h-3 rounded-full ${((fk=Kn[We])==null?void 0:fk.dot)||"bg-gray-400"} group-hover:scale-110 transition-transform`}),c.jsx("span",{className:"text-xs text-theme-tertiary group-hover:text-theme-secondary",children:""})]}),ye&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>ze(!1)}),c.jsxs("div",{className:"absolute bottom-full left-0 mb-2 p-3 bg-white rounded-xl shadow-xl border border-gray-200 z-50 min-w-[200px] animate-in zoom-in-95 duration-100",children:[c.jsxs("div",{className:"text-xs font-semibold text-gray-500 mb-2 px-1 flex items-center gap-2",children:[c.jsx(Ew,{size:12}),""]}),c.jsx("div",{className:"grid grid-cols-6 gap-2",children:Object.keys(Kn).map(E=>c.jsx("button",{type:"button",onClick:()=>{ft(E),ze(!1)},className:`w-5 h-5 rounded-full ${Kn[E].dot} ${We===E?"ring-2 ring-offset-2 ring-gray-400 scale-110":"hover:scale-125 opacity-80 hover:opacity-100"} transition-all shadow-sm`,title:E},E))})]})]})]}),c.jsx("div",{className:"flex gap-1 p-1 bg-theme-hover rounded-lg border border-theme",title:"",children:[{level:"urgent",color:"bg-red-500",label:"",icon:""},{level:"planned",color:"bg-yellow-400",label:"",icon:""},{level:"delegated",color:"bg-green-500",label:"",icon:""},{level:"optional",color:"bg-gray-400",label:"",icon:""}].map(({level:E,color:H,label:de})=>c.jsx("button",{tabIndex:-1,type:"button",onClick:()=>De(le===E?void 0:E),title:de,className:`w-4 h-4 rounded-full ${H} ${le===E?"ring-2 ring-offset-1 ring-gray-500 scale-110":"opacity-50 hover:opacity-100 hover:scale-105"} transition-all`},E))})]})]})]})]})]}),vt&&c.jsx("div",{className:"fixed inset-0 z-[100] bg-black/90 flex items-center justify-center p-4",onClick:()=>me(null),children:c.jsxs("div",{className:"relative max-w-full max-h-full",onClick:E=>E.stopPropagation(),children:[c.jsx("img",{src:vt,alt:"Preview",className:"max-w-full max-h-[90vh] rounded-lg shadow-2xl"}),c.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[c.jsx("a",{href:vt,download:`attachment-${Date.now()}`,target:"_blank",rel:"noopener noreferrer",onClick:E=>E.stopPropagation(),className:"p-2 bg-black/50 hover:bg-black/70 text-white rounded-full backdrop-blur-sm transition-colors",title:"Download",children:c.jsx(ru,{size:20})}),c.jsx("button",{onClick:()=>me(null),className:"p-2 bg-black/50 hover:bg-black/70 text-white rounded-full backdrop-blur-sm transition-colors",children:c.jsx(rn,{size:20})})]})]})}),Nn.isOpen&&c.jsx("div",{className:"fixed inset-0 z-[150] flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm",onClick:()=>Or({...Nn,isOpen:!1}),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 max-w-lg w-full animate-in zoom-in duration-200",onClick:E=>E.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[c.jsx(Is,{size:18,className:"text-indigo-500"}),c.jsx("span",{children:v("aiPolishSuggestions")})]}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("button",{onClick:Ln,disabled:Nn.historyIndex<=0,className:"p-1.5 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors disabled:opacity-30 disabled:hover:bg-transparent disabled:hover:text-gray-500",title:v("undo"),children:c.jsx(Dg,{size:16})}),c.jsx("button",{onClick:gr,disabled:Nn.historyIndex>=Nn.history.length-1,className:"p-1.5 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors disabled:opacity-30 disabled:hover:bg-transparent disabled:hover:text-gray-500",title:v("redo"),children:c.jsx(jw,{size:16})})]})]}),c.jsxs("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2",children:v("suggestedTitle")}),c.jsx("input",{className:"w-full p-2 mb-3 bg-white border border-gray-200 rounded-lg text-sm text-gray-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none shadow-sm transition-all font-medium",value:Nn.title,onChange:E=>jn(E.target.value),onKeyDown:E=>{(E.ctrlKey||E.metaKey)&&E.key==="z"?(E.preventDefault(),E.stopPropagation(),E.shiftKey?gr():Ln()):(E.ctrlKey||E.metaKey)&&E.key==="y"&&(E.preventDefault(),E.stopPropagation(),gr())}}),c.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2",children:v("suggestedContent")}),c.jsx("textarea",{className:"w-full h-40 p-3 bg-white border border-gray-200 rounded-lg text-sm text-gray-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none resize-none leading-relaxed shadow-sm transition-all",value:Nn.content,onChange:E=>oi(E.target.value),onKeyDown:E=>{(E.ctrlKey||E.metaKey)&&E.key==="z"?(E.preventDefault(),E.stopPropagation(),E.shiftKey?gr():Ln()):(E.ctrlKey||E.metaKey)&&E.key==="y"&&(E.preventDefault(),E.stopPropagation(),gr())}})]}),c.jsxs("div",{className:"flex gap-3 justify-end",children:[c.jsx("button",{onClick:()=>Or({...Nn,isOpen:!1}),className:"px-4 py-1.5 text-gray-600 hover:bg-gray-100 rounded text-sm font-medium transition-colors",children:v("cancel")}),c.jsxs("button",{onClick:()=>{D(Nn.title),I(Nn.content),Or({...Nn,isOpen:!1,history:[],historyIndex:-1}),g({msg:v("aiPolishApplied"),type:"info"})},className:"px-4 py-1.5 bg-[#2563EB] hover:bg-[#1d4ed8] text-white rounded text-sm font-medium shadow-sm transition-colors flex items-center gap-1.5",children:[c.jsx(Gn,{size:14,strokeWidth:3}),v("confirmReplace")]})]})]})})]})},wee=["gray","blue","indigo","red","orange","amber","green","teal","cyan","sky","purple","fuchsia","pink","rose"],sE={gray:"bg-gray-400",blue:"bg-blue-500",indigo:"bg-indigo-500",red:"bg-red-500",orange:"bg-orange-500",amber:"bg-amber-500",green:"bg-green-500",teal:"bg-teal-500",cyan:"bg-cyan-500",sky:"bg-sky-500",purple:"bg-purple-500",fuchsia:"bg-fuchsia-500",pink:"bg-pink-500",rose:"bg-rose-500"},iE=({text:t,query:e})=>{if(!e.trim()||!t)return c.jsx(c.Fragment,{children:t});try{const n=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp(`(${n})`,"gi"),s=t.split(r);return c.jsx(c.Fragment,{children:s.map((i,o)=>i.toLowerCase()===e.toLowerCase()?c.jsx("mark",{className:"bg-yellow-200 text-yellow-900 px-0.5 rounded",children:i},o):c.jsx("span",{children:i},o))})}catch{return c.jsx(c.Fragment,{children:t})}},vee=({isOpen:t,onClose:e})=>{const{tasks:n,tags:r,searchHistory:s,addSearchHistory:i,deleteSearchHistory:o,setEditingTaskId:a,editingTaskId:l,navigateToTask:u,verifyTaskPassword:d,temporarilyUnlockTask:f,setToast:h}=b.useContext(Tn),[p,m]=b.useState(""),[y,x]=b.useState({tags:[],startDate:null,endDate:null,colors:[]}),[g,v]=b.useState("or"),[w,T]=b.useState(""),[D,k]=b.useState(!1),[I,C]=b.useState(""),[S,_]=b.useState(!1),N=b.useRef(null),[j,O]=b.useState(!1),[P,W]=b.useState(""),[R,M]=b.useState(null),[X,Q]=b.useState(null);b.useEffect(()=>{t&&N.current&&N.current.focus()},[t]);const A=b.useMemo(()=>!p.trim()&&y.tags.length===0&&!y.startDate&&!y.endDate&&y.colors.length===0?[]:n.filter(le=>{if(le.status==="deleted")return!1;const De=p.toLowerCase(),ie=!p.trim()||le.title.toLowerCase().includes(De)||le.description&&le.description.toLowerCase().includes(De);let Fe=!0;if(y.tags.length>0){const Xe=le.tags||[];g==="and"?Fe=y.tags.every(Ve=>Xe.includes(Ve)):Fe=y.tags.some(Ve=>Xe.includes(Ve))}let _e=!0;if(y.startDate||y.endDate){const Xe=le.start_date||le.due_date;if(!Xe)_e=!1;else{const Ve=Ue=>{const K=new Date(Ue);return isNaN(K.getTime())?NaN:K.setHours(0,0,0,0)},it=Ve(Xe);if(isNaN(it))_e=!1;else{if(y.startDate){const Ue=Ve(y.startDate);!isNaN(Ue)&&it<Ue&&(_e=!1)}if(y.endDate){const Ue=Ve(y.endDate);!isNaN(Ue)&&it>Ue&&(_e=!1)}}}}const tt=y.colors.length===0||y.colors.includes(le.color);return ie&&Fe&&_e&&tt}),[n,p,y,g]),Te=()=>{(p.trim()||y.tags.length>0||y.startDate||y.endDate||y.colors.length>0)&&i(p,y)},we=()=>{I.trim()&&(i(p,y,I.trim()),C(""),_(!1))},B=le=>{m(le.query),x(le.filters)},F=le=>{x(De=>({...De,tags:De.tags.includes(le)?De.tags.filter(ie=>ie!==le):[...De.tags,le]}))},ne=le=>{x(De=>({...De,colors:De.colors.includes(le)?De.colors.filter(ie=>ie!==le):[...De.colors,le]}))},We=()=>{x({tags:[],startDate:null,endDate:null,colors:[]})},ft=y.tags.length>0||y.startDate||y.endDate||y.colors.length>0;return b.useEffect(()=>{if(!t)return;const le=De=>{var ie,Fe,_e;if(De.key===" "&&((ie=document.activeElement)!=null&&ie.closest("[data-search-modal]"))&&((Fe=document.activeElement)==null?void 0:Fe.tagName)!=="INPUT"&&((_e=document.activeElement)==null?void 0:_e.tagName)!=="TEXTAREA"&&De.stopPropagation(),De.key==="Escape"){if(l)return;e()}};return window.addEventListener("keydown",le,!0),()=>window.removeEventListener("keydown",le,!0)},[t,e,l]),t?c.jsxs(c.Fragment,{children:[tr.createPortal(c.jsx(go,{children:c.jsx(Rr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-start justify-center pt-20",onClick:e,"data-search-modal":!0,children:c.jsxs(Rr.div,{initial:{opacity:0,scale:.95,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20},transition:{duration:.2},className:"w-full max-w-2xl bg-theme-card rounded-2xl shadow-2xl overflow-hidden",onClick:le=>le.stopPropagation(),children:[c.jsxs("div",{className:"p-4 border-b border-theme",children:[c.jsxs("div",{className:"flex items-center gap-3 bg-theme-hover rounded-xl px-4 py-3",children:[c.jsx(Bc,{size:20,className:"text-theme-tertiary"}),c.jsx("input",{ref:N,type:"text",value:p,onChange:le=>m(le.target.value),onKeyDown:le=>{le.key==="Enter"&&Te()},placeholder:"...",className:"flex-1 bg-transparent outline-none text-theme-primary placeholder-theme-tertiary"}),p&&c.jsx("button",{onClick:()=>m(""),className:"text-theme-tertiary hover:text-theme-primary",children:c.jsx(rn,{size:18})})]}),c.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[c.jsxs("button",{onClick:()=>k(!D),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors ${D||ft?"bg-indigo-100 text-indigo-700":"bg-theme-hover text-theme-secondary hover:bg-theme-hover/80"}`,children:[D?c.jsx(es,{size:14}):c.jsx(ns,{size:14}),"",ft&&c.jsx("span",{className:"ml-1 w-5 h-5 bg-indigo-500 text-white rounded-full flex items-center justify-center text-[10px]",children:y.tags.length+(y.startDate||y.endDate?1:0)+y.colors.length})]}),c.jsxs("button",{onClick:()=>{m(""),x({tags:[],startDate:null,endDate:null,colors:[]})},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium bg-theme-hover text-theme-secondary hover:bg-theme-hover/80 transition-colors",children:[c.jsx(Ji,{size:14}),"",s.length>0&&c.jsx("span",{className:"ml-1 w-5 h-5 bg-gray-500 text-white rounded-full flex items-center justify-center text-[10px]",children:s.length})]}),ft&&c.jsx("button",{onClick:We,className:"text-xs text-theme-tertiary hover:text-theme-primary",children:""})]}),c.jsx(go,{children:D&&c.jsxs(Rr.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-3 space-y-4 overflow-hidden",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary",children:[c.jsx(Pl,{size:12}),"",y.tags.length>0&&c.jsx("span",{className:"px-1.5 py-0.5 bg-indigo-100 text-indigo-600 rounded-full text-[10px]",children:y.tags.length})]}),y.tags.length>1&&c.jsxs("div",{className:"flex items-center bg-theme-hover rounded-lg p-0.5",children:[c.jsx("button",{onClick:()=>v("or"),className:`px-2 py-0.5 text-[10px] font-bold rounded-md transition-all ${g==="or"?"bg-theme-card text-indigo-600 shadow-sm":"text-theme-tertiary"}`,children:" OR"}),c.jsx("button",{onClick:()=>v("and"),className:`px-2 py-0.5 text-[10px] font-bold rounded-md transition-all ${g==="and"?"bg-theme-card text-indigo-600 shadow-sm":"text-theme-tertiary"}`,children:" AND"})]})]}),c.jsxs("div",{className:"relative mb-2",children:[c.jsx("input",{type:"text",value:w,onChange:le=>T(le.target.value),placeholder:"...",className:"w-full px-3 py-1.5 bg-theme-hover rounded-lg text-xs border-0 focus:ring-2 focus:ring-indigo-500 pl-8 text-theme-primary"}),c.jsx(Bc,{size:12,className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-theme-tertiary"})]}),y.tags.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1.5 mb-2 p-2 bg-indigo-50 rounded-lg",children:y.tags.map(le=>{const De=r.find(ie=>ie.id===le);return De?c.jsxs("button",{onClick:()=>F(De.id),className:"flex items-center gap-1.5 px-2 py-1 bg-indigo-500 text-white rounded-full text-xs font-medium hover:bg-indigo-600 transition-colors",children:[c.jsx("span",{children:De.name}),c.jsx(rn,{size:10})]},De.id):null})}),c.jsxs("div",{className:"max-h-32 overflow-y-auto",children:[c.jsx("div",{className:"grid grid-cols-3 gap-1",children:r.filter(le=>!y.tags.includes(le.id)).filter(le=>!w||le.name.toLowerCase().includes(w.toLowerCase())).map(le=>c.jsxs("button",{onClick:()=>F(le.id),className:"flex items-center gap-1.5 px-2 py-1.5 bg-theme-hover hover:bg-theme-hover/80 rounded-lg text-xs text-theme-secondary transition-colors text-left",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-400 flex-shrink-0"}),c.jsx("span",{className:"truncate",children:le.name})]},le.id))}),r.filter(le=>!y.tags.includes(le.id)).filter(le=>!w||le.name.toLowerCase().includes(w.toLowerCase())).length===0&&c.jsx("div",{className:"text-center text-xs text-theme-tertiary py-2",children:""})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary",children:[c.jsx(Go,{size:12}),"",(y.startDate||y.endDate)&&c.jsx("span",{className:"px-1.5 py-0.5 bg-indigo-100 text-indigo-600 rounded-full text-[10px]",children:""})]}),(y.startDate||y.endDate)&&c.jsxs("button",{onClick:()=>x(le=>({...le,startDate:null,endDate:null})),className:"text-[10px] text-red-500 hover:text-red-600 flex items-center gap-1 z-10",children:[c.jsx(rn,{size:10}),""]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"date",value:y.startDate||"",onChange:le=>x(De=>({...De,startDate:le.target.value||null})),className:"px-3 py-1.5 rounded-lg bg-theme-hover text-xs border-0 focus:ring-2 focus:ring-indigo-500 text-theme-primary"}),c.jsx("span",{className:"text-theme-tertiary",children:""}),c.jsx("input",{type:"date",value:y.endDate||"",onChange:le=>x(De=>({...De,endDate:le.target.value||null})),className:"px-3 py-1.5 rounded-lg bg-theme-hover text-xs border-0 focus:ring-2 focus:ring-indigo-500 text-theme-primary"}),(y.startDate||y.endDate)&&c.jsx("button",{onClick:()=>x(le=>({...le,startDate:null,endDate:null})),className:"p-1.5 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-colors",title:"",children:c.jsx(rn,{size:14})})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary mb-2",children:[c.jsx(Ew,{size:12}),""]}),c.jsx("div",{className:"flex flex-wrap gap-2",children:wee.map(le=>c.jsx("button",{onClick:()=>ne(le),className:`w-6 h-6 rounded-full ${sE[le]} transition-transform ${y.colors.includes(le)?"ring-2 ring-offset-2 ring-indigo-500 scale-110":"hover:scale-110"}`},le))})]})]})})]}),c.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:A.length>0?c.jsxs("div",{className:"p-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("span",{className:"text-xs font-medium text-theme-secondary",children:[" ",A.length," "]}),S?c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"text",value:I,onChange:le=>C(le.target.value),placeholder:"...",className:"px-2 py-1 text-xs border rounded-lg w-32 bg-theme-hover text-theme-primary border-theme",autoFocus:!0}),c.jsx("button",{onClick:we,className:"p-1 text-green-600 hover:text-green-700",children:c.jsx(Gn,{size:14})}),c.jsx("button",{onClick:()=>{_(!1),C("")},className:"p-1 text-theme-tertiary hover:text-theme-primary",children:c.jsx(rn,{size:14})})]}):c.jsxs("button",{onClick:()=>_(!0),className:"flex items-center gap-1 text-xs text-indigo-600 hover:text-indigo-700",children:[c.jsx(PI,{size:12}),""]})]}),c.jsx("div",{className:"space-y-1",children:A.map(le=>{const De=le.start_date||le.due_date,ie=De?new Date(De).toLocaleDateString("zh-TW",{year:"numeric",month:"short",day:"numeric"}):null,Fe=l===le.id,_e=!!le.is_locked,tt=_e&&!le.lock_password,Xe=it=>{it.stopPropagation(),_e?(M(le.id),Q("edit"),W(""),O(!0)):a(le.id)},Ve=it=>{it==null||it.stopPropagation(),_e?(M(le.id),Q("navigate"),W(""),O(!0)):(a(null),u(le.id,!0),e())};return c.jsx("div",{className:"rounded-xl hover:bg-theme-hover transition-colors border border-transparent hover:border-theme",children:Fe?c.jsx("div",{onClick:it=>it.stopPropagation(),onMouseDown:it=>it.stopPropagation(),children:c.jsx(Ro,{initialData:le,onClose:()=>a(null)})}):c.jsx("div",{className:"p-3",children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("div",{className:`w-3 h-3 rounded-full mt-1 flex-shrink-0 ${sE[le.color]}`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:`font-medium text-theme-primary flex items-center gap-1.5 ${tt?"blur-[4px] select-none":""}`,children:[_e&&c.jsx(Aa,{size:12,className:"text-amber-500 flex-shrink-0"}),c.jsx(iE,{text:le.title,query:p})]}),le.description&&!tt&&c.jsx("div",{className:"text-sm text-theme-secondary mt-1 max-h-20 overflow-y-auto",children:c.jsx(iE,{text:le.description.replace(/<[^>]*>/g,""),query:p})}),le.tags.length>0&&!tt&&c.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:le.tags.map(it=>{const Ue=r.find(K=>K.id===it);return Ue?c.jsx("span",{className:"px-2 py-0.5 bg-theme-hover text-theme-secondary rounded-full text-[10px]",children:Ue.name},it):null})})]}),c.jsxs("div",{className:"flex flex-col items-end gap-1 flex-shrink-0",children:[ie&&c.jsx("span",{className:"text-xs text-theme-tertiary",children:ie}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:Xe,className:"p-1 text-theme-tertiary hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors",title:_e?"":"",children:c.jsx(Gn,{size:14})}),c.jsx("button",{onClick:Ve,className:"p-1 text-theme-tertiary hover:text-emerald-600 hover:bg-emerald-50 rounded transition-colors",title:_e?"":"",children:c.jsx(TI,{size:14})})]})]})]})})},le.id)})})]}):p||ft?c.jsxs("div",{className:"p-8 text-center text-theme-tertiary",children:[c.jsx(Bc,{size:32,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{children:""})]}):s.length>0?c.jsxs("div",{className:"p-4",children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary mb-3",children:[c.jsx(Ji,{size:12}),""]}),c.jsx("div",{className:"space-y-1",children:s.map(le=>c.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-theme-hover group",children:[c.jsxs("button",{onClick:()=>B(le),className:"flex-1 text-left",children:[c.jsx("div",{className:"font-medium text-theme-primary text-sm",children:le.name||le.query||"()"}),c.jsxs("div",{className:"text-xs text-theme-tertiary mt-0.5",children:[new Date(le.created_at).toLocaleDateString(),le.filters.tags.length>0&&`  ${le.filters.tags.length} `,le.filters.colors.length>0&&`  ${le.filters.colors.length} `]})]}),c.jsx("button",{onClick:()=>o(le.id),className:"p-1 text-theme-tertiary hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:c.jsx(Mr,{size:14})})]},le.id))})]}):c.jsxs("div",{className:"p-8 text-center text-theme-tertiary",children:[c.jsx(Bc,{size:32,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{children:""})]})}),c.jsx("div",{className:"p-3 border-t border-theme bg-theme-hover flex justify-between items-center text-xs text-theme-tertiary",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("span",{children:[c.jsx("kbd",{className:"px-1.5 py-0.5 bg-theme-card border border-theme rounded text-theme-primary",children:"Enter"})," "]}),c.jsxs("span",{children:[c.jsx("kbd",{className:"px-1.5 py-0.5 bg-theme-card border border-theme rounded text-theme-primary",children:"Esc"})," "]})]})})]})})}),document.body),j&&tr.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999]",onClick:()=>{O(!1),M(null),Q(null)},children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-80 max-w-[90vw]",onClick:le=>le.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[c.jsx(Aa,{size:20,className:"text-amber-500"}),c.jsx("h3",{className:"text-lg font-bold",children:""})]}),c.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["",X==="edit"?"":"",""]}),c.jsx("input",{type:"password",placeholder:"",value:P,onChange:le=>W(le.target.value),onKeyDown:le=>{le.key==="Enter"&&R&&(d(R,P)?(f(R),X==="edit"?a(R):(a(null),u(R,!0),e()),O(!1),M(null),Q(null)):h({msg:"",type:"error"})),le.key==="Escape"&&(O(!1),M(null),Q(null))},autoFocus:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-amber-500"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:()=>{O(!1),M(null),Q(null)},className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:""}),c.jsx("button",{onClick:()=>{R&&(d(R,P)?(f(R),X==="edit"?a(R):(a(null),u(R,!0),e()),O(!1),M(null),Q(null)):h({msg:"",type:"error"}))},className:"flex-1 px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors",children:""})]})]})}),document.body)]}):null},kee=({current:t,total:e})=>{const n=e>0?Math.round(t/e*100):0;return tr.createPortal(c.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm",children:c.jsxs("div",{className:"bg-[#1e1e1e] p-6 rounded-xl shadow-2xl w-80 border border-white/10 text-center",children:[c.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Importing Calendar..."}),c.jsx("div",{className:"w-full bg-gray-700 h-2 rounded-full mb-2 overflow-hidden",children:c.jsx("div",{className:"bg-indigo-500 h-full transition-all duration-200",style:{width:`${n}%`}})}),c.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-2",children:[c.jsxs("span",{children:[t," / ",e]}),c.jsxs("span",{children:[n,"%"]})]})]})}),document.body)},See=["#6366f1","#f43f5e","#10b981","#f59e0b","#64748b"],_ee=({id:t,label:e,active:n,overdueCount:r,normalCount:s,icon:i,color:o,acceptsDrop:a,isEditing:l,editingViewName:u,setEditingViewName:d,setEditingViewId:f,saveViewName:h,setHoveredDropTarget:p,sidebarCollapsed:m,sidebarTextClass:y,sidebarFontClass:x,setView:g,setTagFilter:v,onEditFilter:w})=>{const{dragState:T,updateGhostPosition:D,endDrag:k,selectedTaskIds:I,moveTaskToView:C}=b.useContext(Tn),S=o||(n?"var(--accent-color)":void 0),_=b.useRef(!1),[N,j]=b.useState(!1),O=R=>{a&&(R.preventDefault(),R.stopPropagation(),_.current||(_.current=!0,j(!0),p(t)),D(R.clientX,R.clientY))},P=R=>{R.preventDefault(),_.current=!1,j(!1),p(null)},W=async R=>{if(R.preventDefault(),R.stopPropagation(),_.current=!1,j(!1),p(null),!a){k();return}const M=I.length>0?I:T!=null&&T.draggedId?[T.draggedId]:[];M.length>0&&await C(M,t),k()};return c.jsx("div",{className:`relative group/nav-wrapper transition-all ${N?"ring-2 ring-indigo-500 ring-inset rounded-lg bg-indigo-50 dark:bg-indigo-900/40":""}`,onDragOver:O,onDragLeave:P,onDrop:W,children:c.jsxs("button",{onClick:()=>{!l&&g&&(g(t),v&&v(null))},onDoubleClick:R=>{R.stopPropagation(),w&&w(t)},style:{pointerEvents:a&&(T!=null&&T.isDragging)?"none":"auto"},className:`w-full flex items-center ${m?"justify-center px-1":"justify-between px-3"} py-3 md:py-1 rounded-lg mb-1 md:mb-0 transition-colors touch-manipulation ${y} ${x} ${n?"bg-theme-hover text-theme-primary font-bold":"text-theme-secondary font-medium hover:bg-theme-hover hover:text-theme-primary active:bg-theme-hover"}`,title:m?e:"",children:[c.jsxs("div",{className:`flex items-center gap-2 ${m?"justify-center w-full":""}`,children:[i&&c.jsx(i,{size:16,style:{color:S},className:!o&&!n?"text-theme-tertiary":""}),!m&&(l?c.jsx("input",{autoFocus:!0,value:u,onChange:R=>d(R.target.value),onKeyDown:R=>{R.stopPropagation(),R.key==="Enter"?h(t,u):R.key==="Escape"&&f(null)},onBlur:()=>h(t,u),onClick:R=>R.stopPropagation(),className:"bg-theme-card border border-indigo-300 rounded px-1 py-0.5 text-xs outline-none focus:ring-1 focus:ring-indigo-500 w-20 text-theme-primary"}):c.jsx("span",{children:e}))]}),!m&&c.jsxs("div",{className:"flex gap-2 items-center",children:[r>0&&c.jsx("span",{className:"text-[11px] font-semibold text-white bg-rose-400 rounded-full px-3.5 py-0.5 min-w-[26px] text-center shadow-sm",children:r}),s>0&&(t==="matrix"?c.jsx("span",{className:"text-[11px] font-semibold text-white bg-yellow-400 rounded-full px-3.5 py-0.5 min-w-[26px] text-center shadow-sm",children:s}):c.jsx("span",{className:"text-[11px] text-gray-400 font-medium",children:s}))]})]})})},oE=({view:t,setView:e,tagFilter:n,setTagFilter:r})=>{const[s,i]=b.useState(null),{tasks:o,tags:a,themeSettings:l,setThemeSettings:u,deleteTag:d,updateTag:f,addTag:h,clearAllTasks:p,exportData:m,importData:y,syncGoogleToApp:x,expandedTags:g,setExpandedTags:v,sidebarCollapsed:w,toggleSidebar:T,tagsWithResolvedColors:D,t:k,language:I,setLanguage:C,setAdvancedFilters:S,viewTagFilters:_,updateViewTagFilter:N,visibleTasks:j,setFocusedTaskId:O,moveTaskToView:P,selectedTaskIds:W,dragState:R,updateGhostPosition:M,endDrag:X,addTask:Q,batchAddTasks:A,updateTask:Te,batchUpdateTasks:we,setToast:B,deleteTask:F,batchDeleteTasks:ne,batchImportTasks:We,user:ft,searchOpen:le,setSearchOpen:De,lockedGoogleTagIds:ie,toggleGoogleTagLock:Fe}=b.useContext(Tn),[_e,tt]=b.useState(!1),[Xe,Ve]=b.useState(null),[it,Ue]=b.useState(null),[K,ue]=b.useState(""),[re,oe]=b.useState(()=>{try{return JSON.parse(localStorage.getItem("custom_view_names")||"{}")}catch{return{}}}),[pe,se]=b.useState(""),[Se,Pe]=b.useState(!1),[ye,ze]=b.useState(null),[Ze,gt]=b.useState(""),vt=b.useRef(null),[me,He]=b.useState({provider:localStorage.getItem("ai_provider")||"gemini",googleKey:localStorage.getItem("google_ai_key")||"",openaiKey:localStorage.getItem("openai_api_key")||"",baseUrl:localStorage.getItem("ai_base_url")||"https://api.openai.com/v1",modelName:localStorage.getItem("ai_model")||"gpt-3.5-turbo"}),[qe,nt]=b.useState(null),[Me,ut]=b.useState(null),[ee,fe]=b.useState(null),[q,Z]=b.useState(""),[ge,xe]=b.useState(null),[be,ve]=b.useState(null),[ot,et]=b.useState(()=>{const ce=localStorage.getItem("sidebar_tags_expanded");return ce!==null?ce==="true":!0}),G=b.useRef(null),ae=b.useRef(null),[Ae,Y]=b.useState(!1),[Ie,Le]=b.useState(localStorage.getItem("google_client_id")||""),[ct,Rt]=b.useState({start:new Date().toISOString().split("T")[0],end:new Date(new Date().setMonth(new Date().getMonth()+1)).toISOString().split("T")[0]}),[Cn,Ot]=b.useState("date"),[nn,cn]=b.useState([]),[Ee,Tt]=b.useState(new Set),[Ft,Lt]=b.useState(null),Wt=b.useRef(null),un=b.useRef(null),rr=b.useRef(null);o1(Wt,()=>tt(!1)),o1(un,()=>xe(null)),b.useEffect(()=>{const ce=St=>{St.key==="Escape"&&Xe&&Ve(null)};return window.addEventListener("keydown",ce),()=>window.removeEventListener("keydown",ce)},[Xe]),b.useEffect(()=>{Xe&&se(re[Xe]||"")},[Xe,re]);const ys=async()=>{const ce=o.filter(Pt=>Pt.tags.some(jt=>{const Zt=a.find(kn=>kn.id===jt);return Zt&&Zt.name.startsWith("Google:")}));if(ce.length===0){alert(I==="zh"?" Google ":"No Google Calendar tasks found to delete");return}if(!confirm(I==="zh"?` ${ce.length}  Google 
( App  Google )`:`Delete ${ce.length} Google Calendar tasks?
(This will only delete local tasks, NOT Google Calendar events)`))return;const St=JSON.parse(localStorage.getItem("task_google_map")||"{}"),At=ce.map(Pt=>Pt.id);At.forEach(Pt=>{delete St[Pt]}),localStorage.setItem("task_google_map",JSON.stringify(St)),localStorage.removeItem("google_sync_tokens"),await ne(At,!0),B({msg:` ${ce.length}  Google `,type:"success"}),tt(!1)};b.useEffect(()=>{const ce=St=>{(St.metaKey||St.ctrlKey)&&St.shiftKey&&(St.key==="f"||St.key==="F"||St.key==="s"||St.key==="S")&&(St.preventDefault(),St.stopPropagation(),De(!0)),St.key==="Escape"&&(ge?xe(null):le&&De(!1))};return window.addEventListener("keydown",ce),()=>window.removeEventListener("keydown",ce)},[le,ge]),b.useEffect(()=>{Se&&vt.current&&vt.current.focus(),ee?rr.current=ee:rr.current&&setTimeout(()=>{const ce=document.querySelector(`[data-tag-id="${rr.current}"]`);ce&&ce.focus(),rr.current=null},50)},[Se,ee]);const wn=async()=>{if(!Ie.trim()){alert(I==="zh"?" Settings  Google Client ID":"Please set Google Client ID in settings"),tt(!0);return}localStorage.setItem("google_client_id",Ie.trim());try{await gI(),ae.current||(ae.current=window.google.accounts.oauth2.initTokenClient({client_id:Ie,scope:"https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar.readonly",callback:async ce=>{if(ce.error){console.error(ce);return}await Er(ce.access_token)}})),Ot("date"),Y(!0)}catch{alert("Failed to load Google Sign-In script")}},yn=()=>{ae.current&&ae.current.requestAccessToken({prompt:""})},Er=async ce=>{Lt(ce),localStorage.setItem("google_access_token",ce);try{const St=await bl(ce);cn(St);const At=St.find(Pt=>Pt.primary);At&&Tt(new Set([At.id])),Ot("select")}catch(St){alert("Failed to fetch calendars: "+St),Y(!1)}},Pn=async()=>{var ce,St;if(Ft){Y(!1);try{i({current:0,total:0,importing:!0});let At=[],Pt=[];const jt=I==="zh"?"":"Schedule";let Zt=(ce=a.find(xn=>xn.name.toLowerCase()==="schedule"||xn.name===""))==null?void 0:ce.id;Zt||(Zt=await h(jt,null));for(const xn of Array.from(Ee)){const hn=nn.find(jn=>jn.id===xn),Hn=`Google:${(hn==null?void 0:hn.summary)||"Calendar"}`;let ir=(St=a.find(jn=>jn.name===Hn))==null?void 0:St.id;ir||(ir=await h(Hn,null));const Ii=await yI(Ft,xn,ct.start,ct.end),oi=JSON.parse(localStorage.getItem("task_google_map")||"{}");Ii.forEach(jn=>{const Ln=!jn.start.dateTime;let gr=jn.start.date,$=null,z=null;if(!Ln&&jn.start.dateTime){const J=new Date(jn.start.dateTime),he=J.getFullYear(),Oe=String(J.getMonth()+1).padStart(2,"0"),Ke=String(J.getDate()).padStart(2,"0");gr=`${he}-${Oe}-${Ke}`;const Qe=String(J.getHours()).padStart(2,"0"),at=String(J.getMinutes()).padStart(2,"0");if($=`${Qe}:${at}`,jn.end.dateTime){const xt=new Date(jn.end.dateTime),lt=String(xt.getHours()).padStart(2,"0"),mt=String(xt.getMinutes()).padStart(2,"0");z=`${lt}:${mt}`}}else gr=jn.start.date;const L={title:jn.summary||"(No Title)",description:jn.description||"",status:"active",tags:[Zt,ir].filter(Boolean),start_date:gr,start_time:$,end_time:z,is_all_day:Ln,color:"blue",google_event_id:jn.id,google_calendar_id:xn},V=Object.keys(oi).find(J=>oi[J].evtId===jn.id);let U=V?o.find(J=>J.id===V):null;U||(U=o.find(J=>J.title===(jn.summary||"(No Title)")&&J.start_date===gr&&!Object.keys(oi).includes(J.id))),U?Pt.push({id:U.id,data:L}):At.push(L)})}const kn=At.length+Pt.length;A&&At.length>0&&await A(At,null,(xn,hn)=>i({current:xn,total:kn,importing:!0})),we&&Pt.length>0&&await we(Pt);const sr=nn.filter(xn=>!Ee.has(xn.id));let An=0;for(const xn of sr){const hn=`Google:${xn.summary}`,Hn=a.find(ir=>ir.name===hn);Hn&&(await d(Hn.id),An++,console.log(`[Import] Removed tag for unselected calendar: ${hn}`))}if(B){let xn=`Synced ${kn} events (Added: ${At.length}, Updated: ${Pt.length})`;An>0&&(xn+=`. Stopped sync for ${An} unselected calendars.`),B({msg:xn,type:"info"})}kn===0&&alert("No events found")}catch(At){console.error(At),alert("Import Error: "+At.message)}finally{i(null)}}},Jn=async(ce,St=null)=>{ce==null||ce.preventDefault(),Ze.trim()?(await h(Ze.trim(),St),gt(""),Pe(!1),ze(null),St&&!g.includes(St)&&v(At=>[...At,St])):(Pe(!1),ze(null))},Nn=b.useMemo(()=>{const ce=["prompt",""],St=["journal","note","",""],At=["someday","inspiration","","/"],Pt=["note","journal","",""],jt=["project",""],Zt=["schedule",""],kn=a.find(L=>ce.some(V=>L.name.trim().toLowerCase()===V)),sr=a.find(L=>St.some(V=>L.name.trim().toLowerCase()===V)),An=a.find(L=>At.some(V=>L.name.trim().toLowerCase()===V)),xn=a.find(L=>Pt.some(V=>L.name.trim().toLowerCase()===V)),hn=a.find(L=>jt.some(V=>L.name.trim().toLowerCase()===V)),Hn=a.find(L=>L.name==="#prompt"),ir=a.find(L=>Zt.some(V=>L.name.toLowerCase()===V)),Ii=kn==null?void 0:kn.id,oi=sr==null?void 0:sr.id,jn=An==null?void 0:An.id,Ln=xn==null?void 0:xn.id,gr=hn==null?void 0:hn.id,$=Hn==null?void 0:Hn.id,z=ir==null?void 0:ir.id;return{inbox:o.filter(L=>{if(L.parent_id||L.status==="deleted"||L.status==="logged")return!1;if(!L.start_date&&!L.due_date&&(!L.tags||L.tags.length===0))return!0;const U=!!L.completed_at;return!(!(L.status==="inbox")&&!U||Ii&&L.tags.includes(Ii)||oi&&L.tags.includes(oi)||jn&&L.tags.includes(jn)||Ln&&L.tags.includes(Ln)||$&&L.tags.includes($)||gr&&L.tags.includes(gr)&&o.some(Oe=>Oe.parent_id===L.id&&Oe.status!=="deleted")||!U&&(L.start_date||L.due_date))}).length,todayOverdue:(()=>o.filter(L=>!(L.status==="completed"||L.status==="deleted"||L.status==="logged"||L.status==="waiting"||L.status==="someday"||!Xx(L.start_date||L.due_date)||z&&L.tags.includes(z)||Ln&&L.tags.includes(Ln)||gr&&L.tags.includes(gr))).length)(),todayScheduled:(()=>o.filter(L=>!(L.status==="completed"||L.status==="deleted"||L.status==="logged"||L.status==="waiting"||L.status==="someday"||Xx(L.start_date||L.due_date)||!_w(L.start_date||L.due_date)||z&&L.tags.includes(z)||Ln&&L.tags.includes(Ln)||gr&&L.tags.includes(gr))).length)(),prompt:o.filter(L=>L.status!=="deleted"&&L.status!=="logged"&&Ii&&L.tags.includes(Ii)&&!L.reviewed_at).length,logbook:o.filter(L=>L.status==="logged"&&!L.reviewed_at).length,waiting:o.filter(L=>L.status==="deleted"||L.status==="logged"?!1:(L.status==="waiting"||jn&&L.tags.includes(jn))&&!L.reviewed_at).length,trash:o.filter(L=>L.status==="deleted").length,note:o.filter(L=>L.status==="deleted"||L.status==="logged"?!1:Ln&&L.tags.includes(Ln)).length,matrixUrgent:o.filter(L=>L.parent_id||L.status==="deleted"||L.status==="logged"||L.status==="completed"||z&&L.tags.includes(z)?!1:L.importance==="urgent").length,matrixPlanned:o.filter(L=>L.parent_id||L.status==="deleted"||L.status==="logged"||L.status==="completed"||z&&L.tags.includes(z)?!1:L.importance==="important").length}},[o,a]),Or={small:"text-xs",normal:"text-sm",large:"text-base"}[l.fontSize]||"text-sm",Ni={small:"text-xs",normal:"text-sm",large:"text-base"}[l.fontSize]||"text-sm",tl=l.fontWeight==="thin"?"font-normal":"",Qo=(ce,St)=>{const At={...re,[ce]:St};oe(At),localStorage.setItem("custom_view_names",JSON.stringify(At)),Ue(null)},[mn,ko]=b.useState(null),Zo=async ce=>{if(console.log("[Sidebar Drop] hoveredDropTarget:",mn),!mn||!R.isDragging)return;ce.preventDefault(),ce.stopPropagation();const St=W.length>0?W:R.draggedId?[R.draggedId]:[];console.log("[Sidebar Drop] Moving tasks:",St,"to:",mn),St.length>0&&await P(St,mn),ko(null),X()},si=b.useMemo(()=>{const ce=(St,At)=>a.filter(Pt=>Pt.parent_id===St).sort((Pt,jt)=>(Pt.order_index||0)-(jt.order_index||0)).map(Pt=>({id:Pt.id,name:Pt.name,depth:At,parent_id:Pt.parent_id,data:Pt,isExpanded:g.includes(Pt.id),children:ce(Pt.id,At+1)}));return ce(null,0)},[a,g]),nl=(ce,St)=>{St.stopPropagation(),v(At=>At.includes(ce)?At.filter(Pt=>Pt!==ce):[...At,ce])},rl=(ce,St)=>{ce.dataTransfer.setData("tag_id",St),nt(St)},So=(ce,St)=>{if(ce.preventDefault(),qe===St)return;const At=ce.currentTarget.getBoundingClientRect(),Pt=ce.clientY-At.top,jt=At.height;let Zt="inside";Pt<jt*.25?Zt="top":Pt>jt*.75&&(Zt="bottom"),ut({id:St,position:Zt})},xs=async(ce,St)=>{ce.preventDefault();const At=ce.dataTransfer.getData("tag_id");if(!At||At===St){ut(null),nt(null);return}const Pt=a.find(An=>An.id===At),jt=a.find(An=>An.id===St);if(!Pt||!jt)return;let Zt=jt;for(;Zt.parent_id;){if(Zt.parent_id===At){ut(null),nt(null);return}const An=a.find(xn=>xn.id===Zt.parent_id);if(!An)break;Zt=An}let kn=Pt.parent_id,sr=Pt.order_index||0;if((Me==null?void 0:Me.position)==="inside")kn=St,sr=a.filter(hn=>hn.parent_id===St).reduce((hn,Hn)=>Math.max(hn,Hn.order_index||0),0)+1e4,g.includes(St)||v(hn=>[...hn,St]);else{kn=jt.parent_id;const An=a.filter(hn=>hn.parent_id===jt.parent_id).sort((hn,Hn)=>(hn.order_index||0)-(Hn.order_index||0)),xn=An.findIndex(hn=>hn.id===St);if((Me==null?void 0:Me.position)==="top"){const hn=An[xn-1],Hn=(hn==null?void 0:hn.order_index)||0,ir=jt.order_index||0;sr=hn?(Hn+ir)/2:ir-1e4}else{const hn=An[xn+1],Hn=(hn==null?void 0:hn.order_index)||0,ir=jt.order_index||0;sr=hn?(ir+Hn)/2:ir+1e4}}await f(At,{parent_id:kn,order_index:sr}),ut(null),nt(null)},_o=async ce=>{n===ce&&r(null),await d(ce)},sl=ce=>{fe(ce.id),Z(ce.name),xe(null)},Xn=async()=>{ee&&q.trim()&&(await f(ee,{name:q}),fe(null))},Pr=()=>{localStorage.setItem("ai_provider",me.provider),localStorage.setItem("google_ai_key",me.googleKey.trim()),localStorage.setItem("openai_api_key",me.openaiKey.trim()),localStorage.setItem("ai_base_url",me.baseUrl.trim()),localStorage.setItem("ai_model",me.modelName.trim()),alert("AI Settings Saved!")},Un=ce=>{ce.target.files&&ce.target.files[0]&&(y(ce.target.files[0]),tt(!1))},ji=ce=>{ee||(r(ce),e("inbox"),S({additionalTags:[],startDate:null,dueDate:null,color:null}),O(null))},oc=(ce,St)=>{if(ee!==St){if(ce.key==="ArrowRight"){ce.preventDefault();const At=a.find(Pt=>Pt.id===St);At&&a.some(Pt=>Pt.parent_id===St)&&(g.includes(St)||v(Pt=>[...Pt,At.id]))}if(ce.key==="ArrowLeft"){ce.preventDefault();const At=a.find(Pt=>Pt.id===St);if(At)g.includes(St)&&v(Pt=>Pt.filter(jt=>jt!==St));else if(At.parent_id){const Pt=document.querySelector(`[data-tag-id="${At.parent_id}"]`);Pt&&(Pt.focus(),ji(At.parent_id))}}if(ce.key==="ArrowDown"||ce.key==="ArrowUp"){ce.preventDefault();const At=Array.from(document.querySelectorAll("[data-tag-id]")),Pt=At.findIndex(sr=>sr.getAttribute("data-tag-id")===St);if(Pt===-1)return;const jt=ce.key==="ArrowDown"?(Pt+1)%At.length:(Pt-1+At.length)%At.length,Zt=At[jt];Zt.focus();const kn=Zt.getAttribute("data-tag-id");kn&&ji(kn)}if(ce.key==="Tab"&&(ce.preventDefault(),j.length>0&&O(j[0].data.id)),ce.key==="Enter"){ce.preventDefault();const At=a.find(Pt=>Pt.id===St);At&&sl(At)}if(ce.key==="Delete"||ce.key==="Backspace"){ce.preventDefault(),ce.stopPropagation();const At=St;setTimeout(()=>{confirm(k("deleteTagConfirm"))&&_o(At)},10)}}},ii=ce=>{const St=(Me==null?void 0:Me.id)===ce.id;let At="border-transparent";St&&((Me==null?void 0:Me.position)==="top"?At="border-t-2 border-t-indigo-500":(Me==null?void 0:Me.position)==="bottom"?At="border-b-2 border-b-indigo-500":At="bg-indigo-50 ring-1 ring-indigo-500");const Pt=ee===ce.id;return c.jsxs("div",{className:"relative",children:[c.jsxs("div",{"data-tag-id":ce.id,draggable:!Pt,onDragStart:jt=>rl(jt,ce.id),onDragOver:jt=>So(jt,ce.id),onDrop:jt=>xs(jt,ce.id),onDragLeave:()=>ut(null),className:`relative group flex items-center gap-0.5 py-0.5 rounded pr-1 transition-all select-none outline-none ${Ni} ${tl} ${n===ce.id?"bg-theme-hover text-indigo-600 font-bold":"text-theme-secondary font-medium hover:text-theme-primary hover:bg-theme-hover"} ${At} ${w?"justify-center pl-0":""}`,style:{paddingLeft:w?"0":`${ce.depth*6+6}px`},onClick:()=>{Pt||ji(ce.id)},onDoubleClick:jt=>{jt.stopPropagation(),sl(ce)},tabIndex:0,onKeyDown:jt=>oc(jt,ce.id),children:[ce.children.length>0?c.jsx("button",{onClick:jt=>nl(ce.id,jt),className:"p-0 hover:bg-theme-hover rounded text-theme-tertiary",children:ce.isExpanded?c.jsx(es,{size:10}):c.jsx(ns,{size:10})}):c.jsx("div",{className:"w-[10px]"}),Pt?c.jsxs("div",{className:"flex items-center flex-1 gap-1",children:[c.jsx("input",{autoFocus:!0,className:"flex-1 min-w-0 bg-theme-card border border-indigo-500/50 rounded px-1 py-0.5 text-xs outline-none focus:ring-1 focus:ring-indigo-500 text-theme-primary",value:q,onChange:jt=>Z(jt.target.value),onKeyDown:jt=>{jt.key==="Enter"?Xn():jt.key==="Escape"&&fe(null)},onClick:jt=>jt.stopPropagation()}),c.jsx("button",{onClick:jt=>{jt.stopPropagation(),Xn()},className:"text-green-600 hover:bg-green-100 p-0.5 rounded",children:c.jsx(Gn,{size:12})}),c.jsx("button",{onClick:jt=>{jt.stopPropagation(),fe(null)},className:"text-red-500 hover:bg-red-100 p-0.5 rounded",children:c.jsx(rn,{size:12})})]}):c.jsxs(c.Fragment,{children:[!w&&c.jsxs("span",{className:"truncate flex-1 text-left flex items-center gap-1",style:D[ce.id]?{color:D[ce.id],opacity:.5}:void 0,children:[ce.name.startsWith("#")?ce.name.slice(1):ce.name,ce.name.startsWith("Google:")&&ie.includes(ce.id)&&c.jsx(Aa,{size:9,className:"text-amber-500 flex-shrink-0"})]}),!w&&c.jsxs("div",{className:"flex items-center opacity-0 group-hover:opacity-100 transition-opacity",children:[c.jsx("button",{onClick:jt=>{jt.stopPropagation(),ze(ce.id),gt(""),ce.isExpanded||v(Zt=>[...Zt,ce.id])},className:"p-0.5 hover:bg-gray-200 rounded text-gray-400",title:k("addSubTag"),children:c.jsx(xi,{size:10})}),c.jsx("button",{onMouseDown:jt=>{jt.stopPropagation()},onClick:jt=>{jt.stopPropagation();const Zt=jt.currentTarget.getBoundingClientRect(),kn=180,sr=window.innerHeight,xn=Zt.bottom+4+kn>sr?Zt.top-kn-4:Zt.bottom+4;ve({top:Math.max(8,xn),left:Math.max(8,Zt.right-208)}),xe(ge===ce.id?null:ce.id)},className:"p-0.5 hover:bg-gray-200 rounded text-gray-400",children:c.jsx(Cz,{size:10})})]}),ge===ce.id&&be&&tr.createPortal(c.jsxs("div",{ref:un,className:"fixed bg-theme-card rounded-xl shadow-2xl border border-theme p-3 w-52 animate-in fade-in slide-in-from-top-1 duration-200",style:{top:be.top,left:Math.max(8,be.left),zIndex:99999},onClick:jt=>jt.stopPropagation(),children:[c.jsxs("div",{className:"mb-3",children:[c.jsx("p",{className:"text-[9px] font-bold text-gray-400 mb-2 uppercase",children:k("tagStyle")}),c.jsx("div",{className:"grid grid-cols-5 gap-1.5 focus:outline-none",children:See.map(jt=>c.jsx("button",{className:`w-6 h-6 rounded-full hover:scale-110 transition-transform ${ce.data.color===jt?"ring-2 ring-offset-1 ring-indigo-500 shadow-sm":""}`,style:{backgroundColor:jt},onClick:Zt=>{Zt.stopPropagation(),f(ce.id,{color:jt}),xe(null)},title:k("selectTagColor")},jt))})]}),c.jsxs("div",{className:"space-y-0.5",children:[c.jsxs("button",{onClick:()=>{ze(ce.id),gt(""),xe(null),ce.isExpanded||v(jt=>[...jt,ce.id])},className:"w-full flex items-center gap-2 px-2 py-1 hover:bg-theme-hover rounded text-[11px] text-theme-secondary font-medium",children:[c.jsx(xi,{size:11})," ",k("addSubTag")]}),c.jsxs("button",{onClick:()=>sl(ce),className:"w-full flex items-center gap-2 px-2 py-1 hover:bg-theme-hover rounded text-[11px] text-theme-secondary font-medium",children:[c.jsx(Ig,{size:11})," ",k("rename")]}),ce.name.startsWith("Google:")&&c.jsx("button",{onClick:jt=>{jt.stopPropagation(),Fe(ce.id),xe(null)},className:`w-full flex items-center gap-2 px-2 py-1 hover:bg-theme-hover rounded text-[11px] font-medium ${ie.includes(ce.id)?"text-amber-600":"text-theme-secondary"}`,children:ie.includes(ce.id)?c.jsxs(c.Fragment,{children:[c.jsx(r1,{size:11})," "]}):c.jsxs(c.Fragment,{children:[c.jsx(Aa,{size:11})," "]})}),c.jsxs("button",{onClick:jt=>{jt.stopPropagation();const Zt=ce.id;xe(null),setTimeout(()=>{confirm(k("deleteTagConfirm"))&&_o(Zt)},10)},className:"w-full flex items-center gap-2 px-2 py-1 hover:bg-red-50 rounded text-[11px] text-red-600 font-medium",children:[c.jsx(Mr,{size:11})," ",k("deleteTag")]})]})]}),document.body)]})]}),ye===ce.id&&c.jsx("div",{className:"px-1 mb-0.5",style:{paddingLeft:`${(ce.depth+1)*6+6}px`},children:c.jsx("form",{onSubmit:jt=>Jn(jt,ce.id),className:"relative",children:c.jsx("input",{autoFocus:!0,value:Ze,onChange:jt=>gt(jt.target.value),onKeyDown:jt=>{jt.key==="Escape"&&ze(null),jt.stopPropagation()},onBlur:()=>{Ze.trim()||ze(null)},placeholder:k("subTagPlaceholder"),className:"w-full text-[10px] py-1 px-2 bg-indigo-50/30 border border-indigo-100/50 rounded outline-none focus:ring-1 focus:ring-indigo-200 transition-all font-medium text-gray-700 placeholder:text-gray-300"})})}),ce.isExpanded&&ce.children.map(jt=>ii(jt))]},ce.id)},Nr=ce=>{const St=it===ce.id,At=["logbook","recent","trash","worklog"].includes(ce.id),Pt=re[ce.id]||ce.label;return c.jsx(_ee,{...ce,label:Pt,isEditing:St,editingViewName:K,setEditingViewName:ue,setEditingViewId:Ue,saveViewName:Qo,setHoveredDropTarget:ko,sidebarCollapsed:w,sidebarTextClass:Or,sidebarFontClass:tl,setView:e,setTagFilter:r,onEditFilter:At?void 0:jt=>Ve(jt)})};return c.jsxs("aside",{className:"w-full bg-theme-sidebar border-r border-theme h-screen flex flex-col p-5 sticky top-0 overflow-hidden",onDragOver:ce=>{R.isDragging&&(ce.preventDefault(),M(ce.clientX,ce.clientY))},onDrop:Zo,children:[c.jsxs("div",{className:`mb-8 flex items-center ${w?"justify-center flex-col gap-4":"justify-between px-1"} opacity-60`,children:[!w&&c.jsxs("div",{className:"flex items-center gap-2 text-theme-secondary",children:[c.jsx(t1,{size:18})," ",c.jsx("span",{className:"text-xs font-bold tracking-widest uppercase text-theme-tertiary",children:k("appearance")})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:()=>De(!0),className:"hover:bg-theme-hover p-1 rounded transition-colors text-theme-secondary",title:" (K)",children:c.jsx(Bc,{size:18})}),c.jsx("button",{onClick:T,className:"hover:bg-theme-hover p-1 rounded transition-colors text-theme-secondary",children:w?c.jsx(jz,{size:18}):c.jsx(Nz,{size:18})})]})]}),c.jsxs("nav",{className:"flex-1 overflow-y-auto no-scrollbar py-2",children:[c.jsx("div",{className:"mb-6",children:c.jsx(Nr,{id:"inbox",label:k("inbox"),normalCount:Nn.inbox,active:t==="inbox"&&!n,icon:e1,color:"#1badf8"})}),c.jsxs("div",{className:"mb-6",children:[c.jsx(Nr,{id:"today",label:k("today"),overdueCount:Nn.todayOverdue,normalCount:Nn.todayScheduled,active:t==="today"&&!n,icon:$I,color:"#f5c94c",acceptsDrop:!0}),c.jsx(Nr,{id:"allview",label:"",active:t==="allview"&&!n,icon:jI,color:"#10b981"}),c.jsx(Nr,{id:"matrix",label:"",normalCount:Nn.matrixUrgent,active:t==="matrix",icon:t1,color:"#6366f1"})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx(Nr,{id:"focus",label:"",active:t==="focus",icon:zI,color:"#ef4444"}),c.jsx(Nr,{id:"project",label:"",active:t==="project",icon:uz,color:"#f97316",acceptsDrop:!0}),c.jsx(Nr,{id:"annualplan",label:"",active:t==="annualplan",icon:az,color:"#eab308"})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx(Nr,{id:"waiting",label:"/",active:t==="waiting"&&!n,icon:Ji,color:"#a855f7",acceptsDrop:!0}),c.jsx(Nr,{id:"journal",label:"",active:t==="journal"&&!n,icon:X6,color:"#34d399",acceptsDrop:!0}),c.jsx(Nr,{id:"prompt",label:k("prompt"),normalCount:Nn.prompt,active:t==="prompt",icon:xz,color:"#fbbf24",acceptsDrop:!0}),c.jsx(Nr,{id:"worklog",label:"",active:t==="worklog",icon:Gf,color:"#0ea5e9"})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx(Nr,{id:"logbook",label:k("logbook"),normalCount:Nn.logbook,active:t==="logbook",icon:sm,color:"#a16207"}),c.jsx(Nr,{id:"recent",label:"",active:t==="recent",icon:gz,color:"#0891b2"}),c.jsx(Nr,{id:"trash",label:k("trash"),normalCount:Nn.trash>1e3?Nn.trash:void 0,active:t==="trash",icon:Mr,color:"#9ca3af"})]}),!w&&c.jsxs("div",{className:"mt-2",children:[c.jsxs("div",{className:"flex items-center justify-between px-3 mb-2 group/tagheader cursor-pointer select-none",onClick:()=>{const ce=!ot;et(ce),localStorage.setItem("sidebar_tags_expanded",String(ce))},children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("p",{className:"text-[10px] font-bold text-gray-300 uppercase tracking-wider",children:"TAGS"}),c.jsx("span",{className:"text-gray-300 transition-transform duration-200",style:{transform:ot?"rotate(0deg)":"rotate(-90deg)"},children:c.jsx(es,{size:10})})]}),c.jsx("button",{onClick:ce=>{ce.stopPropagation(),Pe(!0),ot||et(!0)},className:"opacity-0 group-hover/tagheader:opacity-100 p-0.5 hover:bg-gray-100 rounded text-gray-400 hover:text-gray-600 transition-all flex items-center justify-center",title:"",children:c.jsx(xi,{size:10})})]}),ot&&c.jsxs("div",{className:"overflow-hidden",children:[Se&&c.jsx("div",{className:"px-3 overflow-hidden mb-2",children:c.jsxs("form",{onSubmit:Jn,className:"relative",children:[c.jsx("input",{ref:vt,value:Ze,onChange:ce=>gt(ce.target.value),onKeyDown:ce=>{ce.key==="Escape"&&Pe(!1),ce.stopPropagation()},onBlur:()=>{Ze.trim()||Pe(!1)},placeholder:"...",className:"w-full text-xs py-1.5 px-2 bg-indigo-50/50 border border-indigo-100 rounded-md outline-none focus:ring-1 focus:ring-indigo-300 transition-all font-medium text-gray-700 placeholder:text-gray-300"}),c.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1",children:Ze.trim()&&c.jsx("button",{type:"submit",className:"text-indigo-500 hover:text-indigo-600",children:c.jsx(Gn,{size:12})})})]})}),c.jsxs("div",{className:"space-y-0",children:[si.map(ce=>ii(ce)),!Se&&c.jsxs("button",{onClick:()=>Pe(!0),className:"w-full group flex items-center gap-1.5 px-3 py-1 text-gray-300 hover:text-gray-400 text-xs transition-colors transition-opacity opacity-0 hover:opacity-100",children:[c.jsx(xi,{size:10}),c.jsx("span",{className:"font-medium",children:k("addTagPlaceholder")})]})]})]})]})]}),c.jsxs("div",{className:"mt-auto pt-4 border-t border-gray-200 relative",children:[c.jsxs("div",{className:`flex ${w?"justify-center flex-col gap-2":"justify-between"} items-center`,children:[!w&&c.jsxs("div",{className:"text-[10px] text-gray-400 flex items-center gap-1",children:[c.jsx(NI,{size:10})," ",z6]}),c.jsx("button",{onClick:()=>tt(!_e),"aria-label":"Settings",className:"text-gray-400 hover:text-gray-600 p-1 rounded hover:bg-gray-100 transition-colors",children:c.jsx(LI,{size:14})})]}),_e&&c.jsx("div",{ref:Wt,className:"absolute bottom-full left-0 mb-2 w-full bg-white rounded-lg shadow-xl border border-gray-200 z-50 animate-in fade-in zoom-in duration-100 max-h-[60vh] overflow-y-auto",children:c.jsxs("div",{className:"p-3",children:[c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider",children:k("appearance")}),c.jsxs("div",{className:"space-y-3 mb-4",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:k("language")})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>C("zh"),className:`flex-1 text-[10px] py-1 rounded ${I==="zh"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:I==="zh"?"":"Chinese"}),c.jsx("button",{onClick:()=>C("en"),className:`flex-1 text-[10px] py-1 rounded ${I==="en"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:I==="zh"?"":"English"})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:I==="zh"?"":"Color Theme"})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>u(ce=>({...ce,themeMode:"light"})),className:`flex-1 text-[10px] py-1 rounded ${l.themeMode==="light"||!l.themeMode?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:I==="zh"?"":"Light"}),c.jsx("button",{onClick:()=>u(ce=>({...ce,themeMode:"dark"})),className:`flex-1 text-[10px] py-1 rounded ${l.themeMode==="dark"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:I==="zh"?"":"Dark"}),c.jsx("button",{onClick:()=>u(ce=>({...ce,themeMode:"programmer"})),className:`flex-1 text-[10px] py-1 rounded ${l.themeMode==="programmer"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:I==="zh"?"":"Dev"})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:k("fontSize")})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>u(ce=>({...ce,fontSize:"small"})),className:`flex-1 text-[10px] py-1 rounded ${l.fontSize==="small"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:k("sizeSmall")}),c.jsx("button",{onClick:()=>u(ce=>({...ce,fontSize:"normal"})),className:`flex-1 text-[10px] py-1 rounded ${l.fontSize==="normal"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:k("sizeNormal")}),c.jsx("button",{onClick:()=>u(ce=>({...ce,fontSize:"large"})),className:`flex-1 text-[10px] py-1 rounded ${l.fontSize==="large"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:k("sizeLarge")})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:k("timeFormat")})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>u(ce=>({...ce,timeFormat:"24h"})),className:`flex-1 text-[10px] py-1 rounded ${l.timeFormat==="24h"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:"24H"}),c.jsx("button",{onClick:()=>u(ce=>({...ce,timeFormat:"12h"})),className:`flex-1 text-[10px] py-1 rounded ${l.timeFormat==="12h"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:"12H"})]})]})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:k("calendarSettings")}),c.jsxs("div",{className:"mb-4 space-y-2",children:[c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showLunar,onChange:ce=>u({...l,showLunar:ce.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:k("showLunar")})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showTaiwanHolidays,onChange:ce=>u({...l,showTaiwanHolidays:ce.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:k("showTaiwanHolidays")})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showRelationshipLines!==!1,onChange:ce=>u({...l,showRelationshipLines:ce.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:""})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showImportedGoogleEvents!==!1,onChange:ce=>u({...l,showImportedGoogleEvents:ce.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:I==="zh"?" Google ":"Show Google Events"})]})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:"Google Calendar"}),c.jsxs("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"Client ID"}),c.jsx("input",{type:"text",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"your-client-id.apps.googleusercontent.com",value:Ie,onChange:ce=>Le(ce.target.value)})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:k("aiSettings")}),c.jsxs("div",{className:"mb-4 space-y-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] font-bold text-gray-400 uppercase mb-1",children:k("provider")}),c.jsxs("select",{value:me.provider,onChange:ce=>He(St=>({...St,provider:ce.target.value})),className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",children:[c.jsx("option",{value:"gemini",children:"Google Gemini"}),c.jsx("option",{value:"openai",children:"OpenAI Compatible (DeepSeek/Moonshot)"})]})]}),me.provider==="gemini"?c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsx("span",{className:"text-xs text-gray-600",children:"Gemini API Key"}),c.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-indigo-500 hover:underline",children:"Get Key"})]}),c.jsx("input",{type:"password",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"AIza...",value:me.googleKey,onChange:ce=>He(St=>({...St,googleKey:ce.target.value}))})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"Base URL"}),c.jsx("input",{type:"text",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"https://api.deepseek.com",value:me.baseUrl,onChange:ce=>He(St=>({...St,baseUrl:ce.target.value}))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"API Key"}),c.jsx("input",{type:"password",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"sk-...",value:me.openaiKey,onChange:ce=>He(St=>({...St,openaiKey:ce.target.value}))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"Model Name"}),c.jsx("input",{type:"text",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"e.g. deepseek-chat",value:me.modelName,onChange:ce=>He(St=>({...St,modelName:ce.target.value}))})]})]}),c.jsx("button",{onClick:Pr,className:"w-full bg-indigo-600 text-white px-2 py-1.5 rounded text-xs hover:bg-indigo-700 transition-colors font-medium",children:"Save Settings"})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:"Data"}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("button",{onClick:()=>{confirm(I==="zh"?"":"Are you sure you want to delete all tasks? A backup will be downloaded first.")&&p()},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(Mr,{size:12})," ",I==="zh"?"":"Delete All Tasks"]}),c.jsxs("button",{onClick:m,className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(ru,{size:12})," ",I==="zh"?"":"Backup Data"]}),c.jsxs("button",{onClick:()=>{var ce;return(ce=G.current)==null?void 0:ce.click()},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx($z,{size:12})," ",I==="zh"?"":"Import Data"]}),c.jsxs("button",{onClick:wn,className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(Go,{size:12})," ",I==="zh"?" Google ":"Import Google Calendar"]}),c.jsxs("button",{onClick:()=>x&&x(),className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(n1,{size:12})," ",I==="zh"?" Google ":"Sync Google Calendar"]}),c.jsxs("button",{onClick:()=>{localStorage.removeItem("google_sync_tokens"),B({msg:"Sync tokens ...",type:"info"}),x&&x()},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-amber-50 rounded text-xs text-amber-600",children:[c.jsx(n1,{size:12})," ",I==="zh"?"":"Force Full Sync"]}),c.jsxs("button",{onClick:ys,className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-red-600",children:[c.jsx(Mr,{size:12})," ",I==="zh"?"":"Clear Imported Calendar"]}),c.jsxs("button",{onClick:async()=>{if(!confirm("Google:( Google )"))return;const ce=JSON.parse(localStorage.getItem("task_google_map")||"{}"),St=o.filter(Pt=>Pt.tags.some(jt=>{const Zt=a.find(kn=>kn.id===jt);return Zt&&Zt.name.includes("")&&Zt.name.toLowerCase().includes("google")}));let At=0;St.forEach(Pt=>{ce[Pt.id]&&delete ce[Pt.id]}),localStorage.setItem("task_google_map",JSON.stringify(ce));for(const Pt of St)await F(Pt.id),At++;B({msg:` ${At} `,type:"success"})},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-orange-600",children:[c.jsx(Mr,{size:12})," ",I==="zh"?" ()":"Clean CiXing Tasks (Local)"]}),c.jsx("input",{type:"file",ref:G,className:"hidden",accept:".json",onChange:Un})]})]})})]}),Xe&&tr.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-[9999] flex items-center justify-center",onClick:()=>Ve(null),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-80 max-h-[80vh] flex flex-col overflow-hidden",onClick:ce=>ce.stopPropagation(),children:[c.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h3",{className:"font-bold text-gray-700 text-sm",children:""}),c.jsx("button",{onClick:()=>Ve(null),className:"text-gray-400 hover:text-gray-600",children:c.jsx(rn,{size:16})})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-xs text-gray-500",children:""}),c.jsx("input",{type:"text",value:pe,onChange:ce=>se(ce.target.value),onBlur:()=>{const ce={...re};pe.trim()?ce[Xe]=pe:delete ce[Xe],oe(ce),localStorage.setItem("custom_view_names",JSON.stringify(ce))},onKeyDown:ce=>{ce.key==="Enter"&&ce.target.blur()},className:"flex-1 px-2 py-1 text-sm border border-gray-200 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:k(Xe)||Xe})]})]}),c.jsxs("div",{className:"p-2 overflow-y-auto flex-1 text-sm",children:[c.jsx("p",{className:"px-2 py-2 text-xs text-gray-500 mb-2 bg-yellow-50 rounded border border-yellow-100",children:" () /  () / "}),c.jsx("div",{className:"space-y-1",children:a.map(ce=>{const St=_[Xe]||{include:[],exclude:[]},{include:At,exclude:Pt}=Array.isArray(St)?{include:St,exclude:[]}:St,jt=At.includes(ce.id),Zt=Pt.includes(ce.id);return c.jsxs("div",{className:"flex items-center gap-2 px-2 py-2 hover:bg-gray-50 rounded cursor-pointer select-none",onClick:()=>{let kn=[...At],sr=[...Pt];jt?(kn=kn.filter(An=>An!==ce.id),sr.push(ce.id)):Zt?sr=sr.filter(An=>An!==ce.id):kn.push(ce.id),N(Xe,{include:kn,exclude:sr})},children:[c.jsxs("div",{className:"w-5 h-5 flex items-center justify-center",children:[jt&&c.jsx(gf,{size:16,className:"text-green-500"}),Zt&&c.jsx(Bz,{size:16,className:"text-red-500"}),!jt&&!Zt&&c.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300"})]}),c.jsx("span",{style:{color:D[ce.id]},children:ce.name.startsWith("#")?ce.name.slice(1):ce.name})]},ce.id)})})]}),c.jsx("div",{className:"p-3 border-t border-gray-100 flex justify-end",children:c.jsx("button",{onClick:()=>Ve(null),className:"px-4 py-1.5 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700",children:""})})]})}),document.body),Ae&&tr.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-[9999] flex items-center justify-center",onClick:()=>Y(!1),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-96 p-4 max-h-[80vh] flex flex-col",onClick:ce=>ce.stopPropagation(),children:[c.jsx("h3",{className:"font-bold text-gray-700 text-sm mb-4",children:Cn==="date"?I==="zh"?"":"Select Date Range":I==="zh"?"":"Select Calendars"}),Cn==="date"?c.jsxs("div",{className:"space-y-3 mb-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Start Date"}),c.jsx("input",{type:"date",className:"w-full border border-gray-200 rounded px-2 py-1 text-sm outline-none focus:ring-1 focus:ring-indigo-500",value:ct.start,onChange:ce=>Rt(St=>({...St,start:ce.target.value}))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"End Date"}),c.jsx("input",{type:"date",className:"w-full border border-gray-200 rounded px-2 py-1 text-sm outline-none focus:ring-1 focus:ring-indigo-500",value:ct.end,onChange:ce=>Rt(St=>({...St,end:ce.target.value}))})]}),c.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[c.jsx("button",{onClick:()=>Y(!1),className:"px-3 py-1.5 text-gray-500 hover:bg-gray-100 rounded text-xs",children:"Cancel"}),c.jsx("button",{onClick:yn,className:"px-3 py-1.5 bg-indigo-600 text-white rounded text-xs font-medium hover:bg-indigo-700",children:"Next"})]})]}):c.jsxs("div",{className:"mb-4 flex flex-col flex-1 overflow-hidden",children:[c.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 mb-4 border border-gray-100 rounded p-2",children:nn.map(ce=>c.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer hover:bg-gray-50 p-1 rounded",children:[c.jsx("input",{type:"checkbox",checked:Ee.has(ce.id),onChange:St=>{const At=new Set(Ee);St.target.checked?At.add(ce.id):At.delete(ce.id),Tt(At)},className:"rounded text-indigo-600 focus:ring-indigo-500"}),c.jsx("span",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:ce.backgroundColor||"#ccc"}}),c.jsx("span",{className:"truncate",children:ce.summary})]},ce.id))}),c.jsxs("div",{className:"flex justify-end gap-2 mt-auto",children:[c.jsx("button",{onClick:()=>Ot("date"),className:"px-3 py-1.5 text-gray-500 hover:bg-gray-100 rounded text-xs",children:"Back"}),c.jsx("button",{onClick:Pn,disabled:Ee.size===0,className:"px-3 py-1.5 bg-indigo-600 text-white rounded text-xs font-medium hover:bg-indigo-700 disabled:opacity-50",children:"Import"})]})]})]})}),document.body),s&&c.jsx(kee,{current:s.current,total:s.total}),c.jsx(vee,{isOpen:le,onClose:()=>De(!1)})]})},Tee=({initialTitle:t,onSave:e,onCancel:n,onSwitchToFull:r,className:s,fontClass:i})=>{const[o,a]=b.useState(t),l=b.useRef(null);b.useEffect(()=>{const d=setTimeout(()=>{if(l.current){l.current.focus();const f=l.current.value.length;l.current.setSelectionRange(f,f)}},50);return()=>clearTimeout(d)},[]);const u=d=>{d.stopPropagation(),d.key==="Enter"&&(d.preventDefault(),d.metaKey||d.ctrlKey?r(o):e(o)),d.key==="Escape"&&(d.preventDefault(),n())};return c.jsx("input",{ref:l,autoFocus:!0,value:o,onChange:d=>a(d.target.value),onBlur:()=>e(o),onKeyDown:u,onClick:d=>d.stopPropagation(),className:`bg-transparent outline-none border-none p-0 m-0 w-full text-gray-900 dark:text-gray-100 caret-gray-900 dark:caret-gray-100 font-normal ${i}`})},ml=({flatTask:t,isFocused:e,onEdit:n,onSelect:r,backgroundColor:s})=>{const{updateTask:i,setFocusedTaskId:o,editingTaskId:a,setEditingTaskId:l,inlineEditingTaskId:u,setInlineEditingTaskId:d,addTask:f,toggleExpansion:h,startDrag:p,keyboardMove:m,tasks:y,tags:x,dragState:g,navigateBack:v,view:w,canNavigateBack:T,smartReschedule:D,lockTask:k,unlockTask:I,verifyTaskPassword:C,temporarilyUnlockTask:S,selectedTaskIds:_,handleSelection:N,themeSettings:j,pendingFocusTaskId:O,setPendingFocusTaskId:P,setSelectedTaskIds:W,visibleTasks:R,t:M,language:X,batchDeleteTasks:Q,batchUpdateTasks:A,setToast:Te,tagFilter:we}=b.useContext(Tn),{recordingTaskId:B}=b.useContext(Du),F=t.data,ne=b.useRef(null),We=b.useRef(null),ft=b.useRef(null),[le,De]=b.useState(!1),[ie,Fe]=b.useState(null),_e=typeof window<"u"&&window.innerWidth<768,[tt,Xe]=b.useState(!1),[Ve,it]=b.useState("lock"),[Ue,K]=b.useState(""),[ue,re]=b.useState(null),oe=t.isExpanded,pe=t.hasChildren,se=!!F.completed_at&&(F.status==="completed"||F.status==="logged"),Se=F.status==="canceled",Pe=se||Se,ye=_.includes(F.id),ze=!!F.is_locked;ze&&F.lock_password;const Ze=ze&&!F.lock_password,gt=Ee=>{if(!Ee)return null;switch(Ee){case"urgent":return"red";case"planned":return"amber";case"delegated":return"green";case"unplanned":return"gray";default:return null}},vt=Ee=>{const Tt=gt(Ee.importance);if(Tt)return Tt;let Ft=Ee;const Lt=new Set;for(;Ft.parent_id&&!Lt.has(Ft.id);){Lt.add(Ft.id);const Wt=y.find(un=>un.id===Ft.parent_id);if(!Wt)break;Ft=Wt}return Ft.color||"blue"},me=!1;b.useEffect(()=>{e&&ne.current&&ne.current.focus({preventScroll:!0})},[e]),b.useEffect(()=>{O===F.id&&(P(null),o(F.id),setTimeout(()=>{d(F.id)},50))},[O,F.id,P,o,d]);const He=Ee=>{Ee?F.status===Ee?i(F.id,{status:"active",completed_at:null}):i(F.id,{status:Ee,completed_at:new Date().toISOString()}):se||Se?i(F.id,{status:"active",completed_at:null}):i(F.id,{status:"completed",completed_at:new Date().toISOString()})},qe=Ee=>Ee.start_date?new Date(Ee.start_date).toISOString().split("T")[0]:Ee.due_date?new Date(Ee.due_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],nt=Ee=>{if(w!=="today")return!1;const Ft=(_.includes(F.id)?_:[F.id]).map(Lt=>R.findIndex(Wt=>Wt.data.id===Lt)).filter(Lt=>Lt!==-1).sort((Lt,Wt)=>Lt-Wt);if(Ft.length===0)return!1;if(Ee==="up"){const Lt=Ft[0];if(Lt===0)return!0;const Wt=R[Lt].data,un=R[Lt-1].data;return qe(un)!==qe(Wt)}else{const Lt=Ft[Ft.length-1];if(Lt===R.length-1)return!0;const Wt=R[Lt].data,un=R[Lt+1].data;return qe(un)!==qe(Wt)}},Me=Ee=>{const Tt=_.includes(F.id)?_:[F.id],Ft=Tt.map(yn=>y.find(Er=>Er.id===yn)).filter(yn=>yn!==void 0).sort((yn,Er)=>{var Nn,Or;const Pn=((Nn=yn.view_orders)==null?void 0:Nn.today)??0,Jn=((Or=Er.view_orders)==null?void 0:Or.today)??0;return Pn-Jn});if(Ft.length===0)return;const Lt=Ft[0],Wt=Lt.start_date?new Date(Lt.start_date):new Date,un=new Date(Wt);un.setDate(un.getDate()+(Ee==="up"?-1:1));const rr=un.toISOString().split("T")[0],ys=y.filter(yn=>{var Pn,Jn;return(((Pn=yn.start_date)==null?void 0:Pn.split("T")[0])||((Jn=yn.due_date)==null?void 0:Jn.split("T")[0]))===rr&&!Tt.includes(yn.id)}).sort((yn,Er)=>{var Nn,Or;const Pn=((Nn=yn.view_orders)==null?void 0:Nn.today)??0,Jn=((Or=Er.view_orders)==null?void 0:Or.today)??0;return Pn-Jn});let wn;Ee==="up"?wn=ys.reduce((Er,Pn)=>{var Jn;return Math.max(Er,((Jn=Pn.view_orders)==null?void 0:Jn.today)??0)},0)+1e4:wn=ys.reduce((Er,Pn)=>{var Jn;return Math.min(Er,((Jn=Pn.view_orders)==null?void 0:Jn.today)??9e8)},9e8)-(Ft.length+1)*1e4,A(Ft.map((yn,Er)=>({id:yn.id,data:{start_date:rr,is_all_day:!0,view_orders:{...yn.view_orders||{},today:wn+Er*1e4}}})))},ut=Ee=>{if(Ee.altKey&&!Ee.ctrlKey&&!Ee.metaKey){if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(Ee.key)&&(Ee.preventDefault(),Ee.stopPropagation()),w==="focus"||w==="recent"||me||w==="allview"&&F.status==="logged")return;if(w==="today"){if(Ee.key==="ArrowUp"){if(nt("up")){Me("up");return}m(F.id,"up");return}if(Ee.key==="ArrowDown"){if(nt("down")){Me("down");return}m(F.id,"down");return}if(Ee.key==="ArrowRight"){m(F.id,"right");return}if(Ee.key==="ArrowLeft"){T?v():m(F.id,"left");return}}if(w==="upcoming"){if(Ee.key==="ArrowUp"){m(F.id,"up");return}if(Ee.key==="ArrowDown"){m(F.id,"down");return}return}if(Ee.key==="ArrowUp"){m(F.id,"up");return}if(Ee.key==="ArrowDown"){m(F.id,"down");return}if(Ee.key==="ArrowRight"){m(F.id,"right");return}if(Ee.key==="ArrowLeft"){T?v():m(F.id,"left");return}}if(Ee.key==="Tab"){if(Ee.preventDefault(),Ee.stopPropagation(),w==="focus"||w==="upcoming"||me||w==="allview"&&F.status==="logged")return;if(Ee.shiftKey){if(t.depth===0&&we){const Tt=document.querySelector(`[data-tag-id="${we}"]`);if(Tt){Tt.focus(),o(null),W([]);return}}T?v():m(F.id,"left")}else m(F.id,"right");return}if(Ee.key==="Delete"||Ee.key==="Backspace"&&!Ee.target.matches("input, textarea")){Ee.preventDefault(),Ee.stopPropagation();const Tt=_.includes(F.id)?_:[F.id],Ft=R.findIndex(Wt=>Wt.data.id===F.id);let Lt=null;for(let Wt=Ft+1;Wt<R.length;Wt++)if(!Tt.includes(R[Wt].data.id)){Lt=R[Wt];break}if(!Lt){for(let Wt=Ft-1;Wt>=0;Wt--)if(!Tt.includes(R[Wt].data.id)){Lt=R[Wt];break}}Q(Tt,w==="trash"),Lt&&(o(Lt.data.id),W([Lt.data.id]));return}if((Ee.ctrlKey||Ee.metaKey)&&Ee.key==="."){Ee.preventDefault(),Ee.stopPropagation(),Ee.shiftKey?He("canceled"):He("completed");return}if(Ee.key==="Enter"&&(Ee.preventDefault(),Ee.stopPropagation(),ze?(K(""),it("verify"),Ee.metaKey||Ee.ctrlKey?re(()=>()=>n()):re(()=>()=>d(F.id)),Xe(!0)):Ee.metaKey||Ee.ctrlKey?n():d(F.id)),Ee.key===" "&&(w==="inbox"||w==="today"||w==="schedule"||w==="waiting"||w==="focus")){Ee.preventDefault(),Ee.stopPropagation();const Tt=R.findIndex(wn=>wn.data.id===F.id),Ft=wn=>wn.view_orders&&wn.view_orders[w]!==void 0?wn.view_orders[w]:w==="today"?9e8+new Date(wn.created_at).getTime()/1e3:wn.order_index||0,Lt=Ft(F),Wt=w==="today"?null:F.parent_id;let un=null;for(let wn=Tt+1;wn<R.length;wn++){const yn=R[wn];if(w==="today"){un=Ft(yn.data);break}else{if(yn.depth<=t.depth&&yn.data.parent_id!==Wt)break;if(yn.data.parent_id===Wt){un=Ft(yn.data);break}}}let rr=Lt+1e4;un!==null&&(rr=(Lt+un)/2);const ys={title:"",status:w==="waiting"?"someday":"inbox",parent_id:Wt,order_index:rr,view_orders:{[w]:rr}};if(w==="today"){const wn=qe(F);ys.start_date=wn,ys.status="active",ys.is_all_day=!0}else if(w==="waiting"){const wn=x.find(yn=>yn.name.toLowerCase()==="someday");wn&&(ys.tags=[wn.id])}f(ys,[],void 0).then(wn=>{wn&&(P(wn),W([]))})}if(Ee.ctrlKey){if(Ee.key==="t"&&(Ee.preventDefault(),Ee.stopPropagation(),i(F.id,{start_date:new Date().toISOString(),is_all_day:!0})),Ee.key==="]"){Ee.preventDefault(),Ee.stopPropagation();const Tt=F.start_date?new Date(F.start_date):new Date;Tt.setDate(Tt.getDate()+1),i(F.id,{start_date:Tt.toISOString(),is_all_day:!0})}if(Ee.key==="["){Ee.preventDefault(),Ee.stopPropagation();const Tt=F.start_date?new Date(F.start_date):new Date;Tt.setDate(Tt.getDate()-1),i(F.id,{start_date:Tt.toISOString(),is_all_day:!0})}}Ee.altKey&&(Ee.metaKey||Ee.ctrlKey)&&Ee.key==="r"&&(Ee.preventDefault(),Ee.stopPropagation(),D(F.id)),!Ee.altKey&&!Ee.ctrlKey&&!Ee.metaKey&&Ee.key!==" "&&(Ee.key==="ArrowRight"&&(Ee.preventDefault(),pe&&!oe&&h(F.id,!0)),Ee.key==="ArrowLeft"&&(Ee.preventDefault(),oe?h(F.id,!1):F.parent_id&&o(F.parent_id)))},ee=w==="focus",fe=w!=="focus"&&(g.draggedId===F.id||g.isDragging&&ye),et=`group relative ${ee?"mb-0":"mb-1 md:mb-0.5"} rounded-lg outline-none select-none cursor-default ${ee?"py-0.5":"py-2 md:py-1.5"} ${ye?"bg-theme-selection":""} ${!ye&&!fe&&(e&&!ye&&!fe?"bg-theme-hover":"")} ${Pe&&w!=="logbook"&&w!=="trash"?"bg-emerald-50/30":Pe?"opacity-60 grayscale":""} ${fe?"opacity-40 scale-[0.98] blur-[0.5px] transition-all duration-200":"opacity-100 scale-100 transition-all duration-200"} transition-all duration-200 ease-in-out hover-effect active:bg-theme-hover touch-manipulation`,G=()=>{const Ee=[];if(F.repeat_rule&&Ee.push(c.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-50 text-purple-600 flex items-center gap-0.5",title:F.repeat_rule.originalText||"",children:c.jsx(RI,{size:10})},"repeat")),F.start_date){const Tt=_w(F.start_date),Ft=Xx(F.start_date)&&!Pe;let Lt="bg-theme-hover text-theme-secondary";Tt?Lt="bg-yellow-50 text-yellow-600 font-medium":Ft&&(Lt="bg-red-50 text-red-600 font-medium"),Ee.push(c.jsxs("span",{className:`text-[10px] px-1.5 py-0.5 rounded border border-transparent ${Lt} flex items-center gap-1`,children:[c.jsx(Go,{size:10})," ",mI(F.start_date,!F.is_all_day,X)]},"date"))}return Ee.length===0?null:c.jsx(c.Fragment,{children:Ee})},ae=ee||j.fontWeight==="thin"?"font-extralight":"font-semibold",Ae={small:"text-sm",normal:"text-base",large:"text-lg"}[j.fontSize]||"text-base",Ie=(()=>{if(w!=="focus"&&w!=="today"||!F.parent_id)return null;const Ee=[];let Tt=y.find(Wt=>Wt.id===F.parent_id),Ft="blue";const Lt=new Set;for(;Tt&&!Lt.has(Tt.id);)Lt.add(Tt.id),Ee.unshift({title:Tt.title||"Untitled"}),Tt.parent_id||(Ft=Tt.color||"blue"),Tt=y.find(Wt=>Wt.id===Tt.parent_id);return Ee.length===0?null:{items:Ee,rootColor:Ft}})(),Le=ee?"text-[10px]":Ae,ct=ee?12:14,Rt=ee?12:16,Cn=ee?"text-[8px]":"text-[10px]",Ot=b.useCallback(Ee=>{if(!_e)return;const Tt=Ee.touches[0];We.current={x:Tt.clientX,y:Tt.clientY,time:Date.now()},ft.current=setTimeout(()=>{De(!0),navigator.vibrate&&navigator.vibrate(50)},500)},[_e]),nn=b.useCallback(Ee=>{if(!We.current)return;const Tt=Ee.touches[0],Ft=Math.abs(Tt.clientX-We.current.x),Lt=Math.abs(Tt.clientY-We.current.y);(Ft>10||Lt>10)&&ft.current&&(clearTimeout(ft.current),ft.current=null)},[]),cn=b.useCallback(()=>{ft.current&&(clearTimeout(ft.current),ft.current=null),De(!1),We.current=null},[]);return c.jsxs(Rr.div,{layout:!0,transition:{layout:{duration:.2,ease:"easeInOut"}},ref:ne,"data-task-id":F.id,"data-task-index":t.index,draggable:!_e&&w!=="schedule"&&w!=="focus"&&!me&&!(w==="allview"&&F.status==="logged"),onDragStart:Ee=>{if(w==="focus"||me||w==="allview"&&F.status==="logged"){Ee.preventDefault();return}p(Ee,t)},className:`${et} ${le?"scale-[1.02] shadow-lg z-50":""}`,style:{marginLeft:`${w==="today"?0:t.depth*hp}px`,backgroundColor:s||"transparent"},tabIndex:0,onKeyDown:ut,onClick:Ee=>{Ee.stopPropagation(),Ee.preventDefault(),_e?a||(ze?(K(""),it("verify"),re(()=>()=>setTimeout(()=>l(F.id),50)),Xe(!0)):setTimeout(()=>l(F.id),50)):(r||N)(Ee,F.id)},onDoubleClick:Ee=>{Ee.stopPropagation(),_e||(ze?(K(""),it("verify"),re(()=>()=>n()),Xe(!0)):n())},onTouchStart:Ot,onTouchMove:nn,onTouchEnd:cn,children:[c.jsx("div",{className:`flex flex-col ${ee?"px-1":"px-3"}`,children:c.jsxs("div",{className:"flex items-center gap-3",children:[w==="recent"&&c.jsx("span",{className:"text-[10px] text-gray-300 font-light w-14 flex-shrink-0 tabular-nums",children:F.updated_at?new Date(F.updated_at).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"}):""}),w==="trash"?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-[18px] flex justify-center",children:c.jsx(Mr,{size:14,className:"text-gray-300"})}),c.jsx("span",{className:"flex-1 text-gray-400 line-through truncate select-text",children:F.title}),c.jsx("button",{onClick:Ee=>{Ee.stopPropagation();const Tt=_.includes(F.id)?_:[F.id];A(Tt.map(Ft=>({id:Ft,data:{status:"inbox"}}))),Te({msg:" Inbox",type:"info"})},className:"px-2 py-1 bg-white border border-gray-200 text-indigo-600 text-[10px] font-medium rounded hover:bg-indigo-50 hover:border-indigo-200 transition-colors shadow-sm whitespace-nowrap",children:M("putBack")})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex items-center gap-1",children:[pe&&w!=="today"?c.jsx("button",{onClick:Ee=>{Ee.stopPropagation(),h(F.id)},className:"text-slate-400 hover:text-slate-800 transition-transform",children:oe?c.jsx(es,{size:ct}):c.jsx(ns,{size:ct})}):c.jsx("div",{className:`${ee?"w-[12px]":"w-[16px]"}`}),c.jsx(wM,{checked:se,isCanceled:Se,onChange:Ee=>{Ee.stopPropagation(),Ee.altKey?He("canceled"):He()},color:vt(F),isRoot:!F.parent_id,size:ee?14:18})]}),c.jsxs("div",{className:"flex-1 min-w-0 cursor-text flex items-center overflow-hidden relative min-h-[1.5em]",children:[ze&&c.jsx(Aa,{size:12,className:"text-amber-500 mr-1.5 flex-shrink-0"}),B===F.id&&c.jsx("div",{className:"mr-2 flex-shrink-0 w-2 h-2 rounded-full bg-red-500 animate-pulse shadow-[0_0_6px_rgba(239,68,68,0.6)]",title:"Recording..."}),c.jsx("span",{className:`${Le} ${ae} transition-all duration-300 ${Pe?"opacity-30":"text-theme-primary"} ${Se?"line-through decoration-gray-400":""} mr-2 truncate block flex-shrink ${u===F.id?"opacity-0":""} ${Ze?"blur-[4px] select-none":""}`,children:F.title}),u===F.id&&c.jsx("div",{className:"absolute inset-0 bg-white dark:bg-gray-800 z-50 flex items-center pr-2",children:c.jsx(Tee,{initialTitle:F.title,className:`${Le} ${ae}`,fontClass:"",onSave:Ee=>{Ee!==F.title&&i(F.id,{title:Ee}),d(null),ne.current&&ne.current.focus()},onCancel:()=>{d(null),ne.current&&ne.current.focus()},onSwitchToFull:async Ee=>{await i(F.id,{title:Ee}),d(null),n()}})}),Ie&&c.jsx("div",{className:"flex items-center gap-0.5 mr-2 flex-shrink-0",children:Ie.items.map((Ee,Tt)=>{var Ft,Lt;return c.jsxs(Dn.Fragment,{children:[Tt>0&&c.jsx(ns,{size:10,className:"text-gray-300 flex-shrink-0",strokeWidth:1.5}),c.jsx("span",{className:`${ee?"text-[8px]":"text-[9px]"} font-semibold px-1.5 py-[1px] rounded transition-colors duration-200 truncate max-w-[150px]`,style:{backgroundColor:(((Ft=Kn[Ie.rootColor])==null?void 0:Ft.color)||"#6366f1")+"15",color:((Lt=Kn[Ie.rootColor])==null?void 0:Lt.color)||"#6366f1"},title:Ee.title,children:Ee.title})]},Tt)})}),(F.tags||[]).length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"hidden md:flex items-center gap-1 mr-2 flex-shrink-0",children:(F.tags||[]).map(Ee=>{var Lt;const Tt=(Lt=x.find(Wt=>Wt.id===Ee))==null?void 0:Lt.name;if(!Tt)return null;const Ft=Tt.startsWith("#");return c.jsx("div",{className:"relative flex-shrink-0",children:c.jsx("span",{className:`${Cn} border rounded-md px-1.5 py-px whitespace-nowrap ${Ft?"bg-emerald-50 text-emerald-700 border-emerald-200":`border-theme ${se?"text-theme-tertiary bg-theme-hover":"text-theme-secondary bg-theme-hover"}`}`,children:Tt})},Ee)})}),c.jsxs("div",{className:"md:hidden flex items-center mr-2 text-slate-400 flex-shrink-0",children:[c.jsx(Pl,{size:Rt}),(F.tags||[]).length>1&&c.jsx("span",{className:`${ee?"text-[8px]":"text-[9px]"} ml-0.5`,children:(F.tags||[]).length})]})]}),F.description&&c.jsx(Gf,{size:12,className:"text-slate-400 mr-2 flex-shrink-0"}),F.attachments&&F.attachments.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"mr-2 flex-shrink-0 cursor-pointer",onMouseEnter:Ee=>{const Tt=Ee.currentTarget.getBoundingClientRect();Fe({visible:!0,x:Tt.left+Tt.width/2,y:Tt.top-8,attachments:F.attachments||[]})},onMouseLeave:()=>Fe(null),children:c.jsx(co,{size:12,className:"text-slate-400"})}),(ie==null?void 0:ie.visible)&&ie.attachments===F.attachments&&tr.createPortal(c.jsx("div",{className:"fixed z-[99999] pointer-events-none",style:{left:ie.x,top:ie.y,transform:"translate(-50%, -100%)"},children:c.jsxs("div",{className:"bg-gray-800 text-white text-[10px] px-2.5 py-2 rounded-lg shadow-2xl max-w-[220px]",children:[c.jsxs("div",{className:"font-semibold mb-1 text-[11px]",children:[F.attachments.length," "]}),F.attachments.slice(0,5).map((Ee,Tt)=>c.jsx("div",{className:"truncate opacity-80 py-0.5",children:Ee.name},Tt)),F.attachments.length>5&&c.jsxs("div",{className:"opacity-60 pt-1",children:["... ",F.attachments.length-5," "]})]})}),document.body)]}),c.jsxs("div",{className:`ml-auto ${Pe?"opacity-50":"opacity-100"} flex-shrink-0`,children:[" ",G()," "]})]}),c.jsxs("div",{className:"opacity-100 md:opacity-0 md:group-hover:opacity-100 flex items-center gap-1 pl-2",children:[c.jsx("button",{onClick:Ee=>{Ee.stopPropagation(),K(""),it(ze?"unlock":"lock"),Xe(!0)},className:`p-1 transition-colors ${ze?"text-amber-500 hover:text-amber-600":"text-slate-300 hover:text-amber-500"}`,title:ze?"":"",children:ze?c.jsx(r1,{size:Rt}):c.jsx(Aa,{size:Rt})}),c.jsx("button",{onClick:Ee=>{Ee.stopPropagation();const Tt=_.includes(F.id)?_:[F.id];Q(Tt,w==="trash")},className:"p-1 hover:text-red-500 text-slate-300 transition-colors",children:c.jsx(Mr,{size:Rt})})]})]})]})}),tt&&tr.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999]",onClick:()=>{Xe(!1),re(null)},children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-80 max-w-[90vw]",onClick:Ee=>Ee.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[Ve==="lock"?c.jsx(Aa,{size:20,className:"text-amber-500"}):c.jsx(r1,{size:20,className:"text-emerald-500"}),c.jsx("h3",{className:"text-lg font-bold",children:Ve==="lock"?"":Ve==="verify"?"":""})]}),c.jsx("p",{className:"text-sm text-gray-500 mb-4",children:Ve==="lock"?"":Ve==="verify"?"":""}),c.jsx("input",{type:"password",placeholder:"",value:Ue,onChange:Ee=>K(Ee.target.value),onKeyDown:Ee=>{Ee.key==="Enter"&&(Ve==="lock"?Ue.length>=1&&(k(F.id,Ue),Xe(!1)):Ve==="verify"?C(F.id,Ue)?(S(F.id),Xe(!1),ue&&ue(),re(null)):Te({msg:"",type:"error"}):I(F.id,Ue).then(Tt=>{Tt&&Xe(!1)})),Ee.key==="Escape"&&(Xe(!1),re(null))},autoFocus:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-amber-500"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:()=>{Xe(!1),re(null)},className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:""}),c.jsx("button",{onClick:()=>{Ve==="lock"?Ue.length>=1&&(k(F.id,Ue),Xe(!1)):Ve==="verify"?C(F.id,Ue)?(S(F.id),Xe(!1),ue&&ue(),re(null)):Te({msg:"",type:"error"}):I(F.id,Ue).then(Ee=>{Ee&&Xe(!1)})},className:`flex-1 px-4 py-2 rounded-lg transition-colors ${Ve==="lock"?"bg-amber-500 text-white hover:bg-amber-600":"bg-emerald-500 text-white hover:bg-emerald-600"}`,children:Ve==="lock"?"":Ve==="verify"?"":""})]})]})}),document.body)]})},Cee=({show:t,top:e,left:n,width:r,color:s})=>{if(!t)return null;const i=Kn[s]||Kn.blue;return c.jsx("div",{className:"absolute pointer-events-none z-10 transition-all duration-100 ease-out",style:{top:`${e}px`,left:`${n}px`,width:`${r}px`},children:c.jsx("div",{className:`h-0.5 ${i.indicator} rounded-full shadow-sm relative`,children:c.jsx("div",{className:`absolute -left-1.5 -top-[3px] w-2 h-2 ${i.indicator} rounded-full shadow-md`})})})},Eee={red:"#ef4444",orange:"#f97316",yellow:"#eab308",green:"#22c55e",blue:"#3b82f6",purple:"#a855f7",pink:"#ec4899",gray:"#9ca3af"},Nee=({containerRef:t,tasks:e})=>{const[n,r]=b.useState([]),s=b.useRef(null),i=b.useRef(null),o=b.useCallback(()=>{if(!t.current)return;const a=t.current.getBoundingClientRect(),l=t.current.querySelectorAll("[data-task-id]"),u=new Map;l.forEach(g=>{const v=g.getAttribute("data-task-id");if(v){const w=g.getBoundingClientRect();u.set(v,{top:w.top-a.top,height:w.height})}});const d=new Map(e.map(g=>[g.data.id,g.data])),f=new Set(e.map(g=>g.data.id)),h=g=>{let v=g,w=0;const T=new Set,D=[];for(;w<50&&!T.has(v);){T.add(v);const I=d.get(v);if(!I)break;if(D.push(v),!I.parent_id||!f.has(I.parent_id))return{rootId:v,color:I.color||"gray",depth:D.length-1};v=I.parent_id,w++}const k=d.get(g);return{rootId:g,color:(k==null?void 0:k.color)||"gray",depth:0}},p=new Map;e.forEach(g=>{const v=u.get(g.data.id);if(!v)return;const w=h(g.data.id);if(!p.has(w.rootId)){const D=u.get(w.rootId);p.set(w.rootId,{rootId:w.rootId,color:Eee[w.color]||w.color,rootTop:(D==null?void 0:D.top)||v.top,rootHeight:(D==null?void 0:D.height)||v.height,minTop:v.top,maxBottom:v.top+v.height,tasks:[],offsetX:0})}const T=p.get(w.rootId);T.minTop=Math.min(T.minTop,v.top),T.maxBottom=Math.max(T.maxBottom,v.top+v.height),w.depth>0&&T.tasks.push({taskId:g.data.id,rootId:w.rootId,rootColor:T.color,depth:w.depth,top:v.top,height:v.height})});const m=Array.from(p.values()).filter(g=>g.tasks.length>0);m.sort((g,v)=>g.rootTop-v.rootTop);const y=8,x=8;m.forEach((g,v)=>{g.offsetX=y+v*x}),r(m)},[t,e]);return b.useEffect(()=>{o();const a=t.current;a&&a.addEventListener("scroll",o),i.current=new ResizeObserver(o),a&&i.current.observe(a),window.addEventListener("resize",o);const l=setInterval(o,100);return()=>{a&&a.removeEventListener("scroll",o),i.current&&i.current.disconnect(),window.removeEventListener("resize",o),clearInterval(l)}},[o]),b.useEffect(()=>{const a=setTimeout(o,50);return()=>clearTimeout(a)},[e,o]),n.length===0?null:c.jsxs("svg",{ref:s,className:"absolute top-0 left-0 w-full h-full pointer-events-none z-10",style:{overflow:"visible"},children:[c.jsx("defs",{children:c.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[c.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),c.jsxs("feMerge",{children:[c.jsx("feMergeNode",{in:"coloredBlur"}),c.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),n.map((a,l)=>{const u=a.offsetX,d=a.rootTop+a.rootHeight/2,f=a.maxBottom-6;return c.jsxs("g",{children:[c.jsx("path",{d:`M ${u} ${d} L ${u} ${f}`,fill:"none",stroke:a.color,strokeWidth:"2",strokeOpacity:"0.3",strokeLinecap:"round"}),c.jsx("circle",{cx:u,cy:d,r:"4",fill:a.color,opacity:"0.9",filter:"url(#glow)"}),a.tasks.map((h,p)=>c.jsx("rect",{x:u-1.5,y:h.top+8,width:3,height:h.height-16,rx:1.5,ry:1.5,fill:h.rootColor,opacity:.6-(h.depth-1)*.1},`bar-${p}`))]},`group-${l}`)})]})},aE={"zh-TW":["","","","","","",""],en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},lE={"zh-TW":["1","2","3","4","5","6","7","8","9","10","11","12"],en:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},jee=({date:t,isToday:e,isTomorrow:n,taskCount:r,language:s="zh-TW"})=>{var p,m;const i=new Date(t+"T12:00:00"),o=i.getDate(),a=((p=lE[s])==null?void 0:p[i.getMonth()])||lE.en[i.getMonth()],l=((m=aE[s])==null?void 0:m[i.getDay()])||aE.en[i.getDay()],u=i.getDay()===0||i.getDay()===6;let d="",f="";e?(d=s==="zh-TW"?"":"Today",f=`${a}${o}`):n?(d=s==="zh-TW"?"":"Tomorrow",f=`${a}${o}`):(d=`${a}${o}`,f=l);const h=()=>e?"text-blue-600":n?"text-orange-500":u?"text-purple-500":"text-gray-500";return c.jsxs("div",{className:"flex items-center gap-3 pt-6 pb-2 px-1 select-none","data-date-separator":t,children:[c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsx("span",{className:`text-[13px] font-semibold ${h()}`,children:d}),f&&c.jsx("span",{className:"text-[11px] text-gray-400 font-normal",children:f})]}),c.jsx("div",{className:"flex-1 h-[1px] bg-gray-200"}),r>0&&c.jsx("span",{className:"text-[10px] text-gray-400 tabular-nums",children:r})]})},Iee=(t,e)=>{const n=[];for(let r=0;r<e;r++){const s=new Date(t);s.setDate(s.getDate()+r);const i=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),a=String(s.getDate()).padStart(2,"0");n.push(`${i}-${o}-${a}`)}return n},Dee=t=>{const e=new Date,n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=`${n}-${r}-${s}`;return t===i},Mee=t=>{const e=new Date;e.setDate(e.getDate()+1);const n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=`${n}-${r}-${s}`;return t===i},bR=({rootParentId:t})=>{const{visibleTasks:e,focusedTaskId:n,setFocusedTaskId:r,editingTaskId:s,setEditingTaskId:i,expandedTaskIds:o,endDrag:a,dragState:l,updateDropState:u,updateGhostPosition:d,selectedTaskIds:f,setSelectedTaskIds:h,handleSelection:p,selectionAnchor:m,tasks:y,tags:x,pendingFocusTaskId:g,setPendingFocusTaskId:v,view:w,addTask:T,reviewTask:D,emptyTrash:k,restoreTrash:I,t:C,archivedTasks:S,restoreArchivedTask:_,deleteArchivedTask:N,updateArchivedTask:j,batchDeleteArchivedTasks:O,batchDeleteTasks:P,batchUpdateTasks:W,duplicateTasks:R,leavingTaskIds:M,dismissLeavingTasks:X,themeSettings:Q}=b.useContext(Tn),A=b.useRef(null),Te=b.useRef(null),we=b.useRef(null),[B,F]=b.useState(new Date);b.useEffect(()=>{const q=()=>{const ge=new Date;ge.getDate()!==B.getDate()&&F(ge)},Z=setInterval(q,6e4);return window.addEventListener("focus",q),()=>{clearInterval(Z),window.removeEventListener("focus",q)}},[B]);const ne=b.useRef(null),[We,ft]=b.useState("none"),le=b.useMemo(()=>{if(!t)return e;const q=be=>{const ve=w==="allview"||w==="project"?"all":w;return be.view_orders&&be.view_orders[ve]!==void 0?be.view_orders[ve]:be.order_index||0},Z=y.filter(be=>be.parent_id===t&&be.status!=="deleted"&&be.status!=="logged").sort((be,ve)=>q(be)-q(ve)||(be.created_at||"").localeCompare(ve.created_at||""));let ge=0;const xe=(be,ve=0,ot=[])=>{let et=[];return be.forEach(G=>{const ae=y.filter(Le=>Le.parent_id===G.id&&Le.status!=="logged"&&Le.status!=="deleted").sort((Le,ct)=>q(Le)-q(ct)||(Le.created_at||"").localeCompare(ct.created_at||"")),Ae=ae.length>0,Y=o.includes(G.id),Ie=[...ot,G.id];et.push({data:G,depth:ve,hasChildren:Ae,isExpanded:Y,path:Ie,index:ge++}),Ae&&Y&&(et=[...et,...xe(ae,ve+1,Ie)])}),et};return xe(Z)},[e,t,y,o,w]);let De=t?le:e;const ie=b.useMemo(()=>{if(We==="none"||De.length===0)return null;let q=Date.now(),Z=0;return De.forEach(ge=>{const xe=ge.data.updated_at?new Date(ge.data.updated_at).getTime():0;xe>0&&(xe<q&&(q=xe),xe>Z&&(Z=xe))}),Z===q&&(Z=q+1),{minTime:q,maxTime:Z}},[We,De]),Fe=q=>{if(!ie||We==="none")return;const Z=q.updated_at?new Date(q.updated_at).getTime():0;if(Z===0)return;const ge=(Z-ie.minTime)/(ie.maxTime-ie.minTime),xe=Math.max(0,Math.min(1,ge));return We==="recent"?`rgba(255, 0, 0, ${.02+xe*.18})`:`rgba(250, 204, 21, ${.02+xe*.18})`},_e=b.useRef(null),tt=b.useCallback((q,Z)=>{r(Z);const ge=q.shiftKey||q.shiftKey,xe=q.ctrlKey||q.metaKey;if(ge){const be=_e.current||n||Z;_e.current=be;const ve=De.findIndex(et=>et.data.id===be),ot=De.findIndex(et=>et.data.id===Z);if(ve!==-1&&ot!==-1){const[et,G]=ve<ot?[ve,ot]:[ot,ve],ae=De.slice(et,G+1).map(Ae=>Ae.data.id);h(ae)}}else xe?(_e.current=Z,h(be=>be.includes(Z)?be.filter(ve=>ve!==Z):[...be,Z])):(_e.current=Z,h([Z]))},[De,n,r,h]),Xe=w==="upcoming"?tt:p;b.useEffect(()=>{const q=Z=>{var be;if(s)return;const ge=document.activeElement;if((ge==null?void 0:ge.tagName)==="INPUT"||(ge==null?void 0:ge.tagName)==="TEXTAREA"||ge!=null&&ge.isContentEditable||ge!=null&&ge.closest("[data-tag-id]")||document.querySelector("[data-search-modal]"))return;if((Z.metaKey||Z.ctrlKey)&&(Z.key==="a"||Z.key==="A")){Z.preventDefault();const ve=De.map(ot=>ot.data.id);h(ve);return}if((Z.metaKey||Z.ctrlKey)&&(Z.key==="t"||Z.key==="T")){Z.preventDefault();const ve=f.length>0?f:n?[n]:[];if(ve.length>0){const ot=new Date().toISOString().split("T")[0];W(ve.map(et=>({id:et,data:{start_date:ot,status:"active"}})))}return}if((Z.metaKey||Z.ctrlKey)&&(Z.key==="d"||Z.key==="D")){Z.preventDefault();const ve=f.length>0?f:n?[n]:[];ve.length>0&&R(ve);return}const xe=De.findIndex(ve=>ve.data.id===n);if(Z.metaKey||Z.ctrlKey){if(Z.key==="ArrowUp"){if(Z.preventDefault(),De.length>0){const ve=De[0];r(ve.data.id),Xe({shiftKey:!1,ctrlKey:!1},ve.data.id)}return}if(Z.key==="ArrowDown"){if(Z.preventDefault(),De.length>0){const ve=De[De.length-1];r(ve.data.id),Xe({shiftKey:!1,ctrlKey:!1},ve.data.id)}return}}if(Z.shiftKey&&(Z.key==="ArrowDown"||Z.key==="ArrowUp")){Z.preventDefault();let ve=xe;Z.key==="ArrowDown"&&(ve=Math.min(xe+1,De.length-1)),Z.key==="ArrowUp"&&(ve=Math.max(xe-1,0));const ot=De[ve];ot&&(r(ot.data.id),Xe({shiftKey:!0,preventDefault:()=>{}},ot.data.id));return}if(Z.key==="ArrowDown"&&!Z.altKey){Z.preventDefault();const ve=xe+1;if(ve<De.length){const ot=De[ve];r(ot.data.id),Xe({shiftKey:!1,ctrlKey:!1},ot.data.id)}}else if(Z.key==="ArrowUp"&&!Z.altKey){Z.preventDefault();const ve=xe-1;if(ve>=0){const ot=De[ve];r(ot.data.id),Xe({shiftKey:!1,ctrlKey:!1},ot.data.id)}}else if(Z.key==="Enter")xe!==-1&&!s&&!Z.altKey&&w!=="trash"&&(Z.preventDefault(),i(De[xe].data.id));else if(Z.key===" "&&!s&&w!=="trash")if(Z.preventDefault(),xe!==-1){ne.current=n;const ve=De[xe],ot=ve.data.parent_id,et=Le=>Le.view_orders&&Le.view_orders[w]!==void 0?Le.view_orders[w]:w==="today"?9e8+new Date(Le.created_at).getTime()/1e3:Le.order_index||0,G=et(ve.data);let ae=null;for(let Le=xe+1;Le<De.length;Le++){const ct=De[Le];if(ct.depth<=ve.depth&&ct.data.parent_id!==ot)break;if(ct.data.parent_id===ot){ae=et(ct.data);break}}let Ae;ae!==null?Ae=(G+ae)/2:Ae=G+1e4;const Y=x.find(Le=>Le.name.toLowerCase()==="prompt"),Ie={title:"",parent_id:ot,status:ve.data.status,tags:w==="prompt"&&Y?[Y.id]:ve.data.tags,color:ve.data.color,start_date:ve.data.start_date,order_index:Ae,view_orders:{[w]:Ae}};T(Ie).then(Le=>{v(Le),h([])})}else{const ve=new Date().toISOString().split("T")[0],ot=x.find(Le=>Le.name.toLowerCase()==="prompt"),et=x.find(Le=>Le.name.toLowerCase()==="note"),G=x.find(Le=>Le.name.toLowerCase()==="journal"),ae=x.find(Le=>Le.name.includes("")),Ae=Le=>Le.view_orders&&Le.view_orders[w]!==void 0?Le.view_orders[w]:w==="today"?9e8+new Date(Le.created_at).getTime()/1e3:Le.order_index||0;let Y=1e4;if(De.length>0){const Le=De.filter(ct=>!ct.data.parent_id);if(Le.length>0){const ct=Le[Le.length-1];Y=Ae(ct.data)+1e4}else{const ct=De[De.length-1];Y=Ae(ct.data)+1e4}}const Ie={title:"",parent_id:null,status:"inbox",tags:[],order_index:Y,view_orders:{[w]:Y}};if(w==="today")Ie.start_date=ve,Ie.status="active";else if(w==="prompt")Ie.status="active",ot&&(Ie.tags=[ot.id]);else if(w==="journal")Ie.status="active",et?Ie.tags=[et.id]:G&&(Ie.tags=[G.id]);else if(w==="waiting")Ie.status="waiting",ae&&(Ie.tags=[ae.id]);else if(w==="focus")Ie.status="active";else if(w==="upcoming"){const Le=new Date;Le.setDate(Le.getDate()+1),Ie.start_date=Le.toISOString().split("T")[0],Ie.status="active"}T(Ie).then(Le=>{v(Le),h([])})}else if((Z.key==="Delete"||Z.key==="Backspace")&&!s){if(["INPUT","TEXTAREA"].includes(((be=document.activeElement)==null?void 0:be.tagName)||""))return;const ve=f.length>0?f:n?[n]:[];ve.length>0&&(Z.preventDefault(),P(ve,w==="trash"),n&&ve.includes(n))}};return window.addEventListener("keydown",q),()=>window.removeEventListener("keydown",q)},[De,n,o,s,m,T,i,r,Xe,w,x,f,P,W,R]);const Ve=!1,it=q=>{var Tt;if(w==="focus"||w==="upcoming"||w==="recent"||(q.preventDefault(),!l.isDragging||!A.current))return;if(d(q.clientX,q.clientY),we.current){u({dropIndex:null,indicatorTop:0});return}const Z=A.current.getBoundingClientRect(),ge=q.clientX,xe=q.clientY,be=ge-Z.left,ve=100,ot=10,et=window.innerHeight,G=document.querySelector("main");G&&(xe<ve?Te.current||(Te.current=setInterval(()=>{G.scrollTop-=ot},16)):xe>et-ve?Te.current||(Te.current=setInterval(()=>{G.scrollTop+=ot},16)):Te.current&&(clearInterval(Te.current),Te.current=null));let ae=-1,Ae=null,Y=document.elementFromPoint(ge,xe);for(;Y&&Y!==A.current&&Y!==document.body;){if(Y.hasAttribute("data-task-index")){ae=parseInt(Y.getAttribute("data-task-index")||"-1"),Ae=Y.getBoundingClientRect();break}Y=Y.parentElement}if(ae===-1&&De.length>0&&A.current){const Ft=A.current.querySelector("[data-task-index]:last-child");if(Ft){const Lt=Ft.getBoundingClientRect();xe>Lt.bottom&&(ae=parseInt(Ft.getAttribute("data-task-index")||"-1")+1,Ae=Lt)}}if(ae===-1){const Ft=(Tt=A.current)==null?void 0:Tt.querySelector("[data-task-index]:first-child");if(Ft){const Lt=Ft.getBoundingClientRect();xe<Lt.top&&(ae=0,Ae=Lt)}if(ae===-1)return}let Ie=ae,Le=ae;if(Ae){const Ft=Ae.top+Ae.height/2;xe>Ft&&ae<De.length&&(Ie=ae+1)}const ct=be-l.dragOffsetX+l.originalDepth*hp;let Rt=Math.floor(ct/hp);Rt<0&&(Rt=0);const Cn=De[Ie-1],Ot=Cn?Cn.depth+1:0;Rt>Ot&&(Rt=Ot);let nn=0;Ae?Ie===ae?nn=Ae.top-Z.top:nn=Ae.bottom-Z.top:Ie===0&&(nn=0);let cn=Rt*hp+40,Ee=Z.width-cn-20;w==="today"&&(Rt=0,cn=40,Ee=Z.width-60),u({dropIndex:Ie,dropDepth:Rt,indicatorTop:nn,indicatorLeft:cn,indicatorWidth:Ee,anchorTaskIndex:Le})},Ue=()=>{Te.current&&(clearInterval(Te.current),Te.current=null),a(De)},K=q=>{const Z=q||ne.current||n;i(null),Z&&(r(Z),h([Z]),setTimeout(()=>{var xe;const ge=(xe=A.current)==null?void 0:xe.querySelector(`[data-task-id="${Z}"]`);ge&&(ge.focus(),ge.scrollIntoView({block:"nearest",behavior:"smooth"}))},100)),ne.current=null,g&&v(null)},ue=()=>{if(l.dropIndex===null||l.dropIndex===0)return"blue";const q=De[l.dropIndex-1];return(q==null?void 0:q.data.color)||"blue"},re=De,oe=b.useMemo(()=>w!=="inbox"||M.length===0?[]:M.map(q=>y.find(Z=>Z.id===q)).filter(Boolean).map((q,Z)=>({data:q,depth:0,hasChildren:!1,isExpanded:!1,path:[q.id],index:Z})),[w,M,y]),[pe,se]=b.useState(!0),Se=De,Pe=b.useMemo(()=>{if(w!=="allview"&&w!=="logbook")return[];const q=new Map(S.map(be=>[be.id,be])),Z=S.filter(be=>!be.parent_id||!q.has(be.parent_id)).sort((be,ve)=>new Date(ve.archived_at||ve.completed_at||0).getTime()-new Date(be.archived_at||be.completed_at||0).getTime()),ge=[],xe=(be,ve,ot)=>{const et=S.filter(G=>G.parent_id===be.id);ge.push({data:be,depth:ve,hasChildren:et.length>0,isExpanded:!0,path:[...ot,be.id],index:ge.length}),et.forEach(G=>xe(G,ve+1,[...ot,be.id]))};return Z.forEach(be=>xe(be,0,[])),ge},[S,w]),[ye,ze]=b.useState(null),[Ze,gt]=b.useState(""),[vt,me]=b.useState([]),He=b.useRef(null),qe=q=>{if(!q)return"";const Z=new Date(q);return`${Z.getFullYear()}-${String(Z.getMonth()+1).padStart(2,"0")}-${String(Z.getDate()).padStart(2,"0")}`},nt=q=>{if(Ze){const Z=new Date(Ze);isNaN(Z.getTime())||j(q,{completed_at:Z.toISOString()})}ze(null)},Me=(q,Z)=>{if(q.stopPropagation(),q.shiftKey&&He.current){const ge=Pe.findIndex(be=>be.data.id===He.current),xe=Pe.findIndex(be=>be.data.id===Z);if(ge!==-1&&xe!==-1){const[be,ve]=ge<xe?[ge,xe]:[xe,ge],ot=Pe.slice(be,ve+1).map(et=>et.data.id);me(ot)}}else q.metaKey||q.ctrlKey?(He.current=Z,me(ge=>ge.includes(Z)?ge.filter(xe=>xe!==Z):[...ge,Z])):(He.current=Z,me([Z]))};if(w==="logbook")return Pe.length===0?c.jsxs("div",{className:"text-center py-20 opacity-20",children:[c.jsx(e1,{size:48,className:"mx-auto"}),c.jsx("p",{className:"text-xs mt-2",children:""})]}):c.jsxs("div",{className:"pb-20 relative min-h-[500px]",onClick:()=>me([]),children:[c.jsxs("div",{className:"flex items-center gap-2 mb-6 px-2",children:[c.jsx(sm,{size:16,className:"text-gray-400"}),c.jsx("span",{className:"text-[13px] font-bold text-gray-500",children:""}),c.jsx("span",{className:"text-[11px] font-medium px-1.5 py-0.5 rounded-full bg-gray-100 text-gray-500",children:Pe.length}),c.jsx("div",{className:"flex-1 h-[2px] rounded-full bg-gradient-to-r from-gray-200 to-transparent"}),vt.length>0&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:"text-[11px] text-indigo-600 font-medium",children:[" ",vt.length," "]}),c.jsxs("button",{onClick:q=>{q.stopPropagation(),confirm(` ${vt.length} `)&&(O(vt),me([]))},className:"px-2 py-1 bg-red-50 text-red-600 text-[10px] font-medium rounded hover:bg-red-100 transition-colors flex items-center gap-1",children:[c.jsx(Mr,{size:12}),""]}),c.jsx("button",{onClick:q=>{q.stopPropagation(),me([])},className:"px-2 py-1 bg-gray-100 text-gray-600 text-[10px] font-medium rounded hover:bg-gray-200 transition-colors",children:""})]})]}),Pe.map(q=>{const Z=vt.includes(q.data.id);return c.jsx("div",{className:`relative group mb-1 py-2 px-3 rounded-lg transition-colors cursor-pointer ${Z?"bg-indigo-50 border border-indigo-200":"hover:bg-theme-hover"}`,style:{marginLeft:`${q.depth*24}px`},onClick:ge=>Me(ge,q.data.id),children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:`w-[18px] h-[18px] rounded-full border-2 flex items-center justify-center flex-shrink-0 ${Z?"border-indigo-500 bg-indigo-500":"border-emerald-500 bg-emerald-500"}`,children:c.jsx(Gn,{size:12,className:"text-white"})}),c.jsx("span",{className:"flex-1 text-theme-primary opacity-70 truncate",children:q.data.title}),c.jsxs("div",{className:"flex items-center gap-1 text-[11px] text-gray-400",children:[c.jsx(Go,{size:12}),ye===q.data.id?c.jsx("input",{type:"date",autoFocus:!0,value:Ze,onChange:ge=>gt(ge.target.value),onBlur:()=>nt(q.data.id),onKeyDown:ge=>{ge.key==="Enter"&&nt(q.data.id),ge.key==="Escape"&&ze(null)},onClick:ge=>ge.stopPropagation(),className:"bg-white border border-gray-300 rounded px-1 py-0.5 text-[11px] w-28"}):c.jsx("span",{className:"cursor-pointer hover:text-indigo-500 transition-colors",onDoubleClick:ge=>{ge.stopPropagation(),ze(q.data.id),gt(qe(q.data.completed_at))},title:"",children:qe(q.data.completed_at)||""})]}),c.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[c.jsx("button",{onClick:ge=>{ge.stopPropagation(),_(q.data.id)},className:"px-2 py-1 bg-emerald-50 text-emerald-600 text-[10px] font-medium rounded hover:bg-emerald-100 transition-colors",children:""}),c.jsx("button",{onClick:ge=>{ge.stopPropagation(),confirm("")&&N(q.data.id)},className:"p-1 text-gray-400 hover:text-red-500 transition-colors",title:"",children:c.jsx(Mr,{size:14})})]})]})},q.data.id)})]});if(De.length===0&&(w!=="allview"||Pe.length===0))return c.jsxs("div",{className:"text-center py-20 opacity-20",children:[c.jsx(e1,{size:48,className:"mx-auto"}),c.jsx("p",{className:"text-xs mt-2",children:"No tasks"})]});const ut=q=>q.start_date?new Date(q.start_date).toISOString().split("T")[0]:q.due_date?new Date(q.due_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],ee=()=>{const q=Iee(B,8),Z=new Map,ge=[],xe=[],be=B.getFullYear(),ve=String(B.getMonth()+1).padStart(2,"0"),ot=String(B.getDate()).padStart(2,"0"),et=`${be}-${ve}-${ot}`;return De.forEach(G=>{const ae=ut(G.data);ae<et?ge.push(G):q.includes(ae)?(Z.has(ae)||Z.set(ae,[]),Z.get(ae).push(G)):xe.push(G)}),c.jsxs(c.Fragment,{children:[ge.length>0&&c.jsxs("div",{"data-date-group":"overdue",children:[c.jsxs("div",{className:"flex items-center gap-3 pt-2 pb-2 px-1 select-none",children:[c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsx("span",{className:"text-[13px] font-semibold text-red-500",children:""}),c.jsxs("span",{className:"text-[11px] text-red-400 font-normal",children:[ge.length," "]})]}),c.jsx("div",{className:"flex-1 h-[1px] bg-red-200"})]}),ge.map(G=>c.jsx(Dn.Fragment,{children:s===G.data.id?c.jsx(Ro,{initialData:G.data,onClose:K},G.data.id):c.jsx("div",{className:"relative group",children:c.jsx(ml,{flatTask:G,isFocused:n===G.data.id,onEdit:()=>i(G.data.id)},G.data.id)})},G.data.id))]}),q.map(G=>{const ae=Z.get(G)||[];return c.jsxs("div",{"data-date-group":G,children:[c.jsx(jee,{date:G,isToday:Dee(G),isTomorrow:Mee(G),taskCount:ae.length}),ae.length===0?c.jsx("div",{className:"h-12 mx-2 mb-2 border-2 border-dashed border-gray-200 rounded-lg flex items-center justify-center text-gray-300 text-xs transition-all hover:border-gray-300 hover:bg-gray-50","data-empty-drop-zone":G,onDragEnter:Ae=>{Ae.preventDefault(),we.current=G,Ae.currentTarget.classList.add("border-blue-400","bg-blue-50","text-blue-400")},onDragOver:Ae=>{Ae.preventDefault(),Ae.dataTransfer.dropEffect="move",we.current=G,d(Ae.clientX,Ae.clientY)},onDragLeave:Ae=>{we.current=null,Ae.currentTarget.classList.remove("border-blue-400","bg-blue-50","text-blue-400")},onDrop:Ae=>{Ae.preventDefault(),Ae.stopPropagation(),Ae.currentTarget.classList.remove("border-blue-400","bg-blue-50","text-blue-400");const Y=we.current||G;we.current=null;let Ie=[];try{const Le=Ae.dataTransfer.getData("application/json");Le&&(Ie=JSON.parse(Le))}catch{}if(Ie.length===0){const Le=Ae.dataTransfer.getData("text/plain");Le&&(Ie=[Le])}Ie.length===0&&l.draggedId&&(Ie=f.includes(l.draggedId)?f:[l.draggedId]),Ie.length>0&&W(Ie.map(Le=>({id:Le,data:{start_date:Y,is_all_day:!0}}))),a()},children:""}):ae.map(Ae=>c.jsx(Dn.Fragment,{children:s===Ae.data.id?c.jsx(Ro,{initialData:Ae.data,onClose:K},Ae.data.id):c.jsx("div",{className:"relative group",children:c.jsx(ml,{flatTask:Ae,isFocused:n===Ae.data.id,onEdit:()=>i(Ae.data.id)},Ae.data.id)})},Ae.data.id))]},G)}),xe.length>0&&(()=>{const G=new Map;return xe.forEach(Ae=>{const Y=ut(Ae.data),Ie=new Date(Y+"T12:00:00"),Le=`${Ie.getFullYear()}-${String(Ie.getMonth()+1).padStart(2,"0")}`;G.has(Le)||G.set(Le,[]),G.get(Le).push(Ae)}),Array.from(G.keys()).sort().map(Ae=>{const[Y,Ie]=Ae.split("-"),Le=["1","2","3","4","5","6","7","8","9","10","11","12"][parseInt(Ie)-1],ct=G.get(Ae),Rt=new Date().getFullYear(),Cn=parseInt(Y)!==Rt;return c.jsxs("div",{"data-date-group":Ae,children:[c.jsxs("div",{className:"flex items-center gap-3 pt-6 pb-2 px-1 select-none",children:[c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsx("span",{className:"text-[13px] font-semibold text-gray-400",children:Le}),Cn&&c.jsx("span",{className:"text-[11px] text-gray-300 font-normal",children:Y})]}),c.jsx("div",{className:"flex-1 h-[1px] bg-gray-200"}),c.jsx("span",{className:"text-[10px] text-gray-400 tabular-nums",children:ct.length})]}),ct.map(Ot=>c.jsx(Dn.Fragment,{children:s===Ot.data.id?c.jsx(Ro,{initialData:Ot.data,onClose:K},Ot.data.id):c.jsx("div",{className:"relative group",children:c.jsx(ml,{flatTask:Ot,isFocused:n===Ot.data.id,onEdit:()=>i(Ot.data.id)},Ot.data.id)})},Ot.data.id))]},Ae)})})()]})},fe=q=>q.map(Z=>c.jsx(Dn.Fragment,{children:s===Z.data.id?c.jsx(Ro,{initialData:Z.data,onClose:K},Z.data.id):c.jsx("div",{className:"relative group",children:c.jsx(ml,{flatTask:Z,isFocused:n===Z.data.id,onEdit:()=>i(Z.data.id),backgroundColor:Fe(Z.data)},Z.data.id)})},Z.data.id));return c.jsx(c.Fragment,{children:c.jsxs("div",{ref:A,className:"pb-20 relative min-h-[500px]",onDragOver:it,onDragLeave:q=>{var Z;(Z=A.current)!=null&&Z.contains(q.relatedTarget)||u({dropIndex:null})},onDrop:q=>{q.preventDefault(),Ue()},onDragEnd:Ue,children:[(w==="allview"||w==="project"||w==="inbox")&&c.jsx("div",{className:"flex justify-end px-4 py-2 border-b border-gray-100/50 mb-2 sticky top-0 bg-white/95 backdrop-blur z-20",children:c.jsxs("div",{className:"flex items-center gap-2 bg-gray-50/80 p-1 rounded-lg border border-gray-100",children:[c.jsx("span",{className:"text-[9px] text-gray-400 font-bold uppercase tracking-wider px-1",children:"Mark:"}),c.jsxs("div",{className:"flex gap-0.5",children:[c.jsx("button",{onClick:()=>ft("none"),className:`px-2 py-0.5 text-[10px] rounded transition-all ${We==="none"?"bg-white shadow-sm text-gray-800 font-bold":"text-gray-400 hover:text-gray-600"}`,children:"Off"}),c.jsxs("button",{onClick:()=>ft("recent"),className:`px-2 py-0.5 text-[10px] rounded transition-all flex items-center gap-1 ${We==="recent"?"bg-red-50 text-red-600 shadow-sm font-bold ring-1 ring-red-100":"text-gray-400 hover:text-red-500"}`,children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),"Recent"]}),c.jsxs("button",{onClick:()=>ft("frequent"),className:`px-2 py-0.5 text-[10px] rounded transition-all flex items-center gap-1 ${We==="frequent"?"bg-amber-50 text-amber-600 shadow-sm font-bold ring-1 ring-amber-100":"text-gray-400 hover:text-amber-500"}`,children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-amber-500"}),"Frequent"]})]})]})}),w==="today"&&Q.showRelationshipLines!==!1&&c.jsx(Nee,{containerRef:A,tasks:De.map(q=>({data:{id:q.data.id,parent_id:q.data.parent_id,color:q.data.color}}))}),c.jsx(Cee,{show:l.isDragging&&l.dropIndex!==null,top:l.indicatorTop,left:l.indicatorLeft,width:l.indicatorWidth,depth:l.dropDepth,color:ue()}),w==="trash"&&c.jsxs("div",{className:"flex items-center justify-between mb-6 px-4 py-3 bg-gray-50 rounded-lg border border-dashed border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Mr,{className:"text-gray-400",size:18}),c.jsx("span",{className:"font-medium text-gray-500 text-sm",children:C("trashEmptyTitle")})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[De.length>0&&c.jsxs("button",{onClick:()=>{confirm(C("restoreTrashConfirm")||"Are you sure?")&&I()},className:"px-3 py-1.5 bg-white border border-gray-200 text-indigo-500 text-xs font-medium rounded hover:bg-indigo-50 hover:border-indigo-200 transition-colors shadow-sm flex items-center gap-1",children:[c.jsx(Dg,{size:12}),C("restoreTrash")||"Restore All"]}),De.length>0&&c.jsx("button",{onClick:()=>{confirm(C("emptyTrashConfirm"))&&k()},className:"px-3 py-1.5 bg-white border border-gray-200 text-red-500 text-xs font-medium rounded hover:bg-red-50 hover:border-red-200 transition-colors shadow-sm",children:C("emptyTrash")})]})]}),w==="today"?ee():w==="upcoming"?De.map((q,Z)=>c.jsx(Dn.Fragment,{children:s===q.data.id?c.jsx(Ro,{initialData:q.data,onClose:K},q.data.id):c.jsxs("div",{className:"relative group",children:[c.jsx("span",{className:"absolute -left-6 top-1/2 -translate-y-1/2 text-[9px] font-mono text-gray-300 select-none",children:Z+1}),c.jsx(ml,{flatTask:q,isFocused:n===q.data.id,onEdit:()=>i(q.data.id),onSelect:tt},q.data.id)]})},q.data.id)):w==="allview"?c.jsxs(c.Fragment,{children:[fe(Se),Pe.length>0&&c.jsxs("div",{className:"mt-12",children:[c.jsxs("button",{onClick:()=>se(!pe),className:"flex items-center gap-2 mb-4 px-2 w-full text-left group",children:[pe?c.jsx(ns,{size:14,className:"text-gray-400"}):c.jsx(es,{size:14,className:"text-gray-400"}),c.jsx(sm,{size:14,className:"text-gray-400"}),c.jsx("span",{className:"text-[13px] font-bold text-gray-400",children:""}),c.jsx("span",{className:"text-[11px] font-medium px-1.5 py-0.5 rounded-full bg-gray-100 text-gray-500",children:Pe.length}),c.jsx("div",{className:"flex-1 h-[2px] rounded-full bg-gradient-to-r from-gray-200 to-transparent"})]}),!pe&&c.jsx("div",{className:"opacity-60",children:Pe.map(q=>c.jsxs("div",{className:"relative group",style:{marginLeft:`${q.depth*24}px`},children:[c.jsx(ml,{flatTask:q,isFocused:!1,onEdit:()=>{}}),c.jsx("button",{onClick:Z=>{Z.stopPropagation(),_(q.data.id)},className:"absolute right-2 top-2 z-10 opacity-0 group-hover:opacity-100 px-3 py-1 bg-emerald-600 text-white text-[10px] font-bold rounded-full shadow-lg hover:bg-emerald-700 transition-all flex items-center gap-1",children:""})]},q.data.id))})]})]}):fe(re),Ve,w==="inbox"&&oe.length>0&&c.jsxs("div",{className:"mt-8 border-2 border-dashed border-amber-200 rounded-xl p-4 bg-amber-50/50",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ez,{size:16,className:"text-amber-500"}),c.jsxs("span",{className:"text-[13px] font-semibold text-amber-700",children:[oe.length," "]})]}),c.jsx("button",{onClick:X,className:"px-3 py-1 text-xs font-medium bg-amber-100 hover:bg-amber-200 text-amber-700 rounded-full transition-colors",children:""})]}),c.jsx("div",{className:"space-y-1 opacity-70",children:oe.map(q=>{const Z=x.find(ae=>["project",""].includes(ae.name.trim().toLowerCase())),ge=x.find(ae=>ae.name.includes("")||["someday","inspiration","/"].includes(ae.name.trim().toLowerCase())),xe=x.find(ae=>["note","journal","",""].includes(ae.name.trim().toLowerCase())),be=x.find(ae=>["prompt",""].includes(ae.name.trim().toLowerCase())),ve=xe,ot=ge,et=q.data.tags||[];let G="";return q.data.start_date?G="":q.data.status==="someday"||q.data.status==="waiting"||ot&&et.includes(ot.id)?G="/":q.data.parent_id||Z&&et.includes(Z.id)?G="":ge&&et.includes(ge.id)?G="/":xe&&et.includes(xe.id)||ve&&et.includes(ve.id)?G="":be&&et.includes(be.id)&&(G=""),c.jsxs("div",{className:"flex items-center justify-between p-2 bg-white/80 rounded-lg",children:[c.jsx("span",{className:"text-sm text-theme-primary truncate flex-1",children:q.data.title||"()"}),c.jsxs("span",{className:"text-[10px] text-amber-600 bg-amber-100 px-2 py-0.5 rounded-full ml-2",children:[" ",G]})]},q.data.id)})})]})]})})},Aee=()=>{const{tasks:t,tags:e,addTask:n,addTag:r,user:s,t:i}=b.useContext(Tn),[o,a]=b.useState(null),[l,u]=b.useState(null),[d,f]=b.useState(()=>{const S=localStorage.getItem(`note_view_expanded_${s==null?void 0:s.id}`);return S?JSON.parse(S):{}});b.useEffect(()=>{s!=null&&s.id&&localStorage.setItem(`note_view_expanded_${s.id}`,JSON.stringify(d))},[d,s==null?void 0:s.id]);const h=b.useMemo(()=>{const S=e.find(_=>_.name.trim().toLowerCase()==="note");return S?S.id:null},[e]),p=b.useMemo(()=>e.filter(S=>S.name.startsWith("#")),[e]),m=b.useMemo(()=>{if(!h)return[];let S=t.filter(_=>_.status!=="deleted"&&_.tags.includes(h));return l&&(S=S.filter(_=>_.tags.includes(l))),S.sort((_,N)=>new Date(N.created_at).getTime()-new Date(_.created_at).getTime())},[t,h,l]),y=b.useMemo(()=>{const S={},_=[];return m.forEach(N=>{const j=N.tags.filter(O=>{if(O===h)return!1;const P=e.find(W=>W.id===O);return P&&!P.name.startsWith("#")});if(j.length===0)_.push(N);else{const O=j[0];if(!S[O]){const P=e.find(W=>W.id===O);S[O]={tag:P,tasks:[]}}S[O].tasks.push(N)}}),{categories:S,uncategorized:_}},[m,h,e]),x=S=>S.tags.map(_=>e.find(N=>N.id===_)).filter(_=>_&&_.name.startsWith("#")),g=S=>{f(_=>({..._,[S]:!_[S]}))},v=S=>d[S]!==!1,w=async()=>{let S=h;if(S||(S=await r("note")),S){const _=await n({title:"",tags:[S],is_project:!1,status:"active"});setTimeout(()=>{a({id:_})},100)}},T=S=>{a(S)},D=()=>{a(null)},k=S=>{u(l===S?null:S)},I=S=>{const _=x(S);return c.jsxs("div",{onClick:()=>T(S),className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden cursor-pointer group hover:shadow-md transition-all hover:-translate-y-0.5",children:[S.images&&S.images.length>0&&c.jsx("div",{className:"aspect-[16/9] bg-gray-100 relative overflow-hidden",children:c.jsx("img",{src:S.images[0],alt:S.title,className:"w-full h-full object-cover transition-transform group-hover:scale-105"})}),c.jsxs("div",{className:"p-4",children:[_.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:_.map(N=>N&&c.jsx("button",{onClick:j=>{j.stopPropagation(),k(N.id)},className:`text-[10px] px-2 py-0.5 rounded-full font-medium transition-all ${l===N.id?"bg-emerald-500 text-white":"bg-emerald-50 text-emerald-600 hover:bg-emerald-100"}`,children:N.name},N.id))}),c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(Gf,{size:14,className:"text-indigo-400 mt-1 flex-shrink-0"}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h3",{className:`font-medium text-gray-800 line-clamp-2 text-sm ${S.title?"":"italic text-gray-400"}`,children:S.title||""}),S.description&&c.jsx("p",{className:"text-xs text-gray-500 line-clamp-2 mt-1",children:S.description.replace(/<[^>]*>/g,"").slice(0,100)})]})]}),c.jsxs("div",{className:"flex items-center justify-between mt-3 pt-2 border-t border-gray-50",children:[c.jsx("span",{className:"text-[10px] text-gray-400",children:new Date(S.created_at).toLocaleDateString()}),c.jsx("div",{className:"flex flex-wrap gap-1",children:S.tags.filter(N=>{if(N===h)return!1;const j=e.find(O=>O.id===N);return j&&!j.name.startsWith("#")}).slice(0,2).map(N=>{const j=e.find(O=>O.id===N);return j?c.jsx(vM,{tag:j,size:"small"},N):null})})]})]})]},S.id)},C=(S,_)=>{var j,O;const N=v(S);return c.jsxs("div",{className:"mb-6",children:[c.jsxs("button",{onClick:()=>g(S),className:"flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-gray-100 transition-colors w-full text-left group",children:[N?c.jsx(es,{size:16,className:"text-gray-400"}):c.jsx(ns,{size:16,className:"text-gray-400"}),c.jsx("span",{className:"font-bold text-sm",style:{color:((j=_.tag)==null?void 0:j.color)||"#6366f1"},children:((O=_.tag)==null?void 0:O.name)||""}),c.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(",_.tasks.length,")"]})]}),N&&c.jsx("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pl-6",children:_.tasks.map(I)})]},S)};return c.jsxs("div",{className:"h-full flex flex-col bg-white overflow-hidden relative",children:[c.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-white z-10",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("h2",{className:"font-bold text-gray-700 flex items-center gap-2",children:[c.jsx(mf,{size:18}),i("journal")]}),p.length>0&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(cz,{size:14,className:"text-gray-400"}),c.jsxs("div",{className:"flex flex-wrap gap-1",children:[p.slice(0,5).map(S=>c.jsx("button",{onClick:()=>k(S.id),className:`text-[10px] px-2 py-0.5 rounded-full font-medium transition-all ${l===S.id?"bg-emerald-500 text-white":"bg-gray-100 text-gray-600 hover:bg-emerald-50 hover:text-emerald-600"}`,children:S.name},S.id)),l&&c.jsxs("button",{onClick:()=>u(null),className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-red-50 text-red-500 hover:bg-red-100 flex items-center gap-1",children:[c.jsx(rn,{size:10}),""]})]})]})]}),c.jsxs("button",{onClick:w,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors shadow-sm",children:[c.jsx(xi,{size:16})," "]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-gray-50/50",children:m.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx(mf,{size:48,className:"mb-4 opacity-20"}),c.jsx("p",{className:"text-sm",children:l?"":""}),c.jsx("p",{className:"text-xs mt-1",children:l?"":"note"})]}):c.jsxs("div",{children:[Object.entries(y.categories).map(([S,_])=>C(S,_)),y.uncategorized.length>0&&c.jsxs("div",{className:"mb-6",children:[c.jsxs("button",{onClick:()=>g("_uncategorized"),className:"flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-gray-100 transition-colors w-full text-left group",children:[v("_uncategorized")?c.jsx(es,{size:16,className:"text-gray-400"}):c.jsx(ns,{size:16,className:"text-gray-400"}),c.jsx("span",{className:"font-bold text-sm text-gray-500",children:""}),c.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(",y.uncategorized.length,")"]})]}),v("_uncategorized")&&c.jsx("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pl-6",children:y.uncategorized.map(I)})]})]})}),o&&c.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm",onClick:D,children:c.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-2xl shadow-2xl max-h-[90vh] overflow-y-auto",onClick:S=>S.stopPropagation(),children:[c.jsx("div",{className:"p-2 border-b border-gray-100 flex justify-end",children:c.jsx("button",{onClick:D,className:"p-2 hover:bg-gray-100 rounded-full text-gray-500",children:c.jsx(rn,{size:20})})}),c.jsx("div",{className:"p-4",children:c.jsx(Ro,{initialData:t.find(S=>S.id===o.id),onClose:D})})]})})]})},Ree={"2024-01-01":"","2024-02-08":"","2024-02-09":"","2024-02-10":"","2024-02-11":"","2024-02-12":"","2024-02-13":"","2024-02-14":"","2024-02-28":"228","2024-04-04":"","2024-04-05":"","2024-06-10":"","2024-09-17":"","2024-10-10":"","2026-01-01":"","2026-02-16":"","2026-02-17":"","2026-02-18":"","2026-02-19":"","2026-02-28":"228","2026-04-04":"","2026-04-05":"","2026-06-19":"","2026-09-25":"","2026-10-10":""},wR=t=>{const e=t.toISOString().split("T")[0];return Ree[e]||null},vR=t=>{const e=t.getFullYear(),n=t.getMonth()+1,r=t.getDate();if(e===2025){if(n===12)return r===24?"":r===21?"":r===1?"":`${(r+10)%30||30}`;if(n===11)return`${(r+9)%30||30}`;if(n===1){if(r===1)return"";if(r===27)return"";if(r===28)return""}return`N${r%30||30}`}if(e===2026){if(n===1)return`${(r+12)%30||28}`;if(n===2){if(r===17)return"";if(r===16)return"";const s=r-17;return s>0?`${s+1}`:`${29+s}`}return`L${n}.${r}`}return""},Oee={"2025-01-05":"","2025-01-20":"","2025-02-03":"","2025-02-18":"","2025-03-05":"","2025-03-20":"","2025-04-04":"","2025-04-20":"","2025-05-05":"","2025-05-21":"","2025-06-05":"","2025-06-21":"","2025-07-07":"","2025-07-22":"","2025-08-07":"","2025-08-23":"","2025-09-07":"","2025-09-23":"","2025-10-08":"","2025-10-23":"","2025-11-07":"","2025-11-22":"","2025-12-07":"","2025-12-21":"","2026-01-05":"","2026-01-20":"","2026-02-04":"","2026-02-19":"","2026-03-06":"","2026-03-21":"","2026-04-05":"","2026-04-20":"","2026-05-06":"","2026-05-21":"","2026-06-06":"","2026-06-21":"","2026-07-07":"","2026-07-23":"","2026-08-08":"","2026-08-23":"","2026-09-08":"","2026-09-23":"","2026-10-08":"","2026-10-23":"","2026-11-07":"","2026-11-22":"","2026-12-07":"","2026-12-22":""},kR=t=>{const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),s=`${e}-${n}-${r}`;return Oee[s]||null},Ri=120,wc=52,Pee=({onDateClick:t,filterTags:e=[],filterTagsExclude:n=[],filterColors:r=[],filterProjects:s=[]})=>{const{tasks:i,tags:o,batchUpdateTasks:a,addTask:l,setEditingTaskId:u,editingTaskId:d,selectedTaskIds:f,setSelectedTaskIds:h,constructionModeEnabled:p,setConstructionModeEnabled:m,setCalendarDate:y,view:x,viewTagFilters:g,themeSettings:v,tagsWithResolvedColors:w}=b.useContext(Tn),[T,D]=b.useState(null),k=b.useRef(new Map),I=b.useRef(new Map);b.useEffect(()=>{D(null)},[d]);const C=re=>{var se;if(re.tags&&re.tags.length>0){const Se=re.tags.find(Pe=>{const ye=o.find(ze=>ze.id===Pe);return ye&&ye.name.toLowerCase().includes("google")});if(Se){if(w&&w[Se])return w[Se];const Pe=o.find(ye=>ye.id===Se);if(Pe!=null&&Pe.color)return Pe.color}for(const Pe of re.tags){if(w&&w[Pe])return w[Pe];const ye=o.find(ze=>ze.id===Pe);if(ye!=null&&ye.color)return ye.color}}const oe=fp(re,i);if(oe&&oe.color&&oe.color!=="gray"){const Se=Kn[oe.color];if(Se)return Se.color}const pe=re.color||"blue";return((se=Kn[pe])==null?void 0:se.color)||Kn.blue.color},S=b.useRef(null),_=b.useRef(null),N=b.useRef(!1),j=b.useRef(null),[O,P]=b.useState([]),[W,R]=b.useState(null),[M,X]=b.useState(null),[Q,A]=b.useState(new Date),[Te,we]=b.useState(null),[B,F]=b.useState(null),[ne,We]=b.useState({start:0,end:200}),ft=Dn.useMemo(()=>{let re=i.filter(oe=>oe.status!=="deleted");if(x==="focus"){const oe=g.focus||{include:[],exclude:[]},{include:pe,exclude:se}=Array.isArray(oe)?{include:oe,exclude:[]}:oe;pe.length>0&&(re=re.filter(Se=>Se.tags.some(Pe=>pe.includes(Pe)))),se.length>0&&(re=re.filter(Se=>!Se.tags.some(Pe=>se.includes(Pe))))}return e.length>0&&(re=re.filter(oe=>oe.tags.some(pe=>e.includes(pe)))),n.length>0&&(re=re.filter(oe=>!oe.tags.some(pe=>n.includes(pe)))),r.length>0&&(re=re.filter(oe=>r.includes(oe.color))),s.length>0&&(re=re.filter(oe=>{if(s.includes(oe.id)||oe.parent_id&&s.includes(oe.parent_id))return!0;let pe=i.find(se=>se.id===oe.parent_id);for(;pe;){if(s.includes(pe.id))return!0;pe=i.find(se=>se.id===(pe==null?void 0:pe.parent_id))}return!1})),re},[i,x,g,e,n,r,s]),le=re=>{const oe=re.getDay(),pe=new Date(re);pe.setDate(re.getDate()-oe),pe.setHours(0,0,0,0);const se=[];for(let Se=0;Se<7;Se++){const Pe=new Date(pe);Pe.setDate(pe.getDate()+Se),se.push({date:Pe,isCurrentMonth:!0,isToday:yi(Pe,new Date)})}return{id:pe.toDateString(),days:se,firstDate:pe}},De=Dn.useMemo(()=>{const re=new Map;return ft.forEach(oe=>{if(oe.status==="deleted"||oe.status==="logged")return;const pe=oe.start_date||oe.due_date;if(pe){const se=new Date(pe),Se=`${se.getFullYear()}-${se.getMonth()}-${se.getDate()}`;re.has(Se)||re.set(Se,[]),re.get(Se).push(oe)}}),re},[ft]),ie=b.useCallback(re=>{const oe=`${re.getFullYear()}-${re.getMonth()}-${re.getDate()}`;return(De.get(oe)||[]).slice().sort((se,Se)=>se.is_all_day&&!Se.is_all_day?-1:!se.is_all_day&&Se.is_all_day?1:!se.is_all_day&&!Se.is_all_day?(se.start_time||"").localeCompare(Se.start_time||""):(se.order_index||0)-(Se.order_index||0))},[De]);b.useEffect(()=>{const re=new Date,oe=[],pe=-wc,se=wc;for(let Se=pe;Se<=se;Se++){const Pe=new Date(re);Pe.setDate(re.getDate()+Se*7),oe.push(le(Pe))}P(oe),setTimeout(()=>{if(S.current){const Pe=wc*Ri-S.current.clientHeight/2+Ri/2;S.current.scrollTop=Pe}},100)},[]),b.useLayoutEffect(()=>{if(N.current&&S.current){const re=4*Ri;S.current.scrollTop+=re,N.current=!1}},[O]);const Fe=b.useCallback(()=>{const re=S.current;if(!re)return;const{scrollTop:oe,clientHeight:pe,scrollHeight:se}=re;se-oe-pe<500&&P(gt=>{const vt=gt[gt.length-1],me=[];for(let He=1;He<=4;He++){const qe=new Date(vt.firstDate);qe.setDate(qe.getDate()+He*7),me.push(le(qe))}return[...gt,...me]}),oe<200&&!N.current&&(N.current=!0,P(gt=>{const vt=gt[0],me=[];for(let He=4;He>=1;He--){const qe=new Date(vt.firstDate);qe.setDate(qe.getDate()-He*7),me.push(le(qe))}return[...me,...gt]}));const Se=Math.floor((oe+100)/Ri),Pe=O[Se];if(Pe){const gt=Pe.days[3].date;A(gt)}const ye=6,ze=Math.floor(oe/Ri)-ye,Ze=Math.ceil((oe+pe)/Ri)+ye;We(gt=>gt.start===ze&&gt.end===Ze?gt:{start:Math.max(0,ze),end:Ze})},[O]),_e=async(re,oe)=>{const pe=re.toDateString();if(p&&f.length>0){const se=[...f];if(oe.altKey)for(const Se of se){const Pe=i.find(ye=>ye.id===Se);Pe&&await l({...Pe,id:void 0,start_date:re.toISOString()})}else{const Se=se.map(Pe=>({id:Pe,data:{start_date:re.toISOString()}}));await a(Se),h([]),m(!1)}R(pe),setTimeout(()=>R(null),600)}else we(re)},tt=(re,oe)=>{oe.stopPropagation(),t&&t(re)},Xe=async()=>{if(f.length===0)return;const re=o.find(se=>se.name.toLowerCase()==="schedule"||se.name==="");if(!re)return;const oe=f.every(se=>{var Pe;const Se=i.find(ye=>ye.id===se);return(Pe=Se==null?void 0:Se.tags)==null?void 0:Pe.includes(re.id)}),pe=f.map(se=>{const Se=i.find(ye=>ye.id===se);if(!Se)return null;let Pe=[...Se.tags||[]];return oe?Pe=Pe.filter(ye=>ye!==re.id):Pe.includes(re.id)||Pe.push(re.id),{id:se,data:{tags:Pe}}}).filter(Boolean);pe.length>0&&await a(pe)},Ve=(re,oe)=>{oe.stopPropagation(),F({date:re,title:""}),setTimeout(()=>{var pe;return(pe=j.current)==null?void 0:pe.focus()},50)},it=async()=>{B&&(B.title.trim()&&await l({title:B.title.trim(),start_date:B.date.toISOString(),is_all_day:!0,status:"inbox",color:"gray"}),F(null))},Ue=["","","","","","",""],K=`${Q.getFullYear()} ${Q.getMonth()+1}`,ue=b.useCallback(()=>{const re=new Date;y(re);const oe=[];for(let pe=-wc;pe<=wc;pe++){const se=new Date(re);se.setDate(re.getDate()+pe*7),oe.push(le(se))}if(P(oe),S.current){const se=wc*Ri-S.current.clientHeight/2+Ri/2;S.current.scrollTop=se}},[le,y,P]);return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main relative",children:[c.jsx("div",{className:"absolute top-12 left-1/2 -translate-x-1/2 z-40 pointer-events-none opacity-0 transition-opacity duration-300 data-[visible=true]:opacity-100","data-visible":!0,children:c.jsxs("div",{className:"bg-theme-header backdrop-blur-md shadow-lg border border-theme px-4 py-1.5 rounded-full text-sm font-bold text-theme-primary flex items-center gap-2",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-500"}),K]})}),c.jsxs("div",{ref:S,className:"flex-1 overflow-y-auto overflow-x-hidden relative",onScroll:Fe,style:{scrollBehavior:"auto"},children:[c.jsx("div",{className:"flex border-b border-theme bg-theme-sidebar z-30 sticky top-0 shadow-sm min-h-[32px]",children:Ue.map((re,oe)=>c.jsx("div",{className:`flex-1 text-center py-2 text-xs font-bold ${oe===0?"text-red-500":oe===6?"text-green-600":"text-theme-tertiary"}`,children:re},re))}),c.jsx("div",{className:"relative",style:{height:O.length*Ri},children:O.map((re,oe)=>oe<ne.start||oe>ne.end||!S.current?null:c.jsx("div",{className:"flex w-full absolute left-0 right-0 border-b border-theme",style:{height:Ri,top:oe*Ri},children:re.days.map((pe,se)=>{const Se=pe.date.getDate()===1,Pe=ie(pe.date),ye=W===pe.date.toDateString(),ze=p&&f.length>0,Ze=Te&&yi(pe.date,Te),gt=wR(pe.date),vt=vR(pe.date),me=kR(pe.date),He=pe.date.getDay()===0||pe.date.getDay()===6,qe=pe.date.getDay()===0,nt=pe.date.getDay()===6;return c.jsxs("div",{className:`
                                                flex-1 min-w-0 h-full border-r border-theme relative group
                                                ${Ze?"bg-indigo-500/10":""}
                                                ${pe.isToday&&!Ze?"bg-indigo-500/5":He&&!Ze?"bg-theme-sidebar":pe.date.getMonth()%2===0&&!Ze?"bg-theme-main":Ze?"":"bg-theme-hover/30"}
                                                ${ye?"ring-4 ring-green-400 bg-green-50 animate-pulse z-20":""}
                                                ${M===pe.date.toDateString()?"bg-indigo-500/20 ring-inset ring-2 ring-indigo-400 z-10 transition-colors duration-150":""}
                                                ${ze?"cursor-pointer hover:ring-[1.5px] hover:ring-indigo-500 hover:shadow-sm hover:z-30 z-10":""}
                                                ${!pe.isToday&&!ye&&M!==pe.date.toDateString()&&!Ze?"hover:bg-theme-hover":""}
                                            `,onDragEnter:()=>X(pe.date.toDateString()),onDragOver:Me=>{Me.preventDefault(),Me.dataTransfer.dropEffect="move"},onDrop:Me=>{Me.preventDefault(),X(null);try{const ut=Me.dataTransfer.getData("application/json"),ee=JSON.parse(ut);if(Array.isArray(ee)&&ee.length>0){const fe=new Date(pe.date);fe.setHours(9,0,0,0);const q=Me.currentTarget.getBoundingClientRect(),ge=Me.clientY-q.top<q.height*.35,xe=ee.map(be=>({id:be,data:{start_date:fe.toISOString(),is_all_day:ge,...ge?{start_time:null,end_time:null}:{start_time:"09:00",end_time:"10:00"}}}));a(xe)}}catch(ut){console.error("Failed to parse drag data",ut)}},onClick:Me=>_e(pe.date,Me),onDoubleClick:Me=>Ve(pe.date,Me),children:[Se&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"absolute top-0 left-0 w-full border-t-2 border-indigo-500 z-10 shadow-sm"}),c.jsxs("div",{className:"absolute -top-3 left-2 bg-indigo-600 text-white text-xs font-bold px-2 py-0.5 rounded-full z-20 shadow-md",children:[pe.date.getFullYear()," ",pe.date.getMonth()+1,""]}),c.jsx("div",{className:"absolute top-2 left-2 text-6xl font-black text-indigo-500/5 pointer-events-none -z-10 select-none",children:pe.date.getMonth()+1})]}),c.jsxs("div",{className:"p-1 h-full flex flex-col gap-0.5 overflow-hidden",onDoubleClick:Me=>tt(pe.date,Me),children:[c.jsxs("div",{className:"flex items-start justify-between min-w-0 pointer-events-none",children:[c.jsxs("div",{className:"flex flex-col leading-none pt-0.5 pl-0.5 max-w-[70%] text-left",children:[v.showTaiwanHolidays&&gt&&c.jsx("span",{className:"text-[9px] font-bold truncate text-red-500",children:gt}),me&&c.jsxs("span",{className:"text-[8px] font-bold truncate text-amber-600",children:[" ",me]}),v.showLunar&&c.jsx("span",{className:`text-[8px] truncate ${gt||me?"text-gray-400":"text-gray-300"}`,children:vt})]}),c.jsx("div",{className:`
                                                        text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-full ml-auto flex-shrink-0
                                                        ${pe.isToday?"bg-indigo-600 text-white":qe?"text-red-500":nt?"text-green-600":"text-theme-tertiary group-hover:text-theme-secondary"}
                                                    `,children:pe.date.getDate()})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden space-y-0.5 no-scrollbar",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:[Pe.map(Me=>{var ot,et;const ut=C(Me),ee=Me.is_all_day,fe=f.includes(Me.id),q=(ot=o.find(G=>G.name.toLowerCase()==="schedule"||G.name===""))==null?void 0:ot.id,Z=q&&((et=Me.tags)==null?void 0:et.includes(q)),ge=ee?{backgroundColor:ut,color:"white",boxShadow:"0 1px 1px rgba(0,0,0,0.1)",border:fe?"2px solid white":`1px solid ${ut}40`}:{backgroundColor:fe?ut+"30":ut+"1A",color:ut,borderLeft:`3px solid ${ut}`},xe=G=>G?G.replace(":",""):"",be=G=>{G&&k.current.set(Me.id,G)},ve=G=>{G&&I.current.set(Me.id,G)};return c.jsxs("div",{ref:ve,id:`task-bubble-${Me.id}`,draggable:!0,onDragStart:G=>{let ae=[Me.id];if(f.includes(Me.id)&&(ae=f),G.dataTransfer.setData("application/json",JSON.stringify(ae)),G.dataTransfer.effectAllowed="move",D(null),_.current){const Ae=_.current.querySelector("#drag-ghost-count"),Y=_.current.querySelector("#drag-ghost-title"),Ie=_.current.querySelector("#drag-ghost-stack-1"),Le=_.current.querySelector("#drag-ghost-stack-2");Ae&&(Ae.textContent=ae.length.toString()),Y&&(Y.textContent=ae.length>1?`${ae.length} Tasks Selected`:Me.title),Ie&&(Ie.style.opacity=ae.length>1?"1":"0"),Le&&(Le.style.opacity=ae.length>2?"1":"0"),G.dataTransfer.setDragImage(_.current,0,0)}},onDragEnd:()=>X(null),onClick:G=>{G.stopPropagation(),G.metaKey||G.ctrlKey||G.shiftKey?f.includes(Me.id)?h(ae=>ae.filter(Ae=>Ae!==Me.id)):h(ae=>[...ae,Me.id]):h([Me.id])},onDoubleClick:G=>{G.stopPropagation(),u(Me.id)},onMouseEnter:()=>{const G=k.current.get(Me.id),ae=I.current.get(Me.id);if(G&&ae&&G.scrollWidth>G.clientWidth){const Ae=ae.getBoundingClientRect();D({taskId:Me.id,title:Me.title,x:Ae.left,y:Ae.top-8})}},onMouseLeave:()=>D(null),className:`
                                                                    relative text-[9.5px] px-1.5 rounded-md cursor-pointer hover:brightness-95 transition-all mb-0.5
                                                                    flex items-center justify-between gap-1
                                                                    ${fe&&ee?"ring-2 ring-indigo-400 z-10":""}
                                                                    ${fe&&!ee?"z-10":""}
                                                                `,style:{...ge,height:"auto",minHeight:"22px",lineHeight:"1.2",...Z?{backgroundImage:"repeating-linear-gradient(45deg, rgba(255,255,255,0.1) 0px, rgba(255,255,255,0.1) 4px, transparent 4px, transparent 8px)"}:{}},children:[c.jsx("span",{ref:be,className:"truncate flex-1 font-medium select-none",children:Me.title||""}),!ee&&(Me.start_time||Me.end_time)&&c.jsxs("div",{className:"flex flex-col items-end leading-none shrink-0 opacity-80",style:{fontSize:"7px",transform:"scale(0.95)",transformOrigin:"right center"},children:[Me.start_time&&c.jsx("span",{children:xe(Me.start_time)}),Me.end_time&&c.jsx("span",{children:xe(Me.end_time)})]})]},Me.id)}),B&&B.date.toDateString()===pe.date.toDateString()&&c.jsx("div",{className:"px-1.5 py-0.5 rounded-md border-2 border-dashed border-indigo-400 bg-indigo-50/50",children:c.jsx("input",{ref:j,type:"text",value:B.title,onChange:Me=>F({...B,title:Me.target.value}),onKeyDown:Me=>{Me.key==="Enter"&&it(),Me.key==="Escape"&&F(null)},onBlur:it,placeholder:"...",className:"w-full text-[9.5px] bg-transparent outline-none text-indigo-400 font-medium",autoFocus:!0})})]})]})]},se)})},re.id))})]}),f.length>0&&c.jsx("button",{onClick:Xe,className:`absolute bottom-6 right-24 w-10 h-10 border rounded-full shadow-lg flex items-center justify-center transition-all z-30
                        ${f.every(re=>{var se;const oe=i.find(Se=>Se.id===re),pe=o.find(Se=>Se.name.toLowerCase()==="schedule"||Se.name==="");return pe&&((se=oe==null?void 0:oe.tags)==null?void 0:se.includes(pe.id))})?"bg-indigo-100 text-indigo-700 border-indigo-200":"bg-theme-card border-theme text-theme-secondary hover:text-indigo-600 hover:border-indigo-300"}`,title:" Schedule  ()",children:c.jsx(kI,{size:20})}),c.jsx("button",{onClick:ue,className:"absolute bottom-4 right-4 bg-indigo-600 text-white px-3 py-1.5 rounded-full shadow-lg text-xs font-bold hover:apply-indigo-700 transition-transform active:scale-95 flex items-center gap-1",children:"Today"}),c.jsx("div",{ref:_,className:"fixed top-[-1000px] left-[-1000px] z-50 pointer-events-none",children:c.jsxs("div",{className:"bg-theme-card backdrop-blur-xl border border-theme p-3 rounded-xl shadow-2xl flex items-center gap-3 w-48 relative overflow-hidden ring-1 ring-black/5",children:[c.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-50/50 to-purple-50/50 -z-10"}),c.jsx("div",{className:"absolute right-0 top-0 w-16 h-16 bg-indigo-500/10 rounded-full blur-2xl -mr-8 -mt-8"}),c.jsx("div",{id:"drag-ghost-count",className:"flex-shrink-0 w-8 h-8 bg-indigo-600 text-white rounded-lg flex items-center justify-center font-black text-sm shadow-indigo-200 shadow-lg transform rotate-[-6deg]",children:"1"}),c.jsxs("div",{className:"flex flex-col min-w-0",children:[c.jsx("span",{className:"text-[10px] uppercase tracking-wider text-indigo-500 font-bold",children:"Moving"}),c.jsx("span",{id:"drag-ghost-title",className:"text-sm font-bold text-gray-700 truncate leading-tight",children:"Task Title"})]}),c.jsx("div",{id:"drag-ghost-stack-1",className:"absolute top-1 left-1 w-full h-full bg-white/50 border border-gray-200/50 rounded-xl -z-20 transform rotate-2 scale-95 origin-center transition-opacity"}),c.jsx("div",{id:"drag-ghost-stack-2",className:"absolute top-2 left-2 w-full h-full bg-white/30 border border-gray-200/30 rounded-xl -z-30 transform rotate-4 scale-90 origin-center transition-opacity"})]})}),T&&tr.createPortal(c.jsxs("div",{className:"fixed z-[9999] w-max max-w-[300px] bg-white/95 backdrop-blur-xl text-slate-800 text-base px-4 py-2.5 rounded-xl shadow-2xl break-words whitespace-normal leading-relaxed font-medium tracking-normal animate-in fade-in zoom-in-95 duration-150 pointer-events-none border border-slate-200/80 ring-1 ring-black/5",style:{left:T.x,top:T.y,transform:"translateY(-100%)"},children:[T.title,c.jsx("div",{className:"absolute left-4 top-full w-0 h-0 border-[6px] border-transparent border-t-white/95"})]}),document.body)]})},cE=60,ra=40,Lee=200,Kh=15,uE=500,$ee=["","","","","","",""],zee=({filterTags:t=[],filterTagsExclude:e=[],filterColors:n=[],filterProjects:r=[]})=>{const{tasks:s,tags:i,calendarDate:o,setCalendarDate:a,editingTaskId:l,setEditingTaskId:u,addTask:d,handleSelection:f,selectedTaskIds:h,setSelectedTaskIds:p,batchDeleteTasks:m,batchUpdateTasks:y,tagsWithResolvedColors:x}=b.useContext(Tn),g=(me,He)=>{var nt;if(me.tags&&me.tags.length>0){const Me=me.tags.find(fe=>{const q=i.find(Z=>Z.id===fe);return q&&q.name.toLowerCase().includes("google")});if(Me){if(x&&x[Me])return x[Me];const fe=i.find(q=>q.id===Me);if(fe!=null&&fe.color)return fe.color}const ut=me.tags[0];if(x&&x[ut])return x[ut];const ee=i.find(fe=>fe.id===ut);if(ee!=null&&ee.color)return ee.color}const qe=He.color||me.color||"blue";return((nt=Kn[qe])==null?void 0:nt.color)||Kn.blue.color},v=b.useRef(null),w=b.useRef(null),[T,D]=b.useState([]),[k,I]=b.useState(new Date),C=b.useRef(!1),S=b.useRef(0),_=b.useRef(0),N=b.useRef(null),[j,O]=b.useState(Lee),[P,W]=b.useState(null),[R,M]=b.useState(72),[X,Q]=b.useState(null),[A,Te]=b.useState(null),we=b.useRef(null),[B,F]=b.useState(null),[ne,We]=b.useState(null),ft=b.useRef(null),le=b.useMemo(()=>{const me=new Map;let He=s.filter(qe=>qe.status!=="deleted"&&qe.status!=="logged");return t.length>0&&(He=He.filter(qe=>qe.tags.some(nt=>t.includes(nt)))),e.length>0&&(He=He.filter(qe=>!qe.tags.some(nt=>e.includes(nt)))),n.length>0&&(He=He.filter(qe=>n.includes(qe.color))),r.length>0&&(He=He.filter(qe=>{if(r.includes(qe.id)||qe.parent_id&&r.includes(qe.parent_id))return!0;let nt=s.find(Me=>Me.id===qe.parent_id);for(;nt;){if(r.includes(nt.id))return!0;nt=s.find(Me=>Me.id===(nt==null?void 0:nt.parent_id))}return!1})),He.forEach(qe=>{const nt=qe.start_date||qe.due_date;if(nt){const Me=new Date(nt),ut=`${Me.getFullYear()}-${Me.getMonth()}-${Me.getDate()}`;me.has(ut)||me.set(ut,[]),me.get(ut).push(qe)}}),me},[s,t,e,n,r]),[De,ie]=b.useState(!1),Fe=9,_e=18,tt=20,Xe=me=>De?me>=Fe&&me<_e?cE:tt:cE,Ve=me=>{let He=0;const qe=Math.floor(me/60);for(let Me=0;Me<qe;Me++)He+=Xe(Me);const nt=me%60;return He+=nt/60*Xe(qe),He},it=me=>{let He=0;for(let qe=0;qe<24;qe++){const nt=Xe(qe);if(me<=He+nt){const Me=(me-He)/nt;return qe*60+Me*60}He+=nt}return 24*60},Ue=()=>{let me=0;for(let He=0;He<24;He++)me+=Xe(He);return me},K=me=>{if(!me)return 0;const[He,qe]=me.split(":").map(Number);return He*60+qe},ue=me=>{const He=Math.floor(me/60),qe=Math.floor(me%60);return`${String(He).padStart(2,"0")}:${String(qe).padStart(2,"0")}`};b.useEffect(()=>{const me=new Date(o);me.setHours(0,0,0,0);const He=[];for(let qe=-Kh;qe<=Kh;qe++){const nt=new Date(me);nt.setDate(me.getDate()+qe),He.push(nt)}D(He),setTimeout(()=>{if(w.current){const qe=He.length*j/2-w.current.clientWidth/2;w.current.scrollLeft=qe}},0)},[]),b.useEffect(()=>{const me=setInterval(()=>I(new Date),6e4);return()=>clearInterval(me)},[]),b.useEffect(()=>{const me=He=>{var qe;if((He.key==="Delete"||He.key==="Backspace")&&h.length>0&&!l){if(["INPUT","TEXTAREA"].includes(((qe=document.activeElement)==null?void 0:qe.tagName)||""))return;He.preventDefault(),m(h,!1)}};return window.addEventListener("keydown",me),()=>window.removeEventListener("keydown",me)},[h,m,l]);const re=()=>{const me=new Date;me.setHours(0,0,0,0);const He=T.findIndex(qe=>yi(qe,me));if(He!==-1&&w.current){const qe=He*j-w.current.clientWidth/2+j/2;w.current.scrollTo({left:qe,behavior:"smooth"});const nt=Ve(k.getHours()*60+k.getMinutes()),Me=ra+R+4,ut=Math.max(0,nt+Me-w.current.clientHeight/3);setTimeout(()=>{var ee;(ee=w.current)==null||ee.scrollTo({top:ut,behavior:"smooth"})},300)}else{a(me);const qe=[];for(let nt=-Kh;nt<=Kh;nt++){const Me=new Date(me);Me.setDate(me.getDate()+nt),qe.push(Me)}D(qe),setTimeout(()=>{if(w.current){const nt=qe.length*j/2-w.current.clientWidth/2;w.current.scrollLeft=nt}},0)}},oe=async()=>{if(h.length===0)return;const me=i.find(nt=>nt.name.toLowerCase()==="schedule"||nt.name==="");if(!me){console.warn("Schedule tag not found");return}const He=h.every(nt=>{var ut;const Me=s.find(ee=>ee.id===nt);return(ut=Me==null?void 0:Me.tags)==null?void 0:ut.includes(me.id)}),qe=h.map(nt=>{const Me=s.find(ee=>ee.id===nt);if(!Me)return null;let ut=[...Me.tags||[]];return He?ut=ut.filter(ee=>ee!==me.id):ut.includes(me.id)||ut.push(me.id),{id:nt,data:{tags:ut}}}).filter(Boolean);qe.length>0&&await y(qe)};b.useEffect(()=>{setTimeout(()=>re(),100)},[]);const pe=()=>{const me=w.current;if(!me)return;const{scrollLeft:He,scrollWidth:qe,clientWidth:nt}=me,Me=He<S.current;S.current=He,He<uE&&!C.current&&Me&&(C.current=!0,D(ut=>{const ee=ut[0],fe=[];for(let q=1;q<=7;q++){const Z=new Date(ee);Z.setDate(ee.getDate()-q),fe.unshift(Z)}return[...fe,...ut]})),qe-(He+nt)<uE&&D(ut=>{const ee=ut[ut.length-1],fe=[];for(let q=1;q<=7;q++){const Z=new Date(ee);Z.setDate(ee.getDate()+q),fe.push(Z)}return[...ut,...fe]})};b.useLayoutEffect(()=>{if(C.current&&w.current){const me=7*j;w.current.scrollLeft+=me,C.current=!1}},[T,j]),b.useEffect(()=>{if(!P)return;const me=qe=>{const nt=qe.clientX-P.initialMouseX,Me=Math.max(120,Math.min(400,P.initialWidth+nt)),ut=Me-P.initialWidth,fe=P.columnIndex*ut;w.current&&(w.current.scrollLeft=P.initialScrollLeft+fe),O(Me)},He=()=>{W(null)};return window.addEventListener("mousemove",me),window.addEventListener("mouseup",He),()=>{window.removeEventListener("mousemove",me),window.removeEventListener("mouseup",He)}},[P]);const se=(me,He)=>{var qe;me.preventDefault(),me.stopPropagation(),W({initialWidth:j,initialMouseX:me.clientX,columnIndex:He,initialScrollLeft:((qe=w.current)==null?void 0:qe.scrollLeft)||0})};b.useEffect(()=>{if(!X)return;const me=qe=>{const nt=qe.clientY-X.initialMouseY,Me=Math.max(30,Math.min(200,X.initialHeight+nt));M(Me)},He=()=>{Q(null)};return window.addEventListener("mousemove",me),window.addEventListener("mouseup",He),()=>{window.removeEventListener("mousemove",me),window.removeEventListener("mouseup",He)}},[X]);const Se=me=>{me.preventDefault(),me.stopPropagation(),Q({initialHeight:R,initialMouseY:me.clientY})};b.useEffect(()=>{const me=()=>{_.current!==0&&w.current?(w.current.scrollLeft+=_.current,N.current=requestAnimationFrame(me)):N.current=null},He=nt=>{if(ft.current&&!ne){const{initialMouseX:Me,initialMouseY:ut}=ft.current;if(Math.abs(nt.clientX-Me)>3||Math.abs(nt.clientY-ut)>3){const ee=ft.current.task;We({...ft.current,originalStartMin:K(ee.start_time),originalDuration:ee.duration||60,currentDate:ft.current.originalDate,currentStartMin:K(ee.start_time)||540,currentDuration:ee.duration||60,currentSection:ft.current.originalType,startOffsetMin:ft.current.startOffsetMin})}}if(ne){if(nt.preventDefault(),w.current){const{left:ve,width:ot}=w.current.getBoundingClientRect(),et=ve+ot,G=120;let ae=0;const Ae=25;if(nt.clientX<ve+G){const Ie=1-Math.max(0,nt.clientX-ve)/G;ae=-Math.max(2,Math.round(Ae*Ie))}else if(nt.clientX>et-G){const Ie=1-Math.max(0,et-nt.clientX)/G;ae=Math.max(2,Math.round(Ae*Ie))}ae!==_.current&&(_.current=ae,ae!==0&&!N.current&&me())}const Me=document.elementsFromPoint(nt.clientX,nt.clientY);let ut=ne.currentSection,ee=ne.currentDate,fe=ne.currentStartMin,q=ne.currentDuration;const Z=Me.find(ve=>ve.getAttribute("data-drop-zone")==="allday"),ge=Me.find(ve=>ve.getAttribute("data-drop-zone")==="grid"),xe=Me.find(ve=>ve.getAttribute("data-date")),be=xe==null?void 0:xe.getAttribute("data-date");if(be&&(ee=new Date(be)),Z?ut="allday":ge&&(ut="grid"),ut==="grid"&&ge){const ve=ge.getBoundingClientRect();let ot=nt.clientY-ve.top,et=it(ot);if(ne.type==="move")et=et-ne.startOffsetMin,fe=Math.round(et/15)*15,fe=Math.max(0,Math.min(1425,fe));else if(ne.type==="resize-bottom"){const G=Math.round(et/15)*15,ae=Math.max(15,G-ne.originalStartMin);ne.currentDuration=ae,q=ae,fe=ne.originalStartMin}else if(ne.type==="resize-top"){let G=Math.round(et/15)*15;const ae=ne.originalStartMin+ne.originalDuration;let Ae=ae-G;Ae<15&&(Ae=15,G=ae-15),q=Ae,fe=G}}We(ve=>ve?{...ve,currentDate:ee,currentSection:ut,currentStartMin:fe,currentDuration:q}:null)}},qe=async()=>{if(_.current=0,N.current&&(cancelAnimationFrame(N.current),N.current=null),ne){const{task:nt,currentDate:Me,currentSection:ut,currentStartMin:ee,currentDuration:fe,originalType:q,type:Z}=ne,ge=h.includes(nt.id)?h:[nt.id],xe=[],be=Me.getTime()-ne.originalDate.getTime(),ve=Math.round(be/864e5),ot=ee-ne.originalStartMin;for(const et of ge){const G=s.find(Ae=>Ae.id===et);if(!G)continue;const ae={};if(G.start_date){const Ae=new Date(G.start_date);Ae.setDate(Ae.getDate()+ve),ae.start_date=Ae.toISOString()}else ae.start_date=Me.toISOString();if(ut==="allday")ae.is_all_day=!0;else if(ae.is_all_day=!1,q==="grid"){let Y=K(G.start_time)+ot;if(Y<0&&(Y=0),ae.start_time=ue(Y),ae.start_date){const Ie=new Date(ae.start_date);Ie.setHours(Math.floor(Y/60)),Ie.setMinutes(Y%60),ae.start_date=Ie.toISOString()}Z==="resize-bottom"||Z==="resize-top"?ae.duration=fe:ae.duration=G.duration||60,ae.end_time=ue((K(ae.start_time)||0)+(ae.duration||60))}else ae.start_time=ue(ee),ae.duration=60,ae.end_time=ue(ee+60);xe.push({id:et,data:ae})}xe.length>0&&await y(xe)}We(null),ft.current=null};return window.addEventListener("mousemove",He),window.addEventListener("mouseup",qe),()=>{window.removeEventListener("mousemove",He),window.removeEventListener("mouseup",qe)}},[ne,s,h,y]);const Pe=(me,He,qe,nt,Me)=>{if(me.button!==0)return;me.preventDefault(),me.stopPropagation(),f(me,He.id);let ut=0,ee=200;const fe=me.currentTarget;if(ee=fe.getBoundingClientRect().width,!Me){const Z=fe.closest(".schedule-body");if(Z){const ge=Z.getBoundingClientRect(),xe=me.clientY-ge.top;ut=it(xe)-K(He.start_time)}else ut=0}ft.current={task:He,initialMouseX:me.clientX,initialMouseY:me.clientY,originalDate:qe,type:nt,originalType:Me?"allday":"grid",startOffsetMin:ut,colWidth:ee}},ye=async(me,He)=>{me.stopPropagation(),p([]);const qe=await d({title:"",start_date:He.toISOString(),is_all_day:!0,status:"inbox"});u(qe)},ze=(me,He)=>{if(me.button!==0)return;p([]);const qe=me.currentTarget.getBoundingClientRect(),nt=me.clientY-qe.top,Me=Math.floor(it(nt)/15)*15;Te({date:He,startMin:Me,duration:60,title:""}),setTimeout(()=>{var ut;return(ut=we.current)==null?void 0:ut.focus()},50)},Ze=async()=>{A&&A.title.trim()&&await d({title:A.title,start_date:A.date.toISOString(),start_time:ue(A.startMin),duration:A.duration,status:"inbox",is_all_day:!1}),Te(null)},gt=(me,He)=>{if(me.button!==0||me.target.closest("[data-task-id]"))return;p([]);const nt=me.currentTarget.getBoundingClientRect(),Me=me.clientY-nt.top,ut=Math.floor(it(Me)/15)*15;F({date:He,startMin:ut,endMin:ut,initialY:me.clientY})};b.useEffect(()=>{if(!B)return;const me=qe=>{if(!w.current)return;const Me=document.querySelector(`div[data-date="${B.date.toISOString()}"]`);if(!Me)return;const ut=Me.querySelector(".schedule-body");if(!ut)return;const ee=ut.getBoundingClientRect(),fe=qe.clientY-ee.top,q=Math.floor(it(fe)/15)*15,Z=Math.max(0,Math.min(24*60-15,q));F(ge=>ge?{...ge,endMin:Z}:null)},He=()=>{if(B){const{date:qe,startMin:nt,endMin:Me}=B,ut=Math.min(nt,Me),fe=Math.max(nt,Me)-ut;fe>=15&&(Te({date:qe,startMin:ut,duration:Math.max(15,fe),title:""}),setTimeout(()=>{var q;return(q=we.current)==null?void 0:q.focus()},50))}F(null)};return window.addEventListener("mousemove",me),window.addEventListener("mouseup",He),()=>{window.removeEventListener("mousemove",me),window.removeEventListener("mouseup",He)}},[B]);const vt=me=>{if(me.length===0)return{};const He=me.map(ee=>({id:ee.id,start:K(ee.start_time),end:K(ee.start_time)+(ee.duration||60)})).sort((ee,fe)=>ee.start-fe.start),qe=[];let nt=[],Me=-1;He.forEach(ee=>{nt.length===0?(nt.push(ee),Me=ee.end):ee.start<Me?(nt.push(ee),Me=Math.max(Me,ee.end)):(qe.push(nt),nt=[ee],Me=ee.end)}),nt.length>0&&qe.push(nt);const ut={};return qe.forEach(ee=>{const fe=[];ee.forEach(be=>{let ve=!1;for(let ot=0;ot<fe.length;ot++){const et=fe[ot],G=et[et.length-1];if(be.start>=G.end){et.push(be),ve=!0;break}}ve||fe.push([be])});const Z=90/fe.length,ge={},xe=[];ee.forEach(be=>{let ve=!1;for(let ot=0;ot<xe.length;ot++){const et=xe[ot],G=et[et.length-1];if(be.start>=G.end){et.push(be),ge[be.id]=ot,ve=!0;break}}ve||(xe.push([be]),ge[be.id]=xe.length-1)}),ee.forEach(be=>{const ve=ge[be.id];ut[be.id]={left:`${ve*Z+2}%`,width:`${Z}%`}})}),ut};return c.jsxs("div",{ref:v,className:"h-full flex flex-col bg-theme-main overflow-hidden",children:[c.jsxs("div",{className:"flex bg-theme-header border-b border-theme p-2 items-center flex-shrink-0 z-40 shadow-sm justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ji,{size:16,className:"text-theme-primary"}),c.jsx("span",{className:"font-bold text-theme-primary text-sm",children:"Schedule"})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-[10px] text-theme-tertiary font-medium",children:"WIDTH"}),c.jsx("input",{type:"range",min:"120",max:"400",value:j,onChange:me=>O(Number(me.target.value)),className:"w-20 h-1 bg-theme-hover rounded-lg appearance-none cursor-pointer accent-indigo-500"})]}),h.length>0&&c.jsxs("button",{onClick:oe,className:`px-3 py-1 border rounded-md text-xs font-bold shadow-sm flex items-center gap-1 transition-all
                                ${h.every(me=>{var nt;const He=s.find(Me=>Me.id===me),qe=i.find(Me=>Me.name.toLowerCase()==="schedule"||Me.name==="");return qe&&((nt=He==null?void 0:He.tags)==null?void 0:nt.includes(qe.id))})?"bg-indigo-100 text-indigo-700 border-indigo-200":"bg-theme-card border-theme text-theme-secondary hover:bg-theme-hover"}`,title:" Schedule ",children:[c.jsx(kI,{size:14}),h.length>1?`(${h.length})`:""]}),c.jsx("button",{onClick:re,className:"px-3 py-1 bg-theme-card border border-theme rounded-md text-xs font-bold shadow-sm hover:bg-theme-hover text-theme-primary",children:"Today"}),c.jsx("button",{onClick:()=>ie(!De),className:`px-3 py-1 border rounded-md text-xs font-bold shadow-sm transition-colors
                            ${De?"bg-indigo-600 text-white border-indigo-600":"bg-theme-card border-theme text-theme-tertiary hover:bg-theme-hover"}`,children:De?"Work Hours":"Full Day"})]})]}),c.jsxs("div",{ref:w,className:"flex-1 overflow-auto flex relative",onScroll:pe,children:[c.jsxs("div",{className:"sticky left-0 z-30 bg-theme-sidebar border-r border-theme flex-shrink-0 w-14 flex flex-col pointer-events-none select-none h-min relative",children:[c.jsx("div",{className:"sticky top-0 bg-theme-sidebar z-40 border-b border-theme flex-shrink-0",style:{height:ra+R+4}}),Array.from({length:24}).map((me,He)=>c.jsx("div",{className:"text-[10px] text-theme-tertiary font-extralight text-center relative box-border",style:{height:Xe(He)},children:c.jsxs("span",{className:"absolute -top-1.5 left-0 right-0",children:[He,":00"]})},He)),c.jsx("div",{className:"absolute right-0 flex items-center z-50",style:{top:ra+R+4+Ve(k.getHours()*60+k.getMinutes())-8},children:c.jsx("div",{className:"bg-red-500 text-white text-[9px] font-bold px-1 py-0.5 rounded-sm shadow-sm",children:k.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})})}),c.jsx("div",{className:"h-20"})]}),T.map((me,He)=>{const qe=yi(me,k),nt=`${me.getFullYear()}-${me.getMonth()}-${me.getDate()}`,Me=le.get(nt)||[],ut=Me.filter(q=>!q.is_all_day&&q.start_time&&q.start_date),ee=Me.filter(q=>q.is_all_day||!q.start_time),fe=vt(ut);return c.jsxs("div",{"data-date":me.toISOString(),className:"flex-shrink-0 flex flex-col border-r border-theme bg-theme-main relative group h-min",style:{minWidth:j,width:j},children:[c.jsxs("div",{className:`sticky top-0 z-20 border-b border-theme px-1 py-0.5 text-center flex flex-col justify-start select-none shadow-sm relative
                                ${qe?"bg-indigo-500/10 backdrop-blur-sm":"bg-theme-header backdrop-blur-sm"}
                            `,style:{height:ra+R+4},children:[c.jsx("div",{className:"absolute top-0 right-0 w-2 h-full cursor-col-resize z-30 hover:bg-indigo-400/30 transition-colors group-hover:opacity-100 opacity-0",onMouseDown:q=>se(q,He)}),c.jsxs("div",{className:"flex items-center justify-center gap-1 flex-shrink-0",style:{height:ra-4},children:[c.jsxs("span",{className:`text-[10px] font-extralight ${qe?"text-indigo-500":"text-theme-tertiary"}`,children:["",$ee[me.getDay()]]}),c.jsx("span",{className:`text-lg font-extralight ${qe?"text-indigo-500":"text-theme-primary"}`,children:me.getDate()})]}),c.jsx("div",{"data-drop-zone":"allday",className:"overflow-y-auto space-y-1 py-1 border-t border-dashed border-theme custom-scrollbar px-1 cursor-cell transition-colors relative",style:{height:R},onDoubleClick:q=>ye(q,me),children:ee.map(q=>{var et,G;const Z=fp(q,s),ge=g(q,Z),xe=h.includes(q.id),be=(ne==null?void 0:ne.task.id)===q.id,ve=(et=i.find(ae=>ae.name.toLowerCase()==="schedule"||ae.name===""))==null?void 0:et.id,ot=ve&&((G=q.tags)==null?void 0:G.includes(ve));return c.jsxs("div",{onMouseDown:ae=>Pe(ae,q,me,"move",!0),onDoubleClick:ae=>{ae.stopPropagation(),p([]),u(q.id)},className:`group/allday text-[10px] px-2 py-1 rounded-lg border text-center font-extralight transition-all w-full relative overflow-hidden cursor-grab active:cursor-grabbing
                                                    ${xe?"ring-2 ring-offset-1":""}
                                                    ${be?"opacity-30":""}
                                                `,style:{backgroundColor:ot?`${ge}10`:xe?ge+"40":ge+"18",backgroundImage:ot?`repeating-linear-gradient(45deg, ${ge}20 0px, ${ge}20 4px, transparent 4px, transparent 8px)`:void 0,color:ge,borderColor:xe?ge+"80":ge+"60",boxShadow:xe?"2px 2px 4px rgba(0,0,0,0.12)":"2px 2px 3px rgba(0,0,0,0.08)","--tw-ring-color":xe?ge+"60":void 0,...ot?{fontWeight:"bold"}:{}},children:[c.jsx("div",{className:"absolute inset-0 opacity-0 group-hover/allday:opacity-100 transition-opacity pointer-events-none",style:{backgroundColor:ge+"15"}}),c.jsx("div",{className:"truncate pointer-events-none relative z-10",children:q.title||"Untitled"})]},q.id)})}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-2 cursor-ns-resize hover:bg-indigo-400/30 transition-colors z-30",onMouseDown:Se})]}),c.jsxs("div",{"data-drop-zone":"grid",className:"flex-1 relative overflow-hidden schedule-body",style:{height:Ue()},onDoubleClick:q=>ze(q,me),onMouseDown:q=>gt(q,me),children:[Array.from({length:24}).map((q,Z)=>c.jsx("div",{className:"border-t border-theme box-border w-full pointer-events-none opacity-20",style:{height:Xe(Z)}},Z)),B&&yi(B.date,me)&&(()=>{const q=Math.min(B.startMin,B.endMin),Z=Math.max(B.startMin,B.endMin);if(Z-q<15)return null;const xe=Ve(q),be=Ve(Z);return c.jsx("div",{className:"absolute left-1 right-1 rounded-xl border-2 border-dashed border-indigo-400 bg-indigo-50/50 pointer-events-none z-40 flex items-center justify-center",style:{top:xe,height:be-xe},children:c.jsxs("span",{className:"text-xs font-extralight text-indigo-600",children:[ue(q)," - ",ue(Z)]})})})(),qe&&c.jsxs("div",{className:"absolute w-full flex items-center z-10 pointer-events-none",style:{top:Ve(k.getHours()*60+k.getMinutes())},children:[c.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 -ml-1"}),c.jsx("div",{className:"flex-1 border-t-2 border-red-500"})]}),ut.map(q=>{var ae,Ae;const Z=fe[q.id];if(!Z||ne&&ne.task.id===q.id)return null;const ge=K(q.start_time),xe=q.duration||60,be=fp(q,s),ve=g(q,be),ot=h.includes(q.id),et=(ae=i.find(Y=>Y.name.toLowerCase()==="schedule"||Y.name===""))==null?void 0:ae.id,G=et&&((Ae=q.tags)==null?void 0:Ae.includes(et));return c.jsxs("div",{"data-task-id":q.id,onMouseDown:Y=>Pe(Y,q,me,"move",!1),onDoubleClick:Y=>{Y.stopPropagation(),p([]),u(q.id)},className:`absolute rounded-xl border px-2 py-1.5 overflow-hidden select-none cursor-pointer hover:brightness-98 transition-all flex flex-col
                                                ${ot?"ring-2 ring-offset-1":""}
                                            `,style:{top:Ve(ge),height:Ve(ge+xe)-Ve(ge),left:Z.left,width:Z.width,backgroundColor:G?`${ve}10`:ot?ve+"40":ve+"15",backgroundImage:G?`repeating-linear-gradient(45deg, ${ve}20 0px, ${ve}20 4px, transparent 4px, transparent 8px)`:void 0,borderColor:ve+"50",color:ve,zIndex:10,boxShadow:"2px 2px 3px rgba(0,0,0,0.06)","--tw-ring-color":ot?ve+"60":void 0,...G?{fontWeight:"bold"}:{}},children:[c.jsx("div",{className:"font-extralight text-[11px] truncate leading-normal pointer-events-none",children:q.title||""}),xe>30&&c.jsxs("div",{className:"text-[9px] opacity-80 font-extralight mt-0.5 leading-normal pointer-events-none",children:[q.start_time," - ",q.end_time]}),c.jsx("div",{className:"absolute top-0 left-0 w-full h-3 cursor-ns-resize z-50 hover:bg-black/5 transition-colors",onMouseDown:Y=>Pe(Y,q,me,"resize-top",!1)}),c.jsx("div",{className:"absolute bottom-0 left-0 w-full h-3 cursor-ns-resize z-50 hover:bg-black/5 transition-colors",onMouseDown:Y=>Pe(Y,q,me,"resize-bottom",!1)})]},q.id)}),A&&yi(A.date,me)&&c.jsx("div",{className:"absolute z-50 rounded-xl border border-indigo-500 bg-theme-card shadow-xl overflow-hidden px-3 flex items-center",style:{top:Ve(A.startMin),height:Math.max(44,Ve(A.startMin+A.duration)-Ve(A.startMin)),left:"5%",width:"90%"},children:c.jsx("input",{ref:we,value:A.title,onChange:q=>Te({...A,title:q.target.value}),onKeyDown:q=>{q.key==="Enter"&&Ze(),q.key==="Escape"&&Te(null)},onBlur:Ze,className:"w-full text-[12px] font-extralight bg-transparent outline-none text-indigo-400 leading-normal",placeholder:"New Task...",autoFocus:!0})})]})]},me.toISOString())}),ne&&(()=>{var Me,ut,ee;const me=fp(ne.task,s),He=g(ne.task,me);let qe=0;const nt=Array.from(document.querySelectorAll("div[data-date]")).find(fe=>fe.getAttribute("data-date")===ne.currentDate.toISOString());if(nt?qe=nt.getBoundingClientRect().left:qe=ne.initialMouseX,ne.currentSection==="allday"){const q=(((Me=w.current)==null?void 0:Me.getBoundingClientRect().top)||0)+ra+2;return c.jsx("div",{className:"fixed z-[100] pointer-events-none rounded-lg border px-2 py-1 text-[10px] font-extralight text-center shadow-xl cursor-grabbing flex items-center justify-center bg-white",style:{left:qe+4,top:q,width:(ne.colWidth||200)-8,height:R-4,backgroundColor:He+"40",borderColor:He,color:He},children:ne.task.title||"Untitled"})}else{const fe=((ut=w.current)==null?void 0:ut.getBoundingClientRect())||{top:0,left:0},q=((ee=w.current)==null?void 0:ee.scrollTop)||0,Z=Ve(ne.currentStartMin),ge=Ve(ne.currentStartMin+ne.currentDuration)-Z,xe=fe.top+ra+R+4+Z-q;return c.jsxs("div",{className:`fixed rounded-xl border px-2 py-1.5 shadow-2xl overflow-hidden select-none flex flex-col z-[100] bg-white ring-2 ring-indigo-400/50 ${ne.type.startsWith("resize")?"cursor-ns-resize":"cursor-grabbing"}`,style:{top:Math.max(fe.top+ra+R+4,xe),height:ge,left:qe+4,width:(ne.colWidth||190)-8,backgroundColor:"var(--bg-card)",borderColor:He,color:He,opacity:.95},children:[c.jsx("div",{className:"font-extralight text-[11px] truncate leading-normal",children:ne.task.title||""}),c.jsxs("div",{className:"text-[9px] font-extralight mt-0.5 opacity-80 leading-normal",children:[ue(ne.currentStartMin)," - ",ue(ne.currentStartMin+ne.currentDuration)]})]})}})()]})]})},Fee=Object.keys(Kn),Bee=()=>{const{tasks:t,updateTask:e,selectedTaskIds:n,viewTagFilters:r,setEditingTaskId:s,focusSplitWidth:i,setFocusSplitWidth:o,themeSettings:a,setSelectedTaskIds:l,constructionModeEnabled:u,setConstructionModeEnabled:d,deleteTask:f,editingTaskId:h,batchDeleteTasks:p,setCalendarDate:m,tags:y,tagsWithResolvedColors:x}=b.useContext(Tn),g=b.useRef(null),[v,w]=b.useState(!1),[T,D]=b.useState(()=>localStorage.getItem("focus_calendar_mode")||"calendar"),[k,I]=b.useState(null),[C,S]=b.useState(()=>{try{const K=localStorage.getItem("focus_filter_tags_include");return K?JSON.parse(K):[]}catch{return[]}}),[_,N]=b.useState(()=>{try{const K=localStorage.getItem("focus_filter_tags_exclude");return K?JSON.parse(K):[]}catch{return[]}}),[j,O]=b.useState(()=>{try{const K=localStorage.getItem("focus_filter_colors");return K?JSON.parse(K):[]}catch{return[]}}),[P,W]=b.useState(()=>{try{const K=localStorage.getItem("focus_filter_projects");return K?JSON.parse(K):[]}catch{return[]}}),[R,M]=b.useState(!1),[X,Q]=b.useState(!1),[A,Te]=b.useState(!1),we=b.useRef(null),B=b.useRef(null),F=b.useRef(null);b.useEffect(()=>{localStorage.setItem("focus_filter_tags_include",JSON.stringify(C))},[C]),b.useEffect(()=>{localStorage.setItem("focus_filter_tags_exclude",JSON.stringify(_))},[_]),b.useEffect(()=>{localStorage.setItem("focus_filter_colors",JSON.stringify(j))},[j]),b.useEffect(()=>{localStorage.setItem("focus_filter_projects",JSON.stringify(P))},[P]);const ne=b.useMemo(()=>t.filter(K=>K.is_project&&K.status!=="deleted"),[t]),We=C.length>0||_.length>0||j.length>0||P.length>0,ft=()=>{S([]),N([]),O([]),W([])},le=K=>{C.includes(K)?(S(ue=>ue.filter(re=>re!==K)),N(ue=>[...ue,K])):_.includes(K)?N(ue=>ue.filter(re=>re!==K)):S(ue=>[...ue,K])};b.useEffect(()=>{const K=ue=>{we.current&&!we.current.contains(ue.target)&&M(!1),B.current&&!B.current.contains(ue.target)&&Q(!1),F.current&&!F.current.contains(ue.target)&&Te(!1)};return document.addEventListener("mousedown",K),()=>document.removeEventListener("mousedown",K)},[]),b.useEffect(()=>{localStorage.setItem("focus_calendar_mode",T)},[T]);const De=n.length>0&&n.some(K=>{const ue=t.find(re=>re.id===K);return ue&&!ue.start_date}),ie=u&&De,Fe=n.length>0&&n.some(K=>{const ue=t.find(re=>re.id===K);return ue&&ue.start_date}),_e=u&&Fe&&!De,tt=b.useMemo(()=>{const K=r.focus||{include:[],exclude:[]},{include:ue,exclude:re}=Array.isArray(K)?{include:K,exclude:[]}:K,oe=new Set(t.filter(se=>se.status==="deleted").map(se=>se.id));let pe=t.filter(se=>se.status==="inbox"&&!se.start_date&&!se.completed_at&&(!se.parent_id||!oe.has(se.parent_id)));return ue.length>0&&(pe=pe.filter(se=>se.tags.some(Se=>ue.includes(Se)))),re.length>0&&(pe=pe.filter(se=>!se.tags.some(Se=>re.includes(Se)))),pe.sort((se,Se)=>(se.order_index||0)-(Se.order_index||0))},[t,r]);b.useEffect(()=>{const K=ue=>{var re,oe,pe;if(ue.key==="Escape"&&(ie||_e)&&(d(!1),l([])),(ue.key==="Delete"||ue.key==="Backspace")&&!h){if(["INPUT","TEXTAREA"].includes(((re=document.activeElement)==null?void 0:re.tagName)||""))return;n.length>0&&(ue.preventDefault(),p(n,!1),l([]))}if(ue.key==="Enter"&&!h&&n.length>0){if(["INPUT","TEXTAREA"].includes(((oe=document.activeElement)==null?void 0:oe.tagName)||""))return;ue.preventDefault(),s(n[0])}if((ue.key==="ArrowUp"||ue.key==="ArrowDown")&&!h){if(["INPUT","TEXTAREA"].includes(((pe=document.activeElement)==null?void 0:pe.tagName)||"")||(ue.preventDefault(),tt.length===0))return;let se=-1;n.length>0&&(se=tt.findIndex(ye=>n.includes(ye.id)));let Se=0;ue.key==="ArrowDown"?se===-1?Se=0:Se=Math.min(tt.length-1,se+1):se===-1?Se=tt.length-1:Se=Math.max(0,se-1);const Pe=tt[Se];Pe&&(l([Pe.id]),Ve(Se),setTimeout(()=>{const ye=document.getElementById(`focus-task-${Pe.id}`);ye==null||ye.scrollIntoView({block:"nearest"})},0))}};return window.addEventListener("keydown",K),()=>window.removeEventListener("keydown",K)},[ie,_e,l,d,n,f,h,tt]),b.useEffect(()=>{n.length===0&&d(!1)},[n]),b.useEffect(()=>{const K=re=>{if(!v||!g.current)return;const oe=g.current.getBoundingClientRect();let pe=re.clientX-oe.left;const se=oe.width*.9;pe<100&&(pe=100),pe>se&&(pe=se),o(pe)},ue=()=>{w(!1),document.body.style.cursor="default"};return v&&(window.addEventListener("mousemove",K),window.addEventListener("mouseup",ue),document.body.style.cursor="col-resize"),()=>{window.removeEventListener("mousemove",K),window.removeEventListener("mouseup",ue)}},[v]);const[Xe,Ve]=b.useState(null),it=(K,ue,re)=>{if(re.shiftKey&&Xe!==null){const oe=Math.min(Xe,ue),pe=Math.max(Xe,ue),se=tt.slice(oe,pe+1).map(Se=>Se.id);l(se)}else re.metaKey||re.ctrlKey?n.includes(K)?l(n.filter(oe=>oe!==K)):l([...n,K]):l([K]);Ve(ue)},Ue=(K,ue)=>{const re=n.includes(K.id),oe={small:"text-xs",normal:"text-sm",large:"text-base"}[a.fontSize]||"text-sm",pe=a.fontFamily==="things"?"font-things":"font-sans",se=K.color||"blue",Se=Kn[se]||Kn.blue;return c.jsxs("div",{id:`focus-task-${K.id}`,onClick:Pe=>it(K.id,ue,Pe),onDoubleClick:Pe=>{Pe.stopPropagation(),s(K.id)},className:`
                    group relative flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer
                    transition-all duration-150 ease-out
                    ${re?`bg-indigo-50 ring-2 shadow-sm ${ie||_e?"construction-glow ring-transparent":"ring-indigo-400"}`:"hover:bg-theme-hover active:bg-theme-hover"}
                `,style:re&&(ie||_e)?{"--glow-color":Se.color,"--tw-ring-color":Se.color}:{},children:[c.jsx("div",{className:`flex-shrink-0 w-4 h-4 rounded-full border-2 transition-colors ${re?`${Se.border} ${Se.bg}`:"border-gray-300 group-hover:border-gray-400"}`,onClick:Pe=>{Pe.stopPropagation(),e(K.id,{status:"completed"})}}),c.jsxs("div",{className:"flex-1 min-w-0",children:[K.parent_id&&(()=>{const Pe=t.find(ye=>ye.id===K.parent_id);return Pe?c.jsxs("div",{className:"text-[9px] text-gray-400 truncate mb-0.5 flex items-center gap-1",children:[c.jsx("span",{className:"w-1 h-1 rounded-full bg-gray-300"}),Pe.title]}):null})(),c.jsx("div",{className:`${oe} ${pe} font-extralight text-theme-secondary truncate leading-tight`,children:K.title||c.jsx("span",{className:"text-theme-tertiary italic",children:""})})]})]},K.id)};return c.jsxs("div",{ref:g,className:"flex h-full w-full overflow-hidden bg-theme-main",children:[c.jsx("div",{style:{width:i},className:"flex flex-col h-full border-r border-theme flex-shrink-0 bg-theme-sidebar",children:c.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar px-2 py-3 space-y-4",children:[tt.length>0&&c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between px-2 mb-1",children:[c.jsxs("span",{className:`text-[9px] text-gray-400 ${a.fontFamily==="things"?"font-things":"font-sans"}`,children:[" (",tt.length,")"]}),n.length>0&&c.jsxs("button",{onClick:()=>d(!u),className:`flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] font-medium transition-all ${u?"bg-amber-100 text-amber-700 ring-1 ring-amber-300":"bg-gray-100 text-gray-500 hover:bg-gray-200"}`,title:u?"":"",children:[c.jsx(mz,{size:10}),u?"":""]})]}),c.jsx("div",{className:"space-y-1",children:tt.slice(0,50).map((K,ue)=>Ue(K,ue))})]}),tt.length===0&&c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx(gf,{size:32,className:"mb-2 opacity-30"}),c.jsx("p",{className:"text-sm",children:""})]})]})}),c.jsx("div",{onMouseDown:()=>w(!0),className:`w-1 cursor-col-resize hover:bg-indigo-400 group relative z-30 transition-colors flex items-center justify-center ${v?"bg-indigo-400":"bg-transparent"}`,children:c.jsx("div",{className:`absolute opacity-0 group-hover:opacity-100 transition-opacity p-0.5 bg-white border border-gray-200 rounded-md shadow-sm text-gray-400 ${v?"opacity-100":""}`,children:c.jsx(EI,{size:10})})}),c.jsxs("div",{className:"flex-1 h-full min-w-0 relative overflow-hidden flex flex-col",children:[c.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-theme bg-theme-header flex-shrink-0",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[k&&c.jsxs("button",{onClick:()=>{I(null),D("calendar")},className:"flex items-center gap-1 px-2 py-1.5 rounded-md text-xs font-medium text-theme-secondary hover:text-theme-primary hover:bg-theme-hover transition-all",title:"",children:[c.jsx(vI,{size:14}),""]}),c.jsxs("div",{className:"flex items-center gap-1 bg-theme-hover p-0.5 rounded-lg",children:[c.jsxs("button",{onClick:()=>{D("calendar"),I(null)},className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${T==="calendar"&&!k?"bg-theme-card text-indigo-500 shadow-sm":"text-theme-tertiary hover:text-theme-secondary"}`,children:[c.jsx(Go,{size:14}),""]}),c.jsxs("button",{onClick:()=>{D("schedule"),I(null)},className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${T==="schedule"||k?"bg-theme-card text-indigo-500 shadow-sm":"text-theme-tertiary hover:text-theme-secondary"}`,children:[c.jsx(Ji,{size:14}),""]})]}),k&&c.jsxs("span",{className:"text-sm font-medium text-indigo-600",children:[k.getMonth()+1,"",k.getDate()," (",["","","","","","",""][k.getDay()],")"]})]}),c.jsx("div",{className:"text-[10px] text-gray-400",children:k?"":T==="schedule"?" 1-9 ":""})]}),c.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 border-b border-theme bg-theme-card/50 flex-shrink-0",children:[c.jsx("span",{className:"text-[9px] font-bold text-gray-400 uppercase tracking-wider",children:":"}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>M(!R),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-medium transition-all border ${C.length>0||_.length>0?"bg-indigo-50 text-indigo-600 border-indigo-200":"bg-theme-hover text-theme-tertiary border-transparent hover:text-theme-secondary"}`,children:[c.jsx(Pl,{size:11}),"",C.length+_.length>0&&c.jsx("span",{className:"ml-0.5 px-1 bg-indigo-500 text-white rounded-full text-[9px]",children:C.length+_.length}),c.jsx(es,{size:10})]}),R&&c.jsxs("div",{ref:we,className:"absolute top-full left-0 mt-1 w-56 bg-theme-card rounded-lg shadow-xl border border-theme z-50 p-1 max-h-64 overflow-y-auto",children:[c.jsxs("div",{className:"text-[9px] text-theme-tertiary px-2 py-1 border-b border-theme mb-1",children:[":   ",c.jsx("span",{className:"text-green-600",children:""}),"  ",c.jsx("span",{className:"text-red-500",children:""}),"  "]}),y.map(K=>{const ue=C.includes(K.id),re=_.includes(K.id);return c.jsxs("button",{onClick:()=>le(K.id),className:`w-full flex items-center justify-between px-2 py-1.5 text-xs rounded hover:bg-theme-hover transition-colors ${ue?"bg-green-50":re?"bg-red-50":""}`,children:[c.jsxs("div",{className:"flex items-center gap-1.5",children:[c.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:x[K.id]||"#6366f1"}}),c.jsx("span",{className:"text-theme-secondary",children:K.name})]}),ue&&c.jsx(Gn,{size:12,className:"text-green-600"}),re&&c.jsx(rn,{size:12,className:"text-red-500"})]},K.id)}),y.length===0&&c.jsx("div",{className:"text-xs text-theme-tertiary p-2",children:""})]})]}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>Q(!X),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-medium transition-all border ${j.length>0?"bg-indigo-50 text-indigo-600 border-indigo-200":"bg-theme-hover text-theme-tertiary border-transparent hover:text-theme-secondary"}`,children:[c.jsx(Ew,{size:11}),"",j.length>0&&c.jsx("span",{className:"ml-0.5 px-1 bg-indigo-500 text-white rounded-full text-[9px]",children:j.length}),c.jsx(es,{size:10})]}),X&&c.jsx("div",{ref:B,className:"absolute top-full left-0 mt-1 w-48 bg-theme-card rounded-lg shadow-xl border border-theme z-50 p-2",children:c.jsx("div",{className:"grid grid-cols-7 gap-1",children:Fee.map(K=>{var ue;return c.jsx("button",{onClick:()=>{O(re=>re.includes(K)?re.filter(oe=>oe!==K):[...re,K])},className:`w-5 h-5 rounded-full transition-transform ${j.includes(K)?"ring-2 ring-offset-1 ring-indigo-500 scale-110":"hover:scale-110"}`,style:{backgroundColor:((ue=Kn[K])==null?void 0:ue.color)||"#6366f1"},title:K},K)})})})]}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>Te(!A),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-medium transition-all border ${P.length>0?"bg-indigo-50 text-indigo-600 border-indigo-200":"bg-theme-hover text-theme-tertiary border-transparent hover:text-theme-secondary"}`,children:[c.jsx(dz,{size:11}),"",P.length>0&&c.jsx("span",{className:"ml-0.5 px-1 bg-indigo-500 text-white rounded-full text-[9px]",children:P.length}),c.jsx(es,{size:10})]}),A&&c.jsxs("div",{ref:F,className:"absolute top-full left-0 mt-1 w-56 bg-theme-card rounded-lg shadow-xl border border-theme z-50 p-1 max-h-64 overflow-y-auto",children:[ne.map(K=>{var ue;return c.jsxs("button",{onClick:()=>{W(re=>re.includes(K.id)?re.filter(oe=>oe!==K.id):[...re,K.id])},className:`w-full flex items-center justify-between px-2 py-1.5 text-xs rounded hover:bg-theme-hover transition-colors ${P.includes(K.id)?"bg-indigo-50":""}`,children:[c.jsxs("div",{className:"flex items-center gap-1.5",children:[c.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:((ue=Kn[K.color])==null?void 0:ue.color)||"#6366f1"}}),c.jsx("span",{className:"text-theme-secondary truncate",children:K.title})]}),P.includes(K.id)&&c.jsx(Gn,{size:12,className:"text-indigo-600"})]},K.id)}),ne.length===0&&c.jsx("div",{className:"text-xs text-theme-tertiary p-2",children:""})]})]}),We&&c.jsxs("button",{onClick:ft,className:"flex items-center gap-1 text-[10px] text-red-500 hover:text-red-600 ml-auto",children:[c.jsx(rn,{size:11})," "]})]}),c.jsx("div",{className:"flex-1 relative z-10 h-full overflow-hidden",children:T==="calendar"&&!k?c.jsx(Pee,{onDateClick:K=>{I(K),m(K)},filterTags:C,filterTagsExclude:_,filterColors:j,filterProjects:P}):c.jsx(zee,{filterTags:C,filterTagsExclude:_,filterColors:j,filterProjects:P})}),(ie||_e)&&c.jsxs("div",{className:"absolute bottom-0 left-0 right-0 z-20",children:[c.jsx("div",{className:`h-12 opacity-45 transition-colors ${_e?"opacity-30":"opacity-45"}`,style:{backgroundImage:ie?`repeating-linear-gradient(
                                    45deg,
                                    #fbbf24 0px,
                                    #fbbf24 10px,
                                    #1f2937 10px,
                                    #1f2937 20px
                                )`:`repeating-linear-gradient(
                                    45deg,
                                    #818cf8 0px,
                                    #818cf8 10px,
                                    #312e81 10px,
                                    #312e81 20px
                                )`,backgroundSize:"28px 28px"}}),c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:c.jsx("div",{className:`bg-white/95 backdrop-blur-sm px-4 py-2 rounded-lg shadow-lg border ${ie?"border-amber-200":"border-indigo-200"}`,children:c.jsxs("span",{className:`text-sm font-bold ${ie?"text-amber-700":"text-indigo-700"}`,children:[ie?" ":" "," ",n.length,"    ESC "]})})})]})]})]})},Oi=40,By=50,Pi=40,Uy=250,SR=({plan:t,onUpdatePlan:e,onEditTask:n})=>{const[r,s]=b.useState(null),[i,o]=b.useState(null),[a,l]=b.useState(null),[u,d]=b.useState(null),[f,h]=b.useState(0),[p,m]=b.useState(0),[y,x]=b.useState(0),[g,v]=b.useState({x:0,y:0}),[w,T]=b.useState(null),D=b.useRef(null),k=b.useRef(null),I=b.useRef(null);I.current=w,b.useEffect(()=>{T(null)},[t]);const C=(ie,Fe=0,_e=[],tt=null)=>{let Xe=[];return ie.forEach((Ve,it)=>{const Ue=[..._e,it];Xe.push({...Ve,depth:Fe,path:Ue,parentId:tt}),Ve.subtasks&&Ve.subtasks.length>0&&(Xe=[...Xe,...C(Ve.subtasks,Fe+1,Ue,Ve.id||null)])}),Xe},S=w||t,_=b.useMemo(()=>C(S),[S]),N=ie=>_.find(Fe=>Fe.id===ie),j=ie=>{if(!ie)return null;const Fe=new Date(ie);return isNaN(Fe.getTime())?null:Fe},{minDate:O,totalDays:P}=b.useMemo(()=>{let ie=new Date,Fe=new Date;Fe.setDate(ie.getDate()+14);let _e=!1;C(t).forEach(it=>{const Ue=j(it.start_date),K=j(it.due_date);Ue&&((!_e||Ue<ie)&&(ie=Ue),_e=!0),K&&((!_e||K>Fe||K>Fe)&&(Fe=K),_e=!0)}),ie.setDate(ie.getDate()-2),Fe.setDate(Fe.getDate()+5);const Xe=Math.abs(Fe.getTime()-ie.getTime()),Ve=Math.ceil(Xe/(1e3*60*60*24));return{minDate:ie,maxDate:Fe,totalDays:Ve}},[t,w]),W=(ie,Fe)=>{const _e=ie.getTime()-Fe.getTime();return Math.ceil(_e/(1e3*60*60*24))},R=(ie,Fe)=>{const _e=new Date(Fe);return _e.setDate(_e.getDate()+ie),_e.toISOString().split("T")[0]},M=(ie,Fe,_e)=>ie.map(tt=>tt.id===Fe?{...tt,..._e}:tt.subtasks?{...tt,subtasks:M(tt.subtasks,Fe,_e)}:tt),X=(ie,Fe)=>{let _e=JSON.parse(JSON.stringify(ie));if(!Fe)return _e;const tt=[Fe],Xe=new Set;for(;tt.length>0;){const Ve=tt.shift();if(Xe.has(Ve))continue;Xe.add(Ve);const it=(re,oe)=>{for(const pe of re){if(pe.id===oe)return pe;if(pe.subtasks){const se=it(pe.subtasks,oe);if(se)return se}}return null},Ue=it(_e,Ve);if(!Ue||!Ue.due_date)continue;const K=new Date(Ue.due_date),ue=re=>{for(let oe=0;oe<re.length;oe++){const pe=re[oe];if(pe.dependencies&&pe.dependencies.includes(Ve)){const se=pe.start_date?new Date(pe.start_date):null,Se=new Date(K);if(Se.setDate(Se.getDate()+1),!se||se<Se){const Pe=pe.start_date&&pe.due_date?new Date(pe.due_date).getTime()-new Date(pe.start_date).getTime():864e5,ye=Se.toISOString().split("T")[0],Ze=new Date(Se.getTime()+Pe).toISOString().split("T")[0];re[oe]={...pe,start_date:ye,due_date:Ze},pe.id&&tt.push(pe.id)}}pe.subtasks&&ue(pe.subtasks)}};ue(_e)}return _e},Q=(ie,Fe)=>{if(ie.preventDefault(),ie.stopPropagation(),!Fe.id)return;s(Fe.id),o(Fe.id);const _e=Fe.start_date?W(new Date(Fe.start_date),O):0,tt=Fe.due_date?W(new Date(Fe.due_date),O):_e+1;m(_e),x(tt-_e),h(ie.clientX),T(t)},A=(ie,Fe,_e)=>{if(ie.preventDefault(),ie.stopPropagation(),!Fe.id)return;l({id:Fe.id,dir:_e}),h(ie.clientX);const tt=Fe.start_date?W(new Date(Fe.start_date),O):0,Xe=Fe.due_date?W(new Date(Fe.due_date),O):tt+1;m(tt),x(Xe-tt),T(t)},Te=(ie,Fe)=>{var tt;if(ie.preventDefault(),ie.stopPropagation(),!Fe.id)return;d(Fe.id);const _e=(tt=D.current)==null?void 0:tt.getBoundingClientRect();_e&&v({x:ie.clientX-_e.left,y:ie.clientY-_e.top})},we=ie=>{if(u&&D.current){const tt=D.current.getBoundingClientRect();v({x:ie.clientX-tt.left,y:ie.clientY-tt.top});return}if(!i&&!a||!D.current||!w)return;const Fe=ie.clientX-f,_e=Math.round(Fe/Oi);if(i){if(!N(i))return;const Xe=p+_e;if(Xe<0)return;const Ve=R(Xe,O),it=R(Xe+y,O),Ue=M(w,i,{start_date:Ve,due_date:it});T(Ue)}if(a){let tt=p,Xe=y;if(a.dir==="end")Xe=Math.max(1,y+_e);else{const K=y-1,ue=Math.min(_e,K);tt=p+ue,Xe=y-ue}if(tt<0)return;const Ve=R(tt,O),it=R(tt+Xe,O),Ue=M(w,a.id,{start_date:Ve,due_date:it});T(Ue)}},B=()=>{const ie=I.current;if(i&&ie){const Fe=X(ie,i);e(Fe)}else if(a&&ie){const Fe=X(ie,a.id);e(Fe)}o(null),l(null),d(null),T(null)},F=(ie,Fe)=>{var _e;if(ie.stopPropagation(),u&&Fe.id&&u!==Fe.id){if((_e=Fe.dependencies)!=null&&_e.includes(u))return;const tt=[...Fe.dependencies||[],u],Xe=M(t,Fe.id,{dependencies:tt}),Ve=X(Xe,u);e(Ve)}d(null)};b.useEffect(()=>{const ie=()=>{(i||a||u)&&B()},Fe=_e=>{if(u&&D.current){const tt=D.current.getBoundingClientRect();v({x:_e.clientX-tt.left,y:_e.clientY-tt.top})}};return window.addEventListener("mouseup",ie),window.addEventListener("mousemove",Fe),()=>{window.removeEventListener("mouseup",ie),window.removeEventListener("mousemove",Fe)}},[i,a,u,t]);const ne=()=>{const ie=[],Fe=[];for(let _e=0;_e<P;_e++){const tt=new Date(O);tt.setDate(tt.getDate()+_e);const Xe=tt.getDay()===0||tt.getDay()===6;ie.push(c.jsx("line",{x1:_e*Oi,y1:0,x2:_e*Oi,y2:_.length*Pi,stroke:Xe?"#f3f4f6":"#e5e7eb",strokeWidth:1},`line - ${_e} `)),_e%1===0&&Fe.push(c.jsxs("div",{className:"absolute top-0 flex flex-col items-center justify-end pb-2 text-xs text-gray-500 border-r border-gray-100",style:{left:_e*Oi,width:Oi,height:By},children:[c.jsx("span",{className:"font-bold",children:tt.getDate()}),c.jsx("span",{className:"text-[10px]",children:["","","","","","",""][tt.getDay()]})]},`head - ${_e} `))}return{lines:ie,days:Fe}},We=()=>{var Fe,_e;const ie=[];if(_.forEach(tt=>{tt.dependencies&&tt.dependencies.forEach(Xe=>{const Ve=N(Xe);if(Ve){const it=Ve.due_date?W(new Date(Ve.due_date),O):0,Ue=tt.start_date?W(new Date(tt.start_date),O):0,K=_.findIndex(Pe=>Pe.id===Ve.id),ue=_.findIndex(Pe=>Pe.id===tt.id),re=(it+1)*Oi,oe=K*Pi+Pi/2,pe=Ue*Oi,se=ue*Pi+Pi/2,Se=`M ${re} ${oe} C ${re+20} ${oe}, ${pe-20} ${se}, ${pe} ${se} `;ie.push(c.jsx("g",{className:"group cursor-pointer pointer-events-auto",onClick:Pe=>{var ze;if(Pe.stopPropagation(),window.confirm(`Remove dependency: ${Ve.title} -> ${tt.title}?`)&&tt.id){const Ze=(ze=tt.dependencies)==null?void 0:ze.filter(vt=>vt!==Ve.id),gt=M(t,tt.id,{dependencies:Ze});e(gt)}},children:c.jsx("path",{d:Se,fill:"none",stroke:"#94a3b8",strokeWidth:"2",markerEnd:"url(#arrowhead)",className:"group-hover:stroke-red-500"})},`${Ve.id} -${tt.id} `))}})}),u){const tt=N(u);if(tt&&D.current){const Xe=tt.due_date?W(new Date(tt.due_date),O):0,Ve=_.findIndex(se=>se.id===tt.id),it=((Fe=k.current)==null?void 0:Fe.scrollLeft)||0,Ue=((_e=k.current)==null?void 0:_e.scrollTop)||0,K=(Xe+1)*Oi,ue=Ve*Pi+Pi/2,re=g.x+it-Uy,oe=g.y+Ue-By,pe=`M ${K} ${ue} L ${re} ${oe} `;ie.push(c.jsx("path",{d:pe,stroke:"#6366f1",strokeWidth:"2",strokeDasharray:"5,5"},"drawing"))}}return ie},{lines:ft,days:le}=ne(),De=We();return c.jsxs("div",{className:"flex flex-col h-full border rounded-lg overflow-hidden bg-white select-none",ref:D,onMouseMove:we,children:[c.jsxs("div",{className:"flex border-b",children:[c.jsx("div",{style:{width:Uy},className:"flex-shrink-0 border-r bg-gray-50 flex items-center px-4 font-bold text-gray-700",children:""}),c.jsx("div",{className:"flex-1 overflow-hidden relative",style:{height:By},children:c.jsx("div",{className:"absolute inset-0",ref:ie=>{ie&&k.current&&(ie.scrollLeft=k.current.scrollLeft)},children:le})})]}),c.jsxs("div",{className:"flex flex-1 overflow-auto",ref:k,children:[c.jsx("div",{style:{width:Uy},className:"flex-shrink-0 border-r bg-white sticky left-0 z-10",children:_.map((ie,Fe)=>c.jsxs("div",{style:{height:Pi,paddingLeft:ie.depth*20},className:`flex flex-col justify-center px-4 border-b border-gray-50 bg-white cursor-pointer hover:bg-gray-50 transition-colors ${r===ie.id?"!bg-indigo-50 border-l-4 border-l-indigo-500":""}`,onClick:()=>ie.id&&s(ie.id),onDoubleClick:()=>ie.id&&(n==null?void 0:n(ie.id)),children:[c.jsx("span",{className:"truncate text-sm text-gray-700 font-medium",children:ie.title}),c.jsxs("span",{className:"text-[10px] text-gray-400",children:[ie.start_date?ie.start_date.split("T")[0].slice(5).replace("-","/"):"",ie.start_date&&ie.due_date&&ie.start_date.split("T")[0]!==ie.due_date.split("T")[0]?` - ${ie.due_date.split("T")[0].slice(5).replace("-","/")}`:""]})]},Fe))}),c.jsxs("div",{className:"relative",style:{width:P*Oi,height:_.length*Pi},children:[c.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",children:[c.jsx("defs",{children:c.jsx("marker",{id:"arrowhead",markerWidth:"5",markerHeight:"3.5",refX:"4",refY:"1.75",orient:"auto",children:c.jsx("polygon",{points:"0 0, 5 1.75, 0 3.5",fill:"#94a3b8"})})}),ft,De]}),_.map((ie,Fe)=>{const _e=ie.start_date?W(new Date(ie.start_date),O):-1;if(_e<0)return null;const tt=ie.due_date?Math.max(1,W(new Date(ie.due_date),O)-_e+1):1,Xe=_e*Oi,Ve=tt*Oi;return c.jsxs("div",{className:`absolute rounded-md shadow-sm border border-indigo-600 bg-indigo-500 hover:bg-indigo-600 group flex items-center justify-between px-2 transition-colors ${u&&u!==ie.id?"ring-2 ring-indigo-300 ring-offset-1 z-20 cursor-crosshair":""} ${r===ie.id?"ring-2 ring-white ring-offset-2 ring-offset-indigo-500":""}`,style:{left:Xe,top:Fe*Pi+6,width:Ve,height:Pi-12,cursor:u?"crosshair":"grab"},onMouseDown:it=>Q(it,ie),onMouseUp:it=>{u&&(it.stopPropagation(),F(it,ie))},onDoubleClick:it=>{it.stopPropagation(),n&&ie.id&&n(ie.id)},children:[c.jsx("div",{className:`w-4 h-4 bg-white border-2 border-indigo-500 rounded-full cursor-cell absolute -left-2 top-1/2 -translate-y-1/2 hover:scale-125 transition-transform z-30 shadow-sm flex items-center justify-center ${u&&u!==ie.id?"opacity-100 animate-pulse scale-110":"opacity-0"}`,onMouseUp:it=>F(it,ie),children:c.jsx("div",{className:"w-1.5 h-1.5 bg-indigo-500 rounded-full"})}),c.jsx("span",{className:"text-xs text-white font-medium truncate pointer-events-none select-none drop-shadow-sm",children:Ve>30&&ie.title}),c.jsx("div",{className:`w-4 h-4 bg-indigo-500 border-2 border-white rounded-full cursor-crosshair absolute -right-2 top-1/2 -translate-y-1/2 hover:scale-125 transition-transform z-30 shadow-sm ${u?"opacity-0":"opacity-0 group-hover:opacity-100"}`,onMouseDown:it=>Te(it,ie)}),c.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-3 cursor-ew-resize hover:bg-black/10 z-40 rounded-l-md",onMouseDown:it=>A(it,ie,"start")}),c.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-3 cursor-ew-resize hover:bg-black/10 z-40 rounded-r-md",onMouseDown:it=>A(it,ie,"end")})]},ie.id)})]})]}),c.jsxs("div",{className:"h-6 bg-gray-50 border-t flex items-center px-4 text-xs text-gray-400 gap-4",children:[c.jsx("span",{children:""}),c.jsx("span",{children:""}),c.jsx("span",{children:""}),c.jsx("span",{children:""})]})]})},Uee="",Hee=({isOpen:t,onClose:e,position:n,customPrompt:r,setCustomPrompt:s,onRun:i,prompts:o,saveToLibrary:a,setSaveToLibrary:l,isLoading:u,history:d,historyIndex:f,setHistoryIndex:h,onDeleteHistory:p,onUpdateHistory:m,onReplace:y,onInsert:x})=>{const[g,v]=b.useState(""),[w,T]=b.useState("prompt"),[D,k]=b.useState(!1),[I,C]=b.useState("");b.useEffect(()=>{u?T("result"):d.length>0&&f>=0?(T("result"),C(d[f].content)):T("prompt")},[u,d.length,f]);const S=o.filter(O=>O.title.toLowerCase().includes(g.toLowerCase())||O.description&&O.description.toLowerCase().includes(g.toLowerCase()));if(!t)return null;const _=n?Math.max(10,Math.min(n.top,window.innerHeight-500)):100,N=n?Math.min(n.left,window.innerWidth-420):window.innerWidth/2-200,j=d[f];return tr.createPortal(c.jsx(go,{children:c.jsxs(Rr.div,{initial:{opacity:0,y:10,left:N,top:_},animate:{opacity:1,y:0,left:N,top:_},exit:{opacity:0,scale:.95},drag:!0,dragMomentum:!1,className:"fixed w-[400px] bg-white rounded-xl shadow-2xl border border-gray-100 flex flex-col overflow-hidden z-[99999]",style:{position:"fixed"},children:[c.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-100 bg-white cursor-move",children:[c.jsxs("h3",{className:"text-sm font-bold text-slate-800 flex items-center gap-2 pointer-events-none",children:[c.jsx(Is,{className:"text-indigo-500",size:16}),"AI "]}),c.jsxs("div",{className:"flex items-center gap-1",children:[w==="result"&&!u&&c.jsx("button",{onClick:()=>T("prompt"),className:"p-1 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"",children:c.jsx(Is,{size:14})}),c.jsx("button",{onClick:O=>{O.stopPropagation(),e()},className:"text-slate-400 hover:text-slate-600 transition-colors p-1 hover:bg-slate-100 rounded-full",children:c.jsx(rn,{size:16})})]})]}),c.jsx("div",{className:"flex-1 overflow-hidden flex flex-col bg-slate-50/50",children:w==="prompt"?c.jsxs("div",{className:"p-4 space-y-4",children:[c.jsx("input",{type:"text",placeholder:"...",className:"w-full px-3 py-2 text-xs bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-100 outline-none",value:g,onChange:O=>v(O.target.value),onKeyDown:O=>O.stopPropagation(),autoFocus:!0}),!g&&S.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1.5",children:S.slice(0,5).map(O=>c.jsx("button",{onClick:()=>{s(O.description||O.title),v("")},className:"text-[10px] px-2 py-1 rounded-full bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-100 font-medium",children:O.title},O.id))}),c.jsx("textarea",{className:"w-full h-32 p-3 text-sm bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-100 outline-none resize-none",placeholder:"...",value:r,onChange:O=>s(O.target.value),onKeyDown:O=>O.stopPropagation()}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"checkbox",id:"saveToLib",checked:a,onChange:O=>l(O.target.checked),className:"w-3.5 h-3.5 rounded text-indigo-600"}),c.jsx("label",{htmlFor:"saveToLib",className:"text-xs text-slate-500 select-none",children:""})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:()=>i(Uee),className:"flex-1 py-2 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 rounded-xl text-xs font-bold border border-indigo-200 flex items-center justify-center gap-1",children:[c.jsx(Is,{size:14})," "]}),c.jsx("button",{onClick:()=>i(r),disabled:!r.trim(),className:"flex-[2] py-2 bg-slate-800 hover:bg-slate-900 text-white rounded-xl text-xs font-bold disabled:opacity-50",children:""})]})]}):c.jsx("div",{className:"flex flex-col h-auto max-h-[60vh]",children:u?c.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-4 text-slate-400",children:[c.jsx(cd,{size:32,className:"text-indigo-400 animate-pulse"}),c.jsx("span",{className:"text-xs font-bold",children:"..."})]}):j?c.jsxs(c.Fragment,{children:[d.length>1&&c.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-white border-b border-gray-50",children:[c.jsxs("span",{className:"text-[10px] font-bold text-gray-400",children:[f+1," / ",d.length]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:()=>h(Math.max(0,f-1)),disabled:f===0,className:"p-1 hover:bg-gray-100 rounded disabled:opacity-30",children:c.jsx(Mu,{size:14})}),c.jsx("button",{onClick:()=>h(Math.min(d.length-1,f+1)),disabled:f===d.length-1,className:"p-1 hover:bg-gray-100 rounded disabled:opacity-30",children:c.jsx(ns,{size:14})}),c.jsx("div",{className:"w-px h-3 bg-gray-200 mx-1"}),c.jsx("button",{onClick:()=>p(f),className:"p-1 hover:bg-red-50 text-gray-400 hover:text-red-500 rounded",children:c.jsx(Mr,{size:14})})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar bg-white",children:D?c.jsx("textarea",{className:"w-full h-full min-h-[150px] p-2 text-sm border border-indigo-200 rounded-lg focus:ring-2 focus:ring-indigo-100 outline-none resize-none",value:I,onChange:O=>C(O.target.value),onKeyDown:O=>O.stopPropagation()}):c.jsx("div",{className:"prose prose-sm max-w-none prose-indigo",children:c.jsx(ik,{children:j.content})})}),c.jsx("div",{className:"p-3 bg-gray-50 border-t border-gray-100 space-y-2",children:D?c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:()=>{m(f,I),k(!1)},className:"flex-1 py-1.5 bg-indigo-600 text-white rounded-lg text-xs font-bold flex items-center justify-center gap-1",children:[c.jsx(Gn,{size:12})," "]}),c.jsx("button",{onClick:()=>k(!1),className:"px-3 py-1.5 bg-gray-200 text-gray-600 rounded-lg text-xs font-bold",children:""})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("button",{onClick:()=>y(j.content),className:"py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-xs font-bold shadow-sm active:scale-95 flex items-center justify-center gap-1.5",children:[c.jsx(n1,{size:12})," "]}),c.jsxs("button",{onClick:()=>x(j.content),className:"py-2 bg-white hover:bg-gray-50 text-gray-700 border border-gray-200 rounded-lg text-xs font-bold shadow-sm active:scale-95 flex items-center justify-center gap-1.5",children:[c.jsx(Gf,{size:12})," "]})]}),c.jsxs("div",{className:"flex gap-2 justify-end",children:[c.jsxs("button",{onClick:()=>{C(j.content),k(!0)},className:"px-2 py-1 text-[10px] text-gray-500 hover:text-indigo-600 flex items-center gap-1",children:[c.jsx(Nw,{size:10})," "]}),c.jsxs("button",{onClick:()=>navigator.clipboard.writeText(j.content),className:"px-2 py-1 text-[10px] text-gray-500 hover:text-indigo-600 flex items-center gap-1",children:[c.jsx(SI,{size:10})," "]})]})]})})]}):null})})]},"ai-assistant-modal")}),document.body)},Vee=()=>{const{tasks:t,tags:e,themeSettings:n,updateTask:r,setEditingTaskId:s,editingTaskId:i,addTask:o,addTag:a,setView:l,batchUpdateTasks:u,batchDeleteTasks:d}=b.useContext(Tn),[f,h]=b.useState(null),[p,m]=b.useState(null),[y,x]=b.useState(null),[g,v]=b.useState("list"),[w,T]=b.useState(()=>{const G=localStorage.getItem("projectCardSize");return G?parseInt(G):280}),[D,k]=b.useState(()=>{const G=localStorage.getItem("projectOrder");return G?JSON.parse(G):[]});b.useEffect(()=>{const G=localStorage.getItem("openProjectId"),ae=localStorage.getItem("previousView");G&&(h(G),localStorage.removeItem("openProjectId")),ae&&(x(ae),localStorage.removeItem("previousView"))},[]);const I=b.useMemo(()=>e.find(G=>G.name.toLowerCase()==="project"),[e]),C=b.useMemo(()=>I?t.filter(ae=>!ae.tags.includes(I.id)||ae.status==="deleted"||ae.status==="logged"?!1:t.some(Y=>Y.parent_id===ae.id&&Y.status!=="deleted")).map(ae=>{const Ae=t.filter(Ie=>Ie.parent_id===ae.id&&Ie.status!=="deleted").length,Y=t.filter(Ie=>Ie.parent_id===ae.id&&Ie.status==="completed").length;return{id:ae.id,title:ae.title,description:ae.description,color:ae.color||"blue",tags:ae.tags,start_date:ae.start_date,due_date:ae.due_date,childCount:Ae,completedCount:Y,coverImage:ae.images&&ae.images.length>0?ae.images[0]:ae.cover_image,order:ae.project_order||0}}):[],[t,I]),S=b.useMemo(()=>e.filter(G=>G.name.includes("")).map(G=>G.id),[e]),_=b.useMemo(()=>D.length===0?[...C].sort((G,ae)=>{const Ae=G.tags.some(Ie=>S.includes(Ie)),Y=ae.tags.some(Ie=>S.includes(Ie));return Ae&&!Y?-1:!Ae&&Y?1:0}):[...C].sort((G,ae)=>{const Ae=D.indexOf(G.id),Y=D.indexOf(ae.id);return Ae===-1&&Y===-1?0:Ae===-1?1:Y===-1?-1:Ae-Y}),[C,D,S]);b.useEffect(()=>{localStorage.setItem("projectCardSize",w.toString())},[w]);const N=b.useCallback(G=>{const ae=G.map(Ae=>Ae.id);k(ae),localStorage.setItem("projectOrder",JSON.stringify(ae))},[]),[j,O]=b.useState(null),[P,W]=b.useState(null),R=b.useRef(new Map),M=b.useCallback((G,ae)=>{ae?R.current.set(G,ae):R.current.delete(G)},[]),X=b.useCallback((G,ae,Ae)=>{let Y=null,Ie=1/0;return R.current.forEach((Le,ct)=>{if(ct===Ae)return;const Rt=Le.getBoundingClientRect(),Cn=Rt.left+Rt.width/2,Ot=Rt.top+Rt.height/2,nn=Math.sqrt(Math.pow(G-Cn,2)+Math.pow(ae-Ot,2));nn<Ie&&(Ie=nn,Y=ct)}),Y},[]),Q=b.useCallback(G=>{if(G.preventDefault(),!j)return;const ae=X(G.clientX,G.clientY,j);W(ae)},[j,X]),A=b.useCallback(G=>{if(G.preventDefault(),!j||!P||j===P){O(null),W(null);return}const ae=_.findIndex(ct=>ct.id===j),Ae=_.findIndex(ct=>ct.id===P);if(ae===-1||Ae===-1){O(null),W(null);return}const Y=[..._],[Ie]=Y.splice(ae,1),Le=Y.findIndex(ct=>ct.id===P);Y.splice(Le+1,0,Ie),N(Y),O(null),W(null)},[j,P,_,N]),Te=b.useCallback(()=>{O(null),W(null)},[]),we=async G=>{window.confirm(`
`)&&(await r(G,{status:"deleted"}),p===G&&m(null))},B=async()=>{let G=I==null?void 0:I.id;if(G||(G=await a("project")||void 0),!G){console.error("Failed to create project tag");return}const ae=await o({title:"",tags:[G],status:"todo"});ae&&(await o({title:"",parent_id:ae,status:"todo"}),h(ae))},F=f?t.find(G=>G.id===f):null,ne=n.fontFamily==="things"?"font-things":"font-sans",We=b.useRef(null),[ft,le]=b.useState(null),[De,ie]=b.useState(null),[Fe,_e]=b.useState(!1),[tt,Xe]=b.useState(""),[Ve,it]=b.useState(!1),[Ue,K]=b.useState(!1),[ue,re]=b.useState([]),[oe,pe]=b.useState(-1);b.useEffect(()=>{F!=null&&F.ai_history?(re(F.ai_history),pe(F.ai_history.length-1)):(re([]),pe(-1))},[F==null?void 0:F.id,F==null?void 0:F.ai_history]);const se=b.useMemo(()=>{if(!f)return[];t.filter(Y=>Y.parent_id===f&&Y.status!=="deleted").sort((Y,Ie)=>(Y.order_index||0)-(Ie.order_index||0));const ae=Y=>t.filter(Le=>Le.parent_id===Y&&Le.status!=="deleted").sort((Le,ct)=>(Le.order_index||0)-(ct.order_index||0)).map(Le=>({id:Le.id,title:Le.title,description:Le.description||void 0,start_date:Le.start_date,due_date:Le.due_date,dependencies:Le.dependencies||[],subtasks:ae(Le.id)}));return[{id:f,title:(F==null?void 0:F.title)||"Project",start_date:F==null?void 0:F.start_date,due_date:F==null?void 0:F.due_date,description:(F==null?void 0:F.description)||void 0,dependencies:[],subtasks:ae(f)}]},[f,t,F]),Se=async G=>{const ae=Ot=>{let nn=[];return Ot.forEach(cn=>{nn.push(cn),cn.subtasks&&(nn=nn.concat(ae(cn.subtasks)))}),nn},Ae=ae(G),Y=new Set(Ae.map(Ot=>Ot.id).filter(Boolean)),Ie=Ot=>{const nn=t.filter(Ee=>Ee.parent_id===Ot&&Ee.status!=="deleted");let cn=[...nn];return nn.forEach(Ee=>{cn=cn.concat(Ie(Ee.id))}),cn},ct=Ie(f).filter(Ot=>!Y.has(Ot.id)).map(Ot=>Ot.id);ct.length>0&&await d(ct);const Rt=[];for(const Ot of Ae){if(!Ot.id||Ot.id===f)continue;const nn=t.find(un=>un.id===Ot.id);if(!nn)continue;const cn={};let Ee=!1;Ot.start_date!==nn.start_date&&(cn.start_date=Ot.start_date,Ee=!0),Ot.due_date!==nn.due_date&&(cn.due_date=Ot.due_date,Ee=!0);const Tt=Ot.dependencies||[],Ft=nn.dependencies||[],Lt=[...Tt].sort(),Wt=[...Ft].sort();(Lt.length!==Wt.length||!Lt.every((un,rr)=>un===Wt[rr]))&&(cn.dependencies=Ot.dependencies,Ee=!0),Ee&&Rt.push({id:Ot.id,data:cn})}Rt.length>0&&await u(Rt);const Cn=Ae.filter(Ot=>!Ot.id);for(const Ot of Cn)await o({title:Ot.title||"New Task",parent_id:f,start_date:Ot.start_date,due_date:Ot.due_date,status:"todo"})},Pe=b.useMemo(()=>{const G=e.find(ae=>ae.name.toLowerCase()==="prompt");return G?t.filter(ae=>ae.tags.includes(G.id)&&ae.status!=="deleted"):[]},[t,e]),ye=async G=>{let ae="";if(ft&&We.current?ae=We.current.state.doc.textBetween(ft.from,ft.to," "):We.current?ae=We.current.getText():ae=((F==null?void 0:F.description)||"").replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),!ae.trim()){alert("");return}K(!0),_e(!0);try{if(Ve&&tt.trim()){const Le=e.find(Rt=>Rt.name.trim().toLowerCase()==="prompt");let ct=Le==null?void 0:Le.id;if(ct||(ct=await a("prompt")||void 0),ct){const Rt=await P5(tt);await o({title:Rt,description:tt,tags:[ct],status:"active"})}}const Ae=await O5(ae,(F==null?void 0:F.title)||"",G),Y={id:crypto.randomUUID(),role:"assistant",content:Ae.fullResponse,created_at:new Date().toISOString(),prompt:G||"AI Analysis",model:"gemini"},Ie=[...ue,Y];re(Ie),pe(Ie.length-1),f&&r(f,{ai_history:Ie},[],{skipHistory:!0}),Xe("")}catch(Ae){console.error(Ae),alert("AI Error: "+(Ae.message||"Unknown error"))}finally{K(!1)}},ze=G=>{if(We.current&&ft){We.current.chain().setTextSelection({from:ft.from,to:ft.to}).unsetHighlight().insertContent(G).run();const ae=We.current.getHTML();fe(ae),le(null),_e(!1)}else We.current&&alert("")},Ze=G=>{if(We.current){We.current.commands.insertContent(G);const ae=We.current.getHTML();fe(ae),_e(!1)}},gt=G=>{const ae=ue.filter((Ae,Y)=>Y!==G);re(ae),ae.length===0?pe(-1):pe(Math.min(oe,ae.length-1)),f&&r(f,{ai_history:ae},[],{skipHistory:!0})},vt=(G,ae)=>{const Ae=[...ue];Ae[G]={...Ae[G],content:ae},re(Ae),f&&r(f,{ai_history:Ae},[],{skipHistory:!0})},[me,He]=b.useState(!1),[qe,nt]=b.useState(350),[Me,ut]=b.useState(!1),[ee,fe]=b.useState(""),[q,Z]=b.useState(!1),[ge,xe]=b.useState(""),be=b.useRef(null),ve=b.useRef(F==null?void 0:F.description);b.useEffect(()=>{if(f){const G=localStorage.getItem(`projectNotesHeight_${f}`);nt(G?parseInt(G):350)}},[f]),b.useEffect(()=>{(F==null?void 0:F.description)!==void 0&&F.description!==ve.current&&(fe(F.description||""),ve.current=F.description)},[F==null?void 0:F.description]),b.useEffect(()=>{fe((F==null?void 0:F.description)||""),ve.current=F==null?void 0:F.description,F!=null&&F.description&&He(!0)},[f]),b.useEffect(()=>{const G=setTimeout(()=>{f&&F&&ee!==F.description&&r(f,{description:ee})},500);return()=>clearTimeout(G)},[ee,f]),b.useEffect(()=>{if(!Me)return;const G=Ae=>{const Y=Math.max(100,Math.min(800,Ae.clientY-200));nt(Y)},ae=()=>{ut(!1),f&&localStorage.setItem(`projectNotesHeight_${f}`,qe.toString())};return window.addEventListener("mousemove",G),window.addEventListener("mouseup",ae),()=>{window.removeEventListener("mousemove",G),window.removeEventListener("mouseup",ae)}},[Me,qe,f]);const[ot,et]=b.useState(null);if(b.useEffect(()=>{if(!F){et(null);return}const G=F.images&&F.images.length>0?F.images[0]:F.cover_image;if(!G){et(null);return}const ae=new window.Image;ae.crossOrigin="Anonymous",ae.src=G,ae.onload=()=>{try{const Ae=document.createElement("canvas"),Y=Ae.getContext("2d");if(!Y)return;Ae.width=50,Ae.height=50,Y.drawImage(ae,0,0,50,50);const Ie=Y.getImageData(0,0,50,50).data,Le={};for(let Rt=0;Rt<Ie.length;Rt+=4){const Cn=Ie[Rt],Ot=Ie[Rt+1],nn=Ie[Rt+2];if(Ie[Rt+3]<200||Cn>240&&Ot>240&&nn>240)continue;const Ee=20,Tt=Math.floor(Cn/Ee)*Ee,Ft=Math.floor(Ot/Ee)*Ee,Lt=Math.floor(nn/Ee)*Ee,Wt=`${Tt},${Ft},${Lt}`;Le[Wt]=(Le[Wt]||0)+1}const ct=Object.entries(Le).sort(([,Rt],[,Cn])=>Cn-Rt).map(([Rt])=>Rt);if(ct.length>0){const Rt=Ee=>{const[Tt,Ft,Lt]=Ee.split(",").map(Number);return Math.max(Tt,Ft,Lt)-Math.min(Tt,Ft,Lt)},Ot=ct.slice(0,15).sort((Ee,Tt)=>Rt(Tt)-Rt(Ee)),nn=Ot[0],cn=Ot[1]||nn;et(`linear-gradient(135deg, rgba(${nn}, 0.25) 0%, rgba(${cn}, 0.2) 100%)`)}else et(null)}catch(Ae){console.warn("Gradient extraction failed:",Ae),et(null)}},ae.onerror=()=>et(null)},[F]),f&&F){const G=Kn[F.color]||Kn.blue,ae=C.find(Ae=>Ae.id===f);return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main",children:[c.jsxs("div",{className:"flex items-center gap-4 px-6 py-4 border-b relative transition-[background] duration-500 bg-theme-header",style:{borderBottomColor:G.color+"30",backgroundImage:ot||"none"},children:[c.jsx("button",{onClick:()=>{y?(l(y),x(null)):h(null)},className:"p-2 rounded-lg bg-transparent hover:bg-theme-hover text-theme-secondary hover:text-theme-primary transition-colors",title:y?"":"",children:c.jsx(vI,{size:20})}),c.jsx("div",{className:"flex-1 min-w-0",children:q?c.jsx("input",{ref:be,type:"text",value:ge,onChange:Ae=>xe(Ae.target.value),onKeyDown:Ae=>{Ae.key==="Enter"?(Ae.preventDefault(),ge.trim()&&f&&r(f,{title:ge.trim()}),Z(!1)):Ae.key==="Escape"&&(Z(!1),xe(F.title))},onBlur:()=>{ge.trim()&&ge!==F.title&&f&&r(f,{title:ge.trim()}),Z(!1)},className:`text-xl font-bold text-theme-primary ${ne} w-full bg-transparent border-b-2 border-indigo-400 outline-none`,autoFocus:!0}):c.jsx("h1",{className:`text-xl font-bold text-theme-primary ${ne} truncate cursor-pointer hover:text-indigo-600 transition-colors`,onClick:()=>{xe(F.title),Z(!0),setTimeout(()=>{var Ae;return(Ae=be.current)==null?void 0:Ae.select()},0)},title:"",children:F.title})}),c.jsxs("div",{className:"px-3 py-1 rounded-full text-xs font-bold flex-shrink-0",style:{backgroundColor:G.color+"20",color:G.color},children:[(ae==null?void 0:ae.childCount)||0," "]}),c.jsxs("button",{onClick:()=>s(f),className:"flex items-center gap-1.5 px-3 py-1.5 bg-theme-hover hover:bg-theme-card rounded-lg text-sm text-theme-secondary hover:text-theme-primary transition-colors",title:"",children:[c.jsx(Nw,{size:14}),""]}),c.jsxs("div",{className:"flex items-center gap-1 bg-theme-hover p-0.5 rounded-lg ml-2",children:[c.jsx("button",{onClick:()=>v("list"),className:`p-1.5 rounded-md transition-all ${g==="list"?"bg-white shadow-sm text-indigo-500":"text-gray-400 hover:text-gray-600"}`,title:"",children:c.jsx(vz,{size:16})}),c.jsx("button",{onClick:()=>v("gantt"),className:`p-1.5 rounded-md transition-all ${g==="gantt"?"bg-white shadow-sm text-indigo-500":"text-gray-400 hover:text-gray-600"}`,title:"",children:c.jsx(pz,{size:16})})]})]}),F.description&&c.jsxs("div",{className:"border-b bg-theme-hover",style:{borderBottomColor:G.color+"30"},children:[c.jsx("div",{className:"flex items-center gap-2 px-6 py-1 cursor-pointer hover:bg-theme-card transition-colors",onClick:()=>He(!me),children:c.jsx(Rr.div,{animate:{rotate:me?90:0},transition:{duration:.15},children:c.jsx(ns,{size:16,className:"text-gray-400"})})}),me&&c.jsxs("div",{className:"relative",children:[c.jsxs("div",{className:"px-6 pb-3 overflow-y-auto custom-scrollbar transition-all duration-200 relative group",style:{height:qe},onKeyDown:Ae=>Ae.stopPropagation(),children:[c.jsx(Bv,{onEditorReady:Ae=>{We.current=Ae},onPolish:(Ae,Y,Ie)=>{le(Y),Ie&&ie(Ie),_e(!0),Xe("")},initialContent:ee,onChange:fe,editable:!0,descFontClass:"font-extralight",textSizeClass:"text-sm",className:"min-h-full pb-8 text-theme-secondary"}),c.jsx("button",{onClick:Ae=>{Ae.stopPropagation(),He(!1)},className:"absolute bottom-2 right-6 p-1.5 rounded-full bg-theme-main/80 hover:bg-theme-hover text-gray-400 hover:text-theme-secondary transition-all opacity-0 group-hover:opacity-100 flex items-center gap-1 text-xs font-medium backdrop-blur-sm z-10 border border-theme shadow-sm",title:"",children:c.jsx(ns,{size:14,className:"-rotate-90"})})]}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1.5 cursor-ns-resize hover:bg-indigo-200 transition-colors group",onMouseDown:()=>ut(!0),children:c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-0 w-8 h-1 rounded-full bg-gray-300 group-hover:bg-indigo-400 transition-colors"})})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden relative",children:g==="list"?c.jsx(bR,{rootParentId:f}):c.jsx("div",{className:"h-full w-full",children:c.jsx(SR,{plan:se,onUpdatePlan:Se,onEditTask:Ae=>s(Ae)})})}),i===f&&F&&c.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center bg-theme-main/95 backdrop-blur-sm overflow-y-auto pt-20",children:[c.jsx("div",{className:"w-full max-w-3xl px-4 pb-20",children:c.jsx(Ro,{initialData:F,onClose:()=>s(null)})}),c.jsx("button",{onClick:()=>s(null),className:"absolute top-6 right-6 p-2 text-gray-400 hover:text-theme-secondary rounded-full hover:bg-theme-hover transition-colors",children:c.jsx(rn,{size:24})})]}),c.jsx(Hee,{isOpen:Fe,onClose:()=>_e(!1),position:De||void 0,customPrompt:tt,setCustomPrompt:Xe,onRun:ye,prompts:Pe,saveToLibrary:Ve,setSaveToLibrary:it,isLoading:Ue,history:ue,historyIndex:oe,setHistoryIndex:pe,onDeleteHistory:gt,onUpdateHistory:vt,onReplace:ze,onInsert:Ze})]})}return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main",children:[c.jsxs("div",{className:"flex items-center justify-between px-6 py-4 bg-theme-header backdrop-blur-sm border-b border-gray-200/50",children:[c.jsxs("div",{children:[c.jsx("h1",{className:`text-xl font-bold text-theme-primary ${ne}`,children:""}),c.jsxs("p",{className:"text-xs text-theme-secondary mt-0.5",children:[C.length," "]})]}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("button",{onClick:B,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg text-sm font-medium transition-colors shadow-sm",children:[c.jsx(fz,{size:16}),""]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(Az,{size:14,className:"text-gray-400"}),c.jsx("input",{type:"range",min:180,max:400,value:w,onChange:G=>T(parseInt(G.target.value)),className:"w-24 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"}),c.jsxs("span",{className:"text-xs text-theme-secondary w-12",children:[w,"px"]})]})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6",onClick:()=>m(null),children:C.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx("div",{className:"w-24 h-24 bg-theme-hover rounded-2xl flex items-center justify-center mb-4",children:c.jsx(om,{size:40,className:"opacity-30"})}),c.jsx("p",{className:"text-lg font-medium",children:""}),c.jsx("p",{className:"text-sm mt-1",children:"project"})]}):c.jsx(YB,{children:c.jsx("div",{className:"flex flex-wrap gap-5",style:{display:"flex",flexWrap:"wrap",gap:"20px"},onDragOver:Q,onDrop:A,children:_.map(G=>c.jsx(Wee,{project:G,size:w,tags:e,isSelected:p===G.id,isDragging:j===G.id,isDropTarget:P===G.id,onSelect:()=>m(G.id),onDoubleClick:()=>h(G.id),onDelete:()=>we(G.id),onDragStart:()=>O(G.id),onDragEnd:Te,registerRef:M,fontFamilyClass:ne},G.id))})})})]})},Wee=({project:t,size:e,tags:n,isSelected:r,isDragging:s,isDropTarget:i,onSelect:o,onDoubleClick:a,onDragStart:l,onDragEnd:u,registerRef:d,fontFamilyClass:f})=>{const h=Kn[t.color]||Kn.blue,p=b.useMemo(()=>t.tags.some(w=>{const T=n.find(D=>D.id===w);return T&&T.name.includes("")}),[t.tags,n]),m=t.childCount>0?t.completedCount/t.childCount:0,y=10,x=2*Math.PI*y,g=x-m*x,v=w=>{w.dataTransfer.effectAllowed="move",w.dataTransfer.setData("text/plain",t.id),l()};return c.jsx(Rr.div,{layout:!0,layoutId:t.id,transition:{layout:{type:"spring",stiffness:350,damping:25,mass:.8}},ref:w=>d(t.id,w),draggable:!0,onDragStart:v,onDragEnd:u,className:`relative transition-opacity duration-200 ${s?"opacity-50 scale-95":""}`,style:{width:e,...i&&{marginRight:"8px",borderRight:"4px solid #6366f1"}},onDoubleClick:w=>{w.stopPropagation(),a()},children:c.jsx(Rr.div,{onClick:w=>{w.stopPropagation(),s||o()},className:`
                    relative rounded-[20px] overflow-hidden cursor-pointer group flex flex-col
                    bg-white dark:bg-gray-800 
                    shadow-[0_2px_8px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)]
                    border border-gray-100 dark:border-gray-700
                    transition-all duration-300 ease-out
                    ${r?"ring-2 ring-indigo-500 shadow-md":""}
                    ${s?"ring-2 ring-indigo-400":""}
                    ${p?"ring-1 ring-yellow-400/50":""}
                `,style:{height:e*.75},whileHover:s?{}:{y:-4,scale:1.01},children:c.jsxs("div",{className:"p-5 flex flex-col h-full bg-gradient-to-br from-white to-gray-50/50 dark:from-gray-800 dark:to-gray-800/50",children:[c.jsxs("div",{className:"flex justify-between items-start mb-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-lg font-bold shadow-sm",style:{backgroundColor:p?"#fefce8":h.color+"15",color:p?"#ca8a04":h.color},children:p?c.jsx(Lz,{size:18}):t.title.charAt(0).toUpperCase()}),c.jsx("div",{className:"relative w-8 h-8 flex items-center justify-center",children:c.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[c.jsx("circle",{cx:"16",cy:"16",r:y,stroke:"currentColor",strokeWidth:"2.5",fill:"none",className:"text-gray-100 dark:text-gray-700"}),c.jsx("circle",{cx:"16",cy:"16",r:y,stroke:h.color,strokeWidth:"2.5",fill:"none",strokeDasharray:x,strokeDashoffset:g,strokeLinecap:"round",className:"transition-all duration-1000 ease-out"})]})})]}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:`font-bold text-[17px] text-gray-800 dark:text-gray-100 leading-tight mb-1 truncate ${f}`,children:t.title}),c.jsxs("p",{className:"text-[11px] font-medium text-gray-400 dark:text-gray-500 uppercase tracking-wide",children:[t.completedCount," / ",t.childCount," Completed"]})]}),c.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:c.jsx("div",{className:"p-1 rounded text-gray-300 hover:text-gray-500",children:c.jsx(EI,{size:14})})})]})})})},Hy=[{id:"learning",label:"",icon:mf,row:0,col:0,color:"from-blue-500 to-cyan-400"},{id:"experience",label:"",icon:iz,row:0,col:1,color:"from-purple-500 to-pink-400"},{id:"leisure",label:"",icon:sz,row:0,col:2,color:"from-green-500 to-emerald-400"},{id:"work",label:"",icon:Z6,row:1,col:0,color:"from-orange-500 to-amber-400"},{id:"core",label:"",icon:$I,row:1,col:1,color:"from-yellow-500 to-orange-400",isCenter:!0},{id:"family",label:"",icon:yz,row:1,col:2,color:"from-rose-500 to-pink-400"},{id:"social",label:"",icon:zz,row:2,col:0,color:"from-indigo-500 to-blue-400"},{id:"finance",label:"",icon:Fz,row:2,col:1,color:"from-emerald-500 to-teal-400"},{id:"health",label:"",icon:im,row:2,col:2,color:"from-red-500 to-rose-400"}],Kee=()=>{const{tasks:t,tags:e,themeSettings:n,setView:r}=b.useContext(Tn),[s,i]=b.useState(null),o=b.useMemo(()=>e.filter(h=>h.name.includes("")).map(h=>h.id),[e]),a=b.useMemo(()=>{const h={};return Hy.forEach(p=>{h[p.id]=e.filter(m=>m.name.includes(p.label)).map(m=>m.id)}),h},[e]),l=b.useMemo(()=>{const h=e.find(p=>p.name.toLowerCase()==="project");return h?t.filter(p=>{var m,y;return p.status!=="deleted"&&((m=p.tags)==null?void 0:m.includes(h.id))&&((y=p.tags)==null?void 0:y.some(x=>o.includes(x)))}).map(p=>({id:p.id,title:p.title,color:p.color||"blue",tags:p.tags||[]})):[]},[t,e,o]),u=b.useMemo(()=>{const h={};return Hy.forEach(p=>{h[p.id]=l.filter(m=>m.tags.some(y=>{var x;return(x=a[p.id])==null?void 0:x.includes(y)}))}),h},[l,a]),d=n.fontFamily==="things"?"font-things":"font-sans",f=h=>{localStorage.setItem("openProjectId",h),localStorage.setItem("previousView","annualplan"),r("project")};return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main",children:[c.jsx("div",{className:"flex items-center justify-between px-6 py-4 bg-theme-header backdrop-blur-sm border-b border-gray-200/50",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-xl shadow-lg",children:c.jsx(zI,{size:24,className:"text-white"})}),c.jsxs("div",{children:[c.jsx("h1",{className:`text-xl font-bold text-theme-primary ${d}`,children:""}),c.jsxs("p",{className:"text-xs text-theme-tertiary",children:[l.length," "]})]})]})}),c.jsx("div",{className:"flex-1 p-6 overflow-auto",onClick:()=>i(null),children:c.jsx("div",{className:"grid grid-cols-3 gap-4 h-full max-w-5xl mx-auto",children:Hy.map(h=>{const p=h.icon,m=u[h.id]||[];return c.jsxs(Rr.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:h.row*.1+h.col*.05},className:`
                                    relative rounded-2xl overflow-hidden
                                    bg-theme-card shadow-lg
                                    border border-gray-200/50 dark:border-gray-700/50
                                    ${h.isCenter?"ring-2 ring-yellow-400/50 shadow-yellow-100/30":""}
                                `,children:[c.jsxs("div",{className:`
                                    px-3 py-2 bg-gradient-to-r ${h.color}
                                    flex items-center gap-2
                                `,children:[c.jsx(p,{size:16,className:"text-white/90"}),c.jsx("span",{className:"text-sm font-bold text-white/95 drop-shadow-sm",children:h.label})]}),c.jsx("div",{className:"p-2 space-y-1 max-h-[calc(100%-40px)] overflow-y-auto",children:m.length===0?c.jsx("div",{className:"text-center py-4 text-theme-tertiary text-xs",children:""}):m.map(y=>{const x=Kn[y.color]||Kn.blue,g=s===y.id;return c.jsx(Rr.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:v=>{v.stopPropagation(),i(y.id)},onDoubleClick:v=>{v.stopPropagation(),f(y.id)},className:`
                                                        px-3 py-2 rounded-lg cursor-pointer
                                                        transition-all duration-150
                                                        ${g?"bg-indigo-100 dark:bg-indigo-900/30 ring-2 ring-indigo-500":"hover:bg-theme-hover"}
                                                    `,style:{borderLeft:`3px solid ${x.color}`},children:c.jsx("p",{className:`text-sm font-medium text-theme-primary line-clamp-2 ${d}`,children:y.title})},y.id)})}),m.length>0&&c.jsx("div",{className:"absolute top-2 right-2 px-2 py-0.5 bg-white/90 dark:bg-gray-800/90 rounded-full text-[10px] font-bold text-gray-600 dark:text-gray-300 shadow-sm",children:m.length})]},h.id)})})})]})},Gee=()=>{const{advancedFilters:t,setAdvancedFilters:e,tags:n,tagFilter:r}=b.useContext(Tn);if(!r)return null;const s=n.filter(l=>{let u=l;for(;u.parent_id;){if(u.parent_id===r)return!0;u=n.find(d=>d.id===u.parent_id)||{parent_id:null}}return!1}),i=l=>{l&&e(u=>({...u,additionalTags:u.additionalTags.includes(l)?u.additionalTags.filter(d=>d!==l):[...u.additionalTags,l]}))},o=()=>{e({additionalTags:[],startDate:null,dueDate:null,color:null})},a=t.additionalTags.length>0;return c.jsxs("div",{className:"px-8 py-3 border-b border-gray-50 bg-gray-50/30 flex items-center gap-4 relative z-20",children:[c.jsx("div",{className:"flex items-center gap-2",children:c.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Filters:"})}),c.jsx(j1,{icon:Pl,label:"Sub-tags",items:s,selectedIds:t.additionalTags,onSelect:i,multiSelect:!0,placeholder:"Filter by sub-tags..."}),a&&c.jsxs("button",{onClick:o,className:"ml-auto flex items-center gap-1 text-[10px] text-gray-400 hover:text-red-500 transition-colors",children:[c.jsx(rn,{size:12})," Clear"]})]})},qee=({toast:t,onClose:e})=>{const[n,r]=b.useState(!1);b.useEffect(()=>{requestAnimationFrame(()=>r(!0));const a=setTimeout(()=>{r(!1),setTimeout(e,300)},1e4);return()=>clearTimeout(a)},[t,e]);const s=()=>t.type==="error"?c.jsx(Kf,{size:16}):t.undo?c.jsx(ez,{size:16}):c.jsx(NI,{size:16}),i=()=>{t.onClick&&(t.onClick(),e())},o=a=>{a.stopPropagation(),r(!1),setTimeout(e,300)};return c.jsx("div",{className:`
                fixed top-4 left-1/2 -translate-x-1/2 z-[9999]
                transition-all duration-300 ease-out
                ${n?"opacity-100 translate-y-0":"opacity-0 -translate-y-4"}
            `,children:c.jsxs("div",{className:`
                    px-4 py-2.5 rounded-full shadow-lg flex items-center gap-3 backdrop-blur-md
                    ${t.type==="error"?"bg-red-500/90 text-white":"bg-gray-900/90 text-white"}
                    ${t.onClick?"cursor-pointer hover:bg-gray-800/95 transition-colors":""}
                `,onClick:t.onClick?i:void 0,children:[c.jsxs("div",{className:"flex items-center gap-2",children:[s(),c.jsx("span",{className:"text-sm font-medium",children:t.msg})]}),t.onClick&&!t.undo&&c.jsxs("div",{className:"flex items-center gap-1 text-xs text-white/70",children:[c.jsx(TI,{size:12}),c.jsx("span",{children:t.actionLabel||""})]}),t.undo&&c.jsxs("button",{onClick:a=>{var l;a.stopPropagation(),(l=t.undo)==null||l.call(t),e()},className:"flex items-center gap-1 px-2.5 py-1 bg-white/20 hover:bg-white/30 rounded-full text-xs font-bold transition-colors",children:[c.jsx(OI,{size:12}),"Undo"]}),c.jsx("button",{onClick:o,className:"p-1 -mr-1.5 rounded-full hover:bg-white/20 transition-colors",title:"",children:c.jsx(rn,{size:14})})]})})},_R=t=>t.map(e=>({...e,id:e.id||crypto.randomUUID(),subtasks:e.subtasks?_R(e.subtasks):[]})),Yee=({taskId:t,onClose:e})=>{const{tasks:n,tags:r,batchAddTasks:s,setToast:i}=b.useContext(Tn),[o,a]=b.useState("prompt"),[l,u]=b.useState(null),[d,f]=b.useState(null),[h,p]=b.useState(!1),[m,y]=b.useState(""),[x,g]=b.useState(""),[v,w]=b.useState("list"),[T,D]=b.useState([]),[k,I]=b.useState(-1);b.useEffect(()=>{l&&T.length===0&&(D([l]),I(0))},[l]);const C=M=>{const X=T.slice(0,k+1);X.push(M),D(X),I(X.length-1),u(M)},S=()=>{if(k>0){const M=k-1;I(M),u(T[M])}},_=()=>{if(k<T.length-1){const M=k+1;I(M),u(T[M])}};b.useEffect(()=>{const M=X=>{(X.metaKey||X.ctrlKey)&&X.key==="z"&&(X.preventDefault(),X.stopPropagation(),X.shiftKey?_():S())};return window.addEventListener("keydown",M,{capture:!0}),()=>window.removeEventListener("keydown",M,{capture:!0})},[k,T]);const N=n.find(M=>M.id===t),j=b.useMemo(()=>{const M=r.find(X=>X.name.trim().toLowerCase()==="prompt");return M?n.filter(X=>X.tags.includes(M.id)&&X.status!=="deleted"&&X.status!=="logged").sort((X,Q)=>Q.created_at.localeCompare(X.created_at)):[]},[n,r]),O=b.useMemo(()=>{if(!x.trim())return j.slice(0,10);const M=x.toLowerCase();return j.filter(X=>X.title.toLowerCase().includes(M)||(X.description||"").toLowerCase().includes(M)).slice(0,10)},[j,x]),P=async()=>{if(!N){f("Task not found"),a("error");return}a("loading");try{const M=new Date().toISOString().split("T")[0],X=new Date,Q=new Date;Q.setDate(Q.getDate()+14);const A=n.filter(ne=>ne.status!=="deleted"&&ne.status!=="completed"&&ne.status!=="logged").filter(ne=>{const We=ne.start_date||ne.due_date;if(!We)return!1;const ft=new Date(We);return ft>=X&&ft<=Q}).map(ne=>{var We,ft;return`- ${((We=ne.start_date)==null?void 0:We.split("T")[0])||((ft=ne.due_date)==null?void 0:ft.split("T")[0])}: ${ne.title}`}).slice(0,20),Te=N.title.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g,"").match(/.{1,2}/g)||[],we=n.filter(ne=>ne.status==="completed"||ne.status==="logged").map(ne=>{let We=0;return Te.forEach(ft=>{ne.title.includes(ft)&&We++}),{task:ne,score:We}}).filter(ne=>ne.score>0).sort((ne,We)=>We.score-ne.score).slice(0,5).map(ne=>`- [] ${ne.task.title}: ${ne.task.description||"()"}`),B=await NY(N.title,N.description||"",N.start_date||null,N.due_date||null,{today:M,existingSchedule:A,pastExperiences:we},m||void 0),F=_R(B);u(F),D([F]),I(0),a("preview")}catch(M){console.error(M),f(M.message||"Failed to generate plan"),a("error")}},W=async()=>{if(l){p(!0);try{await s(l,t),i({msg:"72",type:"info"}),e()}catch(M){i({msg:""+M.message,type:"error"}),p(!1)}}},R=(M,X,Q)=>{if(!l)return;const A=JSON.parse(JSON.stringify(l));let Te=A;for(let we=0;we<M.length-1;we++)Te=Te[M[we]].subtasks;Te[M[M.length-1]][X]=Q,C(A)};return o==="prompt"?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-xl max-h-[80vh] flex flex-col animate-in slide-in-from-bottom-10 duration-200",children:[c.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-2xl",children:""}),c.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"72"})]}),c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 rounded-full p-1 hover:bg-gray-100",children:c.jsx(rn,{size:20})})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-6 flex flex-col gap-4",children:[c.jsx("div",{className:"bg-indigo-50 p-3 rounded-lg border border-indigo-100",children:c.jsxs("p",{className:"text-sm text-indigo-700",children:["",c.jsx("strong",{children:N==null?void 0:N.title})]})}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),c.jsx("textarea",{value:m,onChange:M=>y(M.target.value),placeholder:"...",className:"w-full border border-gray-200 rounded-lg p-3 text-sm focus:ring-2 focus:ring-indigo-200 focus:border-indigo-400 resize-none",rows:3})]}),j.length>0&&c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),c.jsx("input",{type:"text",value:x,onChange:M=>g(M.target.value),placeholder:"...",className:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm mb-2 focus:ring-2 focus:ring-indigo-200 focus:border-indigo-400"}),c.jsx("div",{className:"flex flex-col gap-1 max-h-40 overflow-y-auto",children:O.map(M=>c.jsxs("button",{onClick:()=>y(M.description||M.title),className:"text-left p-2 rounded-lg hover:bg-gray-50 border border-gray-100 text-sm transition-colors",children:[c.jsx("span",{className:"font-medium text-gray-800",children:M.title}),M.description&&c.jsxs("p",{className:"text-xs text-gray-500 line-clamp-1 mt-0.5",children:[M.description.slice(0,80),"..."]})]},M.id))})]})]}),c.jsxs("div",{className:"px-6 py-4 border-t bg-white flex justify-end gap-3",children:[c.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:""}),c.jsxs("button",{onClick:P,className:"px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg flex items-center gap-2",children:[c.jsx(i1,{size:18}),""]})]})]})}):o==="loading"?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/30 backdrop-blur-sm",children:c.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 flex flex-col items-center gap-4 animate-in zoom-in duration-200",children:[c.jsx(Vi,{className:"w-12 h-12 text-indigo-600 animate-spin"}),c.jsx("p",{className:"text-lg font-medium text-gray-700",children:"72..."}),c.jsx("p",{className:"text-sm text-gray-500",children:""})]})}):o==="error"?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/30 backdrop-blur-sm",children:c.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 w-[400px] flex flex-col gap-4",children:[c.jsxs("div",{className:"flex items-center gap-3 text-red-600",children:[c.jsx(Kf,{size:24}),c.jsx("h3",{className:"text-lg font-bold",children:""})]}),c.jsx("p",{className:"text-gray-600",children:d}),c.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[c.jsx("button",{onClick:()=>a("prompt"),className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700",children:""}),c.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700",children:""})]})]})}):c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col animate-in slide-in-from-bottom-10 duration-200",children:[c.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between sticky top-0 bg-white rounded-t-xl z-10",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-2xl",children:""}),c.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"72"})]}),c.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg",children:[c.jsx("button",{onClick:()=>w("list"),className:`px-3 py-1.5 text-sm rounded-md transition-all ${v==="list"?"bg-white shadow-sm text-indigo-600 font-medium":"text-gray-500 hover:text-gray-700"}`,children:""}),c.jsx("button",{onClick:()=>w("gantt"),className:`px-3 py-1.5 text-sm rounded-md transition-all ${v==="gantt"?"bg-white shadow-sm text-indigo-600 font-medium":"text-gray-500 hover:text-gray-700"}`,children:""})]})]}),c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 rounded-full p-1 hover:bg-gray-100",children:c.jsx(rn,{size:20})})]}),c.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50/50 flex flex-col",children:v==="list"?c.jsxs("div",{className:"p-6",children:[c.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg border border-indigo-100 mb-4",children:[c.jsx("h3",{className:"font-bold text-indigo-900 mb-1",children:N==null?void 0:N.title}),c.jsx("p",{className:"text-sm text-indigo-700",children:"AI"})]}),c.jsx("div",{className:"flex flex-col gap-3",children:l==null?void 0:l.map((M,X)=>c.jsx(TR,{item:M,path:[X],onUpdate:R},X))})]}):c.jsx("div",{className:"flex-1 min-h-[500px] flex flex-col",children:l&&c.jsx(SR,{plan:l,onUpdatePlan:C})})}),c.jsxs("div",{className:"px-6 py-4 border-t bg-white rounded-b-xl flex justify-between sticky bottom-0 z-10",children:[c.jsxs("button",{onClick:()=>a("prompt"),className:"px-4 py-2 text-gray-500 hover:bg-gray-100 rounded-lg flex items-center gap-1",children:[c.jsx(Ig,{size:16})," "]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:e,className:"px-5 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",disabled:h,children:""}),c.jsxs("button",{onClick:W,disabled:h,className:"px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg shadow-sm flex items-center gap-2 disabled:opacity-70",children:[h?c.jsx(Vi,{className:"animate-spin",size:18}):c.jsx(Gn,{size:18}),h?"...":""]})]})]})]})})},TR=({item:t,path:e,depth:n=0,onUpdate:r})=>{const[s,i]=b.useState(!0),o=t.subtasks&&t.subtasks.length>0;return c.jsxs("div",{className:"flex flex-col",children:[c.jsx("div",{className:`p-3 bg-white rounded-lg border border-gray-100 shadow-sm ${n>0?"ml-6":""}`,children:c.jsxs("div",{className:"flex items-start gap-2",children:[o?c.jsx("button",{onClick:()=>i(!s),className:"mt-1 text-gray-400 hover:text-gray-600",children:s?c.jsx(es,{size:14}):c.jsx(ns,{size:14})}):c.jsx("div",{className:"w-[14px] mt-1"}),c.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[c.jsx("input",{type:"text",value:t.title,onChange:a=>r(e,"title",a.target.value),className:"font-medium text-gray-800 bg-transparent border-b border-transparent hover:border-gray-200 focus:border-indigo-400 focus:outline-none px-1 py-0.5 w-full",placeholder:""}),c.jsxs("div",{className:"flex items-start gap-1",children:[c.jsx(Gf,{size:12,className:"text-gray-400 mt-1 flex-shrink-0"}),c.jsx("textarea",{value:t.description||"",onChange:a=>r(e,"description",a.target.value),placeholder:"...",className:"text-sm text-gray-600 bg-gray-50 border border-gray-100 rounded px-2 py-1 w-full resize-none focus:border-indigo-300 focus:outline-none",rows:2})]}),c.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(Go,{size:12,className:"text-gray-400"}),c.jsx("span",{className:"text-gray-500",children:":"}),c.jsx("input",{type:"date",value:t.start_date||"",onChange:a=>r(e,"start_date",a.target.value),className:"border border-gray-200 rounded px-1 py-0.5 text-xs focus:border-indigo-400 focus:outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("span",{className:"text-gray-500",children:":"}),c.jsx("input",{type:"date",value:t.due_date||"",onChange:a=>r(e,"due_date",a.target.value),className:"border border-gray-200 rounded px-1 py-0.5 text-xs focus:border-indigo-400 focus:outline-none"})]})]})]})]})}),o&&s&&c.jsx("div",{className:"flex flex-col gap-2 mt-2 pl-6 relative",children:t.subtasks.map((a,l)=>c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"absolute left-[-12px] top-[-14px] bottom-[20px] w-px bg-gray-200 -z-10"}),c.jsx("div",{className:"absolute left-[-12px] top-[26px] w-[12px] h-px bg-gray-200 -z-10"}),c.jsx(TR,{item:a,path:[...e,l],depth:n+1,onUpdate:r})]},l))})]})},mb=({taskId:t,initialData:e,onClose:n})=>{const{tasks:r,tags:s,updateTask:i,addTask:o,addTag:a,deleteTask:l,toggleExpansion:u,setToast:d,user:f}=b.useContext(Tn),{isRecording:h,startRecording:p,stopRecording:m,recordingTaskId:y}=b.useContext(Du),x=t?r.find(Y=>Y.id===t):null,g=x||e||{},[v,w]=b.useState(g.title||""),[T,D]=b.useState(g.description||""),[k,I]=b.useState(g.start_date||""),[C,S]=b.useState(g.due_date||""),[_,N]=b.useState(g.tags||[]),[j,O]=b.useState(g.parent_id||null),[P,W]=b.useState(g.color||"blue"),[R,M]=b.useState(g.importance||"unplanned"),[X,Q]=b.useState(g.repeat_rule||null),[A,Te]=b.useState(g.images||[]),[we,B]=b.useState(g.attachments||[]),[F,ne]=b.useState(g.is_all_day!==!1),[We,ft]=b.useState(()=>{if(g.start_time)return g.start_time;if(g.start_date&&!g.is_all_day){const Y=new Date(g.start_date);return`${String(Y.getHours()).padStart(2,"0")}:${String(Y.getMinutes()).padStart(2,"0")}`}return""}),[le,De]=b.useState(()=>g.end_time?g.end_time:(g.start_date&&!g.is_all_day&&g.duration,"")),[ie,Fe]=b.useState(()=>{if(t)try{const Y=localStorage.getItem(`task_reminder_${t}`);if(Y!==null)return JSON.parse(Y)}catch{}return(x==null?void 0:x.reminder_minutes)??null}),[_e,tt]=b.useState(null),[Xe,Ve]=b.useState(!1),[it,Ue]=b.useState(!1),[K,ue]=b.useState(!1),[re,oe]=b.useState(!1),[pe,se]=b.useState(""),[Se,Pe]=b.useState(!1),ye=b.useRef(null),[ze,Ze]=b.useState(!1),[gt,vt]=b.useState(null),[me,He]=b.useState(()=>{if(k){const Y=new Date(k);return new Date(Y.getFullYear(),Y.getMonth(),1)}return new Date(new Date().getFullYear(),new Date().getMonth(),1)}),[qe,nt]=b.useState(null),Me=b.useRef(null),ut=b.useRef(null),ee=b.useRef(null),fe=b.useRef(null),q=b.useRef(null);if(b.useEffect(()=>{const Y=setTimeout(()=>Ue(!0),100);return()=>clearTimeout(Y)},[]),b.useEffect(()=>{x?(w(x.title||""),D((x==null?void 0:x.description)||""),I(x.start_date||""),S(x.due_date||""),N(x.tags||[]),O(x.parent_id||null),W(x.color||"blue"),M(x.importance||"unplanned"),Q(x.repeat_rule||null),Te(x.images||[]),B(x.attachments||[])):!t&&e?(w(e.title||""),D(e.description||""),I(e.start_date||""),S(e.due_date||""),N(e.tags||[]),O(e.parent_id||null),W(e.color||"blue"),M(e.importance||"unplanned"),Q(e.repeat_rule||null),Te(e.images||[]),B(e.attachments||[])):t||(w(""),D(""),I(""),S(""),N([]),O(null),W("blue"),M("unplanned"),Q(null),Te([]),B([]))},[x,t,e]),b.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]),b.useEffect(()=>{if(!t&&it&&ut.current){const Y=()=>{if(ut.current){window.scrollTo(0,0);const Ie=document.querySelector(".mobile-task-editor-content");Ie&&(Ie.scrollTop=0),ut.current.focus({preventScroll:!0}),ut.current.click()}};Y(),setTimeout(Y,100),setTimeout(Y,300)}},[t,it]),t&&!x)return null;const Z=async()=>{if(console.log("[MobileTaskEditor] handleSave called, title:",v),!v.trim()){d==null||d({msg:"",type:"error"});return}try{let Y=k||null;k&&!F&&We&&(Y=`${k.split("T")[0]}T${We}:00`);let Ie=null;if(!F&&We&&le){const[ct,Rt]=We.split(":").map(Number),[Cn,Ot]=le.split(":").map(Number),nn=ct*60+Rt;Ie=Cn*60+Ot-nn,Ie<0&&(Ie+=24*60)}const Le={title:v.trim(),description:T,start_date:Y,due_date:C||null,tags:_,parent_id:j,color:j?void 0:P,importance:R,repeat_rule:X,images:A,attachments:we,is_all_day:F,start_time:F?null:We,end_time:F?null:le,duration:Ie,reminder_minutes:ie};if(console.log("[MobileTaskEditor] taskData:",Le),console.log("[MobileTaskEditor] taskId:",t),console.log("[MobileTaskEditor] addTask function:",typeof o),t)await i(t,Le),j&&u(j,!0);else{const ct=await o({...Le,status:"inbox"},[]);if(console.log("[MobileTaskEditor] addTask returned:",ct),!ct){console.error("[MobileTaskEditor] addTask returned empty - check supabaseClient"),d==null||d({msg:"",type:"error"});return}}d==null||d({msg:"",type:"info"}),n()}catch(Y){console.error("[MobileTaskEditor] Save failed:",Y),console.error("[MobileTaskEditor] Error details:",Y==null?void 0:Y.message,Y==null?void 0:Y.stack),d==null||d({msg:`: ${(Y==null?void 0:Y.message)||""}`,type:"error"})}},ge=()=>{t&&(l(t),d==null||d({msg:"",type:"info"})),n()},xe=Y=>{if(!Y)return"";const Ie=new Date(Y),Le=new Date,ct=new Date(Le);return ct.setDate(ct.getDate()+1),Ie.toDateString()===Le.toDateString()?"":Ie.toDateString()===ct.toDateString()?"":Ie.toLocaleDateString("zh-TW",{month:"short",day:"numeric",weekday:"short"})},be=Y=>{const Ie=Y.getFullYear(),Le=String(Y.getMonth()+1).padStart(2,"0"),ct=String(Y.getDate()).padStart(2,"0");return`${Ie}-${Le}-${ct}`},ve={urgent:{label:"",color:"bg-red-500",text:"text-red-600",bg:"bg-red-50"},planned:{label:"",color:"bg-amber-500",text:"text-amber-600",bg:"bg-amber-50"},delegated:{label:"",color:"bg-green-500",text:"text-green-600",bg:"bg-green-50"},unplanned:{label:"",color:"bg-gray-400",text:"text-gray-500",bg:"bg-gray-50"}},ot=Y=>{it&&ee.current&&!ee.current.contains(Y.target)&&n()},et=async(Y,Ie)=>{const Le=Y.target.files;if(!Le||Le.length===0||!f||!je)return;ue(!0);const ct=Le[0];try{const Rt=`${Date.now()}_${D6()}.${ct.name.split(".").pop()}`,Ot=`${f.id}/${Rt}`,{error:nn}=await je.storage.from("attachments").upload(Ot,ct,{contentType:ct.type,upsert:!1});if(nn)throw nn;const{data:cn}=je.storage.from("attachments").getPublicUrl(Ot);if(cn){const Ee={name:ct.name,url:cn.publicUrl,size:ct.size,type:ct.type};if(Ie){if(Te(Tt=>[...Tt,cn.publicUrl]),t){const Tt=(x==null?void 0:x.images)||[];await i(t,{images:[...Tt,cn.publicUrl]},[],{skipHistory:!0})}d==null||d({msg:"",type:"info"})}else{if(B(Tt=>[...Tt,Ee]),t){const Tt=(x==null?void 0:x.attachments)||[];await i(t,{attachments:[...Tt,Ee]},[],{skipHistory:!0})}d==null||d({msg:"",type:"info"})}}}catch(Rt){console.error(Rt),d==null||d({msg:"",type:"error"})}finally{ue(!1),Y.target&&(Y.target.value="")}},G=async(Y,Ie)=>{if(confirm("")){if(Ie){if(Te(Le=>Le.filter(ct=>ct!==Y)),t){const Le=(x==null?void 0:x.images)||[];await i(t,{images:Le.filter(ct=>ct!==Y)},[],{skipHistory:!0})}}else if(B(Le=>Le.filter(ct=>ct.url!==Y)),t){const Le=(x==null?void 0:x.attachments)||[];await i(t,{attachments:Le.filter(ct=>ct.url!==Y)},[],{skipHistory:!0})}}},ae=Y=>{if(qe===Y&&Me.current)Me.current.paused?Me.current.play():(Me.current.pause(),nt(null));else{Me.current&&Me.current.pause();const Ie=new Audio(Y);Ie.onended=()=>nt(null),Me.current=Ie,Ie.play(),nt(Y)}},Ae=c.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-end justify-center",onMouseDown:ot,style:{touchAction:"none"},children:[c.jsx("div",{className:"absolute inset-0 bg-black/40"}),c.jsxs(Rr.div,{ref:ee,initial:{y:"100%"},animate:{y:0},transition:{type:"spring",damping:25,stiffness:300},onMouseDown:Y=>Y.stopPropagation(),onTouchStart:Y=>Y.stopPropagation(),className:"relative w-full bg-white rounded-t-3xl max-h-[80dvh] flex flex-col overflow-hidden shadow-2xl",children:[c.jsx("div",{className:"flex justify-center pt-3 pb-2 flex-shrink-0",children:c.jsx("div",{className:"w-10 h-1.5 bg-gray-300 rounded-full"})}),c.jsxs("div",{className:"flex items-center justify-between px-5 pb-3 border-b border-gray-100 flex-shrink-0",children:[c.jsx("button",{type:"button",onClick:n,className:"text-gray-500 p-2 -ml-2 active:bg-gray-100 rounded-full",children:c.jsx(rn,{size:24})}),h&&y===t?c.jsxs("div",{className:"flex items-center gap-2 text-red-500 animate-pulse font-medium",children:[c.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),"..."]}):c.jsx("h2",{className:"text-lg font-bold text-gray-800",children:t?"":""}),c.jsx("button",{type:"button",onClick:Z,className:"px-4 py-2 bg-indigo-600 text-white rounded-full font-bold text-sm active:bg-indigo-700",children:""})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-5 scroll-smooth mobile-task-editor-content pb-24",children:[c.jsxs("div",{className:"mb-6 relative",children:[c.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 block",children:""}),c.jsx("textarea",{ref:ut,autoFocus:!t,rows:1,name:`task_title_no_autofill_${Math.random()}`,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",value:v,onChange:Y=>{w(Y.target.value),Pe(Y.target.value.length>0),Y.target.style.height="auto",Y.target.style.height=Y.target.scrollHeight+"px"},onKeyDown:Y=>{var Ie;Y.key==="Enter"&&(Y.preventDefault(),(Ie=ut.current)==null||Ie.blur())},onFocus:()=>Pe(v.length>0),onBlur:()=>setTimeout(()=>Pe(!1),200),placeholder:"...",className:"w-full text-xl font-medium text-gray-800 border-none outline-none bg-transparent placeholder-gray-300 p-0 resize-none overflow-hidden",style:{minHeight:"28px"}}),Se&&v.length>0&&(()=>{const Y=r.filter(Ie=>Ie.id!==t&&Ie.title&&Ie.title.toLowerCase().includes(v.toLowerCase())&&Ie.title.toLowerCase()!==v.toLowerCase()).map(Ie=>Ie.title).filter((Ie,Le,ct)=>ct.indexOf(Ie)===Le).slice(0,5);return Y.length===0?null:c.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white rounded-xl shadow-lg border border-gray-200 z-50 overflow-hidden",children:Y.map((Ie,Le)=>c.jsx("button",{type:"button",onMouseDown:ct=>{ct.preventDefault(),w(Ie),Pe(!1)},className:"w-full text-left px-4 py-3 text-gray-700 hover:bg-indigo-50 border-b border-gray-100 last:border-b-0 transition-colors",children:Ie},Le))})})()]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-6",children:[c.jsxs("button",{type:"button",onClick:()=>tt(_e==="date"?null:"date"),className:`flex flex-col items-center justify-center p-3 rounded-2xl border transition-all ${_e==="date"||k?"border-indigo-500 bg-indigo-50":"border-gray-200 bg-white"}`,children:[c.jsx(Go,{size:20,className:k?"text-indigo-600":"text-gray-400"}),c.jsx("span",{className:`text-[10px] mt-1.5 font-bold truncate w-full ${k?"text-indigo-600":"text-gray-500"}`,children:k?xe(k):""})]}),c.jsxs("button",{type:"button",onClick:()=>oe(!0),className:`flex flex-col items-center justify-center p-3 rounded-2xl border transition-all ${re||_.length>0?"border-purple-500 bg-purple-50":"border-gray-200 bg-white"}`,children:[c.jsx(J6,{size:20,className:_.length>0?"text-purple-600":"text-gray-400"}),c.jsx("span",{className:`text-[10px] mt-1.5 font-bold truncate w-full ${_.length>0?"text-purple-600":"text-gray-500"}`,children:_.length>0?`${_.length} `:""})]})]}),_e==="date"&&c.jsxs("div",{className:"bg-gray-50 rounded-2xl p-4 space-y-4 mb-6 animate-in slide-in-from-top-2",children:[c.jsxs("div",{className:"flex gap-2 flex-wrap",children:[c.jsx("button",{type:"button",onClick:()=>I(be(new Date)),className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${k===be(new Date)?"bg-indigo-600 text-white":"bg-white border border-gray-200 text-gray-700"}`,children:""}),c.jsx("button",{type:"button",onClick:()=>{const Y=new Date;Y.setDate(Y.getDate()+1),I(be(Y))},className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${(()=>{const Y=new Date;return Y.setDate(Y.getDate()+1),k===be(Y)})()?"bg-indigo-600 text-white":"bg-white border border-gray-200 text-gray-700"}`,children:""}),c.jsx("button",{type:"button",onClick:()=>I(""),className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${k?"bg-white border border-gray-200 text-gray-700":"bg-gray-600 text-white"}`,children:""})]}),c.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[c.jsxs("div",{className:"flex items-center justify-between p-2 border-b border-gray-100",children:[c.jsx("button",{type:"button",onClick:()=>He(new Date(me.getFullYear(),me.getMonth()-1,1)),className:"p-2 hover:bg-gray-100 rounded-lg",children:c.jsx(Mu,{size:18,className:"text-gray-600"})}),c.jsxs("span",{className:"text-sm font-bold text-gray-700",children:[me.getFullYear()," ",me.getMonth()+1,""]}),c.jsx("button",{type:"button",onClick:()=>He(new Date(me.getFullYear(),me.getMonth()+1,1)),className:"p-2 hover:bg-gray-100 rounded-lg",children:c.jsx(ns,{size:18,className:"text-gray-600"})})]}),c.jsx("div",{className:"grid grid-cols-7 text-center text-[10px] font-bold text-gray-400 py-1 border-b border-gray-50",children:"".split("").map(Y=>c.jsx("div",{children:Y},Y))}),c.jsx("div",{className:"grid grid-cols-7 gap-px bg-gray-100 p-px",children:(()=>{const Y=new Date(me.getFullYear(),me.getMonth(),1),Ie=new Date(me.getFullYear(),me.getMonth()+1,0),Le=Y.getDay(),ct=[];for(let Ot=0;Ot<Le;Ot++)ct.push(null);for(let Ot=1;Ot<=Ie.getDate();Ot++)ct.push(new Date(me.getFullYear(),me.getMonth(),Ot));const Rt=be(new Date),Cn=k?k.split("T")[0]:"";return ct.map((Ot,nn)=>{if(!Ot)return c.jsx("div",{className:"bg-white"},`pad-${nn}`);const cn=be(Ot),Ee=cn===Rt,Tt=cn===Cn,Ft=wR(Ot),Lt=vR(Ot),Wt=Ot.getDay()===0||Ot.getDay()===6,un=r.filter(rr=>rr.id===t||!rr.start_date?!1:rr.start_date.split("T")[0]===cn).length;return c.jsxs("button",{type:"button",onClick:()=>I(cn),className:`relative bg-white p-1 min-h-[52px] flex flex-col items-center transition-all ${Tt?"ring-2 ring-indigo-500 ring-inset":""} ${Ee?"bg-indigo-50":""}`,children:[c.jsx("span",{className:`text-sm font-bold ${Tt?"text-indigo-600":Ft?"text-red-500":Wt?"text-red-400":"text-gray-700"}`,children:Ot.getDate()}),Ft?c.jsx("span",{className:"text-[8px] text-red-400 font-medium leading-tight truncate w-full text-center",children:Ft}):Lt?c.jsx("span",{className:"text-[8px] text-gray-400 leading-tight truncate w-full text-center",children:Lt.slice(-2)}):null,un>0&&c.jsx("span",{className:"absolute bottom-0.5 right-0.5 w-4 h-4 bg-amber-500 text-white text-[9px] font-bold rounded-full flex items-center justify-center",children:un>9?"9+":un})]},cn)})})()})]}),c.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-xl border border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ji,{size:18,className:"text-gray-500"}),c.jsx("span",{className:"text-sm font-medium text-gray-700",children:""})]}),c.jsx("button",{type:"button",onClick:()=>ne(!F),className:`w-12 h-7 rounded-full transition-all ${F?"bg-indigo-600":"bg-gray-300"}`,children:c.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transition-transform ${F?"translate-x-6":"translate-x-1"}`})})]}),!F&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ji,{size:18,className:"text-gray-500"}),c.jsx("input",{type:"time",value:We,onChange:Y=>ft(Y.target.value),className:"flex-1 p-3 bg-white rounded-xl border border-gray-200 text-center"}),c.jsx(Cw,{size:16,className:"text-gray-400"}),c.jsx("input",{type:"time",value:le,onChange:Y=>De(Y.target.value),className:"flex-1 p-3 bg-white rounded-xl border border-gray-200 text-center"})]}),c.jsxs("div",{className:"p-3 bg-white rounded-xl border border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(Ba,{size:18,className:"text-gray-500"}),c.jsx("span",{className:"text-sm font-medium text-gray-700",children:""})]}),c.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"",value:null},{label:"",value:0},{label:"5",value:5},{label:"15",value:15},{label:"30",value:30},{label:"1",value:60}].map(Y=>c.jsx("button",{type:"button",onClick:()=>{Fe(Y.value),t&&(Y.value!==null?localStorage.setItem(`task_reminder_${t}`,JSON.stringify(Y.value)):localStorage.removeItem(`task_reminder_${t}`))},className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${ie===Y.value?"bg-indigo-600 text-white":"bg-gray-100 text-gray-600"}`,children:Y.label},Y.label))})]}),k&&(()=>{const Y=k.split("T")[0],Ie=r.filter(Le=>Le.id===t||!Le.start_date?!1:Le.start_date.split("T")[0]===Y).sort((Le,ct)=>{const Rt=Le.start_time||(Le.is_all_day===!1&&Le.start_date?new Date(Le.start_date).toTimeString().slice(0,5):"99:99"),Cn=ct.start_time||(ct.is_all_day===!1&&ct.start_date?new Date(ct.start_date).toTimeString().slice(0,5):"99:99");return Rt.localeCompare(Cn)});return Ie.length===0?null:c.jsxs("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-xl",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(Go,{size:14,className:"text-amber-600"}),c.jsxs("span",{className:"text-xs font-bold text-amber-700",children:[" ",Ie.length," "]})]}),c.jsx("div",{className:"space-y-1.5 max-h-32 overflow-y-auto",children:Ie.map(Le=>c.jsxs("div",{className:"flex items-center gap-2 text-xs text-amber-800 bg-white/60 rounded-lg px-2 py-1.5",children:[c.jsx("span",{className:"font-medium text-amber-600 w-12 flex-shrink-0",children:Le.is_all_day!==!1?"":Le.start_time||(Le.start_date?new Date(Le.start_date).toTimeString().slice(0,5):"--:--")}),c.jsx("span",{className:"truncate",children:Le.title})]},Le.id))})]})})()]}),_e==="importance"&&c.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 mb-6 grid grid-cols-2 gap-3 animate-in slide-in-from-top-2",children:Object.keys(ve).map(Y=>c.jsxs("button",{onClick:()=>M(Y),className:`flex items-center gap-2 p-3 rounded-xl border transition-all ${R===Y?"border-gray-400 bg-white shadow-sm":"border-transparent hover:bg-white/50"}`,children:[c.jsx("div",{className:`w-3 h-3 rounded-full ${ve[Y].color}`}),c.jsx("span",{className:"text-sm font-bold text-gray-700",children:ve[Y].label}),R===Y&&c.jsx(Gn,{size:16,className:"ml-auto text-gray-400"})]},Y))}),_e==="repeat"&&c.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 mb-6 space-y-2 animate-in slide-in-from-top-2",children:[null,"daily","weekly","monthly"].map(Y=>c.jsxs("button",{onClick:()=>Q(Y?{type:Y,interval:1}:null),className:`w-full flex items-center justify-between p-3 rounded-xl ${(X==null?void 0:X.type)===Y||!X&&!Y?"bg-white shadow-sm border border-gray-200":"hover:bg-white/50"}`,children:[c.jsx("span",{className:"text-sm font-medium text-gray-700",children:{null:"",daily:"",weekly:"",monthly:""}[Y]}),((X==null?void 0:X.type)===Y||!X&&!Y)&&c.jsx(Gn,{size:16,className:"text-blue-500"})]},Y||"none"))}),_e==="tags"&&c.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 space-y-3 max-h-[40vh] overflow-y-auto mb-6 animate-in slide-in-from-top-2",children:s.map(Y=>{const Ie=_.includes(Y.id);return c.jsxs("button",{onClick:()=>N(Le=>Ie?Le.filter(ct=>ct!==Y.id):[...Le,Y.id]),className:`w-full flex items-center justify-between p-3 rounded-xl transition-all ${Ie?"bg-white shadow-sm border border-purple-200":"bg-white border border-gray-200"}`,children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Y.color||"#6366f1"}}),c.jsx("span",{className:"text-sm font-medium",children:Y.name})]}),Ie&&c.jsx(Gn,{size:18,className:"text-purple-600"})]},Y.id)})}),(we&&we.length>0||A&&A.length>0)&&c.jsxs("div",{className:"mb-6",children:[c.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 block",children:""}),c.jsxs("div",{className:"space-y-2",children:[A.map((Y,Ie)=>c.jsxs("div",{className:"relative group rounded-xl overflow-hidden border border-gray-200",children:[c.jsx("img",{src:Y,alt:"Attachment",className:"w-full h-32 object-cover"}),c.jsx("button",{onClick:()=>G(Y,!0),className:"absolute top-2 right-2 p-1.5 bg-black/50 text-white rounded-full",children:c.jsx(rn,{size:14})})]},Y+Ie)),we.map((Y,Ie)=>{var Le;return c.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl border border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[(Le=Y.type)!=null&&Le.startsWith("audio/")?c.jsx("button",{onClick:()=>ae(Y.url),className:`p-2 rounded-full ${qe===Y.url?"bg-indigo-100 text-indigo-600":"bg-gray-200 text-gray-600"}`,children:qe===Y.url?c.jsx(MI,{size:16}):c.jsx(AI,{size:16})}):c.jsx("div",{className:"p-2 bg-gray-200 rounded-lg text-gray-500",children:c.jsx(co,{size:16})}),c.jsxs("div",{className:"flex flex-col overflow-hidden",children:[c.jsx("span",{className:"text-sm font-medium text-gray-700 truncate",children:Y.name}),c.jsxs("span",{className:"text-[10px] text-gray-400",children:[Math.round((Y.size||0)/1024)," KB"]})]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("a",{href:Y.url,download:!0,target:"_blank",rel:"noreferrer",className:"p-2 text-gray-400 hover:text-indigo-600",children:c.jsx(ru,{size:16})}),c.jsx("button",{onClick:()=>G(Y.url,!1),className:"p-2 text-gray-400 hover:text-red-500",children:c.jsx(Mr,{size:16})})]})]},Y.url+Ie)})]})]}),c.jsxs("div",{className:"mb-6 min-h-[150px]",children:[c.jsx("div",{className:"flex items-center justify-between mb-2",children:c.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:""})}),c.jsx("div",{className:"bg-gray-50 rounded-xl px-1 py-1 focus-within:ring-2 focus-within:ring-indigo-100 border border-transparent",children:c.jsx(Bv,{ref:ye,initialContent:T||"",onChange:D,placeholder:"...",className:"min-h-[120px]",availableTags:s.map(Y=>({...Y,parent_id:Y.parent_id||void 0})),onTagClick:()=>{}})})]}),re&&c.jsxs("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center",onClick:()=>oe(!1),children:[c.jsx("div",{className:"absolute inset-0 bg-black/40"}),c.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-[90%] max-w-sm max-h-[60vh] flex flex-col overflow-hidden",onClick:Y=>Y.stopPropagation(),children:[c.jsxs("div",{className:"p-4 border-b border-gray-100",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h3",{className:"font-bold text-gray-800",children:""}),c.jsx("button",{onClick:()=>oe(!1),className:"p-1 text-gray-400 hover:text-gray-600",children:c.jsx(rn,{size:20})})]}),c.jsxs("div",{className:"relative",children:[c.jsx(Bc,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),c.jsx("input",{type:"text",inputMode:"text",name:`tag_search_no_autofill_${Math.random()}`,autoComplete:"one-time-code",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",value:pe,onChange:Y=>se(Y.target.value),placeholder:"...",className:"w-full pl-9 pr-4 py-2.5 bg-gray-100 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200 appearance-none",autoFocus:!0})]}),_.length>0&&c.jsxs("div",{className:"px-4 pb-3",children:[c.jsxs("div",{className:"text-xs text-gray-500 mb-2 font-medium",children:[" (",_.length,")"]}),c.jsx("div",{className:"flex flex-wrap gap-2",children:_.map(Y=>{const Ie=s.find(Le=>Le.id===Y);return Ie?c.jsxs("button",{type:"button",onClick:()=>N(Le=>Le.filter(ct=>ct!==Y)),className:"flex items-center gap-1.5 px-2.5 py-1.5 bg-purple-100 text-purple-700 rounded-lg text-xs font-medium hover:bg-purple-200 transition-colors",children:[c.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:Ie.color||"#6366f1"}}),c.jsx("span",{children:Ie.name}),c.jsx(rn,{size:12,className:"ml-0.5"})]},Y):null})})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[pe.trim()&&!s.some(Y=>Y.name.toLowerCase()===pe.toLowerCase())&&c.jsx("div",{className:"mb-2 border-b border-gray-100 pb-2",children:ze?c.jsxs("div",{className:"p-3 bg-indigo-50 rounded-xl space-y-3",children:[c.jsxs("div",{className:"text-sm font-bold text-indigo-700",children:[": ",pe]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:" ()"}),c.jsxs("select",{value:gt||"",onChange:Y=>vt(Y.target.value||null),className:"w-full p-2 bg-white border border-gray-200 rounded-lg text-sm",children:[c.jsx("option",{value:"",children:" ()"}),s.filter(Y=>!Y.parent_id).map(Y=>c.jsx("option",{value:Y.id,children:Y.name},Y.id))]})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{type:"button",onClick:()=>{Ze(!1),vt(null)},className:"flex-1 py-2 text-sm font-medium text-gray-600 bg-gray-200 rounded-lg",children:""}),c.jsx("button",{type:"button",onClick:async()=>{if(!pe.trim())return;const Y=pe.trim();try{const Ie=await a(Y,gt);Ie&&N(Le=>[...Le,Ie]),d==null||d({msg:` "${Y}"`,type:"info"}),se(""),Ze(!1),vt(null)}catch(Ie){console.error("Failed to create tag:",Ie),d==null||d({msg:"",type:"error"})}},className:"flex-1 py-2 text-sm font-medium text-white bg-indigo-600 rounded-lg",children:""})]})]}):c.jsxs("button",{type:"button",onClick:()=>Ze(!0),className:"w-full flex items-center gap-3 p-3 bg-indigo-50 hover:bg-indigo-100 rounded-xl transition-colors text-left",children:[c.jsx("div",{className:"w-5 h-5 rounded-full bg-indigo-500 flex items-center justify-center text-white text-xs font-bold",children:"+"}),c.jsxs("span",{className:"text-sm font-medium text-indigo-700",children:[' "',pe,'"']})]})}),s.filter(Y=>Y.name.toLowerCase().includes(pe.toLowerCase())).map(Y=>{var Ie;return c.jsxs("button",{type:"button",onClick:()=>{const Le=_.includes(Y.id);N(Le?ct=>ct.filter(Rt=>Rt!==Y.id):ct=>[...ct,Y.id])},className:`w-full flex items-center gap-3 p-3 rounded-xl transition-colors text-left ${_.includes(Y.id)?"bg-purple-50 border-2 border-purple-300":"hover:bg-gray-50 border-2 border-transparent"}`,children:[c.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:Y.color||"#6366f1"}}),c.jsxs("div",{className:"flex flex-col flex-1",children:[c.jsx("span",{className:"text-sm font-medium text-gray-700",children:Y.name}),Y.parent_id&&c.jsx("span",{className:"text-[10px] text-gray-400",children:((Ie=s.find(Le=>Le.id===Y.parent_id))==null?void 0:Ie.name)||""})]}),_.includes(Y.id)&&c.jsx(Gn,{size:18,className:"text-purple-600 flex-shrink-0"})]},Y.id)}),s.filter(Y=>Y.name.toLowerCase().includes(pe.toLowerCase())).length===0&&!pe.trim()&&c.jsx("div",{className:"p-4 text-center text-gray-400 text-sm",children:""})]})]})]}),c.jsx("div",{className:"pt-4 border-t border-gray-100 pb-4",children:Xe?c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:()=>Ve(!1),className:"flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-bold",children:""}),c.jsx("button",{onClick:ge,className:"flex-1 py-3 rounded-xl bg-red-500 text-white font-bold",children:""})]}):c.jsx("button",{onClick:()=>Ve(!0),className:"w-full py-3 text-red-500 font-bold bg-red-50 rounded-xl",children:""})})]}),c.jsxs("div",{className:"flex-shrink-0 border-t border-gray-100 p-3 bg-white/80 backdrop-blur-md pb-6 flex items-center justify-around",children:[c.jsx("input",{type:"file",ref:q,accept:"image/*",className:"hidden",onChange:Y=>et(Y,!0)}),c.jsx("input",{type:"file",ref:fe,className:"hidden",onChange:Y=>et(Y,!1)}),c.jsxs("button",{onClick:()=>{var Y;return(Y=q.current)==null?void 0:Y.click()},disabled:K,className:"p-3 text-gray-500 active:bg-gray-100 rounded-full flex flex-col items-center gap-1",children:[c.jsx(om,{size:24}),c.jsx("span",{className:"text-[10px]",children:""})]}),c.jsxs("button",{onClick:()=>{var Y;return(Y=fe.current)==null?void 0:Y.click()},disabled:K,className:"p-3 text-gray-500 active:bg-gray-100 rounded-full flex flex-col items-center gap-1",children:[c.jsx(co,{size:24}),c.jsx("span",{className:"text-[10px]",children:""})]}),c.jsx("button",{onClick:async()=>{if(h)y===t||!t&&!y?m():d==null||d({msg:"",type:"error"});else{if(!t){d==null||d({msg:"",type:"error"});return}try{await p(t),d==null||d({msg:"",type:"info"})}catch(Y){console.error("[MobileTaskEditor] Recording error:",Y),d==null||d({msg:"",type:"error"})}}},className:`p-4 rounded-full transition-all flex items-center justify-center -mt-8 shadow-lg ${h&&y===t?"bg-red-500 text-white scale-110":"bg-indigo-600 text-white active:scale-95"}`,children:h&&y===t?c.jsx("div",{className:"w-6 h-6 bg-white rounded-sm"}):c.jsx(DI,{size:24})}),c.jsxs("button",{onClick:()=>tt(_e==="importance"?null:"importance"),className:`p-3 rounded-full flex flex-col items-center gap-1 ${R!=="unplanned"?"text-rose-600":"text-gray-500 active:bg-gray-100"}`,children:[c.jsx(Kf,{size:24}),c.jsx("span",{className:"text-[10px]",children:ve[R].label})]}),c.jsxs("button",{onClick:()=>tt(_e==="repeat"?null:"repeat"),className:`p-3 rounded-full flex flex-col items-center gap-1 ${X?"text-blue-600":"text-gray-500 active:bg-gray-100"}`,children:[c.jsx(Iz,{size:24}),c.jsx("span",{className:"text-[10px]",children:""})]})]})]})]});return tr.createPortal(Ae,document.body)},gb=({onClose:t,initialData:e})=>{const n=!!e,[r,s]=Dn.useState(window.innerWidth<768),[i,o]=Dn.useState({});return Dn.useEffect(()=>{const a=()=>{const l=window.innerWidth<768;s(l),window.visualViewport&&o(l?{height:`${window.visualViewport.height}px`,top:`${window.visualViewport.offsetTop}px`,position:"fixed",bottom:"auto"}:{})};return window.addEventListener("resize",a),window.visualViewport&&(window.visualViewport.addEventListener("resize",a),window.visualViewport.addEventListener("scroll",a)),a(),()=>{window.removeEventListener("resize",a),window.visualViewport&&(window.visualViewport.removeEventListener("resize",a),window.visualViewport.removeEventListener("scroll",a))}},[]),r?c.jsx(mb,{taskId:(e==null?void 0:e.id)==="new"||e==null?void 0:e.id,initialData:e,onClose:t}):c.jsx("div",{className:"fixed inset-0 z-[60] flex items-end md:items-center justify-center pointer-events-auto bg-black/20 md:bg-transparent",onClick:t,style:i,children:c.jsxs(Rr.div,{onClick:a=>a.stopPropagation(),drag:window.innerWidth>=768,dragMomentum:!1,dragElastic:.1,initial:{opacity:0,scale:.95,y:50},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:50},transition:{type:"spring",stiffness:300,damping:30},className:"bg-theme-card backdrop-blur-xl rounded-t-2xl md:rounded-2xl shadow-2xl w-full md:max-w-[600px] overflow-visible border border-theme ring-1 ring-black/5 flex flex-col max-h-[90vh] md:max-h-none",children:[c.jsx("div",{className:"md:hidden flex justify-center pt-2 pb-1",children:c.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full"})}),c.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-theme-header border-b border-theme cursor-grab active:cursor-grabbing backdrop-blur-sm select-none md:rounded-t-2xl",onPointerDown:a=>a.preventDefault(),children:[c.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[c.jsx(CI,{size:14,className:"text-gray-300 hidden md:block"}),c.jsx("span",{className:"text-xs md:text-[10px] font-bold uppercase tracking-widest text-theme-tertiary",children:n?"Edit Task":"New Task"})]}),c.jsxs("button",{onClick:t,className:"w-8 h-8 md:w-7 md:h-7 flex items-center justify-center hover:bg-gray-200/80 rounded-full text-gray-400 hover:text-gray-600 transition-colors bg-gray-100/50",onPointerDown:a=>a.stopPropagation(),children:[c.jsx(rn,{size:16,className:"md:hidden"}),c.jsx(rn,{size:14,className:"hidden md:block"})]})]}),c.jsx("div",{className:"p-0 overflow-auto",children:c.jsx(Ro,{initialData:e,onClose:t,isQuickAdd:!n,autoFocus:!n,isEmbedded:!0})})]})})},Gh=({title:t,importance:e,tasks:n,onDrop:r,onAddTask:s,bgColor:i,borderColor:o,titleColor:a,infoText:l})=>{const{updateGhostPosition:u,endDrag:d}=b.useContext(Tn),[f,h]=b.useState(!1),p=g=>{g.preventDefault(),h(!0),u(g.clientX,g.clientY)},m=()=>{h(!1)},y=g=>{g.preventDefault(),h(!1);const v=g.clientY,w=Array.from(g.currentTarget.querySelectorAll("[data-task-id]"));let T=null,D=Number.POSITIVE_INFINITY;w.forEach((I,C)=>{const S=I.getBoundingClientRect(),_=v-(S.top+S.height/2);Math.abs(_)<Math.abs(D)&&(D=_,T={element:I,offset:_,index:C})});let k;if(T){const I=T.index,C=n[I];if(C)if(T.offset<0){const S=n[I-1];S?k=((S.order_index||0)+(C.order_index||0))/2:k=(C.order_index||0)-1e4}else{const S=n[I+1];S?k=((C.order_index||0)+(S.order_index||0))/2:k=(C.order_index||0)+1e4}}else n.length>0?k=(n[n.length-1].order_index||0)+1e4:k=void 0;r(g,e,k)},x=()=>{h(!1),d()};return c.jsxs("div",{className:`flex flex-col h-full rounded-xl border-2 transition-all p-3 overflow-hidden ${f?"bg-indigo-50 border-indigo-400 scale-[1.01]":`${i} ${o}`}`,onDragOver:p,onDragLeave:m,onDrop:y,onDragEnd:x,children:[c.jsxs("div",{className:"flex justify-between items-center mb-3 flex-shrink-0",children:[c.jsxs("div",{className:"flex flex-col",children:[c.jsx("h3",{className:`font-bold text-lg ${a}`,children:t}),l&&c.jsx("span",{className:"text-[10px] text-gray-400 font-medium",children:l})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-xs font-medium text-gray-400 bg-white/50 px-2 py-0.5 rounded-full",children:n.length}),c.jsx("button",{onClick:()=>s(e),className:`p-1 rounded-full hover:bg-black/5 transition-colors ${a}`,children:c.jsx(xi,{size:16})})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar space-y-2 pr-1 pb-10",children:[n.map((g,v)=>c.jsx("div",{children:c.jsx(ml,{flatTask:{data:g,depth:0,hasChildren:!1,isExpanded:!1,path:[g.id],index:v},isFocused:!1,onEdit:()=>{}})},g.id)),n.length===0&&c.jsxs("div",{className:"h-full flex flex-col items-center justify-center opacity-30 text-center",children:[c.jsx("div",{className:`p-4 rounded-full bg-current mb-2 opacity-10 ${a}`,children:c.jsx(II,{size:24})}),c.jsx("span",{className:`text-sm font-medium ${a}`,children:""})]})]})]})},Jee=()=>{const{tasks:t,tags:e,viewTagFilters:n,updateTask:r,addTask:s,setEditingTaskId:i,endDrag:o}=b.useContext(Tn),a=b.useMemo(()=>{var y;const f=(y=e.find(x=>["schedule",""].includes(x.name.trim().toLowerCase())))==null?void 0:y.id,h=n.matrix||{include:[],exclude:[]},{include:p,exclude:m}=Array.isArray(h)?{include:h,exclude:[]}:h;return t.filter(x=>!(x.status==="deleted"||x.status==="logged"||x.status==="completed"||x.parent_id||f&&x.tags.includes(f)||x.tags.some(v=>{const w=e.find(T=>T.id===v);return w&&["schedule",""].includes(w.name.trim().toLowerCase())})||p.length>0&&!x.tags.some(v=>p.includes(v))||m.length>0&&x.tags.some(v=>m.includes(v))))},[t,e,n]),l={urgent:a.filter(f=>f.importance==="urgent"),planned:a.filter(f=>f.importance==="planned"),delegated:a.filter(f=>f.importance==="delegated"),unplanned:a.filter(f=>!f.importance||f.importance==="unplanned"||f.importance==="optional")},u=async(f,h,p)=>{const m=f.dataTransfer.getData("text/plain");if(m){const y={importance:h};p!==void 0&&(y.order_index=p),await r(m,y),await o()}},d=async f=>{const h=await s({title:"",importance:f,status:"inbox"});h&&i(h)};return c.jsxs("div",{className:"h-full p-6 flex flex-col overflow-hidden bg-white",children:[c.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[c.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[c.jsx(II,{className:"text-indigo-600"}),"Eisenhower Matrix"]}),c.jsx("div",{className:"text-xs text-gray-400 font-medium bg-gray-100 px-3 py-1 rounded-full",children:"Shift+Alt inside tasks to move"})]}),c.jsxs("div",{className:"flex-1 grid grid-cols-2 grid-rows-2 gap-4 min-h-0",children:[c.jsx(Gh,{title:" (Do Now)",infoText:"Urgent & Important",importance:"urgent",tasks:l.urgent,onDrop:u,onAddTask:d,bgColor:"bg-red-50/50",borderColor:"border-red-100",titleColor:"text-red-600"}),c.jsx(Gh,{title:" (Plan)",infoText:"Not Urgent but Important",importance:"planned",tasks:l.planned,onDrop:u,onAddTask:d,bgColor:"bg-amber-50/50",borderColor:"border-amber-100",titleColor:"text-amber-600"}),c.jsx(Gh,{title:" (Delegate)",infoText:"Urgent but Not Important",importance:"delegated",tasks:l.delegated,onDrop:u,onAddTask:d,bgColor:"bg-green-50/50",borderColor:"border-green-100",titleColor:"text-green-600"}),c.jsx(Gh,{title:" (Unplanned)",infoText:"Neither Urgent nor Important",importance:"unplanned",tasks:l.unplanned,onDrop:u,onAddTask:d,bgColor:"bg-gray-50/50",borderColor:"border-gray-200",titleColor:"text-gray-500"})]})]})},Xee=()=>{const{user:t,setToast:e}=b.useContext(Tn),[n,r]=b.useState(()=>{const _=localStorage.getItem(`work_logs_${t==null?void 0:t.id}`);return _?JSON.parse(_):[]}),[s,i]=b.useState(()=>new Date().toISOString().split("T")[0]),[o,a]=b.useState(!1),[l,u]=b.useState(""),[d,f]=b.useState(!1),h=_=>{localStorage.setItem(`work_logs_${t==null?void 0:t.id}`,JSON.stringify(_)),r(_)},p=b.useMemo(()=>n.find(_=>_.date===s),[n,s]),m=()=>{const _=new Date(s);_.setDate(_.getDate()-1),i(_.toISOString().split("T")[0])},y=()=>{const _=new Date(s);_.setDate(_.getDate()+1),i(_.toISOString().split("T")[0])},x=()=>{i(new Date().toISOString().split("T")[0])},g=_=>{const N=new Date(_),j=["","","","","","",""],O=N.getFullYear(),P=N.getMonth()+1,W=N.getDate(),R=j[N.getDay()];return`${O}${P}${W}${R}`},v=()=>`## ${g(s)}

### 

#### [/]
1. []
2. []

#### [/]
1. []
2. []

### 

|  |  |  |  |
|-------|------|------|------|
| 1 | [] | [] |  |
| 2 | [] | [] |  |

### 
- []
`,w=()=>{const _=v(),N={id:crypto.randomUUID(),date:s,content:_,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};h([...n,N]),u(_),a(!0)},T=()=>{u((p==null?void 0:p.content)||""),a(!0)},D=()=>{if(p){const _=n.map(N=>N.id===p.id?{...N,content:l,updated_at:new Date().toISOString()}:N);h(_)}a(!1),e==null||e({msg:"",type:"info"})},k=()=>{if(p&&confirm("")){const _=n.filter(N=>N.id!==p.id);h(_),a(!1),e==null||e({msg:"",type:"info"})}},I=async()=>{const N=((p==null?void 0:p.content)||"").replace(/^## /gm,"").replace(/^### /gm,"").replace(/^#### /gm,"").replace(/\*\*/g,"").replace(/\|/g,"	").replace(/-{3,}/g,"");try{await navigator.clipboard.writeText(N),f(!0),setTimeout(()=>f(!1),2e3),e==null||e({msg:"",type:"info"})}catch{e==null||e({msg:"",type:"error"})}},C=_=>_.split(`
`).map((N,j)=>{if(N.startsWith("## "))return c.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4 mt-6 first:mt-0",children:N.slice(3)},j);if(N.startsWith("### "))return c.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-3 mt-5",children:N.slice(4)},j);if(N.startsWith("#### "))return c.jsx("h4",{className:"text-base font-semibold text-gray-600 mb-2 mt-4",children:N.slice(5)},j);if(N.startsWith("| ")){const O=N.split("|").filter(W=>W.trim());return N.includes("---")?null:c.jsx("div",{className:"grid grid-cols-4 gap-2 px-2 py-1 text-sm border-b border-gray-100",children:O.map((W,R)=>c.jsx("span",{className:R===0?"font-medium":"text-gray-600",children:W.trim()},R))},j)}return N.match(/^\d+\. /)?c.jsx("p",{className:"text-sm text-gray-700 ml-6 mb-1",children:N},j):N.startsWith("- ")?c.jsxs("p",{className:"text-sm text-gray-700 ml-4 mb-1",children:[" ",N.slice(2)]},j):N.trim()===""?c.jsx("div",{className:"h-2"},j):c.jsx("p",{className:"text-sm text-gray-700 mb-1",children:N},j)}),S=s===new Date().toISOString().split("T")[0];return c.jsxs("div",{className:"h-full flex flex-col bg-white overflow-hidden",children:[c.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-white z-10",children:[c.jsx("div",{className:"flex items-center gap-4",children:c.jsxs("h2",{className:"font-bold text-gray-700 flex items-center gap-2",children:[c.jsx(mf,{size:18}),""]})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:m,className:"p-1.5 rounded hover:bg-gray-100 text-gray-500",children:c.jsx(Mu,{size:18})}),c.jsx("span",{className:"font-medium text-gray-700 min-w-[180px] text-center",children:g(s)}),c.jsx("button",{onClick:y,className:"p-1.5 rounded hover:bg-gray-100 text-gray-500",children:c.jsx(ns,{size:18})}),!S&&c.jsx("button",{onClick:x,className:"ml-2 px-2 py-1 text-xs bg-indigo-50 text-indigo-600 rounded hover:bg-indigo-100",children:""})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[p&&!o&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:I,className:"flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[d?c.jsx(Gn,{size:14}):c.jsx(SI,{size:14}),d?"":""]}),c.jsxs("button",{onClick:T,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 text-sm font-medium transition-colors",children:[c.jsx(Ig,{size:14}),""]}),c.jsx("button",{onClick:k,className:"flex items-center gap-1 px-3 py-1.5 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 text-sm font-medium transition-colors",children:c.jsx(Mr,{size:14})})]}),o&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:()=>a(!1),className:"flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[c.jsx(rn,{size:14}),""]}),c.jsxs("button",{onClick:D,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors",children:[c.jsx(PI,{size:14}),""]})]}),!p&&!o&&c.jsxs("button",{onClick:w,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors shadow-sm",children:[c.jsx(xi,{size:16}),""]})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-gray-50/50",children:o?c.jsx("div",{className:"max-w-3xl mx-auto",children:c.jsx("textarea",{value:l,onChange:_=>u(_.target.value),className:"w-full h-[calc(100vh-200px)] p-4 bg-white rounded-xl border border-gray-200 focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none font-mono text-sm resize-none",placeholder:"..."})}):p?c.jsx("div",{className:"max-w-3xl mx-auto bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:C(p.content)}):c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx(mf,{size:48,className:"mb-4 opacity-20"}),c.jsx("p",{className:"text-sm",children:""}),c.jsxs("button",{onClick:w,className:"mt-4 flex items-center gap-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors",children:[c.jsx(xi,{size:16}),""]})]})})]})},Qee=({task:t,position:e,count:n})=>{const r=b.useRef(null);if(b.useLayoutEffect(()=>{e&&r.current&&(r.current.style.left=`${e.x}px`,r.current.style.top=`${e.y}px`)},[]),!e)return null;const s=c.jsxs("div",{ref:r,id:"drag-ghost",className:"fixed pointer-events-none rounded-lg border-2 border-indigo-500/50 p-3 w-64 flex items-center gap-3",style:{transform:"translate(16px, 16px) rotate(2deg)",zIndex:99999,backgroundColor:"#ffffff",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",opacity:1,isolation:"isolate"},children:[c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h4",{className:"font-medium text-sm text-gray-900 dark:text-gray-100 truncate",children:t.title||"()"}),n>1&&c.jsxs("p",{className:"text-xs text-indigo-500 font-medium",children:["+ ",n-1," "]})]}),c.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-pulse"})]});return tr.createPortal(s,document.body)},Zee=t=>{switch(t){case"inbox":return"";case"waiting":return"";case"active":return"";case"someday":return"/";case"reference":return"";case"completed":return"";case"archived":return"";case"logged":return"";default:return t}},ete=({onClose:t})=>{const{tasks:e,selectedTaskIds:n,updateTask:r,setToast:s,tags:i}=b.useContext(Tn),[o,a]=b.useState(""),[l,u]=b.useState(0),d=b.useRef(null);b.useEffect(()=>{d.current&&d.current.focus()},[]),b.useEffect(()=>{u(0)},[o]);const f=y=>{y.key==="Escape"&&t()};b.useEffect(()=>(window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)),[]);const h=b.useMemo(()=>{if(!o.trim())return[];const y=o.toLowerCase();return e.filter(x=>{if(x.status==="deleted"||x.status==="archived"||x.status==="logged"||!x.title.toLowerCase().includes(y)||n.includes(x.id))return!1;for(const g of n)if(Tw(g,x.id,e))return!1;return!0}).slice(0,10)},[e,o,n]),p=async y=>{const x=e.find(g=>g.id===y);if(x)try{await Promise.all(n.map(g=>r(g,{parent_id:y}))),s({type:"success",msg:` ${n.length}  "${x.title}" `}),t()}catch(g){console.error(g),s({type:"error",msg:""})}},m=y=>{y.key==="ArrowDown"?(y.preventDefault(),u(x=>(x+1)%h.length)):y.key==="ArrowUp"?(y.preventDefault(),u(x=>(x-1+h.length)%h.length)):y.key==="Enter"&&(y.preventDefault(),h.length>0&&p(h[l].id))};return tr.createPortal(c.jsx(go,{children:c.jsx(Rr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-[99999] flex items-start justify-center pt-[20vh]",onClick:t,children:c.jsxs(Rr.div,{initial:{opacity:0,scale:.95,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20},transition:{duration:.15},className:"w-full max-w-xl bg-white rounded-xl shadow-2xl overflow-hidden border border-gray-200",onClick:y=>y.stopPropagation(),children:[c.jsxs("div",{className:"p-3 border-b border-gray-100 flex items-center gap-3",children:[c.jsx(oz,{className:"text-gray-400",size:20}),c.jsx("input",{ref:d,type:"text",value:o,onChange:y=>a(y.target.value),onKeyDown:m,placeholder:` ${n.length} ...`,className:"flex-1 bg-transparent border-none outline-none text-base text-gray-800 placeholder:text-gray-400"}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-500 px-1.5 py-0.5 rounded border border-gray-200",children:"ESC"})})]}),c.jsxs("div",{className:"max-h-[300px] overflow-y-auto",children:[h.length===0&&o.trim()!==""&&c.jsx("div",{className:"p-8 text-center text-gray-400 text-sm",children:""}),h.length===0&&o.trim()===""&&c.jsx("div",{className:"p-8 text-center text-gray-400 text-sm",children:"..."}),h.map((y,x)=>{var v;const g=x===l;return c.jsxs("button",{onClick:()=>p(y.id),onMouseEnter:()=>u(x),className:`w-full text-left p-3 flex items-center gap-3 transition-colors ${g?"bg-indigo-50":"hover:bg-gray-50"}`,children:[c.jsx("div",{className:`w-1 h-8 rounded-full ${g?"bg-indigo-500":"bg-transparent"}`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:`font-medium truncate ${g?"text-indigo-900":"text-gray-700"}`,children:y.title}),c.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1.5 text-xs",children:[c.jsx("span",{className:"px-1.5 py-0.5 rounded-md bg-gray-100 border border-gray-200 text-gray-500 font-medium",children:Zee(y.status)}),y.parent_id?c.jsxs("span",{className:"flex items-center gap-1 text-indigo-600 bg-indigo-50 border border-indigo-100 px-1.5 py-0.5 rounded-md",children:[c.jsx(_I,{size:10}),c.jsx("span",{className:"max-w-[100px] truncate",children:((v=e.find(w=>w.id===y.parent_id))==null?void 0:v.title)||""})]}):c.jsx("span",{className:"text-gray-400 border border-gray-200 px-1.5 py-0.5 rounded-md",children:""}),y.tags&&y.tags.length>0&&c.jsx("div",{className:"flex gap-1 items-center",children:y.tags.map(w=>{const T=i.find(D=>D.id===w);return T?c.jsxs("span",{className:"px-1.5 py-0.5 rounded-md border text-[10px]",style:{backgroundColor:`${T.color}15`,borderColor:`${T.color}30`,color:T.color},children:["#",T.name]},w):null})})]})]}),g&&c.jsx("span",{className:"text-[10px] text-indigo-400 font-medium px-2 flex-shrink-0",children:"Enter "})]},y.id)})]})]})})}),document.body)},tte={gray:"bg-gray-400",blue:"bg-blue-500",indigo:"bg-indigo-500",red:"bg-red-500",orange:"bg-orange-500",amber:"bg-amber-500",green:"bg-green-500",teal:"bg-teal-500",cyan:"bg-cyan-500",sky:"bg-sky-500",purple:"bg-purple-500",fuchsia:"bg-fuchsia-500",pink:"bg-pink-500",rose:"bg-rose-500"},nte=[{label:"5 ",minutes:5},{label:"30 ",minutes:30},{label:"1 ",minutes:60},{label:"2 ",minutes:120}],rte=({reminder:t,onSnooze:e,onMarkSeen:n,onSelect:r,onEdit:s})=>{const[i,o]=b.useState(!1),[a,l]=b.useState(""),[u,d]=b.useState({top:0,left:0}),[f,h]=b.useState(null),p=b.useRef(null),m=b.useRef(null);b.useEffect(()=>{if(!t.snoozed_until){h(null);return}const w=()=>{const D=Date.now(),I=new Date(t.snoozed_until).getTime()-D;if(I<=0){h(null);return}const C=Math.floor(I/1e3),S=Math.floor(C/60),_=Math.floor(S/60);_>0?h(`${_}${S%60}`):S>0?h(`${S}${C%60}`):h(`${C}`)};w();const T=setInterval(w,1e3);return()=>clearInterval(T)},[t.snoozed_until]);const y=()=>{p.current?(clearTimeout(p.current),p.current=null,s()):p.current=setTimeout(()=>{p.current=null,r()},250)},x=w=>{const T=new Date(w),k=new Date().getTime()-T.getTime(),I=Math.floor(k/6e4),C=Math.floor(k/36e5),S=Math.floor(k/864e5);return I<1?"":I<60?`${I} `:C<24?`${C} `:`${S} `},g=w=>new Date(w).toLocaleString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),v=()=>{const w=parseInt(a);w>0&&(e(w),o(!1),l(""))};return c.jsx("div",{className:`p-3 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer ${t.seen?"opacity-60":""}`,onClick:y,children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("div",{className:`w-2 h-2 mt-2 rounded-full ${tte[t.task_color]} flex-shrink-0`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:"font-medium text-gray-800 truncate",children:t.task_title}),c.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500 flex-wrap",children:[c.jsx(Ji,{size:10}),c.jsxs("span",{children:["",g(t.due_time)]}),c.jsx("span",{className:"text-gray-300",children:""}),c.jsx("span",{children:x(t.triggered_at)}),f&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"text-gray-300",children:""}),c.jsxs("span",{className:"text-orange-500 font-medium",children:[" ",f]})]})]})]}),c.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",onClick:w=>w.stopPropagation(),children:[c.jsx("button",{onClick:n,className:`p-1.5 rounded-lg transition-colors ${t.seen?"bg-green-100 text-green-600":"hover:bg-gray-100 text-gray-400 hover:text-green-600"}`,title:t.seen?"":"",children:t.seen?c.jsx(Gn,{size:14}):c.jsx(lz,{size:14})}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{ref:m,onClick:()=>{if(!i&&m.current){const w=m.current.getBoundingClientRect();d({top:w.bottom+4,left:w.right-160})}o(!i)},className:"p-1.5 rounded-lg hover:bg-gray-100 text-gray-400 hover:text-orange-500 transition-colors flex items-center gap-0.5",title:"",children:[c.jsx(Ba,{size:14}),c.jsx(es,{size:10})]}),i&&tr.createPortal(c.jsxs("div",{className:"fixed w-40 bg-white rounded-lg shadow-xl border border-gray-200 z-[10001] overflow-hidden",style:{top:u.top,left:u.left},"data-snooze-menu":"true",children:[nte.map(w=>c.jsxs("button",{onClick:()=>{e(w.minutes),o(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-orange-50 text-gray-700 hover:text-orange-600 transition-colors",children:[w.label,""]},w.minutes)),c.jsx("div",{className:"border-t border-gray-100 p-2",children:c.jsxs("div",{className:"flex gap-1",children:[c.jsx("input",{type:"number",value:a,onChange:w=>l(w.target.value),placeholder:"",className:"flex-1 px-2 py-1 text-xs border rounded w-16",min:1}),c.jsx("span",{className:"text-xs text-gray-500 self-center",children:""}),c.jsx("button",{onClick:v,className:"px-2 py-1 text-xs bg-orange-500 text-white rounded hover:bg-orange-600",children:""})]})})]}),document.body)]})]})]})})},ste=()=>{const{reminders:t,markAsSeen:e,snoozeReminder:n,clearAllSeen:r,clearAllUnseen:s,clearAll:i,unseenCount:o,isReminderPanelOpen:a,setIsReminderPanelOpen:l}=b.useContext(wI),{setFocusedTaskId:u,setSelectedTaskIds:d,navigateToTask:f}=b.useContext(Tn),h=b.useRef(null);b.useEffect(()=>{const x=g=>{const v=g.target;if(h.current&&h.current.contains(v))return;const w=document.querySelector('[data-snooze-menu="true"]');w&&w.contains(v)||l(!1)};return a&&document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[a,l]);const p=x=>{u(x),d([x]),f(x,!1,"allview"),l(!1),setTimeout(()=>{const g=document.querySelector(`[data-task-id="${x}"]`);g&&g.scrollIntoView({behavior:"smooth",block:"center"})},300)},m=x=>{f(x,!0,"allview"),l(!1)},y=[...t].sort((x,g)=>x.seen!==g.seen?x.seen?1:-1:new Date(g.triggered_at).getTime()-new Date(x.triggered_at).getTime());return c.jsxs("div",{className:"relative",ref:h,children:[c.jsxs("button",{onClick:()=>l(!a),className:`relative p-1.5 rounded-lg transition-colors ${a?"bg-orange-100 text-orange-600":"hover:bg-gray-100 text-gray-500 hover:text-orange-500"}`,title:"",children:[c.jsx(Ba,{size:18}),o>0&&c.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center animate-pulse",children:o>9?"9+":o})]}),c.jsx(go,{children:a&&c.jsxs(Rr.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15},className:"absolute right-0 top-full mt-2 w-80 md:w-96 bg-white rounded-xl shadow-2xl border border-gray-200 z-[9999] overflow-hidden",children:[c.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 flex items-center justify-between bg-gradient-to-r from-orange-50 to-amber-50",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ba,{size:16,className:"text-orange-500"}),c.jsx("span",{className:"font-bold text-gray-800",children:""}),o>0&&c.jsxs("span",{className:"px-1.5 py-0.5 bg-red-500 text-white text-[10px] font-bold rounded-full",children:[o," "]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[o>0&&c.jsx("button",{onClick:s,className:"px-2 py-1 rounded-lg text-[10px] font-bold bg-red-100 text-red-600 hover:bg-red-200 transition-colors",title:"",children:""}),t.some(x=>x.seen)&&c.jsx("button",{onClick:r,className:"p-1.5 rounded-lg hover:bg-white/50 text-gray-400 hover:text-red-500 transition-colors",title:"",children:c.jsx(Mr,{size:14})}),t.length>0&&c.jsx("button",{onClick:i,className:"p-1.5 rounded-lg hover:bg-white/50 text-gray-400 hover:text-red-500 transition-colors",title:"",children:c.jsx(rn,{size:14})})]})]}),c.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:y.length===0?c.jsxs("div",{className:"py-12 text-center text-gray-400",children:[c.jsx(Zx,{size:32,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{className:"text-sm",children:""})]}):y.map(x=>c.jsx(rte,{reminder:x,onSnooze:g=>n(x.id,g),onMarkSeen:()=>e(x.id),onSelect:()=>p(x.task_id),onEdit:()=>m(x.task_id)},x.id))}),c.jsx("div",{className:"px-4 py-2 border-t border-gray-100 bg-gray-50 text-[10px] text-gray-400",children:c.jsx("span",{children:"  "})})]})})]})},ite={capture:{label:"",icon:"",color:"bg-gray-100 text-gray-600"},clarify:{label:"",icon:"",color:"bg-yellow-100 text-yellow-600"},organize:{label:"",icon:"",color:"bg-blue-100 text-blue-600"},engage:{label:"",icon:"",color:"bg-green-100 text-green-600"}},ote=({taskId:t,onClose:e})=>{const{tasks:n,tags:r,updateTask:s,batchAddTasks:i}=b.useContext(Tn),[o,a]=b.useState(""),[l,u]=b.useState([]),[d,f]=b.useState(!1),h=b.useRef(null),p=b.useRef(!1),[m,y]=b.useState("capture"),[x,g]=b.useState([]),v=n.find(_=>_.id===t),w=()=>{setTimeout(()=>{var _;(_=h.current)==null||_.scrollIntoView({behavior:"smooth"})},100)};b.useEffect(()=>{w()},[l,x]),b.useEffect(()=>{if(v&&!p.current)if(p.current=!0,v.ai_history&&v.ai_history.length>0){const _=v.ai_history.map(N=>({id:N.id,role:N.role,content:N.content,timestamp:new Date(N.created_at).getTime()}));_.sort((N,j)=>N.timestamp-j.timestamp),u(_)}else D("",!0)},[v]);const T=async _=>{if(!v)return;const N={id:_.id,role:_.role,content:_.content,created_at:new Date(_.timestamp).toISOString()},j=v.ai_history||[];j.some(O=>O.id===_.id)||await s(v.id,{ai_history:[...j,N]},void 0,{skipHistory:!0})},D=async(_,N=!1)=>{if(!v||!_.trim()&&!N)return;g([]);let j=null;N||(j={id:crypto.randomUUID(),role:"user",content:_,timestamp:Date.now()},u(O=>[...O,j]),T(j),a("")),f(!0);try{const O=v.parent_id?n.find(we=>we.id===v.parent_id):null,P=v.tags.map(we=>{var B;return((B=r.find(F=>F.id===we))==null?void 0:B.name)||we}),W={title:v.title,description:v.description||"",status:v.status,created_at:v.created_at,due_date:v.due_date,start_date:v.start_date,tags:P,project_title:O==null?void 0:O.title},R=new Date,M=new Date;M.setDate(R.getDate()+14);const X=n.filter(we=>{if(we.status==="completed"||we.status==="deleted")return!1;const B=we.start_date||we.due_date;if(!B)return!1;const F=new Date(B);return F>=R&&F<=M}).sort((we,B)=>(we.start_date||we.due_date||"").localeCompare(B.start_date||B.due_date||"")).map(we=>{var B,F;return`[${((B=we.start_date)==null?void 0:B.split("T")[0])||((F=we.due_date)==null?void 0:F.split("T")[0])}] ${we.title}`}).slice(0,30),Q=l.filter(we=>we.role!=="system").map(we=>({role:we.role,content:we.content}));j&&Q.push({role:"user",content:j.content});const A=await IY(W,X,N?" GTD ":_,Q);A.current_stage&&y(A.current_stage),A.actions&&A.actions.length>0&&g(A.actions);const Te={id:crypto.randomUUID(),role:"assistant",content:A.reply,timestamp:Date.now()};u(we=>[...we,Te]),T(Te)}catch(O){console.error(O);const P={id:crypto.randomUUID(),role:"assistant",content:"",timestamp:Date.now()};u(W=>[...W,P])}finally{f(!1)}},k=async()=>{if(!v)return;const _=[];try{for(const N of x)if(N.type==="update_task"){const j={};if(N.params.title&&(j.title=N.params.title),N.params.description&&(j.description=N.params.description),N.params.due_date&&(j.due_date=N.params.due_date),N.params.start_date&&(j.start_date=N.params.start_date),N.params.start_time&&(j.start_time=N.params.start_time),N.params.reminder_minutes!==void 0&&(j.reminder_minutes=N.params.reminder_minutes),N.params.tags&&N.params.tags.length>0){const O=N.params.tags.map(P=>{const W=r.find(R=>R.name.toLowerCase()===P.toLowerCase());return W?W.id:null}).filter(Boolean);O.length>0&&(j.tags=O)}Object.keys(j).length>0&&(await s(v.id,j),_.push(""))}else N.type==="add_subtasks"&&N.params.tasks&&N.params.tasks.length>0&&(await i(N.params.tasks.map(j=>({...j,status:"todo",start_date:j.start_date,start_time:j.start_time,reminder_minutes:j.reminder_minutes,due_date:j.due_date})),v.id),_.push(` ${N.params.tasks.length} `));if(_.length>0){const N={id:crypto.randomUUID(),role:"system",content:_.map(j=>` ${j}`).join(`
`),timestamp:Date.now()};u(j=>[...j,N]),T(N)}g([])}catch(N){console.error("Action execution failed:",N),alert("")}},I=(_,N,j,O)=>{g(P=>{const W=[...P],R={...W[_]};if(R.type==="update_task")R.params={...R.params,[N]:j};else if(R.type==="add_subtasks"&&typeof O=="number"){const M=[...R.params.tasks];M[O]={...M[O],[N]:j},R.params={...R.params,tasks:M}}return W[_]=R,W})},C=_=>{g(N=>N.filter((j,O)=>O!==_))},S=(_,N)=>{g(j=>{const O=[...j],P=O[_];if(P.type==="add_subtasks"){const W=[...P.params.tasks];if(W.splice(N,1),W.length===0)return j.filter((R,M)=>M!==_);O[_]={...P,params:{...P.params,tasks:W}}}return O})};return v?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md h-[700px] flex flex-col animate-in slide-in-from-bottom-5 duration-200 overflow-hidden border border-indigo-100 font-sans",children:[c.jsxs("div",{className:"px-4 py-3 border-b bg-gradient-to-r from-indigo-50 to-white",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600",children:c.jsx(Is,{size:16})}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-sm font-bold text-gray-900",children:"GTD "}),c.jsx("p",{className:"text-xs text-indigo-600 flex items-center gap-1",children:v.title.length>10?v.title.slice(0,10)+"...":v.title})]})]}),c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 p-1.5 rounded-full transition-colors",children:c.jsx(rn,{size:18})})]}),c.jsxs("div",{className:"flex justify-between items-center px-2 py-1 bg-gray-50 rounded-lg relative overflow-hidden",children:[Object.entries(ite).map(([_,N],j)=>{const O=m===_;return c.jsxs("div",{className:`flex flex-col items-center z-10 transition-all duration-300 ${O?"scale-110 opacity-100":"opacity-40 scale-90"}`,children:[c.jsx("span",{className:"text-base mb-0.5",children:N.icon}),c.jsx("span",{className:`text-[10px] font-bold ${O?"text-indigo-600":"text-gray-500"}`,children:N.label})]},_)}),c.jsx("div",{className:"absolute top-1/2 left-0 w-full h-0.5 bg-gray-200 -z-0 transform -translate-y-1/2"})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50/50 space-y-4",children:[l.map(_=>c.jsxs("div",{className:`flex gap-3 ${_.role==="user"?"flex-row-reverse":""}`,children:[c.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${_.role==="user"?"bg-gray-200":_.role==="system"?"bg-green-100 text-green-600":"bg-indigo-600 text-white"}`,children:_.role==="user"?c.jsx(FI,{size:14,className:"text-gray-600"}):_.role==="system"?c.jsx(gf,{size:14}):c.jsx(Q6,{size:14})}),c.jsxs("div",{className:`max-w-[90%] rounded-2xl px-4 py-2.5 text-sm shadow-sm ${_.role==="user"?"bg-white text-gray-800 border border-gray-100 rounded-tr-none":_.role==="system"?"bg-green-50 text-green-800 border border-green-100":"bg-white text-gray-800 border border-indigo-100 rounded-tl-none"}`,children:[c.jsx("div",{className:"prose prose-sm prose-indigo max-w-none",children:c.jsx(ik,{children:_.content})}),c.jsx("span",{className:"text-[10px] text-gray-400 mt-1 block text-right",children:new Date(_.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},_.id)),x.length>0&&c.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-0 overflow-hidden shadow-sm animate-in fade-in slide-in-from-bottom-2",children:[c.jsx("div",{className:"px-3 py-2 bg-amber-100/50 border-b border-amber-200 flex items-center justify-between",children:c.jsxs("div",{className:"flex items-center gap-1.5 text-amber-800",children:[c.jsx(q6,{size:14}),c.jsx("span",{className:"text-xs font-bold",children:" ()"})]})}),c.jsx("div",{className:"p-3 space-y-3",children:x.map((_,N)=>c.jsxs("div",{className:"bg-white rounded-lg border border-amber-100 p-2 shadow-sm relative group",children:[c.jsx("button",{onClick:()=>C(N),className:"absolute right-2 top-2 text-gray-300 hover:text-red-500 hover:bg-gray-100 p-1 rounded transition-all z-10",title:"",children:c.jsx(rn,{size:14})}),_.type==="update_task"&&c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500 font-bold uppercase tracking-wider mb-1",children:[c.jsx(Ig,{size:12})," "]}),c.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[_.params.title!==void 0&&c.jsx("input",{type:"text",value:_.params.title||"",onChange:j=>I(N,"title",j.target.value),className:"w-full text-xs font-bold border border-gray-200 rounded px-1.5 py-1 focus:ring-1 focus:ring-amber-300 outline-none",placeholder:""}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded border border-gray-100 flex-1",children:[c.jsx("span",{className:"text-[10px] text-gray-400",children:""}),c.jsx("input",{type:"date",value:_.params.start_date||"",onChange:j=>I(N,"start_date",j.target.value),className:"flex-1 text-xs bg-transparent outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded border border-gray-100 w-24",children:[c.jsx(Ji,{size:10,className:"text-gray-400"}),c.jsx("input",{type:"time",value:_.params.start_time||"",onChange:j=>I(N,"start_time",j.target.value),className:"flex-1 text-xs bg-transparent outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded border border-gray-100 w-28",children:[c.jsx(Ba,{size:10,className:"text-gray-400"}),c.jsxs("select",{value:_.params.reminder_minutes??-1,onChange:j=>{const O=parseInt(j.target.value);I(N,"reminder_minutes",O===-1?null:O)},className:"flex-1 text-xs bg-transparent outline-none",children:[c.jsx("option",{value:-1,children:""}),c.jsx("option",{value:0,children:""}),c.jsx("option",{value:10,children:"10"}),c.jsx("option",{value:30,children:"30"}),c.jsx("option",{value:60,children:"1"})]})]})]}),_.params.description!==void 0&&c.jsx("textarea",{value:_.params.description||"",onChange:j=>I(N,"description",j.target.value),className:"w-full text-xs border border-gray-200 rounded px-1.5 py-1 focus:ring-1 focus:ring-amber-300 outline-none resize-none h-16",placeholder:""})]})]}),_.type==="add_subtasks"&&c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500 mb-2 font-bold uppercase tracking-wider",children:[c.jsx(wz,{size:12})," "]}),c.jsx("ul",{className:"space-y-2",children:_.params.tasks.map((j,O)=>c.jsxs("li",{className:"flex flex-col gap-1.5 bg-gray-50 p-2 rounded relative group/item border border-transparent hover:border-gray-200 transition-colors",children:[c.jsxs("div",{className:"flex gap-2 w-full pr-5",children:[c.jsx("input",{type:"text",value:j.title,onChange:P=>I(N,"title",P.target.value,O),className:"flex-1 bg-white text-xs border border-gray-200 rounded px-1.5 py-1 focus:ring-1 focus:ring-amber-300 outline-none",placeholder:""}),c.jsx("button",{onClick:()=>S(N,O),className:"absolute right-1 top-1 text-gray-300 hover:text-red-500 p-1 opacity-0 group-hover/item:opacity-100 transition-opacity",title:"",children:c.jsx(Mr,{size:12})})]}),c.jsxs("div",{className:"flex flex-wrap gap-2 text-[10px]",children:[c.jsxs("div",{className:"flex items-center gap-1 bg-white rounded border border-gray-200 px-1 py-0.5 min-w-[100px]",children:[c.jsx("span",{className:"text-gray-400",children:""}),c.jsx("input",{type:"date",value:j.start_date||"",onChange:P=>I(N,"start_date",P.target.value,O),className:"flex-1 outline-none min-w-0 bg-transparent"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-white rounded border border-gray-200 px-1 py-0.5 w-[80px]",children:[c.jsx(Ji,{size:10,className:"text-gray-400"}),c.jsx("input",{type:"time",value:j.start_time||"",onChange:P=>I(N,"start_time",P.target.value,O),className:"flex-1 outline-none min-w-0 bg-transparent"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-white rounded border border-gray-200 px-1 py-0.5 w-[85px]",children:[c.jsx(Ba,{size:10,className:"text-gray-400"}),c.jsxs("select",{value:j.reminder_minutes??-1,onChange:P=>{const W=parseInt(P.target.value);I(N,"reminder_minutes",W===-1?null:W,O)},className:"flex-1 outline-none bg-transparent",children:[c.jsx("option",{value:-1,children:""}),c.jsx("option",{value:0,children:""}),c.jsx("option",{value:10,children:"10"}),c.jsx("option",{value:60,children:"1hr"})]})]})]})]},O))})]})]},N))}),c.jsxs("div",{className:"p-2 border-t border-amber-200/50 flex gap-2",children:[c.jsx("button",{onClick:()=>g([]),className:"flex-1 py-1.5 text-xs text-gray-500 hover:bg-gray-100 rounded-lg transition-colors",children:""}),c.jsxs("button",{onClick:k,className:"flex-1 py-1.5 bg-amber-500 hover:bg-amber-600 text-white rounded-lg text-sm font-bold shadow-sm transition-colors flex items-center justify-center gap-1.5",children:[" (",x.length,")"]})]})]}),d&&c.jsxs("div",{className:"flex gap-3",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-600 text-white flex items-center justify-center flex-shrink-0",children:c.jsx(Vi,{size:14,className:"animate-spin"})}),c.jsxs("div",{className:"bg-white px-4 py-3 rounded-2xl rounded-tl-none shadow-sm border border-indigo-100 flex items-center gap-2",children:[c.jsx("span",{className:"w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),c.jsx("span",{className:"w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),c.jsx("span",{className:"w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]}),c.jsx("div",{ref:h})]}),c.jsxs("div",{className:"p-3 bg-white border-t border-gray-100",children:[c.jsxs("form",{onSubmit:_=>{_.preventDefault(),D(o)},className:"relative",children:[c.jsxs("div",{className:"relative flex items-end gap-2 bg-gray-50 border border-gray-200 rounded-2xl p-2 focus-within:ring-2 focus-within:ring-indigo-100 focus-within:border-indigo-300 transition-all",children:[c.jsx("textarea",{value:o,onChange:_=>{a(_.target.value),_.target.style.height="auto",_.target.style.height=_.target.scrollHeight+"px"},onKeyDown:_=>{_.key==="Enter"&&(_.metaKey||_.ctrlKey)&&(_.preventDefault(),D(o))},placeholder:" GTD ... (Cmd + Enter )",className:"flex-1 bg-transparent border-none focus:ring-0 text-sm resize-none max-h-32 min-h-[24px] py-1 px-1 custom-scrollbar leading-relaxed outline-none",disabled:d,rows:1,style:{height:"auto",minHeight:"24px"}}),c.jsx("button",{type:"submit",disabled:!o.trim()||d,className:"p-1.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors self-end mb-0.5",title:"Cmd + Enter ",children:c.jsx(Mz,{size:16})})]}),c.jsx("div",{className:"text-[10px] text-gray-400 text-right mt-1 pr-1",children:"Cmd + Enter  / Enter "})]}),c.jsx("div",{className:"mt-2 flex gap-2 overflow-x-auto pb-1 no-scrollbar",children:["","","",""].map(_=>c.jsx("button",{onClick:()=>D(_),disabled:d,className:"px-2.5 py-1 bg-gray-50 hover:bg-indigo-50 text-gray-600 hover:text-indigo-600 border border-gray-100 hover:border-indigo-100 rounded-full text-xs whitespace-nowrap transition-colors",children:_},_))})]})]})}):null},CR=6048e5,ate=864e5,ER=6e4,NR=36e5,dE=Symbol.for("constructDateFrom");function wo(t,e){return typeof t=="function"?t(e):t&&typeof t=="object"&&dE in t?t[dE](e):t instanceof Date?new t.constructor(e):new Date(e)}function Us(t,e){return wo(e||t,t)}function jR(t,e,n){const r=Us(t,n==null?void 0:n.in);return isNaN(e)?wo((n==null?void 0:n.in)||t,NaN):(e&&r.setDate(r.getDate()+e),r)}let lte={};function n0(){return lte}function Lf(t,e){var a,l,u,d;const n=n0(),r=(e==null?void 0:e.weekStartsOn)??((l=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:l.weekStartsOn)??n.weekStartsOn??((d=(u=n.locale)==null?void 0:u.options)==null?void 0:d.weekStartsOn)??0,s=Us(t,e==null?void 0:e.in),i=s.getDay(),o=(i<r?7:0)+i-r;return s.setDate(s.getDate()-o),s.setHours(0,0,0,0),s}function og(t,e){return Lf(t,{...e,weekStartsOn:1})}function IR(t,e){const n=Us(t,e==null?void 0:e.in),r=n.getFullYear(),s=wo(n,0);s.setFullYear(r+1,0,4),s.setHours(0,0,0,0);const i=og(s),o=wo(n,0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);const a=og(o);return n.getTime()>=i.getTime()?r+1:n.getTime()>=a.getTime()?r:r-1}function fE(t){const e=Us(t),n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),+t-+n}function DR(t,...e){const n=wo.bind(null,t||e.find(r=>typeof r=="object"));return e.map(n)}function ag(t,e){const n=Us(t,e==null?void 0:e.in);return n.setHours(0,0,0,0),n}function cte(t,e,n){const[r,s]=DR(n==null?void 0:n.in,t,e),i=ag(r),o=ag(s),a=+i-fE(i),l=+o-fE(o);return Math.round((a-l)/ate)}function ute(t,e){const n=IR(t,e),r=wo((e==null?void 0:e.in)||t,0);return r.setFullYear(n,0,4),r.setHours(0,0,0,0),og(r)}function qh(t,e,n){const[r,s]=DR(n==null?void 0:n.in,t,e);return+ag(r)==+ag(s)}function dte(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function fte(t){return!(!dte(t)&&typeof t!="number"||isNaN(+Us(t)))}function hte(t,e){const n=Us(t,e==null?void 0:e.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}const pte={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},mte=(t,e,n)=>{let r;const s=pte[t];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",e.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function uu(t){return(e={})=>{const n=e.width?String(e.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const gte={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},yte={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},xte={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},bte={date:uu({formats:gte,defaultWidth:"full"}),time:uu({formats:yte,defaultWidth:"full"}),dateTime:uu({formats:xte,defaultWidth:"full"})},wte={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},vte=(t,e,n,r)=>wte[t];function ao(t){return(e,n)=>{const r=n!=null&&n.context?String(n.context):"standalone";let s;if(r==="formatting"&&t.formattingValues){const o=t.defaultFormattingWidth||t.defaultWidth,a=n!=null&&n.width?String(n.width):o;s=t.formattingValues[a]||t.formattingValues[o]}else{const o=t.defaultWidth,a=n!=null&&n.width?String(n.width):t.defaultWidth;s=t.values[a]||t.values[o]}const i=t.argumentCallback?t.argumentCallback(e):e;return s[i]}}const kte={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Ste={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},_te={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Tte={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Cte={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Ete={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Nte=(t,e)=>{const n=Number(t),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},jte={ordinalNumber:Nte,era:ao({values:kte,defaultWidth:"wide"}),quarter:ao({values:Ste,defaultWidth:"wide",argumentCallback:t=>t-1}),month:ao({values:_te,defaultWidth:"wide"}),day:ao({values:Tte,defaultWidth:"wide"}),dayPeriod:ao({values:Cte,defaultWidth:"wide",formattingValues:Ete,defaultFormattingWidth:"wide"})};function lo(t){return(e,n={})=>{const r=n.width,s=r&&t.matchPatterns[r]||t.matchPatterns[t.defaultMatchWidth],i=e.match(s);if(!i)return null;const o=i[0],a=r&&t.parsePatterns[r]||t.parsePatterns[t.defaultParseWidth],l=Array.isArray(a)?Dte(a,f=>f.test(o)):Ite(a,f=>f.test(o));let u;u=t.valueCallback?t.valueCallback(l):l,u=n.valueCallback?n.valueCallback(u):u;const d=e.slice(o.length);return{value:u,rest:d}}}function Ite(t,e){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return n}function Dte(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return n}function MR(t){return(e,n={})=>{const r=e.match(t.matchPattern);if(!r)return null;const s=r[0],i=e.match(t.parsePattern);if(!i)return null;let o=t.valueCallback?t.valueCallback(i[0]):i[0];o=n.valueCallback?n.valueCallback(o):o;const a=e.slice(s.length);return{value:o,rest:a}}}const Mte=/^(\d+)(th|st|nd|rd)?/i,Ate=/\d+/i,Rte={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Ote={any:[/^b/i,/^(a|c)/i]},Pte={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Lte={any:[/1/i,/2/i,/3/i,/4/i]},$te={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},zte={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Fte={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Bte={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Ute={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Hte={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Vte={ordinalNumber:MR({matchPattern:Mte,parsePattern:Ate,valueCallback:t=>parseInt(t,10)}),era:lo({matchPatterns:Rte,defaultMatchWidth:"wide",parsePatterns:Ote,defaultParseWidth:"any"}),quarter:lo({matchPatterns:Pte,defaultMatchWidth:"wide",parsePatterns:Lte,defaultParseWidth:"any",valueCallback:t=>t+1}),month:lo({matchPatterns:$te,defaultMatchWidth:"wide",parsePatterns:zte,defaultParseWidth:"any"}),day:lo({matchPatterns:Fte,defaultMatchWidth:"wide",parsePatterns:Bte,defaultParseWidth:"any"}),dayPeriod:lo({matchPatterns:Ute,defaultMatchWidth:"any",parsePatterns:Hte,defaultParseWidth:"any"})},Wte={code:"en-US",formatDistance:mte,formatLong:bte,formatRelative:vte,localize:jte,match:Vte,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Kte(t,e){const n=Us(t,e==null?void 0:e.in);return cte(n,hte(n))+1}function Gte(t,e){const n=Us(t,e==null?void 0:e.in),r=+og(n)-+ute(n);return Math.round(r/CR)+1}function AR(t,e){var d,f,h,p;const n=Us(t,e==null?void 0:e.in),r=n.getFullYear(),s=n0(),i=(e==null?void 0:e.firstWeekContainsDate)??((f=(d=e==null?void 0:e.locale)==null?void 0:d.options)==null?void 0:f.firstWeekContainsDate)??s.firstWeekContainsDate??((p=(h=s.locale)==null?void 0:h.options)==null?void 0:p.firstWeekContainsDate)??1,o=wo((e==null?void 0:e.in)||t,0);o.setFullYear(r+1,0,i),o.setHours(0,0,0,0);const a=Lf(o,e),l=wo((e==null?void 0:e.in)||t,0);l.setFullYear(r,0,i),l.setHours(0,0,0,0);const u=Lf(l,e);return+n>=+a?r+1:+n>=+u?r:r-1}function qte(t,e){var a,l,u,d;const n=n0(),r=(e==null?void 0:e.firstWeekContainsDate)??((l=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:l.firstWeekContainsDate)??n.firstWeekContainsDate??((d=(u=n.locale)==null?void 0:u.options)==null?void 0:d.firstWeekContainsDate)??1,s=AR(t,e),i=wo((e==null?void 0:e.in)||t,0);return i.setFullYear(s,0,r),i.setHours(0,0,0,0),Lf(i,e)}function Yte(t,e){const n=Us(t,e==null?void 0:e.in),r=+Lf(n,e)-+qte(n,e);return Math.round(r/CR)+1}function In(t,e){const n=t<0?"-":"",r=Math.abs(t).toString().padStart(e,"0");return n+r}const sa={y(t,e){const n=t.getFullYear(),r=n>0?n:1-n;return In(e==="yy"?r%100:r,e.length)},M(t,e){const n=t.getMonth();return e==="M"?String(n+1):In(n+1,2)},d(t,e){return In(t.getDate(),e.length)},a(t,e){const n=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(t,e){return In(t.getHours()%12||12,e.length)},H(t,e){return In(t.getHours(),e.length)},m(t,e){return In(t.getMinutes(),e.length)},s(t,e){return In(t.getSeconds(),e.length)},S(t,e){const n=e.length,r=t.getMilliseconds(),s=Math.trunc(r*Math.pow(10,n-3));return In(s,e.length)}},vc={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},hE={G:function(t,e,n){const r=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(t,e,n){if(e==="yo"){const r=t.getFullYear(),s=r>0?r:1-r;return n.ordinalNumber(s,{unit:"year"})}return sa.y(t,e)},Y:function(t,e,n,r){const s=AR(t,r),i=s>0?s:1-s;if(e==="YY"){const o=i%100;return In(o,2)}return e==="Yo"?n.ordinalNumber(i,{unit:"year"}):In(i,e.length)},R:function(t,e){const n=IR(t);return In(n,e.length)},u:function(t,e){const n=t.getFullYear();return In(n,e.length)},Q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return In(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return In(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(t,e,n){const r=t.getMonth();switch(e){case"M":case"MM":return sa.M(t,e);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(t,e,n){const r=t.getMonth();switch(e){case"L":return String(r+1);case"LL":return In(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(t,e,n,r){const s=Yte(t,r);return e==="wo"?n.ordinalNumber(s,{unit:"week"}):In(s,e.length)},I:function(t,e,n){const r=Gte(t);return e==="Io"?n.ordinalNumber(r,{unit:"week"}):In(r,e.length)},d:function(t,e,n){return e==="do"?n.ordinalNumber(t.getDate(),{unit:"date"}):sa.d(t,e)},D:function(t,e,n){const r=Kte(t);return e==="Do"?n.ordinalNumber(r,{unit:"dayOfYear"}):In(r,e.length)},E:function(t,e,n){const r=t.getDay();switch(e){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(t,e,n,r){const s=t.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return In(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(s,{width:"short",context:"formatting"});case"eeee":default:return n.day(s,{width:"wide",context:"formatting"})}},c:function(t,e,n,r){const s=t.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return In(i,e.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(s,{width:"narrow",context:"standalone"});case"cccccc":return n.day(s,{width:"short",context:"standalone"});case"cccc":default:return n.day(s,{width:"wide",context:"standalone"})}},i:function(t,e,n){const r=t.getDay(),s=r===0?7:r;switch(e){case"i":return String(s);case"ii":return In(s,e.length);case"io":return n.ordinalNumber(s,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(t,e,n){const s=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(t,e,n){const r=t.getHours();let s;switch(r===12?s=vc.noon:r===0?s=vc.midnight:s=r/12>=1?"pm":"am",e){case"b":case"bb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(t,e,n){const r=t.getHours();let s;switch(r>=17?s=vc.evening:r>=12?s=vc.afternoon:r>=4?s=vc.morning:s=vc.night,e){case"B":case"BB":case"BBB":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(t,e,n){if(e==="ho"){let r=t.getHours()%12;return r===0&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return sa.h(t,e)},H:function(t,e,n){return e==="Ho"?n.ordinalNumber(t.getHours(),{unit:"hour"}):sa.H(t,e)},K:function(t,e,n){const r=t.getHours()%12;return e==="Ko"?n.ordinalNumber(r,{unit:"hour"}):In(r,e.length)},k:function(t,e,n){let r=t.getHours();return r===0&&(r=24),e==="ko"?n.ordinalNumber(r,{unit:"hour"}):In(r,e.length)},m:function(t,e,n){return e==="mo"?n.ordinalNumber(t.getMinutes(),{unit:"minute"}):sa.m(t,e)},s:function(t,e,n){return e==="so"?n.ordinalNumber(t.getSeconds(),{unit:"second"}):sa.s(t,e)},S:function(t,e){return sa.S(t,e)},X:function(t,e,n){const r=t.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return mE(r);case"XXXX":case"XX":return gl(r);case"XXXXX":case"XXX":default:return gl(r,":")}},x:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"x":return mE(r);case"xxxx":case"xx":return gl(r);case"xxxxx":case"xxx":default:return gl(r,":")}},O:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+pE(r,":");case"OOOO":default:return"GMT"+gl(r,":")}},z:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+pE(r,":");case"zzzz":default:return"GMT"+gl(r,":")}},t:function(t,e,n){const r=Math.trunc(+t/1e3);return In(r,e.length)},T:function(t,e,n){return In(+t,e.length)}};function pE(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),s=Math.trunc(r/60),i=r%60;return i===0?n+String(s):n+String(s)+e+In(i,2)}function mE(t,e){return t%60===0?(t>0?"-":"+")+In(Math.abs(t)/60,2):gl(t,e)}function gl(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),s=In(Math.trunc(r/60),2),i=In(r%60,2);return n+s+e+i}const gE=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},RR=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},Jte=(t,e)=>{const n=t.match(/(P+)(p+)?/)||[],r=n[1],s=n[2];if(!s)return gE(t,e);let i;switch(r){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",gE(r,e)).replace("{{time}}",RR(s,e))},Xte={p:RR,P:Jte},Qte=/^D+$/,Zte=/^Y+$/,ene=["D","DD","YY","YYYY"];function tne(t){return Qte.test(t)}function nne(t){return Zte.test(t)}function rne(t,e,n){const r=sne(t,e,n);if(console.warn(r),ene.includes(t))throw new RangeError(r)}function sne(t,e,n){const r=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${r} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const ine=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,one=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ane=/^'([^]*?)'?$/,lne=/''/g,cne=/[a-zA-Z]/;function nd(t,e,n){var d,f,h,p,m,y,x,g;const r=n0(),s=(n==null?void 0:n.locale)??r.locale??Wte,i=(n==null?void 0:n.firstWeekContainsDate)??((f=(d=n==null?void 0:n.locale)==null?void 0:d.options)==null?void 0:f.firstWeekContainsDate)??r.firstWeekContainsDate??((p=(h=r.locale)==null?void 0:h.options)==null?void 0:p.firstWeekContainsDate)??1,o=(n==null?void 0:n.weekStartsOn)??((y=(m=n==null?void 0:n.locale)==null?void 0:m.options)==null?void 0:y.weekStartsOn)??r.weekStartsOn??((g=(x=r.locale)==null?void 0:x.options)==null?void 0:g.weekStartsOn)??0,a=Us(t,n==null?void 0:n.in);if(!fte(a))throw new RangeError("Invalid time value");let l=e.match(one).map(v=>{const w=v[0];if(w==="p"||w==="P"){const T=Xte[w];return T(v,s.formatLong)}return v}).join("").match(ine).map(v=>{if(v==="''")return{isToken:!1,value:"'"};const w=v[0];if(w==="'")return{isToken:!1,value:une(v)};if(hE[w])return{isToken:!0,value:v};if(w.match(cne))throw new RangeError("Format string contains an unescaped latin alphabet character `"+w+"`");return{isToken:!1,value:v}});s.localize.preprocessor&&(l=s.localize.preprocessor(a,l));const u={firstWeekContainsDate:i,weekStartsOn:o,locale:s};return l.map(v=>{if(!v.isToken)return v.value;const w=v.value;(!(n!=null&&n.useAdditionalWeekYearTokens)&&nne(w)||!(n!=null&&n.useAdditionalDayOfYearTokens)&&tne(w))&&rne(w,e,String(t));const T=hE[w[0]];return T(a,w,s.localize,u)}).join("")}function une(t){const e=t.match(ane);return e?e[1].replace(lne,"'"):t}function dne(t,e,n){return jR(t,-e,n)}function ul(t,e){const n=()=>wo(e==null?void 0:e.in,NaN),r=(e==null?void 0:e.additionalDigits)??2,s=mne(t);let i;if(s.date){const u=gne(s.date,r);i=yne(u.restDateString,u.year)}if(!i||isNaN(+i))return n();const o=+i;let a=0,l;if(s.time&&(a=xne(s.time),isNaN(a)))return n();if(s.timezone){if(l=bne(s.timezone),isNaN(l))return n()}else{const u=new Date(o+a),d=Us(0,e==null?void 0:e.in);return d.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),d.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),d}return Us(o+a+l,e==null?void 0:e.in)}const Yh={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},fne=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,hne=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,pne=/^([+-])(\d{2})(?::?(\d{2}))?$/;function mne(t){const e={},n=t.split(Yh.dateTimeDelimiter);let r;if(n.length>2)return e;if(/:/.test(n[0])?r=n[0]:(e.date=n[0],r=n[1],Yh.timeZoneDelimiter.test(e.date)&&(e.date=t.split(Yh.timeZoneDelimiter)[0],r=t.substr(e.date.length,t.length))),r){const s=Yh.timezone.exec(r);s?(e.time=r.replace(s[1],""),e.timezone=s[1]):e.time=r}return e}function gne(t,e){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),r=t.match(n);if(!r)return{year:NaN,restDateString:""};const s=r[1]?parseInt(r[1]):null,i=r[2]?parseInt(r[2]):null;return{year:i===null?s:i*100,restDateString:t.slice((r[1]||r[2]).length)}}function yne(t,e){if(e===null)return new Date(NaN);const n=t.match(fne);if(!n)return new Date(NaN);const r=!!n[4],s=rd(n[1]),i=rd(n[2])-1,o=rd(n[3]),a=rd(n[4]),l=rd(n[5])-1;if(r)return _ne(e,a,l)?wne(e,a,l):new Date(NaN);{const u=new Date(0);return!kne(e,i,o)||!Sne(e,s)?new Date(NaN):(u.setUTCFullYear(e,i,Math.max(s,o)),u)}}function rd(t){return t?parseInt(t):1}function xne(t){const e=t.match(hne);if(!e)return NaN;const n=Vy(e[1]),r=Vy(e[2]),s=Vy(e[3]);return Tne(n,r,s)?n*NR+r*ER+s*1e3:NaN}function Vy(t){return t&&parseFloat(t.replace(",","."))||0}function bne(t){if(t==="Z")return 0;const e=t.match(pne);if(!e)return 0;const n=e[1]==="+"?-1:1,r=parseInt(e[2]),s=e[3]&&parseInt(e[3])||0;return Cne(r,s)?n*(r*NR+s*ER):NaN}function wne(t,e,n){const r=new Date(0);r.setUTCFullYear(t,0,4);const s=r.getUTCDay()||7,i=(e-1)*7+n+1-s;return r.setUTCDate(r.getUTCDate()+i),r}const vne=[31,null,31,30,31,30,31,31,30,31,30,31];function OR(t){return t%400===0||t%4===0&&t%100!==0}function kne(t,e,n){return e>=0&&e<=11&&n>=1&&n<=(vne[e]||(OR(t)?29:28))}function Sne(t,e){return e>=1&&e<=(OR(t)?366:365)}function _ne(t,e,n){return e>=1&&e<=53&&n>=0&&n<=6}function Tne(t,e,n){return t===24?e===0&&n===0:n>=0&&n<60&&e>=0&&e<60&&t>=0&&t<25}function Cne(t,e){return e>=0&&e<=59}const Ene={lessThanXSeconds:{one:" 1 ",other:" {{count}} "},xSeconds:{one:"1 ",other:"{{count}} "},halfAMinute:"",lessThanXMinutes:{one:" 1 ",other:" {{count}} "},xMinutes:{one:"1 ",other:"{{count}} "},xHours:{one:"1 ",other:"{{count}} "},aboutXHours:{one:" 1 ",other:" {{count}} "},xDays:{one:"1 ",other:"{{count}} "},aboutXWeeks:{one:" 1 ",other:" {{count}} "},xWeeks:{one:"1 ",other:"{{count}} "},aboutXMonths:{one:" 1 ",other:" {{count}} "},xMonths:{one:"1 ",other:"{{count}} "},aboutXYears:{one:" 1 ",other:" {{count}} "},xYears:{one:"1 ",other:"{{count}} "},overXYears:{one:" 1 ",other:" {{count}} "},almostXYears:{one:" 1 ",other:" {{count}} "}},Nne=(t,e,n)=>{let r;const s=Ene[t];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",String(e)),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?r+"":r+"":r},jne={full:"y''M''d'' EEEE",long:"y''M''d''",medium:"yyyy-MM-dd",short:"yy-MM-dd"},Ine={full:"zzzz a h:mm:ss",long:"z a h:mm:ss",medium:"a h:mm:ss",short:"a h:mm"},Dne={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},Mne={date:uu({formats:jne,defaultWidth:"full"}),time:uu({formats:Ine,defaultWidth:"full"}),dateTime:uu({formats:Dne,defaultWidth:"full"})},Ane={lastWeek:"''eeee p",yesterday:"'' p",today:"'' p",tomorrow:"'' p",nextWeek:"''eeee p",other:"P"},Rne=(t,e,n,r)=>Ane[t],One={narrow:["",""],abbreviated:["",""],wide:["",""]},Pne={narrow:["1","2","3","4"],abbreviated:["","","",""],wide:["","","",""]},Lne={narrow:["","","","","","","","","","","",""],abbreviated:["1","2","3","4","5","6","7","8","9","10","11","12"],wide:["","","","","","","","","","","",""]},$ne={narrow:["","","","","","",""],short:["","","","","","",""],abbreviated:["","","","","","",""],wide:["","","","","","",""]},zne={narrow:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},abbreviated:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},wide:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""}},Fne={narrow:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},abbreviated:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},wide:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""}},Bne=(t,e)=>{const n=Number(t);switch(e==null?void 0:e.unit){case"date":return n+"";case"hour":return n+"";case"minute":return n+"";case"second":return n+"";default:return" "+n}},Une={ordinalNumber:Bne,era:ao({values:One,defaultWidth:"wide"}),quarter:ao({values:Pne,defaultWidth:"wide",argumentCallback:t=>t-1}),month:ao({values:Lne,defaultWidth:"wide"}),day:ao({values:$ne,defaultWidth:"wide"}),dayPeriod:ao({values:zne,defaultWidth:"wide",formattingValues:Fne,defaultFormattingWidth:"wide"})},Hne=/^(\s*)?\d+(|||)?/i,Vne=/\d+/i,Wne={narrow:/^()/i,abbreviated:/^()/i,wide:/^(|)/i},Kne={any:[/^()/i,/^()/i]},Gne={narrow:/^[1234]/i,abbreviated:/^[]/i,wide:/^[]/i},qne={any:[/(1|)/i,/(2|)/i,/(3|)/i,/(4|)/i]},Yne={narrow:/^(|||||||||[])/i,abbreviated:/^(|||||||||[]|\d|1[12])/i,wide:/^(|||||||||[])/i},Jne={narrow:[/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^(?!(|))/i,/^/i,/^/i],any:[/^|1/i,/^|2/i,/^|3/i,/^|4/i,/^|5/i,/^|6/i,/^|7/i,/^|8/i,/^|9/i,/^(?!(|))|10/i,/^|11/i,/^|12/i]},Xne={narrow:/^[]/i,short:/^[]/i,abbreviated:/^[]/i,wide:/^[]/i},Qne={any:[//i,//i,//i,//i,//i,//i,//i]},Zne={any:/^(?|?||[]|?||?|)/i},ere={any:{am:/^?/i,pm:/^?/i,midnight:/^/i,noon:/^[]/i,morning:/^/i,afternoon:/^/i,evening:/^?/i,night:/^/i}},tre={ordinalNumber:MR({matchPattern:Hne,parsePattern:Vne,valueCallback:t=>parseInt(t,10)}),era:lo({matchPatterns:Wne,defaultMatchWidth:"wide",parsePatterns:Kne,defaultParseWidth:"any"}),quarter:lo({matchPatterns:Gne,defaultMatchWidth:"wide",parsePatterns:qne,defaultParseWidth:"any",valueCallback:t=>t+1}),month:lo({matchPatterns:Yne,defaultMatchWidth:"wide",parsePatterns:Jne,defaultParseWidth:"any"}),day:lo({matchPatterns:Xne,defaultMatchWidth:"wide",parsePatterns:Qne,defaultParseWidth:"any"}),dayPeriod:lo({matchPatterns:Zne,defaultMatchWidth:"any",parsePatterns:ere,defaultParseWidth:"any"})},yE={code:"zh-TW",formatDistance:Nne,formatLong:Mne,formatRelative:Rne,localize:Une,match:tre,options:{weekStartsOn:1,firstWeekContainsDate:4}},as=64,PR=({onClose:t,isStandalone:e=!1})=>{const n=b.useContext(Tn),{tasks:r,tags:s,updateTask:i,addTask:o,user:a,setEditingTaskId:l,editingTaskId:u,setToast:d,undo:f,redo:h,canUndo:p,canRedo:m}=n,[y,x]=b.useState(new Date),[g,v]=b.useState(()=>{const ee=localStorage.getItem("heart_schedule_tags");return ee?JSON.parse(ee):[]}),[w,T]=b.useState(!1),[D,k]=b.useState(!1),[I,C]=b.useState([]),[S,_]=b.useState(!1),[N,j]=b.useState(null),[O,P]=b.useState(null),[W,R]=b.useState(null),[M,X]=b.useState(!1),[Q,A]=b.useState([]),Te=S?Q:s,we=()=>S?Te.find(ee=>ee.name.includes("-Wei")):Te.find(ee=>ee.name==="Google:")||Te.find(ee=>ee.name.includes("Google:"))||Te.find(ee=>ee.name.includes("")&&ee.name.toLowerCase().includes("google"))||Te.find(ee=>ee.name.includes("")),B=ee=>{const q=(ee.tags||[]).some(Z=>{const ge=Te.find(xe=>xe.id===Z);return ge&&ge.name.includes("-Wei")});return S?q?{canEdit:!0}:{canEdit:!1,reason:"Guest -Wei"}:q?{canEdit:!1,reason:"-Wei Guest "}:{canEdit:!0}},F=b.useRef(null);b.useEffect(()=>{F.current&&(F.current.scrollTop=8*as-20)},[e]),b.useEffect(()=>{const ee=new URLSearchParams(window.location.search),fe=ee.get("d"),q=ee.get("date"),Z=ee.get("tags");if(q&&x(ul(q)),Z)try{const ge=JSON.parse(decodeURIComponent(Z));Array.isArray(ge)&&A(ge)}catch(ge){console.error("Failed to parse tags",ge)}if(fe)try{const ge=decodeURIComponent(fe);let xe;try{xe=JSON.parse(ge)}catch{console.warn("Direct JSON parse failed")}xe&&Array.isArray(xe)&&(C(xe),_(!0))}catch(ge){console.error("Failed to parse snapshot data",ge)}},[]),b.useEffect(()=>{if(!S||!je)return;const ee=window.location.pathname.split("/"),fe=ee.indexOf("heart");if(fe===-1||!ee[fe+1])return;const q=ee[fe+1];if(q==="share")return;const Z=async()=>{try{const{data:xe,error:be}=await je.from("tasks").select("*").eq("user_id",q).neq("status","deleted");be?console.error("[GuestRealtime] Failed to load initial data:",be):xe&&(console.log("[GuestRealtime] Loaded initial data:",xe.length,"tasks"),C(xe))}catch(xe){console.error("[GuestRealtime] Error loading initial data:",xe)}},ge=je.channel(`guest-sync-${q}`).on("postgres_changes",{event:"*",schema:"public",table:"tasks",filter:`user_id=eq.${q}`},xe=>{const{eventType:be,new:ve,old:ot}=xe;C(et=>be==="INSERT"?et.some(G=>G.id===ve.id)?et:[...et,ve]:be==="UPDATE"?et.map(G=>G.id===ve.id?{...G,...ve}:G):be==="DELETE"?et.filter(G=>G.id!==ot.id):et)}).subscribe((xe,be)=>{var ve;console.log(`[GuestRealtime] Status: ${xe}`,be),xe==="SUBSCRIBED"&&Z(),xe==="CHANNEL_ERROR"&&(console.error("[GuestRealtime] Connection Error:",be),(ve=be==null?void 0:be.message)!=null&&ve.includes("401")&&console.error("RLS Policy likely blocking anon access. Please check supabase_guest_policy.sql"))});return()=>{je.removeChannel(ge)}},[S]),b.useEffect(()=>{S&&I.length>0&&r.length>0&&C(ee=>ee.map(fe=>{const q=r.find(Z=>Z.id===fe.id);return q?{...fe,...q}:fe}))},[r]);const ne=b.useMemo(()=>{if(!S)return null;const ee=window.location.pathname.split("/"),fe=ee.indexOf("heart");if(fe!==-1&&ee[fe+1]){const q=ee[fe+1];return q==="share"?null:q}return null},[S]),We=b.useMemo(()=>{const ee=fe=>{if(fe.start_date&&!fe.is_all_day&&(!fe.start_time||!fe.end_time)){const q={...fe},Z=new Date(fe.start_date),ge=Z.getHours()*60+Z.getMinutes();if(q.start_time||(q.start_time=_e(ge)),!q.end_time&&(q.duration||fe.duration)){const xe=Number(q.duration||fe.duration);q.end_time=_e(ge+xe)}return q}return fe};return{...n,tasks:S?I:r,tags:Te,updateTask:async(fe,q,Z)=>{if(fe==="new"){P(xe=>({...xe,...q}));return}const ge=ee(q);if(S&&ne&&je){console.log("[Guest] Updating task:",fe,ge);const{error:xe}=await je.from("tasks").update(ge).eq("id",fe);if(xe){alert(`: ${xe.message}
`),console.error("Guest Update Error:",xe);return}}else await i(fe,ge,Z);S&&C(xe=>xe.map(be=>be.id===fe?{...be,...ge}:be))},addTask:async(fe,q)=>{const Z=ee(fe);let ge=fe.id||`guest-${Date.now()}`;fe.id||(ge=crypto.randomUUID?crypto.randomUUID():`guest-${Date.now()}`);try{if(S&&ne&&je){if(!ne)return alert(` ID (URL ID: ${ne})`),"";let xe=Z.tags||[];if(xe.length===0){const ot=Te.find(et=>et.name.includes("-Wei"))||Te.find(et=>et.name.toLowerCase().includes("wei")&&!et.name.toLowerCase().includes("google"));if(ot)xe=[ot.id];else if(g.length>0)xe=g;else if(Te.length>0){const et=Te.find(G=>!G.name.toLowerCase().includes("google"));xe=[et?et.id:Te[0].id]}}const be={...Z,id:ge,user_id:ne,created_at:new Date().toISOString(),status:"todo",tags:xe};console.log("[Guest] Inserting task for owner:",ne,be);const{error:ve}=await je.from("tasks").insert([be]).select();if(ve)throw ve;d==null||d({msg:"",type:"info"})}else ge=await o(Z,q)}catch(xe){if(console.warn("Guest addTask failed",xe),alert(`: ${(xe==null?void 0:xe.message)||""}`),!S)return""}if(S){const xe={id:ge,...Z,user_id:ne};C(be=>[...be,xe])}return ge},deleteTask:async fe=>{if(S&&ne&&je){console.log("[Guest] Deleting task:",fe);const{error:q}=await je.from("tasks").delete().eq("id",fe);q?(alert(`: ${q.message}`),console.error("Guest Delete Error:",q)):d==null||d({msg:"",type:"info"})}else await n.deleteTask(fe);S&&(C(q=>q.filter(Z=>Z.id!==fe)),W===fe&&R(null))}}},[n,S,Te,ne,W,d]),ft=ee=>{v(fe=>{const q=fe.includes(ee)?fe.filter(Z=>Z!==ee):[...fe,ee];return localStorage.setItem("heart_schedule_tags",JSON.stringify(q)),q})};b.useEffect(()=>{const ee=async fe=>{var Z;if(!W||u)return;const q=(Z=document.activeElement)==null?void 0:Z.tagName;if(!(q==="INPUT"||q==="TEXTAREA"||document.activeElement.isContentEditable)&&(fe.key==="Delete"||fe.key==="Backspace")&&(fe.preventDefault(),window.confirm(""))){const ge=W;await We.deleteTask(ge),R(null)}};return window.addEventListener("keydown",ee),()=>window.removeEventListener("keydown",ee)},[W,u,We]);const le=b.useMemo(()=>S?I.filter(Z=>{if(Z.status==="deleted")return!1;let ge=null;return Z.start_date?ge=ul(Z.start_date):Z.due_date&&(ge=ul(Z.due_date)),!ge||!qh(ge,y)?!1:g.length===0?!0:!Z.tags||Z.tags.length===0?!1:Z.tags.some(xe=>g.includes(xe))}):(!r.some(Z=>{const ge=Z.start_date?ul(Z.start_date):Z.due_date?ul(Z.due_date):null;return ge&&qh(ge,y)&&Z.status!=="deleted"})&&I.length>0?I:r).filter(Z=>{if(Z.status==="deleted")return!1;let ge=null;return Z.start_date?ge=ul(Z.start_date):Z.due_date&&(ge=ul(Z.due_date)),!ge||!qh(ge,y)?!1:g.length===0?!0:!Z.tags||Z.tags.length===0?!1:Z.tags.some(xe=>g.includes(xe))}),[r,y,g,I,S]),De=b.useMemo(()=>le.filter(ee=>ee.is_all_day||!ee.start_time),[le]),ie=b.useMemo(()=>le.filter(ee=>!ee.is_all_day&&ee.start_time),[le]),Fe=ee=>{if(!ee)return 0;const[fe,q]=ee.split(":").map(Number);return fe*60+q},_e=ee=>{const fe=Math.floor(ee/60),q=Math.floor(ee%60);return`${String(fe).padStart(2,"0")}:${String(q).padStart(2,"0")}`},tt=ee=>{const fe=Fe(ee.start_time);let q=ee.duration||60;const Z=fe/60*as,ge=q/60*as;return{top:`${Z}px`,height:`${Math.max(24,ge)}px`}},Xe=ee=>{if(ee.length===0)return{};const fe=ee.map(be=>({id:be.id,start:Fe(be.start_time),end:Fe(be.start_time)+(be.duration||60)})).sort((be,ve)=>be.start-ve.start),q=[];let Z=[],ge=-1;fe.forEach(be=>{Z.length===0?(Z.push(be),ge=be.end):be.start<ge?(Z.push(be),ge=Math.max(ge,be.end)):(q.push(Z),Z=[be],ge=be.end)}),Z.length>0&&q.push(Z);const xe={};return q.forEach(be=>{const ve=[];be.forEach(Ae=>{let Y=!1;for(let Ie=0;Ie<ve.length;Ie++){const Le=ve[Ie],ct=Le[Le.length-1];if(Ae.start>=ct.end){Le.push(Ae),Y=!0;break}}Y||ve.push([Ae])});const et=100/ve.length,G={},ae=[];be.forEach(Ae=>{let Y=!1;for(let Ie=0;Ie<ae.length;Ie++){const Le=ae[Ie],ct=Le[Le.length-1];if(Ae.start>=ct.end){Le.push(Ae),G[Ae.id]=Ie,Y=!0;break}}Y||(ae.push([Ae]),G[Ae.id]=ae.length-1)}),be.forEach(Ae=>{const Y=G[Ae.id];xe[Ae.id]={left:`${Y*et}%`,width:`${et}%`}})}),xe},[Ve,it]=b.useState(null),Ue=b.useRef(Ve);b.useEffect(()=>{Ue.current=Ve},[Ve]);const K=b.useRef(null),ue=()=>{K.current&&(window.removeEventListener("touchmove",K.current.move),window.removeEventListener("touchend",K.current.end),window.removeEventListener("touchcancel",K.current.end),K.current=null)},re=(ee,fe,q)=>{ee.stopPropagation(),ue();const ge=ee.touches[0].clientY,xe=Fe(fe.start_time),be=fe.duration||60;it({taskId:fe.id,initialY:ge,originalStartMin:xe,originalDuration:be,type:q,currentStartMin:xe,currentDuration:be,isTouch:!0});const ve=et=>{et.cancelable&&et.preventDefault();const ae=(et.touches?et.touches[0].clientY:0)-ge,Ae=Math.round(ae/as*60/15)*15;if(q==="move"){let Y=xe+Ae;Y=Math.max(0,Math.min(1440-be,Y)),it(Ie=>Ie?{...Ie,currentStartMin:Y}:null)}else{let Y=be+Ae;Y=Math.max(15,Y),it(Ie=>Ie?{...Ie,currentDuration:Y}:null)}},ot=()=>{try{const et=Ue.current;if(et&&et.taskId===fe.id){const{currentStartMin:G,currentDuration:ae}=et,Ae=_e(G),Y=_e(G+ae),Ie=new Date(y);Ie.setHours(Math.floor(G/60)),Ie.setMinutes(G%60);const Le={start_time:Ae,duration:ae,end_time:Y,start_date:Ie.toISOString()};i(fe.id,Le),S&&C(ct=>ct.map(Rt=>Rt.id===fe.id?{...Rt,...Le}:Rt))}}finally{it(null),ue()}};K.current={move:ve,end:ot},window.addEventListener("touchmove",ve,{passive:!1}),window.addEventListener("touchend",ot),window.addEventListener("touchcancel",ot)},oe=(ee,fe,q)=>{ee.stopPropagation(),ee.preventDefault();const Z=Fe(fe.start_time);it({taskId:fe.id,initialY:ee.clientY,originalStartMin:Z,originalDuration:fe.duration||60,type:q,currentStartMin:Z,currentDuration:fe.duration||60})},pe=(ee,fe)=>{ee.dataTransfer.setData("text/plain",fe.id),ee.dataTransfer.setData("from-allday","true")},se=async ee=>{ee.preventDefault();const fe=ee.dataTransfer.getData("text/plain");if(ee.dataTransfer.getData("from-allday"),!fe)return;const q=ee.currentTarget.getBoundingClientRect(),Z=ee.currentTarget.scrollTop||0,ge=ee.clientY-q.top+Z,xe=Math.floor(ge/as*60/15)*15,be=(S?I:r).find(et=>et.id===fe),ve=(be==null?void 0:be.duration)||60,ot=new Date(y);ot.setHours(Math.floor(xe/60)),ot.setMinutes(xe%60),await We.updateTask(fe,{start_date:ot.toISOString(),start_time:_e(xe),end_time:_e(xe+ve),duration:ve,is_all_day:!1})},Se=async ee=>{ee.preventDefault();const fe=ee.dataTransfer.getData("text/plain");fe&&await We.updateTask(fe,{start_date:y.toISOString(),is_all_day:!0,start_time:null,end_time:null,duration:null})},Pe=ee=>{ee.preventDefault(),ee.dataTransfer.dropEffect="move"},ye=ee=>{R(null);const fe=ee.currentTarget.getBoundingClientRect(),q=ee.clientY-fe.top,Z=Math.floor(q/as*60/15)*15;if(window.innerWidth<768){const ge=new Date(y);ge.setHours(Math.floor(Z/60)),ge.setMinutes(Z%60);const xe=we(),be=xe?[xe.id]:[],ve={id:"new",title:"",start_time:_e(Z),duration:60,end_time:_e(Z+60),start_date:ge.toISOString(),is_all_day:!1,tags:be};P(ve),l("new");return}j({startY:ee.clientY,startMin:Z,currentDuration:60})};b.useEffect(()=>{if((!Ve||Ve.isTouch)&&!N)return;const ee=ve=>{if(Ve){const ot=ve-Ve.initialY,et=Math.round(ot/as*60/15)*15;if(Ve.type==="move"){let G=Ve.originalStartMin+et;G=Math.max(0,Math.min(1440-Ve.currentDuration,G)),it(ae=>ae?{...ae,currentStartMin:G}:null)}else{let G=Ve.originalDuration+et;G=Math.max(15,G),it(ae=>ae?{...ae,currentDuration:G}:null)}}else if(N){const ot=ve-N.startY;let G=60+Math.round(ot/as*60/15)*15;G<15&&(G=15),j(ae=>ae?{...ae,currentDuration:G}:null)}},fe=()=>{if(Ve){const{taskId:ve,currentStartMin:ot,currentDuration:et}=Ve,G=_e(ot),ae=_e(ot+et),Ae=new Date(y);Ae.setHours(Math.floor(ot/60)),Ae.setMinutes(ot%60);const Y={start_time:G,duration:et,end_time:ae,start_date:Ae.toISOString()};i(ve,Y),S&&C(Ie=>Ie.map(Le=>Le.id===ve?{...Le,...Y}:Le)),it(null)}else if(N){const ve=new Date(y);ve.setHours(Math.floor(N.startMin/60)),ve.setMinutes(N.startMin%60);const ot=we(),et=ot?[ot.id]:[],G={id:"new",title:"",start_time:_e(N.startMin),duration:N.currentDuration,end_time:_e(N.startMin+N.currentDuration),start_date:ve.toISOString(),is_all_day:!1,tags:et};P(G),l("new"),j(null)}},q=ve=>ee(ve.clientY),Z=()=>fe(),ge=ve=>{ve.cancelable&&ve.preventDefault(),ee(ve.touches[0].clientY)},xe=()=>fe(),be=()=>fe();return window.addEventListener("mousemove",q),window.addEventListener("mouseup",Z),window.addEventListener("touchmove",ge,{passive:!1}),window.addEventListener("touchend",xe),window.addEventListener("touchcancel",be),()=>{window.removeEventListener("mousemove",q),window.removeEventListener("mouseup",Z),window.removeEventListener("touchmove",ge),window.removeEventListener("touchend",xe),window.removeEventListener("touchcancel",be)}},[Ve,N,y,i,S,s]);const ze=b.useRef(null),Ze=b.useRef({x:0,y:0}),gt=b.useRef(!1),vt=b.useRef(0),me=b.useRef(60),He=ee=>{ue(),Ve&&it(null),R(null)},qe=ee=>{const fe=ee.touches[0];if(gt.current&&F.current){const ge=F.current.getBoundingClientRect(),xe=F.current.scrollTop;let ot=(fe.clientY-ge.top+xe)/as*60-vt.current;ot<15&&(ot=15),ot=Math.round(ot/15)*15,me.current=ot,j(et=>et&&{...et,currentDuration:ot});return}const q=Math.abs(fe.clientX-Ze.current.x),Z=Math.abs(fe.clientY-Ze.current.y);(q>10||Z>10)&&ze.current&&(clearTimeout(ze.current),ze.current=null)},nt=()=>{if(ze.current&&(clearTimeout(ze.current),ze.current=null),gt.current){gt.current=!1;const ee=vt.current,fe=me.current,q=_e(ee),Z=_e(ee+fe),ge=Te.find(be=>be.name.includes("-Wei"))||Te.find(be=>be.name.toLowerCase().includes("wei")&&!be.name.toLowerCase().includes("google")),xe=ge?[ge.id]:[];P({title:"",start_time:q,end_time:Z,start_date:nd(y,"yyyy-MM-dd"),duration:fe,is_all_day:!1,tags:xe}),l("new"),j(null)}},Me=()=>{const ee=le;if(ee.length===0&&!confirm(""))return;const fe=ee.map(ae=>({id:ae.id,title:ae.title,start_time:ae.start_time,end_time:ae.end_time,status:ae.status,tags:ae.tags,duration:ae.duration,start_date:ae.start_date})),q=new Set(fe.flatMap(ae=>ae.tags||[])),Z=s.find(ae=>ae.name.includes("-Wei"));Z&&q.add(Z.id);const ge=s.filter(ae=>q.has(ae.id)).map(ae=>({id:ae.id,name:ae.name,color:ae.color})),xe=JSON.stringify(ge),be=encodeURIComponent(xe),ve=JSON.stringify(fe),ot=encodeURIComponent(ve),et=nd(y,"yyyy-MM-dd"),G=`${window.location.origin}/share/heart/${(a==null?void 0:a.id)||"share"}?date=${et}&d=${ot}&tags=${be}`;navigator.clipboard.writeText(G),alert(`( ${fe.length} )`),k(!1)},ut=b.useMemo(()=>{const ee=ie.map(fe=>Ve&&Ve.taskId===fe.id?{...fe,start_time:_e(Ve.currentStartMin),duration:Ve.currentDuration}:fe);return Xe(ee)},[ie,Ve]);return c.jsxs("div",{className:"fixed inset-0 z-[1000] bg-white/95 backdrop-blur-xl flex flex-col overflow-hidden font-sans text-gray-800",children:[c.jsx("div",{className:"absolute top-0 right-0 w-[50vh] h-[50vh] bg-pink-200/20 rounded-full blur-[100px] pointer-events-none"}),c.jsx("div",{className:"absolute bottom-0 left-0 w-[50vh] h-[50vh] bg-purple-200/20 rounded-full blur-[100px] pointer-events-none"}),c.jsxs("header",{className:"flex-shrink-0 px-6 py-4 flex items-center justify-between relative z-10 bg-white/50 backdrop-blur-sm border-b border-pink-100",children:[!e&&t&&c.jsx("button",{onClick:t,className:"p-2 rounded-full hover:bg-gray-100 text-gray-500",children:c.jsx(rn,{size:20})}),e&&c.jsx("div",{className:"w-10"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(im,{className:"text-pink-500 fill-pink-500 animate-pulse",size:24}),c.jsx("span",{className:"text-lg font-bold tracking-wide bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent",children:"Our Time"})]}),c.jsxs("div",{className:"flex gap-2",children:[S&&c.jsx("button",{onClick:()=>{_(!1),window.history.replaceState({},"",window.location.pathname)},className:"text-xs bg-amber-100 text-amber-700 px-3 py-1 rounded-full font-medium",children:" ()"}),c.jsx("button",{onClick:()=>f(),disabled:!p,className:`p-2 rounded-full transition-colors ${p?"hover:bg-gray-100 text-gray-700":"text-gray-300 cursor-not-allowed"}`,title:" (Ctrl+Z)",children:c.jsx(Dg,{size:18})}),c.jsx("button",{onClick:()=>h(),disabled:!m,className:`p-2 rounded-full transition-colors ${m?"hover:bg-gray-100 text-gray-700":"text-gray-300 cursor-not-allowed"}`,title:" (Ctrl+Shift+Z)",children:c.jsx(jw,{size:18})}),c.jsx("button",{onClick:()=>T(!w),className:`p-2 rounded-full transition-colors ${w?"bg-pink-100 text-pink-600":"hover:bg-gray-100 text-gray-500"}`,children:c.jsx(LI,{size:20})}),c.jsx("button",{onClick:()=>k(!0),className:"p-2 rounded-full bg-pink-50 text-pink-500 hover:bg-pink-100",children:c.jsx(Rz,{size:20})})]})]}),c.jsxs("div",{className:"flex items-center justify-between px-6 py-2 relative z-10 bg-white/30 backdrop-blur-sm border-b border-gray-100",children:[c.jsx("button",{onClick:()=>x(dne(y,1)),className:"p-1 text-gray-400 hover:text-pink-500",children:c.jsx(Mu,{size:18})}),c.jsxs("div",{className:"text-center cursor-pointer",onClick:()=>x(new Date),children:[c.jsx("div",{className:"text-lg font-bold text-gray-800",children:nd(y,"M d",{locale:yE})}),c.jsx("div",{className:"text-[10px] text-pink-500 font-medium tracking-widest uppercase",children:nd(y,"EEEE",{locale:yE})}),(()=>{const ee=kR(y);return ee?c.jsxs("div",{className:"text-[10px] text-amber-600 font-bold mt-0.5 tracking-wide",children:[" ",ee]}):null})()]}),c.jsx("button",{onClick:()=>x(jR(y,1)),className:"p-1 text-gray-400 hover:text-pink-500",children:c.jsx(ns,{size:18})})]}),c.jsx(go,{children:w&&c.jsx(Rr.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"overflow-hidden border-b border-gray-100 bg-gray-50/80 backdrop-blur",children:c.jsxs("div",{className:"p-4",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-2 font-medium",children:""}),c.jsx("div",{className:"flex flex-wrap gap-2",children:Te.map(ee=>c.jsx("button",{onClick:()=>ft(ee.id),className:`px-3 py-1 rounded-full text-xs transition-all border ${g.includes(ee.id)?"bg-pink-500 text-white border-pink-500 shadow-md transform scale-105":"bg-white text-gray-600 border-gray-200"}`,children:ee.name},ee.id))})]})})}),c.jsxs("div",{ref:F,className:"flex-1 overflow-y-auto relative z-0 hide-scrollbar scroll-smooth",children:[De.length>0&&c.jsxs("div",{className:"sticky top-0 z-30 bg-gradient-to-b from-pink-50/90 to-purple-50/90 backdrop-blur-md border-b-2 border-pink-200/50 px-6 py-2",onDragOver:Pe,onDrop:Se,onDoubleClick:async()=>{const ee=await We.addTask({title:"",start_date:y.toISOString(),is_all_day:!0,status:"inbox"});l(ee)},children:[c.jsxs("div",{className:"text-[10px] font-bold text-pink-600 uppercase tracking-wider flex items-center gap-1.5 cursor-pointer select-none",onClick:()=>X(!M),children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-pink-500"}),"",c.jsx("span",{className:"text-pink-400 ml-auto",children:M?c.jsx(pp,{size:14}):c.jsx(es,{size:14})})]}),M&&c.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:De.map(ee=>{var q;const fe=((q=s.find(Z=>{var ge;return(ge=ee.tags)==null?void 0:ge.includes(Z.id)}))==null?void 0:q.color)||"#ec4899";return c.jsx("div",{draggable:!0,onDragStart:Z=>pe(Z,ee),onClick:()=>{const Z=B(ee);if(!Z.canEdit){d==null||d({msg:Z.reason||"",type:"error"});return}l(ee.id)},className:"group relative px-3 py-1.5 rounded-full text-xs font-medium cursor-pointer transition-all hover:shadow-md hover:scale-105 border-2",style:{backgroundColor:fe+"20",borderColor:fe+"60",color:fe},children:c.jsxs("div",{className:"flex items-center gap-1.5",children:[ee.status==="completed"&&c.jsx(gf,{size:12,className:"flex-shrink-0"}),c.jsx("span",{className:"truncate max-w-[200px]",children:ee.title||"()"})]})},ee.id)})})]}),c.jsxs("div",{className:"relative min-h-[1536px] w-full bg-white/40 cursor-crosshair",onMouseDown:ye,onTouchStart:He,onTouchMove:qe,onTouchEnd:nt,onDragOver:Pe,onDrop:se,children:[Array.from({length:24}).map((ee,fe)=>c.jsxs("div",{className:"absolute w-full border-t border-gray-100 flex pointer-events-none",style:{top:fe*as,height:as},children:[c.jsxs("div",{className:"w-14 text-[10px] text-gray-400 font-mono text-right pr-2 -mt-2 select-none",children:[fe.toString().padStart(2,"0"),":00"]}),c.jsx("div",{className:"flex-1 border-l border-gray-50 h-full relative",children:c.jsx("div",{className:"absolute top-1/2 w-full border-t border-gray-50 border-dashed"})})]},fe)),qh(new Date,y)&&c.jsx("div",{className:"absolute left-14 right-0 border-t-2 border-red-400 z-20 pointer-events-none flex items-center",style:{top:(new Date().getHours()*60+new Date().getMinutes())/60*as},children:c.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full -ml-1"})}),N&&c.jsx("div",{className:"absolute left-16 right-2 bg-pink-100/50 border-2 border-pink-400 border-dashed rounded-xl z-30 pointer-events-none",style:{top:`${N.startMin/60*as}px`,height:`${N.currentDuration/60*as}px`},children:c.jsxs("div",{className:"p-2 text-xs font-bold text-pink-600",children:[_e(N.startMin)," - ",_e(N.startMin+N.currentDuration)," ..."]})}),c.jsx("div",{className:"absolute top-0 right-2 left-16 bottom-0 pointer-events-none",children:ie.map(ee=>{const fe=(Ve==null?void 0:Ve.taskId)===ee.id,q=ut[ee.id],Z=fe?{top:`${Ve.currentStartMin/60*as}px`,height:`${Ve.currentDuration/60*as}px`,left:(q==null?void 0:q.left)||"0%",width:(q==null?void 0:q.width)||"100%",zIndex:50}:{...tt(ee),left:(q==null?void 0:q.left)||"0%",width:(q==null?void 0:q.width)||"100%"};let ge="#ec4899";if(ee.tags&&ee.tags.length>0){const be=Te.filter(ot=>ee.tags.includes(ot.id)),ve=be.find(ot=>ot.name.toLowerCase().includes("google"))||be[0];ve&&ve.color&&(ge=ve.color)}const xe=ee.status==="completed"?{}:{borderColor:ge,backgroundColor:`${ge}1A`,borderLeftWidth:"4px",borderLeftColor:ge};return c.jsxs("div",{style:{...Z,...xe},className:`absolute w-full rounded-r-xl rounded-l-md border p-2 text-xs flex flex-col overflow-hidden transition-all shadow-sm group pointer-events-auto
                                        ${ee.status==="completed"?"bg-gray-50 border-gray-200 opacity-60":"hover:shadow-md"}
                                        ${fe?"shadow-xl ring-2 ring-pink-400 opacity-90 cursor-grabbing":"cursor-grab"}
                                        ${W===ee.id?"ring-2 ring-pink-500 z-10 shadow-md":""}
                                    `,onClick:be=>{be.stopPropagation(),fe||R(ee.id)},onDoubleClick:be=>{if(be.stopPropagation(),!fe){const ve=B(ee);if(!ve.canEdit){d==null||d({msg:ve.reason||"",type:"error"});return}l(ee.id),P(null)}},onMouseDown:be=>{const ve=B(ee);if(!ve.canEdit){be.stopPropagation(),be.preventDefault(),d==null||d({msg:ve.reason||"",type:"error"});return}oe(be,ee,"move")},onTouchStart:be=>re(be,ee,"move"),children:[W===ee.id&&c.jsx("div",{className:"absolute top-1 right-1 p-1.5 bg-red-500 text-white rounded-full shadow-lg z-50 cursor-pointer transform hover:scale-110 active:scale-95 transition-all",onClick:be=>{be.stopPropagation(),window.confirm("")&&(We.deleteTask(ee.id),R(null))},children:c.jsx(Mr,{size:14})}),c.jsxs("div",{className:"flex items-center gap-1 font-bold text-gray-800 shrink-0",children:[c.jsx("div",{className:"w-2 h-2 rounded-full mb-0.5",style:{backgroundColor:ee.status==="completed"?"#9ca3af":ge}}),c.jsx("span",{className:"truncate",children:ee.title}),ee.status==="completed"&&c.jsx(gf,{size:12,className:"text-gray-400"})]}),c.jsx("div",{className:"text-[10px] text-gray-500 truncate shrink-0 font-mono",children:fe?`${_e(Ve.currentStartMin)} - ${_e(Ve.currentStartMin+Ve.currentDuration)}`:`${ee.start_time} - ${ee.end_time||_e(Fe(ee.start_time)+(ee.duration||60))}`}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-3 cursor-ns-resize flex items-center justify-center opacity-0 group-hover:opacity-100 hover:bg-black/5",onMouseDown:be=>{const ve=B(ee);if(!ve.canEdit){be.stopPropagation(),be.preventDefault(),d==null||d({msg:ve.reason||"",type:"error"});return}oe(be,ee,"resize")},onTouchStart:be=>{const ve=B(ee);if(!ve.canEdit){be.stopPropagation(),be.preventDefault(),d==null||d({msg:ve.reason||"",type:"error"});return}re(be,ee,"resize")},children:c.jsx(CI,{size:12,className:"text-gray-400"})})]},ee.id)})}),De.length===0&&ie.length===0&&!N&&c.jsxs("div",{className:"absolute top-1/3 left-0 right-0 text-center text-gray-400 pointer-events-none",children:[c.jsx(im,{size:48,className:"mx-auto mb-2 opacity-20"}),c.jsxs("p",{children:["",c.jsx("br",{}),c.jsx("span",{className:"text-xs opacity-50",children:""})]})]})]})]}),c.jsx("div",{className:"md:hidden fixed bottom-6 right-6 z-[900]",children:c.jsx("button",{onClick:()=>{const ee="08:00",fe="09:00",q=we(),Z=q?[q.id]:[];P({title:"",start_time:ee,end_time:fe,start_date:nd(y,"yyyy-MM-dd"),duration:60,is_all_day:!1,tags:Z}),l("new")},className:"w-14 h-14 bg-pink-500 rounded-full shadow-lg flex items-center justify-center text-white active:scale-95 transition-transform",children:c.jsx(xi,{size:28})})}),c.jsx(go,{children:D&&c.jsx("div",{className:"fixed inset-0 z-[1100] bg-black/40 backdrop-blur-sm flex items-center justify-center p-4",children:c.jsxs(Rr.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl",children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsx("h3",{className:"text-xl font-bold",children:""}),c.jsx("button",{onClick:()=>k(!1),children:c.jsx(rn,{size:20})})]}),c.jsx("div",{className:"bg-pink-50 rounded-xl p-4 flex flex-col items-center mb-6",children:c.jsxs("p",{className:"text-center text-sm text-gray-600",children:["",c.jsx("br",{}),""]})}),c.jsxs("button",{onClick:Me,className:"w-full py-3 bg-gray-900 text-white rounded-xl font-medium flex items-center justify-center gap-2",children:[c.jsx(bz,{size:18}),""]})]})})}),u&&c.jsx(Tn.Provider,{value:We,children:c.jsx("div",{className:"absolute inset-0 z-[1200]",children:c.jsx(gb,{initialData:u==="new"?O:S?I.find(ee=>ee.id===u):r.find(ee=>ee.id===u),onClose:()=>{l(null),P(null)}})})})]})},nre=()=>{const{user:t,logout:e,syncStatus:n,view:r,setView:s,tagFilter:i,setTagFilter:o,tasks:a,tags:l,toast:u,setToast:d,undo:f,redo:h,canUndo:p,canRedo:m,canNavigateBack:y,navigateBack:x,archiveCompletedTasks:g,editingTaskId:v,setEditingTaskId:w,themeSettings:T,sidebarWidth:D,setSidebarWidth:k,sidebarCollapsed:I,selectedTaskIds:C,dragState:S}=b.useContext(Tn),[_,N]=b.useState(!1),[j,O]=b.useState(!1),[P,W]=b.useState(!1),[R,M]=b.useState(!1),[X,Q]=b.useState(!1),[A,Te]=b.useState(!1),[we,B]=b.useState(!1),[F,ne]=b.useState(typeof window<"u"&&window.innerWidth<768);b.useEffect(()=>{const K=()=>ne(window.innerWidth<768);return window.addEventListener("resize",K),()=>window.removeEventListener("resize",K)},[]);const[We,ft]=b.useState(()=>{const K=localStorage.getItem("fabPosition");return K?JSON.parse(K):{x:window.innerWidth-80,y:window.innerHeight-80}}),[le,De]=b.useState(!1),ie=b.useRef({x:0,y:0});b.useEffect(()=>{const K=re=>{if(le){const oe=Math.max(20,Math.min(window.innerWidth-70,re.clientX-ie.current.x)),pe=Math.max(20,Math.min(window.innerHeight-70,re.clientY-ie.current.y));ft({x:oe,y:pe})}},ue=()=>{le&&(De(!1),localStorage.setItem("fabPosition",JSON.stringify(We)))};return window.addEventListener("mousemove",K),window.addEventListener("mouseup",ue),()=>{window.removeEventListener("mousemove",K),window.removeEventListener("mouseup",ue)}},[le,We]);const Fe={small:"text-sm",normal:"text-base",large:"text-lg"}[T.fontSize]||"text-base",_e=T.fontWeight==="thin"?"font-light":"font-bold",tt=T.fontFamily==="things"?"font-things":"font-sans",Xe=v?a.find(K=>K.id===v):null;b.useEffect(()=>{const K=ue=>{ue.key==="k"&&(ue.metaKey||ue.ctrlKey)&&(ue.preventDefault(),N(re=>!re)),ue.key==="Escape"&&(v?w(null):A?Te(!1):N(!1)),(ue.metaKey||ue.ctrlKey)&&ue.shiftKey&&ue.code==="KeyM"&&C.length>0&&(ue.preventDefault(),Te(!0))};return window.addEventListener("keydown",K),()=>window.removeEventListener("keydown",K)},[v,w,C,A]),b.useEffect(()=>{const K=re=>{if(!j)return;let oe=re.clientX;oe<150&&(oe=150),oe>400&&(oe=400),k(oe)},ue=()=>{O(!1),document.body.style.cursor="default"};return j&&(window.addEventListener("mousemove",K),window.addEventListener("mouseup",ue),document.body.style.cursor="col-resize"),()=>{window.removeEventListener("mousemove",K),window.removeEventListener("mouseup",ue)}},[j]);const Ve=()=>{var K;return i?((K=l.find(ue=>ue.id===i))==null?void 0:K.name)||"Tags":r==="focus"?"Focus":r.charAt(0).toUpperCase()+r.slice(1)},it=S!=null&&S.draggedId?a.find(K=>K.id===S.draggedId):null,Ue=C.includes((S==null?void 0:S.draggedId)||"")?C.length:1;return c.jsxs("div",{"data-theme":T.themeMode&&T.themeMode!=="light"?T.themeMode:void 0,className:`flex h-screen bg-theme-main text-theme-primary ${tt} selection:bg-indigo-50 selection:text-indigo-900`,children:[(S==null?void 0:S.isDragging)&&it&&c.jsx(Qee,{task:it,position:S.ghostPosition,count:Ue}),c.jsxs("div",{style:{width:I?64:D},className:`relative flex-shrink-0 hidden md:block transition-all duration-300 ease-in-out ${S!=null&&S.isDragging,"z-10"}`,children:[c.jsx(oE,{view:r,setView:s,tagFilter:i,setTagFilter:o}),!I&&!(S!=null&&S.isDragging)&&c.jsx("div",{className:"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-theme-main/10 transition-colors z-50",onMouseDown:()=>O(!0)})]}),P&&c.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 md:hidden",onClick:()=>W(!1),children:c.jsx("div",{className:"absolute left-0 top-0 h-full w-[280px] bg-theme-sidebar shadow-2xl animate-in slide-in-from-left duration-200",onClick:K=>K.stopPropagation(),children:c.jsx(oE,{view:r,setView:K=>{s(K),W(!1)},tagFilter:i,setTagFilter:K=>{o(K),W(!1)}})})}),c.jsxs("main",{className:"flex-1 flex flex-col relative overflow-hidden bg-theme-main",children:[c.jsxs("header",{"data-app-header":"true",className:"h-14 flex items-center justify-between px-4 md:px-8 border-b border-theme z-30 sticky top-0 bg-theme-header backdrop-blur-sm",children:[c.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[c.jsx("button",{className:"md:hidden p-1 -ml-2 text-theme-secondary hover:bg-theme-hover rounded",onClick:()=>W(!0),children:c.jsx(Tz,{size:20})}),y&&c.jsxs("button",{onClick:x,className:"p-1 hover:bg-theme-hover rounded text-theme-secondary flex items-center gap-1 text-sm font-medium transition-colors",title:" (Alt + Left)",children:[c.jsx(_I,{size:16}),c.jsx("span",{className:"hidden md:inline",children:""})]}),y&&c.jsx("span",{className:"text-theme-secondary",children:"|"}),c.jsx("h2",{className:`${Fe} ${_e} tracking-tight text-theme-primary`,children:Ve()})]}),c.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[C.length===1&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:()=>M(!0),className:"p-1.5 rounded hover:bg-indigo-500/10 text-indigo-400 transition-colors animate-in zoom-in duration-200 flex items-center gap-1",title:"72 (Mission 72 Transformations)",children:[c.jsx("span",{className:"text-xl leading-none filter drop-shadow-sm",children:""}),c.jsx("span",{className:"hidden lg:inline text-xs font-bold text-indigo-400",children:"72"})]}),c.jsxs("button",{onClick:()=>Q(!0),className:"p-1.5 rounded hover:bg-amber-500/10 text-amber-500 transition-colors animate-in zoom-in duration-200 flex items-center gap-1",title:"GTD ",children:[c.jsx("span",{className:"text-xl leading-none filter drop-shadow-sm",children:""}),c.jsx("span",{className:"hidden lg:inline text-xs font-bold text-amber-600",children:""})]})]}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1"}),c.jsxs("button",{onClick:g,className:"p-1.5 rounded hover:bg-theme-hover text-theme-tertiary hover:text-emerald-500 transition-colors",title:" (Archive Completed)",children:[" ",c.jsx(sm,{size:16})," "]}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1"}),c.jsx("button",{disabled:!p,onClick:f,className:`p-1 rounded hover:bg-theme-hover ${p?"opacity-100":"opacity-30"}`,title:" (Ctrl+Z)",children:c.jsx(Dg,{size:14})}),c.jsx("button",{disabled:!m,onClick:h,className:`p-1 rounded hover:bg-theme-hover ${m?"opacity-100":"opacity-30"}`,title:" (Ctrl+Shift+Z)",children:c.jsx(jw,{size:14})}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1"}),(t==null?void 0:t.email)==="bibo1243@gmail.com"&&c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:()=>B(!0),className:"p-1.5 rounded-full hover:bg-pink-50 text-pink-400 hover:text-pink-600 transition-colors",title:" (Shared Schedule)",children:c.jsx(im,{size:18,className:we?"fill-pink-500 text-pink-500":""})}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1"})]}),c.jsx(ste,{})]}),c.jsxs("div",{className:"flex items-center gap-1.5 pl-2 border-l border-theme ml-1",children:[c.jsxs("div",{className:"hidden md:flex flex-col items-end group relative",children:[c.jsx("span",{className:"text-[9px] text-theme-tertiary uppercase tracking-wider font-bold leading-none mb-0.5",children:"User"}),c.jsx("span",{className:"text-[10px] font-mono text-theme-secondary leading-none cursor-help",title:t==null?void 0:t.id,children:t!=null&&t.email?t.email:(t==null?void 0:t.id)==="00000000-0000-0000-0000-000000000000"?"Demo":t!=null&&t.id?`ID: ${t.id.slice(0,6)}...`:"Guest"})]}),c.jsxs("div",{className:"w-6 h-6 rounded-full bg-indigo-500/20 text-indigo-400 flex items-center justify-center border border-indigo-500/30 relative group cursor-pointer",title:" (Logout)",onClick:e,children:[c.jsx(FI,{size:12,className:"group-hover:hidden"}),c.jsx(Sz,{size:12,className:"hidden group-hover:block text-red-500"})]})]}),c.jsxs("div",{className:`flex items-center gap-1 text-[10px] ml-1 ${n==="synced"?"text-green-500":n==="error"?"text-red-500":"text-orange-400"}`,children:[n==="synced"?c.jsx(rz,{size:12}):c.jsx(nz,{size:12,className:"animate-pulse"}),c.jsx("span",{className:"uppercase tracking-wider hidden lg:inline",children:n==="synced"?"Synced":n==="error"?"Error":"Syncing..."})]}),n==="error"&&c.jsx("div",{className:"text-[10px] text-red-500 flex items-center gap-1",children:c.jsx(Kf,{size:12})})]})]}),c.jsx(Gee,{}),c.jsx("div",{className:`flex-1 overflow-y-auto scroll-smooth no-scrollbar prevent-pull-refresh ${r!=="focus"&&r!=="project"&&r!=="annualplan"?"p-2 md:p-4":""}`,children:r==="journal"?c.jsx(Aee,{}):r==="focus"?c.jsx(Bee,{}):r==="project"?c.jsx(Vee,{}):r==="annualplan"?c.jsx(Kee,{}):r==="matrix"?c.jsx(Jee,{}):r==="worklog"?c.jsx(Xee,{}):c.jsx("div",{className:"w-full md:w-[calc(100%-100px)] mx-auto mt-2 md:mt-8",children:c.jsx(bR,{})})}),v&&(r==="calendar"||r==="journal"||r==="focus")&&Xe&&c.jsx(gb,{initialData:Xe,onClose:()=>w(null)}),c.jsx("button",{onMouseDown:K=>{ie.current={x:K.clientX-We.x,y:K.clientY-We.y};const ue=K.clientX,re=K.clientY,oe=pe=>{(Math.abs(pe.clientX-ue)>5||Math.abs(pe.clientY-re)>5)&&(De(!0),window.removeEventListener("mousemove",oe))};window.addEventListener("mousemove",oe),window.addEventListener("mouseup",()=>window.removeEventListener("mousemove",oe),{once:!0})},onClick:()=>{le||N(!0)},style:{left:We.x,top:We.y},className:`fixed z-40 h-14 w-14 rounded-full bg-indigo-600 text-white shadow-xl hover:bg-indigo-700 transition-all flex items-center justify-center group fab-mobile md:fab-desktop ${le?"cursor-grabbing scale-110":"cursor-grab hover:scale-105 active:scale-95"}`,title:"Create New Task (Drag to move)",children:c.jsx(xi,{size:28,className:"group-hover:rotate-90 transition-transform duration-200"})}),_&&!F&&c.jsx(gb,{onClose:()=>N(!1)}),_&&F&&c.jsx(mb,{taskId:void 0,onClose:()=>N(!1)}),R&&C.length===1&&c.jsx(Yee,{taskId:C[0],onClose:()=>M(!1)}),X&&C.length===1&&c.jsx(ote,{taskId:C[0],onClose:()=>Q(!1)}),u&&c.jsx(qee,{toast:u,onClose:()=>d(null)}),v&&F&&c.jsx(mb,{taskId:v,onClose:()=>w(null)}),A&&c.jsx(ete,{onClose:()=>Te(!1)}),we&&c.jsx(PR,{onClose:()=>B(!1)})]})]})},rre=()=>{const[t,e]=b.useState(!1),[n,r]=b.useState(""),[s,i]=b.useState(""),[o,a]=b.useState("signin"),[l,u]=b.useState(null),[d,f]=b.useState(null),h=async p=>{p.preventDefault(),e(!0),u(null),f(null);let m=n,y=s;n.toLowerCase()==="demo"&&s.toLowerCase()==="demo"&&(m="demo@demo.com",y="demodemo");try{if(!je)throw new Error("Supabase client not initialized");if(o==="signup"){const{data:x,error:g}=await je.auth.signUp({email:m,password:y});if(g)throw g;x.session?(f("..."),setTimeout(()=>{window.location.reload()},500)):x.user&&!x.session&&f("")}else{const{error:x}=await je.auth.signInWithPassword({email:m,password:y});if(x)throw x;window.location.reload()}}catch(x){u(x.message)}finally{e(!1)}};return c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:c.jsxs("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[c.jsxs("div",{className:"flex flex-col items-center mb-8",children:[c.jsx("div",{className:"w-12 h-12 bg-indigo-600 rounded-xl flex items-center justify-center text-white mb-4 shadow-lg shadow-indigo-200",children:c.jsx(t1,{size:24})}),c.jsx("h1",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:"Things Clone"}),c.jsx("p",{className:"text-sm text-gray-500 mt-2",children:""})]}),l&&c.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-600 text-sm rounded-lg border border-red-100",children:l}),d&&c.jsx("div",{className:"mb-4 p-3 bg-green-50 text-green-600 text-sm rounded-lg border border-green-100",children:d}),c.jsxs("form",{onSubmit:h,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1 ml-1",children:"Email"}),c.jsxs("div",{className:"relative",children:[c.jsx(_z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),c.jsx("input",{type:"text",required:!0,value:n,onChange:p=>r(p.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-100 focus:border-indigo-400 outline-none transition-all text-sm",placeholder:"name@example.com  demo"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1 ml-1",children:"Password"}),c.jsxs("div",{className:"relative",children:[c.jsx(Aa,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),c.jsx("input",{type:"password",required:!0,value:s,onChange:p=>i(p.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-100 focus:border-indigo-400 outline-none transition-all text-sm",placeholder:"",minLength:6})]})]}),c.jsx("button",{type:"submit",disabled:t,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2.5 rounded-lg transition-all flex items-center justify-center gap-2 shadow-lg shadow-indigo-100 disabled:opacity-70 disabled:cursor-not-allowed",children:t?c.jsx(Vi,{className:"animate-spin",size:18}):c.jsxs(c.Fragment,{children:[o==="signin"?"":"",c.jsx(Cw,{size:16})]})})]}),c.jsx("div",{className:"mt-6 text-center",children:c.jsx("button",{type:"button",onClick:()=>a(o==="signin"?"signup":"signin"),className:"text-sm text-indigo-600 hover:text-indigo-500 font-medium",children:o==="signin"?"":""})}),c.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-100",children:[c.jsx("p",{className:"text-xs text-gray-400 text-center mb-3",children:" Demo "}),c.jsx("button",{type:"button",onClick:async()=>{e(!0),u(null);try{if(!je)throw new Error("Supabase client not initialized");const{error:p}=await je.auth.signInWithPassword({email:"demo@demo.com",password:"demodemo"});if(p)throw p;window.location.reload()}catch(p){u("Demo : "+p.message)}finally{e(!1)}},disabled:t,className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 rounded-lg transition-all flex items-center justify-center gap-2 text-sm disabled:opacity-70",children:" Demo "}),c.jsxs("p",{className:"text-[10px] text-gray-400 text-center mt-2",children:[" ",c.jsx("span",{className:"font-mono font-bold",children:"demo"})," "]})]})]})})},sre=()=>{const{isRecording:t,recordingTime:e,stopRecording:n,analyser:r,recordingTaskId:s}=b.useContext(Du),{setFocusedTaskId:i,tasks:o,setView:a,setExpandedTaskIds:l,setEditingTaskId:u}=b.useContext(Tn),[d,f]=b.useState(!1),h=b.useRef(null),p=b.useRef(),m=()=>{if(!s)return;a("allview");const x=o.find(g=>g.id===s);if(x){let g=x;const v=[];for(;g.parent_id;){v.push(g.parent_id);const w=o.find(T=>T.id===g.parent_id);if(!w)break;g=w}v.length>0&&l(w=>[...new Set([...w,...v])])}i(s),u(s),f(!1)};if(b.useEffect(()=>{if(!t||!r||!h.current)return;const x=h.current,g=x.getContext("2d");if(!g)return;const v=r.frequencyBinCount,w=new Uint8Array(v),T=()=>{if(!r)return;p.current=requestAnimationFrame(T),r.getByteTimeDomainData(w),g.clearRect(0,0,x.width,x.height),g.lineWidth=2,g.strokeStyle="rgba(255, 255, 255, 0.8)",g.beginPath();const D=x.width/v;let k=0;for(let I=0;I<v;I++){const S=w[I]/128*x.height/2;I===0?g.moveTo(k,S):g.lineTo(k,S),k+=D}g.lineTo(x.width,x.height/2),g.stroke()};return T(),()=>{p.current&&cancelAnimationFrame(p.current)}},[t,r]),!t)return null;const y=x=>{const g=Math.floor(x/1e3),v=Math.floor(g/60),w=g%60;return`${v.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`};return d?c.jsx("div",{className:"fixed bottom-6 left-6 z-[99999] animate-in fade-in zoom-in duration-300 cursor-pointer group",onClick:m,title:"Recording in progress. Click to locate task.",children:c.jsxs("div",{className:"bg-black/80 backdrop-blur-md border border-emerald-500/30 rounded-full p-2.5 shadow-2xl flex items-center justify-center relative hover:bg-black/90 transition-all hover:scale-110",children:[c.jsx("div",{className:"w-2.5 h-2.5 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_10px_rgba(16,185,129,0.8)]"}),c.jsx("div",{className:"absolute left-full ml-3 bg-black/90 text-white text-[10px] px-2 py-1 rounded-md whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none border border-white/10 shadow-xl font-mono",children:y(e)})]})}):c.jsx("div",{className:"fixed bottom-6 left-1/2 transform -translate-x-1/2 z-[99999] animate-in fade-in slide-in-from-bottom-4 duration-300","data-recording-capsule":!0,children:c.jsxs("div",{className:"bg-black/90 backdrop-blur-xl text-white rounded-full flex items-center p-2 pl-4 pr-3 shadow-2xl border border-white/10 gap-3 min-w-[200px] hover:scale-[1.01] transition-transform",children:[c.jsx("button",{onClick:x=>{x.stopPropagation(),x.preventDefault(),n()},className:"w-8 h-8 rounded-full bg-red-500/20 text-red-400 flex items-center justify-center hover:bg-red-500 hover:text-white transition-all cursor-pointer",title:"Stop Recording",children:c.jsx(Pz,{size:12,fill:"currentColor"})}),c.jsx("div",{className:"flex flex-col items-center min-w-[50px] cursor-pointer hover:opacity-80 transition-opacity",onClick:m,title:"Click to locate task",children:c.jsx("span",{className:"font-mono text-sm font-medium tabular-nums tracking-wider text-white",children:y(e)})}),c.jsx("div",{className:"w-20 h-8 relative opacity-80 flex items-center cursor-pointer",onClick:m,title:"Click to locate task",children:c.jsx("canvas",{ref:h,width:80,height:32,className:"w-full h-full"})}),c.jsx("div",{className:"h-6 w-[1px] bg-white/10 mx-1"}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:m,className:"p-1.5 text-gray-400 hover:text-white hover:bg-white/10 rounded-full transition-colors",title:"Locate Recording Task",children:c.jsx(kz,{size:14})}),c.jsx("button",{onClick:()=>f(!0),className:"p-1.5 text-gray-400 hover:text-white hover:bg-white/10 rounded-full transition-colors",title:"Minimize",children:c.jsx(es,{size:16})})]})]})})},ire=()=>c.jsx("div",{className:"w-full h-screen bg-gray-100 flex items-center justify-center",children:c.jsx("div",{className:"w-full h-full md:max-w-[430px] md:h-[90vh] md:rounded-[3rem] md:border-8 md:border-gray-900 bg-white relative shadow-2xl overflow-hidden",children:c.jsx(PR,{isStandalone:!0})})}),ore=()=>{const{user:t,loading:e}=b.useContext(Tn);if(e)return c.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:c.jsxs("div",{className:"flex flex-col items-center gap-3",children:[c.jsx("div",{className:"w-8 h-8 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"}),c.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"Loading workspace..."})]})});const n=t&&t.aud==="authenticated";return c.jsxs(x3,{children:[c.jsx(lp,{path:"/share/heart/:userId",element:c.jsx(ire,{})}),c.jsx(lp,{path:"/login",element:n?c.jsx(PS,{to:"/",replace:!0}):c.jsx(rre,{})}),c.jsx(lp,{path:"/*",element:n?c.jsx(nre,{}):c.jsx(PS,{to:"/login",replace:!0})})]})};function are(){return c.jsx(H3,{children:c.jsx(B6,{children:c.jsx(U6,{children:c.jsxs(V6,{children:[c.jsx(ore,{}),c.jsx(sre,{})]})})})})}Wy.createRoot(document.getElementById("root")).render(c.jsx(are,{}));
