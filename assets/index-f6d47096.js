(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var Dp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cg(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var wE={exports:{}},ug={},kE={exports:{}},Sn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Uf=Symbol.for("react.element"),tO=Symbol.for("react.portal"),nO=Symbol.for("react.fragment"),rO=Symbol.for("react.strict_mode"),sO=Symbol.for("react.profiler"),iO=Symbol.for("react.provider"),oO=Symbol.for("react.context"),aO=Symbol.for("react.forward_ref"),lO=Symbol.for("react.suspense"),cO=Symbol.for("react.memo"),uO=Symbol.for("react.lazy"),kk=Symbol.iterator;function dO(t){return t===null||typeof t!="object"?null:(t=kk&&t[kk]||t["@@iterator"],typeof t=="function"?t:null)}var SE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_E=Object.assign,TE={};function Nu(t,e,n){this.props=t,this.context=e,this.refs=TE,this.updater=n||SE}Nu.prototype.isReactComponent={};Nu.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Nu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function CE(){}CE.prototype=Nu.prototype;function bb(t,e,n){this.props=t,this.context=e,this.refs=TE,this.updater=n||SE}var vb=bb.prototype=new CE;vb.constructor=bb;_E(vb,Nu.prototype);vb.isPureReactComponent=!0;var Sk=Array.isArray,EE=Object.prototype.hasOwnProperty,wb={current:null},NE={key:!0,ref:!0,__self:!0,__source:!0};function jE(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)EE.call(e,r)&&!NE.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:Uf,type:t,key:i,ref:o,props:s,_owner:wb.current}}function fO(t,e){return{$$typeof:Uf,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function kb(t){return typeof t=="object"&&t!==null&&t.$$typeof===Uf}function hO(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var _k=/\/+/g;function o0(t,e){return typeof t=="object"&&t!==null&&t.key!=null?hO(""+t.key):e.toString(36)}function ep(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Uf:case tO:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+o0(o,0):r,Sk(s)?(n="",t!=null&&(n=t.replace(_k,"$&/")+"/"),ep(s,e,n,"",function(u){return u})):s!=null&&(kb(s)&&(s=fO(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(_k,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Sk(t))for(var a=0;a<t.length;a++){i=t[a];var l=r+o0(i,a);o+=ep(i,e,n,l,s)}else if(l=dO(t),typeof l=="function")for(t=l.call(t),a=0;!(i=t.next()).done;)i=i.value,l=r+o0(i,a++),o+=ep(i,e,n,l,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function uh(t,e,n){if(t==null)return t;var r=[],s=0;return ep(t,r,"","",function(i){return e.call(n,i,s++)}),r}function pO(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Es={current:null},tp={transition:null},mO={ReactCurrentDispatcher:Es,ReactCurrentBatchConfig:tp,ReactCurrentOwner:wb};function IE(){throw Error("act(...) is not supported in production builds of React.")}Sn.Children={map:uh,forEach:function(t,e,n){uh(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return uh(t,function(){e++}),e},toArray:function(t){return uh(t,function(e){return e})||[]},only:function(t){if(!kb(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Sn.Component=Nu;Sn.Fragment=nO;Sn.Profiler=sO;Sn.PureComponent=bb;Sn.StrictMode=rO;Sn.Suspense=lO;Sn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mO;Sn.act=IE;Sn.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=_E({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=wb.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)EE.call(e,l)&&!NE.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Uf,type:t.type,key:s,ref:i,props:r,_owner:o}};Sn.createContext=function(t){return t={$$typeof:oO,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:iO,_context:t},t.Consumer=t};Sn.createElement=jE;Sn.createFactory=function(t){var e=jE.bind(null,t);return e.type=t,e};Sn.createRef=function(){return{current:null}};Sn.forwardRef=function(t){return{$$typeof:aO,render:t}};Sn.isValidElement=kb;Sn.lazy=function(t){return{$$typeof:uO,_payload:{_status:-1,_result:t},_init:pO}};Sn.memo=function(t,e){return{$$typeof:cO,type:t,compare:e===void 0?null:e}};Sn.startTransition=function(t){var e=tp.transition;tp.transition={};try{t()}finally{tp.transition=e}};Sn.unstable_act=IE;Sn.useCallback=function(t,e){return Es.current.useCallback(t,e)};Sn.useContext=function(t){return Es.current.useContext(t)};Sn.useDebugValue=function(){};Sn.useDeferredValue=function(t){return Es.current.useDeferredValue(t)};Sn.useEffect=function(t,e){return Es.current.useEffect(t,e)};Sn.useId=function(){return Es.current.useId()};Sn.useImperativeHandle=function(t,e,n){return Es.current.useImperativeHandle(t,e,n)};Sn.useInsertionEffect=function(t,e){return Es.current.useInsertionEffect(t,e)};Sn.useLayoutEffect=function(t,e){return Es.current.useLayoutEffect(t,e)};Sn.useMemo=function(t,e){return Es.current.useMemo(t,e)};Sn.useReducer=function(t,e,n){return Es.current.useReducer(t,e,n)};Sn.useRef=function(t){return Es.current.useRef(t)};Sn.useState=function(t){return Es.current.useState(t)};Sn.useSyncExternalStore=function(t,e,n){return Es.current.useSyncExternalStore(t,e,n)};Sn.useTransition=function(){return Es.current.useTransition()};Sn.version="18.3.1";kE.exports=Sn;var x=kE.exports;const Ln=cg(x);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gO=x,yO=Symbol.for("react.element"),xO=Symbol.for("react.fragment"),bO=Object.prototype.hasOwnProperty,vO=gO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,wO={key:!0,ref:!0,__self:!0,__source:!0};function ME(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)bO.call(e,r)&&!wO.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:yO,type:t,key:i,ref:o,props:s,_owner:vO.current}}ug.Fragment=xO;ug.jsx=ME;ug.jsxs=ME;wE.exports=ug;var c=wE.exports,Gy={},DE={exports:{}},ai={},AE={exports:{}},RE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(W,V){var D=W.length;W.push(V);e:for(;0<D;){var ge=D-1>>>1,me=W[ge];if(0<s(me,V))W[ge]=V,W[D]=me,D=ge;else break e}}function n(W){return W.length===0?null:W[0]}function r(W){if(W.length===0)return null;var V=W[0],D=W.pop();if(D!==V){W[0]=D;e:for(var ge=0,me=W.length,F=me>>>1;ge<F;){var U=2*(ge+1)-1,ne=W[U],Oe=U+1,at=W[Oe];if(0>s(ne,D))Oe<me&&0>s(at,ne)?(W[ge]=at,W[Oe]=D,ge=Oe):(W[ge]=ne,W[U]=D,ge=U);else if(Oe<me&&0>s(at,D))W[ge]=at,W[Oe]=D,ge=Oe;else break e}}return V}function s(W,V){var D=W.sortIndex-V.sortIndex;return D!==0?D:W.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],u=[],d=1,f=null,h=3,p=!1,m=!1,y=!1,b=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(W){for(var V=n(u);V!==null;){if(V.callback===null)r(u);else if(V.startTime<=W)r(u),V.sortIndex=V.expirationTime,e(l,V);else break;V=n(u)}}function T(W){if(y=!1,w(W),!m)if(n(l)!==null)m=!0,A(R);else{var V=n(u);V!==null&&j(T,V.startTime-W)}}function R(W,V){m=!1,y&&(y=!1,g(S),S=-1),p=!0;var D=h;try{for(w(V),f=n(l);f!==null&&(!(f.expirationTime>V)||W&&!E());){var ge=f.callback;if(typeof ge=="function"){f.callback=null,h=f.priorityLevel;var me=ge(f.expirationTime<=V);V=t.unstable_now(),typeof me=="function"?f.callback=me:f===n(l)&&r(l),w(V)}else r(l);f=n(l)}if(f!==null)var F=!0;else{var U=n(u);U!==null&&j(T,U.startTime-V),F=!1}return F}finally{f=null,h=D,p=!1}}var k=!1,M=null,S=-1,C=5,_=-1;function E(){return!(t.unstable_now()-_<C)}function I(){if(M!==null){var W=t.unstable_now();_=W;var V=!0;try{V=M(!0,W)}finally{V?P():(k=!1,M=null)}}else k=!1}var P;if(typeof v=="function")P=function(){v(I)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,$=O.port2;O.port1.onmessage=I,P=function(){$.postMessage(null)}}else P=function(){b(I,0)};function A(W){M=W,k||(k=!0,P())}function j(W,V){S=b(function(){W(t.unstable_now())},V)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(W){W.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,A(R))},t.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<W?Math.floor(1e3/W):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(W){switch(h){case 1:case 2:case 3:var V=3;break;default:V=h}var D=h;h=V;try{return W()}finally{h=D}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(W,V){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var D=h;h=W;try{return V()}finally{h=D}},t.unstable_scheduleCallback=function(W,V,D){var ge=t.unstable_now();switch(typeof D=="object"&&D!==null?(D=D.delay,D=typeof D=="number"&&0<D?ge+D:ge):D=ge,W){case 1:var me=-1;break;case 2:me=250;break;case 5:me=1073741823;break;case 4:me=1e4;break;default:me=5e3}return me=D+me,W={id:d++,callback:V,priorityLevel:W,startTime:D,expirationTime:me,sortIndex:-1},D>ge?(W.sortIndex=D,e(u,W),n(l)===null&&W===n(u)&&(y?(g(S),S=-1):y=!0,j(T,D-ge))):(W.sortIndex=me,e(l,W),m||p||(m=!0,A(R))),W},t.unstable_shouldYield=E,t.unstable_wrapCallback=function(W){var V=h;return function(){var D=h;h=V;try{return W.apply(this,arguments)}finally{h=D}}}})(RE);AE.exports=RE;var kO=AE.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SO=x,ii=kO;function Rt(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var OE=new Set,Gd={};function sc(t,e){pu(t,e),pu(t+"Capture",e)}function pu(t,e){for(Gd[t]=e,t=0;t<e.length;t++)OE.add(e[t])}var Vo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),qy=Object.prototype.hasOwnProperty,_O=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Tk={},Ck={};function TO(t){return qy.call(Ck,t)?!0:qy.call(Tk,t)?!1:_O.test(t)?Ck[t]=!0:(Tk[t]=!0,!1)}function CO(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function EO(t,e,n,r){if(e===null||typeof e>"u"||CO(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ns(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var ns={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ns[t]=new Ns(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ns[e]=new Ns(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ns[t]=new Ns(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ns[t]=new Ns(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ns[t]=new Ns(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ns[t]=new Ns(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ns[t]=new Ns(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ns[t]=new Ns(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ns[t]=new Ns(t,5,!1,t.toLowerCase(),null,!1,!1)});var Sb=/[\-:]([a-z])/g;function _b(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Sb,_b);ns[e]=new Ns(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Sb,_b);ns[e]=new Ns(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Sb,_b);ns[e]=new Ns(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ns[t]=new Ns(t,1,!1,t.toLowerCase(),null,!1,!1)});ns.xlinkHref=new Ns("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ns[t]=new Ns(t,1,!1,t.toLowerCase(),null,!0,!0)});function Tb(t,e,n,r){var s=ns.hasOwnProperty(e)?ns[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(EO(e,n,s,r)&&(n=null),r||s===null?TO(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Xo=SO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,dh=Symbol.for("react.element"),Ic=Symbol.for("react.portal"),Mc=Symbol.for("react.fragment"),Cb=Symbol.for("react.strict_mode"),Yy=Symbol.for("react.profiler"),PE=Symbol.for("react.provider"),LE=Symbol.for("react.context"),Eb=Symbol.for("react.forward_ref"),Jy=Symbol.for("react.suspense"),Xy=Symbol.for("react.suspense_list"),Nb=Symbol.for("react.memo"),fa=Symbol.for("react.lazy"),$E=Symbol.for("react.offscreen"),Ek=Symbol.iterator;function Wu(t){return t===null||typeof t!="object"?null:(t=Ek&&t[Ek]||t["@@iterator"],typeof t=="function"?t:null)}var fr=Object.assign,a0;function od(t){if(a0===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);a0=e&&e[1]||""}return`
`+a0+t}var l0=!1;function c0(t,e){if(!t||l0)return"";l0=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{l0=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?od(t):""}function NO(t){switch(t.tag){case 5:return od(t.type);case 16:return od("Lazy");case 13:return od("Suspense");case 19:return od("SuspenseList");case 0:case 2:case 15:return t=c0(t.type,!1),t;case 11:return t=c0(t.type.render,!1),t;case 1:return t=c0(t.type,!0),t;default:return""}}function Qy(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Mc:return"Fragment";case Ic:return"Portal";case Yy:return"Profiler";case Cb:return"StrictMode";case Jy:return"Suspense";case Xy:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case LE:return(t.displayName||"Context")+".Consumer";case PE:return(t._context.displayName||"Context")+".Provider";case Eb:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Nb:return e=t.displayName||null,e!==null?e:Qy(t.type)||"Memo";case fa:e=t._payload,t=t._init;try{return Qy(t(e))}catch{}}return null}function jO(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qy(e);case 8:return e===Cb?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ha(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function zE(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function IO(t){var e=zE(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function fh(t){t._valueTracker||(t._valueTracker=IO(t))}function FE(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=zE(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Ap(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Zy(t,e){var n=e.checked;return fr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Nk(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ha(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function BE(t,e){e=e.checked,e!=null&&Tb(t,"checked",e,!1)}function ex(t,e){BE(t,e);var n=Ha(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?tx(t,e.type,n):e.hasOwnProperty("defaultValue")&&tx(t,e.type,Ha(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function jk(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function tx(t,e,n){(e!=="number"||Ap(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var ad=Array.isArray;function Qc(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ha(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function nx(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Rt(91));return fr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Ik(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Rt(92));if(ad(n)){if(1<n.length)throw Error(Rt(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ha(n)}}function UE(t,e){var n=Ha(e.value),r=Ha(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Mk(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function HE(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function rx(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?HE(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var hh,VE=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(hh=hh||document.createElement("div"),hh.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=hh.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function qd(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var xd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},MO=["Webkit","ms","Moz","O"];Object.keys(xd).forEach(function(t){MO.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),xd[e]=xd[t]})});function WE(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||xd.hasOwnProperty(t)&&xd[t]?(""+e).trim():e+"px"}function KE(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=WE(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var DO=fr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function sx(t,e){if(e){if(DO[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Rt(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Rt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Rt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Rt(62))}}function ix(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ox=null;function jb(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ax=null,Zc=null,eu=null;function Dk(t){if(t=Wf(t)){if(typeof ax!="function")throw Error(Rt(280));var e=t.stateNode;e&&(e=mg(e),ax(t.stateNode,t.type,e))}}function GE(t){Zc?eu?eu.push(t):eu=[t]:Zc=t}function qE(){if(Zc){var t=Zc,e=eu;if(eu=Zc=null,Dk(t),e)for(t=0;t<e.length;t++)Dk(e[t])}}function YE(t,e){return t(e)}function JE(){}var u0=!1;function XE(t,e,n){if(u0)return t(e,n);u0=!0;try{return YE(t,e,n)}finally{u0=!1,(Zc!==null||eu!==null)&&(JE(),qE())}}function Yd(t,e){var n=t.stateNode;if(n===null)return null;var r=mg(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Rt(231,e,typeof n));return n}var lx=!1;if(Vo)try{var Ku={};Object.defineProperty(Ku,"passive",{get:function(){lx=!0}}),window.addEventListener("test",Ku,Ku),window.removeEventListener("test",Ku,Ku)}catch{lx=!1}function AO(t,e,n,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(d){this.onError(d)}}var bd=!1,Rp=null,Op=!1,cx=null,RO={onError:function(t){bd=!0,Rp=t}};function OO(t,e,n,r,s,i,o,a,l){bd=!1,Rp=null,AO.apply(RO,arguments)}function PO(t,e,n,r,s,i,o,a,l){if(OO.apply(this,arguments),bd){if(bd){var u=Rp;bd=!1,Rp=null}else throw Error(Rt(198));Op||(Op=!0,cx=u)}}function ic(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function QE(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Ak(t){if(ic(t)!==t)throw Error(Rt(188))}function LO(t){var e=t.alternate;if(!e){if(e=ic(t),e===null)throw Error(Rt(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return Ak(s),t;if(i===r)return Ak(s),e;i=i.sibling}throw Error(Rt(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o)throw Error(Rt(189))}}if(n.alternate!==r)throw Error(Rt(190))}if(n.tag!==3)throw Error(Rt(188));return n.stateNode.current===n?t:e}function ZE(t){return t=LO(t),t!==null?eN(t):null}function eN(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=eN(t);if(e!==null)return e;t=t.sibling}return null}var tN=ii.unstable_scheduleCallback,Rk=ii.unstable_cancelCallback,$O=ii.unstable_shouldYield,zO=ii.unstable_requestPaint,wr=ii.unstable_now,FO=ii.unstable_getCurrentPriorityLevel,Ib=ii.unstable_ImmediatePriority,nN=ii.unstable_UserBlockingPriority,Pp=ii.unstable_NormalPriority,BO=ii.unstable_LowPriority,rN=ii.unstable_IdlePriority,dg=null,mo=null;function UO(t){if(mo&&typeof mo.onCommitFiberRoot=="function")try{mo.onCommitFiberRoot(dg,t,void 0,(t.current.flags&128)===128)}catch{}}var Qi=Math.clz32?Math.clz32:WO,HO=Math.log,VO=Math.LN2;function WO(t){return t>>>=0,t===0?32:31-(HO(t)/VO|0)|0}var ph=64,mh=4194304;function ld(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Lp(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~s;a!==0?r=ld(a):(i&=o,i!==0&&(r=ld(i)))}else o=n&~s,o!==0?r=ld(o):i!==0&&(r=ld(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Qi(e),s=1<<n,r|=t[n],e&=~s;return r}function KO(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function GO(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-Qi(i),a=1<<o,l=s[o];l===-1?(!(a&n)||a&r)&&(s[o]=KO(a,e)):l<=e&&(t.expiredLanes|=a),i&=~a}}function ux(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function sN(){var t=ph;return ph<<=1,!(ph&4194240)&&(ph=64),t}function d0(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Hf(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Qi(e),t[e]=n}function qO(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Qi(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Mb(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Qi(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var $n=0;function iN(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var oN,Db,aN,lN,cN,dx=!1,gh=[],ja=null,Ia=null,Ma=null,Jd=new Map,Xd=new Map,ba=[],YO="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ok(t,e){switch(t){case"focusin":case"focusout":ja=null;break;case"dragenter":case"dragleave":Ia=null;break;case"mouseover":case"mouseout":Ma=null;break;case"pointerover":case"pointerout":Jd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xd.delete(e.pointerId)}}function Gu(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Wf(e),e!==null&&Db(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function JO(t,e,n,r,s){switch(e){case"focusin":return ja=Gu(ja,t,e,n,r,s),!0;case"dragenter":return Ia=Gu(Ia,t,e,n,r,s),!0;case"mouseover":return Ma=Gu(Ma,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Jd.set(i,Gu(Jd.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Xd.set(i,Gu(Xd.get(i)||null,t,e,n,r,s)),!0}return!1}function uN(t){var e=Cl(t.target);if(e!==null){var n=ic(e);if(n!==null){if(e=n.tag,e===13){if(e=QE(n),e!==null){t.blockedOn=e,cN(t.priority,function(){aN(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function np(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=fx(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);ox=r,n.target.dispatchEvent(r),ox=null}else return e=Wf(n),e!==null&&Db(e),t.blockedOn=n,!1;e.shift()}return!0}function Pk(t,e,n){np(t)&&n.delete(e)}function XO(){dx=!1,ja!==null&&np(ja)&&(ja=null),Ia!==null&&np(Ia)&&(Ia=null),Ma!==null&&np(Ma)&&(Ma=null),Jd.forEach(Pk),Xd.forEach(Pk)}function qu(t,e){t.blockedOn===e&&(t.blockedOn=null,dx||(dx=!0,ii.unstable_scheduleCallback(ii.unstable_NormalPriority,XO)))}function Qd(t){function e(s){return qu(s,t)}if(0<gh.length){qu(gh[0],t);for(var n=1;n<gh.length;n++){var r=gh[n];r.blockedOn===t&&(r.blockedOn=null)}}for(ja!==null&&qu(ja,t),Ia!==null&&qu(Ia,t),Ma!==null&&qu(Ma,t),Jd.forEach(e),Xd.forEach(e),n=0;n<ba.length;n++)r=ba[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<ba.length&&(n=ba[0],n.blockedOn===null);)uN(n),n.blockedOn===null&&ba.shift()}var tu=Xo.ReactCurrentBatchConfig,$p=!0;function QO(t,e,n,r){var s=$n,i=tu.transition;tu.transition=null;try{$n=1,Ab(t,e,n,r)}finally{$n=s,tu.transition=i}}function ZO(t,e,n,r){var s=$n,i=tu.transition;tu.transition=null;try{$n=4,Ab(t,e,n,r)}finally{$n=s,tu.transition=i}}function Ab(t,e,n,r){if($p){var s=fx(t,e,n,r);if(s===null)w0(t,e,r,zp,n),Ok(t,r);else if(JO(s,t,e,n,r))r.stopPropagation();else if(Ok(t,r),e&4&&-1<YO.indexOf(t)){for(;s!==null;){var i=Wf(s);if(i!==null&&oN(i),i=fx(t,e,n,r),i===null&&w0(t,e,r,zp,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else w0(t,e,r,null,n)}}var zp=null;function fx(t,e,n,r){if(zp=null,t=jb(r),t=Cl(t),t!==null)if(e=ic(t),e===null)t=null;else if(n=e.tag,n===13){if(t=QE(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return zp=t,null}function dN(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(FO()){case Ib:return 1;case nN:return 4;case Pp:case BO:return 16;case rN:return 536870912;default:return 16}default:return 16}}var _a=null,Rb=null,rp=null;function fN(){if(rp)return rp;var t,e=Rb,n=e.length,r,s="value"in _a?_a.value:_a.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return rp=s.slice(t,1<r?1-r:void 0)}function sp(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function yh(){return!0}function Lk(){return!1}function li(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?yh:Lk,this.isPropagationStopped=Lk,this}return fr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=yh)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=yh)},persist:function(){},isPersistent:yh}),e}var ju={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ob=li(ju),Vf=fr({},ju,{view:0,detail:0}),eP=li(Vf),f0,h0,Yu,fg=fr({},Vf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pb,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Yu&&(Yu&&t.type==="mousemove"?(f0=t.screenX-Yu.screenX,h0=t.screenY-Yu.screenY):h0=f0=0,Yu=t),f0)},movementY:function(t){return"movementY"in t?t.movementY:h0}}),$k=li(fg),tP=fr({},fg,{dataTransfer:0}),nP=li(tP),rP=fr({},Vf,{relatedTarget:0}),p0=li(rP),sP=fr({},ju,{animationName:0,elapsedTime:0,pseudoElement:0}),iP=li(sP),oP=fr({},ju,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),aP=li(oP),lP=fr({},ju,{data:0}),zk=li(lP),cP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},uP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fP(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=dP[t])?!!e[t]:!1}function Pb(){return fP}var hP=fr({},Vf,{key:function(t){if(t.key){var e=cP[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=sp(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?uP[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pb,charCode:function(t){return t.type==="keypress"?sp(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?sp(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),pP=li(hP),mP=fr({},fg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fk=li(mP),gP=fr({},Vf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pb}),yP=li(gP),xP=fr({},ju,{propertyName:0,elapsedTime:0,pseudoElement:0}),bP=li(xP),vP=fr({},fg,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),wP=li(vP),kP=[9,13,27,32],Lb=Vo&&"CompositionEvent"in window,vd=null;Vo&&"documentMode"in document&&(vd=document.documentMode);var SP=Vo&&"TextEvent"in window&&!vd,hN=Vo&&(!Lb||vd&&8<vd&&11>=vd),Bk=String.fromCharCode(32),Uk=!1;function pN(t,e){switch(t){case"keyup":return kP.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mN(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Dc=!1;function _P(t,e){switch(t){case"compositionend":return mN(e);case"keypress":return e.which!==32?null:(Uk=!0,Bk);case"textInput":return t=e.data,t===Bk&&Uk?null:t;default:return null}}function TP(t,e){if(Dc)return t==="compositionend"||!Lb&&pN(t,e)?(t=fN(),rp=Rb=_a=null,Dc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return hN&&e.locale!=="ko"?null:e.data;default:return null}}var CP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hk(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!CP[t.type]:e==="textarea"}function gN(t,e,n,r){GE(r),e=Fp(e,"onChange"),0<e.length&&(n=new Ob("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var wd=null,Zd=null;function EP(t){EN(t,0)}function hg(t){var e=Oc(t);if(FE(e))return t}function NP(t,e){if(t==="change")return e}var yN=!1;if(Vo){var m0;if(Vo){var g0="oninput"in document;if(!g0){var Vk=document.createElement("div");Vk.setAttribute("oninput","return;"),g0=typeof Vk.oninput=="function"}m0=g0}else m0=!1;yN=m0&&(!document.documentMode||9<document.documentMode)}function Wk(){wd&&(wd.detachEvent("onpropertychange",xN),Zd=wd=null)}function xN(t){if(t.propertyName==="value"&&hg(Zd)){var e=[];gN(e,Zd,t,jb(t)),XE(EP,e)}}function jP(t,e,n){t==="focusin"?(Wk(),wd=e,Zd=n,wd.attachEvent("onpropertychange",xN)):t==="focusout"&&Wk()}function IP(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return hg(Zd)}function MP(t,e){if(t==="click")return hg(e)}function DP(t,e){if(t==="input"||t==="change")return hg(e)}function AP(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var eo=typeof Object.is=="function"?Object.is:AP;function ef(t,e){if(eo(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!qy.call(e,s)||!eo(t[s],e[s]))return!1}return!0}function Kk(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Gk(t,e){var n=Kk(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Kk(n)}}function bN(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?bN(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function vN(){for(var t=window,e=Ap();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ap(t.document)}return e}function $b(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function RP(t){var e=vN(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&bN(n.ownerDocument.documentElement,n)){if(r!==null&&$b(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=Gk(n,i);var o=Gk(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var OP=Vo&&"documentMode"in document&&11>=document.documentMode,Ac=null,hx=null,kd=null,px=!1;function qk(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;px||Ac==null||Ac!==Ap(r)||(r=Ac,"selectionStart"in r&&$b(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),kd&&ef(kd,r)||(kd=r,r=Fp(hx,"onSelect"),0<r.length&&(e=new Ob("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Ac)))}function xh(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Rc={animationend:xh("Animation","AnimationEnd"),animationiteration:xh("Animation","AnimationIteration"),animationstart:xh("Animation","AnimationStart"),transitionend:xh("Transition","TransitionEnd")},y0={},wN={};Vo&&(wN=document.createElement("div").style,"AnimationEvent"in window||(delete Rc.animationend.animation,delete Rc.animationiteration.animation,delete Rc.animationstart.animation),"TransitionEvent"in window||delete Rc.transitionend.transition);function pg(t){if(y0[t])return y0[t];if(!Rc[t])return t;var e=Rc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in wN)return y0[t]=e[n];return t}var kN=pg("animationend"),SN=pg("animationiteration"),_N=pg("animationstart"),TN=pg("transitionend"),CN=new Map,Yk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ja(t,e){CN.set(t,e),sc(e,[t])}for(var x0=0;x0<Yk.length;x0++){var b0=Yk[x0],PP=b0.toLowerCase(),LP=b0[0].toUpperCase()+b0.slice(1);Ja(PP,"on"+LP)}Ja(kN,"onAnimationEnd");Ja(SN,"onAnimationIteration");Ja(_N,"onAnimationStart");Ja("dblclick","onDoubleClick");Ja("focusin","onFocus");Ja("focusout","onBlur");Ja(TN,"onTransitionEnd");pu("onMouseEnter",["mouseout","mouseover"]);pu("onMouseLeave",["mouseout","mouseover"]);pu("onPointerEnter",["pointerout","pointerover"]);pu("onPointerLeave",["pointerout","pointerover"]);sc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));sc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));sc("onBeforeInput",["compositionend","keypress","textInput","paste"]);sc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));sc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));sc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$P=new Set("cancel close invalid load scroll toggle".split(" ").concat(cd));function Jk(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,PO(r,e,void 0,t),t.currentTarget=null}function EN(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;Jk(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;Jk(s,a,u),i=l}}}if(Op)throw t=cx,Op=!1,cx=null,t}function qn(t,e){var n=e[bx];n===void 0&&(n=e[bx]=new Set);var r=t+"__bubble";n.has(r)||(NN(e,t,2,!1),n.add(r))}function v0(t,e,n){var r=0;e&&(r|=4),NN(n,t,r,e)}var bh="_reactListening"+Math.random().toString(36).slice(2);function tf(t){if(!t[bh]){t[bh]=!0,OE.forEach(function(n){n!=="selectionchange"&&($P.has(n)||v0(n,!1,t),v0(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[bh]||(e[bh]=!0,v0("selectionchange",!1,e))}}function NN(t,e,n,r){switch(dN(e)){case 1:var s=QO;break;case 4:s=ZO;break;default:s=Ab}n=s.bind(null,e,n,t),s=void 0,!lx||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function w0(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Cl(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}XE(function(){var u=i,d=jb(n),f=[];e:{var h=CN.get(t);if(h!==void 0){var p=Ob,m=t;switch(t){case"keypress":if(sp(n)===0)break e;case"keydown":case"keyup":p=pP;break;case"focusin":m="focus",p=p0;break;case"focusout":m="blur",p=p0;break;case"beforeblur":case"afterblur":p=p0;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=$k;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=nP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=yP;break;case kN:case SN:case _N:p=iP;break;case TN:p=bP;break;case"scroll":p=eP;break;case"wheel":p=wP;break;case"copy":case"cut":case"paste":p=aP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Fk}var y=(e&4)!==0,b=!y&&t==="scroll",g=y?h!==null?h+"Capture":null:h;y=[];for(var v=u,w;v!==null;){w=v;var T=w.stateNode;if(w.tag===5&&T!==null&&(w=T,g!==null&&(T=Yd(v,g),T!=null&&y.push(nf(v,T,w)))),b)break;v=v.return}0<y.length&&(h=new p(h,m,null,n,d),f.push({event:h,listeners:y}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",h&&n!==ox&&(m=n.relatedTarget||n.fromElement)&&(Cl(m)||m[Wo]))break e;if((p||h)&&(h=d.window===d?d:(h=d.ownerDocument)?h.defaultView||h.parentWindow:window,p?(m=n.relatedTarget||n.toElement,p=u,m=m?Cl(m):null,m!==null&&(b=ic(m),m!==b||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=u),p!==m)){if(y=$k,T="onMouseLeave",g="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(y=Fk,T="onPointerLeave",g="onPointerEnter",v="pointer"),b=p==null?h:Oc(p),w=m==null?h:Oc(m),h=new y(T,v+"leave",p,n,d),h.target=b,h.relatedTarget=w,T=null,Cl(d)===u&&(y=new y(g,v+"enter",m,n,d),y.target=w,y.relatedTarget=b,T=y),b=T,p&&m)t:{for(y=p,g=m,v=0,w=y;w;w=uc(w))v++;for(w=0,T=g;T;T=uc(T))w++;for(;0<v-w;)y=uc(y),v--;for(;0<w-v;)g=uc(g),w--;for(;v--;){if(y===g||g!==null&&y===g.alternate)break t;y=uc(y),g=uc(g)}y=null}else y=null;p!==null&&Xk(f,h,p,y,!1),m!==null&&b!==null&&Xk(f,b,m,y,!0)}}e:{if(h=u?Oc(u):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var R=NP;else if(Hk(h))if(yN)R=DP;else{R=IP;var k=jP}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(R=MP);if(R&&(R=R(t,u))){gN(f,R,n,d);break e}k&&k(t,h,u),t==="focusout"&&(k=h._wrapperState)&&k.controlled&&h.type==="number"&&tx(h,"number",h.value)}switch(k=u?Oc(u):window,t){case"focusin":(Hk(k)||k.contentEditable==="true")&&(Ac=k,hx=u,kd=null);break;case"focusout":kd=hx=Ac=null;break;case"mousedown":px=!0;break;case"contextmenu":case"mouseup":case"dragend":px=!1,qk(f,n,d);break;case"selectionchange":if(OP)break;case"keydown":case"keyup":qk(f,n,d)}var M;if(Lb)e:{switch(t){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else Dc?pN(t,n)&&(S="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(S="onCompositionStart");S&&(hN&&n.locale!=="ko"&&(Dc||S!=="onCompositionStart"?S==="onCompositionEnd"&&Dc&&(M=fN()):(_a=d,Rb="value"in _a?_a.value:_a.textContent,Dc=!0)),k=Fp(u,S),0<k.length&&(S=new zk(S,t,null,n,d),f.push({event:S,listeners:k}),M?S.data=M:(M=mN(n),M!==null&&(S.data=M)))),(M=SP?_P(t,n):TP(t,n))&&(u=Fp(u,"onBeforeInput"),0<u.length&&(d=new zk("onBeforeInput","beforeinput",null,n,d),f.push({event:d,listeners:u}),d.data=M))}EN(f,e)})}function nf(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Fp(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Yd(t,n),i!=null&&r.unshift(nf(t,i,s)),i=Yd(t,e),i!=null&&r.push(nf(t,i,s))),t=t.return}return r}function uc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Xk(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=Yd(n,i),l!=null&&o.unshift(nf(n,l,a))):s||(l=Yd(n,i),l!=null&&o.push(nf(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var zP=/\r\n?/g,FP=/\u0000|\uFFFD/g;function Qk(t){return(typeof t=="string"?t:""+t).replace(zP,`
`).replace(FP,"")}function vh(t,e,n){if(e=Qk(e),Qk(t)!==e&&n)throw Error(Rt(425))}function Bp(){}var mx=null,gx=null;function yx(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var xx=typeof setTimeout=="function"?setTimeout:void 0,BP=typeof clearTimeout=="function"?clearTimeout:void 0,Zk=typeof Promise=="function"?Promise:void 0,UP=typeof queueMicrotask=="function"?queueMicrotask:typeof Zk<"u"?function(t){return Zk.resolve(null).then(t).catch(HP)}:xx;function HP(t){setTimeout(function(){throw t})}function k0(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Qd(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Qd(e)}function Da(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function eS(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Iu=Math.random().toString(36).slice(2),lo="__reactFiber$"+Iu,rf="__reactProps$"+Iu,Wo="__reactContainer$"+Iu,bx="__reactEvents$"+Iu,VP="__reactListeners$"+Iu,WP="__reactHandles$"+Iu;function Cl(t){var e=t[lo];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Wo]||n[lo]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=eS(t);t!==null;){if(n=t[lo])return n;t=eS(t)}return e}t=n,n=t.parentNode}return null}function Wf(t){return t=t[lo]||t[Wo],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Oc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Rt(33))}function mg(t){return t[rf]||null}var vx=[],Pc=-1;function Xa(t){return{current:t}}function Qn(t){0>Pc||(t.current=vx[Pc],vx[Pc]=null,Pc--)}function Kn(t,e){Pc++,vx[Pc]=t.current,t.current=e}var Va={},ms=Xa(Va),Fs=Xa(!1),Gl=Va;function mu(t,e){var n=t.type.contextTypes;if(!n)return Va;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Bs(t){return t=t.childContextTypes,t!=null}function Up(){Qn(Fs),Qn(ms)}function tS(t,e,n){if(ms.current!==Va)throw Error(Rt(168));Kn(ms,e),Kn(Fs,n)}function jN(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Rt(108,jO(t)||"Unknown",s));return fr({},n,r)}function Hp(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Va,Gl=ms.current,Kn(ms,t),Kn(Fs,Fs.current),!0}function nS(t,e,n){var r=t.stateNode;if(!r)throw Error(Rt(169));n?(t=jN(t,e,Gl),r.__reactInternalMemoizedMergedChildContext=t,Qn(Fs),Qn(ms),Kn(ms,t)):Qn(Fs),Kn(Fs,n)}var Oo=null,gg=!1,S0=!1;function IN(t){Oo===null?Oo=[t]:Oo.push(t)}function KP(t){gg=!0,IN(t)}function Qa(){if(!S0&&Oo!==null){S0=!0;var t=0,e=$n;try{var n=Oo;for($n=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Oo=null,gg=!1}catch(s){throw Oo!==null&&(Oo=Oo.slice(t+1)),tN(Ib,Qa),s}finally{$n=e,S0=!1}}return null}var Lc=[],$c=0,Vp=null,Wp=0,bi=[],vi=0,ql=null,Lo=1,$o="";function pl(t,e){Lc[$c++]=Wp,Lc[$c++]=Vp,Vp=t,Wp=e}function MN(t,e,n){bi[vi++]=Lo,bi[vi++]=$o,bi[vi++]=ql,ql=t;var r=Lo;t=$o;var s=32-Qi(r)-1;r&=~(1<<s),n+=1;var i=32-Qi(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Lo=1<<32-Qi(e)+s|n<<s|r,$o=i+t}else Lo=1<<i|n<<s|r,$o=t}function zb(t){t.return!==null&&(pl(t,1),MN(t,1,0))}function Fb(t){for(;t===Vp;)Vp=Lc[--$c],Lc[$c]=null,Wp=Lc[--$c],Lc[$c]=null;for(;t===ql;)ql=bi[--vi],bi[vi]=null,$o=bi[--vi],bi[vi]=null,Lo=bi[--vi],bi[vi]=null}var si=null,ti=null,sr=!1,Ji=null;function DN(t,e){var n=Si(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function rS(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,si=t,ti=Da(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,si=t,ti=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=ql!==null?{id:Lo,overflow:$o}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Si(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,si=t,ti=null,!0):!1;default:return!1}}function wx(t){return(t.mode&1)!==0&&(t.flags&128)===0}function kx(t){if(sr){var e=ti;if(e){var n=e;if(!rS(t,e)){if(wx(t))throw Error(Rt(418));e=Da(n.nextSibling);var r=si;e&&rS(t,e)?DN(r,n):(t.flags=t.flags&-4097|2,sr=!1,si=t)}}else{if(wx(t))throw Error(Rt(418));t.flags=t.flags&-4097|2,sr=!1,si=t}}}function sS(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;si=t}function wh(t){if(t!==si)return!1;if(!sr)return sS(t),sr=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!yx(t.type,t.memoizedProps)),e&&(e=ti)){if(wx(t))throw AN(),Error(Rt(418));for(;e;)DN(t,e),e=Da(e.nextSibling)}if(sS(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Rt(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ti=Da(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ti=null}}else ti=si?Da(t.stateNode.nextSibling):null;return!0}function AN(){for(var t=ti;t;)t=Da(t.nextSibling)}function gu(){ti=si=null,sr=!1}function Bb(t){Ji===null?Ji=[t]:Ji.push(t)}var GP=Xo.ReactCurrentBatchConfig;function Ju(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Rt(309));var r=n.stateNode}if(!r)throw Error(Rt(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(Rt(284));if(!n._owner)throw Error(Rt(290,t))}return t}function kh(t,e){throw t=Object.prototype.toString.call(e),Error(Rt(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function iS(t){var e=t._init;return e(t._payload)}function RN(t){function e(g,v){if(t){var w=g.deletions;w===null?(g.deletions=[v],g.flags|=16):w.push(v)}}function n(g,v){if(!t)return null;for(;v!==null;)e(g,v),v=v.sibling;return null}function r(g,v){for(g=new Map;v!==null;)v.key!==null?g.set(v.key,v):g.set(v.index,v),v=v.sibling;return g}function s(g,v){return g=Pa(g,v),g.index=0,g.sibling=null,g}function i(g,v,w){return g.index=w,t?(w=g.alternate,w!==null?(w=w.index,w<v?(g.flags|=2,v):w):(g.flags|=2,v)):(g.flags|=1048576,v)}function o(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,v,w,T){return v===null||v.tag!==6?(v=I0(w,g.mode,T),v.return=g,v):(v=s(v,w),v.return=g,v)}function l(g,v,w,T){var R=w.type;return R===Mc?d(g,v,w.props.children,T,w.key):v!==null&&(v.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===fa&&iS(R)===v.type)?(T=s(v,w.props),T.ref=Ju(g,v,w),T.return=g,T):(T=dp(w.type,w.key,w.props,null,g.mode,T),T.ref=Ju(g,v,w),T.return=g,T)}function u(g,v,w,T){return v===null||v.tag!==4||v.stateNode.containerInfo!==w.containerInfo||v.stateNode.implementation!==w.implementation?(v=M0(w,g.mode,T),v.return=g,v):(v=s(v,w.children||[]),v.return=g,v)}function d(g,v,w,T,R){return v===null||v.tag!==7?(v=$l(w,g.mode,T,R),v.return=g,v):(v=s(v,w),v.return=g,v)}function f(g,v,w){if(typeof v=="string"&&v!==""||typeof v=="number")return v=I0(""+v,g.mode,w),v.return=g,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case dh:return w=dp(v.type,v.key,v.props,null,g.mode,w),w.ref=Ju(g,null,v),w.return=g,w;case Ic:return v=M0(v,g.mode,w),v.return=g,v;case fa:var T=v._init;return f(g,T(v._payload),w)}if(ad(v)||Wu(v))return v=$l(v,g.mode,w,null),v.return=g,v;kh(g,v)}return null}function h(g,v,w,T){var R=v!==null?v.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return R!==null?null:a(g,v,""+w,T);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case dh:return w.key===R?l(g,v,w,T):null;case Ic:return w.key===R?u(g,v,w,T):null;case fa:return R=w._init,h(g,v,R(w._payload),T)}if(ad(w)||Wu(w))return R!==null?null:d(g,v,w,T,null);kh(g,w)}return null}function p(g,v,w,T,R){if(typeof T=="string"&&T!==""||typeof T=="number")return g=g.get(w)||null,a(v,g,""+T,R);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case dh:return g=g.get(T.key===null?w:T.key)||null,l(v,g,T,R);case Ic:return g=g.get(T.key===null?w:T.key)||null,u(v,g,T,R);case fa:var k=T._init;return p(g,v,w,k(T._payload),R)}if(ad(T)||Wu(T))return g=g.get(w)||null,d(v,g,T,R,null);kh(v,T)}return null}function m(g,v,w,T){for(var R=null,k=null,M=v,S=v=0,C=null;M!==null&&S<w.length;S++){M.index>S?(C=M,M=null):C=M.sibling;var _=h(g,M,w[S],T);if(_===null){M===null&&(M=C);break}t&&M&&_.alternate===null&&e(g,M),v=i(_,v,S),k===null?R=_:k.sibling=_,k=_,M=C}if(S===w.length)return n(g,M),sr&&pl(g,S),R;if(M===null){for(;S<w.length;S++)M=f(g,w[S],T),M!==null&&(v=i(M,v,S),k===null?R=M:k.sibling=M,k=M);return sr&&pl(g,S),R}for(M=r(g,M);S<w.length;S++)C=p(M,g,S,w[S],T),C!==null&&(t&&C.alternate!==null&&M.delete(C.key===null?S:C.key),v=i(C,v,S),k===null?R=C:k.sibling=C,k=C);return t&&M.forEach(function(E){return e(g,E)}),sr&&pl(g,S),R}function y(g,v,w,T){var R=Wu(w);if(typeof R!="function")throw Error(Rt(150));if(w=R.call(w),w==null)throw Error(Rt(151));for(var k=R=null,M=v,S=v=0,C=null,_=w.next();M!==null&&!_.done;S++,_=w.next()){M.index>S?(C=M,M=null):C=M.sibling;var E=h(g,M,_.value,T);if(E===null){M===null&&(M=C);break}t&&M&&E.alternate===null&&e(g,M),v=i(E,v,S),k===null?R=E:k.sibling=E,k=E,M=C}if(_.done)return n(g,M),sr&&pl(g,S),R;if(M===null){for(;!_.done;S++,_=w.next())_=f(g,_.value,T),_!==null&&(v=i(_,v,S),k===null?R=_:k.sibling=_,k=_);return sr&&pl(g,S),R}for(M=r(g,M);!_.done;S++,_=w.next())_=p(M,g,S,_.value,T),_!==null&&(t&&_.alternate!==null&&M.delete(_.key===null?S:_.key),v=i(_,v,S),k===null?R=_:k.sibling=_,k=_);return t&&M.forEach(function(I){return e(g,I)}),sr&&pl(g,S),R}function b(g,v,w,T){if(typeof w=="object"&&w!==null&&w.type===Mc&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case dh:e:{for(var R=w.key,k=v;k!==null;){if(k.key===R){if(R=w.type,R===Mc){if(k.tag===7){n(g,k.sibling),v=s(k,w.props.children),v.return=g,g=v;break e}}else if(k.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===fa&&iS(R)===k.type){n(g,k.sibling),v=s(k,w.props),v.ref=Ju(g,k,w),v.return=g,g=v;break e}n(g,k);break}else e(g,k);k=k.sibling}w.type===Mc?(v=$l(w.props.children,g.mode,T,w.key),v.return=g,g=v):(T=dp(w.type,w.key,w.props,null,g.mode,T),T.ref=Ju(g,v,w),T.return=g,g=T)}return o(g);case Ic:e:{for(k=w.key;v!==null;){if(v.key===k)if(v.tag===4&&v.stateNode.containerInfo===w.containerInfo&&v.stateNode.implementation===w.implementation){n(g,v.sibling),v=s(v,w.children||[]),v.return=g,g=v;break e}else{n(g,v);break}else e(g,v);v=v.sibling}v=M0(w,g.mode,T),v.return=g,g=v}return o(g);case fa:return k=w._init,b(g,v,k(w._payload),T)}if(ad(w))return m(g,v,w,T);if(Wu(w))return y(g,v,w,T);kh(g,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,v!==null&&v.tag===6?(n(g,v.sibling),v=s(v,w),v.return=g,g=v):(n(g,v),v=I0(w,g.mode,T),v.return=g,g=v),o(g)):n(g,v)}return b}var yu=RN(!0),ON=RN(!1),Kp=Xa(null),Gp=null,zc=null,Ub=null;function Hb(){Ub=zc=Gp=null}function Vb(t){var e=Kp.current;Qn(Kp),t._currentValue=e}function Sx(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function nu(t,e){Gp=t,Ub=zc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ls=!0),t.firstContext=null)}function Mi(t){var e=t._currentValue;if(Ub!==t)if(t={context:t,memoizedValue:e,next:null},zc===null){if(Gp===null)throw Error(Rt(308));zc=t,Gp.dependencies={lanes:0,firstContext:t}}else zc=zc.next=t;return e}var El=null;function Wb(t){El===null?El=[t]:El.push(t)}function PN(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,Wb(e)):(n.next=s.next,s.next=n),e.interleaved=n,Ko(t,r)}function Ko(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var ha=!1;function Kb(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function LN(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Fo(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Aa(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Mn&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Ko(t,n)}return s=r.interleaved,s===null?(e.next=e,Wb(r)):(e.next=s.next,s.next=e),r.interleaved=e,Ko(t,n)}function ip(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Mb(t,n)}}function oS(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function qp(t,e,n,r){var s=t.updateQueue;ha=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var d=t.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=u:a.next=u,d.lastBaseUpdate=l))}if(i!==null){var f=s.baseState;o=0,d=u=l=null,a=i;do{var h=a.lane,p=a.eventTime;if((r&h)===h){d!==null&&(d=d.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=t,y=a;switch(h=e,p=n,y.tag){case 1:if(m=y.payload,typeof m=="function"){f=m.call(p,f,h);break e}f=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=y.payload,h=typeof m=="function"?m.call(p,f,h):m,h==null)break e;f=fr({},f,h);break e;case 2:ha=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=s.effects,h===null?s.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(u=d=p,l=f):d=d.next=p,o|=h;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;h=a,a=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(1);if(d===null&&(l=f),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=d,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Jl|=o,t.lanes=o,t.memoizedState=f}}function aS(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(Rt(191,s));s.call(r)}}}var Kf={},go=Xa(Kf),sf=Xa(Kf),of=Xa(Kf);function Nl(t){if(t===Kf)throw Error(Rt(174));return t}function Gb(t,e){switch(Kn(of,e),Kn(sf,t),Kn(go,Kf),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:rx(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=rx(e,t)}Qn(go),Kn(go,e)}function xu(){Qn(go),Qn(sf),Qn(of)}function $N(t){Nl(of.current);var e=Nl(go.current),n=rx(e,t.type);e!==n&&(Kn(sf,t),Kn(go,n))}function qb(t){sf.current===t&&(Qn(go),Qn(sf))}var cr=Xa(0);function Yp(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var _0=[];function Yb(){for(var t=0;t<_0.length;t++)_0[t]._workInProgressVersionPrimary=null;_0.length=0}var op=Xo.ReactCurrentDispatcher,T0=Xo.ReactCurrentBatchConfig,Yl=0,dr=null,Rr=null,$r=null,Jp=!1,Sd=!1,af=0,qP=0;function as(){throw Error(Rt(321))}function Jb(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!eo(t[n],e[n]))return!1;return!0}function Xb(t,e,n,r,s,i){if(Yl=i,dr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,op.current=t===null||t.memoizedState===null?QP:ZP,t=n(r,s),Sd){i=0;do{if(Sd=!1,af=0,25<=i)throw Error(Rt(301));i+=1,$r=Rr=null,e.updateQueue=null,op.current=e4,t=n(r,s)}while(Sd)}if(op.current=Xp,e=Rr!==null&&Rr.next!==null,Yl=0,$r=Rr=dr=null,Jp=!1,e)throw Error(Rt(300));return t}function Qb(){var t=af!==0;return af=0,t}function no(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return $r===null?dr.memoizedState=$r=t:$r=$r.next=t,$r}function Di(){if(Rr===null){var t=dr.alternate;t=t!==null?t.memoizedState:null}else t=Rr.next;var e=$r===null?dr.memoizedState:$r.next;if(e!==null)$r=e,Rr=t;else{if(t===null)throw Error(Rt(310));Rr=t,t={memoizedState:Rr.memoizedState,baseState:Rr.baseState,baseQueue:Rr.baseQueue,queue:Rr.queue,next:null},$r===null?dr.memoizedState=$r=t:$r=$r.next=t}return $r}function lf(t,e){return typeof e=="function"?e(t):e}function C0(t){var e=Di(),n=e.queue;if(n===null)throw Error(Rt(311));n.lastRenderedReducer=t;var r=Rr,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var d=u.lane;if((Yl&d)===d)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var f={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,dr.lanes|=d,Jl|=d}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,eo(r,e.memoizedState)||(Ls=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,dr.lanes|=i,Jl|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function E0(t){var e=Di(),n=e.queue;if(n===null)throw Error(Rt(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);eo(i,e.memoizedState)||(Ls=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function zN(){}function FN(t,e){var n=dr,r=Di(),s=e(),i=!eo(r.memoizedState,s);if(i&&(r.memoizedState=s,Ls=!0),r=r.queue,Zb(HN.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||$r!==null&&$r.memoizedState.tag&1){if(n.flags|=2048,cf(9,UN.bind(null,n,r,s,e),void 0,null),Br===null)throw Error(Rt(349));Yl&30||BN(n,e,s)}return s}function BN(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=dr.updateQueue,e===null?(e={lastEffect:null,stores:null},dr.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function UN(t,e,n,r){e.value=n,e.getSnapshot=r,VN(e)&&WN(t)}function HN(t,e,n){return n(function(){VN(e)&&WN(t)})}function VN(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!eo(t,n)}catch{return!0}}function WN(t){var e=Ko(t,1);e!==null&&Zi(e,t,1,-1)}function lS(t){var e=no();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:lf,lastRenderedState:t},e.queue=t,t=t.dispatch=XP.bind(null,dr,t),[e.memoizedState,t]}function cf(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=dr.updateQueue,e===null?(e={lastEffect:null,stores:null},dr.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function KN(){return Di().memoizedState}function ap(t,e,n,r){var s=no();dr.flags|=t,s.memoizedState=cf(1|e,n,void 0,r===void 0?null:r)}function yg(t,e,n,r){var s=Di();r=r===void 0?null:r;var i=void 0;if(Rr!==null){var o=Rr.memoizedState;if(i=o.destroy,r!==null&&Jb(r,o.deps)){s.memoizedState=cf(e,n,i,r);return}}dr.flags|=t,s.memoizedState=cf(1|e,n,i,r)}function cS(t,e){return ap(8390656,8,t,e)}function Zb(t,e){return yg(2048,8,t,e)}function GN(t,e){return yg(4,2,t,e)}function qN(t,e){return yg(4,4,t,e)}function YN(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function JN(t,e,n){return n=n!=null?n.concat([t]):null,yg(4,4,YN.bind(null,e,t),n)}function ev(){}function XN(t,e){var n=Di();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Jb(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function QN(t,e){var n=Di();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Jb(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function ZN(t,e,n){return Yl&21?(eo(n,e)||(n=sN(),dr.lanes|=n,Jl|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ls=!0),t.memoizedState=n)}function YP(t,e){var n=$n;$n=n!==0&&4>n?n:4,t(!0);var r=T0.transition;T0.transition={};try{t(!1),e()}finally{$n=n,T0.transition=r}}function ej(){return Di().memoizedState}function JP(t,e,n){var r=Oa(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},tj(t))nj(e,n);else if(n=PN(t,e,n,r),n!==null){var s=_s();Zi(n,t,r,s),rj(n,e,r)}}function XP(t,e,n){var r=Oa(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(tj(t))nj(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(s.hasEagerState=!0,s.eagerState=a,eo(a,o)){var l=e.interleaved;l===null?(s.next=s,Wb(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}n=PN(t,e,s,r),n!==null&&(s=_s(),Zi(n,t,r,s),rj(n,e,r))}}function tj(t){var e=t.alternate;return t===dr||e!==null&&e===dr}function nj(t,e){Sd=Jp=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function rj(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Mb(t,n)}}var Xp={readContext:Mi,useCallback:as,useContext:as,useEffect:as,useImperativeHandle:as,useInsertionEffect:as,useLayoutEffect:as,useMemo:as,useReducer:as,useRef:as,useState:as,useDebugValue:as,useDeferredValue:as,useTransition:as,useMutableSource:as,useSyncExternalStore:as,useId:as,unstable_isNewReconciler:!1},QP={readContext:Mi,useCallback:function(t,e){return no().memoizedState=[t,e===void 0?null:e],t},useContext:Mi,useEffect:cS,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ap(4194308,4,YN.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ap(4194308,4,t,e)},useInsertionEffect:function(t,e){return ap(4,2,t,e)},useMemo:function(t,e){var n=no();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=no();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=JP.bind(null,dr,t),[r.memoizedState,t]},useRef:function(t){var e=no();return t={current:t},e.memoizedState=t},useState:lS,useDebugValue:ev,useDeferredValue:function(t){return no().memoizedState=t},useTransition:function(){var t=lS(!1),e=t[0];return t=YP.bind(null,t[1]),no().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=dr,s=no();if(sr){if(n===void 0)throw Error(Rt(407));n=n()}else{if(n=e(),Br===null)throw Error(Rt(349));Yl&30||BN(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,cS(HN.bind(null,r,i,t),[t]),r.flags|=2048,cf(9,UN.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=no(),e=Br.identifierPrefix;if(sr){var n=$o,r=Lo;n=(r&~(1<<32-Qi(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=af++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=qP++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},ZP={readContext:Mi,useCallback:XN,useContext:Mi,useEffect:Zb,useImperativeHandle:JN,useInsertionEffect:GN,useLayoutEffect:qN,useMemo:QN,useReducer:C0,useRef:KN,useState:function(){return C0(lf)},useDebugValue:ev,useDeferredValue:function(t){var e=Di();return ZN(e,Rr.memoizedState,t)},useTransition:function(){var t=C0(lf)[0],e=Di().memoizedState;return[t,e]},useMutableSource:zN,useSyncExternalStore:FN,useId:ej,unstable_isNewReconciler:!1},e4={readContext:Mi,useCallback:XN,useContext:Mi,useEffect:Zb,useImperativeHandle:JN,useInsertionEffect:GN,useLayoutEffect:qN,useMemo:QN,useReducer:E0,useRef:KN,useState:function(){return E0(lf)},useDebugValue:ev,useDeferredValue:function(t){var e=Di();return Rr===null?e.memoizedState=t:ZN(e,Rr.memoizedState,t)},useTransition:function(){var t=E0(lf)[0],e=Di().memoizedState;return[t,e]},useMutableSource:zN,useSyncExternalStore:FN,useId:ej,unstable_isNewReconciler:!1};function Ki(t,e){if(t&&t.defaultProps){e=fr({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function _x(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:fr({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var xg={isMounted:function(t){return(t=t._reactInternals)?ic(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=_s(),s=Oa(t),i=Fo(r,s);i.payload=e,n!=null&&(i.callback=n),e=Aa(t,i,s),e!==null&&(Zi(e,t,s,r),ip(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=_s(),s=Oa(t),i=Fo(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Aa(t,i,s),e!==null&&(Zi(e,t,s,r),ip(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=_s(),r=Oa(t),s=Fo(n,r);s.tag=2,e!=null&&(s.callback=e),e=Aa(t,s,r),e!==null&&(Zi(e,t,r,n),ip(e,t,r))}};function uS(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!ef(n,r)||!ef(s,i):!0}function sj(t,e,n){var r=!1,s=Va,i=e.contextType;return typeof i=="object"&&i!==null?i=Mi(i):(s=Bs(e)?Gl:ms.current,r=e.contextTypes,i=(r=r!=null)?mu(t,s):Va),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=xg,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function dS(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&xg.enqueueReplaceState(e,e.state,null)}function Tx(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Kb(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Mi(i):(i=Bs(e)?Gl:ms.current,s.context=mu(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(_x(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&xg.enqueueReplaceState(s,s.state,null),qp(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function bu(t,e){try{var n="",r=e;do n+=NO(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function N0(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Cx(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var t4=typeof WeakMap=="function"?WeakMap:Map;function ij(t,e,n){n=Fo(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Zp||(Zp=!0,Px=r),Cx(t,e)},n}function oj(t,e,n){n=Fo(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Cx(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Cx(t,e),typeof r!="function"&&(Ra===null?Ra=new Set([this]):Ra.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function fS(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new t4;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=m4.bind(null,t,e,n),e.then(t,t))}function hS(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function pS(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Fo(-1,1),e.tag=2,Aa(n,e,1))),n.lanes|=1),t)}var n4=Xo.ReactCurrentOwner,Ls=!1;function vs(t,e,n,r){e.child=t===null?ON(e,null,n,r):yu(e,t.child,n,r)}function mS(t,e,n,r,s){n=n.render;var i=e.ref;return nu(e,s),r=Xb(t,e,n,r,i,s),n=Qb(),t!==null&&!Ls?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Go(t,e,s)):(sr&&n&&zb(e),e.flags|=1,vs(t,e,r,s),e.child)}function gS(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!lv(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,aj(t,e,i,r,s)):(t=dp(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:ef,n(o,r)&&t.ref===e.ref)return Go(t,e,s)}return e.flags|=1,t=Pa(i,r),t.ref=e.ref,t.return=e,e.child=t}function aj(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(ef(i,r)&&t.ref===e.ref)if(Ls=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Ls=!0);else return e.lanes=t.lanes,Go(t,e,s)}return Ex(t,e,n,r,s)}function lj(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Kn(Bc,Xs),Xs|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Kn(Bc,Xs),Xs|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Kn(Bc,Xs),Xs|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Kn(Bc,Xs),Xs|=r;return vs(t,e,s,n),e.child}function cj(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Ex(t,e,n,r,s){var i=Bs(n)?Gl:ms.current;return i=mu(e,i),nu(e,s),n=Xb(t,e,n,r,i,s),r=Qb(),t!==null&&!Ls?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Go(t,e,s)):(sr&&r&&zb(e),e.flags|=1,vs(t,e,n,s),e.child)}function yS(t,e,n,r,s){if(Bs(n)){var i=!0;Hp(e)}else i=!1;if(nu(e,s),e.stateNode===null)lp(t,e),sj(e,n,r),Tx(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=Mi(u):(u=Bs(n)?Gl:ms.current,u=mu(e,u));var d=n.getDerivedStateFromProps,f=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&dS(e,o,r,u),ha=!1;var h=e.memoizedState;o.state=h,qp(e,r,o,s),l=e.memoizedState,a!==r||h!==l||Fs.current||ha?(typeof d=="function"&&(_x(e,n,d,r),l=e.memoizedState),(a=ha||uS(e,n,a,r,h,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,LN(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:Ki(e.type,a),o.props=u,f=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Mi(l):(l=Bs(n)?Gl:ms.current,l=mu(e,l));var p=n.getDerivedStateFromProps;(d=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||h!==l)&&dS(e,o,r,l),ha=!1,h=e.memoizedState,o.state=h,qp(e,r,o,s);var m=e.memoizedState;a!==f||h!==m||Fs.current||ha?(typeof p=="function"&&(_x(e,n,p,r),m=e.memoizedState),(u=ha||uS(e,n,u,r,h,m,l)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),o.props=r,o.state=m,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return Nx(t,e,n,r,i,s)}function Nx(t,e,n,r,s,i){cj(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&nS(e,n,!1),Go(t,e,i);r=e.stateNode,n4.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=yu(e,t.child,null,i),e.child=yu(e,null,a,i)):vs(t,e,a,i),e.memoizedState=r.state,s&&nS(e,n,!0),e.child}function uj(t){var e=t.stateNode;e.pendingContext?tS(t,e.pendingContext,e.pendingContext!==e.context):e.context&&tS(t,e.context,!1),Gb(t,e.containerInfo)}function xS(t,e,n,r,s){return gu(),Bb(s),e.flags|=256,vs(t,e,n,r),e.child}var jx={dehydrated:null,treeContext:null,retryLane:0};function Ix(t){return{baseLanes:t,cachePool:null,transitions:null}}function dj(t,e,n){var r=e.pendingProps,s=cr.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Kn(cr,s&1),t===null)return kx(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=wg(o,r,0,null),t=$l(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Ix(n),e.memoizedState=jx,t):tv(e,o));if(s=t.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return r4(t,e,o,r,a,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Pa(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Pa(a,i):(i=$l(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?Ix(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=jx,r}return i=t.child,t=i.sibling,r=Pa(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function tv(t,e){return e=wg({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Sh(t,e,n,r){return r!==null&&Bb(r),yu(e,t.child,null,n),t=tv(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function r4(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=N0(Error(Rt(422))),Sh(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=wg({mode:"visible",children:r.children},s,0,null),i=$l(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&yu(e,t.child,null,o),e.child.memoizedState=Ix(o),e.memoizedState=jx,i);if(!(e.mode&1))return Sh(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(Rt(419)),r=N0(i,r,void 0),Sh(t,e,o,r)}if(a=(o&t.childLanes)!==0,Ls||a){if(r=Br,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Ko(t,s),Zi(r,t,s,-1))}return av(),r=N0(Error(Rt(421))),Sh(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=g4.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,ti=Da(s.nextSibling),si=e,sr=!0,Ji=null,t!==null&&(bi[vi++]=Lo,bi[vi++]=$o,bi[vi++]=ql,Lo=t.id,$o=t.overflow,ql=e),e=tv(e,r.children),e.flags|=4096,e)}function bS(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Sx(t.return,e,n)}function j0(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function fj(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(vs(t,e,r.children,n),r=cr.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&bS(t,n,e);else if(t.tag===19)bS(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Kn(cr,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Yp(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),j0(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Yp(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}j0(e,!0,n,null,i);break;case"together":j0(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function lp(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Go(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Jl|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Rt(153));if(e.child!==null){for(t=e.child,n=Pa(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Pa(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function s4(t,e,n){switch(e.tag){case 3:uj(e),gu();break;case 5:$N(e);break;case 1:Bs(e.type)&&Hp(e);break;case 4:Gb(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Kn(Kp,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Kn(cr,cr.current&1),e.flags|=128,null):n&e.child.childLanes?dj(t,e,n):(Kn(cr,cr.current&1),t=Go(t,e,n),t!==null?t.sibling:null);Kn(cr,cr.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return fj(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Kn(cr,cr.current),r)break;return null;case 22:case 23:return e.lanes=0,lj(t,e,n)}return Go(t,e,n)}var hj,Mx,pj,mj;hj=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Mx=function(){};pj=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Nl(go.current);var i=null;switch(n){case"input":s=Zy(t,s),r=Zy(t,r),i=[];break;case"select":s=fr({},s,{value:void 0}),r=fr({},r,{value:void 0}),i=[];break;case"textarea":s=nx(t,s),r=nx(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Bp)}sx(n,r);var o;n=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Gd.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(i||(i=[]),i.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Gd.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&qn("scroll",t),i||a===l||(i=[])):(i=i||[]).push(u,l))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};mj=function(t,e,n,r){n!==r&&(e.flags|=4)};function Xu(t,e){if(!sr)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function ls(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function i4(t,e,n){var r=e.pendingProps;switch(Fb(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ls(e),null;case 1:return Bs(e.type)&&Up(),ls(e),null;case 3:return r=e.stateNode,xu(),Qn(Fs),Qn(ms),Yb(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(wh(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ji!==null&&(zx(Ji),Ji=null))),Mx(t,e),ls(e),null;case 5:qb(e);var s=Nl(of.current);if(n=e.type,t!==null&&e.stateNode!=null)pj(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Rt(166));return ls(e),null}if(t=Nl(go.current),wh(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[lo]=e,r[rf]=i,t=(e.mode&1)!==0,n){case"dialog":qn("cancel",r),qn("close",r);break;case"iframe":case"object":case"embed":qn("load",r);break;case"video":case"audio":for(s=0;s<cd.length;s++)qn(cd[s],r);break;case"source":qn("error",r);break;case"img":case"image":case"link":qn("error",r),qn("load",r);break;case"details":qn("toggle",r);break;case"input":Nk(r,i),qn("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},qn("invalid",r);break;case"textarea":Ik(r,i),qn("invalid",r)}sx(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&vh(r.textContent,a,t),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&vh(r.textContent,a,t),s=["children",""+a]):Gd.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&qn("scroll",r)}switch(n){case"input":fh(r),jk(r,i,!0);break;case"textarea":fh(r),Mk(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Bp)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=HE(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[lo]=e,t[rf]=r,hj(t,e,!1,!1),e.stateNode=t;e:{switch(o=ix(n,r),n){case"dialog":qn("cancel",t),qn("close",t),s=r;break;case"iframe":case"object":case"embed":qn("load",t),s=r;break;case"video":case"audio":for(s=0;s<cd.length;s++)qn(cd[s],t);s=r;break;case"source":qn("error",t),s=r;break;case"img":case"image":case"link":qn("error",t),qn("load",t),s=r;break;case"details":qn("toggle",t),s=r;break;case"input":Nk(t,r),s=Zy(t,r),qn("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=fr({},r,{value:void 0}),qn("invalid",t);break;case"textarea":Ik(t,r),s=nx(t,r),qn("invalid",t);break;default:s=r}sx(n,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?KE(t,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&VE(t,l)):i==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&qd(t,l):typeof l=="number"&&qd(t,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Gd.hasOwnProperty(i)?l!=null&&i==="onScroll"&&qn("scroll",t):l!=null&&Tb(t,i,l,o))}switch(n){case"input":fh(t),jk(t,r,!1);break;case"textarea":fh(t),Mk(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ha(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?Qc(t,!!r.multiple,i,!1):r.defaultValue!=null&&Qc(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Bp)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ls(e),null;case 6:if(t&&e.stateNode!=null)mj(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Rt(166));if(n=Nl(of.current),Nl(go.current),wh(e)){if(r=e.stateNode,n=e.memoizedProps,r[lo]=e,(i=r.nodeValue!==n)&&(t=si,t!==null))switch(t.tag){case 3:vh(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&vh(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[lo]=e,e.stateNode=r}return ls(e),null;case 13:if(Qn(cr),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(sr&&ti!==null&&e.mode&1&&!(e.flags&128))AN(),gu(),e.flags|=98560,i=!1;else if(i=wh(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(Rt(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Rt(317));i[lo]=e}else gu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ls(e),i=!1}else Ji!==null&&(zx(Ji),Ji=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||cr.current&1?Or===0&&(Or=3):av())),e.updateQueue!==null&&(e.flags|=4),ls(e),null);case 4:return xu(),Mx(t,e),t===null&&tf(e.stateNode.containerInfo),ls(e),null;case 10:return Vb(e.type._context),ls(e),null;case 17:return Bs(e.type)&&Up(),ls(e),null;case 19:if(Qn(cr),i=e.memoizedState,i===null)return ls(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)Xu(i,!1);else{if(Or!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Yp(t),o!==null){for(e.flags|=128,Xu(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Kn(cr,cr.current&1|2),e.child}t=t.sibling}i.tail!==null&&wr()>vu&&(e.flags|=128,r=!0,Xu(i,!1),e.lanes=4194304)}else{if(!r)if(t=Yp(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Xu(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!sr)return ls(e),null}else 2*wr()-i.renderingStartTime>vu&&n!==1073741824&&(e.flags|=128,r=!0,Xu(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=wr(),e.sibling=null,n=cr.current,Kn(cr,r?n&1|2:n&1),e):(ls(e),null);case 22:case 23:return ov(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Xs&1073741824&&(ls(e),e.subtreeFlags&6&&(e.flags|=8192)):ls(e),null;case 24:return null;case 25:return null}throw Error(Rt(156,e.tag))}function o4(t,e){switch(Fb(e),e.tag){case 1:return Bs(e.type)&&Up(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return xu(),Qn(Fs),Qn(ms),Yb(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return qb(e),null;case 13:if(Qn(cr),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Rt(340));gu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Qn(cr),null;case 4:return xu(),null;case 10:return Vb(e.type._context),null;case 22:case 23:return ov(),null;case 24:return null;default:return null}}var _h=!1,fs=!1,a4=typeof WeakSet=="function"?WeakSet:Set,qt=null;function Fc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){gr(t,e,r)}else n.current=null}function Dx(t,e,n){try{n()}catch(r){gr(t,e,r)}}var vS=!1;function l4(t,e){if(mx=$p,t=vN(),$b(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,u=0,d=0,f=t,h=null;t:for(;;){for(var p;f!==n||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(p=f.firstChild)!==null;)h=f,f=p;for(;;){if(f===t)break t;if(h===n&&++u===s&&(a=o),h===i&&++d===r&&(l=o),(p=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=p}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(gx={focusedElem:t,selectionRange:n},$p=!1,qt=e;qt!==null;)if(e=qt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,qt=t;else for(;qt!==null;){e=qt;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var y=m.memoizedProps,b=m.memoizedState,g=e.stateNode,v=g.getSnapshotBeforeUpdate(e.elementType===e.type?y:Ki(e.type,y),b);g.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Rt(163))}}catch(T){gr(e,e.return,T)}if(t=e.sibling,t!==null){t.return=e.return,qt=t;break}qt=e.return}return m=vS,vS=!1,m}function _d(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Dx(e,n,i)}s=s.next}while(s!==r)}}function bg(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Ax(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function gj(t){var e=t.alternate;e!==null&&(t.alternate=null,gj(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[lo],delete e[rf],delete e[bx],delete e[VP],delete e[WP])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function yj(t){return t.tag===5||t.tag===3||t.tag===4}function wS(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||yj(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Rx(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Bp));else if(r!==4&&(t=t.child,t!==null))for(Rx(t,e,n),t=t.sibling;t!==null;)Rx(t,e,n),t=t.sibling}function Ox(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Ox(t,e,n),t=t.sibling;t!==null;)Ox(t,e,n),t=t.sibling}var Yr=null,qi=!1;function sa(t,e,n){for(n=n.child;n!==null;)xj(t,e,n),n=n.sibling}function xj(t,e,n){if(mo&&typeof mo.onCommitFiberUnmount=="function")try{mo.onCommitFiberUnmount(dg,n)}catch{}switch(n.tag){case 5:fs||Fc(n,e);case 6:var r=Yr,s=qi;Yr=null,sa(t,e,n),Yr=r,qi=s,Yr!==null&&(qi?(t=Yr,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Yr.removeChild(n.stateNode));break;case 18:Yr!==null&&(qi?(t=Yr,n=n.stateNode,t.nodeType===8?k0(t.parentNode,n):t.nodeType===1&&k0(t,n),Qd(t)):k0(Yr,n.stateNode));break;case 4:r=Yr,s=qi,Yr=n.stateNode.containerInfo,qi=!0,sa(t,e,n),Yr=r,qi=s;break;case 0:case 11:case 14:case 15:if(!fs&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Dx(n,e,o),s=s.next}while(s!==r)}sa(t,e,n);break;case 1:if(!fs&&(Fc(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){gr(n,e,a)}sa(t,e,n);break;case 21:sa(t,e,n);break;case 22:n.mode&1?(fs=(r=fs)||n.memoizedState!==null,sa(t,e,n),fs=r):sa(t,e,n);break;default:sa(t,e,n)}}function kS(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new a4),e.forEach(function(r){var s=y4.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function $i(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Yr=a.stateNode,qi=!1;break e;case 3:Yr=a.stateNode.containerInfo,qi=!0;break e;case 4:Yr=a.stateNode.containerInfo,qi=!0;break e}a=a.return}if(Yr===null)throw Error(Rt(160));xj(i,o,s),Yr=null,qi=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){gr(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)bj(e,t),e=e.sibling}function bj(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if($i(e,t),to(t),r&4){try{_d(3,t,t.return),bg(3,t)}catch(y){gr(t,t.return,y)}try{_d(5,t,t.return)}catch(y){gr(t,t.return,y)}}break;case 1:$i(e,t),to(t),r&512&&n!==null&&Fc(n,n.return);break;case 5:if($i(e,t),to(t),r&512&&n!==null&&Fc(n,n.return),t.flags&32){var s=t.stateNode;try{qd(s,"")}catch(y){gr(t,t.return,y)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&BE(s,i),ix(a,o);var u=ix(a,i);for(o=0;o<l.length;o+=2){var d=l[o],f=l[o+1];d==="style"?KE(s,f):d==="dangerouslySetInnerHTML"?VE(s,f):d==="children"?qd(s,f):Tb(s,d,f,u)}switch(a){case"input":ex(s,i);break;case"textarea":UE(s,i);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?Qc(s,!!i.multiple,p,!1):h!==!!i.multiple&&(i.defaultValue!=null?Qc(s,!!i.multiple,i.defaultValue,!0):Qc(s,!!i.multiple,i.multiple?[]:"",!1))}s[rf]=i}catch(y){gr(t,t.return,y)}}break;case 6:if($i(e,t),to(t),r&4){if(t.stateNode===null)throw Error(Rt(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(y){gr(t,t.return,y)}}break;case 3:if($i(e,t),to(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Qd(e.containerInfo)}catch(y){gr(t,t.return,y)}break;case 4:$i(e,t),to(t);break;case 13:$i(e,t),to(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(sv=wr())),r&4&&kS(t);break;case 22:if(d=n!==null&&n.memoizedState!==null,t.mode&1?(fs=(u=fs)||d,$i(e,t),fs=u):$i(e,t),to(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!d&&t.mode&1)for(qt=t,d=t.child;d!==null;){for(f=qt=d;qt!==null;){switch(h=qt,p=h.child,h.tag){case 0:case 11:case 14:case 15:_d(4,h,h.return);break;case 1:Fc(h,h.return);var m=h.stateNode;if(typeof m.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(y){gr(r,n,y)}}break;case 5:Fc(h,h.return);break;case 22:if(h.memoizedState!==null){_S(f);continue}}p!==null?(p.return=h,qt=p):_S(f)}d=d.sibling}e:for(d=null,f=t;;){if(f.tag===5){if(d===null){d=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=WE("display",o))}catch(y){gr(t,t.return,y)}}}else if(f.tag===6){if(d===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(y){gr(t,t.return,y)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:$i(e,t),to(t),r&4&&kS(t);break;case 21:break;default:$i(e,t),to(t)}}function to(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(yj(n)){var r=n;break e}n=n.return}throw Error(Rt(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(qd(s,""),r.flags&=-33);var i=wS(t);Ox(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=wS(t);Rx(t,a,o);break;default:throw Error(Rt(161))}}catch(l){gr(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function c4(t,e,n){qt=t,vj(t)}function vj(t,e,n){for(var r=(t.mode&1)!==0;qt!==null;){var s=qt,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||_h;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||fs;a=_h;var u=fs;if(_h=o,(fs=l)&&!u)for(qt=s;qt!==null;)o=qt,l=o.child,o.tag===22&&o.memoizedState!==null?TS(s):l!==null?(l.return=o,qt=l):TS(s);for(;i!==null;)qt=i,vj(i),i=i.sibling;qt=s,_h=a,fs=u}SS(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,qt=i):SS(t)}}function SS(t){for(;qt!==null;){var e=qt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:fs||bg(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!fs)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Ki(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&aS(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}aS(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var f=d.dehydrated;f!==null&&Qd(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Rt(163))}fs||e.flags&512&&Ax(e)}catch(h){gr(e,e.return,h)}}if(e===t){qt=null;break}if(n=e.sibling,n!==null){n.return=e.return,qt=n;break}qt=e.return}}function _S(t){for(;qt!==null;){var e=qt;if(e===t){qt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,qt=n;break}qt=e.return}}function TS(t){for(;qt!==null;){var e=qt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{bg(4,e)}catch(l){gr(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){gr(e,s,l)}}var i=e.return;try{Ax(e)}catch(l){gr(e,i,l)}break;case 5:var o=e.return;try{Ax(e)}catch(l){gr(e,o,l)}}}catch(l){gr(e,e.return,l)}if(e===t){qt=null;break}var a=e.sibling;if(a!==null){a.return=e.return,qt=a;break}qt=e.return}}var u4=Math.ceil,Qp=Xo.ReactCurrentDispatcher,nv=Xo.ReactCurrentOwner,Ci=Xo.ReactCurrentBatchConfig,Mn=0,Br=null,Cr=null,es=0,Xs=0,Bc=Xa(0),Or=0,uf=null,Jl=0,vg=0,rv=0,Td=null,Rs=null,sv=0,vu=1/0,Do=null,Zp=!1,Px=null,Ra=null,Th=!1,Ta=null,em=0,Cd=0,Lx=null,cp=-1,up=0;function _s(){return Mn&6?wr():cp!==-1?cp:cp=wr()}function Oa(t){return t.mode&1?Mn&2&&es!==0?es&-es:GP.transition!==null?(up===0&&(up=sN()),up):(t=$n,t!==0||(t=window.event,t=t===void 0?16:dN(t.type)),t):1}function Zi(t,e,n,r){if(50<Cd)throw Cd=0,Lx=null,Error(Rt(185));Hf(t,n,r),(!(Mn&2)||t!==Br)&&(t===Br&&(!(Mn&2)&&(vg|=n),Or===4&&va(t,es)),Us(t,r),n===1&&Mn===0&&!(e.mode&1)&&(vu=wr()+500,gg&&Qa()))}function Us(t,e){var n=t.callbackNode;GO(t,e);var r=Lp(t,t===Br?es:0);if(r===0)n!==null&&Rk(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Rk(n),e===1)t.tag===0?KP(CS.bind(null,t)):IN(CS.bind(null,t)),UP(function(){!(Mn&6)&&Qa()}),n=null;else{switch(iN(r)){case 1:n=Ib;break;case 4:n=nN;break;case 16:n=Pp;break;case 536870912:n=rN;break;default:n=Pp}n=Nj(n,wj.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function wj(t,e){if(cp=-1,up=0,Mn&6)throw Error(Rt(327));var n=t.callbackNode;if(ru()&&t.callbackNode!==n)return null;var r=Lp(t,t===Br?es:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=tm(t,r);else{e=r;var s=Mn;Mn|=2;var i=Sj();(Br!==t||es!==e)&&(Do=null,vu=wr()+500,Ll(t,e));do try{h4();break}catch(a){kj(t,a)}while(1);Hb(),Qp.current=i,Mn=s,Cr!==null?e=0:(Br=null,es=0,e=Or)}if(e!==0){if(e===2&&(s=ux(t),s!==0&&(r=s,e=$x(t,s))),e===1)throw n=uf,Ll(t,0),va(t,r),Us(t,wr()),n;if(e===6)va(t,r);else{if(s=t.current.alternate,!(r&30)&&!d4(s)&&(e=tm(t,r),e===2&&(i=ux(t),i!==0&&(r=i,e=$x(t,i))),e===1))throw n=uf,Ll(t,0),va(t,r),Us(t,wr()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(Rt(345));case 2:ml(t,Rs,Do);break;case 3:if(va(t,r),(r&130023424)===r&&(e=sv+500-wr(),10<e)){if(Lp(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){_s(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=xx(ml.bind(null,t,Rs,Do),e);break}ml(t,Rs,Do);break;case 4:if(va(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-Qi(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=wr()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*u4(r/1960))-r,10<r){t.timeoutHandle=xx(ml.bind(null,t,Rs,Do),r);break}ml(t,Rs,Do);break;case 5:ml(t,Rs,Do);break;default:throw Error(Rt(329))}}}return Us(t,wr()),t.callbackNode===n?wj.bind(null,t):null}function $x(t,e){var n=Td;return t.current.memoizedState.isDehydrated&&(Ll(t,e).flags|=256),t=tm(t,e),t!==2&&(e=Rs,Rs=n,e!==null&&zx(e)),t}function zx(t){Rs===null?Rs=t:Rs.push.apply(Rs,t)}function d4(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!eo(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function va(t,e){for(e&=~rv,e&=~vg,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Qi(e),r=1<<n;t[n]=-1,e&=~r}}function CS(t){if(Mn&6)throw Error(Rt(327));ru();var e=Lp(t,0);if(!(e&1))return Us(t,wr()),null;var n=tm(t,e);if(t.tag!==0&&n===2){var r=ux(t);r!==0&&(e=r,n=$x(t,r))}if(n===1)throw n=uf,Ll(t,0),va(t,e),Us(t,wr()),n;if(n===6)throw Error(Rt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ml(t,Rs,Do),Us(t,wr()),null}function iv(t,e){var n=Mn;Mn|=1;try{return t(e)}finally{Mn=n,Mn===0&&(vu=wr()+500,gg&&Qa())}}function Xl(t){Ta!==null&&Ta.tag===0&&!(Mn&6)&&ru();var e=Mn;Mn|=1;var n=Ci.transition,r=$n;try{if(Ci.transition=null,$n=1,t)return t()}finally{$n=r,Ci.transition=n,Mn=e,!(Mn&6)&&Qa()}}function ov(){Xs=Bc.current,Qn(Bc)}function Ll(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,BP(n)),Cr!==null)for(n=Cr.return;n!==null;){var r=n;switch(Fb(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Up();break;case 3:xu(),Qn(Fs),Qn(ms),Yb();break;case 5:qb(r);break;case 4:xu();break;case 13:Qn(cr);break;case 19:Qn(cr);break;case 10:Vb(r.type._context);break;case 22:case 23:ov()}n=n.return}if(Br=t,Cr=t=Pa(t.current,null),es=Xs=e,Or=0,uf=null,rv=vg=Jl=0,Rs=Td=null,El!==null){for(e=0;e<El.length;e++)if(n=El[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}El=null}return t}function kj(t,e){do{var n=Cr;try{if(Hb(),op.current=Xp,Jp){for(var r=dr.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Jp=!1}if(Yl=0,$r=Rr=dr=null,Sd=!1,af=0,nv.current=null,n===null||n.return===null){Or=1,uf=e,Cr=null;break}e:{var i=t,o=n.return,a=n,l=e;if(e=es,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,d=a,f=d.tag;if(!(d.mode&1)&&(f===0||f===11||f===15)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=hS(o);if(p!==null){p.flags&=-257,pS(p,o,a,i,e),p.mode&1&&fS(i,u,e),e=p,l=u;var m=e.updateQueue;if(m===null){var y=new Set;y.add(l),e.updateQueue=y}else m.add(l);break e}else{if(!(e&1)){fS(i,u,e),av();break e}l=Error(Rt(426))}}else if(sr&&a.mode&1){var b=hS(o);if(b!==null){!(b.flags&65536)&&(b.flags|=256),pS(b,o,a,i,e),Bb(bu(l,a));break e}}i=l=bu(l,a),Or!==4&&(Or=2),Td===null?Td=[i]:Td.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var g=ij(i,l,e);oS(i,g);break e;case 1:a=l;var v=i.type,w=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Ra===null||!Ra.has(w)))){i.flags|=65536,e&=-e,i.lanes|=e;var T=oj(i,a,e);oS(i,T);break e}}i=i.return}while(i!==null)}Tj(n)}catch(R){e=R,Cr===n&&n!==null&&(Cr=n=n.return);continue}break}while(1)}function Sj(){var t=Qp.current;return Qp.current=Xp,t===null?Xp:t}function av(){(Or===0||Or===3||Or===2)&&(Or=4),Br===null||!(Jl&268435455)&&!(vg&268435455)||va(Br,es)}function tm(t,e){var n=Mn;Mn|=2;var r=Sj();(Br!==t||es!==e)&&(Do=null,Ll(t,e));do try{f4();break}catch(s){kj(t,s)}while(1);if(Hb(),Mn=n,Qp.current=r,Cr!==null)throw Error(Rt(261));return Br=null,es=0,Or}function f4(){for(;Cr!==null;)_j(Cr)}function h4(){for(;Cr!==null&&!$O();)_j(Cr)}function _j(t){var e=Ej(t.alternate,t,Xs);t.memoizedProps=t.pendingProps,e===null?Tj(t):Cr=e,nv.current=null}function Tj(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=o4(n,e),n!==null){n.flags&=32767,Cr=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Or=6,Cr=null;return}}else if(n=i4(n,e,Xs),n!==null){Cr=n;return}if(e=e.sibling,e!==null){Cr=e;return}Cr=e=t}while(e!==null);Or===0&&(Or=5)}function ml(t,e,n){var r=$n,s=Ci.transition;try{Ci.transition=null,$n=1,p4(t,e,n,r)}finally{Ci.transition=s,$n=r}return null}function p4(t,e,n,r){do ru();while(Ta!==null);if(Mn&6)throw Error(Rt(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Rt(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(qO(t,i),t===Br&&(Cr=Br=null,es=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Th||(Th=!0,Nj(Pp,function(){return ru(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Ci.transition,Ci.transition=null;var o=$n;$n=1;var a=Mn;Mn|=4,nv.current=null,l4(t,n),bj(n,t),RP(gx),$p=!!mx,gx=mx=null,t.current=n,c4(n),zO(),Mn=a,$n=o,Ci.transition=i}else t.current=n;if(Th&&(Th=!1,Ta=t,em=s),i=t.pendingLanes,i===0&&(Ra=null),UO(n.stateNode),Us(t,wr()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Zp)throw Zp=!1,t=Px,Px=null,t;return em&1&&t.tag!==0&&ru(),i=t.pendingLanes,i&1?t===Lx?Cd++:(Cd=0,Lx=t):Cd=0,Qa(),null}function ru(){if(Ta!==null){var t=iN(em),e=Ci.transition,n=$n;try{if(Ci.transition=null,$n=16>t?16:t,Ta===null)var r=!1;else{if(t=Ta,Ta=null,em=0,Mn&6)throw Error(Rt(331));var s=Mn;for(Mn|=4,qt=t.current;qt!==null;){var i=qt,o=i.child;if(qt.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(qt=u;qt!==null;){var d=qt;switch(d.tag){case 0:case 11:case 15:_d(8,d,i)}var f=d.child;if(f!==null)f.return=d,qt=f;else for(;qt!==null;){d=qt;var h=d.sibling,p=d.return;if(gj(d),d===u){qt=null;break}if(h!==null){h.return=p,qt=h;break}qt=p}}}var m=i.alternate;if(m!==null){var y=m.child;if(y!==null){m.child=null;do{var b=y.sibling;y.sibling=null,y=b}while(y!==null)}}qt=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,qt=o;else e:for(;qt!==null;){if(i=qt,i.flags&2048)switch(i.tag){case 0:case 11:case 15:_d(9,i,i.return)}var g=i.sibling;if(g!==null){g.return=i.return,qt=g;break e}qt=i.return}}var v=t.current;for(qt=v;qt!==null;){o=qt;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,qt=w;else e:for(o=v;qt!==null;){if(a=qt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:bg(9,a)}}catch(R){gr(a,a.return,R)}if(a===o){qt=null;break e}var T=a.sibling;if(T!==null){T.return=a.return,qt=T;break e}qt=a.return}}if(Mn=s,Qa(),mo&&typeof mo.onPostCommitFiberRoot=="function")try{mo.onPostCommitFiberRoot(dg,t)}catch{}r=!0}return r}finally{$n=n,Ci.transition=e}}return!1}function ES(t,e,n){e=bu(n,e),e=ij(t,e,1),t=Aa(t,e,1),e=_s(),t!==null&&(Hf(t,1,e),Us(t,e))}function gr(t,e,n){if(t.tag===3)ES(t,t,n);else for(;e!==null;){if(e.tag===3){ES(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ra===null||!Ra.has(r))){t=bu(n,t),t=oj(e,t,1),e=Aa(e,t,1),t=_s(),e!==null&&(Hf(e,1,t),Us(e,t));break}}e=e.return}}function m4(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=_s(),t.pingedLanes|=t.suspendedLanes&n,Br===t&&(es&n)===n&&(Or===4||Or===3&&(es&130023424)===es&&500>wr()-sv?Ll(t,0):rv|=n),Us(t,e)}function Cj(t,e){e===0&&(t.mode&1?(e=mh,mh<<=1,!(mh&130023424)&&(mh=4194304)):e=1);var n=_s();t=Ko(t,e),t!==null&&(Hf(t,e,n),Us(t,n))}function g4(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Cj(t,n)}function y4(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Rt(314))}r!==null&&r.delete(e),Cj(t,n)}var Ej;Ej=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Fs.current)Ls=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ls=!1,s4(t,e,n);Ls=!!(t.flags&131072)}else Ls=!1,sr&&e.flags&1048576&&MN(e,Wp,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;lp(t,e),t=e.pendingProps;var s=mu(e,ms.current);nu(e,n),s=Xb(null,e,r,t,s,n);var i=Qb();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Bs(r)?(i=!0,Hp(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Kb(e),s.updater=xg,e.stateNode=s,s._reactInternals=e,Tx(e,r,t,n),e=Nx(null,e,r,!0,i,n)):(e.tag=0,sr&&i&&zb(e),vs(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(lp(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=b4(r),t=Ki(r,t),s){case 0:e=Ex(null,e,r,t,n);break e;case 1:e=yS(null,e,r,t,n);break e;case 11:e=mS(null,e,r,t,n);break e;case 14:e=gS(null,e,r,Ki(r.type,t),n);break e}throw Error(Rt(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ki(r,s),Ex(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ki(r,s),yS(t,e,r,s,n);case 3:e:{if(uj(e),t===null)throw Error(Rt(387));r=e.pendingProps,i=e.memoizedState,s=i.element,LN(t,e),qp(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=bu(Error(Rt(423)),e),e=xS(t,e,r,n,s);break e}else if(r!==s){s=bu(Error(Rt(424)),e),e=xS(t,e,r,n,s);break e}else for(ti=Da(e.stateNode.containerInfo.firstChild),si=e,sr=!0,Ji=null,n=ON(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(gu(),r===s){e=Go(t,e,n);break e}vs(t,e,r,n)}e=e.child}return e;case 5:return $N(e),t===null&&kx(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,yx(r,s)?o=null:i!==null&&yx(r,i)&&(e.flags|=32),cj(t,e),vs(t,e,o,n),e.child;case 6:return t===null&&kx(e),null;case 13:return dj(t,e,n);case 4:return Gb(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=yu(e,null,r,n):vs(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ki(r,s),mS(t,e,r,s,n);case 7:return vs(t,e,e.pendingProps,n),e.child;case 8:return vs(t,e,e.pendingProps.children,n),e.child;case 12:return vs(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Kn(Kp,r._currentValue),r._currentValue=o,i!==null)if(eo(i.value,o)){if(i.children===s.children&&!Fs.current){e=Go(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=Fo(-1,n&-n),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}i.lanes|=n,l=i.alternate,l!==null&&(l.lanes|=n),Sx(i.return,n,e),a.lanes|=n;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(Rt(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Sx(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}vs(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,nu(e,n),s=Mi(s),r=r(s),e.flags|=1,vs(t,e,r,n),e.child;case 14:return r=e.type,s=Ki(r,e.pendingProps),s=Ki(r.type,s),gS(t,e,r,s,n);case 15:return aj(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ki(r,s),lp(t,e),e.tag=1,Bs(r)?(t=!0,Hp(e)):t=!1,nu(e,n),sj(e,r,s),Tx(e,r,s,n),Nx(null,e,r,!0,t,n);case 19:return fj(t,e,n);case 22:return lj(t,e,n)}throw Error(Rt(156,e.tag))};function Nj(t,e){return tN(t,e)}function x4(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Si(t,e,n,r){return new x4(t,e,n,r)}function lv(t){return t=t.prototype,!(!t||!t.isReactComponent)}function b4(t){if(typeof t=="function")return lv(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Eb)return 11;if(t===Nb)return 14}return 2}function Pa(t,e){var n=t.alternate;return n===null?(n=Si(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function dp(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")lv(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Mc:return $l(n.children,s,i,e);case Cb:o=8,s|=8;break;case Yy:return t=Si(12,n,e,s|2),t.elementType=Yy,t.lanes=i,t;case Jy:return t=Si(13,n,e,s),t.elementType=Jy,t.lanes=i,t;case Xy:return t=Si(19,n,e,s),t.elementType=Xy,t.lanes=i,t;case $E:return wg(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case PE:o=10;break e;case LE:o=9;break e;case Eb:o=11;break e;case Nb:o=14;break e;case fa:o=16,r=null;break e}throw Error(Rt(130,t==null?t:typeof t,""))}return e=Si(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function $l(t,e,n,r){return t=Si(7,t,r,e),t.lanes=n,t}function wg(t,e,n,r){return t=Si(22,t,r,e),t.elementType=$E,t.lanes=n,t.stateNode={isHidden:!1},t}function I0(t,e,n){return t=Si(6,t,null,e),t.lanes=n,t}function M0(t,e,n){return e=Si(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function v4(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=d0(0),this.expirationTimes=d0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=d0(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function cv(t,e,n,r,s,i,o,a,l){return t=new v4(t,e,n,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Si(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Kb(i),t}function w4(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ic,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function jj(t){if(!t)return Va;t=t._reactInternals;e:{if(ic(t)!==t||t.tag!==1)throw Error(Rt(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Bs(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Rt(171))}if(t.tag===1){var n=t.type;if(Bs(n))return jN(t,n,e)}return e}function Ij(t,e,n,r,s,i,o,a,l){return t=cv(n,r,!0,t,s,i,o,a,l),t.context=jj(null),n=t.current,r=_s(),s=Oa(n),i=Fo(r,s),i.callback=e??null,Aa(n,i,s),t.current.lanes=s,Hf(t,s,r),Us(t,r),t}function kg(t,e,n,r){var s=e.current,i=_s(),o=Oa(s);return n=jj(n),e.context===null?e.context=n:e.pendingContext=n,e=Fo(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Aa(s,e,o),t!==null&&(Zi(t,s,o,i),ip(t,s,o)),o}function nm(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function NS(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function uv(t,e){NS(t,e),(t=t.alternate)&&NS(t,e)}function k4(){return null}var Mj=typeof reportError=="function"?reportError:function(t){console.error(t)};function dv(t){this._internalRoot=t}Sg.prototype.render=dv.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Rt(409));kg(t,e,null,null)};Sg.prototype.unmount=dv.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Xl(function(){kg(null,t,null,null)}),e[Wo]=null}};function Sg(t){this._internalRoot=t}Sg.prototype.unstable_scheduleHydration=function(t){if(t){var e=lN();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ba.length&&e!==0&&e<ba[n].priority;n++);ba.splice(n,0,t),n===0&&uN(t)}};function fv(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function _g(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function jS(){}function S4(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=nm(o);i.call(u)}}var o=Ij(e,r,t,0,null,!1,!1,"",jS);return t._reactRootContainer=o,t[Wo]=o.current,tf(t.nodeType===8?t.parentNode:t),Xl(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=nm(l);a.call(u)}}var l=cv(t,0,!1,null,null,!1,!1,"",jS);return t._reactRootContainer=l,t[Wo]=l.current,tf(t.nodeType===8?t.parentNode:t),Xl(function(){kg(e,l,n,r)}),l}function Tg(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=nm(o);a.call(l)}}kg(e,o,t,s)}else o=S4(n,e,t,s,r);return nm(o)}oN=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=ld(e.pendingLanes);n!==0&&(Mb(e,n|1),Us(e,wr()),!(Mn&6)&&(vu=wr()+500,Qa()))}break;case 13:Xl(function(){var r=Ko(t,1);if(r!==null){var s=_s();Zi(r,t,1,s)}}),uv(t,1)}};Db=function(t){if(t.tag===13){var e=Ko(t,134217728);if(e!==null){var n=_s();Zi(e,t,134217728,n)}uv(t,134217728)}};aN=function(t){if(t.tag===13){var e=Oa(t),n=Ko(t,e);if(n!==null){var r=_s();Zi(n,t,e,r)}uv(t,e)}};lN=function(){return $n};cN=function(t,e){var n=$n;try{return $n=t,e()}finally{$n=n}};ax=function(t,e,n){switch(e){case"input":if(ex(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=mg(r);if(!s)throw Error(Rt(90));FE(r),ex(r,s)}}}break;case"textarea":UE(t,n);break;case"select":e=n.value,e!=null&&Qc(t,!!n.multiple,e,!1)}};YE=iv;JE=Xl;var _4={usingClientEntryPoint:!1,Events:[Wf,Oc,mg,GE,qE,iv]},Qu={findFiberByHostInstance:Cl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},T4={bundleType:Qu.bundleType,version:Qu.version,rendererPackageName:Qu.rendererPackageName,rendererConfig:Qu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Xo.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=ZE(t),t===null?null:t.stateNode},findFiberByHostInstance:Qu.findFiberByHostInstance||k4,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ch=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ch.isDisabled&&Ch.supportsFiber)try{dg=Ch.inject(T4),mo=Ch}catch{}}ai.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_4;ai.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!fv(e))throw Error(Rt(200));return w4(t,e,null,n)};ai.createRoot=function(t,e){if(!fv(t))throw Error(Rt(299));var n=!1,r="",s=Mj;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=cv(t,1,!1,null,null,n,!1,r,s),t[Wo]=e.current,tf(t.nodeType===8?t.parentNode:t),new dv(e)};ai.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Rt(188)):(t=Object.keys(t).join(","),Error(Rt(268,t)));return t=ZE(e),t=t===null?null:t.stateNode,t};ai.flushSync=function(t){return Xl(t)};ai.hydrate=function(t,e,n){if(!_g(e))throw Error(Rt(200));return Tg(null,t,e,!0,n)};ai.hydrateRoot=function(t,e,n){if(!fv(t))throw Error(Rt(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=Mj;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Ij(e,null,t,1,n??null,s,!1,i,o),t[Wo]=e.current,tf(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Sg(e)};ai.render=function(t,e,n){if(!_g(e))throw Error(Rt(200));return Tg(null,t,e,!1,n)};ai.unmountComponentAtNode=function(t){if(!_g(t))throw Error(Rt(40));return t._reactRootContainer?(Xl(function(){Tg(null,null,t,!1,function(){t._reactRootContainer=null,t[Wo]=null})}),!0):!1};ai.unstable_batchedUpdates=iv;ai.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!_g(n))throw Error(Rt(200));if(t==null||t._reactInternals===void 0)throw Error(Rt(38));return Tg(t,e,n,!1,r)};ai.version="18.3.1-next-f1338f8080-20240426";function Dj(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Dj)}catch(t){console.error(t)}}Dj(),DE.exports=ai;var ir=DE.exports;const C4=cg(ir);var IS=ir;Gy.createRoot=IS.createRoot,Gy.hydrateRoot=IS.hydrateRoot;const E4="modulepreload",N4=function(t){return"/"+t},MS={},hv=function(e,n,r){if(!n||n.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(n.map(i=>{if(i=N4(i),i in MS)return;MS[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":E4,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((d,f)=>{u.addEventListener("load",d),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};var DS="popstate";function j4(t={}){function e(r,s){let{pathname:i,search:o,hash:a}=r.location;return Fx("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:df(s)}return M4(e,n,null,t)}function or(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ai(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function I4(){return Math.random().toString(36).substring(2,10)}function AS(t,e){return{usr:t.state,key:t.key,idx:e}}function Fx(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Mu(e):e,state:n,key:e&&e.key||r||I4()}}function df({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Mu(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function M4(t,e,n,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a="POP",l=null,u=d();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function d(){return(o.state||{idx:null}).idx}function f(){a="POP";let b=d(),g=b==null?null:b-u;u=b,l&&l({action:a,location:y.location,delta:g})}function h(b,g){a="PUSH";let v=Fx(y.location,b,g);n&&n(v,b),u=d()+1;let w=AS(v,u),T=y.createHref(v);try{o.pushState(w,"",T)}catch(R){if(R instanceof DOMException&&R.name==="DataCloneError")throw R;s.location.assign(T)}i&&l&&l({action:a,location:y.location,delta:1})}function p(b,g){a="REPLACE";let v=Fx(y.location,b,g);n&&n(v,b),u=d();let w=AS(v,u),T=y.createHref(v);o.replaceState(w,"",T),i&&l&&l({action:a,location:y.location,delta:0})}function m(b){return D4(b)}let y={get action(){return a},get location(){return t(s,o)},listen(b){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(DS,f),l=b,()=>{s.removeEventListener(DS,f),l=null}},createHref(b){return e(s,b)},createURL:m,encodeLocation(b){let g=m(b);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:h,replace:p,go(b){return o.go(b)}};return y}function D4(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),or(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:df(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function Aj(t,e,n="/"){return A4(t,e,n,!1)}function A4(t,e,n,r){let s=typeof e=="string"?Mu(e):e,i=qo(s.pathname||"/",n);if(i==null)return null;let o=Rj(t);R4(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let u=W4(i);a=H4(o[l],u,r)}return a}function Rj(t,e=[],n=[],r="",s=!1){let i=(o,a,l=s,u)=>{let d={relativePath:u===void 0?o.path||"":u,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};if(d.relativePath.startsWith("/")){if(!d.relativePath.startsWith(r)&&l)return;or(d.relativePath.startsWith(r),`Absolute route path "${d.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),d.relativePath=d.relativePath.slice(r.length)}let f=Bo([r,d.relativePath]),h=n.concat(d);o.children&&o.children.length>0&&(or(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${f}".`),Rj(o.children,e,h,f,l)),!(o.path==null&&!o.index)&&e.push({path:f,score:B4(f,o.index),routesMeta:h})};return t.forEach((o,a)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))i(o,a);else for(let u of Oj(o.path))i(o,a,!0,u)}),e}function Oj(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=Oj(r.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function R4(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:U4(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var O4=/^:[\w-]+$/,P4=3,L4=2,$4=1,z4=10,F4=-2,RS=t=>t==="*";function B4(t,e){let n=t.split("/"),r=n.length;return n.some(RS)&&(r+=F4),e&&(r+=L4),n.filter(s=>!RS(s)).reduce((s,i)=>s+(O4.test(i)?P4:i===""?$4:z4),r)}function U4(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function H4(t,e,n=!1){let{routesMeta:r}=t,s={},i="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],u=a===r.length-1,d=i==="/"?e:e.slice(i.length)||"/",f=rm({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},d),h=l.route;if(!f&&u&&n&&!r[r.length-1].route.index&&(f=rm({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},d)),!f)return null;Object.assign(s,f.params),o.push({params:s,pathname:Bo([i,f.pathname]),pathnameBase:Y4(Bo([i,f.pathnameBase])),route:h}),f.pathnameBase!=="/"&&(i=Bo([i,f.pathnameBase]))}return o}function rm(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=V4(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((u,{paramName:d,isOptional:f},h)=>{if(d==="*"){let m=a[h]||"";o=i.slice(0,i.length-m.length).replace(/(.)\/+$/,"$1")}const p=a[h];return f&&!p?u[d]=void 0:u[d]=(p||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:t}}function V4(t,e=!1,n=!0){Ai(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function W4(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ai(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function qo(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var Pj=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,K4=t=>Pj.test(t);function G4(t,e="/"){let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?Mu(t):t,i;if(n)if(K4(n))i=n;else{if(n.includes("//")){let o=n;n=n.replace(/\/\/+/g,"/"),Ai(!1,`Pathnames cannot have embedded double slashes - normalizing ${o} -> ${n}`)}n.startsWith("/")?i=OS(n.substring(1),"/"):i=OS(n,e)}else i=e;return{pathname:i,search:J4(r),hash:X4(s)}}function OS(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function D0(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function q4(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function pv(t){let e=q4(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function mv(t,e,n,r=!1){let s;typeof t=="string"?s=Mu(t):(s={...t},or(!s.pathname||!s.pathname.includes("?"),D0("?","pathname","search",s)),or(!s.pathname||!s.pathname.includes("#"),D0("#","pathname","hash",s)),or(!s.search||!s.search.includes("#"),D0("#","search","hash",s)));let i=t===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=n;else{let f=e.length-1;if(!r&&o.startsWith("..")){let h=o.split("/");for(;h[0]==="..";)h.shift(),f-=1;s.pathname=h.join("/")}a=f>=0?e[f]:"/"}let l=G4(s,a),u=o&&o!=="/"&&o.endsWith("/"),d=(i||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(u||d)&&(l.pathname+="/"),l}var Bo=t=>t.join("/").replace(/\/\/+/g,"/"),Y4=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),J4=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,X4=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,Q4=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function Z4(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function e3(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Lj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function $j(t,e){let n=t;if(typeof n!="string"||!Pj.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,s=!1;if(Lj)try{let i=new URL(window.location.href),o=n.startsWith("//")?new URL(i.protocol+n):new URL(n),a=qo(o.pathname,e);o.origin===i.origin&&a!=null?n=a+o.search+o.hash:s=!0}catch{Ai(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:s,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var zj=["POST","PUT","PATCH","DELETE"];new Set(zj);var t3=["GET",...zj];new Set(t3);var Du=x.createContext(null);Du.displayName="DataRouter";var Cg=x.createContext(null);Cg.displayName="DataRouterState";var n3=x.createContext(!1),Fj=x.createContext({isTransitioning:!1});Fj.displayName="ViewTransition";var r3=x.createContext(new Map);r3.displayName="Fetchers";var s3=x.createContext(null);s3.displayName="Await";var ci=x.createContext(null);ci.displayName="Navigation";var Gf=x.createContext(null);Gf.displayName="Location";var To=x.createContext({outlet:null,matches:[],isDataRoute:!1});To.displayName="Route";var gv=x.createContext(null);gv.displayName="RouteError";var Bj="REACT_ROUTER_ERROR",i3="REDIRECT",o3="ROUTE_ERROR_RESPONSE";function a3(t){if(t.startsWith(`${Bj}:${i3}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function l3(t){if(t.startsWith(`${Bj}:${o3}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new Q4(e.status,e.statusText,e.data)}catch{}}function c3(t,{relative:e}={}){or(Au(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=x.useContext(ci),{hash:s,pathname:i,search:o}=qf(t,{relative:e}),a=i;return n!=="/"&&(a=i==="/"?n:Bo([n,i])),r.createHref({pathname:a,search:o,hash:s})}function Au(){return x.useContext(Gf)!=null}function Za(){return or(Au(),"useLocation() may be used only in the context of a <Router> component."),x.useContext(Gf).location}var Uj="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Hj(t){x.useContext(ci).static||x.useLayoutEffect(t)}function Vj(){let{isDataRoute:t}=x.useContext(To);return t?k3():u3()}function u3(){or(Au(),"useNavigate() may be used only in the context of a <Router> component.");let t=x.useContext(Du),{basename:e,navigator:n}=x.useContext(ci),{matches:r}=x.useContext(To),{pathname:s}=Za(),i=JSON.stringify(pv(r)),o=x.useRef(!1);return Hj(()=>{o.current=!0}),x.useCallback((l,u={})=>{if(Ai(o.current,Uj),!o.current)return;if(typeof l=="number"){n.go(l);return}let d=mv(l,JSON.parse(i),s,u.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Bo([e,d.pathname])),(u.replace?n.replace:n.push)(d,u.state,u)},[e,n,i,s,t])}x.createContext(null);function qf(t,{relative:e}={}){let{matches:n}=x.useContext(To),{pathname:r}=Za(),s=JSON.stringify(pv(n));return x.useMemo(()=>mv(t,JSON.parse(s),r,e==="path"),[t,s,r,e])}function d3(t,e){return Wj(t,e)}function Wj(t,e,n,r,s){var v;or(Au(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=x.useContext(ci),{matches:o}=x.useContext(To),a=o[o.length-1],l=a?a.params:{},u=a?a.pathname:"/",d=a?a.pathnameBase:"/",f=a&&a.route;{let w=f&&f.path||"";Gj(u,!f||w.endsWith("*")||w.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${w}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${w}"> to <Route path="${w==="/"?"*":`${w}/*`}">.`)}let h=Za(),p;if(e){let w=typeof e=="string"?Mu(e):e;or(d==="/"||((v=w.pathname)==null?void 0:v.startsWith(d)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${w.pathname}" was given in the \`location\` prop.`),p=w}else p=h;let m=p.pathname||"/",y=m;if(d!=="/"){let w=d.replace(/^\//,"").split("/");y="/"+m.replace(/^\//,"").split("/").slice(w.length).join("/")}let b=Aj(t,{pathname:y});Ai(f||b!=null,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),Ai(b==null||b[b.length-1].route.element!==void 0||b[b.length-1].route.Component!==void 0||b[b.length-1].route.lazy!==void 0,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let g=g3(b&&b.map(w=>Object.assign({},w,{params:Object.assign({},l,w.params),pathname:Bo([d,i.encodeLocation?i.encodeLocation(w.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?d:Bo([d,i.encodeLocation?i.encodeLocation(w.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathnameBase])})),o,n,r,s);return e&&g?x.createElement(Gf.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...p},navigationType:"POP"}},g):g}function f3(){let t=w3(),e=Z4(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=x.createElement(x.Fragment,null,x.createElement("p",null," Hey developer "),x.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",x.createElement("code",{style:i},"ErrorBoundary")," or"," ",x.createElement("code",{style:i},"errorElement")," prop on your route.")),x.createElement(x.Fragment,null,x.createElement("h2",null,"Unexpected Application Error!"),x.createElement("h3",{style:{fontStyle:"italic"}},e),n?x.createElement("pre",{style:s},n):null,o)}var h3=x.createElement(f3,null),Kj=class extends x.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=l3(t.digest);n&&(t=n)}let e=t!==void 0?x.createElement(To.Provider,{value:this.props.routeContext},x.createElement(gv.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?x.createElement(p3,{error:t},e):e}};Kj.contextType=n3;var A0=new WeakMap;function p3({children:t,error:e}){let{basename:n}=x.useContext(ci);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=a3(e.digest);if(r){let s=A0.get(e);if(s)throw s;let i=$j(r.location,n);if(Lj&&!A0.get(e))if(i.isExternal||r.reloadDocument)window.location.href=i.absoluteURL||i.to;else{const o=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(i.to,{replace:r.replace}));throw A0.set(e,o),o}return x.createElement("meta",{httpEquiv:"refresh",content:`0;url=${i.absoluteURL||i.to}`})}}return t}function m3({routeContext:t,match:e,children:n}){let r=x.useContext(Du);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),x.createElement(To.Provider,{value:t},n)}function g3(t,e=[],n=null,r=null,s=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,o=n==null?void 0:n.errors;if(o!=null){let d=i.findIndex(f=>f.route.id&&(o==null?void 0:o[f.route.id])!==void 0);or(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,d+1))}let a=!1,l=-1;if(n)for(let d=0;d<i.length;d++){let f=i[d];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(l=d),f.route.id){let{loaderData:h,errors:p}=n,m=f.route.loader&&!h.hasOwnProperty(f.route.id)&&(!p||p[f.route.id]===void 0);if(f.route.lazy||m){a=!0,l>=0?i=i.slice(0,l+1):i=[i[0]];break}}}let u=n&&r?(d,f)=>{var h,p;r(d,{location:n.location,params:((p=(h=n.matches)==null?void 0:h[0])==null?void 0:p.params)??{},unstable_pattern:e3(n.matches),errorInfo:f})}:void 0;return i.reduceRight((d,f,h)=>{let p,m=!1,y=null,b=null;n&&(p=o&&f.route.id?o[f.route.id]:void 0,y=f.route.errorElement||h3,a&&(l<0&&h===0?(Gj("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),m=!0,b=null):l===h&&(m=!0,b=f.route.hydrateFallbackElement||null)));let g=e.concat(i.slice(0,h+1)),v=()=>{let w;return p?w=y:m?w=b:f.route.Component?w=x.createElement(f.route.Component,null):f.route.element?w=f.route.element:w=d,x.createElement(m3,{match:f,routeContext:{outlet:d,matches:g,isDataRoute:n!=null},children:w})};return n&&(f.route.ErrorBoundary||f.route.errorElement||h===0)?x.createElement(Kj,{location:n.location,revalidation:n.revalidation,component:y,error:p,children:v(),routeContext:{outlet:null,matches:g,isDataRoute:!0},onError:u}):v()},null)}function yv(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function y3(t){let e=x.useContext(Du);return or(e,yv(t)),e}function x3(t){let e=x.useContext(Cg);return or(e,yv(t)),e}function b3(t){let e=x.useContext(To);return or(e,yv(t)),e}function xv(t){let e=b3(t),n=e.matches[e.matches.length-1];return or(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function v3(){return xv("useRouteId")}function w3(){var r;let t=x.useContext(gv),e=x3("useRouteError"),n=xv("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function k3(){let{router:t}=y3("useNavigate"),e=xv("useNavigate"),n=x.useRef(!1);return Hj(()=>{n.current=!0}),x.useCallback(async(s,i={})=>{Ai(n.current,Uj),n.current&&(typeof s=="number"?await t.navigate(s):await t.navigate(s,{fromRouteId:e,...i}))},[t,e])}var PS={};function Gj(t,e,n){!e&&!PS[t]&&(PS[t]=!0,Ai(!1,n))}x.memo(S3);function S3({routes:t,future:e,state:n,onError:r}){return Wj(t,void 0,n,r,e)}function LS({to:t,replace:e,state:n,relative:r}){or(Au(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=x.useContext(ci);Ai(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=x.useContext(To),{pathname:o}=Za(),a=Vj(),l=mv(t,pv(i),o,r==="path"),u=JSON.stringify(l);return x.useEffect(()=>{a(JSON.parse(u),{replace:e,state:n,relative:r})},[a,u,r,e,n]),null}function ud(t){or(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function _3({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:s,static:i=!1,unstable_useTransitions:o}){or(!Au(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=t.replace(/^\/*/,"/"),l=x.useMemo(()=>({basename:a,navigator:s,static:i,unstable_useTransitions:o,future:{}}),[a,s,i,o]);typeof n=="string"&&(n=Mu(n));let{pathname:u="/",search:d="",hash:f="",state:h=null,key:p="default"}=n,m=x.useMemo(()=>{let y=qo(u,a);return y==null?null:{location:{pathname:y,search:d,hash:f,state:h,key:p},navigationType:r}},[a,u,d,f,h,p,r]);return Ai(m!=null,`<Router basename="${a}"> is not able to match the URL "${u}${d}${f}" because it does not start with the basename, so the <Router> won't render anything.`),m==null?null:x.createElement(ci.Provider,{value:l},x.createElement(Gf.Provider,{children:e,value:m}))}function T3({children:t,location:e}){return d3(Bx(t),e)}function Bx(t,e=[]){let n=[];return x.Children.forEach(t,(r,s)=>{if(!x.isValidElement(r))return;let i=[...e,s];if(r.type===x.Fragment){n.push.apply(n,Bx(r.props.children,i));return}or(r.type===ud,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),or(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Bx(r.props.children,i)),n.push(o)}),n}var fp="get",hp="application/x-www-form-urlencoded";function Eg(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function C3(t){return Eg(t)&&t.tagName.toLowerCase()==="button"}function E3(t){return Eg(t)&&t.tagName.toLowerCase()==="form"}function N3(t){return Eg(t)&&t.tagName.toLowerCase()==="input"}function j3(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function I3(t,e){return t.button===0&&(!e||e==="_self")&&!j3(t)}var Eh=null;function M3(){if(Eh===null)try{new FormData(document.createElement("form"),0),Eh=!1}catch{Eh=!0}return Eh}var D3=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function R0(t){return t!=null&&!D3.has(t)?(Ai(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${hp}"`),null):t}function A3(t,e){let n,r,s,i,o;if(E3(t)){let a=t.getAttribute("action");r=a?qo(a,e):null,n=t.getAttribute("method")||fp,s=R0(t.getAttribute("enctype"))||hp,i=new FormData(t)}else if(C3(t)||N3(t)&&(t.type==="submit"||t.type==="image")){let a=t.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=t.getAttribute("formaction")||a.getAttribute("action");if(r=l?qo(l,e):null,n=t.getAttribute("formmethod")||a.getAttribute("method")||fp,s=R0(t.getAttribute("formenctype"))||R0(a.getAttribute("enctype"))||hp,i=new FormData(a,t),!M3()){let{name:u,type:d,value:f}=t;if(d==="image"){let h=u?`${u}.`:"";i.append(`${h}x`,"0"),i.append(`${h}y`,"0")}else u&&i.append(u,f)}}else{if(Eg(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=fp,r=null,s=hp,o=t}return i&&s==="text/plain"&&(o=i,i=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function bv(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function R3(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&qo(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function O3(t,e){if(t.id in e)return e[t.id];try{let n=await hv(()=>import(t.module),[]);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function P3(t){return t!=null&&typeof t.page=="string"}function L3(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function $3(t,e,n){let r=await Promise.all(t.map(async s=>{let i=e.routes[s.route.id];if(i){let o=await O3(i,n);return o.links?o.links():[]}return[]}));return U3(r.flat(1).filter(L3).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function $S(t,e,n,r,s,i){let o=(l,u)=>n[u]?l.route.id!==n[u].route.id:!0,a=(l,u)=>{var d;return n[u].pathname!==l.pathname||((d=n[u].route.path)==null?void 0:d.endsWith("*"))&&n[u].params["*"]!==l.params["*"]};return i==="assets"?e.filter((l,u)=>o(l,u)||a(l,u)):i==="data"?e.filter((l,u)=>{var f;let d=r.routes[l.route.id];if(!d||!d.hasLoader)return!1;if(o(l,u)||a(l,u))return!0;if(l.route.shouldRevalidate){let h=l.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((f=n[0])==null?void 0:f.params)||{},nextUrl:new URL(t,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function z3(t,e,{includeHydrateFallback:n}={}){return F3(t.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function F3(t){return[...new Set(t)]}function B3(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function U3(t,e){let n=new Set,r=new Set(e);return t.reduce((s,i)=>{if(e&&!P3(i)&&i.as==="script"&&i.href&&r.has(i.href))return s;let a=JSON.stringify(B3(i));return n.has(a)||(n.add(a),s.push({key:a,link:i})),s},[])}function qj(){let t=x.useContext(Du);return bv(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function H3(){let t=x.useContext(Cg);return bv(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var vv=x.createContext(void 0);vv.displayName="FrameworkContext";function Yj(){let t=x.useContext(vv);return bv(t,"You must render this element inside a <HydratedRouter> element"),t}function V3(t,e){let n=x.useContext(vv),[r,s]=x.useState(!1),[i,o]=x.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:u,onMouseLeave:d,onTouchStart:f}=e,h=x.useRef(null);x.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let y=g=>{g.forEach(v=>{o(v.isIntersecting)})},b=new IntersectionObserver(y,{threshold:.5});return h.current&&b.observe(h.current),()=>{b.disconnect()}}},[t]),x.useEffect(()=>{if(r){let y=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(y)}}},[r]);let p=()=>{s(!0)},m=()=>{s(!1),o(!1)};return n?t!=="intent"?[i,h,{}]:[i,h,{onFocus:Zu(a,p),onBlur:Zu(l,m),onMouseEnter:Zu(u,p),onMouseLeave:Zu(d,m),onTouchStart:Zu(f,p)}]:[!1,h,{}]}function Zu(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function W3({page:t,...e}){let{router:n}=qj(),r=x.useMemo(()=>Aj(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?x.createElement(G3,{page:t,matches:r,...e}):null}function K3(t){let{manifest:e,routeModules:n}=Yj(),[r,s]=x.useState([]);return x.useEffect(()=>{let i=!1;return $3(t,e,n).then(o=>{i||s(o)}),()=>{i=!0}},[t,e,n]),r}function G3({page:t,matches:e,...n}){let r=Za(),{manifest:s,routeModules:i}=Yj(),{basename:o}=qj(),{loaderData:a,matches:l}=H3(),u=x.useMemo(()=>$S(t,e,l,s,r,"data"),[t,e,l,s,r]),d=x.useMemo(()=>$S(t,e,l,s,r,"assets"),[t,e,l,s,r]),f=x.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let m=new Set,y=!1;if(e.forEach(g=>{var w;let v=s.routes[g.route.id];!v||!v.hasLoader||(!u.some(T=>T.route.id===g.route.id)&&g.route.id in a&&((w=i[g.route.id])!=null&&w.shouldRevalidate)||v.hasClientLoader?y=!0:m.add(g.route.id))}),m.size===0)return[];let b=R3(t,o,"data");return y&&m.size>0&&b.searchParams.set("_routes",e.filter(g=>m.has(g.route.id)).map(g=>g.route.id).join(",")),[b.pathname+b.search]},[o,a,r,s,u,e,t,i]),h=x.useMemo(()=>z3(d,s),[d,s]),p=K3(d);return x.createElement(x.Fragment,null,f.map(m=>x.createElement("link",{key:m,rel:"prefetch",as:"fetch",href:m,...n})),h.map(m=>x.createElement("link",{key:m,rel:"modulepreload",href:m,...n})),p.map(({key:m,link:y})=>x.createElement("link",{key:m,nonce:n.nonce,...y})))}function q3(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var Y3=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Y3&&(window.__reactRouterVersion="7.11.0")}catch{}function J3({basename:t,children:e,unstable_useTransitions:n,window:r}){let s=x.useRef();s.current==null&&(s.current=j4({window:r,v5Compat:!0}));let i=s.current,[o,a]=x.useState({action:i.action,location:i.location}),l=x.useCallback(u=>{n===!1?a(u):x.startTransition(()=>a(u))},[n]);return x.useLayoutEffect(()=>i.listen(l),[i,l]),x.createElement(_3,{basename:t,children:e,location:o.location,navigationType:o.action,navigator:i,unstable_useTransitions:n})}var Jj=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Xj=x.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:s,reloadDocument:i,replace:o,state:a,target:l,to:u,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:h,...p},m){let{basename:y,unstable_useTransitions:b}=x.useContext(ci),g=typeof u=="string"&&Jj.test(u),v=$j(u,y);u=v.to;let w=c3(u,{relative:s}),[T,R,k]=V3(r,p),M=eL(u,{replace:o,state:a,target:l,preventScrollReset:d,relative:s,viewTransition:f,unstable_defaultShouldRevalidate:h,unstable_useTransitions:b});function S(_){e&&e(_),_.defaultPrevented||M(_)}let C=x.createElement("a",{...p,...k,href:v.absoluteURL||w,onClick:v.isExternal||i?e:S,ref:q3(m,R),target:l,"data-discover":!g&&n==="render"?"true":void 0});return T&&!g?x.createElement(x.Fragment,null,C,x.createElement(W3,{page:w})):C});Xj.displayName="Link";var X3=x.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:s=!1,style:i,to:o,viewTransition:a,children:l,...u},d){let f=qf(o,{relative:u.relative}),h=Za(),p=x.useContext(Cg),{navigator:m,basename:y}=x.useContext(ci),b=p!=null&&iL(f)&&a===!0,g=m.encodeLocation?m.encodeLocation(f).pathname:f.pathname,v=h.pathname,w=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;n||(v=v.toLowerCase(),w=w?w.toLowerCase():null,g=g.toLowerCase()),w&&y&&(w=qo(w,y)||w);const T=g!=="/"&&g.endsWith("/")?g.length-1:g.length;let R=v===g||!s&&v.startsWith(g)&&v.charAt(T)==="/",k=w!=null&&(w===g||!s&&w.startsWith(g)&&w.charAt(g.length)==="/"),M={isActive:R,isPending:k,isTransitioning:b},S=R?e:void 0,C;typeof r=="function"?C=r(M):C=[r,R?"active":null,k?"pending":null,b?"transitioning":null].filter(Boolean).join(" ");let _=typeof i=="function"?i(M):i;return x.createElement(Xj,{...u,"aria-current":S,className:C,ref:d,style:_,to:o,viewTransition:a},typeof l=="function"?l(M):l)});X3.displayName="NavLink";var Q3=x.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:s,state:i,method:o=fp,action:a,onSubmit:l,relative:u,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:h,...p},m)=>{let{unstable_useTransitions:y}=x.useContext(ci),b=rL(),g=sL(a,{relative:u}),v=o.toLowerCase()==="get"?"get":"post",w=typeof a=="string"&&Jj.test(a),T=R=>{if(l&&l(R),R.defaultPrevented)return;R.preventDefault();let k=R.nativeEvent.submitter,M=(k==null?void 0:k.getAttribute("formmethod"))||o,S=()=>b(k||R.currentTarget,{fetcherKey:e,method:M,navigate:n,replace:s,state:i,relative:u,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:h});y&&n!==!1?x.startTransition(()=>S()):S()};return x.createElement("form",{ref:m,method:v,action:g,onSubmit:r?l:T,...p,"data-discover":!w&&t==="render"?"true":void 0})});Q3.displayName="Form";function Z3(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Qj(t){let e=x.useContext(Du);return or(e,Z3(t)),e}function eL(t,{target:e,replace:n,state:r,preventScrollReset:s,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:a,unstable_useTransitions:l}={}){let u=Vj(),d=Za(),f=qf(t,{relative:i});return x.useCallback(h=>{if(I3(h,e)){h.preventDefault();let p=n!==void 0?n:df(d)===df(f),m=()=>u(t,{replace:p,state:r,preventScrollReset:s,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:a});l?x.startTransition(()=>m()):m()}},[d,u,f,n,r,e,t,s,i,o,a,l])}var tL=0,nL=()=>`__${String(++tL)}__`;function rL(){let{router:t}=Qj("useSubmit"),{basename:e}=x.useContext(ci),n=v3(),r=t.fetch,s=t.navigate;return x.useCallback(async(i,o={})=>{let{action:a,method:l,encType:u,formData:d,body:f}=A3(i,e);if(o.navigate===!1){let h=o.fetcherKey||nL();await r(h,n,o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:d,body:f,formMethod:o.method||l,formEncType:o.encType||u,flushSync:o.flushSync})}else await s(o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:d,body:f,formMethod:o.method||l,formEncType:o.encType||u,replace:o.replace,state:o.state,fromRouteId:n,flushSync:o.flushSync,viewTransition:o.viewTransition})},[r,s,e,n])}function sL(t,{relative:e}={}){let{basename:n}=x.useContext(ci),r=x.useContext(To);or(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...qf(t||".",{relative:e})},o=Za();if(t==null){i.search=o.search;let a=new URLSearchParams(i.search),l=a.getAll("index");if(l.some(d=>d==="")){a.delete("index"),l.filter(f=>f).forEach(f=>a.append("index",f));let d=a.toString();i.search=d?`?${d}`:""}}return(!t||t===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(i.pathname=i.pathname==="/"?n:Bo([n,i.pathname])),df(i)}function iL(t,{relative:e}={}){let n=x.useContext(Fj);or(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=Qj("useViewTransitionState"),s=qf(t,{relative:e});if(!n.isTransitioning)return!1;let i=qo(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=qo(n.nextLocation.pathname,r)||n.nextLocation.pathname;return rm(s.pathname,o)!=null||rm(s.pathname,i)!=null}function Ng(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function oL(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(d){try{u(r.next(d))}catch(f){o(f)}}function l(d){try{u(r.throw(d))}catch(f){o(f)}}function u(d){d.done?i(d.value):s(d.value).then(a,l)}u((r=r.apply(t,e||[])).next())})}const aL=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class wv extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class lL extends wv{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class zS extends wv{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class FS extends wv{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ux;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Ux||(Ux={}));class cL{constructor(e,{headers:n={},customFetch:r,region:s=Ux.Any}={}){this.url=e,this.headers=n,this.region=s,this.fetch=aL(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return oL(this,arguments,void 0,function*(n,r={}){var s;let i,o;try{const{headers:a,method:l,body:u,signal:d,timeout:f}=r;let h={},{region:p}=r;p||(p=this.region);const m=new URL(`${this.url}/${n}`);p&&p!=="any"&&(h["x-region"]=p,m.searchParams.set("forceFunctionRegion",p));let y;u&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",y=u):typeof u=="string"?(h["Content-Type"]="text/plain",y=u):typeof FormData<"u"&&u instanceof FormData?y=u:(h["Content-Type"]="application/json",y=JSON.stringify(u)):y=u;let b=d;f&&(o=new AbortController,i=setTimeout(()=>o.abort(),f),d?(b=o.signal,d.addEventListener("abort",()=>o.abort())):b=o.signal);const g=yield this.fetch(m.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),a),body:y,signal:b}).catch(R=>{throw new lL(R)}),v=g.headers.get("x-relay-error");if(v&&v==="true")throw new zS(g);if(!g.ok)throw new FS(g);let w=((s=g.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),T;return w==="application/json"?T=yield g.json():w==="application/octet-stream"||w==="application/pdf"?T=yield g.blob():w==="text/event-stream"?T=g:w==="multipart/form-data"?T=yield g.formData():T=yield g.text(),{data:T,error:null,response:g}}catch(a){return{data:null,error:a,response:a instanceof FS||a instanceof zS?a.context:void 0}}finally{i&&clearTimeout(i)}})}}var uL=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},dL=class{constructor(t){var e,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var n=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let o=null,a=null,l=null,u=i.status,d=i.statusText;if(i.ok){var f,h;if(n.method!=="HEAD"){var p;const g=await i.text();g===""||(n.headers.get("Accept")==="text/csv"||n.headers.get("Accept")&&(!((p=n.headers.get("Accept"))===null||p===void 0)&&p.includes("application/vnd.pgrst.plan+text"))?a=g:a=JSON.parse(g))}const y=(f=n.headers.get("Prefer"))===null||f===void 0?void 0:f.match(/count=(exact|planned|estimated)/),b=(h=i.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");y&&b&&b.length>1&&(l=parseInt(b[1])),n.isMaybeSingle&&n.method==="GET"&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,u=406,d="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var m;const y=await i.text();try{o=JSON.parse(y),Array.isArray(o)&&i.status===404&&(a=[],o=null,u=200,d="OK")}catch{i.status===404&&y===""?(u=204,d="No Content"):o={message:y}}if(o&&n.isMaybeSingle&&(!(o==null||(m=o.details)===null||m===void 0)&&m.includes("0 rows"))&&(o=null,u=200,d="OK"),o&&n.shouldThrowOnError)throw new uL(o)}return{error:o,data:a,count:l,status:u,statusText:d}});return this.shouldThrowOnError||(s=s.catch(i=>{var o;let a="";const l=i==null?void 0:i.cause;if(l){var u,d,f,h;const m=(u=l==null?void 0:l.message)!==null&&u!==void 0?u:"",y=(d=l==null?void 0:l.code)!==null&&d!==void 0?d:"";a=`${(f=i==null?void 0:i.name)!==null&&f!==void 0?f:"FetchError"}: ${i==null?void 0:i.message}`,a+=`

Caused by: ${(h=l==null?void 0:l.name)!==null&&h!==void 0?h:"Error"}: ${m}`,y&&(a+=` (${y})`),l!=null&&l.stack&&(a+=`
${l.stack}`)}else{var p;a=(p=i==null?void 0:i.stack)!==null&&p!==void 0?p:""}return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:a,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),s.then(t,e)}returns(){return this}overrideTypes(){return this}},fL=class extends dL{select(t){let e=!1;const n=(t??"*").split("").map(r=>/\s/.test(r)&&!e?"":(r==='"'&&(e=!e),r)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:n,foreignTable:r,referencedTable:s=r}={}){const i=s?`${s}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:n=e}={}){const r=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${t}`),this}range(t,e,{foreignTable:n,referencedTable:r=n}={}){const s=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${t}`),this.url.searchParams.set(i,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:n=!1,buffers:r=!1,wal:s=!1,format:i="text"}={}){var o;const a=[t?"analyze":null,e?"verbose":null,n?"settings":null,r?"buffers":null,s?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const BS=new RegExp("[,()]");var _c=class extends fL{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&BS.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}notIn(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&BS.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`not.in.(${n})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:n,type:r}={}){let s="";r==="plain"?s="pl":r==="phrase"?s="ph":r==="websearch"&&(s="w");const i=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${s}fts${i}.${e}`),this}match(t){return Object.entries(t).forEach(([e,n])=>{this.url.searchParams.append(e,`eq.${n}`)}),this}not(t,e,n){return this.url.searchParams.append(t,`not.${e}.${n}`),this}or(t,{foreignTable:e,referencedTable:n=e}={}){const r=n?`${n}.or`:"or";return this.url.searchParams.append(r,`(${t})`),this}filter(t,e,n){return this.url.searchParams.append(t,`${e}.${n}`),this}},hL=class{constructor(t,{headers:e={},schema:n,fetch:r}){this.url=t,this.headers=new Headers(e),this.schema=n,this.fetch=r}select(t,e){const{head:n=!1,count:r}=e??{},s=n?"HEAD":"GET";let i=!1;const o=(t??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),r&&this.headers.append("Prefer",`count=${r}`),new _c({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:n=!0}={}){var r;const s="POST";if(e&&this.headers.append("Prefer",`count=${e}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const i=t.reduce((o,a)=>o.concat(Object.keys(a)),[]);if(i.length>0){const o=[...new Set(i)].map(a=>`"${a}"`);this.url.searchParams.set("columns",o.join(","))}}return new _c({method:s,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:n=!1,count:r,defaultToNull:s=!0}={}){var i;const o="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),e!==void 0&&this.url.searchParams.set("on_conflict",e),r&&this.headers.append("Prefer",`count=${r}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const a=t.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(a.length>0){const l=[...new Set(a)].map(u=>`"${u}"`);this.url.searchParams.set("columns",l.join(","))}}return new _c({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(t,{count:e}={}){var n;const r="PATCH";return e&&this.headers.append("Prefer",`count=${e}`),new _c({method:r,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:t}={}){var e;const n="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new _c({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},pL=class Zj{constructor(e,{headers:n={},schema:r,fetch:s}={}){this.url=e,this.headers=new Headers(n),this.schemaName=r,this.fetch=s}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new hL(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Zj(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,n={},{head:r=!1,get:s=!1,count:i}={}){var o;let a;const l=new URL(`${this.url}/rpc/${e}`);let u;r||s?(a=r?"HEAD":"GET",Object.entries(n).filter(([f,h])=>h!==void 0).map(([f,h])=>[f,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([f,h])=>{l.searchParams.append(f,h)})):(a="POST",u=n);const d=new Headers(this.headers);return i&&d.set("Prefer",`count=${i}`),new _c({method:a,url:l,headers:d,schema:this.schemaName,body:u,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};class mL{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const r=n.node,s=parseInt(r.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const r=this.getWebSocketConstructor();return new r(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const gL="2.89.0",yL=`realtime-js/${gL}`,eI="1.0.0",xL="2.0.0",US=eI,Hx=1e4,bL=1e3,vL=100;var pa;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(pa||(pa={}));var Dr;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Dr||(Dr={}));var Yi;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Yi||(Yi={}));var Vx;(function(t){t.websocket="websocket"})(Vx||(Vx={}));var vl;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(vl||(vl={}));class wL{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,n){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,r;const s=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(e){var n,r;const s=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:{},o=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,n,r){var s,i;const o=e.topic,a=(s=e.ref)!==null&&s!==void 0?s:"",l=(i=e.join_ref)!==null&&i!==void 0?i:"",u=e.payload.event,d=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},f=Object.keys(d).length===0?"":JSON.stringify(d);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`userEvent length ${u.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`metadata length ${f.length} exceeds maximum of 255`);const h=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+u.length+f.length,p=new ArrayBuffer(this.HEADER_LENGTH+h);let m=new DataView(p),y=0;m.setUint8(y++,this.KINDS.userBroadcastPush),m.setUint8(y++,l.length),m.setUint8(y++,a.length),m.setUint8(y++,o.length),m.setUint8(y++,u.length),m.setUint8(y++,f.length),m.setUint8(y++,n),Array.from(l,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(a,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(o,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(u,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(f,g=>m.setUint8(y++,g.charCodeAt(0)));var b=new Uint8Array(p.byteLength+r.byteLength);return b.set(new Uint8Array(p),0),b.set(new Uint8Array(r),p.byteLength),b.buffer}decode(e,n){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return n(r)}if(typeof e=="string"){const r=JSON.parse(e),[s,i,o,a,l]=r;return n({join_ref:s,ref:i,topic:o,event:a,payload:l})}return n({})}_binaryDecode(e){const n=new DataView(e),r=n.getUint8(0),s=new TextDecoder;switch(r){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,n,s)}}_decodeUserBroadcast(e,n,r){const s=n.getUint8(1),i=n.getUint8(2),o=n.getUint8(3),a=n.getUint8(4);let l=this.HEADER_LENGTH+4;const u=r.decode(e.slice(l,l+s));l=l+s;const d=r.decode(e.slice(l,l+i));l=l+i;const f=r.decode(e.slice(l,l+o));l=l+o;const h=e.slice(l,e.byteLength),p=a===this.JSON_ENCODING?JSON.parse(r.decode(h)):h,m={type:this.BROADCAST_EVENT,event:d,payload:p};return o>0&&(m.meta=JSON.parse(f)),{join_ref:null,ref:null,topic:u,event:this.BROADCAST_EVENT,payload:m}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e==null?void 0:e.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}_pick(e,n){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([r])=>n.includes(r)))}}class tI{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Vn;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Vn||(Vn={}));const HS=(t,e,n={})=>{var r;const s=(r=n.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=kL(o,t,e,s),i),{}):{}},kL=(t,e,n,r)=>{const s=e.find(a=>a.name===t),i=s==null?void 0:s.type,o=n[t];return i&&!r.includes(i)?nI(i,o):Wx(o)},nI=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return CL(e,n)}switch(t){case Vn.bool:return SL(e);case Vn.float4:case Vn.float8:case Vn.int2:case Vn.int4:case Vn.int8:case Vn.numeric:case Vn.oid:return _L(e);case Vn.json:case Vn.jsonb:return TL(e);case Vn.timestamp:return EL(e);case Vn.abstime:case Vn.date:case Vn.daterange:case Vn.int4range:case Vn.int8range:case Vn.money:case Vn.reltime:case Vn.text:case Vn.time:case Vn.timestamptz:case Vn.timetz:case Vn.tsrange:case Vn.tstzrange:return Wx(e);default:return Wx(e)}},Wx=t=>t,SL=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},_L=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},TL=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},CL=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let i;const o=t.slice(1,n);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>nI(e,a))}return t},EL=t=>typeof t=="string"?t.replace(" ","T"):t,rI=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class O0{constructor(e,n,r={},s=Hx){this.channel=e,this.event=n,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var VS;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(VS||(VS={}));class Ed{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ed.syncState(this.state,s,i,o),this.pendingDiffs.forEach(l=>{this.state=Ed.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Ed.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,s){const i=this.cloneDeep(e),o=this.transformState(n),a={},l={};return this.map(i,(u,d)=>{o[u]||(l[u]=d)}),this.map(o,(u,d)=>{const f=i[u];if(f){const h=d.map(b=>b.presence_ref),p=f.map(b=>b.presence_ref),m=d.filter(b=>p.indexOf(b.presence_ref)<0),y=f.filter(b=>h.indexOf(b.presence_ref)<0);m.length>0&&(a[u]=m),y.length>0&&(l[u]=y)}else a[u]=d}),this.syncDiff(i,{joins:a,leaves:l},r,s)}static syncDiff(e,n,r,s){const{joins:i,leaves:o}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(a,l)=>{var u;const d=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(l),d.length>0){const f=e[a].map(p=>p.presence_ref),h=d.filter(p=>f.indexOf(p.presence_ref)<0);e[a].unshift(...h)}r(a,d,l)}),this.map(o,(a,l)=>{let u=e[a];if(!u)return;const d=l.map(f=>f.presence_ref);u=u.filter(f=>d.indexOf(f.presence_ref)<0),e[a]=u,s(a,u,l),u.length===0&&delete e[a]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const s=e[r];return"metas"in s?n[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):n[r]=s,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var WS;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(WS||(WS={}));var Nd;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Nd||(Nd={}));var Ao;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Ao||(Ao={}));class Uc{constructor(e,n={config:{}},r){var s,i;if(this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=Dr.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new O0(this,Yi.join,this.params,this.timeout),this.rejoinTimer=new tI(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Dr.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Dr.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Dr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Dr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Dr.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Yi.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new Ed(this),this.broadcastEndpointURL=rI(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var r,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Dr.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,u=(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(p=>p.filter))!==null&&s!==void 0?s:[],d=!!this.bindings[Nd.PRESENCE]&&this.bindings[Nd.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,f={},h={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:d}),postgres_changes:u,private:l};this.socket.accessTokenValue&&(f.access_token=this.socket.accessTokenValue),this._onError(p=>e==null?void 0:e(Ao.CHANNEL_ERROR,p)),this._onClose(()=>e==null?void 0:e(Ao.CLOSED)),this.updateJoinPayload(Object.assign({config:h},f)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:p})=>{var m;if(this.socket._isManualToken()||this.socket.setAuth(),p===void 0){e==null||e(Ao.SUBSCRIBED);return}else{const y=this.bindings.postgres_changes,b=(m=y==null?void 0:y.length)!==null&&m!==void 0?m:0,g=[];for(let v=0;v<b;v++){const w=y[v],{filter:{event:T,schema:R,table:k,filter:M}}=w,S=p&&p[v];if(S&&S.event===T&&Uc.isFilterValueEqual(S.schema,R)&&Uc.isFilterValueEqual(S.table,k)&&Uc.isFilterValueEqual(S.filter,M))g.push(Object.assign(Object.assign({},w),{id:S.id}));else{this.unsubscribe(),this.state=Dr.errored,e==null||e(Ao.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(Ao.SUBSCRIBED);return}}).receive("error",p=>{this.state=Dr.errored,e==null||e(Ao.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Ao.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this.state===Dr.joined&&e===Nd.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,n,r)}async httpSend(e,n,r={}){var s;if(n==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(s=r.timeout)!==null&&s!==void 0?s:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const u=await a.json();l=u.error||u.message||l}catch{}return Promise.reject(new Error(l))}async send(e,n={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=u.body)===null||s===void 0?void 0:s.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const u=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Dr.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Yi.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new O0(this,Yi.leave,{},e),r.receive("ok",()=>{n(),s("ok")}).receive("timeout",()=>{n(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Dr.closed,this.bindings={}}async _fetchWithTimeout(e,n,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:s.signal}));return clearTimeout(i),o}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new O0(this,e,n,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>vL){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:u,join:d}=Yi;if(r&&[a,l,u,d].indexOf(o)>=0&&r!==this._joinRef())return;let h=this._onMessage(o,n,r);if(n&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(p=>{var m,y,b;return((m=p.filter)===null||m===void 0?void 0:m.event)==="*"||((b=(y=p.filter)===null||y===void 0?void 0:y.event)===null||b===void 0?void 0:b.toLocaleLowerCase())===o}).map(p=>p.callback(h,r)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var m,y,b,g,v,w;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const T=p.id,R=(m=p.filter)===null||m===void 0?void 0:m.event;return T&&((y=n.ids)===null||y===void 0?void 0:y.includes(T))&&(R==="*"||(R==null?void 0:R.toLocaleLowerCase())===((b=n.data)===null||b===void 0?void 0:b.type.toLocaleLowerCase()))}else{const T=(v=(g=p==null?void 0:p.filter)===null||g===void 0?void 0:g.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return T==="*"||T===((w=n==null?void 0:n.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof h=="object"&&"ids"in h){const m=h.data,{schema:y,table:b,commit_timestamp:g,type:v,errors:w}=m;h=Object.assign(Object.assign({},{schema:y,table:b,commit_timestamp:g,eventType:v,new:{},old:{},errors:w}),this._getPayloadRecords(m))}p.callback(h,r)})}_isClosed(){return this.state===Dr.closed}_isJoined(){return this.state===Dr.joined}_isJoining(){return this.state===Dr.joining}_isLeaving(){return this.state===Dr.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const s=e.toLocaleLowerCase(),i={type:s,filter:n,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Uc.isEqual(s.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}static isFilterValueEqual(e,n){return(e??void 0)===(n??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Yi.close,{},e)}_onError(e){this._on(Yi.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Dr.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=HS(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=HS(e.columns,e.old_record)),n}}const P0=()=>{},Nh={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},NL=[1e3,2e3,5e3,1e4],jL=1e4,IL=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ML{constructor(e,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Hx,this.transport=null,this.heartbeatIntervalMs=Nh.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=P0,this.ref=0,this.reconnectTimer=null,this.vsn=US,this.logger=P0,this.conn=null,this.sendBuffer=[],this.serializer=new wL,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>s?(...i)=>s(...i):(...i)=>fetch(...i),!(!((r=n==null?void 0:n.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${Vx.websocket}`,this.httpEndpoint=rI(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=mL.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case pa.connecting:return vl.Connecting;case pa.open:return vl.Open;case pa.closing:return vl.Closing;default:return vl.Closed}}isConnected(){return this.connectionState()===vl.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===r);if(s)return s;{const i=new Uc(`realtime:${e}`,n,this);return this.channels.push(i),i}}push(e){const{topic:n,event:r,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${n} ${r} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(bL,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},Nh.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:s,payload:i,ref:o}=n,a=o?`(${o})`:"",l=i.status||"";this.log("receive",`${l} ${r} ${s} ${a}`.trim(),i),this.channels.filter(u=>u._isMember(r)).forEach(u=>u._trigger(s,i,o)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===pa.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===pa.open||this.conn.readyState===pa.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this._terminateWorker()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Yi.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(n);return`${e}${r}${s}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([IL],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n,r=!1;if(e)n=e,r=!0;else if(this.accessToken)try{n=await this.accessToken()}catch(s){this.log("error","Error fetching access token from callback",s),n=this.accessTokenValue}else n=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(s=>{const i={access_token:n,version:yL};n&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(Yi.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(n=>{this.log("error",`Error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(n)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new tI(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Nh.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,r,s,i,o,a,l,u,d,f,h,p;switch(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:Hx,this.heartbeatIntervalMs=(s=e==null?void 0:e.heartbeatIntervalMs)!==null&&s!==void 0?s:Nh.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e==null?void 0:e.heartbeatCallback)!==null&&a!==void 0?a:P0,this.vsn=(l=e==null?void 0:e.vsn)!==null&&l!==void 0?l:US,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(u=e==null?void 0:e.reconnectAfterMs)!==null&&u!==void 0?u:m=>NL[m-1]||jL,this.vsn){case eI:this.encode=(d=e==null?void 0:e.encode)!==null&&d!==void 0?d:(m,y)=>y(JSON.stringify(m)),this.decode=(f=e==null?void 0:e.decode)!==null&&f!==void 0?f:(m,y)=>y(JSON.parse(m));break;case xL:this.encode=(h=e==null?void 0:e.encode)!==null&&h!==void 0?h:this.serializer.encode.bind(this.serializer),this.decode=(p=e==null?void 0:e.decode)!==null&&p!==void 0?p:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var ff=class extends Error{constructor(t,e){var n;super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((n=e.icebergType)==null?void 0:n.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function DL(t,e,n){const r=new URL(e,t);if(n)for(const[s,i]of Object.entries(n))i!==void 0&&r.searchParams.set(s,i);return r.toString()}async function AL(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function RL(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:n,path:r,query:s,body:i,headers:o}){const a=DL(t.baseUrl,r,s),l=await AL(t.auth),u=await e(a,{method:n,headers:{...i?{"Content-Type":"application/json"}:{},...l,...o},body:i?JSON.stringify(i):void 0}),d=await u.text(),f=(u.headers.get("content-type")||"").includes("application/json"),h=f&&d?JSON.parse(d):d;if(!u.ok){const p=f?h:void 0,m=p==null?void 0:p.error;throw new ff((m==null?void 0:m.message)??`Request failed with status ${u.status}`,{status:u.status,icebergType:m==null?void 0:m.type,icebergCode:m==null?void 0:m.code,details:p})}return{status:u.status,headers:u.headers,data:h}}}}function jh(t){return t.join("")}var OL=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:jh(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(r=>({namespace:r}))}async createNamespace(t,e){const n={namespace:t.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${jh(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${jh(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${jh(t.namespace)}`}),!0}catch(e){if(e instanceof ff&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(n){if(n instanceof ff&&n.status===409)return;throw n}}};function dc(t){return t.join("")}var PL=class{constructor(t,e="",n){this.client=t,this.prefix=e,this.accessDelegation=n}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${dc(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const n={};return this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${dc(t.namespace)}/tables`,body:e,headers:n})).data.metadata}async updateTable(t,e){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${dc(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${dc(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${dc(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${dc(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(n){if(n instanceof ff&&n.status===404)return!1;throw n}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(n){if(n instanceof ff&&n.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw n}}},LL=class{constructor(t){var r;let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const n=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=RL({baseUrl:n,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(r=t.accessDelegation)==null?void 0:r.join(","),this.namespaceOps=new OL(this.client,e),this.tableOps=new PL(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},jg=class extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}};function lr(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var $L=class extends jg{constructor(t,e,n){super(t),this.name="StorageApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Kx=class extends jg{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}};const kv=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),zL=()=>Response,Gx=t=>{if(Array.isArray(t))return t.map(n=>Gx(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const s=n.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=Gx(r)}),e},FL=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},BL=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function hf(t){"@babel/helpers - typeof";return hf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hf(t)}function UL(t,e){if(hf(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(hf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function HL(t){var e=UL(t,"string");return hf(e)=="symbol"?e:e+""}function VL(t,e,n){return(e=HL(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function KS(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function on(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?KS(Object(n),!0).forEach(function(r){VL(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):KS(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const L0=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},WL=async(t,e,n)=>{t instanceof await zL()&&!(n!=null&&n.noResolveJson)?t.json().then(r=>{const s=t.status||500,i=(r==null?void 0:r.statusCode)||s+"";e(new $L(L0(r),s,i))}).catch(r=>{e(new Kx(L0(r),r))}):e(new Kx(L0(t),t))},KL=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?s:(FL(r)?(s.headers=on({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,e!=null&&e.duplex&&(s.duplex=e.duplex),on(on({},s),n))};async function Yf(t,e,n,r,s,i){return new Promise((o,a)=>{t(n,KL(e,r,s,i)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>WL(l,a,r))})}async function pf(t,e,n,r){return Yf(t,"GET",e,n,r)}async function Gi(t,e,n,r,s){return Yf(t,"POST",e,r,s,n)}async function qx(t,e,n,r,s){return Yf(t,"PUT",e,r,s,n)}async function GL(t,e,n,r){return Yf(t,"HEAD",e,on(on({},n),{},{noResolveJson:!0}),r)}async function Sv(t,e,n,r,s){return Yf(t,"DELETE",e,r,s,n)}var qL=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(lr(e))return{data:null,error:e};throw e}}};let sI;sI=Symbol.toStringTag;var YL=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[sI]="BlobDownloadBuilder",this.promise=null}asStream(){return new qL(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(lr(e))return{data:null,error:e};throw e}}};const JL={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},GS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var XL=class{constructor(t,e={},n,r){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.bucketId=n,this.fetch=kv(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(t,e,n,r){var s=this;try{let i;const o=on(on({},GS),r);let a=on(on({},s.headers),t==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",s.encodeMetadata(l)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),l&&!i.has("metadata")&&i.append("metadata",s.encodeMetadata(l))):(i=n,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=s.toBase64(s.encodeMetadata(l))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),r!=null&&r.headers&&(a=on(on({},a),r.headers));const u=s._removeEmptyFolders(e),d=s._getFinalPath(u),f=await(t=="PUT"?qx:Gi)(s.fetch,`${s.url}/object/${d}`,i,on({headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:u,id:f.Id,fullPath:f.Key},error:null}}catch(i){if(s.shouldThrowOnError)throw i;if(lr(i))return{data:null,error:i};throw i}}async upload(t,e,n){return this.uploadOrUpdate("POST",t,e,n)}async uploadToSignedUrl(t,e,n,r){var s=this;const i=s._removeEmptyFolders(t),o=s._getFinalPath(i),a=new URL(s.url+`/object/upload/sign/${o}`);a.searchParams.set("token",e);try{let l;const u=on({upsert:GS.upsert},r),d=on(on({},s.headers),{"x-upsert":String(u.upsert)});return typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",u.cacheControl)):(l=n,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType),{data:{path:i,fullPath:(await qx(s.fetch,a.toString(),l,{headers:d})).Key},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(lr(l))return{data:null,error:l};throw l}}async createSignedUploadUrl(t,e){var n=this;try{let r=n._getFinalPath(t);const s=on({},n.headers);e!=null&&e.upsert&&(s["x-upsert"]="true");const i=await Gi(n.fetch,`${n.url}/object/upload/sign/${r}`,{},{headers:s}),o=new URL(n.url+i.url),a=o.searchParams.get("token");if(!a)throw new jg("No token returned by API");return{data:{signedUrl:o.toString(),path:t,token:a},error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(lr(r))return{data:null,error:r};throw r}}async update(t,e,n){return this.uploadOrUpdate("PUT",t,e,n)}async move(t,e,n){var r=this;try{return{data:await Gi(r.fetch,`${r.url}/object/move`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers}),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(lr(s))return{data:null,error:s};throw s}}async copy(t,e,n){var r=this;try{return{data:{path:(await Gi(r.fetch,`${r.url}/object/copy`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers})).Key},error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(lr(s))return{data:null,error:s};throw s}}async createSignedUrl(t,e,n){var r=this;try{let s=r._getFinalPath(t),i=await Gi(r.fetch,`${r.url}/object/sign/${s}`,on({expiresIn:e},n!=null&&n.transform?{transform:n.transform}:{}),{headers:r.headers});const o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${r.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(lr(s))return{data:null,error:s};throw s}}async createSignedUrls(t,e,n){var r=this;try{const s=await Gi(r.fetch,`${r.url}/object/sign/${r.bucketId}`,{expiresIn:e,paths:t},{headers:r.headers}),i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(o=>on(on({},o),{},{signedUrl:o.signedURL?encodeURI(`${r.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(lr(s))return{data:null,error:s};throw s}}download(t,e){const n=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",r=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),s=r?`?${r}`:"",i=this._getFinalPath(t),o=()=>pf(this.fetch,`${this.url}/${n}/${i}${s}`,{headers:this.headers,noResolveJson:!0});return new YL(o,this.shouldThrowOnError)}async info(t){var e=this;const n=e._getFinalPath(t);try{return{data:Gx(await pf(e.fetch,`${e.url}/object/info/${n}`,{headers:e.headers})),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(lr(r))return{data:null,error:r};throw r}}async exists(t){var e=this;const n=e._getFinalPath(t);try{return await GL(e.fetch,`${e.url}/object/${n}`,{headers:e.headers}),{data:!0,error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(lr(r)&&r instanceof Kx){const s=r.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:r}}throw r}}getPublicUrl(t,e){const n=this._getFinalPath(t),r=[],s=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";s!==""&&r.push(s);const i=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",o=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});o!==""&&r.push(o);let a=r.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${n}${a}`)}}}async remove(t){var e=this;try{return{data:await Sv(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}}async list(t,e,n){var r=this;try{const s=on(on(on({},JL),e),{},{prefix:t||""});return{data:await Gi(r.fetch,`${r.url}/object/list/${r.bucketId}`,s,{headers:r.headers},n),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(lr(s))return{data:null,error:s};throw s}}async listV2(t,e){var n=this;try{const r=on({},t);return{data:await Gi(n.fetch,`${n.url}/object/list-v2/${n.bucketId}`,r,{headers:n.headers},e),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(lr(r))return{data:null,error:r};throw r}}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const iI="2.89.0",oI={"X-Client-Info":`storage-js/${iI}`};var QL=class{constructor(t,e={},n,r){this.shouldThrowOnError=!1;const s=new URL(t);r!=null&&r.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href.replace(/\/$/,""),this.headers=on(on({},oI),e),this.fetch=kv(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(t){var e=this;try{const n=e.listBucketOptionsToQueryString(t);return{data:await pf(e.fetch,`${e.url}/bucket${n}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await pf(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}}async createBucket(t,e={public:!1}){var n=this;try{return{data:await Gi(n.fetch,`${n.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(lr(r))return{data:null,error:r};throw r}}async updateBucket(t,e){var n=this;try{return{data:await qx(n.fetch,`${n.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(lr(r))return{data:null,error:r};throw r}}async emptyBucket(t){var e=this;try{return{data:await Gi(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await Sv(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},ZL=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=on(on({},oI),e),this.fetch=kv(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await Gi(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}}async listBuckets(t){var e=this;try{const n=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&n.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&n.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&n.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&n.set("sortOrder",t.sortOrder),t!=null&&t.search&&n.set("search",t.search);const r=n.toString(),s=r?`${e.url}/bucket?${r}`:`${e.url}/bucket`;return{data:await pf(e.fetch,s,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await Sv(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}}from(t){var e=this;if(!BL(t))throw new jg("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new LL({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(n,{get(s,i){const o=s[i];return typeof o!="function"?o:async(...a)=>{try{return{data:await o.apply(s,a),error:null}}catch(l){if(r)throw l;return{data:null,error:l}}}}})}};const _v={"X-Client-Info":`storage-js/${iI}`,"Content-Type":"application/json"};var aI=class extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Qs(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}var $0=class extends aI{constructor(t,e,n){super(t),this.name="StorageVectorsApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},e$=class extends aI{constructor(t,e){super(t),this.name="StorageVectorsUnknownError",this.originalError=e}};const Tv=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),t$=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},qS=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),n$=async(t,e,n)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const r=t.status||500,s=t;if(typeof s.json=="function")s.json().then(i=>{const o=(i==null?void 0:i.statusCode)||(i==null?void 0:i.code)||r+"";e(new $0(qS(i),r,o))}).catch(()=>{const i=r+"";e(new $0(s.statusText||`HTTP ${r} error`,r,i))});else{const i=r+"";e(new $0(s.statusText||`HTTP ${r} error`,r,i))}}else e(new e$(qS(t),t))},r$=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?s:(t$(r)?(s.headers=on({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,on(on({},s),n))};async function s$(t,e,n,r,s,i){return new Promise((o,a)=>{t(n,r$(e,r,s,i)).then(l=>{if(!l.ok)throw l;if(r!=null&&r.noResolveJson)return l;const u=l.headers.get("content-type");return!u||!u.includes("application/json")?{}:l.json()}).then(l=>o(l)).catch(l=>n$(l,a,r))})}async function Zs(t,e,n,r,s){return s$(t,"POST",e,r,s,n)}var i$=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=on(on({},_v),e),this.fetch=Tv(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(t){var e=this;try{return{data:await Zs(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async getIndex(t,e){var n=this;try{return{data:await Zs(n.fetch,`${n.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(Qs(r))return{data:null,error:r};throw r}}async listIndexes(t){var e=this;try{return{data:await Zs(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async deleteIndex(t,e){var n=this;try{return{data:await Zs(n.fetch,`${n.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers})||{},error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(Qs(r))return{data:null,error:r};throw r}}},o$=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=on(on({},_v),e),this.fetch=Tv(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(t){var e=this;try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await Zs(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async getVectors(t){var e=this;try{return{data:await Zs(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async listVectors(t){var e=this;try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:await Zs(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async queryVectors(t){var e=this;try{return{data:await Zs(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async deleteVectors(t){var e=this;try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await Zs(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}},a$=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=on(on({},_v),e),this.fetch=Tv(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await Zs(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await Zs(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async listBuckets(t={}){var e=this;try{return{data:await Zs(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await Zs(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}},l$=class extends a${constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new c$(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,n=this;return e().call(n,t)}async getBucket(t){var e=()=>super.getBucket,n=this;return e().call(n,t)}async listBuckets(t={}){var e=()=>super.listBuckets,n=this;return e().call(n,t)}async deleteBucket(t){var e=()=>super.deleteBucket,n=this;return e().call(n,t)}},c$=class extends i${constructor(t,e,n,r){super(t,e,r),this.vectorBucketName=n}async createIndex(t){var e=()=>super.createIndex,n=this;return e().call(n,on(on({},t),{},{vectorBucketName:n.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,n=this;return e().call(n,on(on({},t),{},{vectorBucketName:n.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,n=this;return e().call(n,n.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,n=this;return e().call(n,n.vectorBucketName,t)}index(t){return new u$(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},u$=class extends o${constructor(t,e,n,r,s){super(t,e,s),this.vectorBucketName=n,this.indexName=r}async putVectors(t){var e=()=>super.putVectors,n=this;return e().call(n,on(on({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async getVectors(t){var e=()=>super.getVectors,n=this;return e().call(n,on(on({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,n=this;return e().call(n,on(on({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,n=this;return e().call(n,on(on({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,n=this;return e().call(n,on(on({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}},d$=class extends QL{constructor(t,e={},n,r){super(t,e,n,r)}from(t){return new XL(this.url,this.headers,t,this.fetch)}get vectors(){return new l$(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new ZL(this.url+"/iceberg",this.headers,this.fetch)}};const lI="2.89.0",Tc=30*1e3,Yx=3,z0=Yx*Tc,f$="http://localhost:9999",h$="supabase.auth.token",p$={"X-Client-Info":`gotrue-js/${lI}`},Jx="X-Supabase-Api-Version",cI={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},m$=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,g$=10*60*1e3;class mf extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function Qt(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class y$ extends mf{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function x$(t){return Qt(t)&&t.name==="AuthApiError"}class wl extends mf{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class Qo extends mf{constructor(e,n,r,s){super(e,r,s),this.name=n,this.status=r}}class Ys extends Qo{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function b$(t){return Qt(t)&&t.name==="AuthSessionMissingError"}class fc extends Qo{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ih extends Qo{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Mh extends Qo{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function v$(t){return Qt(t)&&t.name==="AuthImplicitGrantRedirectError"}class YS extends Qo{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class w$ extends Qo{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Xx extends Qo{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function F0(t){return Qt(t)&&t.name==="AuthRetryableFetchError"}class JS extends Qo{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class Qx extends Qo{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const sm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),XS=` 	
\r=`.split(""),k$=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<XS.length;e+=1)t[XS[e].charCodeAt(0)]=-2;for(let e=0;e<sm.length;e+=1)t[sm[e].charCodeAt(0)]=e;return t})();function QS(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(sm[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(sm[r]),e.queuedBits-=6}}function uI(t,e,n){const r=k$[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function ZS(t){const e=[],n=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{T$(o,r,n)};for(let o=0;o<t.length;o+=1)uI(t.charCodeAt(o),s,i);return e.join("")}function S$(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function _$(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|s)+65536,n+=1}S$(r,e)}}function T$(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if(!(t>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function su(t){const e=[],n={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<t.length;s+=1)uI(t.charCodeAt(s),n,r);return new Uint8Array(e)}function C$(t){const e=[];return _$(t,n=>e.push(n)),new Uint8Array(e)}function jl(t){const e=[],n={queue:0,queuedBits:0},r=s=>{e.push(s)};return t.forEach(s=>QS(s,n,r)),QS(null,n,r),e.join("")}function E$(t){return Math.round(Date.now()/1e3)+t}function N$(){return Symbol("auth-callback")}const qr=()=>typeof window<"u"&&typeof document<"u",ul={tested:!1,writable:!1},dI=()=>{if(!qr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ul.tested)return ul.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),ul.tested=!0,ul.writable=!0}catch{ul.tested=!0,ul.writable=!1}return ul.writable};function j$(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return n.searchParams.forEach((r,s)=>{e[s]=r}),e}const fI=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),I$=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Cc=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},dl=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Gr=async(t,e)=>{await t.removeItem(e)};class Ig{constructor(){this.promise=new Ig.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}Ig.promiseConstructor=Promise;function B0(t){const e=t.split(".");if(e.length!==3)throw new Qx("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!m$.test(e[r]))throw new Qx("JWT not in base64url format");return{header:JSON.parse(ZS(e[0])),payload:JSON.parse(ZS(e[1])),signature:su(e[2]),raw:{header:e[0],payload:e[1]}}}async function M$(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function D$(t,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await t(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function A$(t){return("0"+t.toString(16)).substr(-2)}function R$(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let s="";for(let i=0;i<56;i++)s+=n.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,A$).join("")}async function O$(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function P$(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await O$(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function hc(t,e,n=!1){const r=R$();let s=r;n&&(s+="/PASSWORD_RECOVERY"),await Cc(t,`${e}-code-verifier`,s);const i=await P$(r);return[i,r===i?"plain":"s256"]}const L$=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function $$(t){const e=t.headers.get(Jx);if(!e||!e.match(L$))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function z$(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function F$(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const B$=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function pc(t){if(!B$.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function U0(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function U$(t,e){return new Proxy(t,{get:(n,r,s)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,s)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,r,s)}})}function e2(t){return JSON.parse(JSON.stringify(t))}const gl=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),H$=[502,503,504];async function t2(t){var e;if(!I$(t))throw new Xx(gl(t),0);if(H$.includes(t.status))throw new Xx(gl(t),t.status);let n;try{n=await t.json()}catch(i){throw new wl(gl(i),i)}let r;const s=$$(t);if(s&&s.getTime()>=cI["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new JS(gl(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Ys}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new JS(gl(n),t.status,n.weak_password.reasons);throw new y$(gl(n),t.status||500,r)}const V$=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),n))};async function sn(t,e,n,r){var s;const i=Object.assign({},r==null?void 0:r.headers);i[Jx]||(i[Jx]=cI["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await W$(t,e,n+a,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function W$(t,e,n,r,s,i){const o=V$(e,r,s,i);let a;try{a=await t(n,Object.assign({},o))}catch(l){throw console.error(l),new Xx(gl(l),0)}if(a.ok||await t2(a),r!=null&&r.noResolveJson)return a;try{return await a.json()}catch(l){await t2(l)}}function Hi(t){var e;let n=null;q$(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=E$(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function n2(t){const e=Hi(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function wa(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function K$(t){return{data:t,error:null}}function G$(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i}=t,o=Ng(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function r2(t){return t}function q$(t){return t.access_token&&t.refresh_token&&t.expires_in}const H0=["global","local","others"];class Y${constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=fI(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=H0[0]){if(H0.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${H0.join(", ")}`);try{return await sn(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Qt(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await sn(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:wa})}catch(r){if(Qt(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=Ng(e,["options"]),s=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await sn(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:G$,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(Qt(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await sn(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:wa})}catch(n){if(Qt(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,s,i,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},d=await sn(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:r2});if(d.error)throw d.error;const f=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(m.split(";")[1].split("=")[1]);u[`${b}Page`]=y}),u.total=parseInt(h)),{data:Object.assign(Object.assign({},f),u),error:null}}catch(u){if(Qt(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){pc(e);try{return await sn(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:wa})}catch(n){if(Qt(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){pc(e);try{return await sn(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:wa})}catch(r){if(Qt(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){pc(e);try{return await sn(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:wa})}catch(r){if(Qt(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){pc(e.userId);try{const{data:n,error:r}=await sn(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:n,error:r}}catch(n){if(Qt(n))return{data:null,error:n};throw n}}async _deleteFactor(e){pc(e.userId),pc(e.id);try{return{data:await sn(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Qt(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,r,s,i,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},d=await sn(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:r2});if(d.error)throw d.error;const f=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(m.split(";")[1].split("=")[1]);u[`${b}Page`]=y}),u.total=parseInt(h)),{data:Object.assign(Object.assign({},f),u),error:null}}catch(u){if(Qt(u))return{data:{clients:[]},error:u};throw u}}async _createOAuthClient(e){try{return await sn(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Qt(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await sn(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Qt(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await sn(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Qt(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await sn(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Qt(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await sn(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Qt(n))return{data:null,error:n};throw n}}}function s2(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const mc={debug:!!(globalThis&&dI()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class hI extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class J$ extends hI{}async function X$(t,e,n){mc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),mc.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){mc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,s.name);try{return await n()}finally{mc.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,s.name)}}else{if(e===0)throw mc.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new J$(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(mc.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function Q$(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function pI(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function Z$(t){return parseInt(t,16)}function e6(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function t6(t){var e;const{chainId:n,domain:r,expirationTime:s,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:l,resources:u,scheme:d,uri:f,version:h}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!f)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const p=pI(t.address),m=d?`${d}://${r}`:r,y=t.statement?`${t.statement}
`:"",b=`${m} wants you to sign in with your Ethereum account:
${p}

${y}`;let g=`URI: ${f}
Version: ${h}
Chain ID: ${n}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(s&&(g+=`
Expiration Time: ${s.toISOString()}`),a&&(g+=`
Not Before: ${a.toISOString()}`),l&&(g+=`
Request ID: ${l}`),u){let v=`
Resources:`;for(const w of u){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);v+=`
- ${w}`}g+=v}return`${b}
${g}`}class _r extends Error{constructor({message:e,code:n,cause:r,name:s}){var i;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(i=s??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=n}}class im extends _r{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function n6({error:t,options:e}){var n,r,s;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new _r({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new _r({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new _r({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new _r({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new _r({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new _r({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new _r({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new _r({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const o=window.location.hostname;if(mI(o)){if(i.rp.id!==o)return new _r({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new _r({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new _r({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new _r({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new _r({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function r6({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new _r({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new _r({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(mI(r)){if(n.rpId!==r)return new _r({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new _r({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new _r({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new _r({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class s6{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const i6=new s6;function o6(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:r}=t,s=Ng(t,["challenge","user","excludeCredentials"]),i=su(e).buffer,o=Object.assign(Object.assign({},n),{id:su(n.id).buffer}),a=Object.assign(Object.assign({},s),{challenge:i,user:o});if(r&&r.length>0){a.excludeCredentials=new Array(r.length);for(let l=0;l<r.length;l++){const u=r[l];a.excludeCredentials[l]=Object.assign(Object.assign({},u),{id:su(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return a}function a6(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,r=Ng(t,["challenge","allowCredentials"]),s=su(e).buffer,i=Object.assign(Object.assign({},r),{challenge:s});if(n&&n.length>0){i.allowCredentials=new Array(n.length);for(let o=0;o<n.length;o++){const a=n[o];i.allowCredentials[o]=Object.assign(Object.assign({},a),{id:su(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return i}function l6(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:jl(new Uint8Array(t.response.attestationObject)),clientDataJSON:jl(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function c6(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,r=t.getClientExtensionResults(),s=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:jl(new Uint8Array(s.authenticatorData)),clientDataJSON:jl(new Uint8Array(s.clientDataJSON)),signature:jl(new Uint8Array(s.signature)),userHandle:s.userHandle?jl(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function mI(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function i2(){var t,e;return!!(qr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function u6(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new im("Browser returned unexpected credential type",e)}:{data:null,error:new im("Empty credential response",e)}}catch(e){return{data:null,error:n6({error:e,options:t})}}}async function d6(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new im("Browser returned unexpected credential type",e)}:{data:null,error:new im("Empty credential response",e)}}catch(e){return{data:null,error:r6({error:e,options:t})}}}const f6={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},h6={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function om(...t){const e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),n=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),r={};for(const s of t)if(s)for(const i in s){const o=s[i];if(o!==void 0)if(Array.isArray(o))r[i]=o;else if(n(o))r[i]=o;else if(e(o)){const a=r[i];e(a)?r[i]=om(a,o):r[i]=om(o)}else r[i]=o}return r}function p6(t,e){return om(f6,t,e||{})}function m6(t,e){return om(h6,t,e||{})}class g6{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:r,signal:s},i){try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!o)return{data:null,error:a};const l=s??i6.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:u}=o.webauthn.credential_options.publicKey;u.name||(u.name=`${u.id}:${r}`),u.displayName||(u.displayName=u.name)}switch(o.webauthn.type){case"create":{const u=p6(o.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:d,error:f}=await u6({publicKey:u,signal:l});return d?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:f}}case"request":{const u=m6(o.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:d,error:f}=await d6(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:u,signal:l}));return d?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:f}}}}catch(o){return Qt(o)?{data:null,error:o}:{data:null,error:new wl("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!n)return{data:null,error:new mf("rpId is required for WebAuthn authentication")};try{if(!i2())return{data:null,error:new wl("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:r},signal:s},{request:i});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:n,rpOrigins:r,credential_response:l.credential_response}})}catch(o){return Qt(o)?{data:null,error:o}:{data:null,error:new wl("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!n)return{data:null,error:new mf("rpId is required for WebAuthn registration")};try{if(!i2())return{data:null,error:new wl("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(d=>{var f;return(f=d.data)===null||f===void 0?void 0:f.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===e&&h.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d==null?void 0:d.id}):void 0),{data:null,error:a};const{data:l,error:u}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:s},{create:i});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:n,rpOrigins:r,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:u}}catch(o){return Qt(o)?{data:null,error:o}:{data:null,error:new wl("Unexpected error in register",o)}}}}Q$();const y6={url:f$,storageKey:h$,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:p$,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function o2(t,e,n){return await n()}const gc={};class gf{get jwks(){var e,n;return(n=(e=gc[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){gc[this.storageKey]=Object.assign(Object.assign({},gc[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=gc[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){gc[this.storageKey]=Object.assign(Object.assign({},gc[this.storageKey]),{cachedAt:e})}constructor(e){var n,r,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},y6),e);if(this.storageKey=i.storageKey,this.instanceID=(n=gf.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,gf.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&qr()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Y$({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=fI(i.fetch),this.lock=i.lock||o2,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:this.persistSession&&qr()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=X$:this.lock=o2,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new g6(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:dI()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=s2(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=s2(this.memoryStorage)),qr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${lI}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},r="none";if(qr()&&(n=j$(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),qr()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:i}=await this._getSessionFromURL(n,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),v$(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Qt(n)?this._returnResult({error:n}):this._returnResult({error:new wl("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,s;try{const i=await sn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:Hi}),{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(i){if(Qt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var n,r,s;try{let i;if("email"in e){const{email:d,password:f,options:h}=e;let p=null,m=null;this.flowType==="pkce"&&([p,m]=await hc(this.storage,this.storageKey)),i=await sn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:d,password:f,data:(n=h==null?void 0:h.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:p,code_challenge_method:m},xform:Hi})}else if("phone"in e){const{phone:d,password:f,options:h}=e;i=await sn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:f,data:(r=h==null?void 0:h.data)!==null&&r!==void 0?r:{},channel:(s=h==null?void 0:h.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:Hi})}else throw new Ih("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return await Gr(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(i){if(await Gr(this.storage,`${this.storageKey}-code-verifier`),Qt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let n;if("email"in e){const{email:i,password:o,options:a}=e;n=await sn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:n2})}else if("phone"in e){const{phone:i,password:o,options:a}=e;n=await sn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:n2})}else throw new Ih("You must provide either an email or phone number and a password");const{data:r,error:s}=n;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!r||!r.session||!r.user){const i=new fc;return this._returnResult({data:{user:null,session:null},error:i})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(n){if(Qt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,r,s,i,o,a,l,u,d,f,h;let p,m;if("message"in e)p=e.message,m=e.signature;else{const{chain:y,wallet:b,statement:g,options:v}=e;let w;if(qr())if(typeof b=="object")w=b;else{const C=window;if("ethereum"in C&&typeof C.ethereum=="object"&&"request"in C.ethereum&&typeof C.ethereum.request=="function")w=C.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!(v!=null&&v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=b}const T=new URL((n=v==null?void 0:v.url)!==null&&n!==void 0?n:window.location.href),R=await w.request({method:"eth_requestAccounts"}).then(C=>C).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!R||R.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const k=pI(R[0]);let M=(r=v==null?void 0:v.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!M){const C=await w.request({method:"eth_chainId"});M=Z$(C)}const S={domain:T.host,address:k,statement:g,uri:T.href,version:"1",chainId:M,nonce:(s=v==null?void 0:v.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(o=(i=v==null?void 0:v.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=v==null?void 0:v.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=v==null?void 0:v.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(u=v==null?void 0:v.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(d=v==null?void 0:v.signInWithEthereum)===null||d===void 0?void 0:d.resources};p=t6(S),m=await w.request({method:"personal_sign",params:[e6(p),k]})}try{const{data:y,error:b}=await sn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:m},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:Hi});if(b)throw b;if(!y||!y.session||!y.user){const g=new fc;return this._returnResult({data:{user:null,session:null},error:g})}return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),this._returnResult({data:Object.assign({},y),error:b})}catch(y){if(Qt(y))return this._returnResult({data:{user:null,session:null},error:y});throw y}}async signInWithSolana(e){var n,r,s,i,o,a,l,u,d,f,h,p;let m,y;if("message"in e)m=e.message,y=e.signature;else{const{chain:b,wallet:g,statement:v,options:w}=e;let T;if(qr())if(typeof g=="object")T=g;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))T=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof g!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");T=g}const R=new URL((n=w==null?void 0:w.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in T&&T.signIn){const k=await T.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:R.host,uri:R.href}),v?{statement:v}:null));let M;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")M=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)M=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in M&&"signature"in M&&(typeof M.signedMessage=="string"||M.signedMessage instanceof Uint8Array)&&M.signature instanceof Uint8Array)m=typeof M.signedMessage=="string"?M.signedMessage:new TextDecoder().decode(M.signedMessage),y=M.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in T)||typeof T.signMessage!="function"||!("publicKey"in T)||typeof T!="object"||!T.publicKey||!("toBase58"in T.publicKey)||typeof T.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${R.host} wants you to sign in with your Solana account:`,T.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${R.href}`,`Issued At: ${(s=(r=w==null?void 0:w.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=w==null?void 0:w.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((a=w==null?void 0:w.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((u=w==null?void 0:w.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((f=(d=w==null?void 0:w.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||f===void 0)&&f.length?["Resources",...w.signInWithSolana.resources.map(M=>`- ${M}`)]:[]].join(`
`);const k=await T.signMessage(new TextEncoder().encode(m),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=k}}try{const{data:b,error:g}=await sn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:jl(y)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Hi});if(g)throw g;if(!b||!b.session||!b.user){const v=new fc;return this._returnResult({data:{user:null,session:null},error:v})}return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),this._returnResult({data:Object.assign({},b),error:g})}catch(b){if(Qt(b))return this._returnResult({data:{user:null,session:null},error:b});throw b}}async _exchangeCodeForSession(e){const n=await dl(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(n??"").split("/");try{if(!r&&this.flowType==="pkce")throw new w$;const{data:i,error:o}=await sn(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Hi});if(await Gr(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const a=new fc;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(await Gr(this.storage,`${this.storageKey}-code-verifier`),Qt(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:n,provider:r,token:s,access_token:i,nonce:o}=e,a=await sn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:Hi}),{data:l,error:u}=a;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!l||!l.session||!l.user){const d=new fc;return this._returnResult({data:{user:null,session:null},error:d})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:u})}catch(n){if(Qt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,r,s,i,o;try{if("email"in e){const{email:a,options:l}=e;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await hc(this.storage,this.storageKey));const{error:f}=await sn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:f})}if("phone"in e){const{phone:a,options:l}=e,{data:u,error:d}=await sn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:d})}throw new Ih("You must provide either an email or phone number.")}catch(a){if(await Gr(this.storage,`${this.storageKey}-code-verifier`),Qt(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var n,r;try{let s,i;"options"in e&&(s=(n=e.options)===null||n===void 0?void 0:n.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await sn(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Hi});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,u=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(s){if(Qt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(e){var n,r,s,i,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await hc(this.storage,this.storageKey));const u=await sn(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:K$});return!((i=u.data)===null||i===void 0)&&i.url&&qr()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(u.data.url),this._returnResult(u)}catch(a){if(await Gr(this.storage,`${this.storageKey}-code-verifier`),Qt(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Ys;const{error:s}=await sn(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(Qt(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:o}=await sn(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:o,error:a}=await sn(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a})}throw new Ih("You must provide either an email or phone number and a type")}catch(n){if(Qt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await dl(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<z0:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const o=await dl(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=U0()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=U$(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const n=await this._acquireLock(-1,async()=>await this._getUser());return n.data.user&&(this.suppressGetSessionWarning=!0),n}async _getUser(e){try{return e?await sn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:wa}):await this._useSession(async n=>{var r,s,i;const{data:o,error:a}=n;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ys}:await sn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:wa})})}catch(n){if(Qt(n))return b$(n)&&(await this._removeSession(),await Gr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new Ys;const o=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await hc(this.storage,this.storageKey));const{data:u,error:d}=await sn(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:wa});if(d)throw d;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(r){if(await Gr(this.storage,`${this.storageKey}-code-verifier`),Qt(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ys;const n=Date.now()/1e3;let r=n,s=!0,i=null;const{payload:o}=B0(e.access_token);if(o.exp&&(r=o.exp,s=r<=n),s){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(n){if(Qt(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:o,error:a}=n;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Ys;const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(Qt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!qr())throw new Mh("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Mh(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new YS("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Mh("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new YS("No code detected.");const{data:v,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const T=new URL(window.location.href);return T.searchParams.delete("code"),window.history.replaceState(window.history.state,"",T.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:u}=e;if(!i||!a||!o||!u)throw new Mh("No session defined in URL");const d=Math.round(Date.now()/1e3),f=parseInt(a);let h=d+f;l&&(h=parseInt(l));const p=h-d;p*1e3<=Tc&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${f}s`);const m=h-f;d-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,h,d):d-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,h,d);const{data:y,error:b}=await this._getUser(i);if(b)throw b;const g={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:f,expires_at:h,refresh_token:o,token_type:u,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:g,redirectType:e.type},error:null})}catch(r){if(Qt(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await dl(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({error:i});const o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(x$(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await Gr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=N$(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,s;try{const{data:{session:i},error:o}=n;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,n={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await hc(this.storage,this.storageKey,!0));try{return await sn(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(i){if(await Gr(this.storage,`${this.storageKey}-code-verifier`),Qt(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:r,error:s}=await this._useSession(async i=>{var o,a,l,u,d;const{data:f,error:h}=i;if(h)throw h;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await sn(this.fetch,"GET",p,{headers:this.headers,jwt:(d=(u=f.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(s)throw s;return qr()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(Qt(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var r;try{const{error:s,data:{session:i}}=n;if(s)throw s;const{options:o,provider:a,token:l,access_token:u,nonce:d}=e,f=await sn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=i==null?void 0:i.access_token)!==null&&r!==void 0?r:void 0,body:{provider:a,id_token:l,access_token:u,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Hi}),{data:h,error:p}=f;return p?this._returnResult({data:{user:null,session:null},error:p}):!h||!h.session||!h.user?this._returnResult({data:{user:null,session:null},error:new fc}):(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:p}))}catch(s){if(await Gr(this.storage,`${this.storageKey}-code-verifier`),Qt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,s;const{data:i,error:o}=n;if(o)throw o;return await sn(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await D$(async s=>(s>0&&await M$(200*Math.pow(2,s-1)),this._debug(n,"refreshing attempt",s),await sn(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Hi})),(s,i)=>{const o=200*Math.pow(2,s);return i&&F0(i)&&Date.now()+o-r<Tc})}catch(r){if(this._debug(n,"error",r),Qt(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),qr()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const s=await dl(this.storage,this.storageKey);if(s&&this.userStorage){let o=await dl(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:s.user},await Cc(this.userStorage,this.storageKey+"-user",o)),s.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:U0()}else if(s&&!s.user&&!s.user){const o=await dl(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(s.user=o.user,await Gr(this.storage,this.storageKey+"-user"),await Cc(this.storage,this.storageKey,s)):s.user=U0()}if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),s!==null&&await this._removeSession();return}const i=((n=s.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<z0;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${z0}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:o}=await this._callRefreshToken(s.refresh_token);o&&(console.error(o),F0(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(s.access_token);!a&&(o!=null&&o.user)?(s.user=o.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(r,"error",s),console.error(s);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Ys;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Ig;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Ys;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={data:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),Qt(i)){const o={data:null,error:i};return F0(i)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,n,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,n)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Gr(this.storage,`${this.storageKey}-code-verifier`);const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await Cc(this.userStorage,this.storageKey+"-user",{user:n.user});const s=Object.assign({},n);delete s.user;const i=e2(s);await Cc(this.storage,this.storageKey,i)}else{const s=e2(n);await Cc(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Gr(this.storage,this.storageKey),await Gr(this.storage,this.storageKey+"-code-verifier"),await Gr(this.storage,this.storageKey+"-user"),this.userStorage&&await Gr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&qr()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Tc);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/Tc);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Tc}ms, refresh threshold is ${Yx} ticks`),s<=Yx&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof hI)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!qr()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const s=[`provider=${encodeURIComponent(n)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await hc(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;return i?this._returnResult({data:null,error:i}):await sn(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,s;const{data:i,error:o}=n;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:u}=await sn(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return u?this._returnResult({data:null,error:u}):(e.factorType==="totp"&&l.type==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?l6(e.webauthn.credential_response):c6(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await sn(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({data:null,error:i});const o=await sn(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:o6(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:a6(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const s={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])s.all.push(i),i.status==="verified"&&s[i.factor_type].push(i);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var e,n;const{data:{session:r},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=B0(r.access_token);let o=null;i.aal&&(o=i.aal);let a=o;((n=(e=r.user.factors)===null||e===void 0?void 0:e.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(a="aal2");const u=i.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:u},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;return s?this._returnResult({data:null,error:s}):r?await sn(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Ys})})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:s},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Ys});const o=await sn(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&qr()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Qt(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:s},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Ys});const o=await sn(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&qr()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Qt(r))return this._returnResult({data:null,error:r});throw r}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;return r?this._returnResult({data:null,error:r}):n?await sn(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new Ys})})}catch(e){if(Qt(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;return s?this._returnResult({data:null,error:s}):r?(await sn(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Ys})})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(a=>a.kid===e);if(r)return r;const s=Date.now();if(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+g$>s)return r;const{data:i,error:o}=await sn(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,r=i.keys.find(a=>a.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:p,error:m}=await this.getSession();if(m||!p.session)return this._returnResult({data:null,error:m});r=p.session.access_token}const{header:s,payload:i,signature:o,raw:{header:a,payload:l}}=B0(r);n!=null&&n.allowExpired||z$(i.exp);const u=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!u){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:i,header:s,signature:o},error:null}}const d=F$(s.alg),f=await crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!await crypto.subtle.verify(d,f,o,C$(`${a}.${l}`)))throw new Qx("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(r){if(Qt(r))return this._returnResult({data:null,error:r});throw r}}}gf.nextInstanceID={};const x6=gf,b6="2.89.0";let dd="";typeof Deno<"u"?dd="deno":typeof document<"u"?dd="web":typeof navigator<"u"&&navigator.product==="ReactNative"?dd="react-native":dd="node";const v6={"X-Client-Info":`supabase-js-${dd}/${b6}`},w6={headers:v6},k6={schema:"public"},S6={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},_6={};function yf(t){"@babel/helpers - typeof";return yf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yf(t)}function T6(t,e){if(yf(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(yf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function C6(t){var e=T6(t,"string");return yf(e)=="symbol"?e:e+""}function E6(t,e,n){return(e=C6(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function pr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?a2(Object(n),!0).forEach(function(r){E6(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a2(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const N6=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),j6=()=>Headers,I6=(t,e,n)=>{const r=N6(n),s=j6();return async(i,o)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:t;let u=new s(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",t),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),r(i,pr(pr({},o),{},{headers:u}))}};function M6(t){return t.endsWith("/")?t:t+"/"}function D6(t,e){var n,r;const{db:s,auth:i,realtime:o,global:a}=t,{db:l,auth:u,realtime:d,global:f}=e,h={db:pr(pr({},l),s),auth:pr(pr({},u),i),realtime:pr(pr({},d),o),storage:{},global:pr(pr(pr({},f),a),{},{headers:pr(pr({},(n=f==null?void 0:f.headers)!==null&&n!==void 0?n:{}),(r=a==null?void 0:a.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return t.accessToken?h.accessToken=t.accessToken:delete h.accessToken,h}function A6(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(M6(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var R6=class extends x6{constructor(t){super(t)}},O6=class{constructor(t,e,n){var r,s;this.supabaseUrl=t,this.supabaseKey=e;const i=A6(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,a={db:k6,realtime:_6,auth:pr(pr({},S6),{},{storageKey:o}),global:w6},l=D6(n??{},a);if(this.storageKey=(r=l.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(s=l.global.headers)!==null&&s!==void 0?s:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(d,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}});else{var u;this.auth=this._initSupabaseAuthClient((u=l.auth)!==null&&u!==void 0?u:{},this.headers,l.global.fetch)}this.fetch=I6(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(pr({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(d=>this.realtime.setAuth(d)).catch(d=>console.warn("Failed to set initial Realtime auth token:",d)),this.rest=new pL(new URL("rest/v1",i).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new d$(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new cL(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,n)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,n;if(t.accessToken)return await t.accessToken();const{data:r}=await t.auth.getSession();return(e=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:s,storageKey:i,flowType:o,lock:a,debug:l,throwOnError:u},d,f){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new R6({url:this.authUrl.href,headers:pr(pr({},h),d),storageKey:i,autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:s,flowType:o,lock:a,debug:l,throwOnError:u,fetch:f,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new ML(this.realtimeUrl.href,pr(pr({},t),{},{params:pr(pr({},{apikey:this.supabaseKey}),t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(t,e,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const P6=(t,e,n)=>new O6(t,e,n);function L6(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}L6()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const gI="https://acrkclmderqewcwugsnl.supabase.co",pp="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFjcmtjbG1kZXJxZXdjd3Vnc25sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNTc0MzAsImV4cCI6MjA4MTgzMzQzMH0.UT2vJTXpPO5tR9sUD8YU0gJ_47Zpe3yJiLzllUljPDw";console.log("Supabase Config:",{url:gI,keyLength:pp==null?void 0:pp.length});let yI=null;try{yI=P6(gI,pp)}catch(t){console.error("Error creating Supabase client:",t)}const ve=yI,xI=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),$6=(t,e)=>{const n=new Date,r=t.toLowerCase().trim();if(/^\d+$/.test(r)){const i=parseInt(r,10);let o=n.getMonth(),a=n.getFullYear();i<n.getDate()&&(o++,o>11&&(o=0,a++));const l=new Date(a,o,i);if(l.getMonth()===o)return l}if(["","today","td"].includes(r))return n;if(["","tmr","tm"].includes(r))return new Date(n.setDate(n.getDate()+1));if([""].includes(r))return new Date(n.setDate(n.getDate()+2));const s=r.match(/^\+(\d+)$/);return s?new Date(n.setDate(n.getDate()+parseInt(s[1]))):null},z6=(t,e="zh")=>t?new Date(t).toLocaleDateString(e==="zh"?"zh-TW":"en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",bI=(t,e=!0,n="zh")=>{if(!t)return"";const r=new Date(t),s=new Date;s.setHours(0,0,0,0);const i=new Date(r.getTime());i.setHours(0,0,0,0);const o=Math.floor((i.getTime()-s.getTime())/(1e3*60*60*24));let a="";if(o===0?a=n==="zh"?"":"Today":o===1?a=n==="zh"?"":"Tomorrow":o===-1?a=n==="zh"?"":"Yesterday":o<0?a=n==="zh"?`${Math.abs(o)} `:`${Math.abs(o)}d ago`:a=n==="zh"?`${r.getMonth()+1}${r.getDate()}`:r.toLocaleDateString("en-US",{month:"short",day:"numeric"}),e){const l=r.getHours(),u=r.getMinutes();(l!==0||u!==0)&&(a+=` ${String(l).padStart(2,"0")}:${String(u).padStart(2,"0")}`)}return a},_i=(t,e)=>t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate(),Cv=t=>t?_i(new Date(t),new Date):!1,Zx=t=>t?new Date(t).getTime()<new Date().setHours(0,0,0,0):!1,Ev=(t,e,n)=>{if(!t)return!1;const r=n.filter(s=>s.parent_id===t);for(const s of r)if(s.id===e||Ev(s.id,e,n))return!0;return!1},F6=t=>{if(!t)return[];const e=/data-type="mention"[^>]*data-id="([^"]+)"/g,n=[];let r;for(;(r=e.exec(t))!==null;)n.push(r[1]);return n},B6=(t,e)=>{var r;return(r=t.tags)!=null&&r.some(s=>e.includes(s))?!0:F6(t.description).some(s=>e.includes(s))},mp=(t,e)=>{let n=t,r=t.parent_id;const s=new Set([t.id]);for(;r&&!s.has(r);){s.add(r);const i=e.find(o=>o.id===r);if(i)n=i,r=i.parent_id;else break}return n},U6=(t,e)=>{const n=new Date(t),r=new Date(n);switch(e.type){case"daily":r.setDate(r.getDate()+e.interval);break;case"weekly":if(e.weekdays&&e.weekdays.length>0){let s=!1;for(let i=1;i<=7*e.interval;i++){const o=new Date(n);if(o.setDate(o.getDate()+i),e.weekdays.includes(o.getDay())){r.setTime(o.getTime()),s=!0;break}}s||r.setDate(r.getDate()+7*e.interval)}else r.setDate(r.getDate()+7*e.interval);break;case"monthly":if(r.setMonth(r.getMonth()+e.interval),e.monthDay){const s=Math.min(e.monthDay,l2(r));r.setDate(s)}break;case"yearly":if(r.setFullYear(r.getFullYear()+e.interval),e.yearMonth!==void 0&&e.yearDay!==void 0){r.setMonth(e.yearMonth-1);const s=Math.min(e.yearDay,l2(r));r.setDate(s)}break}if(e.endDate){const s=new Date(e.endDate);if(r>s)return null}return r.toISOString()},l2=t=>new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),H6=(t,e="zh")=>{if(t.originalText)return t.originalText;const n=t.interval;let r="";if(e==="zh")switch(t.type){case"daily":r=n===1?"":`${n}`;break;case"weekly":r=n===1?"":`${n}`;break;case"monthly":t.monthDay?r=n===1?`${t.monthDay}`:`${n}${t.monthDay}`:r=n===1?"":`${n}`;break;case"yearly":t.yearMonth&&t.yearDay?r=`${t.yearMonth}${t.yearDay}`:r=n===1?"":`${n}`;break}else switch(t.type){case"daily":r=n===1?"Every day":`Every ${n} days`;break;case"weekly":r=n===1?"Every week":`Every ${n} weeks`;break;case"monthly":t.monthDay?r=n===1?`Monthly on day ${t.monthDay}`:`Every ${n} months on day ${t.monthDay}`:r=n===1?"Every month":`Every ${n} months`;break;case"yearly":r=n===1?"Every year":`Every ${n} years`;break}if(t.endDate){const s=new Date(t.endDate).toLocaleDateString(e==="zh"?"zh-TW":"en-US");r+=e==="zh"?` (${s})`:` (until ${s})`}return r},vI=()=>new Promise((t,e)=>{var r;if((r=window.google)!=null&&r.accounts){t();return}document.querySelector('script[src="https://accounts.google.com/gsi/client"]');const n=document.createElement("script");n.src="https://accounts.google.com/gsi/client",n.async=!0,n.defer=!0,n.onload=()=>t(),n.onerror=e,document.body.appendChild(n)}),kl=async t=>{const e=await fetch("https://www.googleapis.com/calendar/v3/users/me/calendarList",{headers:{Authorization:`Bearer ${t}`}});if(!e.ok)throw new Error("Failed to fetch calendar list");return(await e.json()).items||[]},wI=async(t,e,n,r)=>{var u;const s=new Date(n).toISOString(),i=new Date(r),o=new URLSearchParams({timeMin:s,timeMax:i.toISOString(),singleEvents:"true",orderBy:"startTime",maxResults:"2500"}),a=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events?${o}`,{headers:{Authorization:`Bearer ${t}`}}),l=await a.json();if(!a.ok)throw new Error(((u=l.error)==null?void 0:u.message)||"Failed to fetch calendar events");return l.items||[]},e1=async(t,e,n,r)=>{var o,a;let i=0;for(;i<3;){i++;const l=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events/${encodeURIComponent(n)}`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(l.ok)return;if(l.status===403||l.status===429){const f=(((o=(await l.clone().json().catch(()=>({}))).error)==null?void 0:o.message)||"").toLowerCase();if((f.includes("rate limit")||f.includes("quota")||l.status===429)&&i<3){const h=i*1500;console.warn(`[Google Sync] Rate Limit Hit. Retrying update in ${h}ms... (Attempt ${i}/3)`),await new Promise(p=>setTimeout(p,h));continue}}const u=await l.json();throw new Error(((a=u.error)==null?void 0:a.message)||"Failed to update Google event")}},ca=async(t,e,n)=>{var s;const r=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events/${encodeURIComponent(n)}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!r.ok){const i=await r.json();throw new Error(((s=i.error)==null?void 0:s.message)||"Failed to delete Google event")}},Io=async(t,e,n)=>{var i;const r=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){const o=await r.json();throw new Error(((i=o.error)==null?void 0:i.message)||"Failed to create Google event")}return(await r.json()).id},kI=async(t,e,n)=>{let r={singleEvents:"true",maxResults:"2500"};const s=new Date,i=new Date;if(i.setFullYear(s.getFullYear()+2),n)r.syncToken=n;else{const u=new Date;u.setMonth(u.getMonth()-1),r.timeMin=u.toISOString(),r.timeMax=i.toISOString()}let o=[],a,l;try{do{const u=new URLSearchParams({...r,...l?{pageToken:l}:{}}),d=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events?${u}`,{headers:{Authorization:`Bearer ${t}`}});if(d.status===410)return{events:[],fullSyncRequired:!0};if(!d.ok)throw new Error("Sync Request Failed");const f=await d.json();if(f.items){const h=i.getTime(),p=f.items.filter(m=>m.recurringEventId?!1:m.start&&(m.start.dateTime||m.start.date)?new Date(m.start.dateTime||m.start.date).getTime()<h:!0);o.push(...p)}l=f.nextPageToken,a=f.nextSyncToken}while(l);return{events:o,nextSyncToken:a}}catch(u){throw console.error(u),u}},V6=Object.freeze(Object.defineProperty({__proto__:null,createGoogleEvent:Io,deleteGoogleEvent:ca,fetchCalendarList:kl,fetchGoogleEvents:wI,fetchUpdatedGoogleEvents:kI,loadGoogleScript:vI,updateGoogleEvent:e1},Symbol.toStringTag,{value:"Module"})),W6="v1.6.0",gp=28,SI=new Image;SI.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";const Jn={slate:{color:"#64748b",bg:"bg-slate-50",text:"text-slate-600",accent:"text-slate-600",badge:"bg-slate-100 text-slate-600 border-slate-200",border:"border-slate-500",ring:"focus-within:ring-slate-200",buttonRing:"focus:ring-slate-200 focus:border-slate-300",dot:"bg-slate-400",breadcrumb:"bg-slate-50 text-slate-600 hover:bg-slate-100",indicator:"bg-slate-500",ringColor:"ring-slate-400"},gray:{color:"#6b7280",bg:"bg-gray-50",text:"text-gray-600",accent:"text-gray-600",badge:"bg-gray-100 text-gray-600 border-gray-200",border:"border-gray-300",ring:"focus-within:ring-gray-200",buttonRing:"focus:ring-gray-200 focus:border-gray-300",dot:"bg-gray-400",breadcrumb:"bg-gray-50 text-gray-600 hover:bg-gray-100",indicator:"bg-gray-500",ringColor:"ring-gray-400"},zinc:{color:"#71717a",bg:"bg-zinc-50",text:"text-zinc-600",accent:"text-zinc-600",badge:"bg-zinc-100 text-zinc-600 border-zinc-200",border:"border-zinc-500",ring:"focus-within:ring-zinc-200",buttonRing:"focus:ring-zinc-200 focus:border-zinc-300",dot:"bg-zinc-400",breadcrumb:"bg-zinc-50 text-zinc-600 hover:bg-zinc-100",indicator:"bg-zinc-500",ringColor:"ring-zinc-400"},neutral:{color:"#737373",bg:"bg-neutral-50",text:"text-neutral-600",accent:"text-neutral-600",badge:"bg-neutral-100 text-neutral-600 border-neutral-200",border:"border-neutral-500",ring:"focus-within:ring-neutral-200",buttonRing:"focus:ring-neutral-200 focus:border-neutral-300",dot:"bg-neutral-400",breadcrumb:"bg-neutral-50 text-neutral-600 hover:bg-neutral-100",indicator:"bg-neutral-500",ringColor:"ring-neutral-400"},stone:{color:"#78716c",bg:"bg-stone-50",text:"text-stone-600",accent:"text-stone-600",badge:"bg-stone-100 text-stone-600 border-stone-200",border:"border-stone-500",ring:"focus-within:ring-stone-200",buttonRing:"focus:ring-stone-200 focus:border-stone-300",dot:"bg-stone-400",breadcrumb:"bg-stone-50 text-stone-600 hover:bg-stone-100",indicator:"bg-stone-500",ringColor:"ring-stone-400"},red:{color:"#ef4444",bg:"bg-red-50",text:"text-red-600",accent:"text-red-600",badge:"bg-red-100 text-red-600 border-red-200",border:"border-red-500",ring:"focus-within:ring-red-200",buttonRing:"focus:ring-red-200 focus:border-red-300",dot:"bg-red-400",breadcrumb:"bg-red-50 text-red-600 hover:bg-red-100",indicator:"bg-red-500",ringColor:"ring-red-400"},orange:{color:"#f97316",bg:"bg-orange-50",text:"text-orange-600",accent:"text-orange-600",badge:"bg-orange-100 text-orange-600 border-orange-200",border:"border-orange-500",ring:"focus-within:ring-orange-200",buttonRing:"focus:ring-orange-200 focus:border-orange-300",dot:"bg-orange-400",breadcrumb:"bg-orange-50 text-orange-600 hover:bg-orange-100",indicator:"bg-orange-500",ringColor:"ring-orange-400"},amber:{color:"#f59e0b",bg:"bg-amber-50",text:"text-amber-600",accent:"text-amber-600",badge:"bg-amber-100 text-amber-600 border-amber-200",border:"border-amber-500",ring:"focus-within:ring-amber-200",buttonRing:"focus:ring-amber-200 focus:border-amber-300",dot:"bg-amber-400",breadcrumb:"bg-amber-50 text-amber-600 hover:bg-amber-100",indicator:"bg-amber-500",ringColor:"ring-amber-400"},yellow:{color:"#eab308",bg:"bg-yellow-50",text:"text-yellow-600",accent:"text-yellow-600",badge:"bg-yellow-100 text-yellow-600 border-yellow-200",border:"border-yellow-500",ring:"focus-within:ring-yellow-200",buttonRing:"focus:ring-yellow-200 focus:border-yellow-300",dot:"bg-yellow-400",breadcrumb:"bg-yellow-50 text-yellow-600 hover:bg-yellow-100",indicator:"bg-yellow-500",ringColor:"ring-yellow-400"},lime:{color:"#84cc16",bg:"bg-lime-50",text:"text-lime-600",accent:"text-lime-600",badge:"bg-lime-100 text-lime-600 border-lime-200",border:"border-lime-500",ring:"focus-within:ring-lime-200",buttonRing:"focus:ring-lime-200 focus:border-lime-300",dot:"bg-lime-400",breadcrumb:"bg-lime-50 text-lime-600 hover:bg-lime-100",indicator:"bg-lime-500",ringColor:"ring-lime-400"},green:{color:"#10b981",bg:"bg-green-50",text:"text-green-600",accent:"text-green-600",badge:"bg-green-100 text-green-600 border-green-200",border:"border-green-500",ring:"focus-within:ring-green-200",buttonRing:"focus:ring-green-200 focus:border-green-300",dot:"bg-green-400",breadcrumb:"bg-green-50 text-green-600 hover:bg-green-100",indicator:"bg-green-500",ringColor:"ring-green-400"},emerald:{color:"#10b981",bg:"bg-emerald-50",text:"text-emerald-600",accent:"text-emerald-600",badge:"bg-emerald-100 text-emerald-600 border-emerald-200",border:"border-emerald-500",ring:"focus-within:ring-emerald-200",buttonRing:"focus:ring-emerald-200 focus:border-emerald-300",dot:"bg-emerald-400",breadcrumb:"bg-emerald-50 text-emerald-600 hover:bg-emerald-100",indicator:"bg-emerald-500",ringColor:"ring-emerald-400"},teal:{color:"#14b8a6",bg:"bg-teal-50",text:"text-teal-600",accent:"text-teal-600",badge:"bg-teal-100 text-teal-600 border-teal-200",border:"border-teal-500",ring:"focus-within:ring-teal-200",buttonRing:"focus:ring-teal-200 focus:border-teal-300",dot:"bg-teal-400",breadcrumb:"bg-teal-50 text-teal-600 hover:bg-teal-100",indicator:"bg-teal-500",ringColor:"ring-teal-400"},cyan:{color:"#06b6d4",bg:"bg-cyan-50",text:"text-cyan-600",accent:"text-cyan-600",badge:"bg-cyan-100 text-cyan-600 border-cyan-200",border:"border-cyan-500",ring:"focus-within:ring-cyan-200",buttonRing:"focus:ring-cyan-200 focus:border-cyan-300",dot:"bg-cyan-400",breadcrumb:"bg-cyan-50 text-cyan-600 hover:bg-cyan-100",indicator:"bg-cyan-500",ringColor:"ring-cyan-400"},sky:{color:"#0ea5e9",bg:"bg-sky-50",text:"text-sky-600",accent:"text-sky-600",badge:"bg-sky-100 text-sky-600 border-sky-200",border:"border-sky-500",ring:"focus-within:ring-sky-200",buttonRing:"focus:ring-sky-200 focus:border-sky-300",dot:"bg-sky-400",breadcrumb:"bg-sky-50 text-sky-600 hover:bg-sky-100",indicator:"bg-sky-500",ringColor:"ring-sky-400"},blue:{color:"#3b82f6",bg:"bg-blue-50",text:"text-blue-600",accent:"text-blue-600",badge:"bg-blue-100 text-blue-600 border-blue-200",border:"border-blue-500",ring:"focus-within:ring-blue-200",buttonRing:"focus:ring-blue-200 focus:border-blue-300",dot:"bg-blue-400",breadcrumb:"bg-blue-50 text-blue-600 hover:bg-blue-100",indicator:"bg-blue-500",ringColor:"ring-blue-400"},indigo:{color:"#6366f1",bg:"bg-indigo-50",text:"text-indigo-600",accent:"text-indigo-600",badge:"bg-indigo-100 text-indigo-600 border-indigo-200",border:"border-indigo-500",ring:"focus-within:ring-indigo-200",buttonRing:"focus:ring-indigo-200 focus:border-indigo-300",dot:"bg-indigo-400",breadcrumb:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100",indicator:"bg-indigo-500",ringColor:"ring-indigo-400"},violet:{color:"#8b5cf6",bg:"bg-violet-50",text:"text-violet-600",accent:"text-violet-600",badge:"bg-violet-100 text-violet-600 border-violet-200",border:"border-violet-500",ring:"focus-within:ring-violet-200",buttonRing:"focus:ring-violet-200 focus:border-violet-300",dot:"bg-violet-400",breadcrumb:"bg-violet-50 text-violet-600 hover:bg-violet-100",indicator:"bg-violet-500",ringColor:"ring-violet-400"},purple:{color:"#a855f7",bg:"bg-purple-50",text:"text-purple-600",accent:"text-purple-600",badge:"bg-purple-100 text-purple-600 border-purple-200",border:"border-purple-500",ring:"focus-within:ring-purple-200",buttonRing:"focus:ring-purple-200 focus:border-purple-300",dot:"bg-purple-400",breadcrumb:"bg-purple-50 text-purple-600 hover:bg-purple-100",indicator:"bg-purple-500",ringColor:"ring-purple-400"},fuchsia:{color:"#d946ef",bg:"bg-fuchsia-50",text:"text-fuchsia-600",accent:"text-fuchsia-600",badge:"bg-fuchsia-100 text-fuchsia-600 border-fuchsia-200",border:"border-fuchsia-500",ring:"focus-within:ring-fuchsia-200",buttonRing:"focus:ring-fuchsia-200 focus:border-fuchsia-300",dot:"bg-fuchsia-400",breadcrumb:"bg-fuchsia-50 text-fuchsia-600 hover:bg-fuchsia-100",indicator:"bg-fuchsia-500",ringColor:"ring-fuchsia-400"},pink:{color:"#ec4899",bg:"bg-pink-50",text:"text-pink-600",accent:"text-pink-600",badge:"bg-pink-100 text-pink-600 border-pink-200",border:"border-pink-500",ring:"focus-within:ring-pink-200",buttonRing:"focus:ring-pink-200 focus:border-pink-300",dot:"bg-pink-400",breadcrumb:"bg-pink-50 text-pink-600 hover:bg-pink-100",indicator:"bg-pink-500",ringColor:"ring-pink-400"},rose:{color:"#f43f5e",bg:"bg-rose-50",text:"text-rose-600",accent:"text-rose-600",badge:"bg-rose-100 text-rose-600 border-rose-200",border:"border-rose-500",ring:"focus-within:ring-rose-200",buttonRing:"focus:ring-rose-200 focus:border-rose-300",dot:"bg-rose-400",breadcrumb:"bg-rose-50 text-rose-600 hover:bg-rose-100",indicator:"bg-rose-500",ringColor:"ring-rose-400"}},K6={zh:{inbox:"",today:"",upcoming:"",anytime:"",someday:"",logbook:"",trash:"",tags:"",focus:"",journal:"",prompt:"",newTag:"",subTagPlaceholder:"...",tagStyle:"",selectTagColor:"",addSubTag:"",rename:"",deleteTagConfirm:"",deleteTag:"",settings:"",logout:"",emptyTrash:"",emptyTrashConfirm:"",trashEmptyTitle:"",restoreTrash:"",restoreTrashConfirm:"",putBack:"",delete:"",archive:"",notesPlaceholder:"...",addTagPlaceholder:"...",attachFiles:"",aiPolishSuggestions:"AI ",suggestedTitle:" ()",suggestedContent:" ()",aiPolishApplied:" AI ",confirmReplace:"",dateInputPlaceholder:": 5, , ...",identified:"",scheduleTitle:"",noSchedule:"",confirmDate:"",addNotePlaceholder:"...",from:"",addNewTag:"",presentationMode:"",editMode:"",linkAttachments:"",linkedTo:"",noParagraphs:"",clickToLink:"",paragraph:"",noAttachmentsLinked:"",save:"",cancel:"",share:"",aiPolish:"AI ",aiAssistant:"AI ",undo:"",redo:"",dismiss:"",permanentlyDeleted:"",restored:"",appearance:"",fontSize:"",fontWeight:"",fontFamily:"",language:"",timeFormat:"",calendarSettings:"",showLunar:"",showTaiwanHolidays:"",aiSettings:"AI ",provider:"",fontNormal:"",fontThin:"",sizeSmall:"",sizeNormal:"",sizeLarge:"",fontSystem:"",fontThings:"",theme:""},en:{inbox:"Inbox",today:"Today",upcoming:"Upcoming",anytime:"Anytime",someday:"Inspiration",logbook:"Logbook",trash:"Trash",tags:"Tags",focus:"Focus",journal:"Note",prompt:"Prompt",newTag:"New Tag",subTagPlaceholder:"Subtag name...",tagStyle:"Tag Style",selectTagColor:"Select tag color",addSubTag:"Add Subtag",rename:"Rename",deleteTagConfirm:"Are you sure you want to delete this tag?",deleteTag:"Delete Tag",settings:"Settings",logout:"Logout",emptyTrash:"Empty Trash",emptyTrashConfirm:"Are you sure you want to permanently delete all items in the trash? This action is irreversible.",trashEmptyTitle:"Trash",restoreTrash:"Restore All",restoreTrashConfirm:"Are you sure you want to restore all items in the trash?",putBack:"Put Back",delete:"Delete",archive:"Archive",notesPlaceholder:"Notes...",addTagPlaceholder:"Add tag...",attachFiles:"Files",aiPolishSuggestions:"AI Polish Suggestions",suggestedTitle:"Suggested Title (Editable)",suggestedContent:"Suggested Content (Editable)",aiPolishApplied:"AI polish applied",confirmReplace:"Confirm Replace",dateInputPlaceholder:"Type: 5, tomorrow, next Fri...",identified:"Identified",scheduleTitle:"Schedule",noSchedule:"No tasks scheduled",confirmDate:"Confirm Date",addNotePlaceholder:"Add a note...",from:"From",addNewTag:"Add",presentationMode:"Presentation Mode",editMode:"Edit Mode",linkAttachments:"Link Attachments",linkedTo:"Linked to",noParagraphs:"No paragraphs yet",clickToLink:"Click to link attachments",paragraph:"Paragraph",noAttachmentsLinked:"No attachments linked",save:"Save",cancel:"Cancel",share:"Share",aiPolish:"AI Polish",aiAssistant:"AI Assistant",undo:"Undo",redo:"Redo",dismiss:"Dismiss",permanentlyDeleted:"Permanently deleted",restored:"Restored",appearance:"Appearance",fontSize:"Font Size",fontWeight:"Font Weight",fontFamily:"Font Family",language:"Language",timeFormat:"Time Format",calendarSettings:"Calendar Settings",showLunar:"Show Lunar",showTaiwanHolidays:"Show Holidays",aiSettings:"AI Settings",provider:"Provider",fontNormal:"Normal",fontThin:"Thin",sizeSmall:"Small",sizeNormal:"Normal",sizeLarge:"Large",fontSystem:"Default",fontThings:"Thin",theme:"Theme"}},fl=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),En=x.createContext({}),G6=({children:t})=>{const[e,n]=x.useState(null),[r,s]=x.useState([]),[i,o]=x.useState([]),[a,l]=x.useState([]),[u,d]=x.useState(!0),[f,h]=x.useState(null),[p,m]=x.useState("synced"),[y,b]=x.useState(null),[g,v]=x.useState([]),[w,T]=x.useState(null),[R,k]=x.useState(null),[M,S]=x.useState(null),[C,_]=x.useState([]),E=z=>{if(typeof z=="function")S(H=>{const L=z(H);if(L===null)return null;const G=J.current.find(B=>B.id===L);return G!=null&&G.is_locked&&!C.includes(L)?(console.warn("Blocked editing locked task:",L),H):L});else{if(z===null){S(null);return}const H=J.current.find(L=>L.id===z);if(H!=null&&H.is_locked&&!C.includes(z)){console.warn("Blocked editing locked task:",z);return}S(z)}},I=M,P=z=>{_(H=>[...H,z]),setTimeout(()=>{_(H=>H.filter(L=>L!==z))},3e4)},[O,$]=x.useState(()=>{const z=localStorage.getItem(`expanded_tasks_${e==null?void 0:e.id}`);return z?JSON.parse(z):[]}),[A,j]=x.useState({}),[W,V]=x.useState([]),[D,ge]=x.useState(!1),[me,F]=x.useState(!1),[U,ne]=x.useState(()=>{const z=localStorage.getItem("locked_google_tag_ids");return z?JSON.parse(z):[]}),Oe=x.useCallback(z=>{ne(H=>{const G=H.includes(z)?H.filter(B=>B!==z):[...H,z];return localStorage.setItem("locked_google_tag_ids",JSON.stringify(G)),G})},[]),at=x.useCallback(z=>{if(!z.tags||z.tags.length===0)return!1;for(const H of z.tags)if(U.includes(H)){const L=a.find(G=>G.id===H);if(L&&L.name.startsWith("Google:"))return!0}return!1},[U,a]);x.useEffect(()=>{const z=localStorage.getItem("viewTagFilters");if(z)try{const H=JSON.parse(z),L={};Object.keys(H).forEach(G=>{Array.isArray(H[G])?L[G]={include:H[G],exclude:[]}:L[G]=H[G]}),j(L)}catch(H){console.error("Failed to parse viewTagFilters",H)}},[]);const ae=(z,H)=>{j(L=>{const G={...L,[z]:H};return localStorage.setItem("viewTagFilters",JSON.stringify(G)),G})},_e=x.useMemo(()=>{const z={},H=L=>{if(z[L])return z[L];const G=a.find(B=>B.id===L);return G?G.parent_id?G.color==="#6366f1"||!G.color?(z[L]=H(G.parent_id),z[L]):(z[L]=G.color,z[L]):(z[L]=G.color||"#6366f1",z[L]):"#6366f1"};return a.forEach(L=>H(L.id)),z},[a]),[le,Ce]=x.useState(()=>localStorage.getItem(`last_view_${e==null?void 0:e.id}`)||"inbox"),[Le,Ve]=x.useState(null),[st,Be]=x.useState([]),ht=x.useRef([]);ht.current=st;const[vt,te]=x.useState({additionalTags:[],startDate:null,dueDate:null,color:null}),[Z,ie]=x.useState(()=>{const z=localStorage.getItem(`theme_settings_${e==null?void 0:e.id}`),H={fontWeight:"thin",fontSize:"normal",fontFamily:"system",timeFormat:"24h",showLunar:!1,showTaiwanHolidays:!1,language:"zh"};return z?{...H,...JSON.parse(z)}:H}),he=Z.language||"zh",se=z=>{ie(H=>({...H,language:z}))};x.useEffect(()=>{Z.themeMode&&Z.themeMode!=="light"?document.documentElement.setAttribute("data-theme",Z.themeMode):document.documentElement.removeAttribute("data-theme")},[Z.themeMode]),x.useEffect(()=>{const z=Z.fontFamily||"system";document.documentElement.setAttribute("data-font",z)},[Z.fontFamily]);const Q=x.useCallback(z=>K6[he][z]||z,[he]),[ke,Me]=x.useState(null),[fe,Re]=x.useState(null),[qe,xt]=x.useState(()=>{const z=localStorage.getItem(`calendar_current_date_${e==null?void 0:e.id}`);return z?new Date(z):new Date}),[Dt,oe]=x.useState(()=>parseInt(localStorage.getItem(`sidebar_width_${e==null?void 0:e.id}`)||"260")),[Ee,Ue]=x.useState(()=>localStorage.getItem(`sidebar_collapsed_${e==null?void 0:e.id}`)==="true"),[tt,Ne]=x.useState(()=>parseInt(localStorage.getItem(`focus_split_width_${e==null?void 0:e.id}`)||"400")),[pt,dt]=x.useState(!1);x.useEffect(()=>{e!=null&&e.id&&localStorage.setItem(`sidebar_collapsed_${e.id}`,Ee.toString())},[Ee]),x.useEffect(()=>{le==="focus"&&(v([]),k(null))},[le]),x.useEffect(()=>{const z=G=>{const B=/Mac|iPod|iPhone|iPad/.test(navigator.userAgent);(G.ctrlKey||G.metaKey&&!B)&&dt(!0)},H=G=>{const B=/Mac|iPod|iPhone|iPad/.test(navigator.userAgent);!G.ctrlKey&&!(G.metaKey&&!B)&&dt(!1)},L=()=>dt(!1);return window.addEventListener("keydown",z),window.addEventListener("keyup",H),window.addEventListener("blur",L),()=>{window.removeEventListener("keydown",z),window.removeEventListener("keyup",H),window.removeEventListener("blur",L)}},[]),x.useEffect(()=>{e!=null&&e.id&&localStorage.setItem(`calendar_current_date_${e.id}`,qe.toISOString())},[qe]),x.useEffect(()=>{if(e!=null&&e.id){const z=localStorage.getItem(`focus_split_width_${e.id}`);z&&Ne(parseInt(z))}},[e==null?void 0:e.id]),x.useEffect(()=>{e!=null&&e.id&&localStorage.setItem(`focus_split_width_${e.id}`,tt.toString())},[tt,e==null?void 0:e.id]),x.useEffect(()=>{e&&console.warn("[AppContext] Current User ID:",e.id,"Email:",e.email)},[e]);const Et=x.useMemo(()=>{const z={};return r.forEach(H=>{if(H.status==="deleted"||H.status==="logged")return;const L=H.start_date||H.due_date;if(L){const G=L.split("T")[0];z[G]=(z[G]||0)+1}}),z},[r]),[ue,Se]=x.useState(()=>{const z=localStorage.getItem(`expanded_tags_${e==null?void 0:e.id}`);return z?JSON.parse(z):[]}),[nt,ft]=x.useState([]),[ct,Qe]=x.useState([]),[It,Lt]=x.useState([]),J=x.useRef([]),[ye,Ge]=x.useState({isDragging:!1,draggedId:null,originalDepth:0,dragOffsetX:0,dropIndex:null,dropDepth:0,indicatorTop:0,indicatorLeft:0,indicatorWidth:0,ghostPosition:{x:0,y:0},anchorTaskIndex:null}),kt=x.useRef({}),Y=x.useRef(null),ze=x.useRef(null);x.useEffect(()=>{if(!ve){h("Supabase client not initialized"),d(!1);return}(async()=>{try{let L=localStorage.getItem("gtd_user_id");(!L||!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(L))&&(console.warn("Invalid or missing User ID, resetting to default."),L="00000000-0000-0000-0000-000000000000",localStorage.setItem("gtd_user_id",L));let B;if(ve){const{data:{session:q},error:pe}=await ve.auth.getSession();if(pe)throw pe;B=(q==null?void 0:q.user)||{id:L},n(B)}else B={id:L},n(B);if(B!=null&&B.id){const q=localStorage.getItem(`expanded_tasks_${B.id}`);q&&$(JSON.parse(q));const pe=localStorage.getItem(`last_view_${B.id}`);pe&&Ce(pe);const De=localStorage.getItem(`sidebar_width_${B.id}`);De&&oe(parseInt(De));const We=localStorage.getItem(`expanded_tags_${B.id}`);We&&Se(JSON.parse(We));const Je=localStorage.getItem(`theme_settings_${B.id}`);Je&&ie(JSON.parse(Je))}}catch(L){console.error("Initialization error:",L),h(L.message||"Failed to initialize app"),d(!1)}})();const{data:H}=(ve==null?void 0:ve.auth.onAuthStateChange(async(L,G)=>{L==="SIGNED_IN"?n(G==null?void 0:G.user):L==="SIGNED_OUT"&&n(null)}))||{data:{subscription:{unsubscribe:()=>{}}}};return()=>{H.subscription.unsubscribe()}},[]),x.useEffect(()=>{J.current=r},[r]),x.useEffect(()=>{if(!e||!ve)return;(async()=>{try{if(ve){let G=[],B=0;const q=1e3;let pe=!0;for(;pe;){const{data:Te,error:$e}=await ve.from("tasks").select("*").eq("user_id",e.id).order("order_index",{ascending:!0}).order("created_at",{ascending:!0}).range(B,B+q-1);if($e){console.error("[Debug] Fetch Error:",$e);break}Te&&Te.length>0?(G=[...G,...Te],Te.length<q?pe=!1:B+=q):pe=!1}const De=G,{data:We,error:Je}=await ve.from("tags").select("*").eq("user_id",e.id);Je&&console.error("Tags fetch error:",Je);const ot=(We||[]).sort((Te,$e)=>(Te.order_index||0)-($e.order_index||0));if(l(ot||[]),De){const Te=De.map($e=>({...$e,parent_id:$e.parent_id||null,tags:$e.tags||[],images:$e.images||[],attachments:$e.attachments||[],attachment_links:$e.attachment_links||[],view_orders:$e.view_orders||{}}));s(Te),J.current=Te}const{data:Ct,error:ut}=await ve.from("archived_tasks").select("*").eq("user_id",e.id).order("archived_at",{ascending:!1});if(ut)console.warn("Failed to fetch archived tasks (table may not exist yet):",ut);else if(Ct){const Te=Ct.map($e=>({...$e,parent_id:$e.parent_id||null,original_parent_id:$e.original_parent_id||null,tags:$e.tags||[],images:$e.images||[],attachments:$e.attachments||[],view_orders:$e.view_orders||{},is_all_day:!0,start_time:null,end_time:null,duration:null}));o(Te)}const{data:bt,error:Xe}=await ve.from("search_history").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(50);Xe?console.warn("Failed to fetch search history (table may not exist yet):",Xe):bt&&V(bt)}}catch(G){console.error("Error fetching data:",G)}finally{d(!1)}})();const H=ve.channel("tasks_changes").on("postgres_changes",{event:"*",schema:"public",table:"tasks",filter:`user_id=eq.${e.id}`},G=>{if(!(G.new&&kt.current[G.new.id]&&Date.now()-kt.current[G.new.id]<2e3))if(G.eventType==="INSERT"){const B={...G.new,parent_id:G.new.parent_id||null,tags:G.new.tags||[],images:G.new.images||[],attachments:G.new.attachments||[],attachment_links:G.new.attachment_links||[],view_orders:G.new.view_orders||{}};s(q=>{if(q.some(De=>De.id===B.id))return q;const pe=[B,...q].sort((De,We)=>(De.order_index||0)-(We.order_index||0)||De.created_at.localeCompare(We.created_at));return J.current=pe,pe})}else if(G.eventType==="UPDATE"){const B={...G.new,tags:G.new.tags||[],images:G.new.images||[],attachments:G.new.attachments||[],attachment_links:G.new.attachment_links||[],view_orders:G.new.view_orders||{}};s(q=>{const pe=q.map(De=>De.id===B.id?B:De).sort((De,We)=>(De.order_index||0)-(We.order_index||0)||De.created_at.localeCompare(We.created_at));return J.current=pe,pe})}else G.eventType==="DELETE"&&s(B=>{const q=B.filter(pe=>pe.id!==G.old.id);return J.current=q,q})}).subscribe(),L=ve.channel("tags_changes").on("postgres_changes",{event:"*",schema:"public",table:"tags",filter:`user_id=eq.${e.id}`},G=>{G.eventType==="INSERT"?l(B=>B.some(q=>q.id===G.new.id)?B:[...B,G.new]):G.eventType==="DELETE"&&l(B=>B.filter(q=>q.id!==G.old.id))}).subscribe();return()=>{H.unsubscribe(),L.unsubscribe()}},[e]);const lt=z=>{console.error(z),m("error"),b({msg:`Sync Failed: ${z.message||"Unknown error"}`,type:"error"})},X=z=>{kt.current[z]=Date.now()};x.useEffect(()=>{if(!e||!ve)return;const z=async H=>{const L=H.detail;if(!L||!L.taskId||!L.file)return;const G=L.taskId,B=L.file,q=L.markers||[],pe=L.recordingId,De=J.current.find(We=>We.id===G);if(!De){console.warn("[AppContext] Task not found for recording:",G),b({msg:"",type:"error"});return}try{const We=`${Date.now()}_${fl()}.${B.name.split(".").pop()}`,ot=`${(e==null?void 0:e.id)||"anonymous"}/${We}`,{error:Ct}=await ve.storage.from("attachments").upload(ot,B,{contentType:B.type,upsert:!1});if(Ct){console.error("Upload voice error:",Ct),b({msg:"",type:"error"});return}const{data:ut}=ve.storage.from("attachments").getPublicUrl(ot);if(ut){const bt={name:B.name,url:ut.publicUrl,size:B.size,type:B.type,markers:q,recordingId:pe},Te=[...De.attachments||[],bt];X(G),s(be=>{const Ie=be.map(Ke=>Ke.id===G?{...Ke,attachments:Te}:Ke);return J.current=Ie,Ie});const{error:$e}=await ve.from("tasks").update({attachments:Te}).eq("id",G);if($e)console.error("Failed to update task attachments:",$e),b({msg:"",type:"error"});else{window.dispatchEvent(new CustomEvent("recording-saved",{detail:{taskId:G,attachment:bt}}));const be=G;b({msg:"",type:"info",onClick:()=>{window.dispatchEvent(new CustomEvent("navigate-to-task",{detail:{taskId:be,openForEdit:!0}}))},actionLabel:""})}}}catch(We){console.error("[AppContext] Error saving recording:",We),b({msg:"",type:"error"})}};return window.addEventListener("audio-recording-completed",z),()=>window.removeEventListener("audio-recording-completed",z)},[e]);const Fe=async z=>{const H=new Date,L=[];for(let pe=1;pe<=10;pe++){const De=new Date(H);De.setDate(H.getDate()+pe),De.setHours(0,0,0,0);const We=r.filter(Je=>{if(!Je.start_date)return!1;const ot=new Date(Je.start_date);return _i(ot,De)&&!Je.completed_at}).length;L.push({date:De,count:We})}const G=Math.min(...L.map(pe=>pe.count)),B=L.filter(pe=>pe.count===G),q=B[Math.floor(Math.random()*B.length)];await jn(z,{start_date:q.date.toISOString()}),b({msg:` ${q.date.getMonth()+1}/${q.date.getDate()} (: ${q.count})`,type:"info"})},je=z=>{const H=[z],L=G=>{r.filter(q=>q.parent_id===G).forEach(q=>{H.push(q.id),L(q.id)})};return L(z),H},He=async(z,H)=>{if(!ve)return;const L=je(z);s(B=>{const q=B.map(pe=>pe.id===z?{...pe,is_locked:!0,lock_password:H}:L.includes(pe.id)?{...pe,is_locked:!0,lock_password:void 0}:pe);return J.current=q,q}),await ve.from("tasks").update({is_locked:!0,lock_password:H}).eq("id",z);const G=L.filter(B=>B!==z);if(G.length>0)for(const B of G)await ve.from("tasks").update({is_locked:!0,lock_password:null}).eq("id",B);b({msg:` ${L.length-1} `,type:"info"})},Ye=async(z,H)=>{if(!ve)return!1;const L=r.find(pe=>pe.id===z);if(!L||!L.is_locked)return!0;let G=L,B=L;for(;B.parent_id;){const pe=r.find(De=>De.id===B.parent_id);if(pe&&pe.is_locked&&pe.lock_password&&(G=pe),!pe)break;B=pe}if(G.lock_password!==H)return b({msg:"",type:"error"}),!1;const q=je(z);s(pe=>{const De=pe.map(We=>q.includes(We.id)?{...We,is_locked:!1,lock_password:void 0}:We);return J.current=De,De});for(const pe of q)await ve.from("tasks").update({is_locked:!1,lock_password:null}).eq("id",pe);return b({msg:"",type:"info"}),!0},ee=(z,H)=>{const L=r.find(q=>q.id===z);if(!L||!L.is_locked)return!0;let G=L,B=L;for(;B.parent_id;){const q=r.find(pe=>pe.id===B.parent_id);if(q&&q.is_locked&&q.lock_password&&(G=q),!q)break;B=q}return G.lock_password===H},xe=async()=>{const z=r.filter(G=>!!G.completed_at&&G.status!=="logged"&&G.status!=="deleted");if(z.length===0)return;const H=z.map(G=>G.id),L=z.map(G=>({...G,status:"logged",original_parent_id:G.parent_id,archived_at:new Date().toISOString()}));if(s(G=>{const B=G.filter(q=>!H.includes(q.id));return J.current=B,B}),o(G=>[...G,...L]),ve){const{error:G}=await ve.from("archived_tasks").insert(L.map(q=>({id:q.id,user_id:q.user_id,title:q.title,description:q.description,status:q.status,original_parent_id:q.original_parent_id,parent_id:q.parent_id,is_project:q.is_project,order_index:q.order_index,view_orders:q.view_orders,tags:q.tags,color:q.color,start_date:q.start_date,due_date:q.due_date,completed_at:q.completed_at,reviewed_at:q.reviewed_at,images:q.images,attachments:q.attachments,created_at:q.created_at,archived_at:q.archived_at})));if(G){lt(G);return}const{error:B}=await ve.from("tasks").delete().in("id",H);B&&lt(B)}yn({type:"ARCHIVE",payload:{originalTasks:z,archivedRecords:L}}),b({msg:` ${H.length} `,type:"info",undo:_n})},Pe=async z=>{const H=i.find(B=>B.id===z);if(!H)return;let L=H.original_parent_id;L&&(r.find(q=>q.id===L)||(L=null));const G={id:H.id,user_id:H.user_id,title:H.title,description:H.description,status:"completed",parent_id:L,is_project:H.is_project,order_index:H.order_index,view_orders:H.view_orders,tags:H.tags,color:H.color,start_date:H.start_date,due_date:H.due_date,completed_at:H.completed_at,reviewed_at:H.reviewed_at,images:H.images,attachments:H.attachments,created_at:H.created_at,is_all_day:!0,start_time:null,end_time:null,duration:null};if(o(B=>B.filter(q=>q.id!==z)),s(B=>{const q=[...B,G];return J.current=q,q}),ve){const{error:B}=await ve.from("tasks").insert({id:G.id,user_id:G.user_id,title:G.title,description:G.description,status:G.status,parent_id:G.parent_id,is_project:G.is_project,order_index:G.order_index,view_orders:G.view_orders,tags:G.tags,color:G.color,start_date:G.start_date,due_date:G.due_date,completed_at:G.completed_at,reviewed_at:G.reviewed_at,images:G.images,created_at:G.created_at});if(B){lt(B);return}const{error:q}=await ve.from("archived_tasks").delete().eq("id",z);q&&lt(q)}b({msg:"",type:"info"})},et=async z=>{if(i.find(L=>L.id===z)){if(o(L=>L.filter(G=>G.id!==z)),ve){const{error:L}=await ve.from("archived_tasks").delete().eq("id",z);L&&lt(L)}b({msg:"",type:"info"})}},_t=async(z,H)=>{const L=i.find(B=>B.id===z);if(!L)return;const G={...L,...H};if(o(B=>B.map(q=>q.id===z?G:q)),ve){const{error:B}=await ve.from("archived_tasks").update(H).eq("id",z);B&&lt(B)}},Vt=async z=>{if(z.length!==0){if(o(H=>H.filter(L=>!z.includes(L.id))),ve){const{error:H}=await ve.from("archived_tasks").delete().in("id",z);H&&lt(H)}b({msg:` ${z.length} `,type:"info"})}},Ft=async(z,H,L)=>{if(!ve||!e)return;const G={id:fl(),user_id:e.id,query:z,filters:H,name:L||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};V(q=>[G,...q].slice(0,50));const{error:B}=await ve.from("search_history").insert({id:G.id,user_id:G.user_id,query:G.query,filters:G.filters,name:G.name,created_at:G.created_at,updated_at:G.updated_at});B&&console.warn("Failed to save search history:",B)},nn=async z=>{if(!ve)return;V(L=>L.filter(G=>G.id!==z));const{error:H}=await ve.from("search_history").delete().eq("id",z);H&&console.warn("Failed to delete search history:",H)},Xt=async()=>{Jt(),m("syncing");const z=[...r];if(s([]),J.current=[],ft([]),Qe([]),ve){const{error:H}=await ve.from("tasks").delete().neq("id","00000000-0000-0000-0000-000000000000");if(H){lt(H),s(z);return}}m("synced"),b({msg:"",type:"info"})},Jt=()=>{const z={tasks:r,tags:a,user_id:e.id,version:1,exported_at:new Date().toISOString()},H=new Blob([JSON.stringify(z,null,2)],{type:"application/json"}),L=URL.createObjectURL(H),G=document.createElement("a");G.href=L,G.download=`things-clone-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(G),G.click(),document.body.removeChild(G),URL.revokeObjectURL(L),b({msg:"",type:"info"})},fn=async z=>{if(!ve)return;const H=new FileReader;H.onload=async L=>{var G;try{const B=(G=L.target)==null?void 0:G.result,q=JSON.parse(B);if(!q.tasks||!q.tags)throw new Error("");if(m("syncing"),q.tags.length>0){const{error:pe}=await ve.from("tags").upsert(q.tags.map(De=>({...De,user_id:e.id})));if(pe)throw pe}if(q.tasks.length>0){const{error:pe}=await ve.from("tasks").upsert(q.tasks.map(De=>({...De,user_id:e.id})));if(pe)throw pe}b({msg:"...",type:"info"}),setTimeout(()=>window.location.reload(),1e3)}catch(B){lt(B)}},H.readAsText(z)},yn=z=>{ft(H=>[...H,z]),Qe([])},_n=async()=>{if(nt.length===0)return;const z=nt[nt.length-1];if(ft(nt.slice(0,-1)),Qe(H=>[...H,z]),z.type==="ADD"){const H=z.payload.data.id;X(H),s(L=>L.filter(G=>G.id!==H)),ve&&await ve.from("tasks").delete().eq("id",H)}else if(z.type==="DELETE"){const H=z.payload.data;X(H.id),s(L=>[...L,H].sort((G,B)=>(G.order_index||0)-(B.order_index||0)||G.created_at.localeCompare(B.created_at))),ve&&await ve.from("tasks").insert([H])}else if(z.type==="UPDATE"){const{id:H,before:L}=z.payload;await jn(H,L,[],{skipHistory:!0})}else if(z.type==="BATCH_UPDATE"){const L=z.payload.map(G=>({id:G.id,data:G.before}));await Pi(L,{skipHistory:!0})}else if(z.type==="ADD_TAG"){const H=z.payload.data.id;l(L=>L.filter(G=>G.id!==H)),ve&&await ve.from("tags").delete().eq("id",H)}else if(z.type==="DELETE_TAG"){const H=z.payload.data;l(L=>[...L,H].sort((G,B)=>(G.order_index||0)-(B.order_index||0))),ve&&await ve.from("tags").insert([H])}else if(z.type==="UPDATE_TAG"){const{id:H,before:L}=z.payload;l(G=>G.map(B=>B.id===H?{...B,...L}:B).sort((B,q)=>(B.order_index||0)-(q.order_index||0))),ve&&await ve.from("tags").update(L).eq("id",H)}else if(z.type==="ARCHIVE"){const{originalTasks:H,archivedRecords:L}=z.payload,G=L.map(B=>B.id);o(B=>B.filter(q=>!G.includes(q.id))),s(B=>{const q=[...B,...H].sort((pe,De)=>(pe.order_index||0)-(De.order_index||0)||pe.created_at.localeCompare(De.created_at));return J.current=q,q}),ve&&(await ve.from("archived_tasks").delete().in("id",G),await ve.from("tasks").insert(H))}else if(z.type==="BATCH_DELETE"){const H=z.payload.data;s(L=>[...L,...H].sort((G,B)=>(G.order_index||0)-(B.order_index||0)||G.created_at.localeCompare(B.created_at))),ve&&await ve.from("tasks").insert(H)}b({msg:"",type:"info"})},Fn=async()=>{if(ct.length===0)return;const z=ct[ct.length-1];if(Qe(ct.slice(0,-1)),ft(H=>[...H,z]),z.type==="ADD"){const H=z.payload.data;X(H.id),s(L=>[...L,H].sort((G,B)=>(G.order_index||0)-(B.order_index||0)||G.created_at.localeCompare(B.created_at))),ve&&await ve.from("tasks").insert([H])}else if(z.type==="DELETE"){const H=z.payload.data.id;X(H),s(L=>L.filter(G=>G.id!==H)),ve&&await ve.from("tasks").delete().eq("id",H)}else if(z.type==="UPDATE"){const{id:H,after:L}=z.payload;await jn(H,L,[],{skipHistory:!0})}else if(z.type==="BATCH_UPDATE"){const L=z.payload.map(G=>({id:G.id,data:G.after}));await Pi(L,{skipHistory:!0})}else if(z.type==="ADD_TAG"){const H=z.payload.data;l(L=>[...L,H].sort((G,B)=>(G.order_index||0)-(B.order_index||0))),ve&&await ve.from("tags").insert([H])}else if(z.type==="DELETE_TAG"){const H=z.payload.data.id;l(L=>L.filter(G=>G.id!==H)),ve&&await ve.from("tags").delete().eq("id",H)}else if(z.type==="UPDATE_TAG"){const{id:H,after:L}=z.payload;l(G=>G.map(B=>B.id===H?{...B,...L}:B).sort((B,q)=>(B.order_index||0)-(q.order_index||0))),ve&&await ve.from("tags").update(L).eq("id",H)}else if(z.type==="ARCHIVE"){const{originalTasks:H,archivedRecords:L}=z.payload,G=H.map(B=>B.id);s(B=>{const q=B.filter(pe=>!G.includes(pe.id));return J.current=q,q}),o(B=>[...B,...L]),ve&&(await ve.from("archived_tasks").insert(L.map(B=>({id:B.id,user_id:B.user_id,title:B.title,description:B.description,status:B.status,original_parent_id:B.original_parent_id,parent_id:B.parent_id,is_project:B.is_project,order_index:B.order_index,view_orders:B.view_orders,tags:B.tags,color:B.color,start_date:B.start_date,due_date:B.due_date,completed_at:B.completed_at,reviewed_at:B.reviewed_at,images:B.images,attachments:B.attachments,created_at:B.created_at,archived_at:B.archived_at}))),await ve.from("tasks").delete().in("id",G))}else if(z.type==="BATCH_DELETE"){const L=z.payload.data.map(G=>G.id);s(G=>G.filter(B=>!L.includes(B.id))),ve&&await ve.from("tasks").delete().in("id",L)}b({msg:"",type:"info"})},Hn=async()=>{if(!ve)return;const{error:z}=await ve.auth.signOut();z?lt(z):b({msg:"",type:"info"})};x.useEffect(()=>{const z=H=>{I||(H.metaKey||H.ctrlKey)&&H.key==="z"&&(H.preventDefault(),H.shiftKey?Fn():_n())};return window.addEventListener("keydown",z),()=>window.removeEventListener("keydown",z)},[nt,ct,r,I]);const is=(z,H=!1,L)=>{const G=r.find(bt=>bt.id===z);if(!G)return;const B=bt=>a.find(Xe=>bt.some(Te=>Xe.name.trim().toLowerCase()===Te.toLowerCase())),q=B(["note","journal","",""]),pe=B(["prompt",""]),De=q,We=B(["someday","inspiration","","/"]),Je=B(["project",""]),ot=B(["schedule",""]);let Ct=L||"inbox";L||(q&&G.tags.includes(q.id)?Ct="journal":pe&&G.tags.includes(pe.id)?Ct="prompt":De&&G.tags.includes(De.id)?Ct="journal":We&&G.tags.includes(We.id)?Ct="waiting":Je&&G.tags.includes(Je.id)?r.some(Xe=>Xe.parent_id===z&&Xe.status!=="deleted")&&(Ct="projects"):ot&&G.tags.includes(ot.id)?Ct="focus":(G.start_date||G.due_date)&&(Ct="today")),Lt(bt=>[...bt,{view:le,focusedId:R,editingId:I,searchOpen:D}]),Ce(Ct),k(z);let ut=r.find(bt=>bt.id===z);for(;ut&&ut.parent_id;)O.includes(ut.parent_id)||rn(ut.parent_id,!0),ut=r.find(bt=>bt.id===(ut==null?void 0:ut.parent_id));H&&setTimeout(()=>E(z),100)},Gs=()=>{if(It.length===0)return;const z=It[It.length-1];Lt(L=>L.slice(0,-1)),Ce(z.view),k(z.focusedId);const H=z.editingId||z.focusedId;H&&setTimeout(()=>E(H),150),z.searchOpen!==void 0&&ge(z.searchOpen)};x.useEffect(()=>{const z=H=>{const L=H.detail;L!=null&&L.taskId&&is(L.taskId,L.openForEdit||!1)};return window.addEventListener("navigate-to-task",z),()=>window.removeEventListener("navigate-to-task",z)},[r,a,le,R,O]);const ui=x.useCallback((z,H,L,G,B,q)=>{var Tt;if(Z.showImportedGoogleEvents===!1){const Ze=a.filter(re=>re.name.startsWith("Google:")).map(re=>re.id);Ze.length>0&&(z=z.filter(re=>!re.tags.some(Ae=>Ze.includes(Ae))))}const pe=Ze=>{var re;return(re=a.find(Ae=>Ze.some(it=>Ae.name.trim().toLowerCase()===it.toLowerCase())))==null?void 0:re.id},De=pe(["prompt",""]),We=pe(["journal","note","",""]),Je=pe(["someday","inspiration","","/"]),ot=pe(["project",""]),Ct=(Tt=a.find(Ze=>Ze.name==="#prompt"))==null?void 0:Tt.id,ut=pe(["schedule",""]),bt=pe(["annual","annualplan","",""]);if(H==="schedule")return z.filter(Ze=>(!!Ze.due_date||!!Ze.start_date)&&Ze.status!=="deleted"&&Ze.status!=="logged").sort((Ze,re)=>{const Ae=new Date(Ze.start_date||Ze.due_date||0).getTime(),it=new Date(re.start_date||re.due_date||0).getTime();return Ae-it}).map((Ze,re)=>({data:Ze,depth:0,hasChildren:!1,isExpanded:!1,path:[],index:re}));if(H==="recent")return z.filter(Ze=>Ze.status!=="deleted").sort((Ze,re)=>{const Ae=new Date(Ze.updated_at||Ze.created_at||0).getTime();return new Date(re.updated_at||re.created_at||0).getTime()-Ae}).slice(0,100).map((Ze,re)=>({data:Ze,depth:0,hasChildren:!1,isExpanded:!1,path:[],index:re}));const Te=(()=>{if(L){const Ze=Ae=>{const it=a.filter(rt=>rt.parent_id===Ae);return[Ae,...it.flatMap(rt=>Ze(rt.id))]},re=Ze(L);return Ae=>{if(!B6(Ae,re))return!1;const it=q[L]||{include:[],exclude:[]},{include:rt,exclude:St}=Array.isArray(it)?{include:it,exclude:[]}:it;return rt.length>0&&!Ae.tags.some(zt=>rt.includes(zt))||St.length>0&&Ae.tags.some(zt=>St.includes(zt))||B.additionalTags.length>0&&!B.additionalTags.every(zt=>{var Bt;return(Bt=Ae.tags)==null?void 0:Bt.includes(zt)})||B.color&&Ae.color!==B.color||B.startDate&&(!Ae.start_date||new Date(Ae.start_date)<new Date(B.startDate))||B.dueDate&&(!Ae.due_date||new Date(Ae.due_date)>new Date(B.dueDate))?!1:Ae.status!=="deleted"&&Ae.status!=="logged"}}switch(H){case"inbox":return z.filter(re=>re.status==="inbox").forEach(re=>{re.parent_id&&console.log(`[Inbox Debug] Hidden task "${re.title}": has parent_id ${re.parent_id}`)}),re=>{if(re.parent_id||re.status==="deleted"||re.status==="logged")return!1;const Ae=!!re.completed_at,it=!re.start_date&&!re.due_date&&(!re.tags||re.tags.length===0),rt=re.status==="inbox";if(it){const Gt=q.inbox||{include:[],exclude:[]};return!((Array.isArray(Gt)?Gt:Gt.include||[]).length>0)}if(!rt&&!Ae||!Ae&&(re.start_date||re.due_date)||!Ae&&(ut&&re.tags.includes(ut)||re.tags.some(Gt=>{const an=a.find(xn=>xn.id===Gt);return an&&["schedule",""].includes(an.name.trim().toLowerCase())}))||!Ae&&(ot&&re.tags.includes(ot)||bt&&re.tags.includes(bt)||Je&&re.tags.includes(Je)||We&&re.tags.includes(We)||De&&re.tags.includes(De)||Ct&&re.tags.includes(Ct)))return!1;const St=q.inbox||{include:[],exclude:[]},{include:zt,exclude:Bt}=Array.isArray(St)?{include:St,exclude:[]}:St;return!(zt.length>0&&!re.tags.some(Gt=>zt.includes(Gt))||Bt.length>0&&re.tags.some(Gt=>Bt.includes(Gt)))};case"allview":return re=>{if(re.parent_id||re.status==="deleted"||ut&&re.tags.includes(ut))return!1;const Ae=q.allview||{include:[],exclude:[]},{include:it,exclude:rt}=Array.isArray(Ae)?{include:Ae,exclude:[]}:Ae;return!(it.length>0&&!re.tags.some(St=>it.includes(St))||rt.length>0&&re.tags.some(St=>rt.includes(St)))};case"newtable":return re=>{if(re.parent_id||re.status==="deleted"||re.status==="logged"||De&&re.tags.includes(De)||We&&re.tags.includes(We)||Je&&re.tags.includes(Je)||!re.start_date&&!re.due_date)return!1;const Ae=new Date;Ae.setHours(23,59,59,999);const it=re.start_date?new Date(re.start_date):re.due_date?new Date(re.due_date):null;return!(!it||it>Ae)};case"focus":return re=>!(re.status==="deleted"||re.status==="logged"||re.start_date||re.due_date||De&&re.tags.includes(De)||We&&re.tags.includes(We)||Je&&re.tags.includes(Je)||re.status==="waiting"||z.some(it=>it.parent_id===re.id&&it.status!=="deleted"&&it.status!=="logged"));case"today":return re=>{if(re.status==="logged"||re.status==="deleted"||re.status==="waiting"||re.status==="someday"||ut&&re.tags.includes(ut)||re.tags.some(Bt=>{const Gt=a.find(an=>an.id===Bt);return Gt&&["schedule",""].includes(Gt.name.trim().toLowerCase())}))return!1;const Ae=q.today||{include:[],exclude:[]},{include:it,exclude:rt}=Array.isArray(Ae)?{include:Ae,exclude:[]}:Ae;if(it.length>0&&!re.tags.some(Bt=>it.includes(Bt))||rt.length>0&&re.tags.some(Bt=>rt.includes(Bt)))return!1;const St=["note","project"],zt=a.filter(Bt=>St.includes(Bt.name.trim().toLowerCase())).map(Bt=>Bt.id);return!(re.tags&&re.tags.some(Bt=>zt.includes(Bt))||!re.start_date&&!re.due_date)};case"waiting":return re=>{const Ae=q.waiting||{include:[],exclude:[]},{include:it,exclude:rt}=Array.isArray(Ae)?{include:Ae,exclude:[]}:Ae;if(it.length>0&&!re.tags.some(Gt=>it.includes(Gt))||rt.length>0&&re.tags.some(Gt=>rt.includes(Gt))||re.status==="deleted"||re.status==="logged")return!1;const St=re.status==="waiting",zt=re.status==="someday",Bt=re.tags.some(Gt=>{const an=a.find(Tn=>Tn.id===Gt);return an?an.name.trim().toLowerCase()==="someday":!1});return St||zt||Bt};case"journal":return re=>{if(!We)return!1;const Ae=q.journal||{include:[],exclude:[]},{include:it,exclude:rt}=Array.isArray(Ae)?{include:Ae,exclude:[]}:Ae;return it.length>0&&!re.tags.some(St=>it.includes(St))||rt.length>0&&re.tags.some(St=>rt.includes(St))?!1:re.status!=="deleted"&&re.status!=="logged"&&re.tags.includes(We)};case"prompt":return re=>{const Ae=a.find(zt=>zt.name.trim().toLowerCase()==="prompt");if(!Ae)return!1;const it=q.prompt||{include:[],exclude:[]},{include:rt,exclude:St}=Array.isArray(it)?{include:it,exclude:[]}:it;return rt.length>0&&!re.tags.some(zt=>rt.includes(zt))||St.length>0&&re.tags.some(zt=>St.includes(zt))?!1:re.status!=="deleted"&&re.status!=="logged"&&re.tags.includes(Ae.id)};case"log":case"logbook":return re=>{if(re.status!=="logged")return!1;const Ae=q.logbook||q.log||{include:[],exclude:[]},{include:it,exclude:rt}=Array.isArray(Ae)?{include:Ae,exclude:[]}:Ae;return!(it.length>0&&!re.tags.some(St=>it.includes(St))||rt.length>0&&re.tags.some(St=>rt.includes(St)))};case"recent":return re=>{if(re.status==="deleted")return!1;const Ae=q.recent||{include:[],exclude:[]},{include:it,exclude:rt}=Array.isArray(Ae)?{include:Ae,exclude:[]}:Ae;return!(it.length>0&&!re.tags.some(St=>it.includes(St))||rt.length>0&&re.tags.some(St=>rt.includes(St)))};case"trash":return re=>{if(re.status!=="deleted")return!1;const Ae=q.trash||{include:[],exclude:[]},{include:it,exclude:rt}=Array.isArray(Ae)?{include:Ae,exclude:[]}:Ae;return!(it.length>0&&!re.tags.some(St=>it.includes(St))||rt.length>0&&re.tags.some(St=>rt.includes(St)))};default:return re=>{if(re.status==="deleted"||re.status==="logged"||ut&&re.tags.includes(ut)||re.tags.some(zt=>{const Bt=a.find(Gt=>Gt.id===zt);return Bt&&["schedule",""].includes(Bt.name.trim().toLowerCase())}))return!1;const it=q[H]||{include:[],exclude:[]},{include:rt,exclude:St}=Array.isArray(it)?{include:it,exclude:[]}:it;return!(rt.length>0&&!re.tags.some(zt=>rt.includes(zt))||St.length>0&&re.tags.some(zt=>St.includes(zt)))}}})(),$e=H==="allview"||H==="project"?"inbox":H,be=Ze=>Ze.view_orders&&Ze.view_orders[$e]!==void 0?Ze.view_orders[$e]:Ze.order_index||0;if(H==="focus"||H==="today"){const Ze=it=>{const rt=it.start_date||it.due_date;if(rt){const zt=new Date(rt);return`${zt.getFullYear()}-${String(zt.getMonth()+1).padStart(2,"0")}-${String(zt.getDate()).padStart(2,"0")}`}const St=new Date;return`${St.getFullYear()}-${String(St.getMonth()+1).padStart(2,"0")}-${String(St.getDate()).padStart(2,"0")}`},re=it=>it.view_orders&&it.view_orders.today!==void 0?it.view_orders.today:9e8+new Date(it.created_at).getTime()/1e3;return z.filter(Te).sort((it,rt)=>{if(H==="today"){const St=Ze(it),zt=Ze(rt);return St!==zt?St.localeCompare(zt):re(it)-re(rt)}return be(it)-be(rt)||it.created_at.localeCompare(rt.created_at)}).map((it,rt)=>({data:it,depth:0,hasChildren:!1,isExpanded:!1,path:[it.id],index:rt}))}const Ie=z.filter(Ze=>{if(!Te(Ze))return!1;const re=Ze.parent_id||null;if(!re)return!0;const Ae=z.find(it=>it.id===re);return!Ae||!Te(Ae)}).sort((Ze,re)=>be(Ze)-be(re)||Ze.created_at.localeCompare(re.created_at)),Ke=new Set;let Nt=0;const gt=(Ze,re=0,Ae=[])=>{let it=[];return Ze.forEach(rt=>{if(Ke.has(rt.id))return;Ke.add(rt.id);const St=z.filter(an=>an.parent_id===rt.id&&an.status!=="logged"&&an.status!=="deleted").sort((an,xn)=>be(an)-be(xn)||an.created_at.localeCompare(xn.created_at)),zt=St.length>0,Bt=G.includes(rt.id),Gt=[...Ae,rt.id];it.push({data:rt,depth:re,hasChildren:zt,isExpanded:Bt,path:Gt,index:Nt++}),zt&&Bt&&(it=[...it,...gt(St,re+1,Gt)])}),it};return gt(Ie)},[a,Z.showImportedGoogleEvents]),Nn=x.useMemo(()=>ui(r,le,Le,O,vt,A),[r,le,Le,O,vt,A,ui,a]);x.useEffect(()=>{if(le!=="today"||!ve)return;let z=Nn.filter(pe=>{var We;return((We=pe.data.view_orders)==null?void 0:We.today)===void 0});const H=new Map;Nn.forEach(pe=>{var We;const De=(We=pe.data.view_orders)==null?void 0:We.today;if(De!==void 0){const Je=H.get(De)||[];Je.push(pe.data.id),H.set(De,Je)}});const L=new Set;if(H.forEach(pe=>{if(pe.length>1)for(let De=1;De<pe.length;De++)L.add(pe[De])}),L.size>0){const pe=Nn.filter(De=>L.has(De.data.id));console.warn("[Today] Found duplicate orders, re-assigning:",pe.map(De=>De.data.title)),z=[...z,...pe]}if(z.length===0)return;let G=0;Nn.forEach(pe=>{var We;const De=(We=pe.data.view_orders)==null?void 0:We.today;De!==void 0&&De>G&&(G=De)});const q=[...z].sort((pe,De)=>pe.data.created_at.localeCompare(De.data.created_at)).map((pe,De)=>({id:pe.data.id,view_orders:{...pe.data.view_orders||{},today:G+1e4*(De+1)}}));s(pe=>{const De=pe.map(We=>{const Je=q.find(ot=>ot.id===We.id);return Je?{...We,view_orders:Je.view_orders}:We});return J.current=De,De}),q.forEach(async({id:pe,view_orders:De})=>{ve&&await ve.from("tasks").update({view_orders:De}).eq("id",pe)})},[le,Nn,ve]),x.useEffect(()=>{if(le!=="waiting"||!ve)return;let z=Nn.filter(B=>{var pe;return((pe=B.data.view_orders)==null?void 0:pe.waiting)===void 0});if(z.length===0)return;let H=0;Nn.forEach(B=>{var pe;const q=(pe=B.data.view_orders)==null?void 0:pe.waiting;q!==void 0&&q>H&&(H=q)});const G=[...z].sort((B,q)=>B.data.created_at.localeCompare(q.data.created_at)).map((B,q)=>({id:B.data.id,view_orders:{...B.data.view_orders||{},waiting:H+1e4*(q+1)}}));s(B=>{const q=B.map(pe=>{const De=G.find(We=>We.id===pe.id);return De?{...pe,view_orders:De.view_orders}:pe});return J.current=q,q}),G.forEach(async({id:B,view_orders:q})=>{ve&&await ve.from("tasks").update({view_orders:q}).eq("id",B)})},[le,Nn,ve]);const Oi=(z,H)=>{k(H);const L=z.shiftKey||z.shiftKey,G=z.ctrlKey||z.metaKey;if(L){const B=w||R||H;T(B);const q=Nn.findIndex(De=>De.data.id===B),pe=Nn.findIndex(De=>De.data.id===H);if(q!==-1&&pe!==-1){const[De,We]=q<pe?[q,pe]:[pe,q],Je=Nn.slice(De,We+1).map(ot=>ot.data.id);v(Je)}}else G?(T(H),v(B=>B.includes(H)?B.filter(q=>q!==H):[...B,H])):(T(H),v([H]))},Zo=x.useCallback((z,H)=>{const L=document.getElementById("drag-ghost");L&&(L.style.left=`${z}px`,L.style.top=`${H}px`)},[]);x.useEffect(()=>{ze.current=document.querySelector("main")},[]);const ea=(z,H)=>{if(le==="schedule"){z.preventDefault();return}const L=g.includes(H.data.id)?g:[H.data.id];g.includes(H.data.id)||v([H.data.id]),z.dataTransfer.setData("text/plain",H.data.id),z.dataTransfer.setData("application/json",JSON.stringify(L)),z.dataTransfer.effectAllowed="move",z.dataTransfer.setDragImage(SI,0,0);const G=z.currentTarget.getBoundingClientRect(),B=z.clientX-G.left;Ge(q=>({...q,isDragging:!0,draggedId:H.data.id,originalDepth:H.depth,dragOffsetX:B,ghostPosition:{x:z.clientX,y:z.clientY}}))},di=z=>{Ge(H=>({...H,...z}))},il=async z=>{Y.current&&(clearInterval(Y.current),Y.current=null);const{draggedId:H,dropIndex:L,dropDepth:G}=ye;if(Ge(be=>({...be,isDragging:!1,draggedId:null,dropIndex:null})),!H||L===null)return;const B=z||Nn,q=le==="allview"||le==="project"?"inbox":le,pe=g.includes(H)?g:[H],De=be=>q==="today"?9e8+new Date(be.created_at).getTime()/1e3:be.order_index||0,We=r.filter(be=>pe.includes(be.id)).sort((be,Ie)=>{var gt,Tt;const Ke=((gt=be.view_orders)==null?void 0:gt[q])!==void 0?be.view_orders[q]:De(be),Nt=((Tt=Ie.view_orders)==null?void 0:Tt[q])!==void 0?Ie.view_orders[q]:De(Ie);return Ke-Nt});let Je=null;if(le!=="today"&&L>0){const be=B[L-1];if(G>be.depth)Je=be.data.id,rn(Je,!0);else if(G===be.depth)Je=be.data.parent_id;else{let Ie=L-1;for(;Ie>=0;){if(B[Ie].depth===G-1){Je=B[Ie].data.id;break}if(B[Ie].depth<G-1)break;Ie--}if(G===0){const Ke=B.find(Nt=>Nt.depth===0&&!pe.includes(Nt.data.id));Je=Ke?Ke.data.parent_id:null}}}else Je=null;for(const be of We){if(Je&&Ev(be.id,Je,r)){b({msg:"",type:"error"});return}if(Je){const Ie=r.find(Ke=>Ke.id===Je);if(Ie&&!Ie.is_project&&be.is_project){b({msg:"",type:"error"});return}}}let ot=-1e4,Ct=9999999999;const ut=be=>be.view_orders&&be.view_orders[q]!==void 0?be.view_orders[q]:q==="today"?9e8+new Date(be.created_at).getTime()/1e3:be.order_index||0;let bt=null;if(le==="today"){const be=re=>re.start_date?new Date(re.start_date).toISOString().split("T")[0]:re.due_date?new Date(re.due_date).toISOString().split("T")[0]:null;let Ie=null;for(let re=L-1;re>=0&&!(!pe.includes(B[re].data.id)&&(Ie=be(B[re].data),Ie));re--);let Ke=null;for(let re=L;re<B.length&&!(!pe.includes(B[re].data.id)&&(Ke=be(B[re].data),Ke));re++);const Nt=ye.anchorTaskIndex;if(Nt!==null&&Nt>=0&&Nt<B.length){const re=B[Nt].data;pe.includes(re.id)||(bt=be(re))}bt||(bt=Ie||Ke),bt||(bt=new Date().toISOString().split("T")[0]);const gt=B.map((re,Ae)=>({...re,originalIndex:Ae})).filter(re=>!pe.includes(re.data.id)&&be(re.data)===bt),Tt=gt.filter(re=>re.originalIndex<L),Ze=gt.filter(re=>re.originalIndex>=L);if(Tt.length>0){const re=Tt[Tt.length-1];ot=ut(re.data)}if(Ze.length>0){const re=Ze[0];Ct=ut(re.data)}}else{for(let be=L-1;be>=0;be--){const Ie=B[be];if(!pe.includes(Ie.data.id)){if(Ie.depth===G){ot=ut(Ie.data);break}else if(Ie.depth<G)break}}for(let be=L;be<B.length;be++){const Ie=B[be];if(!pe.includes(Ie.data.id)){if(Ie.depth===G){Ct=ut(Ie.data);break}else if(Ie.depth<G)break}}}ot===-1e4&&Ct===9999999999?(ot=0,Ct=2e4):ot===-1e4?ot=Ct-2e4:Ct===9999999999&&(Ct=ot+2e4);const Xe=We.length,Te=(Ct-ot)/(Xe+1),$e=We.map((be,Ie)=>{const Ke=ot+Te*(Ie+1),Nt={...be.view_orders||{},[q]:Ke},gt={id:be.id,view_orders:Nt};return le!=="today"&&(gt.parent_id=Je),le==="today"&&bt&&(gt.start_date=bt,gt.is_all_day=!0),gt});Ir($e)},ol=async(z,H)=>{const L=J.current,G=L.find(Je=>Je.id===z);if(!G)return;X(z);const B=le==="allview"||le==="project"?"inbox":le,q=Je=>Je.view_orders&&Je.view_orders[B]!==void 0?Je.view_orders[B]:B==="today"?9e8+new Date(Je.created_at).getTime()/1e3:Je.order_index||0,De=g.includes(z)?le==="today"?g:g.filter(Je=>{const ot=L.find(Ct=>Ct.id===Je);return ot&&(ot.parent_id||null)===(G.parent_id||null)}):[z],We=L.filter(Je=>De.includes(Je.id)).sort((Je,ot)=>q(Je)-q(ot));if(H==="up"||H==="down"){const Je=le==="today";let ot=[];if(le==="project")ot=L.filter(Xe=>(Xe.parent_id||null)===(G.parent_id||null)&&Xe.status!=="deleted"&&Xe.status!=="logged").sort((Xe,Te)=>q(Xe)-q(Te));else if(Je){const Xe=be=>be.start_date?new Date(be.start_date).toISOString().split("T")[0]:be.due_date?new Date(be.due_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],Te=Xe(G),$e=new Set(Nn.map(be=>be.data.id));$e.add(G.id),ot=L.filter(be=>$e.has(be.id)&&Xe(be)===Te).sort((be,Ie)=>q(be)-q(Ie))}else ot=Nn.filter(Xe=>(Xe.data.parent_id||null)===(G.parent_id||null)).map(Xe=>Xe.data);const Ct=We.map(Xe=>ot.findIndex(Te=>Te.id===Xe.id)).filter(Xe=>Xe!==-1);if(Ct.length===0)return;const ut=Math.min(...Ct),bt=Math.max(...Ct);if(H==="up"){if(ut===0){if(Je){const Ke=Ze=>{const re=Ze.start_date||Ze.due_date;if(re){const it=new Date(re);return`${it.getFullYear()}-${String(it.getMonth()+1).padStart(2,"0")}-${String(it.getDate()).padStart(2,"0")}`}const Ae=new Date;return`${Ae.getFullYear()}-${String(Ae.getMonth()+1).padStart(2,"0")}-${String(Ae.getDate()).padStart(2,"0")}`},Nt=Ke(G),gt=Array.from(new Set(Nn.map(Ze=>Ke(Ze.data)))).sort(),Tt=gt.indexOf(Nt);if(Tt>0){const Ze=gt[Tt-1],re=Nn.filter(rt=>Ke(rt.data)===Ze).map(rt=>rt.data).sort((rt,St)=>q(rt)-q(St));let Ae;re.length>0?Ae=q(re[re.length-1])+1e4:Ae=0;const it=We.map((rt,St)=>({id:rt.id,start_date:Ze,view_orders:{...rt.view_orders||{},[B]:Ae+1e4*St}}));Ir(it);return}}return}const Xe=ut-1,Te=ut-2,$e=q(ot[Xe]),be=Te>=0?q(ot[Te]):$e-2e4;if($e-be<.1){console.log("[Task Reorder] Gap too small, rebalancing list...");const Ke=new Set(We.map(Ae=>Ae.id)),Nt=ot.filter(Ae=>!Ke.has(Ae.id)),gt=ot[Xe];let Tt=Nt.findIndex(Ae=>Ae.id===gt.id);Tt===-1&&(Tt=0);const Ze=[...Nt];Ze.splice(Tt,0,...We);const re=Ze.map((Ae,it)=>({id:Ae.id,view_orders:{...Ae.view_orders||{},[B]:1e4*(it+1)}}));Ir(re)}else{const Ke=($e-be)/(We.length+1),Nt=We.map((gt,Tt)=>({id:gt.id,view_orders:{...gt.view_orders||{},[B]:be+Ke*(Tt+1)}}));Ir(Nt)}}else{if(bt===ot.length-1){if(Je){const Ke=Ze=>{const re=Ze.start_date||Ze.due_date;if(re){const it=new Date(re);return`${it.getFullYear()}-${String(it.getMonth()+1).padStart(2,"0")}-${String(it.getDate()).padStart(2,"0")}`}const Ae=new Date;return`${Ae.getFullYear()}-${String(Ae.getMonth()+1).padStart(2,"0")}-${String(Ae.getDate()).padStart(2,"0")}`},Nt=Ke(G),gt=Array.from(new Set(Nn.map(Ze=>Ke(Ze.data)))).sort(),Tt=gt.indexOf(Nt);if(Tt<gt.length-1){const Ze=gt[Tt+1],re=Nn.filter(rt=>Ke(rt.data)===Ze).map(rt=>rt.data).sort((rt,St)=>q(rt)-q(St));let Ae;re.length>0?Ae=q(re[0])-1e4*We.length:Ae=0;const it=We.map((rt,St)=>({id:rt.id,start_date:Ze,view_orders:{...rt.view_orders||{},[B]:Ae+1e4*St}}));Ir(it);return}}return}const Xe=bt+1,Te=bt+2,$e=q(ot[Xe]),be=Te<ot.length?q(ot[Te]):$e+2e4;if(be-$e<.1){console.log("[Task Reorder] Gap too small (down), rebalancing list...");const Ke=new Set(We.map(Ae=>Ae.id)),Nt=ot.filter(Ae=>!Ke.has(Ae.id)),gt=ot[Xe];let Tt=Nt.findIndex(Ae=>Ae.id===gt.id);Tt===-1&&(Tt=Nt.length);const Ze=[...Nt];Ze.splice(Tt+1,0,...We);const re=Ze.map((Ae,it)=>({id:Ae.id,view_orders:{...Ae.view_orders||{},[B]:1e4*(it+1)}}));Ir(re)}else{const Ke=(be-$e)/(We.length+1),Nt=We.map((gt,Tt)=>({id:gt.id,view_orders:{...gt.view_orders||{},[B]:$e+Ke*(Tt+1)}}));Ir(Nt)}}}else if(H==="right"){if(le==="today"){const Xe=We[0],Te=Nn.findIndex(Ke=>Ke.data.id===Xe.id);if(Te<=0){b({msg:"",type:"info"});return}const $e=Nn[Te-1].data.id,be=(Ke,Nt)=>{let gt=r.find(Tt=>Tt.id===Ke);for(;gt&&gt.parent_id;){if(gt.parent_id===Nt)return!0;gt=r.find(Tt=>Tt.id===gt.parent_id)}return!1};for(const Ke of We)if($e===Ke.id||be($e,Ke.id)){b({msg:"",type:"error"});return}const Ie=We.map(Ke=>({id:Ke.id,parent_id:$e}));Ir(Ie),b({msg:` ${We.length} `,type:"info"});return}let Je=null;const ot=We[0];if(le==="project"){const Xe=L.filter($e=>($e.parent_id||null)===(ot.parent_id||null)&&$e.status!=="deleted"&&$e.status!=="logged").sort(($e,be)=>q($e)-q(be)),Te=Xe.findIndex($e=>$e.id===ot.id);Te>0&&(Je=Xe[Te-1].id)}else{const Xe=Nn.findIndex(Te=>Te.data.id===ot.id);if(Xe>0){const Te=Nn[Xe];for(let $e=Xe-1;$e>=0;$e--){if(Nn[$e].depth===Te.depth){Je=Nn[$e].data.id;break}if(Nn[$e].depth<Te.depth)break}}}if(!Je)return;const Ct=L.filter(Xe=>Xe.parent_id===Je&&Xe.status!=="deleted"&&Xe.status!=="logged").sort((Xe,Te)=>q(Xe)-q(Te));let ut=(Ct[Ct.length-1]?q(Ct[Ct.length-1]):0)+1e4;O.includes(Je)||rn(Je,!0);const bt=We.map(Xe=>{const Te=ut;return ut+=1e4,{id:Xe.id,parent_id:Je,order_index:Te,view_orders:{...Xe.view_orders||{},[B]:Te}}});Ir(bt),b({msg:` ${We.length} `,type:"info"})}else if(H==="left"){if(le==="today"){const Ct=[];let ut=0;for(const bt of We){if(!bt.parent_id)continue;const Xe=L.find($e=>$e.id===bt.parent_id);if(!Xe)continue;const Te=Xe.parent_id||null;Ct.push({id:bt.id,parent_id:Te}),ut++}Ct.length>0?(Ir(Ct),b({msg:` ${ut} `,type:"info"})):b({msg:"",type:"info"});return}const Je=[];let ot=0;for(const Ct of We){if(!Ct.parent_id)continue;const ut=L.find(Ie=>Ie.id===Ct.parent_id);if(!ut)continue;if(le==="project"){const Ie=a.find(Ke=>Ke.name.trim().toLowerCase()==="project");if(Ie&&ut.tags.includes(Ie.id)){b({msg:" ",type:"info"});continue}}const bt=ut.parent_id,Xe=L.filter(Ie=>Ie.parent_id===bt&&Ie.status!=="deleted"&&Ie.status!=="logged").sort((Ie,Ke)=>q(Ie)-q(Ke)),Te=Xe.findIndex(Ie=>Ie.id===ut.id),$e=Xe[Te+1];let be;$e?be=(q(ut)+q($e))/2:be=q(ut)+1e4,Je.push({id:Ct.id,parent_id:bt,order_index:be,view_orders:{...Ct.view_orders||{},[B]:be}}),ot++}Je.length>0&&(Ir(Je),b({msg:` ${ot} `,type:"info"}))}},Ir=async z=>{const H=z.map(q=>{const pe=J.current.find(Je=>Je.id===q.id),De={},We={};return pe&&Object.keys(q).forEach(Je=>{Je!=="id"&&(De[Je]=pe[Je],We[Je]=q[Je])}),{id:q.id,before:De,after:We}});yn({type:"BATCH_UPDATE",payload:H});const L=J.current.map(q=>{const pe=z.find(De=>De.id===q.id);return pe?{...q,...pe}:q}).sort((q,pe)=>(q.order_index||0)-(pe.order_index||0)||q.created_at.localeCompare(pe.created_at));if(J.current=L,s(L),ve){const q=ve;await Promise.all(z.map(pe=>q.from("tasks").update(pe).eq("id",pe.id)))}const G=JSON.parse(localStorage.getItem("task_google_map")||"{}"),B=z.filter(q=>G[q.id]&&(q.start_date!==void 0||q.is_all_day!==void 0));B.length>0&&Promise.resolve(localStorage.getItem("google_access_token")).then(async q=>{q&&await Promise.all(B.map(async pe=>{const De=G[pe.id],We=L.find(Xe=>Xe.id===pe.id);if(!We)return;const Je={},ot=pe.is_all_day!==void 0?pe.is_all_day:We.is_all_day,Ct=pe.start_date||We.start_date;if(!Ct)return;const ut=new Date(Ct);if(isNaN(ut.getTime()))return;const bt=ut.toLocaleDateString("en-CA");if(ot){Je.start={date:bt};const Xe=new Date(ut);Xe.setDate(Xe.getDate()+1),Je.end={date:Xe.toLocaleDateString("en-CA")}}else{const Xe=Ie=>Ie.length===5?Ie+":00":Ie,Te=Xe(pe.start_time||We.start_time||"09:00:00");let $e=We.end_time?Xe(We.end_time):null;if(!$e){const[Ie,Ke]=Te.split(":").map(Number);$e=`${String((Ie+1)%24).padStart(2,"0")}:${String(Ke).padStart(2,"0")}:00`}const be=Intl.DateTimeFormat().resolvedOptions().timeZone;Je.start={dateTime:`${bt}T${Te}`,timeZone:be},Je.end={dateTime:`${bt}T${$e}`,timeZone:be}}try{const Xe=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${De.calId}/events/${De.evtId}`,{method:"PATCH",headers:{Authorization:`Bearer ${q}`,"Content-Type":"application/json"},body:JSON.stringify(Je)});if(!Xe.ok){const Te=await Xe.text();console.error("Batch Google Sync Failed",Te),Xe.status===401&&b({msg:"Google  Google",type:"error"})}}catch(Xe){console.error("Google Batch Sync Error",Xe)}}))})},Co=async(z,H=[],L)=>{if(!ve)return"";m("syncing");const G=L||fl(),B=r.length>0?Math.max(...r.map(ot=>ot.order_index||0)):0,q=z.order_index!==void 0?z.order_index:B+1e4;X(G);const pe={...z,id:G,user_id:e.id,parent_id:z.parent_id||null,created_at:new Date().toISOString(),tags:z.tags||[],images:z.images||[],order_index:q,view_orders:z.view_orders||{},is_all_day:z.is_all_day||!1,start_time:z.start_time||null,end_time:z.end_time||null,duration:z.duration||null,reviewed_at:null,dependencies:z.dependencies||[]};yn({type:"ADD",payload:{data:pe}}),s(ot=>{const Ct=[...ot,pe].sort((ut,bt)=>(ut.order_index||0)-(bt.order_index||0)||ut.created_at.localeCompare(bt.created_at));return J.current=Ct,Ct});const{error:De}=await ve.from("tasks").insert([pe]);if(De)return console.error("Task Insert Error:",De),s(ot=>ot.filter(Ct=>Ct.id!==G)),lt(De),"";const We=a.find(ot=>(pe.tags||[]).includes(ot.id)&&ot.name.startsWith("Google:")),Je=pe.start_date&&(pe.start_time||pe.is_all_day);if(We&&Je){const ot=localStorage.getItem("google_access_token");if(ot){console.log("[Google Sync] New task has Google tag, creating event...");const Ct=We.name.replace("Google:","").trim();kl(ot).then(async ut=>{const bt=ut.find(Ie=>Ie.summary===Ct),Xe=bt?bt.id:"primary",Te={summary:pe.title,description:pe.description||""},$e=new Date(pe.start_date).toLocaleDateString("en-CA"),be=Intl.DateTimeFormat().resolvedOptions().timeZone;if(pe.is_all_day){Te.start={date:$e};const Ie=new Date($e),Ke=new Date(Ie);Ke.setDate(Ke.getDate()+1),Te.end={date:Ke.toLocaleDateString("en-CA")}}else if(pe.start_time){const Ie=pe.start_time.length>5?pe.start_time.substring(0,5):pe.start_time,Ke=`${$e}T${Ie}:00`;let Nt="";if(pe.end_time)Nt=pe.end_time.length>5?pe.end_time.substring(0,5):pe.end_time;else{const gt=new Date(Ke);gt.setHours(gt.getHours()+1),Nt=`${String(gt.getHours()).padStart(2,"0")}:${String(gt.getMinutes()).padStart(2,"0")}`}Te.start={dateTime:Ke,timeZone:be},Te.end={dateTime:`${$e}T${Nt}:00`,timeZone:be}}if(Te.start)try{const Ie=await Io(ot,Xe,Te);if(Ie){const Ke=JSON.parse(localStorage.getItem("task_google_map")||"{}");Ke[G]={evtId:Ie,calId:Xe},localStorage.setItem("task_google_map",JSON.stringify(Ke)),console.log("[Google Sync] Created event for new task:",G,"eventId:",Ie),b({msg:"Google ",type:"info"})}}catch(Ie){console.error("[Google Sync] Failed to create event for new task:",Ie)}}).catch(ut=>console.error("[Google Sync] Calendar list fetch failed:",ut))}}return m("synced"),G},al=async(z,H=null,L)=>{if(!ve)return;m("syncing");let G=J.current.length>0?Math.max(...J.current.map(ot=>ot.order_index||0)):0;const B=[],q=new Date().toISOString(),pe=(ot,Ct)=>{for(const ut of ot){G+=1e4;const bt=ut.id||fl();X(bt);const Xe={id:bt,user_id:e.id,parent_id:Ct,created_at:q,title:ut.title,description:ut.description,start_date:ut.start_date||null,due_date:ut.due_date||null,order_index:G,view_orders:{today:0},dependencies:ut.dependencies||[],is_all_day:ut.is_all_day!==void 0?ut.is_all_day:!0,start_time:ut.start_time||null,end_time:ut.end_time||null,duration:ut.duration||null,color:ut.color,tags:ut.tags||[],status:ut.status||"todo",images:ut.images||[],reviewed_at:null,reminder_minutes:ut.reminder_minutes||null,google_event_id:ut.google_event_id||null,google_calendar_id:ut.google_calendar_id||null};B.push(Xe),ut.subtasks&&ut.subtasks.length>0&&pe(ut.subtasks,bt)}};if(pe(z,H),B.length===0)return;s(ot=>{const Ct=[...ot,...B].sort((ut,bt)=>(ut.order_index||0)-(bt.order_index||0)||ut.created_at.localeCompare(bt.created_at));return J.current=Ct,Ct});const De=500;let We=0;const Je=B.length;try{const ot=JSON.parse(localStorage.getItem("task_google_map")||"{}");for(let Ct=0;Ct<Je;Ct+=De){const ut=B.slice(Ct,Ct+De),bt=ut.map(Te=>{const{google_event_id:$e,google_calendar_id:be,...Ie}=Te;return Ie}),{error:Xe}=await ve.from("tasks").insert(bt);if(Xe){console.error("Batch insert error in chunk "+Ct,Xe),lt(Xe);break}ut.forEach(Te=>{Te.google_event_id&&Te.google_calendar_id&&(ot[Te.id]={evtId:Te.google_event_id,calId:Te.google_calendar_id})}),We+=ut.length,L&&L(We,Je),await new Promise(Te=>setTimeout(Te,10))}localStorage.setItem("task_google_map",JSON.stringify(ot))}catch(ot){console.error("Batch process failed",ot)}m("synced")},cc=async z=>{if(!ve||z.length===0)return[];m("syncing");const H=[],L=new Map,G=q=>{const pe=J.current.filter(We=>We.parent_id===q);let De=[];return pe.forEach(We=>{De.push(We),De=[...De,...G(We.id)]}),De};let B=J.current.length>0?Math.max(...J.current.map(q=>q.order_index||0)):0;try{for(const q of z){const pe=J.current.find(ot=>ot.id===q);if(!pe)continue;const De=G(q);B+=1e4;const We=fl();L.set(q,We);const Je={...pe,id:We,title:pe.title+" ()",created_at:new Date().toISOString(),order_index:B,view_orders:{},reviewed_at:null};delete Je.user_id,await Co(Je,[],We),H.push(We);for(const ot of De){B+=1e4;const Ct=fl();L.set(ot.id,Ct);const ut=L.get(ot.parent_id)||ot.parent_id,bt={...ot,id:Ct,parent_id:ut,created_at:new Date().toISOString(),order_index:B,view_orders:{},reviewed_at:null};delete bt.user_id,await Co(bt,[],Ct)}}}catch(q){lt(q)}finally{m("synced")}return H},jn=async(z,H,L=[],G)=>{var bt,Xe;if(console.warn("[updateTask] CALLED:",z,"status:",H.status),!ve)return;const B=r.find(Te=>Te.id===z);if(B&&at(B)&&!(G!=null&&G.skipGoogleLockCheck)){console.warn("[updateTask] BLOCKED: Task is locked via Google tag:",z),b({msg:" Google ",type:"error"});return}if(m("syncing"),X(z),le==="inbox"&&B&&!B.parent_id){const Te=a.find(zt=>zt.name.trim().toLowerCase()==="project"),$e=a.find(zt=>zt.name.includes("")),be=a.find(zt=>zt.name.trim().toLowerCase()==="note"),Ie=a.find(zt=>zt.name.trim().toLowerCase()==="prompt"),Ke=a.find(zt=>zt.name==="#prompt"),Nt=a.find(zt=>zt.name.trim().toLowerCase()==="journal"),gt=a.find(zt=>zt.name.trim().toLowerCase()==="someday"),Tt=a.find(zt=>["annual","annualplan","",""].some(Bt=>zt.name.trim().toLowerCase().includes(Bt))),Ze=a.find(zt=>["schedule",""].includes(zt.name.trim().toLowerCase())),re=H.tags||B.tags||[],Ae=B.tags||[],it=H.tags&&(Te&&re.includes(Te.id)&&!Ae.includes(Te.id)||$e&&re.includes($e.id)&&!Ae.includes($e.id)||be&&re.includes(be.id)&&!Ae.includes(be.id)||Ie&&re.includes(Ie.id)&&!Ae.includes(Ie.id)||Ke&&re.includes(Ke.id)&&!Ae.includes(Ke.id)||Nt&&re.includes(Nt.id)&&!Ae.includes(Nt.id)||gt&&re.includes(gt.id)&&!Ae.includes(gt.id)||Tt&&re.includes(Tt.id)&&!Ae.includes(Tt.id)||Ze&&re.includes(Ze.id)&&!Ae.includes(Ze.id)),rt=H.status&&(H.status==="someday"||H.status==="waiting")&&B.status!=="someday"&&B.status!=="waiting";(H.start_date&&!B.start_date||H.due_date&&!B.due_date||H.parent_id&&!B.parent_id||it||rt)&&!ht.current.includes(z)&&hn(z)}if(B&&!(G!=null&&G.skipHistory)){const Te={};let $e=!1;Object.keys(H).forEach(be=>{const Ie=B[be],Ke=H[be];Te[be]=Ie,Array.isArray(Ie)||Array.isArray(Ke)||Ie&&typeof Ie=="object"?JSON.stringify(Ie)!==JSON.stringify(Ke)&&($e=!0):Ie!==Ke&&($e=!0)}),$e&&yn({type:"UPDATE",payload:{id:z,before:Te,after:H}})}if(H.start_date&&B){const Te=new Date().toISOString().split("T")[0],$e=H.start_date===Te||H.start_date.startsWith(Te),be=((bt=B.view_orders)==null?void 0:bt.today)!==void 0;if($e&&!be){const Ie=J.current.filter(gt=>{const Tt=gt.start_date||gt.due_date;return Tt&&(Tt===Te||Tt.startsWith(Te))});let Ke=0;Ie.forEach(gt=>{var Ze;const Tt=((Ze=gt.view_orders)==null?void 0:Ze.today)??gt.order_index??0;Tt>Ke&&(Ke=Tt)});const Nt=Ke+1e4;H.view_orders={...B.view_orders||{},...H.view_orders||{},today:Nt}}}const q=H.completed_at&&(!B||!B.completed_at);let pe=[];if(q){const Te=$e=>{const Ie=J.current.filter(Nt=>Nt.parent_id===$e&&!Nt.completed_at).map(Nt=>Nt.id),Ke=Ie.flatMap(Nt=>Te(Nt));return[...Ie,...Ke]};pe=Te(z)}s(Te=>{const $e=new Date().toISOString();let be=Te.map(Ie=>Ie.id===z?{...Ie,...H,updated_at:$e}:Ie);return pe.length>0&&(be=be.map(Ie=>pe.includes(Ie.id)?{...Ie,completed_at:H.completed_at,status:"completed",updated_at:$e}:Ie)),J.current=be,be});const{google_event_id:De,google_calendar_id:We,...Je}=H,{error:ot}=await ve.from("tasks").update(Je).eq("id",z);if(ot){B&&s(Te=>{const $e=Te.map(be=>be.id===z?B:be);return J.current=$e,$e}),lt(ot);return}else{console.log("[updateTask] Database update successful, proceeding to Google sync check");const Te=JSON.parse(localStorage.getItem("task_google_map")||"{}");De&&We&&(Te[z]={evtId:De,calId:We},localStorage.setItem("task_google_map",JSON.stringify(Te)));const $e=Te[z];if(H.status==="deleted"&&console.log("[Google Sync Check] Task being deleted:",z,"Has Google mapping:",!!$e),B&&$e&&$e.evtId!=="PENDING"){const be=localStorage.getItem("google_access_token");if(be){const Ie={...B,...H},Ke={};if(H.tags!==void 0){const gt=a.find(Ze=>(B.tags||[]).includes(Ze.id)&&Ze.name.startsWith("Google:")),Tt=a.find(Ze=>(H.tags||[]).includes(Ze.id)&&Ze.name.startsWith("Google:"));if(gt&&Tt&&gt.id!==Tt.id){console.log("[Google Sync] Calendar tag changed from",gt.name,"to",Tt.name),gt.name.replace("Google:","").trim();const Ze=Tt.name.replace("Google:","").trim();kl(be).then(async re=>{var it;const Ae=re.find(rt=>rt.summary===Ze);if(Ae)try{await ca(be,$e.calId,$e.evtId),console.log("[Google Sync] Deleted event from old calendar:",$e.calId);const rt={summary:Ie.title,description:Ie.description||""},St=(it=Ie.start_date)==null?void 0:it.split("T")[0],zt=Intl.DateTimeFormat().resolvedOptions().timeZone;if(Ie.is_all_day&&St){rt.start={date:St};const Bt=new Date(St);Bt.setDate(Bt.getDate()+1),rt.end={date:Bt.toISOString().split("T")[0]}}else if(Ie.start_time&&St){const Bt=(Ie.start_time||"").substring(0,5);rt.start={dateTime:`${St}T${Bt}:00`,timeZone:zt};const Gt=Ie.end_time?Ie.end_time.substring(0,5):(()=>{const an=new Date(`${St}T${Bt}:00`);return an.setHours(an.getHours()+1),`${String(an.getHours()).padStart(2,"0")}:${String(an.getMinutes()).padStart(2,"0")}`})();rt.end={dateTime:`${St}T${Gt}:00`,timeZone:zt}}if(rt.start){const Bt=await Io(be,Ae.id,rt);if(Bt){const Gt=JSON.parse(localStorage.getItem("task_google_map")||"{}");Gt[z]={evtId:Bt,calId:Ae.id},localStorage.setItem("task_google_map",JSON.stringify(Gt)),console.log("[Google Sync] Moved event to new calendar:",Ae.id,"new event ID:",Bt),b({msg:` ${Ze}`,type:"info"})}}}catch(rt){console.error("[Google Sync] Calendar move failed:",rt),b({msg:"",type:"error"})}}).catch(re=>console.error("[Google Sync] Failed to fetch calendars for move:",re));return}}if(!(H.title!==void 0||H.status!==void 0||H.start_date!==void 0||H.start_time!==void 0||H.end_time!==void 0||H.is_all_day!==void 0))return;if(H.title!==void 0&&H.title!==B.title&&(Ke.summary=Ie.title),H.description!==void 0&&H.description!==B.description&&(Ke.description=Ie.description||""),H.status==="deleted"){console.log("[Google Sync] Task moved to trash, calling DELETE API"),ca(be,$e.calId,$e.evtId).then(()=>{b({msg:"Google ",type:"info"});const gt=JSON.parse(localStorage.getItem("task_google_map")||"{}");delete gt[z],localStorage.setItem("task_google_map",JSON.stringify(gt))}).catch(gt=>console.error("Google Delete Error",gt));return}else H.status&&B.status==="deleted"&&(Ke.status="confirmed",console.log("[Google Sync] Task restored, setting event status to confirmed"),Ke.status="confirmed",console.log("[Google Sync] Task restored, setting event status to confirmed"));try{const gt=rt=>{if(!rt)return null;if(typeof rt=="string"){const St=rt.match(/^(\d{4}-\d{2}-\d{2})/);return St?St[1]:null}return null},Tt=rt=>{if(!rt)return null;if(typeof rt=="string"){const St=rt.match(/^(\d{1,2}):(\d{2})/);if(St)return`${St[1].padStart(2,"0")}:${St[2]}`}return null};if((H.start_date!==void 0&&gt(H.start_date)!==gt(B.start_date)||H.start_time!==void 0&&Tt(H.start_time)!==Tt(B.start_time)||H.end_time!==void 0&&Tt(H.end_time)!==Tt(B.end_time)||H.is_all_day!==void 0&&H.is_all_day!==B.is_all_day)&&Ie.start_date){const rt=Intl.DateTimeFormat().resolvedOptions().timeZone,St=gt(Ie.start_date),zt=Bt=>{if(!Bt)return null;if(typeof Bt=="string"){const Gt=Bt.match(/^(\d{1,2}):(\d{2})(?::(\d{2}))?/);if(Gt){const an=Gt[1].padStart(2,"0"),xn=Gt[2],Tn=Gt[3]||"00";return`${an}:${xn}:${Tn}`}}return null};if(Ie.is_all_day&&St){Ke.start={date:St};const Bt=new Date(St);Bt.setDate(Bt.getDate()+1);const Gt=Bt.toISOString().split("T")[0];Ke.end={date:Gt}}else if(St&&Ie.start_time){const Bt=zt(Ie.start_time);if(Bt){const Gt=`${St}T${Bt}`;Ke.start={dateTime:Gt,timeZone:rt};let an="";const xn=zt(Ie.end_time);if(xn)an=`${St}T${xn}`;else{const Tn=new Date(Gt),bn=new Date(Tn.getTime()+60*60*1e3),br=String(bn.getHours()).padStart(2,"0"),Lr=String(bn.getMinutes()).padStart(2,"0");an=`${St}T${br}:${Lr}:00`}Ke.end={dateTime:an,timeZone:rt}}}}if(Ke.start||Ke.end){const rt=Ke.start&&(Ke.start.date||Ke.start.dateTime),St=Ke.end&&(Ke.end.date||Ke.end.dateTime);(!rt||!St)&&(delete Ke.start,delete Ke.end,console.log("[Google Sync] Removed invalid date objects from payload"))}const Ae=Object.keys(Ke).length>0&&(Ke.summary||Ke.status||Ke.start&&Ke.end);if(H.is_all_day!==void 0&&B.is_all_day!==H.is_all_day&&Ke.start&&Ke.end){console.log("[Google Sync] Event TYPE change detected (is_all_day:",B.is_all_day,"->",H.is_all_day,"), using delete+create"),On.current=!0;const rt=$e.evtId;nr.current.add(rt),(async()=>{try{await ca(be,$e.calId,rt);const St={summary:Ie.title,description:Ie.description||"",start:Ke.start,end:Ke.end},zt=await Io(be,$e.calId,St);nr.current.add(zt);const Bt=JSON.parse(localStorage.getItem("task_google_map")||"{}");Bt[z]={evtId:zt,calId:$e.calId},localStorage.setItem("task_google_map",JSON.stringify(Bt)),b({msg:"Google ",type:"info"}),console.log("[Google Sync] Event type change completed with new ID:",zt)}catch(St){console.error("Failed to recreate event:",St),b({msg:"Google : ",type:"error"})}finally{On.current=!1}})()}else Ae&&(console.log("[Google Sync] Updating event:",$e.evtId),console.log("[Google Sync] Full payload:",JSON.stringify(Ke,null,2)),e1(be,$e.calId,$e.evtId,Ke).then(()=>b({msg:"Google ",type:"info"})).catch(async rt=>{console.error("Google Update Error",rt,"Payload:",Ke),(rt.message||"").includes("conflict")||b({msg:`Google : ${rt.message}`,type:"error"})}))}catch(gt){console.error("Date parsing error",gt)}}}}const ut=JSON.parse(localStorage.getItem("task_google_map")||"{}")[z];if(B&&!ut&&B.status==="deleted"&&H.status&&H.status!=="deleted"){const Te=localStorage.getItem("google_access_token"),$e={...B,...H},be=$e.start_date&&($e.start_time||$e.is_all_day);if(Te&&be){console.log("[Google Sync] Task restored from trash. Recreating Google Event..."),b({msg:" Google ...",type:"info"});const Ie={summary:$e.title,description:$e.description||""},Ke=$e.start_date.split("T")[0];if($e.is_all_day){Ie.start={date:Ke};const Nt=new Date(Ke);Nt.setDate(Nt.getDate()+1),Ie.end={date:Nt.toISOString().split("T")[0]}}else if($e.start_time){const Nt=$e.start_time.length>5?$e.start_time.substring(0,5):$e.start_time,gt=`${Ke}T${Nt}:00`;let Tt="";if($e.end_time)Tt=$e.end_time.length>5?$e.end_time.substring(0,5):$e.end_time;else{const Ae=new Date(gt);Ae.setHours(Ae.getHours()+1);const it=String(Ae.getHours()).padStart(2,"0"),rt=String(Ae.getMinutes()).padStart(2,"0");Tt=`${it}:${rt}`}const Ze=`${Ke}T${Tt}:00`,re=Intl.DateTimeFormat().resolvedOptions().timeZone;Ie.start={dateTime:gt,timeZone:re},Ie.end={dateTime:Ze,timeZone:re}}Ie.start&&Io(Te,"primary",Ie).then(Nt=>{if(Nt){const gt=JSON.parse(localStorage.getItem("task_google_map")||"{}");gt[z]={evtId:Nt,calId:"primary"},localStorage.setItem("task_google_map",JSON.stringify(gt)),b({msg:"Google ",type:"info"})}}).catch(Nt=>console.error("Restore Google Error:",Nt))}}if(B&&!ut){const Te={...B,...H,completed_at:null},$e=H.tags!==void 0?H.tags:B.tags||[],be=a.find(Ke=>$e.includes(Ke.id)&&Ke.name.startsWith("Google:")),Ie=Te.start_date&&(Te.start_time||Te.is_all_day);if(be&&Ie&&Te.status!=="deleted"){const Ke=localStorage.getItem("google_access_token");if(Ke){const Nt=JSON.parse(localStorage.getItem("task_google_map")||"{}");if(((Xe=Nt[z])==null?void 0:Xe.evtId)==="PENDING")return;Nt[z]={evtId:"PENDING",calId:"primary"},localStorage.setItem("task_google_map",JSON.stringify(Nt)),console.log("[Google Sync] Found Google Tag:",be.name,"Creating event..."),b({msg:" Google ...",type:"info"});const gt=be.name.replace("Google:","").trim();let Tt="primary";kl(Ke).then(async Ze=>{var St;const re=Ze.find(zt=>zt.summary===gt);re?(Tt=re.id,console.log("[Google Sync] Resolved Calendar ID:",Tt)):console.warn("[Google Sync] Calendar not found:",gt,"Using primary.");const Ae={summary:Te.title,description:Te.description||""},it=new Date(Te.start_date).toLocaleDateString("en-CA"),rt=Intl.DateTimeFormat().resolvedOptions().timeZone;if(Te.is_all_day){Ae.start={date:it};const zt=new Date(it),Bt=new Date(zt);Bt.setDate(Bt.getDate()+1),Ae.end={date:Bt.toLocaleDateString("en-CA")}}else if(Te.start_time){const zt=Te.start_time.length>5?Te.start_time.substring(0,5):Te.start_time,Bt=`${it}T${zt}:00`;let Gt="";if(Te.end_time)Gt=Te.end_time.length>5?Te.end_time.substring(0,5):Te.end_time;else{const xn=new Date(Bt);xn.setHours(xn.getHours()+1);const Tn=String(xn.getHours()).padStart(2,"0"),bn=String(xn.getMinutes()).padStart(2,"0");Gt=`${Tn}:${bn}`}const an=`${it}T${Gt}:00`;Ae.start={dateTime:Bt,timeZone:rt},Ae.end={dateTime:an,timeZone:rt}}if(Ae.start)try{const zt=await Io(Ke,Tt,Ae);if(zt){const Bt=JSON.parse(localStorage.getItem("task_google_map")||"{}");Bt[z]={evtId:zt,calId:Tt},localStorage.setItem("task_google_map",JSON.stringify(Bt)),b({msg:"Google ",type:"info"})}}catch(zt){console.error("[Google Sync] Creation failed",zt);const Bt=JSON.parse(localStorage.getItem("task_google_map")||"{}");((St=Bt[z])==null?void 0:St.evtId)==="PENDING"&&(delete Bt[z],localStorage.setItem("task_google_map",JSON.stringify(Bt))),b({msg:"Google ",type:"error"})}}).catch(Ze=>{var Ae;console.error("Fetch calendars failed",Ze);const re=JSON.parse(localStorage.getItem("task_google_map")||"{}");((Ae=re[z])==null?void 0:Ae.evtId)==="PENDING"&&(delete re[z],localStorage.setItem("task_google_map",JSON.stringify(re)))})}}}if(pe.length>0&&await ve.from("tasks").update({completed_at:H.completed_at,status:"completed"}).in("id",pe),L.length>0&&await ve.from("tasks").update({parent_id:z}).in("id",L),q&&(B!=null&&B.repeat_rule)&&B.repeat_rule.triggerMode!=="on_schedule"){const Te=U6(B.start_date||new Date().toISOString(),B.repeat_rule);if(Te){const $e={user_id:B.user_id,title:B.title,description:B.repeat_rule.copyDescription!==!1?B.description:null,status:"todo",parent_id:B.parent_id,start_date:Te,due_date:null,is_project:B.is_project,tags:B.tags,color:B.color,order_index:B.order_index,is_all_day:B.is_all_day,start_time:B.is_all_day?null:B.start_time,end_time:B.is_all_day?null:B.end_time,duration:B.duration,reminder_minutes:B.reminder_minutes!==void 0?B.reminder_minutes:null,repeat_rule:B.repeat_rule},{data:be,error:Ie}=await ve.from("tasks").insert($e).select().single();if(be&&!Ie){s(Nt=>{const gt=[...Nt,be];return J.current=gt,gt});const Ke=H6(B.repeat_rule,(Z==null?void 0:Z.language)||"zh");b({msg:`  (${Ke})`,type:"info"})}}}m("synced")},Pi=async(z,H)=>{if(!ve||z.length===0)return;const L=z.filter(({id:Xe})=>{const Te=J.current.find($e=>$e.id===Xe);return Te&&at(Te)});L.length>0&&(console.warn("[batchUpdateTasks] BLOCKED:",L.length,"tasks are locked via Google tag"),b({msg:`${L.length}  Google `,type:"error"}));const G=z.filter(({id:Xe})=>{const Te=J.current.find($e=>$e.id===Xe);return!Te||!at(Te)});if(G.length===0)return;const B=G;if(m("syncing"),le==="inbox"){const Xe=a.find(gt=>gt.name.trim().toLowerCase()==="project"),Te=a.find(gt=>gt.name.includes("")),$e=a.find(gt=>gt.name.trim().toLowerCase()==="note"),be=a.find(gt=>gt.name.trim().toLowerCase()==="prompt"),Ie=a.find(gt=>gt.name==="#prompt"),Ke=a.find(gt=>gt.name.trim().toLowerCase()==="journal"),Nt=a.find(gt=>gt.name.trim().toLowerCase()==="someday");B.forEach(({id:gt,data:Tt})=>{const Ze=J.current.find(re=>re.id===gt);if(Ze&&!Ze.parent_id){const re=Tt.tags||Ze.tags||[],Ae=Ze.tags||[],it=Tt.tags&&(Xe&&re.includes(Xe.id)&&!Ae.includes(Xe.id)||Te&&re.includes(Te.id)&&!Ae.includes(Te.id)||$e&&re.includes($e.id)&&!Ae.includes($e.id)||be&&re.includes(be.id)&&!Ae.includes(be.id)||Ie&&re.includes(Ie.id)&&!Ae.includes(Ie.id)||Ke&&re.includes(Ke.id)&&!Ae.includes(Ke.id)||Nt&&re.includes(Nt.id)&&!Ae.includes(Nt.id)),rt=Tt.status&&(Tt.status==="someday"||Tt.status==="waiting")&&Ze.status!=="someday"&&Ze.status!=="waiting";(Tt.start_date&&!Ze.start_date||Tt.due_date&&!Ze.due_date||Tt.parent_id&&!Ze.parent_id||it||rt)&&!ht.current.includes(gt)&&hn(gt)}})}const q=JSON.parse(localStorage.getItem("task_google_map")||"{}"),pe=B.map(Xe=>{const{google_event_id:Te,google_calendar_id:$e,...be}=Xe.data;return Te&&$e&&(q[Xe.id]={evtId:Te,calId:$e}),{id:Xe.id,data:be}});localStorage.setItem("task_google_map",JSON.stringify(q));const De=localStorage.getItem("google_access_token"),We=[];let Je=!1;De&&z.forEach(({id:Xe,data:Te})=>{const $e=J.current.find(be=>be.id===Xe);if($e&&$e.status==="deleted"&&Te.status&&Te.status!=="deleted"&&!q[Xe]){const be={...$e,...Te};be.start_date&&(be.start_time||be.is_all_day)&&(Je=!0,We.push((async()=>{try{console.log("[batchUpdateTasks] Restoring Google Event for:",Xe);const Ke={summary:be.title,description:be.description||""},Nt=be.start_date.split("T")[0];if(be.is_all_day){Ke.start={date:Nt};const gt=new Date(Nt);gt.setDate(gt.getDate()+1),Ke.end={date:gt.toISOString().split("T")[0]}}else if(be.start_time){const gt=be.start_time.length>5?be.start_time.substring(0,5):be.start_time,Tt=`${Nt}T${gt}:00`;let Ze="";if(be.end_time)Ze=be.end_time.length>5?be.end_time.substring(0,5):be.end_time;else{const it=new Date(Tt);it.setHours(it.getHours()+1);const rt=String(it.getHours()).padStart(2,"0"),St=String(it.getMinutes()).padStart(2,"0");Ze=`${rt}:${St}`}const re=`${Nt}T${Ze}:00`,Ae=Intl.DateTimeFormat().resolvedOptions().timeZone;Ke.start={dateTime:Tt,timeZone:Ae},Ke.end={dateTime:re,timeZone:Ae}}if(Ke.start){const gt=await Io(De,"primary",Ke);gt&&(q[Xe]={evtId:gt,calId:"primary"})}}catch(Ke){console.error("[batchUpdateTasks] Restore Error",Ke)}})()))}}),Je&&(b({msg:" Google ...",type:"info"}),await Promise.all(We),localStorage.setItem("task_google_map",JSON.stringify(q)));const ot=[];let Ct=!1;De&&z.forEach(({id:Xe,data:Te})=>{const $e=J.current.find(Nt=>Nt.id===Xe);if(!$e||Te.status==="deleted"||$e.status==="deleted"&&Te.status&&Te.status!=="deleted")return;const Ie={...$e,...Te},Ke=q[Xe];if(Ke){const Nt={};if(Te.title&&(Nt.summary=Te.title),Te.description!==void 0&&(Nt.description=Te.description),Te.start_date||Te.start_time||Te.end_time||Te.is_all_day!==void 0){const Ze=new Date(Ie.start_date).toLocaleDateString("en-CA"),re=Intl.DateTimeFormat().resolvedOptions().timeZone;if(console.log("[Batch Sync] Date change detected:",{taskId:Xe,is_all_day:Ie.is_all_day,start_time:Ie.start_time,end_time:Ie.end_time,dateStr:Ze}),Ie.is_all_day){Nt.start={date:Ze};const Ae=new Date(Ze);Ae.setDate(Ae.getDate()+1),Nt.end={date:Ae.toLocaleDateString("en-CA")}}else{const Ae=Ie.start_time||"09:00",it=Ie.end_time||"10:00",rt=Ae.length>5?Ae.substring(0,5):Ae,St=`${Ze}T${rt}:00`,zt=it.length>5?it.substring(0,5):it;Nt.end={dateTime:`${Ze}T${zt}:00`,timeZone:re},Nt.start={dateTime:St,timeZone:re}}console.log("[Batch Sync] Payload constructed:",JSON.stringify(Nt,null,2))}if(Te.is_all_day!==void 0&&$e.is_all_day!==Te.is_all_day&&Nt.start&&Nt.end){console.log("[Batch Sync] Event TYPE change detected (is_all_day:",$e.is_all_day,"->",Te.is_all_day,"), using delete+create"),Ct=!0,On.current=!0;const Ze=Ke.evtId;nr.current.add(Ze),console.log("[Batch Sync] Marked old event as replaced:",Ze),ot.push((async()=>{try{await ca(De,Ke.calId,Ze),console.log("[Batch Sync] Old event deleted");const re={summary:Ie.title,description:Ie.description||"",start:Nt.start,end:Nt.end},Ae=await Io(De,Ke.calId,re);console.log("[Batch Sync] New event created:",Ae),nr.current.add(Ae),console.log("[Batch Sync] Marked new event to skip in sync:",Ae);const it=JSON.parse(localStorage.getItem("task_google_map")||"{}");it[Xe]={evtId:Ae,calId:Ke.calId},localStorage.setItem("task_google_map",JSON.stringify(it)),q[Xe]={evtId:Ae,calId:Ke.calId},console.log("[Batch Sync] Event type change completed successfully")}catch(re){console.error("[Batch Sync] Failed to recreate event:",re.message)}finally{On.current=!1}})())}else Object.keys(Nt).length>0&&(Ct=!0,ot.push(e1(De,Ke.calId,Ke.evtId,Nt).then(()=>console.log("[Batch Sync] Update success for task:",Xe)).catch(async Ze=>{const re=Ze.message||"";console.error("[Batch Sync] Update failed for task:",Xe,"Error:",re)})))}else{const Nt=Te.tags!==void 0?Te.tags:$e.tags||[],gt=a.find(Ze=>Nt.includes(Ze.id)&&Ze.name.startsWith("Google:")),Tt=Ie.start_date&&(Ie.start_time||Ie.is_all_day);gt&&Tt&&(Ct=!0,ot.push((async()=>{try{const Ze=gt.name.replace("Google:","").trim();let re="primary";const it=(await kl(De)).find(Bt=>Bt.summary===Ze);it&&(re=it.id);const rt={summary:Ie.title,description:Ie.description||""},St=new Date(Ie.start_date).toLocaleDateString("en-CA"),zt=Intl.DateTimeFormat().resolvedOptions().timeZone;if(Ie.is_all_day){rt.start={date:St};const Bt=new Date(St);Bt.setDate(Bt.getDate()+1),rt.end={date:Bt.toLocaleDateString("en-CA")}}else if(Ie.start_time){const Bt=Ie.start_time.length>5?Ie.start_time.substring(0,5):Ie.start_time,Gt=`${St}T${Bt}:00`;let an="";if(Ie.end_time)an=Ie.end_time.length>5?Ie.end_time.substring(0,5):Ie.end_time;else{const xn=new Date(Gt);xn.setHours(xn.getHours()+1);const Tn=String(xn.getHours()).padStart(2,"0"),bn=String(xn.getMinutes()).padStart(2,"0");an=`${Tn}:${bn}`}rt.start={dateTime:Gt,timeZone:zt},rt.end={dateTime:`${St}T${an}:00`,timeZone:zt}}if(rt.start){const Bt=await Io(De,re,rt);Bt&&(q[Xe]={evtId:Bt,calId:re})}}catch(Ze){console.error("Batch Create Fail",Ze)}})()))}}),Ct&&(b({msg:" Google...",type:"info"}),await Promise.all(ot),localStorage.setItem("task_google_map",JSON.stringify(q)));const ut=[];pe.forEach(({id:Xe,data:Te})=>{X(Xe);const $e=J.current.find(be=>be.id===Xe);if($e){const be={};Object.keys(Te).forEach(Ie=>{be[Ie]=$e[Ie]}),ut.push({id:Xe,before:be,after:Te})}}),ut.length>0&&!(H!=null&&H.skipHistory)&&yn({type:"BATCH_UPDATE",payload:ut});const bt=new Date().toISOString();s(Xe=>{const Te=Xe.map($e=>{const be=pe.find(Ie=>Ie.id===$e.id);return be?{...$e,...be.data,updated_at:bt}:$e});return J.current=Te,Te}),await Promise.all(pe.map(({id:Xe,data:Te})=>ve.from("tasks").update(Te).eq("id",Xe))),m("synced")},er=async(z,H=!1)=>{if(z.length===0)return;const L=z.filter(pe=>{const De=J.current.find(We=>We.id===pe);return De&&at(De)});L.length>0&&(console.warn("[batchDeleteTasks] BLOCKED:",L.length,"tasks are locked via Google tag"),b({msg:`${L.length}  Google `,type:"error"}));const G=z.filter(pe=>{const De=J.current.find(We=>We.id===pe);return!De||!at(De)});if(G.length===0)return;const B=G;if(m("syncing"),!H){const pe=JSON.parse(localStorage.getItem("task_google_map")||"{}"),De=localStorage.getItem("google_access_token");let We=0;if(De){const Ct=B.map(async ut=>{const bt=pe[ut];if(bt)try{console.log("[batchDeleteTasks] Deleting Google Event:",bt.evtId),await ca(De,bt.calId,bt.evtId),delete pe[ut],We++}catch(Xe){console.error("[batchDeleteTasks] Google Delete Error:",Xe)}});await Promise.all(Ct),We>0&&localStorage.setItem("task_google_map",JSON.stringify(pe))}const Je=B.map(Ct=>({id:Ct,data:{status:"deleted"}}));await Pi(Je);const ot=We>0?` ${B.length}  ( ${We}  Google )`:` ${B.length} `;b({msg:ot,undo:()=>_n()});return}const q=J.current.filter(pe=>B.includes(pe.id));if(q.length===0){m("synced");return}if(ve)for(const pe of q){if(pe.attachments&&pe.attachments.length>0)for(const De of pe.attachments)try{const Je=new URL(De.url).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(Je){const ot=Je[1];await ve.storage.from("attachments").remove([ot])}}catch(We){console.warn("Failed to delete attachment:",We)}if(pe.images&&pe.images.length>0)for(const De of pe.images)try{const Je=new URL(De).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(Je){const ot=Je[1];await ve.storage.from("attachments").remove([ot])}}catch(We){console.warn("Failed to delete image:",We)}}if(yn({type:"BATCH_DELETE",payload:{data:q}}),s(pe=>{const De=pe.filter(We=>!z.includes(We.id));return J.current=De,De}),ve)for(let De=0;De<z.length;De+=100){const We=z.slice(De,De+100),{error:Je}=await ve.from("tasks").delete().in("id",We);Je&&console.error("Batch delete chunk error:",Je)}m("synced"),b({msg:` ${z.length} `,type:"info"})},ta=async(z,H=!1)=>{console.warn("[deleteTask] CALLED! id:",z,"permanent:",H);const L=r.find(G=>G.id===z);if(L&&at(L)){console.warn("[deleteTask] BLOCKED: Task is locked via Google tag:",z),b({msg:" Google ",type:"error"});return}if(m("syncing"),X(z),!H){if(L){console.log("[deleteTask] Soft deleting task:",z);const G=JSON.parse(localStorage.getItem("task_google_map")||"{}"),B=G[z];if(B){b({msg:" Google ...",type:"info"});const q=localStorage.getItem("google_access_token");q&&(console.log("[deleteTask] Found Google Event, deleting:",B.evtId),ca(q,B.calId,B.evtId).then(()=>{console.log("[deleteTask] Google Event deleted successfully"),b({msg:"Google ",type:"info"}),delete G[z],localStorage.setItem("task_google_map",JSON.stringify(G))}).catch(pe=>{console.error("[deleteTask] Google Delete Error:",pe),b({msg:"Google : "+pe.message,type:"error"})}))}else console.warn("[deleteTask] No Google mapping found for task:",z);await jn(z,{status:"deleted"}),b({msg:" (v2)",undo:()=>_n()})}return}if(L!=null&&L.attachments&&L.attachments.length>0&&ve)for(const G of L.attachments)try{const q=new URL(G.url).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(q){const pe=q[1];await ve.storage.from("attachments").remove([pe])}}catch(B){console.warn("Failed to delete attachment:",B)}if(L!=null&&L.images&&L.images.length>0&&ve)for(const G of L.images)try{const q=new URL(G).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(q){const pe=q[1];await ve.storage.from("attachments").remove([pe])}}catch(B){console.warn("Failed to delete image:",B)}if(L&&yn({type:"DELETE",payload:{data:L}}),s(G=>{const B=G.filter(q=>q.id!==z);return J.current=B,B}),ve){const{error:G}=await ve.from("tasks").delete().eq("id",z);if(G){lt(G),L&&s(B=>{const q=[L,...B];return J.current=q,q});return}else if(L){const q=JSON.parse(localStorage.getItem("task_google_map")||"{}")[L.id];if(q){const pe=localStorage.getItem("google_access_token");pe&&ca(pe,q.calId,q.evtId).then(()=>b({msg:"Google ",type:"info"})).catch(De=>console.error("Google Delete Error",De))}}}m("synced"),b({msg:"",type:"info"})},ll=async z=>{const H=r.find(L=>L.id===z);H&&H.status==="deleted"&&(await jn(z,{status:"inbox"}),b({msg:" Inbox",type:"info"}))},tr=async()=>{const z=r.filter(L=>L.status==="deleted");if(z.length===0)return;const H=z.map(L=>({id:L.id,data:{status:"inbox"}}));await Pi(H),b({msg:"",type:"info",undo:()=>_n()})},de=async()=>{const z=r.filter(H=>H.status==="deleted");z.length!==0&&await er(z.map(H=>H.id),!0)},Mt=async z=>{if(!ve)return;const H=new Date().toISOString();s(L=>L.map(G=>G.id===z?{...G,reviewed_at:H}:G)),await ve.from("tasks").update({reviewed_at:H}).eq("id",z),b({msg:"",type:"info"})},Ut=async(z,H=null)=>{if(!ve||!z.trim())return null;const L=fl(),B=a.filter(ot=>ot.parent_id===H).reduce((ot,Ct)=>Math.max(ot,Ct.order_index||0),0)+1e4,q=a.find(ot=>ot.id===H),pe=(q==null?void 0:q.color)||"#6366f1",De={id:L,name:z,parent_id:H,user_id:e.id,color:pe,order_index:B};yn({type:"ADD_TAG",payload:{data:De}}),l(ot=>[...ot,De].sort((Ct,ut)=>(Ct.order_index||0)-(ut.order_index||0)));const{data:We,error:Je}=await ve.from("tags").insert([{name:z,parent_id:H,user_id:e.id,color:pe,order_index:B}]).select();return Je?(l(ot=>ot.filter(Ct=>Ct.id!==L)),null):(l(ot=>{const Ct=We[0];return ot.some(bt=>bt.id===Ct.id)?ot.filter(bt=>bt.id!==L):ot.map(bt=>bt.id===L?Ct:bt).sort((bt,Xe)=>(bt.order_index||0)-(Xe.order_index||0))}),We[0].id)},Ht=async(z,H)=>{if(!ve)return;const L=a.find(G=>G.id===z);if(L){const G={};Object.keys(H).forEach(B=>G[B]=L[B]),yn({type:"UPDATE_TAG",payload:{id:z,before:G,after:H}})}l(G=>G.map(B=>B.id===z?{...B,...H}:B).sort((B,q)=>(B.order_index||0)-(q.order_index||0))),await ve.from("tags").update(H).eq("id",z)},$t=async z=>{if(!ve)return;const H=a.find(L=>L.id===z);H&&yn({type:"DELETE_TAG",payload:{data:H}}),l(L=>L.filter(G=>G.id!==z)),await ve.from("tags").delete().eq("id",z)},rn=(z,H)=>{$(L=>{const G=L.includes(z),B=H!==void 0?H?G?L:[...L,z]:L.filter(q=>q!==z):G?L.filter(q=>q!==z):[...L,z];return e!=null&&e.id&&localStorage.setItem(`expanded_tasks_${e.id}`,JSON.stringify(B)),B})},Dn=z=>{Ce(H=>{const L=typeof z=="function"?z(H):z;return e!=null&&e.id&&localStorage.setItem(`last_view_${e.id}`,L),L!==H&&Be([]),L})},Bn=z=>{oe(z),e!=null&&e.id&&localStorage.setItem(`sidebar_width_${e.id}`,z.toString())},zn=()=>Ue(z=>!z),Rn=z=>{Se(H=>{const L=typeof z=="function"?z(H):z;return e!=null&&e.id&&localStorage.setItem(`expanded_tags_${e.id}`,JSON.stringify(L)),L})},hn=z=>{Be(H=>H.includes(z)?H:[...H,z])},xr=()=>{Be([])},ar=z=>{ie(H=>{const L=typeof z=="function"?z(H):z;return e!=null&&e.id&&localStorage.setItem(`theme_settings_${e.id}`,JSON.stringify(L)),L})},js=async(z,H)=>{const L=new Date,G=L.getFullYear(),B=String(L.getMonth()+1).padStart(2,"0"),q=String(L.getDate()).padStart(2,"0"),pe=`${G}-${B}-${q}`,De=bt=>a.find(Xe=>bt.some(Te=>Xe.name.trim().toLowerCase()===Te.toLowerCase())),We=De(["project",""]),Je=De(["someday"]),ot=De(["journal","note","",""]),Ct=De(["prompt",""]);for(const bt of z){const Xe=J.current.find(Te=>Te.id===bt);if(Xe)switch(H){case"today":case"newtable":await jn(bt,{start_date:pe});break;case"project":if(We){const Te=Xe.tags.includes(We.id)?Xe.tags:[...Xe.tags,We.id];await jn(bt,{tags:Te}),J.current.some(be=>be.parent_id===bt&&be.status!=="deleted")||await Co({title:"",parent_id:bt,status:"active",importance:null,tags:[],notes:"",start_date:null,due_date:null})}break;case"waiting":if(Je){const Te=Xe.tags.includes(Je.id)?Xe.tags:[...Xe.tags,Je.id];await jn(bt,{tags:Te,status:"someday"})}else await jn(bt,{status:"someday"});break;case"journal":if(ot){const Te=Xe.tags.includes(ot.id)?Xe.tags:[...Xe.tags,ot.id];await jn(bt,{tags:Te})}break;case"prompt":if(Ct){const Te=Xe.tags.includes(Ct.id)?Xe.tags:[...Xe.tags,Ct.id];await jn(bt,{tags:Te})}break}}v([]),k(null);const ut={today:"",newtable:"",project:"",waiting:"/",journal:"",prompt:""};b({msg:` ${z.length} ${ut[H]||H}`,type:"info"})},qs=x.useRef(!1),On=x.useRef(!1),nr=x.useRef(new Set),Mr=async()=>{var H,L,G,B,q,pe;if(console.log("[Google Sync] Attempting sync..."),qs.current){console.log("[Google Sync] Already syncing, skipping.");return}if(On.current){console.log("[Google Sync] Event recreation in progress, skipping to avoid conflicts.");return}let z=localStorage.getItem("google_access_token");if(!z){console.log("[Google Sync] No token found, skipping.");return}try{const De=await fetch("https://www.googleapis.com/calendar/v3/users/me/calendarList?maxResults=1",{headers:{Authorization:`Bearer ${z}`}});if(De.status===401){console.log("[Google Sync] Token expired, attempting silent refresh...");const We=localStorage.getItem("google_client_id");if(We&&((L=(H=window.google)==null?void 0:H.accounts)!=null&&L.oauth2))try{const Je=await new Promise(ot=>{window.google.accounts.oauth2.initTokenClient({client_id:We,scope:"https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar.readonly",callback:ut=>{ut.error?(console.log("[Google Sync] Silent refresh failed:",ut.error),ot(null)):(console.log("[Google Sync] Silent refresh successful!"),ot(ut.access_token))}}).requestAccessToken({prompt:""}),setTimeout(()=>ot(null),5e3)});if(Je)z=Je,localStorage.setItem("google_access_token",Je),console.log("[Google Sync] Token refreshed successfully");else{console.error("[Google Sync] Silent refresh returned no token"),b({msg:"Google  Google ",type:"error"}),localStorage.removeItem("google_access_token");return}}catch(Je){console.error("[Google Sync] Silent refresh error:",Je),b({msg:"Google  Google ",type:"error"}),localStorage.removeItem("google_access_token");return}else{console.log("[Google Sync] Google script not loaded, attempting to load...");try{const{loadGoogleScript:Je}=await hv(()=>Promise.resolve().then(()=>V6),void 0);await Je(),b({msg:"Google  Google ",type:"error"})}catch{b({msg:"Google  Google ",type:"error"})}localStorage.removeItem("google_access_token");return}}else if(!De.ok){console.error("[Google Sync] Token validation failed:",De.status),b({msg:"Google API ",type:"error"});return}}catch(De){console.error("[Google Sync] Token validation error:",De),b({msg:" Google ",type:"error"});return}console.log("[Google Sync] Starting sync..."),console.log("[Google Sync] replacedEventIdsRef has",nr.current.size,"entries:",Array.from(nr.current)),qs.current=!0;try{const De=JSON.parse(localStorage.getItem("task_google_map")||"{}"),We=new Set;Object.values(De).forEach(be=>{be.calId&&We.add(be.calId)});let Je=[];try{window.google_calendar_list_cache?Je=window.google_calendar_list_cache:(Je=await kl(z),window.google_calendar_list_cache=Je)}catch(be){console.error("[Google Sync] List Calendars Check failed",be)}const ot=a.filter(be=>be.name.startsWith("Google:"));if(console.log("[Google Sync] Found Google tags:",ot.map(be=>be.name)),Je.length>0){const be=a.filter(Ie=>Ie.name.startsWith("Google:")).map(Ie=>Ie.name.replace("Google:","").trim());console.log("[Google Sync] Tag names to match:",be),be.forEach(Ie=>{const Ke=Je.find(Nt=>Nt.summary===Ie);console.log(`[Google Sync] Matching "${Ie}" -> ${Ke?Ke.id:"NOT FOUND"}`),Ke&&We.add(Ke.id)})}else console.log("[Google Sync] No calendars to match against");const Ct=JSON.parse(localStorage.getItem("google_sync_tokens")||"{}");let ut=[...J.current];const bt={...De};let Xe=!1;console.log("[Google Sync] Syncing calendars:",Array.from(We));for(const be of Array.from(We)){const Ie=Ct[be];console.log(`[Google Sync] Checking calendar: ${be}, hasToken: ${!!Ie}`);try{const{events:Ke,nextSyncToken:Nt,fullSyncRequired:gt}=await kI(z,be,Ie);if(console.log(`[Google Sync] Calendar ${be}: ${Ke.length} events, fullSyncRequired: ${gt}`),gt){console.log(`[Google Sync] Full sync required for ${be}, will retry next time.`),delete Ct[be];continue}if(Nt&&(Ct[be]=Nt),Ke.length>0){console.log(`[Google Sync] Got ${Ke.length} updates for ${be}:`,Ke.map(Tt=>({id:Tt.id,summary:Tt.summary,status:Tt.status}))),Xe=!0;for(const Tt of Ke){if(nr.current.has(Tt.id)){console.log("[Google Sync] Ignoring replaced event (type change in progress):",Tt.id);continue}const Ze=Object.keys(bt).find(re=>bt[re].evtId===Tt.id);if(console.log(`[Google Sync] Processing event: "${Tt.summary}" (${Tt.id})`,{hasMapping:!!Ze,mappedTaskId:Ze||"none",eventStatus:Tt.status}),Tt.status==="cancelled"){if(Ze){const re=bt[Ze];if(re&&re.calId===be){const Ae=ut.find(it=>it.id===Ze);Ae&&Ae.status!=="deleted"&&(X(Ze),ut=ut.map(it=>it.id===Ze?{...it,status:"deleted"}:it),ve&&await ve.from("tasks").update({status:"deleted"}).eq("id",Ze),console.log("[Google Auto-Sync] Deleted Task",Ze,"from calendar",be))}else console.log(`[Google Sync] Ignored deletion of ${Ze} from ${be} (mapped to ${re==null?void 0:re.calId})`)}}else{const re=Tt.summary||"(No Title)",Ae=Tt.description||"";let it=null,rt=null,St=null,zt=!1;if(Tt.start.date)zt=!0,it=Tt.start.date;else if(Tt.start.dateTime){const Bt=new Date(Tt.start.dateTime);it=Bt.toLocaleDateString("en-CA"),rt=Bt.toTimeString().substring(0,5),Tt.end.dateTime&&(St=new Date(Tt.end.dateTime).toTimeString().substring(0,5))}if(it)if(Ze){const Bt=ut.findIndex(Gt=>Gt.id===Ze);if(Bt!==-1){const Gt=ut[Bt],an=Gt.status==="deleted",xn=Gt.title!==re||Gt.description!==Ae||((G=Gt.start_date)==null?void 0:G.split("T")[0])!==it||(Gt.start_time||"").substring(0,5)!==(rt||"")||(Gt.end_time||"").substring(0,5)!==(St||"")||Gt.is_all_day!==zt||an;console.log(`[Google Sync] Checking update for "${re}": changed=${xn}, isDeleted=${an}`,{oldTitle:Gt.title,newTitle:re,oldDate:(B=Gt.start_date)==null?void 0:B.split("T")[0],newDate:it,oldIsAllDay:Gt.is_all_day,newIsAllDay:zt,oldStartTime:Gt.start_time,newStartTime:rt});const Tn=(q=bt[Ze])==null?void 0:q.calId,bn=Tn&&Tn!==be;if(xn||bn){const br={title:re,description:Ae,start_date:it,is_all_day:zt,status:"todo"};rt&&(br.start_time=rt),St&&(br.end_time=St);let Lr=[...Gt.tags||[]];if(Je.length>0){const fi=Je.find(na=>na.id===be)||(be==="primary"?Je.find(na=>na.primary):null);if(fi){const na=`Google:${fi.summary}`,cl=a.find(Hu=>Hu.name===na);if(bn){const Hu=a.filter(ra=>ra.name.startsWith("Google:")).map(ra=>ra.id);Lr=Lr.filter(ra=>!Hu.includes(ra)),console.log("[Google Sync] Calendar changed from",Tn,"to",be)}cl&&!Lr.includes(cl.id)&&(Lr.push(cl.id),console.log("[Google Sync] Switched tag to:",na)),br.tags=Lr,bt[Ze]={evtId:Tt.id,calId:be}}}ut[Bt]={...Gt,...br},X(Ze),ve&&await ve.from("tasks").update(br).eq("id",Ze),console.log("[Google Sync] Updated Task",Ze,"with",br),Xe=!0}}else{console.log(`[Google Sync] Stale mapping for "${re}" (taskId: ${Ze}), trying to find by title...`),delete bt[Ze];const Gt=a.filter(xn=>xn.name.startsWith("Google:")).map(xn=>xn.id),an=ut.find(xn=>{var Tn;return xn.title===re&&xn.status!=="deleted"&&((Tn=xn.tags)==null?void 0:Tn.some(bn=>Gt.includes(bn)))});if(an){console.log(`[Google Sync] Found matching task by title: "${re}" -> ${an.id}`);const xn=ut.findIndex(Tn=>Tn.id===an.id);if(xn!==-1){const Tn=ut[xn],bn=Tn.status==="deleted",br=Tn.title!==re||Tn.description!==Ae||((pe=Tn.start_date)==null?void 0:pe.split("T")[0])!==it||(Tn.start_time||"").substring(0,5)!==(rt||"")||(Tn.end_time||"").substring(0,5)!==(St||"")||Tn.is_all_day!==zt||bn;if(console.log(`[Google Sync] (Recovered) Checking update for "${re}": changed=${br}`),br){const Lr={title:re,description:Ae,start_date:it,is_all_day:zt,status:"todo"};rt&&(Lr.start_time=rt),St&&(Lr.end_time=St),ut[xn]={...Tn,...Lr},X(an.id),ve&&await ve.from("tasks").update(Lr).eq("id",an.id),console.log("[Google Sync] (Recovered) Updated Task",an.id,"with",Lr),Xe=!0}bt[an.id]={evtId:Tt.id,calId:be},console.log("[Google Sync] Updated mapping:",an.id,"->",Tt.id)}}else console.log(`[Google Sync] No matching task found for "${re}", will be created on next sync if tag exists`)}}else{const Bt=JSON.parse(localStorage.getItem("task_google_map")||"{}");if(Object.values(Bt).some(bn=>bn.evtId===Tt.id)){console.log("[Google Sync] Event already mapped (found in fresh check), skipping creation:",Tt.id);continue}let an=[],xn=!1;if(Je.length>0){let bn=Je.find(br=>br.id===be);if(!bn&&be==="primary"&&(bn=Je.find(br=>br.primary===!0)),bn){const br=`Google:${bn.summary}`,Lr=a.find(fi=>fi.name===br);Lr?(an.push(Lr.id),console.log("[Google Sync] Assigned tag:",br,"to new task:",re),xn=!0):console.log("[Google Sync] Tag not found:",br,"- skipping creation")}}if(!xn)continue;const Tn={user_id:e==null?void 0:e.id,title:re,description:Ae,status:"todo",start_date:it,start_time:rt,end_time:St,is_all_day:zt,tags:an,order_index:0};if(ve&&e){const{data:bn}=await ve.from("tasks").insert(Tn).select().single();bn&&(ut.push(bn),bt[bn.id]={evtId:Tt.id,calId:be},console.log("[Google Sync] Created Task",bn.id,"with mapping:",{evtId:Tt.id,calId:be},"title:",re))}}}}}}catch{}}Xe&&(ut.sort((be,Ie)=>(be.order_index||0)-(Ie.order_index||0)||be.created_at.localeCompare(Ie.created_at)),s(ut),b({msg:"Google ",type:"info"}));const $e={...JSON.parse(localStorage.getItem("task_google_map")||"{}"),...bt};localStorage.setItem("task_google_map",JSON.stringify($e)),localStorage.setItem("google_sync_tokens",JSON.stringify(Ct)),console.log("[Google Sync] Saved",Object.keys(bt).length,"mappings. Total:",Object.keys($e).length)}finally{console.log("[Google Sync] Sync completed."),qs.current=!1,nr.current.size>0&&(console.log("[Google Sync] Cleared",nr.current.size,"replaced event IDs"),nr.current.clear())}};return x.useEffect(()=>{if(console.log("[Google Sync] useEffect running, user:",!!e),!e)return;console.log("[Google Sync] Setting up 60s interval and 3s initial timeout...");const z=setInterval(()=>{console.log("[Google Sync] 60s interval triggered"),Mr()},6e4),H=setTimeout(()=>{console.log("[Google Sync] Initial 3s timeout triggered"),Mr()},3e3);return()=>{console.log("[Google Sync] Cleaning up interval and timeout"),clearInterval(z),clearTimeout(H)}},[e,a]),c.jsx(En.Provider,{value:{user:e,tasks:r,tags:a,visibleTasks:Nn,loading:u,syncStatus:p,dragState:ye,startDrag:ea,updateDropState:di,endDrag:il,updateGhostPosition:Zo,addTask:Co,batchAddTasks:al,duplicateTasks:cc,updateTask:jn,batchUpdateTasks:Pi,deleteTask:ta,batchDeleteTasks:er,addTag:Ut,updateTag:Ht,deleteTag:$t,keyboardMove:ol,smartReschedule:Fe,lockTask:He,unlockTask:Ye,verifyTaskPassword:ee,temporarilyUnlockTask:P,archiveCompletedTasks:xe,archivedTasks:i,restoreArchivedTask:Pe,deleteArchivedTask:et,updateArchivedTask:_t,batchDeleteArchivedTasks:Vt,clearAllTasks:Xt,exportData:Jt,importData:fn,syncGoogleToApp:Mr,undo:_n,redo:Fn,canUndo:nt.length>0,canRedo:ct.length>0,logout:Hn,navigateToTask:is,navigateBack:Gs,canNavigateBack:It.length>0,toast:y,setToast:b,selectedTaskIds:g,setSelectedTaskIds:v,handleSelection:Oi,selectionAnchor:w,setSelectionAnchor:T,focusedTaskId:R,setFocusedTaskId:k,editingTaskId:I,setEditingTaskId:E,inlineEditingTaskId:fe,setInlineEditingTaskId:Re,expandedTaskIds:O,setExpandedTaskIds:$,toggleExpansion:rn,view:le,setView:Dn,tagFilter:Le,setTagFilter:Ve,advancedFilters:vt,setAdvancedFilters:te,themeSettings:Z,setThemeSettings:ar,calculateVisibleTasks:ui,pendingFocusTaskId:ke,setPendingFocusTaskId:Me,leavingTaskIds:st,addLeavingTask:hn,dismissLeavingTasks:xr,initError:f,sidebarWidth:Dt,setSidebarWidth:Bn,sidebarCollapsed:Ee,toggleSidebar:zn,expandedTags:ue,setExpandedTags:Rn,calendarDate:qe,setCalendarDate:xt,taskCounts:Et,focusSplitWidth:tt,setFocusSplitWidth:Ne,reviewTask:Mt,restoreTask:ll,restoreTrash:tr,emptyTrash:de,moveTaskToView:js,isCmdPressed:pt,tagsWithResolvedColors:_e,language:he,setLanguage:se,t:Q,viewTagFilters:A,updateViewTagFilter:ae,constructionModeEnabled:me,setConstructionModeEnabled:F,searchHistory:W,addSearchHistory:Ft,deleteSearchHistory:nn,searchOpen:D,setSearchOpen:ge,lockedGoogleTagIds:U,toggleGoogleTagLock:Oe,isTaskGoogleLocked:at},children:t})},Ru=x.createContext({isRecording:!1,recordingTime:0,startRecording:async()=>{},stopRecording:()=>{},cancelRecording:()=>{},addMarker:()=>null,recordingTaskId:null,audioMarkers:[],currentRecordingId:null,analyser:null,audioContext:null}),q6=({children:t})=>{x.useContext(En);const[e,n]=x.useState(!1),[r,s]=x.useState(0),[i,o]=x.useState(null),[a,l]=x.useState([]),[u,d]=x.useState(null),f=x.useRef(null),h=x.useRef(null),p=x.useRef(null),m=x.useRef(null),y=x.useRef(null),b=x.useRef([]),g=x.useRef(null),v=x.useRef(0),w=x.useRef(e),T=x.useRef(r),R=x.useRef(i),k=x.useRef(a);x.useEffect(()=>{w.current=e,T.current=r,R.current=i,k.current=a},[e,r,i,a]);const M=async E=>{if(e){console.warn("[RecordingContext] Cannot start recording - another recording is already in progress for task:",i);return}try{const I=await navigator.mediaDevices.getUserMedia({audio:!0});y.current=I;const P=new(window.AudioContext||window.webkitAudioContext);h.current=P;const O=P.createAnalyser();O.fftSize=2048,p.current=O;const $=P.createMediaStreamSource(I);$.connect(O),m.current=$;const A=MediaRecorder.isTypeSupported("audio/mp4")?"audio/mp4":"audio/webm",j=new MediaRecorder(I,{mimeType:A,audioBitsPerSecond:32e3});f.current=j,b.current=[];const W=`rec_${Date.now()}_${crypto.randomUUID()}`;d(W),j.ondataavailable=V=>{V.data.size>0&&b.current.push(V.data)},j.onstop=async()=>{const V=new Blob(b.current,{type:A}),D=A.split("/")[1],ge=new Date,F=`Recording ${`${ge.getFullYear()}.${String(ge.getMonth()+1).padStart(2,"0")}.${String(ge.getDate()).padStart(2,"0")} ${String(ge.getHours()).padStart(2,"0")}:${String(ge.getMinutes()).padStart(2,"0")}`}.${D}`,U=new File([V],F,{type:A});y.current&&y.current.getTracks().forEach(at=>at.stop()),h.current&&h.current.state!=="closed"&&h.current.close();const ne=R.current,Oe=k.current;ne?(console.log(`[RecordingContext] Saving recording for Task ${ne}`,U,Oe),window.dispatchEvent(new CustomEvent("audio-recording-completed",{detail:{file:U,taskId:ne,markers:Oe,duration:T.current,recordingId:W}}))):console.warn("Recording stopped but no Task ID associated."),n(!1),o(null),l([]),s(0),d(null)},j.start(100),n(!0),o(E||null),s(0),l([]),v.current=Date.now(),g.current=setInterval(()=>{const V=Date.now()-v.current;s(V)},100)}catch(I){console.error("[RecordingContext] Failed to start recording",I)}},S=()=>{f.current&&f.current.state!=="inactive"&&f.current.stop(),g.current&&(clearInterval(g.current),g.current=null)},C=()=>{f.current&&f.current.state!=="inactive"&&(f.current.onstop=null,f.current.stop()),g.current&&(clearInterval(g.current),g.current=null),y.current&&y.current.getTracks().forEach(E=>E.stop()),h.current&&h.current.state!=="closed"&&h.current.close(),n(!1),o(null),l([]),s(0)},_=()=>{if(!e)return null;const E=r,P={id:`rec-marker-${Date.now()}`,time:E};return l(O=>[...O,P]),P};return c.jsx(Ru.Provider,{value:{isRecording:e,recordingTime:r,startRecording:M,stopRecording:S,cancelRecording:C,addMarker:_,recordingTaskId:i,audioMarkers:a,currentRecordingId:u,analyser:p.current,audioContext:h.current},children:t})},_I=x.createContext({reminders:[],addReminder:()=>{},markAsSeen:()=>{},snoozeReminder:()=>{},clearAllSeen:()=>{},clearAllUnseen:()=>{},clearAll:()=>{},unseenCount:0,isReminderPanelOpen:!1,setIsReminderPanelOpen:()=>{}}),c2="app_reminders",u2="app_reminder_signatures",Y6=1e4,J6=({children:t})=>{const{tasks:e,setToast:n,user:r}=x.useContext(En),[s,i]=x.useState([]),[o,a]=x.useState(!1),[l,u]=x.useState({}),[d,f]=x.useState(!1),h=x.useRef(null),p=x.useRef(!1),m=x.useRef(null),y=x.useRef([]),b=x.useRef({}),g=x.useRef([]),v=x.useRef(!1);x.useEffect(()=>{y.current=s},[s]),x.useEffect(()=>{b.current=l},[l]),x.useEffect(()=>{g.current=e},[e]),x.useEffect(()=>{v.current=d},[d]),x.useEffect(()=>{(async()=>{const E=(r==null?void 0:r.id)||null;if(!(m.current===E&&p.current)){if(!E){i([]),u({}),f(!1),m.current=null,p.current=!0;return}if(m.current=E,ve)try{const{data:I,error:P}=await ve.from("reminders").select("*").eq("user_id",E).order("triggered_at",{ascending:!1});if(!P&&I){f(!0);const O=I.map(A=>({id:A.id,task_id:A.task_id,task_title:A.task_title,task_color:A.task_color||"gray",triggered_at:A.triggered_at,due_time:A.due_time,seen:A.seen||!1,snoozed_until:A.snoozed_until||null}));i(O);const{data:$}=await ve.from("reminder_signatures").select("*").eq("user_id",E);if($){const A={};$.forEach(j=>{A[j.task_id]=j.signature}),u(A),b.current=A}console.log("[Reminder] Loaded from Supabase:",O.length),p.current=!0;return}}catch(I){console.warn("[Reminder] Supabase load failed, falling back to local:",I)}f(!1);try{const I=localStorage.getItem(c2);I&&i(JSON.parse(I));const P=localStorage.getItem(u2);if(P){const O=JSON.parse(P);u(O),b.current=O}}catch(I){console.error(I)}p.current=!0}})()},[r==null?void 0:r.id]),x.useEffect(()=>{if(!(r!=null&&r.id)||!ve)return;if(!d){console.log("[Reminder] Sync disabled, skipping subscription");return}console.log("[Reminder] Subscribing to realtime channels...");const _=ve.channel("reminders-sync",{config:{broadcast:{self:!1}}}).on("postgres_changes",{event:"*",schema:"public",table:"reminders",filter:`user_id=eq.${r.id}`},I=>{if(I.eventType==="INSERT"){const P=I.new;i(O=>O.some($=>$.id===P.id)?O:[{id:P.id,task_id:P.task_id,task_title:P.task_title,task_color:P.task_color||"gray",triggered_at:P.triggered_at,due_time:P.due_time,seen:P.seen||!1,snoozed_until:P.snoozed_until||null},...O])}else if(I.eventType==="UPDATE"){const P=I.new;i(O=>O.map($=>$.id===P.id?{...$,seen:P.seen||!1,snoozed_until:P.snoozed_until||null}:$))}else if(I.eventType==="DELETE"){const P=I.old;i(O=>O.filter($=>$.id!==P.id))}}).on("broadcast",{event:"clear-action"},I=>{I.payload.type==="clearSeen"?i(P=>P.filter(O=>!O.seen)):I.payload.type==="clearUnseen"?i(P=>P.filter(O=>O.seen)):I.payload.type==="clearAll"&&i([])}).subscribe(I=>{I==="SUBSCRIBED"&&console.log("[Reminder] Reminders channel subscribed")}),E=ve.channel("signatures-sync").on("postgres_changes",{event:"INSERT",schema:"public",table:"reminder_signatures",filter:`user_id=eq.${r.id}`},I=>{const P=I.new;u(O=>O[P.task_id]===P.signature?O:{...O,[P.task_id]:P.signature})}).subscribe(I=>{I==="SUBSCRIBED"&&console.log("[Reminder] Signatures channel subscribed")});return()=>{console.log("[Reminder] Unsubscribing..."),ve.removeChannel(_),ve.removeChannel(E)}},[r==null?void 0:r.id,d]),x.useEffect(()=>{!p.current||d||localStorage.setItem(c2,JSON.stringify(s))},[s,d]),x.useEffect(()=>{!p.current||d||localStorage.setItem(u2,JSON.stringify(l))},[l,d]);const w=x.useCallback(async(_,E,I=!0)=>{const P=g.current.find($=>$.id===_);if(!P)return;const O=P.start_date||P.due_date;if(O){if(v.current&&ve&&(r!=null&&r.id)){const{error:$}=await ve.from("reminder_signatures").insert([{user_id:r.id,task_id:_,signature:E}]);if($){const{data:j}=await ve.from("reminder_signatures").select("signature").eq("user_id",r.id).eq("task_id",_).single();if(j&&j.signature===E){u(W=>({...W,[_]:E}));return}j&&await ve.from("reminder_signatures").update({signature:E}).eq("user_id",r.id).eq("task_id",_)}const A=(await hv(()=>import("./index-c620dda6.js"),[])).v4();await ve.from("reminders").insert([{id:A,user_id:r.id,task_id:_,task_title:P.title,task_color:P.color,triggered_at:new Date().toISOString(),due_time:O,seen:!1}]),u(j=>({...j,[_]:E}))}else{const $={id:`${_}_${Date.now()}`,task_id:_,task_title:P.title,task_color:P.color,triggered_at:new Date().toISOString(),due_time:O,seen:!1,snoozed_until:null};i(A=>[$,...A]),u(A=>({...A,[_]:E})),I&&(n({type:"info",msg:` : ${P.title}`,actionLabel:"",onClick:()=>a(!0)}),"Notification"in window&&Notification.permission==="granted"&&(new Notification("",{body:P.title,icon:"/favicon.ico"}).onclick=()=>{window.focus(),a(!0)}),a(!0))}v.current&&I&&(n({type:"info",msg:` : ${P.title}`,actionLabel:"",onClick:()=>a(!0)}),"Notification"in window&&Notification.permission==="granted"&&(new Notification("",{body:P.title,icon:"/favicon.ico"}).onclick=()=>{window.focus(),a(!0)}),a(!0))}},[n,r==null?void 0:r.id]),T=x.useCallback(async _=>{i(E=>E.map(I=>I.id===_?{...I,seen:!0}:I)),v.current&&ve&&await ve.from("reminders").update({seen:!0}).eq("id",_)},[]),R=x.useCallback(async(_,E)=>{const I=new Date(Date.now()+E*60*1e3).toISOString();i(P=>P.map(O=>O.id===_?{...O,snoozed_until:I,seen:!0}:O)),n({type:"info",msg:`  ${E} `}),v.current&&ve&&await ve.from("reminders").update({snoozed_until:I,seen:!0}).eq("id",_)},[n]),k=x.useCallback(async()=>{const E=y.current.filter(I=>I.seen).map(I=>I.id);i(I=>I.filter(P=>!P.seen)),v.current&&ve&&E.length>0&&(await ve.channel("reminders-sync").send({type:"broadcast",event:"clear-action",payload:{type:"clearSeen"}}),await ve.from("reminders").delete().in("id",E))},[]),M=x.useCallback(async()=>{const E=y.current.filter(I=>!I.seen).map(I=>I.id);i(I=>I.filter(P=>P.seen)),v.current&&ve&&E.length>0&&(await ve.channel("reminders-sync").send({type:"broadcast",event:"clear-action",payload:{type:"clearUnseen"}}),await ve.from("reminders").delete().in("id",E))},[]),S=x.useCallback(async()=>{i([]),v.current&&ve&&(r!=null&&r.id)&&(await ve.channel("reminders-sync").send({type:"broadcast",event:"clear-action",payload:{type:"clearAll"}}),await ve.from("reminders").delete().eq("user_id",r.id))},[r==null?void 0:r.id]),C=x.useCallback(()=>{if(!p.current)return;const _=new Date,E=g.current,I=b.current;E.forEach(P=>{if(["completed","deleted","canceled"].includes(P.status))return;const O=P.start_date||P.due_date;if(!O)return;let $;if(P.is_all_day||!P.start_time)$=new Date(O),O.includes("T")||$.setHours(0,0,0,0);else{const[V,D]=(P.start_time||"00:00").split(":").map(Number),ge=O.split("T")[0];$=new Date(ge),$.setHours(V,D,0,0)}let A=P.reminder_minutes;if(A===void 0)try{const V=localStorage.getItem(`task_reminder_${P.id}`);V&&(A=JSON.parse(V))}catch{}if(A===void 0&&!P.is_all_day&&P.start_time&&(A=0),A==null)return;const j=new Date($.getTime()-A*60*1e3),W=`${$.getTime()}_${A}`;I[P.id]!==W&&_>=j&&w(P.id,W,!0)}),y.current.forEach(async P=>{if(P.snoozed_until){const O=new Date(P.snoozed_until);_>=O&&(E.find(A=>A.id===P.task_id)&&(n({type:"info",msg:` : ${P.task_title}`,actionLabel:"",onClick:()=>a(!0)}),"Notification"in window&&Notification.permission==="granted"&&(new Notification("",{body:P.task_title}).onclick=()=>{window.focus(),a(!0)}),a(!0)),i(A=>A.map(j=>j.id===P.id?{...j,snoozed_until:null,seen:!1}:j)),v.current&&ve&&await ve.from("reminders").update({snoozed_until:null,seen:!1}).eq("id",P.id))}})},[w,n]);return x.useEffect(()=>{const _=setTimeout(C,2e3);return h.current=setInterval(C,Y6),()=>{clearTimeout(_),h.current&&clearInterval(h.current)}},[C]),c.jsx(_I.Provider,{value:{reminders:s,addReminder:w,markAsSeen:T,snoozeReminder:R,clearAllSeen:k,clearAllUnseen:M,clearAll:S,unseenCount:s.filter(_=>!_.seen).length,isReminderPanelOpen:o,setIsReminderPanelOpen:a},children:t})};var X6={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Q6=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Z6=(t,e)=>{const n=x.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:a,...l},u)=>x.createElement("svg",{ref:u,...X6,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:`lucide lucide-${Q6(t)}`,...l},[...e.map(([d,f])=>x.createElement(d,f)),...(Array.isArray(a)?a:[a])||[]]));return n.displayName=`${t}`,n};var wt=Z6;const Jf=wt("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),ez=wt("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),am=wt("Archive",[["rect",{width:"20",height:"5",x:"2",y:"4",rx:"2",key:"uhwcea"}],["path",{d:"M4 9v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9",key:"shkvi4"}],["path",{d:"M10 13h4",key:"ytezjc"}]]),TI=wt("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Nv=wt("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),tz=wt("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),nz=wt("AtSign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),t1=wt("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Wa=wt("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),rz=wt("Bold",[["path",{d:"M14 12a4 4 0 0 0 0-8H6v8",key:"v2sylx"}],["path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z",key:"1ef5ya"}]]),xf=wt("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]),CI=wt("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}]]),sz=wt("Bot",[["rect",{width:"18",height:"10",x:"3",y:"11",rx:"2",key:"1ofdy3"}],["circle",{cx:"12",cy:"5",r:"2",key:"f1ur92"}],["path",{d:"M12 7v4",key:"xawao1"}],["line",{x1:"8",x2:"8",y1:"16",y2:"16",key:"h6x27f"}],["line",{x1:"16",x2:"16",y1:"16",y2:"16",key:"5lty7f"}]]),fd=wt("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),iz=wt("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]),EI=wt("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]),vo=wt("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),bf=wt("CheckCircle2",[["path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",key:"14v8dr"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),oz=wt("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),Xn=wt("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),ts=wt("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Ou=wt("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),rs=wt("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),yp=wt("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),az=wt("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Ri=wt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),lz=wt("CloudLightning",[["path",{d:"M6 16.326A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 .5 8.973",key:"1cez44"}],["path",{d:"m13 12-3 5h4l-3 5",key:"1t22er"}]]),cz=wt("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),uz=wt("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]),dz=wt("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]),NI=wt("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),fz=wt("CornerDownRight",[["polyline",{points:"15 10 20 15 15 20",key:"1q7qjw"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),jI=wt("CornerUpLeft",[["polyline",{points:"9 14 4 9 9 4",key:"881910"}],["path",{d:"M20 20v-7a4 4 0 0 0-4-4H4",key:"1nkjon"}]]),hz=wt("Crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]),iu=wt("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),II=wt("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),pz=wt("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Xf=wt("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),mz=wt("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),gz=wt("FolderKanban",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]]),yz=wt("FolderOpen",[["path",{d:"m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.93a2 2 0 0 1 1.66.9l.82 1.2a2 2 0 0 0 1.66.9H18a2 2 0 0 1 2 2v2",key:"1nmvlm"}]]),xz=wt("FolderPlus",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["line",{x1:"12",x2:"12",y1:"10",y2:"16",key:"3c25pp"}],["line",{x1:"9",x2:"15",y1:"13",y2:"13",key:"10hoct"}]]),bz=wt("FolderTree",[["path",{d:"M13 10h7a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"10jzg2"}],["path",{d:"M13 21h7a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.88a1 1 0 0 1-.9-.55l-.44-.9a1 1 0 0 0-.9-.55H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"1b9nqm"}],["path",{d:"M3 3v2c0 1.1.9 2 2 2h3",key:"1wqwis"}],["path",{d:"M3 3v13c0 1.1.9 2 2 2h3",key:"1bqeom"}]]),vz=wt("GanttChartSquare",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 8h7",key:"kbo1nt"}],["path",{d:"M8 12h6",key:"ikassy"}],["path",{d:"M11 16h5",key:"oq65wt"}]]),MI=wt("GripHorizontal",[["circle",{cx:"12",cy:"9",r:"1",key:"124mty"}],["circle",{cx:"19",cy:"9",r:"1",key:"1ruzo2"}],["circle",{cx:"5",cy:"9",r:"1",key:"1a8b28"}],["circle",{cx:"12",cy:"15",r:"1",key:"1e56xg"}],["circle",{cx:"19",cy:"15",r:"1",key:"1a92ep"}],["circle",{cx:"5",cy:"15",r:"1",key:"5r1jwy"}]]),DI=wt("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),wz=wt("Hammer",[["path",{d:"m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9",key:"1afvon"}],["path",{d:"M17.64 15 22 10.64",key:"zsji6s"}],["path",{d:"m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25v-.86L16.01 4.6a5.56 5.56 0 0 0-3.94-1.64H9l.92.82A6.18 6.18 0 0 1 12 8.4v1.56l2 2h2.47l2.26 1.91",key:"lehyy1"}]]),kz=wt("Heading1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]),Sz=wt("Heading2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]),ou=wt("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),_z=wt("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),Tz=wt("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),vf=wt("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),n1=wt("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]),AI=wt("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Cz=wt("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]),RI=wt("Layers",[["polygon",{points:"12 2 2 7 12 12 22 7 12 2",key:"1b0ttc"}],["polyline",{points:"2 17 12 22 22 17",key:"imjtdl"}],["polyline",{points:"2 12 12 17 22 12",key:"5dexcv"}]]),OI=wt("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),r1=wt("Layout",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"3",x2:"21",y1:"9",y2:"9",key:"1vqk6q"}],["line",{x1:"9",x2:"9",y1:"21",y2:"9",key:"wpwpyp"}]]),Ez=wt("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),d2=wt("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),Nz=wt("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]),jz=wt("ListTodo",[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]),PI=wt("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),yi=wt("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Iz=wt("LocateFixed",[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),La=wt("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Mz=wt("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Dz=wt("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Az=wt("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),LI=wt("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Rz=wt("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),Oz=wt("MoveRight",[["path",{d:"M18 8L22 12L18 16",key:"1r0oui"}],["path",{d:"M2 12H22",key:"1m8cig"}]]),jv=wt("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),Pz=wt("PanelLeftClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]]),Lz=wt("PanelLeftOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]]),ho=wt("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),$I=wt("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),Iv=wt("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),Mg=wt("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),zI=wt("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),ni=wt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Mv=wt("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]),s1=wt("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),FI=wt("Repeat2",[["path",{d:"m2 9 3-3 3 3",key:"1ltn5i"}],["path",{d:"M13 18H7a2 2 0 0 1-2-2V6",key:"1r6tfw"}],["path",{d:"m22 15-3 3-3-3",key:"4rnwn2"}],["path",{d:"M11 6h6a2 2 0 0 1 2 2v10",key:"2f72bc"}]]),$z=wt("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]),BI=wt("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),zz=wt("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),UI=wt("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Hc=wt("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Fz=wt("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Bz=wt("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),HI=wt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Uz=wt("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),Hz=wt("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]),As=wt("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),Vz=wt("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),VI=wt("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),zl=wt("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),WI=wt("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Er=wt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Wz=wt("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),Dg=wt("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]),i1=wt("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),Kz=wt("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),KI=wt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Gz=wt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),o1=wt("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),qz=wt("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]),a1=wt("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),Yz=wt("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),un=wt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function l1(t,e){x.useEffect(()=>{const n=r=>{!t.current||t.current.contains(r.target)||e(r)};return document.addEventListener("mousedown",n),document.addEventListener("touchstart",n),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)}},[t,e])}const wf=x.createContext({});function Dv(t){const e=x.useRef(null);return e.current===null&&(e.current=t()),e.current}const Av=typeof window<"u",Rv=Av?x.useLayoutEffect:x.useEffect,Ag=x.createContext(null);function Ov(t,e){t.indexOf(e)===-1&&t.push(e)}function Pv(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const Yo=(t,e,n)=>n>e?e:n<t?t:n;let Lv=()=>{};const Jo={},GI=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function qI(t){return typeof t=="object"&&t!==null}const YI=t=>/^0[^.\s]+$/u.test(t);function $v(t){let e;return()=>(e===void 0&&(e=t()),e)}const Ei=t=>t,Jz=(t,e)=>n=>e(t(n)),Qf=(...t)=>t.reduce(Jz),kf=(t,e,n)=>{const r=e-t;return r===0?1:(n-t)/r};class zv{constructor(){this.subscriptions=[]}add(e){return Ov(this.subscriptions,e),()=>Pv(this.subscriptions,e)}notify(e,n,r){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](e,n,r);else for(let i=0;i<s;i++){const o=this.subscriptions[i];o&&o(e,n,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const yo=t=>t*1e3,Ti=t=>t/1e3;function JI(t,e){return e?t*(1e3/e):0}const XI=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,Xz=1e-7,Qz=12;function Zz(t,e,n,r,s){let i,o,a=0;do o=e+(n-e)/2,i=XI(o,r,s)-t,i>0?n=o:e=o;while(Math.abs(i)>Xz&&++a<Qz);return o}function Zf(t,e,n,r){if(t===e&&n===r)return Ei;const s=i=>Zz(i,0,1,t,n);return i=>i===0||i===1?i:XI(s(i),e,r)}const QI=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,ZI=t=>e=>1-t(1-e),eM=Zf(.33,1.53,.69,.99),Fv=ZI(eM),tM=QI(Fv),nM=t=>(t*=2)<1?.5*Fv(t):.5*(2-Math.pow(2,-10*(t-1))),Bv=t=>1-Math.sin(Math.acos(t)),rM=ZI(Bv),sM=QI(Bv),eF=Zf(.42,0,1,1),tF=Zf(0,0,.58,1),iM=Zf(.42,0,.58,1),nF=t=>Array.isArray(t)&&typeof t[0]!="number",oM=t=>Array.isArray(t)&&typeof t[0]=="number",rF={linear:Ei,easeIn:eF,easeInOut:iM,easeOut:tF,circIn:Bv,circInOut:sM,circOut:rM,backIn:Fv,backInOut:tM,backOut:eM,anticipate:nM},sF=t=>typeof t=="string",f2=t=>{if(oM(t)){Lv(t.length===4);const[e,n,r,s]=t;return Zf(e,n,r,s)}else if(sF(t))return rF[t];return t},Dh=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],h2={value:null,addProjectionMetrics:null};function iF(t,e){let n=new Set,r=new Set,s=!1,i=!1;const o=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1},l=0;function u(f){o.has(f)&&(d.schedule(f),t()),l++,f(a)}const d={schedule:(f,h=!1,p=!1)=>{const y=p&&s?n:r;return h&&o.add(f),y.has(f)||y.add(f),f},cancel:f=>{r.delete(f),o.delete(f)},process:f=>{if(a=f,s){i=!0;return}s=!0,[n,r]=[r,n],n.forEach(u),e&&h2.value&&h2.value.frameloop[e].push(l),l=0,n.clear(),s=!1,i&&(i=!1,d.process(f))}};return d}const oF=40;function aM(t,e){let n=!1,r=!0;const s={delta:0,timestamp:0,isProcessing:!1},i=()=>n=!0,o=Dh.reduce((w,T)=>(w[T]=iF(i,e?T:void 0),w),{}),{setup:a,read:l,resolveKeyframes:u,preUpdate:d,update:f,preRender:h,render:p,postRender:m}=o,y=()=>{const w=Jo.useManualTiming?s.timestamp:performance.now();n=!1,Jo.useManualTiming||(s.delta=r?1e3/60:Math.max(Math.min(w-s.timestamp,oF),1)),s.timestamp=w,s.isProcessing=!0,a.process(s),l.process(s),u.process(s),d.process(s),f.process(s),h.process(s),p.process(s),m.process(s),s.isProcessing=!1,n&&e&&(r=!1,t(y))},b=()=>{n=!0,r=!0,s.isProcessing||t(y)};return{schedule:Dh.reduce((w,T)=>{const R=o[T];return w[T]=(k,M=!1,S=!1)=>(n||b(),R.schedule(k,M,S)),w},{}),cancel:w=>{for(let T=0;T<Dh.length;T++)o[Dh[T]].cancel(w)},state:s,steps:o}}const{schedule:Zn,cancel:Ka,state:Xr,steps:V0}=aM(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ei,!0);let xp;function aF(){xp=void 0}const $s={now:()=>(xp===void 0&&$s.set(Xr.isProcessing||Jo.useManualTiming?Xr.timestamp:performance.now()),xp),set:t=>{xp=t,queueMicrotask(aF)}},lM=t=>e=>typeof e=="string"&&e.startsWith(t),cM=lM("--"),lF=lM("var(--"),Uv=t=>lF(t)?cF.test(t.split("/*")[0].trim()):!1,cF=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Pu={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},Sf={...Pu,transform:t=>Yo(0,1,t)},Ah={...Pu,default:1},jd=t=>Math.round(t*1e5)/1e5,Hv=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function uF(t){return t==null}const dF=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Vv=(t,e)=>n=>!!(typeof n=="string"&&dF.test(n)&&n.startsWith(t)||e&&!uF(n)&&Object.prototype.hasOwnProperty.call(n,e)),uM=(t,e,n)=>r=>{if(typeof r!="string")return r;const[s,i,o,a]=r.match(Hv);return{[t]:parseFloat(s),[e]:parseFloat(i),[n]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},fF=t=>Yo(0,255,t),W0={...Pu,transform:t=>Math.round(fF(t))},Il={test:Vv("rgb","red"),parse:uM("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:r=1})=>"rgba("+W0.transform(t)+", "+W0.transform(e)+", "+W0.transform(n)+", "+jd(Sf.transform(r))+")"};function hF(t){let e="",n="",r="",s="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),r=t.substring(5,7),s=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),r=t.substring(3,4),s=t.substring(4,5),e+=e,n+=n,r+=r,s+=s),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:s?parseInt(s,16)/255:1}}const c1={test:Vv("#"),parse:hF,transform:Il.transform},eh=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),ua=eh("deg"),xo=eh("%"),ln=eh("px"),pF=eh("vh"),mF=eh("vw"),p2=(()=>({...xo,parse:t=>xo.parse(t)/100,transform:t=>xo.transform(t*100)}))(),Vc={test:Vv("hsl","hue"),parse:uM("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:r=1})=>"hsla("+Math.round(t)+", "+xo.transform(jd(e))+", "+xo.transform(jd(n))+", "+jd(Sf.transform(r))+")"},Tr={test:t=>Il.test(t)||c1.test(t)||Vc.test(t),parse:t=>Il.test(t)?Il.parse(t):Vc.test(t)?Vc.parse(t):c1.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?Il.transform(t):Vc.transform(t),getAnimatableNone:t=>{const e=Tr.parse(t);return e.alpha=0,Tr.transform(e)}},gF=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function yF(t){var e,n;return isNaN(t)&&typeof t=="string"&&(((e=t.match(Hv))==null?void 0:e.length)||0)+(((n=t.match(gF))==null?void 0:n.length)||0)>0}const dM="number",fM="color",xF="var",bF="var(",m2="${}",vF=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function _f(t){const e=t.toString(),n=[],r={color:[],number:[],var:[]},s=[];let i=0;const a=e.replace(vF,l=>(Tr.test(l)?(r.color.push(i),s.push(fM),n.push(Tr.parse(l))):l.startsWith(bF)?(r.var.push(i),s.push(xF),n.push(l)):(r.number.push(i),s.push(dM),n.push(parseFloat(l))),++i,m2)).split(m2);return{values:n,split:a,indexes:r,types:s}}function hM(t){return _f(t).values}function pM(t){const{split:e,types:n}=_f(t),r=e.length;return s=>{let i="";for(let o=0;o<r;o++)if(i+=e[o],s[o]!==void 0){const a=n[o];a===dM?i+=jd(s[o]):a===fM?i+=Tr.transform(s[o]):i+=s[o]}return i}}const wF=t=>typeof t=="number"?0:Tr.test(t)?Tr.getAnimatableNone(t):t;function kF(t){const e=hM(t);return pM(t)(e.map(wF))}const Ga={test:yF,parse:hM,createTransformer:pM,getAnimatableNone:kF};function K0(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function SF({hue:t,saturation:e,lightness:n,alpha:r}){t/=360,e/=100,n/=100;let s=0,i=0,o=0;if(!e)s=i=o=n;else{const a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;s=K0(l,a,t+1/3),i=K0(l,a,t),o=K0(l,a,t-1/3)}return{red:Math.round(s*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:r}}function lm(t,e){return n=>n>0?e:t}const ur=(t,e,n)=>t+(e-t)*n,G0=(t,e,n)=>{const r=t*t,s=n*(e*e-r)+r;return s<0?0:Math.sqrt(s)},_F=[c1,Il,Vc],TF=t=>_F.find(e=>e.test(t));function g2(t){const e=TF(t);if(!e)return!1;let n=e.parse(t);return e===Vc&&(n=SF(n)),n}const y2=(t,e)=>{const n=g2(t),r=g2(e);if(!n||!r)return lm(t,e);const s={...n};return i=>(s.red=G0(n.red,r.red,i),s.green=G0(n.green,r.green,i),s.blue=G0(n.blue,r.blue,i),s.alpha=ur(n.alpha,r.alpha,i),Il.transform(s))},u1=new Set(["none","hidden"]);function CF(t,e){return u1.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function EF(t,e){return n=>ur(t,e,n)}function Wv(t){return typeof t=="number"?EF:typeof t=="string"?Uv(t)?lm:Tr.test(t)?y2:IF:Array.isArray(t)?mM:typeof t=="object"?Tr.test(t)?y2:NF:lm}function mM(t,e){const n=[...t],r=n.length,s=t.map((i,o)=>Wv(i)(i,e[o]));return i=>{for(let o=0;o<r;o++)n[o]=s[o](i);return n}}function NF(t,e){const n={...t,...e},r={};for(const s in n)t[s]!==void 0&&e[s]!==void 0&&(r[s]=Wv(t[s])(t[s],e[s]));return s=>{for(const i in r)n[i]=r[i](s);return n}}function jF(t,e){const n=[],r={color:0,var:0,number:0};for(let s=0;s<e.values.length;s++){const i=e.types[s],o=t.indexes[i][r[i]],a=t.values[o]??0;n[s]=a,r[i]++}return n}const IF=(t,e)=>{const n=Ga.createTransformer(e),r=_f(t),s=_f(e);return r.indexes.var.length===s.indexes.var.length&&r.indexes.color.length===s.indexes.color.length&&r.indexes.number.length>=s.indexes.number.length?u1.has(t)&&!s.values.length||u1.has(e)&&!r.values.length?CF(t,e):Qf(mM(jF(r,s),s.values),n):lm(t,e)};function gM(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?ur(t,e,n):Wv(t)(t,e)}const MF=t=>{const e=({timestamp:n})=>t(n);return{start:(n=!0)=>Zn.update(e,n),stop:()=>Ka(e),now:()=>Xr.isProcessing?Xr.timestamp:$s.now()}},yM=(t,e,n=10)=>{let r="";const s=Math.max(Math.round(e/n),2);for(let i=0;i<s;i++)r+=Math.round(t(i/(s-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},cm=2e4;function Kv(t){let e=0;const n=50;let r=t.next(e);for(;!r.done&&e<cm;)e+=n,r=t.next(e);return e>=cm?1/0:e}function DF(t,e=100,n){const r=n({...t,keyframes:[0,e]}),s=Math.min(Kv(r),cm);return{type:"keyframes",ease:i=>r.next(s*i).value/e,duration:Ti(s)}}const AF=5;function xM(t,e,n){const r=Math.max(e-AF,0);return JI(n-t(r),e-r)}const mr={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},q0=.001;function RF({duration:t=mr.duration,bounce:e=mr.bounce,velocity:n=mr.velocity,mass:r=mr.mass}){let s,i,o=1-e;o=Yo(mr.minDamping,mr.maxDamping,o),t=Yo(mr.minDuration,mr.maxDuration,Ti(t)),o<1?(s=u=>{const d=u*o,f=d*t,h=d-n,p=d1(u,o),m=Math.exp(-f);return q0-h/p*m},i=u=>{const f=u*o*t,h=f*n+n,p=Math.pow(o,2)*Math.pow(u,2)*t,m=Math.exp(-f),y=d1(Math.pow(u,2),o);return(-s(u)+q0>0?-1:1)*((h-p)*m)/y}):(s=u=>{const d=Math.exp(-u*t),f=(u-n)*t+1;return-q0+d*f},i=u=>{const d=Math.exp(-u*t),f=(n-u)*(t*t);return d*f});const a=5/t,l=PF(s,i,a);if(t=yo(t),isNaN(l))return{stiffness:mr.stiffness,damping:mr.damping,duration:t};{const u=Math.pow(l,2)*r;return{stiffness:u,damping:o*2*Math.sqrt(r*u),duration:t}}}const OF=12;function PF(t,e,n){let r=n;for(let s=1;s<OF;s++)r=r-t(r)/e(r);return r}function d1(t,e){return t*Math.sqrt(1-e*e)}const LF=["duration","bounce"],$F=["stiffness","damping","mass"];function x2(t,e){return e.some(n=>t[n]!==void 0)}function zF(t){let e={velocity:mr.velocity,stiffness:mr.stiffness,damping:mr.damping,mass:mr.mass,isResolvedFromDuration:!1,...t};if(!x2(t,$F)&&x2(t,LF))if(t.visualDuration){const n=t.visualDuration,r=2*Math.PI/(n*1.2),s=r*r,i=2*Yo(.05,1,1-(t.bounce||0))*Math.sqrt(s);e={...e,mass:mr.mass,stiffness:s,damping:i}}else{const n=RF(t);e={...e,...n,mass:mr.mass},e.isResolvedFromDuration=!0}return e}function um(t=mr.visualDuration,e=mr.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:r,restDelta:s}=n;const i=n.keyframes[0],o=n.keyframes[n.keyframes.length-1],a={done:!1,value:i},{stiffness:l,damping:u,mass:d,duration:f,velocity:h,isResolvedFromDuration:p}=zF({...n,velocity:-Ti(n.velocity||0)}),m=h||0,y=u/(2*Math.sqrt(l*d)),b=o-i,g=Ti(Math.sqrt(l/d)),v=Math.abs(b)<5;r||(r=v?mr.restSpeed.granular:mr.restSpeed.default),s||(s=v?mr.restDelta.granular:mr.restDelta.default);let w;if(y<1){const R=d1(g,y);w=k=>{const M=Math.exp(-y*g*k);return o-M*((m+y*g*b)/R*Math.sin(R*k)+b*Math.cos(R*k))}}else if(y===1)w=R=>o-Math.exp(-g*R)*(b+(m+g*b)*R);else{const R=g*Math.sqrt(y*y-1);w=k=>{const M=Math.exp(-y*g*k),S=Math.min(R*k,300);return o-M*((m+y*g*b)*Math.sinh(S)+R*b*Math.cosh(S))/R}}const T={calculatedDuration:p&&f||null,next:R=>{const k=w(R);if(p)a.done=R>=f;else{let M=R===0?m:0;y<1&&(M=R===0?yo(m):xM(w,R,k));const S=Math.abs(M)<=r,C=Math.abs(o-k)<=s;a.done=S&&C}return a.value=a.done?o:k,a},toString:()=>{const R=Math.min(Kv(T),cm),k=yM(M=>T.next(R*M).value,R,30);return R+"ms "+k},toTransition:()=>{}};return T}um.applyToOptions=t=>{const e=DF(t,100,um);return t.ease=e.ease,t.duration=yo(e.duration),t.type="keyframes",t};function f1({keyframes:t,velocity:e=0,power:n=.8,timeConstant:r=325,bounceDamping:s=10,bounceStiffness:i=500,modifyTarget:o,min:a,max:l,restDelta:u=.5,restSpeed:d}){const f=t[0],h={done:!1,value:f},p=S=>a!==void 0&&S<a||l!==void 0&&S>l,m=S=>a===void 0?l:l===void 0||Math.abs(a-S)<Math.abs(l-S)?a:l;let y=n*e;const b=f+y,g=o===void 0?b:o(b);g!==b&&(y=g-f);const v=S=>-y*Math.exp(-S/r),w=S=>g+v(S),T=S=>{const C=v(S),_=w(S);h.done=Math.abs(C)<=u,h.value=h.done?g:_};let R,k;const M=S=>{p(h.value)&&(R=S,k=um({keyframes:[h.value,m(h.value)],velocity:xM(w,S,h.value),damping:s,stiffness:i,restDelta:u,restSpeed:d}))};return M(0),{calculatedDuration:null,next:S=>{let C=!1;return!k&&R===void 0&&(C=!0,T(S),M(S)),R!==void 0&&S>=R?k.next(S-R):(!C&&T(S),h)}}}function FF(t,e,n){const r=[],s=n||Jo.mix||gM,i=t.length-1;for(let o=0;o<i;o++){let a=s(t[o],t[o+1]);if(e){const l=Array.isArray(e)?e[o]||Ei:e;a=Qf(l,a)}r.push(a)}return r}function BF(t,e,{clamp:n=!0,ease:r,mixer:s}={}){const i=t.length;if(Lv(i===e.length),i===1)return()=>e[0];if(i===2&&e[0]===e[1])return()=>e[1];const o=t[0]===t[1];t[0]>t[i-1]&&(t=[...t].reverse(),e=[...e].reverse());const a=FF(e,r,s),l=a.length,u=d=>{if(o&&d<t[0])return e[0];let f=0;if(l>1)for(;f<t.length-2&&!(d<t[f+1]);f++);const h=kf(t[f],t[f+1],d);return a[f](h)};return n?d=>u(Yo(t[0],t[i-1],d)):u}function UF(t,e){const n=t[t.length-1];for(let r=1;r<=e;r++){const s=kf(0,e,r);t.push(ur(n,1,s))}}function HF(t){const e=[0];return UF(e,t.length-1),e}function VF(t,e){return t.map(n=>n*e)}function WF(t,e){return t.map(()=>e||iM).splice(0,t.length-1)}function Id({duration:t=300,keyframes:e,times:n,ease:r="easeInOut"}){const s=nF(r)?r.map(f2):f2(r),i={done:!1,value:e[0]},o=VF(n&&n.length===e.length?n:HF(e),t),a=BF(o,e,{ease:Array.isArray(s)?s:WF(e,s)});return{calculatedDuration:t,next:l=>(i.value=a(l),i.done=l>=t,i)}}const KF=t=>t!==null;function Gv(t,{repeat:e,repeatType:n="loop"},r,s=1){const i=t.filter(KF),a=s<0||e&&n!=="loop"&&e%2===1?0:i.length-1;return!a||r===void 0?i[a]:r}const GF={decay:f1,inertia:f1,tween:Id,keyframes:Id,spring:um};function bM(t){typeof t.type=="string"&&(t.type=GF[t.type])}class qv{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,n){return this.finished.then(e,n)}}const qF=t=>t/100;class Yv extends qv{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var r,s;const{motionValue:n}=this.options;n&&n.updatedAt!==$s.now()&&this.tick($s.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(s=(r=this.options).onStop)==null||s.call(r))},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;bM(e);const{type:n=Id,repeat:r=0,repeatDelay:s=0,repeatType:i,velocity:o=0}=e;let{keyframes:a}=e;const l=n||Id;l!==Id&&typeof a[0]!="number"&&(this.mixKeyframes=Qf(qF,gM(a[0],a[1])),a=[0,100]);const u=l({...e,keyframes:a});i==="mirror"&&(this.mirroredGenerator=l({...e,keyframes:[...a].reverse(),velocity:-o})),u.calculatedDuration===null&&(u.calculatedDuration=Kv(u));const{calculatedDuration:d}=u;this.calculatedDuration=d,this.resolvedDuration=d+s,this.totalDuration=this.resolvedDuration*(r+1)-s,this.generator=u}updateTime(e){const n=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(e,n=!1){const{generator:r,totalDuration:s,mixKeyframes:i,mirroredGenerator:o,resolvedDuration:a,calculatedDuration:l}=this;if(this.startTime===null)return r.next(0);const{delay:u=0,keyframes:d,repeat:f,repeatType:h,repeatDelay:p,type:m,onUpdate:y,finalKeyframe:b}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-s/this.speed,this.startTime)),n?this.currentTime=e:this.updateTime(e);const g=this.currentTime-u*(this.playbackSpeed>=0?1:-1),v=this.playbackSpeed>=0?g<0:g>s;this.currentTime=Math.max(g,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=s);let w=this.currentTime,T=r;if(f){const S=Math.min(this.currentTime,s)/a;let C=Math.floor(S),_=S%1;!_&&S>=1&&(_=1),_===1&&C--,C=Math.min(C,f+1),!!(C%2)&&(h==="reverse"?(_=1-_,p&&(_-=p/a)):h==="mirror"&&(T=o)),w=Yo(0,1,_)*a}const R=v?{done:!1,value:d[0]}:T.next(w);i&&(R.value=i(R.value));let{done:k}=R;!v&&l!==null&&(k=this.playbackSpeed>=0?this.currentTime>=s:this.currentTime<=0);const M=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&k);return M&&m!==f1&&(R.value=Gv(d,this.options,b,this.speed)),y&&y(R.value),M&&this.finish(),R}then(e,n){return this.finished.then(e,n)}get duration(){return Ti(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Ti(e)}get time(){return Ti(this.currentTime)}set time(e){var n;e=yo(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),(n=this.driver)==null||n.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime($s.now());const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=Ti(this.currentTime))}play(){var s,i;if(this.isStopped)return;const{driver:e=MF,startTime:n}=this.options;this.driver||(this.driver=e(o=>this.tick(o))),(i=(s=this.options).onPlay)==null||i.call(s);const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=n??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime($s.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,n;this.notifyFinished(),this.teardown(),this.state="finished",(n=(e=this.options).onComplete)==null||n.call(e)}cancel(){var e,n;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(n=(e=this.options).onCancel)==null||n.call(e)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var n;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(n=this.driver)==null||n.stop(),e.observe(this)}}function YF(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const Ml=t=>t*180/Math.PI,h1=t=>{const e=Ml(Math.atan2(t[1],t[0]));return p1(e)},JF={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:h1,rotateZ:h1,skewX:t=>Ml(Math.atan(t[1])),skewY:t=>Ml(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},p1=t=>(t=t%360,t<0&&(t+=360),t),b2=h1,v2=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),w2=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),XF={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:v2,scaleY:w2,scale:t=>(v2(t)+w2(t))/2,rotateX:t=>p1(Ml(Math.atan2(t[6],t[5]))),rotateY:t=>p1(Ml(Math.atan2(-t[2],t[0]))),rotateZ:b2,rotate:b2,skewX:t=>Ml(Math.atan(t[4])),skewY:t=>Ml(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function m1(t){return t.includes("scale")?1:0}function g1(t,e){if(!t||t==="none")return m1(e);const n=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,s;if(n)r=XF,s=n;else{const a=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=JF,s=a}if(!s)return m1(e);const i=r[e],o=s[1].split(",").map(ZF);return typeof i=="function"?i(o):o[i]}const QF=(t,e)=>{const{transform:n="none"}=getComputedStyle(t);return g1(n,e)};function ZF(t){return parseFloat(t.trim())}const Lu=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],$u=(()=>new Set(Lu))(),k2=t=>t===Pu||t===ln,eB=new Set(["x","y","z"]),tB=Lu.filter(t=>!eB.has(t));function nB(t){const e=[];return tB.forEach(n=>{const r=t.getValue(n);r!==void 0&&(e.push([n,r.get()]),r.set(n.startsWith("scale")?1:0))}),e}const Fl={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>g1(e,"x"),y:(t,{transform:e})=>g1(e,"y")};Fl.translateX=Fl.x;Fl.translateY=Fl.y;const Bl=new Set;let y1=!1,x1=!1,b1=!1;function vM(){if(x1){const t=Array.from(Bl).filter(r=>r.needsMeasurement),e=new Set(t.map(r=>r.element)),n=new Map;e.forEach(r=>{const s=nB(r);s.length&&(n.set(r,s),r.render())}),t.forEach(r=>r.measureInitialState()),e.forEach(r=>{r.render();const s=n.get(r);s&&s.forEach(([i,o])=>{var a;(a=r.getValue(i))==null||a.set(o)})}),t.forEach(r=>r.measureEndState()),t.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}x1=!1,y1=!1,Bl.forEach(t=>t.complete(b1)),Bl.clear()}function wM(){Bl.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(x1=!0)})}function rB(){b1=!0,wM(),vM(),b1=!1}class Jv{constructor(e,n,r,s,i,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=r,this.motionValue=s,this.element=i,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(Bl.add(this),y1||(y1=!0,Zn.read(wM),Zn.resolveKeyframes(vM))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:r,motionValue:s}=this;if(e[0]===null){const i=s==null?void 0:s.get(),o=e[e.length-1];if(i!==void 0)e[0]=i;else if(r&&n){const a=r.readValue(n,o);a!=null&&(e[0]=a)}e[0]===void 0&&(e[0]=o),s&&i===void 0&&s.set(e[0])}YF(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Bl.delete(this)}cancel(){this.state==="scheduled"&&(Bl.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const sB=t=>t.startsWith("--");function iB(t,e,n){sB(e)?t.style.setProperty(e,n):t.style[e]=n}const oB=$v(()=>window.ScrollTimeline!==void 0),aB={};function lB(t,e){const n=$v(t);return()=>aB[e]??n()}const kM=lB(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),hd=([t,e,n,r])=>`cubic-bezier(${t}, ${e}, ${n}, ${r})`,S2={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:hd([0,.65,.55,1]),circOut:hd([.55,0,1,.45]),backIn:hd([.31,.01,.66,-.59]),backOut:hd([.33,1.53,.69,.99])};function SM(t,e){if(t)return typeof t=="function"?kM()?yM(t,e):"ease-out":oM(t)?hd(t):Array.isArray(t)?t.map(n=>SM(n,e)||S2.easeOut):S2[t]}function cB(t,e,n,{delay:r=0,duration:s=300,repeat:i=0,repeatType:o="loop",ease:a="easeOut",times:l}={},u=void 0){const d={[e]:n};l&&(d.offset=l);const f=SM(a,s);Array.isArray(f)&&(d.easing=f);const h={delay:r,duration:s,easing:Array.isArray(f)?"linear":f,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"};return u&&(h.pseudoElement=u),t.animate(d,h)}function _M(t){return typeof t=="function"&&"applyToOptions"in t}function uB({type:t,...e}){return _M(t)&&kM()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class dB extends qv{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:n,name:r,keyframes:s,pseudoElement:i,allowFlatten:o=!1,finalKeyframe:a,onComplete:l}=e;this.isPseudoElement=!!i,this.allowFlatten=o,this.options=e,Lv(typeof e.type!="string");const u=uB(e);this.animation=cB(n,r,s,u,i),u.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!i){const d=Gv(s,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(d):iB(n,r,d),this.animation.cancel()}l==null||l(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,n;(n=(e=this.animation).finish)==null||n.call(e)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,n;this.isPseudoElement||(n=(e=this.animation).commitStyles)==null||n.call(e)}get duration(){var n,r;const e=((r=(n=this.animation.effect)==null?void 0:n.getComputedTiming)==null?void 0:r.call(n).duration)||0;return Ti(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Ti(e)}get time(){return Ti(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=yo(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:n}){var r;return this.allowFlatten&&((r=this.animation.effect)==null||r.updateTiming({easing:"linear"})),this.animation.onfinish=null,e&&oB()?(this.animation.timeline=e,Ei):n(this)}}const TM={anticipate:nM,backInOut:tM,circInOut:sM};function fB(t){return t in TM}function hB(t){typeof t.ease=="string"&&fB(t.ease)&&(t.ease=TM[t.ease])}const _2=10;class pB extends dB{constructor(e){hB(e),bM(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:n,onUpdate:r,onComplete:s,element:i,...o}=this.options;if(!n)return;if(e!==void 0){n.set(e);return}const a=new Yv({...o,autoplay:!1}),l=yo(this.finishedTime??this.time);n.setWithVelocity(a.sample(l-_2).value,a.sample(l).value,_2),a.stop()}}const T2=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Ga.test(t)||t==="0")&&!t.startsWith("url("));function mB(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function gB(t,e,n,r){const s=t[0];if(s===null)return!1;if(e==="display"||e==="visibility")return!0;const i=t[t.length-1],o=T2(s,e),a=T2(i,e);return!o||!a?!1:mB(t)||(n==="spring"||_M(n))&&r}function v1(t){t.duration=0,t.type="keyframes"}const yB=new Set(["opacity","clipPath","filter","transform"]),xB=$v(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function bB(t){var d;const{motionValue:e,name:n,repeatDelay:r,repeatType:s,damping:i,type:o}=t;if(!(((d=e==null?void 0:e.owner)==null?void 0:d.current)instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:u}=e.owner.getProps();return xB()&&n&&yB.has(n)&&(n!=="transform"||!u)&&!l&&!r&&s!=="mirror"&&i!==0&&o!=="inertia"}const vB=40;class wB extends qv{constructor({autoplay:e=!0,delay:n=0,type:r="keyframes",repeat:s=0,repeatDelay:i=0,repeatType:o="loop",keyframes:a,name:l,motionValue:u,element:d,...f}){var m;super(),this.stop=()=>{var y,b;this._animation&&(this._animation.stop(),(y=this.stopTimeline)==null||y.call(this)),(b=this.keyframeResolver)==null||b.cancel()},this.createdAt=$s.now();const h={autoplay:e,delay:n,type:r,repeat:s,repeatDelay:i,repeatType:o,name:l,motionValue:u,element:d,...f},p=(d==null?void 0:d.KeyframeResolver)||Jv;this.keyframeResolver=new p(a,(y,b,g)=>this.onKeyframesResolved(y,b,h,!g),l,u,d),(m=this.keyframeResolver)==null||m.scheduleResolve()}onKeyframesResolved(e,n,r,s){this.keyframeResolver=void 0;const{name:i,type:o,velocity:a,delay:l,isHandoff:u,onUpdate:d}=r;this.resolvedAt=$s.now(),gB(e,i,o,a)||((Jo.instantAnimations||!l)&&(d==null||d(Gv(e,r,n))),e[0]=e[e.length-1],v1(r),r.repeat=0);const h={startTime:s?this.resolvedAt?this.resolvedAt-this.createdAt>vB?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...r,keyframes:e},p=!u&&bB(h)?new pB({...h,element:h.motionValue.owner.current}):new Yv(h);p.finished.then(()=>this.notifyFinished()).catch(Ei),this.pendingTimeline&&(this.stopTimeline=p.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=p}get finished(){return this._animation?this.animation.finished:this._finished}then(e,n){return this.finished.finally(e).then(()=>{})}get animation(){var e;return this._animation||((e=this.keyframeResolver)==null||e.resume(),rB()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),(e=this.keyframeResolver)==null||e.cancel()}}const kB=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function SB(t){const e=kB.exec(t);if(!e)return[,];const[,n,r,s]=e;return[`--${n??r}`,s]}function CM(t,e,n=1){const[r,s]=SB(t);if(!r)return;const i=window.getComputedStyle(e).getPropertyValue(r);if(i){const o=i.trim();return GI(o)?parseFloat(o):o}return Uv(s)?CM(s,e,n+1):s}function Xv(t,e){return(t==null?void 0:t[e])??(t==null?void 0:t.default)??t}const EM=new Set(["width","height","top","left","right","bottom",...Lu]),_B={test:t=>t==="auto",parse:t=>t},NM=t=>e=>e.test(t),jM=[Pu,ln,xo,ua,mF,pF,_B],C2=t=>jM.find(NM(t));function TB(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||YI(t):!0}const CB=new Set(["brightness","contrast","saturate","opacity"]);function EB(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[r]=n.match(Hv)||[];if(!r)return t;const s=n.replace(r,"");let i=CB.has(e)?1:0;return r!==n&&(i*=100),e+"("+i+s+")"}const NB=/\b([a-z-]*)\(.*?\)/gu,w1={...Ga,getAnimatableNone:t=>{const e=t.match(NB);return e?e.map(EB).join(" "):t}},E2={...Pu,transform:Math.round},jB={rotate:ua,rotateX:ua,rotateY:ua,rotateZ:ua,scale:Ah,scaleX:Ah,scaleY:Ah,scaleZ:Ah,skew:ua,skewX:ua,skewY:ua,distance:ln,translateX:ln,translateY:ln,translateZ:ln,x:ln,y:ln,z:ln,perspective:ln,transformPerspective:ln,opacity:Sf,originX:p2,originY:p2,originZ:ln},Qv={borderWidth:ln,borderTopWidth:ln,borderRightWidth:ln,borderBottomWidth:ln,borderLeftWidth:ln,borderRadius:ln,radius:ln,borderTopLeftRadius:ln,borderTopRightRadius:ln,borderBottomRightRadius:ln,borderBottomLeftRadius:ln,width:ln,maxWidth:ln,height:ln,maxHeight:ln,top:ln,right:ln,bottom:ln,left:ln,padding:ln,paddingTop:ln,paddingRight:ln,paddingBottom:ln,paddingLeft:ln,margin:ln,marginTop:ln,marginRight:ln,marginBottom:ln,marginLeft:ln,backgroundPositionX:ln,backgroundPositionY:ln,...jB,zIndex:E2,fillOpacity:Sf,strokeOpacity:Sf,numOctaves:E2},IB={...Qv,color:Tr,backgroundColor:Tr,outlineColor:Tr,fill:Tr,stroke:Tr,borderColor:Tr,borderTopColor:Tr,borderRightColor:Tr,borderBottomColor:Tr,borderLeftColor:Tr,filter:w1,WebkitFilter:w1},IM=t=>IB[t];function MM(t,e){let n=IM(t);return n!==w1&&(n=Ga),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const MB=new Set(["auto","none","0"]);function DB(t,e,n){let r=0,s;for(;r<t.length&&!s;){const i=t[r];typeof i=="string"&&!MB.has(i)&&_f(i).values.length&&(s=t[r]),r++}if(s&&n)for(const i of e)t[i]=MM(n,s)}class AB extends Jv{constructor(e,n,r,s,i){super(e,n,r,s,i,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:r}=this;if(!n||!n.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let u=e[l];if(typeof u=="string"&&(u=u.trim(),Uv(u))){const d=CM(u,n.current);d!==void 0&&(e[l]=d),l===e.length-1&&(this.finalKeyframe=u)}}if(this.resolveNoneKeyframes(),!EM.has(r)||e.length!==2)return;const[s,i]=e,o=C2(s),a=C2(i);if(o!==a)if(k2(o)&&k2(a))for(let l=0;l<e.length;l++){const u=e[l];typeof u=="string"&&(e[l]=parseFloat(u))}else Fl[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,r=[];for(let s=0;s<e.length;s++)(e[s]===null||TB(e[s]))&&r.push(s);r.length&&DB(e,r,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:r}=this;if(!e||!e.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Fl[r](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const s=n[n.length-1];s!==void 0&&e.getValue(r,s).jump(s,!1)}measureEndState(){var a;const{element:e,name:n,unresolvedKeyframes:r}=this;if(!e||!e.current)return;const s=e.getValue(n);s&&s.jump(this.measuredOrigin,!1);const i=r.length-1,o=r[i];r[i]=Fl[n](e.measureViewportBox(),window.getComputedStyle(e.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),(a=this.removedTransforms)!=null&&a.length&&this.removedTransforms.forEach(([l,u])=>{e.getValue(l).set(u)}),this.resolveNoneKeyframes()}}function RB(t,e,n){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let r=document;e&&(r=e.current);const s=(n==null?void 0:n[t])??r.querySelectorAll(t);return s?Array.from(s):[]}return Array.from(t)}const DM=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function AM(t){return qI(t)&&"offsetHeight"in t}const N2=30,OB=t=>!isNaN(parseFloat(t));class PB{constructor(e,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{var i;const s=$s.now();if(this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&((i=this.events.change)==null||i.notify(this.current),this.dependents))for(const o of this.dependents)o.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=$s.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=OB(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new zv);const r=this.events[e].add(n);return e==="change"?()=>{r(),Zn.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,n,r){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;(e=this.events.change)==null||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=$s.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>N2)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,N2);return JI(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,n;(e=this.dependents)==null||e.clear(),(n=this.events.destroy)==null||n.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function wu(t,e){return new PB(t,e)}const{schedule:Zv,cancel:yre}=aM(queueMicrotask,!1),Wi={x:!1,y:!1};function RM(){return Wi.x||Wi.y}function LB(t){return t==="x"||t==="y"?Wi[t]?null:(Wi[t]=!0,()=>{Wi[t]=!1}):Wi.x||Wi.y?null:(Wi.x=Wi.y=!0,()=>{Wi.x=Wi.y=!1})}function OM(t,e){const n=RB(t),r=new AbortController,s={passive:!0,...e,signal:r.signal};return[n,s,()=>r.abort()]}function j2(t){return!(t.pointerType==="touch"||RM())}function $B(t,e,n={}){const[r,s,i]=OM(t,n),o=a=>{if(!j2(a))return;const{target:l}=a,u=e(l,a);if(typeof u!="function"||!l)return;const d=f=>{j2(f)&&(u(f),l.removeEventListener("pointerleave",d))};l.addEventListener("pointerleave",d,s)};return r.forEach(a=>{a.addEventListener("pointerenter",o,s)}),i}const PM=(t,e)=>e?t===e?!0:PM(t,e.parentElement):!1,ew=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,zB=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function FB(t){return zB.has(t.tagName)||t.tabIndex!==-1}const bp=new WeakSet;function I2(t){return e=>{e.key==="Enter"&&t(e)}}function Y0(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const BB=(t,e)=>{const n=t.currentTarget;if(!n)return;const r=I2(()=>{if(bp.has(n))return;Y0(n,"down");const s=I2(()=>{Y0(n,"up")}),i=()=>Y0(n,"cancel");n.addEventListener("keyup",s,e),n.addEventListener("blur",i,e)});n.addEventListener("keydown",r,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",r),e)};function M2(t){return ew(t)&&!RM()}function UB(t,e,n={}){const[r,s,i]=OM(t,n),o=a=>{const l=a.currentTarget;if(!M2(a))return;bp.add(l);const u=e(l,a),d=(p,m)=>{window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",h),bp.has(l)&&bp.delete(l),M2(p)&&typeof u=="function"&&u(p,{success:m})},f=p=>{d(p,l===window||l===document||n.useGlobalTarget||PM(l,p.target))},h=p=>{d(p,!1)};window.addEventListener("pointerup",f,s),window.addEventListener("pointercancel",h,s)};return r.forEach(a=>{(n.useGlobalTarget?window:a).addEventListener("pointerdown",o,s),AM(a)&&(a.addEventListener("focus",u=>BB(u,s)),!FB(a)&&!a.hasAttribute("tabindex")&&(a.tabIndex=0))}),i}function LM(t){return qI(t)&&"ownerSVGElement"in t}function HB(t){return LM(t)&&t.tagName==="svg"}const ps=t=>!!(t&&t.getVelocity),VB=[...jM,Tr,Ga],WB=t=>VB.find(NM(t)),tw=x.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function D2(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function KB(...t){return e=>{let n=!1;const r=t.map(s=>{const i=D2(s,e);return!n&&typeof i=="function"&&(n=!0),i});if(n)return()=>{for(let s=0;s<r.length;s++){const i=r[s];typeof i=="function"?i():D2(t[s],null)}}}}function GB(...t){return x.useCallback(KB(...t),t)}class qB extends x.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const r=n.offsetParent,s=AM(r)&&r.offsetWidth||0,i=this.props.sizeRef.current;i.height=n.offsetHeight||0,i.width=n.offsetWidth||0,i.top=n.offsetTop,i.left=n.offsetLeft,i.right=s-i.width-i.left}return null}componentDidUpdate(){}render(){return this.props.children}}function YB({children:t,isPresent:e,anchorX:n,root:r}){const s=x.useId(),i=x.useRef(null),o=x.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=x.useContext(tw),l=GB(i,t==null?void 0:t.ref);return x.useInsertionEffect(()=>{const{width:u,height:d,top:f,left:h,right:p}=o.current;if(e||!i.current||!u||!d)return;const m=n==="left"?`left: ${h}`:`right: ${p}`;i.current.dataset.motionPopId=s;const y=document.createElement("style");a&&(y.nonce=a);const b=r??document.head;return b.appendChild(y),y.sheet&&y.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${u}px !important;
            height: ${d}px !important;
            ${m}px !important;
            top: ${f}px !important;
          }
        `),()=>{b.contains(y)&&b.removeChild(y)}},[e]),c.jsx(qB,{isPresent:e,childRef:i,sizeRef:o,children:x.cloneElement(t,{ref:l})})}const JB=({children:t,initial:e,isPresent:n,onExitComplete:r,custom:s,presenceAffectsLayout:i,mode:o,anchorX:a,root:l})=>{const u=Dv(XB),d=x.useId();let f=!0,h=x.useMemo(()=>(f=!1,{id:d,initial:e,isPresent:n,custom:s,onExitComplete:p=>{u.set(p,!0);for(const m of u.values())if(!m)return;r&&r()},register:p=>(u.set(p,!1),()=>u.delete(p))}),[n,u,r]);return i&&f&&(h={...h}),x.useMemo(()=>{u.forEach((p,m)=>u.set(m,!1))},[n]),x.useEffect(()=>{!n&&!u.size&&r&&r()},[n]),o==="popLayout"&&(t=c.jsx(YB,{isPresent:n,anchorX:a,root:l,children:t})),c.jsx(Ag.Provider,{value:h,children:t})};function XB(){return new Map}function $M(t=!0){const e=x.useContext(Ag);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:r,register:s}=e,i=x.useId();x.useEffect(()=>{if(t)return s(i)},[t]);const o=x.useCallback(()=>t&&r&&r(i),[i,r,t]);return!n&&r?[!1,o]:[!0]}const Rh=t=>t.key||"";function A2(t){const e=[];return x.Children.forEach(t,n=>{x.isValidElement(n)&&e.push(n)}),e}const bo=({children:t,custom:e,initial:n=!0,onExitComplete:r,presenceAffectsLayout:s=!0,mode:i="sync",propagate:o=!1,anchorX:a="left",root:l})=>{const[u,d]=$M(o),f=x.useMemo(()=>A2(t),[t]),h=o&&!u?[]:f.map(Rh),p=x.useRef(!0),m=x.useRef(f),y=Dv(()=>new Map),[b,g]=x.useState(f),[v,w]=x.useState(f);Rv(()=>{p.current=!1,m.current=f;for(let k=0;k<v.length;k++){const M=Rh(v[k]);h.includes(M)?y.delete(M):y.get(M)!==!0&&y.set(M,!1)}},[v,h.length,h.join("-")]);const T=[];if(f!==b){let k=[...f];for(let M=0;M<v.length;M++){const S=v[M],C=Rh(S);h.includes(C)||(k.splice(M,0,S),T.push(S))}return i==="wait"&&T.length&&(k=T),w(A2(k)),g(f),null}const{forceRender:R}=x.useContext(wf);return c.jsx(c.Fragment,{children:v.map(k=>{const M=Rh(k),S=o&&!u?!1:f===v||h.includes(M),C=()=>{if(y.has(M))y.set(M,!0);else return;let _=!0;y.forEach(E=>{E||(_=!1)}),_&&(R==null||R(),w(m.current),o&&(d==null||d()),r&&r())};return c.jsx(JB,{isPresent:S,initial:!p.current||n?void 0:!1,custom:e,presenceAffectsLayout:s,mode:i,root:l,onExitComplete:S?void 0:C,anchorX:a,children:k},M)})})},QB=x.createContext(null);function ZB(){const t=x.useRef(!1);return Rv(()=>(t.current=!0,()=>{t.current=!1}),[]),t}function eU(){const t=ZB(),[e,n]=x.useState(0),r=x.useCallback(()=>{t.current&&n(e+1)},[e]);return[x.useCallback(()=>Zn.postRender(r),[r]),e]}const tU=t=>!t.isLayoutDirty&&t.willUpdate(!1);function R2(){const t=new Set,e=new WeakMap,n=()=>t.forEach(tU);return{add:r=>{t.add(r),e.set(r,r.addEventListener("willUpdate",n))},remove:r=>{t.delete(r);const s=e.get(r);s&&(s(),e.delete(r)),n()},dirty:n}}const zM=t=>t===!0,nU=t=>zM(t===!0)||t==="id",rU=({children:t,id:e,inherit:n=!0})=>{const r=x.useContext(wf),s=x.useContext(QB),[i,o]=eU(),a=x.useRef(null),l=r.id||s;a.current===null&&(nU(n)&&l&&(e=e?l+"-"+e:l),a.current={id:e,group:zM(n)&&r.group||R2()});const u=x.useMemo(()=>({...a.current,forceRender:i}),[o]);return c.jsx(wf.Provider,{value:u,children:t})},FM=x.createContext({strict:!1}),O2={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ku={};for(const t in O2)ku[t]={isEnabled:e=>O2[t].some(n=>!!e[n])};function sU(t){for(const e in t)ku[e]={...ku[e],...t[e]}}const iU=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function dm(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||iU.has(t)}let BM=t=>!dm(t);function oU(t){typeof t=="function"&&(BM=e=>e.startsWith("on")?!dm(e):t(e))}try{oU(require("@emotion/is-prop-valid").default)}catch{}function aU(t,e,n){const r={};for(const s in t)s==="values"&&typeof t.values=="object"||(BM(s)||n===!0&&dm(s)||!e&&!dm(s)||t.draggable&&s.startsWith("onDrag"))&&(r[s]=t[s]);return r}const Rg=x.createContext({});function Og(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function Tf(t){return typeof t=="string"||Array.isArray(t)}const nw=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],rw=["initial",...nw];function Pg(t){return Og(t.animate)||rw.some(e=>Tf(t[e]))}function UM(t){return!!(Pg(t)||t.variants)}function lU(t,e){if(Pg(t)){const{initial:n,animate:r}=t;return{initial:n===!1||Tf(n)?n:void 0,animate:Tf(r)?r:void 0}}return t.inherit!==!1?e:{}}function cU(t){const{initial:e,animate:n}=lU(t,x.useContext(Rg));return x.useMemo(()=>({initial:e,animate:n}),[P2(e),P2(n)])}function P2(t){return Array.isArray(t)?t.join(" "):t}function L2(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const ed={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(ln.test(t))t=parseFloat(t);else return t;const n=L2(t,e.target.x),r=L2(t,e.target.y);return`${n}% ${r}%`}},uU={correct:(t,{treeScale:e,projectionDelta:n})=>{const r=t,s=Ga.parse(t);if(s.length>5)return r;const i=Ga.createTransformer(t),o=typeof s[0]!="number"?1:0,a=n.x.scale*e.x,l=n.y.scale*e.y;s[0+o]/=a,s[1+o]/=l;const u=ur(a,l,.5);return typeof s[2+o]=="number"&&(s[2+o]/=u),typeof s[3+o]=="number"&&(s[3+o]/=u),i(s)}},k1={borderRadius:{...ed,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ed,borderTopRightRadius:ed,borderBottomLeftRadius:ed,borderBottomRightRadius:ed,boxShadow:uU};function HM(t,{layout:e,layoutId:n}){return $u.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!k1[t]||t==="opacity")}const dU={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},fU=Lu.length;function hU(t,e,n){let r="",s=!0;for(let i=0;i<fU;i++){const o=Lu[i],a=t[o];if(a===void 0)continue;let l=!0;if(typeof a=="number"?l=a===(o.startsWith("scale")?1:0):l=parseFloat(a)===0,!l||n){const u=DM(a,Qv[o]);if(!l){s=!1;const d=dU[o]||o;r+=`${d}(${u}) `}n&&(e[o]=u)}}return r=r.trim(),n?r=n(e,s?"":r):s&&(r="none"),r}function sw(t,e,n){const{style:r,vars:s,transformOrigin:i}=t;let o=!1,a=!1;for(const l in e){const u=e[l];if($u.has(l)){o=!0;continue}else if(cM(l)){s[l]=u;continue}else{const d=DM(u,Qv[l]);l.startsWith("origin")?(a=!0,i[l]=d):r[l]=d}}if(e.transform||(o||n?r.transform=hU(e,t.transform,n):r.transform&&(r.transform="none")),a){const{originX:l="50%",originY:u="50%",originZ:d=0}=i;r.transformOrigin=`${l} ${u} ${d}`}}const iw=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function VM(t,e,n){for(const r in e)!ps(e[r])&&!HM(r,n)&&(t[r]=e[r])}function pU({transformTemplate:t},e){return x.useMemo(()=>{const n=iw();return sw(n,e,t),Object.assign({},n.vars,n.style)},[e])}function mU(t,e){const n=t.style||{},r={};return VM(r,n,t),Object.assign(r,pU(t,e)),r}function gU(t,e){const n={},r=mU(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=r,n}const yU={offset:"stroke-dashoffset",array:"stroke-dasharray"},xU={offset:"strokeDashoffset",array:"strokeDasharray"};function bU(t,e,n=1,r=0,s=!0){t.pathLength=1;const i=s?yU:xU;t[i.offset]=ln.transform(-r);const o=ln.transform(e),a=ln.transform(n);t[i.array]=`${o} ${a}`}function WM(t,{attrX:e,attrY:n,attrScale:r,pathLength:s,pathSpacing:i=1,pathOffset:o=0,...a},l,u,d){if(sw(t,a,u),l){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:f,style:h}=t;f.transform&&(h.transform=f.transform,delete f.transform),(h.transform||f.transformOrigin)&&(h.transformOrigin=f.transformOrigin??"50% 50%",delete f.transformOrigin),h.transform&&(h.transformBox=(d==null?void 0:d.transformBox)??"fill-box",delete f.transformBox),e!==void 0&&(f.x=e),n!==void 0&&(f.y=n),r!==void 0&&(f.scale=r),s!==void 0&&bU(f,s,i,o,!1)}const KM=()=>({...iw(),attrs:{}}),GM=t=>typeof t=="string"&&t.toLowerCase()==="svg";function vU(t,e,n,r){const s=x.useMemo(()=>{const i=KM();return WM(i,e,GM(r),t.transformTemplate,t.style),{...i.attrs,style:{...i.style}}},[e]);if(t.style){const i={};VM(i,t.style,t),s.style={...i,...s.style}}return s}const wU=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function ow(t){return typeof t!="string"||t.includes("-")?!1:!!(wU.indexOf(t)>-1||/[A-Z]/u.test(t))}function kU(t,e,n,{latestValues:r},s,i=!1){const a=(ow(t)?vU:gU)(e,r,s,t),l=aU(e,typeof t=="string",i),u=t!==x.Fragment?{...l,...a,ref:n}:{},{children:d}=e,f=x.useMemo(()=>ps(d)?d.get():d,[d]);return x.createElement(t,{...u,children:f})}function $2(t){const e=[{},{}];return t==null||t.values.forEach((n,r)=>{e[0][r]=n.get(),e[1][r]=n.getVelocity()}),e}function aw(t,e,n,r){if(typeof e=="function"){const[s,i]=$2(r);e=e(n!==void 0?n:t.custom,s,i)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[s,i]=$2(r);e=e(n!==void 0?n:t.custom,s,i)}return e}function vp(t){return ps(t)?t.get():t}function SU({scrapeMotionValuesFromProps:t,createRenderState:e},n,r,s){return{latestValues:_U(n,r,s,t),renderState:e()}}function _U(t,e,n,r){const s={},i=r(t,{});for(const h in i)s[h]=vp(i[h]);let{initial:o,animate:a}=t;const l=Pg(t),u=UM(t);e&&u&&!l&&t.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let d=n?n.initial===!1:!1;d=d||o===!1;const f=d?a:o;if(f&&typeof f!="boolean"&&!Og(f)){const h=Array.isArray(f)?f:[f];for(let p=0;p<h.length;p++){const m=aw(t,h[p]);if(m){const{transitionEnd:y,transition:b,...g}=m;for(const v in g){let w=g[v];if(Array.isArray(w)){const T=d?w.length-1:0;w=w[T]}w!==null&&(s[v]=w)}for(const v in y)s[v]=y[v]}}}return s}const qM=t=>(e,n)=>{const r=x.useContext(Rg),s=x.useContext(Ag),i=()=>SU(t,e,r,s);return n?i():Dv(i)};function lw(t,e,n){var i;const{style:r}=t,s={};for(const o in r)(ps(r[o])||e.style&&ps(e.style[o])||HM(o,t)||((i=n==null?void 0:n.getValue(o))==null?void 0:i.liveStyle)!==void 0)&&(s[o]=r[o]);return s}const TU=qM({scrapeMotionValuesFromProps:lw,createRenderState:iw});function YM(t,e,n){const r=lw(t,e,n);for(const s in t)if(ps(t[s])||ps(e[s])){const i=Lu.indexOf(s)!==-1?"attr"+s.charAt(0).toUpperCase()+s.substring(1):s;r[i]=t[s]}return r}const CU=qM({scrapeMotionValuesFromProps:YM,createRenderState:KM}),EU=Symbol.for("motionComponentSymbol");function Wc(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function NU(t,e,n){return x.useCallback(r=>{r&&t.onMount&&t.onMount(r),e&&(r?e.mount(r):e.unmount()),n&&(typeof n=="function"?n(r):Wc(n)&&(n.current=r))},[e])}const cw=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),jU="framerAppearId",JM="data-"+cw(jU),XM=x.createContext({});function IU(t,e,n,r,s){var y,b;const{visualElement:i}=x.useContext(Rg),o=x.useContext(FM),a=x.useContext(Ag),l=x.useContext(tw).reducedMotion,u=x.useRef(null);r=r||o.renderer,!u.current&&r&&(u.current=r(t,{visualState:e,parent:i,props:n,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:l}));const d=u.current,f=x.useContext(XM);d&&!d.projection&&s&&(d.type==="html"||d.type==="svg")&&MU(u.current,n,s,f);const h=x.useRef(!1);x.useInsertionEffect(()=>{d&&h.current&&d.update(n,a)});const p=n[JM],m=x.useRef(!!p&&!((y=window.MotionHandoffIsComplete)!=null&&y.call(window,p))&&((b=window.MotionHasOptimisedAnimation)==null?void 0:b.call(window,p)));return Rv(()=>{d&&(h.current=!0,window.MotionIsMounted=!0,d.updateFeatures(),d.scheduleRenderMicrotask(),m.current&&d.animationState&&d.animationState.animateChanges())}),x.useEffect(()=>{d&&(!m.current&&d.animationState&&d.animationState.animateChanges(),m.current&&(queueMicrotask(()=>{var g;(g=window.MotionHandoffMarkAsComplete)==null||g.call(window,p)}),m.current=!1),d.enteringChildren=void 0)}),d}function MU(t,e,n,r){const{layoutId:s,layout:i,drag:o,dragConstraints:a,layoutScroll:l,layoutRoot:u,layoutCrossfade:d}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:QM(t.parent)),t.projection.setOptions({layoutId:s,layout:i,alwaysMeasureLayout:!!o||a&&Wc(a),visualElement:t,animationType:typeof i=="string"?i:"both",initialPromotionConfig:r,crossfade:d,layoutScroll:l,layoutRoot:u})}function QM(t){if(t)return t.options.allowProjection!==!1?t.projection:QM(t.parent)}function J0(t,{forwardMotionProps:e=!1}={},n,r){n&&sU(n);const s=ow(t)?CU:TU;function i(a,l){let u;const d={...x.useContext(tw),...a,layoutId:DU(a)},{isStatic:f}=d,h=cU(a),p=s(a,f);if(!f&&Av){AU();const m=RU(d);u=m.MeasureLayout,h.visualElement=IU(t,p,d,r,m.ProjectionNode)}return c.jsxs(Rg.Provider,{value:h,children:[u&&h.visualElement?c.jsx(u,{visualElement:h.visualElement,...d}):null,kU(t,a,NU(p,h.visualElement,l),p,f,e)]})}i.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const o=x.forwardRef(i);return o[EU]=t,o}function DU({layoutId:t}){const e=x.useContext(wf).id;return e&&t!==void 0?e+"-"+t:t}function AU(t,e){x.useContext(FM).strict}function RU(t){const{drag:e,layout:n}=ku;if(!e&&!n)return{};const r={...e,...n};return{MeasureLayout:e!=null&&e.isEnabled(t)||n!=null&&n.isEnabled(t)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function OU(t,e){if(typeof Proxy>"u")return J0;const n=new Map,r=(i,o)=>J0(i,o,t,e),s=(i,o)=>r(i,o);return new Proxy(s,{get:(i,o)=>o==="create"?r:(n.has(o)||n.set(o,J0(o,void 0,t,e)),n.get(o))})}function ZM({top:t,left:e,right:n,bottom:r}){return{x:{min:e,max:n},y:{min:t,max:r}}}function PU({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function LU(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),r=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:r.y,right:r.x}}function X0(t){return t===void 0||t===1}function S1({scale:t,scaleX:e,scaleY:n}){return!X0(t)||!X0(e)||!X0(n)}function yl(t){return S1(t)||eD(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function eD(t){return z2(t.x)||z2(t.y)}function z2(t){return t&&t!=="0%"}function fm(t,e,n){const r=t-n,s=e*r;return n+s}function F2(t,e,n,r,s){return s!==void 0&&(t=fm(t,s,r)),fm(t,n,r)+e}function _1(t,e=0,n=1,r,s){t.min=F2(t.min,e,n,r,s),t.max=F2(t.max,e,n,r,s)}function tD(t,{x:e,y:n}){_1(t.x,e.translate,e.scale,e.originPoint),_1(t.y,n.translate,n.scale,n.originPoint)}const B2=.999999999999,U2=1.0000000000001;function $U(t,e,n,r=!1){const s=n.length;if(!s)return;e.x=e.y=1;let i,o;for(let a=0;a<s;a++){i=n[a],o=i.projectionDelta;const{visualElement:l}=i.options;l&&l.props.style&&l.props.style.display==="contents"||(r&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Gc(t,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,tD(t,o)),r&&yl(i.latestValues)&&Gc(t,i.latestValues))}e.x<U2&&e.x>B2&&(e.x=1),e.y<U2&&e.y>B2&&(e.y=1)}function Kc(t,e){t.min=t.min+e,t.max=t.max+e}function H2(t,e,n,r,s=.5){const i=ur(t.min,t.max,s);_1(t,e,n,i,r)}function Gc(t,e){H2(t.x,e.x,e.scaleX,e.scale,e.originX),H2(t.y,e.y,e.scaleY,e.scale,e.originY)}function nD(t,e){return ZM(LU(t.getBoundingClientRect(),e))}function zU(t,e,n){const r=nD(t,n),{scroll:s}=e;return s&&(Kc(r.x,s.offset.x),Kc(r.y,s.offset.y)),r}const V2=()=>({translate:0,scale:1,origin:0,originPoint:0}),qc=()=>({x:V2(),y:V2()}),W2=()=>({min:0,max:0}),Ar=()=>({x:W2(),y:W2()}),T1={current:null},rD={current:!1};function FU(){if(rD.current=!0,!!Av)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>T1.current=t.matches;t.addEventListener("change",e),e()}else T1.current=!1}const BU=new WeakMap;function UU(t,e,n){for(const r in e){const s=e[r],i=n[r];if(ps(s))t.addValue(r,s);else if(ps(i))t.addValue(r,wu(s,{owner:t}));else if(i!==s)if(t.hasValue(r)){const o=t.getValue(r);o.liveStyle===!0?o.jump(s):o.hasAnimated||o.set(s)}else{const o=t.getStaticValue(r);t.addValue(r,wu(o!==void 0?o:s,{owner:t}))}}for(const r in n)e[r]===void 0&&t.removeValue(r);return e}const K2=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class HU{scrapeMotionValuesFromProps(e,n,r){return{}}constructor({parent:e,props:n,presenceContext:r,reducedMotionConfig:s,blockInitialAnimation:i,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Jv,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const h=$s.now();this.renderScheduledAt<h&&(this.renderScheduledAt=h,Zn.render(this.render,!1,!0))};const{latestValues:l,renderState:u}=o;this.latestValues=l,this.baseTarget={...l},this.initialValues=n.initial?{...l}:{},this.renderState=u,this.parent=e,this.props=n,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=s,this.options=a,this.blockInitialAnimation=!!i,this.isControllingVariants=Pg(n),this.isVariantNode=UM(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...f}=this.scrapeMotionValuesFromProps(n,{},this);for(const h in f){const p=f[h];l[h]!==void 0&&ps(p)&&p.set(l[h])}}mount(e){var n;this.current=e,BU.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,s)=>this.bindToMotionValue(s,r)),rD.current||FU(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:T1.current,(n=this.parent)==null||n.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var e;this.projection&&this.projection.unmount(),Ka(this.notifyUpdate),Ka(this.render),this.valueSubscriptions.forEach(n=>n()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(e=this.parent)==null||e.removeChild(this);for(const n in this.events)this.events[n].clear();for(const n in this.features){const r=this.features[n];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=$u.has(e);r&&this.onBindTransform&&this.onBindTransform();const s=n.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&Zn.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let i;window.MotionCheckAppearSync&&(i=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{s(),i&&i(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in ku){const n=ku[e];if(!n)continue;const{isEnabled:r,Feature:s}=n;if(!this.features[e]&&s&&r(this.props)&&(this.features[e]=new s(this)),this.features[e]){const i=this.features[e];i.isMounted?i.update():(i.mount(),i.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ar()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let r=0;r<K2.length;r++){const s=K2[r];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const i="on"+s,o=e[i];o&&(this.propEventSubscriptions[s]=this.on(s,o))}this.prevMotionValues=UU(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const r=this.values.get(e);n!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&n!==void 0&&(r=wu(n===null?void 0:n,{owner:this}),this.addValue(e,r)),r}readValue(e,n){let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(GI(r)||YI(r))?r=parseFloat(r):!WB(r)&&Ga.test(n)&&(r=MM(e,n)),this.setBaseTarget(e,ps(r)?r.get():r)),ps(r)?r.get():r}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var i;const{initial:n}=this.props;let r;if(typeof n=="string"||typeof n=="object"){const o=aw(this.props,n,(i=this.presenceContext)==null?void 0:i.custom);o&&(r=o[e])}if(n&&r!==void 0)return r;const s=this.getBaseTargetFromProps(this.props,e);return s!==void 0&&!ps(s)?s:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new zv),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}scheduleRenderMicrotask(){Zv.render(this.render)}}class sD extends HU{constructor(){super(...arguments),this.KeyframeResolver=AB}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:r}){delete n[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;ps(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function iD(t,{style:e,vars:n},r,s){const i=t.style;let o;for(o in e)i[o]=e[o];s==null||s.applyProjectionStyles(i,r);for(o in n)i.setProperty(o,n[o])}function VU(t){return window.getComputedStyle(t)}class WU extends sD{constructor(){super(...arguments),this.type="html",this.renderInstance=iD}readValueFromInstance(e,n){var r;if($u.has(n))return(r=this.projection)!=null&&r.isProjecting?m1(n):QF(e,n);{const s=VU(e),i=(cM(n)?s.getPropertyValue(n):s[n])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:n}){return nD(e,n)}build(e,n,r){sw(e,n,r.transformTemplate)}scrapeMotionValuesFromProps(e,n,r){return lw(e,n,r)}}const oD=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function KU(t,e,n,r){iD(t,e,void 0,r);for(const s in e.attrs)t.setAttribute(oD.has(s)?s:cw(s),e.attrs[s])}class GU extends sD{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ar}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if($u.has(n)){const r=IM(n);return r&&r.default||0}return n=oD.has(n)?n:cw(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,r){return YM(e,n,r)}build(e,n,r){WM(e,n,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(e,n,r,s){KU(e,n,r,s)}mount(e){this.isSVGTag=GM(e.tagName),super.mount(e)}}const qU=(t,e)=>ow(t)?new GU(e):new WU(e,{allowProjection:t!==x.Fragment});function au(t,e,n){const r=t.getProps();return aw(r,e,n!==void 0?n:r.custom,t)}const C1=t=>Array.isArray(t);function YU(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,wu(n))}function JU(t){return C1(t)?t[t.length-1]||0:t}function XU(t,e){const n=au(t,e);let{transitionEnd:r={},transition:s={},...i}=n||{};i={...i,...r};for(const o in i){const a=JU(i[o]);YU(t,o,a)}}function QU(t){return!!(ps(t)&&t.add)}function E1(t,e){const n=t.getValue("willChange");if(QU(n))return n.add(e);if(!n&&Jo.WillChange){const r=new Jo.WillChange("auto");t.addValue("willChange",r),r.add(e)}}function aD(t){return t.props[JM]}const ZU=t=>t!==null;function e8(t,{repeat:e,repeatType:n="loop"},r){const s=t.filter(ZU),i=e&&n!=="loop"&&e%2===1?0:s.length-1;return!i||r===void 0?s[i]:r}const t8={type:"spring",stiffness:500,damping:25,restSpeed:10},n8=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),r8={type:"keyframes",duration:.8},s8={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},i8=(t,{keyframes:e})=>e.length>2?r8:$u.has(t)?t.startsWith("scale")?n8(e[1]):t8:s8;function o8({when:t,delay:e,delayChildren:n,staggerChildren:r,staggerDirection:s,repeat:i,repeatType:o,repeatDelay:a,from:l,elapsed:u,...d}){return!!Object.keys(d).length}const uw=(t,e,n,r={},s,i)=>o=>{const a=Xv(r,t)||{},l=a.delay||r.delay||0;let{elapsed:u=0}=r;u=u-yo(l);const d={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-u,onUpdate:h=>{e.set(h),a.onUpdate&&a.onUpdate(h)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:t,motionValue:e,element:i?void 0:s};o8(a)||Object.assign(d,i8(t,d)),d.duration&&(d.duration=yo(d.duration)),d.repeatDelay&&(d.repeatDelay=yo(d.repeatDelay)),d.from!==void 0&&(d.keyframes[0]=d.from);let f=!1;if((d.type===!1||d.duration===0&&!d.repeatDelay)&&(v1(d),d.delay===0&&(f=!0)),(Jo.instantAnimations||Jo.skipAnimations)&&(f=!0,v1(d),d.delay=0),d.allowFlatten=!a.type&&!a.ease,f&&!i&&e.get()!==void 0){const h=e8(d.keyframes,a);if(h!==void 0){Zn.update(()=>{d.onUpdate(h),d.onComplete()});return}}return a.isSync?new Yv(d):new wB(d)};function a8({protectedKeys:t,needsAnimating:e},n){const r=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,r}function lD(t,e,{delay:n=0,transitionOverride:r,type:s}={}){let{transition:i=t.getDefaultTransition(),transitionEnd:o,...a}=e;r&&(i=r);const l=[],u=s&&t.animationState&&t.animationState.getState()[s];for(const d in a){const f=t.getValue(d,t.latestValues[d]??null),h=a[d];if(h===void 0||u&&a8(u,d))continue;const p={delay:n,...Xv(i||{},d)},m=f.get();if(m!==void 0&&!f.isAnimating&&!Array.isArray(h)&&h===m&&!p.velocity)continue;let y=!1;if(window.MotionHandoffAnimation){const g=aD(t);if(g){const v=window.MotionHandoffAnimation(g,d,Zn);v!==null&&(p.startTime=v,y=!0)}}E1(t,d),f.start(uw(d,f,h,t.shouldReduceMotion&&EM.has(d)?{type:!1}:p,t,y));const b=f.animation;b&&l.push(b)}return o&&Promise.all(l).then(()=>{Zn.update(()=>{o&&XU(t,o)})}),l}function cD(t,e,n,r=0,s=1){const i=Array.from(t).sort((u,d)=>u.sortNodePosition(d)).indexOf(e),o=t.size,a=(o-1)*r;return typeof n=="function"?n(i,o):s===1?i*r:a-i*r}function N1(t,e,n={}){var l;const r=au(t,e,n.type==="exit"?(l=t.presenceContext)==null?void 0:l.custom:void 0);let{transition:s=t.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(s=n.transitionOverride);const i=r?()=>Promise.all(lD(t,r,n)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?(u=0)=>{const{delayChildren:d=0,staggerChildren:f,staggerDirection:h}=s;return l8(t,e,u,d,f,h,n)}:()=>Promise.resolve(),{when:a}=s;if(a){const[u,d]=a==="beforeChildren"?[i,o]:[o,i];return u().then(()=>d())}else return Promise.all([i(),o(n.delay)])}function l8(t,e,n=0,r=0,s=0,i=1,o){const a=[];for(const l of t.variantChildren)l.notify("AnimationStart",e),a.push(N1(l,e,{...o,delay:n+(typeof r=="function"?0:r)+cD(t.variantChildren,l,r,s,i)}).then(()=>l.notify("AnimationComplete",e)));return Promise.all(a)}function c8(t,e,n={}){t.notify("AnimationStart",e);let r;if(Array.isArray(e)){const s=e.map(i=>N1(t,i,n));r=Promise.all(s)}else if(typeof e=="string")r=N1(t,e,n);else{const s=typeof e=="function"?au(t,e,n.custom):e;r=Promise.all(lD(t,s,n))}return r.then(()=>{t.notify("AnimationComplete",e)})}function uD(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}const u8=rw.length;function dD(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?dD(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<u8;n++){const r=rw[n],s=t.props[r];(Tf(s)||s===!1)&&(e[r]=s)}return e}const d8=[...nw].reverse(),f8=nw.length;function h8(t){return e=>Promise.all(e.map(({animation:n,options:r})=>c8(t,n,r)))}function p8(t){let e=h8(t),n=G2(),r=!0;const s=l=>(u,d)=>{var h;const f=au(t,d,l==="exit"?(h=t.presenceContext)==null?void 0:h.custom:void 0);if(f){const{transition:p,transitionEnd:m,...y}=f;u={...u,...y,...m}}return u};function i(l){e=l(t)}function o(l){const{props:u}=t,d=dD(t.parent)||{},f=[],h=new Set;let p={},m=1/0;for(let b=0;b<f8;b++){const g=d8[b],v=n[g],w=u[g]!==void 0?u[g]:d[g],T=Tf(w),R=g===l?v.isActive:null;R===!1&&(m=b);let k=w===d[g]&&w!==u[g]&&T;if(k&&r&&t.manuallyAnimateOnMount&&(k=!1),v.protectedKeys={...p},!v.isActive&&R===null||!w&&!v.prevProp||Og(w)||typeof w=="boolean")continue;const M=m8(v.prevProp,w);let S=M||g===l&&v.isActive&&!k&&T||b>m&&T,C=!1;const _=Array.isArray(w)?w:[w];let E=_.reduce(s(g),{});R===!1&&(E={});const{prevResolvedValues:I={}}=v,P={...I,...E},O=j=>{S=!0,h.has(j)&&(C=!0,h.delete(j)),v.needsAnimating[j]=!0;const W=t.getValue(j);W&&(W.liveStyle=!1)};for(const j in P){const W=E[j],V=I[j];if(p.hasOwnProperty(j))continue;let D=!1;C1(W)&&C1(V)?D=!uD(W,V):D=W!==V,D?W!=null?O(j):h.add(j):W!==void 0&&h.has(j)?O(j):v.protectedKeys[j]=!0}v.prevProp=w,v.prevResolvedValues=E,v.isActive&&(p={...p,...E}),r&&t.blockInitialAnimation&&(S=!1);const $=k&&M;S&&(!$||C)&&f.push(..._.map(j=>{const W={type:g};if(typeof j=="string"&&r&&!$&&t.manuallyAnimateOnMount&&t.parent){const{parent:V}=t,D=au(V,j);if(V.enteringChildren&&D){const{delayChildren:ge}=D.transition||{};W.delay=cD(V.enteringChildren,t,ge)}}return{animation:j,options:W}}))}if(h.size){const b={};if(typeof u.initial!="boolean"){const g=au(t,Array.isArray(u.initial)?u.initial[0]:u.initial);g&&g.transition&&(b.transition=g.transition)}h.forEach(g=>{const v=t.getBaseTarget(g),w=t.getValue(g);w&&(w.liveStyle=!0),b[g]=v??null}),f.push({animation:b})}let y=!!f.length;return r&&(u.initial===!1||u.initial===u.animate)&&!t.manuallyAnimateOnMount&&(y=!1),r=!1,y?e(f):Promise.resolve()}function a(l,u){var f;if(n[l].isActive===u)return Promise.resolve();(f=t.variantChildren)==null||f.forEach(h=>{var p;return(p=h.animationState)==null?void 0:p.setActive(l,u)}),n[l].isActive=u;const d=o(l);for(const h in n)n[h].protectedKeys={};return d}return{animateChanges:o,setActive:a,setAnimateFunction:i,getState:()=>n,reset:()=>{n=G2()}}}function m8(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!uD(e,t):!1}function hl(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function G2(){return{animate:hl(!0),whileInView:hl(),whileHover:hl(),whileTap:hl(),whileDrag:hl(),whileFocus:hl(),exit:hl()}}class el{constructor(e){this.isMounted=!1,this.node=e}update(){}}class g8 extends el{constructor(e){super(e),e.animationState||(e.animationState=p8(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Og(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)==null||e.call(this)}}let y8=0;class x8 extends el{constructor(){super(...arguments),this.id=y8++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const s=this.node.animationState.setActive("exit",!e);n&&!e&&s.then(()=>{n(this.id)})}mount(){const{register:e,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const b8={animation:{Feature:g8},exit:{Feature:x8}};function Cf(t,e,n,r={passive:!0}){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n)}function th(t){return{point:{x:t.pageX,y:t.pageY}}}const v8=t=>e=>ew(e)&&t(e,th(e));function Md(t,e,n,r){return Cf(t,e,v8(n),r)}const fD=1e-4,w8=1-fD,k8=1+fD,hD=.01,S8=0-hD,_8=0+hD;function Ss(t){return t.max-t.min}function T8(t,e,n){return Math.abs(t-e)<=n}function q2(t,e,n,r=.5){t.origin=r,t.originPoint=ur(e.min,e.max,t.origin),t.scale=Ss(n)/Ss(e),t.translate=ur(n.min,n.max,t.origin)-t.originPoint,(t.scale>=w8&&t.scale<=k8||isNaN(t.scale))&&(t.scale=1),(t.translate>=S8&&t.translate<=_8||isNaN(t.translate))&&(t.translate=0)}function Dd(t,e,n,r){q2(t.x,e.x,n.x,r?r.originX:void 0),q2(t.y,e.y,n.y,r?r.originY:void 0)}function Y2(t,e,n){t.min=n.min+e.min,t.max=t.min+Ss(e)}function C8(t,e,n){Y2(t.x,e.x,n.x),Y2(t.y,e.y,n.y)}function J2(t,e,n){t.min=e.min-n.min,t.max=t.min+Ss(e)}function hm(t,e,n){J2(t.x,e.x,n.x),J2(t.y,e.y,n.y)}function mi(t){return[t("x"),t("y")]}const pD=({current:t})=>t?t.ownerDocument.defaultView:null,X2=(t,e)=>Math.abs(t-e);function E8(t,e){const n=X2(t.x,e.x),r=X2(t.y,e.y);return Math.sqrt(n**2+r**2)}class mD{constructor(e,n,{transformPagePoint:r,contextWindow:s=window,dragSnapToOrigin:i=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=Z0(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,m=E8(h.offset,{x:0,y:0})>=this.distanceThreshold;if(!p&&!m)return;const{point:y}=h,{timestamp:b}=Xr;this.history.push({...y,timestamp:b});const{onStart:g,onMove:v}=this.handlers;p||(g&&g(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),v&&v(this.lastMoveEvent,h)},this.handlePointerMove=(h,p)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=Q0(p,this.transformPagePoint),Zn.update(this.updatePoint,!0)},this.handlePointerUp=(h,p)=>{this.end();const{onEnd:m,onSessionEnd:y,resumeAnimation:b}=this.handlers;if(this.dragSnapToOrigin&&b&&b(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=Z0(h.type==="pointercancel"?this.lastMoveEventInfo:Q0(p,this.transformPagePoint),this.history);this.startEvent&&m&&m(h,g),y&&y(h,g)},!ew(e))return;this.dragSnapToOrigin=i,this.handlers=n,this.transformPagePoint=r,this.distanceThreshold=o,this.contextWindow=s||window;const a=th(e),l=Q0(a,this.transformPagePoint),{point:u}=l,{timestamp:d}=Xr;this.history=[{...u,timestamp:d}];const{onSessionStart:f}=n;f&&f(e,Z0(l,this.history)),this.removeListeners=Qf(Md(this.contextWindow,"pointermove",this.handlePointerMove),Md(this.contextWindow,"pointerup",this.handlePointerUp),Md(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Ka(this.updatePoint)}}function Q0(t,e){return e?{point:e(t.point)}:t}function Q2(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Z0({point:t},e){return{point:t,delta:Q2(t,gD(e)),offset:Q2(t,N8(e)),velocity:j8(e,.1)}}function N8(t){return t[0]}function gD(t){return t[t.length-1]}function j8(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,r=null;const s=gD(t);for(;n>=0&&(r=t[n],!(s.timestamp-r.timestamp>yo(e)));)n--;if(!r)return{x:0,y:0};const i=Ti(s.timestamp-r.timestamp);if(i===0)return{x:0,y:0};const o={x:(s.x-r.x)/i,y:(s.y-r.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function I8(t,{min:e,max:n},r){return e!==void 0&&t<e?t=r?ur(e,t,r.min):Math.max(t,e):n!==void 0&&t>n&&(t=r?ur(n,t,r.max):Math.min(t,n)),t}function Z2(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function M8(t,{top:e,left:n,bottom:r,right:s}){return{x:Z2(t.x,n,s),y:Z2(t.y,e,r)}}function e_(t,e){let n=e.min-t.min,r=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,r]=[r,n]),{min:n,max:r}}function D8(t,e){return{x:e_(t.x,e.x),y:e_(t.y,e.y)}}function A8(t,e){let n=.5;const r=Ss(t),s=Ss(e);return s>r?n=kf(e.min,e.max-r,t.min):r>s&&(n=kf(t.min,t.max-s,e.min)),Yo(0,1,n)}function R8(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const j1=.35;function O8(t=j1){return t===!1?t=0:t===!0&&(t=j1),{x:t_(t,"left","right"),y:t_(t,"top","bottom")}}function t_(t,e,n){return{min:n_(t,e),max:n_(t,n)}}function n_(t,e){return typeof t=="number"?t:t[e]||0}const P8=new WeakMap;class L8{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ar(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:n=!1,distanceThreshold:r}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const i=f=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(th(f).point)},o=(f,h)=>{const{drag:p,dragPropagation:m,onDragStart:y}=this.getProps();if(p&&!m&&(this.openDragLock&&this.openDragLock(),this.openDragLock=LB(p),!this.openDragLock))return;this.latestPointerEvent=f,this.latestPanInfo=h,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),mi(g=>{let v=this.getAxisMotionValue(g).get()||0;if(xo.test(v)){const{projection:w}=this.visualElement;if(w&&w.layout){const T=w.layout.layoutBox[g];T&&(v=Ss(T)*(parseFloat(v)/100))}}this.originPoint[g]=v}),y&&Zn.postRender(()=>y(f,h)),E1(this.visualElement,"transform");const{animationState:b}=this.visualElement;b&&b.setActive("whileDrag",!0)},a=(f,h)=>{this.latestPointerEvent=f,this.latestPanInfo=h;const{dragPropagation:p,dragDirectionLock:m,onDirectionLock:y,onDrag:b}=this.getProps();if(!p&&!this.openDragLock)return;const{offset:g}=h;if(m&&this.currentDirection===null){this.currentDirection=$8(g),this.currentDirection!==null&&y&&y(this.currentDirection);return}this.updateAxis("x",h.point,g),this.updateAxis("y",h.point,g),this.visualElement.render(),b&&b(f,h)},l=(f,h)=>{this.latestPointerEvent=f,this.latestPanInfo=h,this.stop(f,h),this.latestPointerEvent=null,this.latestPanInfo=null},u=()=>mi(f=>{var h;return this.getAnimationState(f)==="paused"&&((h=this.getAxisMotionValue(f).animation)==null?void 0:h.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new mD(e,{onSessionStart:i,onStart:o,onMove:a,onSessionEnd:l,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,distanceThreshold:r,contextWindow:pD(this.visualElement)})}stop(e,n){const r=e||this.latestPointerEvent,s=n||this.latestPanInfo,i=this.isDragging;if(this.cancel(),!i||!s||!r)return;const{velocity:o}=s;this.startAnimation(o);const{onDragEnd:a}=this.getProps();a&&Zn.postRender(()=>a(r,s))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,r){const{drag:s}=this.getProps();if(!r||!Oh(e,s,this.currentDirection))return;const i=this.getAxisMotionValue(e);let o=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(o=I8(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){var i;const{dragConstraints:e,dragElastic:n}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(i=this.visualElement.projection)==null?void 0:i.layout,s=this.constraints;e&&Wc(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&r?this.constraints=M8(r.layoutBox,e):this.constraints=!1,this.elastic=O8(n),s!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&mi(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=R8(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!Wc(e))return!1;const r=e.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const i=zU(r,s.root,this.visualElement.getTransformPagePoint());let o=D8(s.layout.layoutBox,i);if(n){const a=n(PU(o));this.hasMutatedConstraints=!!a,a&&(o=ZM(a))}return o}startAnimation(e){const{drag:n,dragMomentum:r,dragElastic:s,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),l=this.constraints||{},u=mi(d=>{if(!Oh(d,n,this.currentDirection))return;let f=l&&l[d]||{};o&&(f={min:0,max:0});const h=s?200:1e6,p=s?40:1e7,m={type:"inertia",velocity:r?e[d]:0,bounceStiffness:h,bounceDamping:p,timeConstant:750,restDelta:1,restSpeed:10,...i,...f};return this.startAxisValueAnimation(d,m)});return Promise.all(u).then(a)}startAxisValueAnimation(e,n){const r=this.getAxisMotionValue(e);return E1(this.visualElement,e),r.start(uw(e,r,0,n,this.visualElement,!1))}stopAnimation(){mi(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){mi(e=>{var n;return(n=this.getAxisMotionValue(e).animation)==null?void 0:n.pause()})}getAnimationState(e){var n;return(n=this.getAxisMotionValue(e).animation)==null?void 0:n.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps(),s=r[n];return s||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){mi(n=>{const{drag:r}=this.getProps();if(!Oh(n,r,this.currentDirection))return;const{projection:s}=this.visualElement,i=this.getAxisMotionValue(n);if(s&&s.layout){const{min:o,max:a}=s.layout.layoutBox[n];i.set(e[n]-ur(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:r}=this.visualElement;if(!Wc(n)||!r||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};mi(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const l=a.get();s[o]=A8({min:l,max:l},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),mi(o=>{if(!Oh(o,e,null))return;const a=this.getAxisMotionValue(o),{min:l,max:u}=this.constraints[o];a.set(ur(l,u,s[o]))})}addListeners(){if(!this.visualElement.current)return;P8.set(this.visualElement,this);const e=this.visualElement.current,n=Md(e,"pointerdown",l=>{const{drag:u,dragListener:d=!0}=this.getProps();u&&d&&this.start(l)}),r=()=>{const{dragConstraints:l}=this.getProps();Wc(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,i=s.addEventListener("measure",r);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),Zn.read(r);const o=Cf(window,"resize",()=>this.scalePositionWithinConstraints()),a=s.addEventListener("didUpdate",({delta:l,hasLayoutChanged:u})=>{this.isDragging&&u&&(mi(d=>{const f=this.getAxisMotionValue(d);f&&(this.originPoint[d]+=l[d].translate,f.set(f.get()+l[d].translate))}),this.visualElement.render())});return()=>{o(),n(),i(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:r=!1,dragPropagation:s=!1,dragConstraints:i=!1,dragElastic:o=j1,dragMomentum:a=!0}=e;return{...e,drag:n,dragDirectionLock:r,dragPropagation:s,dragConstraints:i,dragElastic:o,dragMomentum:a}}}function Oh(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function $8(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class z8 extends el{constructor(e){super(e),this.removeGroupControls=Ei,this.removeListeners=Ei,this.controls=new L8(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ei}unmount(){this.removeGroupControls(),this.removeListeners()}}const r_=t=>(e,n)=>{t&&Zn.postRender(()=>t(e,n))};class F8 extends el{constructor(){super(...arguments),this.removePointerDownListener=Ei}onPointerDown(e){this.session=new mD(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:pD(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:r,onPanEnd:s}=this.node.getProps();return{onSessionStart:r_(e),onStart:r_(n),onMove:r,onEnd:(i,o)=>{delete this.session,s&&Zn.postRender(()=>s(i,o))}}}mount(){this.removePointerDownListener=Md(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const wp={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let ey=!1;class B8 extends x.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r,layoutId:s}=this.props,{projection:i}=e;i&&(n.group&&n.group.add(i),r&&r.register&&s&&r.register(i),ey&&i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),wp.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:r,drag:s,isPresent:i}=this.props,{projection:o}=r;return o&&(o.isPresent=i,ey=!0,s||e.layoutDependency!==n||n===void 0||e.isPresent!==i?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||Zn.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Zv.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r}=this.props,{projection:s}=e;ey=!0,s&&(s.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(s),r&&r.deregister&&r.deregister(s))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function yD(t){const[e,n]=$M(),r=x.useContext(wf);return c.jsx(B8,{...t,layoutGroup:r,switchLayoutGroup:x.useContext(XM),isPresent:e,safeToRemove:n})}function U8(t,e,n){const r=ps(t)?t:wu(t);return r.start(uw("",r,e,n)),r.animation}const H8=(t,e)=>t.depth-e.depth;class V8{constructor(){this.children=[],this.isDirty=!1}add(e){Ov(this.children,e),this.isDirty=!0}remove(e){Pv(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(H8),this.isDirty=!1,this.children.forEach(e)}}function W8(t,e){const n=$s.now(),r=({timestamp:s})=>{const i=s-n;i>=e&&(Ka(r),t(i-e))};return Zn.setup(r,!0),()=>Ka(r)}const xD=["TopLeft","TopRight","BottomLeft","BottomRight"],K8=xD.length,s_=t=>typeof t=="string"?parseFloat(t):t,i_=t=>typeof t=="number"||ln.test(t);function G8(t,e,n,r,s,i){s?(t.opacity=ur(0,n.opacity??1,q8(r)),t.opacityExit=ur(e.opacity??1,0,Y8(r))):i&&(t.opacity=ur(e.opacity??1,n.opacity??1,r));for(let o=0;o<K8;o++){const a=`border${xD[o]}Radius`;let l=o_(e,a),u=o_(n,a);if(l===void 0&&u===void 0)continue;l||(l=0),u||(u=0),l===0||u===0||i_(l)===i_(u)?(t[a]=Math.max(ur(s_(l),s_(u),r),0),(xo.test(u)||xo.test(l))&&(t[a]+="%")):t[a]=u}(e.rotate||n.rotate)&&(t.rotate=ur(e.rotate||0,n.rotate||0,r))}function o_(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const q8=bD(0,.5,rM),Y8=bD(.5,.95,Ei);function bD(t,e,n){return r=>r<t?0:r>e?1:n(kf(t,e,r))}function a_(t,e){t.min=e.min,t.max=e.max}function zi(t,e){a_(t.x,e.x),a_(t.y,e.y)}function l_(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function c_(t,e,n,r,s){return t-=e,t=fm(t,1/n,r),s!==void 0&&(t=fm(t,1/s,r)),t}function J8(t,e=0,n=1,r=.5,s,i=t,o=t){if(xo.test(e)&&(e=parseFloat(e),e=ur(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=ur(i.min,i.max,r);t===i&&(a-=e),t.min=c_(t.min,e,n,a,s),t.max=c_(t.max,e,n,a,s)}function u_(t,e,[n,r,s],i,o){J8(t,e[n],e[r],e[s],e.scale,i,o)}const X8=["x","scaleX","originX"],Q8=["y","scaleY","originY"];function d_(t,e,n,r){u_(t.x,e,X8,n?n.x:void 0,r?r.x:void 0),u_(t.y,e,Q8,n?n.y:void 0,r?r.y:void 0)}function f_(t){return t.translate===0&&t.scale===1}function vD(t){return f_(t.x)&&f_(t.y)}function h_(t,e){return t.min===e.min&&t.max===e.max}function Z8(t,e){return h_(t.x,e.x)&&h_(t.y,e.y)}function p_(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function wD(t,e){return p_(t.x,e.x)&&p_(t.y,e.y)}function m_(t){return Ss(t.x)/Ss(t.y)}function g_(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class e9{constructor(){this.members=[]}add(e){Ov(this.members,e),e.scheduleRender()}remove(e){if(Pv(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(s=>e===s);if(n===0)return!1;let r;for(let s=n;s>=0;s--){const i=this.members[s];if(i.isPresent!==!1){r=i;break}}return r?(this.promote(r),!0):!1}promote(e,n){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,n&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:s}=e.options;s===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:r}=e;n.onExitComplete&&n.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function t9(t,e,n){let r="";const s=t.x.translate/e.x,i=t.y.translate/e.y,o=(n==null?void 0:n.z)||0;if((s||i||o)&&(r=`translate3d(${s}px, ${i}px, ${o}px) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:u,rotate:d,rotateX:f,rotateY:h,skewX:p,skewY:m}=n;u&&(r=`perspective(${u}px) ${r}`),d&&(r+=`rotate(${d}deg) `),f&&(r+=`rotateX(${f}deg) `),h&&(r+=`rotateY(${h}deg) `),p&&(r+=`skewX(${p}deg) `),m&&(r+=`skewY(${m}deg) `)}const a=t.x.scale*e.x,l=t.y.scale*e.y;return(a!==1||l!==1)&&(r+=`scale(${a}, ${l})`),r||"none"}const ty=["","X","Y","Z"],n9=1e3;let r9=0;function ny(t,e,n,r){const{latestValues:s}=e;s[t]&&(n[t]=s[t],e.setStaticValue(t,0),r&&(r[t]=0))}function kD(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=aD(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:s,layoutId:i}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",Zn,!(s||i))}const{parent:r}=t;r&&!r.hasCheckedOptimisedAppear&&kD(r)}function SD({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:r,resetTransform:s}){return class{constructor(o={},a=e==null?void 0:e()){this.id=r9++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(o9),this.nodes.forEach(u9),this.nodes.forEach(d9),this.nodes.forEach(a9)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new V8)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new zv),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const l=this.eventHandlers.get(o);l&&l.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=LM(o)&&!HB(o),this.instance=o;const{layoutId:a,layout:l,visualElement:u}=this.options;if(u&&!u.current&&u.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(l||a)&&(this.isLayoutDirty=!0),t){let d,f=0;const h=()=>this.root.updateBlockedByResize=!1;Zn.read(()=>{f=window.innerWidth}),t(o,()=>{const p=window.innerWidth;p!==f&&(f=p,this.root.updateBlockedByResize=!0,d&&d(),d=W8(h,250),wp.hasAnimatedSinceResize&&(wp.hasAnimatedSinceResize=!1,this.nodes.forEach(b_)))})}a&&this.root.registerSharedNode(a,this),this.options.animate!==!1&&u&&(a||l)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:f,hasRelativeLayoutChanged:h,layout:p})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const m=this.options.transition||u.getDefaultTransition()||g9,{onLayoutAnimationStart:y,onLayoutAnimationComplete:b}=u.getProps(),g=!this.targetLayout||!wD(this.targetLayout,p),v=!f&&h;if(this.options.layoutRoot||this.resumeFrom||v||f&&(g||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const w={...Xv(m,"layout"),onPlay:y,onComplete:b};(u.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w),this.setAnimationOrigin(d,v)}else f||b_(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=p})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Ka(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(f9),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&kD(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let d=0;d<this.path.length;d++){const f=this.path[d];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:a,layout:l}=this.options;if(a===void 0&&!l)return;const u=this.getTransformTemplate();this.prevTransformTemplateValue=u?u(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(y_);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(x_);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(c9),this.nodes.forEach(s9),this.nodes.forEach(i9)):this.nodes.forEach(x_),this.clearAllSnapshots();const a=$s.now();Xr.delta=Yo(0,1e3/60,a-Xr.timestamp),Xr.timestamp=a,Xr.isProcessing=!0,V0.update.process(Xr),V0.preRender.process(Xr),V0.render.process(Xr),Xr.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Zv.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(l9),this.sharedNodes.forEach(h9)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Zn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Zn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Ss(this.snapshot.measuredBox.x)&&!Ss(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=Ar(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a&&this.instance){const l=r(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:l,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!s)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!vD(this.projectionDelta),l=this.getTransformTemplate(),u=l?l(this.latestValues,""):void 0,d=u!==this.prevTransformTemplateValue;o&&this.instance&&(a||yl(this.latestValues)||d)&&(s(this.instance,u),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let l=this.removeElementScroll(a);return o&&(l=this.removeTransform(l)),y9(l),{animationId:this.root.animationId,measuredBox:a,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var u;const{visualElement:o}=this.options;if(!o)return Ar();const a=o.measureViewportBox();if(!(((u=this.scroll)==null?void 0:u.wasRoot)||this.path.some(x9))){const{scroll:d}=this.root;d&&(Kc(a.x,d.offset.x),Kc(a.y,d.offset.y))}return a}removeElementScroll(o){var l;const a=Ar();if(zi(a,o),(l=this.scroll)!=null&&l.wasRoot)return a;for(let u=0;u<this.path.length;u++){const d=this.path[u],{scroll:f,options:h}=d;d!==this.root&&f&&h.layoutScroll&&(f.wasRoot&&zi(a,o),Kc(a.x,f.offset.x),Kc(a.y,f.offset.y))}return a}applyTransform(o,a=!1){const l=Ar();zi(l,o);for(let u=0;u<this.path.length;u++){const d=this.path[u];!a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&Gc(l,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),yl(d.latestValues)&&Gc(l,d.latestValues)}return yl(this.latestValues)&&Gc(l,this.latestValues),l}removeTransform(o){const a=Ar();zi(a,o);for(let l=0;l<this.path.length;l++){const u=this.path[l];if(!u.instance||!yl(u.latestValues))continue;S1(u.latestValues)&&u.updateSnapshot();const d=Ar(),f=u.measurePageBox();zi(d,f),d_(a,u.latestValues,u.snapshot?u.snapshot.layoutBox:void 0,d)}return yl(this.latestValues)&&d_(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Xr.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var p;const a=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=a.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=a.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=a.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==a;if(!(o||l&&this.isSharedProjectionDirty||this.isProjectionDirty||(p=this.parent)!=null&&p.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:f}=this.options;if(!this.layout||!(d||f))return;this.resolvedRelativeTargetAt=Xr.timestamp;const h=this.getClosestProjectingParent();h&&this.linkedParentVersion!==h.layoutVersion&&!h.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(h&&h.layout?this.createRelativeTarget(h,this.layout.layoutBox,h.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Ar(),this.targetWithTransforms=Ar()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),C8(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):zi(this.target,this.layout.layoutBox),tD(this.target,this.targetDelta)):zi(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,h&&!!h.resumingFrom==!!this.resumingFrom&&!h.options.layoutScroll&&h.target&&this.animationProgress!==1?this.createRelativeTarget(h,this.target,h.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||S1(this.parent.latestValues)||eD(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(o,a,l){this.relativeParent=o,this.linkedParentVersion=o.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ar(),this.relativeTargetOrigin=Ar(),hm(this.relativeTargetOrigin,a,l),zi(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var m;const o=this.getLead(),a=!!this.resumingFrom||this!==o;let l=!0;if((this.isProjectionDirty||(m=this.parent)!=null&&m.isProjectionDirty)&&(l=!1),a&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===Xr.timestamp&&(l=!1),l)return;const{layout:u,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||d))return;zi(this.layoutCorrected,this.layout.layoutBox);const f=this.treeScale.x,h=this.treeScale.y;$U(this.layoutCorrected,this.treeScale,this.path,a),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=Ar());const{target:p}=o;if(!p){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(l_(this.prevProjectionDelta.x,this.projectionDelta.x),l_(this.prevProjectionDelta.y,this.projectionDelta.y)),Dd(this.projectionDelta,this.layoutCorrected,p,this.latestValues),(this.treeScale.x!==f||this.treeScale.y!==h||!g_(this.projectionDelta.x,this.prevProjectionDelta.x)||!g_(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",p))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var a;if((a=this.options.visualElement)==null||a.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=qc(),this.projectionDelta=qc(),this.projectionDeltaWithTransform=qc()}setAnimationOrigin(o,a=!1){const l=this.snapshot,u=l?l.latestValues:{},d={...this.latestValues},f=qc();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const h=Ar(),p=l?l.source:void 0,m=this.layout?this.layout.source:void 0,y=p!==m,b=this.getStack(),g=!b||b.members.length<=1,v=!!(y&&!g&&this.options.crossfade===!0&&!this.path.some(m9));this.animationProgress=0;let w;this.mixTargetDelta=T=>{const R=T/1e3;v_(f.x,o.x,R),v_(f.y,o.y,R),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(hm(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),p9(this.relativeTarget,this.relativeTargetOrigin,h,R),w&&Z8(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=Ar()),zi(w,this.relativeTarget)),y&&(this.animationValues=d,G8(d,u,this.latestValues,R,v,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=R},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){var a,l,u;this.notifyListeners("animationStart"),(a=this.currentAnimation)==null||a.stop(),(u=(l=this.resumingFrom)==null?void 0:l.currentAnimation)==null||u.stop(),this.pendingAnimation&&(Ka(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Zn.update(()=>{wp.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=wu(0)),this.currentAnimation=U8(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:d=>{this.mixTargetDelta(d),o.onUpdate&&o.onUpdate(d)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(n9),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:l,layout:u,latestValues:d}=o;if(!(!a||!l||!u)){if(this!==o&&this.layout&&u&&_D(this.options.animationType,this.layout.layoutBox,u.layoutBox)){l=this.target||Ar();const f=Ss(this.layout.layoutBox.x);l.x.min=o.target.x.min,l.x.max=l.x.min+f;const h=Ss(this.layout.layoutBox.y);l.y.min=o.target.y.min,l.y.max=l.y.min+h}zi(a,l),Gc(a,d),Dd(this.projectionDeltaWithTransform,this.layoutCorrected,a,d)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new e9),this.sharedNodes.get(o).add(a);const u=a.options.initialPromotionConfig;a.promote({transition:u?u.transition:void 0,preserveFollowOpacity:u&&u.shouldPreserveFollowOpacity?u.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var a;const{layoutId:o}=this.options;return o?((a=this.getStack())==null?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:o}=this.options;return o?(a=this.getStack())==null?void 0:a.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:l}={}){const u=this.getStack();u&&u.promote(this,l),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:l}=o;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(a=!0),!a)return;const u={};l.z&&ny("z",o,u,this.animationValues);for(let d=0;d<ty.length;d++)ny(`rotate${ty[d]}`,o,u,this.animationValues),ny(`skew${ty[d]}`,o,u,this.animationValues);o.render();for(const d in u)o.setStaticValue(d,u[d]),this.animationValues&&(this.animationValues[d]=u[d]);o.scheduleRender()}applyProjectionStyles(o,a){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const l=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=vp(a==null?void 0:a.pointerEvents)||"",o.transform=l?l(this.latestValues,""):"none";return}const u=this.getLead();if(!this.projectionDelta||!this.layout||!u.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=vp(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!yl(this.latestValues)&&(o.transform=l?l({},""):"none",this.hasProjected=!1);return}o.visibility="";const d=u.animationValues||u.latestValues;this.applyTransformsToTarget();let f=t9(this.projectionDeltaWithTransform,this.treeScale,d);l&&(f=l(d,f)),o.transform=f;const{x:h,y:p}=this.projectionDelta;o.transformOrigin=`${h.origin*100}% ${p.origin*100}% 0`,u.animationValues?o.opacity=u===this?d.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:o.opacity=u===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const m in k1){if(d[m]===void 0)continue;const{correct:y,applyTo:b,isCSSVariable:g}=k1[m],v=f==="none"?d[m]:y(d[m],u);if(b){const w=b.length;for(let T=0;T<w;T++)o[b[T]]=v}else g?this.options.visualElement.renderState.vars[m]=v:o[m]=v}this.options.layoutId&&(o.pointerEvents=u===this?vp(a==null?void 0:a.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var a;return(a=o.currentAnimation)==null?void 0:a.stop()}),this.root.nodes.forEach(y_),this.root.sharedNodes.clear()}}}function s9(t){t.updateLayout()}function i9(t){var n;const e=((n=t.resumeFrom)==null?void 0:n.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:s}=t.layout,{animationType:i}=t.options,o=e.source!==t.layout.source;i==="size"?mi(f=>{const h=o?e.measuredBox[f]:e.layoutBox[f],p=Ss(h);h.min=r[f].min,h.max=h.min+p}):_D(i,e.layoutBox,r)&&mi(f=>{const h=o?e.measuredBox[f]:e.layoutBox[f],p=Ss(r[f]);h.max=h.min+p,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[f].max=t.relativeTarget[f].min+p)});const a=qc();Dd(a,r,e.layoutBox);const l=qc();o?Dd(l,t.applyTransform(s,!0),e.measuredBox):Dd(l,r,e.layoutBox);const u=!vD(a);let d=!1;if(!t.resumeFrom){const f=t.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:h,layout:p}=f;if(h&&p){const m=Ar();hm(m,e.layoutBox,h.layoutBox);const y=Ar();hm(y,r,p.layoutBox),wD(m,y)||(d=!0),f.options.layoutRoot&&(t.relativeTarget=y,t.relativeTargetOrigin=m,t.relativeParent=f)}}}t.notifyListeners("didUpdate",{layout:r,snapshot:e,delta:l,layoutDelta:a,hasLayoutChanged:u,hasRelativeLayoutChanged:d})}else if(t.isLead()){const{onExitComplete:r}=t.options;r&&r()}t.options.transition=void 0}function o9(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function a9(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function l9(t){t.clearSnapshot()}function y_(t){t.clearMeasurements()}function x_(t){t.isLayoutDirty=!1}function c9(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function b_(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function u9(t){t.resolveTargetDelta()}function d9(t){t.calcProjection()}function f9(t){t.resetSkewAndRotation()}function h9(t){t.removeLeadSnapshot()}function v_(t,e,n){t.translate=ur(e.translate,0,n),t.scale=ur(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function w_(t,e,n,r){t.min=ur(e.min,n.min,r),t.max=ur(e.max,n.max,r)}function p9(t,e,n,r){w_(t.x,e.x,n.x,r),w_(t.y,e.y,n.y,r)}function m9(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const g9={duration:.45,ease:[.4,0,.1,1]},k_=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),S_=k_("applewebkit/")&&!k_("chrome/")?Math.round:Ei;function __(t){t.min=S_(t.min),t.max=S_(t.max)}function y9(t){__(t.x),__(t.y)}function _D(t,e,n){return t==="position"||t==="preserve-aspect"&&!T8(m_(e),m_(n),.2)}function x9(t){var e;return t!==t.root&&((e=t.scroll)==null?void 0:e.wasRoot)}const b9=SD({attachResizeListener:(t,e)=>Cf(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),ry={current:void 0},TD=SD({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!ry.current){const t=new b9({});t.mount(window),t.setOptions({layoutScroll:!0}),ry.current=t}return ry.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),v9={pan:{Feature:F8},drag:{Feature:z8,ProjectionNode:TD,MeasureLayout:yD}};function T_(t,e,n){const{props:r}=t;t.animationState&&r.whileHover&&t.animationState.setActive("whileHover",n==="Start");const s="onHover"+n,i=r[s];i&&Zn.postRender(()=>i(e,th(e)))}class w9 extends el{mount(){const{current:e}=this.node;e&&(this.unmount=$B(e,(n,r)=>(T_(this.node,r,"Start"),s=>T_(this.node,s,"End"))))}unmount(){}}class k9 extends el{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Qf(Cf(this.node.current,"focus",()=>this.onFocus()),Cf(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function C_(t,e,n){const{props:r}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&r.whileTap&&t.animationState.setActive("whileTap",n==="Start");const s="onTap"+(n==="End"?"":n),i=r[s];i&&Zn.postRender(()=>i(e,th(e)))}class S9 extends el{mount(){const{current:e}=this.node;e&&(this.unmount=UB(e,(n,r)=>(C_(this.node,r,"Start"),(s,{success:i})=>C_(this.node,s,i?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const I1=new WeakMap,sy=new WeakMap,_9=t=>{const e=I1.get(t.target);e&&e(t)},T9=t=>{t.forEach(_9)};function C9({root:t,...e}){const n=t||document;sy.has(n)||sy.set(n,{});const r=sy.get(n),s=JSON.stringify(e);return r[s]||(r[s]=new IntersectionObserver(T9,{root:t,...e})),r[s]}function E9(t,e,n){const r=C9(e);return I1.set(t,n),r.observe(t),()=>{I1.delete(t),r.unobserve(t)}}const N9={some:0,all:1};class j9 extends el{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:r,amount:s="some",once:i}=e,o={root:n?n.current:void 0,rootMargin:r,threshold:typeof s=="number"?s:N9[s]},a=l=>{const{isIntersecting:u}=l;if(this.isInView===u||(this.isInView=u,i&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:d,onViewportLeave:f}=this.node.getProps(),h=u?d:f;h&&h(l)};return E9(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(I9(e,n))&&this.startObserver()}unmount(){}}function I9({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const M9={inView:{Feature:j9},tap:{Feature:S9},focus:{Feature:k9},hover:{Feature:w9}},D9={layout:{ProjectionNode:TD,MeasureLayout:yD}},A9={...b8,...M9,...v9,...D9},Pr=OU(A9,qU),R9=({url:t,fileName:e,autoPlay:n=!1,markers:r=[],onClose:s,seekToTime:i})=>{const o=x.useRef(null),[a,l]=x.useState(n),[u,d]=x.useState(0),[f,h]=x.useState(0);x.useEffect(()=>{n&&o.current&&o.current.play().catch(console.error)},[t,n]);const p=()=>{o.current&&(a?o.current.pause():o.current.play(),l(!a))},m=()=>{o.current&&h(o.current.currentTime)},y=()=>{o.current&&d(o.current.duration)},b=T=>{const R=parseFloat(T.target.value);o.current&&(o.current.currentTime=R,h(R))},g=T=>{if(o.current){const R=Math.min(Math.max(o.current.currentTime+T,0),u);o.current.currentTime=R,h(R)}},v=T=>{if(o.current){const R=T/1e3;o.current.currentTime=R,h(R),o.current.play().catch(console.error),l(!0)}};x.useEffect(()=>{i!=null&&o.current&&v(i)},[i]);const w=T=>{if(isNaN(T))return"0:00";const R=Math.floor(T/60),k=Math.floor(T%60);return`${R}:${k.toString().padStart(2,"0")}`};return c.jsxs("div",{className:"w-full bg-slate-50 border border-indigo-100 rounded-xl p-3 mb-4 animate-in fade-in slide-in-from-top-2 flex flex-col gap-2 shadow-sm sticky top-0 z-10 backdrop-blur-sm bg-slate-50/95",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 flex-shrink-0",children:c.jsx(o1,{size:16})}),c.jsx("span",{className:"text-xs font-medium text-slate-700 truncate",title:e,children:e||"Audio Recording"}),r.length>0&&c.jsxs("span",{className:"text-[10px] text-slate-400 bg-slate-200 px-1.5 py-0.5 rounded-full",children:[r.length," "]})]}),s&&c.jsx("button",{onClick:s,className:"p-1 hover:bg-slate-200 rounded-full text-slate-400 hover:text-slate-600 transition-colors",children:c.jsx(un,{size:14})})]}),c.jsx("audio",{ref:o,src:t,onTimeUpdate:m,onLoadedMetadata:y,onEnded:()=>l(!1),className:"hidden"}),c.jsxs("div",{className:"flex items-center justify-between gap-3",children:[c.jsxs("button",{onClick:()=>g(-5),className:"flex items-center gap-0.5 px-2 py-1 text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors text-xs",title:" 5 ",children:[c.jsx(BI,{size:14}),c.jsx("span",{className:"font-mono text-[10px]",children:"5s"})]}),c.jsx("button",{onClick:p,className:"w-10 h-10 flex items-center justify-center bg-indigo-600 text-white rounded-full hover:bg-indigo-700 shadow-md transition-all active:scale-95",children:a?c.jsx($I,{size:20,fill:"currentColor"}):c.jsx(zI,{size:20,fill:"currentColor",className:"ml-1"})}),c.jsxs("button",{onClick:()=>g(5),className:"flex items-center gap-0.5 px-2 py-1 text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors text-xs",title:" 5 ",children:[c.jsx("span",{className:"font-mono text-[10px]",children:"5s"}),c.jsx(zz,{size:14})]}),c.jsxs("div",{className:"flex-1 flex items-center gap-2 min-w-0",children:[c.jsx("span",{className:"text-[10px] font-mono tabular-nums text-slate-500 w-8 text-right",children:w(f)}),c.jsxs("div",{className:"relative flex-1 h-8 flex items-center group select-none",children:[c.jsx("div",{className:"absolute inset-0 flex items-center pointer-events-none",children:c.jsx("div",{className:"w-full h-1 bg-slate-200 rounded-full overflow-visible relative",children:c.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-100 rounded-full",style:{width:`${f/(u||1)*100}%`}})})}),c.jsx("input",{type:"range",min:0,max:u||100,value:f,onChange:b,className:"absolute inset-0 w-full opacity-0 cursor-pointer z-10"})]}),c.jsx("span",{className:"text-[10px] font-mono tabular-nums text-slate-500 w-8",children:w(u)})]})]})]})},CD=({checked:t,isCanceled:e=!1,onChange:n,size:r=18,color:s="blue",isRoot:i=!1})=>{const o={gray:{root:"bg-gray-500 border-gray-500 text-white",sub:"bg-gray-100 border-gray-200 text-gray-500",hover:"hover:border-gray-500",border:"border-gray-400"},blue:{root:"bg-blue-500 border-blue-500 text-white",sub:"bg-blue-100 border-blue-200 text-blue-500",hover:"hover:border-blue-500",border:"border-blue-400"},indigo:{root:"bg-indigo-500 border-indigo-500 text-white",sub:"bg-indigo-100 border-indigo-200 text-indigo-500",hover:"hover:border-indigo-500",border:"border-indigo-400"},red:{root:"bg-red-500 border-red-500 text-white",sub:"bg-red-100 border-red-200 text-red-500",hover:"hover:border-red-500",border:"border-red-400"},orange:{root:"bg-orange-500 border-orange-500 text-white",sub:"bg-orange-100 border-orange-200 text-orange-500",hover:"hover:border-orange-500",border:"border-orange-400"},amber:{root:"bg-amber-500 border-amber-500 text-white",sub:"bg-amber-100 border-amber-200 text-amber-500",hover:"hover:border-amber-500",border:"border-amber-400"},green:{root:"bg-emerald-500 border-emerald-500 text-white",sub:"bg-emerald-100 border-emerald-200 text-emerald-500",hover:"hover:border-emerald-500",border:"border-emerald-400"},teal:{root:"bg-teal-500 border-teal-500 text-white",sub:"bg-teal-100 border-teal-200 text-teal-500",hover:"hover:border-teal-500",border:"border-teal-400"},cyan:{root:"bg-cyan-500 border-cyan-500 text-white",sub:"bg-cyan-100 border-cyan-200 text-cyan-500",hover:"hover:border-cyan-500",border:"border-cyan-400"},sky:{root:"bg-sky-500 border-sky-500 text-white",sub:"bg-sky-100 border-sky-200 text-sky-500",hover:"hover:border-sky-500",border:"border-sky-400"},purple:{root:"bg-purple-500 border-purple-500 text-white",sub:"bg-purple-100 border-purple-200 text-purple-500",hover:"hover:border-purple-500",border:"border-purple-400"},fuchsia:{root:"bg-fuchsia-500 border-fuchsia-500 text-white",sub:"bg-fuchsia-100 border-fuchsia-200 text-fuchsia-500",hover:"hover:border-fuchsia-500",border:"border-fuchsia-400"},pink:{root:"bg-pink-500 border-pink-500 text-white",sub:"bg-pink-100 border-pink-200 text-pink-500",hover:"hover:border-pink-500",border:"border-pink-400"},rose:{root:"bg-rose-500 border-rose-500 text-white",sub:"bg-rose-100 border-rose-200 text-rose-500",hover:"hover:border-rose-500",border:"border-rose-400"}},a=o[s]||o.gray,l=i?a.root:a.sub,d=`bg-transparent ${i?"border-2":""} ${a.border} ${a.hover}`;return c.jsx("div",{onClick:n,className:`group relative cursor-pointer flex items-center justify-center transition-all duration-200 ease-out border shadow-sm ${t||e?l:d}`,style:{width:r,height:r,borderRadius:r*.25},children:e?c.jsx(un,{size:r*.7,className:"text-current scale-100 opacity-100",strokeWidth:3}):c.jsx(Xn,{size:r*.7,className:`transition-all duration-300 ease-back-out ${t?"scale-100 opacity-100":"scale-50 opacity-0"}`,strokeWidth:3})})},E_=({label:t,value:e,onChange:n,theme:r,tasks:s,innerRef:i,colorClass:o})=>{const{themeSettings:a,language:l,t:u}=x.useContext(En),[d,f]=x.useState(""),[h,p]=x.useState(!1),[m,y]=x.useState(new Date),[b,g]=x.useState(null),[v,w]=x.useState(null),[T,R]=x.useState({top:0,left:0}),k=x.useRef(null),M=x.useRef(null),S=x.useRef(!1),C=x.useRef(!1),_=x.useRef(null),E=i||_;x.useEffect(()=>{const ae=_e=>{h&&k.current&&!k.current.contains(_e.target)&&M.current&&!M.current.contains(_e.target)&&(p(!1),f(""),w(null))};return document.addEventListener("mousedown",ae),()=>document.removeEventListener("mousedown",ae)},[h]),x.useEffect(()=>{if(e){const ae=new Date(e);isNaN(ae.getTime())||y(ae)}},[e]);const I=ae=>{const _e=ae.target.value;f(_e);const le=$6(_e);le?(y(le),w(le),g(le)):w(null)},P=()=>{var _e;const ae=v||b||m;if(ae){if(e){const le=new Date(e);ae.setHours(le.getHours(),le.getMinutes())}n(ae.toISOString()),p(!1),f(""),C.current=!0,(_e=E.current)==null||_e.focus(),setTimeout(()=>C.current=!1,200)}},O=()=>{if(E.current){const ae=E.current.getBoundingClientRect(),_e=window.innerWidth,le=window.innerHeight,Ce=288,Le=400;let Ve=ae.left,st=ae.bottom+8;st+Le>le&&ae.top-Le>0&&(st=ae.top-Le-8),Ve+Ce>_e&&(Ve=_e-Ce-10),R({top:st,left:Ve})}},$=ae=>{var _e;ae.key==="Enter"?(ae.preventDefault(),ae.metaKey||ae.ctrlKey||ae.stopPropagation(),h?P():(O(),p(!0))):ae.key==="Escape"?(ae.preventDefault(),h&&(ae.stopPropagation(),p(!1),f(""),C.current=!0,(_e=E.current)==null||_e.focus(),setTimeout(()=>C.current=!1,200))):ae.key===" "&&(ae.preventDefault(),ae.stopPropagation(),O(),p(!0))},A=ae=>{},j=ae=>{S.current||C.current||(O(),p(!0))},W=()=>{h||O(),p(!h)},V=ae=>s.filter(_e=>{if(_e.status==="completed"||_e.status==="deleted")return!1;const le=_e.start_date?new Date(_e.start_date):null,Ce=_e.due_date?new Date(_e.due_date):null;return le&&_i(le,ae)||Ce&&_i(Ce,ae)}),D=ae=>{const _e=new Date(m.getFullYear(),m.getMonth(),ae);y(_e),g(_e),w(_e)},ge=()=>{const ae=new Date(m.getFullYear(),m.getMonth()+1,0).getDate(),_e=new Date(m.getFullYear(),m.getMonth(),1).getDay(),le=[];for(let Ce=0;Ce<_e;Ce++)le.push(c.jsx("div",{className:"h-8 w-8"},`empty-${Ce}`));for(let Ce=1;Ce<=ae;Ce++){const Le=new Date(m.getFullYear(),m.getMonth(),Ce),Ve=e&&_i(new Date(e),Le),st=v&&_i(v,Le),ht=V(Le).length;let vt="bg-transparent";ht>=1&&ht<=3?vt="bg-green-400":ht>=4&&ht<=10?vt="bg-yellow-400":ht>10&&(vt="bg-red-500");const te=Cv(Le.toISOString());let Z="h-8 w-8 rounded-full flex items-center justify-center text-xs relative transition-all ";st?Z+="bg-indigo-600/80 text-white font-bold shadow-md":Ve?Z+="bg-indigo-500 text-white font-bold":(Z+="hover:bg-theme-hover text-theme-primary",te&&(Z+=" text-red-500 font-bold")),te?Z+=" border-2 border-red-400":Z+=" border-2 border-transparent",le.push(c.jsxs("button",{type:"button",onMouseDown:ie=>ie.preventDefault(),onClick:()=>D(Ce),onMouseEnter:()=>g(Le),className:Z,children:[Ce,!Ve&&!st&&ht>0&&c.jsx("div",{className:`absolute bottom-1 w-1 h-1 rounded-full ${vt}`})]},Ce))}return le},me=v||b||(e?new Date(e):null),F=me?V(me):[],U=(r==null?void 0:r.buttonRing)||"focus:ring-indigo-300 focus:border-indigo-300",ne=o||(r==null?void 0:r.text)||"text-theme-tertiary",Oe={small:"text-[11px]",normal:"text-xs",large:"text-sm"}[a.fontSize]||"text-xs",at=a.fontWeight==="thin"?"font-light":"font-medium";return c.jsxs("div",{className:"relative",ref:k,onBlur:A,children:[c.jsxs("button",{ref:E,type:"button",onMouseDown:()=>{S.current=!0,setTimeout(()=>S.current=!1,200)},onClick:W,onKeyDown:$,onFocus:j,className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border ${Oe} ${at} ${U}
            ${e?`${ne} border-theme bg-theme-hover hover:border-theme-hover hover:scale-[1.02]`:"text-theme-tertiary border-transparent hover:bg-theme-hover hover:text-theme-secondary"}
            focus:outline-none focus:bg-theme-card focus:ring-1 focus:border-theme
        `,children:[c.jsx(vo,{size:13}),c.jsx("span",{children:e?bI(e,!1,l):t}),e&&c.jsx(un,{size:12,className:"ml-1 hover:text-red-500",onClick:ae=>{ae.stopPropagation(),n(null)}})]}),h&&ir.createPortal(c.jsxs("div",{ref:M,className:"fixed bg-theme-card rounded-xl shadow-2xl border border-theme p-4 z-[99999] w-72 max-w-[90vw] animate-in fade-in zoom-in duration-100",style:{top:T.top,left:T.left},onClick:ae=>ae.stopPropagation(),onMouseDown:ae=>ae.stopPropagation(),children:[c.jsxs("div",{className:"mb-3 relative",children:[c.jsx("input",{autoFocus:!0,type:"text",placeholder:u("dateInputPlaceholder"),className:"w-full text-xs box-border bg-theme-main border border-theme rounded p-2 text-theme-primary focus:ring-2 focus:ring-indigo-500/50 outline-none pr-8",value:d,onChange:I,onKeyDown:$}),v&&c.jsxs("div",{className:"absolute right-2 top-2 text-[10px] text-indigo-500 font-bold bg-theme-hover px-1 rounded animate-pulse",children:[u("identified"),": ",z6(v.toISOString(),l)]})]}),c.jsxs("div",{className:"flex justify-between items-center mb-2 text-theme-primary",children:[c.jsx("button",{type:"button",onMouseDown:ae=>ae.preventDefault(),onClick:()=>y(new Date(m.getFullYear(),m.getMonth()-1,1)),className:"p-1 hover:bg-theme-hover rounded",children:c.jsx(Ou,{size:16})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"font-bold text-sm cursor-pointer hover:text-indigo-500 transition-colors",title:u("backToToday"),onClick:()=>y(new Date),children:m.toLocaleString(l==="zh"?"zh-TW":"en-US",{month:"long",year:"numeric"})}),c.jsx("button",{type:"button",onMouseDown:ae=>ae.preventDefault(),onClick:()=>y(new Date),className:"text-[10px] px-1.5 py-0.5 bg-indigo-50 text-indigo-600 rounded-full hover:bg-indigo-100 font-bold",children:""})]}),c.jsx("button",{type:"button",onMouseDown:ae=>ae.preventDefault(),onClick:()=>y(new Date(m.getFullYear(),m.getMonth()+1,1)),className:"p-1 hover:bg-theme-hover rounded",children:c.jsx(rs,{size:16})})]}),c.jsxs("div",{className:"grid grid-cols-7 gap-1 mb-2 text-center text-xs font-bold text-theme-tertiary",children:[(l==="zh"?["","","","","","",""]:["S","M","T","W","T","F","S"]).map(ae=>c.jsx("span",{children:ae},ae)),ge()]}),c.jsxs("div",{className:"border-t border-theme pt-3 mt-3",children:[c.jsxs("div",{className:"text-[10px] font-bold text-theme-tertiary mb-2 flex justify-between items-center",children:[c.jsx("span",{children:me?`${me.getMonth()+1}/${me.getDate()} ${u("scheduleTitle")}`:u("scheduleTitle")}),c.jsx("span",{className:"bg-theme-hover px-1.5 rounded text-theme-secondary",children:F.length})]}),c.jsx("div",{className:"max-h-24 overflow-y-auto space-y-1 custom-scrollbar",children:F.length>0?F.map(ae=>c.jsx("div",{className:"text-[10px] bg-theme-hover p-1 rounded truncate border-l-2 border-indigo-400 pl-2 text-theme-secondary",children:ae.title},ae.id)):c.jsx("div",{className:"text-[10px] text-theme-tertiary italic text-center py-2",children:u("noSchedule")})})]}),c.jsx("button",{type:"button",onMouseDown:ae=>ae.preventDefault(),onClick:P,className:"w-full mt-3 bg-indigo-600 text-white text-xs font-bold py-1.5 rounded hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-500/20",children:u("confirmDate")})]}),document.body)]})},M1=({icon:t,label:e,items:n,selectedIds:r,onSelect:s,onSearch:i,placeholder:o,allowAdd:a,onDeleteItem:l,innerRef:u,multiSelect:d=!1,theme:f})=>{const{themeSettings:h,t:p}=x.useContext(En),[m,y]=x.useState(!1),[b,g]=x.useState(""),[v,w]=x.useState(-1),[T,R]=x.useState({top:0,left:0}),[k,M]=x.useState(!1),[S,C]=x.useState(null),[_,E]=x.useState(null),[I,P]=x.useState(""),[O,$]=x.useState(-1),A=x.useRef(null),j=x.useRef(null),W=x.useRef(!1),V=x.useRef(!1),D=x.useRef(null),ge=x.useRef(null),me=x.useRef(null),F=u||me;x.useEffect(()=>{const Q=ke=>{m&&A.current&&!A.current.contains(ke.target)&&j.current&&!j.current.contains(ke.target)&&(y(!1),g(""),M(!1),C(null),E(null))};return document.addEventListener("mousedown",Q),()=>document.removeEventListener("mousedown",Q)},[m]);const U=x.useMemo(()=>!n||!Array.isArray(n)?[]:n.filter(Q=>Q?(Q.title||Q.name||"").toLowerCase().includes(b.toLowerCase()):!1),[n,b]),ne=x.useMemo(()=>!n||!Array.isArray(n)?[]:n.filter(Q=>Q?(Q.title||Q.name||"").toLowerCase().includes(I.toLowerCase()):!1),[n,I]),Oe=a&&b.trim()&&!U.some(Q=>(Q.title||Q.name||"").toLowerCase()===b.trim().toLowerCase()),at=U.length+(Oe?1:0),ae=x.useMemo(()=>r.length===0?null:n.find(Q=>r.includes(Q.id)),[n,r]),_e=ae&&(ae.title||ae.name)||e,le=(Q,ke,Me)=>{var fe;s(Q,ke,Me),d?(g(""),w(-1),y(!0),setTimeout(()=>{var Re;return(Re=D.current)==null?void 0:Re.focus()},0)):(g(""),y(!1),W.current=!0,(fe=F.current)==null||fe.focus(),setTimeout(()=>W.current=!1,200)),M(!1),C(null),E(null),P("")},Ce=()=>{C(b.trim()),M(!0),P(""),setTimeout(()=>{var Q;return(Q=ge.current)==null?void 0:Q.focus()},50)},Le=()=>{S&&le(null,S,_)},Ve=()=>{M(!1),C(null),E(null),P(""),setTimeout(()=>{var Q;return(Q=D.current)==null?void 0:Q.focus()},50)},st=()=>{if(F.current){const Q=F.current.getBoundingClientRect(),ke=window.innerWidth,Me=window.innerHeight,fe=280,Re=350;let qe=Q.left,xt=Q.bottom+8;xt+Re>Me&&Q.top-Re>0&&(xt=Q.top-Re-8),qe+fe>ke&&(qe=ke-fe-10),R({top:xt,left:qe})}},Be=Q=>{var ke,Me,fe;if(k){const Re=ne.length+1;if(Q.key==="Escape")Q.preventDefault(),Q.stopPropagation(),Ve();else if(Q.key==="ArrowDown"){Q.preventDefault();const qe=O+1>=Re?-1:O+1;$(qe),E(qe===-1?null:((ke=ne[qe])==null?void 0:ke.id)||null)}else if(Q.key==="ArrowUp"){Q.preventDefault();const qe=O-1<-1?Re-1:O-1;$(qe),E(qe===-1?null:((Me=ne[qe])==null?void 0:Me.id)||null)}else Q.key==="Enter"&&(Q.preventDefault(),Q.stopPropagation(),Le());return}Q.key==="ArrowDown"?(Q.preventDefault(),m||(st(),y(!0)),w(Re=>Re===-1?0:(Re+1)%at)):Q.key==="ArrowUp"?(Q.preventDefault(),m||(st(),y(!0)),w(Re=>Re<=0?at-1:Re-1)):Q.key==="Enter"?(Q.preventDefault(),Q.metaKey||Q.ctrlKey||Q.stopPropagation(),m?v>=0&&v<U.length?le(U[v].id):Oe&&(v===U.length||v===-1)&&Ce():(st(),y(!0))):Q.key==="Escape"&&(Q.preventDefault(),m&&(Q.stopPropagation(),y(!1),W.current=!0,(fe=F.current)==null||fe.focus(),setTimeout(()=>W.current=!1,200)))},ht=Q=>{},vt=Q=>{V.current||W.current||(st(),y(!0))},te=()=>{m||st(),y(!m)},Z=(f==null?void 0:f.buttonRing)||"focus:ring-indigo-300 focus:border-indigo-300",ie={small:"text-[11px]",normal:"text-xs",large:"text-sm"}[h.fontSize]||"text-xs",he=h.fontWeight==="thin"?"font-light":"font-medium",se=Q=>{if(!Q)return null;const ke=n.find(Me=>Me.id===Q);return ke?ke.title||ke.name:null};return c.jsxs("div",{className:"relative",ref:A,onBlur:ht,children:[c.jsxs("button",{ref:F,type:"button",onMouseDown:()=>{V.current=!0,setTimeout(()=>V.current=!1,200)},onClick:te,onKeyDown:Be,onFocus:vt,className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border ${ie} ${he}
                    ${r.length>0?"text-indigo-600 bg-theme-hover border-theme shadow-sm":"text-theme-tertiary border-transparent hover:bg-theme-hover hover:text-theme-secondary"}
                    focus:outline-none focus:bg-theme-card focus:ring-1 focus:border-theme ${Z}`,children:[c.jsx(t,{size:13})," ",c.jsx("span",{className:"truncate max-w-[80px]",children:_e})]}),m&&ir.createPortal(c.jsx("div",{ref:j,className:"fixed bg-theme-card rounded-lg shadow-xl border border-theme z-[99999] w-72 p-2 animate-in fade-in zoom-in duration-100",style:{top:T.top,left:T.left},onClick:Q=>Q.stopPropagation(),onMouseDown:Q=>Q.stopPropagation(),children:k?c.jsxs("div",{className:"animate-in slide-in-from-right-2 duration-150",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-theme",children:[c.jsx("button",{type:"button",onClick:Ve,className:"text-xs text-theme-tertiary hover:text-theme-primary transition-colors",children:" "}),c.jsxs("span",{className:"text-xs font-medium text-theme-primary",children:[' "',S,'"']})]}),c.jsxs("div",{className:"mb-2",children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-theme-tertiary mb-1",children:[c.jsx(bz,{size:11}),c.jsx("span",{children:""})]}),c.jsx("input",{ref:ge,type:"text",placeholder:"...",className:"w-full text-xs box-border bg-theme-main border border-theme rounded p-2 text-theme-primary focus:ring-1 focus:ring-indigo-500/50 outline-none",value:I,onChange:Q=>P(Q.target.value),onKeyDown:Be})]}),c.jsxs("div",{className:"max-h-40 overflow-y-auto space-y-0.5 custom-scrollbar mb-2",children:[c.jsxs("div",{onMouseDown:Q=>{Q.preventDefault(),E(null),$(-1)},onMouseEnter:()=>$(-1),className:`px-2 py-1.5 text-xs rounded cursor-pointer flex items-center justify-between ${O===-1?"bg-indigo-50 text-indigo-700 ring-1 ring-indigo-200":"text-theme-secondary hover:bg-theme-hover"}`,children:[c.jsx("span",{className:"text-theme-tertiary italic",children:""}),_===null&&c.jsx(Xn,{size:12,className:"text-indigo-600"})]}),ne.map((Q,ke)=>c.jsxs("div",{onMouseDown:Me=>{Me.preventDefault(),E(Q.id),$(ke)},onMouseEnter:()=>$(ke),className:`px-2 py-1.5 text-xs rounded cursor-pointer flex items-center justify-between ${O===ke?"bg-indigo-50 text-indigo-700 ring-1 ring-indigo-200":"text-theme-secondary hover:bg-theme-hover"}`,style:{paddingLeft:Q.depth?`${Q.depth*12+8}px`:"8px"},children:[c.jsxs("div",{className:"flex items-center gap-1.5 truncate",children:[c.jsx("span",{className:"truncate",children:Q.title||Q.name}),Q.parentName&&c.jsx("span",{className:"text-[9px] text-theme-tertiary font-normal bg-theme-hover px-1 rounded truncate",children:Q.parentName})]}),_===Q.id&&c.jsx(Xn,{size:12,className:"text-indigo-600"})]},Q.id))]}),_&&c.jsxs("div",{className:"text-[10px] text-theme-tertiary mb-2 px-1",children:[" ",c.jsx("span",{className:"font-medium text-indigo-600",children:se(_)})," "]}),c.jsxs("button",{type:"button",onClick:Le,className:"w-full py-2 px-3 bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-medium rounded-lg transition-colors flex items-center justify-center gap-1.5",children:[c.jsx(ni,{size:14}),""]})]}):c.jsxs(c.Fragment,{children:[c.jsx("input",{ref:D,autoFocus:!0,type:"text",placeholder:o,className:"w-full text-xs box-border bg-theme-main border-none rounded p-2 mb-1 text-theme-primary focus:ring-1 focus:ring-indigo-500/50 outline-none",value:b,onChange:Q=>{g(Q.target.value),w(-1),i&&i(Q.target.value)},onKeyDown:Be}),c.jsxs("div",{className:"max-h-48 overflow-y-auto space-y-0.5 custom-scrollbar",children:[U.map((Q,ke)=>c.jsxs("div",{onMouseDown:Me=>{Me.preventDefault(),le(Q.id)},onMouseEnter:()=>w(ke),className:`px-2 py-1.5 text-xs rounded cursor-pointer flex items-center justify-between group ${ke===v?"bg-theme-selection text-theme-primary":"text-theme-secondary hover:bg-theme-hover"}`,style:{paddingLeft:Q.depth?`${Q.depth*12+8}px`:"8px"},children:[c.jsxs("div",{className:"flex items-center gap-1.5 truncate",children:[c.jsx("span",{className:"truncate",children:Q.title||Q.name}),Q.parentName&&c.jsxs("span",{className:"text-[9px] text-theme-tertiary font-normal bg-theme-hover px-1 rounded truncate",children:[p("from"),": ",Q.parentName]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[r.includes(Q.id)&&c.jsx(Xn,{size:12,className:"text-indigo-600"}),l&&c.jsx(Er,{size:12,className:"text-gray-400 opacity-0 group-hover:opacity-100 hover:text-red-500",onClick:Me=>{Me.stopPropagation(),l(Q.id)}})]})]},Q.id)),Oe&&c.jsxs("div",{onMouseEnter:()=>w(U.length),className:`px-2 py-1.5 text-xs cursor-pointer rounded flex items-center gap-1 ${v===U.length?"bg-theme-selection text-theme-primary":"text-indigo-600 hover:bg-theme-hover"}`,onMouseDown:Q=>{Q.preventDefault(),Ce()},children:[c.jsx(ni,{size:12})," ",p("addNewTag"),' "',b,'"',c.jsx(rs,{size:12,className:"ml-auto opacity-50"})]})]})]})}),document.body)]})},ED=({tag:t,onRemove:e,size:n="normal"})=>{const{themeSettings:r,tagsWithResolvedColors:s}=x.useContext(En),i={small:{text:{small:"text-[8px]",normal:"text-[9px]",large:"text-[10px]"},padding:"px-1.5 py-0.5"},normal:{text:{small:"text-[9px]",normal:"text-[10px]",large:"text-xs"},padding:"px-2 py-0.5"}},o=i[n].text[r.fontSize]||i[n].text.normal,a=i[n].padding,l=r.fontWeight==="thin"?"font-light":"font-normal";return c.jsxs("div",{className:`inline-flex items-center gap-1 bg-theme-hover text-theme-secondary ${a} rounded-md border border-theme ${o} ${l}`,children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:s[t.id]||t.color}}),c.jsx("span",{children:t.name}),e&&c.jsx("button",{type:"button",onClick:e,className:"hover:text-theme-primary",children:c.jsx(un,{size:10})})]})};function O9(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in t)){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(t)}function ND(t,e){return new Promise(function(n,r){let s;return P9(t).then(function(i){try{return s=i,n(new Blob([e.slice(0,2),s,e.slice(2)],{type:"image/jpeg"}))}catch(o){return r(o)}},r)})}const P9=t=>new Promise((e,n)=>{const r=new FileReader;r.addEventListener("load",({target:{result:s}})=>{const i=new DataView(s);let o=0;if(i.getUint16(o)!==65496)return n("not a valid JPEG");for(o+=2;;){const a=i.getUint16(o);if(a===65498)break;const l=i.getUint16(o+2);if(a===65505&&i.getUint32(o+4)===1165519206){const u=o+10;let d;switch(i.getUint16(u)){case 18761:d=!0;break;case 19789:d=!1;break;default:return n("TIFF header contains invalid endian")}if(i.getUint16(u+2,d)!==42)return n("TIFF header contains invalid version");const f=i.getUint32(u+4,d),h=u+f+2+12*i.getUint16(u+f,d);for(let p=u+f+2;p<h;p+=12)if(i.getUint16(p,d)==274){if(i.getUint16(p+2,d)!==3)return n("Orientation data type is invalid");if(i.getUint32(p+4,d)!==1)return n("Orientation data count is invalid");i.setUint16(p+8,1,d);break}return e(s.slice(o,o+2+l))}o+=2+l}return e(new Blob)}),r.readAsArrayBuffer(t)});var pm={},L9={get exports(){return pm},set exports(t){pm=t}};(function(t){var e,n,r={};L9.exports=r,r.parse=function(s,i){for(var o=r.bin.readUshort,a=r.bin.readUint,l=0,u={},d=new Uint8Array(s),f=d.length-4;a(d,f)!=101010256;)f--;l=f,l+=4;var h=o(d,l+=4);o(d,l+=2);var p=a(d,l+=2),m=a(d,l+=4);l+=4,l=m;for(var y=0;y<h;y++){a(d,l),l+=4,l+=4,l+=4,a(d,l+=4),p=a(d,l+=4);var b=a(d,l+=4),g=o(d,l+=4),v=o(d,l+2),w=o(d,l+4);l+=6;var T=a(d,l+=8);l+=4,l+=g+v+w,r._readLocal(d,T,u,p,b,i)}return u},r._readLocal=function(s,i,o,a,l,u){var d=r.bin.readUshort,f=r.bin.readUint;f(s,i),d(s,i+=4),d(s,i+=2);var h=d(s,i+=2);f(s,i+=2),f(s,i+=4),i+=4;var p=d(s,i+=8),m=d(s,i+=2);i+=2;var y=r.bin.readUTF8(s,i,p);if(i+=p,i+=m,u)o[y]={size:l,csize:a};else{var b=new Uint8Array(s.buffer,i);if(h==0)o[y]=new Uint8Array(b.buffer.slice(i,i+a));else{if(h!=8)throw"unknown compression method: "+h;var g=new Uint8Array(l);r.inflateRaw(b,g),o[y]=g}}},r.inflateRaw=function(s,i){return r.F.inflate(s,i)},r.inflate=function(s,i){return s[0],s[1],r.inflateRaw(new Uint8Array(s.buffer,s.byteOffset+2,s.length-6),i)},r.deflate=function(s,i){i==null&&(i={level:6});var o=0,a=new Uint8Array(50+Math.floor(1.1*s.length));a[o]=120,a[o+1]=156,o+=2,o=r.F.deflateRaw(s,a,o,i.level);var l=r.adler(s,0,s.length);return a[o+0]=l>>>24&255,a[o+1]=l>>>16&255,a[o+2]=l>>>8&255,a[o+3]=l>>>0&255,new Uint8Array(a.buffer,0,o+4)},r.deflateRaw=function(s,i){i==null&&(i={level:6});var o=new Uint8Array(50+Math.floor(1.1*s.length)),a=r.F.deflateRaw(s,o,a,i.level);return new Uint8Array(o.buffer,0,a)},r.encode=function(s,i){i==null&&(i=!1);var o=0,a=r.bin.writeUint,l=r.bin.writeUshort,u={};for(var d in s){var f=!r._noNeed(d)&&!i,h=s[d],p=r.crc.crc(h,0,h.length);u[d]={cpr:f,usize:h.length,crc:p,file:f?r.deflateRaw(h):h}}for(var d in u)o+=u[d].file.length+30+46+2*r.bin.sizeUTF8(d);o+=22;var m=new Uint8Array(o),y=0,b=[];for(var d in u){var g=u[d];b.push(y),y=r._writeHeader(m,y,d,g,0)}var v=0,w=y;for(var d in u)g=u[d],b.push(y),y=r._writeHeader(m,y,d,g,1,b[v++]);var T=y-w;return a(m,y,101010256),y+=4,l(m,y+=4,v),l(m,y+=2,v),a(m,y+=2,T),a(m,y+=4,w),y+=4,y+=2,m.buffer},r._noNeed=function(s){var i=s.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(i)!=-1},r._writeHeader=function(s,i,o,a,l,u){var d=r.bin.writeUint,f=r.bin.writeUshort,h=a.file;return d(s,i,l==0?67324752:33639248),i+=4,l==1&&(i+=2),f(s,i,20),f(s,i+=2,0),f(s,i+=2,a.cpr?8:0),d(s,i+=2,0),d(s,i+=4,a.crc),d(s,i+=4,h.length),d(s,i+=4,a.usize),f(s,i+=4,r.bin.sizeUTF8(o)),f(s,i+=2,0),i+=2,l==1&&(i+=2,i+=2,d(s,i+=6,u),i+=4),i+=r.bin.writeUTF8(s,i,o),l==0&&(s.set(h,i),i+=h.length),i},r.crc={table:function(){for(var s=new Uint32Array(256),i=0;i<256;i++){for(var o=i,a=0;a<8;a++)1&o?o=3988292384^o>>>1:o>>>=1;s[i]=o}return s}(),update:function(s,i,o,a){for(var l=0;l<a;l++)s=r.crc.table[255&(s^i[o+l])]^s>>>8;return s},crc:function(s,i,o){return 4294967295^r.crc.update(4294967295,s,i,o)}},r.adler=function(s,i,o){for(var a=1,l=0,u=i,d=i+o;u<d;){for(var f=Math.min(u+5552,d);u<f;)l+=a+=s[u++];a%=65521,l%=65521}return l<<16|a},r.bin={readUshort:function(s,i){return s[i]|s[i+1]<<8},writeUshort:function(s,i,o){s[i]=255&o,s[i+1]=o>>8&255},readUint:function(s,i){return 16777216*s[i+3]+(s[i+2]<<16|s[i+1]<<8|s[i])},writeUint:function(s,i,o){s[i]=255&o,s[i+1]=o>>8&255,s[i+2]=o>>16&255,s[i+3]=o>>24&255},readASCII:function(s,i,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(s[i+l]);return a},writeASCII:function(s,i,o){for(var a=0;a<o.length;a++)s[i+a]=o.charCodeAt(a)},pad:function(s){return s.length<2?"0"+s:s},readUTF8:function(s,i,o){for(var a,l="",u=0;u<o;u++)l+="%"+r.bin.pad(s[i+u].toString(16));try{a=decodeURIComponent(l)}catch{return r.bin.readASCII(s,i,o)}return a},writeUTF8:function(s,i,o){for(var a=o.length,l=0,u=0;u<a;u++){var d=o.charCodeAt(u);if(!(4294967168&d))s[i+l]=d,l++;else if(!(4294965248&d))s[i+l]=192|d>>6,s[i+l+1]=128|d>>0&63,l+=2;else if(!(4294901760&d))s[i+l]=224|d>>12,s[i+l+1]=128|d>>6&63,s[i+l+2]=128|d>>0&63,l+=3;else{if(4292870144&d)throw"e";s[i+l]=240|d>>18,s[i+l+1]=128|d>>12&63,s[i+l+2]=128|d>>6&63,s[i+l+3]=128|d>>0&63,l+=4}}return l},sizeUTF8:function(s){for(var i=s.length,o=0,a=0;a<i;a++){var l=s.charCodeAt(a);if(!(4294967168&l))o++;else if(!(4294965248&l))o+=2;else if(!(4294901760&l))o+=3;else{if(4292870144&l)throw"e";o+=4}}return o}},r.F={},r.F.deflateRaw=function(s,i,o,a){var l=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],u=r.F.U,d=r.F._goodIndex;r.F._hash;var f=r.F._putsE,h=0,p=o<<3,m=0,y=s.length;if(a==0){for(;h<y;)f(i,p,h+(E=Math.min(65535,y-h))==y?1:0),p=r.F._copyExact(s,h,E,i,p+8),h+=E;return p>>>3}var b=u.lits,g=u.strt,v=u.prev,w=0,T=0,R=0,k=0,M=0,S=0;for(y>2&&(g[S=r.F._hash(s,0)]=0),h=0;h<y;h++){if(M=S,h+1<y-2){S=r.F._hash(s,h+1);var C=h+1&32767;v[C]=g[S],g[S]=C}if(m<=h){(w>14e3||T>26697)&&y-h>100&&(m<h&&(b[w]=h-m,w+=2,m=h),p=r.F._writeBlock(h==y-1||m==y?1:0,b,w,k,s,R,h-R,i,p),w=T=k=0,R=h);var _=0;h<y-2&&(_=r.F._bestMatch(s,h,v,M,Math.min(l[2],y-h),l[3]));var E=_>>>16,I=65535&_;if(_!=0){I=65535&_;var P=d(E=_>>>16,u.of0);u.lhst[257+P]++;var O=d(I,u.df0);u.dhst[O]++,k+=u.exb[P]+u.dxb[O],b[w]=E<<23|h-m,b[w+1]=I<<16|P<<8|O,w+=2,m=h+E}else u.lhst[s[h]]++;T++}}for(R==h&&s.length!=0||(m<h&&(b[w]=h-m,w+=2,m=h),p=r.F._writeBlock(1,b,w,k,s,R,h-R,i,p),w=0,T=0,w=T=k=0,R=h);7&p;)p++;return p>>>3},r.F._bestMatch=function(s,i,o,a,l,u){var d=32767&i,f=o[d],h=d-f+32768&32767;if(f==d||a!=r.F._hash(s,i-h))return 0;for(var p=0,m=0,y=Math.min(32767,i);h<=y&&--u!=0&&f!=d;){if(p==0||s[i+p]==s[i+p-h]){var b=r.F._howLong(s,i,h);if(b>p){if(m=h,(p=b)>=l)break;h+2<b&&(b=h+2);for(var g=0,v=0;v<b-2;v++){var w=i-h+v+32768&32767,T=w-o[w]+32768&32767;T>g&&(g=T,f=w)}}}h+=(d=f)-(f=o[d])+32768&32767}return p<<16|m},r.F._howLong=function(s,i,o){if(s[i]!=s[i-o]||s[i+1]!=s[i+1-o]||s[i+2]!=s[i+2-o])return 0;var a=i,l=Math.min(s.length,i+258);for(i+=3;i<l&&s[i]==s[i-o];)i++;return i-a},r.F._hash=function(s,i){return(s[i]<<8|s[i+1])+(s[i+2]<<4)&65535},r.saved=0,r.F._writeBlock=function(s,i,o,a,l,u,d,f,h){var p,m,y,b,g,v,w,T,R,k=r.F.U,M=r.F._putsF,S=r.F._putsE;k.lhst[256]++,m=(p=r.F.getTrees())[0],y=p[1],b=p[2],g=p[3],v=p[4],w=p[5],T=p[6],R=p[7];var C=32+(h+3&7?8-(h+3&7):0)+(d<<3),_=a+r.F.contSize(k.fltree,k.lhst)+r.F.contSize(k.fdtree,k.dhst),E=a+r.F.contSize(k.ltree,k.lhst)+r.F.contSize(k.dtree,k.dhst);E+=14+3*w+r.F.contSize(k.itree,k.ihst)+(2*k.ihst[16]+3*k.ihst[17]+7*k.ihst[18]);for(var I=0;I<286;I++)k.lhst[I]=0;for(I=0;I<30;I++)k.dhst[I]=0;for(I=0;I<19;I++)k.ihst[I]=0;var P=C<_&&C<E?0:_<E?1:2;if(M(f,h,s),M(f,h+1,P),h+=3,P==0){for(;7&h;)h++;h=r.F._copyExact(l,u,d,f,h)}else{var O,$;if(P==1&&(O=k.fltree,$=k.fdtree),P==2){r.F.makeCodes(k.ltree,m),r.F.revCodes(k.ltree,m),r.F.makeCodes(k.dtree,y),r.F.revCodes(k.dtree,y),r.F.makeCodes(k.itree,b),r.F.revCodes(k.itree,b),O=k.ltree,$=k.dtree,S(f,h,g-257),S(f,h+=5,v-1),S(f,h+=5,w-4),h+=4;for(var A=0;A<w;A++)S(f,h+3*A,k.itree[1+(k.ordr[A]<<1)]);h+=3*w,h=r.F._codeTiny(T,k.itree,f,h),h=r.F._codeTiny(R,k.itree,f,h)}for(var j=u,W=0;W<o;W+=2){for(var V=i[W],D=V>>>23,ge=j+(8388607&V);j<ge;)h=r.F._writeLit(l[j++],O,f,h);if(D!=0){var me=i[W+1],F=me>>16,U=me>>8&255,ne=255&me;S(f,h=r.F._writeLit(257+U,O,f,h),D-k.of0[U]),h+=k.exb[U],M(f,h=r.F._writeLit(ne,$,f,h),F-k.df0[ne]),h+=k.dxb[ne],j+=D}}h=r.F._writeLit(256,O,f,h)}return h},r.F._copyExact=function(s,i,o,a,l){var u=l>>>3;return a[u]=o,a[u+1]=o>>>8,a[u+2]=255-a[u],a[u+3]=255-a[u+1],u+=4,a.set(new Uint8Array(s.buffer,i,o),u),l+(o+4<<3)},r.F.getTrees=function(){for(var s=r.F.U,i=r.F._hufTree(s.lhst,s.ltree,15),o=r.F._hufTree(s.dhst,s.dtree,15),a=[],l=r.F._lenCodes(s.ltree,a),u=[],d=r.F._lenCodes(s.dtree,u),f=0;f<a.length;f+=2)s.ihst[a[f]]++;for(f=0;f<u.length;f+=2)s.ihst[u[f]]++;for(var h=r.F._hufTree(s.ihst,s.itree,7),p=19;p>4&&s.itree[1+(s.ordr[p-1]<<1)]==0;)p--;return[i,o,h,l,d,p,a,u]},r.F.getSecond=function(s){for(var i=[],o=0;o<s.length;o+=2)i.push(s[o+1]);return i},r.F.nonZero=function(s){for(var i="",o=0;o<s.length;o+=2)s[o+1]!=0&&(i+=(o>>1)+",");return i},r.F.contSize=function(s,i){for(var o=0,a=0;a<i.length;a++)o+=i[a]*s[1+(a<<1)];return o},r.F._codeTiny=function(s,i,o,a){for(var l=0;l<s.length;l+=2){var u=s[l],d=s[l+1];a=r.F._writeLit(u,i,o,a);var f=u==16?2:u==17?3:7;u>15&&(r.F._putsE(o,a,d,f),a+=f)}return a},r.F._lenCodes=function(s,i){for(var o=s.length;o!=2&&s[o-1]==0;)o-=2;for(var a=0;a<o;a+=2){var l=s[a+1],u=a+3<o?s[a+3]:-1,d=a+5<o?s[a+5]:-1,f=a==0?-1:s[a-1];if(l==0&&u==l&&d==l){for(var h=a+5;h+2<o&&s[h+2]==l;)h+=2;(p=Math.min(h+1-a>>>1,138))<11?i.push(17,p-3):i.push(18,p-11),a+=2*p-2}else if(l==f&&u==l&&d==l){for(h=a+5;h+2<o&&s[h+2]==l;)h+=2;var p=Math.min(h+1-a>>>1,6);i.push(16,p-3),a+=2*p-2}else i.push(l,0)}return o>>>1},r.F._hufTree=function(s,i,o){var a=[],l=s.length,u=i.length,d=0;for(d=0;d<u;d+=2)i[d]=0,i[d+1]=0;for(d=0;d<l;d++)s[d]!=0&&a.push({lit:d,f:s[d]});var f=a.length,h=a.slice(0);if(f==0)return 0;if(f==1){var p=a[0].lit;return h=p==0?1:0,i[1+(p<<1)]=1,i[1+(h<<1)]=1,1}a.sort(function(T,R){return T.f-R.f});var m=a[0],y=a[1],b=0,g=1,v=2;for(a[0]={lit:-1,f:m.f+y.f,l:m,r:y,d:0};g!=f-1;)m=b!=g&&(v==f||a[b].f<a[v].f)?a[b++]:a[v++],y=b!=g&&(v==f||a[b].f<a[v].f)?a[b++]:a[v++],a[g++]={lit:-1,f:m.f+y.f,l:m,r:y};var w=r.F.setDepth(a[g-1],0);for(w>o&&(r.F.restrictDepth(h,o,w),w=o),d=0;d<f;d++)i[1+(h[d].lit<<1)]=h[d].d;return w},r.F.setDepth=function(s,i){return s.lit!=-1?(s.d=i,i):Math.max(r.F.setDepth(s.l,i+1),r.F.setDepth(s.r,i+1))},r.F.restrictDepth=function(s,i,o){var a=0,l=1<<o-i,u=0;for(s.sort(function(f,h){return h.d==f.d?f.f-h.f:h.d-f.d}),a=0;a<s.length&&s[a].d>i;a++){var d=s[a].d;s[a].d=i,u+=l-(1<<o-d)}for(u>>>=o-i;u>0;)(d=s[a].d)<i?(s[a].d++,u-=1<<i-d-1):a++;for(;a>=0;a--)s[a].d==i&&u<0&&(s[a].d--,u++);u!=0&&console.log("debt left")},r.F._goodIndex=function(s,i){var o=0;return i[16|o]<=s&&(o|=16),i[8|o]<=s&&(o|=8),i[4|o]<=s&&(o|=4),i[2|o]<=s&&(o|=2),i[1|o]<=s&&(o|=1),o},r.F._writeLit=function(s,i,o,a){return r.F._putsF(o,a,i[s<<1]),a+i[1+(s<<1)]},r.F.inflate=function(s,i){var o=Uint8Array;if(s[0]==3&&s[1]==0)return i||new o(0);var a=r.F,l=a._bitsF,u=a._bitsE,d=a._decodeTiny,f=a.makeCodes,h=a.codes2map,p=a._get17,m=a.U,y=i==null;y&&(i=new o(s.length>>>2<<3));for(var b,g,v=0,w=0,T=0,R=0,k=0,M=0,S=0,C=0,_=0;v==0;)if(v=l(s,_,1),w=l(s,_+1,2),_+=3,w!=0){if(y&&(i=r.F._check(i,C+(1<<17))),w==1&&(b=m.flmap,g=m.fdmap,M=511,S=31),w==2){T=u(s,_,5)+257,R=u(s,_+5,5)+1,k=u(s,_+10,4)+4,_+=14;for(var E=0;E<38;E+=2)m.itree[E]=0,m.itree[E+1]=0;var I=1;for(E=0;E<k;E++){var P=u(s,_+3*E,3);m.itree[1+(m.ordr[E]<<1)]=P,P>I&&(I=P)}_+=3*k,f(m.itree,I),h(m.itree,I,m.imap),b=m.lmap,g=m.dmap,_=d(m.imap,(1<<I)-1,T+R,s,_,m.ttree);var O=a._copyOut(m.ttree,0,T,m.ltree);M=(1<<O)-1;var $=a._copyOut(m.ttree,T,R,m.dtree);S=(1<<$)-1,f(m.ltree,O),h(m.ltree,O,b),f(m.dtree,$),h(m.dtree,$,g)}for(;;){var A=b[p(s,_)&M];_+=15&A;var j=A>>>4;if(!(j>>>8))i[C++]=j;else{if(j==256)break;var W=C+j-254;if(j>264){var V=m.ldef[j-257];W=C+(V>>>3)+u(s,_,7&V),_+=7&V}var D=g[p(s,_)&S];_+=15&D;var ge=D>>>4,me=m.ddef[ge],F=(me>>>4)+l(s,_,15&me);for(_+=15&me,y&&(i=r.F._check(i,C+(1<<17)));C<W;)i[C]=i[C++-F],i[C]=i[C++-F],i[C]=i[C++-F],i[C]=i[C++-F];C=W}}}else{7&_&&(_+=8-(7&_));var U=4+(_>>>3),ne=s[U-4]|s[U-3]<<8;y&&(i=r.F._check(i,C+ne)),i.set(new o(s.buffer,s.byteOffset+U,ne),C),_=U+ne<<3,C+=ne}return i.length==C?i:i.slice(0,C)},r.F._check=function(s,i){var o=s.length;if(i<=o)return s;var a=new Uint8Array(Math.max(o<<1,i));return a.set(s,0),a},r.F._decodeTiny=function(s,i,o,a,l,u){for(var d=r.F._bitsE,f=r.F._get17,h=0;h<o;){var p=s[f(a,l)&i];l+=15&p;var m=p>>>4;if(m<=15)u[h]=m,h++;else{var y=0,b=0;m==16?(b=3+d(a,l,2),l+=2,y=u[h-1]):m==17?(b=3+d(a,l,3),l+=3):m==18&&(b=11+d(a,l,7),l+=7);for(var g=h+b;h<g;)u[h]=y,h++}}return l},r.F._copyOut=function(s,i,o,a){for(var l=0,u=0,d=a.length>>>1;u<o;){var f=s[u+i];a[u<<1]=0,a[1+(u<<1)]=f,f>l&&(l=f),u++}for(;u<d;)a[u<<1]=0,a[1+(u<<1)]=0,u++;return l},r.F.makeCodes=function(s,i){for(var o,a,l,u,d=r.F.U,f=s.length,h=d.bl_count,p=0;p<=i;p++)h[p]=0;for(p=1;p<f;p+=2)h[s[p]]++;var m=d.next_code;for(o=0,h[0]=0,a=1;a<=i;a++)o=o+h[a-1]<<1,m[a]=o;for(l=0;l<f;l+=2)(u=s[l+1])!=0&&(s[l]=m[u],m[u]++)},r.F.codes2map=function(s,i,o){for(var a=s.length,l=r.F.U.rev15,u=0;u<a;u+=2)if(s[u+1]!=0)for(var d=u>>1,f=s[u+1],h=d<<4|f,p=i-f,m=s[u]<<p,y=m+(1<<p);m!=y;)o[l[m]>>>15-i]=h,m++},r.F.revCodes=function(s,i){for(var o=r.F.U.rev15,a=15-i,l=0;l<s.length;l+=2){var u=s[l]<<i-s[l+1];s[l]=o[u]>>>a}},r.F._putsE=function(s,i,o){o<<=7&i;var a=i>>>3;s[a]|=o,s[a+1]|=o>>>8},r.F._putsF=function(s,i,o){o<<=7&i;var a=i>>>3;s[a]|=o,s[a+1]|=o>>>8,s[a+2]|=o>>>16},r.F._bitsE=function(s,i,o){return(s[i>>>3]|s[1+(i>>>3)]<<8)>>>(7&i)&(1<<o)-1},r.F._bitsF=function(s,i,o){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16)>>>(7&i)&(1<<o)-1},r.F._get17=function(s,i){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16)>>>(7&i)},r.F._get25=function(s,i){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16|s[3+(i>>>3)]<<24)>>>(7&i)},r.F.U=(e=Uint16Array,n=Uint32Array,{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new n(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new n(286),dhst:new n(30),ihst:new n(19),lits:new n(15e3),strt:new e(65536),prev:new e(32768)}),function(){for(var s=r.F.U,i=0;i<32768;i++){var o=i;o=(4278255360&(o=(4042322160&(o=(3435973836&(o=(2863311530&o)>>>1|(1431655765&o)<<1))>>>2|(858993459&o)<<2))>>>4|(252645135&o)<<4))>>>8|(16711935&o)<<8,s.rev15[i]=(o>>>16|o<<16)>>>17}function a(l,u,d){for(;u--!=0;)l.push(0,d)}for(i=0;i<32;i++)s.ldef[i]=s.of0[i]<<3|s.exb[i],s.ddef[i]=s.df0[i]<<4|s.dxb[i];a(s.fltree,144,8),a(s.fltree,112,9),a(s.fltree,24,7),a(s.fltree,8,8),r.F.makeCodes(s.fltree,9),r.F.codes2map(s.fltree,9,s.flmap),r.F.revCodes(s.fltree,9),a(s.fdtree,32,5),r.F.makeCodes(s.fdtree,5),r.F.codes2map(s.fdtree,5,s.fdmap),r.F.revCodes(s.fdtree,5),a(s.itree,19,0),a(s.ltree,286,0),a(s.dtree,30,0),a(s.ttree,320,0)}()})();var $9=O9({__proto__:null,default:pm},[pm]);const Vi=function(){var t={nextZero(d,f){for(;d[f]!=0;)f++;return f},readUshort:(d,f)=>d[f]<<8|d[f+1],writeUshort(d,f,h){d[f]=h>>8&255,d[f+1]=255&h},readUint:(d,f)=>16777216*d[f]+(d[f+1]<<16|d[f+2]<<8|d[f+3]),writeUint(d,f,h){d[f]=h>>24&255,d[f+1]=h>>16&255,d[f+2]=h>>8&255,d[f+3]=255&h},readASCII(d,f,h){let p="";for(let m=0;m<h;m++)p+=String.fromCharCode(d[f+m]);return p},writeASCII(d,f,h){for(let p=0;p<h.length;p++)d[f+p]=h.charCodeAt(p)},readBytes(d,f,h){const p=[];for(let m=0;m<h;m++)p.push(d[f+m]);return p},pad:d=>d.length<2?`0${d}`:d,readUTF8(d,f,h){let p,m="";for(let y=0;y<h;y++)m+=`%${t.pad(d[f+y].toString(16))}`;try{p=decodeURIComponent(m)}catch{return t.readASCII(d,f,h)}return p}};function e(d,f,h,p){const m=f*h,y=i(p),b=Math.ceil(f*y/8),g=new Uint8Array(4*m),v=new Uint32Array(g.buffer),{ctype:w}=p,{depth:T}=p,R=t.readUshort;if(w==6){const V=m<<2;if(T==8)for(var k=0;k<V;k+=4)g[k]=d[k],g[k+1]=d[k+1],g[k+2]=d[k+2],g[k+3]=d[k+3];if(T==16)for(k=0;k<V;k++)g[k]=d[k<<1]}else if(w==2){const V=p.tabs.tRNS;if(V==null){if(T==8)for(k=0;k<m;k++){var M=3*k;v[k]=255<<24|d[M+2]<<16|d[M+1]<<8|d[M]}if(T==16)for(k=0;k<m;k++)M=6*k,v[k]=255<<24|d[M+4]<<16|d[M+2]<<8|d[M]}else{var S=V[0];const D=V[1],ge=V[2];if(T==8)for(k=0;k<m;k++){var C=k<<2;M=3*k,v[k]=255<<24|d[M+2]<<16|d[M+1]<<8|d[M],d[M]==S&&d[M+1]==D&&d[M+2]==ge&&(g[C+3]=0)}if(T==16)for(k=0;k<m;k++)C=k<<2,M=6*k,v[k]=255<<24|d[M+4]<<16|d[M+2]<<8|d[M],R(d,M)==S&&R(d,M+2)==D&&R(d,M+4)==ge&&(g[C+3]=0)}}else if(w==3){const V=p.tabs.PLTE,D=p.tabs.tRNS,ge=D?D.length:0;if(T==1)for(var _=0;_<h;_++){var E=_*b,I=_*f;for(k=0;k<f;k++){C=I+k<<2;var P=3*(O=d[E+(k>>3)]>>7-((7&k)<<0)&1);g[C]=V[P],g[C+1]=V[P+1],g[C+2]=V[P+2],g[C+3]=O<ge?D[O]:255}}if(T==2)for(_=0;_<h;_++)for(E=_*b,I=_*f,k=0;k<f;k++)C=I+k<<2,P=3*(O=d[E+(k>>2)]>>6-((3&k)<<1)&3),g[C]=V[P],g[C+1]=V[P+1],g[C+2]=V[P+2],g[C+3]=O<ge?D[O]:255;if(T==4)for(_=0;_<h;_++)for(E=_*b,I=_*f,k=0;k<f;k++)C=I+k<<2,P=3*(O=d[E+(k>>1)]>>4-((1&k)<<2)&15),g[C]=V[P],g[C+1]=V[P+1],g[C+2]=V[P+2],g[C+3]=O<ge?D[O]:255;if(T==8)for(k=0;k<m;k++){var O;C=k<<2,P=3*(O=d[k]),g[C]=V[P],g[C+1]=V[P+1],g[C+2]=V[P+2],g[C+3]=O<ge?D[O]:255}}else if(w==4){if(T==8)for(k=0;k<m;k++){C=k<<2;var $=d[A=k<<1];g[C]=$,g[C+1]=$,g[C+2]=$,g[C+3]=d[A+1]}if(T==16)for(k=0;k<m;k++){var A;C=k<<2,$=d[A=k<<2],g[C]=$,g[C+1]=$,g[C+2]=$,g[C+3]=d[A+2]}}else if(w==0)for(S=p.tabs.tRNS?p.tabs.tRNS:-1,_=0;_<h;_++){const V=_*b,D=_*f;if(T==1)for(var j=0;j<f;j++){var W=($=255*(d[V+(j>>>3)]>>>7-(7&j)&1))==255*S?0:255;v[D+j]=W<<24|$<<16|$<<8|$}else if(T==2)for(j=0;j<f;j++)W=($=85*(d[V+(j>>>2)]>>>6-((3&j)<<1)&3))==85*S?0:255,v[D+j]=W<<24|$<<16|$<<8|$;else if(T==4)for(j=0;j<f;j++)W=($=17*(d[V+(j>>>1)]>>>4-((1&j)<<2)&15))==17*S?0:255,v[D+j]=W<<24|$<<16|$<<8|$;else if(T==8)for(j=0;j<f;j++)W=($=d[V+j])==S?0:255,v[D+j]=W<<24|$<<16|$<<8|$;else if(T==16)for(j=0;j<f;j++)$=d[V+(j<<1)],W=R(d,V+(j<<1))==S?0:255,v[D+j]=W<<24|$<<16|$<<8|$}return g}function n(d,f,h,p){const m=i(d),y=Math.ceil(h*m/8),b=new Uint8Array((y+1+d.interlace)*p);return f=d.tabs.CgBI?s(f,b):r(f,b),d.interlace==0?f=o(f,d,0,h,p):d.interlace==1&&(f=function(v,w){const T=w.width,R=w.height,k=i(w),M=k>>3,S=Math.ceil(T*k/8),C=new Uint8Array(R*S);let _=0;const E=[0,0,4,0,2,0,1],I=[0,4,0,2,0,1,0],P=[8,8,8,4,4,2,2],O=[8,8,4,4,2,2,1];let $=0;for(;$<7;){const j=P[$],W=O[$];let V=0,D=0,ge=E[$];for(;ge<R;)ge+=j,D++;let me=I[$];for(;me<T;)me+=W,V++;const F=Math.ceil(V*k/8);o(v,w,_,V,D);let U=0,ne=E[$];for(;ne<R;){let Oe=I[$],at=_+U*F<<3;for(;Oe<T;){var A;if(k==1&&(A=(A=v[at>>3])>>7-(7&at)&1,C[ne*S+(Oe>>3)]|=A<<7-((7&Oe)<<0)),k==2&&(A=(A=v[at>>3])>>6-(7&at)&3,C[ne*S+(Oe>>2)]|=A<<6-((3&Oe)<<1)),k==4&&(A=(A=v[at>>3])>>4-(7&at)&15,C[ne*S+(Oe>>1)]|=A<<4-((1&Oe)<<2)),k>=8){const ae=ne*S+Oe*M;for(let _e=0;_e<M;_e++)C[ae+_e]=v[(at>>3)+_e]}at+=k,Oe+=W}U++,ne+=j}V*D!=0&&(_+=D*(1+F)),$+=1}return C}(f,d)),f}function r(d,f){return s(new Uint8Array(d.buffer,2,d.length-6),f)}var s=function(){const d={H:{}};return d.H.N=function(f,h){const p=Uint8Array;let m,y,b=0,g=0,v=0,w=0,T=0,R=0,k=0,M=0,S=0;if(f[0]==3&&f[1]==0)return h||new p(0);const C=d.H,_=C.b,E=C.e,I=C.R,P=C.n,O=C.A,$=C.Z,A=C.m,j=h==null;for(j&&(h=new p(f.length>>>2<<5));b==0;)if(b=_(f,S,1),g=_(f,S+1,2),S+=3,g!=0){if(j&&(h=d.H.W(h,M+(1<<17))),g==1&&(m=A.J,y=A.h,R=511,k=31),g==2){v=E(f,S,5)+257,w=E(f,S+5,5)+1,T=E(f,S+10,4)+4,S+=14;let V=1;for(var W=0;W<38;W+=2)A.Q[W]=0,A.Q[W+1]=0;for(W=0;W<T;W++){const me=E(f,S+3*W,3);A.Q[1+(A.X[W]<<1)]=me,me>V&&(V=me)}S+=3*T,P(A.Q,V),O(A.Q,V,A.u),m=A.w,y=A.d,S=I(A.u,(1<<V)-1,v+w,f,S,A.v);const D=C.V(A.v,0,v,A.C);R=(1<<D)-1;const ge=C.V(A.v,v,w,A.D);k=(1<<ge)-1,P(A.C,D),O(A.C,D,m),P(A.D,ge),O(A.D,ge,y)}for(;;){const V=m[$(f,S)&R];S+=15&V;const D=V>>>4;if(!(D>>>8))h[M++]=D;else{if(D==256)break;{let ge=M+D-254;if(D>264){const Oe=A.q[D-257];ge=M+(Oe>>>3)+E(f,S,7&Oe),S+=7&Oe}const me=y[$(f,S)&k];S+=15&me;const F=me>>>4,U=A.c[F],ne=(U>>>4)+_(f,S,15&U);for(S+=15&U;M<ge;)h[M]=h[M++-ne],h[M]=h[M++-ne],h[M]=h[M++-ne],h[M]=h[M++-ne];M=ge}}}}else{7&S&&(S+=8-(7&S));const V=4+(S>>>3),D=f[V-4]|f[V-3]<<8;j&&(h=d.H.W(h,M+D)),h.set(new p(f.buffer,f.byteOffset+V,D),M),S=V+D<<3,M+=D}return h.length==M?h:h.slice(0,M)},d.H.W=function(f,h){const p=f.length;if(h<=p)return f;const m=new Uint8Array(p<<1);return m.set(f,0),m},d.H.R=function(f,h,p,m,y,b){const g=d.H.e,v=d.H.Z;let w=0;for(;w<p;){const T=f[v(m,y)&h];y+=15&T;const R=T>>>4;if(R<=15)b[w]=R,w++;else{let k=0,M=0;R==16?(M=3+g(m,y,2),y+=2,k=b[w-1]):R==17?(M=3+g(m,y,3),y+=3):R==18&&(M=11+g(m,y,7),y+=7);const S=w+M;for(;w<S;)b[w]=k,w++}}return y},d.H.V=function(f,h,p,m){let y=0,b=0;const g=m.length>>>1;for(;b<p;){const v=f[b+h];m[b<<1]=0,m[1+(b<<1)]=v,v>y&&(y=v),b++}for(;b<g;)m[b<<1]=0,m[1+(b<<1)]=0,b++;return y},d.H.n=function(f,h){const p=d.H.m,m=f.length;let y,b,g,v;const w=p.j;for(var T=0;T<=h;T++)w[T]=0;for(T=1;T<m;T+=2)w[f[T]]++;const R=p.K;for(y=0,w[0]=0,b=1;b<=h;b++)y=y+w[b-1]<<1,R[b]=y;for(g=0;g<m;g+=2)v=f[g+1],v!=0&&(f[g]=R[v],R[v]++)},d.H.A=function(f,h,p){const m=f.length,y=d.H.m.r;for(let b=0;b<m;b+=2)if(f[b+1]!=0){const g=b>>1,v=f[b+1],w=g<<4|v,T=h-v;let R=f[b]<<T;const k=R+(1<<T);for(;R!=k;)p[y[R]>>>15-h]=w,R++}},d.H.l=function(f,h){const p=d.H.m.r,m=15-h;for(let y=0;y<f.length;y+=2){const b=f[y]<<h-f[y+1];f[y]=p[b]>>>m}},d.H.M=function(f,h,p){p<<=7&h;const m=h>>>3;f[m]|=p,f[m+1]|=p>>>8},d.H.I=function(f,h,p){p<<=7&h;const m=h>>>3;f[m]|=p,f[m+1]|=p>>>8,f[m+2]|=p>>>16},d.H.e=function(f,h,p){return(f[h>>>3]|f[1+(h>>>3)]<<8)>>>(7&h)&(1<<p)-1},d.H.b=function(f,h,p){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16)>>>(7&h)&(1<<p)-1},d.H.Z=function(f,h){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16)>>>(7&h)},d.H.i=function(f,h){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16|f[3+(h>>>3)]<<24)>>>(7&h)},d.H.m=function(){const f=Uint16Array,h=Uint32Array;return{K:new f(16),j:new f(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new f(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new h(32),J:new f(512),_:[],h:new f(32),$:[],w:new f(32768),C:[],v:[],d:new f(32768),D:[],u:new f(512),Q:[],r:new f(32768),s:new h(286),Y:new h(30),a:new h(19),t:new h(15e3),k:new f(65536),g:new f(32768)}}(),function(){const f=d.H.m;for(var h=0;h<32768;h++){let m=h;m=(2863311530&m)>>>1|(1431655765&m)<<1,m=(3435973836&m)>>>2|(858993459&m)<<2,m=(4042322160&m)>>>4|(252645135&m)<<4,m=(4278255360&m)>>>8|(16711935&m)<<8,f.r[h]=(m>>>16|m<<16)>>>17}function p(m,y,b){for(;y--!=0;)m.push(0,b)}for(h=0;h<32;h++)f.q[h]=f.S[h]<<3|f.T[h],f.c[h]=f.p[h]<<4|f.z[h];p(f._,144,8),p(f._,112,9),p(f._,24,7),p(f._,8,8),d.H.n(f._,9),d.H.A(f._,9,f.J),d.H.l(f._,9),p(f.$,32,5),d.H.n(f.$,5),d.H.A(f.$,5,f.h),d.H.l(f.$,5),p(f.Q,19,0),p(f.C,286,0),p(f.D,30,0),p(f.v,320,0)}(),d.H.N}();function i(d){return[1,null,3,1,2,null,4][d.ctype]*d.depth}function o(d,f,h,p,m){let y=i(f);const b=Math.ceil(p*y/8);let g,v;y=Math.ceil(y/8);let w=d[h],T=0;if(w>1&&(d[h]=[0,0,1][w-2]),w==3)for(T=y;T<b;T++)d[T+1]=d[T+1]+(d[T+1-y]>>>1)&255;for(let R=0;R<m;R++)if(g=h+R*b,v=g+R+1,w=d[v-1],T=0,w==0)for(;T<b;T++)d[g+T]=d[v+T];else if(w==1){for(;T<y;T++)d[g+T]=d[v+T];for(;T<b;T++)d[g+T]=d[v+T]+d[g+T-y]}else if(w==2)for(;T<b;T++)d[g+T]=d[v+T]+d[g+T-b];else if(w==3){for(;T<y;T++)d[g+T]=d[v+T]+(d[g+T-b]>>>1);for(;T<b;T++)d[g+T]=d[v+T]+(d[g+T-b]+d[g+T-y]>>>1)}else{for(;T<y;T++)d[g+T]=d[v+T]+a(0,d[g+T-b],0);for(;T<b;T++)d[g+T]=d[v+T]+a(d[g+T-y],d[g+T-b],d[g+T-y-b])}return d}function a(d,f,h){const p=d+f-h,m=p-d,y=p-f,b=p-h;return m*m<=y*y&&m*m<=b*b?d:y*y<=b*b?f:h}function l(d,f,h){h.width=t.readUint(d,f),f+=4,h.height=t.readUint(d,f),f+=4,h.depth=d[f],f++,h.ctype=d[f],f++,h.compress=d[f],f++,h.filter=d[f],f++,h.interlace=d[f],f++}function u(d,f,h,p,m,y,b,g,v){const w=Math.min(f,m),T=Math.min(h,y);let R=0,k=0;for(let $=0;$<T;$++)for(let A=0;A<w;A++)if(b>=0&&g>=0?(R=$*f+A<<2,k=(g+$)*m+b+A<<2):(R=(-g+$)*f-b+A<<2,k=$*m+A<<2),v==0)p[k]=d[R],p[k+1]=d[R+1],p[k+2]=d[R+2],p[k+3]=d[R+3];else if(v==1){var M=d[R+3]*.00392156862745098,S=d[R]*M,C=d[R+1]*M,_=d[R+2]*M,E=p[k+3]*(1/255),I=p[k]*E,P=p[k+1]*E,O=p[k+2]*E;const j=1-M,W=M+E*j,V=W==0?0:1/W;p[k+3]=255*W,p[k+0]=(S+I*j)*V,p[k+1]=(C+P*j)*V,p[k+2]=(_+O*j)*V}else if(v==2)M=d[R+3],S=d[R],C=d[R+1],_=d[R+2],E=p[k+3],I=p[k],P=p[k+1],O=p[k+2],M==E&&S==I&&C==P&&_==O?(p[k]=0,p[k+1]=0,p[k+2]=0,p[k+3]=0):(p[k]=S,p[k+1]=C,p[k+2]=_,p[k+3]=M);else if(v==3){if(M=d[R+3],S=d[R],C=d[R+1],_=d[R+2],E=p[k+3],I=p[k],P=p[k+1],O=p[k+2],M==E&&S==I&&C==P&&_==O)continue;if(M<220&&E>20)return!1}return!0}return{decode:function(f){const h=new Uint8Array(f);let p=8;const m=t,y=m.readUshort,b=m.readUint,g={tabs:{},frames:[]},v=new Uint8Array(h.length);let w,T=0,R=0;const k=[137,80,78,71,13,10,26,10];for(var M=0;M<8;M++)if(h[M]!=k[M])throw"The input is not a PNG file!";for(;p<h.length;){const $=m.readUint(h,p);p+=4;const A=m.readASCII(h,p,4);if(p+=4,A=="IHDR")l(h,p,g);else if(A=="iCCP"){for(var S=p;h[S]!=0;)S++;m.readASCII(h,p,S-p),h[S+1];const j=h.slice(S+2,p+$);let W=null;try{W=r(j)}catch{W=s(j)}g.tabs[A]=W}else if(A=="CgBI")g.tabs[A]=h.slice(p,p+4);else if(A=="IDAT"){for(M=0;M<$;M++)v[T+M]=h[p+M];T+=$}else if(A=="acTL")g.tabs[A]={num_frames:b(h,p),num_plays:b(h,p+4)},w=new Uint8Array(h.length);else if(A=="fcTL"){R!=0&&((O=g.frames[g.frames.length-1]).data=n(g,w.slice(0,R),O.rect.width,O.rect.height),R=0);const j={x:b(h,p+12),y:b(h,p+16),width:b(h,p+4),height:b(h,p+8)};let W=y(h,p+22);W=y(h,p+20)/(W==0?100:W);const V={rect:j,delay:Math.round(1e3*W),dispose:h[p+24],blend:h[p+25]};g.frames.push(V)}else if(A=="fdAT"){for(M=0;M<$-4;M++)w[R+M]=h[p+M+4];R+=$-4}else if(A=="pHYs")g.tabs[A]=[m.readUint(h,p),m.readUint(h,p+4),h[p+8]];else if(A=="cHRM")for(g.tabs[A]=[],M=0;M<8;M++)g.tabs[A].push(m.readUint(h,p+4*M));else if(A=="tEXt"||A=="zTXt"){g.tabs[A]==null&&(g.tabs[A]={});var C=m.nextZero(h,p),_=m.readASCII(h,p,C-p),E=p+$-C-1;if(A=="tEXt")P=m.readASCII(h,C+1,E);else{var I=r(h.slice(C+2,C+2+E));P=m.readUTF8(I,0,I.length)}g.tabs[A][_]=P}else if(A=="iTXt"){g.tabs[A]==null&&(g.tabs[A]={}),C=0,S=p,C=m.nextZero(h,S),_=m.readASCII(h,S,C-S);const j=h[S=C+1];var P;h[S+1],S+=2,C=m.nextZero(h,S),m.readASCII(h,S,C-S),S=C+1,C=m.nextZero(h,S),m.readUTF8(h,S,C-S),E=$-((S=C+1)-p),j==0?P=m.readUTF8(h,S,E):(I=r(h.slice(S,S+E)),P=m.readUTF8(I,0,I.length)),g.tabs[A][_]=P}else if(A=="PLTE")g.tabs[A]=m.readBytes(h,p,$);else if(A=="hIST"){const j=g.tabs.PLTE.length/3;for(g.tabs[A]=[],M=0;M<j;M++)g.tabs[A].push(y(h,p+2*M))}else if(A=="tRNS")g.ctype==3?g.tabs[A]=m.readBytes(h,p,$):g.ctype==0?g.tabs[A]=y(h,p):g.ctype==2&&(g.tabs[A]=[y(h,p),y(h,p+2),y(h,p+4)]);else if(A=="gAMA")g.tabs[A]=m.readUint(h,p)/1e5;else if(A=="sRGB")g.tabs[A]=h[p];else if(A=="bKGD")g.ctype==0||g.ctype==4?g.tabs[A]=[y(h,p)]:g.ctype==2||g.ctype==6?g.tabs[A]=[y(h,p),y(h,p+2),y(h,p+4)]:g.ctype==3&&(g.tabs[A]=h[p]);else if(A=="IEND")break;p+=$,m.readUint(h,p),p+=4}var O;return R!=0&&((O=g.frames[g.frames.length-1]).data=n(g,w.slice(0,R),O.rect.width,O.rect.height)),g.data=n(g,v,g.width,g.height),delete g.compress,delete g.interlace,delete g.filter,g},toRGBA8:function(f){const h=f.width,p=f.height;if(f.tabs.acTL==null)return[e(f.data,h,p,f).buffer];const m=[];f.frames[0].data==null&&(f.frames[0].data=f.data);const y=h*p*4,b=new Uint8Array(y),g=new Uint8Array(y),v=new Uint8Array(y);for(let T=0;T<f.frames.length;T++){const R=f.frames[T],k=R.rect.x,M=R.rect.y,S=R.rect.width,C=R.rect.height,_=e(R.data,S,C,f);if(T!=0)for(var w=0;w<y;w++)v[w]=b[w];if(R.blend==0?u(_,S,C,b,h,p,k,M,0):R.blend==1&&u(_,S,C,b,h,p,k,M,1),m.push(b.buffer.slice(0)),R.dispose!=0){if(R.dispose==1)u(g,S,C,b,h,p,k,M,0);else if(R.dispose==2)for(w=0;w<y;w++)b[w]=v[w]}}return m},_paeth:a,_copyTile:u,_bin:t}}();(function(){const{_copyTile:t}=Vi,{_bin:e}=Vi,n=Vi._paeth;var r={table:function(){const S=new Uint32Array(256);for(let C=0;C<256;C++){let _=C;for(let E=0;E<8;E++)1&_?_=3988292384^_>>>1:_>>>=1;S[C]=_}return S}(),update(S,C,_,E){for(let I=0;I<E;I++)S=r.table[255&(S^C[_+I])]^S>>>8;return S},crc:(S,C,_)=>4294967295^r.update(4294967295,S,C,_)};function s(S,C,_,E){C[_]+=S[0]*E>>4,C[_+1]+=S[1]*E>>4,C[_+2]+=S[2]*E>>4,C[_+3]+=S[3]*E>>4}function i(S){return Math.max(0,Math.min(255,S))}function o(S,C){const _=S[0]-C[0],E=S[1]-C[1],I=S[2]-C[2],P=S[3]-C[3];return _*_+E*E+I*I+P*P}function a(S,C,_,E,I,P,O){O==null&&(O=1);const $=E.length,A=[];for(var j=0;j<$;j++){const ne=E[j];A.push([ne>>>0&255,ne>>>8&255,ne>>>16&255,ne>>>24&255])}for(j=0;j<$;j++){let ne=4294967295;for(var W=0,V=0;V<$;V++){var D=o(A[j],A[V]);V!=j&&D<ne&&(ne=D,W=V)}}const ge=new Uint32Array(I.buffer),me=new Int16Array(C*_*4),F=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(j=0;j<F.length;j++)F[j]=255*((F[j]+.5)/16-.5);for(let ne=0;ne<_;ne++)for(let Oe=0;Oe<C;Oe++){var U;j=4*(ne*C+Oe),O!=2?U=[i(S[j]+me[j]),i(S[j+1]+me[j+1]),i(S[j+2]+me[j+2]),i(S[j+3]+me[j+3])]:(D=F[4*(3&ne)+(3&Oe)],U=[i(S[j]+D),i(S[j+1]+D),i(S[j+2]+D),i(S[j+3]+D)]),W=0;let at=16777215;for(V=0;V<$;V++){const le=o(U,A[V]);le<at&&(at=le,W=V)}const ae=A[W],_e=[U[0]-ae[0],U[1]-ae[1],U[2]-ae[2],U[3]-ae[3]];O==1&&(Oe!=C-1&&s(_e,me,j+4,7),ne!=_-1&&(Oe!=0&&s(_e,me,j+4*C-4,3),s(_e,me,j+4*C,5),Oe!=C-1&&s(_e,me,j+4*C+4,1))),P[j>>2]=W,ge[j>>2]=E[W]}}function l(S,C,_,E,I){I==null&&(I={});const{crc:P}=r,O=e.writeUint,$=e.writeUshort,A=e.writeASCII;let j=8;const W=S.frames.length>1;let V,D=!1,ge=33+(W?20:0);if(I.sRGB!=null&&(ge+=13),I.pHYs!=null&&(ge+=21),I.iCCP!=null&&(V=pako.deflate(I.iCCP),ge+=21+V.length+4),S.ctype==3){for(var me=S.plte.length,F=0;F<me;F++)S.plte[F]>>>24!=255&&(D=!0);ge+=8+3*me+4+(D?8+1*me+4:0)}for(var U=0;U<S.frames.length;U++)W&&(ge+=38),ge+=(ae=S.frames[U]).cimg.length+12,U!=0&&(ge+=4);ge+=12;const ne=new Uint8Array(ge),Oe=[137,80,78,71,13,10,26,10];for(F=0;F<8;F++)ne[F]=Oe[F];if(O(ne,j,13),j+=4,A(ne,j,"IHDR"),j+=4,O(ne,j,C),j+=4,O(ne,j,_),j+=4,ne[j]=S.depth,j++,ne[j]=S.ctype,j++,ne[j]=0,j++,ne[j]=0,j++,ne[j]=0,j++,O(ne,j,P(ne,j-17,17)),j+=4,I.sRGB!=null&&(O(ne,j,1),j+=4,A(ne,j,"sRGB"),j+=4,ne[j]=I.sRGB,j++,O(ne,j,P(ne,j-5,5)),j+=4),I.iCCP!=null){const _e=13+V.length;O(ne,j,_e),j+=4,A(ne,j,"iCCP"),j+=4,A(ne,j,"ICC profile"),j+=11,j+=2,ne.set(V,j),j+=V.length,O(ne,j,P(ne,j-(_e+4),_e+4)),j+=4}if(I.pHYs!=null&&(O(ne,j,9),j+=4,A(ne,j,"pHYs"),j+=4,O(ne,j,I.pHYs[0]),j+=4,O(ne,j,I.pHYs[1]),j+=4,ne[j]=I.pHYs[2],j++,O(ne,j,P(ne,j-13,13)),j+=4),W&&(O(ne,j,8),j+=4,A(ne,j,"acTL"),j+=4,O(ne,j,S.frames.length),j+=4,O(ne,j,I.loop!=null?I.loop:0),j+=4,O(ne,j,P(ne,j-12,12)),j+=4),S.ctype==3){for(O(ne,j,3*(me=S.plte.length)),j+=4,A(ne,j,"PLTE"),j+=4,F=0;F<me;F++){const _e=3*F,le=S.plte[F],Ce=255&le,Le=le>>>8&255,Ve=le>>>16&255;ne[j+_e+0]=Ce,ne[j+_e+1]=Le,ne[j+_e+2]=Ve}if(j+=3*me,O(ne,j,P(ne,j-3*me-4,3*me+4)),j+=4,D){for(O(ne,j,me),j+=4,A(ne,j,"tRNS"),j+=4,F=0;F<me;F++)ne[j+F]=S.plte[F]>>>24&255;j+=me,O(ne,j,P(ne,j-me-4,me+4)),j+=4}}let at=0;for(U=0;U<S.frames.length;U++){var ae=S.frames[U];W&&(O(ne,j,26),j+=4,A(ne,j,"fcTL"),j+=4,O(ne,j,at++),j+=4,O(ne,j,ae.rect.width),j+=4,O(ne,j,ae.rect.height),j+=4,O(ne,j,ae.rect.x),j+=4,O(ne,j,ae.rect.y),j+=4,$(ne,j,E[U]),j+=2,$(ne,j,1e3),j+=2,ne[j]=ae.dispose,j++,ne[j]=ae.blend,j++,O(ne,j,P(ne,j-30,30)),j+=4);const _e=ae.cimg;O(ne,j,(me=_e.length)+(U==0?0:4)),j+=4;const le=j;A(ne,j,U==0?"IDAT":"fdAT"),j+=4,U!=0&&(O(ne,j,at++),j+=4),ne.set(_e,j),j+=me,O(ne,j,P(ne,le,j-le)),j+=4}return O(ne,j,0),j+=4,A(ne,j,"IEND"),j+=4,O(ne,j,P(ne,j-4,4)),j+=4,ne.buffer}function u(S,C,_){for(let E=0;E<S.frames.length;E++){const I=S.frames[E];I.rect.width;const P=I.rect.height,O=new Uint8Array(P*I.bpl+P);I.cimg=p(I.img,P,I.bpp,I.bpl,O,C,_)}}function d(S,C,_,E,I){const P=I[0],O=I[1],$=I[2],A=I[3],j=I[4],W=I[5];let V=6,D=8,ge=255;for(var me=0;me<S.length;me++){const ht=new Uint8Array(S[me]);for(var F=ht.length,U=0;U<F;U+=4)ge&=ht[U+3]}const ne=ge!=255,Oe=function(vt,te,Z,ie,he,se){const Q=[];for(var ke=0;ke<vt.length;ke++){const Dt=new Uint8Array(vt[ke]),oe=new Uint32Array(Dt.buffer);var Me;let Ee=0,Ue=0,tt=te,Ne=Z,pt=ie?1:0;if(ke!=0){const dt=se||ie||ke==1||Q[ke-2].dispose!=0?1:2;let Et=0,ue=1e9;for(let Se=0;Se<dt;Se++){var fe=new Uint8Array(vt[ke-1-Se]);const nt=new Uint32Array(vt[ke-1-Se]);let ft=te,ct=Z,Qe=-1,It=-1;for(let J=0;J<Z;J++)for(let ye=0;ye<te;ye++)oe[qe=J*te+ye]!=nt[qe]&&(ye<ft&&(ft=ye),ye>Qe&&(Qe=ye),J<ct&&(ct=J),J>It&&(It=J));Qe==-1&&(ft=ct=Qe=It=0),he&&((1&ft)==1&&ft--,(1&ct)==1&&ct--);const Lt=(Qe-ft+1)*(It-ct+1);Lt<ue&&(ue=Lt,Et=Se,Ee=ft,Ue=ct,tt=Qe-ft+1,Ne=It-ct+1)}fe=new Uint8Array(vt[ke-1-Et]),Et==1&&(Q[ke-1].dispose=2),Me=new Uint8Array(tt*Ne*4),t(fe,te,Z,Me,tt,Ne,-Ee,-Ue,0),pt=t(Dt,te,Z,Me,tt,Ne,-Ee,-Ue,3)?1:0,pt==1?h(Dt,te,Z,Me,{x:Ee,y:Ue,width:tt,height:Ne}):t(Dt,te,Z,Me,tt,Ne,-Ee,-Ue,0)}else Me=Dt.slice(0);Q.push({rect:{x:Ee,y:Ue,width:tt,height:Ne},img:Me,blend:pt,dispose:0})}if(ie)for(ke=0;ke<Q.length;ke++){if((xt=Q[ke]).blend==1)continue;const Dt=xt.rect,oe=Q[ke-1].rect,Ee=Math.min(Dt.x,oe.x),Ue=Math.min(Dt.y,oe.y),tt={x:Ee,y:Ue,width:Math.max(Dt.x+Dt.width,oe.x+oe.width)-Ee,height:Math.max(Dt.y+Dt.height,oe.y+oe.height)-Ue};Q[ke-1].dispose=1,ke-1!=0&&f(vt,te,Z,Q,ke-1,tt,he),f(vt,te,Z,Q,ke,tt,he)}let Re=0;if(vt.length!=1)for(var qe=0;qe<Q.length;qe++){var xt;Re+=(xt=Q[qe]).rect.width*xt.rect.height}return Q}(S,C,_,P,O,$),at={},ae=[],_e=[];if(E!=0){const ht=[];for(U=0;U<Oe.length;U++)ht.push(Oe[U].img.buffer);const vt=function(he){let se=0;for(var Q=0;Q<he.length;Q++)se+=he[Q].byteLength;const ke=new Uint8Array(se);let Me=0;for(Q=0;Q<he.length;Q++){const fe=new Uint8Array(he[Q]),Re=fe.length;for(let qe=0;qe<Re;qe+=4){let xt=fe[qe],Dt=fe[qe+1],oe=fe[qe+2];const Ee=fe[qe+3];Ee==0&&(xt=Dt=oe=0),ke[Me+qe]=xt,ke[Me+qe+1]=Dt,ke[Me+qe+2]=oe,ke[Me+qe+3]=Ee}Me+=Re}return ke.buffer}(ht),te=y(vt,E);for(U=0;U<te.plte.length;U++)ae.push(te.plte[U].est.rgba);let Z=0;for(U=0;U<Oe.length;U++){const ie=(Ce=Oe[U]).img.length;var le=new Uint8Array(te.inds.buffer,Z>>2,ie>>2);_e.push(le);const he=new Uint8Array(te.abuf,Z,ie);W&&a(Ce.img,Ce.rect.width,Ce.rect.height,ae,he,le),Ce.img.set(he),Z+=ie}}else for(me=0;me<Oe.length;me++){var Ce=Oe[me];const ht=new Uint32Array(Ce.img.buffer);var Le=Ce.rect.width;for(F=ht.length,le=new Uint8Array(F),_e.push(le),U=0;U<F;U++){const vt=ht[U];if(U!=0&&vt==ht[U-1])le[U]=le[U-1];else if(U>Le&&vt==ht[U-Le])le[U]=le[U-Le];else{let te=at[vt];if(te==null&&(at[vt]=te=ae.length,ae.push(vt),ae.length>=300))break;le[U]=te}}}const Ve=ae.length;for(Ve<=256&&j==0&&(D=Ve<=2?1:Ve<=4?2:Ve<=16?4:8,D=Math.max(D,A)),me=0;me<Oe.length;me++){(Ce=Oe[me]).rect.x,Ce.rect.y,Le=Ce.rect.width;const ht=Ce.rect.height;let vt=Ce.img;new Uint32Array(vt.buffer);let te=4*Le,Z=4;if(Ve<=256&&j==0){te=Math.ceil(D*Le/8);var st=new Uint8Array(te*ht);const ie=_e[me];for(let he=0;he<ht;he++){U=he*te;const se=he*Le;if(D==8)for(var Be=0;Be<Le;Be++)st[U+Be]=ie[se+Be];else if(D==4)for(Be=0;Be<Le;Be++)st[U+(Be>>1)]|=ie[se+Be]<<4-4*(1&Be);else if(D==2)for(Be=0;Be<Le;Be++)st[U+(Be>>2)]|=ie[se+Be]<<6-2*(3&Be);else if(D==1)for(Be=0;Be<Le;Be++)st[U+(Be>>3)]|=ie[se+Be]<<7-1*(7&Be)}vt=st,V=3,Z=1}else if(ne==0&&Oe.length==1){st=new Uint8Array(Le*ht*3);const ie=Le*ht;for(U=0;U<ie;U++){const he=3*U,se=4*U;st[he]=vt[se],st[he+1]=vt[se+1],st[he+2]=vt[se+2]}vt=st,V=2,Z=3,te=3*Le}Ce.img=vt,Ce.bpl=te,Ce.bpp=Z}return{ctype:V,depth:D,plte:ae,frames:Oe}}function f(S,C,_,E,I,P,O){const $=Uint8Array,A=Uint32Array,j=new $(S[I-1]),W=new A(S[I-1]),V=I+1<S.length?new $(S[I+1]):null,D=new $(S[I]),ge=new A(D.buffer);let me=C,F=_,U=-1,ne=-1;for(let at=0;at<P.height;at++)for(let ae=0;ae<P.width;ae++){const _e=P.x+ae,le=P.y+at,Ce=le*C+_e,Le=ge[Ce];Le==0||E[I-1].dispose==0&&W[Ce]==Le&&(V==null||V[4*Ce+3]!=0)||(_e<me&&(me=_e),_e>U&&(U=_e),le<F&&(F=le),le>ne&&(ne=le))}U==-1&&(me=F=U=ne=0),O&&((1&me)==1&&me--,(1&F)==1&&F--),P={x:me,y:F,width:U-me+1,height:ne-F+1};const Oe=E[I];Oe.rect=P,Oe.blend=1,Oe.img=new Uint8Array(P.width*P.height*4),E[I-1].dispose==0?(t(j,C,_,Oe.img,P.width,P.height,-P.x,-P.y,0),h(D,C,_,Oe.img,P)):t(D,C,_,Oe.img,P.width,P.height,-P.x,-P.y,0)}function h(S,C,_,E,I){t(S,C,_,E,I.width,I.height,-I.x,-I.y,2)}function p(S,C,_,E,I,P,O){const $=[];let A,j=[0,1,2,3,4];P!=-1?j=[P]:(C*E>5e5||_==1)&&(j=[0]),O&&(A={level:0});const W=$9;for(var V=0;V<j.length;V++){for(let me=0;me<C;me++)m(I,S,me,E,_,j[V]);$.push(W.deflate(I,A))}let D,ge=1e9;for(V=0;V<$.length;V++)$[V].length<ge&&(D=V,ge=$[V].length);return $[D]}function m(S,C,_,E,I,P){const O=_*E;let $=O+_;if(S[$]=P,$++,P==0)if(E<500)for(var A=0;A<E;A++)S[$+A]=C[O+A];else S.set(new Uint8Array(C.buffer,O,E),$);else if(P==1){for(A=0;A<I;A++)S[$+A]=C[O+A];for(A=I;A<E;A++)S[$+A]=C[O+A]-C[O+A-I]+256&255}else if(_==0){for(A=0;A<I;A++)S[$+A]=C[O+A];if(P==2)for(A=I;A<E;A++)S[$+A]=C[O+A];if(P==3)for(A=I;A<E;A++)S[$+A]=C[O+A]-(C[O+A-I]>>1)+256&255;if(P==4)for(A=I;A<E;A++)S[$+A]=C[O+A]-n(C[O+A-I],0,0)+256&255}else{if(P==2)for(A=0;A<E;A++)S[$+A]=C[O+A]+256-C[O+A-E]&255;if(P==3){for(A=0;A<I;A++)S[$+A]=C[O+A]+256-(C[O+A-E]>>1)&255;for(A=I;A<E;A++)S[$+A]=C[O+A]+256-(C[O+A-E]+C[O+A-I]>>1)&255}if(P==4){for(A=0;A<I;A++)S[$+A]=C[O+A]+256-n(0,C[O+A-E],0)&255;for(A=I;A<E;A++)S[$+A]=C[O+A]+256-n(C[O+A-I],C[O+A-E],C[O+A-I-E])&255}}}function y(S,C){const _=new Uint8Array(S),E=_.slice(0),I=new Uint32Array(E.buffer),P=b(E,C),O=P[0],$=P[1],A=_.length,j=new Uint8Array(A>>2);let W;if(_.length<2e7)for(var V=0;V<A;V+=4)W=g(O,D=_[V]*(1/255),ge=_[V+1]*(1/255),me=_[V+2]*(1/255),F=_[V+3]*(1/255)),j[V>>2]=W.ind,I[V>>2]=W.est.rgba;else for(V=0;V<A;V+=4){var D=_[V]*.00392156862745098,ge=_[V+1]*(1/255),me=_[V+2]*(1/255),F=_[V+3]*(1/255);for(W=O;W.left;)W=v(W.est,D,ge,me,F)<=0?W.left:W.right;j[V>>2]=W.ind,I[V>>2]=W.est.rgba}return{abuf:E.buffer,inds:j,plte:$}}function b(S,C,_){_==null&&(_=1e-4);const E=new Uint32Array(S.buffer),I={i0:0,i1:S.length,bst:null,est:null,tdst:0,left:null,right:null};I.bst=R(S,I.i0,I.i1),I.est=k(I.bst);const P=[I];for(;P.length<C;){let $=0,A=0;for(var O=0;O<P.length;O++)P[O].est.L>$&&($=P[O].est.L,A=O);if($<_)break;const j=P[A],W=w(S,E,j.i0,j.i1,j.est.e,j.est.eMq255);if(j.i0>=W||j.i1<=W){j.est.L=0;continue}const V={i0:j.i0,i1:W,bst:null,est:null,tdst:0,left:null,right:null};V.bst=R(S,V.i0,V.i1),V.est=k(V.bst);const D={i0:W,i1:j.i1,bst:null,est:null,tdst:0,left:null,right:null};for(D.bst={R:[],m:[],N:j.bst.N-V.bst.N},O=0;O<16;O++)D.bst.R[O]=j.bst.R[O]-V.bst.R[O];for(O=0;O<4;O++)D.bst.m[O]=j.bst.m[O]-V.bst.m[O];D.est=k(D.bst),j.left=V,j.right=D,P[A]=V,P.push(D)}for(P.sort(($,A)=>A.bst.N-$.bst.N),O=0;O<P.length;O++)P[O].ind=O;return[I,P]}function g(S,C,_,E,I){if(S.left==null)return S.tdst=function(V,D,ge,me,F){const U=D-V[0],ne=ge-V[1],Oe=me-V[2],at=F-V[3];return U*U+ne*ne+Oe*Oe+at*at}(S.est.q,C,_,E,I),S;const P=v(S.est,C,_,E,I);let O=S.left,$=S.right;P>0&&(O=S.right,$=S.left);const A=g(O,C,_,E,I);if(A.tdst<=P*P)return A;const j=g($,C,_,E,I);return j.tdst<A.tdst?j:A}function v(S,C,_,E,I){const{e:P}=S;return P[0]*C+P[1]*_+P[2]*E+P[3]*I-S.eMq}function w(S,C,_,E,I,P){for(E-=4;_<E;){for(;T(S,_,I)<=P;)_+=4;for(;T(S,E,I)>P;)E-=4;if(_>=E)break;const O=C[_>>2];C[_>>2]=C[E>>2],C[E>>2]=O,_+=4,E-=4}for(;T(S,_,I)>P;)_-=4;return _+4}function T(S,C,_){return S[C]*_[0]+S[C+1]*_[1]+S[C+2]*_[2]+S[C+3]*_[3]}function R(S,C,_){const E=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],I=[0,0,0,0],P=_-C>>2;for(let O=C;O<_;O+=4){const $=S[O]*.00392156862745098,A=S[O+1]*(1/255),j=S[O+2]*(1/255),W=S[O+3]*(1/255);I[0]+=$,I[1]+=A,I[2]+=j,I[3]+=W,E[0]+=$*$,E[1]+=$*A,E[2]+=$*j,E[3]+=$*W,E[5]+=A*A,E[6]+=A*j,E[7]+=A*W,E[10]+=j*j,E[11]+=j*W,E[15]+=W*W}return E[4]=E[1],E[8]=E[2],E[9]=E[6],E[12]=E[3],E[13]=E[7],E[14]=E[11],{R:E,m:I,N:P}}function k(S){const{R:C}=S,{m:_}=S,{N:E}=S,I=_[0],P=_[1],O=_[2],$=_[3],A=E==0?0:1/E,j=[C[0]-I*I*A,C[1]-I*P*A,C[2]-I*O*A,C[3]-I*$*A,C[4]-P*I*A,C[5]-P*P*A,C[6]-P*O*A,C[7]-P*$*A,C[8]-O*I*A,C[9]-O*P*A,C[10]-O*O*A,C[11]-O*$*A,C[12]-$*I*A,C[13]-$*P*A,C[14]-$*O*A,C[15]-$*$*A],W=j,V=M;let D=[Math.random(),Math.random(),Math.random(),Math.random()],ge=0,me=0;if(E!=0)for(let U=0;U<16&&(D=V.multVec(W,D),me=Math.sqrt(V.dot(D,D)),D=V.sml(1/me,D),!(U!=0&&Math.abs(me-ge)<1e-9));U++)ge=me;const F=[I*A,P*A,O*A,$*A];return{Cov:j,q:F,e:D,L:ge,eMq255:V.dot(V.sml(255,F),D),eMq:V.dot(D,F),rgba:(Math.round(255*F[3])<<24|Math.round(255*F[2])<<16|Math.round(255*F[1])<<8|Math.round(255*F[0])<<0)>>>0}}var M={multVec:(S,C)=>[S[0]*C[0]+S[1]*C[1]+S[2]*C[2]+S[3]*C[3],S[4]*C[0]+S[5]*C[1]+S[6]*C[2]+S[7]*C[3],S[8]*C[0]+S[9]*C[1]+S[10]*C[2]+S[11]*C[3],S[12]*C[0]+S[13]*C[1]+S[14]*C[2]+S[15]*C[3]],dot:(S,C)=>S[0]*C[0]+S[1]*C[1]+S[2]*C[2]+S[3]*C[3],sml:(S,C)=>[S*C[0],S*C[1],S*C[2],S*C[3]]};Vi.encode=function(C,_,E,I,P,O,$){I==null&&(I=0),$==null&&($=!1);const A=d(C,_,E,I,[!1,!1,!1,0,$,!1]);return u(A,-1),l(A,_,E,P,O)},Vi.encodeLL=function(C,_,E,I,P,O,$,A){const j={ctype:0+(I==1?0:2)+(P==0?0:4),depth:O,frames:[]},W=(I+P)*O,V=W*_;for(let D=0;D<C.length;D++)j.frames.push({rect:{x:0,y:0,width:_,height:E},img:new Uint8Array(C[D]),blend:0,dispose:1,bpp:Math.ceil(W/8),bpl:Math.ceil(V/8)});return u(j,0,!0),l(j,_,E,$,A)},Vi.encode.compress=d,Vi.encode.dither=a,Vi.quantize=y,Vi.quantize.getKDtree=b,Vi.quantize.getNearest=g})();const jD={toArrayBuffer(t,e){const n=t.width,r=t.height,s=n<<2,i=t.getContext("2d").getImageData(0,0,n,r),o=new Uint32Array(i.data.buffer),a=(32*n+31)/32<<2,l=a*r,u=122+l,d=new ArrayBuffer(u),f=new DataView(d),h=1<<20;let p,m,y,b,g=h,v=0,w=0,T=0;function R(S){f.setUint16(w,S,!0),w+=2}function k(S){f.setUint32(w,S,!0),w+=4}function M(S){w+=S}R(19778),k(u),M(4),k(122),k(108),k(n),k(-r>>>0),R(1),R(32),k(3),k(l),k(2835),k(2835),M(8),k(16711680),k(65280),k(255),k(4278190080),k(1466527264),function S(){for(;v<r&&g>0;){for(b=122+v*a,p=0;p<s;)g--,m=o[T++],y=m>>>24,f.setUint32(b+p,m<<8|y),p+=4;v++}T<o.length?(g=h,setTimeout(S,jD._dly)):e(d)}()},toBlob(t,e){this.toArrayBuffer(t,n=>{e(new Blob([n],{type:"image/bmp"}))})},_dly:9};var Os={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},z9={[Os.CHROME]:16384,[Os.FIREFOX]:11180,[Os.DESKTOP_SAFARI]:16384,[Os.IE]:8192,[Os.IOS]:4096,[Os.ETC]:8192};const dw=typeof window<"u",ID=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,mm=dw&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),F9=(dw||ID)&&(mm&&mm.getOriginalSymbol(window,"File")||typeof File<"u"&&File),MD=(dw||ID)&&(mm&&mm.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function fw(t,e,n=Date.now()){return new Promise(r=>{const s=t.split(","),i=s[0].match(/:(.*?);/)[1],o=globalThis.atob(s[1]);let a=o.length;const l=new Uint8Array(a);for(;a--;)l[a]=o.charCodeAt(a);const u=new Blob([l],{type:i});u.name=e,u.lastModified=n,r(u)})}function DD(t){return new Promise((e,n)=>{const r=new MD;r.onload=()=>e(r.result),r.onerror=s=>n(s),r.readAsDataURL(t)})}function AD(t){return new Promise((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=s=>n(s),r.src=t})}function Dl(){if(Dl.cachedResult!==void 0)return Dl.cachedResult;let t=Os.ETC;const{userAgent:e}=navigator;return/Chrom(e|ium)/i.test(e)?t=Os.CHROME:/iP(ad|od|hone)/i.test(e)&&/WebKit/i.test(e)?t=Os.IOS:/Safari/i.test(e)?t=Os.DESKTOP_SAFARI:/Firefox/i.test(e)?t=Os.FIREFOX:(/MSIE/i.test(e)||document.documentMode)&&(t=Os.IE),Dl.cachedResult=t,Dl.cachedResult}function RD(t,e){const n=Dl(),r=z9[n];let s=t,i=e,o=s*i;const a=s>i?i/s:s/i;for(;o>r*r;){const l=(r+s)/2,u=(r+i)/2;l<u?(i=u,s=u*a):(i=l*a,s=l),o=s*i}return{width:s,height:i}}function Lg(t,e){let n,r;try{if(n=new OffscreenCanvas(t,e),r=n.getContext("2d"),r===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{n=document.createElement("canvas"),r=n.getContext("2d")}return n.width=t,n.height=e,[n,r]}function OD(t,e){const{width:n,height:r}=RD(t.width,t.height),[s,i]=Lg(n,r);return e&&/jpe?g/.test(e)&&(i.fillStyle="white",i.fillRect(0,0,s.width,s.height)),i.drawImage(t,0,0,s.width,s.height),s}function kp(){return kp.cachedResult!==void 0||(kp.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),kp.cachedResult}function gm(t,e={}){return new Promise(function(n,r){let s,i;var o=function(){try{return i=OD(s,e.fileType||t.type),n([s,i])}catch(l){return r(l)}},a=function(l){try{var u=function(d){try{throw d}catch(f){return r(f)}};try{let d;return DD(t).then(function(f){try{return d=f,AD(d).then(function(h){try{return s=h,function(){try{return o()}catch(p){return r(p)}}()}catch(p){return u(p)}},u)}catch(h){return u(h)}},u)}catch(d){u(d)}}catch(d){return r(d)}};try{if(kp()||[Os.DESKTOP_SAFARI,Os.MOBILE_SAFARI].includes(Dl()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(t).then(function(l){try{return s=l,o()}catch{return a()}},a)}catch{a()}})}function ym(t,e,n,r,s=1){return new Promise(function(i,o){let a;if(e==="image/png"){let f,h,p;return f=t.getContext("2d"),{data:h}=f.getImageData(0,0,t.width,t.height),p=Vi.encode([h.buffer],t.width,t.height,4096*s),a=new Blob([p],{type:e}),a.name=n,a.lastModified=r,l.call(this)}{let f=function(){return l.call(this)};var u=f;if(e==="image/bmp")return new Promise(h=>jD.toBlob(t,h)).then((function(h){try{return a=h,a.name=n,a.lastModified=r,f.call(this)}catch(p){return o(p)}}).bind(this),o);{let h=function(){return f.call(this)};var d=h;if(typeof OffscreenCanvas=="function"&&t instanceof OffscreenCanvas)return t.convertToBlob({type:e,quality:s}).then((function(p){try{return a=p,a.name=n,a.lastModified=r,h.call(this)}catch(m){return o(m)}}).bind(this),o);{let p;return p=t.toDataURL(e,s),fw(p,n,r).then((function(m){try{return a=m,h.call(this)}catch(y){return o(y)}}).bind(this),o)}}}function l(){return i(a)}})}function ao(t){t.width=0,t.height=0}function Yc(){return new Promise(function(t,e){let n,r,s,i;return Yc.cachedResult!==void 0?t(Yc.cachedResult):fw("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(o){try{return n=o,gm(n).then(function(a){try{return r=a[1],ym(r,n.type,n.name,n.lastModified).then(function(l){try{return s=l,ao(r),gm(s).then(function(u){try{return i=u[0],Yc.cachedResult=i.width===1&&i.height===2,t(Yc.cachedResult)}catch(d){return e(d)}},e)}catch(u){return e(u)}},e)}catch(l){return e(l)}},e)}catch(a){return e(a)}},e)})}function PD(t){return new Promise((e,n)=>{const r=new MD;r.onload=s=>{const i=new DataView(s.target.result);if(i.getUint16(0,!1)!=65496)return e(-2);const o=i.byteLength;let a=2;for(;a<o;){if(i.getUint16(a+2,!1)<=8)return e(-1);const l=i.getUint16(a,!1);if(a+=2,l==65505){if(i.getUint32(a+=2,!1)!=1165519206)return e(-1);const u=i.getUint16(a+=6,!1)==18761;a+=i.getUint32(a+4,u);const d=i.getUint16(a,u);a+=2;for(let f=0;f<d;f++)if(i.getUint16(a+12*f,u)==274)return e(i.getUint16(a+12*f+8,u))}else{if((65280&l)!=65280)break;a+=i.getUint16(a,!1)}}return e(-1)},r.onerror=s=>n(s),r.readAsArrayBuffer(t)})}function LD(t,e){const{width:n}=t,{height:r}=t,{maxWidthOrHeight:s}=e;let i,o=t;return isFinite(s)&&(n>s||r>s)&&([o,i]=Lg(n,r),n>r?(o.width=s,o.height=r/n*s):(o.width=n/r*s,o.height=s),i.drawImage(t,0,0,o.width,o.height),ao(t)),o}function $D(t,e){const{width:n}=t,{height:r}=t,[s,i]=Lg(n,r);switch(e>4&&e<9?(s.width=r,s.height=n):(s.width=n,s.height=r),e){case 2:i.transform(-1,0,0,1,n,0);break;case 3:i.transform(-1,0,0,-1,n,r);break;case 4:i.transform(1,0,0,-1,0,r);break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,r,0);break;case 7:i.transform(0,-1,-1,0,r,n);break;case 8:i.transform(0,-1,1,0,0,n)}return i.drawImage(t,0,0,n,r),ao(t),s}function N_(t,e,n=0){return new Promise(function(r,s){let i,o,a,l,u,d,f,h,p,m,y,b,g,v,w,T,R,k,M,S;function C(E=5){if(e.signal&&e.signal.aborted)throw e.signal.reason;i+=E,e.onProgress(Math.min(i,100))}function _(E){if(e.signal&&e.signal.aborted)throw e.signal.reason;i=Math.min(Math.max(E,i),100),e.onProgress(i)}return i=n,o=e.maxIteration||10,a=1024*e.maxSizeMB*1024,C(),gm(t,e).then((function(E){try{return[,l]=E,C(),u=LD(l,e),C(),new Promise(function(I,P){var O;if(!(O=e.exifOrientation))return PD(t).then((function(A){try{return O=A,$.call(this)}catch(j){return P(j)}}).bind(this),P);function $(){return I(O)}return $.call(this)}).then((function(I){try{return d=I,C(),Yc().then((function(P){try{return f=P?u:$D(u,d),C(),h=e.initialQuality||1,p=e.fileType||t.type,ym(f,p,t.name,t.lastModified,h).then((function(O){try{{let W=function(){if(o--&&(w>a||w>g)){let D,ge;return D=S?.95*M.width:M.width,ge=S?.95*M.height:M.height,[R,k]=Lg(D,ge),k.drawImage(M,0,0,D,ge),h*=p==="image/png"?.85:.95,ym(R,p,t.name,t.lastModified,h).then(function(me){try{return T=me,ao(M),M=R,w=T.size,_(Math.min(99,Math.floor((v-w)/(v-a)*100))),W}catch(F){return s(F)}},s)}return[1]},V=function(){return ao(M),ao(R),ao(u),ao(f),ao(l),_(100),r(T)};var A=W,j=V;if(m=O,C(),y=m.size>a,b=m.size>t.size,!y&&!b)return _(100),r(m);var $;return g=t.size,v=m.size,w=v,M=f,S=!e.alwaysKeepResolution&&y,($=(function(D){for(;D;){if(D.then)return void D.then($,s);try{if(D.pop){if(D.length)return D.pop()?V.call(this):D;D=W}else D=D.call(this)}catch(ge){return s(ge)}}}).bind(this))(W)}}catch(W){return s(W)}}).bind(this),s)}catch(O){return s(O)}}).bind(this),s)}catch(P){return s(P)}}).bind(this),s)}catch(I){return s(I)}}).bind(this),s)})}const B9=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let iy;function U9(t,e){return new Promise((n,r)=>{iy||(iy=function(o){const a=[];return typeof o=="function"?a.push(`(${o})()`):a.push(o),URL.createObjectURL(new Blob(a))}(B9));const s=new Worker(iy);s.addEventListener("message",function(o){if(e.signal&&e.signal.aborted)s.terminate();else if(o.data.progress===void 0){if(o.data.error)return r(new Error(o.data.error)),void s.terminate();n(o.data.file),s.terminate()}else e.onProgress(o.data.progress)}),s.addEventListener("error",r),e.signal&&e.signal.addEventListener("abort",()=>{r(e.signal.reason),s.terminate()}),s.postMessage({file:t,imageCompressionLibUrl:e.libURL,options:{...e,onProgress:void 0,signal:void 0}})})}function us(t,e){return new Promise(function(n,r){let s,i,o,a,l,u;if(s={...e},o=0,{onProgress:a}=s,s.maxSizeMB=s.maxSizeMB||Number.POSITIVE_INFINITY,l=typeof s.useWebWorker!="boolean"||s.useWebWorker,delete s.useWebWorker,s.onProgress=p=>{o=p,typeof a=="function"&&a(o)},!(t instanceof Blob||t instanceof F9))return r(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(t.type))return r(new Error("The file given is not an image"));if(u=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!l||typeof Worker!="function"||u)return N_(t,s).then((function(p){try{return i=p,h.call(this)}catch(m){return r(m)}}).bind(this),r);var d=(function(){try{return h.call(this)}catch(p){return r(p)}}).bind(this),f=function(p){try{return N_(t,s).then(function(m){try{return i=m,d()}catch(y){return r(y)}},r)}catch(m){return r(m)}};try{return s.libURL=s.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",U9(t,s).then(function(p){try{return i=p,d()}catch{return f()}},f)}catch{f()}function h(){try{i.name=t.name,i.lastModified=t.lastModified}catch{}try{s.preserveExif&&t.type==="image/jpeg"&&(!s.fileType||s.fileType&&s.fileType===t.type)&&(i=ND(t,i))}catch{}return n(i)}})}us.getDataUrlFromFile=DD,us.getFilefromDataUrl=fw,us.loadImage=AD,us.drawImageInCanvas=OD,us.drawFileInCanvas=gm,us.canvasToFile=ym,us.getExifOrientation=PD,us.handleMaxWidthOrHeight=LD,us.followExifOrientation=$D,us.cleanupCanvasMemory=ao,us.isAutoOrientationInBrowser=Yc,us.approximateBelowMaximumCanvasSizeOfBrowser=RD,us.copyExifWithoutOrientation=ND,us.getBrowserName=Dl,us.version="2.0.2";function Jr(t){this.content=t}Jr.prototype={constructor:Jr,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,s=r.find(t),i=r.content.slice();return s==-1?i.push(n||t,e):(i[s+1]=e,n&&(i[s]=n)),new Jr(i)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new Jr(n)},addToStart:function(t,e){return new Jr([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new Jr(n)},addBefore:function(t,e,n){var r=this.remove(e),s=r.content.slice(),i=r.find(t);return s.splice(i==-1?s.length:i,0,e,n),new Jr(s)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=Jr.from(t),t.size?new Jr(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Jr.from(t),t.size?new Jr(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Jr.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};Jr.from=function(t){if(t instanceof Jr)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new Jr(e)};function zD(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let s=t.child(r),i=e.child(r);if(s==i){n+=s.nodeSize;continue}if(!s.sameMarkup(i))return n;if(s.isText&&s.text!=i.text){for(let o=0;s.text[o]==i.text[o];o++)n++;return n}if(s.content.size||i.content.size){let o=zD(s.content,i.content,n+1);if(o!=null)return o}n+=s.nodeSize}}function FD(t,e,n,r){for(let s=t.childCount,i=e.childCount;;){if(s==0||i==0)return s==i?null:{a:n,b:r};let o=t.child(--s),a=e.child(--i),l=o.nodeSize;if(o==a){n-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let u=0,d=Math.min(o.text.length,a.text.length);for(;u<d&&o.text[o.text.length-u-1]==a.text[a.text.length-u-1];)u++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let u=FD(o.content,a.content,n-1,r-1);if(u)return u}n-=l,r-=l}}class jt{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,s=0,i){for(let o=0,a=0;a<n;o++){let l=this.content[o],u=a+l.nodeSize;if(u>e&&r(l,s+a,i||null,o)!==!1&&l.content.size){let d=a+1;l.nodesBetween(Math.max(0,e-d),Math.min(l.content.size,n-d),r,s+d)}a=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,s){let i="",o=!0;return this.nodesBetween(e,n,(a,l)=>{let u=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?s?typeof s=="function"?s(a):s:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&u||a.isTextblock)&&r&&(o?o=!1:i+=r),i+=u},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,s=this.content.slice(),i=0;for(n.isText&&n.sameMarkup(r)&&(s[s.length-1]=n.withText(n.text+r.text),i=1);i<e.content.length;i++)s.push(e.content[i]);return new jt(s,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],s=0;if(n>e)for(let i=0,o=0;o<n;i++){let a=this.content[i],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),r.push(a),s+=a.nodeSize),o=l}return new jt(r,s)}cutByIndex(e,n){return e==n?jt.empty:e==0&&n==this.content.length?this:new jt(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let s=this.content.slice(),i=this.size+n.nodeSize-r.nodeSize;return s[e]=n,new jt(s,i)}addToStart(e){return new jt([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new jt(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let s=this.content[n];e(s,r,n),r+=s.nodeSize}}findDiffStart(e,n=0){return zD(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return FD(this,e,n,r)}findIndex(e){if(e==0)return Ph(0,e);if(e==this.size)return Ph(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let s=this.child(n),i=r+s.nodeSize;if(i>=e)return i==e?Ph(n+1,i):Ph(n,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return jt.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new jt(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return jt.empty;let n,r=0;for(let s=0;s<e.length;s++){let i=e[s];r+=i.nodeSize,s&&i.isText&&e[s-1].sameMarkup(i)?(n||(n=e.slice(0,s)),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new jt(n||e,r)}static from(e){if(!e)return jt.empty;if(e instanceof jt)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new jt([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}jt.empty=new jt([],0);const oy={index:0,offset:0};function Ph(t,e){return oy.index=t,oy.offset=e,oy}function xm(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!xm(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!xm(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let Un=class D1{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let s=0;s<e.length;s++){let i=e[s];if(this.eq(i))return e;if(this.type.excludes(i.type))n||(n=e.slice(0,s));else{if(i.type.excludes(this.type))return e;!r&&i.type.rank>this.type.rank&&(n||(n=e.slice(0,s)),n.push(this),r=!0),n&&n.push(i)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&xm(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let s=r.create(n.attrs);return r.checkAttrs(s.attrs),s}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return D1.none;if(e instanceof D1)return[e];let n=e.slice();return n.sort((r,s)=>r.type.rank-s.type.rank),n}};Un.none=[];class bm extends Error{}class Kt{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=UD(this.content,e+this.openStart,n);return r&&new Kt(r,this.openStart,this.openEnd)}removeBetween(e,n){return new Kt(BD(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return Kt.empty;let r=n.openStart||0,s=n.openEnd||0;if(typeof r!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Kt(jt.fromJSON(e,n.content),r,s)}static maxOpen(e,n=!0){let r=0,s=0;for(let i=e.firstChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.firstChild)r++;for(let i=e.lastChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.lastChild)s++;return new Kt(e,r,s)}}Kt.empty=new Kt(jt.empty,0,0);function BD(t,e,n){let{index:r,offset:s}=t.findIndex(e),i=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(s==e||i.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,i.copy(BD(i.content,e-s-1,n-s-1)))}function UD(t,e,n,r){let{index:s,offset:i}=t.findIndex(e),o=t.maybeChild(s);if(i==e||o.isText)return r&&!r.canReplace(s,s,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=UD(o.content,e-i-1,n,o);return a&&t.replaceChild(s,o.copy(a))}function H9(t,e,n){if(n.openStart>t.depth)throw new bm("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new bm("Inconsistent open depths");return HD(t,e,n,0)}function HD(t,e,n,r){let s=t.index(r),i=t.node(r);if(s==e.index(r)&&r<t.depth-n.openStart){let o=HD(t,e,n,r+1);return i.copy(i.content.replaceChild(s,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,a=o.content;return Hl(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=V9(n,t);return Hl(i,WD(t,o,a,e,r))}else return Hl(i,vm(t,e,r))}function VD(t,e){if(!e.type.compatibleContent(t.type))throw new bm("Cannot join "+e.type.name+" onto "+t.type.name)}function A1(t,e,n){let r=t.node(n);return VD(r,e.node(n)),r}function Ul(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Ad(t,e,n,r){let s=(e||t).node(n),i=0,o=e?e.index(n):s.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(Ul(t.nodeAfter,r),i++));for(let a=i;a<o;a++)Ul(s.child(a),r);e&&e.depth==n&&e.textOffset&&Ul(e.nodeBefore,r)}function Hl(t,e){return t.type.checkContent(e),t.copy(e)}function WD(t,e,n,r,s){let i=t.depth>s&&A1(t,e,s+1),o=r.depth>s&&A1(n,r,s+1),a=[];return Ad(null,t,s,a),i&&o&&e.index(s)==n.index(s)?(VD(i,o),Ul(Hl(i,WD(t,e,n,r,s+1)),a)):(i&&Ul(Hl(i,vm(t,e,s+1)),a),Ad(e,n,s,a),o&&Ul(Hl(o,vm(n,r,s+1)),a)),Ad(r,null,s,a),new jt(a)}function vm(t,e,n){let r=[];if(Ad(null,t,n,r),t.depth>n){let s=A1(t,e,n+1);Ul(Hl(s,vm(t,e,n+1)),r)}return Ad(e,null,n,r),new jt(r)}function V9(t,e){let n=e.depth-t.openStart,s=e.node(n).copy(t.content);for(let i=n-1;i>=0;i--)s=e.node(i).copy(jt.from(s));return{start:s.resolveNoCache(t.openStart+n),end:s.resolveNoCache(s.content.size-t.openEnd-n)}}class Ef{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],s=e.child(n);return r?e.child(n).cut(r):s}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],s=n==0?0:this.path[n*3-1]+1;for(let i=0;i<e;i++)s+=r.child(i).nodeSize;return s}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return Un.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),s=e.maybeChild(n);if(!r){let a=r;r=s,s=a}let i=r.marks;for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!s||!i[o].isInSet(s.marks))&&(i=i[o--].removeFromSet(i));return i}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,s=e.parent.maybeChild(e.index());for(var i=0;i<r.length;i++)r[i].type.spec.inclusive===!1&&(!s||!r[i].isInSet(s.marks))&&(r=r[i--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new wm(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],s=0,i=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(i),u=i-l;if(r.push(o,a,s+l),!u||(o=o.child(a),o.isText))break;i=u-1,s+=l+1}return new Ef(n,r,i)}static resolveCached(e,n){let r=j_.get(e);if(r)for(let i=0;i<r.elts.length;i++){let o=r.elts[i];if(o.pos==n)return o}else j_.set(e,r=new W9);let s=r.elts[r.i]=Ef.resolve(e,n);return r.i=(r.i+1)%K9,s}}class W9{constructor(){this.elts=[],this.i=0}}const K9=12,j_=new WeakMap;class wm{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const G9=Object.create(null);let Uo=class R1{constructor(e,n,r,s=Un.none){this.type=e,this.attrs=n,this.marks=s,this.content=r||jt.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,s=0){this.content.nodesBetween(e,n,r,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,s){return this.content.textBetween(e,n,r,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&xm(this.attrs,n||e.defaultAttrs||G9)&&Un.sameSet(this.marks,r||Un.none)}copy(e=null){return e==this.content?this:new R1(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new R1(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return Kt.empty;let s=this.resolve(e),i=this.resolve(n),o=r?0:s.sharedDepth(n),a=s.start(o),u=s.node(o).content.cut(s.pos-a,i.pos-a);return new Kt(u,s.depth-o,i.depth-o)}replace(e,n,r){return H9(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:s}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(s==e||n.isText)return n;e-=s+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let s=this.content.child(n-1);return{node:s,index:n-1,offset:r-s.nodeSize}}resolve(e){return Ef.resolveCached(this,e)}resolveNoCache(e){return Ef.resolve(this,e)}rangeHasMark(e,n,r){let s=!1;return n>e&&this.nodesBetween(e,n,i=>(r.isInSet(i.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),KD(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=jt.empty,s=0,i=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,s,i),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=s;l<i;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,s){if(s&&!this.type.allowsMarks(s))return!1;let i=this.contentMatchAt(e).matchType(r),o=i&&i.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Un.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!Un.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let s=jt.fromJSON(e,n.content),i=e.nodeType(n.type).create(n.attrs,s,r);return i.type.checkAttrs(i.attrs),i}};Uo.prototype.text=void 0;class km extends Uo{constructor(e,n,r,s){if(super(e,n,null,s),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):KD(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new km(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new km(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function KD(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class Ql{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new q9(e,n);if(r.next==null)return Ql.empty;let s=GD(r);r.next&&r.err("Unexpected trailing text");let i=tH(eH(s));return nH(i,r),i}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let s=this;for(let i=n;s&&i<r;i++)s=s.matchType(e.child(i).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let s=[this];function i(o,a){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return jt.from(a.map(u=>u.createAndFill()));for(let u=0;u<o.next.length;u++){let{type:d,next:f}=o.next[u];if(!(d.isText||d.hasRequiredAttrs())&&s.indexOf(f)==-1){s.push(f);let h=i(f,a.concat(d));if(h)return h}}return null}return i(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let s=r.shift(),i=s.match;if(i.matchType(e)){let o=[];for(let a=s;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<i.next.length;o++){let{type:a,next:l}=i.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!s.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:s}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let s=0;s<r.next.length;s++)e.indexOf(r.next[s].next)==-1&&n(r.next[s].next)}return n(this),e.map((r,s)=>{let i=s+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)i+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return i}).join(`
`)}}Ql.empty=new Ql(!0);class q9{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function GD(t){let e=[];do e.push(Y9(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function Y9(t){let e=[];do e.push(J9(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function J9(t){let e=Z9(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=X9(t,e);else break;return e}function I_(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function X9(t,e){let n=I_(t),r=n;return t.eat(",")&&(t.next!="}"?r=I_(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function Q9(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let s=[];for(let i in n){let o=n[i];o.isInGroup(e)&&s.push(o)}return s.length==0&&t.err("No node type or group '"+e+"' found"),s}function Z9(t){if(t.eat("(")){let e=GD(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=Q9(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function eH(t){let e=[[]];return s(i(t,0),n()),e;function n(){return e.push([])-1}function r(o,a,l){let u={term:l,to:a};return e[o].push(u),u}function s(o,a){o.forEach(l=>l.to=a)}function i(o,a){if(o.type=="choice")return o.exprs.reduce((l,u)=>l.concat(i(u,a)),[]);if(o.type=="seq")for(let l=0;;l++){let u=i(o.exprs[l],a);if(l==o.exprs.length-1)return u;s(u,a=n())}else if(o.type=="star"){let l=n();return r(a,l),s(i(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return s(i(o.expr,a),l),s(i(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(i(o.expr,a));if(o.type=="range"){let l=a;for(let u=0;u<o.min;u++){let d=n();s(i(o.expr,l),d),l=d}if(o.max==-1)s(i(o.expr,l),l);else for(let u=o.min;u<o.max;u++){let d=n();r(l,d),s(i(o.expr,l),d),l=d}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function qD(t,e){return e-t}function M_(t,e){let n=[];return r(e),n.sort(qD);function r(s){let i=t[s];if(i.length==1&&!i[0].term)return r(i[0].to);n.push(s);for(let o=0;o<i.length;o++){let{term:a,to:l}=i[o];!a&&n.indexOf(l)==-1&&r(l)}}}function tH(t){let e=Object.create(null);return n(M_(t,0));function n(r){let s=[];r.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let u;for(let d=0;d<s.length;d++)s[d][0]==a&&(u=s[d][1]);M_(t,l).forEach(d=>{u||s.push([a,u=[]]),u.indexOf(d)==-1&&u.push(d)})})});let i=e[r.join(",")]=new Ql(r.indexOf(t.length-1)>-1);for(let o=0;o<s.length;o++){let a=s[o][1].sort(qD);i.next.push({type:s[o][0],next:e[a.join(",")]||n(a)})}return i}}function nH(t,e){for(let n=0,r=[t];n<r.length;n++){let s=r[n],i=!s.validEnd,o=[];for(let a=0;a<s.next.length;a++){let{type:l,next:u}=s.next[a];o.push(l.name),i&&!(l.isText||l.hasRequiredAttrs())&&(i=!1),r.indexOf(u)==-1&&r.push(u)}i&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function YD(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function JD(t,e){let n=Object.create(null);for(let r in t){let s=e&&e[r];if(s===void 0){let i=t[r];if(i.hasDefault)s=i.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=s}return n}function XD(t,e,n,r){for(let s in e)if(!(s in t))throw new RangeError(`Unsupported attribute ${s} for ${n} of type ${s}`);for(let s in t){let i=t[s];i.validate&&i.validate(e[s])}}function QD(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new sH(t,r,e[r]);return n}let D_=class ZD{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=QD(e,r.attrs),this.defaultAttrs=YD(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Ql.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:JD(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Uo(this,this.computeAttrs(e),jt.from(n),Un.setFrom(r))}createChecked(e=null,n,r){return n=jt.from(n),this.checkContent(n),new Uo(this,this.computeAttrs(e),n,Un.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=jt.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let s=this.contentMatch.matchFragment(n),i=s&&s.fillBefore(jt.empty,!0);return i?new Uo(this,e,n.append(i),Un.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){XD(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:Un.none:e}static compile(e,n){let r=Object.create(null);e.forEach((i,o)=>r[i]=new ZD(i,n,o));let s=n.spec.topNode||"doc";if(!r[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function rH(t,e,n){let r=n.split("|");return s=>{let i=s===null?"null":typeof s;if(r.indexOf(i)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${i}`)}}class sH{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?rH(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class $g{constructor(e,n,r,s){this.name=e,this.rank=n,this.schema=r,this.spec=s,this.attrs=QD(e,s.attrs),this.excluded=null;let i=YD(this.attrs);this.instance=i?new Un(this,i):null}create(e=null){return!e&&this.instance?this.instance:new Un(this,JD(this.attrs,e))}static compile(e,n){let r=Object.create(null),s=0;return e.forEach((i,o)=>r[i]=new $g(i,s++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){XD(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}let eA=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let s in e)n[s]=e[s];n.nodes=Jr.from(e.nodes),n.marks=Jr.from(e.marks||{}),this.nodes=D_.compile(this.spec.nodes,this),this.marks=$g.compile(this.spec.marks,this);let r=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let i=this.nodes[s],o=i.spec.content||"",a=i.spec.marks;if(i.contentMatch=r[o]||(r[o]=Ql.parse(o,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=a=="_"?null:a?A_(this,a.split(" ")):a==""||!i.inlineContent?[]:null}for(let s in this.marks){let i=this.marks[s],o=i.spec.excludes;i.excluded=o==null?[i]:o==""?[]:A_(this,o.split(" "))}this.nodeFromJSON=s=>Uo.fromJSON(this,s),this.markFromJSON=s=>Un.fromJSON(this,s),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,s){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof D_){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,s)}text(e,n){let r=this.nodes.text;return new km(r,r.defaultAttrs,e,Un.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}};function A_(t,e){let n=[];for(let r=0;r<e.length;r++){let s=e[r],i=t.marks[s],o=i;if(i)n.push(i);else for(let a in t.marks){let l=t.marks[a];(s=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(s)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function iH(t){return t.tag!=null}function oH(t){return t.style!=null}class $a{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(s=>{if(iH(s))this.tags.push(s);else if(oH(s)){let i=/[^=]*/.exec(s.style)[0];r.indexOf(i)<0&&r.push(i),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let i=e.nodes[s.node];return i.contentMatch.matchType(i)})}parse(e,n={}){let r=new O_(this,n,!1);return r.addAll(e,Un.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new O_(this,n,!0);return r.addAll(e,Un.none,n.from,n.to),Kt.maxOpen(r.finish())}matchTag(e,n,r){for(let s=r?this.tags.indexOf(r)+1:0;s<this.tags.length;s++){let i=this.tags[s];if(cH(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||n.matchesContext(i.context))){if(i.getAttrs){let o=i.getAttrs(e);if(o===!1)continue;i.attrs=o||void 0}return i}}}matchStyle(e,n,r,s){for(let i=s?this.styles.indexOf(s)+1:0;i<this.styles.length;i++){let o=this.styles[i],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(s){let i=s.priority==null?50:s.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<i)break}n.splice(o,0,s)}for(let s in e.marks){let i=e.marks[s].spec.parseDOM;i&&i.forEach(o=>{r(o=P_(o)),o.mark||o.ignore||o.clearMark||(o.mark=s)})}for(let s in e.nodes){let i=e.nodes[s].spec.parseDOM;i&&i.forEach(o=>{r(o=P_(o)),o.node||o.ignore||o.mark||(o.node=s)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new $a(e,$a.schemaRules(e)))}}const tA={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},aH={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},nA={ol:!0,ul:!0},Nf=1,O1=2,Rd=4;function R_(t,e,n){return e!=null?(e?Nf:0)|(e==="full"?O1:0):t&&t.whitespace=="pre"?Nf|O1:n&~Rd}class Lh{constructor(e,n,r,s,i,o){this.type=e,this.attrs=n,this.marks=r,this.solid=s,this.options=o,this.content=[],this.activeMarks=Un.none,this.match=i||(o&Rd?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(jt.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,s;return(s=r.findWrapping(e.type))?(this.match=r,s):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Nf)){let r=this.content[this.content.length-1],s;if(r&&r.isText&&(s=/[ \t\r\n\u000c]+$/.exec(r.text))){let i=r;r.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-s[0].length))}}let n=jt.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(jt.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!tA.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class O_{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let s=n.topNode,i,o=R_(null,n.preserveWhitespace,0)|(r?Rd:0);s?i=new Lh(s.type,s.attrs,Un.none,!0,n.topMatch||s.type.contentMatch,o):r?i=new Lh(null,null,Un.none,!0,null,o):i=new Lh(e.schema.topNodeType,null,Un.none,!0,null,o),this.nodes=[i],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,s=this.top,i=s.options&O1?"full":this.localPreserveWS||(s.options&Nf)>0,{schema:o}=this.parser;if(i==="full"||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(i)if(i==="full")r=r.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=r.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),n,!0),a[l]&&this.insertNode(o.text(a[l]),n,!/\S/.test(a[l]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let a=s.content[s.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(o.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let s=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;nA.hasOwnProperty(o)&&this.parser.normalizeLists&&lH(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:aH.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let u,d=this.needsBlock;if(tA.hasOwnProperty(o))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),u=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let f=l&&l.skip?n:this.readStyles(e,n);f&&this.addAll(e,f),u&&this.sync(i),this.needsBlock=d}else{let u=this.readStyles(e,n);u&&this.addElementByRule(e,l,u,l.consuming===!1?a:void 0)}this.localPreserveWS=s}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let i=this.parser.matchedStyles[s],o=r.getPropertyValue(i);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(i,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(u=>!l.clearMark(u)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,s){let i,o;if(n.node)if(o=this.parser.schema.nodes[n.node],o.isLeaf)this.insertNode(o.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,n.attrs||null,r,n.preserveWhitespace);l&&(i=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(s)this.addElement(e,r,s);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}i&&this.sync(a)&&this.open--}addAll(e,n,r,s){let i=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=s==null?null:e.childNodes[s];o!=a;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o,n);this.findAtPoint(e,i)}findPlace(e,n,r){let s,i;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],u=l.findWrapping(e);if(u&&(!s||s.length>u.length+a)&&(s=u,i=l,!u.length))break;if(l.solid){if(r)break;a+=2}}if(!s)return null;this.sync(i);for(let o=0;o<s.length;o++)n=this.enterInner(s[o],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(n=this.enterInner(i,null,n))}let s=this.findPlace(e,n,r);if(s){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let o=Un.none;for(let a of s.concat(e.marks))(i.type?i.type.allowsMarkType(a.type):L_(a.type,e.type))&&(o=a.addToSet(o));return i.content.push(e.mark(o)),!0}return!1}enter(e,n,r,s){let i=this.findPlace(e.create(n),r,!1);return i&&(i=this.enterInner(e,n,r,!0,s)),i}enterInner(e,n,r,s=!1,i){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=R_(e,i,o.options);o.options&Rd&&o.content.length==0&&(a|=Rd);let l=Un.none;return r=r.filter(u=>(o.type?o.type.allowsMarkType(u.type):L_(u.type,e))?(l=u.addToSet(l),!1):!0),this.nodes.push(new Lh(e,n,l,s,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=Nf)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let s=r.length-1;s>=0;s--)e+=r[s].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&e.nodeType==1&&e.contains(this.find[s].node)&&n.compareDocumentPosition(this.find[s].node)&(r?2:4)&&(this.find[s].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,s=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(s?0:1),o=(a,l)=>{for(;a>=0;a--){let u=n[a];if(u==""){if(a==n.length-1||a==0)continue;for(;l>=i;l--)if(o(a-1,l))return!0;return!1}else{let d=l>0||l==0&&s?this.nodes[l].type:r&&l>=i?r.node(l-i).type:null;if(!d||d.name!=u&&!d.isInGroup(u))return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function lH(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&nA.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function cH(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function P_(t){let e={};for(let n in t)e[n]=t[n];return e}function L_(t,e){let n=e.schema.nodes;for(let r in n){let s=n[r];if(!s.allowsMarkType(t))continue;let i=[],o=a=>{i.push(a);for(let l=0;l<a.edgeCount;l++){let{type:u,next:d}=a.edge(l);if(u==e||i.indexOf(d)<0&&o(d))return!0}};if(o(s.contentMatch))return!0}}class oc{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=ay(n).createDocumentFragment());let s=r,i=[];return e.forEach(o=>{if(i.length||o.marks.length){let a=0,l=0;for(;a<i.length&&l<o.marks.length;){let u=o.marks[l];if(!this.marks[u.type.name]){l++;continue}if(!u.eq(i[a][0])||u.type.spec.spanning===!1)break;a++,l++}for(;a<i.length;)s=i.pop()[1];for(;l<o.marks.length;){let u=o.marks[l++],d=this.serializeMark(u,o.isInline,n);d&&(i.push([u,s]),s.appendChild(d.dom),s=d.contentDOM||d.dom)}}s.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:s}=Sp(ay(n),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,s)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let s=e.marks.length-1;s>=0;s--){let i=this.serializeMark(e.marks[s],e.isInline,n);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(e,n,r={}){let s=this.marks[e.type.name];return s&&Sp(ay(r),s(e,n),null,e.attrs)}static renderSpec(e,n,r=null,s){return Sp(e,n,r,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new oc(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=$_(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return $_(e.marks)}}function $_(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function ay(t){return t.document||window.document}const z_=new WeakMap;function uH(t){let e=z_.get(t);return e===void 0&&z_.set(t,e=dH(t)),e}function dH(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let s=0;s<r.length;s++)n(r[s]);else for(let s in r)n(r[s])}return n(t),e}function Sp(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let s=e[0],i;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(i=uH(r))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=s.indexOf(" ");o>0&&(n=s.slice(0,o),s=s.slice(o+1));let a,l=n?t.createElementNS(n,s):t.createElement(s),u=e[1],d=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){d=2;for(let f in u)if(u[f]!=null){let h=f.indexOf(" ");h>0?l.setAttributeNS(f.slice(0,h),f.slice(h+1),u[f]):f=="style"&&l.style?l.style.cssText=u[f]:l.setAttribute(f,u[f])}}for(let f=d;f<e.length;f++){let h=e[f];if(h===0){if(f<e.length-1||f>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:p,contentDOM:m}=Sp(t,h,n,r);if(l.appendChild(p),m){if(a)throw new RangeError("Multiple content holes");a=m}}}return{dom:l,contentDOM:a}}const rA=65535,sA=Math.pow(2,16);function fH(t,e){return t+e*sA}function F_(t){return t&rA}function hH(t){return(t-(t&rA))/sA}const iA=1,oA=2,_p=4,aA=8;class P1{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&aA)>0}get deletedBefore(){return(this.delInfo&(iA|_p))>0}get deletedAfter(){return(this.delInfo&(oA|_p))>0}get deletedAcross(){return(this.delInfo&_p)>0}}class ei{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&ei.empty)return ei.empty}recover(e){let n=0,r=F_(e);if(!this.inverted)for(let s=0;s<r;s++)n+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[r*3]+n+hH(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let s=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?s:0);if(l>e)break;let u=this.ranges[a+i],d=this.ranges[a+o],f=l+u;if(e<=f){let h=u?e==l?-1:e==f?1:n:n,p=l+s+(h<0?0:d);if(r)return p;let m=e==(n<0?l:f)?null:fH(a/3,e-l),y=e==l?oA:e==f?iA:_p;return(n<0?e!=l:e!=f)&&(y|=aA),new P1(p,y,m)}s+=d-u}return r?e+s:new P1(e+s,0,null)}touches(e,n){let r=0,s=F_(n),i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let u=this.ranges[a+i],d=l+u;if(e<=d&&a==s*3)return!0;r+=this.ranges[a+o]-u}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let s=0,i=0;s<this.ranges.length;s+=3){let o=this.ranges[s],a=o-(this.inverted?i:0),l=o+(this.inverted?0:i),u=this.ranges[s+n],d=this.ranges[s+r];e(a,a+u,l,l+d),i+=d-u}}invert(){return new ei(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?ei.empty:new ei(e<0?[0,-e,0]:[0,0,e])}}ei.empty=new ei([]);class jf{constructor(e,n,r=0,s=e?e.length:0){this.mirror=n,this.from=r,this.to=s,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new jf(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let s=e.getMirror(n);this.appendMap(e._maps[n],s!=null&&s<n?r+s:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let s=e.getMirror(n);this.appendMap(e._maps[n].invert(),s!=null&&s>n?r-s-1:void 0)}}invert(){let e=new jf;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let s=0;for(let i=this.from;i<this.to;i++){let o=this._maps[i],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(i);if(l!=null&&l>i&&l<this.to){i=l,e=this._maps[l].recover(a.recover);continue}}s|=a.delInfo,e=a.pos}return r?e:new P1(e,s,null)}}const ly=Object.create(null);class ys{getMap(){return ei.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=ly[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in ly)throw new RangeError("Duplicate use of step JSON ID "+e);return ly[e]=n,n.prototype.jsonID=e,n}}class Nr{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new Nr(e,null)}static fail(e){return new Nr(null,e)}static fromReplace(e,n,r,s){try{return Nr.ok(e.replace(n,r,s))}catch(i){if(i instanceof bm)return Nr.fail(i.message);throw i}}}function hw(t,e,n){let r=[];for(let s=0;s<t.childCount;s++){let i=t.child(s);i.content.size&&(i=i.copy(hw(i.content,e,i))),i.isInline&&(i=e(i,n,s)),r.push(i)}return jt.fromArray(r)}class Ca extends ys{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),s=r.node(r.sharedDepth(this.to)),i=new Kt(hw(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),s),n.openStart,n.openEnd);return Nr.fromReplace(e,this.from,this.to,i)}invert(){return new po(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Ca(n.pos,r.pos,this.mark)}merge(e){return e instanceof Ca&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ca(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Ca(n.from,n.to,e.markFromJSON(n.mark))}}ys.jsonID("addMark",Ca);class po extends ys{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new Kt(hw(n.content,s=>s.mark(this.mark.removeFromSet(s.marks)),e),n.openStart,n.openEnd);return Nr.fromReplace(e,this.from,this.to,r)}invert(){return new Ca(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new po(n.pos,r.pos,this.mark)}merge(e){return e instanceof po&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new po(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new po(n.from,n.to,e.markFromJSON(n.mark))}}ys.jsonID("removeMark",po);class Ea extends ys{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return Nr.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return Nr.fromReplace(e,this.pos,this.pos+1,new Kt(jt.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let s=0;s<n.marks.length;s++)if(!n.marks[s].isInSet(r))return new Ea(this.pos,n.marks[s]);return new Ea(this.pos,this.mark)}}return new Zl(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Ea(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Ea(n.pos,e.markFromJSON(n.mark))}}ys.jsonID("addNodeMark",Ea);class Zl extends ys{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return Nr.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return Nr.fromReplace(e,this.pos,this.pos+1,new Kt(jt.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new Ea(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Zl(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Zl(n.pos,e.markFromJSON(n.mark))}}ys.jsonID("removeNodeMark",Zl);class zr extends ys{constructor(e,n,r,s=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=s}apply(e){return this.structure&&L1(e,this.from,this.to)?Nr.fail("Structure replace would overwrite content"):Nr.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new ei([this.from,this.to-this.from,this.slice.size])}invert(e){return new zr(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new zr(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof zr)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?Kt.empty:new Kt(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new zr(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?Kt.empty:new Kt(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new zr(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new zr(n.from,n.to,Kt.fromJSON(e,n.slice),!!n.structure)}}ys.jsonID("replace",zr);class Ur extends ys{constructor(e,n,r,s,i,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=s,this.slice=i,this.insert=o,this.structure=a}apply(e){if(this.structure&&(L1(e,this.from,this.gapFrom)||L1(e,this.gapTo,this.to)))return Nr.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return Nr.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?Nr.fromReplace(e,this.from,this.to,r):Nr.fail("Content does not fit in gap")}getMap(){return new ei([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new Ur(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),s=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||s<n.pos||i>r.pos?null:new Ur(n.pos,r.pos,s,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Ur(n.from,n.to,n.gapFrom,n.gapTo,Kt.fromJSON(e,n.slice),n.insert,!!n.structure)}}ys.jsonID("replaceAround",Ur);function L1(t,e,n){let r=t.resolve(e),s=n-e,i=r.depth;for(;s>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,s--;if(s>0){let o=r.node(i).maybeChild(r.indexAfter(i));for(;s>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,s--}}return!1}function pH(t,e,n,r){let s=[],i=[],o,a;t.doc.nodesBetween(e,n,(l,u,d)=>{if(!l.isInline)return;let f=l.marks;if(!r.isInSet(f)&&d.type.allowsMarkType(r.type)){let h=Math.max(u,e),p=Math.min(u+l.nodeSize,n),m=r.addToSet(f);for(let y=0;y<f.length;y++)f[y].isInSet(m)||(o&&o.to==h&&o.mark.eq(f[y])?o.to=p:s.push(o=new po(h,p,f[y])));a&&a.to==h?a.to=p:i.push(a=new Ca(h,p,r))}}),s.forEach(l=>t.step(l)),i.forEach(l=>t.step(l))}function mH(t,e,n,r){let s=[],i=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;i++;let l=null;if(r instanceof $g){let u=o.marks,d;for(;d=r.isInSet(u);)(l||(l=[])).push(d),u=d.removeFromSet(u)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let u=Math.min(a+o.nodeSize,n);for(let d=0;d<l.length;d++){let f=l[d],h;for(let p=0;p<s.length;p++){let m=s[p];m.step==i-1&&f.eq(s[p].style)&&(h=m)}h?(h.to=u,h.step=i):s.push({style:f,from:Math.max(a,e),to:u,step:i})}}}),s.forEach(o=>t.step(new po(o.from,o.to,o.style)))}function pw(t,e,n,r=n.contentMatch,s=!0){let i=t.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<i.childCount;l++){let u=i.child(l),d=a+u.nodeSize,f=r.matchType(u.type);if(!f)o.push(new zr(a,d,Kt.empty));else{r=f;for(let h=0;h<u.marks.length;h++)n.allowsMarkType(u.marks[h].type)||t.step(new po(a,d,u.marks[h]));if(s&&u.isText&&n.whitespace!="pre"){let h,p=/\r?\n|\r/g,m;for(;h=p.exec(u.text);)m||(m=new Kt(jt.from(n.schema.text(" ",n.allowedMarks(u.marks))),0,0)),o.push(new zr(a+h.index,a+h.index+h[0].length,m))}}a=d}if(!r.validEnd){let l=r.fillBefore(jt.empty,!0);t.replace(a,a,new Kt(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function gH(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function zu(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth,s=0,i=0;;--r){let o=t.$from.node(r),a=t.$from.index(r)+s,l=t.$to.indexAfter(r)-i;if(r<t.depth&&o.canReplace(a,l,n))return r;if(r==0||o.type.spec.isolating||!gH(o,a,l))break;a&&(s=1),l<o.childCount&&(i=1)}return null}function yH(t,e,n){let{$from:r,$to:s,depth:i}=e,o=r.before(i+1),a=s.after(i+1),l=o,u=a,d=jt.empty,f=0;for(let m=i,y=!1;m>n;m--)y||r.index(m)>0?(y=!0,d=jt.from(r.node(m).copy(d)),f++):l--;let h=jt.empty,p=0;for(let m=i,y=!1;m>n;m--)y||s.after(m+1)<s.end(m)?(y=!0,h=jt.from(s.node(m).copy(h)),p++):u++;t.step(new Ur(l,u,o,a,new Kt(d.append(h),f,p),d.size-f,!0))}function mw(t,e,n=null,r=t){let s=xH(t,e),i=s&&bH(r,e);return i?s.map(B_).concat({type:e,attrs:n}).concat(i.map(B_)):null}function B_(t){return{type:t,attrs:null}}function xH(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.contentMatchAt(r).findWrapping(e);if(!i)return null;let o=i.length?i[0]:e;return n.canReplaceWith(r,s,o)?i:null}function bH(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.child(r),o=e.contentMatch.findWrapping(i.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let u=r;l&&u<s;u++)l=l.matchType(n.child(u).type);return!l||!l.validEnd?null:o}function vH(t,e,n){let r=jt.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let a=n[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=jt.from(n[o].type.create(n[o].attrs,r))}let s=e.start,i=e.end;t.step(new Ur(s,i,s,i,new Kt(r,0,0),n.length,!0))}function wH(t,e,n,r,s){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{let l=typeof s=="function"?s(o):s;if(o.isTextblock&&!o.hasMarkup(r,l)&&kH(t.doc,t.mapping.slice(i).map(a),r)){let u=null;if(r.schema.linebreakReplacement){let p=r.whitespace=="pre",m=!!r.contentMatch.matchType(r.schema.linebreakReplacement);p&&!m?u=!1:!p&&m&&(u=!0)}u===!1&&cA(t,o,a,i),pw(t,t.mapping.slice(i).map(a,1),r,void 0,u===null);let d=t.mapping.slice(i),f=d.map(a,1),h=d.map(a+o.nodeSize,1);return t.step(new Ur(f,h,f+1,h-1,new Kt(jt.from(r.create(l,null,o.marks)),0,0),1,!0)),u===!0&&lA(t,o,a,i),!1}})}function lA(t,e,n,r){e.forEach((s,i)=>{if(s.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(s.text);){let l=t.mapping.slice(r).map(n+1+i+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function cA(t,e,n,r){e.forEach((s,i)=>{if(s.type==s.type.schema.linebreakReplacement){let o=t.mapping.slice(r).map(n+1+i);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function kH(t,e,n){let r=t.resolve(e),s=r.index();return r.parent.canReplaceWith(s,s+1,n)}function SH(t,e,n,r,s){let i=t.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let o=n.create(r,null,s||i.marks);if(i.isLeaf)return t.replaceWith(e,e+i.nodeSize,o);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new Ur(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new Kt(jt.from(o),0,0),1,!0))}function lu(t,e,n=1,r){let s=t.resolve(e),i=s.depth-n,o=r&&r[r.length-1]||s.parent;if(i<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!o.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let u=s.depth-1,d=n-2;u>i;u--,d--){let f=s.node(u),h=s.index(u);if(f.type.spec.isolating)return!1;let p=f.content.cutByIndex(h,f.childCount),m=r&&r[d+1];m&&(p=p.replaceChild(0,m.type.create(m.attrs)));let y=r&&r[d]||f;if(!f.canReplace(h+1,f.childCount)||!y.type.validContent(p))return!1}let a=s.indexAfter(i),l=r&&r[0];return s.node(i).canReplaceWith(a,a,l?l.type:s.node(i+1).type)}function _H(t,e,n=1,r){let s=t.doc.resolve(e),i=jt.empty,o=jt.empty;for(let a=s.depth,l=s.depth-n,u=n-1;a>l;a--,u--){i=jt.from(s.node(a).copy(i));let d=r&&r[u];o=jt.from(d?d.type.create(d.attrs,o):s.node(a).copy(o))}t.step(new zr(e,e,new Kt(i.append(o),n,n),!0))}function tl(t,e){let n=t.resolve(e),r=n.index();return uA(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function TH(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let s=0;s<e.childCount;s++){let i=e.child(s),o=i.type==r?t.type.schema.nodes.text:i.type;if(n=n.matchType(o),!n||!t.type.allowsMarks(i.marks))return!1}return n.validEnd}function uA(t,e){return!!(t&&e&&!t.isLeaf&&TH(t,e))}function zg(t,e,n=-1){let r=t.resolve(e);for(let s=r.depth;;s--){let i,o,a=r.index(s);if(s==r.depth?(i=r.nodeBefore,o=r.nodeAfter):n>0?(i=r.node(s+1),a++,o=r.node(s).maybeChild(a)):(i=r.node(s).maybeChild(a-1),o=r.node(s+1)),i&&!i.isTextblock&&uA(i,o)&&r.node(s).canReplace(a,a+1))return e;if(s==0)break;e=n<0?r.before(s):r.after(s)}}function CH(t,e,n){let r=null,{linebreakReplacement:s}=t.doc.type.schema,i=t.doc.resolve(e-n),o=i.node().type;if(s&&o.inlineContent){let d=o.whitespace=="pre",f=!!o.contentMatch.matchType(s);d&&!f?r=!1:!d&&f&&(r=!0)}let a=t.steps.length;if(r===!1){let d=t.doc.resolve(e+n);cA(t,d.node(),d.before(),a)}o.inlineContent&&pw(t,e+n-1,o,i.node().contentMatchAt(i.index()),r==null);let l=t.mapping.slice(a),u=l.map(e-n);if(t.step(new zr(u,l.map(e+n,-1),Kt.empty,!0)),r===!0){let d=t.doc.resolve(u);lA(t,d.node(),d.before(),t.steps.length)}return t}function EH(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let s=r.depth-1;s>=0;s--){let i=r.index(s);if(r.node(s).canReplaceWith(i,i,n))return r.before(s+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(let s=r.depth-1;s>=0;s--){let i=r.indexAfter(s);if(r.node(s).canReplaceWith(i,i,n))return r.after(s+1);if(i<r.node(s).childCount)return null}return null}function dA(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let s=n.content;for(let i=0;i<n.openStart;i++)s=s.firstChild.content;for(let i=1;i<=(n.openStart==0&&n.size?2:1);i++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),u=r.node(o),d=!1;if(i==1)d=u.canReplace(l,l,s);else{let f=u.contentMatchAt(l).findWrapping(s.firstChild.type);d=f&&u.canReplaceWith(l,l,f[0])}if(d)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function Fg(t,e,n=e,r=Kt.empty){if(e==n&&!r.size)return null;let s=t.resolve(e),i=t.resolve(n);return fA(s,i,r)?new zr(e,n,r):new NH(s,i,r).fit()}function fA(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class NH{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=jt.empty;for(let s=0;s<=e.depth;s++){let i=e.node(s);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=jt.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,s=this.close(e<0?this.$to:r.doc.resolve(e));if(!s)return null;let i=this.placed,o=r.depth,a=s.depth;for(;o&&a&&i.childCount==1;)i=i.firstChild.content,o--,a--;let l=new Kt(i,o,a);return e>-1?new Ur(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new zr(r.pos,s.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,s=this.unplaced.openEnd;r<e;r++){let i=n.firstChild;if(n.childCount>1&&(s=0),i.type.spec.isolating&&s<=r){e=r;break}n=i.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let s,i=null;r?(i=cy(this.unplaced.content,r-1).firstChild,s=i.content):s=this.unplaced.content;let o=s.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:u}=this.frontier[a],d,f=null;if(n==1&&(o?u.matchType(o.type)||(f=u.fillBefore(jt.from(o),!1)):i&&l.compatibleContent(i.type)))return{sliceDepth:r,frontierDepth:a,parent:i,inject:f};if(n==2&&o&&(d=u.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:i,wrap:d};if(i&&u.matchType(i.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=cy(e,n);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new Kt(e,n+1,Math.max(r,s.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=cy(e,n);if(s.childCount<=1&&n>0){let i=e.size-n<=n+s.size;this.unplaced=new Kt(pd(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new Kt(pd(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:s,wrap:i}){for(;this.depth>n;)this.closeFrontierNode();if(i)for(let y=0;y<i.length;y++)this.openFrontierNode(i[y]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,u=0,d=[],{match:f,type:h}=this.frontier[n];if(s){for(let y=0;y<s.childCount;y++)d.push(s.child(y));f=f.matchFragment(s)}let p=a.size+e-(o.content.size-o.openEnd);for(;u<a.childCount;){let y=a.child(u),b=f.matchType(y.type);if(!b)break;u++,(u>1||l==0||y.content.size)&&(f=b,d.push(hA(y.mark(h.allowedMarks(y.marks)),u==1?l:0,u==a.childCount?p:-1)))}let m=u==a.childCount;m||(p=-1),this.placed=md(this.placed,n,jt.from(d)),this.frontier[n].match=f,m&&p<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let y=0,b=a;y<p;y++){let g=b.lastChild;this.frontier.push({type:g.type,match:g.contentMatchAt(g.childCount)}),b=g.content}this.unplaced=m?e==0?Kt.empty:new Kt(pd(o.content,e-1,1),e-1,p<0?o.openEnd:e-1):new Kt(pd(o.content,e,u),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!uy(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,s=this.$to.after(r);for(;r>1&&s==this.$to.end(--r);)++s;return s}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:s}=this.frontier[n],i=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=uy(e,n,s,r,i);if(o){for(let a=n-1;a>=0;a--){let{match:l,type:u}=this.frontier[a],d=uy(e,a,u,l,!0);if(!d||d.childCount)continue e}return{depth:n,fit:o,move:i?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=md(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let s=e.node(r),i=s.type.contentMatch.fillBefore(s.content,!0,e.index(r));this.openFrontierNode(s.type,s.attrs,i)}return e}openFrontierNode(e,n=null,r){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=md(this.placed,this.depth,jt.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(jt.empty,!0);n.childCount&&(this.placed=md(this.placed,this.frontier.length,n))}}function pd(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(pd(t.firstChild.content,e-1,n)))}function md(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(md(t.lastChild.content,e-1,n)))}function cy(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function hA(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,hA(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(jt.empty,!0)))),t.copy(r)}function uy(t,e,n,r,s){let i=t.node(e),o=s?t.indexAfter(e):t.index(e);if(o==i.childCount&&!n.compatibleContent(i.type))return null;let a=r.fillBefore(i.content,!0,o);return a&&!jH(n,i.content,o)?a:null}function jH(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function IH(t){return t.spec.defining||t.spec.definingForContent}function MH(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let s=t.doc.resolve(e),i=t.doc.resolve(n);if(fA(s,i,r))return t.step(new zr(e,n,r));let o=mA(s,i);o[o.length-1]==0&&o.pop();let a=-(s.depth+1);o.unshift(a);for(let h=s.depth,p=s.pos-1;h>0;h--,p--){let m=s.node(h).type.spec;if(m.defining||m.definingAsContext||m.isolating)break;o.indexOf(h)>-1?a=h:s.before(h)==p&&o.splice(1,0,-h)}let l=o.indexOf(a),u=[],d=r.openStart;for(let h=r.content,p=0;;p++){let m=h.firstChild;if(u.push(m),p==r.openStart)break;h=m.content}for(let h=d-1;h>=0;h--){let p=u[h],m=IH(p.type);if(m&&!p.sameMarkup(s.node(Math.abs(a)-1)))d=h;else if(m||!p.type.isTextblock)break}for(let h=r.openStart;h>=0;h--){let p=(h+d+1)%(r.openStart+1),m=u[p];if(m)for(let y=0;y<o.length;y++){let b=o[(y+l)%o.length],g=!0;b<0&&(g=!1,b=-b);let v=s.node(b-1),w=s.index(b-1);if(v.canReplaceWith(w,w,m.type,m.marks))return t.replace(s.before(b),g?i.after(b):n,new Kt(pA(r.content,0,r.openStart,p),p,r.openEnd))}}let f=t.steps.length;for(let h=o.length-1;h>=0&&(t.replace(e,n,r),!(t.steps.length>f));h--){let p=o[h];p<0||(e=s.before(p),n=i.after(p))}}function pA(t,e,n,r,s){if(e<n){let i=t.firstChild;t=t.replaceChild(0,i.copy(pA(i.content,e+1,n,r,i)))}if(e>r){let i=s.contentMatchAt(0),o=i.fillBefore(t).append(t);t=o.append(i.matchFragment(o).fillBefore(jt.empty,!0))}return t}function DH(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let s=EH(t.doc,e,r.type);s!=null&&(e=n=s)}t.replaceRange(e,n,new Kt(jt.from(r),0,0))}function AH(t,e,n){let r=t.doc.resolve(e),s=t.doc.resolve(n),i=mA(r,s);for(let o=0;o<i.length;o++){let a=i[o],l=o==i.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),s.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),s.indexAfter(a-1))))return t.delete(r.before(a),s.after(a))}for(let o=1;o<=r.depth&&o<=s.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&s.end(o)-n!=s.depth-o&&r.start(o-1)==s.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),s.index(o-1)))return t.delete(r.before(o),n);t.delete(e,n)}function mA(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let s=r;s>=0;s--){let i=t.start(s);if(i<t.pos-(t.depth-s)||e.end(s)>e.pos+(e.depth-s)||t.node(s).type.spec.isolating||e.node(s).type.spec.isolating)break;(i==e.start(s)||s==t.depth&&s==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&s&&e.start(s-1)==i-1)&&n.push(s)}return n}class cu extends ys{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return Nr.fail("No node at attribute step's position");let r=Object.create(null);for(let i in n.attrs)r[i]=n.attrs[i];r[this.attr]=this.value;let s=n.type.create(r,null,n.marks);return Nr.fromReplace(e,this.pos,this.pos+1,new Kt(jt.from(s),0,n.isLeaf?0:1))}getMap(){return ei.empty}invert(e){return new cu(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new cu(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new cu(n.pos,n.attr,n.value)}}ys.jsonID("attr",cu);class If extends ys{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let s in e.attrs)n[s]=e.attrs[s];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return Nr.ok(r)}getMap(){return ei.empty}invert(e){return new If(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new If(n.attr,n.value)}}ys.jsonID("docAttr",If);let Su=class extends Error{};Su=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};Su.prototype=Object.create(Error.prototype);Su.prototype.constructor=Su;Su.prototype.name="TransformError";class gA{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new jf}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new Su(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=Kt.empty){let s=Fg(this.doc,e,n,r);return s&&this.step(s),this}replaceWith(e,n,r){return this.replace(e,n,new Kt(jt.from(r),0,0))}delete(e,n){return this.replace(e,n,Kt.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return MH(this,e,n,r),this}replaceRangeWith(e,n,r){return DH(this,e,n,r),this}deleteRange(e,n){return AH(this,e,n),this}lift(e,n){return yH(this,e,n),this}join(e,n=1){return CH(this,e,n),this}wrap(e,n){return vH(this,e,n),this}setBlockType(e,n=e,r,s=null){return wH(this,e,n,r,s),this}setNodeMarkup(e,n,r=null,s){return SH(this,e,n,r,s),this}setNodeAttribute(e,n,r){return this.step(new cu(e,n,r)),this}setDocAttribute(e,n){return this.step(new If(e,n)),this}addNodeMark(e,n){return this.step(new Ea(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof Un)n.isInSet(r.marks)&&this.step(new Zl(e,n));else{let s=r.marks,i,o=[];for(;i=n.isInSet(s);)o.push(new Zl(e,i)),s=i.removeFromSet(s);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,n=1,r){return _H(this,e,n,r),this}addMark(e,n,r){return pH(this,e,n,r),this}removeMark(e,n,r){return mH(this,e,n,r),this}clearIncompatible(e,n,r){return pw(this,e,n,r),this}}const dy=Object.create(null);class mn{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new RH(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=Kt.empty){let r=n.content.lastChild,s=null;for(let a=0;a<n.openEnd;a++)s=r,r=r.lastChild;let i=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:u}=o[a],d=e.mapping.slice(i);e.replaceRange(d.map(l.pos),d.map(u.pos),a?Kt.empty:n),a==0&&V_(e,i,(r?r.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){let{$from:o,$to:a}=s[i],l=e.mapping.slice(r),u=l.map(o.pos),d=l.map(a.pos);i?e.deleteRange(u,d):(e.replaceRangeWith(u,d,n),V_(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let s=e.parent.inlineContent?new pn(e):Ec(e.node(0),e.parent,e.pos,e.index(),n,r);if(s)return s;for(let i=e.depth-1;i>=0;i--){let o=n<0?Ec(e.node(0),e.node(i),e.before(i+1),e.index(i),n,r):Ec(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new Ni(e.node(0))}static atStart(e){return Ec(e,e,0,0,1)||new Ni(e)}static atEnd(e){return Ec(e,e,e.content.size,e.childCount,-1)||new Ni(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=dy[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in dy)throw new RangeError("Duplicate use of selection JSON ID "+e);return dy[e]=n,n.prototype.jsonID=e,n}getBookmark(){return pn.between(this.$anchor,this.$head).getBookmark()}}mn.prototype.visible=!0;class RH{constructor(e,n){this.$from=e,this.$to=n}}let U_=!1;function H_(t){!U_&&!t.parent.inlineContent&&(U_=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class pn extends mn{constructor(e,n=e){H_(e),H_(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return mn.near(r);let s=e.resolve(n.map(this.anchor));return new pn(s.parent.inlineContent?s:r,r)}replace(e,n=Kt.empty){if(super.replace(e,n),n==Kt.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof pn&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Bg(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new pn(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let s=e.resolve(n);return new this(s,r==n?s:e.resolve(r))}static between(e,n,r){let s=e.pos-n.pos;if((!r||s)&&(r=s>=0?1:-1),!n.parent.inlineContent){let i=mn.findFrom(n,r,!0)||mn.findFrom(n,-r,!0);if(i)n=i.$head;else return mn.near(n,r)}return e.parent.inlineContent||(s==0?e=n:(e=(mn.findFrom(e,-r,!0)||mn.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=s<0&&(e=n))),new pn(e,n)}}mn.jsonID("text",pn);class Bg{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Bg(e.map(this.anchor),e.map(this.head))}resolve(e){return pn.between(e.resolve(this.anchor),e.resolve(this.head))}}class en extends mn{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:s}=n.mapResult(this.anchor),i=e.resolve(s);return r?mn.near(i):new en(i)}content(){return new Kt(jt.from(this.node),0,0)}eq(e){return e instanceof en&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new gw(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new en(e.resolve(n.anchor))}static create(e,n){return new en(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}en.prototype.visible=!1;mn.jsonID("node",en);class gw{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new Bg(r,r):new gw(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&en.isSelectable(r)?new en(n):mn.near(n)}}class Ni extends mn{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=Kt.empty){if(n==Kt.empty){e.delete(0,e.doc.content.size);let r=mn.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new Ni(e)}map(e){return new Ni(e)}eq(e){return e instanceof Ni}getBookmark(){return OH}}mn.jsonID("all",Ni);const OH={map(){return this},resolve(t){return new Ni(t)}};function Ec(t,e,n,r,s,i=!1){if(e.inlineContent)return pn.create(t,n);for(let o=r-(s>0?0:1);s>0?o<e.childCount:o>=0;o+=s){let a=e.child(o);if(a.isAtom){if(!i&&en.isSelectable(a))return en.create(t,n-(s<0?a.nodeSize:0))}else{let l=Ec(t,a,n+s,s<0?a.childCount:0,s,i);if(l)return l}n+=a.nodeSize*s}return null}function V_(t,e,n){let r=t.steps.length-1;if(r<e)return;let s=t.steps[r];if(!(s instanceof zr||s instanceof Ur))return;let i=t.mapping.maps[r],o;i.forEach((a,l,u,d)=>{o==null&&(o=d)}),t.setSelection(mn.near(t.doc.resolve(o),n))}const W_=1,$h=2,K_=4;class PH extends gA{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|W_)&~$h,this.storedMarks=null,this}get selectionSet(){return(this.updated&W_)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=$h,this}ensureMarks(e){return Un.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&$h)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~$h,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||Un.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let s=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(s.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),!e)return this.deleteRange(n,r);let i=this.storedMarks;if(!i){let o=this.doc.resolve(n);i=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,s.text(e,i)),!this.selection.empty&&this.selection.to==n+e.length&&this.setSelection(mn.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=K_,this}get scrolledIntoView(){return(this.updated&K_)>0}}function G_(t,e){return!e||!t?t:t.bind(e)}class gd{constructor(e,n,r){this.name=e,this.init=G_(n.init,r),this.apply=G_(n.apply,r)}}const LH=[new gd("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new gd("selection",{init(t,e){return t.selection||mn.atStart(e.doc)},apply(t){return t.selection}}),new gd("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new gd("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class fy{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=LH.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new gd(r.key,r.spec.state,r))})}}class Jc{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let s=this.config.plugins[r];if(s.spec.filterTransaction&&!s.spec.filterTransaction.call(s,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),s=null;for(;;){let i=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=s?s[o].n:0,u=s?s[o].state:this,d=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,u,r);if(d&&r.filterTransaction(d,o)){if(d.setMeta("appendedTransaction",e),!s){s=[];for(let f=0;f<this.config.plugins.length;f++)s.push(f<o?{state:r,n:n.length}:{state:this,n:0})}n.push(d),r=r.applyInner(d),i=!0}s&&(s[o]={state:r,n:n.length})}}if(!i)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new Jc(this.config),r=this.config.fields;for(let s=0;s<r.length;s++){let i=r[s];n[i.name]=i.apply(e,this[i.name],this,n)}return n}get tr(){return new PH(this)}static create(e){let n=new fy(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new Jc(n);for(let s=0;s<n.fields.length;s++)r[n.fields[s].name]=n.fields[s].init(e,r);return r}reconfigure(e){let n=new fy(this.schema,e.plugins),r=n.fields,s=new Jc(n);for(let i=0;i<r.length;i++){let o=r[i].name;s[o]=this.hasOwnProperty(o)?this[o]:r[i].init(e,s)}return s}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[r],i=s.spec.state;i&&i.toJSON&&(n[r]=i.toJSON.call(s,this[s.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new fy(e.schema,e.plugins),i=new Jc(s);return s.fields.forEach(o=>{if(o.name=="doc")i.doc=Uo.fromJSON(e.schema,n.doc);else if(o.name=="selection")i.selection=mn.fromJSON(i.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(i.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],u=l.spec.state;if(l.key==o.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){i[o.name]=u.fromJSON.call(l,e,n[a],i);return}}i[o.name]=o.init(e,i)}}),i}}function yA(t,e,n){for(let r in t){let s=t[r];s instanceof Function?s=s.bind(e):r=="handleDOMEvents"&&(s=yA(s,e,{})),n[r]=s}return n}class jr{constructor(e){this.spec=e,this.props={},e.props&&yA(e.props,this,this.props),this.key=e.key?e.key.key:xA("plugin")}getState(e){return e[this.key]}}const hy=Object.create(null);function xA(t){return t in hy?t+"$"+ ++hy[t]:(hy[t]=0,t+"$")}class ss{constructor(e="key"){this.key=xA(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Qr=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},_u=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let $1=null;const Ro=function(t,e,n){let r=$1||($1=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},$H=function(){$1=null},ec=function(t,e,n,r){return n&&(q_(t,e,n,r,-1)||q_(t,e,n,r,1))},zH=/^(img|br|input|textarea|hr)$/i;function q_(t,e,n,r,s){for(var i;;){if(t==n&&e==r)return!0;if(e==(s<0?0:ki(t))){let o=t.parentNode;if(!o||o.nodeType!=1||nh(t)||zH.test(t.nodeName)||t.contentEditable=="false")return!1;e=Qr(t)+(s<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(s<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((i=o.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=s;else return!1;else t=o,e=s<0?ki(t):0}else return!1}}function ki(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function FH(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=ki(t)}else if(t.parentNode&&!nh(t))e=Qr(t),t=t.parentNode;else return null}}function BH(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!nh(t))e=Qr(t)+1,t=t.parentNode;else return null}}function UH(t,e,n){for(let r=e==0,s=e==ki(t);r||s;){if(t==n)return!0;let i=Qr(t);if(t=t.parentNode,!t)return!1;r=r&&i==0,s=s&&i==ki(t)}}function nh(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Ug=function(t){return t.focusNode&&ec(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function Sl(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function HH(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function VH(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(ki(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(ki(r.startContainer),r.startOffset)}}}const wo=typeof navigator<"u"?navigator:null,Y_=typeof document<"u"?document:null,nl=wo&&wo.userAgent||"",z1=/Edge\/(\d+)/.exec(nl),bA=/MSIE \d/.exec(nl),F1=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nl),Hs=!!(bA||F1||z1),za=bA?document.documentMode:F1?+F1[1]:z1?+z1[1]:0,ji=!Hs&&/gecko\/(\d+)/i.test(nl);ji&&+(/Firefox\/(\d+)/.exec(nl)||[0,0])[1];const B1=!Hs&&/Chrome\/(\d+)/.exec(nl),Fr=!!B1,vA=B1?+B1[1]:0,gs=!Hs&&!!wo&&/Apple Computer/.test(wo.vendor),Tu=gs&&(/Mobile\/\w+/.test(nl)||!!wo&&wo.maxTouchPoints>2),xi=Tu||(wo?/Mac/.test(wo.platform):!1),wA=wo?/Win/.test(wo.platform):!1,zo=/Android \d/.test(nl),rh=!!Y_&&"webkitFontSmoothing"in Y_.documentElement.style,WH=rh?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function KH(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function Eo(t,e){return typeof t=="number"?t:t[e]}function GH(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function J_(t,e,n){let r=t.someProp("scrollThreshold")||0,s=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument;for(let o=n||t.dom;o;){if(o.nodeType!=1){o=_u(o);continue}let a=o,l=a==i.body,u=l?KH(i):GH(a),d=0,f=0;if(e.top<u.top+Eo(r,"top")?f=-(u.top-e.top+Eo(s,"top")):e.bottom>u.bottom-Eo(r,"bottom")&&(f=e.bottom-e.top>u.bottom-u.top?e.top+Eo(s,"top")-u.top:e.bottom-u.bottom+Eo(s,"bottom")),e.left<u.left+Eo(r,"left")?d=-(u.left-e.left+Eo(s,"left")):e.right>u.right-Eo(r,"right")&&(d=e.right-u.right+Eo(s,"right")),d||f)if(l)i.defaultView.scrollBy(d,f);else{let p=a.scrollLeft,m=a.scrollTop;f&&(a.scrollTop+=f),d&&(a.scrollLeft+=d);let y=a.scrollLeft-p,b=a.scrollTop-m;e={left:e.left-y,top:e.top-b,right:e.right-y,bottom:e.bottom-b}}let h=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(h))break;o=h=="absolute"?o.offsetParent:_u(o)}}function qH(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,s;for(let i=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(i,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,s=l.top;break}}return{refDOM:r,refTop:s,stack:kA(t.dom)}}function kA(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=_u(r));return e}function YH({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;SA(n,r==0?0:r-e)}function SA(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:s,left:i}=t[n];r.scrollTop!=s+e&&(r.scrollTop=s+e),r.scrollLeft!=i&&(r.scrollLeft=i)}}let yc=null;function JH(t){if(t.setActive)return t.setActive();if(yc)return t.focus(yc);let e=kA(t);t.focus(yc==null?{get preventScroll(){return yc={preventScroll:!0},!0}}:void 0),yc||(yc=!1,SA(e,0))}function _A(t,e){let n,r=2e8,s,i=0,o=e.top,a=e.top,l,u;for(let d=t.firstChild,f=0;d;d=d.nextSibling,f++){let h;if(d.nodeType==1)h=d.getClientRects();else if(d.nodeType==3)h=Ro(d).getClientRects();else continue;for(let p=0;p<h.length;p++){let m=h[p];if(m.top<=o&&m.bottom>=a){o=Math.max(m.bottom,o),a=Math.min(m.top,a);let y=m.left>e.left?m.left-e.left:m.right<e.left?e.left-m.right:0;if(y<r){n=d,r=y,s=y&&n.nodeType==3?{left:m.right<e.left?m.right:m.left,top:e.top}:e,d.nodeType==1&&y&&(i=f+(e.left>=(m.left+m.right)/2?1:0));continue}}else m.top>e.top&&!l&&m.left<=e.left&&m.right>=e.left&&(l=d,u={left:Math.max(m.left,Math.min(m.right,e.left)),top:m.top});!n&&(e.left>=m.right&&e.top>=m.top||e.left>=m.left&&e.top>=m.bottom)&&(i=f+1)}}return!n&&l&&(n=l,s=u,r=0),n&&n.nodeType==3?XH(n,s):!n||r&&n.nodeType==1?{node:t,offset:i}:_A(n,s)}function XH(t,e){let n=t.nodeValue.length,r=document.createRange(),s;for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let o=da(r,1);if(o.top!=o.bottom&&yw(e,o)){s={node:t,offset:i+(e.left>=(o.left+o.right)/2?1:0)};break}}return r.detach(),s||{node:t,offset:0}}function yw(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function QH(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function ZH(t,e,n){let{node:r,offset:s}=_A(e,n),i=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();i=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,s,i)}function eV(t,e,n,r){let s=-1;for(let i=e,o=!1;i!=t.dom;){let a=t.docView.nearestDesc(i,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>r.left||l.top>r.top?s=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(s=a.posAfter),o=!0),!a.contentDOM&&s<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;i=a.dom.parentNode}return s>-1?s:t.docView.posFromDOM(e,n,-1)}function TA(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let s=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),i=s;;){let o=t.childNodes[i];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let u=a[l];if(yw(e,u))return TA(o,e,u)}}if((i=(i+1)%r)==s)break}return t}function tV(t,e){let n=t.dom.ownerDocument,r,s=0,i=VH(n,e.left,e.top);i&&({node:r,offset:s}=i);let o=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),a;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let u=t.dom.getBoundingClientRect();if(!yw(e,u)||(o=TA(t.dom,e,u),!o))return null}if(gs)for(let u=o;r&&u;u=_u(u))u.draggable&&(r=void 0);if(o=QH(o,e),r){if(ji&&r.nodeType==1&&(s=Math.min(s,r.childNodes.length),s<r.childNodes.length)){let d=r.childNodes[s],f;d.nodeName=="IMG"&&(f=d.getBoundingClientRect()).right<=e.left&&f.bottom>e.top&&s++}let u;rh&&s&&r.nodeType==1&&(u=r.childNodes[s-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&s--,r==t.dom&&s==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(s==0||r.nodeType!=1||r.childNodes[s-1].nodeName!="BR")&&(a=eV(t,r,s,e))}a==null&&(a=ZH(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function X_(t){return t.top<t.bottom||t.left<t.right}function da(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(X_(r))return r}return Array.prototype.find.call(n,X_)||t.getBoundingClientRect()}const nV=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function CA(t,e,n){let{node:r,offset:s,atom:i}=t.docView.domFromPos(e,n<0?-1:1),o=rh||ji;if(r.nodeType==3)if(o&&(nV.test(r.nodeValue)||(n<0?!s:s==r.nodeValue.length))){let l=da(Ro(r,s,s),n);if(ji&&s&&/\s/.test(r.nodeValue[s-1])&&s<r.nodeValue.length){let u=da(Ro(r,s-1,s-1),-1);if(u.top==l.top){let d=da(Ro(r,s,s+1),-1);if(d.top!=l.top)return td(d,d.left<u.left)}}return l}else{let l=s,u=s,d=n<0?1:-1;return n<0&&!s?(u++,d=-1):n>=0&&s==r.nodeValue.length?(l--,d=1):n<0?l--:u++,td(da(Ro(r,l,u),d),d<0)}if(!t.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&s&&(n<0||s==ki(r))){let l=r.childNodes[s-1];if(l.nodeType==1)return py(l.getBoundingClientRect(),!1)}if(i==null&&s<ki(r)){let l=r.childNodes[s];if(l.nodeType==1)return py(l.getBoundingClientRect(),!0)}return py(r.getBoundingClientRect(),n>=0)}if(i==null&&s&&(n<0||s==ki(r))){let l=r.childNodes[s-1],u=l.nodeType==3?Ro(l,ki(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(u)return td(da(u,1),!1)}if(i==null&&s<ki(r)){let l=r.childNodes[s];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let u=l?l.nodeType==3?Ro(l,0,o?0:1):l.nodeType==1?l:null:null;if(u)return td(da(u,-1),!0)}return td(da(r.nodeType==3?Ro(r):r,-n),n>=0)}function td(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function py(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function EA(t,e,n){let r=t.state,s=t.root.activeElement;r!=e&&t.updateState(e),s!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),s!=t.dom&&s&&s.focus()}}function rV(t,e,n){let r=e.selection,s=n=="up"?r.$from:r.$to;return EA(t,e,()=>{let{node:i}=t.docView.domFromPos(s.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(i,!0);if(!a)break;if(a.node.isBlock){i=a.contentDOM||a.dom;break}i=a.dom.parentNode}let o=CA(t,s.pos,1);for(let a=i.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=Ro(a,0,a.nodeValue.length).getClientRects();else continue;for(let u=0;u<l.length;u++){let d=l[u];if(d.bottom>d.top+1&&(n=="up"?o.top-d.top>(d.bottom-o.top)*2:d.bottom-o.bottom>(o.bottom-d.top)*2))return!1}}return!0})}const sV=/[\u0590-\u08ac]/;function iV(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let s=r.parentOffset,i=!s,o=s==r.parent.content.size,a=t.domSelection();return a?!sV.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?i:o:EA(t,e,()=>{let{focusNode:l,focusOffset:u,anchorNode:d,anchorOffset:f}=t.domSelectionRange(),h=a.caretBidiLevel;a.modify("move",n,"character");let p=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:m,focusOffset:y}=t.domSelectionRange(),b=m&&!p.contains(m.nodeType==1?m:m.parentNode)||l==m&&u==y;try{a.collapse(d,f),l&&(l!=d||u!=f)&&a.extend&&a.extend(l,u)}catch{}return h!=null&&(a.caretBidiLevel=h),b}):r.pos==r.start()||r.pos==r.end()}let Q_=null,Z_=null,eT=!1;function oV(t,e,n){return Q_==e&&Z_==n?eT:(Q_=e,Z_=n,eT=n=="up"||n=="down"?rV(t,e,n):iV(t,e,n))}const Ii=0,tT=1,Al=2,ko=3;class sh{constructor(e,n,r,s){this.parent=e,this.children=n,this.dom=r,this.contentDOM=s,this.dirty=Ii,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let s=this.children[n];if(s==e)return r;r+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let i,o;if(e==this.contentDOM)i=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(o)+o.size:this.posAtStart}else{let i,o;if(e==this.contentDOM)i=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(o):this.posAtEnd}let s;if(e==this.dom&&this.contentDOM)s=n>Qr(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!1;break}if(i.previousSibling)break}if(s==null&&n==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!0;break}if(i.nextSibling)break}}return s??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,s=e;s;s=s.parentNode){let i=this.getDesc(s),o;if(i&&(!n||i.node))if(r&&(o=i.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return i}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let s=e;s;s=s.parentNode){let i=this.getDesc(s);if(i)return i.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let s=this.children[n],i=r+s.size;if(r==e&&i!=r){for(;!s.border&&s.children.length;)for(let o=0;o<s.children.length;o++){let a=s.children[o];if(a.size){s=a;break}}return s}if(e<i)return s.descAt(e-r-s.border);r=i}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,s=0;for(let i=0;r<this.children.length;r++){let o=this.children[r],a=i+o.size;if(a>e||o instanceof jA){s=e-i;break}i=a}if(s)return this.children[r].domFromPos(s-this.children[r].border,n);for(let i;r&&!(i=this.children[r-1]).size&&i instanceof NA&&i.side>=0;r--);if(n<=0){let i,o=!0;for(;i=r?this.children[r-1]:null,!(!i||i.dom.parentNode==this.contentDOM);r--,o=!1);return i&&n&&o&&!i.border&&!i.domAtom?i.domFromPos(i.size,n):{node:this.contentDOM,offset:i?Qr(i.dom)+1:0}}else{let i,o=!0;for(;i=r<this.children.length?this.children[r]:null,!(!i||i.dom.parentNode==this.contentDOM);r++,o=!1);return i&&o&&!i.border&&!i.domAtom?i.domFromPos(0,n):{node:this.contentDOM,offset:i?Qr(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,i=-1;for(let o=r,a=0;;a++){let l=this.children[a],u=o+l.size;if(s==-1&&e<=u){let d=o+l.border;if(e>=d&&n<=u-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,d);e=o;for(let f=a;f>0;f--){let h=this.children[f-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){s=Qr(h.dom)+1;break}e-=h.size}s==-1&&(s=0)}if(s>-1&&(u>n||a==this.children.length-1)){n=u;for(let d=a+1;d<this.children.length;d++){let f=this.children[d];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(-1)){i=Qr(f.dom);break}n+=f.size}i==-1&&(i=this.contentDOM.childNodes.length);break}o=u}return{node:this.contentDOM,from:e,to:n,fromOffset:s,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,s=!1){let i=Math.min(e,n),o=Math.max(e,n);for(let p=0,m=0;p<this.children.length;p++){let y=this.children[p],b=m+y.size;if(i>m&&o<b)return y.setSelection(e-m-y.border,n-m-y.border,r,s);m=b}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),u=r.root.getSelection(),d=r.domSelectionRange(),f=!1;if((ji||gs)&&e==n){let{node:p,offset:m}=a;if(p.nodeType==3){if(f=!!(m&&p.nodeValue[m-1]==`
`),f&&m==p.nodeValue.length)for(let y=p,b;y;y=y.parentNode){if(b=y.nextSibling){b.nodeName=="BR"&&(a=l={node:b.parentNode,offset:Qr(b)+1});break}let g=y.pmViewDesc;if(g&&g.node&&g.node.isBlock)break}}else{let y=p.childNodes[m-1];f=y&&(y.nodeName=="BR"||y.contentEditable=="false")}}if(ji&&d.focusNode&&d.focusNode!=l.node&&d.focusNode.nodeType==1){let p=d.focusNode.childNodes[d.focusOffset];p&&p.contentEditable=="false"&&(s=!0)}if(!(s||f&&gs)&&ec(a.node,a.offset,d.anchorNode,d.anchorOffset)&&ec(l.node,l.offset,d.focusNode,d.focusOffset))return;let h=!1;if((u.extend||e==n)&&!(f&&ji)){u.collapse(a.node,a.offset);try{e!=n&&u.extend(l.node,l.offset),h=!0}catch{}}if(!h){if(e>n){let m=a;a=l,l=m}let p=document.createRange();p.setEnd(l.node,l.offset),p.setStart(a.node,a.offset),u.removeAllRanges(),u.addRange(p)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,s=0;s<this.children.length;s++){let i=this.children[s],o=r+i.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let a=r+i.border,l=o-i.border;if(e>=a&&n<=l){this.dirty=e==r||n==o?Al:tT,e==a&&n==l&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=ko:i.markDirty(e-a,n-a);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?Al:ko}r=o}this.dirty=Al}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?Al:tT;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class NA extends sh{constructor(e,n,r,s){let i,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!i)return s;if(i.parent)return i.parent.posBeforeChild(i)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,i=this}matchesWidget(e){return this.dirty==Ii&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class aV extends sh{constructor(e,n,r,s){super(e,[],n,null),this.textDOM=r,this.text=s}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class tc extends sh{constructor(e,n,r,s,i){super(e,[],r,s),this.mark=n,this.spec=i}static create(e,n,r,s){let i=s.nodeViews[n.type.name],o=i&&i(n,s,r);return(!o||!o.dom)&&(o=oc.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new tc(e,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&ko||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=ko&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=Ii){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Ii}}slice(e,n,r){let s=tc.create(this.parent,this.mark,!0,r),i=this.children,o=this.size;n<o&&(i=H1(i,n,o,r)),e>0&&(i=H1(i,0,e,r));for(let a=0;a<i.length;a++)i[a].parent=s;return s.children=i,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Fa extends sh{constructor(e,n,r,s,i,o,a,l,u){super(e,[],i,o),this.node=n,this.outerDeco=r,this.innerDeco=s,this.nodeDOM=a}static create(e,n,r,s,i,o){let a=i.nodeViews[n.type.name],l,u=a&&a(n,i,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,s),d=u&&u.dom,f=u&&u.contentDOM;if(n.isText){if(!d)d=document.createTextNode(n.text);else if(d.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else d||({dom:d,contentDOM:f}=oc.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!f&&!n.isText&&d.nodeName!="BR"&&(d.hasAttribute("contenteditable")||(d.contentEditable="false"),n.type.spec.draggable&&(d.draggable=!0));let h=d;return d=DA(d,r,n),u?l=new lV(e,n,r,s,d,f||null,h,u,i,o+1):n.isText?new Hg(e,n,r,s,d,h,i):new Fa(e,n,r,s,d,f||null,h,i,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>jt.empty)}return e}matchesNode(e,n,r){return this.dirty==Ii&&e.eq(this.node)&&Sm(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,s=n,i=e.composing?this.localCompositionInfo(e,n):null,o=i&&i.pos>-1?i:null,a=i&&i.pos<0,l=new uV(this,o&&o.node,e);hV(this.node,this.innerDeco,(u,d,f)=>{u.spec.marks?l.syncToMarks(u.spec.marks,r,e):u.type.side>=0&&!f&&l.syncToMarks(d==this.node.childCount?Un.none:this.node.child(d).marks,r,e),l.placeWidget(u,e,s)},(u,d,f,h)=>{l.syncToMarks(u.marks,r,e);let p;l.findNodeMatch(u,d,f,h)||a&&e.state.selection.from>s&&e.state.selection.to<s+u.nodeSize&&(p=l.findIndexWithChild(i.node))>-1&&l.updateNodeAt(u,d,f,p,e)||l.updateNextNode(u,d,f,e,h,s)||l.addNode(u,d,f,e,s),s+=u.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==Al)&&(o&&this.protectLocalComposition(e,o),IA(this.contentDOM,this.children,e),Tu&&pV(this.dom))}localCompositionInfo(e,n){let{from:r,to:s}=e.state.selection;if(!(e.state.selection instanceof pn)||r<n||s>n+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let o=i.nodeValue,a=mV(this.node.content,o,r-n,s-n);return a<0?null:{node:i,pos:a,text:o}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:s}){if(this.getDesc(n))return;let i=n;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let o=new aV(this,i,n,s);e.input.compositionNodes.push(o),this.children=H1(this.children,r,r+s.length,e,o)}update(e,n,r,s){return this.dirty==ko||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,s),!0)}updateInner(e,n,r,s){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=Ii}updateOuterDeco(e){if(Sm(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=MA(this.dom,this.nodeDOM,U1(this.outerDeco,this.node,n),U1(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function nT(t,e,n,r,s){DA(r,e,t);let i=new Fa(void 0,t,e,n,r,r,r,s,0);return i.contentDOM&&i.updateChildren(s,0),i}class Hg extends Fa{constructor(e,n,r,s,i,o,a){super(e,n,r,s,i,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,s){return this.dirty==ko||this.dirty!=Ii&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=Ii||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=Ii,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let s=this.node.cut(e,n),i=document.createTextNode(s.text);return new Hg(this.parent,s,this.outerDeco,this.innerDeco,i,i,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=ko)}get domAtom(){return!1}isText(e){return this.node.text==e}}class jA extends sh{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Ii&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class lV extends Fa{constructor(e,n,r,s,i,o,a,l,u,d){super(e,n,r,s,i,o,a,u,d),this.spec=l}update(e,n,r,s){if(this.dirty==ko)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,n,r);return i&&this.updateInner(e,n,r,s),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,s){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function IA(t,e,n){let r=t.firstChild,s=!1;for(let i=0;i<e.length;i++){let o=e[i],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=rT(r),s=!0;r=r.nextSibling}else s=!0,t.insertBefore(a,r);if(o instanceof tc){let l=r?r.previousSibling:t.lastChild;IA(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=rT(r),s=!0;s&&n.trackWrites==t&&(n.trackWrites=null)}const Od=function(t){t&&(this.nodeName=t)};Od.prototype=Object.create(null);const Rl=[new Od];function U1(t,e,n){if(t.length==0)return Rl;let r=n?Rl[0]:new Od,s=[r];for(let i=0;i<t.length;i++){let o=t[i].type.attrs;if(o){o.nodeName&&s.push(r=new Od(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&s.length==1&&s.push(r=new Od(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return s}function MA(t,e,n,r){if(n==Rl&&r==Rl)return e;let s=e;for(let i=0;i<r.length;i++){let o=r[i],a=n[i];if(i){let l;a&&a.nodeName==o.nodeName&&s!=t&&(l=s.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(s),a=Rl[0]),s=l}cV(s,a||Rl[0],o)}return s}function cV(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],s=n.class?n.class.split(" ").filter(Boolean):[];for(let i=0;i<r.length;i++)s.indexOf(r[i])==-1&&t.classList.remove(r[i]);for(let i=0;i<s.length;i++)r.indexOf(s[i])==-1&&t.classList.add(s[i]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,s;for(;s=r.exec(e.style);)t.style.removeProperty(s[1])}n.style&&(t.style.cssText+=n.style)}}function DA(t,e,n){return MA(t,t,Rl,U1(e,n,t.nodeType!=1))}function Sm(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function rT(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class uV{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=dV(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let s=0,i=this.stack.length>>1,o=Math.min(i,e.length);for(;s<o&&(s==i-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&e[s].type.spec.spanning!==!1;)s++;for(;s<i;)this.destroyRest(),this.top.dirty=Ii,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let u=this.top.children[l];if(u.matchesMark(e[i])&&!this.isLocked(u.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=tc.create(this.top,e[i],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,i++}}findNodeMatch(e,n,r,s){let i=-1,o;if(s>=this.preMatch.index&&(o=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))i=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let u=this.top.children[a];if(u.matchesNode(e,n,r)&&!this.preMatch.matched.has(u)){i=a;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,n,r,s,i){let o=this.top.children[s];return o.dirty==ko&&o.dom==o.contentDOM&&(o.dirty=Al),o.update(e,n,r,i)?(this.destroyBetween(this.index,s),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let s=this.index;s<this.top.children.length;s++)if(this.top.children[s]==r)return s}return-1}e=n}}updateNextNode(e,n,r,s,i,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof Fa){let u=this.preMatch.matched.get(l);if(u!=null&&u!=i)return!1;let d=l.dom,f,h=this.isLocked(d)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=ko&&Sm(n,l.outerDeco));if(!h&&l.update(e,n,r,s))return this.destroyBetween(this.index,a),l.dom!=d&&(this.changed=!0),this.index++,!0;if(!h&&(f=this.recreateWrapper(l,e,n,r,s,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=f,f.contentDOM&&(f.dirty=Al,f.updateChildren(s,o+1),f.dirty=Ii),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,s,i,o){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!Sm(r,e.outerDeco)||!s.eq(e.innerDeco))return null;let a=Fa.create(this.top,n,r,s,i,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,n,r,s,i){let o=Fa.create(this.top,e,n,r,s,i);o.contentDOM&&o.updateChildren(s,i+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,n,r){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(s&&s.matchesWidget(e)&&(e==s.widget||!s.widget.type.toDOM.parentNode))this.index++;else{let i=new NA(this.top,e,n,r);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof tc;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof Hg)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((gs||Fr)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let s=new jA(this.top,[],r,null);n!=this.top?n.children.push(s):n.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function dV(t,e){let n=e,r=n.children.length,s=t.childCount,i=new Map,o=[];e:for(;s>0;){let a;for(;;)if(r){let u=n.children[r-1];if(u instanceof tc)n=u,r=u.children.length;else{a=u,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(s-1))break;--s,i.set(a,s),o.push(a)}}return{index:s,matched:i,matches:o.reverse()}}function fV(t,e){return t.type.side-e.type.side}function hV(t,e,n,r){let s=e.locals(t),i=0;if(s.length==0){for(let u=0;u<t.childCount;u++){let d=t.child(u);r(d,s,e.forChild(i,d),u),i+=d.nodeSize}return}let o=0,a=[],l=null;for(let u=0;;){let d,f;for(;o<s.length&&s[o].to==i;){let b=s[o++];b.widget&&(d?(f||(f=[d])).push(b):d=b)}if(d)if(f){f.sort(fV);for(let b=0;b<f.length;b++)n(f[b],u,!!l)}else n(d,u,!!l);let h,p;if(l)p=-1,h=l,l=null;else if(u<t.childCount)p=u,h=t.child(u++);else break;for(let b=0;b<a.length;b++)a[b].to<=i&&a.splice(b--,1);for(;o<s.length&&s[o].from<=i&&s[o].to>i;)a.push(s[o++]);let m=i+h.nodeSize;if(h.isText){let b=m;o<s.length&&s[o].from<b&&(b=s[o].from);for(let g=0;g<a.length;g++)a[g].to<b&&(b=a[g].to);b<m&&(l=h.cut(b-i),h=h.cut(0,b-i),m=b,p=-1)}else for(;o<s.length&&s[o].to<m;)o++;let y=h.isInline&&!h.isLeaf?a.filter(b=>!b.inline):a.slice();r(h,y,e.forChild(i,h),p),i=m}}function pV(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function mV(t,e,n,r){for(let s=0,i=0;s<t.childCount&&i<=r;){let o=t.child(s++),a=i;if(i+=o.nodeSize,!o.isText)continue;let l=o.text;for(;s<t.childCount;){let u=t.child(s++);if(i+=u.nodeSize,!u.isText)break;l+=u.text}if(i>=n){if(i>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let u=a<r?l.lastIndexOf(e,r-a-1):-1;if(u>=0&&u+e.length+a>=n)return a+u;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function H1(t,e,n,r,s){let i=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],u=a,d=a+=l.size;u>=n||d<=e?i.push(l):(u<e&&i.push(l.slice(0,e-u,r)),s&&(i.push(s),s=void 0),d>n&&i.push(l.slice(n-u,l.size,r)))}return i}function xw(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let s=t.docView.nearestDesc(n.focusNode),i=s&&s.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,u;if(Ug(n)){for(l=o;s&&!s.node;)s=s.parent;let f=s.node;if(s&&f.isAtom&&en.isSelectable(f)&&s.parent&&!(f.isInline&&UH(n.focusNode,n.focusOffset,s.dom))){let h=s.posBefore;u=new en(o==h?a:r.resolve(h))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let f=o,h=o;for(let p=0;p<n.rangeCount;p++){let m=n.getRangeAt(p);f=Math.min(f,t.docView.posFromDOM(m.startContainer,m.startOffset,1)),h=Math.max(h,t.docView.posFromDOM(m.endContainer,m.endOffset,-1))}if(f<0)return null;[l,o]=h==t.state.selection.anchor?[h,f]:[f,h],a=r.resolve(o)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let d=r.resolve(l);if(!u){let f=e=="pointer"||t.state.selection.head<a.pos&&!i?1:-1;u=bw(t,d,a,f)}return u}function AA(t){return t.editable?t.hasFocus():OA(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Ho(t,e=!1){let n=t.state.selection;if(RA(t,n),!!AA(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&Fr){let r=t.domSelectionRange(),s=t.domObserver.currentSelection;if(r.anchorNode&&s.anchorNode&&ec(r.anchorNode,r.anchorOffset,s.anchorNode,s.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)yV(t);else{let{anchor:r,head:s}=n,i,o;sT&&!(n instanceof pn)&&(n.$from.parent.inlineContent||(i=iT(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=iT(t,n.to))),t.docView.setSelection(r,s,t,e),sT&&(i&&oT(i),o&&oT(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&gV(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const sT=gs||Fr&&vA<63;function iT(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),s=r<n.childNodes.length?n.childNodes[r]:null,i=r?n.childNodes[r-1]:null;if(gs&&s&&s.contentEditable=="false")return my(s);if((!s||s.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(s)return my(s);if(i)return my(i)}}function my(t){return t.contentEditable="true",gs&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function oT(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function gV(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,s=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=s)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!AA(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function yV(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,Qr(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&Hs&&za<=11&&(n.disabled=!0,n.disabled=!1)}function RA(t,e){if(e instanceof en){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(aT(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else aT(t)}function aT(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function bw(t,e,n,r){return t.someProp("createSelectionBetween",s=>s(t,e,n))||pn.between(e,n,r)}function lT(t){return t.editable&&!t.hasFocus()?!1:OA(t)}function OA(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function xV(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return ec(e.node,e.offset,n.anchorNode,n.anchorOffset)}function V1(t,e){let{$anchor:n,$head:r}=t.selection,s=e>0?n.max(r):n.min(r),i=s.parent.inlineContent?s.depth?t.doc.resolve(e>0?s.after():s.before()):null:s;return i&&mn.findFrom(i,e)}function ma(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function cT(t,e,n){let r=t.state.selection;if(r instanceof pn)if(n.indexOf("s")>-1){let{$head:s}=r,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let o=t.state.doc.resolve(s.pos+i.nodeSize*(e<0?-1:1));return ma(t,new pn(r.$anchor,o))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let s=V1(t.state,e);return s&&s instanceof en?ma(t,s):!1}else if(!(xi&&n.indexOf("m")>-1)){let s=r.$head,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter,o;if(!i||i.isText)return!1;let a=e<0?s.pos-i.nodeSize:s.pos;return i.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?en.isSelectable(i)?ma(t,new en(e<0?t.state.doc.resolve(s.pos-i.nodeSize):s)):rh?ma(t,new pn(t.state.doc.resolve(e<0?a:a+i.nodeSize))):!1:!1}}else return!1;else{if(r instanceof en&&r.node.isInline)return ma(t,new pn(e>0?r.$to:r.$from));{let s=V1(t.state,e);return s?ma(t,s):!1}}}function _m(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Pd(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function xc(t,e){return e<0?bV(t):vV(t)}function bV(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s,i,o=!1;for(ji&&n.nodeType==1&&r<_m(n)&&Pd(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(Pd(a,-1))s=n,i=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(PA(n))break;{let a=n.previousSibling;for(;a&&Pd(a,-1);)s=n.parentNode,i=Qr(a),a=a.previousSibling;if(a)n=a,r=_m(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?W1(t,n,r):s&&W1(t,s,i)}function vV(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s=_m(n),i,o;for(;;)if(r<s){if(n.nodeType!=1)break;let a=n.childNodes[r];if(Pd(a,1))i=n,o=++r;else break}else{if(PA(n))break;{let a=n.nextSibling;for(;a&&Pd(a,1);)i=a.parentNode,o=Qr(a)+1,a=a.nextSibling;if(a)n=a,r=0,s=_m(n);else{if(n=n.parentNode,n==t.dom)break;r=s=0}}}i&&W1(t,i,o)}function PA(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function wV(t,e){for(;t&&e==t.childNodes.length&&!nh(t);)e=Qr(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function kV(t,e){for(;t&&!e&&!nh(t);)e=Qr(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function W1(t,e,n){if(e.nodeType!=3){let i,o;(o=wV(e,n))?(e=o,n=0):(i=kV(e,n))&&(e=i,n=i.nodeValue.length)}let r=t.domSelection();if(!r)return;if(Ug(r)){let i=document.createRange();i.setEnd(e,n),i.setStart(e,n),r.removeAllRanges(),r.addRange(i)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:s}=t;setTimeout(()=>{t.state==s&&Ho(t)},50)}function uT(t,e){let n=t.state.doc.resolve(e);if(!(Fr||wA)&&n.parent.inlineContent){let s=t.coordsAtPos(e);if(e>n.start()){let i=t.coordsAtPos(e-1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left<s.left?"ltr":"rtl"}if(e<n.end()){let i=t.coordsAtPos(e+1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left>s.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function dT(t,e,n){let r=t.state.selection;if(r instanceof pn&&!r.empty||n.indexOf("s")>-1||xi&&n.indexOf("m")>-1)return!1;let{$from:s,$to:i}=r;if(!s.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=V1(t.state,e);if(o&&o instanceof en)return ma(t,o)}if(!s.parent.inlineContent){let o=e<0?s:i,a=r instanceof Ni?mn.near(o,e):mn.findFrom(o,e);return a?ma(t,a):!1}return!1}function fT(t,e){if(!(t.state.selection instanceof pn))return!0;let{$head:n,$anchor:r,empty:s}=t.state.selection;if(!n.sameParent(r))return!0;if(!s)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let o=t.state.tr;return e<0?o.delete(n.pos-i.nodeSize,n.pos):o.delete(n.pos,n.pos+i.nodeSize),t.dispatch(o),!0}return!1}function hT(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function SV(t){if(!gs||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;hT(t,r,"true"),setTimeout(()=>hT(t,r,"false"),20)}return!1}function _V(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function TV(t,e){let n=e.keyCode,r=_V(e);if(n==8||xi&&n==72&&r=="c")return fT(t,-1)||xc(t,-1);if(n==46&&!e.shiftKey||xi&&n==68&&r=="c")return fT(t,1)||xc(t,1);if(n==13||n==27)return!0;if(n==37||xi&&n==66&&r=="c"){let s=n==37?uT(t,t.state.selection.from)=="ltr"?-1:1:-1;return cT(t,s,r)||xc(t,s)}else if(n==39||xi&&n==70&&r=="c"){let s=n==39?uT(t,t.state.selection.from)=="ltr"?1:-1:1;return cT(t,s,r)||xc(t,s)}else{if(n==38||xi&&n==80&&r=="c")return dT(t,-1,r)||xc(t,-1);if(n==40||xi&&n==78&&r=="c")return SV(t)||dT(t,1,r)||xc(t,1);if(r==(xi?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function vw(t,e){t.someProp("transformCopied",p=>{e=p(e,t)});let n=[],{content:r,openStart:s,openEnd:i}=e;for(;s>1&&i>1&&r.childCount==1&&r.firstChild.childCount==1;){s--,i--;let p=r.firstChild;n.push(p.type.name,p.attrs!=p.type.defaultAttrs?p.attrs:null),r=p.content}let o=t.someProp("clipboardSerializer")||oc.fromSchema(t.state.schema),a=UA(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let u=l.firstChild,d,f=0;for(;u&&u.nodeType==1&&(d=BA[u.nodeName.toLowerCase()]);){for(let p=d.length-1;p>=0;p--){let m=a.createElement(d[p]);for(;l.firstChild;)m.appendChild(l.firstChild);l.appendChild(m),f++}u=l.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${s} ${i}${f?` -${f}`:""} ${JSON.stringify(n)}`);let h=t.someProp("clipboardTextSerializer",p=>p(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:h,slice:e}}function LA(t,e,n,r,s){let i=s.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=!!e&&(r||i||!n);if(l){if(t.someProp("transformPastedText",h=>{e=h(e,i||r,t)}),i)return a=new Kt(jt.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",h=>{a=h(a,t,!0)}),a;let f=t.someProp("clipboardTextParser",h=>h(e,s,r,t));if(f)a=f;else{let h=s.marks(),{schema:p}=t.state,m=oc.fromSchema(p);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(y=>{let b=o.appendChild(document.createElement("p"));y&&b.appendChild(m.serializeNode(p.text(y,h)))})}}else t.someProp("transformPastedHTML",f=>{n=f(n,t)}),o=jV(n),rh&&IV(o);let u=o&&o.querySelector("[data-pm-slice]"),d=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let f=+d[3];f>0;f--){let h=o.firstChild;for(;h&&h.nodeType!=1;)h=h.nextSibling;if(!h)break;o=h}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||$a.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||d),context:s,ruleFromNode(h){return h.nodeName=="BR"&&!h.nextSibling&&h.parentNode&&!CV.test(h.parentNode.nodeName)?{ignore:!0}:null}})),d)a=MV(pT(a,+d[1],+d[2]),d[4]);else if(a=Kt.maxOpen(EV(a.content,s),!0),a.openStart||a.openEnd){let f=0,h=0;for(let p=a.content.firstChild;f<a.openStart&&!p.type.spec.isolating;f++,p=p.firstChild);for(let p=a.content.lastChild;h<a.openEnd&&!p.type.spec.isolating;h++,p=p.lastChild);a=pT(a,f,h)}return t.someProp("transformPasted",f=>{a=f(a,t,l)}),a}const CV=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function EV(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let s=e.node(n).contentMatchAt(e.index(n)),i,o=[];if(t.forEach(a=>{if(!o)return;let l=s.findWrapping(a.type),u;if(!l)return o=null;if(u=o.length&&i.length&&zA(l,i,a,o[o.length-1],0))o[o.length-1]=u;else{o.length&&(o[o.length-1]=FA(o[o.length-1],i.length));let d=$A(a,l);o.push(d),s=s.matchType(d.type),i=l}}),o)return jt.from(o)}return t}function $A(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,jt.from(t));return t}function zA(t,e,n,r,s){if(s<t.length&&s<e.length&&t[s]==e[s]){let i=zA(t,e,n,r.lastChild,s+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(s==t.length-1?n.type:t[s+1]))return r.copy(r.content.append(jt.from($A(n,t,s+1))))}}function FA(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,FA(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(jt.empty,!0);return t.copy(n.append(r))}function K1(t,e,n,r,s,i){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(i=0),s<r-1&&(a=K1(a,e,n,r,s+1,i)),s>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,i<=s).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(jt.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function pT(t,e,n){return e<t.openStart&&(t=new Kt(K1(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new Kt(K1(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const BA={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let mT=null;function UA(){return mT||(mT=document.implementation.createHTMLDocument("title"))}let gy=null;function NV(t){let e=window.trustedTypes;return e?(gy||(gy=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),gy.createHTML(t)):t}function jV(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=UA().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),s;if((s=r&&BA[r[1].toLowerCase()])&&(t=s.map(i=>"<"+i+">").join("")+t+s.map(i=>"</"+i+">").reverse().join("")),n.innerHTML=NV(t),s)for(let i=0;i<s.length;i++)n=n.querySelector(s[i])||n;return n}function IV(t){let e=t.querySelectorAll(Fr?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==""&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function MV(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:s,openStart:i,openEnd:o}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;s=jt.from(l.create(r[a+1],s)),i++,o++}return new Kt(s,i,o)}const Ts={},Cs={},DV={touchstart:!0,touchmove:!0};class AV{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function RV(t){for(let e in Ts){let n=Ts[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{PV(t,r)&&!ww(t,r)&&(t.editable||!(r.type in Cs))&&n(t,r)},DV[e]?{passive:!0}:void 0)}gs&&t.dom.addEventListener("input",()=>null),G1(t)}function Na(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function OV(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function G1(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>ww(t,r))})}function ww(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function PV(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function LV(t,e){!ww(t,e)&&Ts[e.type]&&(t.editable||!(e.type in Cs))&&Ts[e.type](t,e)}Cs.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!VA(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(zo&&Fr&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),Tu&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",s=>s(t,Sl(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||TV(t,n)?n.preventDefault():Na(t,"key")};Cs.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Cs.keypress=(t,e)=>{let n=e;if(VA(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||xi&&n.metaKey)return;if(t.someProp("handleKeyPress",s=>s(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof pn)||!r.$from.sameParent(r.$to)){let s=String.fromCharCode(n.charCode),i=()=>t.state.tr.insertText(s).scrollIntoView();!/[\r\n]/.test(s)&&!t.someProp("handleTextInput",o=>o(t,r.$from.pos,r.$to.pos,s,i))&&t.dispatch(i()),n.preventDefault()}};function Vg(t){return{left:t.clientX,top:t.clientY}}function $V(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function kw(t,e,n,r,s){if(r==-1)return!1;let i=t.state.doc.resolve(r);for(let o=i.depth+1;o>0;o--)if(t.someProp(e,a=>o>i.depth?a(t,n,i.nodeAfter,i.before(o),s,!0):a(t,n,i.node(o),i.before(o),s,!1)))return!0;return!1}function uu(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);n=="pointer"&&r.setMeta("pointer",!0),t.dispatch(r)}function zV(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&en.isSelectable(r)?(uu(t,new en(n),"pointer"),!0):!1}function FV(t,e){if(e==-1)return!1;let n=t.state.selection,r,s;n instanceof en&&(r=n.node);let i=t.state.doc.resolve(e);for(let o=i.depth+1;o>0;o--){let a=o>i.depth?i.nodeAfter:i.node(o);if(en.isSelectable(a)){r&&n.$from.depth>0&&o>=n.$from.depth&&i.before(n.$from.depth+1)==n.$from.pos?s=i.before(n.$from.depth):s=i.before(o);break}}return s!=null?(uu(t,en.create(t.state.doc,s),"pointer"),!0):!1}function BV(t,e,n,r,s){return kw(t,"handleClickOn",e,n,r)||t.someProp("handleClick",i=>i(t,e,r))||(s?FV(t,n):zV(t,n))}function UV(t,e,n,r){return kw(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",s=>s(t,e,r))}function HV(t,e,n,r){return kw(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",s=>s(t,e,r))||VV(t,n,r)}function VV(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(uu(t,pn.create(r,0,r.content.size),"pointer"),!0):!1;let s=r.resolve(e);for(let i=s.depth+1;i>0;i--){let o=i>s.depth?s.nodeAfter:s.node(i),a=s.before(i);if(o.inlineContent)uu(t,pn.create(r,a+1,a+1+o.content.size),"pointer");else if(en.isSelectable(o))uu(t,en.create(r,a),"pointer");else continue;return!0}}function Sw(t){return Tm(t)}const HA=xi?"metaKey":"ctrlKey";Ts.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=Sw(t),s=Date.now(),i="singleClick";s-t.input.lastClick.time<500&&$V(n,t.input.lastClick)&&!n[HA]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?i="doubleClick":t.input.lastClick.type=="doubleClick"&&(i="tripleClick")),t.input.lastClick={time:s,x:n.clientX,y:n.clientY,type:i,button:n.button};let o=t.posAtCoords(Vg(n));o&&(i=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new WV(t,o,n,!!r)):(i=="doubleClick"?UV:HV)(t,o.pos,o.inside,n)?n.preventDefault():Na(t,"pointer"))};class WV{constructor(e,n,r,s){this.view=e,this.pos=n,this.event=r,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[HA],this.allowDefault=r.shiftKey;let i,o;if(n.inside>-1)i=e.state.doc.nodeAt(n.inside),o=n.inside;else{let d=e.state.doc.resolve(n.pos);i=d.parent,o=d.depth?d.before():0}const a=s?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:u}=e.state;(r.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||u instanceof en&&u.from<=o&&u.to>o)&&(this.mightDrag={node:i,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&ji&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Na(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Ho(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(Vg(e))),this.updateAllowDefault(e),this.allowDefault||!n?Na(this.view,"pointer"):BV(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||gs&&this.mightDrag&&!this.mightDrag.node.isAtom||Fr&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(uu(this.view,mn.near(this.view.state.doc.resolve(n.pos)),"pointer"),e.preventDefault()):Na(this.view,"pointer")}move(e){this.updateAllowDefault(e),Na(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Ts.touchstart=t=>{t.input.lastTouch=Date.now(),Sw(t),Na(t,"pointer")};Ts.touchmove=t=>{t.input.lastTouch=Date.now(),Na(t,"pointer")};Ts.contextmenu=t=>Sw(t);function VA(t,e){return t.composing?!0:gs&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const KV=zo?5e3:-1;Cs.compositionstart=Cs.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof pn&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)||Fr&&wA&&GV(t)))t.markCursor=t.state.storedMarks||n.marks(),Tm(t,!0),t.markCursor=null;else if(Tm(t,!e.selection.empty),ji&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let s=r.focusNode,i=r.focusOffset;s&&s.nodeType==1&&i!=0;){let o=i<0?s.lastChild:s.childNodes[i-1];if(!o)break;if(o.nodeType==3){let a=t.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else s=o,i=-1}}t.input.composing=!0}WA(t,KV)};function GV(t){let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(!e||e.nodeType!=1||n>=e.childNodes.length)return!1;let r=e.childNodes[n];return r.nodeType==1&&r.contentEditable=="false"}Cs.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,WA(t,20))};function WA(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Tm(t),e))}function KA(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=YV());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function qV(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=FH(e.focusNode,e.focusOffset),r=BH(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let s=r.pmViewDesc,i=t.domObserver.lastChangedTextNode;if(n==i||r==i)return i;if(!s||!s.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let o=n.pmViewDesc;if(!(!o||!o.isText(n.nodeValue)))return r}}return n||r}function YV(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Tm(t,e=!1){if(!(zo&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),KA(t),e||t.docView&&t.docView.dirty){let n=xw(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function JV(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),s=document.createRange();s.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(s),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const Mf=Hs&&za<15||Tu&&WH<604;Ts.copy=Cs.cut=(t,e)=>{let n=e,r=t.state.selection,s=n.type=="cut";if(r.empty)return;let i=Mf?null:n.clipboardData,o=r.content(),{dom:a,text:l}=vw(t,o);i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):JV(t,a),s&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function XV(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function QV(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let s=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?Df(t,r.value,null,s,e):Df(t,r.textContent,r.innerHTML,s,e)},50)}function Df(t,e,n,r,s){let i=LA(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,s,i||Kt.empty)))return!0;if(!i)return!1;let o=XV(i),a=o?t.state.tr.replaceSelectionWith(o,r):t.state.tr.replaceSelection(i);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function GA(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Cs.paste=(t,e)=>{let n=e;if(t.composing&&!zo)return;let r=Mf?null:n.clipboardData,s=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&Df(t,GA(r),r.getData("text/html"),s,n)?n.preventDefault():QV(t,n)};class qA{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const ZV=xi?"altKey":"ctrlKey";function YA(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[ZV]}Ts.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let s=t.state.selection,i=s.empty?null:t.posAtCoords(Vg(n)),o;if(!(i&&i.pos>=s.from&&i.pos<=(s instanceof en?s.to-1:s.to))){if(r&&r.mightDrag)o=en.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let f=t.docView.nearestDesc(n.target,!0);f&&f.node.type.spec.draggable&&f!=t.docView&&(o=en.create(t.state.doc,f.posBefore))}}let a=(o||t.state.selection).content(),{dom:l,text:u,slice:d}=vw(t,a);(!n.dataTransfer.files.length||!Fr||vA>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(Mf?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",Mf||n.dataTransfer.setData("text/plain",u),t.dragging=new qA(d,YA(t,n),o)};Ts.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Cs.dragover=Cs.dragenter=(t,e)=>e.preventDefault();Cs.drop=(t,e)=>{try{e7(t,e,t.dragging)}finally{t.dragging=null}};function e7(t,e,n){if(!e.dataTransfer)return;let r=t.posAtCoords(Vg(e));if(!r)return;let s=t.state.doc.resolve(r.pos),i=n&&n.slice;i?t.someProp("transformPasted",p=>{i=p(i,t,!1)}):i=LA(t,GA(e.dataTransfer),Mf?null:e.dataTransfer.getData("text/html"),!1,s);let o=!!(n&&YA(t,e));if(t.someProp("handleDrop",p=>p(t,e,i||Kt.empty,o))){e.preventDefault();return}if(!i)return;e.preventDefault();let a=i?dA(t.state.doc,s.pos,i):s.pos;a==null&&(a=s.pos);let l=t.state.tr;if(o){let{node:p}=n;p?p.replace(l):l.deleteSelection()}let u=l.mapping.map(a),d=i.openStart==0&&i.openEnd==0&&i.content.childCount==1,f=l.doc;if(d?l.replaceRangeWith(u,u,i.content.firstChild):l.replaceRange(u,u,i),l.doc.eq(f))return;let h=l.doc.resolve(u);if(d&&en.isSelectable(i.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(i.content.firstChild))l.setSelection(new en(h));else{let p=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach((m,y,b,g)=>p=g),l.setSelection(bw(t,h,l.doc.resolve(p)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}Ts.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&Ho(t)},20))};Ts.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Ts.beforeinput=(t,e)=>{if(Fr&&zo&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",i=>i(t,Sl(8,"Backspace")))))return;let{$cursor:s}=t.state.selection;s&&s.pos>0&&t.dispatch(t.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let t in Cs)Ts[t]=Cs[t];function Af(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class Cm{constructor(e,n){this.toDOM=e,this.spec=n||Vl,this.side=this.spec.side||0}map(e,n,r,s){let{pos:i,deleted:o}=e.mapResult(n.from+s,this.side<0?-1:1);return o?null:new zs(i-r,i-r,this)}valid(){return!0}eq(e){return this==e||e instanceof Cm&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Af(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Ba{constructor(e,n){this.attrs=e,this.spec=n||Vl}map(e,n,r,s){let i=e.map(n.from+s,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+s,this.spec.inclusiveEnd?1:-1)-r;return i>=o?null:new zs(i,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof Ba&&Af(this.attrs,e.attrs)&&Af(this.spec,e.spec)}static is(e){return e.type instanceof Ba}destroy(){}}class _w{constructor(e,n){this.attrs=e,this.spec=n||Vl}map(e,n,r,s){let i=e.mapResult(n.from+s,1);if(i.deleted)return null;let o=e.mapResult(n.to+s,-1);return o.deleted||o.pos<=i.pos?null:new zs(i.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:s}=e.content.findIndex(n.from),i;return s==n.from&&!(i=e.child(r)).isText&&s+i.nodeSize==n.to}eq(e){return this==e||e instanceof _w&&Af(this.attrs,e.attrs)&&Af(this.spec,e.spec)}destroy(){}}class zs{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new zs(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new zs(e,e,new Cm(n,r))}static inline(e,n,r,s){return new zs(e,n,new Ba(r,s))}static node(e,n,r,s){return new zs(e,n,new _w(r,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof Ba}get widget(){return this.type instanceof Cm}}const Nc=[],Vl={};class vr{constructor(e,n){this.local=e.length?e:Nc,this.children=n.length?n:Nc}static create(e,n){return n.length?Em(n,e,0,Vl):ds}find(e,n,r){let s=[];return this.findInner(e??0,n??1e9,s,0,r),s}findInner(e,n,r,s,i){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!i||i(a.spec))&&r.push(a.copy(a.from+s,a.to+s))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,r,s+a,i)}}map(e,n,r){return this==ds||e.maps.length==0?this:this.mapInner(e,n,0,0,r||Vl)}mapInner(e,n,r,s,i){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,s);l&&l.type.valid(n,l)?(o||(o=[])).push(l):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?t7(this.children,o||[],e,n,r,s,i):o?new vr(o.sort(Wl),Nc):ds}add(e,n){return n.length?this==ds?vr.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let s,i=0;e.forEach((a,l)=>{let u=l+r,d;if(d=XA(n,a,u)){for(s||(s=this.children.slice());i<s.length&&s[i]<l;)i+=3;s[i]==l?s[i+2]=s[i+2].addInner(a,d,u+1):s.splice(i,0,l,l+a.nodeSize,Em(d,a,u+1,Vl)),i+=3}});let o=JA(i?QA(n):n,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new vr(o.length?this.local.concat(o).sort(Wl):this.local,s||this.children)}remove(e){return e.length==0||this==ds?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,s=this.local;for(let i=0;i<r.length;i+=3){let o,a=r[i]+n,l=r[i+1]+n;for(let d=0,f;d<e.length;d++)(f=e[d])&&f.from>a&&f.to<l&&(e[d]=null,(o||(o=[])).push(f));if(!o)continue;r==this.children&&(r=this.children.slice());let u=r[i+2].removeInner(o,a+1);u!=ds?r[i+2]=u:(r.splice(i,3),i-=3)}if(s.length){for(let i=0,o;i<e.length;i++)if(o=e[i])for(let a=0;a<s.length;a++)s[a].eq(o,n)&&(s==this.local&&(s=this.local.slice()),s.splice(a--,1))}return r==this.children&&s==this.local?this:s.length||r.length?new vr(s,r):ds}forChild(e,n){if(this==ds)return this;if(n.isLeaf)return vr.empty;let r,s;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let i=e+1,o=i+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>i&&l.type instanceof Ba){let u=Math.max(i,l.from)-i,d=Math.min(o,l.to)-i;u<d&&(s||(s=[])).push(l.copy(u,d))}}if(s){let a=new vr(s.sort(Wl),Nc);return r?new ka([a,r]):a}return r||ds}eq(e){if(this==e)return!0;if(!(e instanceof vr)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return Tw(this.localsInner(e))}localsInner(e){if(this==ds)return Nc;if(e.inlineContent||!this.local.some(Ba.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Ba||n.push(this.local[r]);return n}forEachSet(e){e(this)}}vr.empty=new vr([],[]);vr.removeOverlap=Tw;const ds=vr.empty;class ka{constructor(e){this.members=e}map(e,n){const r=this.members.map(s=>s.map(e,n,Vl));return ka.from(r)}forChild(e,n){if(n.isLeaf)return vr.empty;let r=[];for(let s=0;s<this.members.length;s++){let i=this.members[s].forChild(e,n);i!=ds&&(i instanceof ka?r=r.concat(i.members):r.push(i))}return ka.from(r)}eq(e){if(!(e instanceof ka)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let s=0;s<this.members.length;s++){let i=this.members[s].localsInner(e);if(i.length)if(!n)n=i;else{r&&(n=n.slice(),r=!1);for(let o=0;o<i.length;o++)n.push(i[o])}}return n?Tw(r?n:n.sort(Wl)):Nc}static from(e){switch(e.length){case 0:return ds;case 1:return e[0];default:return new ka(e.every(n=>n instanceof vr)?e:e.reduce((n,r)=>n.concat(r instanceof vr?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function t7(t,e,n,r,s,i,o){let a=t.slice();for(let u=0,d=i;u<n.maps.length;u++){let f=0;n.maps[u].forEach((h,p,m,y)=>{let b=y-m-(p-h);for(let g=0;g<a.length;g+=3){let v=a[g+1];if(v<0||h>v+d-f)continue;let w=a[g]+d-f;p>=w?a[g+1]=h<=w?-2:-1:h>=d&&b&&(a[g]+=b,a[g+1]+=b)}f+=b}),d=n.maps[u].map(d,-1)}let l=!1;for(let u=0;u<a.length;u+=3)if(a[u+1]<0){if(a[u+1]==-2){l=!0,a[u+1]=-1;continue}let d=n.map(t[u]+i),f=d-s;if(f<0||f>=r.content.size){l=!0;continue}let h=n.map(t[u+1]+i,-1),p=h-s,{index:m,offset:y}=r.content.findIndex(f),b=r.maybeChild(m);if(b&&y==f&&y+b.nodeSize==p){let g=a[u+2].mapInner(n,b,d+1,t[u]+i+1,o);g!=ds?(a[u]=f,a[u+1]=p,a[u+2]=g):(a[u+1]=-2,l=!0)}else l=!0}if(l){let u=n7(a,t,e,n,s,i,o),d=Em(u,r,0,o);e=d.local;for(let f=0;f<a.length;f+=3)a[f+1]<0&&(a.splice(f,3),f-=3);for(let f=0,h=0;f<d.children.length;f+=3){let p=d.children[f];for(;h<a.length&&a[h]<p;)h+=3;a.splice(h,0,d.children[f],d.children[f+1],d.children[f+2])}}return new vr(e.sort(Wl),a)}function JA(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let s=t[r];n.push(new zs(s.from+e,s.to+e,s.type))}return n}function n7(t,e,n,r,s,i,o){function a(l,u){for(let d=0;d<l.local.length;d++){let f=l.local[d].map(r,s,u);f?n.push(f):o.onRemove&&o.onRemove(l.local[d].spec)}for(let d=0;d<l.children.length;d+=3)a(l.children[d+2],l.children[d]+u+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+i+1);return n}function XA(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,s=null;for(let i=0,o;i<t.length;i++)(o=t[i])&&o.from>n&&o.to<r&&((s||(s=[])).push(o),t[i]=null);return s}function QA(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function Em(t,e,n,r){let s=[],i=!1;e.forEach((a,l)=>{let u=XA(t,a,l+n);if(u){i=!0;let d=Em(u,a,n+l+1,r);d!=ds&&s.push(l,l+a.nodeSize,d)}});let o=JA(i?QA(t):t,-n).sort(Wl);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||s.length?new vr(o,s):ds}function Wl(t,e){return t.from-e.from||t.to-e.to}function Tw(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let s=n+1;s<e.length;s++){let i=e[s];if(i.from==r.from){i.to!=r.to&&(e==t&&(e=t.slice()),e[s]=i.copy(i.from,r.to),gT(e,s+1,i.copy(r.to,i.to)));continue}else{i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),gT(e,s,r.copy(i.from,r.to)));break}}}return e}function gT(t,e,n){for(;e<t.length&&Wl(n,t[e])>0;)e++;t.splice(e,0,n)}function yy(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=ds&&e.push(r)}),t.cursorWrapper&&e.push(vr.create(t.state.doc,[t.cursorWrapper.deco])),ka.from(e)}const r7={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},s7=Hs&&za<=11;class i7{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class o7{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new i7,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let s=0;s<r.length;s++)this.queue.push(r[s]);Hs&&za<=11&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),s7&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,r7)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(lT(this.view)){if(this.suppressingSelectionUpdates)return Ho(this.view);if(Hs&&za<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&ec(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let i=e.focusNode;i;i=_u(i))n.add(i);for(let i=e.anchorNode;i;i=_u(i))if(n.has(i)){r=i;break}let s=r&&this.view.docView.nearestDesc(r);if(s&&s.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&lT(e)&&!this.ignoreSelectionChange(r),i=-1,o=-1,a=!1,l=[];if(e.editable)for(let d=0;d<n.length;d++){let f=this.registerMutation(n[d],l);f&&(i=i<0?f.from:Math.min(f.from,i),o=o<0?f.to:Math.max(f.to,o),f.typeOver&&(a=!0))}if(ji&&l.length){let d=l.filter(f=>f.nodeName=="BR");if(d.length==2){let[f,h]=d;f.parentNode&&f.parentNode.parentNode==h.parentNode?h.remove():f.remove()}else{let{focusNode:f}=this.currentSelection;for(let h of d){let p=h.parentNode;p&&p.nodeName=="LI"&&(!f||c7(e,f)!=p)&&h.remove()}}}else if((Fr||gs)&&l.some(d=>d.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let d of l)if(d.nodeName=="BR"&&d.parentNode){let f=d.nextSibling;f&&f.nodeType==1&&f.contentEditable=="false"&&d.parentNode.removeChild(d)}}let u=null;i<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Ug(r)&&(u=xw(e))&&u.eq(mn.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Ho(e),this.currentSelection.set(r),e.scrollToSelection()):(i>-1||s)&&(i>-1&&(e.docView.markDirty(i,o),a7(e)),this.handleDOMChange(i,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||Ho(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let d=0;d<e.addedNodes.length;d++){let f=e.addedNodes[d];n.push(f),f.nodeType==3&&(this.lastChangedTextNode=f)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let s=e.previousSibling,i=e.nextSibling;if(Hs&&za<=11&&e.addedNodes.length)for(let d=0;d<e.addedNodes.length;d++){let{previousSibling:f,nextSibling:h}=e.addedNodes[d];(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(s=f),(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(i=h)}let o=s&&s.parentNode==e.target?Qr(s)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=i&&i.parentNode==e.target?Qr(i):e.target.childNodes.length,u=r.localPosFromDOM(e.target,l,1);return{from:a,to:u}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let yT=new WeakMap,xT=!1;function a7(t){if(!yT.has(t)&&(yT.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=ji,xT)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),xT=!0}}function bT(t,e){let n=e.startContainer,r=e.startOffset,s=e.endContainer,i=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return ec(o.node,o.offset,s,i)&&([n,r,s,i]=[s,i,n,r]),{anchorNode:n,anchorOffset:r,focusNode:s,focusOffset:i}}function l7(t,e){if(e.getComposedRanges){let s=e.getComposedRanges(t.root)[0];if(s)return bT(t,s)}let n;function r(s){s.preventDefault(),s.stopImmediatePropagation(),n=s.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?bT(t,n):null}function c7(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function u7(t,e,n){let{node:r,fromOffset:s,toOffset:i,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),u,d=l.anchorNode;if(d&&t.dom.contains(d.nodeType==1?d:d.parentNode)&&(u=[{node:d,offset:l.anchorOffset}],Ug(l)||u.push({node:l.focusNode,offset:l.focusOffset})),Fr&&t.input.lastKeyCode===8)for(let b=i;b>s;b--){let g=r.childNodes[b-1],v=g.pmViewDesc;if(g.nodeName=="BR"&&!v){i=b;break}if(!v||v.size)break}let f=t.state.doc,h=t.someProp("domParser")||$a.fromSchema(t.state.schema),p=f.resolve(o),m=null,y=h.parse(r,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:s,to:i,preserveWhitespace:p.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:d7,context:p});if(u&&u[0].pos!=null){let b=u[0].pos,g=u[1]&&u[1].pos;g==null&&(g=b),m={anchor:b+o,head:g+o}}return{doc:y,sel:m,from:o,to:a}}function d7(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(gs&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||gs&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const f7=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function h7(t,e,n,r,s){let i=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let M=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,S=xw(t,M);if(S&&!t.state.selection.eq(S)){if(Fr&&zo&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",_=>_(t,Sl(13,"Enter"))))return;let C=t.state.tr.setSelection(S);M=="pointer"?C.setMeta("pointer",!0):M=="key"&&C.scrollIntoView(),i&&C.setMeta("composition",i),t.dispatch(C)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l=t.state.selection,u=u7(t,e,n),d=t.state.doc,f=d.slice(u.from,u.to),h,p;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(h=t.state.selection.to,p="end"):(h=t.state.selection.from,p="start"),t.input.lastKeyCode=null;let m=g7(f.content,u.doc.content,u.from,h,p);if(m&&t.input.domChangeCount++,(Tu&&t.input.lastIOSEnter>Date.now()-225||zo)&&s.some(M=>M.nodeType==1&&!f7.test(M.nodeName))&&(!m||m.endA>=m.endB)&&t.someProp("handleKeyDown",M=>M(t,Sl(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!m)if(r&&l instanceof pn&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))m={start:l.from,endA:l.to,endB:l.to};else{if(u.sel){let M=vT(t,t.state.doc,u.sel);if(M&&!M.eq(t.state.selection)){let S=t.state.tr.setSelection(M);i&&S.setMeta("composition",i),t.dispatch(S)}}return}t.state.selection.from<t.state.selection.to&&m.start==m.endB&&t.state.selection instanceof pn&&(m.start>t.state.selection.from&&m.start<=t.state.selection.from+2&&t.state.selection.from>=u.from?m.start=t.state.selection.from:m.endA<t.state.selection.to&&m.endA>=t.state.selection.to-2&&t.state.selection.to<=u.to&&(m.endB+=t.state.selection.to-m.endA,m.endA=t.state.selection.to)),Hs&&za<=11&&m.endB==m.start+1&&m.endA==m.start&&m.start>u.from&&u.doc.textBetween(m.start-u.from-1,m.start-u.from+1)==" "&&(m.start--,m.endA--,m.endB--);let y=u.doc.resolveNoCache(m.start-u.from),b=u.doc.resolveNoCache(m.endB-u.from),g=d.resolve(m.start),v=y.sameParent(b)&&y.parent.inlineContent&&g.end()>=m.endA;if((Tu&&t.input.lastIOSEnter>Date.now()-225&&(!v||s.some(M=>M.nodeName=="DIV"||M.nodeName=="P"))||!v&&y.pos<u.doc.content.size&&(!y.sameParent(b)||!y.parent.inlineContent)&&y.pos<b.pos&&!/\S/.test(u.doc.textBetween(y.pos,b.pos,"","")))&&t.someProp("handleKeyDown",M=>M(t,Sl(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>m.start&&m7(d,m.start,m.endA,y,b)&&t.someProp("handleKeyDown",M=>M(t,Sl(8,"Backspace")))){zo&&Fr&&t.domObserver.suppressSelectionUpdates();return}Fr&&m.endB==m.start&&(t.input.lastChromeDelete=Date.now()),zo&&!v&&y.start()!=b.start()&&b.parentOffset==0&&y.depth==b.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==m.endA&&(m.endB-=2,b=u.doc.resolveNoCache(m.endB-u.from),setTimeout(()=>{t.someProp("handleKeyDown",function(M){return M(t,Sl(13,"Enter"))})},20));let w=m.start,T=m.endA,R=M=>{let S=M||t.state.tr.replace(w,T,u.doc.slice(m.start-u.from,m.endB-u.from));if(u.sel){let C=vT(t,S.doc,u.sel);C&&!(Fr&&t.composing&&C.empty&&(m.start!=m.endB||t.input.lastChromeDelete<Date.now()-100)&&(C.head==w||C.head==S.mapping.map(T)-1)||Hs&&C.empty&&C.head==w)&&S.setSelection(C)}return i&&S.setMeta("composition",i),S.scrollIntoView()},k;if(v)if(y.pos==b.pos){Hs&&za<=11&&y.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>Ho(t),20));let M=R(t.state.tr.delete(w,T)),S=d.resolve(m.start).marksAcross(d.resolve(m.endA));S&&M.ensureMarks(S),t.dispatch(M)}else if(m.endA==m.endB&&(k=p7(y.parent.content.cut(y.parentOffset,b.parentOffset),g.parent.content.cut(g.parentOffset,m.endA-g.start())))){let M=R(t.state.tr);k.type=="add"?M.addMark(w,T,k.mark):M.removeMark(w,T,k.mark),t.dispatch(M)}else if(y.parent.child(y.index()).isText&&y.index()==b.index()-(b.textOffset?0:1)){let M=y.parent.textBetween(y.parentOffset,b.parentOffset),S=()=>R(t.state.tr.insertText(M,w,T));t.someProp("handleTextInput",C=>C(t,w,T,M,S))||t.dispatch(S())}else t.dispatch(R());else t.dispatch(R())}function vT(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:bw(t,e.resolve(n.anchor),e.resolve(n.head))}function p7(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,s=n,i=r,o,a,l;for(let d=0;d<r.length;d++)s=r[d].removeFromSet(s);for(let d=0;d<n.length;d++)i=n[d].removeFromSet(i);if(s.length==1&&i.length==0)a=s[0],o="add",l=d=>d.mark(a.addToSet(d.marks));else if(s.length==0&&i.length==1)a=i[0],o="remove",l=d=>d.mark(a.removeFromSet(d.marks));else return null;let u=[];for(let d=0;d<e.childCount;d++)u.push(l(e.child(d)));if(jt.from(u).eq(t))return{mark:a,type:o}}function m7(t,e,n,r,s){if(n-e<=s.pos-r.pos||xy(r,!0,!1)<s.pos)return!1;let i=t.resolve(e);if(!r.parent.isTextblock){let a=i.nodeAfter;return a!=null&&n==e+a.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=t.resolve(xy(i,!0,!0));return!o.parent.isTextblock||o.pos>n||xy(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function xy(t,e,n){let r=t.depth,s=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,s++,e=!1;if(n){let i=t.node(r).maybeChild(t.indexAfter(r));for(;i&&!i.isLeaf;)i=i.firstChild,s++}return s}function g7(t,e,n,r,s){let i=t.findDiffStart(e,n);if(i==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(s=="end"){let l=Math.max(0,i-Math.min(o,a));r-=o+l-i}if(o<i&&t.size<e.size){let l=r<=i&&r>=o?i-r:0;i-=l,i&&i<e.size&&wT(e.textBetween(i-1,i+1))&&(i+=l?1:-1),a=i+(a-o),o=i}else if(a<i){let l=r<=i&&r>=a?i-r:0;i-=l,i&&i<t.size&&wT(t.textBetween(i-1,i+1))&&(i+=l?1:-1),o=i+(o-a),a=i}return{start:i,endA:o,endB:a}}function wT(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class ZA{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new AV,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(CT),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=_T(this),ST(this),this.nodeViews=TT(this),this.docView=nT(this.state.doc,kT(this),yy(this),this.dom,this),this.domObserver=new o7(this,(r,s,i,o)=>h7(this,r,s,i,o)),this.domObserver.start(),RV(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&G1(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(CT),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let s=this.state,i=!1,o=!1;e.storedMarks&&this.composing&&(KA(this),o=!0),this.state=e;let a=s.plugins!=e.plugins||this._props.plugins!=n.plugins;if(a||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let p=TT(this);x7(p,this.nodeViews)&&(this.nodeViews=p,i=!0)}(a||n.handleDOMEvents!=this._props.handleDOMEvents)&&G1(this),this.editable=_T(this),ST(this);let l=yy(this),u=kT(this),d=s.plugins!=e.plugins&&!s.doc.eq(e.doc)?"reset":e.scrollToSelection>s.scrollToSelection?"to selection":"preserve",f=i||!this.docView.matchesNode(e.doc,u,l);(f||!e.selection.eq(s.selection))&&(o=!0);let h=d=="preserve"&&o&&this.dom.style.overflowAnchor==null&&qH(this);if(o){this.domObserver.stop();let p=f&&(Hs||Fr)&&!this.composing&&!s.selection.empty&&!e.selection.empty&&y7(s.selection,e.selection);if(f){let m=Fr?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=qV(this)),(i||!this.docView.update(e.doc,u,l,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=nT(e.doc,u,l,this.dom,this)),m&&!this.trackWrites&&(p=!0)}p||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&xV(this))?Ho(this,p):(RA(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),!((r=this.dragging)===null||r===void 0)&&r.node&&!s.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,s),d=="reset"?this.dom.scrollTop=0:d=="to selection"?this.scrollToSelection():h&&YH(h)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof en){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&J_(this,n.getBoundingClientRect(),e)}else J_(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,s=-1;if(this.state.doc.nodeAt(r.from)==r.node)s=r.from;else{let i=r.from+(this.state.doc.content.size-n.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==r.node&&(s=i)}this.dragging=new qA(e.slice,e.move,s<0?void 0:en.create(this.state.doc,s))}someProp(e,n){let r=this._props&&this._props[e],s;if(r!=null&&(s=n?n(r):r))return s;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(s=n?n(a):a))return s}let i=this.state.plugins;if(i)for(let o=0;o<i.length;o++){let a=i[o].props[e];if(a!=null&&(s=n?n(a):a))return s}}hasFocus(){if(Hs){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&JH(this.dom),Ho(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return tV(this,e)}coordsAtPos(e,n=1){return CA(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let s=this.docView.posFromDOM(e,n,r);if(s==null)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(e,n){return oV(this,n||this.state,e)}pasteHTML(e,n){return Df(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return Df(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return vw(this,e)}destroy(){this.docView&&(OV(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],yy(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,$H())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return LV(this,e)}domSelectionRange(){let e=this.domSelection();return e?gs&&this.root.nodeType===11&&HH(this.dom.ownerDocument)==this.dom&&l7(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}ZA.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function kT(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[zs.node(0,t.state.doc.content.size,e)]}function ST(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:zs.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function _T(t){return!t.someProp("editable",e=>e(t.state)===!1)}function y7(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function TT(t){let e=Object.create(null);function n(r){for(let s in r)Object.prototype.hasOwnProperty.call(e,s)||(e[s]=r[s])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function x7(t,e){let n=0,r=0;for(let s in t){if(t[s]!=e[s])return!0;n++}for(let s in e)r++;return n!=r}function CT(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var qa={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Nm={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},b7=typeof navigator<"u"&&/Mac/.test(navigator.platform),v7=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Zr=0;Zr<10;Zr++)qa[48+Zr]=qa[96+Zr]=String(Zr);for(var Zr=1;Zr<=24;Zr++)qa[Zr+111]="F"+Zr;for(var Zr=65;Zr<=90;Zr++)qa[Zr]=String.fromCharCode(Zr+32),Nm[Zr]=String.fromCharCode(Zr);for(var by in qa)Nm.hasOwnProperty(by)||(Nm[by]=qa[by]);function w7(t){var e=b7&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||v7&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?Nm:qa)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const k7=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),S7=typeof navigator<"u"&&/Win/.test(navigator.platform);function _7(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,s,i,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))k7?o=!0:s=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),s&&(n="Ctrl-"+n),o&&(n="Meta-"+n),i&&(n="Shift-"+n),n}function T7(t){let e=Object.create(null);for(let n in t)e[_7(n)]=t[n];return e}function vy(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function C7(t){return new jr({props:{handleKeyDown:e5(t)}})}function e5(t){let e=T7(t);return function(n,r){let s=w7(r),i,o=e[vy(s,r)];if(o&&o(n.state,n.dispatch,n))return!0;if(s.length==1&&s!=" "){if(r.shiftKey){let a=e[vy(s,r,!1)];if(a&&a(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(S7&&r.ctrlKey&&r.altKey)&&(i=qa[r.keyCode])&&i!=s){let a=e[vy(i,r)];if(a&&a(n.state,n.dispatch,n))return!0}}return!1}}const E7=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function t5(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const N7=(t,e,n)=>{let r=t5(t,n);if(!r)return!1;let s=Cw(r);if(!s){let o=r.blockRange(),a=o&&zu(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let i=s.nodeBefore;if(i5(t,s,e,-1))return!0;if(r.parent.content.size==0&&(Cu(i,"end")||en.isSelectable(i)))for(let o=r.depth;;o--){let a=Fg(t.doc,r.before(o),r.after(o),Kt.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(Cu(i,"end")?mn.findFrom(l.doc.resolve(l.mapping.map(s.pos,-1)),-1):en.create(l.doc,s.pos-i.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos-i.nodeSize,s.pos).scrollIntoView()),!0):!1},j7=(t,e,n)=>{let r=t5(t,n);if(!r)return!1;let s=Cw(r);return s?n5(t,s,e):!1},I7=(t,e,n)=>{let r=r5(t,n);if(!r)return!1;let s=Ew(r);return s?n5(t,s,e):!1};function n5(t,e,n){let r=e.nodeBefore,s=r,i=e.pos-1;for(;!s.isTextblock;i--){if(s.type.spec.isolating)return!1;let d=s.lastChild;if(!d)return!1;s=d}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let d=a.firstChild;if(!d)return!1;a=d}let u=Fg(t.doc,i,l,Kt.empty);if(!u||u.from!=i||u instanceof zr&&u.slice.size>=l-i)return!1;if(n){let d=t.tr.step(u);d.setSelection(pn.create(d.doc,i)),n(d.scrollIntoView())}return!0}function Cu(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const M7=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;i=Cw(r)}let o=i&&i.nodeBefore;return!o||!en.isSelectable(o)?!1:(e&&e(t.tr.setSelection(en.create(t.doc,i.pos-o.nodeSize)).scrollIntoView()),!0)};function Cw(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function r5(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const D7=(t,e,n)=>{let r=r5(t,n);if(!r)return!1;let s=Ew(r);if(!s)return!1;let i=s.nodeAfter;if(i5(t,s,e,1))return!0;if(r.parent.content.size==0&&(Cu(i,"start")||en.isSelectable(i))){let o=Fg(t.doc,r.before(),r.after(),Kt.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(Cu(i,"start")?mn.findFrom(a.doc.resolve(a.mapping.map(s.pos)),1):en.create(a.doc,a.mapping.map(s.pos))),e(a.scrollIntoView())}return!0}}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos,s.pos+i.nodeSize).scrollIntoView()),!0):!1},A7=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;i=Ew(r)}let o=i&&i.nodeAfter;return!o||!en.isSelectable(o)?!1:(e&&e(t.tr.setSelection(en.create(t.doc,i.pos)).scrollIntoView()),!0)};function Ew(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const R7=(t,e)=>{let n=t.selection,r=n instanceof en,s;if(r){if(n.node.isTextblock||!tl(t.doc,n.from))return!1;s=n.from}else if(s=zg(t.doc,n.from,-1),s==null)return!1;if(e){let i=t.tr.join(s);r&&i.setSelection(en.create(i.doc,s-t.doc.resolve(s).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},O7=(t,e)=>{let n=t.selection,r;if(n instanceof en){if(n.node.isTextblock||!tl(t.doc,n.to))return!1;r=n.to}else if(r=zg(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},P7=(t,e)=>{let{$from:n,$to:r}=t.selection,s=n.blockRange(r),i=s&&zu(s);return i==null?!1:(e&&e(t.tr.lift(s,i).scrollIntoView()),!0)},L7=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function s5(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const $7=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let s=n.node(-1),i=n.indexAfter(-1),o=s5(s.contentMatchAt(i));if(!o||!s.canReplaceWith(i,i,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(mn.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},z7=(t,e)=>{let n=t.selection,{$from:r,$to:s}=n;if(n instanceof Ni||r.parent.inlineContent||s.parent.inlineContent)return!1;let i=s5(s.parent.contentMatchAt(s.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let o=(!r.parentOffset&&s.index()<s.parent.childCount?r:s).pos,a=t.tr.insert(o,i.createAndFill());a.setSelection(pn.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},F7=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let i=n.before();if(lu(t.doc,i))return e&&e(t.tr.split(i).scrollIntoView()),!0}let r=n.blockRange(),s=r&&zu(r);return s==null?!1:(e&&e(t.tr.lift(r,s).scrollIntoView()),!0)},B7=(t,e)=>{let{$from:n,to:r}=t.selection,s,i=n.sharedDepth(r);return i==0?!1:(s=n.before(i),e&&e(t.tr.setSelection(en.create(t.doc,s))),!0)};function U7(t,e,n){let r=e.nodeBefore,s=e.nodeAfter,i=e.index();return!r||!s||!r.type.compatibleContent(s.type)?!1:!r.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(s.isTextblock||tl(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function i5(t,e,n,r){let s=e.nodeBefore,i=e.nodeAfter,o,a,l=s.type.spec.isolating||i.type.spec.isolating;if(!l&&U7(t,e,n))return!0;let u=!l&&e.parent.canReplace(e.index(),e.index()+1);if(u&&(o=(a=s.contentMatchAt(s.childCount)).findWrapping(i.type))&&a.matchType(o[0]||i.type).validEnd){if(n){let p=e.pos+i.nodeSize,m=jt.empty;for(let g=o.length-1;g>=0;g--)m=jt.from(o[g].create(null,m));m=jt.from(s.copy(m));let y=t.tr.step(new Ur(e.pos-1,p,e.pos,p,new Kt(m,1,0),o.length,!0)),b=y.doc.resolve(p+2*o.length);b.nodeAfter&&b.nodeAfter.type==s.type&&tl(y.doc,b.pos)&&y.join(b.pos),n(y.scrollIntoView())}return!0}let d=i.type.spec.isolating||r>0&&l?null:mn.findFrom(e,1),f=d&&d.$from.blockRange(d.$to),h=f&&zu(f);if(h!=null&&h>=e.depth)return n&&n(t.tr.lift(f,h).scrollIntoView()),!0;if(u&&Cu(i,"start",!0)&&Cu(s,"end")){let p=s,m=[];for(;m.push(p),!p.isTextblock;)p=p.lastChild;let y=i,b=1;for(;!y.isTextblock;y=y.firstChild)b++;if(p.canReplace(p.childCount,p.childCount,y.content)){if(n){let g=jt.empty;for(let w=m.length-1;w>=0;w--)g=jt.from(m[w].copy(g));let v=t.tr.step(new Ur(e.pos-m.length,e.pos+i.nodeSize,e.pos+b,e.pos+i.nodeSize-b,new Kt(g,m.length,0),0,!0));n(v.scrollIntoView())}return!0}}return!1}function o5(t){return function(e,n){let r=e.selection,s=t<0?r.$from:r.$to,i=s.depth;for(;s.node(i).isInline;){if(!i)return!1;i--}return s.node(i).isTextblock?(n&&n(e.tr.setSelection(pn.create(e.doc,t<0?s.start(i):s.end(i)))),!0):!1}}const H7=o5(-1),V7=o5(1);function W7(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,o=s.blockRange(i),a=o&&mw(o,t,e);return a?(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function ET(t,e=null){return function(n,r){let s=!1;for(let i=0;i<n.selection.ranges.length&&!s;i++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[i];n.doc.nodesBetween(o,a,(l,u)=>{if(s)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)s=!0;else{let d=n.doc.resolve(u),f=d.index();s=d.parent.canReplaceWith(f,f+1,t)}})}if(!s)return!1;if(r){let i=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[o];i.setBlockType(a,l,t,e)}r(i.scrollIntoView())}return!0}}typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function K7(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,o=s.blockRange(i);if(!o)return!1;let a=r?n.tr:null;return G7(a,o,t,e)?(r&&r(a.scrollIntoView()),!0):!1}}function G7(t,e,n,r=null){let s=!1,i=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);i=new wm(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new wm(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),s=!0}let a=mw(i,n,r,e);return a?(t&&q7(t,e,a,s,n),!0):!1}function q7(t,e,n,r,s){let i=jt.empty;for(let d=n.length-1;d>=0;d--)i=jt.from(n[d].type.create(n[d].attrs,i));t.step(new Ur(e.start-(r?2:0),e.end,e.start,e.end,new Kt(i,0,0),n.length,!0));let o=0;for(let d=0;d<n.length;d++)n[d].type==s&&(o=d+1);let a=n.length-o,l=e.start+n.length-(r?2:0),u=e.parent;for(let d=e.startIndex,f=e.endIndex,h=!0;d<f;d++,h=!1)!h&&lu(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=u.child(d).nodeSize;return t}function Y7(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,o=>o.childCount>0&&o.firstChild.type==t);return i?n?r.node(i.depth-1).type==t?J7(e,n,t,i):X7(e,n,i):!0:!1}}function J7(t,e,n,r){let s=t.tr,i=r.end,o=r.$to.end(r.depth);i<o&&(s.step(new Ur(i-1,o,i,o,new Kt(jt.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new wm(s.doc.resolve(r.$from.pos),s.doc.resolve(o),r.depth));const a=zu(r);if(a==null)return!1;s.lift(r,a);let l=s.doc.resolve(s.mapping.map(i,-1)-1);return tl(s.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&s.join(l.pos),e(s.scrollIntoView()),!0}function X7(t,e,n){let r=t.tr,s=n.parent;for(let p=n.end,m=n.endIndex-1,y=n.startIndex;m>y;m--)p-=s.child(m).nodeSize,r.delete(p-1,p+1);let i=r.doc.resolve(n.start),o=i.nodeAfter;if(r.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==s.childCount,u=i.node(-1),d=i.index(-1);if(!u.canReplace(d+(a?0:1),d+1,o.content.append(l?jt.empty:jt.from(s))))return!1;let f=i.pos,h=f+o.nodeSize;return r.step(new Ur(f-(a?1:0),h+(l?1:0),f+1,h-1,new Kt((a?jt.empty:jt.from(s.copy(jt.empty))).append(l?jt.empty:jt.from(s.copy(jt.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function Q7(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,u=>u.childCount>0&&u.firstChild.type==t);if(!i)return!1;let o=i.startIndex;if(o==0)return!1;let a=i.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let u=l.lastChild&&l.lastChild.type==a.type,d=jt.from(u?t.create():null),f=new Kt(jt.from(t.create(null,jt.from(a.type.create(null,d)))),u?3:1,0),h=i.start,p=i.end;n(e.tr.step(new Ur(h-(u?3:1),p,h,p,f,1,!0)).scrollIntoView())}return!0}}function Wg(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:s}=n,{storedMarks:i}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return r},get doc(){return s},get tr(){return r=n.selection,s=n.doc,i=n.storedMarks,n}}}class Kg{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:r}=this,{view:s}=n,{tr:i}=r,o=this.buildProps(i);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...d)=>{const f=l(...d)(o);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(i),f}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,a=[],l=!!e,u=e||i.tr,d=()=>(!l&&n&&!u.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(u),a.every(h=>h===!0)),f={...Object.fromEntries(Object.entries(r).map(([h,p])=>[h,(...y)=>{const b=this.buildProps(u,n),g=p(...y)(b);return a.push(g),f}])),run:d};return f}createCan(e){const{rawCommands:n,state:r}=this,s=!1,i=e||r.tr,o=this.buildProps(i,s);return{...Object.fromEntries(Object.entries(n).map(([l,u])=>[l,(...d)=>u(...d)({...o,dispatch:void 0})])),chain:()=>this.createChain(i,s)}}buildProps(e,n=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,a={tr:e,editor:s,view:o,state:Wg({state:i,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e,n),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([l,u])=>[l,(...d)=>u(...d)(a)]))}};return a}}class Z7{constructor(){this.callbacks={}}on(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),this}emit(e,...n){const r=this.callbacks[e];return r&&r.forEach(s=>s.apply(this,n)),this}off(e,n){const r=this.callbacks[e];return r&&(n?this.callbacks[e]=r.filter(s=>s!==n):delete this.callbacks[e]),this}once(e,n){const r=(...s)=>{this.off(e,r),n.apply(this,s)};return this.on(e,r)}removeAllListeners(){this.callbacks={}}}function Yt(t,e,n){return t.config[e]===void 0&&t.parent?Yt(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?Yt(t.parent,e,n):null}):t.config[e]}function Gg(t){const e=t.filter(s=>s.type==="extension"),n=t.filter(s=>s.type==="node"),r=t.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function a5(t){const e=[],{nodeExtensions:n,markExtensions:r}=Gg(t),s=[...n,...r],i={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:s},l=Yt(o,"addGlobalAttributes",a);if(!l)return;l().forEach(d=>{d.types.forEach(f=>{Object.entries(d.attributes).forEach(([h,p])=>{e.push({type:f,name:h,attribute:{...i,...p}})})})})}),s.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=Yt(o,"addAttributes",a);if(!l)return;const u=l();Object.entries(u).forEach(([d,f])=>{const h={...i,...f};typeof(h==null?void 0:h.default)=="function"&&(h.default=h.default()),h!=null&&h.isRequired&&(h==null?void 0:h.default)===void 0&&delete h.default,e.push({type:o.name,name:d,attribute:h})})}),e}function Vr(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function In(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([s,i])=>{if(!r[s]){r[s]=i;return}if(s==="class"){const a=i?String(i).split(" "):[],l=r[s]?r[s].split(" "):[],u=a.filter(d=>!l.includes(d));r[s]=[...l,...u].join(" ")}else if(s==="style"){const a=i?i.split(";").map(d=>d.trim()).filter(Boolean):[],l=r[s]?r[s].split(";").map(d=>d.trim()).filter(Boolean):[],u=new Map;l.forEach(d=>{const[f,h]=d.split(":").map(p=>p.trim());u.set(f,h)}),a.forEach(d=>{const[f,h]=d.split(":").map(p=>p.trim());u.set(f,h)}),r[s]=Array.from(u.entries()).map(([d,f])=>`${d}: ${f}`).join("; ")}else r[s]=i}),r},{})}function q1(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>In(n,r),{})}function l5(t){return typeof t=="function"}function wn(t,e=void 0,...n){return l5(t)?e?t.bind(e)(...n):t(...n):t}function eW(t={}){return Object.keys(t).length===0&&t.constructor===Object}function tW(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function NT(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const s=e.reduce((i,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):tW(n.getAttribute(o.name));return a==null?i:{...i,[o.name]:a}},{});return{...r,...s}}}}function jT(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&eW(n)?!1:n!=null))}function nW(t,e){var n;const r=a5(t),{nodeExtensions:s,markExtensions:i}=Gg(t),o=(n=s.find(u=>Yt(u,"topNode")))===null||n===void 0?void 0:n.name,a=Object.fromEntries(s.map(u=>{const d=r.filter(g=>g.type===u.name),f={name:u.name,options:u.options,storage:u.storage,editor:e},h=t.reduce((g,v)=>{const w=Yt(v,"extendNodeSchema",f);return{...g,...w?w(u):{}}},{}),p=jT({...h,content:wn(Yt(u,"content",f)),marks:wn(Yt(u,"marks",f)),group:wn(Yt(u,"group",f)),inline:wn(Yt(u,"inline",f)),atom:wn(Yt(u,"atom",f)),selectable:wn(Yt(u,"selectable",f)),draggable:wn(Yt(u,"draggable",f)),code:wn(Yt(u,"code",f)),whitespace:wn(Yt(u,"whitespace",f)),linebreakReplacement:wn(Yt(u,"linebreakReplacement",f)),defining:wn(Yt(u,"defining",f)),isolating:wn(Yt(u,"isolating",f)),attrs:Object.fromEntries(d.map(g=>{var v;return[g.name,{default:(v=g==null?void 0:g.attribute)===null||v===void 0?void 0:v.default}]}))}),m=wn(Yt(u,"parseHTML",f));m&&(p.parseDOM=m.map(g=>NT(g,d)));const y=Yt(u,"renderHTML",f);y&&(p.toDOM=g=>y({node:g,HTMLAttributes:q1(g,d)}));const b=Yt(u,"renderText",f);return b&&(p.toText=b),[u.name,p]})),l=Object.fromEntries(i.map(u=>{const d=r.filter(b=>b.type===u.name),f={name:u.name,options:u.options,storage:u.storage,editor:e},h=t.reduce((b,g)=>{const v=Yt(g,"extendMarkSchema",f);return{...b,...v?v(u):{}}},{}),p=jT({...h,inclusive:wn(Yt(u,"inclusive",f)),excludes:wn(Yt(u,"excludes",f)),group:wn(Yt(u,"group",f)),spanning:wn(Yt(u,"spanning",f)),code:wn(Yt(u,"code",f)),attrs:Object.fromEntries(d.map(b=>{var g;return[b.name,{default:(g=b==null?void 0:b.attribute)===null||g===void 0?void 0:g.default}]}))}),m=wn(Yt(u,"parseHTML",f));m&&(p.parseDOM=m.map(b=>NT(b,d)));const y=Yt(u,"renderHTML",f);return y&&(p.toDOM=b=>y({mark:b,HTMLAttributes:q1(b,d)})),[u.name,p]}));return new eA({topNode:o,nodes:a,marks:l})}function wy(t,e){return e.nodes[t]||e.marks[t]||null}function IT(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function Nw(t,e){const n=oc.fromSchema(e).serializeFragment(t),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(n),s.innerHTML}const rW=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(s,i,o,a)=>{var l,u;const d=((u=(l=s.type.spec).toText)===null||u===void 0?void 0:u.call(l,{node:s,pos:i,parent:o,index:a}))||s.textContent||"%leaf%";n+=s.isAtom&&!s.isText?d:d.slice(0,Math.max(0,r-i))}),n};function jw(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class qg{constructor(e){this.find=e.find,this.handler=e.handler}}const sW=(t,e)=>{if(jw(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function zh(t){var e;const{editor:n,from:r,to:s,text:i,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const u=l.state.doc.resolve(r);if(u.parent.type.spec.code||!((e=u.nodeBefore||u.nodeAfter)===null||e===void 0)&&e.marks.find(h=>h.type.spec.code))return!1;let d=!1;const f=rW(u)+i;return o.forEach(h=>{if(d)return;const p=sW(f,h.find);if(!p)return;const m=l.state.tr,y=Wg({state:l.state,transaction:m}),b={from:r-(p[0].length-i.length),to:s},{commands:g,chain:v,can:w}=new Kg({editor:n,state:y});h.handler({state:y,range:b,match:p,commands:g,chain:v,can:w})===null||!m.steps.length||(m.setMeta(a,{transform:m,from:r,to:s,text:i}),l.dispatch(m),d=!0)}),d}function iW(t){const{editor:e,rules:n}=t,r=new jr({state:{init(){return null},apply(s,i,o){const a=s.getMeta(r);if(a)return a;const l=s.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:d}=l;typeof d=="string"?d=d:d=Nw(jt.from(d),o.schema);const{from:f}=l,h=f+d.length;zh({editor:e,from:f,to:h,text:d,rules:n,plugin:r})}),s.selectionSet||s.docChanged?null:i}},props:{handleTextInput(s,i,o,a){return zh({editor:e,from:i,to:o,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:i}=s.state.selection;i&&zh({editor:e,from:i.pos,to:i.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(s,i){if(i.key!=="Enter")return!1;const{$cursor:o}=s.state.selection;return o?zh({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function oW(t){return Object.prototype.toString.call(t).slice(8,-1)}function Fh(t){return oW(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function Yg(t,e){const n={...t};return Fh(t)&&Fh(e)&&Object.keys(e).forEach(r=>{Fh(e[r])&&Fh(t[r])?n[r]=Yg(t[r],e[r]):n[r]=e[r]}),n}class oi{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=wn(Yt(this,"addOptions",{name:this.name}))),this.storage=wn(Yt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new oi(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>Yg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new oi(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=wn(Yt(n,"addOptions",{name:n.name})),n.storage=wn(Yt(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const o=s.marks();if(!!!o.find(u=>(u==null?void 0:u.type.name)===n.name))return!1;const l=o.find(u=>(u==null?void 0:u.type.name)===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",s.pos),e.view.dispatch(r),!0}return!1}}function aW(t){return typeof t=="number"}class lW{constructor(e){this.find=e.find,this.handler=e.handler}}const cW=(t,e,n)=>{if(jw(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(s=>{const i=[s.text];return i.index=s.index,i.input=t,i.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(s.replaceWith)),i}):[]};function uW(t){const{editor:e,state:n,from:r,to:s,rule:i,pasteEvent:o,dropEvent:a}=t,{commands:l,chain:u,can:d}=new Kg({editor:e,state:n}),f=[];return n.doc.nodesBetween(r,s,(p,m)=>{if(!p.isTextblock||p.type.spec.code)return;const y=Math.max(r,m),b=Math.min(s,m+p.content.size),g=p.textBetween(y-m,b-m,void 0,"");cW(g,i.find,o).forEach(w=>{if(w.index===void 0)return;const T=y+w.index+1,R=T+w[0].length,k={from:n.tr.mapping.map(T),to:n.tr.mapping.map(R)},M=i.handler({state:n,range:k,match:w,commands:l,chain:u,can:d,pasteEvent:o,dropEvent:a});f.push(M)})}),f.every(p=>p!==null)}let Bh=null;const dW=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)===null||e===void 0||e.setData("text/html",t),n};function fW(t){const{editor:e,rules:n}=t;let r=null,s=!1,i=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:d,from:f,to:h,rule:p,pasteEvt:m})=>{const y=d.tr,b=Wg({state:d,transaction:y});if(!(!uW({editor:e,state:b,from:Math.max(f-1,0),to:h.b-1,rule:p,pasteEvent:m,dropEvent:a})||!y.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,y}};return n.map(d=>new jr({view(f){const h=m=>{var y;r=!((y=f.dom.parentElement)===null||y===void 0)&&y.contains(m.target)?f.dom.parentElement:null,r&&(Bh=e)},p=()=>{Bh&&(Bh=null)};return window.addEventListener("dragstart",h),window.addEventListener("dragend",p),{destroy(){window.removeEventListener("dragstart",h),window.removeEventListener("dragend",p)}}},props:{handleDOMEvents:{drop:(f,h)=>{if(i=r===f.dom.parentElement,a=h,!i){const p=Bh;p!=null&&p.isEditable&&setTimeout(()=>{const m=p.state.selection;m&&p.commands.deleteRange({from:m.from,to:m.to})},10)}return!1},paste:(f,h)=>{var p;const m=(p=h.clipboardData)===null||p===void 0?void 0:p.getData("text/html");return o=h,s=!!(m!=null&&m.includes("data-pm-slice")),!1}}},appendTransaction:(f,h,p)=>{const m=f[0],y=m.getMeta("uiEvent")==="paste"&&!s,b=m.getMeta("uiEvent")==="drop"&&!i,g=m.getMeta("applyPasteRules"),v=!!g;if(!y&&!b&&!v)return;if(v){let{text:R}=g;typeof R=="string"?R=R:R=Nw(jt.from(R),p.schema);const{from:k}=g,M=k+R.length,S=dW(R);return l({rule:d,state:p,from:k,to:{b:M},pasteEvt:S})}const w=h.doc.content.findDiffStart(p.doc.content),T=h.doc.content.findDiffEnd(p.doc.content);if(!(!aW(w)||!T||w===T.b))return l({rule:d,state:p,from:w,to:T,pasteEvt:o})}}))}function hW(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}class Xc{constructor(e,n){this.splittableMarks=[],this.editor=n,this.extensions=Xc.resolve(e),this.schema=nW(this.extensions,n),this.setupExtensions()}static resolve(e){const n=Xc.sort(Xc.flatten(e)),r=hW(n.map(s=>s.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(s=>`'${s}'`).join(", ")}]. This can lead to issues.`),n}static flatten(e){return e.map(n=>{const r={name:n.name,options:n.options,storage:n.storage},s=Yt(n,"addExtensions",r);return s?[n,...this.flatten(s())]:n}).flat(10)}static sort(e){return e.sort((r,s)=>{const i=Yt(r,"priority")||100,o=Yt(s,"priority")||100;return i>o?-1:i<o?1:0})}get commands(){return this.extensions.reduce((e,n)=>{const r={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:wy(n.name,this.schema)},s=Yt(n,"addCommands",r);return s?{...e,...s()}:e},{})}get plugins(){const{editor:e}=this,n=Xc.sort([...this.extensions].reverse()),r=[],s=[],i=n.map(o=>{const a={name:o.name,options:o.options,storage:o.storage,editor:e,type:wy(o.name,this.schema)},l=[],u=Yt(o,"addKeyboardShortcuts",a);let d={};if(o.type==="mark"&&Yt(o,"exitable",a)&&(d.ArrowRight=()=>oi.handleExit({editor:e,mark:o})),u){const y=Object.fromEntries(Object.entries(u()).map(([b,g])=>[b,()=>g({editor:e})]));d={...d,...y}}const f=C7(d);l.push(f);const h=Yt(o,"addInputRules",a);IT(o,e.options.enableInputRules)&&h&&r.push(...h());const p=Yt(o,"addPasteRules",a);IT(o,e.options.enablePasteRules)&&p&&s.push(...p());const m=Yt(o,"addProseMirrorPlugins",a);if(m){const y=m();l.push(...y)}return l}).flat();return[iW({editor:e,rules:r}),...fW({editor:e,rules:s}),...i]}get attributes(){return a5(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:n}=Gg(this.extensions);return Object.fromEntries(n.filter(r=>!!Yt(r,"addNodeView")).map(r=>{const s=this.attributes.filter(l=>l.type===r.name),i={name:r.name,options:r.options,storage:r.storage,editor:e,type:Vr(r.name,this.schema)},o=Yt(r,"addNodeView",i);if(!o)return[];const a=(l,u,d,f,h)=>{const p=q1(l,s);return o()({node:l,view:u,getPos:d,decorations:f,innerDecorations:h,editor:e,extension:r,HTMLAttributes:p})};return[r.name,a]}))}setupExtensions(){this.extensions.forEach(e=>{var n;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:wy(e.name,this.schema)};e.type==="mark"&&(!((n=wn(Yt(e,"keepOnSplit",r)))!==null&&n!==void 0)||n)&&this.splittableMarks.push(e.name);const s=Yt(e,"onBeforeCreate",r),i=Yt(e,"onCreate",r),o=Yt(e,"onUpdate",r),a=Yt(e,"onSelectionUpdate",r),l=Yt(e,"onTransaction",r),u=Yt(e,"onFocus",r),d=Yt(e,"onBlur",r),f=Yt(e,"onDestroy",r);s&&this.editor.on("beforeCreate",s),i&&this.editor.on("create",i),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),u&&this.editor.on("focus",u),d&&this.editor.on("blur",d),f&&this.editor.on("destroy",f)})}}class Wr{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=wn(Yt(this,"addOptions",{name:this.name}))),this.storage=wn(Yt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Wr(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>Yg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new Wr({...this.config,...e});return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=wn(Yt(n,"addOptions",{name:n.name})),n.storage=wn(Yt(n,"addStorage",{name:n.name,options:n.options})),n}}function c5(t,e,n){const{from:r,to:s}=e,{blockSeparator:i=`

`,textSerializers:o={}}=n||{};let a="";return t.nodesBetween(r,s,(l,u,d,f)=>{var h;l.isBlock&&u>r&&(a+=i);const p=o==null?void 0:o[l.type.name];if(p)return d&&(a+=p({node:l,pos:u,parent:d,index:f,range:e})),!1;l.isText&&(a+=(h=l==null?void 0:l.text)===null||h===void 0?void 0:h.slice(Math.max(r,u)-u,s-u))}),a}function u5(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}const pW=Wr.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new jr({key:new ss("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:s}=e,{ranges:i}=s,o=Math.min(...i.map(d=>d.$from.pos)),a=Math.max(...i.map(d=>d.$to.pos)),l=u5(n);return c5(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),mW=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window==null?void 0:window.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),gW=(t=!1)=>({commands:e})=>e.setContent("",t),yW=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:s}=r;return n&&s.forEach(({$from:i,$to:o})=>{t.doc.nodesBetween(i.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:u,mapping:d}=e,f=u.resolve(d.map(l)),h=u.resolve(d.map(l+a.nodeSize)),p=f.blockRange(h);if(!p)return;const m=zu(p);if(a.type.isTextblock){const{defaultType:y}=f.parent.contentMatchAt(f.index());e.setNodeMarkup(p.start,y)}(m||m===0)&&e.lift(p,m)})}),!0},xW=t=>e=>t(e),bW=()=>({state:t,dispatch:e})=>z7(t,e),vW=(t,e)=>({editor:n,tr:r})=>{const{state:s}=n,i=s.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const o=r.mapping.map(e);return r.insert(o,i.content),r.setSelection(new pn(r.doc.resolve(Math.max(o-1,0)))),!0},wW=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const s=t.selection.$anchor;for(let i=s.depth;i>0;i-=1)if(s.node(i).type===r.type){if(e){const a=s.before(i),l=s.after(i);t.delete(a,l).scrollIntoView()}return!0}return!1},kW=t=>({tr:e,state:n,dispatch:r})=>{const s=Vr(t,n.schema),i=e.selection.$anchor;for(let o=i.depth;o>0;o-=1)if(i.node(o).type===s){if(r){const l=i.before(o),u=i.after(o);e.delete(l,u).scrollIntoView()}return!0}return!1},SW=t=>({tr:e,dispatch:n})=>{const{from:r,to:s}=t;return n&&e.delete(r,s),!0},_W=()=>({state:t,dispatch:e})=>E7(t,e),TW=()=>({commands:t})=>t.keyboardShortcut("Enter"),CW=()=>({state:t,dispatch:e})=>$7(t,e);function jm(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(s=>n.strict?e[s]===t[s]:jw(e[s])?e[s].test(t[s]):e[s]===t[s]):!0}function d5(t,e,n={}){return t.find(r=>r.type===e&&jm(Object.fromEntries(Object.keys(n).map(s=>[s,r.attrs[s]])),n))}function MT(t,e,n={}){return!!d5(t,e,n)}function Iw(t,e,n){var r;if(!t||!e)return;let s=t.parent.childAfter(t.parentOffset);if((!s.node||!s.node.marks.some(d=>d.type===e))&&(s=t.parent.childBefore(t.parentOffset)),!s.node||!s.node.marks.some(d=>d.type===e)||(n=n||((r=s.node.marks[0])===null||r===void 0?void 0:r.attrs),!d5([...s.node.marks],e,n)))return;let o=s.index,a=t.start()+s.offset,l=o+1,u=a+s.node.nodeSize;for(;o>0&&MT([...t.parent.child(o-1).marks],e,n);)o-=1,a-=t.parent.child(o).nodeSize;for(;l<t.parent.childCount&&MT([...t.parent.child(l).marks],e,n);)u+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:u}}function rl(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const EW=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const i=rl(t,r.schema),{doc:o,selection:a}=n,{$from:l,from:u,to:d}=a;if(s){const f=Iw(l,i,e);if(f&&f.from<=u&&f.to>=d){const h=pn.create(o,f.from,f.to);n.setSelection(h)}}return!0},NW=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function f5(t){return t instanceof pn}function Ol(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function h5(t,e=null){if(!e)return null;const n=mn.atStart(t),r=mn.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const s=n.from,i=r.to;return e==="all"?pn.create(t,Ol(0,s,i),Ol(t.content.size,s,i)):pn.create(t,Ol(e,s,i),Ol(e,s,i))}function p5(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Jg(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const jW=(t=null,e={})=>({editor:n,view:r,tr:s,dispatch:i})=>{e={scrollIntoView:!0,...e};const o=()=>{(Jg()||p5())&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e!=null&&e.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(i&&t===null&&!f5(n.state.selection))return o(),!0;const a=h5(s.doc,t)||n.state.selection,l=n.state.selection.eq(a);return i&&(l||s.setSelection(a),l&&s.storedMarks&&s.setStoredMarks(s.storedMarks),o()),!0},IW=(t,e)=>n=>t.every((r,s)=>e(r,{...n,index:s})),MW=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),m5=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&m5(r)}return t};function Uh(t){const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return m5(n)}function Rf(t,e,n){if(t instanceof Uo||t instanceof jt)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,s=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return jt.fromArray(t.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(i){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",i),Rf("",e,n)}if(s){if(n.errorOnInvalidContent){let o=!1,a="";const l=new eA({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(o=!0,a=typeof u=="string"?u:u.outerHTML,null)}]}})});if(n.slice?$a.fromSchema(l).parseSlice(Uh(t),n.parseOptions):$a.fromSchema(l).parse(Uh(t),n.parseOptions),n.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const i=$a.fromSchema(e);return n.slice?i.parseSlice(Uh(t),n.parseOptions).content:i.parse(Uh(t),n.parseOptions)}return Rf("",e,n)}function DW(t,e,n){const r=t.steps.length-1;if(r<e)return;const s=t.steps[r];if(!(s instanceof zr||s instanceof Ur))return;const i=t.mapping.maps[r];let o=0;i.forEach((a,l,u,d)=>{o===0&&(o=d)}),t.setSelection(mn.near(t.doc.resolve(o),n))}const AW=t=>!("type"in t),RW=(t,e,n)=>({tr:r,dispatch:s,editor:i})=>{var o;if(s){n={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=b=>{i.emit("contentError",{editor:i,error:b,disableCollaboration:()=>{i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{Rf(e,i.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(b){l(b)}try{a=Rf(e,i.schema,{parseOptions:u,errorOnInvalidContent:(o=n.errorOnInvalidContent)!==null&&o!==void 0?o:i.options.enableContentCheck})}catch(b){return l(b),!1}let{from:d,to:f}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},h=!0,p=!0;if((AW(a)?a:[a]).forEach(b=>{b.check(),h=h?b.isText&&b.marks.length===0:!1,p=p?b.isBlock:!1}),d===f&&p){const{parent:b}=r.doc.resolve(d);b.isTextblock&&!b.type.spec.code&&!b.childCount&&(d-=1,f+=1)}let y;if(h){if(Array.isArray(e))y=e.map(b=>b.text||"").join("");else if(e instanceof jt){let b="";e.forEach(g=>{g.text&&(b+=g.text)}),y=b}else typeof e=="object"&&e&&e.text?y=e.text:y=e;r.insertText(y,d,f)}else y=a,r.replaceWith(d,f,y);n.updateSelection&&DW(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:d,text:y}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:d,text:y})}return!0},OW=()=>({state:t,dispatch:e})=>R7(t,e),PW=()=>({state:t,dispatch:e})=>O7(t,e),LW=()=>({state:t,dispatch:e})=>N7(t,e),$W=()=>({state:t,dispatch:e})=>D7(t,e),zW=()=>({state:t,dispatch:e,tr:n})=>{try{const r=zg(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},FW=()=>({state:t,dispatch:e,tr:n})=>{try{const r=zg(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},BW=()=>({state:t,dispatch:e})=>j7(t,e),UW=()=>({state:t,dispatch:e})=>I7(t,e);function g5(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function HW(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,s,i,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))Jg()||g5()?o=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),s&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),i&&(n=`Shift-${n}`),n}const VW=t=>({editor:e,view:n,tr:r,dispatch:s})=>{const i=HW(t).split(/-(?!$)/),o=i.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",u=>u(n,a))});return l==null||l.steps.forEach(u=>{const d=u.map(r.mapping);d&&s&&r.maybeStep(d)}),!0};function Of(t,e,n={}){const{from:r,to:s,empty:i}=t.selection,o=e?Vr(e,t.schema):null,a=[];t.doc.nodesBetween(r,s,(f,h)=>{if(f.isText)return;const p=Math.max(r,h),m=Math.min(s,h+f.nodeSize);a.push({node:f,from:p,to:m})});const l=s-r,u=a.filter(f=>o?o.name===f.node.type.name:!0).filter(f=>jm(f.node.attrs,n,{strict:!1}));return i?!!u.length:u.reduce((f,h)=>f+h.to-h.from,0)>=l}const WW=(t,e={})=>({state:n,dispatch:r})=>{const s=Vr(t,n.schema);return Of(n,s,e)?P7(n,r):!1},KW=()=>({state:t,dispatch:e})=>F7(t,e),GW=t=>({state:e,dispatch:n})=>{const r=Vr(t,e.schema);return Y7(r)(e,n)},qW=()=>({state:t,dispatch:e})=>L7(t,e);function Xg(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function DT(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,s)=>(n.includes(s)||(r[s]=t[s]),r),{})}const YW=(t,e)=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=Xg(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(i=Vr(t,r.schema)),a==="mark"&&(o=rl(t,r.schema)),s&&n.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(u,d)=>{i&&i===u.type&&n.setNodeMarkup(d,void 0,DT(u.attrs,e)),o&&u.marks.length&&u.marks.forEach(f=>{o===f.type&&n.addMark(d,d+u.nodeSize,o.create(DT(f.attrs,e)))})})}),!0):!1},JW=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),XW=()=>({tr:t,dispatch:e})=>{if(e){const n=new Ni(t.doc);t.setSelection(n)}return!0},QW=()=>({state:t,dispatch:e})=>M7(t,e),ZW=()=>({state:t,dispatch:e})=>A7(t,e),eK=()=>({state:t,dispatch:e})=>B7(t,e),tK=()=>({state:t,dispatch:e})=>V7(t,e),nK=()=>({state:t,dispatch:e})=>H7(t,e);function Y1(t,e,n={},r={}){return Rf(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}const rK=(t,e=!1,n={},r={})=>({editor:s,tr:i,dispatch:o,commands:a})=>{var l,u;const{doc:d}=i;if(n.preserveWhitespace!=="full"){const f=Y1(t,s.schema,n,{errorOnInvalidContent:(l=r.errorOnInvalidContent)!==null&&l!==void 0?l:s.options.enableContentCheck});return o&&i.replaceWith(0,d.content.size,f).setMeta("preventUpdate",!e),!0}return o&&i.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:d.content.size},t,{parseOptions:n,errorOnInvalidContent:(u=r.errorOnInvalidContent)!==null&&u!==void 0?u:s.options.enableContentCheck})};function y5(t,e){const n=rl(e,t.schema),{from:r,to:s,empty:i}=t.selection,o=[];i?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,s,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function sK(t,e){const n=new gA(t);return e.forEach(r=>{r.steps.forEach(s=>{n.step(s)})}),n}function Mw(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function Tp(t,e){const n=[];return t.descendants((r,s)=>{e(r)&&n.push({node:r,pos:s})}),n}function iK(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(s,i)=>{n(s)&&r.push({node:s,pos:i})}),r}function oK(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function Fu(t){return e=>oK(e.$from,t)}function aK(t,e){const n={from:0,to:t.content.size};return c5(t,n,e)}function lK(t,e){const n=Vr(e,t.schema),{from:r,to:s}=t.selection,i=[];t.doc.nodesBetween(r,s,a=>{i.push(a)});const o=i.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function x5(t,e){const n=Xg(typeof e=="string"?e:e.name,t.schema);return n==="node"?lK(t,e):n==="mark"?y5(t,e):{}}function cK(t,e=JSON.stringify){const n={};return t.filter(r=>{const s=e(r);return Object.prototype.hasOwnProperty.call(n,s)?!1:n[s]=!0})}function uK(t){const e=cK(t);return e.length===1?e:e.filter((n,r)=>!e.filter((i,o)=>o!==r).some(i=>n.oldRange.from>=i.oldRange.from&&n.oldRange.to<=i.oldRange.to&&n.newRange.from>=i.newRange.from&&n.newRange.to<=i.newRange.to))}function dK(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((s,i)=>{const o=[];if(s.ranges.length)s.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=n[i];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const u=e.slice(i).map(a,-1),d=e.slice(i).map(l),f=e.invert().map(u,-1),h=e.invert().map(d);r.push({oldRange:{from:f,to:h},newRange:{from:u,to:d}})})}),uK(r)}function Dw(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(s=>{const i=n.resolve(t),o=Iw(i,s.type);o&&r.push({mark:s,...o})}):n.nodesBetween(t,e,(s,i)=>{!s||(s==null?void 0:s.nodeSize)===void 0||r.push(...s.marks.map(o=>({from:i,to:i+s.nodeSize,mark:o})))}),r}function Cp(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const s=t.find(i=>i.type===e&&i.name===r);return s?s.attribute.keepOnSplit:!1}))}function J1(t,e,n={}){const{empty:r,ranges:s}=t.selection,i=e?rl(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(f=>i?i.name===f.type.name:!0).find(f=>jm(f.attrs,n,{strict:!1}));let o=0;const a=[];if(s.forEach(({$from:f,$to:h})=>{const p=f.pos,m=h.pos;t.doc.nodesBetween(p,m,(y,b)=>{if(!y.isText&&!y.marks.length)return;const g=Math.max(p,b),v=Math.min(m,b+y.nodeSize),w=v-g;o+=w,a.push(...y.marks.map(T=>({mark:T,from:g,to:v})))})}),o===0)return!1;const l=a.filter(f=>i?i.name===f.mark.type.name:!0).filter(f=>jm(f.mark.attrs,n,{strict:!1})).reduce((f,h)=>f+h.to-h.from,0),u=a.filter(f=>i?f.mark.type!==i&&f.mark.type.excludes(i):!0).reduce((f,h)=>f+h.to-h.from,0);return(l>0?l+u:l)>=o}function b5(t,e,n={}){if(!e)return Of(t,null,n)||J1(t,null,n);const r=Xg(e,t.schema);return r==="node"?Of(t,e,n):r==="mark"?J1(t,e,n):!1}function AT(t,e){const{nodeExtensions:n}=Gg(e),r=n.find(o=>o.name===t);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},i=wn(Yt(r,"group",s));return typeof i!="string"?!1:i.split(" ").includes("list")}function Aw(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!==null&&r!==void 0?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let s=!0;return t.content.forEach(i=>{s!==!1&&(Aw(i,{ignoreWhitespace:n,checkChildren:e})||(s=!1))}),s}return!1}function fK(t){return t instanceof en}function hK(t,e,n){var r;const{selection:s}=e;let i=null;if(f5(s)&&(i=s.$cursor),i){const a=(r=t.storedMarks)!==null&&r!==void 0?r:i.marks();return!!n.isInSet(a)||!a.some(l=>l.type.excludes(n))}const{ranges:o}=s;return o.some(({$from:a,$to:l})=>{let u=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(d,f,h)=>{if(u)return!1;if(d.isInline){const p=!h||h.type.allowsMarkType(n),m=!!n.isInSet(d.marks)||!d.marks.some(y=>y.type.excludes(n));u=p&&m}return!u}),u})}const pK=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const{selection:i}=n,{empty:o,ranges:a}=i,l=rl(t,r.schema);if(s)if(o){const u=y5(r,l);n.addStoredMark(l.create({...u,...e}))}else a.forEach(u=>{const d=u.$from.pos,f=u.$to.pos;r.doc.nodesBetween(d,f,(h,p)=>{const m=Math.max(p,d),y=Math.min(p+h.nodeSize,f);h.marks.find(g=>g.type===l)?h.marks.forEach(g=>{l===g.type&&n.addMark(m,y,l.create({...g.attrs,...e}))}):n.addMark(m,y,l.create(e))})});return hK(r,n,l)},mK=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),gK=(t,e={})=>({state:n,dispatch:r,chain:s})=>{const i=Vr(t,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),i.isTextblock?s().command(({commands:a})=>ET(i,{...o,...e})(n)?!0:a.clearNodes()).command(({state:a})=>ET(i,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},yK=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,s=Ol(t,0,r.content.size),i=en.create(r,s);e.setSelection(i)}return!0},xK=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:s,to:i}=typeof t=="number"?{from:t,to:t}:t,o=pn.atStart(r).from,a=pn.atEnd(r).to,l=Ol(s,o,a),u=Ol(i,o,a),d=pn.create(r,l,u);e.setSelection(d)}return!0},bK=t=>({state:e,dispatch:n})=>{const r=Vr(t,e.schema);return Q7(r)(e,n)};function RT(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(s=>e==null?void 0:e.includes(s.type.name));t.tr.ensureMarks(r)}}const vK=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:s})=>{const{selection:i,doc:o}=e,{$from:a,$to:l}=i,u=s.extensionManager.attributes,d=Cp(u,a.node().type.name,a.node().attrs);if(i instanceof en&&i.node.isBlock)return!a.parentOffset||!lu(o,a.pos)?!1:(r&&(t&&RT(n,s.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const f=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:Mw(a.node(-1).contentMatchAt(a.indexAfter(-1)));let p=f&&h?[{type:h,attrs:d}]:void 0,m=lu(e.doc,e.mapping.map(a.pos),1,p);if(!p&&!m&&lu(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(m=!0,p=h?[{type:h,attrs:d}]:void 0),r){if(m&&(i instanceof pn&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,p),h&&!f&&!a.parentOffset&&a.parent.type!==h)){const y=e.mapping.map(a.before()),b=e.doc.resolve(y);a.node(-1).canReplaceWith(b.index(),b.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}t&&RT(n,s.extensionManager.splittableMarks),e.scrollIntoView()}return m},wK=(t,e={})=>({tr:n,state:r,dispatch:s,editor:i})=>{var o;const a=Vr(t,r.schema),{$from:l,$to:u}=r.selection,d=r.selection.node;if(d&&d.isBlock||l.depth<2||!l.sameParent(u))return!1;const f=l.node(-1);if(f.type!==a)return!1;const h=i.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(s){let g=jt.empty;const v=l.index(-1)?1:l.index(-2)?2:3;for(let S=l.depth-v;S>=l.depth-3;S-=1)g=jt.from(l.node(S).copy(g));const w=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,T={...Cp(h,l.node().type.name,l.node().attrs),...e},R=((o=a.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(T))||void 0;g=g.append(jt.from(a.createAndFill(null,R)||void 0));const k=l.before(l.depth-(v-1));n.replace(k,l.after(-w),new Kt(g,4-v,0));let M=-1;n.doc.nodesBetween(k,n.doc.content.size,(S,C)=>{if(M>-1)return!1;S.isTextblock&&S.content.size===0&&(M=C+1)}),M>-1&&n.setSelection(pn.near(n.doc.resolve(M))),n.scrollIntoView()}return!0}const p=u.pos===l.end()?f.contentMatchAt(0).defaultType:null,m={...Cp(h,f.type.name,f.attrs),...e},y={...Cp(h,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,u.pos);const b=p?[{type:a,attrs:m},{type:p,attrs:y}]:[{type:a,attrs:m}];if(!lu(n.doc,l.pos,2))return!1;if(s){const{selection:g,storedMarks:v}=r,{splittableMarks:w}=i.extensionManager,T=v||g.$to.parentOffset&&g.$from.marks();if(n.split(l.pos,2,b).scrollIntoView(),!T||!s)return!0;const R=T.filter(k=>w.includes(k.type.name));n.ensureMarks(R)}return!0},ky=(t,e)=>{const n=Fu(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&tl(t.doc,n.pos)&&t.join(n.pos),!0},Sy=(t,e)=>{const n=Fu(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&tl(t.doc,r)&&t.join(r),!0},kK=(t,e,n,r={})=>({editor:s,tr:i,state:o,dispatch:a,chain:l,commands:u,can:d})=>{const{extensions:f,splittableMarks:h}=s.extensionManager,p=Vr(t,o.schema),m=Vr(e,o.schema),{selection:y,storedMarks:b}=o,{$from:g,$to:v}=y,w=g.blockRange(v),T=b||y.$to.parentOffset&&y.$from.marks();if(!w)return!1;const R=Fu(k=>AT(k.type.name,f))(y);if(w.depth>=1&&R&&w.depth-R.depth<=1){if(R.node.type===p)return u.liftListItem(m);if(AT(R.node.type.name,f)&&p.validContent(R.node.content)&&a)return l().command(()=>(i.setNodeMarkup(R.pos,p),!0)).command(()=>ky(i,p)).command(()=>Sy(i,p)).run()}return!n||!T||!a?l().command(()=>d().wrapInList(p,r)?!0:u.clearNodes()).wrapInList(p,r).command(()=>ky(i,p)).command(()=>Sy(i,p)).run():l().command(()=>{const k=d().wrapInList(p,r),M=T.filter(S=>h.includes(S.type.name));return i.ensureMarks(M),k?!0:u.clearNodes()}).wrapInList(p,r).command(()=>ky(i,p)).command(()=>Sy(i,p)).run()},SK=(t,e={},n={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:i=!1}=n,o=rl(t,r.schema);return J1(r,o,e)?s.unsetMark(o,{extendEmptyMarkRange:i}):s.setMark(o,e)},_K=(t,e,n={})=>({state:r,commands:s})=>{const i=Vr(t,r.schema),o=Vr(e,r.schema),a=Of(r,i,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?s.setNode(o,l):s.setNode(i,{...l,...n})},TK=(t,e={})=>({state:n,commands:r})=>{const s=Vr(t,n.schema);return Of(n,s,e)?r.lift(s):r.wrapIn(s,e)},CK=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const s=n[r];let i;if(s.spec.isInputRules&&(i=s.getState(t))){if(e){const o=t.tr,a=i.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(i.text){const l=o.doc.resolve(i.from).marks();o.replaceWith(i.from,i.to,t.schema.text(i.text,l))}else o.delete(i.from,i.to)}return!0}}return!1},EK=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:s}=n;return r||e&&s.forEach(i=>{t.removeMark(i.$from.pos,i.$to.pos)}),!0},NK=(t,e={})=>({tr:n,state:r,dispatch:s})=>{var i;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=rl(t,r.schema),{$from:u,empty:d,ranges:f}=a;if(!s)return!0;if(d&&o){let{from:h,to:p}=a;const m=(i=u.marks().find(b=>b.type===l))===null||i===void 0?void 0:i.attrs,y=Iw(u,l,m);y&&(h=y.from,p=y.to),n.removeMark(h,p,l)}else f.forEach(h=>{n.removeMark(h.$from.pos,h.$to.pos,l)});return n.removeStoredMark(l),!0},jK=(t,e={})=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=Xg(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(i=Vr(t,r.schema)),a==="mark"&&(o=rl(t,r.schema)),s&&n.selection.ranges.forEach(l=>{const u=l.$from.pos,d=l.$to.pos;let f,h,p,m;n.selection.empty?r.doc.nodesBetween(u,d,(y,b)=>{i&&i===y.type&&(p=Math.max(b,u),m=Math.min(b+y.nodeSize,d),f=b,h=y)}):r.doc.nodesBetween(u,d,(y,b)=>{b<u&&i&&i===y.type&&(p=Math.max(b,u),m=Math.min(b+y.nodeSize,d),f=b,h=y),b>=u&&b<=d&&(i&&i===y.type&&n.setNodeMarkup(b,void 0,{...y.attrs,...e}),o&&y.marks.length&&y.marks.forEach(g=>{if(o===g.type){const v=Math.max(b,u),w=Math.min(b+y.nodeSize,d);n.addMark(v,w,o.create({...g.attrs,...e}))}}))}),h&&(f!==void 0&&n.setNodeMarkup(f,void 0,{...h.attrs,...e}),o&&h.marks.length&&h.marks.forEach(y=>{o===y.type&&n.addMark(p,m,o.create({...y.attrs,...e}))}))}),!0):!1},IK=(t,e={})=>({state:n,dispatch:r})=>{const s=Vr(t,n.schema);return W7(s,e)(n,r)},MK=(t,e={})=>({state:n,dispatch:r})=>{const s=Vr(t,n.schema);return K7(s,e)(n,r)};var DK=Object.freeze({__proto__:null,blur:mW,clearContent:gW,clearNodes:yW,command:xW,createParagraphNear:bW,cut:vW,deleteCurrentNode:wW,deleteNode:kW,deleteRange:SW,deleteSelection:_W,enter:TW,exitCode:CW,extendMarkRange:EW,first:NW,focus:jW,forEach:IW,insertContent:MW,insertContentAt:RW,joinBackward:LW,joinDown:PW,joinForward:$W,joinItemBackward:zW,joinItemForward:FW,joinTextblockBackward:BW,joinTextblockForward:UW,joinUp:OW,keyboardShortcut:VW,lift:WW,liftEmptyBlock:KW,liftListItem:GW,newlineInCode:qW,resetAttributes:YW,scrollIntoView:JW,selectAll:XW,selectNodeBackward:QW,selectNodeForward:ZW,selectParentNode:eK,selectTextblockEnd:tK,selectTextblockStart:nK,setContent:rK,setMark:pK,setMeta:mK,setNode:gK,setNodeSelection:yK,setTextSelection:xK,sinkListItem:bK,splitBlock:vK,splitListItem:wK,toggleList:kK,toggleMark:SK,toggleNode:_K,toggleWrap:TK,undoInputRule:CK,unsetAllMarks:EK,unsetMark:NK,updateAttributes:jK,wrapIn:IK,wrapInList:MK});const AK=Wr.create({name:"commands",addCommands(){return{...DK}}}),RK=Wr.create({name:"drop",addProseMirrorPlugins(){return[new jr({key:new ss("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),OK=Wr.create({name:"editable",addProseMirrorPlugins(){return[new jr({key:new ss("editable"),props:{editable:()=>this.editor.options.editable}})]}}),PK=new ss("focusEvents"),LK=Wr.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new jr({key:PK,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),$K=Wr.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:u}=a,{empty:d,$anchor:f}=l,{pos:h,parent:p}=f,m=f.parent.isTextblock&&h>0?a.doc.resolve(h-1):f,y=m.parent.type.spec.isolating,b=f.pos-f.parentOffset,g=y&&m.parent.childCount===1?b===f.pos:mn.atStart(u).from===h;return!d||!p.type.isTextblock||p.textContent.length||!g||g&&f.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...r},i={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Jg()||g5()?i:s},addProseMirrorPlugins(){return[new jr({key:new ss("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(y=>y.getMeta("composition")))return;const r=t.some(y=>y.docChanged)&&!e.doc.eq(n.doc),s=t.some(y=>y.getMeta("preventClearDocument"));if(!r||s)return;const{empty:i,from:o,to:a}=e.selection,l=mn.atStart(e.doc).from,u=mn.atEnd(e.doc).to;if(i||!(o===l&&a===u)||!Aw(n.doc))return;const h=n.tr,p=Wg({state:n,transaction:h}),{commands:m}=new Kg({editor:this.editor,state:p});if(m.clearNodes(),!!h.steps.length)return h}})]}}),zK=Wr.create({name:"paste",addProseMirrorPlugins(){return[new jr({key:new ss("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),FK=Wr.create({name:"tabindex",addProseMirrorPlugins(){return[new jr({key:new ss("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class _l{get name(){return this.node.type.name}constructor(e,n,r=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=s}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new _l(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new _l(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new _l(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const s=n.isBlock&&!n.isTextblock,i=n.isAtom&&!n.isText,o=this.pos+r+(i?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!s&&a.depth<=this.depth)return;const l=new _l(a,this.editor,s,s?n:null);s&&(l.actualDepth=this.depth+1),e.push(new _l(a,this.editor,s,s?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,s=this.parent;for(;s&&!r;){if(s.node.type.name===e)if(Object.keys(n).length>0){const i=s.node.attrs,o=Object.keys(n);for(let a=0;a<o.length;a+=1){const l=o[a];if(i[l]!==n[l])break}}else r=s;s=s.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let s=[];if(!this.children||this.children.length===0)return s;const i=Object.keys(n);return this.children.forEach(o=>{r&&s.length>0||(o.node.type.name===e&&i.every(l=>n[l]===o.node.attrs[l])&&s.push(o),!(r&&s.length>0)&&(s=s.concat(o.querySelectorAll(e,n,r))))}),s}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}}const BK=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function UK(t,e,n){const r=document.querySelector(`style[data-tiptap-style${n?`-${n}`:""}]`);if(r!==null)return r;const s=document.createElement("style");return e&&s.setAttribute("nonce",e),s.setAttribute(`data-tiptap-style${n?`-${n}`:""}`,""),s.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(s),s}let HK=class extends Z7{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:r,moved:s})=>this.options.onDrop(n,r,s)),this.on("paste",({event:n,slice:r})=>this.options.onPaste(n,r)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=UK(BK,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,n){const r=l5(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let r=n;if([].concat(e).forEach(i=>{const o=typeof i=="string"?`${i}$`:i.key;r=r.filter(a=>!a.key.startsWith(o))}),n.length===r.length)return;const s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}createExtensionManager(){var e,n;const s=[...this.options.enableCoreExtensions?[OK,pW.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||n===void 0?void 0:n.blockSeparator}),AK,LK,$K,FK,RK,zK].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i==null?void 0:i.type));this.extensionManager=new Xc(s,this)}createCommandManager(){this.commandManager=new Kg({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let n;try{n=Y1(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>a.name!=="collaboration"),this.createExtensionManager()}}),n=Y1(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const r=h5(n,this.options.autofocus);this.view=new ZA(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:Jc.create({doc:n,selection:r||void 0})});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(o)});return}const n=this.state.apply(e),r=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const s=e.getMeta("focus"),i=e.getMeta("blur");s&&this.emit("focus",{editor:this,event:s.event,transaction:e}),i&&this.emit("blur",{editor:this,event:i.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return x5(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,s=typeof e=="string"?n:e;return b5(this.state,r,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Nw(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return aK(this.state.doc,{blockSeparator:n,textSerializers:{...u5(this.schema),...r}})}get isEmpty(){return Aw(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelector(e,n))||null}$nodes(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new _l(n,this)}get $doc(){return this.$pos(0)}};function nc(t){return new qg({find:t.find,handler:({state:e,range:n,match:r})=>{const s=wn(t.getAttributes,void 0,r);if(s===!1||s===null)return null;const{tr:i}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),u=n.from+a.indexOf(o),d=u+o.length;if(Dw(n.from,n.to,e.doc).filter(p=>p.mark.type.excluded.find(y=>y===t.type&&y!==p.mark.type)).filter(p=>p.to>u).length)return null;d<n.to&&i.delete(d,n.to),u>n.from&&i.delete(n.from+l,u);const h=n.from+l+o.length;i.addMark(n.from+l,h,t.type.create(s||{})),i.removeStoredMark(t.type)}}})}function VK(t){return new qg({find:t.find,handler:({state:e,range:n,match:r})=>{const s=wn(t.getAttributes,void 0,r)||{},{tr:i}=e,o=n.from;let a=n.to;const l=t.type.create(s);if(r[1]){const u=r[0].lastIndexOf(r[1]);let d=o+u;d>a?d=a:a=d+r[1].length;const f=r[0][r[0].length-1];i.insertText(f,o+r[0].length-1),i.replaceWith(d,a,l)}else if(r[0]){const u=t.type.isInline?o:o-1;i.insert(u,t.type.create(s)).delete(i.mapping.map(o),i.mapping.map(a))}i.scrollIntoView()}})}function X1(t){return new qg({find:t.find,handler:({state:e,range:n,match:r})=>{const s=e.doc.resolve(n.from),i=wn(t.getAttributes,void 0,r)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,i)}})}function Eu(t){return new qg({find:t.find,handler:({state:e,range:n,match:r,chain:s})=>{const i=wn(t.getAttributes,void 0,r)||{},o=e.tr.delete(n.from,n.to),l=o.doc.resolve(n.from).blockRange(),u=l&&mw(l,t.type,i);if(!u)return null;if(o.wrap(l,u),t.keepMarks&&t.editor){const{selection:f,storedMarks:h}=e,{splittableMarks:p}=t.editor.extensionManager,m=h||f.$to.parentOffset&&f.$from.marks();if(m){const y=m.filter(b=>p.includes(b.type.name));o.ensureMarks(y)}}if(t.keepAttributes){const f=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(f,i).run()}const d=o.doc.resolve(n.from-1).nodeBefore;d&&d.type===t.type&&tl(o.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,d))&&o.join(n.from-1)}})}class yr{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=wn(Yt(this,"addOptions",{name:this.name}))),this.storage=wn(Yt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new yr(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>Yg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new yr(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=wn(Yt(n,"addOptions",{name:n.name})),n.storage=wn(Yt(n,"addStorage",{name:n.name,options:n.options})),n}}class WK{constructor(e,n,r){this.isDragging=!1,this.component=e,this.editor=n.editor,this.options={stopEvent:null,ignoreMutation:null,...r},this.extension=n.extension,this.node=n.node,this.decorations=n.decorations,this.innerDecorations=n.innerDecorations,this.view=n.view,this.HTMLAttributes=n.HTMLAttributes,this.getPos=n.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(e){var n,r,s,i,o,a,l;const{view:u}=this.editor,d=e.target,f=d.nodeType===3?(n=d.parentElement)===null||n===void 0?void 0:n.closest("[data-drag-handle]"):d.closest("[data-drag-handle]");if(!this.dom||!((r=this.contentDOM)===null||r===void 0)&&r.contains(d)||!f)return;let h=0,p=0;if(this.dom!==f){const v=this.dom.getBoundingClientRect(),w=f.getBoundingClientRect(),T=(s=e.offsetX)!==null&&s!==void 0?s:(i=e.nativeEvent)===null||i===void 0?void 0:i.offsetX,R=(o=e.offsetY)!==null&&o!==void 0?o:(a=e.nativeEvent)===null||a===void 0?void 0:a.offsetY;h=w.x-v.x+T,p=w.y-v.y+R}const m=this.dom.cloneNode(!0);(l=e.dataTransfer)===null||l===void 0||l.setDragImage(m,h,p);const y=this.getPos();if(typeof y!="number")return;const b=en.create(u.state.doc,y),g=u.state.tr.setSelection(b);u.dispatch(g)}stopEvent(e){var n;if(!this.dom)return!1;if(typeof this.options.stopEvent=="function")return this.options.stopEvent({event:e});const r=e.target;if(!(this.dom.contains(r)&&!(!((n=this.contentDOM)===null||n===void 0)&&n.contains(r))))return!1;const i=e.type.startsWith("drag"),o=e.type==="drop";if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(r.tagName)||r.isContentEditable)&&!o&&!i)return!0;const{isEditable:l}=this.editor,{isDragging:u}=this,d=!!this.node.type.spec.draggable,f=en.isSelectable(this.node),h=e.type==="copy",p=e.type==="paste",m=e.type==="cut",y=e.type==="mousedown";if(!d&&f&&i&&e.target===this.dom&&e.preventDefault(),d&&i&&!u&&e.target===this.dom)return e.preventDefault(),!1;if(d&&l&&!u&&y){const b=r.closest("[data-drag-handle]");b&&(this.dom===b||this.dom.contains(b))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!(u||o||h||p||m||y&&f)}ignoreMutation(e){return!this.dom||!this.contentDOM?!0:typeof this.options.ignoreMutation=="function"?this.options.ignoreMutation({mutation:e}):this.node.isLeaf||this.node.isAtom?!0:e.type==="selection"||this.dom.contains(e.target)&&e.type==="childList"&&(Jg()||p5())&&this.editor.isFocused&&[...Array.from(e.addedNodes),...Array.from(e.removedNodes)].every(r=>r.isContentEditable)?!1:this.contentDOM===e.target&&e.type==="attributes"?!0:!this.contentDOM.contains(e.target)}updateAttributes(e){this.editor.commands.command(({tr:n})=>{const r=this.getPos();return typeof r!="number"?!1:(n.setNodeMarkup(r,void 0,{...this.node.attrs,...e}),!0)})}deleteNode(){const e=this.getPos();if(typeof e!="number")return;const n=e+this.node.nodeSize;this.editor.commands.deleteRange({from:e,to:n})}}function Ya(t){return new lW({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:s})=>{const i=wn(t.getAttributes,void 0,r,s);if(i===!1||i===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let u=n.to;if(a){const d=l.search(/\S/),f=n.from+l.indexOf(a),h=f+a.length;if(Dw(n.from,n.to,e.doc).filter(m=>m.mark.type.excluded.find(b=>b===t.type&&b!==m.mark.type)).filter(m=>m.to>f).length)return null;h<n.to&&o.delete(h,n.to),f>n.from&&o.delete(n.from+d,f),u=n.from+d+a.length,o.addMark(n.from+d,u,t.type.create(i||{})),o.removeStoredMark(t.type)}}})}function KK(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof en){const i=r.index();return r.parent.canReplaceWith(i,i+1,e)}let s=r.depth;for(;s>=0;){const i=r.index(s);if(r.node(s).contentMatchAt(i).matchType(e))return!0;s-=1}return!1}function GK(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}const qK=(...t)=>e=>{t.forEach(n=>{typeof n=="function"?n(e):n&&(n.current=e)})},YK=({renderers:t})=>Ln.createElement(Ln.Fragment,null,Object.entries(t).map(([e,n])=>C4.createPortal(n.reactElement,n.element,e)));class JK extends Ln.Component{constructor(e){super(e),this.editorContentRef=Ln.createRef(),this.initialized=!1,this.state={renderers:{}}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const{editor:e}=this.props;if(e&&e.options.element){if(e.contentComponent)return;const n=this.editorContentRef.current;n.append(...e.options.element.childNodes),e.setOptions({element:n}),e.contentComponent=this,e.createNodeViews(),this.initialized=!0}}maybeFlushSync(e){this.initialized?ir.flushSync(e):e()}setRenderer(e,n){this.maybeFlushSync(()=>{this.setState(({renderers:r})=>({renderers:{...r,[e]:n}}))})}removeRenderer(e){this.maybeFlushSync(()=>{this.setState(({renderers:n})=>{const r={...n};return delete r[e],{renderers:r}})})}componentWillUnmount(){const{editor:e}=this.props;if(!e||(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),e.contentComponent=null,!e.options.element.firstChild))return;const n=document.createElement("div");n.append(...e.options.element.childNodes),e.setOptions({element:n})}render(){const{editor:e,innerRef:n,...r}=this.props;return Ln.createElement(Ln.Fragment,null,Ln.createElement("div",{ref:qK(n,this.editorContentRef),...r}),Ln.createElement(YK,{renderers:this.state.renderers}))}}const XK=x.forwardRef((t,e)=>{const n=Ln.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return Ln.createElement(JK,{key:n,innerRef:e,...t})}),QK=Ln.memo(XK);class ZK extends HK{constructor(){super(...arguments),this.contentComponent=null}}const eG=(t={},e=[])=>{const n=x.useRef(null),[,r]=x.useState({}),{onBeforeCreate:s,onBlur:i,onCreate:o,onDestroy:a,onFocus:l,onSelectionUpdate:u,onTransaction:d,onUpdate:f}=t,h=x.useRef(s),p=x.useRef(i),m=x.useRef(o),y=x.useRef(a),b=x.useRef(l),g=x.useRef(u),v=x.useRef(d),w=x.useRef(f);return x.useEffect(()=>{n.current&&(s&&(n.current.off("beforeCreate",h.current),n.current.on("beforeCreate",s),h.current=s),i&&(n.current.off("blur",p.current),n.current.on("blur",i),p.current=i),o&&(n.current.off("create",m.current),n.current.on("create",o),m.current=o),a&&(n.current.off("destroy",y.current),n.current.on("destroy",a),y.current=a),l&&(n.current.off("focus",b.current),n.current.on("focus",l),b.current=l),u&&(n.current.off("selectionUpdate",g.current),n.current.on("selectionUpdate",u),g.current=u),d&&(n.current.off("transaction",v.current),n.current.on("transaction",d),v.current=d),f&&(n.current.off("update",w.current),n.current.on("update",f),w.current=f))},[s,i,o,a,l,u,d,f,n.current]),x.useEffect(()=>{let T=!0;return n.current=new ZK(t),n.current.on("transaction",()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{T&&r({})})})}),()=>{T=!1}},e),x.useEffect(()=>()=>{var T;return(T=n.current)===null||T===void 0?void 0:T.destroy()},[]),n.current},tG=x.createContext({editor:null});tG.Consumer;const v5=x.createContext({onDragStart:void 0}),nG=()=>x.useContext(v5);Ln.forwardRef((t,e)=>{const{onDragStart:n}=nG(),r=t.as||"div";return Ln.createElement(r,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:n,style:{whiteSpace:"normal",...t.style}})});function rG(t){return!!(typeof t=="function"&&t.prototype&&t.prototype.isReactComponent)}function sG(t){var e;return typeof t=="object"&&((e=t.$$typeof)===null||e===void 0?void 0:e.toString())==="Symbol(react.forward_ref)"}class iG{constructor(e,{editor:n,props:r={},as:s="div",className:i="",attrs:o}){this.ref=null,this.id=Math.floor(Math.random()*4294967295).toString(),this.component=e,this.editor=n,this.props=r,this.element=document.createElement(s),this.element.classList.add("react-renderer"),i&&this.element.classList.add(...i.split(" ")),o&&Object.keys(o).forEach(a=>{this.element.setAttribute(a,o[a])}),this.render()}render(){var e,n;const r=this.component,s=this.props;(rG(r)||sG(r))&&(s.ref=i=>{this.ref=i}),this.reactElement=Ln.createElement(r,{...s}),(n=(e=this.editor)===null||e===void 0?void 0:e.contentComponent)===null||n===void 0||n.setRenderer(this.id,this)}updateProps(e={}){this.props={...this.props,...e},this.render()}destroy(){var e,n;(n=(e=this.editor)===null||e===void 0?void 0:e.contentComponent)===null||n===void 0||n.removeRenderer(this.id)}}class oG extends WK{mount(){const e={editor:this.editor,node:this.node,decorations:this.decorations,selected:!1,extension:this.extension,getPos:()=>this.getPos(),updateAttributes:(i={})=>this.updateAttributes(i),deleteNode:()=>this.deleteNode()};if(!this.component.displayName){const i=o=>o.charAt(0).toUpperCase()+o.substring(1);this.component.displayName=i(this.extension.name)}const n=i=>{const o=this.component,a=this.onDragStart.bind(this),l=u=>{u&&this.contentDOMElement&&u.firstChild!==this.contentDOMElement&&u.appendChild(this.contentDOMElement)};return Ln.createElement(Ln.Fragment,null,Ln.createElement(v5.Provider,{value:{onDragStart:a,nodeViewContentRef:l}},Ln.createElement(o,{...i})))};n.displayName="ReactNodeView",this.node.isLeaf?this.contentDOMElement=null:this.options.contentDOMElementTag?this.contentDOMElement=document.createElement(this.options.contentDOMElementTag):this.contentDOMElement=document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.style.whiteSpace="inherit");let r=this.node.isInline?"span":"div";this.options.as&&(r=this.options.as);const{className:s=""}=this.options;this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.editor.on("selectionUpdate",this.handleSelectionUpdate),this.renderer=new iG(n,{editor:this.editor,props:e,as:r,className:`node-${this.node.type.name} ${s}`.trim(),attrs:this.options.attrs})}get dom(){var e;if(this.renderer.element.firstElementChild&&!(!((e=this.renderer.element.firstElementChild)===null||e===void 0)&&e.hasAttribute("data-node-view-wrapper")))throw Error("Please use the NodeViewWrapper component for your node view.");return this.renderer.element}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){const{from:e,to:n}=this.editor.state.selection;if(e<=this.getPos()&&n>=this.getPos()+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(e,n){const r=s=>{this.renderer.updateProps(s)};if(e.type!==this.node.type)return!1;if(typeof this.options.update=="function"){const s=this.node,i=this.decorations;return this.node=e,this.decorations=n,this.options.update({oldNode:s,oldDecorations:i,newNode:e,newDecorations:n,updateProps:()=>r({node:e,decorations:n})})}return e===this.node&&this.decorations===n||(this.node=e,this.decorations=n,r({node:e,decorations:n})),!0}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.element.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.element.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}}function aG(t,e){return n=>n.editor.contentComponent?new oG(t,n,e):{}}const lG=/^\s*>\s$/,cG=yr.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",In(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Eu({find:lG,type:this.type})]}}),uG=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,dG=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,fG=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,hG=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,pG=oi.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",In(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[nc({find:uG,type:this.type}),nc({find:fG,type:this.type})]},addPasteRules(){return[Ya({find:dG,type:this.type}),Ya({find:hG,type:this.type})]}}),mG="listItem",OT="textStyle",PT=/^\s*([-+*])\s$/,gG=yr.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",In(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(mG,this.editor.getAttributes(OT)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=Eu({find:PT,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=Eu({find:PT,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(OT),editor:this.editor})),[t]}}),yG=/(^|[^`])`([^`]+)`(?!`)/,xG=/(^|[^`])`([^`]+)`(?!`)/g,bG=oi.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",In(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[nc({find:yG,type:this.type})]},addPasteRules(){return[Ya({find:xG,type:this.type})]}}),vG=/^```([a-z]+)?[\s\n]$/,wG=/^~~~([a-z]+)?[\s\n]$/,kG=yr.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,i=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",In(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:s}=n;if(!s||r.parent.type!==this.type)return!1;const i=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!i||!o?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:s,empty:i}=n;if(!i||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const a=s.after();return a===void 0?!1:r.nodeAt(a)?t.commands.command(({tr:u})=>(u.setSelection(mn.near(r.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[X1({find:vG,type:this.type,getAttributes:t=>({language:t[1]})}),X1({find:wG,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new jr({key:new ss("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,i=s==null?void 0:s.mode;if(!n||!i)return!1;const{tr:o,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:i},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(pn.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),SG=yr.create({name:"doc",topNode:!0,content:"block+"});function _G(t={}){return new jr({view(e){return new TG(e,t)}})}class TG{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let i=o=>{this[s](o)};return e.dom.addEventListener(s,i),{name:s,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,s=this.editorView.dom,i=s.getBoundingClientRect(),o=i.width/s.offsetWidth,a=i.height/s.offsetHeight;if(n){let f=e.nodeBefore,h=e.nodeAfter;if(f||h){let p=this.editorView.nodeDOM(this.cursorPos-(f?f.nodeSize:0));if(p){let m=p.getBoundingClientRect(),y=f?m.bottom:m.top;f&&h&&(y=(y+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let b=this.width/2*a;r={left:m.left,right:m.right,top:y-b,bottom:y+b}}}}if(!r){let f=this.editorView.coordsAtPos(this.cursorPos),h=this.width/2*o;r={left:f.left-h,right:f.left+h,top:f.top,bottom:f.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let u,d;if(!l||l==document.body&&getComputedStyle(l).position=="static")u=-pageXOffset,d=-pageYOffset;else{let f=l.getBoundingClientRect(),h=f.width/l.offsetWidth,p=f.height/l.offsetHeight;u=f.left-l.scrollLeft*h,d=f.top-l.scrollTop*p}this.element.style.left=(r.left-u)/o+"px",this.element.style.top=(r.top-d)/a+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),s=r&&r.type.spec.disableDropCursor,i=typeof s=="function"?s(this.editorView,n,e):s;if(n&&!i){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=dA(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const CG=Wr.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[_G(this.options)]}});class rr extends mn{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return rr.valid(r)?new rr(r):mn.near(r)}content(){return Kt.empty}eq(e){return e instanceof rr&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new rr(e.resolve(n.pos))}getBookmark(){return new Rw(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!EG(e)||!NG(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let s=n.contentMatchAt(e.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&rr.valid(e))return e;let s=e.pos,i=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){i=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;s+=n;let l=e.doc.resolve(s);if(rr.valid(l))return l}for(;;){let o=n>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!en.isSelectable(i)){e=e.doc.resolve(s+i.nodeSize*n),r=!1;continue e}break}i=o,s+=n;let a=e.doc.resolve(s);if(rr.valid(a))return a}return null}}}rr.prototype.visible=!1;rr.findFrom=rr.findGapCursorFrom;mn.jsonID("gapcursor",rr);class Rw{constructor(e){this.pos=e}map(e){return new Rw(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return rr.valid(n)?new rr(n):mn.near(n)}}function w5(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function EG(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n-1);;s=s.lastChild){if(s.childCount==0&&!s.inlineContent||w5(s.type))return!0;if(s.inlineContent)return!1}}return!0}function NG(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n);;s=s.firstChild){if(s.childCount==0&&!s.inlineContent||w5(s.type))return!0;if(s.inlineContent)return!1}}return!0}function jG(){return new jr({props:{decorations:AG,createSelectionBetween(t,e,n){return e.pos==n.pos&&rr.valid(n)?new rr(n):null},handleClick:MG,handleKeyDown:IG,handleDOMEvents:{beforeinput:DG}}})}const IG=e5({ArrowLeft:Hh("horiz",-1),ArrowRight:Hh("horiz",1),ArrowUp:Hh("vert",-1),ArrowDown:Hh("vert",1)});function Hh(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,s,i){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof pn){if(!i.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let u=rr.findGapCursorFrom(a,e,l);return u?(s&&s(r.tr.setSelection(new rr(u))),!0):!1}}function MG(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!rr.valid(r))return!1;let s=t.posAtCoords({left:n.clientX,top:n.clientY});return s&&s.inside>-1&&en.isSelectable(t.state.doc.nodeAt(s.inside))?!1:(t.dispatch(t.state.tr.setSelection(new rr(r))),!0)}function DG(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof rr))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let s=jt.empty;for(let o=r.length-1;o>=0;o--)s=jt.from(r[o].createAndFill(null,s));let i=t.state.tr.replace(n.pos,n.pos,new Kt(s,0,0));return i.setSelection(pn.near(i.doc.resolve(n.pos+1))),t.dispatch(i),!1}function AG(t){if(!(t.selection instanceof rr))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",vr.create(t.doc,[zs.widget(t.selection.head,e,{key:"gapcursor"})])}const RG=Wr.create({name:"gapCursor",addProseMirrorPlugins(){return[jG()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=wn(Yt(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),OG=yr.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",In(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:s,storedMarks:i}=n;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=i||s.$to.parentOffset&&s.$from.marks();return e().insertContent({type:this.name}).command(({tr:u,dispatch:d})=>{if(d&&l&&o){const f=l.filter(h=>a.includes(h.type.name));u.ensureMarks(f)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),PG=yr.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,In(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>X1({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var Im=200,Hr=function(){};Hr.prototype.append=function(e){return e.length?(e=Hr.from(e),!this.length&&e||e.length<Im&&this.leafAppend(e)||this.length<Im&&e.leafPrepend(this)||this.appendInner(e)):this};Hr.prototype.prepend=function(e){return e.length?Hr.from(e).append(this):this};Hr.prototype.appendInner=function(e){return new LG(this,e)};Hr.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?Hr.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};Hr.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Hr.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};Hr.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var s=[];return this.forEach(function(i,o){return s.push(e(i,o))},n,r),s};Hr.from=function(e){return e instanceof Hr?e:e&&e.length?new k5(e):Hr.empty};var k5=function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(s,i){return s==0&&i==this.length?this:new e(this.values.slice(s,i))},e.prototype.getInner=function(s){return this.values[s]},e.prototype.forEachInner=function(s,i,o,a){for(var l=i;l<o;l++)if(s(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(s,i,o,a){for(var l=i-1;l>=o;l--)if(s(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(s){if(this.length+s.length<=Im)return new e(this.values.concat(s.flatten()))},e.prototype.leafPrepend=function(s){if(this.length+s.length<=Im)return new e(s.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(Hr);Hr.empty=new k5([]);var LG=function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,s,i,o){var a=this.left.length;if(s<a&&this.left.forEachInner(r,s,Math.min(i,a),o)===!1||i>a&&this.right.forEachInner(r,Math.max(s-a,0),Math.min(this.length,i)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,s,i,o){var a=this.left.length;if(s>a&&this.right.forEachInvertedInner(r,s-a,Math.max(i,a)-a,o+a)===!1||i<a&&this.left.forEachInvertedInner(r,Math.min(s,a),i,o)===!1)return!1},e.prototype.sliceInner=function(r,s){if(r==0&&s==this.length)return this;var i=this.left.length;return s<=i?this.left.slice(r,s):r>=i?this.right.slice(r-i,s-i):this.left.slice(r,i).append(this.right.slice(0,s-i))},e.prototype.leafAppend=function(r){var s=this.right.leafAppend(r);if(s)return new e(this.left,s)},e.prototype.leafPrepend=function(r){var s=this.left.leafPrepend(r);if(s)return new e(s,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(Hr);const $G=500;class Xi{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let s,i;n&&(s=this.remapping(r,this.items.length),i=s.maps.length);let o=e.tr,a,l,u=[],d=[];return this.items.forEach((f,h)=>{if(!f.step){s||(s=this.remapping(r,h+1),i=s.maps.length),i--,d.push(f);return}if(s){d.push(new ro(f.map));let p=f.step.map(s.slice(i)),m;p&&o.maybeStep(p).doc&&(m=o.mapping.maps[o.mapping.maps.length-1],u.push(new ro(m,void 0,void 0,u.length+d.length))),i--,m&&s.appendMap(m,i)}else o.maybeStep(f.step);if(f.selection)return a=s?f.selection.map(s.slice(i)):f.selection,l=new Xi(this.items.slice(0,r).append(d.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,r,s){let i=[],o=this.eventCount,a=this.items,l=!s&&a.length?a.get(a.length-1):null;for(let d=0;d<e.steps.length;d++){let f=e.steps[d].invert(e.docs[d]),h=new ro(e.mapping.maps[d],f,n),p;(p=l&&l.merge(h))&&(h=p,d?i.pop():a=a.slice(0,a.length-1)),i.push(h),n&&(o++,n=void 0),s||(l=h)}let u=o-r.depth;return u>FG&&(a=zG(a,u),o-=u),new Xi(a.append(i),o)}remapping(e,n){let r=new jf;return this.items.forEach((s,i)=>{let o=s.mirrorOffset!=null&&i-s.mirrorOffset>=e?r.maps.length-s.mirrorOffset:void 0;r.appendMap(s.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new Xi(this.items.append(e.map(n=>new ro(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],s=Math.max(0,this.items.length-n),i=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(h=>{h.selection&&a--},s);let l=n;this.items.forEach(h=>{let p=i.getMirror(--l);if(p==null)return;o=Math.min(o,p);let m=i.maps[p];if(h.step){let y=e.steps[p].invert(e.docs[p]),b=h.selection&&h.selection.map(i.slice(l+1,p));b&&a++,r.push(new ro(m,y,b))}else r.push(new ro(m))},s);let u=[];for(let h=n;h<o;h++)u.push(new ro(i.maps[h]));let d=this.items.slice(0,s).append(u).append(r),f=new Xi(d,a);return f.emptyItemCount()>$G&&(f=f.compress(this.items.length-r.length)),f}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,s=[],i=0;return this.items.forEach((o,a)=>{if(a>=e)s.push(o),o.selection&&i++;else if(o.step){let l=o.step.map(n.slice(r)),u=l&&l.getMap();if(r--,u&&n.appendMap(u,r),l){let d=o.selection&&o.selection.map(n.slice(r));d&&i++;let f=new ro(u.invert(),l,d),h,p=s.length-1;(h=s.length&&s[p].merge(f))?s[p]=h:s.push(f)}}else o.map&&r--},this.items.length,0),new Xi(Hr.from(s.reverse()),i)}}Xi.empty=new Xi(Hr.empty,0);function zG(t,e){let n;return t.forEach((r,s)=>{if(r.selection&&e--==0)return n=s,!1}),t.slice(n)}class ro{constructor(e,n,r,s){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new ro(n.getMap().invert(),n,this.selection)}}}class ga{constructor(e,n,r,s,i){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=s,this.prevComposition=i}}const FG=20;function BG(t,e,n,r){let s=n.getMeta(Kl),i;if(s)return s.historyState;n.getMeta(VG)&&(t=new ga(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(Kl))return o.getMeta(Kl).redo?new ga(t.done.addTransform(n,void 0,r,Ep(e)),t.undone,LT(n.mapping.maps),t.prevTime,t.prevComposition):new ga(t.done,t.undone.addTransform(n,void 0,r,Ep(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!UG(n,t.prevRanges)),u=o?_y(t.prevRanges,n.mapping):LT(n.mapping.maps);return new ga(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,Ep(e)),Xi.empty,u,n.time,a??t.prevComposition)}else return(i=n.getMeta("rebased"))?new ga(t.done.rebased(n,i),t.undone.rebased(n,i),_y(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new ga(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),_y(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function UG(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,s)=>{for(let i=0;i<e.length;i+=2)r<=e[i+1]&&s>=e[i]&&(n=!0)}),n}function LT(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,s,i,o)=>e.push(i,o));return e}function _y(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let s=e.map(t[r],1),i=e.map(t[r+1],-1);s<=i&&n.push(s,i)}return n}function HG(t,e,n){let r=Ep(e),s=Kl.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,r);if(!i)return null;let o=i.selection.resolve(i.transform.doc),a=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),s,r),l=new ga(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(o).setMeta(Kl,{redo:n,historyState:l})}let Ty=!1,$T=null;function Ep(t){let e=t.plugins;if($T!=e){Ty=!1,$T=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){Ty=!0;break}}return Ty}const Kl=new ss("history"),VG=new ss("closeHistory");function WG(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new jr({key:Kl,state:{init(){return new ga(Xi.empty,Xi.empty,null,0,-1)},apply(e,n,r){return BG(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,s=r=="historyUndo"?_5:r=="historyRedo"?T5:null;return!s||!e.editable?!1:(n.preventDefault(),s(e.state,e.dispatch))}}}})}function S5(t,e){return(n,r)=>{let s=Kl.getState(n);if(!s||(t?s.undone:s.done).eventCount==0)return!1;if(r){let i=HG(s,n,t);i&&r(e?i.scrollIntoView():i)}return!0}}const _5=S5(!1,!0),T5=S5(!0,!0),KG=Wr.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>_5(t,e),redo:()=>({state:t,dispatch:e})=>T5(t,e)}},addProseMirrorPlugins(){return[WG(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),GG=yr.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",In(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!KK(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$from:r,$to:s}=n,i=t();return r.parentOffset===0?i.insertContentAt({from:Math.max(r.pos-1,0),to:s.pos},{type:this.name}):fK(n)?i.insertContentAt(s.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({tr:o,dispatch:a})=>{var l;if(a){const{$to:u}=o.selection,d=u.end();if(u.nodeAfter)u.nodeAfter.isTextblock?o.setSelection(pn.create(o.doc,u.pos+1)):u.nodeAfter.isBlock?o.setSelection(en.create(o.doc,u.pos)):o.setSelection(pn.create(o.doc,u.pos));else{const f=(l=u.parent.type.contentMatch.defaultType)===null||l===void 0?void 0:l.create();f&&(o.insert(d,f),o.setSelection(pn.create(o.doc,d+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[VK({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),qG=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,YG=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,JG=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,XG=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,QG=oi.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",In(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[nc({find:qG,type:this.type}),nc({find:JG,type:this.type})]},addPasteRules(){return[Ya({find:YG,type:this.type}),Ya({find:XG,type:this.type})]}}),ZG=yr.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",In(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),eq="listItem",zT="textStyle",FT=/^(\d+)\.\s$/,tq=yr.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",In(this.options.HTMLAttributes,n),0]:["ol",In(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(eq,this.editor.getAttributes(zT)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=Eu({find:FT,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=Eu({find:FT,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(zT)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),nq=yr.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",In(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),rq=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,sq=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,iq=oi.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",In(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[nc({find:rq,type:this.type})]},addPasteRules(){return[Ya({find:sq,type:this.type})]}}),oq=yr.create({name:"text",group:"inline"}),aq=Wr.create({name:"starterKit",addExtensions(){var t,e,n,r,s,i,o,a,l,u,d,f,h,p,m,y,b,g;const v=[];return this.options.blockquote!==!1&&v.push(cG.configure((t=this.options)===null||t===void 0?void 0:t.blockquote)),this.options.bold!==!1&&v.push(pG.configure((e=this.options)===null||e===void 0?void 0:e.bold)),this.options.bulletList!==!1&&v.push(gG.configure((n=this.options)===null||n===void 0?void 0:n.bulletList)),this.options.code!==!1&&v.push(bG.configure((r=this.options)===null||r===void 0?void 0:r.code)),this.options.codeBlock!==!1&&v.push(kG.configure((s=this.options)===null||s===void 0?void 0:s.codeBlock)),this.options.document!==!1&&v.push(SG.configure((i=this.options)===null||i===void 0?void 0:i.document)),this.options.dropcursor!==!1&&v.push(CG.configure((o=this.options)===null||o===void 0?void 0:o.dropcursor)),this.options.gapcursor!==!1&&v.push(RG.configure((a=this.options)===null||a===void 0?void 0:a.gapcursor)),this.options.hardBreak!==!1&&v.push(OG.configure((l=this.options)===null||l===void 0?void 0:l.hardBreak)),this.options.heading!==!1&&v.push(PG.configure((u=this.options)===null||u===void 0?void 0:u.heading)),this.options.history!==!1&&v.push(KG.configure((d=this.options)===null||d===void 0?void 0:d.history)),this.options.horizontalRule!==!1&&v.push(GG.configure((f=this.options)===null||f===void 0?void 0:f.horizontalRule)),this.options.italic!==!1&&v.push(QG.configure((h=this.options)===null||h===void 0?void 0:h.italic)),this.options.listItem!==!1&&v.push(ZG.configure((p=this.options)===null||p===void 0?void 0:p.listItem)),this.options.orderedList!==!1&&v.push(tq.configure((m=this.options)===null||m===void 0?void 0:m.orderedList)),this.options.paragraph!==!1&&v.push(nq.configure((y=this.options)===null||y===void 0?void 0:y.paragraph)),this.options.strike!==!1&&v.push(iq.configure((b=this.options)===null||b===void 0?void 0:b.strike)),this.options.text!==!1&&v.push(oq.configure((g=this.options)===null||g===void 0?void 0:g.text)),v}}),lq="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",cq="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",Q1="numeric",Z1="ascii",eb="alpha",Ld="asciinumeric",yd="alphanumeric",tb="domain",C5="emoji",uq="scheme",dq="slashscheme",Cy="whitespace";function fq(t,e){return t in e||(e[t]=[]),e[t]}function Pl(t,e,n){e[Q1]&&(e[Ld]=!0,e[yd]=!0),e[Z1]&&(e[Ld]=!0,e[eb]=!0),e[Ld]&&(e[yd]=!0),e[eb]&&(e[yd]=!0),e[yd]&&(e[tb]=!0),e[C5]&&(e[tb]=!0);for(const r in e){const s=fq(r,n);s.indexOf(t)<0&&s.push(t)}}function hq(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function Ps(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Ps.groups={};Ps.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const s=e.jr[r][0],i=e.jr[r][1];if(i&&s.test(t))return i}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let s=0;s<t.length;s++)this.tt(t[s],e,n,r)},tr(t,e,n,r){r=r||Ps.groups;let s;return e&&e.j?s=e:(s=new Ps(e),n&&r&&Pl(e,n,r)),this.jr.push([t,s]),s},ts(t,e,n,r){let s=this;const i=t.length;if(!i)return s;for(let o=0;o<i-1;o++)s=s.tt(t[o]);return s.tt(t[i-1],e,n,r)},tt(t,e,n,r){r=r||Ps.groups;const s=this;if(e&&e.j)return s.j[t]=e,e;const i=e;let o,a=s.go(t);if(a?(o=new Ps,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new Ps,i){if(r)if(o.t&&typeof o.t=="string"){const l=Object.assign(hq(o.t,r),n);Pl(i,l,r)}else n&&Pl(i,n,r);o.t=i}return s.j[t]=o,o}};const vn=(t,e,n,r,s)=>t.ta(e,n,r,s),hr=(t,e,n,r,s)=>t.tr(e,n,r,s),BT=(t,e,n,r,s)=>t.ts(e,n,r,s),At=(t,e,n,r,s)=>t.tt(e,n,r,s),Mo="WORD",nb="UWORD",E5="ASCIINUMERICAL",N5="ALPHANUMERICAL",Pf="LOCALHOST",rb="TLD",sb="UTLD",Np="SCHEME",jc="SLASH_SCHEME",Ow="NUM",ib="WS",Pw="NL",$d="OPENBRACE",zd="CLOSEBRACE",Mm="OPENBRACKET",Dm="CLOSEBRACKET",Am="OPENPAREN",Rm="CLOSEPAREN",Om="OPENANGLEBRACKET",Pm="CLOSEANGLEBRACKET",Lm="FULLWIDTHLEFTPAREN",$m="FULLWIDTHRIGHTPAREN",zm="LEFTCORNERBRACKET",Fm="RIGHTCORNERBRACKET",Bm="LEFTWHITECORNERBRACKET",Um="RIGHTWHITECORNERBRACKET",Hm="FULLWIDTHLESSTHAN",Vm="FULLWIDTHGREATERTHAN",Wm="AMPERSAND",Km="APOSTROPHE",Gm="ASTERISK",ya="AT",qm="BACKSLASH",Ym="BACKTICK",Jm="CARET",Sa="COLON",Lw="COMMA",Xm="DOLLAR",so="DOT",Qm="EQUALS",$w="EXCLAMATION",gi="HYPHEN",Fd="PERCENT",Zm="PIPE",eg="PLUS",tg="POUND",Bd="QUERY",zw="QUOTE",j5="FULLWIDTHMIDDLEDOT",Fw="SEMI",io="SLASH",Ud="TILDE",ng="UNDERSCORE",I5="EMOJI",rg="SYM";var M5=Object.freeze({__proto__:null,ALPHANUMERICAL:N5,AMPERSAND:Wm,APOSTROPHE:Km,ASCIINUMERICAL:E5,ASTERISK:Gm,AT:ya,BACKSLASH:qm,BACKTICK:Ym,CARET:Jm,CLOSEANGLEBRACKET:Pm,CLOSEBRACE:zd,CLOSEBRACKET:Dm,CLOSEPAREN:Rm,COLON:Sa,COMMA:Lw,DOLLAR:Xm,DOT:so,EMOJI:I5,EQUALS:Qm,EXCLAMATION:$w,FULLWIDTHGREATERTHAN:Vm,FULLWIDTHLEFTPAREN:Lm,FULLWIDTHLESSTHAN:Hm,FULLWIDTHMIDDLEDOT:j5,FULLWIDTHRIGHTPAREN:$m,HYPHEN:gi,LEFTCORNERBRACKET:zm,LEFTWHITECORNERBRACKET:Bm,LOCALHOST:Pf,NL:Pw,NUM:Ow,OPENANGLEBRACKET:Om,OPENBRACE:$d,OPENBRACKET:Mm,OPENPAREN:Am,PERCENT:Fd,PIPE:Zm,PLUS:eg,POUND:tg,QUERY:Bd,QUOTE:zw,RIGHTCORNERBRACKET:Fm,RIGHTWHITECORNERBRACKET:Um,SCHEME:Np,SEMI:Fw,SLASH:io,SLASH_SCHEME:jc,SYM:rg,TILDE:Ud,TLD:rb,UNDERSCORE:ng,UTLD:sb,UWORD:nb,WORD:Mo,WS:ib});const No=/[a-z]/,nd=/\p{L}/u,Ey=/\p{Emoji}/u,jo=/\d/,Ny=/\s/,UT="\r",jy=`
`,pq="",mq="",Iy="";let Vh=null,Wh=null;function gq(t=[]){const e={};Ps.groups=e;const n=new Ps;Vh==null&&(Vh=HT(lq)),Wh==null&&(Wh=HT(cq)),At(n,"'",Km),At(n,"{",$d),At(n,"}",zd),At(n,"[",Mm),At(n,"]",Dm),At(n,"(",Am),At(n,")",Rm),At(n,"<",Om),At(n,">",Pm),At(n,"",Lm),At(n,"",$m),At(n,"",zm),At(n,"",Fm),At(n,"",Bm),At(n,"",Um),At(n,"",Hm),At(n,"",Vm),At(n,"&",Wm),At(n,"*",Gm),At(n,"@",ya),At(n,"`",Ym),At(n,"^",Jm),At(n,":",Sa),At(n,",",Lw),At(n,"$",Xm),At(n,".",so),At(n,"=",Qm),At(n,"!",$w),At(n,"-",gi),At(n,"%",Fd),At(n,"|",Zm),At(n,"+",eg),At(n,"#",tg),At(n,"?",Bd),At(n,'"',zw),At(n,"/",io),At(n,";",Fw),At(n,"~",Ud),At(n,"_",ng),At(n,"\\",qm),At(n,"",j5);const r=hr(n,jo,Ow,{[Q1]:!0});hr(r,jo,r);const s=hr(r,No,E5,{[Ld]:!0}),i=hr(r,nd,N5,{[yd]:!0}),o=hr(n,No,Mo,{[Z1]:!0});hr(o,jo,s),hr(o,No,o),hr(s,jo,s),hr(s,No,s);const a=hr(n,nd,nb,{[eb]:!0});hr(a,No),hr(a,jo,i),hr(a,nd,a),hr(i,jo,i),hr(i,No),hr(i,nd,i);const l=At(n,jy,Pw,{[Cy]:!0}),u=At(n,UT,ib,{[Cy]:!0}),d=hr(n,Ny,ib,{[Cy]:!0});At(n,Iy,d),At(u,jy,l),At(u,Iy,d),hr(u,Ny,d),At(d,UT),At(d,jy),hr(d,Ny,d),At(d,Iy,d);const f=hr(n,Ey,I5,{[C5]:!0});At(f,"#"),hr(f,Ey,f),At(f,pq,f);const h=At(f,mq);At(h,"#"),hr(h,Ey,f);const p=[[No,o],[jo,s]],m=[[No,null],[nd,a],[jo,i]];for(let y=0;y<Vh.length;y++)ia(n,Vh[y],rb,Mo,p);for(let y=0;y<Wh.length;y++)ia(n,Wh[y],sb,nb,m);Pl(rb,{tld:!0,ascii:!0},e),Pl(sb,{utld:!0,alpha:!0},e),ia(n,"file",Np,Mo,p),ia(n,"mailto",Np,Mo,p),ia(n,"http",jc,Mo,p),ia(n,"https",jc,Mo,p),ia(n,"ftp",jc,Mo,p),ia(n,"ftps",jc,Mo,p),Pl(Np,{scheme:!0,ascii:!0},e),Pl(jc,{slashscheme:!0,ascii:!0},e),t=t.sort((y,b)=>y[0]>b[0]?1:-1);for(let y=0;y<t.length;y++){const b=t[y][0],v=t[y][1]?{[uq]:!0}:{[dq]:!0};b.indexOf("-")>=0?v[tb]=!0:No.test(b)?jo.test(b)?v[Ld]=!0:v[Z1]=!0:v[Q1]=!0,BT(n,b,b,v)}return BT(n,"localhost",Pf,{ascii:!0}),n.jd=new Ps(rg),{start:n,tokens:Object.assign({groups:e},M5)}}function D5(t,e){const n=yq(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=n.length,s=[];let i=0,o=0;for(;o<r;){let a=t,l=null,u=0,d=null,f=-1,h=-1;for(;o<r&&(l=a.go(n[o]));)a=l,a.accepts()?(f=0,h=0,d=a):f>=0&&(f+=n[o].length,h++),u+=n[o].length,i+=n[o].length,o++;i-=f,o-=h,u-=f,s.push({t:d.t,v:e.slice(i-u,i),s:i-u,e:i})}return s}function yq(t){const e=[],n=t.length;let r=0;for(;r<n;){let s=t.charCodeAt(r),i,o=s<55296||s>56319||r+1===n||(i=t.charCodeAt(r+1))<56320||i>57343?t[r]:t.slice(r,r+2);e.push(o),r+=o.length}return e}function ia(t,e,n,r,s){let i;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];t.j[l]?i=t.j[l]:(i=new Ps(r),i.jr=s.slice(),t.j[l]=i),t=i}return i=new Ps(n),i.jr=s.slice(),t.j[e[o-1]]=i,i}function HT(t){const e=[],n=[];let r=0,s="0123456789";for(;r<t.length;){let i=0;for(;s.indexOf(t[r+i])>=0;)i++;if(i>0){e.push(n.join(""));for(let o=parseInt(t.substring(r,r+i),10);o>0;o--)n.pop();r+=i}else n.push(t[r]),r++}return e}const Lf={defaultProtocol:"http",events:null,format:VT,formatHref:VT,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Bw(t,e=null){let n=Object.assign({},Lf);t&&(n=Object.assign(n,t instanceof Bw?t.o:t));const r=n.ignoreTags,s=[];for(let i=0;i<r.length;i++)s.push(r[i].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=s}Bw.prototype={o:Lf,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let s=this.o[t];return s&&(typeof s=="object"?(s=n.t in s?s[n.t]:Lf[t],typeof s=="function"&&r&&(s=s(e,n))):typeof s=="function"&&r&&(s=s(e,n.t,n)),s)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function VT(t){return t}function A5(t,e){this.t="token",this.v=t,this.tk=e}A5.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=Lf.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),s=t.get("tagName",n,e),i=this.toFormattedString(t),o={},a=t.get("className",n,e),l=t.get("target",n,e),u=t.get("rel",n,e),d=t.getObj("attributes",n,e),f=t.getObj("events",n,e);return o.href=r,a&&(o.class=a),l&&(o.target=l),u&&(o.rel=u),d&&Object.assign(o,d),{tagName:s,attributes:o,content:i,eventListeners:f}}};function Qg(t,e){class n extends A5{constructor(s,i){super(s,i),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const WT=Qg("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),KT=Qg("text"),xq=Qg("nl"),Kh=Qg("url",{isLink:!0,toHref(t=Lf.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==Pf&&t[1].t===Sa}}),pi=t=>new Ps(t);function bq({groups:t}){const e=t.domain.concat([Wm,Gm,ya,qm,Ym,Jm,Xm,Qm,gi,Ow,Fd,Zm,eg,tg,io,rg,Ud,ng]),n=[Km,Sa,Lw,so,$w,Fd,Bd,zw,Fw,Om,Pm,$d,zd,Dm,Mm,Am,Rm,Lm,$m,zm,Fm,Bm,Um,Hm,Vm],r=[Wm,Km,Gm,qm,Ym,Jm,Xm,Qm,gi,$d,zd,Fd,Zm,eg,tg,Bd,io,rg,Ud,ng],s=pi(),i=At(s,Ud);vn(i,r,i),vn(i,t.domain,i);const o=pi(),a=pi(),l=pi();vn(s,t.domain,o),vn(s,t.scheme,a),vn(s,t.slashscheme,l),vn(o,r,i),vn(o,t.domain,o);const u=At(o,ya);At(i,ya,u),At(a,ya,u),At(l,ya,u);const d=At(i,so);vn(d,r,i),vn(d,t.domain,i);const f=pi();vn(u,t.domain,f),vn(f,t.domain,f);const h=At(f,so);vn(h,t.domain,f);const p=pi(WT);vn(h,t.tld,p),vn(h,t.utld,p),At(u,Pf,p);const m=At(f,gi);At(m,gi,m),vn(m,t.domain,f),vn(p,t.domain,f),At(p,so,h),At(p,gi,m);const y=At(p,Sa);vn(y,t.numeric,WT);const b=At(o,gi),g=At(o,so);At(b,gi,b),vn(b,t.domain,o),vn(g,r,i),vn(g,t.domain,o);const v=pi(Kh);vn(g,t.tld,v),vn(g,t.utld,v),vn(v,t.domain,o),vn(v,r,i),At(v,so,g),At(v,gi,b),At(v,ya,u);const w=At(v,Sa),T=pi(Kh);vn(w,t.numeric,T);const R=pi(Kh),k=pi();vn(R,e,R),vn(R,n,k),vn(k,e,R),vn(k,n,k),At(v,io,R),At(T,io,R);const M=At(a,Sa),S=At(l,Sa),C=At(S,io),_=At(C,io);vn(a,t.domain,o),At(a,so,g),At(a,gi,b),vn(l,t.domain,o),At(l,so,g),At(l,gi,b),vn(M,t.domain,R),At(M,io,R),At(M,Bd,R),vn(_,t.domain,R),vn(_,e,R),At(_,io,R);const E=[[$d,zd],[Mm,Dm],[Am,Rm],[Om,Pm],[Lm,$m],[zm,Fm],[Bm,Um],[Hm,Vm]];for(let I=0;I<E.length;I++){const[P,O]=E[I],$=At(R,P);At(k,P,$),At($,O,R);const A=pi(Kh);vn($,e,A);const j=pi();vn($,n),vn(A,e,A),vn(A,n,j),vn(j,e,A),vn(j,n,j),At(A,O,R),At(j,O,R)}return At(s,Pf,v),At(s,Pw,xq),{start:s,tokens:M5}}function vq(t,e,n){let r=n.length,s=0,i=[],o=[];for(;s<r;){let a=t,l=null,u=null,d=0,f=null,h=-1;for(;s<r&&!(l=a.go(n[s].t));)o.push(n[s++]);for(;s<r&&(u=l||a.go(n[s].t));)l=null,a=u,a.accepts()?(h=0,f=a):h>=0&&h++,s++,d++;if(h<0)s-=d,s<r&&(o.push(n[s]),s++);else{o.length>0&&(i.push(My(KT,e,o)),o=[]),s-=h,d-=h;const p=f.t,m=n.slice(s-d,s);i.push(My(p,e,m))}}return o.length>0&&i.push(My(KT,e,o)),i}function My(t,e,n){const r=n[0].s,s=n[n.length-1].e,i=e.slice(r,s);return new t(i,n)}const wq=typeof console<"u"&&console&&console.warn||(()=>{}),kq="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Yn={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Sq(){return Ps.groups={},Yn.scanner=null,Yn.parser=null,Yn.tokenQueue=[],Yn.pluginQueue=[],Yn.customSchemes=[],Yn.initialized=!1,Yn}function GT(t,e=!1){if(Yn.initialized&&wq(`linkifyjs: already initialized - will not register custom scheme "${t}" ${kq}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Yn.customSchemes.push([t,e])}function _q(){Yn.scanner=gq(Yn.customSchemes);for(let t=0;t<Yn.tokenQueue.length;t++)Yn.tokenQueue[t][1]({scanner:Yn.scanner});Yn.parser=bq(Yn.scanner.tokens);for(let t=0;t<Yn.pluginQueue.length;t++)Yn.pluginQueue[t][1]({scanner:Yn.scanner,parser:Yn.parser});return Yn.initialized=!0,Yn}function R5(t){return Yn.initialized||_q(),vq(Yn.parser.start,t,D5(Yn.scanner.start,t))}R5.scan=D5;function Uw(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new Bw(n),s=R5(t),i=[];for(let o=0;o<s.length;o++){const a=s[o];a.isLink&&(!e||a.t===e)&&r.check(a)&&i.push(a.toFormattedObject(r))}return i}function Tq(t){return new jr({key:new ss("autolink"),appendTransaction:(e,n,r)=>{const s=e.some(u=>u.docChanged)&&!n.doc.eq(r.doc),i=e.some(u=>u.getMeta("preventAutolink"));if(!s||i)return;const{tr:o}=r,a=sK(n.doc,[...e]);if(dK(a).forEach(({newRange:u})=>{const d=iK(r.doc,u,p=>p.isTextblock);let f,h;if(d.length>1?(f=d[0],h=r.doc.textBetween(f.pos,f.pos+f.node.nodeSize,void 0," ")):d.length&&r.doc.textBetween(u.from,u.to," "," ").endsWith(" ")&&(f=d[0],h=r.doc.textBetween(f.pos,u.to,void 0," ")),f&&h){const p=h.split(" ").filter(b=>b!=="");if(p.length<=0)return!1;const m=p[p.length-1],y=f.pos+h.lastIndexOf(m);if(!m)return!1;Uw(m).filter(b=>b.isLink).map(b=>({...b,from:y+b.start+1,to:y+b.end+1})).filter(b=>r.schema.marks.code?!r.doc.rangeHasMark(b.from,b.to,r.schema.marks.code):!0).filter(b=>t.validate?t.validate(b.value):!0).forEach(b=>{Dw(b.from,b.to,r.doc).some(g=>g.mark.type===t.type)||o.addMark(b.from,b.to,t.type.create({href:b.href}))})}}),!!o.steps.length)return o}})}function Cq(t){return new jr({key:new ss("handleClickLink"),props:{handleClick:(e,n,r)=>{var s,i;if(r.button!==0)return!1;let o=r.target;const a=[];for(;o.nodeName!=="DIV";)a.push(o),o=o.parentNode;if(!a.find(h=>h.nodeName==="A"))return!1;const l=x5(e.state,t.type.name),u=r.target,d=(s=u==null?void 0:u.href)!==null&&s!==void 0?s:l.href,f=(i=u==null?void 0:u.target)!==null&&i!==void 0?i:l.target;return u&&d?(window.open(d,f),!0):!1}}})}function Eq(t){return new jr({key:new ss("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{state:s}=e,{selection:i}=s,{empty:o}=i;if(o)return!1;let a="";r.content.forEach(u=>{a+=u.textContent});const l=Uw(a).find(u=>u.isLink&&u.value===a);return!a||!l?!1:(t.editor.commands.setMark(t.type,{href:l.href}),!0)}}})}const Nq=oi.create({name:"link",priority:1e3,keepOnSplit:!1,onCreate(){this.options.protocols.forEach(t=>{if(typeof t=="string"){GT(t);return}GT(t.scheme,t.optionalSlashes)})},onDestroy(){Sq()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},validate:void 0}},addAttributes(){return{href:{default:null},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:'a[href]:not([href *= "javascript:" i])'}]},renderHTML({HTMLAttributes:t}){var e;return!((e=t.href)===null||e===void 0)&&e.startsWith("javascript:")?["a",In(this.options.HTMLAttributes,{...t,href:""}),0]:["a",In(this.options.HTMLAttributes,t),0]},addCommands(){return{setLink:t=>({chain:e})=>e().setMark(this.name,t).setMeta("preventAutolink",!0).run(),toggleLink:t=>({chain:e})=>e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run(),unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Ya({find:t=>{const e=[];if(t){const n=Uw(t).filter(r=>r.isLink);n.length&&n.forEach(r=>e.push({text:r.value,data:{href:r.href},index:r.start}))}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[];return this.options.autolink&&t.push(Tq({type:this.type,validate:this.options.validate})),this.options.openOnClick&&t.push(Cq({type:this.type})),this.options.linkOnPaste&&t.push(Eq({editor:this.editor,type:this.type})),t}}),jq=Wr.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,considerAnyAsEmpty:!1,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new jr({key:new ss("placeholder"),props:{decorations:({doc:t,selection:e})=>{var n;const r=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:s}=e,i=[];if(!r)return null;const{firstChild:o}=t.content,a=o&&o.type.isLeaf,l=o&&o.isAtom,u=this.options.considerAnyAsEmpty?!0:o&&o.type.name===((n=t.type.contentMatch.defaultType)===null||n===void 0?void 0:n.name),d=t.content.childCount<=1&&o&&u&&o.nodeSize<=2&&(!a||!l);return t.descendants((f,h)=>{const p=s>=h&&s<=h+f.nodeSize,m=!f.isLeaf&&!f.childCount;if((p||!this.options.showOnlyCurrent)&&m){const y=[this.options.emptyNodeClass];d&&y.push(this.options.emptyEditorClass);const b=zs.node(h,h+f.nodeSize,{class:y.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:f,pos:h,hasAnchor:p}):this.options.placeholder});i.push(b)}return this.options.includeChildren}),vr.create(t,i)}}})]}}),Iq=yr.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",In(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}}),Mq=/^\s*(\[([( |x])?\])\s$/,Dq=yr.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList"}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>t.getAttribute("data-checked")==="true",renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",In(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:n,editor:r})=>{const s=document.createElement("li"),i=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div");return i.contentEditable="false",a.type="checkbox",a.addEventListener("change",u=>{if(!r.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:d}=u.target;r.isEditable&&typeof n=="function"&&r.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:f})=>{const h=n(),p=f.doc.nodeAt(h);return f.setNodeMarkup(h,void 0,{...p==null?void 0:p.attrs,checked:d}),!0}).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,d)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([u,d])=>{s.setAttribute(u,d)}),s.dataset.checked=t.attrs.checked,t.attrs.checked&&a.setAttribute("checked","checked"),i.append(a,o),s.append(i,l),Object.entries(e).forEach(([u,d])=>{s.setAttribute(u,d)}),{dom:s,contentDOM:l,update:u=>u.type!==this.type?!1:(s.dataset.checked=u.attrs.checked,u.attrs.checked?a.setAttribute("checked","checked"):a.removeAttribute("checked"),!0)}}},addInputRules(){return[Eu({find:Mq,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),Aq=t=>{if(!t.children.length)return;const e=t.querySelectorAll("span");e&&e.forEach(n=>{var r,s;const i=n.getAttribute("style"),o=(s=(r=n.parentElement)===null||r===void 0?void 0:r.closest("span"))===null||s===void 0?void 0:s.getAttribute("style");n.setAttribute("style",`${o};${i}`)})},Rq=oi.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{},mergeNestedSpanStyles:!1}},parseHTML(){return[{tag:"span",getAttrs:t=>t.hasAttribute("style")?(this.options.mergeNestedSpanStyles&&Aq(t),{}):!1}]},renderHTML({HTMLAttributes:t}){return["span",In(this.options.HTMLAttributes,t),0]},addCommands(){return{removeEmptyTextStyle:()=>({tr:t})=>{const{selection:e}=t;return t.doc.nodesBetween(e.from,e.to,(n,r)=>{if(n.isTextblock)return!0;n.marks.filter(s=>s.type===this.type).some(s=>Object.values(s.attrs).some(i=>!!i))||t.removeMark(r,r+n.nodeSize,this.type)}),!0}}}}),Oq=Wr.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:t=>{var e;return(e=t.style.color)===null||e===void 0?void 0:e.replace(/['"]+/g,"")},renderHTML:t=>t.color?{style:`color: ${t.color}`}:{}}}}]},addCommands(){return{setColor:t=>({chain:e})=>e().setMark("textStyle",{color:t}).run(),unsetColor:()=>({chain:t})=>t().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}),Pq=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))$/,Lq=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))/g,$q=oi.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",In(this.options.HTMLAttributes,t),0]},addCommands(){return{setHighlight:t=>({commands:e})=>e.setMark(this.name,t),toggleHighlight:t=>({commands:e})=>e.toggleMark(this.name,t),unsetHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[nc({find:Pq,type:this.type})]},addPasteRules(){return[Ya({find:Lq,type:this.type})]}}),sg=(t,e)=>e.view.domAtPos(t).node.offsetParent!==null,zq=(t,e,n)=>{for(let r=t.depth;r>0;r-=1){const s=t.node(r),i=e(s),o=sg(t.start(r),n);if(i&&o)return{pos:r>0?t.before(r):0,start:t.start(r),depth:r,node:s}}},qT=(t,e)=>{const{state:n,view:r,extensionManager:s}=t,{schema:i,selection:o}=n,{empty:a,$anchor:l}=o,u=!!s.extensions.find(g=>g.name==="gapCursor");if(!a||l.parent.type!==i.nodes.detailsSummary||!u||e==="right"&&l.parentOffset!==l.parent.nodeSize-2)return!1;const d=Fu(g=>g.type===i.nodes.details)(o);if(!d)return!1;const f=Tp(d.node,g=>g.type===i.nodes.detailsContent);if(!f.length||sg(d.start+f[0].pos+1,t))return!1;const p=n.doc.resolve(d.pos+d.node.nodeSize),m=rr.findFrom(p,1,!1);if(!m)return!1;const{tr:y}=n,b=new rr(m);return y.setSelection(b),y.scrollIntoView(),r.dispatch(y),!0},Fq=yr.create({name:"details",content:"detailsSummary detailsContent",group:"block",defining:!0,isolating:!0,allowGapCursor:!1,addOptions(){return{persist:!1,openClassName:"is-open",HTMLAttributes:{}}},addAttributes(){return this.options.persist?{open:{default:!1,parseHTML:t=>t.hasAttribute("open"),renderHTML:({open:t})=>t?{open:""}:{}}}:[]},parseHTML(){return[{tag:"details"}]},renderHTML({HTMLAttributes:t}){return["details",In(this.options.HTMLAttributes,t),0]},addNodeView(){return({editor:t,getPos:e,node:n,HTMLAttributes:r})=>{const s=document.createElement("div"),i=In(this.options.HTMLAttributes,r,{"data-type":this.name});Object.entries(i).forEach(([u,d])=>s.setAttribute(u,d));const o=document.createElement("button");o.type="button",s.append(o);const a=document.createElement("div");s.append(a);const l=u=>{if(u!==void 0)if(u){if(s.classList.contains(this.options.openClassName))return;s.classList.add(this.options.openClassName)}else{if(!s.classList.contains(this.options.openClassName))return;s.classList.remove(this.options.openClassName)}else s.classList.toggle(this.options.openClassName);const d=new Event("toggleDetailsContent"),f=a.querySelector(':scope > div[data-type="detailsContent"]');f==null||f.dispatchEvent(d)};return n.attrs.open&&setTimeout(()=>l()),o.addEventListener("click",()=>{if(l(),!this.options.persist){t.commands.focus(void 0,{scrollIntoView:!1});return}if(t.isEditable&&typeof e=="function"){const{from:u,to:d}=t.state.selection;t.chain().command(({tr:f})=>{const h=e(),p=f.doc.nodeAt(h);return(p==null?void 0:p.type)!==this.type?!1:(f.setNodeMarkup(h,void 0,{open:!p.attrs.open}),!0)}).setTextSelection({from:u,to:d}).focus(void 0,{scrollIntoView:!1}).run()}}),{dom:s,contentDOM:a,ignoreMutation(u){return u.type==="selection"?!1:!s.contains(u.target)||s===u.target},update:u=>u.type!==this.type?!1:(u.attrs.open!==void 0&&l(u.attrs.open),!0)}}},addCommands(){return{setDetails:()=>({state:t,chain:e})=>{var n;const{schema:r,selection:s}=t,{$from:i,$to:o}=s,a=i.blockRange(o);if(!a)return!1;const l=t.doc.slice(a.start,a.end);if(!r.nodes.detailsContent.contentMatch.matchFragment(l.content))return!1;const d=((n=l.toJSON())===null||n===void 0?void 0:n.content)||[];return e().insertContentAt({from:a.start,to:a.end},{type:this.name,content:[{type:"detailsSummary"},{type:"detailsContent",content:d}]}).setTextSelection(a.start+2).run()},unsetDetails:()=>({state:t,chain:e})=>{const{selection:n,schema:r}=t,s=Fu(g=>g.type===this.type)(n);if(!s)return!1;const i=Tp(s.node,g=>g.type===r.nodes.detailsSummary),o=Tp(s.node,g=>g.type===r.nodes.detailsContent);if(!i.length||!o.length)return!1;const a=i[0],l=o[0],u=s.pos,d=t.doc.resolve(u),f=u+s.node.nodeSize,h={from:u,to:f},p=l.node.content.toJSON()||[],m=d.parent.type.contentMatch.defaultType,b=[m==null?void 0:m.create(null,a.node.content).toJSON(),...p];return e().insertContentAt(h,b).setTextSelection(u+1).run()}}},addKeyboardShortcuts(){return{Backspace:()=>{const{schema:t,selection:e}=this.editor.state,{empty:n,$anchor:r}=e;return!n||r.parent.type!==t.nodes.detailsSummary?!1:r.parentOffset!==0?this.editor.commands.command(({tr:s})=>{const i=r.pos-1,o=r.pos;return s.delete(i,o),!0}):this.editor.commands.unsetDetails()},Enter:({editor:t})=>{const{state:e,view:n}=t,{schema:r,selection:s}=e,{$head:i}=s;if(i.parent.type!==r.nodes.detailsSummary)return!1;const o=sg(i.after()+1,t),a=o?e.doc.nodeAt(i.after()):i.node(-2);if(!a)return!1;const l=o?0:i.indexAfter(-1),u=Mw(a.contentMatchAt(l));if(!u||!a.canReplaceWith(l,l,u))return!1;const d=u.createAndFill();if(!d)return!1;const f=o?i.after()+1:i.after(-1),h=e.tr.replaceWith(f,f,d),p=h.doc.resolve(f),m=mn.near(p,1);return h.setSelection(m),h.scrollIntoView(),n.dispatch(h),!0},ArrowRight:({editor:t})=>qT(t,"right"),ArrowDown:({editor:t})=>qT(t,"down")}},addProseMirrorPlugins(){return[new jr({key:new ss("detailsSelection"),appendTransaction:(t,e,n)=>{const{editor:r,type:s}=this;if(!t.some(b=>b.selectionSet)||!e.selection.empty||!n.selection.empty||!b5(n,s.name))return;const{$from:a}=n.selection;if(sg(a.pos,r))return;const u=zq(a,b=>b.type===s,r);if(!u)return;const d=Tp(u.node,b=>b.type===n.schema.nodes.detailsSummary);if(!d.length)return;const f=d[0],p=(e.selection.from<n.selection.from?"forward":"backward")==="forward"?u.start+f.pos:u.pos+f.pos+f.node.nodeSize,m=pn.create(n.doc,p);return n.tr.setSelection(m)}})]}}),Bq=yr.create({name:"detailsSummary",content:"text*",defining:!0,selectable:!1,isolating:!0,addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"summary"}]},renderHTML({HTMLAttributes:t}){return["summary",In(this.options.HTMLAttributes,t),0]}}),Uq=yr.create({name:"detailsContent",content:"block+",defining:!0,selectable:!1,addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:`div[data-type="${this.name}"]`}]},renderHTML({HTMLAttributes:t}){return["div",In(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},addNodeView(){return({HTMLAttributes:t})=>{const e=document.createElement("div"),n=In(this.options.HTMLAttributes,t,{"data-type":this.name,hidden:"hidden"});return Object.entries(n).forEach(([r,s])=>e.setAttribute(r,s)),e.addEventListener("toggleDetailsContent",()=>{e.toggleAttribute("hidden")}),{dom:e,contentDOM:e,ignoreMutation(r){return r.type==="selection"?!1:!e.contains(r.target)||e===r.target},update:r=>r.type===this.type}}},addKeyboardShortcuts(){return{Enter:({editor:t})=>{const{state:e,view:n}=t,{selection:r}=e,{$from:s,empty:i}=r,o=Fu(E=>E.type===this.type)(r);if(!i||!o||!o.node.childCount)return!1;const a=s.index(o.depth),{childCount:l}=o.node;if(!(l===a+1))return!1;const d=o.node.type.contentMatch.defaultType,f=d==null?void 0:d.createAndFill();if(!f)return!1;const h=e.doc.resolve(o.pos+1),p=l-1,m=o.node.child(p),y=h.posAtIndex(p,o.depth);if(!m.eq(f))return!1;const g=s.node(-3);if(!g)return!1;const v=s.indexAfter(-3),w=Mw(g.contentMatchAt(v));if(!w||!g.canReplaceWith(v,v,w))return!1;const T=w.createAndFill();if(!T)return!1;const{tr:R}=e,k=s.after(-2);R.replaceWith(k,k,T);const M=R.doc.resolve(k),S=mn.near(M,1);R.setSelection(S);const C=y,_=y+m.nodeSize;return R.delete(C,_),R.scrollIntoView(),n.dispatch(R),!0}}}});function Hq(t){var e;const{char:n,allowSpaces:r,allowToIncludeChar:s,allowedPrefixes:i,startOfLine:o,$position:a}=t,l=r&&!s,u=GK(n),d=new RegExp(`\\s${u}$`),f=o?"^":"",h=s?"":u,p=l?new RegExp(`${f}${u}.*?(?=\\s${h}|$)`,"gm"):new RegExp(`${f}(?:^)?${u}[^\\s${h}]*`,"gm"),m=((e=a.nodeBefore)===null||e===void 0?void 0:e.isText)&&a.nodeBefore.text;if(!m)return null;const y=a.pos-m.length,b=Array.from(m.matchAll(p)).pop();if(!b||b.input===void 0||b.index===void 0)return null;const g=b.input.slice(Math.max(0,b.index-1),b.index),v=new RegExp(`^[${i==null?void 0:i.join("")}\0]?$`).test(g);if(i!==null&&!v)return null;const w=y+b.index;let T=w+b[0].length;return l&&d.test(m.slice(T-1,T+1))&&(b[0]+=" ",T+=1),w<a.pos&&T>=a.pos?{range:{from:w,to:T},query:b[0].slice(n.length),text:b[0]}:null}const Vq=new ss("suggestion");function Wq({pluginKey:t=Vq,editor:e,char:n="@",allowSpaces:r=!1,allowToIncludeChar:s=!1,allowedPrefixes:i=[" "],startOfLine:o=!1,decorationTag:a="span",decorationClass:l="suggestion",decorationContent:u="",decorationEmptyClass:d="is-empty",command:f=()=>null,items:h=()=>[],render:p=()=>({}),allow:m=()=>!0,findSuggestionMatch:y=Hq}){let b;const g=p==null?void 0:p(),v=new jr({key:t,view(){return{update:async(w,T)=>{var R,k,M,S,C,_,E;const I=(R=this.key)===null||R===void 0?void 0:R.getState(T),P=(k=this.key)===null||k===void 0?void 0:k.getState(w.state),O=I.active&&P.active&&I.range.from!==P.range.from,$=!I.active&&P.active,A=I.active&&!P.active,j=!$&&!A&&I.query!==P.query,W=$||O&&j,V=j||O,D=A||O&&j;if(!W&&!V&&!D)return;const ge=D&&!W?I:P,me=w.dom.querySelector(`[data-decoration-id="${ge.decorationId}"]`);b={editor:e,range:ge.range,query:ge.query,text:ge.text,items:[],command:F=>f({editor:e,range:ge.range,props:F}),decorationNode:me,clientRect:me?()=>{var F;const{decorationId:U}=(F=this.key)===null||F===void 0?void 0:F.getState(e.state),ne=w.dom.querySelector(`[data-decoration-id="${U}"]`);return(ne==null?void 0:ne.getBoundingClientRect())||null}:null},W&&((M=g==null?void 0:g.onBeforeStart)===null||M===void 0||M.call(g,b)),V&&((S=g==null?void 0:g.onBeforeUpdate)===null||S===void 0||S.call(g,b)),(V||W)&&(b.items=await h({editor:e,query:ge.query})),D&&((C=g==null?void 0:g.onExit)===null||C===void 0||C.call(g,b)),V&&((_=g==null?void 0:g.onUpdate)===null||_===void 0||_.call(g,b)),W&&((E=g==null?void 0:g.onStart)===null||E===void 0||E.call(g,b))},destroy:()=>{var w;b&&((w=g==null?void 0:g.onExit)===null||w===void 0||w.call(g,b))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(w,T,R,k){const{isEditable:M}=e,{composing:S}=e.view,{selection:C}=w,{empty:_,from:E}=C,I={...T};if(I.composing=S,M&&(_||e.view.composing)){(E<T.range.from||E>T.range.to)&&!S&&!T.composing&&(I.active=!1);const P=y({char:n,allowSpaces:r,allowToIncludeChar:s,allowedPrefixes:i,startOfLine:o,$position:C.$from}),O=`id_${Math.floor(Math.random()*4294967295)}`;P&&m({editor:e,state:k,range:P.range,isActive:T.active})?(I.active=!0,I.decorationId=T.decorationId?T.decorationId:O,I.range=P.range,I.query=P.query,I.text=P.text):I.active=!1}else I.active=!1;return I.active||(I.decorationId=null,I.range={from:0,to:0},I.query=null,I.text=null),I}},props:{handleKeyDown(w,T){var R;const{active:k,range:M}=v.getState(w.state);return k&&((R=g==null?void 0:g.onKeyDown)===null||R===void 0?void 0:R.call(g,{view:w,event:T,range:M}))||!1},decorations(w){const{active:T,range:R,decorationId:k,query:M}=v.getState(w);if(!T)return null;const S=!(M!=null&&M.length),C=[l];return S&&C.push(d),vr.create(w.doc,[zs.inline(R.from,R.to,{nodeName:a,class:C.join(" "),"data-decoration-id":k,"data-decoration-content":u})])}}});return v}function Kq({editor:t,overrideSuggestionOptions:e,extensionName:n,char:r="@"}){const s=new ss;return{editor:t,char:r,pluginKey:s,command:({editor:i,range:o,props:a})=>{var l,u,d;const f=i.view.state.selection.$to.nodeAfter;((l=f==null?void 0:f.text)===null||l===void 0?void 0:l.startsWith(" "))&&(o.to+=1),i.chain().focus().insertContentAt(o,[{type:n,attrs:{...a,mentionSuggestionChar:r}},{type:"text",text:" "}]).run(),(d=(u=i.view.dom.ownerDocument.defaultView)===null||u===void 0?void 0:u.getSelection())===null||d===void 0||d.collapseToEnd()},allow:({state:i,range:o})=>{const a=i.doc.resolve(o.from),l=i.schema.nodes[n];return!!a.parent.type.contentMatch.matchType(l)},...e}}function O5(t){return(t.options.suggestions.length?t.options.suggestions:[t.options.suggestion]).map(e=>Kq({editor:t.editor,overrideSuggestionOptions:e,extensionName:t.name,char:e.char}))}function YT(t,e){const n=O5(t),r=n.find(s=>s.char===e);return r||(n.length?n[0]:null)}const Gq=yr.create({name:"mention",priority:101,addOptions(){return{HTMLAttributes:{},renderText({node:t,suggestion:e}){var n,r;return`${(n=e==null?void 0:e.char)!==null&&n!==void 0?n:"@"}${(r=t.attrs.label)!==null&&r!==void 0?r:t.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:t,node:e,suggestion:n}){var r,s;return["span",In(this.HTMLAttributes,t.HTMLAttributes),`${(r=n==null?void 0:n.char)!==null&&r!==void 0?r:"@"}${(s=e.attrs.label)!==null&&s!==void 0?s:e.attrs.id}`]},suggestions:[],suggestion:{}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}},mentionSuggestionChar:{default:"@",parseHTML:t=>t.getAttribute("data-mention-suggestion-char"),renderHTML:t=>({"data-mention-suggestion-char":t.mentionSuggestionChar})}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:e}){const n=YT(this,t.attrs.mentionSuggestionChar);if(this.options.renderLabel!==void 0)return console.warn("renderLabel is deprecated use renderText and renderHTML instead"),["span",In({"data-type":this.name},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:t,suggestion:n})];const r={...this.options};r.HTMLAttributes=In({"data-type":this.name},this.options.HTMLAttributes,e);const s=this.options.renderHTML({options:r,node:t,suggestion:n});return typeof s=="string"?["span",In({"data-type":this.name},this.options.HTMLAttributes,e),s]:s},renderText({node:t}){const e={options:this.options,node:t,suggestion:YT(this,t.attrs.mentionSuggestionChar)};return this.options.renderLabel!==void 0?(console.warn("renderLabel is deprecated use renderText and renderHTML instead"),this.options.renderLabel(e)):this.options.renderText(e)},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:t,state:e})=>{let n=!1;const{selection:r}=e,{empty:s,anchor:i}=r;if(!s)return!1;e.doc.nodesBetween(i-1,i,(l,u)=>{if(l.type.name===this.name)return n=!0,t.insertText(this.options.deleteTriggerWithBackspace?"":this.options.suggestion.char||"",u,u+l.nodeSize),!1});let o=new Uo,a=0;return e.doc.nodesBetween(i-1,i,(l,u)=>{if(l.type.name===this.name)return n=!0,o=l,a=u,!1}),n&&t.insertText(this.options.deleteTriggerWithBackspace?"":o.attrs.mentionSuggestionChar,a,a+o.nodeSize),n})}},addProseMirrorPlugins(){return O5(this).map(Wq)}}),qq=(t,e)=>Wr.create({name:"keyboardNavigation",addKeyboardShortcuts(){return{Enter:()=>(e&&e(),!1),Tab:({editor:n})=>{var a;if(n.isEmpty)return!1;const{state:r}=n,{selection:s}=r,{$from:i}=s;return((a=i.node(-1))==null?void 0:a.type.name)==="listItem"?n.commands.sinkListItem("listItem"):n.commands.insertContent("")},"Shift-Tab":({editor:n})=>{var a;if(n.isEmpty)return!1;const{state:r}=n,{selection:s}=r,{$from:i}=s;if(((a=i.node(-1))==null?void 0:a.type.name)==="listItem")return n.commands.liftListItem("listItem");{const{$anchor:l}=s,d=l.parent.textContent.substring(0,l.parentOffset).match(/[\u00A0 ]{1,4}$/);if(d){const f=l.pos-d[0].length,h=l.pos;return n.commands.deleteRange({from:f,to:h}),!0}}return!0},"Mod-Enter":()=>t?(t(),!0):!1,Escape:()=>!1,"Mod-Alt-5":({editor:n})=>n.chain().focus().toggleBulletList().run(),"Mod-Alt-6":({editor:n})=>n.chain().focus().toggleOrderedList().run(),"Mod-Alt-7":({editor:n})=>n.isActive("details")?n.chain().focus().unsetDetails().run():n.chain().focus().setDetails().run()}}}),Yq=oi.create({name:"timestamp",inclusive:!1,excludes:"",addAttributes(){return{time:{default:0,parseHTML:t=>parseInt(t.getAttribute("data-time")||"0",10),renderHTML:t=>t.time?{"data-time":t.time}:{}},recordingId:{default:null,parseHTML:t=>t.getAttribute("data-recording-id"),renderHTML:t=>t.recordingId?{"data-recording-id":t.recordingId,class:"timestamp-marker cursor-pointer hover:bg-indigo-100/50 hover:text-indigo-800 transition-colors rounded-sm px-[1px]",title:`Jump to ${Math.floor(t.time/1e3)}s`}:{}}}},parseHTML(){return[{tag:"span[data-time]"}]},renderHTML({HTMLAttributes:t}){return["span",In(t),0]}}),Jq=yr.create({name:"paragraph",priority:1e3,group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",In(t),0]},addAttributes(){return{"data-paragraph-id":{default:null,parseHTML:t=>t.getAttribute("data-paragraph-id"),renderHTML:t=>t["data-paragraph-id"]?{"data-paragraph-id":t["data-paragraph-id"]}:{}},"data-timestamp":{default:null,parseHTML:t=>t.getAttribute("data-timestamp"),renderHTML:t=>t["data-timestamp"]?{"data-timestamp":t["data-timestamp"],class:"cursor-pointer hover:bg-indigo-50/50 transition-colors rounded px-1 -mx-1",title:"Click to play audio"}:{}}}}}),Xq=oi.create({name:"attachmentLink",addAttributes(){return{attachmentUrls:{default:[],parseHTML:t=>{const e=t.getAttribute("data-attachment-urls");return e?JSON.parse(e):[]},renderHTML:t=>!t.attachmentUrls||t.attachmentUrls.length===0?{}:{"data-attachment-urls":JSON.stringify(t.attachmentUrls)}}}},parseHTML(){return[{tag:"span[data-attachment-link]"}]},renderHTML({HTMLAttributes:t}){return["span",In(t,{"data-attachment-link":"true",class:"attachment-link-text cursor-pointer"}),0]}}),Qq=({node:t})=>null,Zq=yr.create({name:"audioMarker",group:"inline",inline:!0,atom:!0,addAttributes(){return{id:{default:null},time:{default:null},label:{default:"0:00"},fileName:{default:null}}},parseHTML(){return[{tag:'span[data-type="audio-marker"]'}]},renderHTML({HTMLAttributes:t}){return["span",In(t,{"data-type":"audio-marker"})]},addNodeView(){return aG(Qq)}}),Zg=x.forwardRef(({initialContent:t,onChange:e,onExit:n,onPolish:r,onEditorReady:s,editable:i=!0,className:o="",placeholder:a="",textSizeClass:l="text-base",descFontClass:u="font-normal",autoFocus:d=!1,onAudioMarkerClick:f,activeMarkerIds:h,onMarkersChange:p,attachments:m=[],taskColor:y="#6366f1",availableTags:b=[],onCreateTag:g},v)=>{const{t:w}=x.useContext(En),[T,R]=x.useState(!1),[k,M]=x.useState({top:0,left:0}),S=x.useRef(null),C=x.useRef(b),_=x.useRef(g),E=x.useRef(!1),I=x.useRef(e);x.useEffect(()=>{C.current=b},[b]),x.useEffect(()=>{_.current=g},[g]),x.useEffect(()=>{I.current=e},[e]);const[P,O]=x.useState(!1),[$,A]=x.useState({top:0,left:0}),[j,W]=x.useState(null),[V,D]=x.useState([]),[ge,me]=x.useState(!1),[F,U]=x.useState({top:0,left:0}),[ne,Oe]=x.useState([]);x.useImperativeHandle(v,()=>({toggleRecording:()=>{},chain:()=>{var Z;return(Z=Be.current)==null?void 0:Z.chain()},focus:()=>{var Z;return(Z=Be.current)==null?void 0:Z.commands.focus()},insertContent:Z=>{var ie;return(ie=Be.current)==null?void 0:ie.commands.insertContent(Z)},getEditor:()=>Be.current}));const at=x.useContext(Ru),ae=(at==null?void 0:at.isRecording)||!1,_e=(at==null?void 0:at.recordingTime)||0,le=(at==null?void 0:at.addMarker)||(()=>null),Ce=(at==null?void 0:at.currentRecordingId)||null,Le=x.useRef(_e),Ve=x.useRef(Ce),st=x.useRef(ae);x.useEffect(()=>{Le.current=_e,Ve.current=Ce,st.current=ae},[_e,Ce,ae]);const Be=x.useRef(null);x.useEffect(()=>{window.__activeMarkerIds=h,window.dispatchEvent(new CustomEvent("active-markers-change",{detail:{ids:h}}))},[h]),x.useEffect(()=>{const Z=ie=>{var he;f&&((he=ie.detail)==null?void 0:he.time)!==void 0&&f(ie.detail.time)};return window.addEventListener("audio-marker-click",Z),()=>{window.removeEventListener("audio-marker-click",Z)}},[f]);const ht=Z=>{const ie=Math.floor(Z/1e3),he=Math.floor(ie/60),se=ie%60;return`${he.toString().padStart(2,"0")}:${se.toString().padStart(2,"0")}`},vt=()=>{if(ae&&Be.current){const Z=le();if(Z){const{id:ie,time:he}=Z;console.log("Enter pressed during recording at:",he);const se=ht(he);Be.current.chain().insertContent({type:"audioMarker",attrs:{id:ie,time:he,label:se}}).insertContent(" ").run()}}},te=eG({extensions:[aq.configure({paragraph:!1,bulletList:{keepMarks:!0,keepAttributes:!1},orderedList:{keepMarks:!0,keepAttributes:!1}}),Jq,Yq,Zq,Rq,Oq,$q.configure({multicolor:!0}),Nq.configure({openOnClick:!1,autolink:!0}),jq.configure({placeholder:a||w("addNotePlaceholder"),emptyEditorClass:"is-editor-empty before:content-[attr(data-placeholder)] before:text-slate-300 before:float-left before:pointer-events-none before:h-0"}),Iq,Dq.configure({nested:!0}),Fq.configure({persist:!0,HTMLAttributes:{class:"details"}}),Bq,Uq,Xq,Gq.configure({HTMLAttributes:{class:"tag-mention"},renderLabel({node:Z}){return Z.attrs.label??Z.attrs.id},suggestion:{char:"@",allowSpaces:!1,items:({query:Z})=>{const ie=C.current;if(!Z)return ie.slice(0,10);const he=Z.toLowerCase();return ie.filter(Q=>Q.name.toLowerCase().includes(he)).slice(0,10)},render:()=>{let Z=null,ie=0,he=[],se=null;return{onStart:Q=>{var Me;E.current=!0,he=Q.items,ie=0,Z=document.createElement("div"),Z.className="mention-suggestion-popup fixed z-[99999] bg-white dark:bg-gray-800 shadow-lg rounded-lg border border-gray-200 dark:border-gray-700 py-1 min-w-[200px] max-w-[300px] max-h-[300px] overflow-y-auto",document.body.appendChild(Z),se={command:Q.command,query:Q.query,range:Q.range,onKeyDown:({event:fe})=>{if(fe.key==="ArrowDown"){fe.preventDefault();const Re=he.length>0?he.length:0,xt=(se==null?void 0:se.query)&&se.query.trim().length>0?Re+1:Re;return ie=(ie+1)%xt,se==null||se.updateItems(he,se.query),!0}if(fe.key==="ArrowUp"){fe.preventDefault();const qe=(se==null?void 0:se.query)&&se.query.trim().length>0?he.length+1:he.length;return ie=(ie-1+qe)%qe,se==null||se.updateItems(he,se.query),!0}return fe.key==="Enter"?(fe.preventDefault(),se==null||se.selectItem(ie),!0):fe.key==="Escape"?(fe.preventDefault(),!0):!1},updateItems:(fe,Re)=>{if(he=fe,!Z)return;const qe=Re&&Re.trim().length>0&&!fe.some(xt=>xt.name.toLowerCase()===Re.toLowerCase());if(Z.innerHTML="",fe.length===0&&!qe){Z.innerHTML='<div class="px-3 py-2 text-sm text-gray-400"></div>';return}if(fe.forEach((xt,Dt)=>{const oe=document.createElement("div");oe.className=`px-3 py-2 cursor-pointer flex items-center gap-2 text-sm ${Dt===ie?"bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,oe.innerHTML=`
                                                <span class="w-2 h-2 rounded-full" style="background-color: ${xt.color||"#6366f1"}"></span>
                                                <span class="truncate">${xt.name}</span>
                                            `,oe.addEventListener("mouseenter",()=>{ie=Dt,se==null||se.updateItems(he,Re)}),oe.addEventListener("mousedown",Ee=>{Ee.preventDefault(),se==null||se.selectItem(Dt)}),Z.appendChild(oe)}),qe){const xt=fe.length,Dt=document.createElement("div");Dt.className=`px-3 py-2 cursor-pointer flex items-center gap-2 text-sm border-t border-gray-100 dark:border-gray-700 ${ie===xt?"bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,Dt.innerHTML=`
                                                <span class="text-green-500">+</span>
                                                <span> "<strong>${Re}</strong>"</span>
                                            `,Dt.addEventListener("mouseenter",()=>{ie=xt,se==null||se.updateItems(he,Re)}),Dt.addEventListener("mousedown",oe=>{oe.preventDefault(),se==null||se.selectItem(xt)}),Z.appendChild(Dt)}},selectItem:async fe=>{const Re=(se==null?void 0:se.query)&&se.query.trim().length>0&&!he.some(oe=>oe.name.toLowerCase()===se.query.toLowerCase()),qe=se==null?void 0:se.command,xt=se==null?void 0:se.range,Dt=Be.current;if(fe<he.length){const oe=he[fe];qe&&qe({id:oe.id,label:oe.name})}else if(Re&&_.current&&xt&&Dt){const oe=se.query.trim(),{from:Ee,to:Ue}=xt;Z&&(Z.remove(),Z=null),E.current=!1;const tt=await _.current(oe);tt&&Be.current&&Be.current.chain().focus().deleteRange({from:Ee,to:Ue}).insertContentAt(Ee,{type:"mention",attrs:{id:tt.id,label:tt.name}}).run()}}},se.updateItems(he,Q.query);const ke=(Me=Q.clientRect)==null?void 0:Me.call(Q);ke&&Z&&(Z.style.left=`${ke.left}px`,Z.style.top=`${ke.bottom+5}px`)},onUpdate:Q=>{var Me;he=Q.items,se&&(se.query=Q.query,se.range=Q.range,ie=0,se.updateItems(he,Q.query));const ke=(Me=Q.clientRect)==null?void 0:Me.call(Q);ke&&Z&&(Z.style.left=`${ke.left}px`,Z.style.top=`${ke.bottom+5}px`)},onKeyDown:Q=>(se==null?void 0:se.onKeyDown(Q))??!1,onExit:()=>{E.current=!1,Z&&(Z.remove(),Z=null),se=null}}}}}),qq(n,vt)],content:t,editable:i,editorProps:{attributes:{class:`prose prose-sm max-w-none focus:outline-none min-h-[100px] text-theme-secondary ${l} ${u} leading-relaxed custom-scrollbar selection:bg-indigo-100`,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"}},onUpdate:({editor:Z})=>{if(!window.__imeComposing){if(e){const ie=Z.getHTML();e(Z.isEmpty?"":ie)}if(p){const ie=[];Z.state.doc.descendants(he=>{he.type.name==="audioMarker"&&he.attrs.id&&ie.push({id:he.attrs.id,time:he.attrs.time||0})}),p(ie)}}},onCreate:({editor:Z})=>{if(s&&s(Z),p){const ie=[];Z.state.doc.descendants(he=>{he.type.name==="audioMarker"&&he.attrs.id&&ie.push({id:he.attrs.id,time:he.attrs.time||0})}),p(ie)}},onSelectionUpdate:({editor:Z})=>{if(window.__imeComposing)return;S.current&&clearTimeout(S.current);const{from:ie,to:he}=Z.state.selection;ie!==he&&i?S.current=setTimeout(()=>{const se=window.getSelection();if(se&&se.rangeCount>0){const ke=se.getRangeAt(0).getBoundingClientRect(),Me={top:ke.bottom+5,left:ke.left+ke.width/2};M(Me),A(Me),R(!0)}},500):(R(!1),O(!1))}});return x.useEffect(()=>{if(!te)return;const Z=({transaction:ke})=>{if(!window.__imeComposing&&st.current&&Le.current>=0&&ke.docChanged){const Me=Le.current,{selection:fe}=te.state;if(!fe.empty)return;const Re=fe.$from,qe=Re.parent.textContent.substring(0,Re.parentOffset),xt=qe.lastIndexOf("@");if(xt!==-1&&!qe.substring(xt+1).includes(" ")||E.current)return;const oe=Re.marks().find(Ue=>Ue.type.name==="timestamp");let Ee=!0;if(oe){const Ue=oe.attrs.time;Me-Ue<2e3&&(Ee=!1)}if(Ee){const Ue=Ve.current;te.commands.setMark("timestamp",{time:Me,recordingId:Ue})}else oe&&te.commands.setMark("timestamp",oe.attrs)}};let ie=null;const he=()=>{window.__imeComposing=!0,te&&(ie=te.state.selection.from)},se=()=>{if(window.__imeComposing=!1,st.current&&Le.current>=0&&te&&ie!==null){const ke=Le.current,Me=Ve.current,fe=ie;ie=null,setTimeout(()=>{if(!te)return;const{selection:Re}=te.state,qe=Re.from;if(qe>fe){const xt=Re.$from,Dt=xt.parent.textContent.substring(0,xt.parentOffset),oe=Dt.lastIndexOf("@");if(oe!==-1&&!Dt.substring(oe+1).includes(" ")){if(I.current){const Ue=te.getHTML();I.current(te.isEmpty?"":Ue)}return}try{te.chain().setTextSelection({from:fe,to:qe}).setMark("timestamp",{time:ke,recordingId:Me}).setTextSelection(qe).run()}catch(Ee){console.warn("Failed to apply timestamp mark:",Ee)}}if(I.current){const xt=te.getHTML();I.current(te.isEmpty?"":xt)}},50)}else ie=null,te&&I.current&&setTimeout(()=>{if(te&&I.current){const ke=te.getHTML();I.current(te.isEmpty?"":ke)}},50)},Q=te.view.dom;return Q.addEventListener("compositionstart",he),Q.addEventListener("compositionend",se),te.on("selectionUpdate",Z),te.on("update",Z),()=>{te.off("update",Z),te.off("selectionUpdate",Z),Q.removeEventListener("compositionstart",he),Q.removeEventListener("compositionend",se),window.__imeComposing=!1}},[te,ae]),x.useEffect(()=>{if(te&&t!==void 0){const Z=te.getHTML(),ie=he=>he==="<p></p>"||he==="";if(ie(Z)&&ie(t)||te.isFocused)return;Z!==t&&te.commands.setContent(t,!1)}},[t,te]),x.useEffect(()=>{te&&(Be.current=te,te.toggleRecording=()=>{},te.isRecording=!1,te.scrollToParagraph=Z=>{if(!Z)return;let ie=null,he=null,se=null;te.state.doc.descendants((Me,fe)=>{if(Me.type.name==="audioMarker"&&Me.attrs.id===Z)return ie=fe,!1}),ie!==null&&te.state.doc.descendants((Me,fe)=>{if(Me.type.name==="audioMarker"&&fe>ie&&he===null)return he=fe,se=Me.attrs.id,!1});const Q=he!==null?he:ie,ke=se!==null?se:Z;Q!==null&&(te.chain().setTextSelection(Q).scrollIntoView().focus().run(),setTimeout(()=>{const Me=document.querySelector(`[data-id="${ke}"]`);Me&&(Me.style.transition="all 0.3s ease",Me.style.backgroundColor="#fef08a",Me.style.color="#854d0e",Me.style.borderColor="#fbbf24",Me.style.transform="scale(1.2)",setTimeout(()=>{Me.style.transition="all 1s ease",Me.style.backgroundColor="",Me.style.color="",Me.style.borderColor="",Me.style.transform=""},2e3))},50))})},[te]),x.useEffect(()=>{te&&d&&te.commands.focus("end")},[te,d]),x.useEffect(()=>{te&&s&&s(te)},[te,s]),te?c.jsxs("div",{className:`note-editor-wrapper ${o} relative bg-transparent border-none`,style:{"--attachment-link-color":y},onClickCapture:Z=>{const ie=Z.target,he=ie.closest("[data-time]");if(he){const ke=he.getAttribute("data-time"),Me=he.getAttribute("data-recording-id")||void 0,fe=parseInt(ke||"0",10);if(!isNaN(fe)&&f){f(fe,Me);return}}const se=ie.closest("[data-timestamp]");if(se){const ke=parseInt(se.getAttribute("data-timestamp")||"0",10);if(!isNaN(ke)&&f){f(ke);return}}const Q=ie.closest("[data-attachment-link]");if(Q){Z.preventDefault(),Z.stopPropagation();const ke=Q.getAttribute("data-attachment-urls");if(ke)try{const Me=JSON.parse(ke);if(Array.isArray(Me)&&Me.length>0){const fe=Q.getBoundingClientRect();U({top:fe.bottom+5,left:Math.min(fe.left,window.innerWidth-340)}),Oe(Me),me(!0)}}catch(Me){console.error("Failed to parse attachment URLs",Me)}}else ie.closest(".attachment-popup")||me(!1)},children:[c.jsx(QK,{editor:te}),T&&c.jsxs("div",{className:"fixed z-50 bg-white rounded-lg shadow-2xl border border-gray-200 p-2 flex gap-1.5 animate-in fade-in zoom-in-95 duration-200 items-center",style:{top:`${k.top}px`,left:`${k.left}px`,transform:"translateX(-50%)"},children:[c.jsx("button",{type:"button",onMouseDown:Z=>{Z.preventDefault(),Z.stopPropagation();const{from:ie,to:he}=te.state.selection,se=te.state.doc.textBetween(ie,he," ");r==null||r(se,{from:ie,to:he},k),R(!1)},className:"w-8 h-8 rounded-lg bg-indigo-50 hover:bg-indigo-100 text-indigo-600 shadow-sm hover:scale-105 hover:ring-2 hover:ring-indigo-300 transition-all active:scale-95 flex items-center justify-center cursor-pointer",title:"AI  (Polish Selection)",children:c.jsx(As,{size:16})}),m.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"h-4 w-[1px] bg-gray-200 mx-1"}),c.jsx("button",{type:"button",onMouseDown:Z=>{Z.preventDefault(),Z.stopPropagation();const{from:ie,to:he}=te.state.selection;if(ie!==he){W({from:ie,to:he});const se=te.getAttributes("attachmentLink");D((se==null?void 0:se.attachmentUrls)||[]),O(!0),R(!1)}},className:"w-8 h-8 rounded-lg bg-amber-50 hover:bg-amber-100 text-amber-600 shadow-sm hover:scale-105 hover:ring-2 hover:ring-amber-300 transition-all active:scale-95 flex items-center justify-center cursor-pointer",title:" (Alt+A)",children:c.jsx(ho,{size:16})})]}),c.jsx("div",{className:"h-4 w-[1px] bg-gray-200 mx-1"}),[{color:"#000000",label:""},{color:"#ef4444",label:""},{color:"#f97316",label:""},{color:"#f59e0b",label:""},{color:"#10b981",label:""},{color:"#3b82f6",label:""},{color:"#8b5cf6",label:""},{color:"#ec4899",label:""},{color:"#64748b",label:""}].map(({color:Z,label:ie})=>c.jsx("button",{type:"button",onMouseDown:he=>{he.preventDefault(),he.stopPropagation(),te==null||te.chain().focus().setColor(Z).run(),R(!1)},className:"w-7 h-7 rounded-full border-2 border-white shadow-md hover:scale-110 hover:ring-2 hover:ring-indigo-300 transition-all active:scale-95 cursor-pointer",style:{backgroundColor:Z},title:ie},Z))]}),P&&m.length>0&&c.jsxs("div",{className:"fixed z-[99999] bg-white rounded-xl shadow-2xl border border-gray-100 p-3 min-w-[220px] max-w-[300px] animate-in fade-in zoom-in-95 duration-150",style:{top:$.top,left:$.left},children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("span",{className:"text-xs font-bold text-gray-600",children:""}),c.jsx("button",{type:"button",onClick:()=>{O(!1),D([])},className:"p-0.5 text-gray-400 hover:text-gray-600",children:c.jsx(un,{size:14})})]}),c.jsx("div",{className:"space-y-1 max-h-[200px] overflow-y-auto mb-2",children:m.map((Z,ie)=>{const he=V.includes(Z.url);return c.jsxs("button",{type:"button",onClick:()=>{D(he?se=>se.filter(Q=>Q!==Z.url):se=>[...se,Z.url])},className:`w-full text-left px-2 py-1.5 rounded-lg flex items-center gap-2 text-xs transition-colors ${he?"bg-indigo-50 text-indigo-700 border border-indigo-200":"hover:bg-gray-50 text-gray-600"}`,children:[c.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center flex-shrink-0 ${he?"bg-indigo-500 border-indigo-500 text-white":"border-gray-300"}`,children:he&&c.jsx(Xn,{size:12})}),c.jsx(ho,{size:12,className:he?"text-indigo-400":"text-gray-400"}),c.jsx("span",{className:"truncate",children:Z.name})]},ie)})}),c.jsxs("div",{className:"flex gap-2 pt-2 border-t border-gray-100",children:[c.jsx("button",{type:"button",onClick:()=>{O(!1),D([])},className:"flex-1 px-3 py-1.5 text-xs text-gray-500 hover:bg-gray-50 rounded-lg transition-colors",children:""}),c.jsxs("button",{type:"button",onClick:()=>{j&&te&&(V.length>0?te.chain().focus().setTextSelection(j).setMark("attachmentLink",{attachmentUrls:V}).run():te.chain().focus().setTextSelection(j).unsetMark("attachmentLink").run(),O(!1),W(null),D([]))},className:"flex-1 px-3 py-1.5 text-xs bg-indigo-500 text-white hover:bg-indigo-600 rounded-lg transition-colors font-medium",children:[" ",V.length>0&&`(${V.length})`]})]})]}),ge&&ne.length>0&&c.jsxs("div",{className:"fixed z-[99999] bg-white rounded-xl shadow-2xl border border-gray-100 p-3 min-w-[220px] max-w-[320px] animate-in fade-in zoom-in-95 duration-150",style:{top:F.top,left:F.left},children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("span",{className:"text-xs font-bold text-gray-600",children:""}),c.jsx("button",{type:"button",onClick:()=>me(!1),className:"p-0.5 text-gray-400 hover:text-gray-600",children:c.jsx(un,{size:14})})]}),c.jsx("div",{className:"space-y-1.5",children:ne.map((Z,ie)=>{const he=m.find(se=>se.url===Z);return he?c.jsxs("div",{className:"flex items-center justify-between gap-2 px-2 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[c.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[c.jsx(ho,{size:12,className:"text-gray-400 flex-shrink-0"}),c.jsx("span",{className:"text-xs text-gray-600 truncate",children:he.name})]}),c.jsx("button",{type:"button",onClick:()=>{fetch(Z).then(se=>se.blob()).then(se=>{const Q=window.URL.createObjectURL(se),ke=document.createElement("a");ke.href=Q,ke.download=he.name,document.body.appendChild(ke),ke.click(),document.body.removeChild(ke),window.URL.revokeObjectURL(Q)})},className:"p-1 text-indigo-500 hover:text-indigo-700 hover:bg-indigo-50 rounded transition-colors",title:"",children:c.jsx(iu,{size:14})})]},ie):null})})]}),c.jsx("style",{dangerouslySetInnerHTML:{__html:`
                .ProseMirror p.is-editor-empty:first-child::before {
                    content: attr(data-placeholder);
                    float: left;
                    color: #cbd5e1;
                    pointer-events: none;
                    height: 0;
                }
                .ProseMirror {
                    word-break: break-word;
                    max-height: calc(30 * 1.625em);
                    overflow-y: auto;
                }
                .note-editor-wrapper.h-full .ProseMirror {
                    height: 100%;
                    max-height: 100%;
                }
                .ProseMirror h1 { font-size: 1.25rem; font-weight: 700; margin-top: 0.5rem; margin-bottom: 0.5rem; color: #334155; }
                .ProseMirror h2 { font-size: 1.1rem; font-weight: 700; margin-top: 0.5rem; margin-bottom: 0.5rem; color: #475569; }
                .ProseMirror ul { list-style-type: disc; list-style-position: outside; padding-left: 2rem; margin-top: 0.25rem; margin-left: 0; }
                .ProseMirror ol { list-style-type: decimal; list-style-position: outside; padding-left: 2rem; margin-top: 0.25rem; margin-left: 0; }
                .ProseMirror li { padding-left: 0.25rem; }
            `}})]}):null});var JT;(function(t){t.STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object"})(JT||(JT={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var XT;(function(t){t.LANGUAGE_UNSPECIFIED="language_unspecified",t.PYTHON="python"})(XT||(XT={}));var QT;(function(t){t.OUTCOME_UNSPECIFIED="outcome_unspecified",t.OUTCOME_OK="outcome_ok",t.OUTCOME_FAILED="outcome_failed",t.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(QT||(QT={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZT=["user","model","function","system"];var eC;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(eC||(eC={}));var tC;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(tC||(tC={}));var nC;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(nC||(nC={}));var rC;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER"})(rC||(rC={}));var Hd;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.OTHER="OTHER"})(Hd||(Hd={}));var sC;(function(t){t.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",t.RETRIEVAL_QUERY="RETRIEVAL_QUERY",t.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",t.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",t.CLASSIFICATION="CLASSIFICATION",t.CLUSTERING="CLUSTERING"})(sC||(sC={}));var iC;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(iC||(iC={}));var oC;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(oC||(oC={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hs extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class bc extends hs{constructor(e,n){super(e),this.response=n}}class P5 extends hs{constructor(e,n,r,s){super(e),this.status=n,this.statusText=r,this.errorDetails=s}}class Ua extends hs{}class L5 extends hs{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eY="https://generativelanguage.googleapis.com",tY="v1beta",nY="0.24.1",rY="genai-js";var rc;(function(t){t.GENERATE_CONTENT="generateContent",t.STREAM_GENERATE_CONTENT="streamGenerateContent",t.COUNT_TOKENS="countTokens",t.EMBED_CONTENT="embedContent",t.BATCH_EMBED_CONTENTS="batchEmbedContents"})(rc||(rc={}));class sY{constructor(e,n,r,s,i){this.model=e,this.task=n,this.apiKey=r,this.stream=s,this.requestOptions=i}toString(){var e,n;const r=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||tY;let i=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||eY}/${r}/${this.model}:${this.task}`;return this.stream&&(i+="?alt=sse"),i}}function iY(t){const e=[];return t!=null&&t.apiClient&&e.push(t.apiClient),e.push(`${rY}/${nY}`),e.join(" ")}async function oY(t){var e;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",iY(t.requestOptions)),n.append("x-goog-api-key",t.apiKey);let r=(e=t.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(s){throw new Ua(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${s.message}`)}for(const[s,i]of r.entries()){if(s==="x-goog-api-key")throw new Ua(`Cannot set reserved header name ${s}`);if(s==="x-goog-api-client")throw new Ua(`Header name ${s} can only be set using the apiClient field`);n.append(s,i)}}return n}async function aY(t,e,n,r,s,i){const o=new sY(t,e,n,r,i);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},dY(i)),{method:"POST",headers:await oY(o),body:s})}}async function ih(t,e,n,r,s,i={},o=fetch){const{url:a,fetchOptions:l}=await aY(t,e,n,r,s,i);return lY(a,l,o)}async function lY(t,e,n=fetch){let r;try{r=await n(t,e)}catch(s){cY(s,t)}return r.ok||await uY(r,t),r}function cY(t,e){let n=t;throw n.name==="AbortError"?(n=new L5(`Request aborted when fetching ${e.toString()}: ${t.message}`),n.stack=t.stack):t instanceof P5||t instanceof Ua||(n=new hs(`Error fetching from ${e.toString()}: ${t.message}`),n.stack=t.stack),n}async function uY(t,e){let n="",r;try{const s=await t.json();n=s.error.message,s.error.details&&(n+=` ${JSON.stringify(s.error.details)}`,r=s.error.details)}catch{}throw new P5(`Error fetching from ${e.toString()}: [${t.status} ${t.statusText}] ${n}`,t.status,t.statusText,r)}function dY(t){const e={};if((t==null?void 0:t.signal)!==void 0||(t==null?void 0:t.timeout)>=0){const n=new AbortController;(t==null?void 0:t.timeout)>=0&&setTimeout(()=>n.abort(),t.timeout),t!=null&&t.signal&&t.signal.addEventListener("abort",()=>{n.abort()}),e.signal=n.signal}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hw(t){return t.text=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),jp(t.candidates[0]))throw new bc(`${xa(t)}`,t);return fY(t)}else if(t.promptFeedback)throw new bc(`Text not available. ${xa(t)}`,t);return""},t.functionCall=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),jp(t.candidates[0]))throw new bc(`${xa(t)}`,t);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),aC(t)[0]}else if(t.promptFeedback)throw new bc(`Function call not available. ${xa(t)}`,t)},t.functionCalls=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),jp(t.candidates[0]))throw new bc(`${xa(t)}`,t);return aC(t)}else if(t.promptFeedback)throw new bc(`Function call not available. ${xa(t)}`,t)},t}function fY(t){var e,n,r,s;const i=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const o of(s=(r=t.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)o.text&&i.push(o.text),o.executableCode&&i.push("\n```"+o.executableCode.language+`
`+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&i.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}function aC(t){var e,n,r,s;const i=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const o of(s=(r=t.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)o.functionCall&&i.push(o.functionCall);if(i.length>0)return i}const hY=[Hd.RECITATION,Hd.SAFETY,Hd.LANGUAGE];function jp(t){return!!t.finishReason&&hY.includes(t.finishReason)}function xa(t){var e,n,r;let s="";if((!t.candidates||t.candidates.length===0)&&t.promptFeedback)s+="Response was blocked",!((e=t.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${t.promptFeedback.blockReason}`),!((n=t.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(s+=`: ${t.promptFeedback.blockReasonMessage}`);else if(!((r=t.candidates)===null||r===void 0)&&r[0]){const i=t.candidates[0];jp(i)&&(s+=`Candidate was blocked due to ${i.finishReason}`,i.finishMessage&&(s+=`: ${i.finishMessage}`))}return s}function $f(t){return this instanceof $f?(this.v=t,this):new $f(t)}function pY(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),s,i=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(h){r[h]&&(s[h]=function(p){return new Promise(function(m,y){i.push([h,p,m,y])>1||a(h,p)})})}function a(h,p){try{l(r[h](p))}catch(m){f(i[0][3],m)}}function l(h){h.value instanceof $f?Promise.resolve(h.value.v).then(u,d):f(i[0][2],h)}function u(h){a("next",h)}function d(h){a("throw",h)}function f(h,p){h(p),i.shift(),i.length&&a(i[0][0],i[0][1])}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lC=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function mY(t){const e=t.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=xY(e),[r,s]=n.tee();return{stream:yY(r),response:gY(s)}}async function gY(t){const e=[],n=t.getReader();for(;;){const{done:r,value:s}=await n.read();if(r)return Hw(bY(e));e.push(s)}}function yY(t){return pY(this,arguments,function*(){const n=t.getReader();for(;;){const{value:r,done:s}=yield $f(n.read());if(s)break;yield yield $f(Hw(r))}})}function xY(t){const e=t.getReader();return new ReadableStream({start(r){let s="";return i();function i(){return e.read().then(({value:o,done:a})=>{if(a){if(s.trim()){r.error(new hs("Failed to parse stream"));return}r.close();return}s+=o;let l=s.match(lC),u;for(;l;){try{u=JSON.parse(l[1])}catch{r.error(new hs(`Error parsing JSON response: "${l[1]}"`));return}r.enqueue(u),s=s.substring(l[0].length),l=s.match(lC)}return i()}).catch(o=>{let a=o;throw a.stack=o.stack,a.name==="AbortError"?a=new L5("Request aborted when reading from the stream"):a=new hs("Error reading from the stream"),a})}}})}function bY(t){const e=t[t.length-1],n={promptFeedback:e==null?void 0:e.promptFeedback};for(const r of t){if(r.candidates){let s=0;for(const i of r.candidates)if(n.candidates||(n.candidates=[]),n.candidates[s]||(n.candidates[s]={index:s}),n.candidates[s].citationMetadata=i.citationMetadata,n.candidates[s].groundingMetadata=i.groundingMetadata,n.candidates[s].finishReason=i.finishReason,n.candidates[s].finishMessage=i.finishMessage,n.candidates[s].safetyRatings=i.safetyRatings,i.content&&i.content.parts){n.candidates[s].content||(n.candidates[s].content={role:i.content.role||"user",parts:[]});const o={};for(const a of i.content.parts)a.text&&(o.text=a.text),a.functionCall&&(o.functionCall=a.functionCall),a.executableCode&&(o.executableCode=a.executableCode),a.codeExecutionResult&&(o.codeExecutionResult=a.codeExecutionResult),Object.keys(o).length===0&&(o.text=""),n.candidates[s].content.parts.push(o)}s++}r.usageMetadata&&(n.usageMetadata=r.usageMetadata)}return n}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $5(t,e,n,r){const s=await ih(e,rc.STREAM_GENERATE_CONTENT,t,!0,JSON.stringify(n),r);return mY(s)}async function z5(t,e,n,r){const i=await(await ih(e,rc.GENERATE_CONTENT,t,!1,JSON.stringify(n),r)).json();return{response:Hw(i)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F5(t){if(t!=null){if(typeof t=="string")return{role:"system",parts:[{text:t}]};if(t.text)return{role:"system",parts:[t]};if(t.parts)return t.role?t:{role:"system",parts:t.parts}}}function zf(t){let e=[];if(typeof t=="string")e=[{text:t}];else for(const n of t)typeof n=="string"?e.push({text:n}):e.push(n);return vY(e)}function vY(t){const e={role:"user",parts:[]},n={role:"function",parts:[]};let r=!1,s=!1;for(const i of t)"functionResponse"in i?(n.parts.push(i),s=!0):(e.parts.push(i),r=!0);if(r&&s)throw new hs("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!s)throw new hs("No content is provided for sending chat message.");return r?e:n}function wY(t,e){var n;let r={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(n=e==null?void 0:e.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const s=t.generateContentRequest!=null;if(t.contents){if(s)throw new Ua("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=t.contents}else if(s)r=Object.assign(Object.assign({},r),t.generateContentRequest);else{const i=zf(t);r.contents=[i]}return{generateContentRequest:r}}function cC(t){let e;return t.contents?e=t:e={contents:[zf(t)]},t.systemInstruction&&(e.systemInstruction=F5(t.systemInstruction)),e}function kY(t){return typeof t=="string"||Array.isArray(t)?{content:zf(t)}:t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uC=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],SY={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function _Y(t){let e=!1;for(const n of t){const{role:r,parts:s}=n;if(!e&&r!=="user")throw new hs(`First content should be with role 'user', got ${r}`);if(!ZT.includes(r))throw new hs(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(ZT)}`);if(!Array.isArray(s))throw new hs("Content should have 'parts' property with an array of Parts");if(s.length===0)throw new hs("Each Content should have at least one part");const i={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const a of s)for(const l of uC)l in a&&(i[l]+=1);const o=SY[r];for(const a of uC)if(!o.includes(a)&&i[a]>0)throw new hs(`Content with role '${r}' can't contain '${a}' part`);e=!0}}function dC(t){var e;if(t.candidates===void 0||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;if(n===void 0||n.parts===void 0||n.parts.length===0)return!1;for(const r of n.parts)if(r===void 0||Object.keys(r).length===0||r.text!==void 0&&r.text==="")return!1;return!0}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fC="SILENT_ERROR";class TY{constructor(e,n,r,s={}){this.model=n,this.params=r,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,r!=null&&r.history&&(_Y(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,n={}){var r,s,i,o,a,l;await this._sendPromise;const u=zf(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,u]},f=Object.assign(Object.assign({},this._requestOptions),n);let h;return this._sendPromise=this._sendPromise.then(()=>z5(this._apiKey,this.model,d,f)).then(p=>{var m;if(dC(p.response)){this._history.push(u);const y=Object.assign({parts:[],role:"model"},(m=p.response.candidates)===null||m===void 0?void 0:m[0].content);this._history.push(y)}else{const y=xa(p.response);y&&console.warn(`sendMessage() was unsuccessful. ${y}. Inspect response object for details.`)}h=p}).catch(p=>{throw this._sendPromise=Promise.resolve(),p}),await this._sendPromise,h}async sendMessageStream(e,n={}){var r,s,i,o,a,l;await this._sendPromise;const u=zf(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,u]},f=Object.assign(Object.assign({},this._requestOptions),n),h=$5(this._apiKey,this.model,d,f);return this._sendPromise=this._sendPromise.then(()=>h).catch(p=>{throw new Error(fC)}).then(p=>p.response).then(p=>{if(dC(p)){this._history.push(u);const m=Object.assign({},p.candidates[0].content);m.role||(m.role="model"),this._history.push(m)}else{const m=xa(p);m&&console.warn(`sendMessageStream() was unsuccessful. ${m}. Inspect response object for details.`)}}).catch(p=>{p.message!==fC&&console.error(p)}),h}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CY(t,e,n,r){return(await ih(e,rc.COUNT_TOKENS,t,!1,JSON.stringify(n),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EY(t,e,n,r){return(await ih(e,rc.EMBED_CONTENT,t,!1,JSON.stringify(n),r)).json()}async function NY(t,e,n,r){const s=n.requests.map(o=>Object.assign(Object.assign({},o),{model:e}));return(await ih(e,rc.BATCH_EMBED_CONTENTS,t,!1,JSON.stringify({requests:s}),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hC{constructor(e,n,r={}){this.apiKey=e,this._requestOptions=r,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=F5(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(e,n={}){var r;const s=cC(e),i=Object.assign(Object.assign({},this._requestOptions),n);return z5(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}async generateContentStream(e,n={}){var r;const s=cC(e),i=Object.assign(Object.assign({},this._requestOptions),n);return $5(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}startChat(e){var n;return new TY(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},e),this._requestOptions)}async countTokens(e,n={}){const r=wY(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),n);return CY(this.apiKey,this.model,r,s)}async embedContent(e,n={}){const r=kY(e),s=Object.assign(Object.assign({},this._requestOptions),n);return EY(this.apiKey,this.model,r,s)}async batchEmbedContents(e,n={}){const r=Object.assign(Object.assign({},this._requestOptions),n);return NY(this.apiKey,this.model,e,r)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jY{constructor(e){this.apiKey=e}getGenerativeModel(e,n){if(!e.model)throw new hs("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new hC(this.apiKey,e,n)}getGenerativeModelFromCachedContent(e,n,r){if(!e.name)throw new Ua("Cached content must contain a `name` field.");if(!e.model)throw new Ua("Cached content must contain a `model` field.");const s=["model","systemInstruction"];for(const o of s)if(n!=null&&n[o]&&e[o]&&(n==null?void 0:n[o])!==e[o]){if(o==="model"){const a=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,l=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(a===l)continue}throw new Ua(`Different value for "${o}" specified in modelParams (${n[o]}) and cachedContent (${e[o]})`)}const i=Object.assign(Object.assign({},n),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new hC(this.apiKey,i,r)}}const IY="AIzaSyBbGFzQkwhEmNQduYxaZnnxxHR-DlQjj98",Vw=()=>({provider:localStorage.getItem("ai_provider")||"gemini",googleKey:localStorage.getItem("google_ai_key")||IY,openaiKey:localStorage.getItem("openai_api_key")||"",baseUrl:localStorage.getItem("ai_base_url")||"https://api.openai.com/v1",modelName:localStorage.getItem("ai_model")||"gpt-3.5-turbo"}),MY=()=>{const{googleKey:t}=Vw();if(!t)throw new Error("Google API Key is missing. Please set it in Settings.");return new jY(t)},DY=async(t,e=!0)=>{var a,l;const{openaiKey:n,baseUrl:r,modelName:s}=Vw();if(!n)throw new Error("API Key is missing. Please set it in Settings.");let i=r.trim();i.endsWith("/")&&(i=i.slice(0,-1));const o=`${i}/chat/completions`;console.log(`Using OpenAI-compatible provider: ${i}, model: ${s}`);try{const u=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:s,messages:[{role:"system",content:e?"You are a helpful assistant. Output valid JSON only.":"You are a helpful assistant."},{role:"user",content:t}],temperature:.7})});if(!u.ok){const h=await u.text();throw new Error(`API Error: ${u.status} ${u.statusText} - ${h}`)}const f=((l=(a=(await u.json()).choices[0])==null?void 0:a.message)==null?void 0:l.content)||"";if(console.log("AI Raw Response:",f),!e)return f;try{let h=f;const p=f.match(/\{[\s\S]*\}/);p&&(h=p[0]);const m=h.replace(/```json/g,"").replace(/```/g,"").trim();try{return JSON.parse(m)}catch(y){if(m.includes('"fullResponse": "')){const b='"fullResponse": "',g=m.indexOf(b)+b.length,v=m.lastIndexOf('"');if(g>b.length-1&&v>g)return{fullResponse:m.substring(g,v).replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")}}throw y}}catch(h){throw console.warn("OpenAI JSON Parse failed"),h}}catch(u){throw console.error("OpenAI Provider Error:",u),u}},AY=async t=>{const e=MY(),n=["gemini-1.5-flash","gemini-2.0-flash-001","gemini-2.0-flash-lite-preview-02-05","gemini-1.5-pro","gemini-pro"];let r;for(const s of n)try{console.log(`[SimpleAI] Attempting to use model: ${s}`);const l=(await(await e.getGenerativeModel({model:s}).generateContent(t)).response).text();if(l)return l.trim()}catch(i){console.warn(`[SimpleAI] Model ${s} failed:`,i),r=i;continue}throw r||new Error("All AI models failed to respond")},ac=async t=>{const{provider:e}=Vw();if(e==="openai"){const n=await DY(t,!1);return typeof n=="string"?n:JSON.stringify(n)}return await AY(t)},B5=async(t,e,n)=>{const r=` AI 
  
  ${e}
  ${t}
  
  `,s=n&&n.trim()?n:r,i=(n==null?void 0:n.includes(""))||(n==null?void 0:n.includes("")),o=e.trim()?`
"${e}"

`:"",a=!!(n&&n.trim()),l=["1. Traditional Chinese","2.  JSON "];i?(l.push("3. "),l.push("4. ")):a?(l.push("3. "),l.push("4. ......"),l.push("5.  Markdown ")):(l.push("3. "),l.push("4.  Markdown ****"),l.push("5. "));const u=`
${s}

${o}
"${t}"


${l.join(`
`)}`;try{if(!t.trim())throw new Error("");return{fullResponse:await ac(u)}}catch(d){throw console.error("AI Assistant Error:",d),d}},U5=async t=>{const e=` AI Prompt 10 

  
  "${t}"`;try{return(await ac(e)).trim().replace(/^"|"$/g,"")}catch(n){return console.error("Generate Prompt Title Error:",n),t.slice(0,15)+(t.length>15?"...":"")}},RY=async(t,e)=>{const n=t.length>3e3?t.slice(0,3e3)+"...":t;let r;e?r=`${e}

  
  ---
    ${n}
  ---

    `:r=`SEOSEO

  
  1. 
  2. 15 - 30
  3. 
  4. 
  5. 
  6. 
  7. 

  
  - "5"
    - "90%"
    - ""

  
  ---
    ${n}
  ---

    SEO`,console.log("Generating SEO title for content length:",t.length);try{const s=await ac(r);return console.log("SEO Title AI result:",s),s.trim().replace(/^["]/g,"").replace(/["]$/g,"").replace(/^\d+[\.\s]+/,"").replace(/^[:]\s*/i,"").trim()||s.trim()}catch(s){throw console.error("Generate SEO Title Error:",s),s}},OY=async(t,e)=>{const n=t.length>3e3?t.slice(0,3e3)+"...":t,s=`SEO


(SEO)

${e.length>0?`
${e.join(", ")}`:""}


1. ---
2. 
3.  3-7 
4.  10 
5. 
6. 
7. 


---
${n}
---

`;console.log("Generating SEO keywords for content length:",t.length),console.log("Content preview:",t.slice(0,200));try{const i=await ac(s);return console.log("SEO Keywords AI result:",i),i.split(/[,\n]/).map(a=>a.trim()).filter(a=>a.length>0&&a.length<=20).slice(0,7)}catch(i){throw console.error("Generate SEO Keywords Error:",i),i}},PY=async(t,e,n,r,s,i)=>{const o=s.existingSchedule&&s.existingSchedule.length>0?`
Existing Schedule (Potential Conflicts):
${s.existingSchedule.join(`
`)}`:"",a=s.pastExperiences&&s.pastExperiences.length>0?`
Relevant Past Experience:
${s.pastExperiences.join(`
`)}`:"",l=`
Role:  AI (Chief Administrative Officer)

Source Task:
- : "${t}"
- /: "${e||"()"}"
- : ${n||""}
- : ${r||""}
- : ${s.today}
${i?`
: "${i}"`:""}
${o}
${a}

Instructions:
1. 
2.  (Relevant Past Experience)() 
3.  (Existing Schedule)() description 
4. 
5. 
   - "title": 
   - "description": 
   - "start_date": YYYY-MM-DD 
   - "due_date": YYYY-MM-DD 
6. "subtasks": 

Output Rules:
-  JSON 
-  Markdown... JSON
- 
- description  title 

JSON Format:
[
  {
    "title": "",
    "description": "...",
    "start_date": "YYYY-MM-DD",
    "due_date": "YYYY-MM-DD",
    "subtasks": []
  }
]
`;try{const u=await ac(l);console.log("Mission 72 Raw Output:",u);let d=u;const f=u.match(/\[[\s\S]*\]/);return f&&(d=f[0]),d=d.replace(/```json/g,"").replace(/```/g,"").trim(),JSON.parse(d)}catch(u){throw console.error("Mission 72 Planning Error:",u),new Error("AI ")}},LY=async(t,e)=>{if(e.length===0)return null;const n=e.map(s=>`- ${s.name} (ID: ${s.id}, : ${s.depth})`).join(`
`),r=`${t}


${n}


1. 
2. 
3.  "NONE"
4. 

 ID "NONE"`;try{const i=(await ac(r)).trim().replace(/["""'']/g,"");if(i==="NONE"||i.toLowerCase()==="none")return null;const o=e.find(l=>l.id===i);if(o)return o.id;const a=e.find(l=>i.toLowerCase().includes(l.name.toLowerCase())||l.name.toLowerCase().includes(i.toLowerCase()));return a?a.id:null}catch(s){return console.error("Find Best Parent Keyword Error:",s),null}},$Y=async(t,e,n,r=[])=>{const s=`
 GTD (Getting Things Done) **** GTD 



- ${t.title}
- ${t.description||"()"}
- ${t.status}
- ${t.created_at}
- ${t.due_date||""}
- ()${t.start_date||""}
- ${t.tags.join(", ")||""}
- ${t.project_title||" ()"}

 ()
${e.length>0?e.join(`
`):"()"}


${r.map(i=>`${i.role==="user"?"":"GTD"}: ${i.content}`).join(`
`)}


"${n}"

GTD  (current_stage)
1. capture (): 
2. clarify (): 
3. organize (): ** (start_date) start_time (HH:MM) (due_date)**
4. engage (): 


1. ******** \`actions\` JSON
2. ****
3. **** \`start_date\`
4. ************ \`actions\` JSON reminder_minutes

 (JSON Only)
{
  "reply": "...",
  "current_stage": "capture" | "clarify" | "organize" | "engage",
  "actions": [
    { "type": "update_task", "params": { "start_date": "YYYY-MM-DD", "start_time": "09:00", "reminder_minutes": 0 } },
    { "type": "add_subtasks", "params": { "tasks": [{ "title": "...", "start_date": "...", "reminder_minutes": 10 }] } }
  ]
}
* \`actions\` 

 JSON
`;try{const i=await ac(s);let o=i;const a=i.match(/\{[\s\S]*\}/);return a&&(o=a[0]),o=o.replace(/```json/g,"").replace(/```/g,"").trim(),JSON.parse(o)}catch(i){return console.error("GTD Coach Error:",i),{reply:"",current_stage:"capture",actions:[]}}};function zY(t,e){const n=e||{};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const FY=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,BY=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,UY={};function pC(t,e){return((e||UY).jsx?BY:FY).test(t)}const HY=/[ \t\n\f\r]/g;function VY(t){return typeof t=="object"?t.type==="text"?mC(t.value):!1:mC(t)}function mC(t){return t.replace(HY,"")===""}class oh{constructor(e,n,r){this.normal=n,this.property=e,r&&(this.space=r)}}oh.prototype.normal={};oh.prototype.property={};oh.prototype.space=void 0;function H5(t,e){const n={},r={};for(const s of t)Object.assign(n,s.property),Object.assign(r,s.normal);return new oh(n,r,e)}function ob(t){return t.toLowerCase()}class Ks{constructor(e,n){this.attribute=n,this.property=e}}Ks.prototype.attribute="";Ks.prototype.booleanish=!1;Ks.prototype.boolean=!1;Ks.prototype.commaOrSpaceSeparated=!1;Ks.prototype.commaSeparated=!1;Ks.prototype.defined=!1;Ks.prototype.mustUseProperty=!1;Ks.prototype.number=!1;Ks.prototype.overloadedBoolean=!1;Ks.prototype.property="";Ks.prototype.spaceSeparated=!1;Ks.prototype.space=void 0;let WY=0;const gn=lc(),Sr=lc(),ab=lc(),Pt=lc(),Wn=lc(),du=lc(),Js=lc();function lc(){return 2**++WY}const lb=Object.freeze(Object.defineProperty({__proto__:null,boolean:gn,booleanish:Sr,commaOrSpaceSeparated:Js,commaSeparated:du,number:Pt,overloadedBoolean:ab,spaceSeparated:Wn},Symbol.toStringTag,{value:"Module"})),Dy=Object.keys(lb);class Ww extends Ks{constructor(e,n,r,s){let i=-1;if(super(e,n),gC(this,"space",s),typeof r=="number")for(;++i<Dy.length;){const o=Dy[i];gC(this,Dy[i],(r&lb[o])===lb[o])}}}Ww.prototype.defined=!0;function gC(t,e,n){n&&(t[e]=n)}function Bu(t){const e={},n={};for(const[r,s]of Object.entries(t.properties)){const i=new Ww(r,t.transform(t.attributes||{},r),s,t.space);t.mustUseProperty&&t.mustUseProperty.includes(r)&&(i.mustUseProperty=!0),e[r]=i,n[ob(r)]=r,n[ob(i.attribute)]=r}return new oh(e,n,t.space)}const V5=Bu({properties:{ariaActiveDescendant:null,ariaAtomic:Sr,ariaAutoComplete:null,ariaBusy:Sr,ariaChecked:Sr,ariaColCount:Pt,ariaColIndex:Pt,ariaColSpan:Pt,ariaControls:Wn,ariaCurrent:null,ariaDescribedBy:Wn,ariaDetails:null,ariaDisabled:Sr,ariaDropEffect:Wn,ariaErrorMessage:null,ariaExpanded:Sr,ariaFlowTo:Wn,ariaGrabbed:Sr,ariaHasPopup:null,ariaHidden:Sr,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Wn,ariaLevel:Pt,ariaLive:null,ariaModal:Sr,ariaMultiLine:Sr,ariaMultiSelectable:Sr,ariaOrientation:null,ariaOwns:Wn,ariaPlaceholder:null,ariaPosInSet:Pt,ariaPressed:Sr,ariaReadOnly:Sr,ariaRelevant:null,ariaRequired:Sr,ariaRoleDescription:Wn,ariaRowCount:Pt,ariaRowIndex:Pt,ariaRowSpan:Pt,ariaSelected:Sr,ariaSetSize:Pt,ariaSort:null,ariaValueMax:Pt,ariaValueMin:Pt,ariaValueNow:Pt,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function W5(t,e){return e in t?t[e]:e}function K5(t,e){return W5(t,e.toLowerCase())}const KY=Bu({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:du,acceptCharset:Wn,accessKey:Wn,action:null,allow:null,allowFullScreen:gn,allowPaymentRequest:gn,allowUserMedia:gn,alt:null,as:null,async:gn,autoCapitalize:null,autoComplete:Wn,autoFocus:gn,autoPlay:gn,blocking:Wn,capture:null,charSet:null,checked:gn,cite:null,className:Wn,cols:Pt,colSpan:null,content:null,contentEditable:Sr,controls:gn,controlsList:Wn,coords:Pt|du,crossOrigin:null,data:null,dateTime:null,decoding:null,default:gn,defer:gn,dir:null,dirName:null,disabled:gn,download:ab,draggable:Sr,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:gn,formTarget:null,headers:Wn,height:Pt,hidden:ab,high:Pt,href:null,hrefLang:null,htmlFor:Wn,httpEquiv:Wn,id:null,imageSizes:null,imageSrcSet:null,inert:gn,inputMode:null,integrity:null,is:null,isMap:gn,itemId:null,itemProp:Wn,itemRef:Wn,itemScope:gn,itemType:Wn,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:gn,low:Pt,manifest:null,max:null,maxLength:Pt,media:null,method:null,min:null,minLength:Pt,multiple:gn,muted:gn,name:null,nonce:null,noModule:gn,noValidate:gn,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:gn,optimum:Pt,pattern:null,ping:Wn,placeholder:null,playsInline:gn,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:gn,referrerPolicy:null,rel:Wn,required:gn,reversed:gn,rows:Pt,rowSpan:Pt,sandbox:Wn,scope:null,scoped:gn,seamless:gn,selected:gn,shadowRootClonable:gn,shadowRootDelegatesFocus:gn,shadowRootMode:null,shape:null,size:Pt,sizes:null,slot:null,span:Pt,spellCheck:Sr,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Pt,step:null,style:null,tabIndex:Pt,target:null,title:null,translate:null,type:null,typeMustMatch:gn,useMap:null,value:Sr,width:Pt,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Wn,axis:null,background:null,bgColor:null,border:Pt,borderColor:null,bottomMargin:Pt,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:gn,declare:gn,event:null,face:null,frame:null,frameBorder:null,hSpace:Pt,leftMargin:Pt,link:null,longDesc:null,lowSrc:null,marginHeight:Pt,marginWidth:Pt,noResize:gn,noHref:gn,noShade:gn,noWrap:gn,object:null,profile:null,prompt:null,rev:null,rightMargin:Pt,rules:null,scheme:null,scrolling:Sr,standby:null,summary:null,text:null,topMargin:Pt,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Pt,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:gn,disableRemotePlayback:gn,prefix:null,property:null,results:Pt,security:null,unselectable:null},space:"html",transform:K5}),GY=Bu({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Js,accentHeight:Pt,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Pt,amplitude:Pt,arabicForm:null,ascent:Pt,attributeName:null,attributeType:null,azimuth:Pt,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Pt,by:null,calcMode:null,capHeight:Pt,className:Wn,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Pt,diffuseConstant:Pt,direction:null,display:null,dur:null,divisor:Pt,dominantBaseline:null,download:gn,dx:null,dy:null,edgeMode:null,editable:null,elevation:Pt,enableBackground:null,end:null,event:null,exponent:Pt,externalResourcesRequired:null,fill:null,fillOpacity:Pt,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:du,g2:du,glyphName:du,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Pt,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Pt,horizOriginX:Pt,horizOriginY:Pt,id:null,ideographic:Pt,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Pt,k:Pt,k1:Pt,k2:Pt,k3:Pt,k4:Pt,kernelMatrix:Js,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Pt,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Pt,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Pt,overlineThickness:Pt,paintOrder:null,panose1:null,path:null,pathLength:Pt,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Wn,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Pt,pointsAtY:Pt,pointsAtZ:Pt,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Js,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Js,rev:Js,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Js,requiredFeatures:Js,requiredFonts:Js,requiredFormats:Js,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Pt,specularExponent:Pt,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Pt,strikethroughThickness:Pt,string:null,stroke:null,strokeDashArray:Js,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Pt,strokeOpacity:Pt,strokeWidth:null,style:null,surfaceScale:Pt,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Js,tabIndex:Pt,tableValues:null,target:null,targetX:Pt,targetY:Pt,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Js,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Pt,underlineThickness:Pt,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Pt,values:null,vAlphabetic:Pt,vMathematical:Pt,vectorEffect:null,vHanging:Pt,vIdeographic:Pt,version:null,vertAdvY:Pt,vertOriginX:Pt,vertOriginY:Pt,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Pt,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:W5}),G5=Bu({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),q5=Bu({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:K5}),Y5=Bu({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),qY={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},YY=/[A-Z]/g,yC=/-[a-z]/g,JY=/^data[-\w.:]+$/i;function XY(t,e){const n=ob(e);let r=e,s=Ks;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&JY.test(e)){if(e.charAt(4)==="-"){const i=e.slice(5).replace(yC,ZY);r="data"+i.charAt(0).toUpperCase()+i.slice(1)}else{const i=e.slice(4);if(!yC.test(i)){let o=i.replace(YY,QY);o.charAt(0)!=="-"&&(o="-"+o),e="data"+o}}s=Ww}return new s(r,e)}function QY(t){return"-"+t.toLowerCase()}function ZY(t){return t.charAt(1).toUpperCase()}const eJ=H5([V5,KY,G5,q5,Y5],"html"),Kw=H5([V5,GY,G5,q5,Y5],"svg");function tJ(t){return t.join(" ").trim()}var Gw={},xC=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,nJ=/\n/g,rJ=/^\s*/,sJ=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,iJ=/^:\s*/,oJ=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,aJ=/^[;\s]*/,lJ=/^\s+|\s+$/g,cJ=`
`,bC="/",vC="*",Tl="",uJ="comment",dJ="declaration";function fJ(t,e){if(typeof t!="string")throw new TypeError("First argument must be a string");if(!t)return[];e=e||{};var n=1,r=1;function s(m){var y=m.match(nJ);y&&(n+=y.length);var b=m.lastIndexOf(cJ);r=~b?m.length-b:r+m.length}function i(){var m={line:n,column:r};return function(y){return y.position=new o(m),u(),y}}function o(m){this.start=m,this.end={line:n,column:r},this.source=e.source}o.prototype.content=t;function a(m){var y=new Error(e.source+":"+n+":"+r+": "+m);if(y.reason=m,y.filename=e.source,y.line=n,y.column=r,y.source=t,!e.silent)throw y}function l(m){var y=m.exec(t);if(y){var b=y[0];return s(b),t=t.slice(b.length),y}}function u(){l(rJ)}function d(m){var y;for(m=m||[];y=f();)y!==!1&&m.push(y);return m}function f(){var m=i();if(!(bC!=t.charAt(0)||vC!=t.charAt(1))){for(var y=2;Tl!=t.charAt(y)&&(vC!=t.charAt(y)||bC!=t.charAt(y+1));)++y;if(y+=2,Tl===t.charAt(y-1))return a("End of comment missing");var b=t.slice(2,y-2);return r+=2,s(b),t=t.slice(y),r+=2,m({type:uJ,comment:b})}}function h(){var m=i(),y=l(sJ);if(y){if(f(),!l(iJ))return a("property missing ':'");var b=l(oJ),g=m({type:dJ,property:wC(y[0].replace(xC,Tl)),value:b?wC(b[0].replace(xC,Tl)):Tl});return l(aJ),g}}function p(){var m=[];d(m);for(var y;y=h();)y!==!1&&(m.push(y),d(m));return m}return u(),p()}function wC(t){return t?t.replace(lJ,Tl):Tl}var hJ=fJ,pJ=Dp&&Dp.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Gw,"__esModule",{value:!0});Gw.default=gJ;const mJ=pJ(hJ);function gJ(t,e){let n=null;if(!t||typeof t!="string")return n;const r=(0,mJ.default)(t),s=typeof e=="function";return r.forEach(i=>{if(i.type!=="declaration")return;const{property:o,value:a}=i;s?e(o,a,i):a&&(n=n||{},n[o]=a)}),n}var e0={};Object.defineProperty(e0,"__esModule",{value:!0});e0.camelCase=void 0;var yJ=/^--[a-zA-Z0-9_-]+$/,xJ=/-([a-z])/g,bJ=/^[^-]+$/,vJ=/^-(webkit|moz|ms|o|khtml)-/,wJ=/^-(ms)-/,kJ=function(t){return!t||bJ.test(t)||yJ.test(t)},SJ=function(t,e){return e.toUpperCase()},kC=function(t,e){return"".concat(e,"-")},_J=function(t,e){return e===void 0&&(e={}),kJ(t)?t:(t=t.toLowerCase(),e.reactCompat?t=t.replace(wJ,kC):t=t.replace(vJ,kC),t.replace(xJ,SJ))};e0.camelCase=_J;var TJ=Dp&&Dp.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},CJ=TJ(Gw),EJ=e0;function cb(t,e){var n={};return!t||typeof t!="string"||(0,CJ.default)(t,function(r,s){r&&s&&(n[(0,EJ.camelCase)(r,e)]=s)}),n}cb.default=cb;var NJ=cb;const jJ=cg(NJ),J5=X5("end"),qw=X5("start");function X5(t){return e;function e(n){const r=n&&n.position&&n.position[t]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function IJ(t){const e=qw(t),n=J5(t);if(e&&n)return{start:e,end:n}}function Vd(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?SC(t.position):"start"in t||"end"in t?SC(t):"line"in t||"column"in t?ub(t):""}function ub(t){return _C(t&&t.line)+":"+_C(t&&t.column)}function SC(t){return ub(t&&t.start)+"-"+ub(t&&t.end)}function _C(t){return t&&typeof t=="number"?t:1}class xs extends Error{constructor(e,n,r){super(),typeof n=="string"&&(r=n,n=void 0);let s="",i={},o=!1;if(n&&("line"in n&&"column"in n?i={place:n}:"start"in n&&"end"in n?i={place:n}:"type"in n?i={ancestors:[n],place:n.position}:i={...n}),typeof e=="string"?s=e:!i.cause&&e&&(o=!0,s=e.message,i.cause=e),!i.ruleId&&!i.source&&typeof r=="string"){const l=r.indexOf(":");l===-1?i.ruleId=r:(i.source=r.slice(0,l),i.ruleId=r.slice(l+1))}if(!i.place&&i.ancestors&&i.ancestors){const l=i.ancestors[i.ancestors.length-1];l&&(i.place=l.position)}const a=i.place&&"start"in i.place?i.place.start:i.place;this.ancestors=i.ancestors||void 0,this.cause=i.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file="",this.message=s,this.line=a?a.line:void 0,this.name=Vd(i.place)||"1:1",this.place=i.place||void 0,this.reason=this.message,this.ruleId=i.ruleId||void 0,this.source=i.source||void 0,this.stack=o&&i.cause&&typeof i.cause.stack=="string"?i.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}xs.prototype.file="";xs.prototype.name="";xs.prototype.reason="";xs.prototype.message="";xs.prototype.stack="";xs.prototype.column=void 0;xs.prototype.line=void 0;xs.prototype.ancestors=void 0;xs.prototype.cause=void 0;xs.prototype.fatal=void 0;xs.prototype.place=void 0;xs.prototype.ruleId=void 0;xs.prototype.source=void 0;const Yw={}.hasOwnProperty,MJ=new Map,DJ=/[A-Z]/g,AJ=new Set(["table","tbody","thead","tfoot","tr"]),RJ=new Set(["td","th"]),Q5="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function OJ(t,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=e.filePath||void 0;let r;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=HJ(n,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=UJ(n,e.jsx,e.jsxs)}const s={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:r,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?Kw:eJ,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},i=Z5(s,t,void 0);return i&&typeof i!="string"?i:s.create(t,s.Fragment,{children:i||void 0},void 0)}function Z5(t,e,n){if(e.type==="element")return PJ(t,e,n);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return LJ(t,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return zJ(t,e,n);if(e.type==="mdxjsEsm")return $J(t,e);if(e.type==="root")return FJ(t,e,n);if(e.type==="text")return BJ(t,e)}function PJ(t,e,n){const r=t.schema;let s=r;e.tagName.toLowerCase()==="svg"&&r.space==="html"&&(s=Kw,t.schema=s),t.ancestors.push(e);const i=tR(t,e.tagName,!1),o=VJ(t,e);let a=Xw(t,e);return AJ.has(e.tagName)&&(a=a.filter(function(l){return typeof l=="string"?!VY(l):!0})),eR(t,o,i,e),Jw(o,a),t.ancestors.pop(),t.schema=r,t.create(e,i,o,n)}function LJ(t,e){if(e.data&&e.data.estree&&t.evaluater){const r=e.data.estree.body[0];return r.type,t.evaluater.evaluateExpression(r.expression)}Ff(t,e.position)}function $J(t,e){if(e.data&&e.data.estree&&t.evaluater)return t.evaluater.evaluateProgram(e.data.estree);Ff(t,e.position)}function zJ(t,e,n){const r=t.schema;let s=r;e.name==="svg"&&r.space==="html"&&(s=Kw,t.schema=s),t.ancestors.push(e);const i=e.name===null?t.Fragment:tR(t,e.name,!0),o=WJ(t,e),a=Xw(t,e);return eR(t,o,i,e),Jw(o,a),t.ancestors.pop(),t.schema=r,t.create(e,i,o,n)}function FJ(t,e,n){const r={};return Jw(r,Xw(t,e)),t.create(e,t.Fragment,r,n)}function BJ(t,e){return e.value}function eR(t,e,n,r){typeof n!="string"&&n!==t.Fragment&&t.passNode&&(e.node=r)}function Jw(t,e){if(e.length>0){const n=e.length>1?e:e[0];n&&(t.children=n)}}function UJ(t,e,n){return r;function r(s,i,o,a){const u=Array.isArray(o.children)?n:e;return a?u(i,o,a):u(i,o)}}function HJ(t,e){return n;function n(r,s,i,o){const a=Array.isArray(i.children),l=qw(r);return e(s,i,o,a,{columnNumber:l?l.column-1:void 0,fileName:t,lineNumber:l?l.line:void 0},void 0)}}function VJ(t,e){const n={};let r,s;for(s in e.properties)if(s!=="children"&&Yw.call(e.properties,s)){const i=KJ(t,s,e.properties[s]);if(i){const[o,a]=i;t.tableCellAlignToStyle&&o==="align"&&typeof a=="string"&&RJ.has(e.tagName)?r=a:n[o]=a}}if(r){const i=n.style||(n.style={});i[t.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return n}function WJ(t,e){const n={};for(const r of e.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&t.evaluater){const i=r.data.estree.body[0];i.type;const o=i.expression;o.type;const a=o.properties[0];a.type,Object.assign(n,t.evaluater.evaluateExpression(a.argument))}else Ff(t,e.position);else{const s=r.name;let i;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&t.evaluater){const a=r.value.data.estree.body[0];a.type,i=t.evaluater.evaluateExpression(a.expression)}else Ff(t,e.position);else i=r.value===null?!0:r.value;n[s]=i}return n}function Xw(t,e){const n=[];let r=-1;const s=t.passKeys?new Map:MJ;for(;++r<e.children.length;){const i=e.children[r];let o;if(t.passKeys){const l=i.type==="element"?i.tagName:i.type==="mdxJsxFlowElement"||i.type==="mdxJsxTextElement"?i.name:void 0;if(l){const u=s.get(l)||0;o=l+"-"+u,s.set(l,u+1)}}const a=Z5(t,i,o);a!==void 0&&n.push(a)}return n}function KJ(t,e,n){const r=XY(t.schema,e);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?zY(n):tJ(n)),r.property==="style"){let s=typeof n=="object"?n:GJ(t,String(n));return t.stylePropertyNameCase==="css"&&(s=qJ(s)),["style",s]}return[t.elementAttributeNameCase==="react"&&r.space?qY[r.property]||r.property:r.attribute,n]}}function GJ(t,e){try{return jJ(e,{reactCompat:!0})}catch(n){if(t.ignoreInvalidStyle)return{};const r=n,s=new xs("Cannot parse `style` attribute",{ancestors:t.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw s.file=t.filePath||void 0,s.url=Q5+"#cannot-parse-style-attribute",s}}function tR(t,e,n){let r;if(!n)r={type:"Literal",value:e};else if(e.includes(".")){const s=e.split(".");let i=-1,o;for(;++i<s.length;){const a=pC(s[i])?{type:"Identifier",name:s[i]}:{type:"Literal",value:s[i]};o=o?{type:"MemberExpression",object:o,property:a,computed:!!(i&&a.type==="Literal"),optional:!1}:a}r=o}else r=pC(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(r.type==="Literal"){const s=r.value;return Yw.call(t.components,s)?t.components[s]:s}if(t.evaluater)return t.evaluater.evaluateExpression(r);Ff(t)}function Ff(t,e){const n=new xs("Cannot handle MDX estrees without `createEvaluater`",{ancestors:t.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=t.filePath||void 0,n.url=Q5+"#cannot-handle-mdx-estrees-without-createevaluater",n}function qJ(t){const e={};let n;for(n in t)Yw.call(t,n)&&(e[YJ(n)]=t[n]);return e}function YJ(t){let e=t.replace(DJ,JJ);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function JJ(t){return"-"+t.toLowerCase()}const Ay={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},XJ={};function QJ(t,e){const n=e||XJ,r=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,s=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return nR(t,r,s)}function nR(t,e,n){if(ZJ(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return TC(t.children,e,n)}return Array.isArray(t)?TC(t,e,n):""}function TC(t,e,n){const r=[];let s=-1;for(;++s<t.length;)r[s]=nR(t[s],e,n);return r.join("")}function ZJ(t){return!!(t&&typeof t=="object")}const CC=document.createElement("i");function Qw(t){const e="&"+t+";";CC.innerHTML=e;const n=CC.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===e?!1:n}function So(t,e,n,r){const s=t.length;let i=0,o;if(e<0?e=-e>s?0:s+e:e=e>s?s:e,n=n>0?n:0,r.length<1e4)o=Array.from(r),o.unshift(e,n),t.splice(...o);else for(n&&t.splice(e,n);i<r.length;)o=r.slice(i,i+1e4),o.unshift(e,0),t.splice(...o),i+=1e4,e+=1e4}function wi(t,e){return t.length>0?(So(t,t.length,0,e),t):e}const EC={}.hasOwnProperty;function eX(t){const e={};let n=-1;for(;++n<t.length;)tX(e,t[n]);return e}function tX(t,e){let n;for(n in e){const s=(EC.call(t,n)?t[n]:void 0)||(t[n]={}),i=e[n];let o;if(i)for(o in i){EC.call(s,o)||(s[o]=[]);const a=i[o];nX(s[o],Array.isArray(a)?a:a?[a]:[])}}}function nX(t,e){let n=-1;const r=[];for(;++n<e.length;)(e[n].add==="after"?t:r).push(e[n]);So(t,0,0,r)}function rR(t,e){const n=Number.parseInt(t,e);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function fu(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const co=sl(/[A-Za-z]/),ri=sl(/[\dA-Za-z]/),rX=sl(/[#-'*+\--9=?A-Z^-~]/);function db(t){return t!==null&&(t<32||t===127)}const fb=sl(/\d/),sX=sl(/[\dA-Fa-f]/),iX=sl(/[!-/:-@[-`{-~]/);function dn(t){return t!==null&&t<-2}function Vs(t){return t!==null&&(t<0||t===32)}function An(t){return t===-2||t===-1||t===32}const oX=sl(/\p{P}|\p{S}/u),aX=sl(/\s/);function sl(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function Uu(t){const e=[];let n=-1,r=0,s=0;for(;++n<t.length;){const i=t.charCodeAt(n);let o="";if(i===37&&ri(t.charCodeAt(n+1))&&ri(t.charCodeAt(n+2)))s=2;else if(i<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(i))||(o=String.fromCharCode(i));else if(i>55295&&i<57344){const a=t.charCodeAt(n+1);i<56320&&a>56319&&a<57344?(o=String.fromCharCode(i,a),s=1):o=""}else o=String.fromCharCode(i);o&&(e.push(t.slice(r,n),encodeURIComponent(o)),r=n+s+1,o=""),s&&(n+=s,s=0)}return e.join("")+t.slice(r)}function Gn(t,e,n,r){const s=r?r-1:Number.POSITIVE_INFINITY;let i=0;return o;function o(l){return An(l)?(t.enter(n),a(l)):e(l)}function a(l){return An(l)&&i++<s?(t.consume(l),a):(t.exit(n),e(l))}}const lX={tokenize:cX};function cX(t){const e=t.attempt(this.parser.constructs.contentInitial,r,s);let n;return e;function r(a){if(a===null){t.consume(a);return}return t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),Gn(t,e,"linePrefix")}function s(a){return t.enter("paragraph"),i(a)}function i(a){const l=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=l),n=l,o(a)}function o(a){if(a===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(a);return}return dn(a)?(t.consume(a),t.exit("chunkText"),i):(t.consume(a),o)}}const uX={tokenize:dX},NC={tokenize:fX};function dX(t){const e=this,n=[];let r=0,s,i,o;return a;function a(w){if(r<n.length){const T=n[r];return e.containerState=T[1],t.attempt(T[0].continuation,l,u)(w)}return u(w)}function l(w){if(r++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,s&&v();const T=e.events.length;let R=T,k;for(;R--;)if(e.events[R][0]==="exit"&&e.events[R][1].type==="chunkFlow"){k=e.events[R][1].end;break}g(r);let M=T;for(;M<e.events.length;)e.events[M][1].end={...k},M++;return So(e.events,R+1,0,e.events.slice(T)),e.events.length=M,u(w)}return a(w)}function u(w){if(r===n.length){if(!s)return h(w);if(s.currentConstruct&&s.currentConstruct.concrete)return m(w);e.interrupt=!!(s.currentConstruct&&!s._gfmTableDynamicInterruptHack)}return e.containerState={},t.check(NC,d,f)(w)}function d(w){return s&&v(),g(r),h(w)}function f(w){return e.parser.lazy[e.now().line]=r!==n.length,o=e.now().offset,m(w)}function h(w){return e.containerState={},t.attempt(NC,p,m)(w)}function p(w){return r++,n.push([e.currentConstruct,e.containerState]),h(w)}function m(w){if(w===null){s&&v(),g(0),t.consume(w);return}return s=s||e.parser.flow(e.now()),t.enter("chunkFlow",{_tokenizer:s,contentType:"flow",previous:i}),y(w)}function y(w){if(w===null){b(t.exit("chunkFlow"),!0),g(0),t.consume(w);return}return dn(w)?(t.consume(w),b(t.exit("chunkFlow")),r=0,e.interrupt=void 0,a):(t.consume(w),y)}function b(w,T){const R=e.sliceStream(w);if(T&&R.push(null),w.previous=i,i&&(i.next=w),i=w,s.defineSkip(w.start),s.write(R),e.parser.lazy[w.start.line]){let k=s.events.length;for(;k--;)if(s.events[k][1].start.offset<o&&(!s.events[k][1].end||s.events[k][1].end.offset>o))return;const M=e.events.length;let S=M,C,_;for(;S--;)if(e.events[S][0]==="exit"&&e.events[S][1].type==="chunkFlow"){if(C){_=e.events[S][1].end;break}C=!0}for(g(r),k=M;k<e.events.length;)e.events[k][1].end={..._},k++;So(e.events,S+1,0,e.events.slice(M)),e.events.length=k}}function g(w){let T=n.length;for(;T-- >w;){const R=n[T];e.containerState=R[1],R[0].exit.call(e,t)}n.length=w}function v(){s.write([null]),i=void 0,s=void 0,e.containerState._closeFlow=void 0}}function fX(t,e,n){return Gn(t,t.attempt(this.parser.constructs.document,e,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function jC(t){if(t===null||Vs(t)||aX(t))return 1;if(oX(t))return 2}function Zw(t,e,n){const r=[];let s=-1;for(;++s<t.length;){const i=t[s].resolveAll;i&&!r.includes(i)&&(e=i(e,n),r.push(i))}return e}const hb={name:"attention",resolveAll:hX,tokenize:pX};function hX(t,e){let n=-1,r,s,i,o,a,l,u,d;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(r=n;r--;)if(t[r][0]==="exit"&&t[r][1].type==="attentionSequence"&&t[r][1]._open&&e.sliceSerialize(t[r][1]).charCodeAt(0)===e.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[r][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[r][1].end.offset-t[r][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;l=t[r][1].end.offset-t[r][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const f={...t[r][1].end},h={...t[n][1].start};IC(f,-l),IC(h,l),o={type:l>1?"strongSequence":"emphasisSequence",start:f,end:{...t[r][1].end}},a={type:l>1?"strongSequence":"emphasisSequence",start:{...t[n][1].start},end:h},i={type:l>1?"strongText":"emphasisText",start:{...t[r][1].end},end:{...t[n][1].start}},s={type:l>1?"strong":"emphasis",start:{...o.start},end:{...a.end}},t[r][1].end={...o.start},t[n][1].start={...a.end},u=[],t[r][1].end.offset-t[r][1].start.offset&&(u=wi(u,[["enter",t[r][1],e],["exit",t[r][1],e]])),u=wi(u,[["enter",s,e],["enter",o,e],["exit",o,e],["enter",i,e]]),u=wi(u,Zw(e.parser.constructs.insideSpan.null,t.slice(r+1,n),e)),u=wi(u,[["exit",i,e],["enter",a,e],["exit",a,e],["exit",s,e]]),t[n][1].end.offset-t[n][1].start.offset?(d=2,u=wi(u,[["enter",t[n][1],e],["exit",t[n][1],e]])):d=0,So(t,r-1,n-r+3,u),n=r+u.length-d-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function pX(t,e){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,s=jC(r);let i;return o;function o(l){return i=l,t.enter("attentionSequence"),a(l)}function a(l){if(l===i)return t.consume(l),a;const u=t.exit("attentionSequence"),d=jC(l),f=!d||d===2&&s||n.includes(l),h=!s||s===2&&d||n.includes(r);return u._open=!!(i===42?f:f&&(s||!h)),u._close=!!(i===42?h:h&&(d||!f)),e(l)}}function IC(t,e){t.column+=e,t.offset+=e,t._bufferIndex+=e}const mX={name:"autolink",tokenize:gX};function gX(t,e,n){let r=0;return s;function s(p){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),i}function i(p){return co(p)?(t.consume(p),o):p===64?n(p):u(p)}function o(p){return p===43||p===45||p===46||ri(p)?(r=1,a(p)):u(p)}function a(p){return p===58?(t.consume(p),r=0,l):(p===43||p===45||p===46||ri(p))&&r++<32?(t.consume(p),a):(r=0,u(p))}function l(p){return p===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.exit("autolink"),e):p===null||p===32||p===60||db(p)?n(p):(t.consume(p),l)}function u(p){return p===64?(t.consume(p),d):rX(p)?(t.consume(p),u):n(p)}function d(p){return ri(p)?f(p):n(p)}function f(p){return p===46?(t.consume(p),r=0,d):p===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.exit("autolink"),e):h(p)}function h(p){if((p===45||ri(p))&&r++<63){const m=p===45?h:f;return t.consume(p),m}return n(p)}}const t0={partial:!0,tokenize:yX};function yX(t,e,n){return r;function r(i){return An(i)?Gn(t,s,"linePrefix")(i):s(i)}function s(i){return i===null||dn(i)?e(i):n(i)}}const sR={continuation:{tokenize:bX},exit:vX,name:"blockQuote",tokenize:xX};function xX(t,e,n){const r=this;return s;function s(o){if(o===62){const a=r.containerState;return a.open||(t.enter("blockQuote",{_container:!0}),a.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(o),t.exit("blockQuoteMarker"),i}return n(o)}function i(o){return An(o)?(t.enter("blockQuotePrefixWhitespace"),t.consume(o),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),e):(t.exit("blockQuotePrefix"),e(o))}}function bX(t,e,n){const r=this;return s;function s(o){return An(o)?Gn(t,i,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o):i(o)}function i(o){return t.attempt(sR,e,n)(o)}}function vX(t){t.exit("blockQuote")}const iR={name:"characterEscape",tokenize:wX};function wX(t,e,n){return r;function r(i){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(i),t.exit("escapeMarker"),s}function s(i){return iX(i)?(t.enter("characterEscapeValue"),t.consume(i),t.exit("characterEscapeValue"),t.exit("characterEscape"),e):n(i)}}const oR={name:"characterReference",tokenize:kX};function kX(t,e,n){const r=this;let s=0,i,o;return a;function a(f){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(f),t.exit("characterReferenceMarker"),l}function l(f){return f===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(f),t.exit("characterReferenceMarkerNumeric"),u):(t.enter("characterReferenceValue"),i=31,o=ri,d(f))}function u(f){return f===88||f===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(f),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),i=6,o=sX,d):(t.enter("characterReferenceValue"),i=7,o=fb,d(f))}function d(f){if(f===59&&s){const h=t.exit("characterReferenceValue");return o===ri&&!Qw(r.sliceSerialize(h))?n(f):(t.enter("characterReferenceMarker"),t.consume(f),t.exit("characterReferenceMarker"),t.exit("characterReference"),e)}return o(f)&&s++<i?(t.consume(f),d):n(f)}}const MC={partial:!0,tokenize:_X},DC={concrete:!0,name:"codeFenced",tokenize:SX};function SX(t,e,n){const r=this,s={partial:!0,tokenize:R};let i=0,o=0,a;return l;function l(k){return u(k)}function u(k){const M=r.events[r.events.length-1];return i=M&&M[1].type==="linePrefix"?M[2].sliceSerialize(M[1],!0).length:0,a=k,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),d(k)}function d(k){return k===a?(o++,t.consume(k),d):o<3?n(k):(t.exit("codeFencedFenceSequence"),An(k)?Gn(t,f,"whitespace")(k):f(k))}function f(k){return k===null||dn(k)?(t.exit("codeFencedFence"),r.interrupt?e(k):t.check(MC,y,T)(k)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),h(k))}function h(k){return k===null||dn(k)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),f(k)):An(k)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),Gn(t,p,"whitespace")(k)):k===96&&k===a?n(k):(t.consume(k),h)}function p(k){return k===null||dn(k)?f(k):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),m(k))}function m(k){return k===null||dn(k)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),f(k)):k===96&&k===a?n(k):(t.consume(k),m)}function y(k){return t.attempt(s,T,b)(k)}function b(k){return t.enter("lineEnding"),t.consume(k),t.exit("lineEnding"),g}function g(k){return i>0&&An(k)?Gn(t,v,"linePrefix",i+1)(k):v(k)}function v(k){return k===null||dn(k)?t.check(MC,y,T)(k):(t.enter("codeFlowValue"),w(k))}function w(k){return k===null||dn(k)?(t.exit("codeFlowValue"),v(k)):(t.consume(k),w)}function T(k){return t.exit("codeFenced"),e(k)}function R(k,M,S){let C=0;return _;function _($){return k.enter("lineEnding"),k.consume($),k.exit("lineEnding"),E}function E($){return k.enter("codeFencedFence"),An($)?Gn(k,I,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)($):I($)}function I($){return $===a?(k.enter("codeFencedFenceSequence"),P($)):S($)}function P($){return $===a?(C++,k.consume($),P):C>=o?(k.exit("codeFencedFenceSequence"),An($)?Gn(k,O,"whitespace")($):O($)):S($)}function O($){return $===null||dn($)?(k.exit("codeFencedFence"),M($)):S($)}}}function _X(t,e,n){const r=this;return s;function s(o){return o===null?n(o):(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),i)}function i(o){return r.parser.lazy[r.now().line]?n(o):e(o)}}const Ry={name:"codeIndented",tokenize:CX},TX={partial:!0,tokenize:EX};function CX(t,e,n){const r=this;return s;function s(u){return t.enter("codeIndented"),Gn(t,i,"linePrefix",4+1)(u)}function i(u){const d=r.events[r.events.length-1];return d&&d[1].type==="linePrefix"&&d[2].sliceSerialize(d[1],!0).length>=4?o(u):n(u)}function o(u){return u===null?l(u):dn(u)?t.attempt(TX,o,l)(u):(t.enter("codeFlowValue"),a(u))}function a(u){return u===null||dn(u)?(t.exit("codeFlowValue"),o(u)):(t.consume(u),a)}function l(u){return t.exit("codeIndented"),e(u)}}function EX(t,e,n){const r=this;return s;function s(o){return r.parser.lazy[r.now().line]?n(o):dn(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),s):Gn(t,i,"linePrefix",4+1)(o)}function i(o){const a=r.events[r.events.length-1];return a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):dn(o)?s(o):n(o)}}const NX={name:"codeText",previous:IX,resolve:jX,tokenize:MX};function jX(t){let e=t.length-4,n=3,r,s;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[e][1].type==="lineEnding"||t[e][1].type==="space")){for(r=n;++r<e;)if(t[r][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[e][1].type="codeTextPadding",n+=2,e-=2;break}}for(r=n-1,e++;++r<=e;)s===void 0?r!==e&&t[r][1].type!=="lineEnding"&&(s=r):(r===e||t[r][1].type==="lineEnding")&&(t[s][1].type="codeTextData",r!==s+2&&(t[s][1].end=t[r-1][1].end,t.splice(s+2,r-s-2),e-=r-s-2,r=s+2),s=void 0);return t}function IX(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function MX(t,e,n){let r=0,s,i;return o;function o(f){return t.enter("codeText"),t.enter("codeTextSequence"),a(f)}function a(f){return f===96?(t.consume(f),r++,a):(t.exit("codeTextSequence"),l(f))}function l(f){return f===null?n(f):f===32?(t.enter("space"),t.consume(f),t.exit("space"),l):f===96?(i=t.enter("codeTextSequence"),s=0,d(f)):dn(f)?(t.enter("lineEnding"),t.consume(f),t.exit("lineEnding"),l):(t.enter("codeTextData"),u(f))}function u(f){return f===null||f===32||f===96||dn(f)?(t.exit("codeTextData"),l(f)):(t.consume(f),u)}function d(f){return f===96?(t.consume(f),s++,d):s===r?(t.exit("codeTextSequence"),t.exit("codeText"),e(f)):(i.type="codeTextData",u(f))}}class DX{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,n){const r=n??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(e,r):e>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(e,n,r){const s=n||0;this.setCursor(Math.trunc(e));const i=this.right.splice(this.right.length-s,Number.POSITIVE_INFINITY);return r&&rd(this.left,r),i.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),rd(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),rd(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const n=this.left.splice(e,Number.POSITIVE_INFINITY);rd(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);rd(this.left,n.reverse())}}}function rd(t,e){let n=0;if(e.length<1e4)t.push(...e);else for(;n<e.length;)t.push(...e.slice(n,n+1e4)),n+=1e4}function aR(t){const e={};let n=-1,r,s,i,o,a,l,u;const d=new DX(t);for(;++n<d.length;){for(;n in e;)n=e[n];if(r=d.get(n),n&&r[1].type==="chunkFlow"&&d.get(n-1)[1].type==="listItemPrefix"&&(l=r[1]._tokenizer.events,i=0,i<l.length&&l[i][1].type==="lineEndingBlank"&&(i+=2),i<l.length&&l[i][1].type==="content"))for(;++i<l.length&&l[i][1].type!=="content";)l[i][1].type==="chunkText"&&(l[i][1]._isInFirstContentOfListItem=!0,i++);if(r[0]==="enter")r[1].contentType&&(Object.assign(e,AX(d,n)),n=e[n],u=!0);else if(r[1]._container){for(i=n,s=void 0;i--;)if(o=d.get(i),o[1].type==="lineEnding"||o[1].type==="lineEndingBlank")o[0]==="enter"&&(s&&(d.get(s)[1].type="lineEndingBlank"),o[1].type="lineEnding",s=i);else if(!(o[1].type==="linePrefix"||o[1].type==="listItemIndent"))break;s&&(r[1].end={...d.get(s)[1].start},a=d.slice(s,n),a.unshift(r),d.splice(s,n-s+1,a))}}return So(t,0,Number.POSITIVE_INFINITY,d.slice(0)),!u}function AX(t,e){const n=t.get(e)[1],r=t.get(e)[2];let s=e-1;const i=[];let o=n._tokenizer;o||(o=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(o._contentTypeTextTrailing=!0));const a=o.events,l=[],u={};let d,f,h=-1,p=n,m=0,y=0;const b=[y];for(;p;){for(;t.get(++s)[1]!==p;);i.push(s),p._tokenizer||(d=r.sliceStream(p),p.next||d.push(null),f&&o.defineSkip(p.start),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(d),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),f=p,p=p.next}for(p=n;++h<a.length;)a[h][0]==="exit"&&a[h-1][0]==="enter"&&a[h][1].type===a[h-1][1].type&&a[h][1].start.line!==a[h][1].end.line&&(y=h+1,b.push(y),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(o.events=[],p?(p._tokenizer=void 0,p.previous=void 0):b.pop(),h=b.length;h--;){const g=a.slice(b[h],b[h+1]),v=i.pop();l.push([v,v+g.length-1]),t.splice(v,2,g)}for(l.reverse(),h=-1;++h<l.length;)u[m+l[h][0]]=m+l[h][1],m+=l[h][1]-l[h][0]-1;return u}const RX={resolve:PX,tokenize:LX},OX={partial:!0,tokenize:$X};function PX(t){return aR(t),t}function LX(t,e){let n;return r;function r(a){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),s(a)}function s(a){return a===null?i(a):dn(a)?t.check(OX,o,i)(a):(t.consume(a),s)}function i(a){return t.exit("chunkContent"),t.exit("content"),e(a)}function o(a){return t.consume(a),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,s}}function $X(t,e,n){const r=this;return s;function s(o){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),Gn(t,i,"linePrefix")}function i(o){if(o===null||dn(o))return n(o);const a=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):t.interrupt(r.parser.constructs.flow,n,e)(o)}}function lR(t,e,n,r,s,i,o,a,l){const u=l||Number.POSITIVE_INFINITY;let d=0;return f;function f(g){return g===60?(t.enter(r),t.enter(s),t.enter(i),t.consume(g),t.exit(i),h):g===null||g===32||g===41||db(g)?n(g):(t.enter(r),t.enter(o),t.enter(a),t.enter("chunkString",{contentType:"string"}),y(g))}function h(g){return g===62?(t.enter(i),t.consume(g),t.exit(i),t.exit(s),t.exit(r),e):(t.enter(a),t.enter("chunkString",{contentType:"string"}),p(g))}function p(g){return g===62?(t.exit("chunkString"),t.exit(a),h(g)):g===null||g===60||dn(g)?n(g):(t.consume(g),g===92?m:p)}function m(g){return g===60||g===62||g===92?(t.consume(g),p):p(g)}function y(g){return!d&&(g===null||g===41||Vs(g))?(t.exit("chunkString"),t.exit(a),t.exit(o),t.exit(r),e(g)):d<u&&g===40?(t.consume(g),d++,y):g===41?(t.consume(g),d--,y):g===null||g===32||g===40||db(g)?n(g):(t.consume(g),g===92?b:y)}function b(g){return g===40||g===41||g===92?(t.consume(g),y):y(g)}}function cR(t,e,n,r,s,i){const o=this;let a=0,l;return u;function u(p){return t.enter(r),t.enter(s),t.consume(p),t.exit(s),t.enter(i),d}function d(p){return a>999||p===null||p===91||p===93&&!l||p===94&&!a&&"_hiddenFootnoteSupport"in o.parser.constructs?n(p):p===93?(t.exit(i),t.enter(s),t.consume(p),t.exit(s),t.exit(r),e):dn(p)?(t.enter("lineEnding"),t.consume(p),t.exit("lineEnding"),d):(t.enter("chunkString",{contentType:"string"}),f(p))}function f(p){return p===null||p===91||p===93||dn(p)||a++>999?(t.exit("chunkString"),d(p)):(t.consume(p),l||(l=!An(p)),p===92?h:f)}function h(p){return p===91||p===92||p===93?(t.consume(p),a++,f):f(p)}}function uR(t,e,n,r,s,i){let o;return a;function a(h){return h===34||h===39||h===40?(t.enter(r),t.enter(s),t.consume(h),t.exit(s),o=h===40?41:h,l):n(h)}function l(h){return h===o?(t.enter(s),t.consume(h),t.exit(s),t.exit(r),e):(t.enter(i),u(h))}function u(h){return h===o?(t.exit(i),l(o)):h===null?n(h):dn(h)?(t.enter("lineEnding"),t.consume(h),t.exit("lineEnding"),Gn(t,u,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),d(h))}function d(h){return h===o||h===null||dn(h)?(t.exit("chunkString"),u(h)):(t.consume(h),h===92?f:d)}function f(h){return h===o||h===92?(t.consume(h),d):d(h)}}function Wd(t,e){let n;return r;function r(s){return dn(s)?(t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),n=!0,r):An(s)?Gn(t,r,n?"linePrefix":"lineSuffix")(s):e(s)}}const zX={name:"definition",tokenize:BX},FX={partial:!0,tokenize:UX};function BX(t,e,n){const r=this;let s;return i;function i(p){return t.enter("definition"),o(p)}function o(p){return cR.call(r,t,a,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(p)}function a(p){return s=fu(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),p===58?(t.enter("definitionMarker"),t.consume(p),t.exit("definitionMarker"),l):n(p)}function l(p){return Vs(p)?Wd(t,u)(p):u(p)}function u(p){return lR(t,d,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(p)}function d(p){return t.attempt(FX,f,f)(p)}function f(p){return An(p)?Gn(t,h,"whitespace")(p):h(p)}function h(p){return p===null||dn(p)?(t.exit("definition"),r.parser.defined.push(s),e(p)):n(p)}}function UX(t,e,n){return r;function r(a){return Vs(a)?Wd(t,s)(a):n(a)}function s(a){return uR(t,i,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(a)}function i(a){return An(a)?Gn(t,o,"whitespace")(a):o(a)}function o(a){return a===null||dn(a)?e(a):n(a)}}const HX={name:"hardBreakEscape",tokenize:VX};function VX(t,e,n){return r;function r(i){return t.enter("hardBreakEscape"),t.consume(i),s}function s(i){return dn(i)?(t.exit("hardBreakEscape"),e(i)):n(i)}}const WX={name:"headingAtx",resolve:KX,tokenize:GX};function KX(t,e){let n=t.length-2,r=3,s,i;return t[r][1].type==="whitespace"&&(r+=2),n-2>r&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(r===n-1||n-4>r&&t[n-2][1].type==="whitespace")&&(n-=r+1===n?2:4),n>r&&(s={type:"atxHeadingText",start:t[r][1].start,end:t[n][1].end},i={type:"chunkText",start:t[r][1].start,end:t[n][1].end,contentType:"text"},So(t,r,n-r+1,[["enter",s,e],["enter",i,e],["exit",i,e],["exit",s,e]])),t}function GX(t,e,n){let r=0;return s;function s(d){return t.enter("atxHeading"),i(d)}function i(d){return t.enter("atxHeadingSequence"),o(d)}function o(d){return d===35&&r++<6?(t.consume(d),o):d===null||Vs(d)?(t.exit("atxHeadingSequence"),a(d)):n(d)}function a(d){return d===35?(t.enter("atxHeadingSequence"),l(d)):d===null||dn(d)?(t.exit("atxHeading"),e(d)):An(d)?Gn(t,a,"whitespace")(d):(t.enter("atxHeadingText"),u(d))}function l(d){return d===35?(t.consume(d),l):(t.exit("atxHeadingSequence"),a(d))}function u(d){return d===null||d===35||Vs(d)?(t.exit("atxHeadingText"),a(d)):(t.consume(d),u)}}const qX=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],AC=["pre","script","style","textarea"],YX={concrete:!0,name:"htmlFlow",resolveTo:QX,tokenize:ZX},JX={partial:!0,tokenize:tQ},XX={partial:!0,tokenize:eQ};function QX(t){let e=t.length;for(;e--&&!(t[e][0]==="enter"&&t[e][1].type==="htmlFlow"););return e>1&&t[e-2][1].type==="linePrefix"&&(t[e][1].start=t[e-2][1].start,t[e+1][1].start=t[e-2][1].start,t.splice(e-2,2)),t}function ZX(t,e,n){const r=this;let s,i,o,a,l;return u;function u(F){return d(F)}function d(F){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(F),f}function f(F){return F===33?(t.consume(F),h):F===47?(t.consume(F),i=!0,y):F===63?(t.consume(F),s=3,r.interrupt?e:D):co(F)?(t.consume(F),o=String.fromCharCode(F),b):n(F)}function h(F){return F===45?(t.consume(F),s=2,p):F===91?(t.consume(F),s=5,a=0,m):co(F)?(t.consume(F),s=4,r.interrupt?e:D):n(F)}function p(F){return F===45?(t.consume(F),r.interrupt?e:D):n(F)}function m(F){const U="CDATA[";return F===U.charCodeAt(a++)?(t.consume(F),a===U.length?r.interrupt?e:I:m):n(F)}function y(F){return co(F)?(t.consume(F),o=String.fromCharCode(F),b):n(F)}function b(F){if(F===null||F===47||F===62||Vs(F)){const U=F===47,ne=o.toLowerCase();return!U&&!i&&AC.includes(ne)?(s=1,r.interrupt?e(F):I(F)):qX.includes(o.toLowerCase())?(s=6,U?(t.consume(F),g):r.interrupt?e(F):I(F)):(s=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(F):i?v(F):w(F))}return F===45||ri(F)?(t.consume(F),o+=String.fromCharCode(F),b):n(F)}function g(F){return F===62?(t.consume(F),r.interrupt?e:I):n(F)}function v(F){return An(F)?(t.consume(F),v):_(F)}function w(F){return F===47?(t.consume(F),_):F===58||F===95||co(F)?(t.consume(F),T):An(F)?(t.consume(F),w):_(F)}function T(F){return F===45||F===46||F===58||F===95||ri(F)?(t.consume(F),T):R(F)}function R(F){return F===61?(t.consume(F),k):An(F)?(t.consume(F),R):w(F)}function k(F){return F===null||F===60||F===61||F===62||F===96?n(F):F===34||F===39?(t.consume(F),l=F,M):An(F)?(t.consume(F),k):S(F)}function M(F){return F===l?(t.consume(F),l=null,C):F===null||dn(F)?n(F):(t.consume(F),M)}function S(F){return F===null||F===34||F===39||F===47||F===60||F===61||F===62||F===96||Vs(F)?R(F):(t.consume(F),S)}function C(F){return F===47||F===62||An(F)?w(F):n(F)}function _(F){return F===62?(t.consume(F),E):n(F)}function E(F){return F===null||dn(F)?I(F):An(F)?(t.consume(F),E):n(F)}function I(F){return F===45&&s===2?(t.consume(F),A):F===60&&s===1?(t.consume(F),j):F===62&&s===4?(t.consume(F),ge):F===63&&s===3?(t.consume(F),D):F===93&&s===5?(t.consume(F),V):dn(F)&&(s===6||s===7)?(t.exit("htmlFlowData"),t.check(JX,me,P)(F)):F===null||dn(F)?(t.exit("htmlFlowData"),P(F)):(t.consume(F),I)}function P(F){return t.check(XX,O,me)(F)}function O(F){return t.enter("lineEnding"),t.consume(F),t.exit("lineEnding"),$}function $(F){return F===null||dn(F)?P(F):(t.enter("htmlFlowData"),I(F))}function A(F){return F===45?(t.consume(F),D):I(F)}function j(F){return F===47?(t.consume(F),o="",W):I(F)}function W(F){if(F===62){const U=o.toLowerCase();return AC.includes(U)?(t.consume(F),ge):I(F)}return co(F)&&o.length<8?(t.consume(F),o+=String.fromCharCode(F),W):I(F)}function V(F){return F===93?(t.consume(F),D):I(F)}function D(F){return F===62?(t.consume(F),ge):F===45&&s===2?(t.consume(F),D):I(F)}function ge(F){return F===null||dn(F)?(t.exit("htmlFlowData"),me(F)):(t.consume(F),ge)}function me(F){return t.exit("htmlFlow"),e(F)}}function eQ(t,e,n){const r=this;return s;function s(o){return dn(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),i):n(o)}function i(o){return r.parser.lazy[r.now().line]?n(o):e(o)}}function tQ(t,e,n){return r;function r(s){return t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),t.attempt(t0,e,n)}}const nQ={name:"htmlText",tokenize:rQ};function rQ(t,e,n){const r=this;let s,i,o;return a;function a(D){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(D),l}function l(D){return D===33?(t.consume(D),u):D===47?(t.consume(D),R):D===63?(t.consume(D),w):co(D)?(t.consume(D),S):n(D)}function u(D){return D===45?(t.consume(D),d):D===91?(t.consume(D),i=0,m):co(D)?(t.consume(D),v):n(D)}function d(D){return D===45?(t.consume(D),p):n(D)}function f(D){return D===null?n(D):D===45?(t.consume(D),h):dn(D)?(o=f,j(D)):(t.consume(D),f)}function h(D){return D===45?(t.consume(D),p):f(D)}function p(D){return D===62?A(D):D===45?h(D):f(D)}function m(D){const ge="CDATA[";return D===ge.charCodeAt(i++)?(t.consume(D),i===ge.length?y:m):n(D)}function y(D){return D===null?n(D):D===93?(t.consume(D),b):dn(D)?(o=y,j(D)):(t.consume(D),y)}function b(D){return D===93?(t.consume(D),g):y(D)}function g(D){return D===62?A(D):D===93?(t.consume(D),g):y(D)}function v(D){return D===null||D===62?A(D):dn(D)?(o=v,j(D)):(t.consume(D),v)}function w(D){return D===null?n(D):D===63?(t.consume(D),T):dn(D)?(o=w,j(D)):(t.consume(D),w)}function T(D){return D===62?A(D):w(D)}function R(D){return co(D)?(t.consume(D),k):n(D)}function k(D){return D===45||ri(D)?(t.consume(D),k):M(D)}function M(D){return dn(D)?(o=M,j(D)):An(D)?(t.consume(D),M):A(D)}function S(D){return D===45||ri(D)?(t.consume(D),S):D===47||D===62||Vs(D)?C(D):n(D)}function C(D){return D===47?(t.consume(D),A):D===58||D===95||co(D)?(t.consume(D),_):dn(D)?(o=C,j(D)):An(D)?(t.consume(D),C):A(D)}function _(D){return D===45||D===46||D===58||D===95||ri(D)?(t.consume(D),_):E(D)}function E(D){return D===61?(t.consume(D),I):dn(D)?(o=E,j(D)):An(D)?(t.consume(D),E):C(D)}function I(D){return D===null||D===60||D===61||D===62||D===96?n(D):D===34||D===39?(t.consume(D),s=D,P):dn(D)?(o=I,j(D)):An(D)?(t.consume(D),I):(t.consume(D),O)}function P(D){return D===s?(t.consume(D),s=void 0,$):D===null?n(D):dn(D)?(o=P,j(D)):(t.consume(D),P)}function O(D){return D===null||D===34||D===39||D===60||D===61||D===96?n(D):D===47||D===62||Vs(D)?C(D):(t.consume(D),O)}function $(D){return D===47||D===62||Vs(D)?C(D):n(D)}function A(D){return D===62?(t.consume(D),t.exit("htmlTextData"),t.exit("htmlText"),e):n(D)}function j(D){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(D),t.exit("lineEnding"),W}function W(D){return An(D)?Gn(t,V,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(D):V(D)}function V(D){return t.enter("htmlTextData"),o(D)}}const ek={name:"labelEnd",resolveAll:aQ,resolveTo:lQ,tokenize:cQ},sQ={tokenize:uQ},iQ={tokenize:dQ},oQ={tokenize:fQ};function aQ(t){let e=-1;const n=[];for(;++e<t.length;){const r=t[e][1];if(n.push(t[e]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const s=r.type==="labelImage"?4:2;r.type="data",e+=s}}return t.length!==n.length&&So(t,0,t.length,n),t}function lQ(t,e){let n=t.length,r=0,s,i,o,a;for(;n--;)if(s=t[n][1],i){if(s.type==="link"||s.type==="labelLink"&&s._inactive)break;t[n][0]==="enter"&&s.type==="labelLink"&&(s._inactive=!0)}else if(o){if(t[n][0]==="enter"&&(s.type==="labelImage"||s.type==="labelLink")&&!s._balanced&&(i=n,s.type!=="labelLink")){r=2;break}}else s.type==="labelEnd"&&(o=n);const l={type:t[i][1].type==="labelLink"?"link":"image",start:{...t[i][1].start},end:{...t[t.length-1][1].end}},u={type:"label",start:{...t[i][1].start},end:{...t[o][1].end}},d={type:"labelText",start:{...t[i+r+2][1].end},end:{...t[o-2][1].start}};return a=[["enter",l,e],["enter",u,e]],a=wi(a,t.slice(i+1,i+r+3)),a=wi(a,[["enter",d,e]]),a=wi(a,Zw(e.parser.constructs.insideSpan.null,t.slice(i+r+4,o-3),e)),a=wi(a,[["exit",d,e],t[o-2],t[o-1],["exit",u,e]]),a=wi(a,t.slice(o+1)),a=wi(a,[["exit",l,e]]),So(t,i,t.length,a),t}function cQ(t,e,n){const r=this;let s=r.events.length,i,o;for(;s--;)if((r.events[s][1].type==="labelImage"||r.events[s][1].type==="labelLink")&&!r.events[s][1]._balanced){i=r.events[s][1];break}return a;function a(h){return i?i._inactive?f(h):(o=r.parser.defined.includes(fu(r.sliceSerialize({start:i.end,end:r.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(h),t.exit("labelMarker"),t.exit("labelEnd"),l):n(h)}function l(h){return h===40?t.attempt(sQ,d,o?d:f)(h):h===91?t.attempt(iQ,d,o?u:f)(h):o?d(h):f(h)}function u(h){return t.attempt(oQ,d,f)(h)}function d(h){return e(h)}function f(h){return i._balanced=!0,n(h)}}function uQ(t,e,n){return r;function r(f){return t.enter("resource"),t.enter("resourceMarker"),t.consume(f),t.exit("resourceMarker"),s}function s(f){return Vs(f)?Wd(t,i)(f):i(f)}function i(f){return f===41?d(f):lR(t,o,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(f)}function o(f){return Vs(f)?Wd(t,l)(f):d(f)}function a(f){return n(f)}function l(f){return f===34||f===39||f===40?uR(t,u,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(f):d(f)}function u(f){return Vs(f)?Wd(t,d)(f):d(f)}function d(f){return f===41?(t.enter("resourceMarker"),t.consume(f),t.exit("resourceMarker"),t.exit("resource"),e):n(f)}}function dQ(t,e,n){const r=this;return s;function s(a){return cR.call(r,t,i,o,"reference","referenceMarker","referenceString")(a)}function i(a){return r.parser.defined.includes(fu(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(a):n(a)}function o(a){return n(a)}}function fQ(t,e,n){return r;function r(i){return t.enter("reference"),t.enter("referenceMarker"),t.consume(i),t.exit("referenceMarker"),s}function s(i){return i===93?(t.enter("referenceMarker"),t.consume(i),t.exit("referenceMarker"),t.exit("reference"),e):n(i)}}const hQ={name:"labelStartImage",resolveAll:ek.resolveAll,tokenize:pQ};function pQ(t,e,n){const r=this;return s;function s(a){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(a),t.exit("labelImageMarker"),i}function i(a){return a===91?(t.enter("labelMarker"),t.consume(a),t.exit("labelMarker"),t.exit("labelImage"),o):n(a)}function o(a){return a===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(a):e(a)}}const mQ={name:"labelStartLink",resolveAll:ek.resolveAll,tokenize:gQ};function gQ(t,e,n){const r=this;return s;function s(o){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(o),t.exit("labelMarker"),t.exit("labelLink"),i}function i(o){return o===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(o):e(o)}}const Oy={name:"lineEnding",tokenize:yQ};function yQ(t,e){return n;function n(r){return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),Gn(t,e,"linePrefix")}}const Ip={name:"thematicBreak",tokenize:xQ};function xQ(t,e,n){let r=0,s;return i;function i(u){return t.enter("thematicBreak"),o(u)}function o(u){return s=u,a(u)}function a(u){return u===s?(t.enter("thematicBreakSequence"),l(u)):r>=3&&(u===null||dn(u))?(t.exit("thematicBreak"),e(u)):n(u)}function l(u){return u===s?(t.consume(u),r++,l):(t.exit("thematicBreakSequence"),An(u)?Gn(t,a,"whitespace")(u):a(u))}}const Ds={continuation:{tokenize:kQ},exit:_Q,name:"list",tokenize:wQ},bQ={partial:!0,tokenize:TQ},vQ={partial:!0,tokenize:SQ};function wQ(t,e,n){const r=this,s=r.events[r.events.length-1];let i=s&&s[1].type==="linePrefix"?s[2].sliceSerialize(s[1],!0).length:0,o=0;return a;function a(p){const m=r.containerState.type||(p===42||p===43||p===45?"listUnordered":"listOrdered");if(m==="listUnordered"?!r.containerState.marker||p===r.containerState.marker:fb(p)){if(r.containerState.type||(r.containerState.type=m,t.enter(m,{_container:!0})),m==="listUnordered")return t.enter("listItemPrefix"),p===42||p===45?t.check(Ip,n,u)(p):u(p);if(!r.interrupt||p===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),l(p)}return n(p)}function l(p){return fb(p)&&++o<10?(t.consume(p),l):(!r.interrupt||o<2)&&(r.containerState.marker?p===r.containerState.marker:p===41||p===46)?(t.exit("listItemValue"),u(p)):n(p)}function u(p){return t.enter("listItemMarker"),t.consume(p),t.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||p,t.check(t0,r.interrupt?n:d,t.attempt(bQ,h,f))}function d(p){return r.containerState.initialBlankLine=!0,i++,h(p)}function f(p){return An(p)?(t.enter("listItemPrefixWhitespace"),t.consume(p),t.exit("listItemPrefixWhitespace"),h):n(p)}function h(p){return r.containerState.size=i+r.sliceSerialize(t.exit("listItemPrefix"),!0).length,e(p)}}function kQ(t,e,n){const r=this;return r.containerState._closeFlow=void 0,t.check(t0,s,i);function s(a){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,Gn(t,e,"listItemIndent",r.containerState.size+1)(a)}function i(a){return r.containerState.furtherBlankLines||!An(a)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,o(a)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,t.attempt(vQ,e,o)(a))}function o(a){return r.containerState._closeFlow=!0,r.interrupt=void 0,Gn(t,t.attempt(Ds,e,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a)}}function SQ(t,e,n){const r=this;return Gn(t,s,"listItemIndent",r.containerState.size+1);function s(i){const o=r.events[r.events.length-1];return o&&o[1].type==="listItemIndent"&&o[2].sliceSerialize(o[1],!0).length===r.containerState.size?e(i):n(i)}}function _Q(t){t.exit(this.containerState.type)}function TQ(t,e,n){const r=this;return Gn(t,s,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4+1);function s(i){const o=r.events[r.events.length-1];return!An(i)&&o&&o[1].type==="listItemPrefixWhitespace"?e(i):n(i)}}const RC={name:"setextUnderline",resolveTo:CQ,tokenize:EQ};function CQ(t,e){let n=t.length,r,s,i;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){r=n;break}t[n][1].type==="paragraph"&&(s=n)}else t[n][1].type==="content"&&t.splice(n,1),!i&&t[n][1].type==="definition"&&(i=n);const o={type:"setextHeading",start:{...t[r][1].start},end:{...t[t.length-1][1].end}};return t[s][1].type="setextHeadingText",i?(t.splice(s,0,["enter",o,e]),t.splice(i+1,0,["exit",t[r][1],e]),t[r][1].end={...t[i][1].end}):t[r][1]=o,t.push(["exit",o,e]),t}function EQ(t,e,n){const r=this;let s;return i;function i(u){let d=r.events.length,f;for(;d--;)if(r.events[d][1].type!=="lineEnding"&&r.events[d][1].type!=="linePrefix"&&r.events[d][1].type!=="content"){f=r.events[d][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||f)?(t.enter("setextHeadingLine"),s=u,o(u)):n(u)}function o(u){return t.enter("setextHeadingLineSequence"),a(u)}function a(u){return u===s?(t.consume(u),a):(t.exit("setextHeadingLineSequence"),An(u)?Gn(t,l,"lineSuffix")(u):l(u))}function l(u){return u===null||dn(u)?(t.exit("setextHeadingLine"),e(u)):n(u)}}const NQ={tokenize:jQ};function jQ(t){const e=this,n=t.attempt(t0,r,t.attempt(this.parser.constructs.flowInitial,s,Gn(t,t.attempt(this.parser.constructs.flow,s,t.attempt(RX,s)),"linePrefix")));return n;function r(i){if(i===null){t.consume(i);return}return t.enter("lineEndingBlank"),t.consume(i),t.exit("lineEndingBlank"),e.currentConstruct=void 0,n}function s(i){if(i===null){t.consume(i);return}return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),e.currentConstruct=void 0,n}}const IQ={resolveAll:fR()},MQ=dR("string"),DQ=dR("text");function dR(t){return{resolveAll:fR(t==="text"?AQ:void 0),tokenize:e};function e(n){const r=this,s=this.parser.constructs[t],i=n.attempt(s,o,a);return o;function o(d){return u(d)?i(d):a(d)}function a(d){if(d===null){n.consume(d);return}return n.enter("data"),n.consume(d),l}function l(d){return u(d)?(n.exit("data"),i(d)):(n.consume(d),l)}function u(d){if(d===null)return!0;const f=s[d];let h=-1;if(f)for(;++h<f.length;){const p=f[h];if(!p.previous||p.previous.call(r,r.previous))return!0}return!1}}}function fR(t){return e;function e(n,r){let s=-1,i;for(;++s<=n.length;)i===void 0?n[s]&&n[s][1].type==="data"&&(i=s,s++):(!n[s]||n[s][1].type!=="data")&&(s!==i+2&&(n[i][1].end=n[s-1][1].end,n.splice(i+2,s-i-2),s=i+2),i=void 0);return t?t(n,r):n}}function AQ(t,e){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const r=t[n-1][1],s=e.sliceStream(r);let i=s.length,o=-1,a=0,l;for(;i--;){const u=s[i];if(typeof u=="string"){for(o=u.length;u.charCodeAt(o-1)===32;)a++,o--;if(o)break;o=-1}else if(u===-2)l=!0,a++;else if(u!==-1){i++;break}}if(e._contentTypeTextTrailing&&n===t.length&&(a=0),a){const u={type:n===t.length||l||a<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:i?o:r.start._bufferIndex+o,_index:r.start._index+i,line:r.end.line,column:r.end.column-a,offset:r.end.offset-a},end:{...r.end}};r.end={...u.start},r.start.offset===r.end.offset?Object.assign(r,u):(t.splice(n,0,["enter",u,e],["exit",u,e]),n+=2)}n++}return t}const RQ={42:Ds,43:Ds,45:Ds,48:Ds,49:Ds,50:Ds,51:Ds,52:Ds,53:Ds,54:Ds,55:Ds,56:Ds,57:Ds,62:sR},OQ={91:zX},PQ={[-2]:Ry,[-1]:Ry,32:Ry},LQ={35:WX,42:Ip,45:[RC,Ip],60:YX,61:RC,95:Ip,96:DC,126:DC},$Q={38:oR,92:iR},zQ={[-5]:Oy,[-4]:Oy,[-3]:Oy,33:hQ,38:oR,42:hb,60:[mX,nQ],91:mQ,92:[HX,iR],93:ek,95:hb,96:NX},FQ={null:[hb,IQ]},BQ={null:[42,95]},UQ={null:[]},HQ=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:BQ,contentInitial:OQ,disable:UQ,document:RQ,flow:LQ,flowInitial:PQ,insideSpan:FQ,string:$Q,text:zQ},Symbol.toStringTag,{value:"Module"}));function VQ(t,e,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const s={},i=[];let o=[],a=[];const l={attempt:M(R),check:M(k),consume:v,enter:w,exit:T,interrupt:M(k,{interrupt:!0})},u={code:null,containerState:{},defineSkip:y,events:[],now:m,parser:t,previous:null,sliceSerialize:h,sliceStream:p,write:f};let d=e.tokenize.call(u,l);return e.resolveAll&&i.push(e),u;function f(E){return o=wi(o,E),b(),o[o.length-1]!==null?[]:(S(e,0),u.events=Zw(i,u.events,u),u.events)}function h(E,I){return KQ(p(E),I)}function p(E){return WQ(o,E)}function m(){const{_bufferIndex:E,_index:I,line:P,column:O,offset:$}=r;return{_bufferIndex:E,_index:I,line:P,column:O,offset:$}}function y(E){s[E.line]=E.column,_()}function b(){let E;for(;r._index<o.length;){const I=o[r._index];if(typeof I=="string")for(E=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===E&&r._bufferIndex<I.length;)g(I.charCodeAt(r._bufferIndex));else g(I)}}function g(E){d=d(E)}function v(E){dn(E)?(r.line++,r.column=1,r.offset+=E===-3?2:1,_()):E!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===o[r._index].length&&(r._bufferIndex=-1,r._index++)),u.previous=E}function w(E,I){const P=I||{};return P.type=E,P.start=m(),u.events.push(["enter",P,u]),a.push(P),P}function T(E){const I=a.pop();return I.end=m(),u.events.push(["exit",I,u]),I}function R(E,I){S(E,I.from)}function k(E,I){I.restore()}function M(E,I){return P;function P(O,$,A){let j,W,V,D;return Array.isArray(O)?me(O):"tokenize"in O?me([O]):ge(O);function ge(Oe){return at;function at(ae){const _e=ae!==null&&Oe[ae],le=ae!==null&&Oe.null,Ce=[...Array.isArray(_e)?_e:_e?[_e]:[],...Array.isArray(le)?le:le?[le]:[]];return me(Ce)(ae)}}function me(Oe){return j=Oe,W=0,Oe.length===0?A:F(Oe[W])}function F(Oe){return at;function at(ae){return D=C(),V=Oe,Oe.partial||(u.currentConstruct=Oe),Oe.name&&u.parser.constructs.disable.null.includes(Oe.name)?ne():Oe.tokenize.call(I?Object.assign(Object.create(u),I):u,l,U,ne)(ae)}}function U(Oe){return E(V,D),$}function ne(Oe){return D.restore(),++W<j.length?F(j[W]):A}}}function S(E,I){E.resolveAll&&!i.includes(E)&&i.push(E),E.resolve&&So(u.events,I,u.events.length-I,E.resolve(u.events.slice(I),u)),E.resolveTo&&(u.events=E.resolveTo(u.events,u))}function C(){const E=m(),I=u.previous,P=u.currentConstruct,O=u.events.length,$=Array.from(a);return{from:O,restore:A};function A(){r=E,u.previous=I,u.currentConstruct=P,u.events.length=O,a=$,_()}}function _(){r.line in s&&r.column<2&&(r.column=s[r.line],r.offset+=s[r.line]-1)}}function WQ(t,e){const n=e.start._index,r=e.start._bufferIndex,s=e.end._index,i=e.end._bufferIndex;let o;if(n===s)o=[t[n].slice(r,i)];else{if(o=t.slice(n,s),r>-1){const a=o[0];typeof a=="string"?o[0]=a.slice(r):o.shift()}i>0&&o.push(t[s].slice(0,i))}return o}function KQ(t,e){let n=-1;const r=[];let s;for(;++n<t.length;){const i=t[n];let o;if(typeof i=="string")o=i;else switch(i){case-5:{o="\r";break}case-4:{o=`
`;break}case-3:{o=`\r
`;break}case-2:{o=e?" ":"	";break}case-1:{if(!e&&s)continue;o=" ";break}default:o=String.fromCharCode(i)}s=i===-2,r.push(o)}return r.join("")}function GQ(t){const r={constructs:eX([HQ,...(t||{}).extensions||[]]),content:s(lX),defined:[],document:s(uX),flow:s(NQ),lazy:{},string:s(MQ),text:s(DQ)};return r;function s(i){return o;function o(a){return VQ(r,i,a)}}}function qQ(t){for(;!aR(t););return t}const OC=/[\0\t\n\r]/g;function YQ(){let t=1,e="",n=!0,r;return s;function s(i,o,a){const l=[];let u,d,f,h,p;for(i=e+(typeof i=="string"?i.toString():new TextDecoder(o||void 0).decode(i)),f=0,e="",n&&(i.charCodeAt(0)===65279&&f++,n=void 0);f<i.length;){if(OC.lastIndex=f,u=OC.exec(i),h=u&&u.index!==void 0?u.index:i.length,p=i.charCodeAt(h),!u){e=i.slice(f);break}if(p===10&&f===h&&r)l.push(-3),r=void 0;else switch(r&&(l.push(-5),r=void 0),f<h&&(l.push(i.slice(f,h)),t+=h-f),p){case 0:{l.push(65533),t++;break}case 9:{for(d=Math.ceil(t/4)*4,l.push(-2);t++<d;)l.push(-1);break}case 10:{l.push(-4),t=1;break}default:r=!0,t=1}f=h+1}return a&&(r&&l.push(-5),e&&l.push(e),l.push(null)),l}}const JQ=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function XQ(t){return t.replace(JQ,QQ)}function QQ(t,e,n){if(e)return e;if(n.charCodeAt(0)===35){const s=n.charCodeAt(1),i=s===120||s===88;return rR(n.slice(i?2:1),i?16:10)}return Qw(n)||t}const hR={}.hasOwnProperty;function ZQ(t,e,n){return typeof e!="string"&&(n=e,e=void 0),eZ(n)(qQ(GQ(n).document().write(YQ()(t,e,!0))))}function eZ(t){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:i(Z),autolinkProtocol:C,autolinkEmail:C,atxHeading:i(Be),blockQuote:i(le),characterEscape:C,characterReference:C,codeFenced:i(Ce),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:i(Ce,o),codeText:i(Le,o),codeTextData:C,data:C,codeFlowValue:C,definition:i(Ve),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:i(st),hardBreakEscape:i(ht),hardBreakTrailing:i(ht),htmlFlow:i(vt,o),htmlFlowData:C,htmlText:i(vt,o),htmlTextData:C,image:i(te),label:o,link:i(Z),listItem:i(he),listItemValue:h,listOrdered:i(ie,f),listUnordered:i(ie),paragraph:i(se),reference:F,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:i(Be),strong:i(Q),thematicBreak:i(Me)},exit:{atxHeading:l(),atxHeadingSequence:R,autolink:l(),autolinkEmail:_e,autolinkProtocol:ae,blockQuote:l(),characterEscapeValue:_,characterReferenceMarkerHexadecimal:ne,characterReferenceMarkerNumeric:ne,characterReferenceValue:Oe,characterReference:at,codeFenced:l(b),codeFencedFence:y,codeFencedFenceInfo:p,codeFencedFenceMeta:m,codeFlowValue:_,codeIndented:l(g),codeText:l($),codeTextData:_,data:_,definition:l(),definitionDestinationString:T,definitionLabelString:v,definitionTitleString:w,emphasis:l(),hardBreakEscape:l(I),hardBreakTrailing:l(I),htmlFlow:l(P),htmlFlowData:_,htmlText:l(O),htmlTextData:_,image:l(j),label:V,labelText:W,lineEnding:E,link:l(A),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:U,resourceDestinationString:D,resourceTitleString:ge,resource:me,setextHeading:l(S),setextHeadingLineSequence:M,setextHeadingText:k,strong:l(),thematicBreak:l()}};pR(e,(t||{}).mdastExtensions||[]);const n={};return r;function r(fe){let Re={type:"root",children:[]};const qe={stack:[Re],tokenStack:[],config:e,enter:a,exit:u,buffer:o,resume:d,data:n},xt=[];let Dt=-1;for(;++Dt<fe.length;)if(fe[Dt][1].type==="listOrdered"||fe[Dt][1].type==="listUnordered")if(fe[Dt][0]==="enter")xt.push(Dt);else{const oe=xt.pop();Dt=s(fe,oe,Dt)}for(Dt=-1;++Dt<fe.length;){const oe=e[fe[Dt][0]];hR.call(oe,fe[Dt][1].type)&&oe[fe[Dt][1].type].call(Object.assign({sliceSerialize:fe[Dt][2].sliceSerialize},qe),fe[Dt][1])}if(qe.tokenStack.length>0){const oe=qe.tokenStack[qe.tokenStack.length-1];(oe[1]||PC).call(qe,void 0,oe[0])}for(Re.position={start:oa(fe.length>0?fe[0][1].start:{line:1,column:1,offset:0}),end:oa(fe.length>0?fe[fe.length-2][1].end:{line:1,column:1,offset:0})},Dt=-1;++Dt<e.transforms.length;)Re=e.transforms[Dt](Re)||Re;return Re}function s(fe,Re,qe){let xt=Re-1,Dt=-1,oe=!1,Ee,Ue,tt,Ne;for(;++xt<=qe;){const pt=fe[xt];switch(pt[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{pt[0]==="enter"?Dt++:Dt--,Ne=void 0;break}case"lineEndingBlank":{pt[0]==="enter"&&(Ee&&!Ne&&!Dt&&!tt&&(tt=xt),Ne=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Ne=void 0}if(!Dt&&pt[0]==="enter"&&pt[1].type==="listItemPrefix"||Dt===-1&&pt[0]==="exit"&&(pt[1].type==="listUnordered"||pt[1].type==="listOrdered")){if(Ee){let dt=xt;for(Ue=void 0;dt--;){const Et=fe[dt];if(Et[1].type==="lineEnding"||Et[1].type==="lineEndingBlank"){if(Et[0]==="exit")continue;Ue&&(fe[Ue][1].type="lineEndingBlank",oe=!0),Et[1].type="lineEnding",Ue=dt}else if(!(Et[1].type==="linePrefix"||Et[1].type==="blockQuotePrefix"||Et[1].type==="blockQuotePrefixWhitespace"||Et[1].type==="blockQuoteMarker"||Et[1].type==="listItemIndent"))break}tt&&(!Ue||tt<Ue)&&(Ee._spread=!0),Ee.end=Object.assign({},Ue?fe[Ue][1].start:pt[1].end),fe.splice(Ue||xt,0,["exit",Ee,pt[2]]),xt++,qe++}if(pt[1].type==="listItemPrefix"){const dt={type:"listItem",_spread:!1,start:Object.assign({},pt[1].start),end:void 0};Ee=dt,fe.splice(xt,0,["enter",dt,pt[2]]),xt++,qe++,tt=void 0,Ne=!0}}}return fe[Re][1]._spread=oe,qe}function i(fe,Re){return qe;function qe(xt){a.call(this,fe(xt),xt),Re&&Re.call(this,xt)}}function o(){this.stack.push({type:"fragment",children:[]})}function a(fe,Re,qe){this.stack[this.stack.length-1].children.push(fe),this.stack.push(fe),this.tokenStack.push([Re,qe||void 0]),fe.position={start:oa(Re.start),end:void 0}}function l(fe){return Re;function Re(qe){fe&&fe.call(this,qe),u.call(this,qe)}}function u(fe,Re){const qe=this.stack.pop(),xt=this.tokenStack.pop();if(xt)xt[0].type!==fe.type&&(Re?Re.call(this,fe,xt[0]):(xt[1]||PC).call(this,fe,xt[0]));else throw new Error("Cannot close `"+fe.type+"` ("+Vd({start:fe.start,end:fe.end})+"): its not open");qe.position.end=oa(fe.end)}function d(){return QJ(this.stack.pop())}function f(){this.data.expectingFirstListItemValue=!0}function h(fe){if(this.data.expectingFirstListItemValue){const Re=this.stack[this.stack.length-2];Re.start=Number.parseInt(this.sliceSerialize(fe),10),this.data.expectingFirstListItemValue=void 0}}function p(){const fe=this.resume(),Re=this.stack[this.stack.length-1];Re.lang=fe}function m(){const fe=this.resume(),Re=this.stack[this.stack.length-1];Re.meta=fe}function y(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function b(){const fe=this.resume(),Re=this.stack[this.stack.length-1];Re.value=fe.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function g(){const fe=this.resume(),Re=this.stack[this.stack.length-1];Re.value=fe.replace(/(\r?\n|\r)$/g,"")}function v(fe){const Re=this.resume(),qe=this.stack[this.stack.length-1];qe.label=Re,qe.identifier=fu(this.sliceSerialize(fe)).toLowerCase()}function w(){const fe=this.resume(),Re=this.stack[this.stack.length-1];Re.title=fe}function T(){const fe=this.resume(),Re=this.stack[this.stack.length-1];Re.url=fe}function R(fe){const Re=this.stack[this.stack.length-1];if(!Re.depth){const qe=this.sliceSerialize(fe).length;Re.depth=qe}}function k(){this.data.setextHeadingSlurpLineEnding=!0}function M(fe){const Re=this.stack[this.stack.length-1];Re.depth=this.sliceSerialize(fe).codePointAt(0)===61?1:2}function S(){this.data.setextHeadingSlurpLineEnding=void 0}function C(fe){const qe=this.stack[this.stack.length-1].children;let xt=qe[qe.length-1];(!xt||xt.type!=="text")&&(xt=ke(),xt.position={start:oa(fe.start),end:void 0},qe.push(xt)),this.stack.push(xt)}function _(fe){const Re=this.stack.pop();Re.value+=this.sliceSerialize(fe),Re.position.end=oa(fe.end)}function E(fe){const Re=this.stack[this.stack.length-1];if(this.data.atHardBreak){const qe=Re.children[Re.children.length-1];qe.position.end=oa(fe.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(Re.type)&&(C.call(this,fe),_.call(this,fe))}function I(){this.data.atHardBreak=!0}function P(){const fe=this.resume(),Re=this.stack[this.stack.length-1];Re.value=fe}function O(){const fe=this.resume(),Re=this.stack[this.stack.length-1];Re.value=fe}function $(){const fe=this.resume(),Re=this.stack[this.stack.length-1];Re.value=fe}function A(){const fe=this.stack[this.stack.length-1];if(this.data.inReference){const Re=this.data.referenceType||"shortcut";fe.type+="Reference",fe.referenceType=Re,delete fe.url,delete fe.title}else delete fe.identifier,delete fe.label;this.data.referenceType=void 0}function j(){const fe=this.stack[this.stack.length-1];if(this.data.inReference){const Re=this.data.referenceType||"shortcut";fe.type+="Reference",fe.referenceType=Re,delete fe.url,delete fe.title}else delete fe.identifier,delete fe.label;this.data.referenceType=void 0}function W(fe){const Re=this.sliceSerialize(fe),qe=this.stack[this.stack.length-2];qe.label=XQ(Re),qe.identifier=fu(Re).toLowerCase()}function V(){const fe=this.stack[this.stack.length-1],Re=this.resume(),qe=this.stack[this.stack.length-1];if(this.data.inReference=!0,qe.type==="link"){const xt=fe.children;qe.children=xt}else qe.alt=Re}function D(){const fe=this.resume(),Re=this.stack[this.stack.length-1];Re.url=fe}function ge(){const fe=this.resume(),Re=this.stack[this.stack.length-1];Re.title=fe}function me(){this.data.inReference=void 0}function F(){this.data.referenceType="collapsed"}function U(fe){const Re=this.resume(),qe=this.stack[this.stack.length-1];qe.label=Re,qe.identifier=fu(this.sliceSerialize(fe)).toLowerCase(),this.data.referenceType="full"}function ne(fe){this.data.characterReferenceType=fe.type}function Oe(fe){const Re=this.sliceSerialize(fe),qe=this.data.characterReferenceType;let xt;qe?(xt=rR(Re,qe==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):xt=Qw(Re);const Dt=this.stack[this.stack.length-1];Dt.value+=xt}function at(fe){const Re=this.stack.pop();Re.position.end=oa(fe.end)}function ae(fe){_.call(this,fe);const Re=this.stack[this.stack.length-1];Re.url=this.sliceSerialize(fe)}function _e(fe){_.call(this,fe);const Re=this.stack[this.stack.length-1];Re.url="mailto:"+this.sliceSerialize(fe)}function le(){return{type:"blockquote",children:[]}}function Ce(){return{type:"code",lang:null,meta:null,value:""}}function Le(){return{type:"inlineCode",value:""}}function Ve(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function st(){return{type:"emphasis",children:[]}}function Be(){return{type:"heading",depth:0,children:[]}}function ht(){return{type:"break"}}function vt(){return{type:"html",value:""}}function te(){return{type:"image",title:null,url:"",alt:null}}function Z(){return{type:"link",title:null,url:"",children:[]}}function ie(fe){return{type:"list",ordered:fe.type==="listOrdered",start:null,spread:fe._spread,children:[]}}function he(fe){return{type:"listItem",spread:fe._spread,checked:null,children:[]}}function se(){return{type:"paragraph",children:[]}}function Q(){return{type:"strong",children:[]}}function ke(){return{type:"text",value:""}}function Me(){return{type:"thematicBreak"}}}function oa(t){return{line:t.line,column:t.column,offset:t.offset}}function pR(t,e){let n=-1;for(;++n<e.length;){const r=e[n];Array.isArray(r)?pR(t,r):tZ(t,r)}}function tZ(t,e){let n;for(n in e)if(hR.call(e,n))switch(n){case"canContainEols":{const r=e[n];r&&t[n].push(...r);break}case"transforms":{const r=e[n];r&&t[n].push(...r);break}case"enter":case"exit":{const r=e[n];r&&Object.assign(t[n],r);break}}}function PC(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+Vd({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+Vd({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+Vd({start:e.start,end:e.end})+") is still open")}function nZ(t){const e=this;e.parser=n;function n(r){return ZQ(r,{...e.data("settings"),...t,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function rZ(t,e){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(e),!0)};return t.patch(e,n),t.applyData(e,n)}function sZ(t,e){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(e,n),[t.applyData(e,n),{type:"text",value:`
`}]}function iZ(t,e){const n=e.value?e.value+`
`:"",r={},s=e.lang?e.lang.split(/\s+/):[];s.length>0&&(r.className=["language-"+s[0]]);let i={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]};return e.meta&&(i.data={meta:e.meta}),t.patch(e,i),i=t.applyData(e,i),i={type:"element",tagName:"pre",properties:{},children:[i]},t.patch(e,i),i}function oZ(t,e){const n={type:"element",tagName:"del",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function aZ(t,e){const n={type:"element",tagName:"em",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function lZ(t,e){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",r=String(e.identifier).toUpperCase(),s=Uu(r.toLowerCase()),i=t.footnoteOrder.indexOf(r);let o,a=t.footnoteCounts.get(r);a===void 0?(a=0,t.footnoteOrder.push(r),o=t.footnoteOrder.length):o=i+1,a+=1,t.footnoteCounts.set(r,a);const l={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+s,id:n+"fnref-"+s+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};t.patch(e,l);const u={type:"element",tagName:"sup",properties:{},children:[l]};return t.patch(e,u),t.applyData(e,u)}function cZ(t,e){const n={type:"element",tagName:"h"+e.depth,properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function uZ(t,e){if(t.options.allowDangerousHtml){const n={type:"raw",value:e.value};return t.patch(e,n),t.applyData(e,n)}}function mR(t,e){const n=e.referenceType;let r="]";if(n==="collapsed"?r+="[]":n==="full"&&(r+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+r}];const s=t.all(e),i=s[0];i&&i.type==="text"?i.value="["+i.value:s.unshift({type:"text",value:"["});const o=s[s.length-1];return o&&o.type==="text"?o.value+=r:s.push({type:"text",value:r}),s}function dZ(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return mR(t,e);const s={src:Uu(r.url||""),alt:e.alt};r.title!==null&&r.title!==void 0&&(s.title=r.title);const i={type:"element",tagName:"img",properties:s,children:[]};return t.patch(e,i),t.applyData(e,i)}function fZ(t,e){const n={src:Uu(e.url)};e.alt!==null&&e.alt!==void 0&&(n.alt=e.alt),e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"img",properties:n,children:[]};return t.patch(e,r),t.applyData(e,r)}function hZ(t,e){const n={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};t.patch(e,n);const r={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(e,r),t.applyData(e,r)}function pZ(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return mR(t,e);const s={href:Uu(r.url||"")};r.title!==null&&r.title!==void 0&&(s.title=r.title);const i={type:"element",tagName:"a",properties:s,children:t.all(e)};return t.patch(e,i),t.applyData(e,i)}function mZ(t,e){const n={href:Uu(e.url)};e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"a",properties:n,children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function gZ(t,e,n){const r=t.all(e),s=n?yZ(n):gR(e),i={},o=[];if(typeof e.checked=="boolean"){const d=r[0];let f;d&&d.type==="element"&&d.tagName==="p"?f=d:(f={type:"element",tagName:"p",properties:{},children:[]},r.unshift(f)),f.children.length>0&&f.children.unshift({type:"text",value:" "}),f.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),i.className=["task-list-item"]}let a=-1;for(;++a<r.length;){const d=r[a];(s||a!==0||d.type!=="element"||d.tagName!=="p")&&o.push({type:"text",value:`
`}),d.type==="element"&&d.tagName==="p"&&!s?o.push(...d.children):o.push(d)}const l=r[r.length-1];l&&(s||l.type!=="element"||l.tagName!=="p")&&o.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:i,children:o};return t.patch(e,u),t.applyData(e,u)}function yZ(t){let e=!1;if(t.type==="list"){e=t.spread||!1;const n=t.children;let r=-1;for(;!e&&++r<n.length;)e=gR(n[r])}return e}function gR(t){const e=t.spread;return e??t.children.length>1}function xZ(t,e){const n={},r=t.all(e);let s=-1;for(typeof e.start=="number"&&e.start!==1&&(n.start=e.start);++s<r.length;){const o=r[s];if(o.type==="element"&&o.tagName==="li"&&o.properties&&Array.isArray(o.properties.className)&&o.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const i={type:"element",tagName:e.ordered?"ol":"ul",properties:n,children:t.wrap(r,!0)};return t.patch(e,i),t.applyData(e,i)}function bZ(t,e){const n={type:"element",tagName:"p",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function vZ(t,e){const n={type:"root",children:t.wrap(t.all(e))};return t.patch(e,n),t.applyData(e,n)}function wZ(t,e){const n={type:"element",tagName:"strong",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function kZ(t,e){const n=t.all(e),r=n.shift(),s=[];if(r){const o={type:"element",tagName:"thead",properties:{},children:t.wrap([r],!0)};t.patch(e.children[0],o),s.push(o)}if(n.length>0){const o={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},a=qw(e.children[1]),l=J5(e.children[e.children.length-1]);a&&l&&(o.position={start:a,end:l}),s.push(o)}const i={type:"element",tagName:"table",properties:{},children:t.wrap(s,!0)};return t.patch(e,i),t.applyData(e,i)}function SZ(t,e,n){const r=n?n.children:void 0,i=(r?r.indexOf(e):1)===0?"th":"td",o=n&&n.type==="table"?n.align:void 0,a=o?o.length:e.children.length;let l=-1;const u=[];for(;++l<a;){const f=e.children[l],h={},p=o?o[l]:void 0;p&&(h.align=p);let m={type:"element",tagName:i,properties:h,children:[]};f&&(m.children=t.all(f),t.patch(f,m),m=t.applyData(f,m)),u.push(m)}const d={type:"element",tagName:"tr",properties:{},children:t.wrap(u,!0)};return t.patch(e,d),t.applyData(e,d)}function _Z(t,e){const n={type:"element",tagName:"td",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}const LC=9,$C=32;function TZ(t){const e=String(t),n=/\r?\n|\r/g;let r=n.exec(e),s=0;const i=[];for(;r;)i.push(zC(e.slice(s,r.index),s>0,!0),r[0]),s=r.index+r[0].length,r=n.exec(e);return i.push(zC(e.slice(s),s>0,!1)),i.join("")}function zC(t,e,n){let r=0,s=t.length;if(e){let i=t.codePointAt(r);for(;i===LC||i===$C;)r++,i=t.codePointAt(r)}if(n){let i=t.codePointAt(s-1);for(;i===LC||i===$C;)s--,i=t.codePointAt(s-1)}return s>r?t.slice(r,s):""}function CZ(t,e){const n={type:"text",value:TZ(String(e.value))};return t.patch(e,n),t.applyData(e,n)}function EZ(t,e){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(e,n),t.applyData(e,n)}const NZ={blockquote:rZ,break:sZ,code:iZ,delete:oZ,emphasis:aZ,footnoteReference:lZ,heading:cZ,html:uZ,imageReference:dZ,image:fZ,inlineCode:hZ,linkReference:pZ,link:mZ,listItem:gZ,list:xZ,paragraph:bZ,root:vZ,strong:wZ,table:kZ,tableCell:_Z,tableRow:SZ,text:CZ,thematicBreak:EZ,toml:Gh,yaml:Gh,definition:Gh,footnoteDefinition:Gh};function Gh(){}const yR=-1,n0=0,Kd=1,ig=2,tk=3,nk=4,rk=5,sk=6,xR=7,bR=8,FC=typeof self=="object"?self:globalThis,jZ=(t,e)=>{const n=(s,i)=>(t.set(i,s),s),r=s=>{if(t.has(s))return t.get(s);const[i,o]=e[s];switch(i){case n0:case yR:return n(o,s);case Kd:{const a=n([],s);for(const l of o)a.push(r(l));return a}case ig:{const a=n({},s);for(const[l,u]of o)a[r(l)]=r(u);return a}case tk:return n(new Date(o),s);case nk:{const{source:a,flags:l}=o;return n(new RegExp(a,l),s)}case rk:{const a=n(new Map,s);for(const[l,u]of o)a.set(r(l),r(u));return a}case sk:{const a=n(new Set,s);for(const l of o)a.add(r(l));return a}case xR:{const{name:a,message:l}=o;return n(new FC[a](l),s)}case bR:return n(BigInt(o),s);case"BigInt":return n(Object(BigInt(o)),s);case"ArrayBuffer":return n(new Uint8Array(o).buffer,o);case"DataView":{const{buffer:a}=new Uint8Array(o);return n(new DataView(a),o)}}return n(new FC[i](o),s)};return r},BC=t=>jZ(new Map,t)(0),vc="",{toString:IZ}={},{keys:MZ}=Object,sd=t=>{const e=typeof t;if(e!=="object"||!t)return[n0,e];const n=IZ.call(t).slice(8,-1);switch(n){case"Array":return[Kd,vc];case"Object":return[ig,vc];case"Date":return[tk,vc];case"RegExp":return[nk,vc];case"Map":return[rk,vc];case"Set":return[sk,vc];case"DataView":return[Kd,n]}return n.includes("Array")?[Kd,n]:n.includes("Error")?[xR,n]:[ig,n]},qh=([t,e])=>t===n0&&(e==="function"||e==="symbol"),DZ=(t,e,n,r)=>{const s=(o,a)=>{const l=r.push(o)-1;return n.set(a,l),l},i=o=>{if(n.has(o))return n.get(o);let[a,l]=sd(o);switch(a){case n0:{let d=o;switch(l){case"bigint":a=bR,d=o.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+l);d=null;break;case"undefined":return s([yR],o)}return s([a,d],o)}case Kd:{if(l){let h=o;return l==="DataView"?h=new Uint8Array(o.buffer):l==="ArrayBuffer"&&(h=new Uint8Array(o)),s([l,[...h]],o)}const d=[],f=s([a,d],o);for(const h of o)d.push(i(h));return f}case ig:{if(l)switch(l){case"BigInt":return s([l,o.toString()],o);case"Boolean":case"Number":case"String":return s([l,o.valueOf()],o)}if(e&&"toJSON"in o)return i(o.toJSON());const d=[],f=s([a,d],o);for(const h of MZ(o))(t||!qh(sd(o[h])))&&d.push([i(h),i(o[h])]);return f}case tk:return s([a,o.toISOString()],o);case nk:{const{source:d,flags:f}=o;return s([a,{source:d,flags:f}],o)}case rk:{const d=[],f=s([a,d],o);for(const[h,p]of o)(t||!(qh(sd(h))||qh(sd(p))))&&d.push([i(h),i(p)]);return f}case sk:{const d=[],f=s([a,d],o);for(const h of o)(t||!qh(sd(h)))&&d.push(i(h));return f}}const{message:u}=o;return s([a,{name:l,message:u}],o)};return i},UC=(t,{json:e,lossy:n}={})=>{const r=[];return DZ(!(e||n),!!e,new Map,r)(t),r},og=typeof structuredClone=="function"?(t,e)=>e&&("json"in e||"lossy"in e)?BC(UC(t,e)):structuredClone(t):(t,e)=>BC(UC(t,e));function AZ(t,e){const n=[{type:"text",value:""}];return e>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),n}function RZ(t,e){return"Back to reference "+(t+1)+(e>1?"-"+e:"")}function OZ(t){const e=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||AZ,r=t.options.footnoteBackLabel||RZ,s=t.options.footnoteLabel||"Footnotes",i=t.options.footnoteLabelTagName||"h2",o=t.options.footnoteLabelProperties||{className:["sr-only"]},a=[];let l=-1;for(;++l<t.footnoteOrder.length;){const u=t.footnoteById.get(t.footnoteOrder[l]);if(!u)continue;const d=t.all(u),f=String(u.identifier).toUpperCase(),h=Uu(f.toLowerCase());let p=0;const m=[],y=t.footnoteCounts.get(f);for(;y!==void 0&&++p<=y;){m.length>0&&m.push({type:"text",value:" "});let v=typeof n=="string"?n:n(l,p);typeof v=="string"&&(v={type:"text",value:v}),m.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+h+(p>1?"-"+p:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(l,p),className:["data-footnote-backref"]},children:Array.isArray(v)?v:[v]})}const b=d[d.length-1];if(b&&b.type==="element"&&b.tagName==="p"){const v=b.children[b.children.length-1];v&&v.type==="text"?v.value+=" ":b.children.push({type:"text",value:" "}),b.children.push(...m)}else d.push(...m);const g={type:"element",tagName:"li",properties:{id:e+"fn-"+h},children:t.wrap(d,!0)};t.patch(u,g),a.push(g)}if(a.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:i,properties:{...og(o),id:"footnote-label"},children:[{type:"text",value:s}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(a,!0)},{type:"text",value:`
`}]}}const vR=function(t){if(t==null)return zZ;if(typeof t=="function")return r0(t);if(typeof t=="object")return Array.isArray(t)?PZ(t):LZ(t);if(typeof t=="string")return $Z(t);throw new Error("Expected function, string, or object as test")};function PZ(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=vR(t[n]);return r0(r);function r(...s){let i=-1;for(;++i<e.length;)if(e[i].apply(this,s))return!0;return!1}}function LZ(t){const e=t;return r0(n);function n(r){const s=r;let i;for(i in t)if(s[i]!==e[i])return!1;return!0}}function $Z(t){return r0(e);function e(n){return n&&n.type===t}}function r0(t){return e;function e(n,r,s){return!!(FZ(n)&&t.call(this,n,typeof r=="number"?r:void 0,s||void 0))}}function zZ(){return!0}function FZ(t){return t!==null&&typeof t=="object"&&"type"in t}const wR=[],BZ=!0,HC=!1,UZ="skip";function HZ(t,e,n,r){let s;typeof e=="function"&&typeof n!="function"?(r=n,n=e):s=e;const i=vR(s),o=r?-1:1;a(t,void 0,[])();function a(l,u,d){const f=l&&typeof l=="object"?l:{};if(typeof f.type=="string"){const p=typeof f.tagName=="string"?f.tagName:typeof f.name=="string"?f.name:void 0;Object.defineProperty(h,"name",{value:"node ("+(l.type+(p?"<"+p+">":""))+")"})}return h;function h(){let p=wR,m,y,b;if((!e||i(l,u,d[d.length-1]||void 0))&&(p=VZ(n(l,d)),p[0]===HC))return p;if("children"in l&&l.children){const g=l;if(g.children&&p[0]!==UZ)for(y=(r?g.children.length:-1)+o,b=d.concat(g);y>-1&&y<g.children.length;){const v=g.children[y];if(m=a(v,y,b)(),m[0]===HC)return m;y=typeof m[1]=="number"?m[1]:y+o}}return p}}}function VZ(t){return Array.isArray(t)?t:typeof t=="number"?[BZ,t]:t==null?wR:[t]}function kR(t,e,n,r){let s,i,o;typeof e=="function"&&typeof n!="function"?(i=void 0,o=e,s=n):(i=e,o=n,s=r),HZ(t,i,a,s);function a(l,u){const d=u[u.length-1],f=d?d.children.indexOf(l):void 0;return o(l,f,d)}}const pb={}.hasOwnProperty,WZ={};function KZ(t,e){const n=e||WZ,r=new Map,s=new Map,i=new Map,o={...NZ,...n.handlers},a={all:u,applyData:qZ,definitionById:r,footnoteById:s,footnoteCounts:i,footnoteOrder:[],handlers:o,one:l,options:n,patch:GZ,wrap:JZ};return kR(t,function(d){if(d.type==="definition"||d.type==="footnoteDefinition"){const f=d.type==="definition"?r:s,h=String(d.identifier).toUpperCase();f.has(h)||f.set(h,d)}}),a;function l(d,f){const h=d.type,p=a.handlers[h];if(pb.call(a.handlers,h)&&p)return p(a,d,f);if(a.options.passThrough&&a.options.passThrough.includes(h)){if("children"in d){const{children:y,...b}=d,g=og(b);return g.children=a.all(d),g}return og(d)}return(a.options.unknownHandler||YZ)(a,d,f)}function u(d){const f=[];if("children"in d){const h=d.children;let p=-1;for(;++p<h.length;){const m=a.one(h[p],d);if(m){if(p&&h[p-1].type==="break"&&(!Array.isArray(m)&&m.type==="text"&&(m.value=VC(m.value)),!Array.isArray(m)&&m.type==="element")){const y=m.children[0];y&&y.type==="text"&&(y.value=VC(y.value))}Array.isArray(m)?f.push(...m):f.push(m)}}}return f}}function GZ(t,e){t.position&&(e.position=IJ(t))}function qZ(t,e){let n=e;if(t&&t.data){const r=t.data.hName,s=t.data.hChildren,i=t.data.hProperties;if(typeof r=="string")if(n.type==="element")n.tagName=r;else{const o="children"in n?n.children:[n];n={type:"element",tagName:r,properties:{},children:o}}n.type==="element"&&i&&Object.assign(n.properties,og(i)),"children"in n&&n.children&&s!==null&&s!==void 0&&(n.children=s)}return n}function YZ(t,e){const n=e.data||{},r="value"in e&&!(pb.call(n,"hProperties")||pb.call(n,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function JZ(t,e){const n=[];let r=-1;for(e&&n.push({type:"text",value:`
`});++r<t.length;)r&&n.push({type:"text",value:`
`}),n.push(t[r]);return e&&t.length>0&&n.push({type:"text",value:`
`}),n}function VC(t){let e=0,n=t.charCodeAt(e);for(;n===9||n===32;)e++,n=t.charCodeAt(e);return t.slice(e)}function WC(t,e){const n=KZ(t,e),r=n.one(t,void 0),s=OZ(n),i=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return s&&i.children.push({type:"text",value:`
`},s),i}function XZ(t,e){return t&&"run"in t?async function(n,r){const s=WC(n,{file:r,...e});await t.run(s,r)}:function(n,r){return WC(n,{file:r,...t||e})}}function KC(t){if(t)throw t}var Mp=Object.prototype.hasOwnProperty,SR=Object.prototype.toString,GC=Object.defineProperty,qC=Object.getOwnPropertyDescriptor,YC=function(e){return typeof Array.isArray=="function"?Array.isArray(e):SR.call(e)==="[object Array]"},JC=function(e){if(!e||SR.call(e)!=="[object Object]")return!1;var n=Mp.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&Mp.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!r)return!1;var s;for(s in e);return typeof s>"u"||Mp.call(e,s)},XC=function(e,n){GC&&n.name==="__proto__"?GC(e,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):e[n.name]=n.newValue},QC=function(e,n){if(n==="__proto__")if(Mp.call(e,n)){if(qC)return qC(e,n).value}else return;return e[n]},QZ=function t(){var e,n,r,s,i,o,a=arguments[0],l=1,u=arguments.length,d=!1;for(typeof a=="boolean"&&(d=a,a=arguments[1]||{},l=2),(a==null||typeof a!="object"&&typeof a!="function")&&(a={});l<u;++l)if(e=arguments[l],e!=null)for(n in e)r=QC(a,n),s=QC(e,n),a!==s&&(d&&s&&(JC(s)||(i=YC(s)))?(i?(i=!1,o=r&&YC(r)?r:[]):o=r&&JC(r)?r:{},XC(a,{name:n,newValue:t(d,o,s)})):typeof s<"u"&&XC(a,{name:n,newValue:s}));return a};const Py=cg(QZ);function mb(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function ZZ(){const t=[],e={run:n,use:r};return e;function n(...s){let i=-1;const o=s.pop();if(typeof o!="function")throw new TypeError("Expected function as last argument, not "+o);a(null,...s);function a(l,...u){const d=t[++i];let f=-1;if(l){o(l);return}for(;++f<s.length;)(u[f]===null||u[f]===void 0)&&(u[f]=s[f]);s=u,d?eee(d,a)(...u):o(null,...u)}}function r(s){if(typeof s!="function")throw new TypeError("Expected `middelware` to be a function, not "+s);return t.push(s),e}}function eee(t,e){let n;return r;function r(...o){const a=t.length>o.length;let l;a&&o.push(s);try{l=t.apply(this,o)}catch(u){const d=u;if(a&&n)throw d;return s(d)}a||(l&&l.then&&typeof l.then=="function"?l.then(i,s):l instanceof Error?s(l):i(l))}function s(o,...a){n||(n=!0,e(o,...a))}function i(o){s(null,o)}}const oo={basename:tee,dirname:nee,extname:ree,join:see,sep:"/"};function tee(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');ah(t);let n=0,r=-1,s=t.length,i;if(e===void 0||e.length===0||e.length>t.length){for(;s--;)if(t.codePointAt(s)===47){if(i){n=s+1;break}}else r<0&&(i=!0,r=s+1);return r<0?"":t.slice(n,r)}if(e===t)return"";let o=-1,a=e.length-1;for(;s--;)if(t.codePointAt(s)===47){if(i){n=s+1;break}}else o<0&&(i=!0,o=s+1),a>-1&&(t.codePointAt(s)===e.codePointAt(a--)?a<0&&(r=s):(a=-1,r=o));return n===r?r=o:r<0&&(r=t.length),t.slice(n,r)}function nee(t){if(ah(t),t.length===0)return".";let e=-1,n=t.length,r;for(;--n;)if(t.codePointAt(n)===47){if(r){e=n;break}}else r||(r=!0);return e<0?t.codePointAt(0)===47?"/":".":e===1&&t.codePointAt(0)===47?"//":t.slice(0,e)}function ree(t){ah(t);let e=t.length,n=-1,r=0,s=-1,i=0,o;for(;e--;){const a=t.codePointAt(e);if(a===47){if(o){r=e+1;break}continue}n<0&&(o=!0,n=e+1),a===46?s<0?s=e:i!==1&&(i=1):s>-1&&(i=-1)}return s<0||n<0||i===0||i===1&&s===n-1&&s===r+1?"":t.slice(s,n)}function see(...t){let e=-1,n;for(;++e<t.length;)ah(t[e]),t[e]&&(n=n===void 0?t[e]:n+"/"+t[e]);return n===void 0?".":iee(n)}function iee(t){ah(t);const e=t.codePointAt(0)===47;let n=oee(t,!e);return n.length===0&&!e&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),e?"/"+n:n}function oee(t,e){let n="",r=0,s=-1,i=0,o=-1,a,l;for(;++o<=t.length;){if(o<t.length)a=t.codePointAt(o);else{if(a===47)break;a=47}if(a===47){if(!(s===o-1||i===1))if(s!==o-1&&i===2){if(n.length<2||r!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(l=n.lastIndexOf("/"),l!==n.length-1){l<0?(n="",r=0):(n=n.slice(0,l),r=n.length-1-n.lastIndexOf("/")),s=o,i=0;continue}}else if(n.length>0){n="",r=0,s=o,i=0;continue}}e&&(n=n.length>0?n+"/..":"..",r=2)}else n.length>0?n+="/"+t.slice(s+1,o):n=t.slice(s+1,o),r=o-s-1;s=o,i=0}else a===46&&i>-1?i++:i=-1}return n}function ah(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const aee={cwd:lee};function lee(){return"/"}function gb(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function cee(t){if(typeof t=="string")t=new URL(t);else if(!gb(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(t.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return uee(t)}function uee(t){if(t.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=t.pathname;let n=-1;for(;++n<e.length;)if(e.codePointAt(n)===37&&e.codePointAt(n+1)===50){const r=e.codePointAt(n+2);if(r===70||r===102){const s=new TypeError("File URL path must not include encoded / characters");throw s.code="ERR_INVALID_FILE_URL_PATH",s}}return decodeURIComponent(e)}const Ly=["history","path","basename","stem","extname","dirname"];class _R{constructor(e){let n;e?gb(e)?n={path:e}:typeof e=="string"||dee(e)?n={value:e}:n=e:n={},this.cwd="cwd"in n?"":aee.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<Ly.length;){const i=Ly[r];i in n&&n[i]!==void 0&&n[i]!==null&&(this[i]=i==="history"?[...n[i]]:n[i])}let s;for(s in n)Ly.includes(s)||(this[s]=n[s])}get basename(){return typeof this.path=="string"?oo.basename(this.path):void 0}set basename(e){zy(e,"basename"),$y(e,"basename"),this.path=oo.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?oo.dirname(this.path):void 0}set dirname(e){ZC(this.basename,"dirname"),this.path=oo.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?oo.extname(this.path):void 0}set extname(e){if($y(e,"extname"),ZC(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=oo.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){gb(e)&&(e=cee(e)),zy(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?oo.basename(this.path,this.extname):void 0}set stem(e){zy(e,"stem"),$y(e,"stem"),this.path=oo.join(this.dirname||"",e+(this.extname||""))}fail(e,n,r){const s=this.message(e,n,r);throw s.fatal=!0,s}info(e,n,r){const s=this.message(e,n,r);return s.fatal=void 0,s}message(e,n,r){const s=new xs(e,n,r);return this.path&&(s.name=this.path+":"+s.name,s.file=this.path),s.fatal=!1,this.messages.push(s),s}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function $y(t,e){if(t&&t.includes(oo.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+oo.sep+"`")}function zy(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function ZC(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}function dee(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const fee=function(t){const r=this.constructor.prototype,s=r[t],i=function(){return s.apply(i,arguments)};return Object.setPrototypeOf(i,r),i},hee={}.hasOwnProperty;class ik extends fee{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=ZZ()}copy(){const e=new ik;let n=-1;for(;++n<this.attachers.length;){const r=this.attachers[n];e.use(...r)}return e.data(Py(!0,{},this.namespace)),e}data(e,n){return typeof e=="string"?arguments.length===2?(Uy("data",this.frozen),this.namespace[e]=n,this):hee.call(this.namespace,e)&&this.namespace[e]||void 0:e?(Uy("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const s=n.call(e,...r);typeof s=="function"&&this.transformers.use(s)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=Yh(e),r=this.parser||this.Parser;return Fy("parse",r),r(String(n),n)}process(e,n){const r=this;return this.freeze(),Fy("process",this.parser||this.Parser),By("process",this.compiler||this.Compiler),n?s(void 0,n):new Promise(s);function s(i,o){const a=Yh(e),l=r.parse(a);r.run(l,a,function(d,f,h){if(d||!f||!h)return u(d);const p=f,m=r.stringify(p,h);gee(m)?h.value=m:h.result=m,u(d,h)});function u(d,f){d||!f?o(d):i?i(f):n(void 0,f)}}}processSync(e){let n=!1,r;return this.freeze(),Fy("processSync",this.parser||this.Parser),By("processSync",this.compiler||this.Compiler),this.process(e,s),tE("processSync","process",n),r;function s(i,o){n=!0,KC(i),r=o}}run(e,n,r){eE(e),this.freeze();const s=this.transformers;return!r&&typeof n=="function"&&(r=n,n=void 0),r?i(void 0,r):new Promise(i);function i(o,a){const l=Yh(n);s.run(e,l,u);function u(d,f,h){const p=f||e;d?a(d):o?o(p):r(void 0,p,h)}}}runSync(e,n){let r=!1,s;return this.run(e,n,i),tE("runSync","run",r),s;function i(o,a){KC(o),s=a,r=!0}}stringify(e,n){this.freeze();const r=Yh(n),s=this.compiler||this.Compiler;return By("stringify",s),eE(e),s(e,r)}use(e,...n){const r=this.attachers,s=this.namespace;if(Uy("use",this.frozen),e!=null)if(typeof e=="function")l(e,n);else if(typeof e=="object")Array.isArray(e)?a(e):o(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function i(u){if(typeof u=="function")l(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[d,...f]=u;l(d,f)}else o(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function o(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(u.plugins),u.settings&&(s.settings=Py(!0,s.settings,u.settings))}function a(u){let d=-1;if(u!=null)if(Array.isArray(u))for(;++d<u.length;){const f=u[d];i(f)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function l(u,d){let f=-1,h=-1;for(;++f<r.length;)if(r[f][0]===u){h=f;break}if(h===-1)r.push([u,...d]);else if(d.length>0){let[p,...m]=d;const y=r[h][1];mb(y)&&mb(p)&&(p=Py(!0,y,p)),r[h]=[u,p,...m]}}}}const pee=new ik().freeze();function Fy(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function By(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function Uy(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function eE(t){if(!mb(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function tE(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function Yh(t){return mee(t)?t:new _R(t)}function mee(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function gee(t){return typeof t=="string"||yee(t)}function yee(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const xee="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",nE=[],rE={allowDangerousHtml:!0},bee=/^(https?|ircs?|mailto|xmpp)$/i,vee=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function ok(t){const e=wee(t),n=kee(t);return See(e.runSync(e.parse(n),n),t)}function wee(t){const e=t.rehypePlugins||nE,n=t.remarkPlugins||nE,r=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...rE}:rE;return pee().use(nZ).use(n).use(XZ,r).use(e)}function kee(t){const e=t.children||"",n=new _R;return typeof e=="string"&&(n.value=e),n}function See(t,e){const n=e.allowedElements,r=e.allowElement,s=e.components,i=e.disallowedElements,o=e.skipHtml,a=e.unwrapDisallowed,l=e.urlTransform||_ee;for(const d of vee)Object.hasOwn(e,d.from)&&(""+d.from+(d.to?"use `"+d.to+"` instead":"remove it")+xee+d.id,void 0);return kR(t,u),OJ(t,{Fragment:c.Fragment,components:s,ignoreInvalidStyle:!0,jsx:c.jsx,jsxs:c.jsxs,passKeys:!0,passNode:!0});function u(d,f,h){if(d.type==="raw"&&h&&typeof f=="number")return o?h.children.splice(f,1):h.children[f]={type:"text",value:d.value},f;if(d.type==="element"){let p;for(p in Ay)if(Object.hasOwn(Ay,p)&&Object.hasOwn(d.properties,p)){const m=d.properties[p],y=Ay[p];(y===null||y.includes(d.tagName))&&(d.properties[p]=l(String(m||""),p,d))}}if(d.type==="element"){let p=n?!n.includes(d.tagName):i?i.includes(d.tagName):!1;if(!p&&r&&typeof f=="number"&&(p=!r(d,f,h)),p&&h&&typeof f=="number")return a&&d.children?h.children.splice(f,1,...d.children):h.children.splice(f,1),f}}}function _ee(t){const e=t.indexOf(":"),n=t.indexOf("?"),r=t.indexOf("#"),s=t.indexOf("/");return e===-1||s!==-1&&e>s||n!==-1&&e>n||r!==-1&&e>r||bee.test(t.slice(0,e))?t:""}const Tee=[{label:"",value:null},{label:"",value:0},{label:"5 ",value:5},{label:"15 ",value:15},{label:"30 ",value:30},{label:"1 ",value:60},{label:"2 ",value:120},{label:"1 ",value:1440}],Cee=({value:t,onChange:e})=>{const[n,r]=x.useState(!1),[s,i]=x.useState(""),[o,a]=x.useState("minutes"),l=()=>t==null?"":t===0?"":t<60?`${t} `:t<1440?`${t/60} `:`${t/1440} `,u=()=>{const f=parseInt(s);if(isNaN(f)||f<=0)return;let h=f;o==="hours"&&(h=f*60),o==="days"&&(h=f*1440),e(h),r(!1),i("")},d=t!=null;return c.jsxs("div",{className:"relative",children:[c.jsxs("button",{type:"button",onClick:()=>r(!n),className:`flex items-center gap-1.5 px-2 py-1 rounded-lg text-xs transition-colors ${d?"bg-orange-100 text-orange-600 hover:bg-orange-200":"bg-gray-100 text-gray-500 hover:bg-gray-200"}`,title:"",children:[d?c.jsx(Wa,{size:12}):c.jsx(t1,{size:12}),c.jsx("span",{children:l()}),c.jsx(ts,{size:10})]}),n&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>r(!1)}),c.jsxs("div",{className:"absolute left-0 top-full mt-1 w-48 bg-white rounded-lg shadow-xl border border-gray-200 z-50 overflow-hidden",children:[Tee.map(f=>c.jsxs("button",{type:"button",onClick:()=>{e(f.value),r(!1)},className:`w-full px-3 py-2 text-left text-sm hover:bg-orange-50 transition-colors flex items-center gap-2 ${t===f.value?"bg-orange-100 text-orange-700 font-medium":"text-gray-700"}`,children:[f.value===null?c.jsx(t1,{size:12}):c.jsx(Wa,{size:12}),f.label]},f.value??"null")),c.jsxs("div",{className:"border-t border-gray-100 p-2",children:[c.jsx("div",{className:"text-[10px] text-gray-400 mb-1.5",children:""}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("input",{type:"number",value:s,onChange:f=>i(f.target.value),placeholder:"",className:"flex-1 px-2 py-1 text-xs border rounded w-14",min:1}),c.jsxs("select",{value:o,onChange:f=>a(f.target.value),className:"px-1 py-1 text-xs border rounded",children:[c.jsx("option",{value:"minutes",children:""}),c.jsx("option",{value:"hours",children:""}),c.jsx("option",{value:"days",children:""})]}),c.jsx("button",{type:"button",onClick:u,className:"px-2 py-1 text-xs bg-orange-500 text-white rounded hover:bg-orange-600",children:""})]})]}),d&&c.jsxs("button",{type:"button",onClick:()=>{e(null),r(!1)},className:"w-full px-3 py-2 text-left text-xs text-red-500 hover:bg-red-50 border-t border-gray-100 flex items-center gap-2",children:[c.jsx(un,{size:12}),""]})]})]})]})},sE=t=>{if(!t)return"";let e=t;e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/^### (.*$)/gm,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gm,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gm,"<h1>$1</h1>");const n=e.split(`
`);let r=!1,s=[];for(let i=0;i<n.length;i++){const o=n[i];if(/^[*-] /.test(o)||/^\d+\. /.test(o)){r||(s.push("<ul>"),r=!0);const l=o.replace(/^[*-] |^\d+\. /,"");s.push(`<li>${l}</li>`)}else r&&(s.push("</ul>"),r=!1),o.trim()===""||(o.startsWith("<h")?s.push(o):s.push(`<p>${o}</p>`))}return r&&s.push("</ul>"),s.join("")},iE=t=>{if(!t)return"";if(!t.includes("<")||!t.includes(">"))return t;let e=t;return e=e.replace(/<\/p>/gi,`
`),e=e.replace(/<br\s*\/?>/gi,`
`),e=e.replace(/<\/div>/gi,`
`),e=e.replace(/<[^>]+>/g,""),e=e.replace(/&nbsp;/g," "),e=e.replace(/&amp;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e.trim()},Eee="",Po=({initialData:t,onClose:e,isQuickAdd:n=!1,isEmbedded:r=!1,isReadOnly:s=!1})=>{var dk,fk,hk;const{addTask:i,updateTask:o,tags:a,tasks:l,addTag:u,deleteTag:d,setFocusedTaskId:f,themeSettings:h,toggleExpansion:p,setSelectedTaskIds:m,deleteTask:y,visibleTasks:b,user:g,setToast:v,t:w,navigateToTask:T}=x.useContext(En),[R,k]=x.useState((t==null?void 0:t.title)||""),[M,S]=x.useState((t==null?void 0:t.description)||""),[C,_]=x.useState((t==null?void 0:t.due_date)||null),[E,I]=x.useState((t==null?void 0:t.start_date)||null),[P,O]=x.useState((t==null?void 0:t.tags)||[]),[$,A]=x.useState((t==null?void 0:t.images)||[]),[j,W]=x.useState((t==null?void 0:t.attachments)||[]),[V,D]=x.useState(!1),[ge,me]=x.useState((t==null?void 0:t.parent_id)||null),[F,U]=x.useState([]),[ne,Oe]=x.useState((t==null?void 0:t.is_project)||!1),[at,ae]=x.useState((t==null?void 0:t.color)||"gray"),[_e,le]=x.useState((t==null?void 0:t.importance)||"unplanned"),[Ce,Le]=x.useState((t==null?void 0:t.is_all_day)!==void 0?t.is_all_day:!0),[Ve,st]=x.useState(()=>{if(t!=null&&t.start_time)return t.start_time;if(t!=null&&t.start_date&&!(t!=null&&t.is_all_day)){const N=new Date(t.start_date);return`${String(N.getHours()).padStart(2,"0")}:${String(N.getMinutes()).padStart(2,"0")}`}return"09:00"}),[Be,ht]=x.useState(()=>{if(t!=null&&t.end_time)return t.end_time;if(t!=null&&t.start_date&&!(t!=null&&t.is_all_day)){const N=new Date(t.start_date),K=typeof t.duration=="number"?t.duration:60;return N.setMinutes(N.getMinutes()+K),`${String(N.getHours()).padStart(2,"0")}:${String(N.getMinutes()).padStart(2,"0")}`}return"10:00"}),[vt,te]=x.useState((t==null?void 0:t.duration)||""),[Z,ie]=x.useState((t==null?void 0:t.repeat_rule)||null),[he,se]=x.useState(!1),[Q,ke]=x.useState(()=>{if(t!=null&&t.id)try{const N=localStorage.getItem(`task_reminder_${t.id}`);if(N!==null)return JSON.parse(N)}catch{}return(t==null?void 0:t.reminder_minutes)??null});x.useEffect(()=>{if(t!=null&&t.id)try{Q!==null?localStorage.setItem(`task_reminder_${t.id}`,JSON.stringify(Q)):localStorage.removeItem(`task_reminder_${t.id}`)}catch{}},[Q,t==null?void 0:t.id]);const[Me,fe]=x.useState(!1),[Re,qe]=x.useState(!1),[xt,Dt]=x.useState(!1),[oe,Ee]=x.useState(null),Ue=x.useRef(null),tt=x.useRef(null),Ne=x.useRef(null),pt=x.useRef(null),[dt,Et]=x.useState(null),ue=x.useRef(null),Se=x.useRef(null),[nt,ft]=x.useState(null),[ct,Qe]=x.useState(null),[It,Lt]=x.useState(null),[J,ye]=x.useState(null),[Ge,kt]=x.useState(null),[Y,ze]=x.useState(new Set),[lt,X]=x.useState(!1),[Fe,je]=x.useState(!1),[He,Ye]=x.useState(""),[ee,xe]=x.useState(!1),[Pe,et]=x.useState(!1),[_t,Vt]=x.useState(""),[Ft,nn]=x.useState(""),[Xt,Jt]=x.useState(0),[fn,yn]=x.useState(0),[_n,Fn]=x.useState(!1),[Hn,is]=x.useState({isOpen:!1,title:"",content:"",history:[],historyIndex:-1}),[Gs,ui]=x.useState(!1),[Nn,Oi]=x.useState(!1),[Zo,ea]=x.useState([]),{isRecording:di,startRecording:il,stopRecording:ol,recordingTaskId:Ir,recordingTime:Co}=x.useContext(Ru),al=N=>{const K=Math.floor(N/1e3),ce=Math.floor(K/60),we=K%60;return`${ce}:${we.toString().padStart(2,"0")}`},cc=async(N,K,ce)=>{if(console.log("TaskInput handleSaveAudio called with:",N.name,K,ce),!ve)return;const we=`${Date.now()}_${crypto.randomUUID()}.${N.name.split(".").pop()}`,yt=`${(g==null?void 0:g.id)||"anonymous"}/${we}`;try{const{error:Ot}=await ve.storage.from("attachments").upload(yt,N,{contentType:N.type,upsert:!1});if(Ot){console.error("Upload voice error:",Ot),v==null||v({msg:"",type:"error"});return}const{data:Zt}=ve.storage.from("attachments").getPublicUrl(yt);if(Zt){const tn={name:N.name,url:Zt.publicUrl,size:N.size,type:N.type,markers:K,recordingId:ce},cn=[...j,tn];W(cn),t&&o(t.id,{attachments:cn},[],{skipHistory:!0}),v==null||v({msg:"",type:"info"})}}catch(Ot){console.error(Ot),v==null||v({msg:"",type:"error"})}};x.useEffect(()=>{const N=K=>{const ce=K.detail;ce&&ce.taskId===(t==null?void 0:t.id)&&ce.attachment&&(console.log("[TaskInput] Recording saved event - updating local attachments state"),W(we=>we.some(yt=>yt.url===ce.attachment.url)?we:[...we,ce.attachment]))};return window.addEventListener("recording-saved",N),()=>window.removeEventListener("recording-saved",N)},[t==null?void 0:t.id]);const[jn,Pi]=x.useState((t==null?void 0:t.ai_history)||[]),[er,ta]=x.useState(t!=null&&t.ai_history?t.ai_history.length-1:-1),[ll,tr]=x.useState(""),[de,Mt]=x.useState(!1),[Ut,Ht]=x.useState(!1),[$t,rn]=x.useState(!1),[Dn,Bn]=x.useState(0),[zn,Rn]=x.useState((t==null?void 0:t.attachment_links)||[]),[hn,xr]=x.useState(!1),ar=x.useMemo(()=>{const N=a.find(K=>K.name.trim().toLowerCase()==="prompt");return N?l.filter(K=>K.tags.includes(N.id)&&K.status!=="deleted"&&K.status!=="logged").sort((K,ce)=>ce.created_at.localeCompare(K.created_at)):[]},[l,a]),js=x.useMemo(()=>{if(!Ft.trim())return ar;const N=Ft.toLowerCase();return ar.filter(K=>K.title.toLowerCase().includes(N)||K.description&&K.description.toLowerCase().includes(N))},[ar,Ft]),qs=x.useMemo(()=>ar.slice(0,5),[ar]);x.useEffect(()=>{if(!Ft.trim()){yn(0),Jt(0);return}let N=0;js.forEach(K=>{const ce=(K.title.match(new RegExp(Ft,"gi"))||[]).length,we=K.description?(K.description.match(new RegExp(Ft,"gi"))||[]).length:0;N+=ce+we}),yn(N),Jt(0)},[Ft,js]);const On=N=>{is(K=>{const ce={title:K.title,content:N},we=[...K.history.slice(0,K.historyIndex+1),ce];return{...K,content:N,history:we,historyIndex:we.length-1}})},nr=N=>{is(K=>{const ce={title:N,content:K.content},we=[...K.history.slice(0,K.historyIndex+1),ce];return{...K,title:N,history:we,historyIndex:we.length-1}})},Mr=()=>{is(N=>{if(N.historyIndex<=0)return N;const K=N.historyIndex-1;return{...N,title:N.history[K].title,content:N.history[K].content,historyIndex:K}})},z=()=>{is(N=>{if(N.historyIndex>=N.history.length-1)return N;const K=N.historyIndex+1;return{...N,title:N.history[K].title,content:N.history[K].content,historyIndex:K}})},H=t?!!t.completed_at:!1,L=x.useRef(null),G=x.useRef(null),B=x.useRef(null),q=x.useRef(null),pe=x.useRef(null),De=x.useRef(null),We=x.useRef(null),Je=x.useRef(null),[ot,Ct]=x.useState([]),[ut,bt]=x.useState(!1),[Xe,Te]=x.useState(-1);x.useEffect(()=>{const N=setTimeout(()=>{if(t&&!n&&!s){const K={};let ce=!1;if(R!==(t.title||"")&&(K.title=R,ce=!0),M!==(t.description||"")&&(K.description=M,ce=!0),Ve&&Ve!==(t.start_time||"")&&(K.start_time=Ve,ce=!0),Be&&Be!==(t.end_time||"")&&(K.end_time=Be,ce=!0),vt&&String(vt)!==String(t.duration||60)&&(K.duration=Number(vt),ce=!0),Ce!==(t.is_all_day??!0)&&(K.is_all_day=Ce,ce=!0),E&&E!==t.start_date&&(K.start_date=E,ce=!0),ce){if((K.start_time||K.start_date)&&!Ce){const we=K.start_date||E||t.start_date,mt=K.start_time||Ve||t.start_time||"00:00";if(we){const yt=new Date(we),[Ot,Zt]=mt.split(":").map(Number);!isNaN(Ot)&&!isNaN(Zt)&&(yt.setHours(Ot,Zt,0,0),K.start_date=yt.toISOString())}}o(t.id,K,[],{skipHistory:!0})}}},800);return()=>clearTimeout(N)},[R,M,Ve,Be,vt,E,Ce,t,o,n]),x.useEffect(()=>{const N=K=>{(K.metaKey||K.ctrlKey)&&K.shiftKey&&(K.key==="v"||K.key==="V")&&(K.preventDefault(),K.stopPropagation(),di?ol():il(t==null?void 0:t.id))};return window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N)},[di,il,ol,t==null?void 0:t.id]),x.useEffect(()=>{G.current},[M]),x.useEffect(()=>{if(!It||!ue.current)return;const N=()=>{const ce=ue.current;ce&&It&&(ce.chain().setTextSelection({from:It.from,to:It.to}).unsetHighlight().setTextSelection(ce.state.selection.to).run(),Lt(null))},K=setTimeout(()=>{document.addEventListener("click",N,{once:!0})},100);return()=>{clearTimeout(K),document.removeEventListener("click",N)}},[It]);const $e=x.useRef(t);x.useEffect(()=>{const N=$e.current;if(!t||!N){$e.current=t;return}t.id!==N.id?(k(t.title||""),S(t.description||""),I(t.start_date||""),st(t.start_time||""),ht(t.end_time||""),te(t.duration||60),Le(t.is_all_day??!0),O(t.tags||[]),A(t.images||[]),me(t.parent_id||null),Oe(t.is_project||!1),ae(t.color||"gray"),le(t.importance||"unplanned")):(t.title!==N.title&&k(t.title||""),t.description!==N.description&&S(t.description||""),t.start_date!==N.start_date&&I(t.start_date||""),t.start_time!==N.start_time&&st(t.start_time||""),t.end_time!==N.end_time&&ht(t.end_time||""),t.duration!==N.duration&&te(t.duration||60),t.is_all_day!==N.is_all_day&&Le(t.is_all_day??!0),JSON.stringify(t.tags)!==JSON.stringify(N.tags)&&O(t.tags||[])),$e.current=t},[t]);const be=async N=>{let K;if(nt&&ue.current?K=ue.current.state.doc.textBetween(nt.from,nt.to," "):ue.current?K=ue.current.getText():K=M.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),!K||!K.trim()){v==null||v({msg:"Please enter or select some content first.",type:"error"});return}X(!0),et(!1),Ht(!0);try{if(_n&&_t.trim()){let Ot=a.find(tn=>tn.name.trim().toLowerCase()==="prompt"),Zt=Ot==null?void 0:Ot.id;if(Zt||(Zt=await u("prompt")||void 0),Zt){const tn=await U5(_t);await i({title:tn,description:_t,tags:[Zt],status:"active"})}}const we=await B5(K,nt?"":R,N),mt={id:crypto.randomUUID(),role:"assistant",content:we.fullResponse,created_at:new Date().toISOString(),prompt:N||"AI Analysis",model:"gemini"},yt=[...jn,mt];Pi(yt),ta(yt.length-1),tr(we.fullResponse),Mt(!1),Vt(""),t&&o(t.id,{ai_history:yt},[],{skipHistory:!0})}catch(ce){console.error(ce);let we=ce.message||"";(we.includes("429")||we.includes("quota"))&&(we="AI  1-2  API Key"),alert(`AI ${we}`),Ht(!1)}finally{X(!1)}},Ie=()=>{if(document.activeElement instanceof HTMLElement&&(Se.current=document.activeElement),!M||!M.trim()){v==null||v({msg:"Please enter some content first.",type:"error"});return}if(Ut){Ht(!1);return}if(jn.length>0){Ht(!0);return}Vt(""),et(!0)},Ke=()=>{et(!1),ft(null)},[Nt,gt]=x.useState(!1),Tt=x.useMemo(()=>{const N=a.find(K=>K.name.trim().toLowerCase().includes("for"));return N?l.filter(K=>K.tags.includes(N.id)&&K.status!=="deleted"&&K.status!=="logged").sort((K,ce)=>ce.created_at.localeCompare(K.created_at)):[]},[l,a]),Ze=async N=>{document.activeElement instanceof HTMLElement&&(Se.current=document.activeElement);let K;if(ue.current?K=ue.current.getText():K=M.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),console.log("Note content for title generation:",K.substring(0,200)+"..."),console.log("Content length:",K.length),!K||!K.trim()){v==null||v({msg:"",type:"error"});return}je(!0),gt(!1);try{const ce=await RY(K,N);console.log("Generated SEO title:",ce),Ye(ce),xe(!0)}catch(ce){console.error("Generate title error:",ce),v==null||v({msg:"",type:"error"})}finally{je(!1)}},re=async()=>{let N;if(ue.current?N=ue.current.getText():N=M.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),!N||!N.trim()){v==null||v({msg:"",type:"error"});return}Tt.length>0?gt(!0):(console.log("No custom title prompts found. Using default."),Ze())},Ae=()=>{k(He),xe(!1),Ye(""),v==null||v({msg:" SEO ",type:"info"})},it=()=>{xe(!1),Ye("")},rt=x.useMemo(()=>{var N;return(N=t==null?void 0:t.dependencies)!=null&&N.length?l.filter(K=>{var ce;return((ce=t.dependencies)==null?void 0:ce.includes(K.id))&&!K.completed_at}):[]},[t==null?void 0:t.dependencies,l]),St=x.useMemo(()=>a.filter(N=>N.name.startsWith("#")).map(N=>N.name.slice(1)),[a]),zt=async()=>{let N="";if(ue.current&&typeof ue.current.getText=="function"&&(N=ue.current.getText()),(!N||!N.trim())&&(N=M.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim()),!N||!N.trim()){v==null||v({msg:"",type:"error"});return}console.log("Generating keywords for current task content:",N.slice(0,100)+(N.length>100?"...":"")),ui(!0);try{const K=await OY(N,St);ea(K),Oi(!0),console.log("Generated keywords:",K)}catch(K){console.error("Generate keywords error:",K),v==null||v({msg:"",type:"error"})}finally{ui(!1)}},Bt=async N=>{const K=`#${N}`;let ce=a.find(we=>we.name.toLowerCase()===K.toLowerCase());try{if(ce)P.includes(ce.id)?v==null||v({msg:` ${K} `,type:"info"}):(O(we=>[...we,ce.id]),v==null||v({msg:`: ${K}`,type:"info"}));else{let we=a.find(cn=>cn.name==="#"),mt;if(we)mt=we.id;else{const cn=await u("#");if(!cn)throw new Error("Failed to create root keyword tag");mt=cn}const yt=(cn,kn=0)=>{const Wt=a.find(Cn=>Cn.id===cn);return!Wt||!Wt.parent_id||Wt.parent_id===mt?kn:yt(Wt.parent_id,kn+1)},Ot=a.filter(cn=>{if(cn.parent_id===mt)return!0;let kn=cn;const Wt=new Set;for(;kn.parent_id&&!Wt.has(kn.id);){if(Wt.add(kn.id),kn.parent_id===mt)return!0;const Cn=a.find(kr=>kr.id===kn.parent_id);if(!Cn)break;kn=Cn}return!1}).map(cn=>({id:cn.id,name:cn.name.replace(/^#/,""),parentId:cn.parent_id,depth:yt(cn.id)}));let Zt=mt;if(Ot.length>0){v==null||v({msg:"...",type:"info"});const cn=await LY(N,Ot);if(cn){Zt=cn;const kn=a.find(Wt=>Wt.id===cn);console.log(`AI suggested parent for "${N}": ${kn==null?void 0:kn.name}`)}}const tn=await u(K,Zt);if(tn){P.includes(tn)||O(Wt=>[...Wt,tn]);const cn=a.find(Wt=>Wt.id===Zt),kn=(cn==null?void 0:cn.name)||"#";v==null||v({msg:`: ${K} ( ${kn})`,type:"info"})}else throw new Error("Failed to create tag")}ea(we=>we.filter(mt=>mt!==N))}catch(we){console.error("Error adding keyword tag:",we),v==null||v({msg:"",type:"error"})}},Gt=async()=>{const N=[...Zo];let K=0,ce=a.find(mt=>mt.name==="#"),we=null;if(ce)we=ce.id;else{const mt=await u("#");mt&&(we=mt)}for(const mt of N){const yt=`#${mt}`;let Ot=a.find(Zt=>Zt.name.toLowerCase()===yt.toLowerCase());try{if(Ot)P.includes(Ot.id)||(O(Zt=>[...Zt,Ot.id]),K++);else{const Zt=await u(yt,we);Zt&&!P.includes(Zt)&&(O(tn=>[...tn,Zt]),K++)}}catch(Zt){console.error("Error adding keyword tag:",mt,Zt)}}ea([]),Oi(!1),K>0?v==null||v({msg:` ${K}  #`,type:"info"}):v==null||v({msg:"",type:"info"})},an=N=>{ea(K=>K.filter(ce=>ce!==N))},xn=N=>{if(!N)return at;let K=l.find(we=>we.id===N);const ce=new Set;for(;K&&K.parent_id&&!ce.has(K.id);){ce.add(K.id);const we=l.find(mt=>mt.id===K.parent_id);if(we)K=we;else break}return(K==null?void 0:K.color)||"blue"},Tn=x.useMemo(()=>xn(ge),[ge,l,at]),bn=Jn[Tn]||Jn.blue;l1(Ue,N=>{if(n||Pe||Ut&&ct||ee||Nt||Nn||N&&di&&Ir===(t==null?void 0:t.id)&&N.target.closest("[data-recording-capsule]"))return;const K=N==null?void 0:N.target;if(!(K&&K.closest('[data-app-header="true"]')))if(t&&e)if(R.trim())fi();else{const ce=b.findIndex(mt=>mt.data.id===t.id),we=b[ce-1];y(t.id),e(we?we.data.id:null)}else e&&(R.trim()||M.replace(/<[^>]*>/g,"").trim()?fi():e(null))});const br=x.useMemo(()=>{if(!(t!=null&&t.id))return l.filter(ce=>ce.status!=="deleted");const N=new Set,K=[t.id];for(;K.length>0;){const ce=K.shift();for(const we of l)we.parent_id===ce&&!N.has(we.id)&&(N.add(we.id),K.push(we.id))}return l.filter(ce=>ce.id!==t.id&&!N.has(ce.id)&&ce.status!=="deleted")},[l,t]),Lr=x.useMemo(()=>{const N=(K=null,ce=0,we=null)=>{const mt=a.filter(Ot=>Ot.parent_id===K);let yt=[];return mt.forEach(Ot=>{yt.push({...Ot,depth:ce,parentName:we}),yt=[...yt,...N(Ot.id,ce+1,Ot.name)]}),yt};return N()},[a]);x.useEffect(()=>{if(t!=null&&t.id){const N=l.filter(K=>K.parent_id===t.id).map(K=>K.id);U(N)}},[t,l]),x.useEffect(()=>{const N=!t||!t.title;if(R.length>=2&&N){const K=l.filter(ce=>ce.title.toLowerCase().includes(R.toLowerCase())&&ce.id!==(t==null?void 0:t.id));Ct(K.slice(0,5)),bt(K.length>0),Te(-1)}else bt(!1)},[R,l,t]),x.useEffect(()=>{!t&&L.current&&L.current.focus()},[t]);const fi=async()=>{let N=R.trim();const K=M.replace(/<[^>]*>/g,"").trim();if(!N&&K&&(N=K.split(`
`)[0].substring(0,30)||"Untitled Note"),!N)return;let ce=E;if(E&&!Ce&&Ve){const mt=new Date(E),[yt,Ot]=Ve.split(":").map(Number);mt.setHours(yt,Ot,0,0),ce=mt.toISOString()}else if(E&&Ce){const mt=new Date(E);mt.setHours(12,0,0,0),ce=mt.toISOString()}const we={title:N,description:M,due_date:C,start_date:ce,parent_id:ge,is_project:ne||F.length>0,tags:P,status:(t==null?void 0:t.status)||"inbox",color:Tn,importance:_e,images:$,is_all_day:Ce,duration:vt?Number(vt):null,attachments:j,attachment_links:zn,ai_history:jn,repeat_rule:Z,reminder_minutes:Q};if(e?e((t==null?void 0:t.id)||null):na(),t&&t.id&&t.id!=="new")await o(t.id,we,F);else{const mt=await i(we,F);f(mt),m([mt])}},na=()=>{k(""),S(""),_(null),I(null),O([]),A([]),W([]),me(null),U([]),Oe(!1),Le(!0),st("09:00"),ht("10:00"),te(""),ie(null),ke(null)},cl=async N=>{if(!(N.length===0||!ve)){Dt(!0);try{const K=[],ce=[];for(const Ot of N){if(Ot.size>104857600){v==null||v({msg:`: ${Ot.name} ( 100MB)`,type:"error"});continue}const Zt=Ot.type.startsWith("image/");let tn=Ot;if(Zt&&Ot.size>2*1024*1024)try{tn=await us(Ot,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0})}catch(bs){console.warn("Compression failed, using original file:",bs)}const cn=Ot.name.split(".").pop()||(Zt?"jpg":"bin"),kn=`${Date.now()}_${crypto.randomUUID()}.${cn}`,Cn=`${(g==null?void 0:g.id)||"anonymous"}/${kn}`,{error:kr}=await ve.storage.from("attachments").upload(Cn,tn,{contentType:Ot.type,upsert:!1});if(kr){console.error("Upload error:",kr);continue}const{data:Is}=ve.storage.from("attachments").getPublicUrl(Cn);if(Is){const bs={name:Ot.name,url:Is.publicUrl,size:Ot.size,type:Ot.type};ce.push(bs),Zt&&K.push(Is.publicUrl)}}const mt=[...$,...K],yt=[...j,...ce];A(mt),W(yt),t&&(K.length>0||ce.length>0)&&o(t.id,{images:mt,attachments:yt},[],{skipHistory:!0})}catch(K){console.error("Error uploading files:",K)}finally{Dt(!1),tt.current&&(tt.current.value="")}}},Hu=async N=>{const K=N.target;if(K.tagName==="INPUT"||K.tagName==="TEXTAREA"||K.isContentEditable){if(N.clipboardData.files.length>0){N.preventDefault();const ce=Array.from(N.clipboardData.files);await cl(ce);return}return}if(N.clipboardData.files.length>0){N.preventDefault();const ce=Array.from(N.clipboardData.files);await cl(ce)}},ra=async N=>{let K=[];"files"in N.target&&N.target.files?K=Array.from(N.target.files):"dataTransfer"in N&&N.dataTransfer.files&&(K=Array.from(N.dataTransfer.files)),await cl(K)},HR=async N=>{const K=$.filter(we=>we!==N),ce=j.filter(we=>we.url!==N);if(A(K),W(ce),t&&o(t.id,{images:K,attachments:ce},[],{skipHistory:!0}),ve)try{const mt=new URL(N).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(mt){const yt=mt[1];await ve.storage.from("attachments").remove([yt])}}catch(we){console.warn("Failed to delete image from storage:",we)}},VR=async N=>{const K=N.target.files;if(!(!K||K.length===0||!ve)){Dt(!0);try{const ce=[],we=[];for(const Ot of Array.from(K)){const Zt=Ot.name.split(".").pop()||"bin",tn=`${Date.now()}_${crypto.randomUUID()}.${Zt}`,cn=`${g.id}/${tn}`,{error:kn}=await ve.storage.from("attachments").upload(cn,Ot,{contentType:Ot.type,upsert:!1});if(kn){console.error("Upload error:",kn),v==null||v({msg:`: ${Ot.name}`,type:"error"});continue}const{data:Wt}=ve.storage.from("attachments").getPublicUrl(cn);if(Wt){const Cn=Ot.type.startsWith("image/"),kr={name:Ot.name,url:Wt.publicUrl,size:Ot.size,type:Ot.type};ce.push(kr),Cn&&we.push(Wt.publicUrl)}}const mt=[...j,...ce],yt=[...$,...we];W(mt),A(yt),t&&(ce.length>0||we.length>0)&&o(t.id,{attachments:mt,images:yt},[],{skipHistory:!0}),ce.length>0&&Et(ce[ce.length-1].url),v==null||v({msg:` ${ce.length} `,type:"info"})}catch(ce){console.error("Error uploading attachments:",ce),v==null||v({msg:"",type:"error"})}finally{Dt(!1),Ne.current&&(Ne.current.value="")}}},hi=x.useRef(null),WR=async N=>{const K=j.find(Ot=>Ot.url===N);if(!K)return;hi.current&&(clearTimeout(hi.current.timeoutId),i0(hi.current.url));const ce=j.filter(Ot=>Ot.url!==N),we=$.filter(Ot=>Ot!==N);W(ce),A(we),t&&o(t.id,{attachments:ce,images:we},[],{skipHistory:!0});const mt=setTimeout(()=>{i0(N),lh.current.push({type:"delete",attachment:K}),ch.current=[],hi.current=null},1e4);hi.current={url:N,attachment:K,timeoutId:mt};const yt=K.name||"";v==null||v({msg:`: ${yt.length>20?yt.slice(0,20)+"...":yt}`,type:"info",undo:()=>{var Ot,Zt;if(hi.current&&hi.current.url===N){if(clearTimeout(hi.current.timeoutId),hi.current=null,W(tn=>[...tn,K]),(Ot=K.type)!=null&&Ot.startsWith("image/")&&A(tn=>[...tn,K.url]),t){const tn=[...ce,K],cn=(Zt=K.type)!=null&&Zt.startsWith("image/")?[...we,K.url]:we;o(t.id,{attachments:tn,images:cn},[],{skipHistory:!0})}v==null||v({msg:"",type:"info"})}}})},i0=async N=>{if(ve)try{const ce=new URL(N).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(ce){const we=ce[1];await ve.storage.from("attachments").remove([we]),console.log("[TaskInput] Attachment deleted from storage:",we)}}catch(K){console.warn("Failed to delete attachment from storage:",K)}},lh=x.useRef([]),ch=x.useRef([]),KR=()=>{var N,K;if(hi.current){const{attachment:ce,timeoutId:we}=hi.current;if(clearTimeout(we),hi.current=null,W(mt=>mt.some(Ot=>Ot.url===ce.url)?mt:[...mt,ce]),(N=ce.type)!=null&&N.startsWith("image/")&&A(mt=>mt.includes(ce.url)?mt:[...mt,ce.url]),t){const yt=[...j,ce];o(t.id,{attachments:yt},[],{skipHistory:!0})}return v==null||v({msg:"",type:"info"}),!0}if(lh.current.length>0){const ce=lh.current.pop();return ch.current.push(ce),ce.type==="delete"&&(W(we=>[...we,ce.attachment]),(K=ce.attachment.type)!=null&&K.startsWith("image/")&&A(we=>[...we,ce.attachment.url]),t&&o(t.id,{attachments:[...j,ce.attachment]},[],{skipHistory:!0}),v==null||v({msg:"",type:"info"})),!0}return!1},GR=()=>{if(ch.current.length>0){const N=ch.current.pop();return lh.current.push(N),N.type==="delete"&&(W(K=>K.filter(ce=>ce.url!==N.attachment.url)),A(K=>K.filter(ce=>ce!==N.attachment.url)),t&&o(t.id,{attachments:j.filter(K=>K.url!==N.attachment.url),images:$.filter(K=>K!==N.attachment.url)},[],{skipHistory:!0}),i0(N.attachment.url),v==null||v({msg:"",type:"info"})),!0}return!1};x.useEffect(()=>{const N=K=>{var ce;(ce=Ue.current)!=null&&ce.contains(document.activeElement)&&((K.ctrlKey||K.metaKey)&&K.key==="z"&&!K.shiftKey&&KR()&&(K.preventDefault(),K.stopPropagation()),(K.ctrlKey||K.metaKey)&&K.key==="z"&&K.shiftKey&&GR()&&(K.preventDefault(),K.stopPropagation()))};return window.addEventListener("keydown",N,!0),()=>window.removeEventListener("keydown",N,!0)},[j,$,t]);const qR=N=>N<1024?N+" B":N<1024*1024?(N/1024).toFixed(1)+" KB":(N/(1024*1024)).toFixed(1)+" MB",Vu=N=>{var mt,yt,Ot,Zt,tn,cn,kn,Wt,Cn,kr,Is,bs,Li,pk,mk,gk,yk,xk,bk,vk,wk;N.preventDefault();const K=document.activeElement,ce=N.shiftKey,we=(mt=Ue.current)==null?void 0:mt.querySelector(".ProseMirror");ce?K===L.current?(Is=Je.current)==null||Is.focus():K!=null&&K.classList.contains("ProseMirror")?(bs=L.current)==null||bs.focus():Je.current&&(K===Je.current||(Li=Je.current.parentElement)!=null&&Li.contains(K))?Ce&&q.current?q.current.focus():!Ce&&We.current?setTimeout(()=>{var Kr,Ms;(Kr=We.current)==null||Kr.focus(),(Ms=We.current)==null||Ms.select()},0):(pk=B.current)==null||pk.focus():K===q.current?(mk=B.current)==null||mk.focus():K===We.current?De.current?setTimeout(()=>{var Kr,Ms;(Kr=De.current)==null||Kr.focus(),(Ms=De.current)==null||Ms.select()},0):(gk=B.current)==null||gk.focus():K===De.current?pe.current?setTimeout(()=>{var Kr,Ms;(Kr=pe.current)==null||Kr.focus(),(Ms=pe.current)==null||Ms.select()},0):(yk=B.current)==null||yk.focus():K===pe.current?(xk=B.current)==null||xk.focus():B.current&&(K===B.current||(bk=B.current.parentElement)!=null&&bk.contains(K))?we?we.focus():(vk=L.current)==null||vk.focus():(wk=Je.current)==null||wk.focus():K===L.current?we&&we.focus():K!=null&&K.classList.contains("ProseMirror")?(yt=B.current)==null||yt.focus():K===B.current||B.current&&((Ot=B.current.parentElement)!=null&&Ot.contains(K))?Ce&&q.current?q.current.focus():!Ce&&pe.current?(pe.current.focus(),pe.current.select()):(Zt=Je.current)==null||Zt.focus():K===q.current?(tn=Je.current)==null||tn.focus():K===pe.current?De.current?setTimeout(()=>{var Kr,Ms;(Kr=De.current)==null||Kr.focus(),(Ms=De.current)==null||Ms.select()},0):(cn=Je.current)==null||cn.focus():K===De.current?We.current?setTimeout(()=>{var Kr,Ms;(Kr=We.current)==null||Kr.focus(),(Ms=We.current)==null||Ms.select()},0):(kn=Je.current)==null||kn.focus():K===We.current?setTimeout(()=>{var Kr;(Kr=Je.current)==null||Kr.focus()},0):Je.current&&(K===Je.current||(Wt=Je.current.parentElement)!=null&&Wt.contains(K))?(Cn=L.current)==null||Cn.focus():(kr=L.current)==null||kr.focus()},ak=()=>{t&&o(t.id,{completed_at:H?null:new Date().toISOString(),reminder_minutes:Q})},lk=N=>{var mt,yt,Ot,Zt,tn,cn,kn;if((N.ctrlKey||N.metaKey)&&N.key==="z"){N.stopPropagation();return}if(N.shiftKey){if(N.key==="S"||N.key==="s"){N.preventDefault(),(mt=B.current)==null||mt.focus();return}if(N.key==="T"||N.key==="t"){N.preventDefault(),(yt=Je.current)==null||yt.focus();return}}if(N.ctrlKey&&N.key==="."){N.preventDefault(),N.stopPropagation(),ak();return}if($t&&document.activeElement===L.current){if(N.key==="ArrowLeft"){N.preventDefault();const Wt=Dn-1;Bn(Wt);const Cn=new Date;Cn.setDate(Cn.getDate()+Wt);const kr=Cn.toLocaleDateString("sv-SE"),bs=["","","","","","",""][Cn.getDay()].replace("","");k(Li=>Li.replace(/\d{4}-\d{2}-\d{2}[]$/,`${kr}${bs}`));return}if(N.key==="ArrowRight"){N.preventDefault();const Wt=Dn+1;Bn(Wt);const Cn=new Date;Cn.setDate(Cn.getDate()+Wt);const kr=Cn.toLocaleDateString("sv-SE"),bs=["","","","","","",""][Cn.getDay()].replace("","");k(Li=>Li.replace(/\d{4}-\d{2}-\d{2}[]$/,`${kr}${bs}`));return}if(N.key==="Enter"){N.preventDefault(),rn(!1),Bn(0);return}if(N.key==="Escape"){N.preventDefault(),rn(!1),Bn(0),k(Wt=>Wt.replace(/\d{4}-\d{2}-\d{2}[]$/,""));return}}const K=document.activeElement,ce=(K==null?void 0:K.classList.contains("ProseMirror"))||(K==null?void 0:K.closest(".ProseMirror")),we=M&&M.trim()&&M!=="<p></p>";if(N.key==="Tab"&&!ce){Vu(N);return}if(N.key==="Tab"&&ce&&!we){Vu(N);return}if(ut){if(N.key==="ArrowDown"){N.preventDefault(),Te(Wt=>Wt===-1?0:(Wt+1)%ot.length);return}if(N.key==="ArrowUp"){N.preventDefault(),Te(Wt=>Wt<=0?ot.length-1:Wt-1);return}if((N.ctrlKey||N.metaKey)&&N.key==="Enter"&&Xe>=0&&(N.preventDefault(),k(ot[Xe].title),bt(!1)),N.key==="Escape"){N.preventDefault(),bt(!1);return}}if(!N.nativeEvent.isComposing){if((N.ctrlKey||N.metaKey)&&N.key==="Enter"&&!ce){N.preventDefault(),N.stopPropagation(),fi();return}if((N.ctrlKey||N.metaKey)&&N.key==="Enter"&&ce){N.preventDefault(),N.stopPropagation(),(Ot=L.current)==null||Ot.focus();return}if(N.key==="Enter"&&!N.shiftKey){if(N.target.tagName==="TEXTAREA"||N.target.isContentEditable)return;N.preventDefault(),N.stopPropagation(),fi()}if(N.key==="Escape"){if(Ut){N.preventDefault(),N.stopPropagation(),Ht(!1),(Zt=Se.current)==null||Zt.focus();return}if(ee){N.preventDefault(),N.stopPropagation(),xe(!1),(tn=Se.current)==null||tn.focus();return}if(ut){N.preventDefault(),N.stopPropagation(),bt(!1);return}if(Pe){N.preventDefault(),N.stopPropagation(),et(!1),(cn=Se.current)==null||cn.focus();return}if(Hn.isOpen){N.preventDefault(),N.stopPropagation(),is(Wt=>({...Wt,isOpen:!1}));return}if($t){N.preventDefault(),N.stopPropagation(),rn(!1);return}if(ce){N.preventDefault(),N.stopPropagation(),(kn=L.current)==null||kn.focus();return}}if(N.key==="Escape"&&e)if(N.preventDefault(),t&&!R.trim()){const Wt=b.findIndex(kr=>kr.data.id===t.id),Cn=b[Wt-1];y(t.id),e(Cn?Cn.data.id:null)}else fi()}},ck=N=>{if(st(N),N&&Be){const[K,ce]=N.split(":").map(Number),[we,mt]=Be.split(":").map(Number);if(!isNaN(K)&&!isNaN(ce)&&!isNaN(we)&&!isNaN(mt)){const yt=K*60+ce,Ot=we*60+mt;if(yt<Ot)te((Ot-yt).toString());else{const Zt=Number(vt)||60,tn=yt+Zt,cn=Math.floor(tn/60)%24,kn=tn%60;ht(`${String(cn).padStart(2,"0")}:${String(kn).padStart(2,"0")}`)}}}},YR=N=>{if(ht(N),N&&Ve){const[K,ce]=Ve.split(":").map(Number),[we,mt]=N.split(":").map(Number);let yt=we*60+mt-(K*60+ce);yt<0&&(yt+=1440),te(yt.toString())}},JR=N=>{if(te(N),N&&!isNaN(Number(N))&&Ve){const K=Number(N),[ce,we]=Ve.split(":").map(Number),mt=new Date;mt.setHours(ce,we+K),ht(`${String(mt.getHours()).padStart(2,"0")}:${String(mt.getMinutes()).padStart(2,"0")}`)}},XR=h.fontWeight==="thin"?"font-extralight":"font-medium",QR=h.fontWeight==="thin"?"font-extralight":"font-normal",uk={small:"text-sm",normal:"text-base",large:"text-lg"}[h.fontSize]||"text-base",ZR=t?`border-${Tn}-200`:"border-gray-100/50",eO=()=>{const N=ct?Math.max(10,Math.min(ct.top,window.innerHeight-500)):0,K=ct?Math.max(220,Math.min(ct.left,window.innerWidth-220)):0,ce=c.jsxs(Pr.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:ct?"fixed bg-white rounded-xl shadow-2xl border border-gray-100 p-4 flex flex-col gap-4 overflow-hidden w-[400px]":"absolute top-[30px] right-0 w-[400px] bg-white rounded-xl shadow-2xl border border-gray-100 z-[100] p-4 flex flex-col gap-4 overflow-hidden",style:ct?{top:N,left:K,transform:"translateX(-50%)",zIndex:99999}:{},children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("h3",{className:"text-sm font-bold text-slate-800 flex items-center gap-2",children:[c.jsx(As,{className:"text-indigo-500",size:16}),"AI "]}),c.jsx("button",{onClick:Ke,className:"text-slate-400 hover:text-slate-600 transition-colors p-1 hover:bg-slate-100 rounded-full",children:c.jsx(un,{size:16})})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("input",{type:"text",placeholder:"...",className:"w-full px-3 py-2 text-xs bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none transition-all",value:Ft,onChange:we=>nn(we.target.value)}),!Ft&&qs.length>0&&c.jsxs("div",{children:[c.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2",children:""}),c.jsx("div",{className:"flex flex-wrap gap-1.5",children:qs.map(we=>c.jsx("button",{type:"button",onClick:()=>{Vt(we.description||we.title),nn("")},className:"text-[10px] px-2 py-1 rounded-full bg-indigo-50 text-indigo-600 hover:bg-indigo-100 transition-all border border-indigo-100 font-medium",title:we.description||we.title,children:we.title},we.id))})]}),c.jsx("textarea",{className:"w-full h-32 p-3 text-sm bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none resize-none transition-all placeholder:text-slate-300",placeholder:"...",value:_t,onChange:we=>Vt(we.target.value)}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"checkbox",id:"saveToLib",checked:_n,onChange:we=>Fn(we.target.checked),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-slate-300"}),c.jsx("label",{htmlFor:"saveToLib",className:"text-xs text-slate-500 cursor-pointer select-none",children:""})]}),c.jsxs("div",{className:"flex gap-2 justify-end",children:[c.jsxs("button",{onClick:()=>be(Eee),className:"flex-1 py-2.5 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 rounded-xl text-[10px] font-bold transition-all border border-indigo-200 shadow-sm active:scale-95 flex flex-col items-center justify-center gap-0.5",title:"",children:[c.jsx(As,{size:12}),c.jsx("span",{children:""})]}),c.jsxs("button",{onClick:()=>be(),className:"flex-1 py-2.5 bg-slate-50 hover:bg-slate-100 text-slate-600 rounded-xl text-[10px] font-bold transition-all border border-slate-200 shadow-sm active:scale-95 flex flex-col items-center justify-center gap-0.5",children:[c.jsx(fd,{size:12}),c.jsx("span",{children:""})]}),c.jsx("button",{onClick:()=>be(_t),disabled:!_t.trim(),className:"flex-[2] py-2 bg-slate-800 hover:bg-slate-900 text-white rounded-xl text-xs font-bold transition-all shadow-md shadow-slate-200 disabled:opacity-50 disabled:grayscale active:scale-95",children:""})]})]}),js.length>0&&c.jsxs("div",{className:"border-t border-gray-50 pt-3 mt-1",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest",children:Ft?"":""}),Ft&&fn>0&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:"text-[10px] text-gray-500",children:[Xt+1," / ",fn]}),c.jsxs("div",{className:"flex gap-0.5",children:[c.jsx("button",{onClick:()=>{Jt(we=>we>0?we-1:fn-1)},className:"p-1 hover:bg-gray-100 rounded text-gray-400 hover:text-gray-600",title:" (Cmd+Shift+G)",children:c.jsx(yp,{size:12})}),c.jsx("button",{onClick:()=>{Jt(we=>we<fn-1?we+1:0)},className:"p-1 hover:bg-gray-100 rounded text-gray-400 hover:text-gray-600",title:" (Cmd+G)",children:c.jsx(ts,{size:12})})]})]})]}),c.jsx("div",{className:"flex flex-col gap-1.5 max-h-[160px] overflow-y-auto custom-scrollbar pr-1",onKeyDown:we=>{(we.metaKey||we.ctrlKey)&&we.key==="g"&&(we.preventDefault(),we.shiftKey?Jt(mt=>mt>0?mt-1:fn-1):Jt(mt=>mt<fn-1?mt+1:0))},children:js.map((we,mt)=>{const yt=iE(we.description||""),Ot=(Zt,tn,cn)=>{if(!tn.trim())return Zt;const kn=Zt.split(new RegExp(`(${tn})`,"gi"));let Wt=0;for(let Cn=0;Cn<mt;Cn++){const kr=js[Cn],Is=iE(kr.description||""),bs=(kr.title.match(new RegExp(tn,"gi"))||[]).length,Li=Is?(Is.match(new RegExp(tn,"gi"))||[]).length:0;Wt+=bs+Li}if(!cn){const Cn=(we.title.match(new RegExp(tn,"gi"))||[]).length;Wt+=Cn}return kn.map((Cn,kr)=>{if(Cn.toLowerCase()===tn.toLowerCase()){const Is=Wt===Xt,bs=c.jsx("mark",{className:`${Is?"bg-orange-400 text-white ring-2 ring-orange-500":"bg-yellow-200 text-slate-900"} font-bold px-0.5 rounded`,ref:Is?Li=>{Li&&Li.scrollIntoView({behavior:"smooth",block:"center"})}:void 0,children:Cn},kr);return Wt++,bs}return Cn})};return c.jsxs("button",{type:"button",onClick:()=>{Vt(yt||we.title),nn(""),Jt(0)},className:"flex-shrink-0 text-left text-[11px] p-2 rounded-xl hover:bg-indigo-50 text-slate-600 hover:text-indigo-700 transition-all border border-slate-100 hover:border-indigo-100 shadow-sm bg-white active:scale-[0.98]",title:yt||we.title,children:[c.jsx("div",{className:"font-medium",children:Ot(we.title,Ft,!0)}),yt&&yt!==we.title&&c.jsx("div",{className:"text-[10px] text-gray-400 mt-0.5 whitespace-pre-wrap line-clamp-3",children:Ot(yt,Ft,!1)})]},we.id)})})]})]},"prompt-modal");return ct?ir.createPortal(c.jsx(bo,{children:Pe&&ce}),document.body):c.jsx(bo,{children:Pe&&ce})};return c.jsxs("div",{ref:Ue,className:`group transition-all w-full relative ${n||r?"bg-transparent":`mb-3 bg-white rounded-xl border ${ZR} shadow-[0_4px_8px_rgba(0,0,0,0.08)]`} ${V?"ring-2 ring-indigo-400 border-indigo-400 bg-indigo-50/10":""}`,onKeyDown:lk,onPaste:Hu,onDragOver:N=>{N.preventDefault(),N.stopPropagation(),D(!0)},onDragLeave:N=>{N.preventDefault(),N.stopPropagation(),D(!1)},onDrop:N=>{N.preventDefault(),N.stopPropagation(),D(!1),ra(N)},children:[V&&c.jsx("div",{className:"absolute inset-0 bg-indigo-500/10 backdrop-blur-[1px] z-[50] flex items-center justify-center rounded-xl pointer-events-none",children:c.jsxs("div",{className:"bg-white px-4 py-2 rounded-full shadow-lg border border-indigo-200 flex items-center gap-2",children:[c.jsx(vf,{className:"text-indigo-500 animate-bounce",size:20}),c.jsx("span",{className:"text-sm font-bold text-indigo-600",children:""})]})}),t&&!r&&c.jsx("button",{onClick:N=>{N.stopPropagation(),window.open(`${window.location.origin}/share/${t.id}`,"_blank")},className:"absolute top-4 right-4 md:opacity-0 group-hover:opacity-100 transition-opacity p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg z-20",title:" (Share Task)",children:c.jsx(Hz,{size:16})}),c.jsxs("div",{className:`flex gap-4 ${t?"pl-5":"pl-6"} py-6`,children:[t?c.jsxs("div",{className:"mb-0.5",children:[" ",c.jsx(CD,{checked:H,onChange:N=>{N.stopPropagation(),ak()},size:20,color:Tn,isRoot:!ge})," "]}):c.jsx("button",{type:"button",tabIndex:-1,onClick:()=>Oe(!ne),className:`mb-0.5 h-6 w-6 flex items-center justify-center transition-all ${ne?bn.accent:"text-gray-300 hover:text-gray-400"}`,children:ne?c.jsx(RI,{size:18}):c.jsx(az,{size:18})}),c.jsxs("div",{className:"flex-1 space-y-4 relative pr-6",children:[c.jsx("div",{className:"flex items-end justify-between",children:c.jsxs("div",{className:"flex-1 relative space-y-2",children:[ge&&(()=>{const N=l.find(K=>K.id===ge);return N?c.jsxs("button",{type:"button",onClick:K=>{K.stopPropagation(),t&&R.trim()&&fi(),T(ge,!0,"allview")},className:"flex items-center gap-1.5 text-xs text-theme-tertiary hover:text-indigo-600 transition-colors group/parent",children:[c.jsx(yp,{size:12,className:"opacity-50 group-hover/parent:opacity-100"}),c.jsx("span",{className:"truncate max-w-[200px] group-hover/parent:underline",children:N.title||""})]}):null})(),rt.length>0&&c.jsxs("div",{className:"flex items-center gap-2 text-xs text-amber-600 bg-amber-50 p-2 rounded-lg mb-2",children:[c.jsx(Jf,{size:14,className:"shrink-0"}),c.jsxs("span",{children:["",rt.map((N,K)=>c.jsxs("span",{children:[K>0&&", ",c.jsx("button",{type:"button",onClick:ce=>{ce.stopPropagation(),T(N.id,!0)},className:"hover:underline font-medium",children:N.title})]},N.id))]})]}),c.jsxs("div",{className:"flex items-center relative gap-2",children:[c.jsx("input",{ref:L,autoFocus:!0,type:"text",name:"data_task_input",autoComplete:"off",autoCorrect:"off",spellCheck:"false",value:R,onKeyDown:N=>{N.key==="Enter"&&console.log("[TaskInputDebug] Enter pressed",{isComposing:N.nativeEvent.isComposing,titleLen:R.length}),lk(N)},onFocus:()=>se(R.length>0),onBlur:()=>setTimeout(()=>se(!1),200),onChange:N=>{const K=N.target.value;if(se(K.length>0),K.endsWith("@ ")&&!$t){rn(!0),Bn(0);const ce=new Date,we=ce.toLocaleDateString("sv-SE"),yt=["","","","","","",""][ce.getDay()].replace("","");k(K.slice(0,-2)+`${we}${yt}`)}else $t&&!K.match(/\d{4}-\d{2}-\d{2}[]$/)&&rn(!1),k(K)},readOnly:s,placeholder:s?"":"...",className:`flex-1 ${uk} ${XR} transition-all duration-300 placeholder:font-light placeholder-gray-300 border-none bg-transparent focus:ring-0 outline-none p-0 leading-tight ${H?"opacity-30":$t?"text-slate-400":"text-slate-800"} ${s?"cursor-default":""}`}),he&&R.length>0&&(()=>{const N=ce=>{const we=l.find(Ot=>Ot.id===ce);if(!we||!we.parent_id)return"";const mt=l.find(Ot=>Ot.id===we.parent_id);if(!mt)return"";const yt=N(mt.id);return yt?`${yt} > ${mt.title}`:mt.title},K=l.filter(ce=>ce.id!==(t==null?void 0:t.id)&&ce.title&&ce.title.toLowerCase().includes(R.toLowerCase())&&ce.title.toLowerCase()!==R.toLowerCase()).slice(0,5);return K.length===0?null:c.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 z-50 overflow-hidden animate-in slide-in-from-top-2 fade-in duration-200",children:K.map(ce=>{const we=N(ce.id);return c.jsx("button",{type:"button",onMouseDown:mt=>{mt.preventDefault(),k(ce.title),se(!1)},className:"w-full text-left px-4 py-2.5 text-sm hover:bg-slate-50 dark:hover:bg-slate-700/50 border-b border-slate-100 dark:border-slate-700/50 last:border-b-0 transition-colors group",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity",children:""}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:"text-slate-700 dark:text-slate-300 truncate",children:ce.title}),we&&c.jsx("div",{className:"text-xs text-slate-400 dark:text-slate-500 truncate mt-0.5",children:we})]})]})},ce.id)})})})(),R.trim()&&c.jsx("button",{type:"button",onClick:N=>{N.preventDefault(),N.stopPropagation(),console.log("[TaskInput] Manual Button Submit"),fi()},className:"p-1.5 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition-colors shadow-sm active:scale-95 flex-shrink-0 animate-in fade-in zoom-in duration-200",children:c.jsx(tz,{size:18})})]}),Nt&&ir.createPortal(c.jsx("div",{className:"fixed inset-0 z-[9999999] flex items-center justify-center bg-black/20 backdrop-blur-sm",onClick:()=>gt(!1),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl border border-slate-200 p-4 w-[400px] max-w-[90vw] animate-in fade-in zoom-in-95 duration-200",onClick:N=>N.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between mb-3 border-b border-slate-100 pb-2",children:[c.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[c.jsx(As,{size:16,className:"text-amber-500"}),c.jsx("h3",{className:"font-bold text-sm",children:" AI "})]}),c.jsx("button",{onClick:()=>gt(!1),className:"text-slate-400 hover:text-slate-600",children:c.jsx(un,{size:16})})]}),c.jsxs("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:[c.jsxs("button",{onClick:()=>Ze(),className:"w-full text-left p-3 rounded-lg border border-slate-100 hover:border-indigo-300 hover:bg-indigo-50 transition-all group",children:[c.jsx("div",{className:"font-medium text-sm text-slate-700 group-hover:text-indigo-700",children:" SEO "}),c.jsx("div",{className:"text-xs text-slate-500 mt-1",children:" SEO "})]}),Tt.map(N=>c.jsxs("button",{onClick:()=>Ze(N.description||""),className:"w-full text-left p-3 rounded-lg border border-slate-100 hover:border-amber-300 hover:bg-amber-50 transition-all group",children:[c.jsx("div",{className:"font-medium text-sm text-slate-700 group-hover:text-amber-700",children:N.title}),c.jsx("div",{className:"text-xs text-slate-500 mt-1 line-clamp-2",children:(N.description||"").replace(/<[^>]+>/g,"")})]},N.id))]})]})}),document.body),ee&&ir.createPortal(c.jsxs("div",{className:"fixed bg-theme-card rounded-xl shadow-2xl border border-theme p-4 animate-in fade-in zoom-in-95 duration-200",style:{top:L.current?L.current.getBoundingClientRect().bottom+8:100,left:L.current?L.current.getBoundingClientRect().left:100,width:L.current?L.current.getBoundingClientRect().width:300,zIndex:99999},children:[c.jsxs("div",{className:"flex items-center gap-2 text-indigo-400 mb-3",children:[c.jsx(a1,{size:14}),c.jsx("span",{className:"text-xs font-bold",children:"AI "})]}),c.jsx("input",{type:"text",autoFocus:!0,value:He,onChange:N=>Ye(N.target.value),className:"w-full px-3 py-2 text-sm bg-theme-main border border-theme rounded-lg focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500/50 outline-none text-theme-primary",placeholder:"..."}),c.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[c.jsx("button",{type:"button",onClick:it,className:"px-3 py-1.5 text-xs text-theme-tertiary hover:bg-theme-hover rounded-lg transition-colors",children:""}),c.jsx("button",{type:"button",onClick:Ae,className:"px-3 py-1.5 text-xs bg-indigo-600 text-white hover:bg-indigo-700 rounded-lg transition-colors font-medium",children:""})]})]}),document.body),Nn&&ir.createPortal(c.jsx("div",{className:"fixed inset-0 z-[9999999] flex items-center justify-center bg-black/20 backdrop-blur-sm",onClick:N=>{N.stopPropagation(),Oi(!1)},onMouseDown:N=>N.stopPropagation(),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl border border-slate-200 p-5 w-[450px] max-w-[90vw] animate-in fade-in zoom-in-95 duration-200",onClick:N=>N.stopPropagation(),onMouseDown:N=>N.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between mb-4 border-b border-slate-100 pb-3",children:[c.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[c.jsx(zl,{size:16,className:"text-emerald-500"}),c.jsx("h3",{className:"font-bold text-sm",children:"AI "})]}),c.jsx("button",{onClick:N=>{N.stopPropagation(),Oi(!1)},onMouseDown:N=>N.stopPropagation(),className:"text-slate-400 hover:text-slate-600",children:c.jsx(un,{size:16})})]}),Zo.length>0&&c.jsxs("div",{className:"mb-4",children:[c.jsx("p",{className:"text-xs text-slate-500 mb-2",children:" SEO   "}),c.jsx("div",{className:"flex flex-wrap gap-2",children:Zo.map((N,K)=>c.jsxs("div",{className:"group flex items-center gap-1 px-3 py-1.5 bg-emerald-50 text-emerald-700 rounded-full text-xs font-medium border border-emerald-200 hover:bg-emerald-100 transition-all",onClick:ce=>ce.stopPropagation(),onMouseDown:ce=>ce.stopPropagation(),children:[c.jsx("span",{className:"text-emerald-500",children:"#"}),c.jsx("span",{children:N}),c.jsx("button",{onClick:ce=>{ce.stopPropagation(),Bt(N)},onMouseDown:ce=>ce.stopPropagation(),className:"ml-1 text-emerald-600 hover:text-emerald-800 p-0.5 hover:bg-emerald-200 rounded",title:"",children:c.jsx(Xn,{size:12})}),c.jsx("button",{onClick:ce=>{ce.stopPropagation(),an(N)},onMouseDown:ce=>ce.stopPropagation(),className:"text-slate-400 hover:text-red-500 p-0.5 hover:bg-red-100 rounded",title:"",children:c.jsx(un,{size:12})})]},K))})]}),Gs&&c.jsxs("div",{className:"flex items-center justify-center py-6 text-slate-500",children:[c.jsx(yi,{size:20,className:"animate-spin mr-2"}),c.jsx("span",{className:"text-sm",children:"..."})]}),c.jsxs("div",{className:"flex gap-2 justify-end mt-4 pt-3 border-t border-slate-100",children:[c.jsx("button",{onClick:N=>{N.stopPropagation(),Oi(!1)},onMouseDown:N=>N.stopPropagation(),className:"px-4 py-2 text-xs text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:""}),c.jsxs("button",{onClick:N=>{N.stopPropagation(),zt()},onMouseDown:N=>N.stopPropagation(),disabled:Gs,className:"px-4 py-2 text-xs bg-indigo-600 text-white hover:bg-indigo-700 rounded-lg transition-colors font-medium disabled:opacity-50 flex items-center gap-1",children:[Gs?c.jsx(yi,{size:12,className:"animate-spin"}):c.jsx(As,{size:12}),""]}),Zo.length>0&&c.jsxs("button",{onClick:N=>{N.stopPropagation(),Gt()},onMouseDown:N=>N.stopPropagation(),className:"px-4 py-2 text-xs bg-emerald-600 text-white hover:bg-emerald-700 rounded-lg transition-colors font-medium flex items-center gap-1",children:[c.jsx(Xn,{size:12}),""]})]})]})}),document.body),ut&&c.jsx("div",{className:"w-full mt-1 mb-2",children:c.jsx("div",{className:"bg-theme-hover rounded-lg overflow-hidden border border-theme",children:ot.map((N,K)=>c.jsxs("div",{className:`px-3 py-1.5 text-xs cursor-pointer transition-colors flex justify-between items-center ${K===Xe?"bg-theme-selection text-theme-primary font-medium":"text-theme-secondary hover:bg-theme-hover"}`,onClick:()=>{k(N.title),bt(!1)},children:[c.jsx("span",{children:N.title}),K===Xe&&c.jsx("span",{className:"text-[9px] text-indigo-400 font-normal",children:"Ctrl+Enter"})]},N.id))})}),c.jsx("div",{className:"flex justify-end mb-1 gap-2",children:!s&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{type:"button",onClick:()=>{Ie(),Qe(null)},disabled:lt,className:`flex items-center gap-1.5 text-xs transition-colors disabled:opacity-50 px-2 py-0.5 rounded-full ${Ut?"bg-indigo-500/20 text-indigo-400 font-bold shadow-sm ring-1 ring-indigo-500/30":"text-indigo-500 hover:text-indigo-400 hover:bg-indigo-500/10 font-medium"}`,title:"AI Assistant Brain",children:[lt?c.jsx(yi,{size:12,className:"animate-spin"}):c.jsx(As,{size:12}),c.jsx("span",{children:"AI "})]}),c.jsxs("button",{type:"button",onClick:re,disabled:Fe,className:`flex items-center gap-1.5 text-xs transition-colors disabled:opacity-50 px-2 py-0.5 rounded-full ${Fe?"bg-amber-500/20 text-amber-400 font-bold shadow-sm ring-1 ring-amber-500/30":"text-amber-500 hover:text-amber-400 hover:bg-amber-500/10 font-medium"}`,title:" SEO ",children:[Fe?c.jsx(yi,{size:12,className:"animate-spin"}):c.jsx(a1,{size:12}),c.jsx("span",{children:"AI "})]}),c.jsxs("button",{type:"button",onClick:()=>{Oi(!0),zt()},disabled:Gs,className:`flex items-center gap-1.5 text-xs transition-colors disabled:opacity-50 px-2 py-0.5 rounded-full ${Gs?"bg-emerald-500/20 text-emerald-400 font-bold shadow-sm ring-1 ring-emerald-500/30":"text-emerald-500 hover:text-emerald-400 hover:bg-emerald-500/10 font-medium"}`,title:" SEO ",children:[Gs?c.jsx(yi,{size:12,className:"animate-spin"}):c.jsx(zl,{size:12}),c.jsx("span",{children:"AI "})]}),eO()]})}),c.jsxs("div",{className:"flex flex-col md:flex-row gap-4 transition-all duration-300 items-stretch h-full",children:[c.jsxs("div",{className:"flex-1 transition-all duration-300 overflow-y-auto max-h-[55vh] flex flex-col no-scrollbar",children:[J&&c.jsx(R9,{url:J.url,fileName:J.name,autoPlay:!0,markers:(dk=J.markers)==null?void 0:dk.filter(N=>Y.has(N.id)),seekToTime:Ge,onClose:()=>{ye(null),kt(null)},onMarkerClick:N=>{ue.current&&ue.current.scrollToParagraph&&ue.current.scrollToParagraph(N.id)}}),c.jsx(Zg,{onEditorReady:N=>{ue.current=N},onPolish:(N,K,ce)=>{ft(K),ce&&Qe(ce),et(!0),Vt("")},initialContent:M,onChange:S,onExit:()=>{var N;return(N=B.current)==null?void 0:N.focus()},textSizeClass:uk,descFontClass:QR,editable:!s,placeholder:s?"...":"...",className:"h-full",onSaveAudio:cc,onAudioMarkerClick:(N,K)=>{if(K){const we=j.find(mt=>mt.recordingId===K);if(we){ye({url:we.url,name:we.name,markers:we.markers}),kt(Math.max(0,N-4e3));return}}if(J){kt(Math.max(0,N-4e3));return}const ce=j.find(we=>{var mt,yt;return we.recordingId||((mt=we.type)==null?void 0:mt.startsWith("audio/"))||((yt=we.url)==null?void 0:yt.match(/\.(mp3|wav|webm|m4a|ogg)$/i))});ce&&(ye({url:ce.url,name:ce.name,markers:ce.markers}),kt(Math.max(0,N-4e3)))},activeMarkerIds:((fk=J==null?void 0:J.markers)==null?void 0:fk.filter(N=>Y.has(N.id)).map(N=>N.id))||null,onMarkersChange:N=>{ze(new Set(N.map(K=>K.id)))},attachments:j,taskColor:Tn,availableTags:a.map(N=>({id:N.id,name:N.name,color:N.color,parent_id:N.parent_id,order_index:N.order_index})),onCreateTag:async N=>{if(!u)return null;try{const K=await u(N,null);if(K)return{id:K,name:N,color:"#6366f1"}}catch(K){console.error("Failed to create tag from editor",K),v==null||v({msg:"",type:"error"})}return null}})]}),Ut&&(()=>{var we,mt;const N=ct?Math.max(10,Math.min(ct.top,window.innerHeight-500)):0,K=ct?Math.min(ct.left+220,window.innerWidth-360):0,ce=c.jsx("div",{className:ct?"fixed w-[340px] shrink-0 animate-in slide-in-from-right-4 fade-in duration-300 flex flex-col max-h-[80vh] overflow-hidden bg-white rounded-2xl shadow-2xl":"w-full md:w-[340px] shrink-0 animate-in slide-in-from-right-4 md:slide-in-from-bottom-4 fade-in duration-500 border-l border-indigo-50 pl-0 md:pl-4 flex flex-col h-full overflow-hidden",style:ct?{top:N,left:K,zIndex:99998}:{},children:lt?c.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400 gap-4 bg-slate-50/50 rounded-2xl border border-dashed border-slate-200",children:[c.jsxs("div",{className:"relative",children:[c.jsx(fd,{size:32,className:"text-indigo-400 animate-pulse"}),c.jsx(As,{size:16,className:"absolute -top-1 -right-1 text-amber-400 animate-bounce"})]}),c.jsxs("div",{className:"flex flex-col items-center gap-1",children:[c.jsx("span",{className:"text-[11px] font-bold text-slate-500",children:"..."}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("div",{className:"w-1 h-1 bg-indigo-400 rounded-full animate-bounce [animation-delay:-0.3s]"}),c.jsx("div",{className:"w-1 h-1 bg-indigo-400 rounded-full animate-bounce [animation-delay:-0.15s]"}),c.jsx("div",{className:"w-1 h-1 bg-indigo-400 rounded-full animate-bounce"})]})]})]}):jn.length>0?c.jsxs("div",{className:"flex flex-col gap-2 h-full",children:[c.jsxs("div",{className:"flex items-center justify-between px-2 pt-2",children:[c.jsxs("span",{className:"text-xs font-bold text-slate-400 ml-1",children:[" ",er+1," / ",jn.length]}),c.jsxs("div",{className:"flex items-center gap-1 bg-slate-100 rounded-lg p-0.5",children:[c.jsx("button",{onClick:()=>{const yt=Math.max(0,er-1);ta(yt),tr(jn[yt].content)},disabled:er===0,className:"p-1 hover:bg-white rounded-md disabled:opacity-30 transition-all text-slate-600",title:"",children:c.jsx(Ou,{size:12})}),c.jsx("button",{onClick:()=>{const yt=Math.min(jn.length-1,er+1);ta(yt),tr(jn[yt].content)},disabled:er===jn.length-1,className:"p-1 hover:bg-white rounded-md disabled:opacity-30 transition-all text-slate-600",title:"",children:c.jsx(rs,{size:12})}),c.jsx("div",{className:"w-px h-3 bg-slate-300 mx-0.5"}),c.jsx("button",{onClick:()=>{const yt=jn.filter((Ot,Zt)=>Zt!==er);if(Pi(yt),yt.length!==0){const Ot=Math.min(er,yt.length-1);ta(Ot),tr(yt[Ot].content)}t&&o(t.id,{ai_history:yt},[],{skipHistory:!0})},className:"p-1 hover:bg-red-50 text-slate-400 hover:text-red-500 rounded-md transition-all",title:"",children:c.jsx(Er,{size:12})})]})]}),c.jsxs("div",{className:"bg-white rounded-2xl shadow-xl shadow-indigo-100/20 border border-indigo-50 overflow-hidden flex flex-col animate-in zoom-in-95 duration-300 flex-1",children:[c.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 p-3 shrink-0",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2 text-white",children:[c.jsx(fd,{size:16,className:"animate-pulse"}),c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-xs font-bold tracking-wider",children:"AI "}),c.jsx("span",{className:"text-[10px] text-indigo-100 opacity-80 truncate max-w-[200px]",children:(we=jn[er])==null?void 0:we.prompt})]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:()=>{Vt(""),et(!0)},className:"p-1 text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-colors",title:"",children:c.jsx(As,{size:14})}),c.jsx("button",{onClick:()=>{Ht(!1),ft(null)},className:"p-1 text-white/60 hover:text-white transition-colors",children:c.jsx(un,{size:14})})]})]})}),c.jsxs("div",{className:"p-4 flex flex-col gap-3 overflow-hidden flex-1",children:[de?c.jsx("textarea",{value:ll,onChange:yt=>tr(yt.target.value),className:"w-full h-full min-h-[200px] p-3 text-[13px] text-slate-700 leading-relaxed border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none resize-none"}):c.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar pr-1",children:c.jsx("div",{className:"markdown-content text-[13px] text-slate-700 leading-relaxed prose prose-sm prose-indigo max-w-none",children:c.jsx(ok,{children:((mt=jn[er])==null?void 0:mt.content)||""})})}),c.jsx("div",{className:"flex flex-col gap-2 pt-2 border-t border-slate-50 shrink-0",children:de?c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:()=>{const yt=[...jn];yt[er]={...yt[er],content:ll},Pi(yt),t&&o(t.id,{ai_history:yt},[],{skipHistory:!0}),Mt(!1)},className:"flex-1 flex items-center justify-center gap-2 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-indigo-200 active:scale-95",children:[c.jsx(Xn,{size:14}),""]}),c.jsx("button",{onClick:()=>{var yt;tr(((yt=jn[er])==null?void 0:yt.content)||""),Mt(!1)},className:"px-3 py-2 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-xl text-xs font-bold transition-all active:scale-95",children:""})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("button",{onClick:()=>{var yt;tr(((yt=jn[er])==null?void 0:yt.content)||""),Mt(!0)},className:"flex items-center justify-center gap-1.5 py-2 bg-slate-50 hover:bg-slate-100 text-slate-600 rounded-xl text-[11px] font-bold transition-all border border-slate-200 active:scale-95",children:[c.jsx(Iv,{size:13}),""]}),c.jsxs("button",{onClick:async()=>{var Ot,Zt;const yt=((Ot=a.find(tn=>tn.name.includes("")))==null?void 0:Ot.id)||await u("");yt&&(await i({title:` ${R||""}`,description:((Zt=jn[er])==null?void 0:Zt.content)||"",tags:[yt],status:"active",color:"purple"}),v==null||v({msg:"",type:"info"}))},className:"flex items-center justify-center gap-1.5 py-2 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-xl text-[11px] font-bold transition-all border border-purple-200 shadow-sm active:scale-95",children:[c.jsx(iu,{size:13}),""]})]}),c.jsxs("button",{onClick:()=>{var cn,kn;const yt=((cn=jn[er])==null?void 0:cn.content)||"",Ot=((kn=jn[er])==null?void 0:kn.prompt)||"",Zt=sE(yt);let tn="AI ";if(Ot){const Wt=Ot.replace(/<[^>]*>/g,"").trim();Wt.includes("")||Wt.includes("")||Wt.includes("")?tn="AI ":Wt.includes("")||Wt.includes("")||Wt.includes("")?tn="AI ":Wt.includes("")||Wt.includes("")||Wt.includes("")?tn="AI ":Wt.includes("")||Wt.includes("")?tn="AI ":Wt.includes("")||Wt.includes("")||Wt.includes("translate")?tn="AI ":Wt.includes("")||Wt.includes("")||Wt.includes("")?tn="AI ":Wt.includes("")||Wt.includes("")?tn="AI ":Wt.includes("")||Wt.includes("")?tn="AI ":Wt.includes("")||Wt.includes("")?tn="AI ":Wt.length>0&&(tn="AI "+Wt.slice(0,6).replace(/[]/g,""))}S(Wt=>Wt+`<p><br><strong>--- ${tn} ---</strong></p>`+Zt),v==null||v({msg:"",type:"info"}),Ht(!1)},className:"flex items-center justify-center gap-2 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-indigo-200 active:scale-95",children:[c.jsx(Nv,{size:14}),""]}),nt&&c.jsxs("button",{onClick:()=>{var yt;if(ue.current){const Ot=ue.current,Zt=nt.from,tn=((yt=jn[er])==null?void 0:yt.content)||"",cn=sE(tn),kn=Zt;Ot.commands.insertContentAt(nt,cn),setTimeout(()=>{Ot.chain().setTextSelection({from:Zt,to:kn}).setHighlight({color:"#fef08a"}).setTextSelection(kn).focus().run(),Lt({from:Zt,to:kn})},50),ft(null),Qe(null),Ht(!1),v==null||v({msg:"",type:"info"})}},className:"flex items-center justify-center gap-2 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-xl text-xs font-bold transition-all border border-green-200 shadow-sm active:scale-95",children:[c.jsx(Xn,{size:14}),""]})]})})]})]})]}):c.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400 gap-4 bg-slate-50/50 rounded-2xl border border-dashed border-slate-200",children:[c.jsx(fd,{size:32,className:"text-slate-300"}),c.jsx("span",{className:"text-xs text-slate-400",children:" AI "})]})});return ct?ir.createPortal(ce,document.body):ce})()]}),$.length>0&&c.jsx("div",{className:"grid grid-cols-4 gap-2 mt-2",children:$.map((N,K)=>{var yt;const ce=j.find(Ot=>Ot.url===N),we=N.match(/\.(jpg|jpeg|png|gif|webp|avif)/i)||((yt=ce==null?void 0:ce.type)==null?void 0:yt.startsWith("image/")),mt=(ce==null?void 0:ce.name)||"Image";return c.jsxs("div",{className:"relative group aspect-square rounded-lg overflow-hidden border border-gray-100 shadow-sm cursor-pointer bg-gray-50 flex items-center justify-center",onClick:()=>we?Ee(N):window.open(N,"_blank"),children:[we?c.jsx("img",{src:N,alt:mt,className:"w-full h-full object-cover transition-transform group-hover:scale-105"}):c.jsxs("div",{className:"flex flex-col items-center gap-1 p-2",children:[c.jsx("div",{className:"w-8 h-8 rounded bg-white border border-gray-200 flex items-center justify-center shadow-sm",children:c.jsx(ho,{size:16,className:"text-gray-400"})}),c.jsx("span",{className:"text-[9px] text-gray-500 truncate w-full px-1 text-center font-medium leading-tight",children:mt})]}),c.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors"}),!s&&c.jsx("button",{type:"button",onClick:Ot=>{Ot.stopPropagation(),HR(N)},className:"absolute top-1 right-1 p-1 bg-black/50 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-500 z-10",children:c.jsx(un,{size:10})})]},K)})}),j.length>0&&c.jsxs("div",{className:"mt-2",children:[c.jsxs("button",{type:"button",onClick:()=>xr(!hn),className:`w-full flex items-center justify-between gap-2 px-2.5 py-1.5 rounded-lg border transition-all ${hn?"bg-indigo-50 border-indigo-200":"bg-gray-50 border-gray-100 hover:bg-gray-100"}`,children:[c.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[c.jsx(ho,{size:12,className:hn?"text-indigo-500":"text-gray-400"}),c.jsxs("span",{className:`text-xs font-medium ${hn?"text-indigo-700":"text-gray-600"}`,children:[j.length," "]}),j.filter(N=>{var K;return((K=N.type)==null?void 0:K.startsWith("audio/"))||N.name.match(/\.(mp3|wav|ogg|m4a|webm)$/i)}).length>0&&c.jsxs("span",{className:"text-[10px] text-indigo-500 bg-indigo-50 px-1.5 py-0.5 rounded-full flex items-center gap-1",children:[c.jsx(o1,{size:9}),j.filter(N=>{var K;return((K=N.type)==null?void 0:K.startsWith("audio/"))||N.name.match(/\.(mp3|wav|ogg|m4a|webm)$/i)}).length]}),!hn&&c.jsx("span",{className:"text-[10px] text-gray-400 truncate max-w-[200px]",children:j.map(N=>N.name.split(".")[0]).join(", ")})]}),c.jsx(ts,{size:14,className:`text-gray-400 transition-transform ${hn?"rotate-180":""}`})]}),hn&&c.jsx("div",{className:"mt-1.5 space-y-1 animate-in slide-in-from-top-2 duration-200",children:j.map(N=>{var K;return c.jsxs("div",{className:`group flex items-center gap-2 px-2 py-1 rounded-md border transition-colors ${(J==null?void 0:J.url)===N.url?"bg-indigo-50 border-indigo-200 ring-1 ring-indigo-300/50":"bg-theme-card border-theme hover:border-theme"}`,children:[(K=N.type)!=null&&K.startsWith("audio/")||N.name.match(/\.(mp3|wav|ogg|m4a|webm|mp4)$/i)?c.jsx("button",{type:"button",onClick:ce=>{ce.preventDefault(),ye({url:N.url,name:N.name,markers:N.markers})},className:"p-0.5 text-indigo-500 bg-indigo-50 rounded-full hover:bg-indigo-100",children:c.jsx(o1,{size:10})}):c.jsx(ho,{size:10,className:"text-gray-400 flex-shrink-0"}),c.jsx("input",{ref:ce=>{ce&&dt===N.url&&(ce.focus(),Et(null))},type:"text",value:N.name,onChange:ce=>{const we=ce.target.value;W(mt=>mt.map(yt=>yt.url===N.url?{...yt,name:we}:yt))},onBlur:()=>{t&&o(t.id,{attachments:j},[],{skipHistory:!0})},onKeyDown:ce=>{var we;ce.key==="Enter"&&(ce.preventDefault(),ce.stopPropagation(),ce.target.blur(),(we=pt.current)==null||we.focus())},className:"flex-1 text-[11px] text-theme-secondary bg-transparent border-none focus:outline-none focus:bg-indigo-50/50 rounded px-1 truncate min-w-0"}),c.jsx("button",{type:"button",onClick:ce=>{ce.preventDefault(),fetch(N.url).then(we=>we.blob()).then(we=>{const mt=window.URL.createObjectURL(we),yt=document.createElement("a");yt.href=mt,yt.download=N.name,document.body.appendChild(yt),yt.click(),window.URL.revokeObjectURL(mt),document.body.removeChild(yt)}).catch(we=>console.error("Download failed:",we))},className:"p-0.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors opacity-0 group-hover:opacity-100",title:"",children:c.jsx(iu,{size:10})}),c.jsx("span",{className:"text-[9px] text-gray-400 flex-shrink-0",children:qR(N.size)}),!s&&c.jsx("button",{type:"button",onClick:()=>WR(N.url),className:"opacity-0 group-hover:opacity-100 p-0.5 hover:bg-red-50 rounded transition-all",children:c.jsx(un,{size:10,className:"text-gray-400 hover:text-red-500"})})]},N.url)})})]})]})}),c.jsxs("div",{className:"flex items-center justify-between pt-1 flex-col items-start gap-2",children:[P.length>0&&(()=>{const N=P.filter(ce=>{const we=a.find(mt=>mt.id===ce);return we&&!we.name.startsWith("#")}),K=P.filter(ce=>{const we=a.find(mt=>mt.id===ce);return we&&we.name.startsWith("#")});return c.jsxs("div",{className:"flex flex-col gap-2 px-1 w-full",children:[N.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1",children:N.map(ce=>{const we=a.find(mt=>mt.id===ce);return we?c.jsx(ED,{tag:we,onRemove:()=>O(mt=>mt.filter(yt=>yt!==ce))},ce):null})}),K.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1 pt-1 border-t border-emerald-100",children:K.map(ce=>{const we=a.find(mt=>mt.id===ce);return we?c.jsxs("div",{className:"flex items-center gap-1 h-5 px-2 rounded-full text-[10px] font-medium bg-emerald-50 text-emerald-700 border border-emerald-200",children:[c.jsx("span",{children:we.name}),!s&&c.jsx("button",{type:"button",onClick:()=>O(mt=>mt.filter(yt=>yt!==ce)),className:"hover:text-red-500 transition-colors",children:c.jsx(un,{size:10})})]},ce):null})})]})})(),c.jsxs("div",{className:`flex flex-col gap-3 w-full border-t border-gray-100 pt-3 mt-1 ${s?"pointer-events-none opacity-80":""}`,children:[c.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[!E&&c.jsxs("button",{type:"button",onClick:()=>I(new Date().toISOString()),className:"flex items-center gap-1 px-2 py-1.5 rounded-md bg-indigo-500/10 text-indigo-500 text-[10px] font-bold border border-indigo-500/20 hover:bg-indigo-500/20 transition-all animate-pulse hover:animate-none",title:"",children:[c.jsx(As,{size:11})," "]}),c.jsx(E_,{innerRef:B,label:"",value:E||void 0,onChange:I,theme:bn,tasks:l}),E&&c.jsx("div",{className:"flex items-center gap-2 bg-transparent rounded-md px-2 py-1 border border-theme",children:c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{ref:q,type:"checkbox",checked:Ce,onChange:N=>{const K=N.target.checked;Le(K),K||setTimeout(()=>{var ce,we;(ce=pe.current)==null||ce.focus(),(we=pe.current)==null||we.select()},50)},className:"w-3 h-3 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-tighter",children:""})]})}),E&&c.jsx(Cee,{value:Q,onChange:ke}),c.jsx(E_,{tabIndex:-1,label:"",value:C||void 0,onChange:_,colorClass:"text-red-500",tasks:l,theme:bn}),c.jsx(M1,{innerRef:Je,icon:zl,label:"",items:Lr,selectedIds:P,placeholder:"...",allowAdd:!0,onDeleteItem:d,multiSelect:!0,theme:bn,onSelect:async(N,K,ce)=>{if(N)O(we=>we.includes(N)?we.filter(mt=>mt!==N):[...we,N]);else if(K){const we=await u(K,ce??null);we&&O(mt=>[...mt,we])}}}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{type:"button",onClick:()=>fe(!Me),className:`flex items-center gap-1 px-2 py-1.5 rounded-md text-[10px] font-bold border transition-all ${Z?"bg-purple-50 text-purple-600 border-purple-200 hover:bg-purple-100":"bg-transparent text-theme-tertiary border-theme hover:bg-theme-hover"}`,title:"",children:[c.jsx(FI,{size:12}),Z&&Z.originalText||""]}),Me&&c.jsxs("div",{className:"absolute top-full left-0 mt-1 z-50 bg-white rounded-lg shadow-xl border border-gray-200 p-4 min-w-[280px]",children:[c.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-3",children:""}),c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsx("div",{className:"grid grid-cols-4 gap-1",children:[{type:"daily",label:""},{type:"weekly",label:""},{type:"monthly",label:""},{type:"yearly",label:""}].map(N=>c.jsx("button",{type:"button",onClick:()=>{ie(K=>({...K,type:N.type,interval:(K==null?void 0:K.interval)||1,originalText:`${(K==null?void 0:K.interval)||1}${N.type==="daily"?"":N.type==="weekly"?"":N.type==="monthly"?"":""}`,triggerMode:(K==null?void 0:K.triggerMode)||"on_complete"}))},className:`px-2 py-1.5 rounded text-xs font-medium transition-colors ${(Z==null?void 0:Z.type)===N.type?"bg-purple-500 text-white":"bg-gray-100 text-gray-600 hover:bg-purple-100"}`,children:N.label},N.type))})]}),Z&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-sm text-gray-600",children:""}),c.jsx("input",{type:"number",min:1,max:365,value:Z.interval,onChange:N=>{const K=Math.max(1,parseInt(N.target.value)||1);ie(ce=>ce?{...ce,interval:K,originalText:`${K}${ce.type==="daily"?"":ce.type==="weekly"?"":ce.type==="monthly"?"":""}`}:null)},className:"w-16 px-2 py-1 border border-gray-300 rounded text-sm text-center focus:border-purple-400 focus:outline-none"}),c.jsx("span",{className:"text-sm text-gray-600",children:Z.type==="daily"?"":Z.type==="weekly"?"":Z.type==="monthly"?"":""})]})]}),(Z==null?void 0:Z.type)==="monthly"&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-sm text-gray-600",children:""}),c.jsx("input",{type:"number",min:1,max:31,value:Z.monthDay||1,onChange:N=>{const K=Math.min(31,Math.max(1,parseInt(N.target.value)||1));ie(ce=>ce?{...ce,monthDay:K,originalText:`${ce.interval}${K}`}:null)},className:"w-16 px-2 py-1 border border-gray-300 rounded text-sm text-center focus:border-purple-400 focus:outline-none"}),c.jsx("span",{className:"text-sm text-gray-600",children:""})]})]}),Z&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-gray-50",children:[c.jsx("input",{type:"radio",name:"triggerMode",checked:Z.triggerMode!=="on_schedule",onChange:()=>ie(N=>N?{...N,triggerMode:"on_complete"}:null),className:"text-purple-500"}),c.jsxs("div",{children:[c.jsx("div",{className:"text-xs font-medium text-gray-700",children:""}),c.jsx("div",{className:"text-[10px] text-gray-400",children:""})]})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-gray-50",children:[c.jsx("input",{type:"radio",name:"triggerMode",checked:Z.triggerMode==="on_schedule",onChange:()=>ie(N=>N?{...N,triggerMode:"on_schedule"}:null),className:"text-purple-500"}),c.jsxs("div",{children:[c.jsx("div",{className:"text-xs font-medium text-gray-700",children:""}),c.jsx("div",{className:"text-[10px] text-gray-400",children:""})]})]})]})]}),Z&&c.jsx("div",{className:"mb-3",children:c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-gray-50",children:[c.jsx("input",{type:"checkbox",checked:Z.copyDescription!==!1,onChange:N=>ie(K=>K?{...K,copyDescription:N.target.checked}:null),className:"w-3.5 h-3.5 text-purple-600 rounded border-gray-300 focus:ring-purple-500"}),c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-xs font-medium text-gray-700",children:""}),c.jsx("span",{className:"text-[10px] text-gray-400",children:""})]})]})}),Z&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:" ()"}),c.jsx("input",{type:"date",value:Z.endDate||"",onChange:N=>ie(K=>K?{...K,endDate:N.target.value||void 0}:null),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:border-purple-400 focus:outline-none",placeholder:""}),Z.endDate&&c.jsx("button",{type:"button",onClick:()=>ie(N=>N?{...N,endDate:void 0}:null),className:"text-[10px] text-red-500 hover:underline mt-1",children:""})]}),c.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-100",children:[c.jsx("button",{type:"button",onClick:()=>{ie(null),fe(!1)},className:"text-xs text-red-500 hover:text-red-600 font-medium",children:""}),c.jsx("button",{type:"button",onClick:()=>fe(!1),className:"px-3 py-1 bg-purple-500 text-white text-xs font-medium rounded hover:bg-purple-600 transition-colors",children:""})]})]})]})]}),c.jsx(bo,{children:!Ce&&E&&c.jsxs(Pr.div,{initial:{height:0,opacity:0,marginTop:0},animate:{height:"auto",opacity:1,marginTop:0},exit:{height:0,opacity:0,marginTop:0},className:"overflow-hidden flex items-center gap-3 px-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ri,{size:12,className:"text-theme-tertiary"}),c.jsxs("div",{className:"flex items-center bg-transparent border border-theme rounded-md px-2 py-0.5",children:[c.jsx("input",{ref:pe,type:"text",value:Ve,onChange:N=>ck(N.target.value),onKeyDown:N=>{N.key==="Tab"?Vu(N):N.stopPropagation()},placeholder:"09:00",className:"bg-transparent border-none text-[11px] font-medium text-theme-primary focus:ring-0 outline-none p-0 w-12 placeholder:text-theme-tertiary"}),h.timeFormat==="12h"&&c.jsx("button",{onClick:()=>{const[N,K]=Ve.split(" ");K&&ck(`${N} ${K==="AM"?"PM":"AM"}`)},className:"text-[10px] font-bold text-theme-tertiary hover:text-theme-secondary ml-1",children:Ve.includes("PM")?"PM":"AM"})]}),c.jsx("span",{className:"text-theme-tertiary text-xs",children:""}),c.jsxs("div",{className:"flex items-center bg-transparent border border-theme rounded-md px-2 py-0.5",children:[c.jsx("input",{ref:De,type:"text",value:Be,onChange:N=>YR(N.target.value),onKeyDown:N=>{N.key==="Tab"?Vu(N):N.stopPropagation()},placeholder:"10:00",className:"bg-transparent border-none text-[11px] font-medium text-theme-primary focus:ring-0 outline-none p-0 w-12 placeholder:text-theme-tertiary"}),h.timeFormat==="12h"&&c.jsx("span",{className:"text-[9px] font-bold text-indigo-400 ml-1",children:(()=>{const N=Be.split(":");if(N.length!==2)return"";const K=parseInt(N[0]),ce=parseInt(N[1]);return isNaN(K)||isNaN(ce)?"":`${K%12||12}:${String(ce).padStart(2,"0")}${K<12?"AM":"PM"}`})()})]})]}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsxs("div",{className:"relative",children:[c.jsx("input",{ref:We,type:"text",placeholder:"",value:vt,onChange:N=>JR(N.target.value),onKeyDown:N=>{N.key==="Tab"?Vu(N):N.stopPropagation()},className:"w-14 bg-transparent border border-theme rounded-md px-2 py-0.5 text-[11px] font-medium text-theme-primary focus:ring-1 focus:ring-indigo-100 outline-none placeholder:text-theme-tertiary"}),c.jsx("span",{className:"absolute right-2 top-1.5 text-[8px] text-gray-400 font-bold pointer-events-none",children:"MIN"})]})})]})}),!s&&c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"file",ref:tt,className:"hidden",multiple:!0,accept:"image/*",onChange:ra}),c.jsxs("button",{type:"button",tabIndex:-1,onClick:()=>{var N;return(N=tt.current)==null?void 0:N.click()},className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border border-transparent hover:border-theme hover:bg-theme-hover text-theme-tertiary hover:text-theme-secondary focus:outline-none focus:bg-white focus:ring-1 ${(bn==null?void 0:bn.buttonRing)||"focus:ring-indigo-300"} focus:border-theme text-xs ${h.fontWeight==="thin"?"font-light":"font-medium"}`,children:[xt?c.jsx(yi,{size:13,className:"animate-spin"}):c.jsx(vf,{size:13}),c.jsx("span",{children:""})]}),c.jsx("input",{ref:Ne,type:"file",multiple:!0,className:"hidden",onChange:VR}),c.jsxs("button",{ref:pt,type:"button",tabIndex:-1,onClick:()=>{var N;return(N=Ne.current)==null?void 0:N.click()},className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border border-transparent hover:border-theme hover:bg-theme-hover text-theme-tertiary hover:text-theme-secondary focus:outline-none focus:bg-white focus:ring-1 ${(bn==null?void 0:bn.buttonRing)||"focus:ring-indigo-300"} focus:border-theme text-xs ${h.fontWeight==="thin"?"font-light":"font-medium"}`,children:[xt?c.jsx(yi,{size:13,className:"animate-spin"}):c.jsx(ho,{size:13}),c.jsx("span",{children:w("attachFiles")})]}),c.jsxs("button",{type:"button",tabIndex:-1,onMouseDown:N=>N.preventDefault(),onClick:()=>{di?Ir===(t==null?void 0:t.id)?ol():v==null||v({msg:"",type:"warning"}):t!=null&&t.id?il(t.id):v==null||v({msg:"",type:"warning"})},className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border border-transparent hover:border-theme hover:bg-theme-hover text-theme-tertiary hover:text-theme-secondary focus:outline-none focus:bg-theme-card focus:ring-1 ${(bn==null?void 0:bn.buttonRing)||"focus:ring-indigo-300"} focus:border-theme text-xs ${h.fontWeight==="thin"?"font-light":"font-medium"} ${di&&Ir===(t==null?void 0:t.id)?"text-red-500 animate-pulse":""}`,title:di?"":"",children:[c.jsx(LI,{size:13,strokeWidth:di&&Ir===(t==null?void 0:t.id)?3:2}),c.jsx("span",{children:di&&Ir===(t==null?void 0:t.id)?al(Co):""})]}),c.jsx(M1,{tabIndex:-1,icon:yp,label:"",items:br,allowAdd:!0,selectedIds:ge?[ge]:[],placeholder:"...",theme:bn,onSelect:async(N,K)=>{let ce=N;if(!ce&&K&&(ce=await i({title:K,is_project:!0,status:"inbox"})),!ce&&!N)return;const we=ce===ge?null:ce;me(we),t&&(we&&p(we,!0),await o(t.id,{parent_id:we},[]))}})]}),!ge&&c.jsxs("div",{className:"relative",children:[c.jsxs("button",{type:"button",onClick:()=>qe(!Re),className:"flex items-center gap-1.5 px-2 py-1.5 rounded-md border border-transparent hover:border-theme hover:bg-theme-hover transition-all group",title:"",children:[c.jsx("div",{className:`w-3 h-3 rounded-full ${((hk=Jn[at])==null?void 0:hk.dot)||"bg-gray-400"} group-hover:scale-110 transition-transform`}),c.jsx("span",{className:"text-xs text-theme-tertiary group-hover:text-theme-secondary",children:""})]}),Re&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>qe(!1)}),c.jsxs("div",{className:"absolute bottom-full left-0 mb-2 p-3 bg-white rounded-xl shadow-xl border border-gray-200 z-50 min-w-[200px] animate-in zoom-in-95 duration-100",children:[c.jsxs("div",{className:"text-xs font-semibold text-gray-500 mb-2 px-1 flex items-center gap-2",children:[c.jsx(jv,{size:12}),""]}),c.jsx("div",{className:"grid grid-cols-6 gap-2",children:Object.keys(Jn).map(N=>c.jsx("button",{type:"button",onClick:()=>{ae(N),qe(!1)},className:`w-5 h-5 rounded-full ${Jn[N].dot} ${at===N?"ring-2 ring-offset-2 ring-gray-400 scale-110":"hover:scale-125 opacity-80 hover:opacity-100"} transition-all shadow-sm`,title:N},N))})]})]})]}),c.jsx("div",{className:"flex gap-1 p-1 bg-theme-hover rounded-lg border border-theme",title:"",children:[{level:"urgent",color:"bg-red-500",label:"",icon:""},{level:"planned",color:"bg-yellow-400",label:"",icon:""},{level:"delegated",color:"bg-green-500",label:"",icon:""},{level:"optional",color:"bg-gray-400",label:"",icon:""}].map(({level:N,color:K,label:ce})=>c.jsx("button",{tabIndex:-1,type:"button",onClick:()=>le(_e===N?void 0:N),title:ce,className:`w-4 h-4 rounded-full ${K} ${_e===N?"ring-2 ring-offset-1 ring-gray-500 scale-110":"opacity-50 hover:opacity-100 hover:scale-105"} transition-all`},N))})]})]})]})]})]}),oe&&c.jsx("div",{className:"fixed inset-0 z-[100] bg-black/90 flex items-center justify-center p-4",onClick:()=>Ee(null),children:c.jsxs("div",{className:"relative max-w-full max-h-full",onClick:N=>N.stopPropagation(),children:[c.jsx("img",{src:oe,alt:"Preview",className:"max-w-full max-h-[90vh] rounded-lg shadow-2xl"}),c.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[c.jsx("a",{href:oe,download:`attachment-${Date.now()}`,target:"_blank",rel:"noopener noreferrer",onClick:N=>N.stopPropagation(),className:"p-2 bg-black/50 hover:bg-black/70 text-white rounded-full backdrop-blur-sm transition-colors",title:"Download",children:c.jsx(iu,{size:20})}),c.jsx("button",{onClick:()=>Ee(null),className:"p-2 bg-black/50 hover:bg-black/70 text-white rounded-full backdrop-blur-sm transition-colors",children:c.jsx(un,{size:20})})]})]})}),Hn.isOpen&&c.jsx("div",{className:"fixed inset-0 z-[150] flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm",onClick:()=>is({...Hn,isOpen:!1}),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 max-w-lg w-full animate-in zoom-in duration-200",onClick:N=>N.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[c.jsx(As,{size:18,className:"text-indigo-500"}),c.jsx("span",{children:w("aiPolishSuggestions")})]}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("button",{onClick:Mr,disabled:Hn.historyIndex<=0,className:"p-1.5 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors disabled:opacity-30 disabled:hover:bg-transparent disabled:hover:text-gray-500",title:w("undo"),children:c.jsx(Dg,{size:16})}),c.jsx("button",{onClick:z,disabled:Hn.historyIndex>=Hn.history.length-1,className:"p-1.5 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors disabled:opacity-30 disabled:hover:bg-transparent disabled:hover:text-gray-500",title:w("redo"),children:c.jsx(Mv,{size:16})})]})]}),c.jsxs("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2",children:w("suggestedTitle")}),c.jsx("input",{className:"w-full p-2 mb-3 bg-white border border-gray-200 rounded-lg text-sm text-gray-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none shadow-sm transition-all font-medium",value:Hn.title,onChange:N=>nr(N.target.value),onKeyDown:N=>{(N.ctrlKey||N.metaKey)&&N.key==="z"?(N.preventDefault(),N.stopPropagation(),N.shiftKey?z():Mr()):(N.ctrlKey||N.metaKey)&&N.key==="y"&&(N.preventDefault(),N.stopPropagation(),z())}}),c.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2",children:w("suggestedContent")}),c.jsx("textarea",{className:"w-full h-40 p-3 bg-white border border-gray-200 rounded-lg text-sm text-gray-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none resize-none leading-relaxed shadow-sm transition-all",value:Hn.content,onChange:N=>On(N.target.value),onKeyDown:N=>{(N.ctrlKey||N.metaKey)&&N.key==="z"?(N.preventDefault(),N.stopPropagation(),N.shiftKey?z():Mr()):(N.ctrlKey||N.metaKey)&&N.key==="y"&&(N.preventDefault(),N.stopPropagation(),z())}})]}),c.jsxs("div",{className:"flex gap-3 justify-end",children:[c.jsx("button",{onClick:()=>is({...Hn,isOpen:!1}),className:"px-4 py-1.5 text-gray-600 hover:bg-gray-100 rounded text-sm font-medium transition-colors",children:w("cancel")}),c.jsxs("button",{onClick:()=>{k(Hn.title),S(Hn.content),is({...Hn,isOpen:!1,history:[],historyIndex:-1}),v({msg:w("aiPolishApplied"),type:"info"})},className:"px-4 py-1.5 bg-[#2563EB] hover:bg-[#1d4ed8] text-white rounded text-sm font-medium shadow-sm transition-colors flex items-center gap-1.5",children:[c.jsx(Xn,{size:14,strokeWidth:3}),w("confirmReplace")]})]})]})})]})},Nee=["gray","blue","indigo","red","orange","amber","green","teal","cyan","sky","purple","fuchsia","pink","rose"],oE={gray:"bg-gray-400",blue:"bg-blue-500",indigo:"bg-indigo-500",red:"bg-red-500",orange:"bg-orange-500",amber:"bg-amber-500",green:"bg-green-500",teal:"bg-teal-500",cyan:"bg-cyan-500",sky:"bg-sky-500",purple:"bg-purple-500",fuchsia:"bg-fuchsia-500",pink:"bg-pink-500",rose:"bg-rose-500"},aE=({text:t,query:e})=>{if(!e.trim()||!t)return c.jsx(c.Fragment,{children:t});try{const n=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp(`(${n})`,"gi"),s=t.split(r);return c.jsx(c.Fragment,{children:s.map((i,o)=>i.toLowerCase()===e.toLowerCase()?c.jsx("mark",{className:"bg-yellow-200 text-yellow-900 px-0.5 rounded",children:i},o):c.jsx("span",{children:i},o))})}catch{return c.jsx(c.Fragment,{children:t})}},jee=({isOpen:t,onClose:e})=>{const{tasks:n,tags:r,searchHistory:s,addSearchHistory:i,deleteSearchHistory:o,setEditingTaskId:a,editingTaskId:l,navigateToTask:u,verifyTaskPassword:d,temporarilyUnlockTask:f,setToast:h}=x.useContext(En),[p,m]=x.useState(""),[y,b]=x.useState({tags:[],startDate:null,endDate:null,colors:[]}),[g,v]=x.useState("or"),[w,T]=x.useState(""),[R,k]=x.useState(!1),[M,S]=x.useState(""),[C,_]=x.useState(!1),E=x.useRef(null),[I,P]=x.useState(!1),[O,$]=x.useState(""),[A,j]=x.useState(null),[W,V]=x.useState(null);x.useEffect(()=>{t&&E.current&&E.current.focus()},[t]);const D=x.useMemo(()=>!p.trim()&&y.tags.length===0&&!y.startDate&&!y.endDate&&y.colors.length===0?[]:n.filter(ae=>{if(ae.status==="deleted")return!1;const _e=p.toLowerCase(),le=!p.trim()||ae.title.toLowerCase().includes(_e)||ae.description&&ae.description.toLowerCase().includes(_e);let Ce=!0;if(y.tags.length>0){const st=ae.tags||[];g==="and"?Ce=y.tags.every(Be=>st.includes(Be)):Ce=y.tags.some(Be=>st.includes(Be))}let Le=!0;if(y.startDate||y.endDate){const st=ae.start_date||ae.due_date;if(!st)Le=!1;else{const Be=vt=>{const te=new Date(vt);return isNaN(te.getTime())?NaN:te.setHours(0,0,0,0)},ht=Be(st);if(isNaN(ht))Le=!1;else{if(y.startDate){const vt=Be(y.startDate);!isNaN(vt)&&ht<vt&&(Le=!1)}if(y.endDate){const vt=Be(y.endDate);!isNaN(vt)&&ht>vt&&(Le=!1)}}}}const Ve=y.colors.length===0||y.colors.includes(ae.color);return le&&Ce&&Le&&Ve}),[n,p,y,g]),ge=()=>{(p.trim()||y.tags.length>0||y.startDate||y.endDate||y.colors.length>0)&&i(p,y)},me=()=>{M.trim()&&(i(p,y,M.trim()),S(""),_(!1))},F=ae=>{m(ae.query),b(ae.filters)},U=ae=>{b(_e=>({..._e,tags:_e.tags.includes(ae)?_e.tags.filter(le=>le!==ae):[..._e.tags,ae]}))},ne=ae=>{b(_e=>({..._e,colors:_e.colors.includes(ae)?_e.colors.filter(le=>le!==ae):[..._e.colors,ae]}))},Oe=()=>{b({tags:[],startDate:null,endDate:null,colors:[]})},at=y.tags.length>0||y.startDate||y.endDate||y.colors.length>0;return x.useEffect(()=>{if(!t)return;const ae=_e=>{var le,Ce,Le;if(_e.key===" "&&((le=document.activeElement)!=null&&le.closest("[data-search-modal]"))&&((Ce=document.activeElement)==null?void 0:Ce.tagName)!=="INPUT"&&((Le=document.activeElement)==null?void 0:Le.tagName)!=="TEXTAREA"&&_e.stopPropagation(),_e.key==="Escape"){if(l)return;e()}};return window.addEventListener("keydown",ae,!0),()=>window.removeEventListener("keydown",ae,!0)},[t,e,l]),t?c.jsxs(c.Fragment,{children:[ir.createPortal(c.jsx(bo,{children:c.jsx(Pr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-start justify-center pt-20",onClick:e,"data-search-modal":!0,children:c.jsxs(Pr.div,{initial:{opacity:0,scale:.95,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20},transition:{duration:.2},className:"w-full max-w-2xl bg-theme-card rounded-2xl shadow-2xl overflow-hidden",onClick:ae=>ae.stopPropagation(),children:[c.jsxs("div",{className:"p-4 border-b border-theme",children:[c.jsxs("div",{className:"flex items-center gap-3 bg-theme-hover rounded-xl px-4 py-3",children:[c.jsx(Hc,{size:20,className:"text-theme-tertiary"}),c.jsx("input",{ref:E,type:"text",value:p,onChange:ae=>m(ae.target.value),onKeyDown:ae=>{ae.key==="Enter"&&ge()},placeholder:"...",className:"flex-1 bg-transparent outline-none text-theme-primary placeholder-theme-tertiary"}),p&&c.jsx("button",{onClick:()=>m(""),className:"text-theme-tertiary hover:text-theme-primary",children:c.jsx(un,{size:18})})]}),c.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[c.jsxs("button",{onClick:()=>k(!R),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors ${R||at?"bg-indigo-100 text-indigo-700":"bg-theme-hover text-theme-secondary hover:bg-theme-hover/80"}`,children:[R?c.jsx(ts,{size:14}):c.jsx(rs,{size:14}),"",at&&c.jsx("span",{className:"ml-1 w-5 h-5 bg-indigo-500 text-white rounded-full flex items-center justify-center text-[10px]",children:y.tags.length+(y.startDate||y.endDate?1:0)+y.colors.length})]}),c.jsxs("button",{onClick:()=>{m(""),b({tags:[],startDate:null,endDate:null,colors:[]})},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium bg-theme-hover text-theme-secondary hover:bg-theme-hover/80 transition-colors",children:[c.jsx(Ri,{size:14}),"",s.length>0&&c.jsx("span",{className:"ml-1 w-5 h-5 bg-gray-500 text-white rounded-full flex items-center justify-center text-[10px]",children:s.length})]}),at&&c.jsx("button",{onClick:Oe,className:"text-xs text-theme-tertiary hover:text-theme-primary",children:""})]}),c.jsx(bo,{children:R&&c.jsxs(Pr.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-3 space-y-4 overflow-hidden",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary",children:[c.jsx(zl,{size:12}),"",y.tags.length>0&&c.jsx("span",{className:"px-1.5 py-0.5 bg-indigo-100 text-indigo-600 rounded-full text-[10px]",children:y.tags.length})]}),y.tags.length>1&&c.jsxs("div",{className:"flex items-center bg-theme-hover rounded-lg p-0.5",children:[c.jsx("button",{onClick:()=>v("or"),className:`px-2 py-0.5 text-[10px] font-bold rounded-md transition-all ${g==="or"?"bg-theme-card text-indigo-600 shadow-sm":"text-theme-tertiary"}`,children:" OR"}),c.jsx("button",{onClick:()=>v("and"),className:`px-2 py-0.5 text-[10px] font-bold rounded-md transition-all ${g==="and"?"bg-theme-card text-indigo-600 shadow-sm":"text-theme-tertiary"}`,children:" AND"})]})]}),c.jsxs("div",{className:"relative mb-2",children:[c.jsx("input",{type:"text",value:w,onChange:ae=>T(ae.target.value),placeholder:"...",className:"w-full px-3 py-1.5 bg-theme-hover rounded-lg text-xs border-0 focus:ring-2 focus:ring-indigo-500 pl-8 text-theme-primary"}),c.jsx(Hc,{size:12,className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-theme-tertiary"})]}),y.tags.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1.5 mb-2 p-2 bg-indigo-50 rounded-lg",children:y.tags.map(ae=>{const _e=r.find(le=>le.id===ae);return _e?c.jsxs("button",{onClick:()=>U(_e.id),className:"flex items-center gap-1.5 px-2 py-1 bg-indigo-500 text-white rounded-full text-xs font-medium hover:bg-indigo-600 transition-colors",children:[c.jsx("span",{children:_e.name}),c.jsx(un,{size:10})]},_e.id):null})}),c.jsxs("div",{className:"max-h-32 overflow-y-auto",children:[c.jsx("div",{className:"grid grid-cols-3 gap-1",children:r.filter(ae=>!y.tags.includes(ae.id)).filter(ae=>!w||ae.name.toLowerCase().includes(w.toLowerCase())).map(ae=>c.jsxs("button",{onClick:()=>U(ae.id),className:"flex items-center gap-1.5 px-2 py-1.5 bg-theme-hover hover:bg-theme-hover/80 rounded-lg text-xs text-theme-secondary transition-colors text-left",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-400 flex-shrink-0"}),c.jsx("span",{className:"truncate",children:ae.name})]},ae.id))}),r.filter(ae=>!y.tags.includes(ae.id)).filter(ae=>!w||ae.name.toLowerCase().includes(w.toLowerCase())).length===0&&c.jsx("div",{className:"text-center text-xs text-theme-tertiary py-2",children:""})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary",children:[c.jsx(vo,{size:12}),"",(y.startDate||y.endDate)&&c.jsx("span",{className:"px-1.5 py-0.5 bg-indigo-100 text-indigo-600 rounded-full text-[10px]",children:""})]}),(y.startDate||y.endDate)&&c.jsxs("button",{onClick:()=>b(ae=>({...ae,startDate:null,endDate:null})),className:"text-[10px] text-red-500 hover:text-red-600 flex items-center gap-1 z-10",children:[c.jsx(un,{size:10}),""]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"date",value:y.startDate||"",onChange:ae=>b(_e=>({..._e,startDate:ae.target.value||null})),className:"px-3 py-1.5 rounded-lg bg-theme-hover text-xs border-0 focus:ring-2 focus:ring-indigo-500 text-theme-primary"}),c.jsx("span",{className:"text-theme-tertiary",children:""}),c.jsx("input",{type:"date",value:y.endDate||"",onChange:ae=>b(_e=>({..._e,endDate:ae.target.value||null})),className:"px-3 py-1.5 rounded-lg bg-theme-hover text-xs border-0 focus:ring-2 focus:ring-indigo-500 text-theme-primary"}),(y.startDate||y.endDate)&&c.jsx("button",{onClick:()=>b(ae=>({...ae,startDate:null,endDate:null})),className:"p-1.5 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-colors",title:"",children:c.jsx(un,{size:14})})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary mb-2",children:[c.jsx(jv,{size:12}),""]}),c.jsx("div",{className:"flex flex-wrap gap-2",children:Nee.map(ae=>c.jsx("button",{onClick:()=>ne(ae),className:`w-6 h-6 rounded-full ${oE[ae]} transition-transform ${y.colors.includes(ae)?"ring-2 ring-offset-2 ring-indigo-500 scale-110":"hover:scale-110"}`},ae))})]})]})})]}),c.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:D.length>0?c.jsxs("div",{className:"p-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("span",{className:"text-xs font-medium text-theme-secondary",children:[" ",D.length," "]}),C?c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"text",value:M,onChange:ae=>S(ae.target.value),placeholder:"...",className:"px-2 py-1 text-xs border rounded-lg w-32 bg-theme-hover text-theme-primary border-theme",autoFocus:!0}),c.jsx("button",{onClick:me,className:"p-1 text-green-600 hover:text-green-700",children:c.jsx(Xn,{size:14})}),c.jsx("button",{onClick:()=>{_(!1),S("")},className:"p-1 text-theme-tertiary hover:text-theme-primary",children:c.jsx(un,{size:14})})]}):c.jsxs("button",{onClick:()=>_(!0),className:"flex items-center gap-1 text-xs text-indigo-600 hover:text-indigo-700",children:[c.jsx(UI,{size:12}),""]})]}),c.jsx("div",{className:"space-y-1",children:D.map(ae=>{const _e=ae.start_date||ae.due_date,le=_e?new Date(_e).toLocaleDateString("zh-TW",{year:"numeric",month:"short",day:"numeric"}):null,Ce=l===ae.id,Le=!!ae.is_locked,Ve=Le&&!ae.lock_password,st=ht=>{ht.stopPropagation(),Le?(j(ae.id),V("edit"),$(""),P(!0)):a(ae.id)},Be=ht=>{ht==null||ht.stopPropagation(),Le?(j(ae.id),V("navigate"),$(""),P(!0)):(a(null),u(ae.id,!0),e())};return c.jsx("div",{className:"rounded-xl hover:bg-theme-hover transition-colors border border-transparent hover:border-theme",children:Ce?c.jsx("div",{onClick:ht=>ht.stopPropagation(),onMouseDown:ht=>ht.stopPropagation(),children:c.jsx(Po,{initialData:ae,onClose:()=>a(null)})}):c.jsx("div",{className:"p-3",children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("div",{className:`w-3 h-3 rounded-full mt-1 flex-shrink-0 ${oE[ae.color]}`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:`font-medium text-theme-primary flex items-center gap-1.5 ${Ve?"blur-[4px] select-none":""}`,children:[Le&&c.jsx(La,{size:12,className:"text-amber-500 flex-shrink-0"}),c.jsx(aE,{text:ae.title,query:p})]}),ae.description&&!Ve&&c.jsx("div",{className:"text-sm text-theme-secondary mt-1 max-h-20 overflow-y-auto",children:c.jsx(aE,{text:ae.description.replace(/<[^>]*>/g,""),query:p})}),ae.tags.length>0&&!Ve&&c.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:ae.tags.map(ht=>{const vt=r.find(te=>te.id===ht);return vt?c.jsx("span",{className:"px-2 py-0.5 bg-theme-hover text-theme-secondary rounded-full text-[10px]",children:vt.name},ht):null})})]}),c.jsxs("div",{className:"flex flex-col items-end gap-1 flex-shrink-0",children:[le&&c.jsx("span",{className:"text-xs text-theme-tertiary",children:le}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:st,className:"p-1 text-theme-tertiary hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors",title:Le?"":"",children:c.jsx(Xn,{size:14})}),c.jsx("button",{onClick:Be,className:"p-1 text-theme-tertiary hover:text-emerald-600 hover:bg-emerald-50 rounded transition-colors",title:Le?"":"",children:c.jsx(II,{size:14})})]})]})]})})},ae.id)})})]}):p||at?c.jsxs("div",{className:"p-8 text-center text-theme-tertiary",children:[c.jsx(Hc,{size:32,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{children:""})]}):s.length>0?c.jsxs("div",{className:"p-4",children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary mb-3",children:[c.jsx(Ri,{size:12}),""]}),c.jsx("div",{className:"space-y-1",children:s.map(ae=>c.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-theme-hover group",children:[c.jsxs("button",{onClick:()=>F(ae),className:"flex-1 text-left",children:[c.jsx("div",{className:"font-medium text-theme-primary text-sm",children:ae.name||ae.query||"()"}),c.jsxs("div",{className:"text-xs text-theme-tertiary mt-0.5",children:[new Date(ae.created_at).toLocaleDateString(),ae.filters.tags.length>0&&`  ${ae.filters.tags.length} `,ae.filters.colors.length>0&&`  ${ae.filters.colors.length} `]})]}),c.jsx("button",{onClick:()=>o(ae.id),className:"p-1 text-theme-tertiary hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:c.jsx(Er,{size:14})})]},ae.id))})]}):c.jsxs("div",{className:"p-8 text-center text-theme-tertiary",children:[c.jsx(Hc,{size:32,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{children:""})]})}),c.jsx("div",{className:"p-3 border-t border-theme bg-theme-hover flex justify-between items-center text-xs text-theme-tertiary",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("span",{children:[c.jsx("kbd",{className:"px-1.5 py-0.5 bg-theme-card border border-theme rounded text-theme-primary",children:"Enter"})," "]}),c.jsxs("span",{children:[c.jsx("kbd",{className:"px-1.5 py-0.5 bg-theme-card border border-theme rounded text-theme-primary",children:"Esc"})," "]})]})})]})})}),document.body),I&&ir.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999]",onClick:()=>{P(!1),j(null),V(null)},children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-80 max-w-[90vw]",onClick:ae=>ae.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[c.jsx(La,{size:20,className:"text-amber-500"}),c.jsx("h3",{className:"text-lg font-bold",children:""})]}),c.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["",W==="edit"?"":"",""]}),c.jsx("input",{type:"password",placeholder:"",value:O,onChange:ae=>$(ae.target.value),onKeyDown:ae=>{ae.key==="Enter"&&A&&(d(A,O)?(f(A),W==="edit"?a(A):(a(null),u(A,!0),e()),P(!1),j(null),V(null)):h({msg:"",type:"error"})),ae.key==="Escape"&&(P(!1),j(null),V(null))},autoFocus:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-amber-500"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:()=>{P(!1),j(null),V(null)},className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:""}),c.jsx("button",{onClick:()=>{A&&(d(A,O)?(f(A),W==="edit"?a(A):(a(null),u(A,!0),e()),P(!1),j(null),V(null)):h({msg:"",type:"error"}))},className:"flex-1 px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors",children:""})]})]})}),document.body)]}):null},Iee=({current:t,total:e})=>{const n=e>0?Math.round(t/e*100):0;return ir.createPortal(c.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm",children:c.jsxs("div",{className:"bg-[#1e1e1e] p-6 rounded-xl shadow-2xl w-80 border border-white/10 text-center",children:[c.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Importing Calendar..."}),c.jsx("div",{className:"w-full bg-gray-700 h-2 rounded-full mb-2 overflow-hidden",children:c.jsx("div",{className:"bg-indigo-500 h-full transition-all duration-200",style:{width:`${n}%`}})}),c.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-2",children:[c.jsxs("span",{children:[t," / ",e]}),c.jsxs("span",{children:[n,"%"]})]})]})}),document.body)},Mee=["#6366f1","#f43f5e","#10b981","#f59e0b","#64748b"],Dee=({id:t,label:e,active:n,overdueCount:r,normalCount:s,icon:i,color:o,acceptsDrop:a,isEditing:l,editingViewName:u,setEditingViewName:d,setEditingViewId:f,saveViewName:h,setHoveredDropTarget:p,sidebarCollapsed:m,sidebarTextClass:y,sidebarFontClass:b,setView:g,setTagFilter:v,onEditFilter:w})=>{const{dragState:T,updateGhostPosition:R,endDrag:k,selectedTaskIds:M,moveTaskToView:S}=x.useContext(En),C=o||(n?"var(--accent-color)":void 0),_=x.useRef(!1),[E,I]=x.useState(!1),P=A=>{a&&(A.preventDefault(),A.stopPropagation(),_.current||(_.current=!0,I(!0),p(t)),R(A.clientX,A.clientY))},O=A=>{A.preventDefault(),_.current=!1,I(!1),p(null)},$=async A=>{if(A.preventDefault(),A.stopPropagation(),_.current=!1,I(!1),p(null),!a){k();return}const j=M.length>0?M:T!=null&&T.draggedId?[T.draggedId]:[];j.length>0&&await S(j,t),k()};return c.jsx("div",{className:`relative group/nav-wrapper transition-all ${E?"ring-2 ring-indigo-500 ring-inset rounded-lg bg-indigo-50 dark:bg-indigo-900/40":""}`,onDragOver:P,onDragLeave:O,onDrop:$,children:c.jsxs("button",{onClick:()=>{!l&&g&&(g(t),v&&v(null))},onDoubleClick:A=>{A.stopPropagation(),w&&w(t)},style:{pointerEvents:a&&(T!=null&&T.isDragging)?"none":"auto"},className:`w-full flex items-center ${m?"justify-center px-1":"justify-between px-3"} py-3 md:py-1 rounded-lg mb-1 md:mb-0 transition-colors touch-manipulation ${y} ${b} ${n?"bg-theme-hover text-theme-primary font-bold":"text-theme-secondary font-medium hover:bg-theme-hover hover:text-theme-primary active:bg-theme-hover"}`,title:m?e:"",children:[c.jsxs("div",{className:`flex items-center gap-2 ${m?"justify-center w-full":""}`,children:[i&&c.jsx(i,{size:16,style:{color:C},className:!o&&!n?"text-theme-tertiary":""}),!m&&(l?c.jsx("input",{autoFocus:!0,value:u,onChange:A=>d(A.target.value),onKeyDown:A=>{A.stopPropagation(),A.key==="Enter"?h(t,u):A.key==="Escape"&&f(null)},onBlur:()=>h(t,u),onClick:A=>A.stopPropagation(),className:"bg-theme-card border border-indigo-300 rounded px-1 py-0.5 text-xs outline-none focus:ring-1 focus:ring-indigo-500 w-20 text-theme-primary"}):c.jsx("span",{children:e}))]}),!m&&c.jsxs("div",{className:"flex gap-2 items-center",children:[r>0&&c.jsx("span",{className:"text-[11px] font-semibold text-white bg-rose-400 rounded-full px-3.5 py-0.5 min-w-[26px] text-center shadow-sm",children:r}),s>0&&(t==="matrix"?c.jsx("span",{className:"text-[11px] font-semibold text-white bg-yellow-400 rounded-full px-3.5 py-0.5 min-w-[26px] text-center shadow-sm",children:s}):c.jsx("span",{className:"text-[11px] text-gray-400 font-medium",children:s}))]})]})})},lE=({view:t,setView:e,tagFilter:n,setTagFilter:r})=>{const[s,i]=x.useState(null),{tasks:o,tags:a,themeSettings:l,setThemeSettings:u,deleteTag:d,updateTag:f,addTag:h,clearAllTasks:p,exportData:m,importData:y,syncGoogleToApp:b,expandedTags:g,setExpandedTags:v,sidebarCollapsed:w,toggleSidebar:T,tagsWithResolvedColors:R,t:k,language:M,setLanguage:S,setAdvancedFilters:C,viewTagFilters:_,updateViewTagFilter:E,visibleTasks:I,setFocusedTaskId:P,moveTaskToView:O,selectedTaskIds:$,dragState:A,updateGhostPosition:j,endDrag:W,addTask:V,batchAddTasks:D,updateTask:ge,batchUpdateTasks:me,setToast:F,deleteTask:U,batchDeleteTasks:ne,batchImportTasks:Oe,user:at,searchOpen:ae,setSearchOpen:_e,lockedGoogleTagIds:le,toggleGoogleTagLock:Ce}=x.useContext(En),[Le,Ve]=x.useState(!1),[st,Be]=x.useState(null),[ht,vt]=x.useState(null),[te,Z]=x.useState(""),[ie,he]=x.useState(()=>{try{return JSON.parse(localStorage.getItem("custom_view_names")||"{}")}catch{return{}}}),[se,Q]=x.useState(""),[ke,Me]=x.useState(!1),[fe,Re]=x.useState(null),[qe,xt]=x.useState(""),Dt=x.useRef(null),[oe,Ee]=x.useState({provider:localStorage.getItem("ai_provider")||"gemini",googleKey:localStorage.getItem("google_ai_key")||"",openaiKey:localStorage.getItem("openai_api_key")||"",baseUrl:localStorage.getItem("ai_base_url")||"https://api.openai.com/v1",modelName:localStorage.getItem("ai_model")||"gpt-3.5-turbo"}),[Ue,tt]=x.useState(null),[Ne,pt]=x.useState(null),[dt,Et]=x.useState(null),[ue,Se]=x.useState(""),[nt,ft]=x.useState(null),[ct,Qe]=x.useState(null),[It,Lt]=x.useState(()=>{const de=localStorage.getItem("sidebar_tags_expanded");return de!==null?de==="true":!0}),J=x.useRef(null),ye=x.useRef(null),[Ge,kt]=x.useState(!1),[Y,ze]=x.useState(localStorage.getItem("google_client_id")||""),[lt,X]=x.useState({start:new Date().toISOString().split("T")[0],end:new Date(new Date().setMonth(new Date().getMonth()+1)).toISOString().split("T")[0]}),[Fe,je]=x.useState("date"),[He,Ye]=x.useState([]),[ee,xe]=x.useState(new Set),[Pe,et]=x.useState(null),_t=x.useRef(null),Vt=x.useRef(null),Ft=x.useRef(null);l1(_t,()=>Ve(!1)),l1(Vt,()=>ft(null)),x.useEffect(()=>{const de=Mt=>{Mt.key==="Escape"&&st&&Be(null)};return window.addEventListener("keydown",de),()=>window.removeEventListener("keydown",de)},[st]),x.useEffect(()=>{st&&Q(ie[st]||"")},[st,ie]);const nn=async()=>{const de=o.filter(Ht=>Ht.tags.some($t=>{const rn=a.find(Dn=>Dn.id===$t);return rn&&rn.name.startsWith("Google:")}));if(de.length===0){alert(M==="zh"?" Google ":"No Google Calendar tasks found to delete");return}if(!confirm(M==="zh"?` ${de.length}  Google 
( App  Google )`:`Delete ${de.length} Google Calendar tasks?
(This will only delete local tasks, NOT Google Calendar events)`))return;const Mt=JSON.parse(localStorage.getItem("task_google_map")||"{}"),Ut=de.map(Ht=>Ht.id);Ut.forEach(Ht=>{delete Mt[Ht]}),localStorage.setItem("task_google_map",JSON.stringify(Mt)),localStorage.removeItem("google_sync_tokens"),await ne(Ut,!0),F({msg:` ${de.length}  Google `,type:"success"}),Ve(!1)};x.useEffect(()=>{const de=Mt=>{(Mt.metaKey||Mt.ctrlKey)&&Mt.shiftKey&&(Mt.key==="f"||Mt.key==="F"||Mt.key==="s"||Mt.key==="S")&&(Mt.preventDefault(),Mt.stopPropagation(),_e(!0)),Mt.key==="Escape"&&(nt?ft(null):ae&&_e(!1))};return window.addEventListener("keydown",de),()=>window.removeEventListener("keydown",de)},[ae,nt]),x.useEffect(()=>{ke&&Dt.current&&Dt.current.focus(),dt?Ft.current=dt:Ft.current&&setTimeout(()=>{const de=document.querySelector(`[data-tag-id="${Ft.current}"]`);de&&de.focus(),Ft.current=null},50)},[ke,dt]);const Xt=async()=>{if(!Y.trim()){alert(M==="zh"?" Settings  Google Client ID":"Please set Google Client ID in settings"),Ve(!0);return}localStorage.setItem("google_client_id",Y.trim());try{await vI(),ye.current||(ye.current=window.google.accounts.oauth2.initTokenClient({client_id:Y,scope:"https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar.readonly",callback:async de=>{if(de.error){console.error(de);return}await fn(de.access_token)}})),je("date"),kt(!0)}catch{alert("Failed to load Google Sign-In script")}},Jt=()=>{ye.current&&ye.current.requestAccessToken({prompt:""})},fn=async de=>{et(de),localStorage.setItem("google_access_token",de);try{const Mt=await kl(de);Ye(Mt);const Ut=Mt.find(Ht=>Ht.primary);Ut&&xe(new Set([Ut.id])),je("select")}catch(Mt){alert("Failed to fetch calendars: "+Mt),kt(!1)}},yn=async()=>{var de,Mt;if(Pe){kt(!1);try{i({current:0,total:0,importing:!0});let Ut=[],Ht=[];const $t=M==="zh"?"":"Schedule";let rn=(de=a.find(Rn=>Rn.name.toLowerCase()==="schedule"||Rn.name===""))==null?void 0:de.id;rn||(rn=await h($t,null));for(const Rn of Array.from(ee)){const hn=He.find(On=>On.id===Rn),xr=`Google:${(hn==null?void 0:hn.summary)||"Calendar"}`;let ar=(Mt=a.find(On=>On.name===xr))==null?void 0:Mt.id;ar||(ar=await h(xr,null));const js=await wI(Pe,Rn,lt.start,lt.end),qs=JSON.parse(localStorage.getItem("task_google_map")||"{}");js.forEach(On=>{const nr=!On.start.dateTime;let Mr=On.start.date,z=null,H=null;if(!nr&&On.start.dateTime){const q=new Date(On.start.dateTime),pe=q.getFullYear(),De=String(q.getMonth()+1).padStart(2,"0"),We=String(q.getDate()).padStart(2,"0");Mr=`${pe}-${De}-${We}`;const Je=String(q.getHours()).padStart(2,"0"),ot=String(q.getMinutes()).padStart(2,"0");if(z=`${Je}:${ot}`,On.end.dateTime){const Ct=new Date(On.end.dateTime),ut=String(Ct.getHours()).padStart(2,"0"),bt=String(Ct.getMinutes()).padStart(2,"0");H=`${ut}:${bt}`}}else Mr=On.start.date;const L={title:On.summary||"(No Title)",description:On.description||"",status:"active",tags:[rn,ar].filter(Boolean),start_date:Mr,start_time:z,end_time:H,is_all_day:nr,color:"blue",google_event_id:On.id,google_calendar_id:Rn},G=Object.keys(qs).find(q=>qs[q].evtId===On.id);let B=G?o.find(q=>q.id===G):null;B||(B=o.find(q=>q.title===(On.summary||"(No Title)")&&q.start_date===Mr&&!Object.keys(qs).includes(q.id))),B?Ht.push({id:B.id,data:L}):Ut.push(L)})}const Dn=Ut.length+Ht.length;D&&Ut.length>0&&await D(Ut,null,(Rn,hn)=>i({current:Rn,total:Dn,importing:!0})),me&&Ht.length>0&&await me(Ht);const Bn=He.filter(Rn=>!ee.has(Rn.id));let zn=0;for(const Rn of Bn){const hn=`Google:${Rn.summary}`,xr=a.find(ar=>ar.name===hn);xr&&(await d(xr.id),zn++,console.log(`[Import] Removed tag for unselected calendar: ${hn}`))}if(F){let Rn=`Synced ${Dn} events (Added: ${Ut.length}, Updated: ${Ht.length})`;zn>0&&(Rn+=`. Stopped sync for ${zn} unselected calendars.`),F({msg:Rn,type:"info"})}Dn===0&&alert("No events found")}catch(Ut){console.error(Ut),alert("Import Error: "+Ut.message)}finally{i(null)}}},_n=async(de,Mt=null)=>{de==null||de.preventDefault(),qe.trim()?(await h(qe.trim(),Mt),xt(""),Me(!1),Re(null),Mt&&!g.includes(Mt)&&v(Ut=>[...Ut,Mt])):(Me(!1),Re(null))},Fn=x.useMemo(()=>{const de=["prompt",""],Mt=["journal","note","",""],Ut=["someday","inspiration","","/"],Ht=["note","journal","",""],$t=["project",""],rn=["schedule",""],Dn=a.find(L=>de.some(G=>L.name.trim().toLowerCase()===G)),Bn=a.find(L=>Mt.some(G=>L.name.trim().toLowerCase()===G)),zn=a.find(L=>Ut.some(G=>L.name.trim().toLowerCase()===G)),Rn=a.find(L=>Ht.some(G=>L.name.trim().toLowerCase()===G)),hn=a.find(L=>$t.some(G=>L.name.trim().toLowerCase()===G)),xr=a.find(L=>L.name==="#prompt"),ar=a.find(L=>rn.some(G=>L.name.toLowerCase()===G)),js=Dn==null?void 0:Dn.id,qs=Bn==null?void 0:Bn.id,On=zn==null?void 0:zn.id,nr=Rn==null?void 0:Rn.id,Mr=hn==null?void 0:hn.id,z=xr==null?void 0:xr.id,H=ar==null?void 0:ar.id;return{inbox:o.filter(L=>{if(L.parent_id||L.status==="deleted"||L.status==="logged")return!1;if(!L.start_date&&!L.due_date&&(!L.tags||L.tags.length===0))return!0;const B=!!L.completed_at;return!(!(L.status==="inbox")&&!B||js&&L.tags.includes(js)||qs&&L.tags.includes(qs)||On&&L.tags.includes(On)||nr&&L.tags.includes(nr)||z&&L.tags.includes(z)||Mr&&L.tags.includes(Mr)&&o.some(De=>De.parent_id===L.id&&De.status!=="deleted")||!B&&(L.start_date||L.due_date))}).length,todayOverdue:(()=>o.filter(L=>!(L.status==="completed"||L.status==="deleted"||L.status==="logged"||L.status==="waiting"||L.status==="someday"||!Zx(L.start_date||L.due_date)||H&&L.tags.includes(H)||nr&&L.tags.includes(nr)||Mr&&L.tags.includes(Mr))).length)(),todayScheduled:(()=>o.filter(L=>!(L.status==="completed"||L.status==="deleted"||L.status==="logged"||L.status==="waiting"||L.status==="someday"||Zx(L.start_date||L.due_date)||!Cv(L.start_date||L.due_date)||H&&L.tags.includes(H)||nr&&L.tags.includes(nr)||Mr&&L.tags.includes(Mr))).length)(),prompt:o.filter(L=>L.status!=="deleted"&&L.status!=="logged"&&js&&L.tags.includes(js)&&!L.reviewed_at).length,logbook:o.filter(L=>L.status==="logged"&&!L.reviewed_at).length,waiting:o.filter(L=>L.status==="deleted"||L.status==="logged"?!1:(L.status==="waiting"||On&&L.tags.includes(On))&&!L.reviewed_at).length,trash:o.filter(L=>L.status==="deleted").length,note:o.filter(L=>L.status==="deleted"||L.status==="logged"?!1:nr&&L.tags.includes(nr)).length,matrixUrgent:o.filter(L=>L.parent_id||L.status==="deleted"||L.status==="logged"||L.status==="completed"||H&&L.tags.includes(H)?!1:L.importance==="urgent").length,matrixPlanned:o.filter(L=>L.parent_id||L.status==="deleted"||L.status==="logged"||L.status==="completed"||H&&L.tags.includes(H)?!1:L.importance==="important").length}},[o,a]),Hn={small:"text-xs",normal:"text-sm",large:"text-base"}[l.fontSize]||"text-sm",is={small:"text-xs",normal:"text-sm",large:"text-base"}[l.fontSize]||"text-sm",Gs=l.fontWeight==="thin"?"font-normal":"",ui=(de,Mt)=>{const Ut={...ie,[de]:Mt};he(Ut),localStorage.setItem("custom_view_names",JSON.stringify(Ut)),vt(null)},[Nn,Oi]=x.useState(null),Zo=async de=>{if(console.log("[Sidebar Drop] hoveredDropTarget:",Nn),!Nn||!A.isDragging)return;de.preventDefault(),de.stopPropagation();const Mt=$.length>0?$:A.draggedId?[A.draggedId]:[];console.log("[Sidebar Drop] Moving tasks:",Mt,"to:",Nn),Mt.length>0&&await O(Mt,Nn),Oi(null),W()},ea=x.useMemo(()=>{const de=(Mt,Ut)=>a.filter(Ht=>Ht.parent_id===Mt).sort((Ht,$t)=>(Ht.order_index||0)-($t.order_index||0)).map(Ht=>({id:Ht.id,name:Ht.name,depth:Ut,parent_id:Ht.parent_id,data:Ht,isExpanded:g.includes(Ht.id),children:de(Ht.id,Ut+1)}));return de(null,0)},[a,g]),di=(de,Mt)=>{Mt.stopPropagation(),v(Ut=>Ut.includes(de)?Ut.filter(Ht=>Ht!==de):[...Ut,de])},il=(de,Mt)=>{de.dataTransfer.setData("tag_id",Mt),tt(Mt)},ol=(de,Mt)=>{if(de.preventDefault(),Ue===Mt)return;const Ut=de.currentTarget.getBoundingClientRect(),Ht=de.clientY-Ut.top,$t=Ut.height;let rn="inside";Ht<$t*.25?rn="top":Ht>$t*.75&&(rn="bottom"),pt({id:Mt,position:rn})},Ir=async(de,Mt)=>{de.preventDefault();const Ut=de.dataTransfer.getData("tag_id");if(!Ut||Ut===Mt){pt(null),tt(null);return}const Ht=a.find(zn=>zn.id===Ut),$t=a.find(zn=>zn.id===Mt);if(!Ht||!$t)return;let rn=$t;for(;rn.parent_id;){if(rn.parent_id===Ut){pt(null),tt(null);return}const zn=a.find(Rn=>Rn.id===rn.parent_id);if(!zn)break;rn=zn}let Dn=Ht.parent_id,Bn=Ht.order_index||0;if((Ne==null?void 0:Ne.position)==="inside")Dn=Mt,Bn=a.filter(hn=>hn.parent_id===Mt).reduce((hn,xr)=>Math.max(hn,xr.order_index||0),0)+1e4,g.includes(Mt)||v(hn=>[...hn,Mt]);else{Dn=$t.parent_id;const zn=a.filter(hn=>hn.parent_id===$t.parent_id).sort((hn,xr)=>(hn.order_index||0)-(xr.order_index||0)),Rn=zn.findIndex(hn=>hn.id===Mt);if((Ne==null?void 0:Ne.position)==="top"){const hn=zn[Rn-1],xr=(hn==null?void 0:hn.order_index)||0,ar=$t.order_index||0;Bn=hn?(xr+ar)/2:ar-1e4}else{const hn=zn[Rn+1],xr=(hn==null?void 0:hn.order_index)||0,ar=$t.order_index||0;Bn=hn?(ar+xr)/2:ar+1e4}}await f(Ut,{parent_id:Dn,order_index:Bn}),pt(null),tt(null)},Co=async de=>{n===de&&r(null),await d(de)},al=de=>{Et(de.id),Se(de.name),ft(null)},cc=async()=>{dt&&ue.trim()&&(await f(dt,{name:ue}),Et(null))},jn=()=>{localStorage.setItem("ai_provider",oe.provider),localStorage.setItem("google_ai_key",oe.googleKey.trim()),localStorage.setItem("openai_api_key",oe.openaiKey.trim()),localStorage.setItem("ai_base_url",oe.baseUrl.trim()),localStorage.setItem("ai_model",oe.modelName.trim()),alert("AI Settings Saved!")},Pi=de=>{de.target.files&&de.target.files[0]&&(y(de.target.files[0]),Ve(!1))},er=de=>{dt||(r(de),e("inbox"),C({additionalTags:[],startDate:null,dueDate:null,color:null}),P(null))},ta=(de,Mt)=>{if(dt!==Mt){if(de.key==="ArrowRight"){de.preventDefault();const Ut=a.find(Ht=>Ht.id===Mt);Ut&&a.some(Ht=>Ht.parent_id===Mt)&&(g.includes(Mt)||v(Ht=>[...Ht,Ut.id]))}if(de.key==="ArrowLeft"){de.preventDefault();const Ut=a.find(Ht=>Ht.id===Mt);if(Ut)g.includes(Mt)&&v(Ht=>Ht.filter($t=>$t!==Mt));else if(Ut.parent_id){const Ht=document.querySelector(`[data-tag-id="${Ut.parent_id}"]`);Ht&&(Ht.focus(),er(Ut.parent_id))}}if(de.key==="ArrowDown"||de.key==="ArrowUp"){de.preventDefault();const Ut=Array.from(document.querySelectorAll("[data-tag-id]")),Ht=Ut.findIndex(Bn=>Bn.getAttribute("data-tag-id")===Mt);if(Ht===-1)return;const $t=de.key==="ArrowDown"?(Ht+1)%Ut.length:(Ht-1+Ut.length)%Ut.length,rn=Ut[$t];rn.focus();const Dn=rn.getAttribute("data-tag-id");Dn&&er(Dn)}if(de.key==="Tab"&&(de.preventDefault(),I.length>0&&P(I[0].data.id)),de.key==="Enter"){de.preventDefault();const Ut=a.find(Ht=>Ht.id===Mt);Ut&&al(Ut)}if(de.key==="Delete"||de.key==="Backspace"){de.preventDefault(),de.stopPropagation();const Ut=Mt;setTimeout(()=>{confirm(k("deleteTagConfirm"))&&Co(Ut)},10)}}},ll=de=>{const Mt=(Ne==null?void 0:Ne.id)===de.id;let Ut="border-transparent";Mt&&((Ne==null?void 0:Ne.position)==="top"?Ut="border-t-2 border-t-indigo-500":(Ne==null?void 0:Ne.position)==="bottom"?Ut="border-b-2 border-b-indigo-500":Ut="bg-indigo-50 ring-1 ring-indigo-500");const Ht=dt===de.id;return c.jsxs("div",{className:"relative",children:[c.jsxs("div",{"data-tag-id":de.id,draggable:!Ht,onDragStart:$t=>il($t,de.id),onDragOver:$t=>ol($t,de.id),onDrop:$t=>Ir($t,de.id),onDragLeave:()=>pt(null),className:`relative group flex items-center gap-0.5 py-0.5 rounded pr-1 transition-all select-none outline-none ${is} ${Gs} ${n===de.id?"bg-theme-hover text-indigo-600 font-bold":"text-theme-secondary font-medium hover:text-theme-primary hover:bg-theme-hover"} ${Ut} ${w?"justify-center pl-0":""}`,style:{paddingLeft:w?"0":`${de.depth*6+6}px`},onClick:()=>{Ht||er(de.id)},onDoubleClick:$t=>{$t.stopPropagation(),al(de)},tabIndex:0,onKeyDown:$t=>ta($t,de.id),children:[de.children.length>0?c.jsx("button",{onClick:$t=>di(de.id,$t),className:"p-0 hover:bg-theme-hover rounded text-theme-tertiary",children:de.isExpanded?c.jsx(ts,{size:10}):c.jsx(rs,{size:10})}):c.jsx("div",{className:"w-[10px]"}),Ht?c.jsxs("div",{className:"flex items-center flex-1 gap-1",children:[c.jsx("input",{autoFocus:!0,className:"flex-1 min-w-0 bg-theme-card border border-indigo-500/50 rounded px-1 py-0.5 text-xs outline-none focus:ring-1 focus:ring-indigo-500 text-theme-primary",value:ue,onChange:$t=>Se($t.target.value),onKeyDown:$t=>{$t.key==="Enter"?cc():$t.key==="Escape"&&Et(null)},onClick:$t=>$t.stopPropagation()}),c.jsx("button",{onClick:$t=>{$t.stopPropagation(),cc()},className:"text-green-600 hover:bg-green-100 p-0.5 rounded",children:c.jsx(Xn,{size:12})}),c.jsx("button",{onClick:$t=>{$t.stopPropagation(),Et(null)},className:"text-red-500 hover:bg-red-100 p-0.5 rounded",children:c.jsx(un,{size:12})})]}):c.jsxs(c.Fragment,{children:[!w&&c.jsxs("span",{className:"truncate flex-1 text-left flex items-center gap-1",style:R[de.id]?{color:R[de.id],opacity:.5}:void 0,children:[de.name.startsWith("#")?de.name.slice(1):de.name,de.name.startsWith("Google:")&&le.includes(de.id)&&c.jsx(La,{size:9,className:"text-amber-500 flex-shrink-0"})]}),!w&&c.jsxs("div",{className:"flex items-center opacity-0 group-hover:opacity-100 transition-opacity",children:[c.jsx("button",{onClick:$t=>{$t.stopPropagation(),Re(de.id),xt(""),de.isExpanded||v(rn=>[...rn,de.id])},className:"p-0.5 hover:bg-gray-200 rounded text-gray-400",title:k("addSubTag"),children:c.jsx(ni,{size:10})}),c.jsx("button",{onMouseDown:$t=>{$t.stopPropagation()},onClick:$t=>{$t.stopPropagation();const rn=$t.currentTarget.getBoundingClientRect(),Dn=180,Bn=window.innerHeight,Rn=rn.bottom+4+Dn>Bn?rn.top-Dn-4:rn.bottom+4;Qe({top:Math.max(8,Rn),left:Math.max(8,rn.right-208)}),ft(nt===de.id?null:de.id)},className:"p-0.5 hover:bg-gray-200 rounded text-gray-400",children:c.jsx(Rz,{size:10})})]}),nt===de.id&&ct&&ir.createPortal(c.jsxs("div",{ref:Vt,className:"fixed bg-theme-card rounded-xl shadow-2xl border border-theme p-3 w-52 animate-in fade-in slide-in-from-top-1 duration-200",style:{top:ct.top,left:Math.max(8,ct.left),zIndex:99999},onClick:$t=>$t.stopPropagation(),children:[c.jsxs("div",{className:"mb-3",children:[c.jsx("p",{className:"text-[9px] font-bold text-gray-400 mb-2 uppercase",children:k("tagStyle")}),c.jsx("div",{className:"grid grid-cols-5 gap-1.5 focus:outline-none",children:Mee.map($t=>c.jsx("button",{className:`w-6 h-6 rounded-full hover:scale-110 transition-transform ${de.data.color===$t?"ring-2 ring-offset-1 ring-indigo-500 shadow-sm":""}`,style:{backgroundColor:$t},onClick:rn=>{rn.stopPropagation(),f(de.id,{color:$t}),ft(null)},title:k("selectTagColor")},$t))})]}),c.jsxs("div",{className:"space-y-0.5",children:[c.jsxs("button",{onClick:()=>{Re(de.id),xt(""),ft(null),de.isExpanded||v($t=>[...$t,de.id])},className:"w-full flex items-center gap-2 px-2 py-1 hover:bg-theme-hover rounded text-[11px] text-theme-secondary font-medium",children:[c.jsx(ni,{size:11})," ",k("addSubTag")]}),c.jsxs("button",{onClick:()=>al(de),className:"w-full flex items-center gap-2 px-2 py-1 hover:bg-theme-hover rounded text-[11px] text-theme-secondary font-medium",children:[c.jsx(Mg,{size:11})," ",k("rename")]}),de.name.startsWith("Google:")&&c.jsx("button",{onClick:$t=>{$t.stopPropagation(),Ce(de.id),ft(null)},className:`w-full flex items-center gap-2 px-2 py-1 hover:bg-theme-hover rounded text-[11px] font-medium ${le.includes(de.id)?"text-amber-600":"text-theme-secondary"}`,children:le.includes(de.id)?c.jsxs(c.Fragment,{children:[c.jsx(i1,{size:11})," "]}):c.jsxs(c.Fragment,{children:[c.jsx(La,{size:11})," "]})}),c.jsxs("button",{onClick:$t=>{$t.stopPropagation();const rn=de.id;ft(null),setTimeout(()=>{confirm(k("deleteTagConfirm"))&&Co(rn)},10)},className:"w-full flex items-center gap-2 px-2 py-1 hover:bg-red-50 rounded text-[11px] text-red-600 font-medium",children:[c.jsx(Er,{size:11})," ",k("deleteTag")]})]})]}),document.body)]})]}),fe===de.id&&c.jsx("div",{className:"px-1 mb-0.5",style:{paddingLeft:`${(de.depth+1)*6+6}px`},children:c.jsx("form",{onSubmit:$t=>_n($t,de.id),className:"relative",children:c.jsx("input",{autoFocus:!0,value:qe,onChange:$t=>xt($t.target.value),onKeyDown:$t=>{$t.key==="Escape"&&Re(null),$t.stopPropagation()},onBlur:()=>{qe.trim()||Re(null)},placeholder:k("subTagPlaceholder"),className:"w-full text-[10px] py-1 px-2 bg-indigo-50/30 border border-indigo-100/50 rounded outline-none focus:ring-1 focus:ring-indigo-200 transition-all font-medium text-gray-700 placeholder:text-gray-300"})})}),de.isExpanded&&de.children.map($t=>ll($t))]},de.id)},tr=de=>{const Mt=ht===de.id,Ut=["logbook","recent","trash","worklog"].includes(de.id),Ht=ie[de.id]||de.label;return c.jsx(Dee,{...de,label:Ht,isEditing:Mt,editingViewName:te,setEditingViewName:Z,setEditingViewId:vt,saveViewName:ui,setHoveredDropTarget:Oi,sidebarCollapsed:w,sidebarTextClass:Hn,sidebarFontClass:Gs,setView:e,setTagFilter:r,onEditFilter:Ut?void 0:$t=>Be($t)})};return c.jsxs("aside",{className:"w-full bg-theme-sidebar border-r border-theme h-screen flex flex-col p-5 sticky top-0 overflow-hidden",onDragOver:de=>{A.isDragging&&(de.preventDefault(),j(de.clientX,de.clientY))},onDrop:Zo,children:[c.jsxs("div",{className:`mb-8 flex items-center ${w?"justify-center flex-col gap-4":"justify-between px-1"} opacity-60`,children:[!w&&c.jsxs("div",{className:"flex items-center gap-2 text-theme-secondary",children:[c.jsx(r1,{size:18})," ",c.jsx("span",{className:"text-xs font-bold tracking-widest uppercase text-theme-tertiary",children:k("appearance")})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:()=>_e(!0),className:"hover:bg-theme-hover p-1 rounded transition-colors text-theme-secondary",title:" (K)",children:c.jsx(Hc,{size:18})}),c.jsx("button",{onClick:T,className:"hover:bg-theme-hover p-1 rounded transition-colors text-theme-secondary",children:w?c.jsx(Lz,{size:18}):c.jsx(Pz,{size:18})})]})]}),c.jsxs("nav",{className:"flex-1 overflow-y-auto no-scrollbar py-2",children:[c.jsx("div",{className:"mb-6",children:c.jsx(tr,{id:"inbox",label:k("inbox"),normalCount:Fn.inbox,active:t==="inbox"&&!n,icon:n1,color:"#1badf8"})}),c.jsxs("div",{className:"mb-6",children:[c.jsx(tr,{id:"today",label:k("today"),overdueCount:Fn.todayOverdue,normalCount:Fn.todayScheduled,active:t==="today"&&!n,icon:VI,color:"#f5c94c",acceptsDrop:!0}),c.jsx(tr,{id:"allview",label:"",active:t==="allview"&&!n,icon:RI,color:"#10b981"}),c.jsx(tr,{id:"matrix",label:"",normalCount:Fn.matrixUrgent,active:t==="matrix",icon:r1,color:"#6366f1"})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx(tr,{id:"focus",label:"",active:t==="focus",icon:WI,color:"#ef4444"}),c.jsx(tr,{id:"project",label:"",active:t==="project",icon:gz,color:"#f97316",acceptsDrop:!0}),c.jsx(tr,{id:"annualplan",label:"",active:t==="annualplan",icon:hz,color:"#eab308"})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx(tr,{id:"waiting",label:"/",active:t==="waiting"&&!n,icon:Ri,color:"#a855f7",acceptsDrop:!0}),c.jsx(tr,{id:"journal",label:"",active:t==="journal"&&!n,icon:CI,color:"#34d399",acceptsDrop:!0}),c.jsx(tr,{id:"prompt",label:k("prompt"),normalCount:Fn.prompt,active:t==="prompt",icon:Ez,color:"#fbbf24",acceptsDrop:!0}),c.jsx(tr,{id:"worklog",label:"",active:t==="worklog",icon:Xf,color:"#0ea5e9"})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx(tr,{id:"logbook",label:k("logbook"),normalCount:Fn.logbook,active:t==="logbook",icon:am,color:"#a16207"}),c.jsx(tr,{id:"recent",label:"",active:t==="recent",icon:_z,color:"#0891b2"}),c.jsx(tr,{id:"trash",label:k("trash"),normalCount:Fn.trash>1e3?Fn.trash:void 0,active:t==="trash",icon:Er,color:"#9ca3af"})]}),!w&&c.jsxs("div",{className:"mt-2",children:[c.jsxs("div",{className:"flex items-center justify-between px-3 mb-2 group/tagheader cursor-pointer select-none",onClick:()=>{const de=!It;Lt(de),localStorage.setItem("sidebar_tags_expanded",String(de))},children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("p",{className:"text-[10px] font-bold text-gray-300 uppercase tracking-wider",children:"TAGS"}),c.jsx("span",{className:"text-gray-300 transition-transform duration-200",style:{transform:It?"rotate(0deg)":"rotate(-90deg)"},children:c.jsx(ts,{size:10})})]}),c.jsx("button",{onClick:de=>{de.stopPropagation(),Me(!0),It||Lt(!0)},className:"opacity-0 group-hover/tagheader:opacity-100 p-0.5 hover:bg-gray-100 rounded text-gray-400 hover:text-gray-600 transition-all flex items-center justify-center",title:"",children:c.jsx(ni,{size:10})})]}),It&&c.jsxs("div",{className:"overflow-hidden",children:[ke&&c.jsx("div",{className:"px-3 overflow-hidden mb-2",children:c.jsxs("form",{onSubmit:_n,className:"relative",children:[c.jsx("input",{ref:Dt,value:qe,onChange:de=>xt(de.target.value),onKeyDown:de=>{de.key==="Escape"&&Me(!1),de.stopPropagation()},onBlur:()=>{qe.trim()||Me(!1)},placeholder:"...",className:"w-full text-xs py-1.5 px-2 bg-indigo-50/50 border border-indigo-100 rounded-md outline-none focus:ring-1 focus:ring-indigo-300 transition-all font-medium text-gray-700 placeholder:text-gray-300"}),c.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1",children:qe.trim()&&c.jsx("button",{type:"submit",className:"text-indigo-500 hover:text-indigo-600",children:c.jsx(Xn,{size:12})})})]})}),c.jsxs("div",{className:"space-y-0",children:[ea.map(de=>ll(de)),!ke&&c.jsxs("button",{onClick:()=>Me(!0),className:"w-full group flex items-center gap-1.5 px-3 py-1 text-gray-300 hover:text-gray-400 text-xs transition-colors transition-opacity opacity-0 hover:opacity-100",children:[c.jsx(ni,{size:10}),c.jsx("span",{className:"font-medium",children:k("addTagPlaceholder")})]})]})]})]})]}),c.jsxs("div",{className:"mt-auto pt-4 border-t border-gray-200 relative",children:[c.jsxs("div",{className:`flex ${w?"justify-center flex-col gap-2":"justify-between"} items-center`,children:[!w&&c.jsxs("div",{className:"text-[10px] text-gray-400 flex items-center gap-1",children:[c.jsx(AI,{size:10})," ",W6]}),c.jsx("button",{onClick:()=>Ve(!Le),"aria-label":"Settings",className:"text-gray-400 hover:text-gray-600 p-1 rounded hover:bg-gray-100 transition-colors",children:c.jsx(HI,{size:14})})]}),Le&&c.jsx("div",{ref:_t,className:"absolute bottom-full left-0 mb-2 w-full bg-white rounded-lg shadow-xl border border-gray-200 z-50 animate-in fade-in zoom-in duration-100 max-h-[60vh] overflow-y-auto",children:c.jsxs("div",{className:"p-3",children:[c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider",children:k("appearance")}),c.jsxs("div",{className:"space-y-3 mb-4",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:k("language")})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>S("zh"),className:`flex-1 text-[10px] py-1 rounded ${M==="zh"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:M==="zh"?"":"Chinese"}),c.jsx("button",{onClick:()=>S("en"),className:`flex-1 text-[10px] py-1 rounded ${M==="en"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:M==="zh"?"":"English"})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:M==="zh"?"":"Color Theme"})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>u(de=>({...de,themeMode:"light"})),className:`flex-1 text-[10px] py-1 rounded ${l.themeMode==="light"||!l.themeMode?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:M==="zh"?"":"Light"}),c.jsx("button",{onClick:()=>u(de=>({...de,themeMode:"dark"})),className:`flex-1 text-[10px] py-1 rounded ${l.themeMode==="dark"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:M==="zh"?"":"Dark"}),c.jsx("button",{onClick:()=>u(de=>({...de,themeMode:"programmer"})),className:`flex-1 text-[10px] py-1 rounded ${l.themeMode==="programmer"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:M==="zh"?"":"Dev"})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:k("fontSize")})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>u(de=>({...de,fontSize:"small"})),className:`flex-1 text-[10px] py-1 rounded ${l.fontSize==="small"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:k("sizeSmall")}),c.jsx("button",{onClick:()=>u(de=>({...de,fontSize:"normal"})),className:`flex-1 text-[10px] py-1 rounded ${l.fontSize==="normal"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:k("sizeNormal")}),c.jsx("button",{onClick:()=>u(de=>({...de,fontSize:"large"})),className:`flex-1 text-[10px] py-1 rounded ${l.fontSize==="large"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:k("sizeLarge")})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:k("timeFormat")})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>u(de=>({...de,timeFormat:"24h"})),className:`flex-1 text-[10px] py-1 rounded ${l.timeFormat==="24h"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:"24H"}),c.jsx("button",{onClick:()=>u(de=>({...de,timeFormat:"12h"})),className:`flex-1 text-[10px] py-1 rounded ${l.timeFormat==="12h"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:"12H"})]})]})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:k("calendarSettings")}),c.jsxs("div",{className:"mb-4 space-y-2",children:[c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showLunar,onChange:de=>u({...l,showLunar:de.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:k("showLunar")})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showTaiwanHolidays,onChange:de=>u({...l,showTaiwanHolidays:de.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:k("showTaiwanHolidays")})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showRelationshipLines!==!1,onChange:de=>u({...l,showRelationshipLines:de.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:""})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showImportedGoogleEvents!==!1,onChange:de=>u({...l,showImportedGoogleEvents:de.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:M==="zh"?" Google ":"Show Google Events"})]})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:"Google Calendar"}),c.jsxs("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"Client ID"}),c.jsx("input",{type:"text",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"your-client-id.apps.googleusercontent.com",value:Y,onChange:de=>ze(de.target.value)})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:k("aiSettings")}),c.jsxs("div",{className:"mb-4 space-y-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] font-bold text-gray-400 uppercase mb-1",children:k("provider")}),c.jsxs("select",{value:oe.provider,onChange:de=>Ee(Mt=>({...Mt,provider:de.target.value})),className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",children:[c.jsx("option",{value:"gemini",children:"Google Gemini"}),c.jsx("option",{value:"openai",children:"OpenAI Compatible (DeepSeek/Moonshot)"})]})]}),oe.provider==="gemini"?c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsx("span",{className:"text-xs text-gray-600",children:"Gemini API Key"}),c.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-indigo-500 hover:underline",children:"Get Key"})]}),c.jsx("input",{type:"password",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"AIza...",value:oe.googleKey,onChange:de=>Ee(Mt=>({...Mt,googleKey:de.target.value}))})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"Base URL"}),c.jsx("input",{type:"text",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"https://api.deepseek.com",value:oe.baseUrl,onChange:de=>Ee(Mt=>({...Mt,baseUrl:de.target.value}))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"API Key"}),c.jsx("input",{type:"password",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"sk-...",value:oe.openaiKey,onChange:de=>Ee(Mt=>({...Mt,openaiKey:de.target.value}))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"Model Name"}),c.jsx("input",{type:"text",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"e.g. deepseek-chat",value:oe.modelName,onChange:de=>Ee(Mt=>({...Mt,modelName:de.target.value}))})]})]}),c.jsx("button",{onClick:jn,className:"w-full bg-indigo-600 text-white px-2 py-1.5 rounded text-xs hover:bg-indigo-700 transition-colors font-medium",children:"Save Settings"})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:"Data"}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("button",{onClick:()=>{confirm(M==="zh"?"":"Are you sure you want to delete all tasks? A backup will be downloaded first.")&&p()},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(Er,{size:12})," ",M==="zh"?"":"Delete All Tasks"]}),c.jsxs("button",{onClick:m,className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(iu,{size:12})," ",M==="zh"?"":"Backup Data"]}),c.jsxs("button",{onClick:()=>{var de;return(de=J.current)==null?void 0:de.click()},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(Kz,{size:12})," ",M==="zh"?"":"Import Data"]}),c.jsxs("button",{onClick:Xt,className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(vo,{size:12})," ",M==="zh"?" Google ":"Import Google Calendar"]}),c.jsxs("button",{onClick:()=>b&&b(),className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(s1,{size:12})," ",M==="zh"?" Google ":"Sync Google Calendar"]}),c.jsxs("button",{onClick:()=>{localStorage.removeItem("google_sync_tokens"),F({msg:"Sync tokens ...",type:"info"}),b&&b()},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-amber-50 rounded text-xs text-amber-600",children:[c.jsx(s1,{size:12})," ",M==="zh"?"":"Force Full Sync"]}),c.jsxs("button",{onClick:nn,className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-red-600",children:[c.jsx(Er,{size:12})," ",M==="zh"?"":"Clear Imported Calendar"]}),c.jsxs("button",{onClick:async()=>{if(!confirm("Google:( Google )"))return;const de=JSON.parse(localStorage.getItem("task_google_map")||"{}"),Mt=o.filter(Ht=>Ht.tags.some($t=>{const rn=a.find(Dn=>Dn.id===$t);return rn&&rn.name.includes("")&&rn.name.toLowerCase().includes("google")}));let Ut=0;Mt.forEach(Ht=>{de[Ht.id]&&delete de[Ht.id]}),localStorage.setItem("task_google_map",JSON.stringify(de));for(const Ht of Mt)await U(Ht.id),Ut++;F({msg:` ${Ut} `,type:"success"})},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-orange-600",children:[c.jsx(Er,{size:12})," ",M==="zh"?" ()":"Clean CiXing Tasks (Local)"]}),c.jsx("input",{type:"file",ref:J,className:"hidden",accept:".json",onChange:Pi})]})]})})]}),st&&ir.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-[9999] flex items-center justify-center",onClick:()=>Be(null),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-80 max-h-[80vh] flex flex-col overflow-hidden",onClick:de=>de.stopPropagation(),children:[c.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h3",{className:"font-bold text-gray-700 text-sm",children:""}),c.jsx("button",{onClick:()=>Be(null),className:"text-gray-400 hover:text-gray-600",children:c.jsx(un,{size:16})})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-xs text-gray-500",children:""}),c.jsx("input",{type:"text",value:se,onChange:de=>Q(de.target.value),onBlur:()=>{const de={...ie};se.trim()?de[st]=se:delete de[st],he(de),localStorage.setItem("custom_view_names",JSON.stringify(de))},onKeyDown:de=>{de.key==="Enter"&&de.target.blur()},className:"flex-1 px-2 py-1 text-sm border border-gray-200 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:k(st)||st})]})]}),c.jsxs("div",{className:"p-2 overflow-y-auto flex-1 text-sm",children:[c.jsx("p",{className:"px-2 py-2 text-xs text-gray-500 mb-2 bg-yellow-50 rounded border border-yellow-100",children:" () /  () / "}),c.jsx("div",{className:"space-y-1",children:a.map(de=>{const Mt=_[st]||{include:[],exclude:[]},{include:Ut,exclude:Ht}=Array.isArray(Mt)?{include:Mt,exclude:[]}:Mt,$t=Ut.includes(de.id),rn=Ht.includes(de.id);return c.jsxs("div",{className:"flex items-center gap-2 px-2 py-2 hover:bg-gray-50 rounded cursor-pointer select-none",onClick:()=>{let Dn=[...Ut],Bn=[...Ht];$t?(Dn=Dn.filter(zn=>zn!==de.id),Bn.push(de.id)):rn?Bn=Bn.filter(zn=>zn!==de.id):Dn.push(de.id),E(st,{include:Dn,exclude:Bn})},children:[c.jsxs("div",{className:"w-5 h-5 flex items-center justify-center",children:[$t&&c.jsx(bf,{size:16,className:"text-green-500"}),rn&&c.jsx(Yz,{size:16,className:"text-red-500"}),!$t&&!rn&&c.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300"})]}),c.jsx("span",{style:{color:R[de.id]},children:de.name.startsWith("#")?de.name.slice(1):de.name})]},de.id)})})]}),c.jsx("div",{className:"p-3 border-t border-gray-100 flex justify-end",children:c.jsx("button",{onClick:()=>Be(null),className:"px-4 py-1.5 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700",children:""})})]})}),document.body),Ge&&ir.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-[9999] flex items-center justify-center",onClick:()=>kt(!1),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-96 p-4 max-h-[80vh] flex flex-col",onClick:de=>de.stopPropagation(),children:[c.jsx("h3",{className:"font-bold text-gray-700 text-sm mb-4",children:Fe==="date"?M==="zh"?"":"Select Date Range":M==="zh"?"":"Select Calendars"}),Fe==="date"?c.jsxs("div",{className:"space-y-3 mb-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Start Date"}),c.jsx("input",{type:"date",className:"w-full border border-gray-200 rounded px-2 py-1 text-sm outline-none focus:ring-1 focus:ring-indigo-500",value:lt.start,onChange:de=>X(Mt=>({...Mt,start:de.target.value}))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"End Date"}),c.jsx("input",{type:"date",className:"w-full border border-gray-200 rounded px-2 py-1 text-sm outline-none focus:ring-1 focus:ring-indigo-500",value:lt.end,onChange:de=>X(Mt=>({...Mt,end:de.target.value}))})]}),c.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[c.jsx("button",{onClick:()=>kt(!1),className:"px-3 py-1.5 text-gray-500 hover:bg-gray-100 rounded text-xs",children:"Cancel"}),c.jsx("button",{onClick:Jt,className:"px-3 py-1.5 bg-indigo-600 text-white rounded text-xs font-medium hover:bg-indigo-700",children:"Next"})]})]}):c.jsxs("div",{className:"mb-4 flex flex-col flex-1 overflow-hidden",children:[c.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 mb-4 border border-gray-100 rounded p-2",children:He.map(de=>c.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer hover:bg-gray-50 p-1 rounded",children:[c.jsx("input",{type:"checkbox",checked:ee.has(de.id),onChange:Mt=>{const Ut=new Set(ee);Mt.target.checked?Ut.add(de.id):Ut.delete(de.id),xe(Ut)},className:"rounded text-indigo-600 focus:ring-indigo-500"}),c.jsx("span",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:de.backgroundColor||"#ccc"}}),c.jsx("span",{className:"truncate",children:de.summary})]},de.id))}),c.jsxs("div",{className:"flex justify-end gap-2 mt-auto",children:[c.jsx("button",{onClick:()=>je("date"),className:"px-3 py-1.5 text-gray-500 hover:bg-gray-100 rounded text-xs",children:"Back"}),c.jsx("button",{onClick:yn,disabled:ee.size===0,className:"px-3 py-1.5 bg-indigo-600 text-white rounded text-xs font-medium hover:bg-indigo-700 disabled:opacity-50",children:"Import"})]})]})]})}),document.body),s&&c.jsx(Iee,{current:s.current,total:s.total}),c.jsx(jee,{isOpen:ae,onClose:()=>_e(!1)})]})},Aee=({initialTitle:t,onSave:e,onCancel:n,onSwitchToFull:r,className:s,fontClass:i})=>{const[o,a]=x.useState(t),l=x.useRef(null);x.useEffect(()=>{const d=setTimeout(()=>{if(l.current){l.current.focus();const f=l.current.value.length;l.current.setSelectionRange(f,f)}},50);return()=>clearTimeout(d)},[]);const u=d=>{d.stopPropagation(),d.key==="Enter"&&(d.preventDefault(),d.metaKey||d.ctrlKey?r(o):e(o)),d.key==="Escape"&&(d.preventDefault(),n())};return c.jsx("input",{ref:l,autoFocus:!0,value:o,onChange:d=>a(d.target.value),onBlur:()=>e(o),onKeyDown:u,onClick:d=>d.stopPropagation(),className:`bg-transparent outline-none border-none p-0 m-0 w-full text-gray-900 dark:text-gray-100 caret-gray-900 dark:caret-gray-100 font-normal ${i}`})},xl=({flatTask:t,isFocused:e,onEdit:n,onSelect:r,backgroundColor:s})=>{const{updateTask:i,setFocusedTaskId:o,editingTaskId:a,setEditingTaskId:l,inlineEditingTaskId:u,setInlineEditingTaskId:d,addTask:f,toggleExpansion:h,startDrag:p,keyboardMove:m,tasks:y,tags:b,dragState:g,navigateBack:v,view:w,canNavigateBack:T,smartReschedule:R,lockTask:k,unlockTask:M,verifyTaskPassword:S,temporarilyUnlockTask:C,selectedTaskIds:_,handleSelection:E,themeSettings:I,pendingFocusTaskId:P,setPendingFocusTaskId:O,setSelectedTaskIds:$,visibleTasks:A,t:j,language:W,batchDeleteTasks:V,batchUpdateTasks:D,setToast:ge,tagFilter:me}=x.useContext(En),{recordingTaskId:F}=x.useContext(Ru),U=t.data,ne=x.useRef(null),Oe=x.useRef(null),at=x.useRef(null),[ae,_e]=x.useState(!1),[le,Ce]=x.useState(null),Le=typeof window<"u"&&window.innerWidth<768,[Ve,st]=x.useState(!1),[Be,ht]=x.useState("lock"),[vt,te]=x.useState(""),[Z,ie]=x.useState(null),he=t.isExpanded,se=t.hasChildren,Q=!!U.completed_at&&(U.status==="completed"||U.status==="logged"),ke=U.status==="canceled",Me=Q||ke,fe=_.includes(U.id),Re=!!U.is_locked;Re&&U.lock_password;const qe=Re&&!U.lock_password,xt=ee=>{if(!ee)return null;switch(ee){case"urgent":return"red";case"planned":return"amber";case"delegated":return"green";case"unplanned":return"gray";default:return null}},Dt=ee=>{const xe=xt(ee.importance);if(xe)return xe;let Pe=ee;const et=new Set;for(;Pe.parent_id&&!et.has(Pe.id);){et.add(Pe.id);const _t=y.find(Vt=>Vt.id===Pe.parent_id);if(!_t)break;Pe=_t}return Pe.color||"blue"},oe=!1;x.useEffect(()=>{e&&ne.current&&ne.current.focus({preventScroll:!0})},[e]),x.useEffect(()=>{P===U.id&&(O(null),o(U.id),setTimeout(()=>{d(U.id)},50))},[P,U.id,O,o,d]);const Ee=ee=>{ee?U.status===ee?i(U.id,{status:"active",completed_at:null}):i(U.id,{status:ee,completed_at:new Date().toISOString()}):Q||ke?i(U.id,{status:"active",completed_at:null}):i(U.id,{status:"completed",completed_at:new Date().toISOString()})},Ue=ee=>ee.start_date?new Date(ee.start_date).toISOString().split("T")[0]:ee.due_date?new Date(ee.due_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],tt=ee=>{if(w!=="today")return!1;const Pe=(_.includes(U.id)?_:[U.id]).map(et=>A.findIndex(_t=>_t.data.id===et)).filter(et=>et!==-1).sort((et,_t)=>et-_t);if(Pe.length===0)return!1;if(ee==="up"){const et=Pe[0];if(et===0)return!0;const _t=A[et].data,Vt=A[et-1].data;return Ue(Vt)!==Ue(_t)}else{const et=Pe[Pe.length-1];if(et===A.length-1)return!0;const _t=A[et].data,Vt=A[et+1].data;return Ue(Vt)!==Ue(_t)}},Ne=ee=>{const xe=_.includes(U.id)?_:[U.id],Pe=xe.map(Jt=>y.find(fn=>fn.id===Jt)).filter(Jt=>Jt!==void 0).sort((Jt,fn)=>{var Fn,Hn;const yn=((Fn=Jt.view_orders)==null?void 0:Fn.today)??0,_n=((Hn=fn.view_orders)==null?void 0:Hn.today)??0;return yn-_n});if(Pe.length===0)return;const et=Pe[0],_t=et.start_date?new Date(et.start_date):new Date,Vt=new Date(_t);Vt.setDate(Vt.getDate()+(ee==="up"?-1:1));const Ft=Vt.toISOString().split("T")[0],nn=y.filter(Jt=>{var yn,_n;return(((yn=Jt.start_date)==null?void 0:yn.split("T")[0])||((_n=Jt.due_date)==null?void 0:_n.split("T")[0]))===Ft&&!xe.includes(Jt.id)}).sort((Jt,fn)=>{var Fn,Hn;const yn=((Fn=Jt.view_orders)==null?void 0:Fn.today)??0,_n=((Hn=fn.view_orders)==null?void 0:Hn.today)??0;return yn-_n});let Xt;ee==="up"?Xt=nn.reduce((fn,yn)=>{var _n;return Math.max(fn,((_n=yn.view_orders)==null?void 0:_n.today)??0)},0)+1e4:Xt=nn.reduce((fn,yn)=>{var _n;return Math.min(fn,((_n=yn.view_orders)==null?void 0:_n.today)??9e8)},9e8)-(Pe.length+1)*1e4,D(Pe.map((Jt,fn)=>({id:Jt.id,data:{start_date:Ft,is_all_day:!0,view_orders:{...Jt.view_orders||{},today:Xt+fn*1e4}}})))},pt=ee=>{if(ee.altKey&&!ee.ctrlKey&&!ee.metaKey){if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(ee.key)&&(ee.preventDefault(),ee.stopPropagation()),w==="focus"||w==="recent"||oe||w==="allview"&&U.status==="logged")return;if(w==="today"){if(ee.key==="ArrowUp"){if(tt("up")){Ne("up");return}m(U.id,"up");return}if(ee.key==="ArrowDown"){if(tt("down")){Ne("down");return}m(U.id,"down");return}if(ee.key==="ArrowRight"){m(U.id,"right");return}if(ee.key==="ArrowLeft"){T?v():m(U.id,"left");return}}if(w==="upcoming"){if(ee.key==="ArrowUp"){m(U.id,"up");return}if(ee.key==="ArrowDown"){m(U.id,"down");return}return}if(ee.key==="ArrowUp"){m(U.id,"up");return}if(ee.key==="ArrowDown"){m(U.id,"down");return}if(ee.key==="ArrowRight"){m(U.id,"right");return}if(ee.key==="ArrowLeft"){T?v():m(U.id,"left");return}}if(ee.key==="Tab"){if(ee.preventDefault(),ee.stopPropagation(),w==="focus"||w==="upcoming"||oe||w==="allview"&&U.status==="logged")return;if(ee.shiftKey){if(t.depth===0&&me){const xe=document.querySelector(`[data-tag-id="${me}"]`);if(xe){xe.focus(),o(null),$([]);return}}T?v():m(U.id,"left")}else m(U.id,"right");return}if(ee.key==="Delete"||ee.key==="Backspace"&&!ee.target.matches("input, textarea")){ee.preventDefault(),ee.stopPropagation();const xe=_.includes(U.id)?_:[U.id],Pe=A.findIndex(_t=>_t.data.id===U.id);let et=null;for(let _t=Pe+1;_t<A.length;_t++)if(!xe.includes(A[_t].data.id)){et=A[_t];break}if(!et){for(let _t=Pe-1;_t>=0;_t--)if(!xe.includes(A[_t].data.id)){et=A[_t];break}}V(xe,w==="trash"),et&&(o(et.data.id),$([et.data.id]));return}if((ee.ctrlKey||ee.metaKey)&&ee.key==="."){ee.preventDefault(),ee.stopPropagation(),ee.shiftKey?Ee("canceled"):Ee("completed");return}if(ee.key==="Enter"&&(ee.preventDefault(),ee.stopPropagation(),Re?(te(""),ht("verify"),ee.metaKey||ee.ctrlKey?ie(()=>()=>n()):ie(()=>()=>d(U.id)),st(!0)):ee.metaKey||ee.ctrlKey?n():d(U.id)),ee.key===" "&&(w==="inbox"||w==="today"||w==="schedule"||w==="waiting"||w==="focus")){ee.preventDefault(),ee.stopPropagation();const xe=A.findIndex(Xt=>Xt.data.id===U.id),Pe=Xt=>Xt.view_orders&&Xt.view_orders[w]!==void 0?Xt.view_orders[w]:w==="today"?9e8+new Date(Xt.created_at).getTime()/1e3:Xt.order_index||0,et=Pe(U),_t=w==="today"?null:U.parent_id;let Vt=null;for(let Xt=xe+1;Xt<A.length;Xt++){const Jt=A[Xt];if(w==="today"){Vt=Pe(Jt.data);break}else{if(Jt.depth<=t.depth&&Jt.data.parent_id!==_t)break;if(Jt.data.parent_id===_t){Vt=Pe(Jt.data);break}}}let Ft=et+1e4;Vt!==null&&(Ft=(et+Vt)/2);const nn={title:"",status:w==="waiting"?"someday":"inbox",parent_id:_t,order_index:Ft,view_orders:{[w]:Ft}};if(w==="today"){const Xt=Ue(U);nn.start_date=Xt,nn.status="active",nn.is_all_day=!0}else if(w==="waiting"){const Xt=b.find(Jt=>Jt.name.toLowerCase()==="someday");Xt&&(nn.tags=[Xt.id])}f(nn,[],void 0).then(Xt=>{Xt&&(O(Xt),$([]))})}if(ee.ctrlKey){if(ee.key==="t"&&(ee.preventDefault(),ee.stopPropagation(),i(U.id,{start_date:new Date().toISOString(),is_all_day:!0})),ee.key==="]"){ee.preventDefault(),ee.stopPropagation();const xe=U.start_date?new Date(U.start_date):new Date;xe.setDate(xe.getDate()+1),i(U.id,{start_date:xe.toISOString(),is_all_day:!0})}if(ee.key==="["){ee.preventDefault(),ee.stopPropagation();const xe=U.start_date?new Date(U.start_date):new Date;xe.setDate(xe.getDate()-1),i(U.id,{start_date:xe.toISOString(),is_all_day:!0})}}ee.altKey&&(ee.metaKey||ee.ctrlKey)&&ee.key==="r"&&(ee.preventDefault(),ee.stopPropagation(),R(U.id)),!ee.altKey&&!ee.ctrlKey&&!ee.metaKey&&ee.key!==" "&&(ee.key==="ArrowRight"&&(ee.preventDefault(),se&&!he&&h(U.id,!0)),ee.key==="ArrowLeft"&&(ee.preventDefault(),he?h(U.id,!1):U.parent_id&&o(U.parent_id)))},dt=w==="focus",Et=w!=="focus"&&(g.draggedId===U.id||g.isDragging&&fe),Lt=`group relative ${dt?"mb-0":"mb-1 md:mb-0.5"} rounded-lg outline-none select-none cursor-default ${dt?"py-0.5":"py-2 md:py-1.5"} ${fe?"bg-theme-selection":""} ${!fe&&!Et&&(e&&!fe&&!Et?"bg-theme-hover":"")} ${Me&&w!=="logbook"&&w!=="trash"?"bg-emerald-50/30":Me?"opacity-60 grayscale":""} ${Et?"opacity-40 scale-[0.98] blur-[0.5px] transition-all duration-200":"opacity-100 scale-100 transition-all duration-200"} transition-all duration-200 ease-in-out hover-effect active:bg-theme-hover touch-manipulation`,J=()=>{const ee=[];if(U.repeat_rule&&ee.push(c.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-50 text-purple-600 flex items-center gap-0.5",title:U.repeat_rule.originalText||"",children:c.jsx(FI,{size:10})},"repeat")),U.start_date){const xe=Cv(U.start_date),Pe=Zx(U.start_date)&&!Me;let et="bg-theme-hover text-theme-secondary";xe?et="bg-yellow-50 text-yellow-600 font-medium":Pe&&(et="bg-red-50 text-red-600 font-medium"),ee.push(c.jsxs("span",{className:`text-[10px] px-1.5 py-0.5 rounded border border-transparent ${et} flex items-center gap-1`,children:[c.jsx(vo,{size:10})," ",bI(U.start_date,!U.is_all_day,W)]},"date"))}return ee.length===0?null:c.jsx(c.Fragment,{children:ee})},ye=dt||I.fontWeight==="thin"?"font-extralight":"font-semibold",Ge={small:"text-sm",normal:"text-base",large:"text-lg"}[I.fontSize]||"text-base",Y=(()=>{if(w!=="focus"&&w!=="today"||!U.parent_id)return null;const ee=[];let xe=y.find(_t=>_t.id===U.parent_id),Pe="blue";const et=new Set;for(;xe&&!et.has(xe.id);)et.add(xe.id),ee.unshift({title:xe.title||"Untitled"}),xe.parent_id||(Pe=xe.color||"blue"),xe=y.find(_t=>_t.id===xe.parent_id);return ee.length===0?null:{items:ee,rootColor:Pe}})(),ze=dt?"text-[10px]":Ge,lt=dt?12:14,X=dt?12:16,Fe=dt?"text-[8px]":"text-[10px]",je=x.useCallback(ee=>{if(!Le)return;const xe=ee.touches[0];Oe.current={x:xe.clientX,y:xe.clientY,time:Date.now()},at.current=setTimeout(()=>{_e(!0),navigator.vibrate&&navigator.vibrate(50)},500)},[Le]),He=x.useCallback(ee=>{if(!Oe.current)return;const xe=ee.touches[0],Pe=Math.abs(xe.clientX-Oe.current.x),et=Math.abs(xe.clientY-Oe.current.y);(Pe>10||et>10)&&at.current&&(clearTimeout(at.current),at.current=null)},[]),Ye=x.useCallback(()=>{at.current&&(clearTimeout(at.current),at.current=null),_e(!1),Oe.current=null},[]);return c.jsxs(Pr.div,{layout:!0,transition:{layout:{duration:.2,ease:"easeInOut"}},ref:ne,"data-task-id":U.id,"data-task-index":t.index,draggable:!Le&&w!=="schedule"&&w!=="focus"&&!oe&&!(w==="allview"&&U.status==="logged"),onDragStart:ee=>{if(w==="focus"||oe||w==="allview"&&U.status==="logged"){ee.preventDefault();return}p(ee,t)},className:`${Lt} ${ae?"scale-[1.02] shadow-lg z-50":""}`,style:{marginLeft:`${w==="today"?0:t.depth*gp}px`,backgroundColor:s||"transparent"},tabIndex:0,onKeyDown:pt,onClick:ee=>{ee.stopPropagation(),ee.preventDefault(),Le?a||(Re?(te(""),ht("verify"),ie(()=>()=>setTimeout(()=>l(U.id),50)),st(!0)):setTimeout(()=>l(U.id),50)):(r||E)(ee,U.id)},onDoubleClick:ee=>{ee.stopPropagation(),Le||(Re?(te(""),ht("verify"),ie(()=>()=>n()),st(!0)):n())},onTouchStart:je,onTouchMove:He,onTouchEnd:Ye,children:[c.jsx("div",{className:`flex flex-col ${dt?"px-1":"px-3"}`,children:c.jsxs("div",{className:"flex items-center gap-3",children:[w==="recent"&&c.jsx("span",{className:"text-[10px] text-gray-300 font-light w-14 flex-shrink-0 tabular-nums",children:U.updated_at?new Date(U.updated_at).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"}):""}),w==="trash"?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-[18px] flex justify-center",children:c.jsx(Er,{size:14,className:"text-gray-300"})}),c.jsx("span",{className:"flex-1 text-gray-400 line-through truncate select-text",children:U.title}),c.jsx("button",{onClick:ee=>{ee.stopPropagation();const xe=_.includes(U.id)?_:[U.id];D(xe.map(Pe=>({id:Pe,data:{status:"inbox"}}))),ge({msg:" Inbox",type:"info"})},className:"px-2 py-1 bg-white border border-gray-200 text-indigo-600 text-[10px] font-medium rounded hover:bg-indigo-50 hover:border-indigo-200 transition-colors shadow-sm whitespace-nowrap",children:j("putBack")})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex items-center gap-1",children:[se&&w!=="today"?c.jsx("button",{onClick:ee=>{ee.stopPropagation(),h(U.id)},className:"text-slate-400 hover:text-slate-800 transition-transform",children:he?c.jsx(ts,{size:lt}):c.jsx(rs,{size:lt})}):c.jsx("div",{className:`${dt?"w-[12px]":"w-[16px]"}`}),c.jsx(CD,{checked:Q,isCanceled:ke,onChange:ee=>{ee.stopPropagation(),ee.altKey?Ee("canceled"):Ee()},color:Dt(U),isRoot:!U.parent_id,size:dt?14:18})]}),c.jsxs("div",{className:"flex-1 min-w-0 cursor-text flex items-center overflow-hidden relative min-h-[1.5em]",children:[Re&&c.jsx(La,{size:12,className:"text-amber-500 mr-1.5 flex-shrink-0"}),F===U.id&&c.jsx("div",{className:"mr-2 flex-shrink-0 w-2 h-2 rounded-full bg-red-500 animate-pulse shadow-[0_0_6px_rgba(239,68,68,0.6)]",title:"Recording..."}),c.jsx("span",{className:`${ze} ${ye} transition-all duration-300 ${Me?"opacity-30":"text-theme-primary"} ${ke?"line-through decoration-gray-400":""} mr-2 truncate block flex-shrink ${u===U.id?"opacity-0":""} ${qe?"blur-[4px] select-none":""}`,children:U.title}),u===U.id&&c.jsx("div",{className:"absolute inset-0 bg-white dark:bg-gray-800 z-50 flex items-center pr-2",children:c.jsx(Aee,{initialTitle:U.title,className:`${ze} ${ye}`,fontClass:"",onSave:ee=>{ee!==U.title&&i(U.id,{title:ee}),d(null),ne.current&&ne.current.focus()},onCancel:()=>{d(null),ne.current&&ne.current.focus()},onSwitchToFull:async ee=>{await i(U.id,{title:ee}),d(null),n()}})}),Y&&c.jsx("div",{className:"flex items-center gap-0.5 mr-2 flex-shrink-0",children:Y.items.map((ee,xe)=>{var Pe,et;return c.jsxs(Ln.Fragment,{children:[xe>0&&c.jsx(rs,{size:10,className:"text-gray-300 flex-shrink-0",strokeWidth:1.5}),c.jsx("span",{className:`${dt?"text-[8px]":"text-[9px]"} font-semibold px-1.5 py-[1px] rounded transition-colors duration-200 truncate max-w-[150px]`,style:{backgroundColor:(((Pe=Jn[Y.rootColor])==null?void 0:Pe.color)||"#6366f1")+"15",color:((et=Jn[Y.rootColor])==null?void 0:et.color)||"#6366f1"},title:ee.title,children:ee.title})]},xe)})}),(U.tags||[]).length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"hidden md:flex items-center gap-1 mr-2 flex-shrink-0",children:(U.tags||[]).map(ee=>{var et;const xe=(et=b.find(_t=>_t.id===ee))==null?void 0:et.name;if(!xe)return null;const Pe=xe.startsWith("#");return c.jsx("div",{className:"relative flex-shrink-0",children:c.jsx("span",{className:`${Fe} border rounded-md px-1.5 py-px whitespace-nowrap ${Pe?"bg-emerald-50 text-emerald-700 border-emerald-200":`border-theme ${Q?"text-theme-tertiary bg-theme-hover":"text-theme-secondary bg-theme-hover"}`}`,children:xe})},ee)})}),c.jsxs("div",{className:"md:hidden flex items-center mr-2 text-slate-400 flex-shrink-0",children:[c.jsx(zl,{size:X}),(U.tags||[]).length>1&&c.jsx("span",{className:`${dt?"text-[8px]":"text-[9px]"} ml-0.5`,children:(U.tags||[]).length})]})]}),U.description&&c.jsx(Xf,{size:12,className:"text-slate-400 mr-2 flex-shrink-0"}),U.attachments&&U.attachments.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"mr-2 flex-shrink-0 cursor-pointer",onMouseEnter:ee=>{const xe=ee.currentTarget.getBoundingClientRect();Ce({visible:!0,x:xe.left+xe.width/2,y:xe.top-8,attachments:U.attachments||[]})},onMouseLeave:()=>Ce(null),children:c.jsx(ho,{size:12,className:"text-slate-400"})}),(le==null?void 0:le.visible)&&le.attachments===U.attachments&&ir.createPortal(c.jsx("div",{className:"fixed z-[99999] pointer-events-none",style:{left:le.x,top:le.y,transform:"translate(-50%, -100%)"},children:c.jsxs("div",{className:"bg-gray-800 text-white text-[10px] px-2.5 py-2 rounded-lg shadow-2xl max-w-[220px]",children:[c.jsxs("div",{className:"font-semibold mb-1 text-[11px]",children:[U.attachments.length," "]}),U.attachments.slice(0,5).map((ee,xe)=>c.jsx("div",{className:"truncate opacity-80 py-0.5",children:ee.name},xe)),U.attachments.length>5&&c.jsxs("div",{className:"opacity-60 pt-1",children:["... ",U.attachments.length-5," "]})]})}),document.body)]}),c.jsxs("div",{className:`ml-auto ${Me?"opacity-50":"opacity-100"} flex-shrink-0`,children:[" ",J()," "]})]}),c.jsxs("div",{className:"opacity-100 md:opacity-0 md:group-hover:opacity-100 flex items-center gap-1 pl-2",children:[c.jsx("button",{onClick:ee=>{ee.stopPropagation(),te(""),ht(Re?"unlock":"lock"),st(!0)},className:`p-1 transition-colors ${Re?"text-amber-500 hover:text-amber-600":"text-slate-300 hover:text-amber-500"}`,title:Re?"":"",children:Re?c.jsx(i1,{size:X}):c.jsx(La,{size:X})}),c.jsx("button",{onClick:ee=>{ee.stopPropagation();const xe=_.includes(U.id)?_:[U.id];V(xe,w==="trash")},className:"p-1 hover:text-red-500 text-slate-300 transition-colors",children:c.jsx(Er,{size:X})})]})]})]})}),Ve&&ir.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999]",onClick:()=>{st(!1),ie(null)},children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-80 max-w-[90vw]",onClick:ee=>ee.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[Be==="lock"?c.jsx(La,{size:20,className:"text-amber-500"}):c.jsx(i1,{size:20,className:"text-emerald-500"}),c.jsx("h3",{className:"text-lg font-bold",children:Be==="lock"?"":Be==="verify"?"":""})]}),c.jsx("p",{className:"text-sm text-gray-500 mb-4",children:Be==="lock"?"":Be==="verify"?"":""}),c.jsx("input",{type:"password",placeholder:"",value:vt,onChange:ee=>te(ee.target.value),onKeyDown:ee=>{ee.key==="Enter"&&(Be==="lock"?vt.length>=1&&(k(U.id,vt),st(!1)):Be==="verify"?S(U.id,vt)?(C(U.id),st(!1),Z&&Z(),ie(null)):ge({msg:"",type:"error"}):M(U.id,vt).then(xe=>{xe&&st(!1)})),ee.key==="Escape"&&(st(!1),ie(null))},autoFocus:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-amber-500"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:()=>{st(!1),ie(null)},className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:""}),c.jsx("button",{onClick:()=>{Be==="lock"?vt.length>=1&&(k(U.id,vt),st(!1)):Be==="verify"?S(U.id,vt)?(C(U.id),st(!1),Z&&Z(),ie(null)):ge({msg:"",type:"error"}):M(U.id,vt).then(ee=>{ee&&st(!1)})},className:`flex-1 px-4 py-2 rounded-lg transition-colors ${Be==="lock"?"bg-amber-500 text-white hover:bg-amber-600":"bg-emerald-500 text-white hover:bg-emerald-600"}`,children:Be==="lock"?"":Be==="verify"?"":""})]})]})}),document.body)]})},Ree=({show:t,top:e,left:n,width:r,color:s})=>{if(!t)return null;const i=Jn[s]||Jn.blue;return c.jsx("div",{className:"absolute pointer-events-none z-10 transition-all duration-100 ease-out",style:{top:`${e}px`,left:`${n}px`,width:`${r}px`},children:c.jsx("div",{className:`h-0.5 ${i.indicator} rounded-full shadow-sm relative`,children:c.jsx("div",{className:`absolute -left-1.5 -top-[3px] w-2 h-2 ${i.indicator} rounded-full shadow-md`})})})},Oee={red:"#ef4444",orange:"#f97316",yellow:"#eab308",green:"#22c55e",blue:"#3b82f6",purple:"#a855f7",pink:"#ec4899",gray:"#9ca3af"},Pee=({containerRef:t,tasks:e})=>{const[n,r]=x.useState([]),s=x.useRef(null),i=x.useRef(null),o=x.useCallback(()=>{if(!t.current)return;const a=t.current.getBoundingClientRect(),l=t.current.querySelectorAll("[data-task-id]"),u=new Map;l.forEach(g=>{const v=g.getAttribute("data-task-id");if(v){const w=g.getBoundingClientRect();u.set(v,{top:w.top-a.top,height:w.height})}});const d=new Map(e.map(g=>[g.data.id,g.data])),f=new Set(e.map(g=>g.data.id)),h=g=>{let v=g,w=0;const T=new Set,R=[];for(;w<50&&!T.has(v);){T.add(v);const M=d.get(v);if(!M)break;if(R.push(v),!M.parent_id||!f.has(M.parent_id))return{rootId:v,color:M.color||"gray",depth:R.length-1};v=M.parent_id,w++}const k=d.get(g);return{rootId:g,color:(k==null?void 0:k.color)||"gray",depth:0}},p=new Map;e.forEach(g=>{const v=u.get(g.data.id);if(!v)return;const w=h(g.data.id);if(!p.has(w.rootId)){const R=u.get(w.rootId);p.set(w.rootId,{rootId:w.rootId,color:Oee[w.color]||w.color,rootTop:(R==null?void 0:R.top)||v.top,rootHeight:(R==null?void 0:R.height)||v.height,minTop:v.top,maxBottom:v.top+v.height,tasks:[],offsetX:0})}const T=p.get(w.rootId);T.minTop=Math.min(T.minTop,v.top),T.maxBottom=Math.max(T.maxBottom,v.top+v.height),w.depth>0&&T.tasks.push({taskId:g.data.id,rootId:w.rootId,rootColor:T.color,depth:w.depth,top:v.top,height:v.height})});const m=Array.from(p.values()).filter(g=>g.tasks.length>0);m.sort((g,v)=>g.rootTop-v.rootTop);const y=8,b=8;m.forEach((g,v)=>{g.offsetX=y+v*b}),r(m)},[t,e]);return x.useEffect(()=>{o();const a=t.current;a&&a.addEventListener("scroll",o),i.current=new ResizeObserver(o),a&&i.current.observe(a),window.addEventListener("resize",o);const l=setInterval(o,100);return()=>{a&&a.removeEventListener("scroll",o),i.current&&i.current.disconnect(),window.removeEventListener("resize",o),clearInterval(l)}},[o]),x.useEffect(()=>{const a=setTimeout(o,50);return()=>clearTimeout(a)},[e,o]),n.length===0?null:c.jsxs("svg",{ref:s,className:"absolute top-0 left-0 w-full h-full pointer-events-none z-10",style:{overflow:"visible"},children:[c.jsx("defs",{children:c.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[c.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),c.jsxs("feMerge",{children:[c.jsx("feMergeNode",{in:"coloredBlur"}),c.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),n.map((a,l)=>{const u=a.offsetX,d=a.rootTop+a.rootHeight/2,f=a.maxBottom-6;return c.jsxs("g",{children:[c.jsx("path",{d:`M ${u} ${d} L ${u} ${f}`,fill:"none",stroke:a.color,strokeWidth:"2",strokeOpacity:"0.3",strokeLinecap:"round"}),c.jsx("circle",{cx:u,cy:d,r:"4",fill:a.color,opacity:"0.9",filter:"url(#glow)"}),a.tasks.map((h,p)=>c.jsx("rect",{x:u-1.5,y:h.top+8,width:3,height:h.height-16,rx:1.5,ry:1.5,fill:h.rootColor,opacity:.6-(h.depth-1)*.1},`bar-${p}`))]},`group-${l}`)})]})},cE={"zh-TW":["","","","","","",""],en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},uE={"zh-TW":["1","2","3","4","5","6","7","8","9","10","11","12"],en:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},Lee=({date:t,isToday:e,isTomorrow:n,taskCount:r,language:s="zh-TW"})=>{var p,m;const i=new Date(t+"T12:00:00"),o=i.getDate(),a=((p=uE[s])==null?void 0:p[i.getMonth()])||uE.en[i.getMonth()],l=((m=cE[s])==null?void 0:m[i.getDay()])||cE.en[i.getDay()],u=i.getDay()===0||i.getDay()===6;let d="",f="";e?(d=s==="zh-TW"?"":"Today",f=`${a}${o}`):n?(d=s==="zh-TW"?"":"Tomorrow",f=`${a}${o}`):(d=`${a}${o}`,f=l);const h=()=>e?"text-blue-600":n?"text-orange-500":u?"text-purple-500":"text-gray-500";return c.jsxs("div",{className:"flex items-center gap-3 pt-6 pb-2 px-1 select-none","data-date-separator":t,children:[c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsx("span",{className:`text-[13px] font-semibold ${h()}`,children:d}),f&&c.jsx("span",{className:"text-[11px] text-gray-400 font-normal",children:f})]}),c.jsx("div",{className:"flex-1 h-[1px] bg-gray-200"}),r>0&&c.jsx("span",{className:"text-[10px] text-gray-400 tabular-nums",children:r})]})},$ee=(t,e)=>{const n=[];for(let r=0;r<e;r++){const s=new Date(t);s.setDate(s.getDate()+r);const i=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),a=String(s.getDate()).padStart(2,"0");n.push(`${i}-${o}-${a}`)}return n},zee=t=>{const e=new Date,n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=`${n}-${r}-${s}`;return t===i},Fee=t=>{const e=new Date;e.setDate(e.getDate()+1);const n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=`${n}-${r}-${s}`;return t===i},TR=({rootParentId:t})=>{const{visibleTasks:e,focusedTaskId:n,setFocusedTaskId:r,editingTaskId:s,setEditingTaskId:i,expandedTaskIds:o,endDrag:a,dragState:l,updateDropState:u,updateGhostPosition:d,selectedTaskIds:f,setSelectedTaskIds:h,handleSelection:p,selectionAnchor:m,tasks:y,tags:b,pendingFocusTaskId:g,setPendingFocusTaskId:v,view:w,addTask:T,reviewTask:R,emptyTrash:k,restoreTrash:M,t:S,archivedTasks:C,restoreArchivedTask:_,deleteArchivedTask:E,updateArchivedTask:I,batchDeleteArchivedTasks:P,batchDeleteTasks:O,batchUpdateTasks:$,duplicateTasks:A,leavingTaskIds:j,dismissLeavingTasks:W,themeSettings:V}=x.useContext(En),D=x.useRef(null),ge=x.useRef(null),me=x.useRef(null),[F,U]=x.useState(new Date);x.useEffect(()=>{const ue=()=>{const nt=new Date;nt.getDate()!==F.getDate()&&U(nt)},Se=setInterval(ue,6e4);return window.addEventListener("focus",ue),()=>{clearInterval(Se),window.removeEventListener("focus",ue)}},[F]);const ne=x.useRef(null),[Oe,at]=x.useState("none"),ae=x.useMemo(()=>{if(!t)return e;const ue=ct=>{const Qe=w==="allview"||w==="project"?"all":w;return ct.view_orders&&ct.view_orders[Qe]!==void 0?ct.view_orders[Qe]:ct.order_index||0},Se=y.filter(ct=>ct.parent_id===t&&ct.status!=="deleted"&&ct.status!=="logged").sort((ct,Qe)=>ue(ct)-ue(Qe)||(ct.created_at||"").localeCompare(Qe.created_at||""));let nt=0;const ft=(ct,Qe=0,It=[])=>{let Lt=[];return ct.forEach(J=>{const ye=y.filter(ze=>ze.parent_id===J.id&&ze.status!=="logged"&&ze.status!=="deleted").sort((ze,lt)=>ue(ze)-ue(lt)||(ze.created_at||"").localeCompare(lt.created_at||"")),Ge=ye.length>0,kt=o.includes(J.id),Y=[...It,J.id];Lt.push({data:J,depth:Qe,hasChildren:Ge,isExpanded:kt,path:Y,index:nt++}),Ge&&kt&&(Lt=[...Lt,...ft(ye,Qe+1,Y)])}),Lt};return ft(Se)},[e,t,y,o,w]);let _e=t?ae:e;const le=x.useMemo(()=>{if(Oe==="none"||_e.length===0)return null;let ue=Date.now(),Se=0;return _e.forEach(nt=>{const ft=nt.data.updated_at?new Date(nt.data.updated_at).getTime():0;ft>0&&(ft<ue&&(ue=ft),ft>Se&&(Se=ft))}),Se===ue&&(Se=ue+1),{minTime:ue,maxTime:Se}},[Oe,_e]),Ce=ue=>{if(!le||Oe==="none")return;const Se=ue.updated_at?new Date(ue.updated_at).getTime():0;if(Se===0)return;const nt=(Se-le.minTime)/(le.maxTime-le.minTime),ft=Math.max(0,Math.min(1,nt));return Oe==="recent"?`rgba(255, 0, 0, ${.02+ft*.18})`:`rgba(250, 204, 21, ${.02+ft*.18})`},Le=x.useRef(null),Ve=x.useCallback((ue,Se)=>{r(Se);const nt=ue.shiftKey||ue.shiftKey,ft=ue.ctrlKey||ue.metaKey;if(nt){const ct=Le.current||n||Se;Le.current=ct;const Qe=_e.findIndex(Lt=>Lt.data.id===ct),It=_e.findIndex(Lt=>Lt.data.id===Se);if(Qe!==-1&&It!==-1){const[Lt,J]=Qe<It?[Qe,It]:[It,Qe],ye=_e.slice(Lt,J+1).map(Ge=>Ge.data.id);h(ye)}}else ft?(Le.current=Se,h(ct=>ct.includes(Se)?ct.filter(Qe=>Qe!==Se):[...ct,Se])):(Le.current=Se,h([Se]))},[_e,n,r,h]),st=w==="upcoming"?Ve:p;x.useEffect(()=>{const ue=Se=>{var ct;if(s)return;const nt=document.activeElement;if((nt==null?void 0:nt.tagName)==="INPUT"||(nt==null?void 0:nt.tagName)==="TEXTAREA"||nt!=null&&nt.isContentEditable||nt!=null&&nt.closest("[data-tag-id]")||document.querySelector("[data-search-modal]"))return;if((Se.metaKey||Se.ctrlKey)&&(Se.key==="a"||Se.key==="A")){Se.preventDefault();const Qe=_e.map(It=>It.data.id);h(Qe);return}if((Se.metaKey||Se.ctrlKey)&&(Se.key==="t"||Se.key==="T")){Se.preventDefault();const Qe=f.length>0?f:n?[n]:[];if(Qe.length>0){const It=new Date().toISOString().split("T")[0];$(Qe.map(Lt=>({id:Lt,data:{start_date:It,status:"active"}})))}return}if((Se.metaKey||Se.ctrlKey)&&(Se.key==="d"||Se.key==="D")){Se.preventDefault();const Qe=f.length>0?f:n?[n]:[];Qe.length>0&&A(Qe);return}const ft=_e.findIndex(Qe=>Qe.data.id===n);if(Se.metaKey||Se.ctrlKey){if(Se.key==="ArrowUp"){if(Se.preventDefault(),_e.length>0){const Qe=_e[0];r(Qe.data.id),st({shiftKey:!1,ctrlKey:!1},Qe.data.id)}return}if(Se.key==="ArrowDown"){if(Se.preventDefault(),_e.length>0){const Qe=_e[_e.length-1];r(Qe.data.id),st({shiftKey:!1,ctrlKey:!1},Qe.data.id)}return}}if(Se.shiftKey&&(Se.key==="ArrowDown"||Se.key==="ArrowUp")){Se.preventDefault();let Qe=ft;Se.key==="ArrowDown"&&(Qe=Math.min(ft+1,_e.length-1)),Se.key==="ArrowUp"&&(Qe=Math.max(ft-1,0));const It=_e[Qe];It&&(r(It.data.id),st({shiftKey:!0,preventDefault:()=>{}},It.data.id));return}if(Se.key==="ArrowDown"&&!Se.altKey){Se.preventDefault();const Qe=ft+1;if(Qe<_e.length){const It=_e[Qe];r(It.data.id),st({shiftKey:!1,ctrlKey:!1},It.data.id)}}else if(Se.key==="ArrowUp"&&!Se.altKey){Se.preventDefault();const Qe=ft-1;if(Qe>=0){const It=_e[Qe];r(It.data.id),st({shiftKey:!1,ctrlKey:!1},It.data.id)}}else if(Se.key==="Enter")ft!==-1&&!s&&!Se.altKey&&w!=="trash"&&(Se.preventDefault(),i(_e[ft].data.id));else if(Se.key===" "&&!s&&w!=="trash")if(Se.preventDefault(),ft!==-1){ne.current=n;const Qe=_e[ft],It=Qe.data.parent_id,Lt=ze=>ze.view_orders&&ze.view_orders[w]!==void 0?ze.view_orders[w]:w==="today"?9e8+new Date(ze.created_at).getTime()/1e3:ze.order_index||0,J=Lt(Qe.data);let ye=null;for(let ze=ft+1;ze<_e.length;ze++){const lt=_e[ze];if(lt.depth<=Qe.depth&&lt.data.parent_id!==It)break;if(lt.data.parent_id===It){ye=Lt(lt.data);break}}let Ge;ye!==null?Ge=(J+ye)/2:Ge=J+1e4;const kt=b.find(ze=>ze.name.toLowerCase()==="prompt"),Y={title:"",parent_id:It,status:Qe.data.status,tags:w==="prompt"&&kt?[kt.id]:Qe.data.tags,color:Qe.data.color,start_date:Qe.data.start_date,order_index:Ge,view_orders:{[w]:Ge}};T(Y).then(ze=>{v(ze),h([])})}else{const Qe=new Date().toISOString().split("T")[0],It=b.find(ze=>ze.name.toLowerCase()==="prompt"),Lt=b.find(ze=>ze.name.toLowerCase()==="note"),J=b.find(ze=>ze.name.toLowerCase()==="journal"),ye=b.find(ze=>ze.name.includes("")),Ge=ze=>ze.view_orders&&ze.view_orders[w]!==void 0?ze.view_orders[w]:w==="today"?9e8+new Date(ze.created_at).getTime()/1e3:ze.order_index||0;let kt=1e4;if(_e.length>0){const ze=_e.filter(lt=>!lt.data.parent_id);if(ze.length>0){const lt=ze[ze.length-1];kt=Ge(lt.data)+1e4}else{const lt=_e[_e.length-1];kt=Ge(lt.data)+1e4}}const Y={title:"",parent_id:null,status:"inbox",tags:[],order_index:kt,view_orders:{[w]:kt}};if(w==="today")Y.start_date=Qe,Y.status="active";else if(w==="prompt")Y.status="active",It&&(Y.tags=[It.id]);else if(w==="journal")Y.status="active",Lt?Y.tags=[Lt.id]:J&&(Y.tags=[J.id]);else if(w==="waiting")Y.status="waiting",ye&&(Y.tags=[ye.id]);else if(w==="focus")Y.status="active";else if(w==="upcoming"){const ze=new Date;ze.setDate(ze.getDate()+1),Y.start_date=ze.toISOString().split("T")[0],Y.status="active"}T(Y).then(ze=>{v(ze),h([])})}else if((Se.key==="Delete"||Se.key==="Backspace")&&!s){if(["INPUT","TEXTAREA"].includes(((ct=document.activeElement)==null?void 0:ct.tagName)||""))return;const Qe=f.length>0?f:n?[n]:[];Qe.length>0&&(Se.preventDefault(),O(Qe,w==="trash"),n&&Qe.includes(n))}};return window.addEventListener("keydown",ue),()=>window.removeEventListener("keydown",ue)},[_e,n,o,s,m,T,i,r,st,w,b,f,O,$,A]);const Be=!1,ht=ue=>{var xe;if(w==="focus"||w==="upcoming"||w==="recent"||(ue.preventDefault(),!l.isDragging||!D.current))return;if(d(ue.clientX,ue.clientY),me.current){u({dropIndex:null,indicatorTop:0});return}const Se=D.current.getBoundingClientRect(),nt=ue.clientX,ft=ue.clientY,ct=nt-Se.left,Qe=100,It=10,Lt=window.innerHeight,J=document.querySelector("main");J&&(ft<Qe?ge.current||(ge.current=setInterval(()=>{J.scrollTop-=It},16)):ft>Lt-Qe?ge.current||(ge.current=setInterval(()=>{J.scrollTop+=It},16)):ge.current&&(clearInterval(ge.current),ge.current=null));let ye=-1,Ge=null,kt=document.elementFromPoint(nt,ft);for(;kt&&kt!==D.current&&kt!==document.body;){if(kt.hasAttribute("data-task-index")){ye=parseInt(kt.getAttribute("data-task-index")||"-1"),Ge=kt.getBoundingClientRect();break}kt=kt.parentElement}if(ye===-1&&_e.length>0&&D.current){const Pe=D.current.querySelector("[data-task-index]:last-child");if(Pe){const et=Pe.getBoundingClientRect();ft>et.bottom&&(ye=parseInt(Pe.getAttribute("data-task-index")||"-1")+1,Ge=et)}}if(ye===-1){const Pe=(xe=D.current)==null?void 0:xe.querySelector("[data-task-index]:first-child");if(Pe){const et=Pe.getBoundingClientRect();ft<et.top&&(ye=0,Ge=et)}if(ye===-1)return}let Y=ye,ze=ye;if(Ge){const Pe=Ge.top+Ge.height/2;ft>Pe&&ye<_e.length&&(Y=ye+1)}const lt=ct-l.dragOffsetX+l.originalDepth*gp;let X=Math.floor(lt/gp);X<0&&(X=0);const Fe=_e[Y-1],je=Fe?Fe.depth+1:0;X>je&&(X=je);let He=0;Ge?Y===ye?He=Ge.top-Se.top:He=Ge.bottom-Se.top:Y===0&&(He=0);let Ye=X*gp+40,ee=Se.width-Ye-20;w==="today"&&(X=0,Ye=40,ee=Se.width-60),u({dropIndex:Y,dropDepth:X,indicatorTop:He,indicatorLeft:Ye,indicatorWidth:ee,anchorTaskIndex:ze})},vt=()=>{ge.current&&(clearInterval(ge.current),ge.current=null),a(_e)},te=ue=>{const Se=ue||ne.current||n;i(null),Se&&(r(Se),h([Se]),setTimeout(()=>{var ft;const nt=(ft=D.current)==null?void 0:ft.querySelector(`[data-task-id="${Se}"]`);nt&&(nt.focus(),nt.scrollIntoView({block:"nearest",behavior:"smooth"}))},100)),ne.current=null,g&&v(null)},Z=()=>{if(l.dropIndex===null||l.dropIndex===0)return"blue";const ue=_e[l.dropIndex-1];return(ue==null?void 0:ue.data.color)||"blue"},ie=_e,he=x.useMemo(()=>w!=="inbox"||j.length===0?[]:j.map(ue=>y.find(Se=>Se.id===ue)).filter(Boolean).map((ue,Se)=>({data:ue,depth:0,hasChildren:!1,isExpanded:!1,path:[ue.id],index:Se})),[w,j,y]),[se,Q]=x.useState(!0),ke=_e,Me=x.useMemo(()=>{if(w!=="allview"&&w!=="logbook")return[];const ue=new Map(C.map(ct=>[ct.id,ct])),Se=C.filter(ct=>!ct.parent_id||!ue.has(ct.parent_id)).sort((ct,Qe)=>new Date(Qe.archived_at||Qe.completed_at||0).getTime()-new Date(ct.archived_at||ct.completed_at||0).getTime()),nt=[],ft=(ct,Qe,It)=>{const Lt=C.filter(J=>J.parent_id===ct.id);nt.push({data:ct,depth:Qe,hasChildren:Lt.length>0,isExpanded:!0,path:[...It,ct.id],index:nt.length}),Lt.forEach(J=>ft(J,Qe+1,[...It,ct.id]))};return Se.forEach(ct=>ft(ct,0,[])),nt},[C,w]),[fe,Re]=x.useState(null),[qe,xt]=x.useState(""),[Dt,oe]=x.useState([]),Ee=x.useRef(null),Ue=ue=>{if(!ue)return"";const Se=new Date(ue);return`${Se.getFullYear()}-${String(Se.getMonth()+1).padStart(2,"0")}-${String(Se.getDate()).padStart(2,"0")}`},tt=ue=>{if(qe){const Se=new Date(qe);isNaN(Se.getTime())||I(ue,{completed_at:Se.toISOString()})}Re(null)},Ne=(ue,Se)=>{if(ue.stopPropagation(),ue.shiftKey&&Ee.current){const nt=Me.findIndex(ct=>ct.data.id===Ee.current),ft=Me.findIndex(ct=>ct.data.id===Se);if(nt!==-1&&ft!==-1){const[ct,Qe]=nt<ft?[nt,ft]:[ft,nt],It=Me.slice(ct,Qe+1).map(Lt=>Lt.data.id);oe(It)}}else ue.metaKey||ue.ctrlKey?(Ee.current=Se,oe(nt=>nt.includes(Se)?nt.filter(ft=>ft!==Se):[...nt,Se])):(Ee.current=Se,oe([Se]))};if(w==="logbook")return Me.length===0?c.jsxs("div",{className:"text-center py-20 opacity-20",children:[c.jsx(n1,{size:48,className:"mx-auto"}),c.jsx("p",{className:"text-xs mt-2",children:""})]}):c.jsxs("div",{className:"pb-20 relative min-h-[500px]",onClick:()=>oe([]),children:[c.jsxs("div",{className:"flex items-center gap-2 mb-6 px-2",children:[c.jsx(am,{size:16,className:"text-gray-400"}),c.jsx("span",{className:"text-[13px] font-bold text-gray-500",children:""}),c.jsx("span",{className:"text-[11px] font-medium px-1.5 py-0.5 rounded-full bg-gray-100 text-gray-500",children:Me.length}),c.jsx("div",{className:"flex-1 h-[2px] rounded-full bg-gradient-to-r from-gray-200 to-transparent"}),Dt.length>0&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:"text-[11px] text-indigo-600 font-medium",children:[" ",Dt.length," "]}),c.jsxs("button",{onClick:ue=>{ue.stopPropagation(),confirm(` ${Dt.length} `)&&(P(Dt),oe([]))},className:"px-2 py-1 bg-red-50 text-red-600 text-[10px] font-medium rounded hover:bg-red-100 transition-colors flex items-center gap-1",children:[c.jsx(Er,{size:12}),""]}),c.jsx("button",{onClick:ue=>{ue.stopPropagation(),oe([])},className:"px-2 py-1 bg-gray-100 text-gray-600 text-[10px] font-medium rounded hover:bg-gray-200 transition-colors",children:""})]})]}),Me.map(ue=>{const Se=Dt.includes(ue.data.id);return c.jsx("div",{className:`relative group mb-1 py-2 px-3 rounded-lg transition-colors cursor-pointer ${Se?"bg-indigo-50 border border-indigo-200":"hover:bg-theme-hover"}`,style:{marginLeft:`${ue.depth*24}px`},onClick:nt=>Ne(nt,ue.data.id),children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:`w-[18px] h-[18px] rounded-full border-2 flex items-center justify-center flex-shrink-0 ${Se?"border-indigo-500 bg-indigo-500":"border-emerald-500 bg-emerald-500"}`,children:c.jsx(Xn,{size:12,className:"text-white"})}),c.jsx("span",{className:"flex-1 text-theme-primary opacity-70 truncate",children:ue.data.title}),c.jsxs("div",{className:"flex items-center gap-1 text-[11px] text-gray-400",children:[c.jsx(vo,{size:12}),fe===ue.data.id?c.jsx("input",{type:"date",autoFocus:!0,value:qe,onChange:nt=>xt(nt.target.value),onBlur:()=>tt(ue.data.id),onKeyDown:nt=>{nt.key==="Enter"&&tt(ue.data.id),nt.key==="Escape"&&Re(null)},onClick:nt=>nt.stopPropagation(),className:"bg-white border border-gray-300 rounded px-1 py-0.5 text-[11px] w-28"}):c.jsx("span",{className:"cursor-pointer hover:text-indigo-500 transition-colors",onDoubleClick:nt=>{nt.stopPropagation(),Re(ue.data.id),xt(Ue(ue.data.completed_at))},title:"",children:Ue(ue.data.completed_at)||""})]}),c.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[c.jsx("button",{onClick:nt=>{nt.stopPropagation(),_(ue.data.id)},className:"px-2 py-1 bg-emerald-50 text-emerald-600 text-[10px] font-medium rounded hover:bg-emerald-100 transition-colors",children:""}),c.jsx("button",{onClick:nt=>{nt.stopPropagation(),confirm("")&&E(ue.data.id)},className:"p-1 text-gray-400 hover:text-red-500 transition-colors",title:"",children:c.jsx(Er,{size:14})})]})]})},ue.data.id)})]});if(_e.length===0&&(w!=="allview"||Me.length===0))return c.jsxs("div",{className:"text-center py-20 opacity-20",children:[c.jsx(n1,{size:48,className:"mx-auto"}),c.jsx("p",{className:"text-xs mt-2",children:"No tasks"})]});const pt=ue=>ue.start_date?new Date(ue.start_date).toISOString().split("T")[0]:ue.due_date?new Date(ue.due_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],dt=()=>{const ue=$ee(F,8),Se=new Map,nt=[],ft=[],ct=F.getFullYear(),Qe=String(F.getMonth()+1).padStart(2,"0"),It=String(F.getDate()).padStart(2,"0"),Lt=`${ct}-${Qe}-${It}`;return _e.forEach(J=>{const ye=pt(J.data);ye<Lt?nt.push(J):ue.includes(ye)?(Se.has(ye)||Se.set(ye,[]),Se.get(ye).push(J)):ft.push(J)}),c.jsxs(c.Fragment,{children:[nt.length>0&&c.jsxs("div",{"data-date-group":"overdue",children:[c.jsxs("div",{className:"flex items-center gap-3 pt-2 pb-2 px-1 select-none",children:[c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsx("span",{className:"text-[13px] font-semibold text-red-500",children:""}),c.jsxs("span",{className:"text-[11px] text-red-400 font-normal",children:[nt.length," "]})]}),c.jsx("div",{className:"flex-1 h-[1px] bg-red-200"})]}),nt.map(J=>c.jsx(Ln.Fragment,{children:s===J.data.id?c.jsx(Po,{initialData:J.data,onClose:te},J.data.id):c.jsx("div",{className:"relative group",children:c.jsx(xl,{flatTask:J,isFocused:n===J.data.id,onEdit:()=>i(J.data.id)},J.data.id)})},J.data.id))]}),ue.map(J=>{const ye=Se.get(J)||[];return c.jsxs("div",{"data-date-group":J,children:[c.jsx(Lee,{date:J,isToday:zee(J),isTomorrow:Fee(J),taskCount:ye.length}),ye.length===0?c.jsx("div",{className:"h-12 mx-2 mb-2 border-2 border-dashed border-gray-200 rounded-lg flex items-center justify-center text-gray-300 text-xs transition-all hover:border-gray-300 hover:bg-gray-50","data-empty-drop-zone":J,onDragEnter:Ge=>{Ge.preventDefault(),me.current=J,Ge.currentTarget.classList.add("border-blue-400","bg-blue-50","text-blue-400")},onDragOver:Ge=>{Ge.preventDefault(),Ge.dataTransfer.dropEffect="move",me.current=J,d(Ge.clientX,Ge.clientY)},onDragLeave:Ge=>{me.current=null,Ge.currentTarget.classList.remove("border-blue-400","bg-blue-50","text-blue-400")},onDrop:Ge=>{Ge.preventDefault(),Ge.stopPropagation(),Ge.currentTarget.classList.remove("border-blue-400","bg-blue-50","text-blue-400");const kt=me.current||J;me.current=null;let Y=[];try{const ze=Ge.dataTransfer.getData("application/json");ze&&(Y=JSON.parse(ze))}catch{}if(Y.length===0){const ze=Ge.dataTransfer.getData("text/plain");ze&&(Y=[ze])}Y.length===0&&l.draggedId&&(Y=f.includes(l.draggedId)?f:[l.draggedId]),Y.length>0&&$(Y.map(ze=>({id:ze,data:{start_date:kt,is_all_day:!0}}))),a()},children:""}):ye.map(Ge=>c.jsx(Ln.Fragment,{children:s===Ge.data.id?c.jsx(Po,{initialData:Ge.data,onClose:te},Ge.data.id):c.jsx("div",{className:"relative group",children:c.jsx(xl,{flatTask:Ge,isFocused:n===Ge.data.id,onEdit:()=>i(Ge.data.id)},Ge.data.id)})},Ge.data.id))]},J)}),ft.length>0&&(()=>{const J=new Map;return ft.forEach(Ge=>{const kt=pt(Ge.data),Y=new Date(kt+"T12:00:00"),ze=`${Y.getFullYear()}-${String(Y.getMonth()+1).padStart(2,"0")}`;J.has(ze)||J.set(ze,[]),J.get(ze).push(Ge)}),Array.from(J.keys()).sort().map(Ge=>{const[kt,Y]=Ge.split("-"),ze=["1","2","3","4","5","6","7","8","9","10","11","12"][parseInt(Y)-1],lt=J.get(Ge),X=new Date().getFullYear(),Fe=parseInt(kt)!==X;return c.jsxs("div",{"data-date-group":Ge,children:[c.jsxs("div",{className:"flex items-center gap-3 pt-6 pb-2 px-1 select-none",children:[c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsx("span",{className:"text-[13px] font-semibold text-gray-400",children:ze}),Fe&&c.jsx("span",{className:"text-[11px] text-gray-300 font-normal",children:kt})]}),c.jsx("div",{className:"flex-1 h-[1px] bg-gray-200"}),c.jsx("span",{className:"text-[10px] text-gray-400 tabular-nums",children:lt.length})]}),lt.map(je=>c.jsx(Ln.Fragment,{children:s===je.data.id?c.jsx(Po,{initialData:je.data,onClose:te},je.data.id):c.jsx("div",{className:"relative group",children:c.jsx(xl,{flatTask:je,isFocused:n===je.data.id,onEdit:()=>i(je.data.id)},je.data.id)})},je.data.id))]},Ge)})})()]})},Et=ue=>ue.map(Se=>c.jsx(Ln.Fragment,{children:s===Se.data.id?c.jsx(Po,{initialData:Se.data,onClose:te},Se.data.id):c.jsx("div",{className:"relative group",children:c.jsx(xl,{flatTask:Se,isFocused:n===Se.data.id,onEdit:()=>i(Se.data.id),backgroundColor:Ce(Se.data)},Se.data.id)})},Se.data.id));return c.jsx(c.Fragment,{children:c.jsxs("div",{ref:D,className:"pb-20 relative min-h-[500px]",onDragOver:ht,onDragLeave:ue=>{var Se;(Se=D.current)!=null&&Se.contains(ue.relatedTarget)||u({dropIndex:null})},onDrop:ue=>{ue.preventDefault(),vt()},onDragEnd:vt,children:[(w==="allview"||w==="project"||w==="inbox")&&c.jsx("div",{className:"flex justify-end px-4 py-2 border-b border-gray-100/50 mb-2 sticky top-0 bg-white/95 backdrop-blur z-20",children:c.jsxs("div",{className:"flex items-center gap-2 bg-gray-50/80 p-1 rounded-lg border border-gray-100",children:[c.jsx("span",{className:"text-[9px] text-gray-400 font-bold uppercase tracking-wider px-1",children:"Mark:"}),c.jsxs("div",{className:"flex gap-0.5",children:[c.jsx("button",{onClick:()=>at("none"),className:`px-2 py-0.5 text-[10px] rounded transition-all ${Oe==="none"?"bg-white shadow-sm text-gray-800 font-bold":"text-gray-400 hover:text-gray-600"}`,children:"Off"}),c.jsxs("button",{onClick:()=>at("recent"),className:`px-2 py-0.5 text-[10px] rounded transition-all flex items-center gap-1 ${Oe==="recent"?"bg-red-50 text-red-600 shadow-sm font-bold ring-1 ring-red-100":"text-gray-400 hover:text-red-500"}`,children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),"Recent"]}),c.jsxs("button",{onClick:()=>at("frequent"),className:`px-2 py-0.5 text-[10px] rounded transition-all flex items-center gap-1 ${Oe==="frequent"?"bg-amber-50 text-amber-600 shadow-sm font-bold ring-1 ring-amber-100":"text-gray-400 hover:text-amber-500"}`,children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-amber-500"}),"Frequent"]})]})]})}),w==="today"&&V.showRelationshipLines!==!1&&c.jsx(Pee,{containerRef:D,tasks:_e.map(ue=>({data:{id:ue.data.id,parent_id:ue.data.parent_id,color:ue.data.color}}))}),c.jsx(Ree,{show:l.isDragging&&l.dropIndex!==null,top:l.indicatorTop,left:l.indicatorLeft,width:l.indicatorWidth,depth:l.dropDepth,color:Z()}),w==="trash"&&c.jsxs("div",{className:"flex items-center justify-between mb-6 px-4 py-3 bg-gray-50 rounded-lg border border-dashed border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Er,{className:"text-gray-400",size:18}),c.jsx("span",{className:"font-medium text-gray-500 text-sm",children:S("trashEmptyTitle")})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[_e.length>0&&c.jsxs("button",{onClick:()=>{confirm(S("restoreTrashConfirm")||"Are you sure?")&&M()},className:"px-3 py-1.5 bg-white border border-gray-200 text-indigo-500 text-xs font-medium rounded hover:bg-indigo-50 hover:border-indigo-200 transition-colors shadow-sm flex items-center gap-1",children:[c.jsx(Dg,{size:12}),S("restoreTrash")||"Restore All"]}),_e.length>0&&c.jsx("button",{onClick:()=>{confirm(S("emptyTrashConfirm"))&&k()},className:"px-3 py-1.5 bg-white border border-gray-200 text-red-500 text-xs font-medium rounded hover:bg-red-50 hover:border-red-200 transition-colors shadow-sm",children:S("emptyTrash")})]})]}),w==="today"?dt():w==="upcoming"?_e.map((ue,Se)=>c.jsx(Ln.Fragment,{children:s===ue.data.id?c.jsx(Po,{initialData:ue.data,onClose:te},ue.data.id):c.jsxs("div",{className:"relative group",children:[c.jsx("span",{className:"absolute -left-6 top-1/2 -translate-y-1/2 text-[9px] font-mono text-gray-300 select-none",children:Se+1}),c.jsx(xl,{flatTask:ue,isFocused:n===ue.data.id,onEdit:()=>i(ue.data.id),onSelect:Ve},ue.data.id)]})},ue.data.id)):w==="allview"?c.jsxs(c.Fragment,{children:[Et(ke),Me.length>0&&c.jsxs("div",{className:"mt-12",children:[c.jsxs("button",{onClick:()=>Q(!se),className:"flex items-center gap-2 mb-4 px-2 w-full text-left group",children:[se?c.jsx(rs,{size:14,className:"text-gray-400"}):c.jsx(ts,{size:14,className:"text-gray-400"}),c.jsx(am,{size:14,className:"text-gray-400"}),c.jsx("span",{className:"text-[13px] font-bold text-gray-400",children:""}),c.jsx("span",{className:"text-[11px] font-medium px-1.5 py-0.5 rounded-full bg-gray-100 text-gray-500",children:Me.length}),c.jsx("div",{className:"flex-1 h-[2px] rounded-full bg-gradient-to-r from-gray-200 to-transparent"})]}),!se&&c.jsx("div",{className:"opacity-60",children:Me.map(ue=>c.jsxs("div",{className:"relative group",style:{marginLeft:`${ue.depth*24}px`},children:[c.jsx(xl,{flatTask:ue,isFocused:!1,onEdit:()=>{}}),c.jsx("button",{onClick:Se=>{Se.stopPropagation(),_(ue.data.id)},className:"absolute right-2 top-2 z-10 opacity-0 group-hover:opacity-100 px-3 py-1 bg-emerald-600 text-white text-[10px] font-bold rounded-full shadow-lg hover:bg-emerald-700 transition-all flex items-center gap-1",children:""})]},ue.data.id))})]})]}):Et(ie),Be,w==="inbox"&&he.length>0&&c.jsxs("div",{className:"mt-8 border-2 border-dashed border-amber-200 rounded-xl p-4 bg-amber-50/50",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Oz,{size:16,className:"text-amber-500"}),c.jsxs("span",{className:"text-[13px] font-semibold text-amber-700",children:[he.length," "]})]}),c.jsx("button",{onClick:W,className:"px-3 py-1 text-xs font-medium bg-amber-100 hover:bg-amber-200 text-amber-700 rounded-full transition-colors",children:""})]}),c.jsx("div",{className:"space-y-1 opacity-70",children:he.map(ue=>{const Se=b.find(ye=>["project",""].includes(ye.name.trim().toLowerCase())),nt=b.find(ye=>ye.name.includes("")||["someday","inspiration","/"].includes(ye.name.trim().toLowerCase())),ft=b.find(ye=>["note","journal","",""].includes(ye.name.trim().toLowerCase())),ct=b.find(ye=>["prompt",""].includes(ye.name.trim().toLowerCase())),Qe=ft,It=nt,Lt=ue.data.tags||[];let J="";return ue.data.start_date?J="":ue.data.status==="someday"||ue.data.status==="waiting"||It&&Lt.includes(It.id)?J="/":ue.data.parent_id||Se&&Lt.includes(Se.id)?J="":nt&&Lt.includes(nt.id)?J="/":ft&&Lt.includes(ft.id)||Qe&&Lt.includes(Qe.id)?J="":ct&&Lt.includes(ct.id)&&(J=""),c.jsxs("div",{className:"flex items-center justify-between p-2 bg-white/80 rounded-lg",children:[c.jsx("span",{className:"text-sm text-theme-primary truncate flex-1",children:ue.data.title||"()"}),c.jsxs("span",{className:"text-[10px] text-amber-600 bg-amber-100 px-2 py-0.5 rounded-full ml-2",children:[" ",J]})]},ue.data.id)})})]})]})})},Bee=()=>{const{tasks:t,tags:e,addTask:n,addTag:r,user:s,t:i}=x.useContext(En),[o,a]=x.useState(null),[l,u]=x.useState(null),[d,f]=x.useState(()=>{const C=localStorage.getItem(`note_view_expanded_${s==null?void 0:s.id}`);return C?JSON.parse(C):{}});x.useEffect(()=>{s!=null&&s.id&&localStorage.setItem(`note_view_expanded_${s.id}`,JSON.stringify(d))},[d,s==null?void 0:s.id]);const h=x.useMemo(()=>{const C=e.find(_=>_.name.trim().toLowerCase()==="note");return C?C.id:null},[e]),p=x.useMemo(()=>e.filter(C=>C.name.startsWith("#")),[e]),m=x.useMemo(()=>{if(!h)return[];let C=t.filter(_=>_.status!=="deleted"&&_.tags.includes(h));return l&&(C=C.filter(_=>_.tags.includes(l))),C.sort((_,E)=>new Date(E.created_at).getTime()-new Date(_.created_at).getTime())},[t,h,l]),y=x.useMemo(()=>{const C={},_=[];return m.forEach(E=>{const I=E.tags.filter(P=>{if(P===h)return!1;const O=e.find($=>$.id===P);return O&&!O.name.startsWith("#")});if(I.length===0)_.push(E);else{const P=I[0];if(!C[P]){const O=e.find($=>$.id===P);C[P]={tag:O,tasks:[]}}C[P].tasks.push(E)}}),{categories:C,uncategorized:_}},[m,h,e]),b=C=>C.tags.map(_=>e.find(E=>E.id===_)).filter(_=>_&&_.name.startsWith("#")),g=C=>{f(_=>({..._,[C]:!_[C]}))},v=C=>d[C]!==!1,w=async()=>{let C=h;if(C||(C=await r("note")),C){const _=await n({title:"",tags:[C],is_project:!1,status:"active"});setTimeout(()=>{a({id:_})},100)}},T=C=>{a(C)},R=()=>{a(null)},k=C=>{u(l===C?null:C)},M=C=>{const _=b(C);return c.jsxs("div",{onClick:()=>T(C),className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden cursor-pointer group hover:shadow-md transition-all hover:-translate-y-0.5",children:[C.images&&C.images.length>0&&c.jsx("div",{className:"aspect-[16/9] bg-gray-100 relative overflow-hidden",children:c.jsx("img",{src:C.images[0],alt:C.title,className:"w-full h-full object-cover transition-transform group-hover:scale-105"})}),c.jsxs("div",{className:"p-4",children:[_.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:_.map(E=>E&&c.jsx("button",{onClick:I=>{I.stopPropagation(),k(E.id)},className:`text-[10px] px-2 py-0.5 rounded-full font-medium transition-all ${l===E.id?"bg-emerald-500 text-white":"bg-emerald-50 text-emerald-600 hover:bg-emerald-100"}`,children:E.name},E.id))}),c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(Xf,{size:14,className:"text-indigo-400 mt-1 flex-shrink-0"}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h3",{className:`font-medium text-gray-800 line-clamp-2 text-sm ${C.title?"":"italic text-gray-400"}`,children:C.title||""}),C.description&&c.jsx("p",{className:"text-xs text-gray-500 line-clamp-2 mt-1",children:C.description.replace(/<[^>]*>/g,"").slice(0,100)})]})]}),c.jsxs("div",{className:"flex items-center justify-between mt-3 pt-2 border-t border-gray-50",children:[c.jsx("span",{className:"text-[10px] text-gray-400",children:new Date(C.created_at).toLocaleDateString()}),c.jsx("div",{className:"flex flex-wrap gap-1",children:C.tags.filter(E=>{if(E===h)return!1;const I=e.find(P=>P.id===E);return I&&!I.name.startsWith("#")}).slice(0,2).map(E=>{const I=e.find(P=>P.id===E);return I?c.jsx(ED,{tag:I,size:"small"},E):null})})]})]})]},C.id)},S=(C,_)=>{var I,P;const E=v(C);return c.jsxs("div",{className:"mb-6",children:[c.jsxs("button",{onClick:()=>g(C),className:"flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-gray-100 transition-colors w-full text-left group",children:[E?c.jsx(ts,{size:16,className:"text-gray-400"}):c.jsx(rs,{size:16,className:"text-gray-400"}),c.jsx("span",{className:"font-bold text-sm",style:{color:((I=_.tag)==null?void 0:I.color)||"#6366f1"},children:((P=_.tag)==null?void 0:P.name)||""}),c.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(",_.tasks.length,")"]})]}),E&&c.jsx("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pl-6",children:_.tasks.map(M)})]},C)};return c.jsxs("div",{className:"h-full flex flex-col bg-white overflow-hidden relative",children:[c.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-white z-10",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("h2",{className:"font-bold text-gray-700 flex items-center gap-2",children:[c.jsx(xf,{size:18}),i("journal")]}),p.length>0&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(mz,{size:14,className:"text-gray-400"}),c.jsxs("div",{className:"flex flex-wrap gap-1",children:[p.slice(0,5).map(C=>c.jsx("button",{onClick:()=>k(C.id),className:`text-[10px] px-2 py-0.5 rounded-full font-medium transition-all ${l===C.id?"bg-emerald-500 text-white":"bg-gray-100 text-gray-600 hover:bg-emerald-50 hover:text-emerald-600"}`,children:C.name},C.id)),l&&c.jsxs("button",{onClick:()=>u(null),className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-red-50 text-red-500 hover:bg-red-100 flex items-center gap-1",children:[c.jsx(un,{size:10}),""]})]})]})]}),c.jsxs("button",{onClick:w,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors shadow-sm",children:[c.jsx(ni,{size:16})," "]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-gray-50/50",children:m.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx(xf,{size:48,className:"mb-4 opacity-20"}),c.jsx("p",{className:"text-sm",children:l?"":""}),c.jsx("p",{className:"text-xs mt-1",children:l?"":"note"})]}):c.jsxs("div",{children:[Object.entries(y.categories).map(([C,_])=>S(C,_)),y.uncategorized.length>0&&c.jsxs("div",{className:"mb-6",children:[c.jsxs("button",{onClick:()=>g("_uncategorized"),className:"flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-gray-100 transition-colors w-full text-left group",children:[v("_uncategorized")?c.jsx(ts,{size:16,className:"text-gray-400"}):c.jsx(rs,{size:16,className:"text-gray-400"}),c.jsx("span",{className:"font-bold text-sm text-gray-500",children:""}),c.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(",y.uncategorized.length,")"]})]}),v("_uncategorized")&&c.jsx("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pl-6",children:y.uncategorized.map(M)})]})]})}),o&&c.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm",onClick:R,children:c.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-2xl shadow-2xl max-h-[90vh] overflow-y-auto",onClick:C=>C.stopPropagation(),children:[c.jsx("div",{className:"p-2 border-b border-gray-100 flex justify-end",children:c.jsx("button",{onClick:R,className:"p-2 hover:bg-gray-100 rounded-full text-gray-500",children:c.jsx(un,{size:20})})}),c.jsx("div",{className:"p-4",children:c.jsx(Po,{initialData:t.find(C=>C.id===o.id),onClose:R})})]})})]})},Uee={"2024-01-01":"","2024-02-08":"","2024-02-09":"","2024-02-10":"","2024-02-11":"","2024-02-12":"","2024-02-13":"","2024-02-14":"","2024-02-28":"228","2024-04-04":"","2024-04-05":"","2024-06-10":"","2024-09-17":"","2024-10-10":"","2026-01-01":"","2026-02-16":"","2026-02-17":"","2026-02-18":"","2026-02-19":"","2026-02-28":"228","2026-04-04":"","2026-04-05":"","2026-06-19":"","2026-09-25":"","2026-10-10":""},CR=t=>{const e=t.toISOString().split("T")[0];return Uee[e]||null},ER=t=>{const e=t.getFullYear(),n=t.getMonth()+1,r=t.getDate();if(e===2025){if(n===12)return r===24?"":r===21?"":r===1?"":`${(r+10)%30||30}`;if(n===11)return`${(r+9)%30||30}`;if(n===1){if(r===1)return"";if(r===27)return"";if(r===28)return""}return`N${r%30||30}`}if(e===2026){if(n===1)return`${(r+12)%30||28}`;if(n===2){if(r===17)return"";if(r===16)return"";const s=r-17;return s>0?`${s+1}`:`${29+s}`}return`L${n}.${r}`}return""},Hee={"2025-01-05":"","2025-01-20":"","2025-02-03":"","2025-02-18":"","2025-03-05":"","2025-03-20":"","2025-04-04":"","2025-04-20":"","2025-05-05":"","2025-05-21":"","2025-06-05":"","2025-06-21":"","2025-07-07":"","2025-07-22":"","2025-08-07":"","2025-08-23":"","2025-09-07":"","2025-09-23":"","2025-10-08":"","2025-10-23":"","2025-11-07":"","2025-11-22":"","2025-12-07":"","2025-12-21":"","2026-01-05":"","2026-01-20":"","2026-02-04":"","2026-02-19":"","2026-03-06":"","2026-03-21":"","2026-04-05":"","2026-04-20":"","2026-05-06":"","2026-05-21":"","2026-06-06":"","2026-06-21":"","2026-07-07":"","2026-07-23":"","2026-08-08":"","2026-08-23":"","2026-09-08":"","2026-09-23":"","2026-10-08":"","2026-10-23":"","2026-11-07":"","2026-11-22":"","2026-12-07":"","2026-12-22":""},NR=t=>{const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),s=`${e}-${n}-${r}`;return Hee[s]||null},Fi=120,wc=52,Vee=({onDateClick:t,filterTags:e=[],filterTagsExclude:n=[],filterColors:r=[],filterProjects:s=[]})=>{const{tasks:i,tags:o,batchUpdateTasks:a,addTask:l,setEditingTaskId:u,editingTaskId:d,selectedTaskIds:f,setSelectedTaskIds:h,constructionModeEnabled:p,setConstructionModeEnabled:m,setCalendarDate:y,view:b,viewTagFilters:g,themeSettings:v,tagsWithResolvedColors:w}=x.useContext(En),[T,R]=x.useState(null),k=x.useRef(new Map),M=x.useRef(new Map);x.useEffect(()=>{R(null)},[d]);const S=ie=>{var Q;if(ie.tags&&ie.tags.length>0){const ke=ie.tags.find(Me=>{const fe=o.find(Re=>Re.id===Me);return fe&&fe.name.toLowerCase().includes("google")});if(ke){if(w&&w[ke])return w[ke];const Me=o.find(fe=>fe.id===ke);if(Me!=null&&Me.color)return Me.color}for(const Me of ie.tags){if(w&&w[Me])return w[Me];const fe=o.find(Re=>Re.id===Me);if(fe!=null&&fe.color)return fe.color}}const he=mp(ie,i);if(he&&he.color&&he.color!=="gray"){const ke=Jn[he.color];if(ke)return ke.color}const se=ie.color||"blue";return((Q=Jn[se])==null?void 0:Q.color)||Jn.blue.color},C=x.useRef(null),_=x.useRef(null),E=x.useRef(!1),I=x.useRef(null),[P,O]=x.useState([]),[$,A]=x.useState(null),[j,W]=x.useState(null),[V,D]=x.useState(new Date),[ge,me]=x.useState(null),[F,U]=x.useState(null),[ne,Oe]=x.useState({start:0,end:200}),at=Ln.useMemo(()=>{let ie=i.filter(he=>he.status!=="deleted");if(b==="focus"){const he=g.focus||{include:[],exclude:[]},{include:se,exclude:Q}=Array.isArray(he)?{include:he,exclude:[]}:he;se.length>0&&(ie=ie.filter(ke=>ke.tags.some(Me=>se.includes(Me)))),Q.length>0&&(ie=ie.filter(ke=>!ke.tags.some(Me=>Q.includes(Me))))}return e.length>0&&(ie=ie.filter(he=>he.tags.some(se=>e.includes(se)))),n.length>0&&(ie=ie.filter(he=>!he.tags.some(se=>n.includes(se)))),r.length>0&&(ie=ie.filter(he=>r.includes(he.color))),s.length>0&&(ie=ie.filter(he=>{if(s.includes(he.id)||he.parent_id&&s.includes(he.parent_id))return!0;let se=i.find(Q=>Q.id===he.parent_id);for(;se;){if(s.includes(se.id))return!0;se=i.find(Q=>Q.id===(se==null?void 0:se.parent_id))}return!1})),ie},[i,b,g,e,n,r,s]),ae=ie=>{const he=ie.getDay(),se=new Date(ie);se.setDate(ie.getDate()-he),se.setHours(0,0,0,0);const Q=[];for(let ke=0;ke<7;ke++){const Me=new Date(se);Me.setDate(se.getDate()+ke),Q.push({date:Me,isCurrentMonth:!0,isToday:_i(Me,new Date)})}return{id:se.toDateString(),days:Q,firstDate:se}},_e=Ln.useMemo(()=>{const ie=new Map;return at.forEach(he=>{if(he.status==="deleted"||he.status==="logged")return;const se=he.start_date||he.due_date;if(se){const Q=new Date(se),ke=`${Q.getFullYear()}-${Q.getMonth()}-${Q.getDate()}`;ie.has(ke)||ie.set(ke,[]),ie.get(ke).push(he)}}),ie},[at]),le=x.useCallback(ie=>{const he=`${ie.getFullYear()}-${ie.getMonth()}-${ie.getDate()}`;return(_e.get(he)||[]).slice().sort((Q,ke)=>Q.is_all_day&&!ke.is_all_day?-1:!Q.is_all_day&&ke.is_all_day?1:!Q.is_all_day&&!ke.is_all_day?(Q.start_time||"").localeCompare(ke.start_time||""):(Q.order_index||0)-(ke.order_index||0))},[_e]);x.useEffect(()=>{const ie=new Date,he=[],se=-wc,Q=wc;for(let ke=se;ke<=Q;ke++){const Me=new Date(ie);Me.setDate(ie.getDate()+ke*7),he.push(ae(Me))}O(he),setTimeout(()=>{if(C.current){const Me=wc*Fi-C.current.clientHeight/2+Fi/2;C.current.scrollTop=Me}},100)},[]),x.useLayoutEffect(()=>{if(E.current&&C.current){const ie=4*Fi;C.current.scrollTop+=ie,E.current=!1}},[P]);const Ce=x.useCallback(()=>{const ie=C.current;if(!ie)return;const{scrollTop:he,clientHeight:se,scrollHeight:Q}=ie;Q-he-se<500&&O(xt=>{const Dt=xt[xt.length-1],oe=[];for(let Ee=1;Ee<=4;Ee++){const Ue=new Date(Dt.firstDate);Ue.setDate(Ue.getDate()+Ee*7),oe.push(ae(Ue))}return[...xt,...oe]}),he<200&&!E.current&&(E.current=!0,O(xt=>{const Dt=xt[0],oe=[];for(let Ee=4;Ee>=1;Ee--){const Ue=new Date(Dt.firstDate);Ue.setDate(Ue.getDate()-Ee*7),oe.push(ae(Ue))}return[...oe,...xt]}));const ke=Math.floor((he+100)/Fi),Me=P[ke];if(Me){const xt=Me.days[3].date;D(xt)}const fe=6,Re=Math.floor(he/Fi)-fe,qe=Math.ceil((he+se)/Fi)+fe;Oe(xt=>xt.start===Re&&xt.end===qe?xt:{start:Math.max(0,Re),end:qe})},[P]),Le=async(ie,he)=>{const se=ie.toDateString();if(p&&f.length>0){const Q=[...f];if(he.altKey)for(const ke of Q){const Me=i.find(fe=>fe.id===ke);Me&&await l({...Me,id:void 0,start_date:ie.toISOString()})}else{const ke=Q.map(Me=>({id:Me,data:{start_date:ie.toISOString()}}));await a(ke),h([]),m(!1)}A(se),setTimeout(()=>A(null),600)}else me(ie)},Ve=(ie,he)=>{he.stopPropagation(),t&&t(ie)},st=async()=>{if(f.length===0)return;const ie=o.find(Q=>Q.name.toLowerCase()==="schedule"||Q.name==="");if(!ie)return;const he=f.every(Q=>{var Me;const ke=i.find(fe=>fe.id===Q);return(Me=ke==null?void 0:ke.tags)==null?void 0:Me.includes(ie.id)}),se=f.map(Q=>{const ke=i.find(fe=>fe.id===Q);if(!ke)return null;let Me=[...ke.tags||[]];return he?Me=Me.filter(fe=>fe!==ie.id):Me.includes(ie.id)||Me.push(ie.id),{id:Q,data:{tags:Me}}}).filter(Boolean);se.length>0&&await a(se)},Be=(ie,he)=>{he.stopPropagation(),U({date:ie,title:""}),setTimeout(()=>{var se;return(se=I.current)==null?void 0:se.focus()},50)},ht=async()=>{F&&(F.title.trim()&&await l({title:F.title.trim(),start_date:F.date.toISOString(),is_all_day:!0,status:"inbox",color:"gray"}),U(null))},vt=["","","","","","",""],te=`${V.getFullYear()} ${V.getMonth()+1}`,Z=x.useCallback(()=>{const ie=new Date;y(ie);const he=[];for(let se=-wc;se<=wc;se++){const Q=new Date(ie);Q.setDate(ie.getDate()+se*7),he.push(ae(Q))}if(O(he),C.current){const Q=wc*Fi-C.current.clientHeight/2+Fi/2;C.current.scrollTop=Q}},[ae,y,O]);return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main relative",children:[c.jsx("div",{className:"absolute top-12 left-1/2 -translate-x-1/2 z-40 pointer-events-none opacity-0 transition-opacity duration-300 data-[visible=true]:opacity-100","data-visible":!0,children:c.jsxs("div",{className:"bg-theme-header backdrop-blur-md shadow-lg border border-theme px-4 py-1.5 rounded-full text-sm font-bold text-theme-primary flex items-center gap-2",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-500"}),te]})}),c.jsxs("div",{ref:C,className:"flex-1 overflow-y-auto overflow-x-hidden relative",onScroll:Ce,style:{scrollBehavior:"auto"},children:[c.jsx("div",{className:"flex border-b border-theme bg-theme-sidebar z-30 sticky top-0 shadow-sm min-h-[32px]",children:vt.map((ie,he)=>c.jsx("div",{className:`flex-1 text-center py-2 text-xs font-bold ${he===0?"text-red-500":he===6?"text-green-600":"text-theme-tertiary"}`,children:ie},ie))}),c.jsx("div",{className:"relative",style:{height:P.length*Fi},children:P.map((ie,he)=>he<ne.start||he>ne.end||!C.current?null:c.jsx("div",{className:"flex w-full absolute left-0 right-0 border-b border-theme",style:{height:Fi,top:he*Fi},children:ie.days.map((se,Q)=>{const ke=se.date.getDate()===1,Me=le(se.date),fe=$===se.date.toDateString(),Re=p&&f.length>0,qe=ge&&_i(se.date,ge),xt=CR(se.date),Dt=ER(se.date),oe=NR(se.date),Ee=se.date.getDay()===0||se.date.getDay()===6,Ue=se.date.getDay()===0,tt=se.date.getDay()===6;return c.jsxs("div",{className:`
                                                flex-1 min-w-0 h-full border-r border-theme relative group
                                                ${qe?"bg-indigo-500/10":""}
                                                ${se.isToday&&!qe?"bg-indigo-500/5":Ee&&!qe?"bg-theme-sidebar":se.date.getMonth()%2===0&&!qe?"bg-theme-main":qe?"":"bg-theme-hover/30"}
                                                ${fe?"ring-4 ring-green-400 bg-green-50 animate-pulse z-20":""}
                                                ${j===se.date.toDateString()?"bg-indigo-500/20 ring-inset ring-2 ring-indigo-400 z-10 transition-colors duration-150":""}
                                                ${Re?"cursor-pointer hover:ring-[1.5px] hover:ring-indigo-500 hover:shadow-sm hover:z-30 z-10":""}
                                                ${!se.isToday&&!fe&&j!==se.date.toDateString()&&!qe?"hover:bg-theme-hover":""}
                                            `,onDragEnter:()=>W(se.date.toDateString()),onDragOver:Ne=>{Ne.preventDefault(),Ne.dataTransfer.dropEffect="move"},onDrop:Ne=>{Ne.preventDefault(),W(null);try{const pt=Ne.dataTransfer.getData("application/json"),dt=JSON.parse(pt);if(Array.isArray(dt)&&dt.length>0){const Et=new Date(se.date);Et.setHours(9,0,0,0);const ue=Ne.currentTarget.getBoundingClientRect(),nt=Ne.clientY-ue.top<ue.height*.35,ft=dt.map(ct=>({id:ct,data:{start_date:Et.toISOString(),is_all_day:nt,...nt?{start_time:null,end_time:null}:{start_time:"09:00",end_time:"10:00"}}}));a(ft)}}catch(pt){console.error("Failed to parse drag data",pt)}},onClick:Ne=>Le(se.date,Ne),onDoubleClick:Ne=>Be(se.date,Ne),children:[ke&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"absolute top-0 left-0 w-full border-t-2 border-indigo-500 z-10 shadow-sm"}),c.jsxs("div",{className:"absolute -top-3 left-2 bg-indigo-600 text-white text-xs font-bold px-2 py-0.5 rounded-full z-20 shadow-md",children:[se.date.getFullYear()," ",se.date.getMonth()+1,""]}),c.jsx("div",{className:"absolute top-2 left-2 text-6xl font-black text-indigo-500/5 pointer-events-none -z-10 select-none",children:se.date.getMonth()+1})]}),c.jsxs("div",{className:"p-1 h-full flex flex-col gap-0.5 overflow-hidden",onDoubleClick:Ne=>Ve(se.date,Ne),children:[c.jsxs("div",{className:"flex items-start justify-between min-w-0 pointer-events-none",children:[c.jsxs("div",{className:"flex flex-col leading-none pt-0.5 pl-0.5 max-w-[70%] text-left",children:[v.showTaiwanHolidays&&xt&&c.jsx("span",{className:"text-[9px] font-bold truncate text-red-500",children:xt}),oe&&c.jsxs("span",{className:"text-[8px] font-bold truncate text-amber-600",children:[" ",oe]}),v.showLunar&&c.jsx("span",{className:`text-[8px] truncate ${xt||oe?"text-gray-400":"text-gray-300"}`,children:Dt})]}),c.jsx("div",{className:`
                                                        text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-full ml-auto flex-shrink-0
                                                        ${se.isToday?"bg-indigo-600 text-white":Ue?"text-red-500":tt?"text-green-600":"text-theme-tertiary group-hover:text-theme-secondary"}
                                                    `,children:se.date.getDate()})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden space-y-0.5 no-scrollbar",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:[Me.map(Ne=>{var It,Lt;const pt=S(Ne),dt=Ne.is_all_day,Et=f.includes(Ne.id),ue=(It=o.find(J=>J.name.toLowerCase()==="schedule"||J.name===""))==null?void 0:It.id,Se=ue&&((Lt=Ne.tags)==null?void 0:Lt.includes(ue)),nt=dt?{backgroundColor:pt,color:"white",boxShadow:"0 1px 1px rgba(0,0,0,0.1)",border:Et?"2px solid white":`1px solid ${pt}40`}:{backgroundColor:Et?pt+"30":pt+"1A",color:pt,borderLeft:`3px solid ${pt}`},ft=J=>J?J.replace(":",""):"",ct=J=>{J&&k.current.set(Ne.id,J)},Qe=J=>{J&&M.current.set(Ne.id,J)};return c.jsxs("div",{ref:Qe,id:`task-bubble-${Ne.id}`,draggable:!0,onDragStart:J=>{let ye=[Ne.id];if(f.includes(Ne.id)&&(ye=f),J.dataTransfer.setData("application/json",JSON.stringify(ye)),J.dataTransfer.effectAllowed="move",R(null),_.current){const Ge=_.current.querySelector("#drag-ghost-count"),kt=_.current.querySelector("#drag-ghost-title"),Y=_.current.querySelector("#drag-ghost-stack-1"),ze=_.current.querySelector("#drag-ghost-stack-2");Ge&&(Ge.textContent=ye.length.toString()),kt&&(kt.textContent=ye.length>1?`${ye.length} Tasks Selected`:Ne.title),Y&&(Y.style.opacity=ye.length>1?"1":"0"),ze&&(ze.style.opacity=ye.length>2?"1":"0"),J.dataTransfer.setDragImage(_.current,0,0)}},onDragEnd:()=>W(null),onClick:J=>{J.stopPropagation(),J.metaKey||J.ctrlKey||J.shiftKey?f.includes(Ne.id)?h(ye=>ye.filter(Ge=>Ge!==Ne.id)):h(ye=>[...ye,Ne.id]):h([Ne.id])},onDoubleClick:J=>{J.stopPropagation(),u(Ne.id)},onMouseEnter:()=>{const J=k.current.get(Ne.id),ye=M.current.get(Ne.id);if(J&&ye&&J.scrollWidth>J.clientWidth){const Ge=ye.getBoundingClientRect();R({taskId:Ne.id,title:Ne.title,x:Ge.left,y:Ge.top-8})}},onMouseLeave:()=>R(null),className:`
                                                                    relative text-[9.5px] px-1.5 rounded-md cursor-pointer hover:brightness-95 transition-all mb-0.5
                                                                    flex items-center justify-between gap-1
                                                                    ${Et&&dt?"ring-2 ring-indigo-400 z-10":""}
                                                                    ${Et&&!dt?"z-10":""}
                                                                `,style:{...nt,height:"auto",minHeight:"22px",lineHeight:"1.2",...Se?{backgroundImage:"repeating-linear-gradient(45deg, rgba(255,255,255,0.1) 0px, rgba(255,255,255,0.1) 4px, transparent 4px, transparent 8px)"}:{}},children:[c.jsx("span",{ref:ct,className:"truncate flex-1 font-medium select-none",children:Ne.title||""}),!dt&&(Ne.start_time||Ne.end_time)&&c.jsxs("div",{className:"flex flex-col items-end leading-none shrink-0 opacity-80",style:{fontSize:"7px",transform:"scale(0.95)",transformOrigin:"right center"},children:[Ne.start_time&&c.jsx("span",{children:ft(Ne.start_time)}),Ne.end_time&&c.jsx("span",{children:ft(Ne.end_time)})]})]},Ne.id)}),F&&F.date.toDateString()===se.date.toDateString()&&c.jsx("div",{className:"px-1.5 py-0.5 rounded-md border-2 border-dashed border-indigo-400 bg-indigo-50/50",children:c.jsx("input",{ref:I,type:"text",value:F.title,onChange:Ne=>U({...F,title:Ne.target.value}),onKeyDown:Ne=>{Ne.key==="Enter"&&ht(),Ne.key==="Escape"&&U(null)},onBlur:ht,placeholder:"...",className:"w-full text-[9.5px] bg-transparent outline-none text-indigo-400 font-medium",autoFocus:!0})})]})]})]},Q)})},ie.id))})]}),f.length>0&&c.jsx("button",{onClick:st,className:`absolute bottom-6 right-24 w-10 h-10 border rounded-full shadow-lg flex items-center justify-center transition-all z-30
                        ${f.every(ie=>{var Q;const he=i.find(ke=>ke.id===ie),se=o.find(ke=>ke.name.toLowerCase()==="schedule"||ke.name==="");return se&&((Q=he==null?void 0:he.tags)==null?void 0:Q.includes(se.id))})?"bg-indigo-100 text-indigo-700 border-indigo-200":"bg-theme-card border-theme text-theme-secondary hover:text-indigo-600 hover:border-indigo-300"}`,title:" Schedule  ()",children:c.jsx(EI,{size:20})}),c.jsx("button",{onClick:Z,className:"absolute bottom-4 right-4 bg-indigo-600 text-white px-3 py-1.5 rounded-full shadow-lg text-xs font-bold hover:apply-indigo-700 transition-transform active:scale-95 flex items-center gap-1",children:"Today"}),c.jsx("div",{ref:_,className:"fixed top-[-1000px] left-[-1000px] z-50 pointer-events-none",children:c.jsxs("div",{className:"bg-theme-card backdrop-blur-xl border border-theme p-3 rounded-xl shadow-2xl flex items-center gap-3 w-48 relative overflow-hidden ring-1 ring-black/5",children:[c.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-50/50 to-purple-50/50 -z-10"}),c.jsx("div",{className:"absolute right-0 top-0 w-16 h-16 bg-indigo-500/10 rounded-full blur-2xl -mr-8 -mt-8"}),c.jsx("div",{id:"drag-ghost-count",className:"flex-shrink-0 w-8 h-8 bg-indigo-600 text-white rounded-lg flex items-center justify-center font-black text-sm shadow-indigo-200 shadow-lg transform rotate-[-6deg]",children:"1"}),c.jsxs("div",{className:"flex flex-col min-w-0",children:[c.jsx("span",{className:"text-[10px] uppercase tracking-wider text-indigo-500 font-bold",children:"Moving"}),c.jsx("span",{id:"drag-ghost-title",className:"text-sm font-bold text-gray-700 truncate leading-tight",children:"Task Title"})]}),c.jsx("div",{id:"drag-ghost-stack-1",className:"absolute top-1 left-1 w-full h-full bg-white/50 border border-gray-200/50 rounded-xl -z-20 transform rotate-2 scale-95 origin-center transition-opacity"}),c.jsx("div",{id:"drag-ghost-stack-2",className:"absolute top-2 left-2 w-full h-full bg-white/30 border border-gray-200/30 rounded-xl -z-30 transform rotate-4 scale-90 origin-center transition-opacity"})]})}),T&&ir.createPortal(c.jsxs("div",{className:"fixed z-[9999] w-max max-w-[300px] bg-white/95 backdrop-blur-xl text-slate-800 text-base px-4 py-2.5 rounded-xl shadow-2xl break-words whitespace-normal leading-relaxed font-medium tracking-normal animate-in fade-in zoom-in-95 duration-150 pointer-events-none border border-slate-200/80 ring-1 ring-black/5",style:{left:T.x,top:T.y,transform:"translateY(-100%)"},children:[T.title,c.jsx("div",{className:"absolute left-4 top-full w-0 h-0 border-[6px] border-transparent border-t-white/95"})]}),document.body)]})},dE=60,aa=40,Wee=200,Jh=15,fE=500,Kee=["","","","","","",""],Gee=({filterTags:t=[],filterTagsExclude:e=[],filterColors:n=[],filterProjects:r=[]})=>{const{tasks:s,tags:i,calendarDate:o,setCalendarDate:a,editingTaskId:l,setEditingTaskId:u,addTask:d,handleSelection:f,selectedTaskIds:h,setSelectedTaskIds:p,batchDeleteTasks:m,batchUpdateTasks:y,tagsWithResolvedColors:b}=x.useContext(En),g=(oe,Ee)=>{var tt;if(oe.tags&&oe.tags.length>0){const Ne=oe.tags.find(Et=>{const ue=i.find(Se=>Se.id===Et);return ue&&ue.name.toLowerCase().includes("google")});if(Ne){if(b&&b[Ne])return b[Ne];const Et=i.find(ue=>ue.id===Ne);if(Et!=null&&Et.color)return Et.color}const pt=oe.tags[0];if(b&&b[pt])return b[pt];const dt=i.find(Et=>Et.id===pt);if(dt!=null&&dt.color)return dt.color}const Ue=Ee.color||oe.color||"blue";return((tt=Jn[Ue])==null?void 0:tt.color)||Jn.blue.color},v=x.useRef(null),w=x.useRef(null),[T,R]=x.useState([]),[k,M]=x.useState(new Date),S=x.useRef(!1),C=x.useRef(0),_=x.useRef(0),E=x.useRef(null),[I,P]=x.useState(Wee),[O,$]=x.useState(null),[A,j]=x.useState(72),[W,V]=x.useState(null),[D,ge]=x.useState(null),me=x.useRef(null),[F,U]=x.useState(null),[ne,Oe]=x.useState(null),at=x.useRef(null),ae=x.useMemo(()=>{const oe=new Map;let Ee=s.filter(Ue=>Ue.status!=="deleted"&&Ue.status!=="logged");return t.length>0&&(Ee=Ee.filter(Ue=>Ue.tags.some(tt=>t.includes(tt)))),e.length>0&&(Ee=Ee.filter(Ue=>!Ue.tags.some(tt=>e.includes(tt)))),n.length>0&&(Ee=Ee.filter(Ue=>n.includes(Ue.color))),r.length>0&&(Ee=Ee.filter(Ue=>{if(r.includes(Ue.id)||Ue.parent_id&&r.includes(Ue.parent_id))return!0;let tt=s.find(Ne=>Ne.id===Ue.parent_id);for(;tt;){if(r.includes(tt.id))return!0;tt=s.find(Ne=>Ne.id===(tt==null?void 0:tt.parent_id))}return!1})),Ee.forEach(Ue=>{const tt=Ue.start_date||Ue.due_date;if(tt){const Ne=new Date(tt),pt=`${Ne.getFullYear()}-${Ne.getMonth()}-${Ne.getDate()}`;oe.has(pt)||oe.set(pt,[]),oe.get(pt).push(Ue)}}),oe},[s,t,e,n,r]),[_e,le]=x.useState(!1),Ce=9,Le=18,Ve=20,st=oe=>_e?oe>=Ce&&oe<Le?dE:Ve:dE,Be=oe=>{let Ee=0;const Ue=Math.floor(oe/60);for(let Ne=0;Ne<Ue;Ne++)Ee+=st(Ne);const tt=oe%60;return Ee+=tt/60*st(Ue),Ee},ht=oe=>{let Ee=0;for(let Ue=0;Ue<24;Ue++){const tt=st(Ue);if(oe<=Ee+tt){const Ne=(oe-Ee)/tt;return Ue*60+Ne*60}Ee+=tt}return 24*60},vt=()=>{let oe=0;for(let Ee=0;Ee<24;Ee++)oe+=st(Ee);return oe},te=oe=>{if(!oe)return 0;const[Ee,Ue]=oe.split(":").map(Number);return Ee*60+Ue},Z=oe=>{const Ee=Math.floor(oe/60),Ue=Math.floor(oe%60);return`${String(Ee).padStart(2,"0")}:${String(Ue).padStart(2,"0")}`};x.useEffect(()=>{const oe=new Date(o);oe.setHours(0,0,0,0);const Ee=[];for(let Ue=-Jh;Ue<=Jh;Ue++){const tt=new Date(oe);tt.setDate(oe.getDate()+Ue),Ee.push(tt)}R(Ee),setTimeout(()=>{if(w.current){const Ue=Ee.length*I/2-w.current.clientWidth/2;w.current.scrollLeft=Ue}},0)},[]),x.useEffect(()=>{const oe=setInterval(()=>M(new Date),6e4);return()=>clearInterval(oe)},[]),x.useEffect(()=>{const oe=Ee=>{var Ue;if((Ee.key==="Delete"||Ee.key==="Backspace")&&h.length>0&&!l){if(["INPUT","TEXTAREA"].includes(((Ue=document.activeElement)==null?void 0:Ue.tagName)||""))return;Ee.preventDefault(),m(h,!1)}};return window.addEventListener("keydown",oe),()=>window.removeEventListener("keydown",oe)},[h,m,l]);const ie=()=>{const oe=new Date;oe.setHours(0,0,0,0);const Ee=T.findIndex(Ue=>_i(Ue,oe));if(Ee!==-1&&w.current){const Ue=Ee*I-w.current.clientWidth/2+I/2;w.current.scrollTo({left:Ue,behavior:"smooth"});const tt=Be(k.getHours()*60+k.getMinutes()),Ne=aa+A+4,pt=Math.max(0,tt+Ne-w.current.clientHeight/3);setTimeout(()=>{var dt;(dt=w.current)==null||dt.scrollTo({top:pt,behavior:"smooth"})},300)}else{a(oe);const Ue=[];for(let tt=-Jh;tt<=Jh;tt++){const Ne=new Date(oe);Ne.setDate(oe.getDate()+tt),Ue.push(Ne)}R(Ue),setTimeout(()=>{if(w.current){const tt=Ue.length*I/2-w.current.clientWidth/2;w.current.scrollLeft=tt}},0)}},he=async()=>{if(h.length===0)return;const oe=i.find(tt=>tt.name.toLowerCase()==="schedule"||tt.name==="");if(!oe){console.warn("Schedule tag not found");return}const Ee=h.every(tt=>{var pt;const Ne=s.find(dt=>dt.id===tt);return(pt=Ne==null?void 0:Ne.tags)==null?void 0:pt.includes(oe.id)}),Ue=h.map(tt=>{const Ne=s.find(dt=>dt.id===tt);if(!Ne)return null;let pt=[...Ne.tags||[]];return Ee?pt=pt.filter(dt=>dt!==oe.id):pt.includes(oe.id)||pt.push(oe.id),{id:tt,data:{tags:pt}}}).filter(Boolean);Ue.length>0&&await y(Ue)};x.useEffect(()=>{setTimeout(()=>ie(),100)},[]);const se=()=>{const oe=w.current;if(!oe)return;const{scrollLeft:Ee,scrollWidth:Ue,clientWidth:tt}=oe,Ne=Ee<C.current;C.current=Ee,Ee<fE&&!S.current&&Ne&&(S.current=!0,R(pt=>{const dt=pt[0],Et=[];for(let ue=1;ue<=7;ue++){const Se=new Date(dt);Se.setDate(dt.getDate()-ue),Et.unshift(Se)}return[...Et,...pt]})),Ue-(Ee+tt)<fE&&R(pt=>{const dt=pt[pt.length-1],Et=[];for(let ue=1;ue<=7;ue++){const Se=new Date(dt);Se.setDate(dt.getDate()+ue),Et.push(Se)}return[...pt,...Et]})};x.useLayoutEffect(()=>{if(S.current&&w.current){const oe=7*I;w.current.scrollLeft+=oe,S.current=!1}},[T,I]),x.useEffect(()=>{if(!O)return;const oe=Ue=>{const tt=Ue.clientX-O.initialMouseX,Ne=Math.max(120,Math.min(400,O.initialWidth+tt)),pt=Ne-O.initialWidth,Et=O.columnIndex*pt;w.current&&(w.current.scrollLeft=O.initialScrollLeft+Et),P(Ne)},Ee=()=>{$(null)};return window.addEventListener("mousemove",oe),window.addEventListener("mouseup",Ee),()=>{window.removeEventListener("mousemove",oe),window.removeEventListener("mouseup",Ee)}},[O]);const Q=(oe,Ee)=>{var Ue;oe.preventDefault(),oe.stopPropagation(),$({initialWidth:I,initialMouseX:oe.clientX,columnIndex:Ee,initialScrollLeft:((Ue=w.current)==null?void 0:Ue.scrollLeft)||0})};x.useEffect(()=>{if(!W)return;const oe=Ue=>{const tt=Ue.clientY-W.initialMouseY,Ne=Math.max(30,Math.min(200,W.initialHeight+tt));j(Ne)},Ee=()=>{V(null)};return window.addEventListener("mousemove",oe),window.addEventListener("mouseup",Ee),()=>{window.removeEventListener("mousemove",oe),window.removeEventListener("mouseup",Ee)}},[W]);const ke=oe=>{oe.preventDefault(),oe.stopPropagation(),V({initialHeight:A,initialMouseY:oe.clientY})};x.useEffect(()=>{const oe=()=>{_.current!==0&&w.current?(w.current.scrollLeft+=_.current,E.current=requestAnimationFrame(oe)):E.current=null},Ee=tt=>{if(at.current&&!ne){const{initialMouseX:Ne,initialMouseY:pt}=at.current;if(Math.abs(tt.clientX-Ne)>3||Math.abs(tt.clientY-pt)>3){const dt=at.current.task;Oe({...at.current,originalStartMin:te(dt.start_time),originalDuration:dt.duration||60,currentDate:at.current.originalDate,currentStartMin:te(dt.start_time)||540,currentDuration:dt.duration||60,currentSection:at.current.originalType,startOffsetMin:at.current.startOffsetMin})}}if(ne){if(tt.preventDefault(),w.current){const{left:Qe,width:It}=w.current.getBoundingClientRect(),Lt=Qe+It,J=120;let ye=0;const Ge=25;if(tt.clientX<Qe+J){const Y=1-Math.max(0,tt.clientX-Qe)/J;ye=-Math.max(2,Math.round(Ge*Y))}else if(tt.clientX>Lt-J){const Y=1-Math.max(0,Lt-tt.clientX)/J;ye=Math.max(2,Math.round(Ge*Y))}ye!==_.current&&(_.current=ye,ye!==0&&!E.current&&oe())}const Ne=document.elementsFromPoint(tt.clientX,tt.clientY);let pt=ne.currentSection,dt=ne.currentDate,Et=ne.currentStartMin,ue=ne.currentDuration;const Se=Ne.find(Qe=>Qe.getAttribute("data-drop-zone")==="allday"),nt=Ne.find(Qe=>Qe.getAttribute("data-drop-zone")==="grid"),ft=Ne.find(Qe=>Qe.getAttribute("data-date")),ct=ft==null?void 0:ft.getAttribute("data-date");if(ct&&(dt=new Date(ct)),Se?pt="allday":nt&&(pt="grid"),pt==="grid"&&nt){const Qe=nt.getBoundingClientRect();let It=tt.clientY-Qe.top,Lt=ht(It);if(ne.type==="move")Lt=Lt-ne.startOffsetMin,Et=Math.round(Lt/15)*15,Et=Math.max(0,Math.min(1425,Et));else if(ne.type==="resize-bottom"){const J=Math.round(Lt/15)*15,ye=Math.max(15,J-ne.originalStartMin);ne.currentDuration=ye,ue=ye,Et=ne.originalStartMin}else if(ne.type==="resize-top"){let J=Math.round(Lt/15)*15;const ye=ne.originalStartMin+ne.originalDuration;let Ge=ye-J;Ge<15&&(Ge=15,J=ye-15),ue=Ge,Et=J}}Oe(Qe=>Qe?{...Qe,currentDate:dt,currentSection:pt,currentStartMin:Et,currentDuration:ue}:null)}},Ue=async()=>{if(_.current=0,E.current&&(cancelAnimationFrame(E.current),E.current=null),ne){const{task:tt,currentDate:Ne,currentSection:pt,currentStartMin:dt,currentDuration:Et,originalType:ue,type:Se}=ne,nt=h.includes(tt.id)?h:[tt.id],ft=[],ct=Ne.getTime()-ne.originalDate.getTime(),Qe=Math.round(ct/864e5),It=dt-ne.originalStartMin;for(const Lt of nt){const J=s.find(Ge=>Ge.id===Lt);if(!J)continue;const ye={};if(J.start_date){const Ge=new Date(J.start_date);Ge.setDate(Ge.getDate()+Qe),ye.start_date=Ge.toISOString()}else ye.start_date=Ne.toISOString();if(pt==="allday")ye.is_all_day=!0;else if(ye.is_all_day=!1,ue==="grid"){let kt=te(J.start_time)+It;if(kt<0&&(kt=0),ye.start_time=Z(kt),ye.start_date){const Y=new Date(ye.start_date);Y.setHours(Math.floor(kt/60)),Y.setMinutes(kt%60),ye.start_date=Y.toISOString()}Se==="resize-bottom"||Se==="resize-top"?ye.duration=Et:ye.duration=J.duration||60,ye.end_time=Z((te(ye.start_time)||0)+(ye.duration||60))}else ye.start_time=Z(dt),ye.duration=60,ye.end_time=Z(dt+60);ft.push({id:Lt,data:ye})}ft.length>0&&await y(ft)}Oe(null),at.current=null};return window.addEventListener("mousemove",Ee),window.addEventListener("mouseup",Ue),()=>{window.removeEventListener("mousemove",Ee),window.removeEventListener("mouseup",Ue)}},[ne,s,h,y]);const Me=(oe,Ee,Ue,tt,Ne)=>{if(oe.button!==0)return;oe.preventDefault(),oe.stopPropagation(),f(oe,Ee.id);let pt=0,dt=200;const Et=oe.currentTarget;if(dt=Et.getBoundingClientRect().width,!Ne){const Se=Et.closest(".schedule-body");if(Se){const nt=Se.getBoundingClientRect(),ft=oe.clientY-nt.top;pt=ht(ft)-te(Ee.start_time)}else pt=0}at.current={task:Ee,initialMouseX:oe.clientX,initialMouseY:oe.clientY,originalDate:Ue,type:tt,originalType:Ne?"allday":"grid",startOffsetMin:pt,colWidth:dt}},fe=async(oe,Ee)=>{oe.stopPropagation(),p([]);const Ue=await d({title:"",start_date:Ee.toISOString(),is_all_day:!0,status:"inbox"});u(Ue)},Re=(oe,Ee)=>{if(oe.button!==0)return;p([]);const Ue=oe.currentTarget.getBoundingClientRect(),tt=oe.clientY-Ue.top,Ne=Math.floor(ht(tt)/15)*15;ge({date:Ee,startMin:Ne,duration:60,title:""}),setTimeout(()=>{var pt;return(pt=me.current)==null?void 0:pt.focus()},50)},qe=async()=>{D&&D.title.trim()&&await d({title:D.title,start_date:D.date.toISOString(),start_time:Z(D.startMin),duration:D.duration,status:"inbox",is_all_day:!1}),ge(null)},xt=(oe,Ee)=>{if(oe.button!==0||oe.target.closest("[data-task-id]"))return;p([]);const tt=oe.currentTarget.getBoundingClientRect(),Ne=oe.clientY-tt.top,pt=Math.floor(ht(Ne)/15)*15;U({date:Ee,startMin:pt,endMin:pt,initialY:oe.clientY})};x.useEffect(()=>{if(!F)return;const oe=Ue=>{if(!w.current)return;const Ne=document.querySelector(`div[data-date="${F.date.toISOString()}"]`);if(!Ne)return;const pt=Ne.querySelector(".schedule-body");if(!pt)return;const dt=pt.getBoundingClientRect(),Et=Ue.clientY-dt.top,ue=Math.floor(ht(Et)/15)*15,Se=Math.max(0,Math.min(24*60-15,ue));U(nt=>nt?{...nt,endMin:Se}:null)},Ee=()=>{if(F){const{date:Ue,startMin:tt,endMin:Ne}=F,pt=Math.min(tt,Ne),Et=Math.max(tt,Ne)-pt;Et>=15&&(ge({date:Ue,startMin:pt,duration:Math.max(15,Et),title:""}),setTimeout(()=>{var ue;return(ue=me.current)==null?void 0:ue.focus()},50))}U(null)};return window.addEventListener("mousemove",oe),window.addEventListener("mouseup",Ee),()=>{window.removeEventListener("mousemove",oe),window.removeEventListener("mouseup",Ee)}},[F]);const Dt=oe=>{if(oe.length===0)return{};const Ee=oe.map(dt=>({id:dt.id,start:te(dt.start_time),end:te(dt.start_time)+(dt.duration||60)})).sort((dt,Et)=>dt.start-Et.start),Ue=[];let tt=[],Ne=-1;Ee.forEach(dt=>{tt.length===0?(tt.push(dt),Ne=dt.end):dt.start<Ne?(tt.push(dt),Ne=Math.max(Ne,dt.end)):(Ue.push(tt),tt=[dt],Ne=dt.end)}),tt.length>0&&Ue.push(tt);const pt={};return Ue.forEach(dt=>{const Et=[];dt.forEach(ct=>{let Qe=!1;for(let It=0;It<Et.length;It++){const Lt=Et[It],J=Lt[Lt.length-1];if(ct.start>=J.end){Lt.push(ct),Qe=!0;break}}Qe||Et.push([ct])});const Se=90/Et.length,nt={},ft=[];dt.forEach(ct=>{let Qe=!1;for(let It=0;It<ft.length;It++){const Lt=ft[It],J=Lt[Lt.length-1];if(ct.start>=J.end){Lt.push(ct),nt[ct.id]=It,Qe=!0;break}}Qe||(ft.push([ct]),nt[ct.id]=ft.length-1)}),dt.forEach(ct=>{const Qe=nt[ct.id];pt[ct.id]={left:`${Qe*Se+2}%`,width:`${Se}%`}})}),pt};return c.jsxs("div",{ref:v,className:"h-full flex flex-col bg-theme-main overflow-hidden",children:[c.jsxs("div",{className:"flex bg-theme-header border-b border-theme p-2 items-center flex-shrink-0 z-40 shadow-sm justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ri,{size:16,className:"text-theme-primary"}),c.jsx("span",{className:"font-bold text-theme-primary text-sm",children:"Schedule"})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-[10px] text-theme-tertiary font-medium",children:"WIDTH"}),c.jsx("input",{type:"range",min:"120",max:"400",value:I,onChange:oe=>P(Number(oe.target.value)),className:"w-20 h-1 bg-theme-hover rounded-lg appearance-none cursor-pointer accent-indigo-500"})]}),h.length>0&&c.jsxs("button",{onClick:he,className:`px-3 py-1 border rounded-md text-xs font-bold shadow-sm flex items-center gap-1 transition-all
                                ${h.every(oe=>{var tt;const Ee=s.find(Ne=>Ne.id===oe),Ue=i.find(Ne=>Ne.name.toLowerCase()==="schedule"||Ne.name==="");return Ue&&((tt=Ee==null?void 0:Ee.tags)==null?void 0:tt.includes(Ue.id))})?"bg-indigo-100 text-indigo-700 border-indigo-200":"bg-theme-card border-theme text-theme-secondary hover:bg-theme-hover"}`,title:" Schedule ",children:[c.jsx(EI,{size:14}),h.length>1?`(${h.length})`:""]}),c.jsx("button",{onClick:ie,className:"px-3 py-1 bg-theme-card border border-theme rounded-md text-xs font-bold shadow-sm hover:bg-theme-hover text-theme-primary",children:"Today"}),c.jsx("button",{onClick:()=>le(!_e),className:`px-3 py-1 border rounded-md text-xs font-bold shadow-sm transition-colors
                            ${_e?"bg-indigo-600 text-white border-indigo-600":"bg-theme-card border-theme text-theme-tertiary hover:bg-theme-hover"}`,children:_e?"Work Hours":"Full Day"})]})]}),c.jsxs("div",{ref:w,className:"flex-1 overflow-auto flex relative",onScroll:se,children:[c.jsxs("div",{className:"sticky left-0 z-30 bg-theme-sidebar border-r border-theme flex-shrink-0 w-14 flex flex-col pointer-events-none select-none h-min relative",children:[c.jsx("div",{className:"sticky top-0 bg-theme-sidebar z-40 border-b border-theme flex-shrink-0",style:{height:aa+A+4}}),Array.from({length:24}).map((oe,Ee)=>c.jsx("div",{className:"text-[10px] text-theme-tertiary font-extralight text-center relative box-border",style:{height:st(Ee)},children:c.jsxs("span",{className:"absolute -top-1.5 left-0 right-0",children:[Ee,":00"]})},Ee)),c.jsx("div",{className:"absolute right-0 flex items-center z-50",style:{top:aa+A+4+Be(k.getHours()*60+k.getMinutes())-8},children:c.jsx("div",{className:"bg-red-500 text-white text-[9px] font-bold px-1 py-0.5 rounded-sm shadow-sm",children:k.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})})}),c.jsx("div",{className:"h-20"})]}),T.map((oe,Ee)=>{const Ue=_i(oe,k),tt=`${oe.getFullYear()}-${oe.getMonth()}-${oe.getDate()}`,Ne=ae.get(tt)||[],pt=Ne.filter(ue=>!ue.is_all_day&&ue.start_time&&ue.start_date),dt=Ne.filter(ue=>ue.is_all_day||!ue.start_time),Et=Dt(pt);return c.jsxs("div",{"data-date":oe.toISOString(),className:"flex-shrink-0 flex flex-col border-r border-theme bg-theme-main relative group h-min",style:{minWidth:I,width:I},children:[c.jsxs("div",{className:`sticky top-0 z-20 border-b border-theme px-1 py-0.5 text-center flex flex-col justify-start select-none shadow-sm relative
                                ${Ue?"bg-indigo-500/10 backdrop-blur-sm":"bg-theme-header backdrop-blur-sm"}
                            `,style:{height:aa+A+4},children:[c.jsx("div",{className:"absolute top-0 right-0 w-2 h-full cursor-col-resize z-30 hover:bg-indigo-400/30 transition-colors group-hover:opacity-100 opacity-0",onMouseDown:ue=>Q(ue,Ee)}),c.jsxs("div",{className:"flex items-center justify-center gap-1 flex-shrink-0",style:{height:aa-4},children:[c.jsxs("span",{className:`text-[10px] font-extralight ${Ue?"text-indigo-500":"text-theme-tertiary"}`,children:["",Kee[oe.getDay()]]}),c.jsx("span",{className:`text-lg font-extralight ${Ue?"text-indigo-500":"text-theme-primary"}`,children:oe.getDate()})]}),c.jsx("div",{"data-drop-zone":"allday",className:"overflow-y-auto space-y-1 py-1 border-t border-dashed border-theme custom-scrollbar px-1 cursor-cell transition-colors relative",style:{height:A},onDoubleClick:ue=>fe(ue,oe),children:dt.map(ue=>{var Lt,J;const Se=mp(ue,s),nt=g(ue,Se),ft=h.includes(ue.id),ct=(ne==null?void 0:ne.task.id)===ue.id,Qe=(Lt=i.find(ye=>ye.name.toLowerCase()==="schedule"||ye.name===""))==null?void 0:Lt.id,It=Qe&&((J=ue.tags)==null?void 0:J.includes(Qe));return c.jsxs("div",{onMouseDown:ye=>Me(ye,ue,oe,"move",!0),onDoubleClick:ye=>{ye.stopPropagation(),p([]),u(ue.id)},className:`group/allday text-[10px] px-2 py-1 rounded-lg border text-center font-extralight transition-all w-full relative overflow-hidden cursor-grab active:cursor-grabbing
                                                    ${ft?"ring-2 ring-offset-1":""}
                                                    ${ct?"opacity-30":""}
                                                `,style:{backgroundColor:It?`${nt}10`:ft?nt+"40":nt+"18",backgroundImage:It?`repeating-linear-gradient(45deg, ${nt}20 0px, ${nt}20 4px, transparent 4px, transparent 8px)`:void 0,color:nt,borderColor:ft?nt+"80":nt+"60",boxShadow:ft?"2px 2px 4px rgba(0,0,0,0.12)":"2px 2px 3px rgba(0,0,0,0.08)","--tw-ring-color":ft?nt+"60":void 0,...It?{fontWeight:"bold"}:{}},children:[c.jsx("div",{className:"absolute inset-0 opacity-0 group-hover/allday:opacity-100 transition-opacity pointer-events-none",style:{backgroundColor:nt+"15"}}),c.jsx("div",{className:"truncate pointer-events-none relative z-10",children:ue.title||"Untitled"})]},ue.id)})}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-2 cursor-ns-resize hover:bg-indigo-400/30 transition-colors z-30",onMouseDown:ke})]}),c.jsxs("div",{"data-drop-zone":"grid",className:"flex-1 relative overflow-hidden schedule-body",style:{height:vt()},onDoubleClick:ue=>Re(ue,oe),onMouseDown:ue=>xt(ue,oe),children:[Array.from({length:24}).map((ue,Se)=>c.jsx("div",{className:"border-t border-theme box-border w-full pointer-events-none opacity-20",style:{height:st(Se)}},Se)),F&&_i(F.date,oe)&&(()=>{const ue=Math.min(F.startMin,F.endMin),Se=Math.max(F.startMin,F.endMin);if(Se-ue<15)return null;const ft=Be(ue),ct=Be(Se);return c.jsx("div",{className:"absolute left-1 right-1 rounded-xl border-2 border-dashed border-indigo-400 bg-indigo-50/50 pointer-events-none z-40 flex items-center justify-center",style:{top:ft,height:ct-ft},children:c.jsxs("span",{className:"text-xs font-extralight text-indigo-600",children:[Z(ue)," - ",Z(Se)]})})})(),Ue&&c.jsxs("div",{className:"absolute w-full flex items-center z-10 pointer-events-none",style:{top:Be(k.getHours()*60+k.getMinutes())},children:[c.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 -ml-1"}),c.jsx("div",{className:"flex-1 border-t-2 border-red-500"})]}),pt.map(ue=>{var ye,Ge;const Se=Et[ue.id];if(!Se||ne&&ne.task.id===ue.id)return null;const nt=te(ue.start_time),ft=ue.duration||60,ct=mp(ue,s),Qe=g(ue,ct),It=h.includes(ue.id),Lt=(ye=i.find(kt=>kt.name.toLowerCase()==="schedule"||kt.name===""))==null?void 0:ye.id,J=Lt&&((Ge=ue.tags)==null?void 0:Ge.includes(Lt));return c.jsxs("div",{"data-task-id":ue.id,onMouseDown:kt=>Me(kt,ue,oe,"move",!1),onDoubleClick:kt=>{kt.stopPropagation(),p([]),u(ue.id)},className:`absolute rounded-xl border px-2 py-1.5 overflow-hidden select-none cursor-pointer hover:brightness-98 transition-all flex flex-col
                                                ${It?"ring-2 ring-offset-1":""}
                                            `,style:{top:Be(nt),height:Be(nt+ft)-Be(nt),left:Se.left,width:Se.width,backgroundColor:J?`${Qe}10`:It?Qe+"40":Qe+"15",backgroundImage:J?`repeating-linear-gradient(45deg, ${Qe}20 0px, ${Qe}20 4px, transparent 4px, transparent 8px)`:void 0,borderColor:Qe+"50",color:Qe,zIndex:10,boxShadow:"2px 2px 3px rgba(0,0,0,0.06)","--tw-ring-color":It?Qe+"60":void 0,...J?{fontWeight:"bold"}:{}},children:[c.jsx("div",{className:"font-extralight text-[11px] truncate leading-normal pointer-events-none",children:ue.title||""}),ft>30&&c.jsxs("div",{className:"text-[9px] opacity-80 font-extralight mt-0.5 leading-normal pointer-events-none",children:[ue.start_time," - ",ue.end_time]}),c.jsx("div",{className:"absolute top-0 left-0 w-full h-3 cursor-ns-resize z-50 hover:bg-black/5 transition-colors",onMouseDown:kt=>Me(kt,ue,oe,"resize-top",!1)}),c.jsx("div",{className:"absolute bottom-0 left-0 w-full h-3 cursor-ns-resize z-50 hover:bg-black/5 transition-colors",onMouseDown:kt=>Me(kt,ue,oe,"resize-bottom",!1)})]},ue.id)}),D&&_i(D.date,oe)&&c.jsx("div",{className:"absolute z-50 rounded-xl border border-indigo-500 bg-theme-card shadow-xl overflow-hidden px-3 flex items-center",style:{top:Be(D.startMin),height:Math.max(44,Be(D.startMin+D.duration)-Be(D.startMin)),left:"5%",width:"90%"},children:c.jsx("input",{ref:me,value:D.title,onChange:ue=>ge({...D,title:ue.target.value}),onKeyDown:ue=>{ue.key==="Enter"&&qe(),ue.key==="Escape"&&ge(null)},onBlur:qe,className:"w-full text-[12px] font-extralight bg-transparent outline-none text-indigo-400 leading-normal",placeholder:"New Task...",autoFocus:!0})})]})]},oe.toISOString())}),ne&&(()=>{var Ne,pt,dt;const oe=mp(ne.task,s),Ee=g(ne.task,oe);let Ue=0;const tt=Array.from(document.querySelectorAll("div[data-date]")).find(Et=>Et.getAttribute("data-date")===ne.currentDate.toISOString());if(tt?Ue=tt.getBoundingClientRect().left:Ue=ne.initialMouseX,ne.currentSection==="allday"){const ue=(((Ne=w.current)==null?void 0:Ne.getBoundingClientRect().top)||0)+aa+2;return c.jsx("div",{className:"fixed z-[100] pointer-events-none rounded-lg border px-2 py-1 text-[10px] font-extralight text-center shadow-xl cursor-grabbing flex items-center justify-center bg-white",style:{left:Ue+4,top:ue,width:(ne.colWidth||200)-8,height:A-4,backgroundColor:Ee+"40",borderColor:Ee,color:Ee},children:ne.task.title||"Untitled"})}else{const Et=((pt=w.current)==null?void 0:pt.getBoundingClientRect())||{top:0,left:0},ue=((dt=w.current)==null?void 0:dt.scrollTop)||0,Se=Be(ne.currentStartMin),nt=Be(ne.currentStartMin+ne.currentDuration)-Se,ft=Et.top+aa+A+4+Se-ue;return c.jsxs("div",{className:`fixed rounded-xl border px-2 py-1.5 shadow-2xl overflow-hidden select-none flex flex-col z-[100] bg-white ring-2 ring-indigo-400/50 ${ne.type.startsWith("resize")?"cursor-ns-resize":"cursor-grabbing"}`,style:{top:Math.max(Et.top+aa+A+4,ft),height:nt,left:Ue+4,width:(ne.colWidth||190)-8,backgroundColor:"var(--bg-card)",borderColor:Ee,color:Ee,opacity:.95},children:[c.jsx("div",{className:"font-extralight text-[11px] truncate leading-normal",children:ne.task.title||""}),c.jsxs("div",{className:"text-[9px] font-extralight mt-0.5 opacity-80 leading-normal",children:[Z(ne.currentStartMin)," - ",Z(ne.currentStartMin+ne.currentDuration)]})]})}})()]})]})},qee=Object.keys(Jn),Yee=()=>{const{tasks:t,updateTask:e,selectedTaskIds:n,viewTagFilters:r,setEditingTaskId:s,focusSplitWidth:i,setFocusSplitWidth:o,themeSettings:a,setSelectedTaskIds:l,constructionModeEnabled:u,setConstructionModeEnabled:d,deleteTask:f,editingTaskId:h,batchDeleteTasks:p,setCalendarDate:m,tags:y,tagsWithResolvedColors:b}=x.useContext(En),g=x.useRef(null),[v,w]=x.useState(!1),[T,R]=x.useState(()=>localStorage.getItem("focus_calendar_mode")||"calendar"),[k,M]=x.useState(null),[S,C]=x.useState(()=>{try{const te=localStorage.getItem("focus_filter_tags_include");return te?JSON.parse(te):[]}catch{return[]}}),[_,E]=x.useState(()=>{try{const te=localStorage.getItem("focus_filter_tags_exclude");return te?JSON.parse(te):[]}catch{return[]}}),[I,P]=x.useState(()=>{try{const te=localStorage.getItem("focus_filter_colors");return te?JSON.parse(te):[]}catch{return[]}}),[O,$]=x.useState(()=>{try{const te=localStorage.getItem("focus_filter_projects");return te?JSON.parse(te):[]}catch{return[]}}),[A,j]=x.useState(!1),[W,V]=x.useState(!1),[D,ge]=x.useState(!1),me=x.useRef(null),F=x.useRef(null),U=x.useRef(null);x.useEffect(()=>{localStorage.setItem("focus_filter_tags_include",JSON.stringify(S))},[S]),x.useEffect(()=>{localStorage.setItem("focus_filter_tags_exclude",JSON.stringify(_))},[_]),x.useEffect(()=>{localStorage.setItem("focus_filter_colors",JSON.stringify(I))},[I]),x.useEffect(()=>{localStorage.setItem("focus_filter_projects",JSON.stringify(O))},[O]);const ne=x.useMemo(()=>t.filter(te=>te.is_project&&te.status!=="deleted"),[t]),Oe=S.length>0||_.length>0||I.length>0||O.length>0,at=()=>{C([]),E([]),P([]),$([])},ae=te=>{S.includes(te)?(C(Z=>Z.filter(ie=>ie!==te)),E(Z=>[...Z,te])):_.includes(te)?E(Z=>Z.filter(ie=>ie!==te)):C(Z=>[...Z,te])};x.useEffect(()=>{const te=Z=>{me.current&&!me.current.contains(Z.target)&&j(!1),F.current&&!F.current.contains(Z.target)&&V(!1),U.current&&!U.current.contains(Z.target)&&ge(!1)};return document.addEventListener("mousedown",te),()=>document.removeEventListener("mousedown",te)},[]),x.useEffect(()=>{localStorage.setItem("focus_calendar_mode",T)},[T]);const _e=n.length>0&&n.some(te=>{const Z=t.find(ie=>ie.id===te);return Z&&!Z.start_date}),le=u&&_e,Ce=n.length>0&&n.some(te=>{const Z=t.find(ie=>ie.id===te);return Z&&Z.start_date}),Le=u&&Ce&&!_e,Ve=x.useMemo(()=>{const te=r.focus||{include:[],exclude:[]},{include:Z,exclude:ie}=Array.isArray(te)?{include:te,exclude:[]}:te,he=new Set(t.filter(Q=>Q.status==="deleted").map(Q=>Q.id));let se=t.filter(Q=>Q.status==="inbox"&&!Q.start_date&&!Q.completed_at&&(!Q.parent_id||!he.has(Q.parent_id)));return Z.length>0&&(se=se.filter(Q=>Q.tags.some(ke=>Z.includes(ke)))),ie.length>0&&(se=se.filter(Q=>!Q.tags.some(ke=>ie.includes(ke)))),se.sort((Q,ke)=>(Q.order_index||0)-(ke.order_index||0))},[t,r]);x.useEffect(()=>{const te=Z=>{var ie,he,se;if(Z.key==="Escape"&&(le||Le)&&(d(!1),l([])),(Z.key==="Delete"||Z.key==="Backspace")&&!h){if(["INPUT","TEXTAREA"].includes(((ie=document.activeElement)==null?void 0:ie.tagName)||""))return;n.length>0&&(Z.preventDefault(),p(n,!1),l([]))}if(Z.key==="Enter"&&!h&&n.length>0){if(["INPUT","TEXTAREA"].includes(((he=document.activeElement)==null?void 0:he.tagName)||""))return;Z.preventDefault(),s(n[0])}if((Z.key==="ArrowUp"||Z.key==="ArrowDown")&&!h){if(["INPUT","TEXTAREA"].includes(((se=document.activeElement)==null?void 0:se.tagName)||"")||(Z.preventDefault(),Ve.length===0))return;let Q=-1;n.length>0&&(Q=Ve.findIndex(fe=>n.includes(fe.id)));let ke=0;Z.key==="ArrowDown"?Q===-1?ke=0:ke=Math.min(Ve.length-1,Q+1):Q===-1?ke=Ve.length-1:ke=Math.max(0,Q-1);const Me=Ve[ke];Me&&(l([Me.id]),Be(ke),setTimeout(()=>{const fe=document.getElementById(`focus-task-${Me.id}`);fe==null||fe.scrollIntoView({block:"nearest"})},0))}};return window.addEventListener("keydown",te),()=>window.removeEventListener("keydown",te)},[le,Le,l,d,n,f,h,Ve]),x.useEffect(()=>{n.length===0&&d(!1)},[n]),x.useEffect(()=>{const te=ie=>{if(!v||!g.current)return;const he=g.current.getBoundingClientRect();let se=ie.clientX-he.left;const Q=he.width*.9;se<100&&(se=100),se>Q&&(se=Q),o(se)},Z=()=>{w(!1),document.body.style.cursor="default"};return v&&(window.addEventListener("mousemove",te),window.addEventListener("mouseup",Z),document.body.style.cursor="col-resize"),()=>{window.removeEventListener("mousemove",te),window.removeEventListener("mouseup",Z)}},[v]);const[st,Be]=x.useState(null),ht=(te,Z,ie)=>{if(ie.shiftKey&&st!==null){const he=Math.min(st,Z),se=Math.max(st,Z),Q=Ve.slice(he,se+1).map(ke=>ke.id);l(Q)}else ie.metaKey||ie.ctrlKey?n.includes(te)?l(n.filter(he=>he!==te)):l([...n,te]):l([te]);Be(Z)},vt=(te,Z)=>{const ie=n.includes(te.id),he={small:"text-xs",normal:"text-sm",large:"text-base"}[a.fontSize]||"text-sm",se=a.fontFamily==="things"?"font-things":"font-sans",Q=te.color||"blue",ke=Jn[Q]||Jn.blue;return c.jsxs("div",{id:`focus-task-${te.id}`,onClick:Me=>ht(te.id,Z,Me),onDoubleClick:Me=>{Me.stopPropagation(),s(te.id)},className:`
                    group relative flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer
                    transition-all duration-150 ease-out
                    ${ie?`bg-indigo-50 ring-2 shadow-sm ${le||Le?"construction-glow ring-transparent":"ring-indigo-400"}`:"hover:bg-theme-hover active:bg-theme-hover"}
                `,style:ie&&(le||Le)?{"--glow-color":ke.color,"--tw-ring-color":ke.color}:{},children:[c.jsx("div",{className:`flex-shrink-0 w-4 h-4 rounded-full border-2 transition-colors ${ie?`${ke.border} ${ke.bg}`:"border-gray-300 group-hover:border-gray-400"}`,onClick:Me=>{Me.stopPropagation(),e(te.id,{status:"completed"})}}),c.jsxs("div",{className:"flex-1 min-w-0",children:[te.parent_id&&(()=>{const Me=t.find(fe=>fe.id===te.parent_id);return Me?c.jsxs("div",{className:"text-[9px] text-gray-400 truncate mb-0.5 flex items-center gap-1",children:[c.jsx("span",{className:"w-1 h-1 rounded-full bg-gray-300"}),Me.title]}):null})(),c.jsx("div",{className:`${he} ${se} font-extralight text-theme-secondary truncate leading-tight`,children:te.title||c.jsx("span",{className:"text-theme-tertiary italic",children:""})})]})]},te.id)};return c.jsxs("div",{ref:g,className:"flex h-full w-full overflow-hidden bg-theme-main",children:[c.jsx("div",{style:{width:i},className:"flex flex-col h-full border-r border-theme flex-shrink-0 bg-theme-sidebar",children:c.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar px-2 py-3 space-y-4",children:[Ve.length>0&&c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between px-2 mb-1",children:[c.jsxs("span",{className:`text-[9px] text-gray-400 ${a.fontFamily==="things"?"font-things":"font-sans"}`,children:[" (",Ve.length,")"]}),n.length>0&&c.jsxs("button",{onClick:()=>d(!u),className:`flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] font-medium transition-all ${u?"bg-amber-100 text-amber-700 ring-1 ring-amber-300":"bg-gray-100 text-gray-500 hover:bg-gray-200"}`,title:u?"":"",children:[c.jsx(wz,{size:10}),u?"":""]})]}),c.jsx("div",{className:"space-y-1",children:Ve.slice(0,50).map((te,Z)=>vt(te,Z))})]}),Ve.length===0&&c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx(bf,{size:32,className:"mb-2 opacity-30"}),c.jsx("p",{className:"text-sm",children:""})]})]})}),c.jsx("div",{onMouseDown:()=>w(!0),className:`w-1 cursor-col-resize hover:bg-indigo-400 group relative z-30 transition-colors flex items-center justify-center ${v?"bg-indigo-400":"bg-transparent"}`,children:c.jsx("div",{className:`absolute opacity-0 group-hover:opacity-100 transition-opacity p-0.5 bg-white border border-gray-200 rounded-md shadow-sm text-gray-400 ${v?"opacity-100":""}`,children:c.jsx(DI,{size:10})})}),c.jsxs("div",{className:"flex-1 h-full min-w-0 relative overflow-hidden flex flex-col",children:[c.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-theme bg-theme-header flex-shrink-0",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[k&&c.jsxs("button",{onClick:()=>{M(null),R("calendar")},className:"flex items-center gap-1 px-2 py-1.5 rounded-md text-xs font-medium text-theme-secondary hover:text-theme-primary hover:bg-theme-hover transition-all",title:"",children:[c.jsx(TI,{size:14}),""]}),c.jsxs("div",{className:"flex items-center gap-1 bg-theme-hover p-0.5 rounded-lg",children:[c.jsxs("button",{onClick:()=>{R("calendar"),M(null)},className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${T==="calendar"&&!k?"bg-theme-card text-indigo-500 shadow-sm":"text-theme-tertiary hover:text-theme-secondary"}`,children:[c.jsx(vo,{size:14}),""]}),c.jsxs("button",{onClick:()=>{R("schedule"),M(null)},className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${T==="schedule"||k?"bg-theme-card text-indigo-500 shadow-sm":"text-theme-tertiary hover:text-theme-secondary"}`,children:[c.jsx(Ri,{size:14}),""]})]}),k&&c.jsxs("span",{className:"text-sm font-medium text-indigo-600",children:[k.getMonth()+1,"",k.getDate()," (",["","","","","","",""][k.getDay()],")"]})]}),c.jsx("div",{className:"text-[10px] text-gray-400",children:k?"":T==="schedule"?" 1-9 ":""})]}),c.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 border-b border-theme bg-theme-card/50 flex-shrink-0",children:[c.jsx("span",{className:"text-[9px] font-bold text-gray-400 uppercase tracking-wider",children:":"}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>j(!A),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-medium transition-all border ${S.length>0||_.length>0?"bg-indigo-50 text-indigo-600 border-indigo-200":"bg-theme-hover text-theme-tertiary border-transparent hover:text-theme-secondary"}`,children:[c.jsx(zl,{size:11}),"",S.length+_.length>0&&c.jsx("span",{className:"ml-0.5 px-1 bg-indigo-500 text-white rounded-full text-[9px]",children:S.length+_.length}),c.jsx(ts,{size:10})]}),A&&c.jsxs("div",{ref:me,className:"absolute top-full left-0 mt-1 w-56 bg-theme-card rounded-lg shadow-xl border border-theme z-50 p-1 max-h-64 overflow-y-auto",children:[c.jsxs("div",{className:"text-[9px] text-theme-tertiary px-2 py-1 border-b border-theme mb-1",children:[":   ",c.jsx("span",{className:"text-green-600",children:""}),"  ",c.jsx("span",{className:"text-red-500",children:""}),"  "]}),y.map(te=>{const Z=S.includes(te.id),ie=_.includes(te.id);return c.jsxs("button",{onClick:()=>ae(te.id),className:`w-full flex items-center justify-between px-2 py-1.5 text-xs rounded hover:bg-theme-hover transition-colors ${Z?"bg-green-50":ie?"bg-red-50":""}`,children:[c.jsxs("div",{className:"flex items-center gap-1.5",children:[c.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:b[te.id]||"#6366f1"}}),c.jsx("span",{className:"text-theme-secondary",children:te.name})]}),Z&&c.jsx(Xn,{size:12,className:"text-green-600"}),ie&&c.jsx(un,{size:12,className:"text-red-500"})]},te.id)}),y.length===0&&c.jsx("div",{className:"text-xs text-theme-tertiary p-2",children:""})]})]}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>V(!W),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-medium transition-all border ${I.length>0?"bg-indigo-50 text-indigo-600 border-indigo-200":"bg-theme-hover text-theme-tertiary border-transparent hover:text-theme-secondary"}`,children:[c.jsx(jv,{size:11}),"",I.length>0&&c.jsx("span",{className:"ml-0.5 px-1 bg-indigo-500 text-white rounded-full text-[9px]",children:I.length}),c.jsx(ts,{size:10})]}),W&&c.jsx("div",{ref:F,className:"absolute top-full left-0 mt-1 w-48 bg-theme-card rounded-lg shadow-xl border border-theme z-50 p-2",children:c.jsx("div",{className:"grid grid-cols-7 gap-1",children:qee.map(te=>{var Z;return c.jsx("button",{onClick:()=>{P(ie=>ie.includes(te)?ie.filter(he=>he!==te):[...ie,te])},className:`w-5 h-5 rounded-full transition-transform ${I.includes(te)?"ring-2 ring-offset-1 ring-indigo-500 scale-110":"hover:scale-110"}`,style:{backgroundColor:((Z=Jn[te])==null?void 0:Z.color)||"#6366f1"},title:te},te)})})})]}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>ge(!D),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-medium transition-all border ${O.length>0?"bg-indigo-50 text-indigo-600 border-indigo-200":"bg-theme-hover text-theme-tertiary border-transparent hover:text-theme-secondary"}`,children:[c.jsx(yz,{size:11}),"",O.length>0&&c.jsx("span",{className:"ml-0.5 px-1 bg-indigo-500 text-white rounded-full text-[9px]",children:O.length}),c.jsx(ts,{size:10})]}),D&&c.jsxs("div",{ref:U,className:"absolute top-full left-0 mt-1 w-56 bg-theme-card rounded-lg shadow-xl border border-theme z-50 p-1 max-h-64 overflow-y-auto",children:[ne.map(te=>{var Z;return c.jsxs("button",{onClick:()=>{$(ie=>ie.includes(te.id)?ie.filter(he=>he!==te.id):[...ie,te.id])},className:`w-full flex items-center justify-between px-2 py-1.5 text-xs rounded hover:bg-theme-hover transition-colors ${O.includes(te.id)?"bg-indigo-50":""}`,children:[c.jsxs("div",{className:"flex items-center gap-1.5",children:[c.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:((Z=Jn[te.color])==null?void 0:Z.color)||"#6366f1"}}),c.jsx("span",{className:"text-theme-secondary truncate",children:te.title})]}),O.includes(te.id)&&c.jsx(Xn,{size:12,className:"text-indigo-600"})]},te.id)}),ne.length===0&&c.jsx("div",{className:"text-xs text-theme-tertiary p-2",children:""})]})]}),Oe&&c.jsxs("button",{onClick:at,className:"flex items-center gap-1 text-[10px] text-red-500 hover:text-red-600 ml-auto",children:[c.jsx(un,{size:11})," "]})]}),c.jsx("div",{className:"flex-1 relative z-10 h-full overflow-hidden",children:T==="calendar"&&!k?c.jsx(Vee,{onDateClick:te=>{M(te),m(te)},filterTags:S,filterTagsExclude:_,filterColors:I,filterProjects:O}):c.jsx(Gee,{filterTags:S,filterTagsExclude:_,filterColors:I,filterProjects:O})}),(le||Le)&&c.jsxs("div",{className:"absolute bottom-0 left-0 right-0 z-20",children:[c.jsx("div",{className:`h-12 opacity-45 transition-colors ${Le?"opacity-30":"opacity-45"}`,style:{backgroundImage:le?`repeating-linear-gradient(
                                    45deg,
                                    #fbbf24 0px,
                                    #fbbf24 10px,
                                    #1f2937 10px,
                                    #1f2937 20px
                                )`:`repeating-linear-gradient(
                                    45deg,
                                    #818cf8 0px,
                                    #818cf8 10px,
                                    #312e81 10px,
                                    #312e81 20px
                                )`,backgroundSize:"28px 28px"}}),c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:c.jsx("div",{className:`bg-white/95 backdrop-blur-sm px-4 py-2 rounded-lg shadow-lg border ${le?"border-amber-200":"border-indigo-200"}`,children:c.jsxs("span",{className:`text-sm font-bold ${le?"text-amber-700":"text-indigo-700"}`,children:[le?" ":" "," ",n.length,"    ESC "]})})})]})]})]})},Bi=40,Hy=50,Ui=40,Vy=250,jR=({plan:t,onUpdatePlan:e,onEditTask:n})=>{const[r,s]=x.useState(null),[i,o]=x.useState(null),[a,l]=x.useState(null),[u,d]=x.useState(null),[f,h]=x.useState(0),[p,m]=x.useState(0),[y,b]=x.useState(0),[g,v]=x.useState({x:0,y:0}),[w,T]=x.useState(null),R=x.useRef(null),k=x.useRef(null),M=x.useRef(null);M.current=w,x.useEffect(()=>{T(null)},[t]);const S=(le,Ce=0,Le=[],Ve=null)=>{let st=[];return le.forEach((Be,ht)=>{const vt=[...Le,ht];st.push({...Be,depth:Ce,path:vt,parentId:Ve}),Be.subtasks&&Be.subtasks.length>0&&(st=[...st,...S(Be.subtasks,Ce+1,vt,Be.id||null)])}),st},C=w||t,_=x.useMemo(()=>S(C),[C]),E=le=>_.find(Ce=>Ce.id===le),I=le=>{if(!le)return null;const Ce=new Date(le);return isNaN(Ce.getTime())?null:Ce},{minDate:P,totalDays:O}=x.useMemo(()=>{let le=new Date,Ce=new Date;Ce.setDate(le.getDate()+14);let Le=!1;S(t).forEach(ht=>{const vt=I(ht.start_date),te=I(ht.due_date);vt&&((!Le||vt<le)&&(le=vt),Le=!0),te&&((!Le||te>Ce||te>Ce)&&(Ce=te),Le=!0)}),le.setDate(le.getDate()-2),Ce.setDate(Ce.getDate()+5);const st=Math.abs(Ce.getTime()-le.getTime()),Be=Math.ceil(st/(1e3*60*60*24));return{minDate:le,maxDate:Ce,totalDays:Be}},[t,w]),$=(le,Ce)=>{const Le=le.getTime()-Ce.getTime();return Math.ceil(Le/(1e3*60*60*24))},A=(le,Ce)=>{const Le=new Date(Ce);return Le.setDate(Le.getDate()+le),Le.toISOString().split("T")[0]},j=(le,Ce,Le)=>le.map(Ve=>Ve.id===Ce?{...Ve,...Le}:Ve.subtasks?{...Ve,subtasks:j(Ve.subtasks,Ce,Le)}:Ve),W=(le,Ce)=>{let Le=JSON.parse(JSON.stringify(le));if(!Ce)return Le;const Ve=[Ce],st=new Set;for(;Ve.length>0;){const Be=Ve.shift();if(st.has(Be))continue;st.add(Be);const ht=(ie,he)=>{for(const se of ie){if(se.id===he)return se;if(se.subtasks){const Q=ht(se.subtasks,he);if(Q)return Q}}return null},vt=ht(Le,Be);if(!vt||!vt.due_date)continue;const te=new Date(vt.due_date),Z=ie=>{for(let he=0;he<ie.length;he++){const se=ie[he];if(se.dependencies&&se.dependencies.includes(Be)){const Q=se.start_date?new Date(se.start_date):null,ke=new Date(te);if(ke.setDate(ke.getDate()+1),!Q||Q<ke){const Me=se.start_date&&se.due_date?new Date(se.due_date).getTime()-new Date(se.start_date).getTime():864e5,fe=ke.toISOString().split("T")[0],qe=new Date(ke.getTime()+Me).toISOString().split("T")[0];ie[he]={...se,start_date:fe,due_date:qe},se.id&&Ve.push(se.id)}}se.subtasks&&Z(se.subtasks)}};Z(Le)}return Le},V=(le,Ce)=>{if(le.preventDefault(),le.stopPropagation(),!Ce.id)return;s(Ce.id),o(Ce.id);const Le=Ce.start_date?$(new Date(Ce.start_date),P):0,Ve=Ce.due_date?$(new Date(Ce.due_date),P):Le+1;m(Le),b(Ve-Le),h(le.clientX),T(t)},D=(le,Ce,Le)=>{if(le.preventDefault(),le.stopPropagation(),!Ce.id)return;l({id:Ce.id,dir:Le}),h(le.clientX);const Ve=Ce.start_date?$(new Date(Ce.start_date),P):0,st=Ce.due_date?$(new Date(Ce.due_date),P):Ve+1;m(Ve),b(st-Ve),T(t)},ge=(le,Ce)=>{var Ve;if(le.preventDefault(),le.stopPropagation(),!Ce.id)return;d(Ce.id);const Le=(Ve=R.current)==null?void 0:Ve.getBoundingClientRect();Le&&v({x:le.clientX-Le.left,y:le.clientY-Le.top})},me=le=>{if(u&&R.current){const Ve=R.current.getBoundingClientRect();v({x:le.clientX-Ve.left,y:le.clientY-Ve.top});return}if(!i&&!a||!R.current||!w)return;const Ce=le.clientX-f,Le=Math.round(Ce/Bi);if(i){if(!E(i))return;const st=p+Le;if(st<0)return;const Be=A(st,P),ht=A(st+y,P),vt=j(w,i,{start_date:Be,due_date:ht});T(vt)}if(a){let Ve=p,st=y;if(a.dir==="end")st=Math.max(1,y+Le);else{const te=y-1,Z=Math.min(Le,te);Ve=p+Z,st=y-Z}if(Ve<0)return;const Be=A(Ve,P),ht=A(Ve+st,P),vt=j(w,a.id,{start_date:Be,due_date:ht});T(vt)}},F=()=>{const le=M.current;if(i&&le){const Ce=W(le,i);e(Ce)}else if(a&&le){const Ce=W(le,a.id);e(Ce)}o(null),l(null),d(null),T(null)},U=(le,Ce)=>{var Le;if(le.stopPropagation(),u&&Ce.id&&u!==Ce.id){if((Le=Ce.dependencies)!=null&&Le.includes(u))return;const Ve=[...Ce.dependencies||[],u],st=j(t,Ce.id,{dependencies:Ve}),Be=W(st,u);e(Be)}d(null)};x.useEffect(()=>{const le=()=>{(i||a||u)&&F()},Ce=Le=>{if(u&&R.current){const Ve=R.current.getBoundingClientRect();v({x:Le.clientX-Ve.left,y:Le.clientY-Ve.top})}};return window.addEventListener("mouseup",le),window.addEventListener("mousemove",Ce),()=>{window.removeEventListener("mouseup",le),window.removeEventListener("mousemove",Ce)}},[i,a,u,t]);const ne=()=>{const le=[],Ce=[];for(let Le=0;Le<O;Le++){const Ve=new Date(P);Ve.setDate(Ve.getDate()+Le);const st=Ve.getDay()===0||Ve.getDay()===6;le.push(c.jsx("line",{x1:Le*Bi,y1:0,x2:Le*Bi,y2:_.length*Ui,stroke:st?"#f3f4f6":"#e5e7eb",strokeWidth:1},`line - ${Le} `)),Le%1===0&&Ce.push(c.jsxs("div",{className:"absolute top-0 flex flex-col items-center justify-end pb-2 text-xs text-gray-500 border-r border-gray-100",style:{left:Le*Bi,width:Bi,height:Hy},children:[c.jsx("span",{className:"font-bold",children:Ve.getDate()}),c.jsx("span",{className:"text-[10px]",children:["","","","","","",""][Ve.getDay()]})]},`head - ${Le} `))}return{lines:le,days:Ce}},Oe=()=>{var Ce,Le;const le=[];if(_.forEach(Ve=>{Ve.dependencies&&Ve.dependencies.forEach(st=>{const Be=E(st);if(Be){const ht=Be.due_date?$(new Date(Be.due_date),P):0,vt=Ve.start_date?$(new Date(Ve.start_date),P):0,te=_.findIndex(Me=>Me.id===Be.id),Z=_.findIndex(Me=>Me.id===Ve.id),ie=(ht+1)*Bi,he=te*Ui+Ui/2,se=vt*Bi,Q=Z*Ui+Ui/2,ke=`M ${ie} ${he} C ${ie+20} ${he}, ${se-20} ${Q}, ${se} ${Q} `;le.push(c.jsx("g",{className:"group cursor-pointer pointer-events-auto",onClick:Me=>{var Re;if(Me.stopPropagation(),window.confirm(`Remove dependency: ${Be.title} -> ${Ve.title}?`)&&Ve.id){const qe=(Re=Ve.dependencies)==null?void 0:Re.filter(Dt=>Dt!==Be.id),xt=j(t,Ve.id,{dependencies:qe});e(xt)}},children:c.jsx("path",{d:ke,fill:"none",stroke:"#94a3b8",strokeWidth:"2",markerEnd:"url(#arrowhead)",className:"group-hover:stroke-red-500"})},`${Be.id} -${Ve.id} `))}})}),u){const Ve=E(u);if(Ve&&R.current){const st=Ve.due_date?$(new Date(Ve.due_date),P):0,Be=_.findIndex(Q=>Q.id===Ve.id),ht=((Ce=k.current)==null?void 0:Ce.scrollLeft)||0,vt=((Le=k.current)==null?void 0:Le.scrollTop)||0,te=(st+1)*Bi,Z=Be*Ui+Ui/2,ie=g.x+ht-Vy,he=g.y+vt-Hy,se=`M ${te} ${Z} L ${ie} ${he} `;le.push(c.jsx("path",{d:se,stroke:"#6366f1",strokeWidth:"2",strokeDasharray:"5,5"},"drawing"))}}return le},{lines:at,days:ae}=ne(),_e=Oe();return c.jsxs("div",{className:"flex flex-col h-full border rounded-lg overflow-hidden bg-white select-none",ref:R,onMouseMove:me,children:[c.jsxs("div",{className:"flex border-b",children:[c.jsx("div",{style:{width:Vy},className:"flex-shrink-0 border-r bg-gray-50 flex items-center px-4 font-bold text-gray-700",children:""}),c.jsx("div",{className:"flex-1 overflow-hidden relative",style:{height:Hy},children:c.jsx("div",{className:"absolute inset-0",ref:le=>{le&&k.current&&(le.scrollLeft=k.current.scrollLeft)},children:ae})})]}),c.jsxs("div",{className:"flex flex-1 overflow-auto",ref:k,children:[c.jsx("div",{style:{width:Vy},className:"flex-shrink-0 border-r bg-white sticky left-0 z-10",children:_.map((le,Ce)=>c.jsxs("div",{style:{height:Ui,paddingLeft:le.depth*20},className:`flex flex-col justify-center px-4 border-b border-gray-50 bg-white cursor-pointer hover:bg-gray-50 transition-colors ${r===le.id?"!bg-indigo-50 border-l-4 border-l-indigo-500":""}`,onClick:()=>le.id&&s(le.id),onDoubleClick:()=>le.id&&(n==null?void 0:n(le.id)),children:[c.jsx("span",{className:"truncate text-sm text-gray-700 font-medium",children:le.title}),c.jsxs("span",{className:"text-[10px] text-gray-400",children:[le.start_date?le.start_date.split("T")[0].slice(5).replace("-","/"):"",le.start_date&&le.due_date&&le.start_date.split("T")[0]!==le.due_date.split("T")[0]?` - ${le.due_date.split("T")[0].slice(5).replace("-","/")}`:""]})]},Ce))}),c.jsxs("div",{className:"relative",style:{width:O*Bi,height:_.length*Ui},children:[c.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",children:[c.jsx("defs",{children:c.jsx("marker",{id:"arrowhead",markerWidth:"5",markerHeight:"3.5",refX:"4",refY:"1.75",orient:"auto",children:c.jsx("polygon",{points:"0 0, 5 1.75, 0 3.5",fill:"#94a3b8"})})}),at,_e]}),_.map((le,Ce)=>{const Le=le.start_date?$(new Date(le.start_date),P):-1;if(Le<0)return null;const Ve=le.due_date?Math.max(1,$(new Date(le.due_date),P)-Le+1):1,st=Le*Bi,Be=Ve*Bi;return c.jsxs("div",{className:`absolute rounded-md shadow-sm border border-indigo-600 bg-indigo-500 hover:bg-indigo-600 group flex items-center justify-between px-2 transition-colors ${u&&u!==le.id?"ring-2 ring-indigo-300 ring-offset-1 z-20 cursor-crosshair":""} ${r===le.id?"ring-2 ring-white ring-offset-2 ring-offset-indigo-500":""}`,style:{left:st,top:Ce*Ui+6,width:Be,height:Ui-12,cursor:u?"crosshair":"grab"},onMouseDown:ht=>V(ht,le),onMouseUp:ht=>{u&&(ht.stopPropagation(),U(ht,le))},onDoubleClick:ht=>{ht.stopPropagation(),n&&le.id&&n(le.id)},children:[c.jsx("div",{className:`w-4 h-4 bg-white border-2 border-indigo-500 rounded-full cursor-cell absolute -left-2 top-1/2 -translate-y-1/2 hover:scale-125 transition-transform z-30 shadow-sm flex items-center justify-center ${u&&u!==le.id?"opacity-100 animate-pulse scale-110":"opacity-0"}`,onMouseUp:ht=>U(ht,le),children:c.jsx("div",{className:"w-1.5 h-1.5 bg-indigo-500 rounded-full"})}),c.jsx("span",{className:"text-xs text-white font-medium truncate pointer-events-none select-none drop-shadow-sm",children:Be>30&&le.title}),c.jsx("div",{className:`w-4 h-4 bg-indigo-500 border-2 border-white rounded-full cursor-crosshair absolute -right-2 top-1/2 -translate-y-1/2 hover:scale-125 transition-transform z-30 shadow-sm ${u?"opacity-0":"opacity-0 group-hover:opacity-100"}`,onMouseDown:ht=>ge(ht,le)}),c.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-3 cursor-ew-resize hover:bg-black/10 z-40 rounded-l-md",onMouseDown:ht=>D(ht,le,"start")}),c.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-3 cursor-ew-resize hover:bg-black/10 z-40 rounded-r-md",onMouseDown:ht=>D(ht,le,"end")})]},le.id)})]})]}),c.jsxs("div",{className:"h-6 bg-gray-50 border-t flex items-center px-4 text-xs text-gray-400 gap-4",children:[c.jsx("span",{children:""}),c.jsx("span",{children:""}),c.jsx("span",{children:""}),c.jsx("span",{children:""})]})]})},Jee="",Xee=({isOpen:t,onClose:e,position:n,customPrompt:r,setCustomPrompt:s,onRun:i,prompts:o,saveToLibrary:a,setSaveToLibrary:l,isLoading:u,history:d,historyIndex:f,setHistoryIndex:h,onDeleteHistory:p,onUpdateHistory:m,onReplace:y,onInsert:b})=>{const[g,v]=x.useState(""),[w,T]=x.useState("prompt"),[R,k]=x.useState(!1),[M,S]=x.useState("");x.useEffect(()=>{u?T("result"):d.length>0&&f>=0?(T("result"),S(d[f].content)):T("prompt")},[u,d.length,f]);const C=o.filter(P=>P.title.toLowerCase().includes(g.toLowerCase())||P.description&&P.description.toLowerCase().includes(g.toLowerCase()));if(!t)return null;const _=n?Math.max(10,Math.min(n.top,window.innerHeight-500)):100,E=n?Math.min(n.left,window.innerWidth-420):window.innerWidth/2-200,I=d[f];return ir.createPortal(c.jsx(bo,{children:c.jsxs(Pr.div,{initial:{opacity:0,y:10,left:E,top:_},animate:{opacity:1,y:0,left:E,top:_},exit:{opacity:0,scale:.95},drag:!0,dragMomentum:!1,className:"fixed w-[400px] bg-white rounded-xl shadow-2xl border border-gray-100 flex flex-col overflow-hidden z-[99999]",style:{position:"fixed"},children:[c.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-100 bg-white cursor-move",children:[c.jsxs("h3",{className:"text-sm font-bold text-slate-800 flex items-center gap-2 pointer-events-none",children:[c.jsx(As,{className:"text-indigo-500",size:16}),"AI "]}),c.jsxs("div",{className:"flex items-center gap-1",children:[w==="result"&&!u&&c.jsx("button",{onClick:()=>T("prompt"),className:"p-1 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"",children:c.jsx(As,{size:14})}),c.jsx("button",{onClick:P=>{P.stopPropagation(),e()},className:"text-slate-400 hover:text-slate-600 transition-colors p-1 hover:bg-slate-100 rounded-full",children:c.jsx(un,{size:16})})]})]}),c.jsx("div",{className:"flex-1 overflow-hidden flex flex-col bg-slate-50/50",children:w==="prompt"?c.jsxs("div",{className:"p-4 space-y-4",children:[c.jsx("input",{type:"text",placeholder:"...",className:"w-full px-3 py-2 text-xs bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-100 outline-none",value:g,onChange:P=>v(P.target.value),onKeyDown:P=>P.stopPropagation(),autoFocus:!0}),!g&&C.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1.5",children:C.slice(0,5).map(P=>c.jsx("button",{onClick:()=>{s(P.description||P.title),v("")},className:"text-[10px] px-2 py-1 rounded-full bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-100 font-medium",children:P.title},P.id))}),c.jsx("textarea",{className:"w-full h-32 p-3 text-sm bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-100 outline-none resize-none",placeholder:"...",value:r,onChange:P=>s(P.target.value),onKeyDown:P=>P.stopPropagation()}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"checkbox",id:"saveToLib",checked:a,onChange:P=>l(P.target.checked),className:"w-3.5 h-3.5 rounded text-indigo-600"}),c.jsx("label",{htmlFor:"saveToLib",className:"text-xs text-slate-500 select-none",children:""})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:()=>i(Jee),className:"flex-1 py-2 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 rounded-xl text-xs font-bold border border-indigo-200 flex items-center justify-center gap-1",children:[c.jsx(As,{size:14})," "]}),c.jsx("button",{onClick:()=>i(r),disabled:!r.trim(),className:"flex-[2] py-2 bg-slate-800 hover:bg-slate-900 text-white rounded-xl text-xs font-bold disabled:opacity-50",children:""})]})]}):c.jsx("div",{className:"flex flex-col h-auto max-h-[60vh]",children:u?c.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-4 text-slate-400",children:[c.jsx(fd,{size:32,className:"text-indigo-400 animate-pulse"}),c.jsx("span",{className:"text-xs font-bold",children:"..."})]}):I?c.jsxs(c.Fragment,{children:[d.length>1&&c.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-white border-b border-gray-50",children:[c.jsxs("span",{className:"text-[10px] font-bold text-gray-400",children:[f+1," / ",d.length]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:()=>h(Math.max(0,f-1)),disabled:f===0,className:"p-1 hover:bg-gray-100 rounded disabled:opacity-30",children:c.jsx(Ou,{size:14})}),c.jsx("button",{onClick:()=>h(Math.min(d.length-1,f+1)),disabled:f===d.length-1,className:"p-1 hover:bg-gray-100 rounded disabled:opacity-30",children:c.jsx(rs,{size:14})}),c.jsx("div",{className:"w-px h-3 bg-gray-200 mx-1"}),c.jsx("button",{onClick:()=>p(f),className:"p-1 hover:bg-red-50 text-gray-400 hover:text-red-500 rounded",children:c.jsx(Er,{size:14})})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar bg-white",children:R?c.jsx("textarea",{className:"w-full h-full min-h-[150px] p-2 text-sm border border-indigo-200 rounded-lg focus:ring-2 focus:ring-indigo-100 outline-none resize-none",value:M,onChange:P=>S(P.target.value),onKeyDown:P=>P.stopPropagation()}):c.jsx("div",{className:"prose prose-sm max-w-none prose-indigo",children:c.jsx(ok,{children:I.content})})}),c.jsx("div",{className:"p-3 bg-gray-50 border-t border-gray-100 space-y-2",children:R?c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:()=>{m(f,M),k(!1)},className:"flex-1 py-1.5 bg-indigo-600 text-white rounded-lg text-xs font-bold flex items-center justify-center gap-1",children:[c.jsx(Xn,{size:12})," "]}),c.jsx("button",{onClick:()=>k(!1),className:"px-3 py-1.5 bg-gray-200 text-gray-600 rounded-lg text-xs font-bold",children:""})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("button",{onClick:()=>y(I.content),className:"py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-xs font-bold shadow-sm active:scale-95 flex items-center justify-center gap-1.5",children:[c.jsx(s1,{size:12})," "]}),c.jsxs("button",{onClick:()=>b(I.content),className:"py-2 bg-white hover:bg-gray-50 text-gray-700 border border-gray-200 rounded-lg text-xs font-bold shadow-sm active:scale-95 flex items-center justify-center gap-1.5",children:[c.jsx(Xf,{size:12})," "]})]}),c.jsxs("div",{className:"flex gap-2 justify-end",children:[c.jsxs("button",{onClick:()=>{S(I.content),k(!0)},className:"px-2 py-1 text-[10px] text-gray-500 hover:text-indigo-600 flex items-center gap-1",children:[c.jsx(Iv,{size:10})," "]}),c.jsxs("button",{onClick:()=>navigator.clipboard.writeText(I.content),className:"px-2 py-1 text-[10px] text-gray-500 hover:text-indigo-600 flex items-center gap-1",children:[c.jsx(NI,{size:10})," "]})]})]})})]}):null})})]},"ai-assistant-modal")}),document.body)},Qee=()=>{const{tasks:t,tags:e,themeSettings:n,updateTask:r,setEditingTaskId:s,editingTaskId:i,addTask:o,addTag:a,setView:l,batchUpdateTasks:u,batchDeleteTasks:d}=x.useContext(En),[f,h]=x.useState(null),[p,m]=x.useState(null),[y,b]=x.useState(null),[g,v]=x.useState("list"),[w,T]=x.useState(()=>{const J=localStorage.getItem("projectCardSize");return J?parseInt(J):280}),[R,k]=x.useState(()=>{const J=localStorage.getItem("projectOrder");return J?JSON.parse(J):[]});x.useEffect(()=>{const J=localStorage.getItem("openProjectId"),ye=localStorage.getItem("previousView");J&&(h(J),localStorage.removeItem("openProjectId")),ye&&(b(ye),localStorage.removeItem("previousView"))},[]);const M=x.useMemo(()=>e.find(J=>J.name.toLowerCase()==="project"),[e]),S=x.useMemo(()=>M?t.filter(ye=>!ye.tags.includes(M.id)||ye.status==="deleted"||ye.status==="logged"?!1:t.some(kt=>kt.parent_id===ye.id&&kt.status!=="deleted")).map(ye=>{const Ge=t.filter(Y=>Y.parent_id===ye.id&&Y.status!=="deleted").length,kt=t.filter(Y=>Y.parent_id===ye.id&&Y.status==="completed").length;return{id:ye.id,title:ye.title,description:ye.description,color:ye.color||"blue",tags:ye.tags,start_date:ye.start_date,due_date:ye.due_date,childCount:Ge,completedCount:kt,coverImage:ye.images&&ye.images.length>0?ye.images[0]:ye.cover_image,order:ye.project_order||0}}):[],[t,M]),C=x.useMemo(()=>e.filter(J=>J.name.includes("")).map(J=>J.id),[e]),_=x.useMemo(()=>R.length===0?[...S].sort((J,ye)=>{const Ge=J.tags.some(Y=>C.includes(Y)),kt=ye.tags.some(Y=>C.includes(Y));return Ge&&!kt?-1:!Ge&&kt?1:0}):[...S].sort((J,ye)=>{const Ge=R.indexOf(J.id),kt=R.indexOf(ye.id);return Ge===-1&&kt===-1?0:Ge===-1?1:kt===-1?-1:Ge-kt}),[S,R,C]);x.useEffect(()=>{localStorage.setItem("projectCardSize",w.toString())},[w]);const E=x.useCallback(J=>{const ye=J.map(Ge=>Ge.id);k(ye),localStorage.setItem("projectOrder",JSON.stringify(ye))},[]),[I,P]=x.useState(null),[O,$]=x.useState(null),A=x.useRef(new Map),j=x.useCallback((J,ye)=>{ye?A.current.set(J,ye):A.current.delete(J)},[]),W=x.useCallback((J,ye,Ge)=>{let kt=null,Y=1/0;return A.current.forEach((ze,lt)=>{if(lt===Ge)return;const X=ze.getBoundingClientRect(),Fe=X.left+X.width/2,je=X.top+X.height/2,He=Math.sqrt(Math.pow(J-Fe,2)+Math.pow(ye-je,2));He<Y&&(Y=He,kt=lt)}),kt},[]),V=x.useCallback(J=>{if(J.preventDefault(),!I)return;const ye=W(J.clientX,J.clientY,I);$(ye)},[I,W]),D=x.useCallback(J=>{if(J.preventDefault(),!I||!O||I===O){P(null),$(null);return}const ye=_.findIndex(lt=>lt.id===I),Ge=_.findIndex(lt=>lt.id===O);if(ye===-1||Ge===-1){P(null),$(null);return}const kt=[..._],[Y]=kt.splice(ye,1),ze=kt.findIndex(lt=>lt.id===O);kt.splice(ze+1,0,Y),E(kt),P(null),$(null)},[I,O,_,E]),ge=x.useCallback(()=>{P(null),$(null)},[]),me=async J=>{window.confirm(`
`)&&(await r(J,{status:"deleted"}),p===J&&m(null))},F=async()=>{let J=M==null?void 0:M.id;if(J||(J=await a("project")||void 0),!J){console.error("Failed to create project tag");return}const ye=await o({title:"",tags:[J],status:"todo"});ye&&(await o({title:"",parent_id:ye,status:"todo"}),h(ye))},U=f?t.find(J=>J.id===f):null,ne=n.fontFamily==="things"?"font-things":"font-sans",Oe=x.useRef(null),[at,ae]=x.useState(null),[_e,le]=x.useState(null),[Ce,Le]=x.useState(!1),[Ve,st]=x.useState(""),[Be,ht]=x.useState(!1),[vt,te]=x.useState(!1),[Z,ie]=x.useState([]),[he,se]=x.useState(-1);x.useEffect(()=>{U!=null&&U.ai_history?(ie(U.ai_history),se(U.ai_history.length-1)):(ie([]),se(-1))},[U==null?void 0:U.id,U==null?void 0:U.ai_history]);const Q=x.useMemo(()=>{if(!f)return[];t.filter(kt=>kt.parent_id===f&&kt.status!=="deleted").sort((kt,Y)=>(kt.order_index||0)-(Y.order_index||0));const ye=kt=>t.filter(ze=>ze.parent_id===kt&&ze.status!=="deleted").sort((ze,lt)=>(ze.order_index||0)-(lt.order_index||0)).map(ze=>({id:ze.id,title:ze.title,description:ze.description||void 0,start_date:ze.start_date,due_date:ze.due_date,dependencies:ze.dependencies||[],subtasks:ye(ze.id)}));return[{id:f,title:(U==null?void 0:U.title)||"Project",start_date:U==null?void 0:U.start_date,due_date:U==null?void 0:U.due_date,description:(U==null?void 0:U.description)||void 0,dependencies:[],subtasks:ye(f)}]},[f,t,U]),ke=async J=>{const ye=je=>{let He=[];return je.forEach(Ye=>{He.push(Ye),Ye.subtasks&&(He=He.concat(ye(Ye.subtasks)))}),He},Ge=ye(J),kt=new Set(Ge.map(je=>je.id).filter(Boolean)),Y=je=>{const He=t.filter(ee=>ee.parent_id===je&&ee.status!=="deleted");let Ye=[...He];return He.forEach(ee=>{Ye=Ye.concat(Y(ee.id))}),Ye},lt=Y(f).filter(je=>!kt.has(je.id)).map(je=>je.id);lt.length>0&&await d(lt);const X=[];for(const je of Ge){if(!je.id||je.id===f)continue;const He=t.find(Vt=>Vt.id===je.id);if(!He)continue;const Ye={};let ee=!1;je.start_date!==He.start_date&&(Ye.start_date=je.start_date,ee=!0),je.due_date!==He.due_date&&(Ye.due_date=je.due_date,ee=!0);const xe=je.dependencies||[],Pe=He.dependencies||[],et=[...xe].sort(),_t=[...Pe].sort();(et.length!==_t.length||!et.every((Vt,Ft)=>Vt===_t[Ft]))&&(Ye.dependencies=je.dependencies,ee=!0),ee&&X.push({id:je.id,data:Ye})}X.length>0&&await u(X);const Fe=Ge.filter(je=>!je.id);for(const je of Fe)await o({title:je.title||"New Task",parent_id:f,start_date:je.start_date,due_date:je.due_date,status:"todo"})},Me=x.useMemo(()=>{const J=e.find(ye=>ye.name.toLowerCase()==="prompt");return J?t.filter(ye=>ye.tags.includes(J.id)&&ye.status!=="deleted"):[]},[t,e]),fe=async J=>{let ye="";if(at&&Oe.current?ye=Oe.current.state.doc.textBetween(at.from,at.to," "):Oe.current?ye=Oe.current.getText():ye=((U==null?void 0:U.description)||"").replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),!ye.trim()){alert("");return}te(!0),Le(!0);try{if(Be&&Ve.trim()){const ze=e.find(X=>X.name.trim().toLowerCase()==="prompt");let lt=ze==null?void 0:ze.id;if(lt||(lt=await a("prompt")||void 0),lt){const X=await U5(Ve);await o({title:X,description:Ve,tags:[lt],status:"active"})}}const Ge=await B5(ye,(U==null?void 0:U.title)||"",J),kt={id:crypto.randomUUID(),role:"assistant",content:Ge.fullResponse,created_at:new Date().toISOString(),prompt:J||"AI Analysis",model:"gemini"},Y=[...Z,kt];ie(Y),se(Y.length-1),f&&r(f,{ai_history:Y},[],{skipHistory:!0}),st("")}catch(Ge){console.error(Ge),alert("AI Error: "+(Ge.message||"Unknown error"))}finally{te(!1)}},Re=J=>{if(Oe.current&&at){Oe.current.chain().setTextSelection({from:at.from,to:at.to}).unsetHighlight().insertContent(J).run();const ye=Oe.current.getHTML();Et(ye),ae(null),Le(!1)}else Oe.current&&alert("")},qe=J=>{if(Oe.current){Oe.current.commands.insertContent(J);const ye=Oe.current.getHTML();Et(ye),Le(!1)}},xt=J=>{const ye=Z.filter((Ge,kt)=>kt!==J);ie(ye),ye.length===0?se(-1):se(Math.min(he,ye.length-1)),f&&r(f,{ai_history:ye},[],{skipHistory:!0})},Dt=(J,ye)=>{const Ge=[...Z];Ge[J]={...Ge[J],content:ye},ie(Ge),f&&r(f,{ai_history:Ge},[],{skipHistory:!0})},[oe,Ee]=x.useState(!1),[Ue,tt]=x.useState(350),[Ne,pt]=x.useState(!1),[dt,Et]=x.useState(""),[ue,Se]=x.useState(!1),[nt,ft]=x.useState(""),ct=x.useRef(null),Qe=x.useRef(U==null?void 0:U.description);x.useEffect(()=>{if(f){const J=localStorage.getItem(`projectNotesHeight_${f}`);tt(J?parseInt(J):350)}},[f]),x.useEffect(()=>{(U==null?void 0:U.description)!==void 0&&U.description!==Qe.current&&(Et(U.description||""),Qe.current=U.description)},[U==null?void 0:U.description]),x.useEffect(()=>{Et((U==null?void 0:U.description)||""),Qe.current=U==null?void 0:U.description,U!=null&&U.description&&Ee(!0)},[f]),x.useEffect(()=>{const J=setTimeout(()=>{f&&U&&dt!==U.description&&r(f,{description:dt})},500);return()=>clearTimeout(J)},[dt,f]),x.useEffect(()=>{if(!Ne)return;const J=Ge=>{const kt=Math.max(100,Math.min(800,Ge.clientY-200));tt(kt)},ye=()=>{pt(!1),f&&localStorage.setItem(`projectNotesHeight_${f}`,Ue.toString())};return window.addEventListener("mousemove",J),window.addEventListener("mouseup",ye),()=>{window.removeEventListener("mousemove",J),window.removeEventListener("mouseup",ye)}},[Ne,Ue,f]);const[It,Lt]=x.useState(null);if(x.useEffect(()=>{if(!U){Lt(null);return}const J=U.images&&U.images.length>0?U.images[0]:U.cover_image;if(!J){Lt(null);return}const ye=new window.Image;ye.crossOrigin="Anonymous",ye.src=J,ye.onload=()=>{try{const Ge=document.createElement("canvas"),kt=Ge.getContext("2d");if(!kt)return;Ge.width=50,Ge.height=50,kt.drawImage(ye,0,0,50,50);const Y=kt.getImageData(0,0,50,50).data,ze={};for(let X=0;X<Y.length;X+=4){const Fe=Y[X],je=Y[X+1],He=Y[X+2];if(Y[X+3]<200||Fe>240&&je>240&&He>240)continue;const ee=20,xe=Math.floor(Fe/ee)*ee,Pe=Math.floor(je/ee)*ee,et=Math.floor(He/ee)*ee,_t=`${xe},${Pe},${et}`;ze[_t]=(ze[_t]||0)+1}const lt=Object.entries(ze).sort(([,X],[,Fe])=>Fe-X).map(([X])=>X);if(lt.length>0){const X=ee=>{const[xe,Pe,et]=ee.split(",").map(Number);return Math.max(xe,Pe,et)-Math.min(xe,Pe,et)},je=lt.slice(0,15).sort((ee,xe)=>X(xe)-X(ee)),He=je[0],Ye=je[1]||He;Lt(`linear-gradient(135deg, rgba(${He}, 0.25) 0%, rgba(${Ye}, 0.2) 100%)`)}else Lt(null)}catch(Ge){console.warn("Gradient extraction failed:",Ge),Lt(null)}},ye.onerror=()=>Lt(null)},[U]),f&&U){const J=Jn[U.color]||Jn.blue,ye=S.find(Ge=>Ge.id===f);return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main",children:[c.jsxs("div",{className:"flex items-center gap-4 px-6 py-4 border-b relative transition-[background] duration-500 bg-theme-header",style:{borderBottomColor:J.color+"30",backgroundImage:It||"none"},children:[c.jsx("button",{onClick:()=>{y?(l(y),b(null)):h(null)},className:"p-2 rounded-lg bg-transparent hover:bg-theme-hover text-theme-secondary hover:text-theme-primary transition-colors",title:y?"":"",children:c.jsx(TI,{size:20})}),c.jsx("div",{className:"flex-1 min-w-0",children:ue?c.jsx("input",{ref:ct,type:"text",value:nt,onChange:Ge=>ft(Ge.target.value),onKeyDown:Ge=>{Ge.key==="Enter"?(Ge.preventDefault(),nt.trim()&&f&&r(f,{title:nt.trim()}),Se(!1)):Ge.key==="Escape"&&(Se(!1),ft(U.title))},onBlur:()=>{nt.trim()&&nt!==U.title&&f&&r(f,{title:nt.trim()}),Se(!1)},className:`text-xl font-bold text-theme-primary ${ne} w-full bg-transparent border-b-2 border-indigo-400 outline-none`,autoFocus:!0}):c.jsx("h1",{className:`text-xl font-bold text-theme-primary ${ne} truncate cursor-pointer hover:text-indigo-600 transition-colors`,onClick:()=>{ft(U.title),Se(!0),setTimeout(()=>{var Ge;return(Ge=ct.current)==null?void 0:Ge.select()},0)},title:"",children:U.title})}),c.jsxs("div",{className:"px-3 py-1 rounded-full text-xs font-bold flex-shrink-0",style:{backgroundColor:J.color+"20",color:J.color},children:[(ye==null?void 0:ye.childCount)||0," "]}),c.jsxs("button",{onClick:()=>s(f),className:"flex items-center gap-1.5 px-3 py-1.5 bg-theme-hover hover:bg-theme-card rounded-lg text-sm text-theme-secondary hover:text-theme-primary transition-colors",title:"",children:[c.jsx(Iv,{size:14}),""]}),c.jsxs("div",{className:"flex items-center gap-1 bg-theme-hover p-0.5 rounded-lg ml-2",children:[c.jsx("button",{onClick:()=>v("list"),className:`p-1.5 rounded-md transition-all ${g==="list"?"bg-white shadow-sm text-indigo-500":"text-gray-400 hover:text-gray-600"}`,title:"",children:c.jsx(PI,{size:16})}),c.jsx("button",{onClick:()=>v("gantt"),className:`p-1.5 rounded-md transition-all ${g==="gantt"?"bg-white shadow-sm text-indigo-500":"text-gray-400 hover:text-gray-600"}`,title:"",children:c.jsx(vz,{size:16})})]})]}),U.description&&c.jsxs("div",{className:"border-b bg-theme-hover",style:{borderBottomColor:J.color+"30"},children:[c.jsx("div",{className:"flex items-center gap-2 px-6 py-1 cursor-pointer hover:bg-theme-card transition-colors",onClick:()=>Ee(!oe),children:c.jsx(Pr.div,{animate:{rotate:oe?90:0},transition:{duration:.15},children:c.jsx(rs,{size:16,className:"text-gray-400"})})}),oe&&c.jsxs("div",{className:"relative",children:[c.jsxs("div",{className:"px-6 pb-3 overflow-y-auto custom-scrollbar transition-all duration-200 relative group",style:{height:Ue},onKeyDown:Ge=>Ge.stopPropagation(),children:[c.jsx(Zg,{onEditorReady:Ge=>{Oe.current=Ge},onPolish:(Ge,kt,Y)=>{ae(kt),Y&&le(Y),Le(!0),st("")},initialContent:dt,onChange:Et,editable:!0,descFontClass:"font-extralight",textSizeClass:"text-sm",className:"min-h-full pb-8 text-theme-secondary"}),c.jsx("button",{onClick:Ge=>{Ge.stopPropagation(),Ee(!1)},className:"absolute bottom-2 right-6 p-1.5 rounded-full bg-theme-main/80 hover:bg-theme-hover text-gray-400 hover:text-theme-secondary transition-all opacity-0 group-hover:opacity-100 flex items-center gap-1 text-xs font-medium backdrop-blur-sm z-10 border border-theme shadow-sm",title:"",children:c.jsx(rs,{size:14,className:"-rotate-90"})})]}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1.5 cursor-ns-resize hover:bg-indigo-200 transition-colors group",onMouseDown:()=>pt(!0),children:c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-0 w-8 h-1 rounded-full bg-gray-300 group-hover:bg-indigo-400 transition-colors"})})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden relative",children:g==="list"?c.jsx(TR,{rootParentId:f}):c.jsx("div",{className:"h-full w-full",children:c.jsx(jR,{plan:Q,onUpdatePlan:ke,onEditTask:Ge=>s(Ge)})})}),i===f&&U&&c.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center bg-theme-main/95 backdrop-blur-sm overflow-y-auto pt-20",children:[c.jsx("div",{className:"w-full max-w-3xl px-4 pb-20",children:c.jsx(Po,{initialData:U,onClose:()=>s(null)})}),c.jsx("button",{onClick:()=>s(null),className:"absolute top-6 right-6 p-2 text-gray-400 hover:text-theme-secondary rounded-full hover:bg-theme-hover transition-colors",children:c.jsx(un,{size:24})})]}),c.jsx(Xee,{isOpen:Ce,onClose:()=>Le(!1),position:_e||void 0,customPrompt:Ve,setCustomPrompt:st,onRun:fe,prompts:Me,saveToLibrary:Be,setSaveToLibrary:ht,isLoading:vt,history:Z,historyIndex:he,setHistoryIndex:se,onDeleteHistory:xt,onUpdateHistory:Dt,onReplace:Re,onInsert:qe})]})}return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main",children:[c.jsxs("div",{className:"flex items-center justify-between px-6 py-4 bg-theme-header backdrop-blur-sm border-b border-gray-200/50",children:[c.jsxs("div",{children:[c.jsx("h1",{className:`text-xl font-bold text-theme-primary ${ne}`,children:""}),c.jsxs("p",{className:"text-xs text-theme-secondary mt-0.5",children:[S.length," "]})]}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("button",{onClick:F,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg text-sm font-medium transition-colors shadow-sm",children:[c.jsx(xz,{size:16}),""]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(Bz,{size:14,className:"text-gray-400"}),c.jsx("input",{type:"range",min:180,max:400,value:w,onChange:J=>T(parseInt(J.target.value)),className:"w-24 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"}),c.jsxs("span",{className:"text-xs text-theme-secondary w-12",children:[w,"px"]})]})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6",onClick:()=>m(null),children:S.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx("div",{className:"w-24 h-24 bg-theme-hover rounded-2xl flex items-center justify-center mb-4",children:c.jsx(vf,{size:40,className:"opacity-30"})}),c.jsx("p",{className:"text-lg font-medium",children:""}),c.jsx("p",{className:"text-sm mt-1",children:"project"})]}):c.jsx(rU,{children:c.jsx("div",{className:"flex flex-wrap gap-5",style:{display:"flex",flexWrap:"wrap",gap:"20px"},onDragOver:V,onDrop:D,children:_.map(J=>c.jsx(Zee,{project:J,size:w,tags:e,isSelected:p===J.id,isDragging:I===J.id,isDropTarget:O===J.id,onSelect:()=>m(J.id),onDoubleClick:()=>h(J.id),onDelete:()=>me(J.id),onDragStart:()=>P(J.id),onDragEnd:ge,registerRef:j,fontFamilyClass:ne},J.id))})})})]})},Zee=({project:t,size:e,tags:n,isSelected:r,isDragging:s,isDropTarget:i,onSelect:o,onDoubleClick:a,onDragStart:l,onDragEnd:u,registerRef:d,fontFamilyClass:f})=>{const h=Jn[t.color]||Jn.blue,p=x.useMemo(()=>t.tags.some(w=>{const T=n.find(R=>R.id===w);return T&&T.name.includes("")}),[t.tags,n]),m=t.childCount>0?t.completedCount/t.childCount:0,y=10,b=2*Math.PI*y,g=b-m*b,v=w=>{w.dataTransfer.effectAllowed="move",w.dataTransfer.setData("text/plain",t.id),l()};return c.jsx(Pr.div,{layout:!0,layoutId:t.id,transition:{layout:{type:"spring",stiffness:350,damping:25,mass:.8}},ref:w=>d(t.id,w),draggable:!0,onDragStart:v,onDragEnd:u,className:`relative transition-opacity duration-200 ${s?"opacity-50 scale-95":""}`,style:{width:e,...i&&{marginRight:"8px",borderRight:"4px solid #6366f1"}},onDoubleClick:w=>{w.stopPropagation(),a()},children:c.jsx(Pr.div,{onClick:w=>{w.stopPropagation(),s||o()},className:`
                    relative rounded-[20px] overflow-hidden cursor-pointer group flex flex-col
                    bg-white dark:bg-gray-800 
                    shadow-[0_2px_8px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)]
                    border border-gray-100 dark:border-gray-700
                    transition-all duration-300 ease-out
                    ${r?"ring-2 ring-indigo-500 shadow-md":""}
                    ${s?"ring-2 ring-indigo-400":""}
                    ${p?"ring-1 ring-yellow-400/50":""}
                `,style:{height:e*.75},whileHover:s?{}:{y:-4,scale:1.01},children:c.jsxs("div",{className:"p-5 flex flex-col h-full bg-gradient-to-br from-white to-gray-50/50 dark:from-gray-800 dark:to-gray-800/50",children:[c.jsxs("div",{className:"flex justify-between items-start mb-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-lg font-bold shadow-sm",style:{backgroundColor:p?"#fefce8":h.color+"15",color:p?"#ca8a04":h.color},children:p?c.jsx(Wz,{size:18}):t.title.charAt(0).toUpperCase()}),c.jsx("div",{className:"relative w-8 h-8 flex items-center justify-center",children:c.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[c.jsx("circle",{cx:"16",cy:"16",r:y,stroke:"currentColor",strokeWidth:"2.5",fill:"none",className:"text-gray-100 dark:text-gray-700"}),c.jsx("circle",{cx:"16",cy:"16",r:y,stroke:h.color,strokeWidth:"2.5",fill:"none",strokeDasharray:b,strokeDashoffset:g,strokeLinecap:"round",className:"transition-all duration-1000 ease-out"})]})})]}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:`font-bold text-[17px] text-gray-800 dark:text-gray-100 leading-tight mb-1 truncate ${f}`,children:t.title}),c.jsxs("p",{className:"text-[11px] font-medium text-gray-400 dark:text-gray-500 uppercase tracking-wide",children:[t.completedCount," / ",t.childCount," Completed"]})]}),c.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:c.jsx("div",{className:"p-1 rounded text-gray-300 hover:text-gray-500",children:c.jsx(DI,{size:14})})})]})})})},Wy=[{id:"learning",label:"",icon:xf,row:0,col:0,color:"from-blue-500 to-cyan-400"},{id:"experience",label:"",icon:dz,row:0,col:1,color:"from-purple-500 to-pink-400"},{id:"leisure",label:"",icon:uz,row:0,col:2,color:"from-green-500 to-emerald-400"},{id:"work",label:"",icon:iz,row:1,col:0,color:"from-orange-500 to-amber-400"},{id:"core",label:"",icon:VI,row:1,col:1,color:"from-yellow-500 to-orange-400",isCenter:!0},{id:"family",label:"",icon:Tz,row:1,col:2,color:"from-rose-500 to-pink-400"},{id:"social",label:"",icon:Gz,row:2,col:0,color:"from-indigo-500 to-blue-400"},{id:"finance",label:"",icon:qz,row:2,col:1,color:"from-emerald-500 to-teal-400"},{id:"health",label:"",icon:ou,row:2,col:2,color:"from-red-500 to-rose-400"}],ete=()=>{const{tasks:t,tags:e,themeSettings:n,setView:r}=x.useContext(En),[s,i]=x.useState(null),o=x.useMemo(()=>e.filter(h=>h.name.includes("")).map(h=>h.id),[e]),a=x.useMemo(()=>{const h={};return Wy.forEach(p=>{h[p.id]=e.filter(m=>m.name.includes(p.label)).map(m=>m.id)}),h},[e]),l=x.useMemo(()=>{const h=e.find(p=>p.name.toLowerCase()==="project");return h?t.filter(p=>{var m,y;return p.status!=="deleted"&&((m=p.tags)==null?void 0:m.includes(h.id))&&((y=p.tags)==null?void 0:y.some(b=>o.includes(b)))}).map(p=>({id:p.id,title:p.title,color:p.color||"blue",tags:p.tags||[]})):[]},[t,e,o]),u=x.useMemo(()=>{const h={};return Wy.forEach(p=>{h[p.id]=l.filter(m=>m.tags.some(y=>{var b;return(b=a[p.id])==null?void 0:b.includes(y)}))}),h},[l,a]),d=n.fontFamily==="things"?"font-things":"font-sans",f=h=>{localStorage.setItem("openProjectId",h),localStorage.setItem("previousView","annualplan"),r("project")};return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main",children:[c.jsx("div",{className:"flex items-center justify-between px-6 py-4 bg-theme-header backdrop-blur-sm border-b border-gray-200/50",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-xl shadow-lg",children:c.jsx(WI,{size:24,className:"text-white"})}),c.jsxs("div",{children:[c.jsx("h1",{className:`text-xl font-bold text-theme-primary ${d}`,children:""}),c.jsxs("p",{className:"text-xs text-theme-tertiary",children:[l.length," "]})]})]})}),c.jsx("div",{className:"flex-1 p-6 overflow-auto",onClick:()=>i(null),children:c.jsx("div",{className:"grid grid-cols-3 gap-4 h-full max-w-5xl mx-auto",children:Wy.map(h=>{const p=h.icon,m=u[h.id]||[];return c.jsxs(Pr.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:h.row*.1+h.col*.05},className:`
                                    relative rounded-2xl overflow-hidden
                                    bg-theme-card shadow-lg
                                    border border-gray-200/50 dark:border-gray-700/50
                                    ${h.isCenter?"ring-2 ring-yellow-400/50 shadow-yellow-100/30":""}
                                `,children:[c.jsxs("div",{className:`
                                    px-3 py-2 bg-gradient-to-r ${h.color}
                                    flex items-center gap-2
                                `,children:[c.jsx(p,{size:16,className:"text-white/90"}),c.jsx("span",{className:"text-sm font-bold text-white/95 drop-shadow-sm",children:h.label})]}),c.jsx("div",{className:"p-2 space-y-1 max-h-[calc(100%-40px)] overflow-y-auto",children:m.length===0?c.jsx("div",{className:"text-center py-4 text-theme-tertiary text-xs",children:""}):m.map(y=>{const b=Jn[y.color]||Jn.blue,g=s===y.id;return c.jsx(Pr.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:v=>{v.stopPropagation(),i(y.id)},onDoubleClick:v=>{v.stopPropagation(),f(y.id)},className:`
                                                        px-3 py-2 rounded-lg cursor-pointer
                                                        transition-all duration-150
                                                        ${g?"bg-indigo-100 dark:bg-indigo-900/30 ring-2 ring-indigo-500":"hover:bg-theme-hover"}
                                                    `,style:{borderLeft:`3px solid ${b.color}`},children:c.jsx("p",{className:`text-sm font-medium text-theme-primary line-clamp-2 ${d}`,children:y.title})},y.id)})}),m.length>0&&c.jsx("div",{className:"absolute top-2 right-2 px-2 py-0.5 bg-white/90 dark:bg-gray-800/90 rounded-full text-[10px] font-bold text-gray-600 dark:text-gray-300 shadow-sm",children:m.length})]},h.id)})})})]})},tte=()=>{const{advancedFilters:t,setAdvancedFilters:e,tags:n,tagFilter:r}=x.useContext(En);if(!r)return null;const s=n.filter(l=>{let u=l;for(;u.parent_id;){if(u.parent_id===r)return!0;u=n.find(d=>d.id===u.parent_id)||{parent_id:null}}return!1}),i=l=>{l&&e(u=>({...u,additionalTags:u.additionalTags.includes(l)?u.additionalTags.filter(d=>d!==l):[...u.additionalTags,l]}))},o=()=>{e({additionalTags:[],startDate:null,dueDate:null,color:null})},a=t.additionalTags.length>0;return c.jsxs("div",{className:"px-8 py-3 border-b border-gray-50 bg-gray-50/30 flex items-center gap-4 relative z-20",children:[c.jsx("div",{className:"flex items-center gap-2",children:c.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Filters:"})}),c.jsx(M1,{icon:zl,label:"Sub-tags",items:s,selectedIds:t.additionalTags,onSelect:i,multiSelect:!0,placeholder:"Filter by sub-tags..."}),a&&c.jsxs("button",{onClick:o,className:"ml-auto flex items-center gap-1 text-[10px] text-gray-400 hover:text-red-500 transition-colors",children:[c.jsx(un,{size:12})," Clear"]})]})},nte=({toast:t,onClose:e})=>{const[n,r]=x.useState(!1);x.useEffect(()=>{requestAnimationFrame(()=>r(!0));const a=setTimeout(()=>{r(!1),setTimeout(e,300)},1e4);return()=>clearTimeout(a)},[t,e]);const s=()=>t.type==="error"?c.jsx(Jf,{size:16}):t.undo?c.jsx(oz,{size:16}):c.jsx(AI,{size:16}),i=()=>{t.onClick&&(t.onClick(),e())},o=a=>{a.stopPropagation(),r(!1),setTimeout(e,300)};return c.jsx("div",{className:`
                fixed top-4 left-1/2 -translate-x-1/2 z-[9999]
                transition-all duration-300 ease-out
                ${n?"opacity-100 translate-y-0":"opacity-0 -translate-y-4"}
            `,children:c.jsxs("div",{className:`
                    px-4 py-2.5 rounded-full shadow-lg flex items-center gap-3 backdrop-blur-md
                    ${t.type==="error"?"bg-red-500/90 text-white":"bg-gray-900/90 text-white"}
                    ${t.onClick?"cursor-pointer hover:bg-gray-800/95 transition-colors":""}
                `,onClick:t.onClick?i:void 0,children:[c.jsxs("div",{className:"flex items-center gap-2",children:[s(),c.jsx("span",{className:"text-sm font-medium",children:t.msg})]}),t.onClick&&!t.undo&&c.jsxs("div",{className:"flex items-center gap-1 text-xs text-white/70",children:[c.jsx(II,{size:12}),c.jsx("span",{children:t.actionLabel||""})]}),t.undo&&c.jsxs("button",{onClick:a=>{var l;a.stopPropagation(),(l=t.undo)==null||l.call(t),e()},className:"flex items-center gap-1 px-2.5 py-1 bg-white/20 hover:bg-white/30 rounded-full text-xs font-bold transition-colors",children:[c.jsx(BI,{size:12}),"Undo"]}),c.jsx("button",{onClick:o,className:"p-1 -mr-1.5 rounded-full hover:bg-white/20 transition-colors",title:"",children:c.jsx(un,{size:14})})]})})},IR=t=>t.map(e=>({...e,id:e.id||crypto.randomUUID(),subtasks:e.subtasks?IR(e.subtasks):[]})),rte=({taskId:t,onClose:e})=>{const{tasks:n,tags:r,batchAddTasks:s,setToast:i}=x.useContext(En),[o,a]=x.useState("prompt"),[l,u]=x.useState(null),[d,f]=x.useState(null),[h,p]=x.useState(!1),[m,y]=x.useState(""),[b,g]=x.useState(""),[v,w]=x.useState("list"),[T,R]=x.useState([]),[k,M]=x.useState(-1);x.useEffect(()=>{l&&T.length===0&&(R([l]),M(0))},[l]);const S=j=>{const W=T.slice(0,k+1);W.push(j),R(W),M(W.length-1),u(j)},C=()=>{if(k>0){const j=k-1;M(j),u(T[j])}},_=()=>{if(k<T.length-1){const j=k+1;M(j),u(T[j])}};x.useEffect(()=>{const j=W=>{(W.metaKey||W.ctrlKey)&&W.key==="z"&&(W.preventDefault(),W.stopPropagation(),W.shiftKey?_():C())};return window.addEventListener("keydown",j,{capture:!0}),()=>window.removeEventListener("keydown",j,{capture:!0})},[k,T]);const E=n.find(j=>j.id===t),I=x.useMemo(()=>{const j=r.find(W=>W.name.trim().toLowerCase()==="prompt");return j?n.filter(W=>W.tags.includes(j.id)&&W.status!=="deleted"&&W.status!=="logged").sort((W,V)=>V.created_at.localeCompare(W.created_at)):[]},[n,r]),P=x.useMemo(()=>{if(!b.trim())return I.slice(0,10);const j=b.toLowerCase();return I.filter(W=>W.title.toLowerCase().includes(j)||(W.description||"").toLowerCase().includes(j)).slice(0,10)},[I,b]),O=async()=>{if(!E){f("Task not found"),a("error");return}a("loading");try{const j=new Date().toISOString().split("T")[0],W=new Date,V=new Date;V.setDate(V.getDate()+14);const D=n.filter(ne=>ne.status!=="deleted"&&ne.status!=="completed"&&ne.status!=="logged").filter(ne=>{const Oe=ne.start_date||ne.due_date;if(!Oe)return!1;const at=new Date(Oe);return at>=W&&at<=V}).map(ne=>{var Oe,at;return`- ${((Oe=ne.start_date)==null?void 0:Oe.split("T")[0])||((at=ne.due_date)==null?void 0:at.split("T")[0])}: ${ne.title}`}).slice(0,20),ge=E.title.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g,"").match(/.{1,2}/g)||[],me=n.filter(ne=>ne.status==="completed"||ne.status==="logged").map(ne=>{let Oe=0;return ge.forEach(at=>{ne.title.includes(at)&&Oe++}),{task:ne,score:Oe}}).filter(ne=>ne.score>0).sort((ne,Oe)=>Oe.score-ne.score).slice(0,5).map(ne=>`- [] ${ne.task.title}: ${ne.task.description||"()"}`),F=await PY(E.title,E.description||"",E.start_date||null,E.due_date||null,{today:j,existingSchedule:D,pastExperiences:me},m||void 0),U=IR(F);u(U),R([U]),M(0),a("preview")}catch(j){console.error(j),f(j.message||"Failed to generate plan"),a("error")}},$=async()=>{if(l){p(!0);try{await s(l,t),i({msg:"72",type:"info"}),e()}catch(j){i({msg:""+j.message,type:"error"}),p(!1)}}},A=(j,W,V)=>{if(!l)return;const D=JSON.parse(JSON.stringify(l));let ge=D;for(let me=0;me<j.length-1;me++)ge=ge[j[me]].subtasks;ge[j[j.length-1]][W]=V,S(D)};return o==="prompt"?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-xl max-h-[80vh] flex flex-col animate-in slide-in-from-bottom-10 duration-200",children:[c.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-2xl",children:""}),c.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"72"})]}),c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 rounded-full p-1 hover:bg-gray-100",children:c.jsx(un,{size:20})})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-6 flex flex-col gap-4",children:[c.jsx("div",{className:"bg-indigo-50 p-3 rounded-lg border border-indigo-100",children:c.jsxs("p",{className:"text-sm text-indigo-700",children:["",c.jsx("strong",{children:E==null?void 0:E.title})]})}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),c.jsx("textarea",{value:m,onChange:j=>y(j.target.value),placeholder:"...",className:"w-full border border-gray-200 rounded-lg p-3 text-sm focus:ring-2 focus:ring-indigo-200 focus:border-indigo-400 resize-none",rows:3})]}),I.length>0&&c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),c.jsx("input",{type:"text",value:b,onChange:j=>g(j.target.value),placeholder:"...",className:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm mb-2 focus:ring-2 focus:ring-indigo-200 focus:border-indigo-400"}),c.jsx("div",{className:"flex flex-col gap-1 max-h-40 overflow-y-auto",children:P.map(j=>c.jsxs("button",{onClick:()=>y(j.description||j.title),className:"text-left p-2 rounded-lg hover:bg-gray-50 border border-gray-100 text-sm transition-colors",children:[c.jsx("span",{className:"font-medium text-gray-800",children:j.title}),j.description&&c.jsxs("p",{className:"text-xs text-gray-500 line-clamp-1 mt-0.5",children:[j.description.slice(0,80),"..."]})]},j.id))})]})]}),c.jsxs("div",{className:"px-6 py-4 border-t bg-white flex justify-end gap-3",children:[c.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:""}),c.jsxs("button",{onClick:O,className:"px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg flex items-center gap-2",children:[c.jsx(a1,{size:18}),""]})]})]})}):o==="loading"?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/30 backdrop-blur-sm",children:c.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 flex flex-col items-center gap-4 animate-in zoom-in duration-200",children:[c.jsx(yi,{className:"w-12 h-12 text-indigo-600 animate-spin"}),c.jsx("p",{className:"text-lg font-medium text-gray-700",children:"72..."}),c.jsx("p",{className:"text-sm text-gray-500",children:""})]})}):o==="error"?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/30 backdrop-blur-sm",children:c.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 w-[400px] flex flex-col gap-4",children:[c.jsxs("div",{className:"flex items-center gap-3 text-red-600",children:[c.jsx(Jf,{size:24}),c.jsx("h3",{className:"text-lg font-bold",children:""})]}),c.jsx("p",{className:"text-gray-600",children:d}),c.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[c.jsx("button",{onClick:()=>a("prompt"),className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700",children:""}),c.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700",children:""})]})]})}):c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col animate-in slide-in-from-bottom-10 duration-200",children:[c.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between sticky top-0 bg-white rounded-t-xl z-10",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-2xl",children:""}),c.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"72"})]}),c.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg",children:[c.jsx("button",{onClick:()=>w("list"),className:`px-3 py-1.5 text-sm rounded-md transition-all ${v==="list"?"bg-white shadow-sm text-indigo-600 font-medium":"text-gray-500 hover:text-gray-700"}`,children:""}),c.jsx("button",{onClick:()=>w("gantt"),className:`px-3 py-1.5 text-sm rounded-md transition-all ${v==="gantt"?"bg-white shadow-sm text-indigo-600 font-medium":"text-gray-500 hover:text-gray-700"}`,children:""})]})]}),c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 rounded-full p-1 hover:bg-gray-100",children:c.jsx(un,{size:20})})]}),c.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50/50 flex flex-col",children:v==="list"?c.jsxs("div",{className:"p-6",children:[c.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg border border-indigo-100 mb-4",children:[c.jsx("h3",{className:"font-bold text-indigo-900 mb-1",children:E==null?void 0:E.title}),c.jsx("p",{className:"text-sm text-indigo-700",children:"AI"})]}),c.jsx("div",{className:"flex flex-col gap-3",children:l==null?void 0:l.map((j,W)=>c.jsx(MR,{item:j,path:[W],onUpdate:A},W))})]}):c.jsx("div",{className:"flex-1 min-h-[500px] flex flex-col",children:l&&c.jsx(jR,{plan:l,onUpdatePlan:S})})}),c.jsxs("div",{className:"px-6 py-4 border-t bg-white rounded-b-xl flex justify-between sticky bottom-0 z-10",children:[c.jsxs("button",{onClick:()=>a("prompt"),className:"px-4 py-2 text-gray-500 hover:bg-gray-100 rounded-lg flex items-center gap-1",children:[c.jsx(Mg,{size:16})," "]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:e,className:"px-5 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",disabled:h,children:""}),c.jsxs("button",{onClick:$,disabled:h,className:"px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg shadow-sm flex items-center gap-2 disabled:opacity-70",children:[h?c.jsx(yi,{className:"animate-spin",size:18}):c.jsx(Xn,{size:18}),h?"...":""]})]})]})]})})},MR=({item:t,path:e,depth:n=0,onUpdate:r})=>{const[s,i]=x.useState(!0),o=t.subtasks&&t.subtasks.length>0;return c.jsxs("div",{className:"flex flex-col",children:[c.jsx("div",{className:`p-3 bg-white rounded-lg border border-gray-100 shadow-sm ${n>0?"ml-6":""}`,children:c.jsxs("div",{className:"flex items-start gap-2",children:[o?c.jsx("button",{onClick:()=>i(!s),className:"mt-1 text-gray-400 hover:text-gray-600",children:s?c.jsx(ts,{size:14}):c.jsx(rs,{size:14})}):c.jsx("div",{className:"w-[14px] mt-1"}),c.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[c.jsx("input",{type:"text",value:t.title,onChange:a=>r(e,"title",a.target.value),className:"font-medium text-gray-800 bg-transparent border-b border-transparent hover:border-gray-200 focus:border-indigo-400 focus:outline-none px-1 py-0.5 w-full",placeholder:""}),c.jsxs("div",{className:"flex items-start gap-1",children:[c.jsx(Xf,{size:12,className:"text-gray-400 mt-1 flex-shrink-0"}),c.jsx("textarea",{value:t.description||"",onChange:a=>r(e,"description",a.target.value),placeholder:"...",className:"text-sm text-gray-600 bg-gray-50 border border-gray-100 rounded px-2 py-1 w-full resize-none focus:border-indigo-300 focus:outline-none",rows:2})]}),c.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(vo,{size:12,className:"text-gray-400"}),c.jsx("span",{className:"text-gray-500",children:":"}),c.jsx("input",{type:"date",value:t.start_date||"",onChange:a=>r(e,"start_date",a.target.value),className:"border border-gray-200 rounded px-1 py-0.5 text-xs focus:border-indigo-400 focus:outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("span",{className:"text-gray-500",children:":"}),c.jsx("input",{type:"date",value:t.due_date||"",onChange:a=>r(e,"due_date",a.target.value),className:"border border-gray-200 rounded px-1 py-0.5 text-xs focus:border-indigo-400 focus:outline-none"})]})]})]})]})}),o&&s&&c.jsx("div",{className:"flex flex-col gap-2 mt-2 pl-6 relative",children:t.subtasks.map((a,l)=>c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"absolute left-[-12px] top-[-14px] bottom-[20px] w-px bg-gray-200 -z-10"}),c.jsx("div",{className:"absolute left-[-12px] top-[26px] w-[12px] h-px bg-gray-200 -z-10"}),c.jsx(MR,{item:a,path:[...e,l],depth:n+1,onUpdate:r})]},l))})]})},yb=({taskId:t,initialData:e,onClose:n,isReadOnly:r=!1})=>{const{tasks:s,tags:i,updateTask:o,addTask:a,addTag:l,deleteTask:u,toggleExpansion:d,setToast:f,user:h}=x.useContext(En),{isRecording:p,startRecording:m,stopRecording:y,recordingTaskId:b}=x.useContext(Ru),g=t?s.find(Y=>Y.id===t):null,v=g||e||{},[w,T]=x.useState(v.title||""),[R,k]=x.useState(v.description||""),[M,S]=x.useState(v.start_date||""),[C,_]=x.useState(v.due_date||""),[E,I]=x.useState(v.tags||[]),[P,O]=x.useState(v.parent_id||null),[$,A]=x.useState(v.color||"blue"),[j,W]=x.useState(v.importance||"unplanned"),[V,D]=x.useState(v.repeat_rule||null),[ge,me]=x.useState(v.images||[]),[F,U]=x.useState(v.attachments||[]),[ne,Oe]=x.useState(v.is_all_day!==!1),[at,ae]=x.useState(()=>{if(v.start_time)return v.start_time;if(v.start_date&&!v.is_all_day){const Y=new Date(v.start_date);return`${String(Y.getHours()).padStart(2,"0")}:${String(Y.getMinutes()).padStart(2,"0")}`}return""}),[_e,le]=x.useState(()=>v.end_time?v.end_time:(v.start_date&&!v.is_all_day&&v.duration,"")),[Ce,Le]=x.useState(()=>{if(t)try{const Y=localStorage.getItem(`task_reminder_${t}`);if(Y!==null)return JSON.parse(Y)}catch{}return(g==null?void 0:g.reminder_minutes)??null}),[Ve,st]=x.useState(null),[Be,ht]=x.useState(!1),[vt,te]=x.useState(!1),[Z,ie]=x.useState(!1),[he,se]=x.useState(!1),[Q,ke]=x.useState(""),[Me,fe]=x.useState(!1),Re=x.useRef(null),[qe,xt]=x.useState(!1),[Dt,oe]=x.useState(null),[Ee,Ue]=x.useState(()=>{if(M){const Y=new Date(M);return new Date(Y.getFullYear(),Y.getMonth(),1)}return new Date(new Date().getFullYear(),new Date().getMonth(),1)}),[tt,Ne]=x.useState(null),pt=x.useRef(null),dt=x.useRef(null),Et=x.useRef(null),ue=x.useRef(null),Se=x.useRef(null);if(x.useEffect(()=>{const Y=setTimeout(()=>te(!0),100);return()=>clearTimeout(Y)},[]),x.useEffect(()=>{g?(T(g.title||""),k((g==null?void 0:g.description)||""),S(()=>{const Y=g.start_date;return Y?Y.includes("T")?Qe(new Date(Y)):Y:""}),_(g.due_date||""),I(g.tags||[]),O(g.parent_id||null),A(g.color||"blue"),W(g.importance||"unplanned"),D(g.repeat_rule||null),me(g.images||[]),U(g.attachments||[])):!t&&e?(T(e.title||""),k(e.description||""),S(e.start_date||""),_(e.due_date||""),I(e.tags||[]),O(e.parent_id||null),A(e.color||"blue"),W(e.importance||"unplanned"),D(e.repeat_rule||null),me(e.images||[]),U(e.attachments||[])):t||(T(""),k(""),S(""),_(""),I([]),O(null),A("blue"),W("unplanned"),D(null),me([]),U([]))},[g,t,e]),x.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]),x.useEffect(()=>{if(!t&&vt&&dt.current){const Y=()=>{if(dt.current){window.scrollTo(0,0);const ze=document.querySelector(".mobile-task-editor-content");ze&&(ze.scrollTop=0),dt.current.focus({preventScroll:!0}),dt.current.click()}};Y(),setTimeout(Y,100),setTimeout(Y,300)}},[t,vt]),t&&!g)return null;const nt=async()=>{if(console.log("[MobileTaskEditor] handleSave called, title:",w),!w.trim()){f==null||f({msg:"",type:"error"});return}try{let Y=M||null;M&&!ne&&at&&(Y=`${M.split("T")[0]}T${at}:00`);let ze=null;if(!ne&&at&&_e){const[X,Fe]=at.split(":").map(Number),[je,He]=_e.split(":").map(Number),Ye=X*60+Fe;ze=je*60+He-Ye,ze<0&&(ze+=24*60)}const lt={title:w.trim(),description:R,start_date:Y,due_date:C||null,tags:E,parent_id:P,color:P?void 0:$,importance:j,repeat_rule:V,images:ge,attachments:F,is_all_day:ne,start_time:ne?null:at,end_time:ne?null:_e,duration:ze,reminder_minutes:Ce};if(console.log("[MobileTaskEditor] taskData:",lt),console.log("[MobileTaskEditor] taskId:",t),console.log("[MobileTaskEditor] addTask function:",typeof a),t)await o(t,lt),P&&d(P,!0);else{const X=await a({...lt,status:"inbox"},[]);if(console.log("[MobileTaskEditor] addTask returned:",X),!X){console.error("[MobileTaskEditor] addTask returned empty - check supabaseClient"),f==null||f({msg:"",type:"error"});return}}f==null||f({msg:"",type:"info"}),n()}catch(Y){console.error("[MobileTaskEditor] Save failed:",Y),console.error("[MobileTaskEditor] Error details:",Y==null?void 0:Y.message,Y==null?void 0:Y.stack),f==null||f({msg:`: ${(Y==null?void 0:Y.message)||""}`,type:"error"})}},ft=()=>{t&&(u(t),f==null||f({msg:"",type:"info"})),n()},ct=Y=>{if(!Y)return"";const ze=new Date(Y),lt=new Date,X=new Date(lt);return X.setDate(X.getDate()+1),ze.toDateString()===lt.toDateString()?"":ze.toDateString()===X.toDateString()?"":ze.toLocaleDateString("zh-TW",{month:"short",day:"numeric",weekday:"short"})},Qe=Y=>{const ze=Y.getFullYear(),lt=String(Y.getMonth()+1).padStart(2,"0"),X=String(Y.getDate()).padStart(2,"0");return`${ze}-${lt}-${X}`},It={urgent:{label:"",color:"bg-red-500",text:"text-red-600",bg:"bg-red-50"},planned:{label:"",color:"bg-amber-500",text:"text-amber-600",bg:"bg-amber-50"},delegated:{label:"",color:"bg-green-500",text:"text-green-600",bg:"bg-green-50"},unplanned:{label:"",color:"bg-gray-400",text:"text-gray-500",bg:"bg-gray-50"}},Lt=Y=>{vt&&Et.current&&!Et.current.contains(Y.target)&&n()},J=async(Y,ze)=>{const lt=Y.target.files;if(!lt||lt.length===0||!h||!ve)return;ie(!0);const X=lt[0];try{const Fe=`${Date.now()}_${xI()}.${X.name.split(".").pop()}`,He=`${h.id}/${Fe}`,{error:Ye}=await ve.storage.from("attachments").upload(He,X,{contentType:X.type,upsert:!1});if(Ye)throw Ye;const{data:ee}=ve.storage.from("attachments").getPublicUrl(He);if(ee){const xe={name:X.name,url:ee.publicUrl,size:X.size,type:X.type};if(ze){if(me(Pe=>[...Pe,ee.publicUrl]),t){const Pe=(g==null?void 0:g.images)||[];await o(t,{images:[...Pe,ee.publicUrl]},[],{skipHistory:!0})}f==null||f({msg:"",type:"info"})}else{if(U(Pe=>[...Pe,xe]),t){const Pe=(g==null?void 0:g.attachments)||[];await o(t,{attachments:[...Pe,xe]},[],{skipHistory:!0})}f==null||f({msg:"",type:"info"})}}}catch(Fe){console.error(Fe),f==null||f({msg:"",type:"error"})}finally{ie(!1),Y.target&&(Y.target.value="")}},ye=async(Y,ze)=>{if(confirm("")){if(ze){if(me(lt=>lt.filter(X=>X!==Y)),t){const lt=(g==null?void 0:g.images)||[];await o(t,{images:lt.filter(X=>X!==Y)},[],{skipHistory:!0})}}else if(U(lt=>lt.filter(X=>X.url!==Y)),t){const lt=(g==null?void 0:g.attachments)||[];await o(t,{attachments:lt.filter(X=>X.url!==Y)},[],{skipHistory:!0})}}},Ge=Y=>{if(tt===Y&&pt.current)pt.current.paused?pt.current.play():(pt.current.pause(),Ne(null));else{pt.current&&pt.current.pause();const ze=new Audio(Y);ze.onended=()=>Ne(null),pt.current=ze,ze.play(),Ne(Y)}},kt=c.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-end justify-center",onMouseDown:Lt,style:{touchAction:"none"},children:[c.jsx("div",{className:"absolute inset-0 bg-black/40"}),c.jsxs(Pr.div,{ref:Et,initial:{y:"100%"},animate:{y:0},transition:{type:"spring",damping:25,stiffness:300},onMouseDown:Y=>Y.stopPropagation(),onTouchStart:Y=>Y.stopPropagation(),className:"relative w-full bg-white rounded-t-3xl max-h-[80dvh] flex flex-col overflow-hidden shadow-2xl",children:[c.jsx("div",{className:"flex justify-center pt-3 pb-2 flex-shrink-0",children:c.jsx("div",{className:"w-10 h-1.5 bg-gray-300 rounded-full"})}),c.jsxs("div",{className:"flex items-center justify-between px-5 pb-3 border-b border-gray-100 flex-shrink-0",children:[c.jsx("button",{type:"button",onClick:n,className:"text-gray-500 p-2 -ml-2 active:bg-gray-100 rounded-full",children:c.jsx(un,{size:24})}),p&&b===t?c.jsxs("div",{className:"flex items-center gap-2 text-red-500 animate-pulse font-medium",children:[c.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),"..."]}):c.jsx("h2",{className:"text-lg font-bold text-gray-800",children:r?"":t?"":""}),!r&&c.jsx("button",{type:"button",onClick:nt,className:"px-4 py-2 bg-indigo-600 text-white rounded-full font-bold text-sm active:bg-indigo-700",children:""})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-5 scroll-smooth mobile-task-editor-content pb-24",children:[c.jsxs("div",{className:"mb-6 relative",children:[c.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 block",children:""}),c.jsx("textarea",{ref:dt,readOnly:r,autoFocus:!t&&!r,rows:1,name:`task_title_no_autofill_${Math.random()}`,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",value:w,onChange:Y=>{T(Y.target.value),fe(Y.target.value.length>0),Y.target.style.height="auto",Y.target.style.height=Y.target.scrollHeight+"px"},onKeyDown:Y=>{var ze;Y.key==="Enter"&&(Y.preventDefault(),(ze=dt.current)==null||ze.blur())},onFocus:()=>fe(w.length>0),onBlur:()=>setTimeout(()=>fe(!1),200),placeholder:"...",className:"w-full text-xl font-medium text-gray-800 border-none outline-none bg-transparent placeholder-gray-300 p-0 resize-none overflow-hidden",style:{minHeight:"28px"}}),Me&&w.length>0&&(()=>{const Y=s.filter(ze=>ze.id!==t&&ze.title&&ze.title.toLowerCase().includes(w.toLowerCase())&&ze.title.toLowerCase()!==w.toLowerCase()).map(ze=>ze.title).filter((ze,lt,X)=>X.indexOf(ze)===lt).slice(0,5);return Y.length===0?null:c.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white rounded-xl shadow-lg border border-gray-200 z-50 overflow-hidden",children:Y.map((ze,lt)=>c.jsx("button",{type:"button",onMouseDown:X=>{X.preventDefault(),T(ze),fe(!1)},className:"w-full text-left px-4 py-3 text-gray-700 hover:bg-indigo-50 border-b border-gray-100 last:border-b-0 transition-colors",children:ze},lt))})})()]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-6",children:[c.jsxs("button",{type:"button",onClick:()=>!r&&st(Ve==="date"?null:"date"),className:`flex flex-col items-center justify-center p-3 rounded-2xl border transition-all ${Ve==="date"||M?"border-indigo-500 bg-indigo-50":"border-gray-200 bg-white"} ${r?"opacity-80":""}`,children:[c.jsx(vo,{size:20,className:M?"text-indigo-600":"text-gray-400"}),c.jsx("span",{className:`text-[10px] mt-1.5 font-bold truncate w-full ${M?"text-indigo-600":"text-gray-500"}`,children:M?ct(M):""})]}),c.jsxs("button",{type:"button",onClick:()=>!r&&se(!0),className:`flex flex-col items-center justify-center p-3 rounded-2xl border transition-all ${he||E.length>0?"border-purple-500 bg-purple-50":"border-gray-200 bg-white"} ${r?"opacity-80":""}`,children:[c.jsx(nz,{size:20,className:E.length>0?"text-purple-600":"text-gray-400"}),c.jsx("span",{className:`text-[10px] mt-1.5 font-bold truncate w-full ${E.length>0?"text-purple-600":"text-gray-500"}`,children:E.length>0?`${E.length} `:""})]})]}),Ve==="date"&&c.jsxs("div",{className:"bg-gray-50 rounded-2xl p-4 space-y-4 mb-6 animate-in slide-in-from-top-2",children:[c.jsxs("div",{className:"flex gap-2 flex-wrap",children:[c.jsx("button",{type:"button",onClick:()=>S(Qe(new Date)),className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${M===Qe(new Date)?"bg-indigo-600 text-white":"bg-white border border-gray-200 text-gray-700"}`,children:""}),c.jsx("button",{type:"button",onClick:()=>{const Y=new Date;Y.setDate(Y.getDate()+1),S(Qe(Y))},className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${(()=>{const Y=new Date;return Y.setDate(Y.getDate()+1),M===Qe(Y)})()?"bg-indigo-600 text-white":"bg-white border border-gray-200 text-gray-700"}`,children:""}),c.jsx("button",{type:"button",onClick:()=>S(""),className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${M?"bg-white border border-gray-200 text-gray-700":"bg-gray-600 text-white"}`,children:""})]}),c.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[c.jsxs("div",{className:"flex items-center justify-between p-2 border-b border-gray-100",children:[c.jsx("button",{type:"button",onClick:()=>Ue(new Date(Ee.getFullYear(),Ee.getMonth()-1,1)),className:"p-2 hover:bg-gray-100 rounded-lg",children:c.jsx(Ou,{size:18,className:"text-gray-600"})}),c.jsxs("span",{className:"text-sm font-bold text-gray-700",children:[Ee.getFullYear()," ",Ee.getMonth()+1,""]}),c.jsx("button",{type:"button",onClick:()=>Ue(new Date(Ee.getFullYear(),Ee.getMonth()+1,1)),className:"p-2 hover:bg-gray-100 rounded-lg",children:c.jsx(rs,{size:18,className:"text-gray-600"})})]}),c.jsx("div",{className:"grid grid-cols-7 text-center text-[10px] font-bold text-gray-400 py-1 border-b border-gray-50",children:"".split("").map(Y=>c.jsx("div",{children:Y},Y))}),c.jsx("div",{className:"grid grid-cols-7 gap-px bg-gray-100 p-px",children:(()=>{const Y=new Date(Ee.getFullYear(),Ee.getMonth(),1),ze=new Date(Ee.getFullYear(),Ee.getMonth()+1,0),lt=Y.getDay(),X=[];for(let He=0;He<lt;He++)X.push(null);for(let He=1;He<=ze.getDate();He++)X.push(new Date(Ee.getFullYear(),Ee.getMonth(),He));const Fe=Qe(new Date),je=M?M.split("T")[0]:"";return X.map((He,Ye)=>{if(!He)return c.jsx("div",{className:"bg-white"},`pad-${Ye}`);const ee=Qe(He),xe=ee===Fe,Pe=ee===je,et=CR(He),_t=ER(He),Vt=He.getDay()===0||He.getDay()===6,Ft=s.filter(nn=>nn.id===t||!nn.start_date?!1:nn.start_date.split("T")[0]===ee).length;return c.jsxs("button",{type:"button",onClick:()=>S(ee),className:`relative bg-white p-1 min-h-[52px] flex flex-col items-center transition-all ${Pe?"ring-2 ring-indigo-500 ring-inset":""} ${xe?"bg-indigo-50":""}`,children:[c.jsx("span",{className:`text-sm font-bold ${Pe?"text-indigo-600":et?"text-red-500":Vt?"text-red-400":"text-gray-700"}`,children:He.getDate()}),et?c.jsx("span",{className:"text-[8px] text-red-400 font-medium leading-tight truncate w-full text-center",children:et}):_t?c.jsx("span",{className:"text-[8px] text-gray-400 leading-tight truncate w-full text-center",children:_t.slice(-2)}):null,Ft>0&&c.jsx("span",{className:"absolute bottom-0.5 right-0.5 w-4 h-4 bg-amber-500 text-white text-[9px] font-bold rounded-full flex items-center justify-center",children:Ft>9?"9+":Ft})]},ee)})})()})]}),c.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-xl border border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ri,{size:18,className:"text-gray-500"}),c.jsx("span",{className:"text-sm font-medium text-gray-700",children:""})]}),c.jsx("button",{type:"button",onClick:()=>Oe(!ne),className:`w-12 h-7 rounded-full transition-all ${ne?"bg-indigo-600":"bg-gray-300"}`,children:c.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transition-transform ${ne?"translate-x-6":"translate-x-1"}`})})]}),!ne&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ri,{size:18,className:"text-gray-500"}),c.jsx("input",{type:"time",value:at,onChange:Y=>ae(Y.target.value),className:"flex-1 p-3 bg-white rounded-xl border border-gray-200 text-center"}),c.jsx(Nv,{size:16,className:"text-gray-400"}),c.jsx("input",{type:"time",value:_e,onChange:Y=>le(Y.target.value),className:"flex-1 p-3 bg-white rounded-xl border border-gray-200 text-center"})]}),c.jsxs("div",{className:"p-3 bg-white rounded-xl border border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(Wa,{size:18,className:"text-gray-500"}),c.jsx("span",{className:"text-sm font-medium text-gray-700",children:""})]}),c.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"",value:null},{label:"",value:0},{label:"5",value:5},{label:"15",value:15},{label:"30",value:30},{label:"1",value:60}].map(Y=>c.jsx("button",{type:"button",onClick:()=>{Le(Y.value),t&&(Y.value!==null?localStorage.setItem(`task_reminder_${t}`,JSON.stringify(Y.value)):localStorage.removeItem(`task_reminder_${t}`))},className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${Ce===Y.value?"bg-indigo-600 text-white":"bg-gray-100 text-gray-600"}`,children:Y.label},Y.label))})]}),M&&(()=>{const Y=M.split("T")[0],ze=s.filter(lt=>lt.id===t||!lt.start_date?!1:lt.start_date.split("T")[0]===Y).sort((lt,X)=>{const Fe=lt.start_time||(lt.is_all_day===!1&&lt.start_date?new Date(lt.start_date).toTimeString().slice(0,5):"99:99"),je=X.start_time||(X.is_all_day===!1&&X.start_date?new Date(X.start_date).toTimeString().slice(0,5):"99:99");return Fe.localeCompare(je)});return ze.length===0?null:c.jsxs("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-xl",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(vo,{size:14,className:"text-amber-600"}),c.jsxs("span",{className:"text-xs font-bold text-amber-700",children:[" ",ze.length," "]})]}),c.jsx("div",{className:"space-y-1.5 max-h-32 overflow-y-auto",children:ze.map(lt=>c.jsxs("div",{className:"flex items-center gap-2 text-xs text-amber-800 bg-white/60 rounded-lg px-2 py-1.5",children:[c.jsx("span",{className:"font-medium text-amber-600 w-12 flex-shrink-0",children:lt.is_all_day!==!1?"":lt.start_time||(lt.start_date?new Date(lt.start_date).toTimeString().slice(0,5):"--:--")}),c.jsx("span",{className:"truncate",children:lt.title})]},lt.id))})]})})()]}),Ve==="importance"&&c.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 mb-6 grid grid-cols-2 gap-3 animate-in slide-in-from-top-2",children:Object.keys(It).map(Y=>c.jsxs("button",{onClick:()=>W(Y),className:`flex items-center gap-2 p-3 rounded-xl border transition-all ${j===Y?"border-gray-400 bg-white shadow-sm":"border-transparent hover:bg-white/50"}`,children:[c.jsx("div",{className:`w-3 h-3 rounded-full ${It[Y].color}`}),c.jsx("span",{className:"text-sm font-bold text-gray-700",children:It[Y].label}),j===Y&&c.jsx(Xn,{size:16,className:"ml-auto text-gray-400"})]},Y))}),Ve==="repeat"&&c.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 mb-6 space-y-2 animate-in slide-in-from-top-2",children:[null,"daily","weekly","monthly"].map(Y=>c.jsxs("button",{onClick:()=>D(Y?{type:Y,interval:1}:null),className:`w-full flex items-center justify-between p-3 rounded-xl ${(V==null?void 0:V.type)===Y||!V&&!Y?"bg-white shadow-sm border border-gray-200":"hover:bg-white/50"}`,children:[c.jsx("span",{className:"text-sm font-medium text-gray-700",children:{null:"",daily:"",weekly:"",monthly:""}[Y]}),((V==null?void 0:V.type)===Y||!V&&!Y)&&c.jsx(Xn,{size:16,className:"text-blue-500"})]},Y||"none"))}),Ve==="tags"&&c.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 space-y-3 max-h-[40vh] overflow-y-auto mb-6 animate-in slide-in-from-top-2",children:i.map(Y=>{const ze=E.includes(Y.id);return c.jsxs("button",{onClick:()=>I(lt=>ze?lt.filter(X=>X!==Y.id):[...lt,Y.id]),className:`w-full flex items-center justify-between p-3 rounded-xl transition-all ${ze?"bg-white shadow-sm border border-purple-200":"bg-white border border-gray-200"}`,children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Y.color||"#6366f1"}}),c.jsx("span",{className:"text-sm font-medium",children:Y.name})]}),ze&&c.jsx(Xn,{size:18,className:"text-purple-600"})]},Y.id)})}),(F&&F.length>0||ge&&ge.length>0)&&c.jsxs("div",{className:"mb-6",children:[c.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 block",children:""}),c.jsxs("div",{className:"space-y-2",children:[ge.map((Y,ze)=>c.jsxs("div",{className:"relative group rounded-xl overflow-hidden border border-gray-200",children:[c.jsx("img",{src:Y,alt:"Attachment",className:"w-full h-32 object-cover"}),!r&&c.jsx("button",{onClick:()=>ye(Y,!0),className:"absolute top-2 right-2 p-1.5 bg-black/50 text-white rounded-full",children:c.jsx(un,{size:14})})]},Y+ze)),F.map((Y,ze)=>{var lt;return c.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl border border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[(lt=Y.type)!=null&&lt.startsWith("audio/")?c.jsx("button",{onClick:()=>Ge(Y.url),className:`p-2 rounded-full ${tt===Y.url?"bg-indigo-100 text-indigo-600":"bg-gray-200 text-gray-600"}`,children:tt===Y.url?c.jsx($I,{size:16}):c.jsx(zI,{size:16})}):c.jsx("div",{className:"p-2 bg-gray-200 rounded-lg text-gray-500",children:c.jsx(ho,{size:16})}),c.jsxs("div",{className:"flex flex-col overflow-hidden",children:[c.jsx("span",{className:"text-sm font-medium text-gray-700 truncate",children:Y.name}),c.jsxs("span",{className:"text-[10px] text-gray-400",children:[Math.round((Y.size||0)/1024)," KB"]})]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("a",{href:Y.url,download:!0,target:"_blank",rel:"noreferrer",className:"p-2 text-gray-400 hover:text-indigo-600",children:c.jsx(iu,{size:16})}),!r&&c.jsx("button",{onClick:()=>ye(Y.url,!1),className:"p-2 text-gray-400 hover:text-red-500",children:c.jsx(Er,{size:16})})]})]},Y.url+ze)})]})]}),c.jsxs("div",{className:"mb-6 min-h-[150px]",children:[c.jsx("div",{className:"flex items-center justify-between mb-2",children:c.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:""})}),c.jsx("div",{className:"bg-gray-50 rounded-xl px-1 py-1 focus-within:ring-2 focus-within:ring-indigo-100 border border-transparent",children:c.jsx(Zg,{ref:Re,initialContent:R||"",onChange:k,placeholder:r?"...":"...",className:"min-h-[120px]",availableTags:i.map(Y=>({...Y,parent_id:Y.parent_id||void 0})),onTagClick:()=>{},editable:!r})})]}),he&&c.jsxs("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center",onClick:()=>se(!1),children:[c.jsx("div",{className:"absolute inset-0 bg-black/40"}),c.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-[90%] max-w-sm max-h-[60vh] flex flex-col overflow-hidden",onClick:Y=>Y.stopPropagation(),children:[c.jsxs("div",{className:"p-4 border-b border-gray-100",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h3",{className:"font-bold text-gray-800",children:""}),c.jsx("button",{onClick:()=>se(!1),className:"p-1 text-gray-400 hover:text-gray-600",children:c.jsx(un,{size:20})})]}),c.jsxs("div",{className:"relative",children:[c.jsx(Hc,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),c.jsx("input",{type:"text",inputMode:"text",name:`tag_search_no_autofill_${Math.random()}`,autoComplete:"one-time-code",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",value:Q,onChange:Y=>ke(Y.target.value),placeholder:"...",className:"w-full pl-9 pr-4 py-2.5 bg-gray-100 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200 appearance-none",autoFocus:!0})]}),E.length>0&&c.jsxs("div",{className:"px-4 pb-3",children:[c.jsxs("div",{className:"text-xs text-gray-500 mb-2 font-medium",children:[" (",E.length,")"]}),c.jsx("div",{className:"flex flex-wrap gap-2",children:E.map(Y=>{const ze=i.find(lt=>lt.id===Y);return ze?c.jsxs("button",{type:"button",onClick:()=>I(lt=>lt.filter(X=>X!==Y)),className:"flex items-center gap-1.5 px-2.5 py-1.5 bg-purple-100 text-purple-700 rounded-lg text-xs font-medium hover:bg-purple-200 transition-colors",children:[c.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:ze.color||"#6366f1"}}),c.jsx("span",{children:ze.name}),c.jsx(un,{size:12,className:"ml-0.5"})]},Y):null})})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[Q.trim()&&!i.some(Y=>Y.name.toLowerCase()===Q.toLowerCase())&&c.jsx("div",{className:"mb-2 border-b border-gray-100 pb-2",children:qe?c.jsxs("div",{className:"p-3 bg-indigo-50 rounded-xl space-y-3",children:[c.jsxs("div",{className:"text-sm font-bold text-indigo-700",children:[": ",Q]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:" ()"}),c.jsxs("select",{value:Dt||"",onChange:Y=>oe(Y.target.value||null),className:"w-full p-2 bg-white border border-gray-200 rounded-lg text-sm",children:[c.jsx("option",{value:"",children:" ()"}),i.filter(Y=>!Y.parent_id).map(Y=>c.jsx("option",{value:Y.id,children:Y.name},Y.id))]})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{type:"button",onClick:()=>{xt(!1),oe(null)},className:"flex-1 py-2 text-sm font-medium text-gray-600 bg-gray-200 rounded-lg",children:""}),c.jsx("button",{type:"button",onClick:async()=>{if(!Q.trim())return;const Y=Q.trim();try{const ze=await l(Y,Dt);ze&&I(lt=>[...lt,ze]),f==null||f({msg:` "${Y}"`,type:"info"}),ke(""),xt(!1),oe(null)}catch(ze){console.error("Failed to create tag:",ze),f==null||f({msg:"",type:"error"})}},className:"flex-1 py-2 text-sm font-medium text-white bg-indigo-600 rounded-lg",children:""})]})]}):c.jsxs("button",{type:"button",onClick:()=>xt(!0),className:"w-full flex items-center gap-3 p-3 bg-indigo-50 hover:bg-indigo-100 rounded-xl transition-colors text-left",children:[c.jsx("div",{className:"w-5 h-5 rounded-full bg-indigo-500 flex items-center justify-center text-white text-xs font-bold",children:"+"}),c.jsxs("span",{className:"text-sm font-medium text-indigo-700",children:[' "',Q,'"']})]})}),i.filter(Y=>Y.name.toLowerCase().includes(Q.toLowerCase())).map(Y=>{var ze;return c.jsxs("button",{type:"button",onClick:()=>{const lt=E.includes(Y.id);I(lt?X=>X.filter(Fe=>Fe!==Y.id):X=>[...X,Y.id])},className:`w-full flex items-center gap-3 p-3 rounded-xl transition-colors text-left ${E.includes(Y.id)?"bg-purple-50 border-2 border-purple-300":"hover:bg-gray-50 border-2 border-transparent"}`,children:[c.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:Y.color||"#6366f1"}}),c.jsxs("div",{className:"flex flex-col flex-1",children:[c.jsx("span",{className:"text-sm font-medium text-gray-700",children:Y.name}),Y.parent_id&&c.jsx("span",{className:"text-[10px] text-gray-400",children:((ze=i.find(lt=>lt.id===Y.parent_id))==null?void 0:ze.name)||""})]}),E.includes(Y.id)&&c.jsx(Xn,{size:18,className:"text-purple-600 flex-shrink-0"})]},Y.id)}),i.filter(Y=>Y.name.toLowerCase().includes(Q.toLowerCase())).length===0&&!Q.trim()&&c.jsx("div",{className:"p-4 text-center text-gray-400 text-sm",children:""})]})]})]}),c.jsx("div",{className:"pt-4 border-t border-gray-100 pb-4",children:!r&&(Be?c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:()=>ht(!1),className:"flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-bold",children:""}),c.jsx("button",{onClick:ft,className:"flex-1 py-3 rounded-xl bg-red-500 text-white font-bold",children:""})]}):c.jsx("button",{onClick:()=>ht(!0),className:"w-full py-3 text-red-500 font-bold bg-red-50 rounded-xl",children:""}))})]}),!r&&c.jsxs("div",{className:"flex-shrink-0 border-t border-gray-100 p-3 bg-white/80 backdrop-blur-md pb-6 flex items-center justify-around",children:[c.jsx("input",{type:"file",ref:Se,accept:"image/*",className:"hidden",onChange:Y=>J(Y,!0)}),c.jsx("input",{type:"file",ref:ue,className:"hidden",onChange:Y=>J(Y,!1)}),c.jsxs("button",{onClick:()=>{var Y;return(Y=Se.current)==null?void 0:Y.click()},disabled:Z,className:"p-3 text-gray-500 active:bg-gray-100 rounded-full flex flex-col items-center gap-1",children:[c.jsx(vf,{size:24}),c.jsx("span",{className:"text-[10px]",children:""})]}),c.jsxs("button",{onClick:()=>{var Y;return(Y=ue.current)==null?void 0:Y.click()},disabled:Z,className:"p-3 text-gray-500 active:bg-gray-100 rounded-full flex flex-col items-center gap-1",children:[c.jsx(ho,{size:24}),c.jsx("span",{className:"text-[10px]",children:""})]}),c.jsx("button",{onClick:async()=>{if(p)b===t||!t&&!b?y():f==null||f({msg:"",type:"error"});else{if(!t){f==null||f({msg:"",type:"error"});return}try{await m(t),f==null||f({msg:"",type:"info"})}catch(Y){console.error("[MobileTaskEditor] Recording error:",Y),f==null||f({msg:"",type:"error"})}}},className:`p-4 rounded-full transition-all flex items-center justify-center -mt-8 shadow-lg ${p&&b===t?"bg-red-500 text-white scale-110":"bg-indigo-600 text-white active:scale-95"}`,children:p&&b===t?c.jsx("div",{className:"w-6 h-6 bg-white rounded-sm"}):c.jsx(LI,{size:24})}),c.jsxs("button",{onClick:()=>st(Ve==="importance"?null:"importance"),className:`p-3 rounded-full flex flex-col items-center gap-1 ${j!=="unplanned"?"text-rose-600":"text-gray-500 active:bg-gray-100"}`,children:[c.jsx(Jf,{size:24}),c.jsx("span",{className:"text-[10px]",children:It[j].label})]}),c.jsxs("button",{onClick:()=>st(Ve==="repeat"?null:"repeat"),className:`p-3 rounded-full flex flex-col items-center gap-1 ${V?"text-blue-600":"text-gray-500 active:bg-gray-100"}`,children:[c.jsx($z,{size:24}),c.jsx("span",{className:"text-[10px]",children:""})]})]})]})]});return ir.createPortal(kt,document.body)},xb=({onClose:t,initialData:e,isReadOnly:n=!1})=>{const r=!!e,[s,i]=Ln.useState(window.innerWidth<768),[o,a]=Ln.useState({});return Ln.useEffect(()=>{const l=()=>{const u=window.innerWidth<768;i(u),window.visualViewport&&a(u?{height:`${window.visualViewport.height}px`,top:`${window.visualViewport.offsetTop}px`,position:"fixed",bottom:"auto"}:{})};return window.addEventListener("resize",l),window.visualViewport&&(window.visualViewport.addEventListener("resize",l),window.visualViewport.addEventListener("scroll",l)),l(),()=>{window.removeEventListener("resize",l),window.visualViewport&&(window.visualViewport.removeEventListener("resize",l),window.visualViewport.removeEventListener("scroll",l))}},[]),s?c.jsx(yb,{taskId:(e==null?void 0:e.id)==="new"||e==null?void 0:e.id,initialData:e,onClose:t,isReadOnly:n}):c.jsx("div",{className:"fixed inset-0 z-[60] flex items-end md:items-center justify-center pointer-events-auto bg-black/20 md:bg-transparent",onClick:t,style:o,children:c.jsxs(Pr.div,{onClick:l=>l.stopPropagation(),drag:window.innerWidth>=768,dragMomentum:!1,dragElastic:.1,initial:{opacity:0,scale:.95,y:50},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:50},transition:{type:"spring",stiffness:300,damping:30},className:"bg-theme-card backdrop-blur-xl rounded-t-2xl md:rounded-2xl shadow-2xl w-full md:max-w-[600px] overflow-visible border border-theme ring-1 ring-black/5 flex flex-col max-h-[90vh] md:max-h-none",children:[c.jsx("div",{className:"md:hidden flex justify-center pt-2 pb-1",children:c.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full"})}),c.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-theme-header border-b border-theme cursor-grab active:cursor-grabbing backdrop-blur-sm select-none md:rounded-t-2xl",onPointerDown:l=>l.preventDefault(),children:[c.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[c.jsx(MI,{size:14,className:"text-gray-300 hidden md:block"}),c.jsx("span",{className:"text-xs md:text-[10px] font-bold uppercase tracking-widest text-theme-tertiary",children:n?"View Task":r?"Edit Task":"New Task"})]}),c.jsxs("button",{onClick:t,className:"w-8 h-8 md:w-7 md:h-7 flex items-center justify-center hover:bg-gray-200/80 rounded-full text-gray-400 hover:text-gray-600 transition-colors bg-gray-100/50",onPointerDown:l=>l.stopPropagation(),children:[c.jsx(un,{size:16,className:"md:hidden"}),c.jsx(un,{size:14,className:"hidden md:block"})]})]}),c.jsx("div",{className:"p-0 overflow-auto",children:c.jsx(Po,{initialData:e,onClose:t,isQuickAdd:!r,autoFocus:!r&&!n,isEmbedded:!0,isReadOnly:n})})]})})},Xh=({title:t,importance:e,tasks:n,onDrop:r,onAddTask:s,setEditingTaskId:i,bgColor:o,borderColor:a,titleColor:l,infoText:u})=>{const{updateGhostPosition:d,endDrag:f}=x.useContext(En),[h,p]=x.useState(!1),m=v=>{v.preventDefault(),p(!0),d(v.clientX,v.clientY)},y=()=>{p(!1)},b=v=>{v.preventDefault(),p(!1);const w=v.clientY,T=Array.from(v.currentTarget.querySelectorAll("[data-task-id]"));let R=null,k=Number.POSITIVE_INFINITY;T.forEach((S,C)=>{const _=S.getBoundingClientRect(),E=w-(_.top+_.height/2);Math.abs(E)<Math.abs(k)&&(k=E,R={element:S,offset:E,index:C})});let M;if(R){const S=R.index,C=n[S];if(C)if(R.offset<0){const _=n[S-1];_?M=((_.order_index||0)+(C.order_index||0))/2:M=(C.order_index||0)-1e4}else{const _=n[S+1];_?M=((C.order_index||0)+(_.order_index||0))/2:M=(C.order_index||0)+1e4}}else n.length>0?M=(n[n.length-1].order_index||0)+1e4:M=void 0;r(v,e,M)},g=()=>{p(!1),f()};return c.jsxs("div",{className:`flex flex-col h-full rounded-xl border-2 transition-all p-3 overflow-hidden ${h?"bg-indigo-50 border-indigo-400 scale-[1.01]":`${o} ${a}`}`,onDragOver:m,onDragLeave:y,onDrop:b,onDragEnd:g,children:[c.jsxs("div",{className:"flex justify-between items-center mb-3 flex-shrink-0",children:[c.jsxs("div",{className:"flex flex-col",children:[c.jsx("h3",{className:`font-bold text-lg ${l}`,children:t}),u&&c.jsx("span",{className:"text-[10px] text-gray-400 font-medium",children:u})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-xs font-medium text-gray-400 bg-white/50 px-2 py-0.5 rounded-full",children:n.length}),c.jsx("button",{onClick:()=>s(e),className:`p-1 rounded-full hover:bg-black/5 transition-colors ${l}`,children:c.jsx(ni,{size:16})})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar space-y-2 pr-1 pb-10",children:[n.map((v,w)=>c.jsx("div",{children:c.jsx(xl,{flatTask:{data:v,depth:0,hasChildren:!1,isExpanded:!1,path:[v.id],index:w},isFocused:!1,onEdit:()=>i(v.id)})},v.id)),n.length===0&&c.jsxs("div",{className:"h-full flex flex-col items-center justify-center opacity-30 text-center",children:[c.jsx("div",{className:`p-4 rounded-full bg-current mb-2 opacity-10 ${l}`,children:c.jsx(OI,{size:24})}),c.jsx("span",{className:`text-sm font-medium ${l}`,children:""})]})]})]})},ste=()=>{const{tasks:t,tags:e,viewTagFilters:n,updateTask:r,addTask:s,setEditingTaskId:i,setPendingFocusTaskId:o,endDrag:a}=x.useContext(En),l=x.useMemo(()=>{var b;const h=(b=e.find(g=>["schedule",""].includes(g.name.trim().toLowerCase())))==null?void 0:b.id,p=n.matrix||{include:[],exclude:[]},{include:m,exclude:y}=Array.isArray(p)?{include:p,exclude:[]}:p;return t.filter(g=>!(g.status==="deleted"||g.status==="logged"||g.status==="completed"||g.parent_id||h&&g.tags.includes(h)||g.tags.some(w=>{const T=e.find(R=>R.id===w);return T&&["schedule",""].includes(T.name.trim().toLowerCase())})||m.length>0&&!g.tags.some(w=>m.includes(w))||y.length>0&&g.tags.some(w=>y.includes(w))))},[t,e,n]),u={urgent:l.filter(h=>h.importance==="urgent"),planned:l.filter(h=>h.importance==="planned"),delegated:l.filter(h=>h.importance==="delegated"),unplanned:l.filter(h=>!h.importance||h.importance==="unplanned"||h.importance==="optional")},d=async(h,p,m)=>{const y=h.dataTransfer.getData("text/plain");if(y){const b={importance:p};m!==void 0&&(b.order_index=m),await r(y,b),await a()}},f=async h=>{const p=await s({title:"",importance:h,status:"inbox"});p&&o(p)};return c.jsxs("div",{className:"h-full p-6 flex flex-col overflow-hidden bg-white",children:[c.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[c.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[c.jsx(OI,{className:"text-indigo-600"}),"Eisenhower Matrix"]}),c.jsx("div",{className:"text-xs text-gray-400 font-medium bg-gray-100 px-3 py-1 rounded-full",children:"Shift+Alt inside tasks to move"})]}),c.jsxs("div",{className:"flex-1 grid grid-cols-2 grid-rows-2 gap-4 min-h-0",children:[c.jsx(Xh,{title:" (Do Now)",infoText:"Urgent & Important",importance:"urgent",tasks:u.urgent,onDrop:d,onAddTask:f,setEditingTaskId:i,bgColor:"bg-red-50/50",borderColor:"border-red-100",titleColor:"text-red-600"}),c.jsx(Xh,{title:" (Plan)",infoText:"Not Urgent but Important",importance:"planned",tasks:u.planned,onDrop:d,onAddTask:f,setEditingTaskId:i,bgColor:"bg-amber-50/50",borderColor:"border-amber-100",titleColor:"text-amber-600"}),c.jsx(Xh,{title:" (Delegate)",infoText:"Urgent but Not Important",importance:"delegated",tasks:u.delegated,onDrop:d,onAddTask:f,setEditingTaskId:i,bgColor:"bg-green-50/50",borderColor:"border-green-100",titleColor:"text-green-600"}),c.jsx(Xh,{title:" (Unplanned)",infoText:"Neither Urgent nor Important",importance:"unplanned",tasks:u.unplanned,onDrop:d,onAddTask:f,setEditingTaskId:i,bgColor:"bg-gray-50/50",borderColor:"border-gray-200",titleColor:"text-gray-500"})]})]})},ite=()=>{const{user:t,setToast:e}=x.useContext(En),[n,r]=x.useState(()=>{const _=localStorage.getItem(`work_logs_${t==null?void 0:t.id}`);return _?JSON.parse(_):[]}),[s,i]=x.useState(()=>new Date().toISOString().split("T")[0]),[o,a]=x.useState(!1),[l,u]=x.useState(""),[d,f]=x.useState(!1),h=_=>{localStorage.setItem(`work_logs_${t==null?void 0:t.id}`,JSON.stringify(_)),r(_)},p=x.useMemo(()=>n.find(_=>_.date===s),[n,s]),m=()=>{const _=new Date(s);_.setDate(_.getDate()-1),i(_.toISOString().split("T")[0])},y=()=>{const _=new Date(s);_.setDate(_.getDate()+1),i(_.toISOString().split("T")[0])},b=()=>{i(new Date().toISOString().split("T")[0])},g=_=>{const E=new Date(_),I=["","","","","","",""],P=E.getFullYear(),O=E.getMonth()+1,$=E.getDate(),A=I[E.getDay()];return`${P}${O}${$}${A}`},v=()=>`## ${g(s)}

### 

#### [/]
1. []
2. []

#### [/]
1. []
2. []

### 

|  |  |  |  |
|-------|------|------|------|
| 1 | [] | [] |  |
| 2 | [] | [] |  |

### 
- []
`,w=()=>{const _=v(),E={id:crypto.randomUUID(),date:s,content:_,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};h([...n,E]),u(_),a(!0)},T=()=>{u((p==null?void 0:p.content)||""),a(!0)},R=()=>{if(p){const _=n.map(E=>E.id===p.id?{...E,content:l,updated_at:new Date().toISOString()}:E);h(_)}a(!1),e==null||e({msg:"",type:"info"})},k=()=>{if(p&&confirm("")){const _=n.filter(E=>E.id!==p.id);h(_),a(!1),e==null||e({msg:"",type:"info"})}},M=async()=>{const E=((p==null?void 0:p.content)||"").replace(/^## /gm,"").replace(/^### /gm,"").replace(/^#### /gm,"").replace(/\*\*/g,"").replace(/\|/g,"	").replace(/-{3,}/g,"");try{await navigator.clipboard.writeText(E),f(!0),setTimeout(()=>f(!1),2e3),e==null||e({msg:"",type:"info"})}catch{e==null||e({msg:"",type:"error"})}},S=_=>_.split(`
`).map((E,I)=>{if(E.startsWith("## "))return c.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4 mt-6 first:mt-0",children:E.slice(3)},I);if(E.startsWith("### "))return c.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-3 mt-5",children:E.slice(4)},I);if(E.startsWith("#### "))return c.jsx("h4",{className:"text-base font-semibold text-gray-600 mb-2 mt-4",children:E.slice(5)},I);if(E.startsWith("| ")){const P=E.split("|").filter($=>$.trim());return E.includes("---")?null:c.jsx("div",{className:"grid grid-cols-4 gap-2 px-2 py-1 text-sm border-b border-gray-100",children:P.map(($,A)=>c.jsx("span",{className:A===0?"font-medium":"text-gray-600",children:$.trim()},A))},I)}return E.match(/^\d+\. /)?c.jsx("p",{className:"text-sm text-gray-700 ml-6 mb-1",children:E},I):E.startsWith("- ")?c.jsxs("p",{className:"text-sm text-gray-700 ml-4 mb-1",children:[" ",E.slice(2)]},I):E.trim()===""?c.jsx("div",{className:"h-2"},I):c.jsx("p",{className:"text-sm text-gray-700 mb-1",children:E},I)}),C=s===new Date().toISOString().split("T")[0];return c.jsxs("div",{className:"h-full flex flex-col bg-white overflow-hidden",children:[c.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-white z-10",children:[c.jsx("div",{className:"flex items-center gap-4",children:c.jsxs("h2",{className:"font-bold text-gray-700 flex items-center gap-2",children:[c.jsx(xf,{size:18}),""]})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:m,className:"p-1.5 rounded hover:bg-gray-100 text-gray-500",children:c.jsx(Ou,{size:18})}),c.jsx("span",{className:"font-medium text-gray-700 min-w-[180px] text-center",children:g(s)}),c.jsx("button",{onClick:y,className:"p-1.5 rounded hover:bg-gray-100 text-gray-500",children:c.jsx(rs,{size:18})}),!C&&c.jsx("button",{onClick:b,className:"ml-2 px-2 py-1 text-xs bg-indigo-50 text-indigo-600 rounded hover:bg-indigo-100",children:""})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[p&&!o&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:M,className:"flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[d?c.jsx(Xn,{size:14}):c.jsx(NI,{size:14}),d?"":""]}),c.jsxs("button",{onClick:T,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 text-sm font-medium transition-colors",children:[c.jsx(Mg,{size:14}),""]}),c.jsx("button",{onClick:k,className:"flex items-center gap-1 px-3 py-1.5 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 text-sm font-medium transition-colors",children:c.jsx(Er,{size:14})})]}),o&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:()=>a(!1),className:"flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[c.jsx(un,{size:14}),""]}),c.jsxs("button",{onClick:R,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors",children:[c.jsx(UI,{size:14}),""]})]}),!p&&!o&&c.jsxs("button",{onClick:w,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors shadow-sm",children:[c.jsx(ni,{size:16}),""]})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-gray-50/50",children:o?c.jsx("div",{className:"max-w-3xl mx-auto",children:c.jsx("textarea",{value:l,onChange:_=>u(_.target.value),className:"w-full h-[calc(100vh-200px)] p-4 bg-white rounded-xl border border-gray-200 focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none font-mono text-sm resize-none",placeholder:"..."})}):p?c.jsx("div",{className:"max-w-3xl mx-auto bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:S(p.content)}):c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx(xf,{size:48,className:"mb-4 opacity-20"}),c.jsx("p",{className:"text-sm",children:""}),c.jsxs("button",{onClick:w,className:"mt-4 flex items-center gap-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors",children:[c.jsx(ni,{size:16}),""]})]})})]})},ote=({task:t,position:e,count:n})=>{const r=x.useRef(null);if(x.useLayoutEffect(()=>{e&&r.current&&(r.current.style.left=`${e.x}px`,r.current.style.top=`${e.y}px`)},[]),!e)return null;const s=c.jsxs("div",{ref:r,id:"drag-ghost",className:"fixed pointer-events-none rounded-lg border-2 border-indigo-500/50 p-3 w-64 flex items-center gap-3",style:{transform:"translate(16px, 16px) rotate(2deg)",zIndex:99999,backgroundColor:"#ffffff",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",opacity:1,isolation:"isolate"},children:[c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h4",{className:"font-medium text-sm text-gray-900 dark:text-gray-100 truncate",children:t.title||"()"}),n>1&&c.jsxs("p",{className:"text-xs text-indigo-500 font-medium",children:["+ ",n-1," "]})]}),c.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-pulse"})]});return ir.createPortal(s,document.body)},ate=t=>{switch(t){case"inbox":return"";case"waiting":return"";case"active":return"";case"someday":return"/";case"reference":return"";case"completed":return"";case"archived":return"";case"logged":return"";default:return t}},lte=({onClose:t})=>{const{tasks:e,selectedTaskIds:n,updateTask:r,setToast:s,tags:i}=x.useContext(En),[o,a]=x.useState(""),[l,u]=x.useState(0),d=x.useRef(null);x.useEffect(()=>{d.current&&d.current.focus()},[]),x.useEffect(()=>{u(0)},[o]);const f=y=>{y.key==="Escape"&&t()};x.useEffect(()=>(window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)),[]);const h=x.useMemo(()=>{if(!o.trim())return[];const y=o.toLowerCase();return e.filter(b=>{if(b.status==="deleted"||b.status==="archived"||b.status==="logged"||!b.title.toLowerCase().includes(y)||n.includes(b.id))return!1;for(const g of n)if(Ev(g,b.id,e))return!1;return!0}).slice(0,10)},[e,o,n]),p=async y=>{const b=e.find(g=>g.id===y);if(b)try{await Promise.all(n.map(g=>r(g,{parent_id:y}))),s({type:"success",msg:` ${n.length}  "${b.title}" `}),t()}catch(g){console.error(g),s({type:"error",msg:""})}},m=y=>{y.key==="ArrowDown"?(y.preventDefault(),u(b=>(b+1)%h.length)):y.key==="ArrowUp"?(y.preventDefault(),u(b=>(b-1+h.length)%h.length)):y.key==="Enter"&&(y.preventDefault(),h.length>0&&p(h[l].id))};return ir.createPortal(c.jsx(bo,{children:c.jsx(Pr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-[99999] flex items-start justify-center pt-[20vh]",onClick:t,children:c.jsxs(Pr.div,{initial:{opacity:0,scale:.95,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20},transition:{duration:.15},className:"w-full max-w-xl bg-white rounded-xl shadow-2xl overflow-hidden border border-gray-200",onClick:y=>y.stopPropagation(),children:[c.jsxs("div",{className:"p-3 border-b border-gray-100 flex items-center gap-3",children:[c.jsx(fz,{className:"text-gray-400",size:20}),c.jsx("input",{ref:d,type:"text",value:o,onChange:y=>a(y.target.value),onKeyDown:m,placeholder:` ${n.length} ...`,className:"flex-1 bg-transparent border-none outline-none text-base text-gray-800 placeholder:text-gray-400"}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-500 px-1.5 py-0.5 rounded border border-gray-200",children:"ESC"})})]}),c.jsxs("div",{className:"max-h-[300px] overflow-y-auto",children:[h.length===0&&o.trim()!==""&&c.jsx("div",{className:"p-8 text-center text-gray-400 text-sm",children:""}),h.length===0&&o.trim()===""&&c.jsx("div",{className:"p-8 text-center text-gray-400 text-sm",children:"..."}),h.map((y,b)=>{var v;const g=b===l;return c.jsxs("button",{onClick:()=>p(y.id),onMouseEnter:()=>u(b),className:`w-full text-left p-3 flex items-center gap-3 transition-colors ${g?"bg-indigo-50":"hover:bg-gray-50"}`,children:[c.jsx("div",{className:`w-1 h-8 rounded-full ${g?"bg-indigo-500":"bg-transparent"}`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:`font-medium truncate ${g?"text-indigo-900":"text-gray-700"}`,children:y.title}),c.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1.5 text-xs",children:[c.jsx("span",{className:"px-1.5 py-0.5 rounded-md bg-gray-100 border border-gray-200 text-gray-500 font-medium",children:ate(y.status)}),y.parent_id?c.jsxs("span",{className:"flex items-center gap-1 text-indigo-600 bg-indigo-50 border border-indigo-100 px-1.5 py-0.5 rounded-md",children:[c.jsx(jI,{size:10}),c.jsx("span",{className:"max-w-[100px] truncate",children:((v=e.find(w=>w.id===y.parent_id))==null?void 0:v.title)||""})]}):c.jsx("span",{className:"text-gray-400 border border-gray-200 px-1.5 py-0.5 rounded-md",children:""}),y.tags&&y.tags.length>0&&c.jsx("div",{className:"flex gap-1 items-center",children:y.tags.map(w=>{const T=i.find(R=>R.id===w);return T?c.jsxs("span",{className:"px-1.5 py-0.5 rounded-md border text-[10px]",style:{backgroundColor:`${T.color}15`,borderColor:`${T.color}30`,color:T.color},children:["#",T.name]},w):null})})]})]}),g&&c.jsx("span",{className:"text-[10px] text-indigo-400 font-medium px-2 flex-shrink-0",children:"Enter "})]},y.id)})]})]})})}),document.body)},cte={gray:"bg-gray-400",blue:"bg-blue-500",indigo:"bg-indigo-500",red:"bg-red-500",orange:"bg-orange-500",amber:"bg-amber-500",green:"bg-green-500",teal:"bg-teal-500",cyan:"bg-cyan-500",sky:"bg-sky-500",purple:"bg-purple-500",fuchsia:"bg-fuchsia-500",pink:"bg-pink-500",rose:"bg-rose-500"},ute=[{label:"5 ",minutes:5},{label:"30 ",minutes:30},{label:"1 ",minutes:60},{label:"2 ",minutes:120}],dte=({reminder:t,onSnooze:e,onMarkSeen:n,onSelect:r,onEdit:s})=>{const[i,o]=x.useState(!1),[a,l]=x.useState(""),[u,d]=x.useState({top:0,left:0}),[f,h]=x.useState(null),p=x.useRef(null),m=x.useRef(null);x.useEffect(()=>{if(!t.snoozed_until){h(null);return}const w=()=>{const R=Date.now(),M=new Date(t.snoozed_until).getTime()-R;if(M<=0){h(null);return}const S=Math.floor(M/1e3),C=Math.floor(S/60),_=Math.floor(C/60);_>0?h(`${_}${C%60}`):C>0?h(`${C}${S%60}`):h(`${S}`)};w();const T=setInterval(w,1e3);return()=>clearInterval(T)},[t.snoozed_until]);const y=()=>{p.current?(clearTimeout(p.current),p.current=null,s()):p.current=setTimeout(()=>{p.current=null,r()},250)},b=w=>{const T=new Date(w),k=new Date().getTime()-T.getTime(),M=Math.floor(k/6e4),S=Math.floor(k/36e5),C=Math.floor(k/864e5);return M<1?"":M<60?`${M} `:S<24?`${S} `:`${C} `},g=w=>new Date(w).toLocaleString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),v=()=>{const w=parseInt(a);w>0&&(e(w),o(!1),l(""))};return c.jsx("div",{className:`p-3 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer ${t.seen?"opacity-60":""}`,onClick:y,children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("div",{className:`w-2 h-2 mt-2 rounded-full ${cte[t.task_color]} flex-shrink-0`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:"font-medium text-gray-800 truncate",children:t.task_title}),c.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500 flex-wrap",children:[c.jsx(Ri,{size:10}),c.jsxs("span",{children:["",g(t.due_time)]}),c.jsx("span",{className:"text-gray-300",children:""}),c.jsx("span",{children:b(t.triggered_at)}),f&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"text-gray-300",children:""}),c.jsxs("span",{className:"text-orange-500 font-medium",children:[" ",f]})]})]})]}),c.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",onClick:w=>w.stopPropagation(),children:[c.jsx("button",{onClick:n,className:`p-1.5 rounded-lg transition-colors ${t.seen?"bg-green-100 text-green-600":"hover:bg-gray-100 text-gray-400 hover:text-green-600"}`,title:t.seen?"":"",children:t.seen?c.jsx(Xn,{size:14}):c.jsx(pz,{size:14})}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{ref:m,onClick:()=>{if(!i&&m.current){const w=m.current.getBoundingClientRect();d({top:w.bottom+4,left:w.right-160})}o(!i)},className:"p-1.5 rounded-lg hover:bg-gray-100 text-gray-400 hover:text-orange-500 transition-colors flex items-center gap-0.5",title:"",children:[c.jsx(Wa,{size:14}),c.jsx(ts,{size:10})]}),i&&ir.createPortal(c.jsxs("div",{className:"fixed w-40 bg-white rounded-lg shadow-xl border border-gray-200 z-[10001] overflow-hidden",style:{top:u.top,left:u.left},"data-snooze-menu":"true",children:[ute.map(w=>c.jsxs("button",{onClick:()=>{e(w.minutes),o(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-orange-50 text-gray-700 hover:text-orange-600 transition-colors",children:[w.label,""]},w.minutes)),c.jsx("div",{className:"border-t border-gray-100 p-2",children:c.jsxs("div",{className:"flex gap-1",children:[c.jsx("input",{type:"number",value:a,onChange:w=>l(w.target.value),placeholder:"",className:"flex-1 px-2 py-1 text-xs border rounded w-16",min:1}),c.jsx("span",{className:"text-xs text-gray-500 self-center",children:""}),c.jsx("button",{onClick:v,className:"px-2 py-1 text-xs bg-orange-500 text-white rounded hover:bg-orange-600",children:""})]})})]}),document.body)]})]})]})})},fte=()=>{const{reminders:t,markAsSeen:e,snoozeReminder:n,clearAllSeen:r,clearAllUnseen:s,clearAll:i,unseenCount:o,isReminderPanelOpen:a,setIsReminderPanelOpen:l}=x.useContext(_I),{setFocusedTaskId:u,setSelectedTaskIds:d,navigateToTask:f}=x.useContext(En),h=x.useRef(null);x.useEffect(()=>{const b=g=>{const v=g.target;if(h.current&&h.current.contains(v))return;const w=document.querySelector('[data-snooze-menu="true"]');w&&w.contains(v)||l(!1)};return a&&document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[a,l]);const p=b=>{u(b),d([b]),f(b,!1,"allview"),l(!1),setTimeout(()=>{const g=document.querySelector(`[data-task-id="${b}"]`);g&&g.scrollIntoView({behavior:"smooth",block:"center"})},300)},m=b=>{f(b,!0,"allview"),l(!1)},y=[...t].sort((b,g)=>b.seen!==g.seen?b.seen?1:-1:new Date(g.triggered_at).getTime()-new Date(b.triggered_at).getTime());return c.jsxs("div",{className:"relative",ref:h,children:[c.jsx("button",{onClick:()=>l(!a),className:`p-1.5 rounded-lg transition-colors ${a?"bg-orange-100 text-orange-600":"hover:bg-gray-100 text-gray-500 hover:text-orange-500"}`,title:"",children:c.jsxs("div",{className:"relative",children:[c.jsx(Wa,{size:18}),o>0&&c.jsx("span",{className:"absolute -top-1.5 -right-1.5 w-3.5 h-3.5 bg-red-500 text-white text-[9px] font-bold rounded-full flex items-center justify-center animate-pulse ring-2 ring-white",children:o>9?"9+":o})]})}),c.jsx(bo,{children:a&&c.jsxs(Pr.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15},className:"absolute right-0 top-full mt-2 w-80 md:w-96 bg-white rounded-xl shadow-2xl border border-gray-200 z-[9999] overflow-hidden",children:[c.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 flex items-center justify-between bg-gradient-to-r from-orange-50 to-amber-50",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Wa,{size:16,className:"text-orange-500"}),c.jsx("span",{className:"font-bold text-gray-800",children:""}),o>0&&c.jsxs("span",{className:"px-1.5 py-0.5 bg-red-500 text-white text-[10px] font-bold rounded-full",children:[o," "]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[o>0&&c.jsx("button",{onClick:s,className:"px-2 py-1 rounded-lg text-[10px] font-bold bg-red-100 text-red-600 hover:bg-red-200 transition-colors",title:"",children:""}),t.some(b=>b.seen)&&c.jsx("button",{onClick:r,className:"p-1.5 rounded-lg hover:bg-white/50 text-gray-400 hover:text-red-500 transition-colors",title:"",children:c.jsx(Er,{size:14})}),t.length>0&&c.jsx("button",{onClick:i,className:"p-1.5 rounded-lg hover:bg-white/50 text-gray-400 hover:text-red-500 transition-colors",title:"",children:c.jsx(un,{size:14})})]})]}),c.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:y.length===0?c.jsxs("div",{className:"py-12 text-center text-gray-400",children:[c.jsx(t1,{size:32,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{className:"text-sm",children:""})]}):y.map(b=>c.jsx(dte,{reminder:b,onSnooze:g=>n(b.id,g),onMarkSeen:()=>e(b.id),onSelect:()=>p(b.task_id),onEdit:()=>m(b.task_id)},b.id))}),c.jsx("div",{className:"px-4 py-2 border-t border-gray-100 bg-gray-50 text-[10px] text-gray-400",children:c.jsx("span",{children:"  "})})]})})]})},hte={capture:{label:"",icon:"",color:"bg-gray-100 text-gray-600"},clarify:{label:"",icon:"",color:"bg-yellow-100 text-yellow-600"},organize:{label:"",icon:"",color:"bg-blue-100 text-blue-600"},engage:{label:"",icon:"",color:"bg-green-100 text-green-600"}},pte=({taskId:t,onClose:e})=>{const{tasks:n,tags:r,updateTask:s,batchAddTasks:i}=x.useContext(En),[o,a]=x.useState(""),[l,u]=x.useState([]),[d,f]=x.useState(!1),h=x.useRef(null),p=x.useRef(!1),[m,y]=x.useState("capture"),[b,g]=x.useState([]),v=n.find(_=>_.id===t),w=()=>{setTimeout(()=>{var _;(_=h.current)==null||_.scrollIntoView({behavior:"smooth"})},100)};x.useEffect(()=>{w()},[l,b]),x.useEffect(()=>{if(v&&!p.current)if(p.current=!0,v.ai_history&&v.ai_history.length>0){const _=v.ai_history.map(E=>({id:E.id,role:E.role,content:E.content,timestamp:new Date(E.created_at).getTime()}));_.sort((E,I)=>E.timestamp-I.timestamp),u(_)}else R("",!0)},[v]);const T=async _=>{if(!v)return;const E={id:_.id,role:_.role,content:_.content,created_at:new Date(_.timestamp).toISOString()},I=v.ai_history||[];I.some(P=>P.id===_.id)||await s(v.id,{ai_history:[...I,E]},void 0,{skipHistory:!0})},R=async(_,E=!1)=>{if(!v||!_.trim()&&!E)return;g([]);let I=null;E||(I={id:crypto.randomUUID(),role:"user",content:_,timestamp:Date.now()},u(P=>[...P,I]),T(I),a("")),f(!0);try{const P=v.parent_id?n.find(me=>me.id===v.parent_id):null,O=v.tags.map(me=>{var F;return((F=r.find(U=>U.id===me))==null?void 0:F.name)||me}),$={title:v.title,description:v.description||"",status:v.status,created_at:v.created_at,due_date:v.due_date,start_date:v.start_date,tags:O,project_title:P==null?void 0:P.title},A=new Date,j=new Date;j.setDate(A.getDate()+14);const W=n.filter(me=>{if(me.status==="completed"||me.status==="deleted")return!1;const F=me.start_date||me.due_date;if(!F)return!1;const U=new Date(F);return U>=A&&U<=j}).sort((me,F)=>(me.start_date||me.due_date||"").localeCompare(F.start_date||F.due_date||"")).map(me=>{var F,U;return`[${((F=me.start_date)==null?void 0:F.split("T")[0])||((U=me.due_date)==null?void 0:U.split("T")[0])}] ${me.title}`}).slice(0,30),V=l.filter(me=>me.role!=="system").map(me=>({role:me.role,content:me.content}));I&&V.push({role:"user",content:I.content});const D=await $Y($,W,E?" GTD ":_,V);D.current_stage&&y(D.current_stage),D.actions&&D.actions.length>0&&g(D.actions);const ge={id:crypto.randomUUID(),role:"assistant",content:D.reply,timestamp:Date.now()};u(me=>[...me,ge]),T(ge)}catch(P){console.error(P);const O={id:crypto.randomUUID(),role:"assistant",content:"",timestamp:Date.now()};u($=>[...$,O])}finally{f(!1)}},k=async()=>{if(!v)return;const _=[];try{for(const E of b)if(E.type==="update_task"){const I={};if(E.params.title&&(I.title=E.params.title),E.params.description&&(I.description=E.params.description),E.params.due_date&&(I.due_date=E.params.due_date),E.params.start_date&&(I.start_date=E.params.start_date),E.params.start_time&&(I.start_time=E.params.start_time),E.params.reminder_minutes!==void 0&&(I.reminder_minutes=E.params.reminder_minutes),E.params.tags&&E.params.tags.length>0){const P=E.params.tags.map(O=>{const $=r.find(A=>A.name.toLowerCase()===O.toLowerCase());return $?$.id:null}).filter(Boolean);P.length>0&&(I.tags=P)}Object.keys(I).length>0&&(await s(v.id,I),_.push(""))}else E.type==="add_subtasks"&&E.params.tasks&&E.params.tasks.length>0&&(await i(E.params.tasks.map(I=>({...I,status:"todo",start_date:I.start_date,start_time:I.start_time,reminder_minutes:I.reminder_minutes,due_date:I.due_date})),v.id),_.push(` ${E.params.tasks.length} `));if(_.length>0){const E={id:crypto.randomUUID(),role:"system",content:_.map(I=>` ${I}`).join(`
`),timestamp:Date.now()};u(I=>[...I,E]),T(E)}g([])}catch(E){console.error("Action execution failed:",E),alert("")}},M=(_,E,I,P)=>{g(O=>{const $=[...O],A={...$[_]};if(A.type==="update_task")A.params={...A.params,[E]:I};else if(A.type==="add_subtasks"&&typeof P=="number"){const j=[...A.params.tasks];j[P]={...j[P],[E]:I},A.params={...A.params,tasks:j}}return $[_]=A,$})},S=_=>{g(E=>E.filter((I,P)=>P!==_))},C=(_,E)=>{g(I=>{const P=[...I],O=P[_];if(O.type==="add_subtasks"){const $=[...O.params.tasks];if($.splice(E,1),$.length===0)return I.filter((A,j)=>j!==_);P[_]={...O,params:{...O.params,tasks:$}}}return P})};return v?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md h-[700px] flex flex-col animate-in slide-in-from-bottom-5 duration-200 overflow-hidden border border-indigo-100 font-sans",children:[c.jsxs("div",{className:"px-4 py-3 border-b bg-gradient-to-r from-indigo-50 to-white",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600",children:c.jsx(As,{size:16})}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-sm font-bold text-gray-900",children:"GTD "}),c.jsx("p",{className:"text-xs text-indigo-600 flex items-center gap-1",children:v.title.length>10?v.title.slice(0,10)+"...":v.title})]})]}),c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 p-1.5 rounded-full transition-colors",children:c.jsx(un,{size:18})})]}),c.jsxs("div",{className:"flex justify-between items-center px-2 py-1 bg-gray-50 rounded-lg relative overflow-hidden",children:[Object.entries(hte).map(([_,E],I)=>{const P=m===_;return c.jsxs("div",{className:`flex flex-col items-center z-10 transition-all duration-300 ${P?"scale-110 opacity-100":"opacity-40 scale-90"}`,children:[c.jsx("span",{className:"text-base mb-0.5",children:E.icon}),c.jsx("span",{className:`text-[10px] font-bold ${P?"text-indigo-600":"text-gray-500"}`,children:E.label})]},_)}),c.jsx("div",{className:"absolute top-1/2 left-0 w-full h-0.5 bg-gray-200 -z-0 transform -translate-y-1/2"})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50/50 space-y-4",children:[l.map(_=>c.jsxs("div",{className:`flex gap-3 ${_.role==="user"?"flex-row-reverse":""}`,children:[c.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${_.role==="user"?"bg-gray-200":_.role==="system"?"bg-green-100 text-green-600":"bg-indigo-600 text-white"}`,children:_.role==="user"?c.jsx(KI,{size:14,className:"text-gray-600"}):_.role==="system"?c.jsx(bf,{size:14}):c.jsx(sz,{size:14})}),c.jsxs("div",{className:`max-w-[90%] rounded-2xl px-4 py-2.5 text-sm shadow-sm ${_.role==="user"?"bg-white text-gray-800 border border-gray-100 rounded-tr-none":_.role==="system"?"bg-green-50 text-green-800 border border-green-100":"bg-white text-gray-800 border border-indigo-100 rounded-tl-none"}`,children:[c.jsx("div",{className:"prose prose-sm prose-indigo max-w-none",children:c.jsx(ok,{children:_.content})}),c.jsx("span",{className:"text-[10px] text-gray-400 mt-1 block text-right",children:new Date(_.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},_.id)),b.length>0&&c.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-0 overflow-hidden shadow-sm animate-in fade-in slide-in-from-bottom-2",children:[c.jsx("div",{className:"px-3 py-2 bg-amber-100/50 border-b border-amber-200 flex items-center justify-between",children:c.jsxs("div",{className:"flex items-center gap-1.5 text-amber-800",children:[c.jsx(ez,{size:14}),c.jsx("span",{className:"text-xs font-bold",children:" ()"})]})}),c.jsx("div",{className:"p-3 space-y-3",children:b.map((_,E)=>c.jsxs("div",{className:"bg-white rounded-lg border border-amber-100 p-2 shadow-sm relative group",children:[c.jsx("button",{onClick:()=>S(E),className:"absolute right-2 top-2 text-gray-300 hover:text-red-500 hover:bg-gray-100 p-1 rounded transition-all z-10",title:"",children:c.jsx(un,{size:14})}),_.type==="update_task"&&c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500 font-bold uppercase tracking-wider mb-1",children:[c.jsx(Mg,{size:12})," "]}),c.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[_.params.title!==void 0&&c.jsx("input",{type:"text",value:_.params.title||"",onChange:I=>M(E,"title",I.target.value),className:"w-full text-xs font-bold border border-gray-200 rounded px-1.5 py-1 focus:ring-1 focus:ring-amber-300 outline-none",placeholder:""}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded border border-gray-100 flex-1",children:[c.jsx("span",{className:"text-[10px] text-gray-400",children:""}),c.jsx("input",{type:"date",value:_.params.start_date||"",onChange:I=>M(E,"start_date",I.target.value),className:"flex-1 text-xs bg-transparent outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded border border-gray-100 w-24",children:[c.jsx(Ri,{size:10,className:"text-gray-400"}),c.jsx("input",{type:"time",value:_.params.start_time||"",onChange:I=>M(E,"start_time",I.target.value),className:"flex-1 text-xs bg-transparent outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded border border-gray-100 w-28",children:[c.jsx(Wa,{size:10,className:"text-gray-400"}),c.jsxs("select",{value:_.params.reminder_minutes??-1,onChange:I=>{const P=parseInt(I.target.value);M(E,"reminder_minutes",P===-1?null:P)},className:"flex-1 text-xs bg-transparent outline-none",children:[c.jsx("option",{value:-1,children:""}),c.jsx("option",{value:0,children:""}),c.jsx("option",{value:10,children:"10"}),c.jsx("option",{value:30,children:"30"}),c.jsx("option",{value:60,children:"1"})]})]})]}),_.params.description!==void 0&&c.jsx("textarea",{value:_.params.description||"",onChange:I=>M(E,"description",I.target.value),className:"w-full text-xs border border-gray-200 rounded px-1.5 py-1 focus:ring-1 focus:ring-amber-300 outline-none resize-none h-16",placeholder:""})]})]}),_.type==="add_subtasks"&&c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500 mb-2 font-bold uppercase tracking-wider",children:[c.jsx(jz,{size:12})," "]}),c.jsx("ul",{className:"space-y-2",children:_.params.tasks.map((I,P)=>c.jsxs("li",{className:"flex flex-col gap-1.5 bg-gray-50 p-2 rounded relative group/item border border-transparent hover:border-gray-200 transition-colors",children:[c.jsxs("div",{className:"flex gap-2 w-full pr-5",children:[c.jsx("input",{type:"text",value:I.title,onChange:O=>M(E,"title",O.target.value,P),className:"flex-1 bg-white text-xs border border-gray-200 rounded px-1.5 py-1 focus:ring-1 focus:ring-amber-300 outline-none",placeholder:""}),c.jsx("button",{onClick:()=>C(E,P),className:"absolute right-1 top-1 text-gray-300 hover:text-red-500 p-1 opacity-0 group-hover/item:opacity-100 transition-opacity",title:"",children:c.jsx(Er,{size:12})})]}),c.jsxs("div",{className:"flex flex-wrap gap-2 text-[10px]",children:[c.jsxs("div",{className:"flex items-center gap-1 bg-white rounded border border-gray-200 px-1 py-0.5 min-w-[100px]",children:[c.jsx("span",{className:"text-gray-400",children:""}),c.jsx("input",{type:"date",value:I.start_date||"",onChange:O=>M(E,"start_date",O.target.value,P),className:"flex-1 outline-none min-w-0 bg-transparent"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-white rounded border border-gray-200 px-1 py-0.5 w-[80px]",children:[c.jsx(Ri,{size:10,className:"text-gray-400"}),c.jsx("input",{type:"time",value:I.start_time||"",onChange:O=>M(E,"start_time",O.target.value,P),className:"flex-1 outline-none min-w-0 bg-transparent"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-white rounded border border-gray-200 px-1 py-0.5 w-[85px]",children:[c.jsx(Wa,{size:10,className:"text-gray-400"}),c.jsxs("select",{value:I.reminder_minutes??-1,onChange:O=>{const $=parseInt(O.target.value);M(E,"reminder_minutes",$===-1?null:$,P)},className:"flex-1 outline-none bg-transparent",children:[c.jsx("option",{value:-1,children:""}),c.jsx("option",{value:0,children:""}),c.jsx("option",{value:10,children:"10"}),c.jsx("option",{value:60,children:"1hr"})]})]})]})]},P))})]})]},E))}),c.jsxs("div",{className:"p-2 border-t border-amber-200/50 flex gap-2",children:[c.jsx("button",{onClick:()=>g([]),className:"flex-1 py-1.5 text-xs text-gray-500 hover:bg-gray-100 rounded-lg transition-colors",children:""}),c.jsxs("button",{onClick:k,className:"flex-1 py-1.5 bg-amber-500 hover:bg-amber-600 text-white rounded-lg text-sm font-bold shadow-sm transition-colors flex items-center justify-center gap-1.5",children:[" (",b.length,")"]})]})]}),d&&c.jsxs("div",{className:"flex gap-3",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-600 text-white flex items-center justify-center flex-shrink-0",children:c.jsx(yi,{size:14,className:"animate-spin"})}),c.jsxs("div",{className:"bg-white px-4 py-3 rounded-2xl rounded-tl-none shadow-sm border border-indigo-100 flex items-center gap-2",children:[c.jsx("span",{className:"w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),c.jsx("span",{className:"w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),c.jsx("span",{className:"w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]}),c.jsx("div",{ref:h})]}),c.jsxs("div",{className:"p-3 bg-white border-t border-gray-100",children:[c.jsxs("form",{onSubmit:_=>{_.preventDefault(),R(o)},className:"relative",children:[c.jsxs("div",{className:"relative flex items-end gap-2 bg-gray-50 border border-gray-200 rounded-2xl p-2 focus-within:ring-2 focus-within:ring-indigo-100 focus-within:border-indigo-300 transition-all",children:[c.jsx("textarea",{value:o,onChange:_=>{a(_.target.value),_.target.style.height="auto",_.target.style.height=_.target.scrollHeight+"px"},onKeyDown:_=>{_.key==="Enter"&&(_.metaKey||_.ctrlKey)&&(_.preventDefault(),R(o))},placeholder:" GTD ... (Cmd + Enter )",className:"flex-1 bg-transparent border-none focus:ring-0 text-sm resize-none max-h-32 min-h-[24px] py-1 px-1 custom-scrollbar leading-relaxed outline-none",disabled:d,rows:1,style:{height:"auto",minHeight:"24px"}}),c.jsx("button",{type:"submit",disabled:!o.trim()||d,className:"p-1.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors self-end mb-0.5",title:"Cmd + Enter ",children:c.jsx(Fz,{size:16})})]}),c.jsx("div",{className:"text-[10px] text-gray-400 text-right mt-1 pr-1",children:"Cmd + Enter  / Enter "})]}),c.jsx("div",{className:"mt-2 flex gap-2 overflow-x-auto pb-1 no-scrollbar",children:["","","",""].map(_=>c.jsx("button",{onClick:()=>R(_),disabled:d,className:"px-2.5 py-1 bg-gray-50 hover:bg-indigo-50 text-gray-600 hover:text-indigo-600 border border-gray-100 hover:border-indigo-100 rounded-full text-xs whitespace-nowrap transition-colors",children:_},_))})]})]})}):null},DR=6048e5,mte=864e5,AR=6e4,RR=36e5,hE=Symbol.for("constructDateFrom");function _o(t,e){return typeof t=="function"?t(e):t&&typeof t=="object"&&hE in t?t[hE](e):t instanceof Date?new t.constructor(e):new Date(e)}function Ws(t,e){return _o(e||t,t)}function OR(t,e,n){const r=Ws(t,n==null?void 0:n.in);return isNaN(e)?_o((n==null?void 0:n.in)||t,NaN):(e&&r.setDate(r.getDate()+e),r)}let gte={};function s0(){return gte}function Bf(t,e){var a,l,u,d;const n=s0(),r=(e==null?void 0:e.weekStartsOn)??((l=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:l.weekStartsOn)??n.weekStartsOn??((d=(u=n.locale)==null?void 0:u.options)==null?void 0:d.weekStartsOn)??0,s=Ws(t,e==null?void 0:e.in),i=s.getDay(),o=(i<r?7:0)+i-r;return s.setDate(s.getDate()-o),s.setHours(0,0,0,0),s}function ag(t,e){return Bf(t,{...e,weekStartsOn:1})}function PR(t,e){const n=Ws(t,e==null?void 0:e.in),r=n.getFullYear(),s=_o(n,0);s.setFullYear(r+1,0,4),s.setHours(0,0,0,0);const i=ag(s),o=_o(n,0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);const a=ag(o);return n.getTime()>=i.getTime()?r+1:n.getTime()>=a.getTime()?r:r-1}function pE(t){const e=Ws(t),n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),+t-+n}function LR(t,...e){const n=_o.bind(null,t||e.find(r=>typeof r=="object"));return e.map(n)}function lg(t,e){const n=Ws(t,e==null?void 0:e.in);return n.setHours(0,0,0,0),n}function yte(t,e,n){const[r,s]=LR(n==null?void 0:n.in,t,e),i=lg(r),o=lg(s),a=+i-pE(i),l=+o-pE(o);return Math.round((a-l)/mte)}function xte(t,e){const n=PR(t,e),r=_o((e==null?void 0:e.in)||t,0);return r.setFullYear(n,0,4),r.setHours(0,0,0,0),ag(r)}function Qh(t,e,n){const[r,s]=LR(n==null?void 0:n.in,t,e);return+lg(r)==+lg(s)}function bte(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function vte(t){return!(!bte(t)&&typeof t!="number"||isNaN(+Ws(t)))}function wte(t,e){const n=Ws(t,e==null?void 0:e.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}const kte={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Ste=(t,e,n)=>{let r;const s=kte[t];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",e.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function hu(t){return(e={})=>{const n=e.width?String(e.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const _te={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Tte={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Cte={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Ete={date:hu({formats:_te,defaultWidth:"full"}),time:hu({formats:Tte,defaultWidth:"full"}),dateTime:hu({formats:Cte,defaultWidth:"full"})},Nte={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},jte=(t,e,n,r)=>Nte[t];function uo(t){return(e,n)=>{const r=n!=null&&n.context?String(n.context):"standalone";let s;if(r==="formatting"&&t.formattingValues){const o=t.defaultFormattingWidth||t.defaultWidth,a=n!=null&&n.width?String(n.width):o;s=t.formattingValues[a]||t.formattingValues[o]}else{const o=t.defaultWidth,a=n!=null&&n.width?String(n.width):t.defaultWidth;s=t.values[a]||t.values[o]}const i=t.argumentCallback?t.argumentCallback(e):e;return s[i]}}const Ite={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Mte={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Dte={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Ate={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Rte={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Ote={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Pte=(t,e)=>{const n=Number(t),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},Lte={ordinalNumber:Pte,era:uo({values:Ite,defaultWidth:"wide"}),quarter:uo({values:Mte,defaultWidth:"wide",argumentCallback:t=>t-1}),month:uo({values:Dte,defaultWidth:"wide"}),day:uo({values:Ate,defaultWidth:"wide"}),dayPeriod:uo({values:Rte,defaultWidth:"wide",formattingValues:Ote,defaultFormattingWidth:"wide"})};function fo(t){return(e,n={})=>{const r=n.width,s=r&&t.matchPatterns[r]||t.matchPatterns[t.defaultMatchWidth],i=e.match(s);if(!i)return null;const o=i[0],a=r&&t.parsePatterns[r]||t.parsePatterns[t.defaultParseWidth],l=Array.isArray(a)?zte(a,f=>f.test(o)):$te(a,f=>f.test(o));let u;u=t.valueCallback?t.valueCallback(l):l,u=n.valueCallback?n.valueCallback(u):u;const d=e.slice(o.length);return{value:u,rest:d}}}function $te(t,e){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return n}function zte(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return n}function $R(t){return(e,n={})=>{const r=e.match(t.matchPattern);if(!r)return null;const s=r[0],i=e.match(t.parsePattern);if(!i)return null;let o=t.valueCallback?t.valueCallback(i[0]):i[0];o=n.valueCallback?n.valueCallback(o):o;const a=e.slice(s.length);return{value:o,rest:a}}}const Fte=/^(\d+)(th|st|nd|rd)?/i,Bte=/\d+/i,Ute={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Hte={any:[/^b/i,/^(a|c)/i]},Vte={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Wte={any:[/1/i,/2/i,/3/i,/4/i]},Kte={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Gte={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},qte={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Yte={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Jte={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Xte={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Qte={ordinalNumber:$R({matchPattern:Fte,parsePattern:Bte,valueCallback:t=>parseInt(t,10)}),era:fo({matchPatterns:Ute,defaultMatchWidth:"wide",parsePatterns:Hte,defaultParseWidth:"any"}),quarter:fo({matchPatterns:Vte,defaultMatchWidth:"wide",parsePatterns:Wte,defaultParseWidth:"any",valueCallback:t=>t+1}),month:fo({matchPatterns:Kte,defaultMatchWidth:"wide",parsePatterns:Gte,defaultParseWidth:"any"}),day:fo({matchPatterns:qte,defaultMatchWidth:"wide",parsePatterns:Yte,defaultParseWidth:"any"}),dayPeriod:fo({matchPatterns:Jte,defaultMatchWidth:"any",parsePatterns:Xte,defaultParseWidth:"any"})},Zte={code:"en-US",formatDistance:Ste,formatLong:Ete,formatRelative:jte,localize:Lte,match:Qte,options:{weekStartsOn:0,firstWeekContainsDate:1}};function ene(t,e){const n=Ws(t,e==null?void 0:e.in);return yte(n,wte(n))+1}function tne(t,e){const n=Ws(t,e==null?void 0:e.in),r=+ag(n)-+xte(n);return Math.round(r/DR)+1}function zR(t,e){var d,f,h,p;const n=Ws(t,e==null?void 0:e.in),r=n.getFullYear(),s=s0(),i=(e==null?void 0:e.firstWeekContainsDate)??((f=(d=e==null?void 0:e.locale)==null?void 0:d.options)==null?void 0:f.firstWeekContainsDate)??s.firstWeekContainsDate??((p=(h=s.locale)==null?void 0:h.options)==null?void 0:p.firstWeekContainsDate)??1,o=_o((e==null?void 0:e.in)||t,0);o.setFullYear(r+1,0,i),o.setHours(0,0,0,0);const a=Bf(o,e),l=_o((e==null?void 0:e.in)||t,0);l.setFullYear(r,0,i),l.setHours(0,0,0,0);const u=Bf(l,e);return+n>=+a?r+1:+n>=+u?r:r-1}function nne(t,e){var a,l,u,d;const n=s0(),r=(e==null?void 0:e.firstWeekContainsDate)??((l=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:l.firstWeekContainsDate)??n.firstWeekContainsDate??((d=(u=n.locale)==null?void 0:u.options)==null?void 0:d.firstWeekContainsDate)??1,s=zR(t,e),i=_o((e==null?void 0:e.in)||t,0);return i.setFullYear(s,0,r),i.setHours(0,0,0,0),Bf(i,e)}function rne(t,e){const n=Ws(t,e==null?void 0:e.in),r=+Bf(n,e)-+nne(n,e);return Math.round(r/DR)+1}function Pn(t,e){const n=t<0?"-":"",r=Math.abs(t).toString().padStart(e,"0");return n+r}const la={y(t,e){const n=t.getFullYear(),r=n>0?n:1-n;return Pn(e==="yy"?r%100:r,e.length)},M(t,e){const n=t.getMonth();return e==="M"?String(n+1):Pn(n+1,2)},d(t,e){return Pn(t.getDate(),e.length)},a(t,e){const n=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(t,e){return Pn(t.getHours()%12||12,e.length)},H(t,e){return Pn(t.getHours(),e.length)},m(t,e){return Pn(t.getMinutes(),e.length)},s(t,e){return Pn(t.getSeconds(),e.length)},S(t,e){const n=e.length,r=t.getMilliseconds(),s=Math.trunc(r*Math.pow(10,n-3));return Pn(s,e.length)}},kc={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},mE={G:function(t,e,n){const r=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(t,e,n){if(e==="yo"){const r=t.getFullYear(),s=r>0?r:1-r;return n.ordinalNumber(s,{unit:"year"})}return la.y(t,e)},Y:function(t,e,n,r){const s=zR(t,r),i=s>0?s:1-s;if(e==="YY"){const o=i%100;return Pn(o,2)}return e==="Yo"?n.ordinalNumber(i,{unit:"year"}):Pn(i,e.length)},R:function(t,e){const n=PR(t);return Pn(n,e.length)},u:function(t,e){const n=t.getFullYear();return Pn(n,e.length)},Q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return Pn(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return Pn(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(t,e,n){const r=t.getMonth();switch(e){case"M":case"MM":return la.M(t,e);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(t,e,n){const r=t.getMonth();switch(e){case"L":return String(r+1);case"LL":return Pn(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(t,e,n,r){const s=rne(t,r);return e==="wo"?n.ordinalNumber(s,{unit:"week"}):Pn(s,e.length)},I:function(t,e,n){const r=tne(t);return e==="Io"?n.ordinalNumber(r,{unit:"week"}):Pn(r,e.length)},d:function(t,e,n){return e==="do"?n.ordinalNumber(t.getDate(),{unit:"date"}):la.d(t,e)},D:function(t,e,n){const r=ene(t);return e==="Do"?n.ordinalNumber(r,{unit:"dayOfYear"}):Pn(r,e.length)},E:function(t,e,n){const r=t.getDay();switch(e){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(t,e,n,r){const s=t.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return Pn(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(s,{width:"short",context:"formatting"});case"eeee":default:return n.day(s,{width:"wide",context:"formatting"})}},c:function(t,e,n,r){const s=t.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return Pn(i,e.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(s,{width:"narrow",context:"standalone"});case"cccccc":return n.day(s,{width:"short",context:"standalone"});case"cccc":default:return n.day(s,{width:"wide",context:"standalone"})}},i:function(t,e,n){const r=t.getDay(),s=r===0?7:r;switch(e){case"i":return String(s);case"ii":return Pn(s,e.length);case"io":return n.ordinalNumber(s,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(t,e,n){const s=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(t,e,n){const r=t.getHours();let s;switch(r===12?s=kc.noon:r===0?s=kc.midnight:s=r/12>=1?"pm":"am",e){case"b":case"bb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(t,e,n){const r=t.getHours();let s;switch(r>=17?s=kc.evening:r>=12?s=kc.afternoon:r>=4?s=kc.morning:s=kc.night,e){case"B":case"BB":case"BBB":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(t,e,n){if(e==="ho"){let r=t.getHours()%12;return r===0&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return la.h(t,e)},H:function(t,e,n){return e==="Ho"?n.ordinalNumber(t.getHours(),{unit:"hour"}):la.H(t,e)},K:function(t,e,n){const r=t.getHours()%12;return e==="Ko"?n.ordinalNumber(r,{unit:"hour"}):Pn(r,e.length)},k:function(t,e,n){let r=t.getHours();return r===0&&(r=24),e==="ko"?n.ordinalNumber(r,{unit:"hour"}):Pn(r,e.length)},m:function(t,e,n){return e==="mo"?n.ordinalNumber(t.getMinutes(),{unit:"minute"}):la.m(t,e)},s:function(t,e,n){return e==="so"?n.ordinalNumber(t.getSeconds(),{unit:"second"}):la.s(t,e)},S:function(t,e){return la.S(t,e)},X:function(t,e,n){const r=t.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return yE(r);case"XXXX":case"XX":return bl(r);case"XXXXX":case"XXX":default:return bl(r,":")}},x:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"x":return yE(r);case"xxxx":case"xx":return bl(r);case"xxxxx":case"xxx":default:return bl(r,":")}},O:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+gE(r,":");case"OOOO":default:return"GMT"+bl(r,":")}},z:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+gE(r,":");case"zzzz":default:return"GMT"+bl(r,":")}},t:function(t,e,n){const r=Math.trunc(+t/1e3);return Pn(r,e.length)},T:function(t,e,n){return Pn(+t,e.length)}};function gE(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),s=Math.trunc(r/60),i=r%60;return i===0?n+String(s):n+String(s)+e+Pn(i,2)}function yE(t,e){return t%60===0?(t>0?"-":"+")+Pn(Math.abs(t)/60,2):bl(t,e)}function bl(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),s=Pn(Math.trunc(r/60),2),i=Pn(r%60,2);return n+s+e+i}const xE=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},FR=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},sne=(t,e)=>{const n=t.match(/(P+)(p+)?/)||[],r=n[1],s=n[2];if(!s)return xE(t,e);let i;switch(r){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",xE(r,e)).replace("{{time}}",FR(s,e))},ine={p:FR,P:sne},one=/^D+$/,ane=/^Y+$/,lne=["D","DD","YY","YYYY"];function cne(t){return one.test(t)}function une(t){return ane.test(t)}function dne(t,e,n){const r=fne(t,e,n);if(console.warn(r),lne.includes(t))throw new RangeError(r)}function fne(t,e,n){const r=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${r} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const hne=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,pne=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,mne=/^'([^]*?)'?$/,gne=/''/g,yne=/[a-zA-Z]/;function ks(t,e,n){var d,f,h,p,m,y,b,g;const r=s0(),s=(n==null?void 0:n.locale)??r.locale??Zte,i=(n==null?void 0:n.firstWeekContainsDate)??((f=(d=n==null?void 0:n.locale)==null?void 0:d.options)==null?void 0:f.firstWeekContainsDate)??r.firstWeekContainsDate??((p=(h=r.locale)==null?void 0:h.options)==null?void 0:p.firstWeekContainsDate)??1,o=(n==null?void 0:n.weekStartsOn)??((y=(m=n==null?void 0:n.locale)==null?void 0:m.options)==null?void 0:y.weekStartsOn)??r.weekStartsOn??((g=(b=r.locale)==null?void 0:b.options)==null?void 0:g.weekStartsOn)??0,a=Ws(t,n==null?void 0:n.in);if(!vte(a))throw new RangeError("Invalid time value");let l=e.match(pne).map(v=>{const w=v[0];if(w==="p"||w==="P"){const T=ine[w];return T(v,s.formatLong)}return v}).join("").match(hne).map(v=>{if(v==="''")return{isToken:!1,value:"'"};const w=v[0];if(w==="'")return{isToken:!1,value:xne(v)};if(mE[w])return{isToken:!0,value:v};if(w.match(yne))throw new RangeError("Format string contains an unescaped latin alphabet character `"+w+"`");return{isToken:!1,value:v}});s.localize.preprocessor&&(l=s.localize.preprocessor(a,l));const u={firstWeekContainsDate:i,weekStartsOn:o,locale:s};return l.map(v=>{if(!v.isToken)return v.value;const w=v.value;(!(n!=null&&n.useAdditionalWeekYearTokens)&&une(w)||!(n!=null&&n.useAdditionalDayOfYearTokens)&&cne(w))&&dne(w,e,String(t));const T=mE[w[0]];return T(a,w,s.localize,u)}).join("")}function xne(t){const e=t.match(mne);return e?e[1].replace(gne,"'"):t}function bne(t,e,n){return OR(t,-e,n)}function ws(t,e){const n=()=>_o(e==null?void 0:e.in,NaN),r=(e==null?void 0:e.additionalDigits)??2,s=Sne(t);let i;if(s.date){const u=_ne(s.date,r);i=Tne(u.restDateString,u.year)}if(!i||isNaN(+i))return n();const o=+i;let a=0,l;if(s.time&&(a=Cne(s.time),isNaN(a)))return n();if(s.timezone){if(l=Ene(s.timezone),isNaN(l))return n()}else{const u=new Date(o+a),d=Ws(0,e==null?void 0:e.in);return d.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),d.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),d}return Ws(o+a+l,e==null?void 0:e.in)}const Zh={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},vne=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,wne=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,kne=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Sne(t){const e={},n=t.split(Zh.dateTimeDelimiter);let r;if(n.length>2)return e;if(/:/.test(n[0])?r=n[0]:(e.date=n[0],r=n[1],Zh.timeZoneDelimiter.test(e.date)&&(e.date=t.split(Zh.timeZoneDelimiter)[0],r=t.substr(e.date.length,t.length))),r){const s=Zh.timezone.exec(r);s?(e.time=r.replace(s[1],""),e.timezone=s[1]):e.time=r}return e}function _ne(t,e){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),r=t.match(n);if(!r)return{year:NaN,restDateString:""};const s=r[1]?parseInt(r[1]):null,i=r[2]?parseInt(r[2]):null;return{year:i===null?s:i*100,restDateString:t.slice((r[1]||r[2]).length)}}function Tne(t,e){if(e===null)return new Date(NaN);const n=t.match(vne);if(!n)return new Date(NaN);const r=!!n[4],s=id(n[1]),i=id(n[2])-1,o=id(n[3]),a=id(n[4]),l=id(n[5])-1;if(r)return Dne(e,a,l)?Nne(e,a,l):new Date(NaN);{const u=new Date(0);return!Ine(e,i,o)||!Mne(e,s)?new Date(NaN):(u.setUTCFullYear(e,i,Math.max(s,o)),u)}}function id(t){return t?parseInt(t):1}function Cne(t){const e=t.match(wne);if(!e)return NaN;const n=Ky(e[1]),r=Ky(e[2]),s=Ky(e[3]);return Ane(n,r,s)?n*RR+r*AR+s*1e3:NaN}function Ky(t){return t&&parseFloat(t.replace(",","."))||0}function Ene(t){if(t==="Z")return 0;const e=t.match(kne);if(!e)return 0;const n=e[1]==="+"?-1:1,r=parseInt(e[2]),s=e[3]&&parseInt(e[3])||0;return Rne(r,s)?n*(r*RR+s*AR):NaN}function Nne(t,e,n){const r=new Date(0);r.setUTCFullYear(t,0,4);const s=r.getUTCDay()||7,i=(e-1)*7+n+1-s;return r.setUTCDate(r.getUTCDate()+i),r}const jne=[31,null,31,30,31,30,31,31,30,31,30,31];function BR(t){return t%400===0||t%4===0&&t%100!==0}function Ine(t,e,n){return e>=0&&e<=11&&n>=1&&n<=(jne[e]||(BR(t)?29:28))}function Mne(t,e){return e>=1&&e<=(BR(t)?366:365)}function Dne(t,e,n){return e>=1&&e<=53&&n>=0&&n<=6}function Ane(t,e,n){return t===24?e===0&&n===0:n>=0&&n<60&&e>=0&&e<60&&t>=0&&t<25}function Rne(t,e){return e>=0&&e<=59}const One=({onSave:t,onCancel:e,initialData:n,isReadOnly:r=!1})=>{const{user:s,setToast:i}=x.useContext(En),[o,a]=x.useState((n==null?void 0:n.description)||""),[l,u]=x.useState(((n==null?void 0:n.images)||[]).map(C=>({url:C}))),[d,f]=x.useState(!1),[h,p]=x.useState(!1),m=x.useRef(null),b=(()=>n!=null&&n.date&&!isNaN(n.date.getTime())?n.date:new Date)(),[g,v]=x.useState(ks(b,"yyyy-MM-dd")),[w,T]=x.useState(ks(b,"HH:mm")),R=async C=>new Promise(_=>{const E=new FileReader;E.readAsDataURL(C),E.onload=I=>{var O;const P=new Image;P.src=(O=I.target)==null?void 0:O.result,P.onload=()=>{const $=document.createElement("canvas");let A=P.width,j=P.height;const W=1920;A>j&&A>W?(j*=W/A,A=W):j>W&&(A*=W/j,j=W),$.width=A,$.height=j;const V=$.getContext("2d");V==null||V.drawImage(P,0,0,A,j);let D=.9;const ge=()=>{$.toBlob(me=>{if(!me){_(null);return}if(me.size>300*1024&&D>.1)D-=.1,ge();else{const F=(me.size/1024).toFixed(1);_({blob:me,sizeText:`${F} KB`})}},"image/jpeg",D)};ge()}},E.onerror=()=>_(null)}),k=async C=>{if(r)return;const _=C.target.files;if(!(!_||_.length===0)&&!(!s||!ve)){f(!0);try{const E=[];for(let I=0;I<_.length;I++){const P=_[I],O=await R(P);if(!O)continue;const{blob:$,sizeText:A}=O,j="jpg",W=`${Date.now()}_${xI()}.${j}`,V=`${s.id}/${W}`,{error:D}=await ve.storage.from("attachments").upload(V,$,{contentType:"image/jpeg"});if(D)throw D;const{data:ge}=ve.storage.from("attachments").getPublicUrl(V);ge&&E.push({url:ge.publicUrl,sizeText:A,isNew:!0})}u(I=>[...I,...E])}catch(E){console.error("Upload error:",E),i==null||i({msg:"",type:"error"})}finally{f(!1),C.target&&(C.target.value="")}}},M=async()=>{if(r)return;const C=document.createElement("div");if(C.innerHTML=o,!(C.textContent||C.innerText||"").trim()&&l.length===0){i==null||i({msg:"",type:"warning"});return}p(!0);try{const E=new Date(`${g}T${w}`),I=l.map(P=>P.url);await t({description:o,images:I,date:E}),e()}catch(E){console.error("Save error:",E),i==null||i({msg:"",type:"error"})}finally{p(!1)}},S=C=>{var E;const _=(E=m.current)==null?void 0:E.getEditor();if(_)switch(C){case"bold":_.chain().focus().toggleBold().run();break;case"italic":_.chain().focus().toggleItalic().run();break;case"bulletList":_.chain().focus().toggleBulletList().run();break;case"orderedList":_.chain().focus().toggleOrderedList().run();break;case"h1":_.chain().focus().toggleHeading({level:1}).run();break;case"h2":_.chain().focus().toggleHeading({level:2}).run();break}};return c.jsxs("div",{className:"fixed inset-0 z-[1200] flex flex-col bg-white",children:[c.jsxs("div",{className:"flex flex-col border-b border-gray-100 bg-white/80 backdrop-blur-md sticky top-0 z-20",children:[c.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[c.jsx("button",{onClick:e,className:"p-2 -ml-2 text-gray-500 hover:bg-gray-100 rounded-full",children:c.jsx(un,{size:24})}),c.jsx("div",{className:"font-bold text-lg text-gray-800",children:r?"":n?"":""}),!r&&c.jsx("button",{onClick:M,disabled:h||d,className:`px-4 py-1.5 rounded-full font-bold text-sm text-white transition-all ${h||d?"bg-gray-300":"bg-pink-500 hover:bg-pink-600 active:scale-95"}`,children:h?c.jsx(yi,{size:16,className:"animate-spin"}):""}),r&&c.jsx("div",{className:"w-8"})," "]}),c.jsxs("div",{className:"px-4 pb-2 flex gap-2",children:[c.jsx("input",{type:"date",value:g,onChange:C=>!r&&v(C.target.value),disabled:r,className:`bg-gray-50 border border-gray-200 rounded-lg px-2 py-1 text-sm font-medium text-gray-700 outline-none ${r?"opacity-80 cursor-default":"focus:ring-2 focus:ring-pink-200"}`}),c.jsx("input",{type:"time",value:w,onChange:C=>!r&&T(C.target.value),disabled:r,className:`bg-gray-50 border border-gray-200 rounded-lg px-2 py-1 text-sm font-medium text-gray-700 outline-none ${r?"opacity-80 cursor-default":"focus:ring-2 focus:ring-pink-200"}`})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-32",children:[l.length>0&&c.jsx("div",{className:"grid grid-cols-2 gap-2 mb-4",children:l.map((C,_)=>c.jsxs("div",{className:"relative group aspect-square rounded-xl overflow-hidden bg-gray-100 border border-gray-200",children:[c.jsx("img",{src:C.url,alt:"Moment",className:"w-full h-full object-cover"}),C.sizeText&&c.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[10px] py-0.5 px-2 text-center pointer-events-none",children:C.sizeText}),!r&&c.jsx("button",{onClick:()=>u(E=>E.filter((I,P)=>P!==_)),className:"absolute top-2 right-2 p-1.5 bg-black/50 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:c.jsx(un,{size:14})})]},_))}),c.jsx("div",{className:"min-h-[200px]",onClick:()=>{var C;return!r&&((C=m.current)==null?void 0:C.focus())},children:c.jsx(Zg,{ref:m,initialContent:o,onChange:a,placeholder:r?"...":"...",textSizeClass:"text-lg",descFontClass:"font-newsreader",className:"moments-editor",editable:!r})})]}),!r&&c.jsxs("div",{className:"sticky bottom-0 left-0 right-0 bg-white border-t border-gray-100 pb-safe pt-2 px-2 z-20 shadow-[0_-4px_12px_rgba(0,0,0,0.05)]",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2 px-2",children:[c.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 bg-pink-50 text-pink-600 rounded-full cursor-pointer active:scale-95 transition-transform select-none",children:[c.jsx(vf,{size:20}),c.jsx("span",{className:"text-sm font-bold",children:""}),c.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:k})]}),d&&c.jsx("span",{className:"text-xs text-gray-400 animate-pulse",children:"..."})]}),c.jsxs("div",{className:"flex items-center justify-between px-2 py-2 overflow-x-auto no-scrollbar",children:[c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 p-1 rounded-xl",children:[c.jsx(Sc,{icon:c.jsx(rz,{size:18}),onClick:()=>S("bold")}),c.jsx(Sc,{icon:c.jsx(Cz,{size:18}),onClick:()=>S("italic")})]}),c.jsx("div",{className:"w-px h-6 bg-gray-200 mx-2 shrink-0"}),c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 p-1 rounded-xl",children:[c.jsx(Sc,{icon:c.jsx(kz,{size:18}),onClick:()=>S("h1")}),c.jsx(Sc,{icon:c.jsx(Sz,{size:18}),onClick:()=>S("h2")})]}),c.jsx("div",{className:"w-px h-6 bg-gray-200 mx-2 shrink-0"}),c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 p-1 rounded-xl",children:[c.jsx(Sc,{icon:c.jsx(PI,{size:18}),onClick:()=>S("bulletList")}),c.jsx(Sc,{icon:c.jsx(Nz,{size:18}),onClick:()=>S("orderedList")})]})]})]})]})},Sc=({icon:t,onClick:e})=>c.jsx("button",{type:"button",onMouseDown:n=>{n.preventDefault(),e()},className:"p-2 text-gray-600 hover:text-pink-500 hover:bg-white rounded-lg transition-all active:scale-90",children:t}),Pne=({tasks:t,tags:e,isGuest:n,onAddTask:r,onUpdateTask:s,onDeleteTask:i,scrollRef:o})=>{const{setToast:a}=x.useContext(En),[l,u]=x.useState(!1),[d,f]=x.useState(null),[h,p]=x.useState(null),[m,y]=x.useState(20),b=x.useRef(null),g=x.useRef(null);x.useEffect(()=>{if(o!=null&&o.current&&g.current){const O=document.getElementById(`moment-${o.current}`);O&&O.scrollIntoView({behavior:"auto",block:"center"})}},[t]),x.useEffect(()=>{const O=g.current;if(!O)return;const $=()=>{const W=O.scrollTop+O.clientHeight/2;let V=null,D=1/0;O.querySelectorAll("[data-moment-id]").forEach(me=>{const U=me.offsetTop+me.offsetHeight/2,ne=Math.abs(U-W);ne<D&&(D=ne,V=me.getAttribute("data-moment-id"))}),V&&o&&(o.current=V,localStorage.setItem("heart_last_moment_id",V))};let A;const j=()=>{clearTimeout(A),A=setTimeout($,100)};return O.addEventListener("scroll",j),()=>O.removeEventListener("scroll",j)},[m,t]);const v=x.useMemo(()=>e.find(O=>O.name==="OurTimeMoment"),[e]),w=x.useMemo(()=>e.find(O=>O.name.includes("Google:")||O.name==="Google:"),[e]),T=x.useMemo(()=>e.find(O=>O.name.includes("-Wei")||O.name==="-Wei"),[e]),R=O=>{try{let $=0;if(O.start_date){const A=O.start_date.substring(0,10),j=O.start_time||"00:00",W=j.length>5?j.substring(0,5):j;let V=ws(`${A}T${W}`);isNaN(V.getTime())&&(V=new Date(`${A.replace(/-/g,"/")} ${W}`)),isNaN(V.getTime())||($=V.getTime())}if($===0&&O.created_at){const A=new Date(O.created_at);isNaN(A.getTime())||($=A.getTime())}return $}catch{return 0}},k=x.useMemo(()=>!v||!w&&!T?[]:t.filter(O=>{if(O.status==="trash"||O.status==="deleted"||O.is_deleted||O.deleted_at)return!1;const $=O.tags||[];if(!$.includes(v.id))return!1;const A=w&&$.includes(w.id),j=T&&$.includes(T.id);return A||j}).sort((O,$)=>{const A=R(O);return R($)-A}),[t,v,w,T]),M=x.useMemo(()=>k.slice(0,m),[k,m]),S=x.useMemo(()=>{var A,j;const O=[];let $=0;for(;$<M.length;){const W=M[$],V=T&&((A=W.tags)==null?void 0:A.includes(T.id)),D=M[$+1];if(D){const ge=T&&((j=D.tags)==null?void 0:j.includes(T.id));if(V!==ge){O.push({type:"pair",items:[W,D]}),$+=2;continue}}O.push({type:"single",items:[W]}),$++}return O},[M,T]);x.useEffect(()=>{const O=new IntersectionObserver($=>{$[0].isIntersecting&&y(A=>Math.min(A+20,k.length))},{threshold:.1});return b.current&&O.observe(b.current),()=>O.disconnect()},[k.length]);const C=async O=>{try{const $=O.date||new Date,A=ks($,"yyyy-MM-dd"),j=ks($,"HH:mm");if(d){const W={description:O.description,images:O.images,start_date:A,start_time:j};await s(d.id,W),a==null||a({msg:"",type:"info"})}else{const W=[];v&&W.push(v.id);let V=null;if(n?V=T==null?void 0:T.id:V=w==null?void 0:w.id,!V){const D=e.find(me=>me.name.includes("-Wei")),ge=e.find(me=>me.name.includes("Google:"));n&&D?V=D.id:!n&&ge&&(V=ge.id)}if(V)W.push(V);else{a==null||a({msg:"",type:"error"});return}await r({title:ks($,"yyyy-MM-dd HH:mm"),description:O.description,images:O.images,tags:W,start_date:A,start_time:j,is_all_day:!1,status:"inbox"}),a==null||a({msg:"",type:"success"})}u(!1),f(null)}catch($){console.error($),a==null||a({msg:"",type:"error"})}},_=(O,$,A)=>{const j=O.start_date?ws(O.start_date):ws(O.created_at),W=ks(j,"yyyy/MM/dd"),V=O.start_time?O.start_time.substring(0,5):ks(j,"HH:mm");return c.jsxs("div",{"data-moment-id":O.id,className:`
                    relative w-full flex ${$?"justify-end":"justify-start"}
                    ${A?"mt-16":""} 
                    group transition-all duration-500 animate-in fade-in slide-in-from-bottom-4
                `,children:[c.jsx("div",{className:`
                    absolute top-6 w-4 h-4 rounded-full z-10 shadow-sm border-4 border-white
                    ${$?"left-[-8px] bg-pink-400 ring-2 ring-pink-100":"right-[-8px] bg-indigo-400 ring-2 ring-indigo-100"}
                `}),c.jsxs("div",{className:`w-[90%] ${$?"pl-6 text-right":"pr-6 text-left"}`,children:[c.jsxs("div",{className:`
                        mb-1 flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-gray-400
                        ${$?"justify-end flex-row-reverse":"mt-8"}
                    `,children:[c.jsx(vo,{size:12}),c.jsx("span",{children:W}),c.jsx("span",{className:"w-1 h-1 rounded-full bg-gray-300 mx-1"}),c.jsx(Ri,{size:12}),c.jsx("span",{children:V})]}),c.jsxs("div",{className:`
                            relative bg-white p-4 rounded-2xl shadow-sm border transition-all hover:shadow-md cursor-pointer
                            ${$?"border-pink-50 hover:border-pink-200 rounded-tl-none":"border-indigo-50 hover:border-indigo-200 rounded-tr-none"}
                        `,onDoubleClick:()=>{f(O),u(!0)},children:[O.images&&O.images.length>0&&c.jsx("div",{className:`grid gap-1 mb-3 rounded-lg overflow-hidden ${O.images.length>1?"grid-cols-2":"grid-cols-1"}`,children:O.images.map((D,ge)=>c.jsx("img",{src:D,className:"w-full h-auto rounded-lg hover:scale-105 transition-transform duration-500 cursor-zoom-in",loading:"lazy",onClick:me=>{me.stopPropagation(),p(D)}},ge))}),c.jsx("div",{className:`prose prose-sm max-w-none font-newsreader text-gray-600 leading-snug ${$?"prose-pink text-right":"prose-indigo text-left"}`,dangerouslySetInnerHTML:{__html:(()=>{const D=O.description||"";if(!D)return"";const ge=document.createElement("div");ge.innerHTML=D;const me=ge.textContent||ge.innerText||"";return me.length>100?me.substring(0,100)+"...":D})()}}),c.jsx("div",{className:`absolute top-2 ${$?"left-2":"right-2"} opacity-0 group-hover:opacity-100 transition-opacity`,children:c.jsx("button",{onClick:D=>{D.stopPropagation(),window.confirm("")&&i(O.id)},className:"p-1 text-gray-300 hover:text-red-400 hover:bg-gray-50 rounded-full",children:c.jsx(Er,{size:14})})})]})]})]},O.id)},[E,I]=x.useState("vertical"),P=()=>c.jsx("div",{className:"relative w-full overflow-x-auto overflow-y-hidden h-[calc(100vh-140px)] flex flex-col justify-center custom-scrollbar bg-slate-50",children:c.jsxs("div",{className:"flex gap-4 md:gap-12 relative z-10 px-4 md:px-20 items-center h-full min-w-max",children:[c.jsxs("div",{className:"absolute top-1/2 left-0 right-0 h-12 z-0 pointer-events-none transform -translate-y-1/2 overflow-hidden",children:[c.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-100/30 via-purple-100/30 to-pink-100/30 blur-xl"}),c.jsxs("svg",{className:"absolute top-0 left-0 w-full h-full",preserveAspectRatio:"none",children:[c.jsx("defs",{children:c.jsxs("linearGradient",{id:"lineGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[c.jsx("stop",{offset:"0%",stopColor:"#818cf8",stopOpacity:"0.4"}),c.jsx("stop",{offset:"50%",stopColor:"#c084fc",stopOpacity:"0.6"}),c.jsx("stop",{offset:"100%",stopColor:"#f472b6",stopOpacity:"0.4"})]})}),c.jsx("line",{x1:"0",y1:"50%",x2:"100%",y2:"50%",stroke:"url(#lineGradient)",strokeWidth:"2",strokeDasharray:"6 6"})]}),c.jsx("div",{className:"absolute inset-0 w-full h-full opacity-30",style:{backgroundImage:`
                                    radial-gradient(circle at 10px 24px, #818cf8 2px, transparent 2.5px),
                                    radial-gradient(circle at 30px 24px, #f472b6 2px, transparent 2.5px)
                                `,backgroundSize:"40px 100%"}}),c.jsx("div",{className:"absolute top-[calc(50%-1px)] left-0 w-full h-0.5 bg-gradient-to-r from-indigo-300 via-purple-300 to-pink-300 opacity-60"})]}),S.map((O,$)=>{var j,W;const A=(V,D)=>{var F;const ge=V.start_date?ws(V.start_date):ws(V.created_at),me=ks(ge,"MM/dd");return c.jsxs("div",{"data-moment-id":V.id,className:`
                                        relative w-[220px] md:w-[300px] flex-shrink-0 group transition-all duration-500 hover:scale-[1.02]
                                        flex flex-col h-1/2
                                        ${D?"justify-start pt-8 md:pt-12":"justify-end pb-8 md:pb-12"}
                                    `,children:[c.jsx("div",{className:`
                                        absolute left-1/2 -translate-x-1/2 w-0.5 bg-gray-300/50 group-hover:bg-pink-300 transition-colors
                                        ${D?"top-0 h-8 md:h-12":"bottom-0 h-8 md:h-12"}
                                    `}),c.jsx("div",{className:`
                                        absolute left-1/2 -translate-x-1/2 w-3 h-3 md:w-5 md:h-5 rounded-full z-20 shadow-lg border-[2px] md:border-[3px] border-white transition-transform duration-300 group-hover:scale-125
                                        ${D?"top-0 -translate-y-1/2 bg-gradient-to-br from-pink-400 to-rose-500":"bottom-0 translate-y-1/2 bg-gradient-to-br from-indigo-400 to-blue-500"}
                                    `,children:c.jsx("div",{className:"absolute inset-0 rounded-full bg-white opacity-30 animate-ping"})}),c.jsxs("div",{className:`
                                            flex flex-col flex-1 min-h-0
                                            bg-white p-3 md:p-4 rounded-xl md:rounded-2xl shadow-[0_4px_12px_rgba(0,0,0,0.04)] 
                                            border border-white hover:border-pink-200 transition-all cursor-pointer overflow-hidden
                                            ${D?"rounded-tl-none":"rounded-bl-none"}
                                        `,onDoubleClick:()=>{f(V),u(!0)},children:[c.jsxs("div",{className:"text-[10px] md:text-xs font-bold text-gray-400 mb-2 flex justify-between items-center shrink-0",children:[c.jsx("span",{className:"bg-gray-100 px-2 py-0.5 rounded-full",children:me}),((F=V.images)==null?void 0:F.length)>0&&c.jsxs("span",{className:"text-pink-400 text-[9px] bg-pink-50 px-1.5 py-0.5 rounded-full",children:[" ",V.images.length]})]}),V.images&&V.images.length>0?c.jsxs("div",{className:"flex-1 min-h-0 mb-2 overflow-hidden rounded-lg bg-gray-50 relative group/img",children:[c.jsx("img",{src:V.images[0],className:"w-full h-full object-cover transition-transform duration-700 group-hover/img:scale-110"}),V.images.length>1&&c.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/50 text-white text-[10px] px-2 py-1 rounded-full backdrop-blur-sm",children:["+",V.images.length-1]})]}):c.jsx("div",{className:"flex-1 min-h-[10%]"}),c.jsx("div",{className:"text-xs md:text-sm text-gray-600 font-newsreader line-clamp-3 md:line-clamp-4 shrink-0 leading-relaxed overflow-hidden",dangerouslySetInnerHTML:{__html:V.description||""}})]})]},V.id)};if(O.type==="pair"){const V=O.items[0],D=O.items[1],ge=T&&((j=V.tags)==null?void 0:j.includes(T.id)),me=ge?D:V,F=ge?V:D;return c.jsxs("div",{className:"flex flex-col h-full",children:[A(me,!1),A(F,!0)]},`pair-${$}`)}else{const V=O.items[0],D=T&&((W=V.tags)==null?void 0:W.includes(T.id)),ge=c.jsx("div",{className:"h-1/2 w-[220px] md:w-[300px] flex-shrink-0"});return c.jsx("div",{className:"flex flex-col h-full",children:D?c.jsxs(c.Fragment,{children:[ge,A(V,!0)]}):c.jsxs(c.Fragment,{children:[A(V,!1),ge]})},`single-${$}`)}}),c.jsx("div",{className:"w-20 shrink-0"})]})});return c.jsxs("div",{className:"relative min-h-full bg-slate-50 pb-20 flex flex-col",children:[c.jsxs("div",{className:"flex justify-end px-4 py-2 gap-2",children:[c.jsx("button",{onClick:()=>I("vertical"),className:`text-xs px-3 py-1 rounded-full border ${E==="vertical"?"bg-indigo-500 text-white border-indigo-500":"bg-white text-gray-500 border-gray-200"}`,children:""}),c.jsx("button",{onClick:()=>I("horizontal"),className:`text-xs px-3 py-1 rounded-full border ${E==="horizontal"?"bg-indigo-500 text-white border-indigo-500":"bg-white text-gray-500 border-gray-200"}`,children:""})]}),E==="horizontal"?P():c.jsxs("div",{className:"max-w-4xl mx-auto px-2 md:px-4 py-8 flex-1 w-full",children:[k.length===0&&c.jsxs("div",{className:"text-center py-20 opacity-50",children:[c.jsx(ou,{size:48,className:"mx-auto text-pink-300 mb-4 animate-pulse"}),c.jsx("p",{className:"text-gray-500 text-lg font-newsreader",children:"..."})]}),c.jsxs("div",{className:"relative space-y-0",children:[k.length>0&&c.jsx("div",{className:"absolute left-1/2 top-4 bottom-4 w-0.5 bg-gradient-to-b from-indigo-200 via-pink-200 to-transparent -translate-x-1/2 z-0"}),S.map((O,$)=>{var A,j,W;if(O.type==="pair"){const V=O.items[0],D=O.items[1],ge=T&&((A=V.tags)==null?void 0:A.includes(T.id)),me=T&&((j=D.tags)==null?void 0:j.includes(T.id));return c.jsxs("div",{className:"grid grid-cols-2 w-full relative z-10",children:[c.jsx("div",{className:"w-full",children:ge?me?null:_(D,!1,!0):_(V,!1,!1)}),c.jsx("div",{className:"w-full",children:ge?_(V,!0,!1):me?_(D,!0,!0):null})]},`pair-${$}`)}else{const V=O.items[0],D=T&&((W=V.tags)==null?void 0:W.includes(T.id));return c.jsxs("div",{className:"grid grid-cols-2 w-full relative z-10",children:[c.jsx("div",{className:"w-full",children:!D&&_(V,!1,!1)}),c.jsx("div",{className:"w-full",children:D&&_(V,!0,!1)})]},`single-${$}`)}}),k.length>m&&c.jsx("div",{ref:b,className:"py-8 flex justify-center",children:c.jsx("div",{className:"w-8 h-8 border-4 border-pink-200 rounded-full animate-spin border-t-transparent"})})]})]}),c.jsx("button",{onClick:()=>{f(null),u(!0)},className:`
                    fixed bottom-6 right-6 w-14 h-14 text-white rounded-full shadow-lg flex items-center justify-center hover:scale-110 active:scale-95 transition-all z-50
                    bg-gradient-to-tr ${n?"from-pink-500 to-rose-500":"from-indigo-500 to-blue-600"}
                `,children:c.jsx(ni,{size:28})}),l&&c.jsx(One,{initialData:d?{description:d.description,images:d.images,date:(()=>{try{if(d.start_date){const $=d.start_date.substring(0,10),A=d.start_time?d.start_time.substring(0,5):"00:00";let j=ws(`${$}T${A}`);if(isNaN(j.getTime())&&(j=new Date(`${$.replace(/-/g,"/")} ${A}`)),!isNaN(j.getTime()))return j}const O=new Date(d.created_at);return isNaN(O.getTime())?new Date:O}catch{return new Date}})()}:void 0,onSave:C,onCancel:()=>{u(!1),f(null)},isReadOnly:(()=>{var $;if(!d)return!1;const O=T&&(($=d.tags)==null?void 0:$.includes(T.id));return n?!O:!!O})()}),h&&c.jsx("div",{className:"fixed inset-0 z-[1300] bg-black/95 flex items-center justify-center p-4 animate-in fade-in duration-200",onClick:()=>p(null),children:c.jsx("img",{src:h,className:"max-w-full max-h-full object-contain cursor-zoom-out",onClick:O=>{O.stopPropagation(),p(null)}})})]})},Lne={lessThanXSeconds:{one:" 1 ",other:" {{count}} "},xSeconds:{one:"1 ",other:"{{count}} "},halfAMinute:"",lessThanXMinutes:{one:" 1 ",other:" {{count}} "},xMinutes:{one:"1 ",other:"{{count}} "},xHours:{one:"1 ",other:"{{count}} "},aboutXHours:{one:" 1 ",other:" {{count}} "},xDays:{one:"1 ",other:"{{count}} "},aboutXWeeks:{one:" 1 ",other:" {{count}} "},xWeeks:{one:"1 ",other:"{{count}} "},aboutXMonths:{one:" 1 ",other:" {{count}} "},xMonths:{one:"1 ",other:"{{count}} "},aboutXYears:{one:" 1 ",other:" {{count}} "},xYears:{one:"1 ",other:"{{count}} "},overXYears:{one:" 1 ",other:" {{count}} "},almostXYears:{one:" 1 ",other:" {{count}} "}},$ne=(t,e,n)=>{let r;const s=Lne[t];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",String(e)),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?r+"":r+"":r},zne={full:"y''M''d'' EEEE",long:"y''M''d''",medium:"yyyy-MM-dd",short:"yy-MM-dd"},Fne={full:"zzzz a h:mm:ss",long:"z a h:mm:ss",medium:"a h:mm:ss",short:"a h:mm"},Bne={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},Une={date:hu({formats:zne,defaultWidth:"full"}),time:hu({formats:Fne,defaultWidth:"full"}),dateTime:hu({formats:Bne,defaultWidth:"full"})},Hne={lastWeek:"''eeee p",yesterday:"'' p",today:"'' p",tomorrow:"'' p",nextWeek:"''eeee p",other:"P"},Vne=(t,e,n,r)=>Hne[t],Wne={narrow:["",""],abbreviated:["",""],wide:["",""]},Kne={narrow:["1","2","3","4"],abbreviated:["","","",""],wide:["","","",""]},Gne={narrow:["","","","","","","","","","","",""],abbreviated:["1","2","3","4","5","6","7","8","9","10","11","12"],wide:["","","","","","","","","","","",""]},qne={narrow:["","","","","","",""],short:["","","","","","",""],abbreviated:["","","","","","",""],wide:["","","","","","",""]},Yne={narrow:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},abbreviated:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},wide:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""}},Jne={narrow:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},abbreviated:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},wide:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""}},Xne=(t,e)=>{const n=Number(t);switch(e==null?void 0:e.unit){case"date":return n+"";case"hour":return n+"";case"minute":return n+"";case"second":return n+"";default:return" "+n}},Qne={ordinalNumber:Xne,era:uo({values:Wne,defaultWidth:"wide"}),quarter:uo({values:Kne,defaultWidth:"wide",argumentCallback:t=>t-1}),month:uo({values:Gne,defaultWidth:"wide"}),day:uo({values:qne,defaultWidth:"wide"}),dayPeriod:uo({values:Yne,defaultWidth:"wide",formattingValues:Jne,defaultFormattingWidth:"wide"})},Zne=/^(\s*)?\d+(|||)?/i,ere=/\d+/i,tre={narrow:/^()/i,abbreviated:/^()/i,wide:/^(|)/i},nre={any:[/^()/i,/^()/i]},rre={narrow:/^[1234]/i,abbreviated:/^[]/i,wide:/^[]/i},sre={any:[/(1|)/i,/(2|)/i,/(3|)/i,/(4|)/i]},ire={narrow:/^(|||||||||[])/i,abbreviated:/^(|||||||||[]|\d|1[12])/i,wide:/^(|||||||||[])/i},ore={narrow:[/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^(?!(|))/i,/^/i,/^/i],any:[/^|1/i,/^|2/i,/^|3/i,/^|4/i,/^|5/i,/^|6/i,/^|7/i,/^|8/i,/^|9/i,/^(?!(|))|10/i,/^|11/i,/^|12/i]},are={narrow:/^[]/i,short:/^[]/i,abbreviated:/^[]/i,wide:/^[]/i},lre={any:[//i,//i,//i,//i,//i,//i,//i]},cre={any:/^(?|?||[]|?||?|)/i},ure={any:{am:/^?/i,pm:/^?/i,midnight:/^/i,noon:/^[]/i,morning:/^/i,afternoon:/^/i,evening:/^?/i,night:/^/i}},dre={ordinalNumber:$R({matchPattern:Zne,parsePattern:ere,valueCallback:t=>parseInt(t,10)}),era:fo({matchPatterns:tre,defaultMatchWidth:"wide",parsePatterns:nre,defaultParseWidth:"any"}),quarter:fo({matchPatterns:rre,defaultMatchWidth:"wide",parsePatterns:sre,defaultParseWidth:"any",valueCallback:t=>t+1}),month:fo({matchPatterns:ire,defaultMatchWidth:"wide",parsePatterns:ore,defaultParseWidth:"any"}),day:fo({matchPatterns:are,defaultMatchWidth:"wide",parsePatterns:lre,defaultParseWidth:"any"}),dayPeriod:fo({matchPatterns:cre,defaultMatchWidth:"any",parsePatterns:ure,defaultParseWidth:"any"})},bE={code:"zh-TW",formatDistance:$ne,formatLong:Une,formatRelative:Vne,localize:Qne,match:dre,options:{weekStartsOn:1,firstWeekContainsDate:4}},cs=64,UR=({onClose:t,isStandalone:e=!1})=>{const n=x.useContext(En),{tasks:r,tags:s,updateTask:i,addTask:o,user:a,setEditingTaskId:l,editingTaskId:u,setToast:d}=n,[f,h]=x.useState(()=>localStorage.getItem("heart_view_mode")||"schedule"),[p,m]=x.useState(()=>{const X=localStorage.getItem("heart_selected_date");return X?ws(X):new Date}),y=x.useRef(localStorage.getItem("heart_last_moment_id"));x.useEffect(()=>{localStorage.setItem("heart_view_mode",f)},[f]),x.useEffect(()=>{f==="schedule"&&localStorage.setItem("heart_selected_date",p.toISOString())},[p,f]);const[b,g]=x.useState(()=>{const X=localStorage.getItem("heart_schedule_tags");return X?JSON.parse(X):[]}),[v,w]=x.useState(!1),[T,R]=x.useState(!1),[k,M]=x.useState([]),[S,C]=x.useState(!1),[_,E]=x.useState(null),[I,P]=x.useState(null),[O,$]=x.useState(null),[A,j]=x.useState(!1),[W,V]=x.useState(null),[D,ge]=x.useState(!1),[me,F]=x.useState([]),[U,ne]=x.useState(null),Oe=S?me:s,at=()=>S?Oe.find(X=>X.name.includes("-Wei")):Oe.find(X=>X.name==="Google:")||Oe.find(X=>X.name.includes("Google:"))||Oe.find(X=>X.name.includes("")&&X.name.toLowerCase().includes("google"))||Oe.find(X=>X.name.includes("")),ae=X=>{const je=(X.tags||[]).some(He=>{const Ye=Oe.find(ee=>ee.id===He);return Ye&&Ye.name.includes("-Wei")});return S?je?{canEdit:!0}:{canEdit:!1,reason:"Guest -Wei"}:je?{canEdit:!1,reason:"-Wei Guest "}:{canEdit:!0}},_e=x.useRef(null);x.useEffect(()=>{_e.current&&(_e.current.scrollTop=8*cs-20)},[e]),x.useEffect(()=>{var ee;const X=window.location.pathname,Fe=new URLSearchParams(window.location.search);if(X.includes("/share/heart/s/")){const Pe=(ee=X.split("/s/")[1])==null?void 0:ee.split("/")[0];if(Pe&&ve){ve.from("schedule_snapshots").select("data, created_by").eq("id",Pe).single().then(({data:et,error:_t})=>{if(et){if(et.created_by&&ne(et.created_by),et.data){const{tasks:Vt,tags:Ft,date:nn}=et.data;Vt&&M(Vt),Ft&&F(Ft),nn&&m(ws(nn)),C(!0)}}else _t&&console.error("Error loading snapshot:",_t)});return}}const je=Fe.get("date"),He=Fe.get("tags"),Ye=Fe.get("d");if(je&&m(ws(je)),He)try{const xe=JSON.parse(decodeURIComponent(He));Array.isArray(xe)&&F(xe)}catch(xe){console.error("Failed to parse tags",xe)}if(Ye)try{const xe=decodeURIComponent(Ye);let Pe;try{Pe=JSON.parse(xe)}catch{console.warn("Direct JSON parse failed")}Pe&&Array.isArray(Pe)&&(M(Pe),C(!0))}catch(xe){console.error("Failed to parse snapshot data",xe)}},[]),x.useEffect(()=>{let X=U;if(!X&&S){const Ye=window.location.pathname.split("/"),ee=Ye.indexOf("heart"),xe=ee!==-1&&Ye[ee+1]?Ye[ee+1]:null;xe&&xe!=="share"&&xe!=="s"&&(X=xe)}if(!S||!ve||!X)return;console.log("[GuestRealtime] Initializing sync for Owner:",X);const Fe=async()=>{try{const{data:Ye,error:ee}=await ve.from("tasks").select("*").eq("user_id",X).neq("status","deleted");Ye&&(console.log("[GuestRealtime] Loaded tasks:",Ye.length),M(Ye));const{data:xe,error:Pe}=await ve.from("tags").select("*").eq("user_id",X);xe&&F(xe)}catch(Ye){console.error("[GuestRealtime] Error loading initial data:",Ye)}},je=ve.channel(`guest-tasks-${X}`).on("postgres_changes",{event:"*",schema:"public",table:"tasks",filter:`user_id=eq.${X}`},Ye=>{const{eventType:ee,new:xe,old:Pe}=Ye;M(et=>ee==="INSERT"?et.some(_t=>_t.id===xe.id)?et:[...et,xe]:ee==="UPDATE"?et.map(_t=>_t.id===xe.id?{..._t,...xe}:_t):ee==="DELETE"?et.filter(_t=>_t.id!==Pe.id):et)}).subscribe(Ye=>{Ye==="SUBSCRIBED"&&Fe()}),He=ve.channel(`guest-tags-${X}`).on("postgres_changes",{event:"*",schema:"public",table:"tags",filter:`user_id=eq.${X}`},Ye=>{const{eventType:ee,new:xe,old:Pe}=Ye;F(et=>ee==="INSERT"?et.some(_t=>_t.id===xe.id)?et:[...et,xe]:ee==="UPDATE"?et.map(_t=>_t.id===xe.id?{..._t,...xe}:_t):ee==="DELETE"?et.filter(_t=>_t.id!==Pe.id):et)}).subscribe();return()=>{ve.removeChannel(je),ve.removeChannel(He)}},[S,U]),x.useEffect(()=>{S&&k.length>0&&r.length>0&&M(X=>X.map(Fe=>{const je=r.find(He=>He.id===Fe.id);return je?{...Fe,...je}:Fe}))},[r]);const le=x.useMemo(()=>{if(!S)return null;if(U)return U;const X=window.location.pathname.split("/"),Fe=X.indexOf("heart");if(Fe!==-1&&X[Fe+1]){const je=X[Fe+1];return je==="share"||je==="s"?null:je}return null},[S,U]),Ce=x.useRef({past:[],future:[]}),Le=x.useRef(!1),Ve=X=>{if(Le.current)return;const Fe=[...Ce.current.past,JSON.parse(JSON.stringify(X))];Fe.length>20&&Fe.shift(),Ce.current.past=Fe,Ce.current.future=[]},st=async(X,Fe)=>{if(!ve)return;const je=new Map(X.map(Ye=>[Ye.id,Ye])),He=new Map(Fe.map(Ye=>[Ye.id,Ye]));for(const Ye of Fe){const ee=je.get(Ye.id);if(!ee)console.log("[GuestUndo] Restoring task:",Ye.id),await ve.from("tasks").update({status:"inbox"}).eq("id",Ye.id);else if(Ye.title!==ee.title||Ye.start_date!==ee.start_date||Ye.start_time!==ee.start_time||Ye.end_time!==ee.end_time||Ye.duration!==ee.duration||Ye.status!==ee.status){console.log("[GuestUndo] Reverting update for:",Ye.id);const{id:Pe,user_id:et,created_at:_t,...Vt}=Ye;await ve.from("tasks").update(Vt).eq("id",Pe)}}for(const Ye of X)He.has(Ye.id)||(console.log("[GuestUndo] Deleting added task:",Ye.id),await ve.from("tasks").delete().eq("id",Ye.id))},Be=x.useMemo(()=>{const X=je=>{if(je.start_date&&!je.is_all_day&&(!je.start_time||!je.end_time)){const He={...je},Ye=new Date(je.start_date),ee=Ye.getHours()*60+Ye.getMinutes();if(He.start_time||(He.start_time=qe(ee)),!He.end_time&&(He.duration||je.duration)){const xe=Number(He.duration||je.duration);He.end_time=qe(ee+xe)}return He}return je},Fe={...n};return{...Fe,tasks:S?k:r,tags:Oe,undo:async()=>{if(!S)return Fe.undo();if(Ce.current.past.length===0)return;Le.current=!0;const je=Ce.current.past.pop();je&&(Ce.current.future.push(JSON.parse(JSON.stringify(k))),await st(k,je),M(je)),Le.current=!1},redo:async()=>{if(!S)return Fe.redo();if(Ce.current.future.length===0)return;Le.current=!0;const je=Ce.current.future.pop();je&&(Ce.current.past.push(JSON.parse(JSON.stringify(k))),await st(k,je),M(je)),Le.current=!1},canUndo:S?Ce.current.past.length>0:Fe.canUndo,canRedo:S?Ce.current.future.length>0:Fe.canRedo,updateTask:async(je,He,Ye)=>{var xe;if(je==="new"){P(Pe=>({...Pe,...He}));return}if(Ve(k),S){const Pe=k.find(et=>et.id===je);if(Pe&&!((xe=Pe.tags)==null?void 0:xe.some(_t=>{var Ft;const Vt=Oe.find(nn=>nn.id===_t);return(Ft=Vt==null?void 0:Vt.name)==null?void 0:Ft.includes("-Wei")}))){alert(" Wei");return}}const ee=X(He);if(S&&le&&ve){console.log("[Guest] Updating task:",je,ee);const{error:Pe}=await ve.from("tasks").update(ee).eq("id",je);if(Pe){alert(`: ${Pe.message}
`),console.error("Guest Update Error:",Pe);return}}else await i(je,ee,Ye);S&&M(Pe=>Pe.map(et=>et.id===je?{...et,...ee}:et))},addTask:async(je,He)=>{Ve(k);const Ye=X(je);let ee=je.id||`guest-${Date.now()}`;je.id||(ee=crypto.randomUUID?crypto.randomUUID():`guest-${Date.now()}`);try{if(S&&le&&ve){if(!le)return alert(` ID (URL ID: ${le})`),"";let xe=Ye.tags||[];if(xe.length===0){const _t=Oe.find(Vt=>Vt.name.includes("-Wei"))||Oe.find(Vt=>Vt.name.toLowerCase().includes("wei")&&!Vt.name.toLowerCase().includes("google"));if(_t)xe=[_t.id];else if(b.length>0)xe=b;else if(Oe.length>0){const Vt=Oe.find(Ft=>!Ft.name.toLowerCase().includes("google"));xe=[Vt?Vt.id:Oe[0].id]}}const Pe={...Ye,id:ee,user_id:le,created_at:new Date().toISOString(),status:"todo",tags:xe};console.log("[Guest] Inserting task for owner:",le,Pe);const{error:et}=await ve.from("tasks").insert([Pe]).select();if(et)throw et;d==null||d({msg:"",type:"info"})}else ee=await o(Ye,He)}catch(xe){if(console.warn("Guest addTask failed",xe),alert(`: ${(xe==null?void 0:xe.message)||""}`),!S)return""}if(S){const xe={id:ee,...Ye,user_id:le};M(Pe=>[...Pe,xe])}return ee},deleteTask:async je=>{var He;if(Ve(k),S){const Ye=k.find(ee=>ee.id===je);if(Ye&&!((He=Ye.tags)==null?void 0:He.some(xe=>{var et;const Pe=Oe.find(_t=>_t.id===xe);return(et=Pe==null?void 0:Pe.name)==null?void 0:et.includes("-Wei")}))){d==null||d({msg:" Wei",type:"error"});return}}if(S&&le&&ve){console.log("[Guest] Deleting task (soft):",je);const{error:Ye}=await ve.from("tasks").update({status:"deleted"}).eq("id",je);Ye?(alert(`: ${Ye.message}`),console.error("Guest Delete Error:",Ye)):d==null||d({msg:"",type:"info"})}else await n.deleteTask(je);S&&(M(Ye=>Ye.filter(ee=>ee.id!==je)),O===je&&$(null))}}},[n,S,k,Oe,le,ve,O,d]),ht=Be.undo,vt=Be.redo,te=Be.canUndo,Z=Be.canRedo,ie=Be.addTask,he=Be.updateTask,se=Be.deleteTask;x.useEffect(()=>{if(!S)return;const X=Fe=>{(Fe.metaKey||Fe.ctrlKey)&&Fe.key==="z"&&!Fe.shiftKey&&(Fe.preventDefault(),ht()),((Fe.metaKey||Fe.ctrlKey)&&Fe.key==="z"&&Fe.shiftKey||(Fe.metaKey||Fe.ctrlKey)&&Fe.key==="y")&&(Fe.preventDefault(),vt())};return window.addEventListener("keydown",X),()=>window.removeEventListener("keydown",X)},[S,ht,vt]);const Q=X=>{g(Fe=>{const je=Fe.includes(X)?Fe.filter(He=>He!==X):[...Fe,X];return localStorage.setItem("heart_schedule_tags",JSON.stringify(je)),je})};x.useEffect(()=>{const X=async Fe=>{var He;if(!O||u)return;const je=(He=document.activeElement)==null?void 0:He.tagName;if(!(je==="INPUT"||je==="TEXTAREA"||document.activeElement.isContentEditable)&&(Fe.key==="Delete"||Fe.key==="Backspace")){if(Fe.preventDefault(),S){const ee=k.find(xe=>xe.id===O);if(ee){const xe=ae(ee);if(!xe.canEdit){d==null||d({msg:xe.reason||"",type:"error"});return}}}const Ye=O;await Be.deleteTask(Ye),$(null)}};return window.addEventListener("keydown",X),()=>window.removeEventListener("keydown",X)},[O,u,Be]);const ke=x.useMemo(()=>S?k.filter(He=>{if(He.status==="deleted")return!1;let Ye=null;return He.start_date?Ye=ws(He.start_date):He.due_date&&(Ye=ws(He.due_date)),!Ye||!Qh(Ye,p)?!1:b.length===0?!0:!He.tags||He.tags.length===0?!1:He.tags.some(ee=>b.includes(ee))}):(!r.some(He=>{const Ye=He.start_date?ws(He.start_date):He.due_date?ws(He.due_date):null;return Ye&&Qh(Ye,p)&&He.status!=="deleted"})&&k.length>0?k:r).filter(He=>{if(He.status==="deleted")return!1;let Ye=null;return He.start_date?Ye=ws(He.start_date):He.due_date&&(Ye=ws(He.due_date)),!Ye||!Qh(Ye,p)?!1:b.length===0?!0:!He.tags||He.tags.length===0?!1:He.tags.some(ee=>b.includes(ee))}),[r,p,b,k,S]),Me=x.useMemo(()=>ke.filter(X=>X.is_all_day||!X.start_time),[ke]),fe=x.useMemo(()=>ke.filter(X=>!X.is_all_day&&X.start_time),[ke]),Re=X=>{if(!X)return 0;const[Fe,je]=X.split(":").map(Number);return Fe*60+je},qe=X=>{const Fe=Math.floor(X/60),je=Math.floor(X%60);return`${String(Fe).padStart(2,"0")}:${String(je).padStart(2,"0")}`},xt=X=>{const Fe=Re(X.start_time);let je=X.duration||60;const He=Fe/60*cs,Ye=je/60*cs;return{top:`${He}px`,height:`${Math.max(24,Ye)}px`}},Dt=X=>{if(X.length===0)return{};const Fe=X.map(xe=>({id:xe.id,start:Re(xe.start_time),end:Re(xe.start_time)+(xe.duration||60)})).sort((xe,Pe)=>xe.start-Pe.start),je=[];let He=[],Ye=-1;Fe.forEach(xe=>{He.length===0?(He.push(xe),Ye=xe.end):xe.start<Ye?(He.push(xe),Ye=Math.max(Ye,xe.end)):(je.push(He),He=[xe],Ye=xe.end)}),He.length>0&&je.push(He);const ee={};return je.forEach(xe=>{const Pe=[];xe.forEach(nn=>{let Xt=!1;for(let Jt=0;Jt<Pe.length;Jt++){const fn=Pe[Jt],yn=fn[fn.length-1];if(nn.start>=yn.end){fn.push(nn),Xt=!0;break}}Xt||Pe.push([nn])});const _t=100/Pe.length,Vt={},Ft=[];xe.forEach(nn=>{let Xt=!1;for(let Jt=0;Jt<Ft.length;Jt++){const fn=Ft[Jt],yn=fn[fn.length-1];if(nn.start>=yn.end){fn.push(nn),Vt[nn.id]=Jt,Xt=!0;break}}Xt||(Ft.push([nn]),Vt[nn.id]=Ft.length-1)}),xe.forEach(nn=>{const Xt=Vt[nn.id];ee[nn.id]={left:`${Xt*_t}%`,width:`${_t}%`}})}),ee},[oe,Ee]=x.useState(null),Ue=x.useRef(oe);x.useEffect(()=>{Ue.current=oe},[oe]);const tt=x.useRef(null),Ne=x.useRef(null),pt=()=>{Ne.current&&(window.removeEventListener("touchmove",Ne.current.move),window.removeEventListener("touchend",Ne.current.end),window.removeEventListener("touchcancel",Ne.current.end),Ne.current=null)},dt=(X,Fe,je)=>{var Vt;if(S&&(je==="move"||je==="resize")&&!((Vt=Fe.tags)==null?void 0:Vt.some(nn=>{var Jt;const Xt=Oe.find(fn=>fn.id===nn);return(Jt=Xt==null?void 0:Xt.name)==null?void 0:Jt.includes("-Wei")})))return;const He=X.touches[0],Ye=He.clientX,ee=He.clientY,xe=Re(Fe.start_time),Pe=Fe.duration||60;tt.current&&clearTimeout(tt.current);const et=()=>{tt.current&&(clearTimeout(tt.current),tt.current=null),window.removeEventListener("touchmove",_t),window.removeEventListener("touchend",et),window.removeEventListener("touchcancel",et)},_t=Ft=>{const nn=Ft.touches[0].clientX,Xt=Ft.touches[0].clientY;(Math.abs(nn-Ye)>10||Math.abs(Xt-ee)>10)&&et()};tt.current=setTimeout(()=>{navigator.vibrate&&navigator.vibrate(50),et(),pt(),Ee({taskId:Fe.id,initialY:ee,originalStartMin:xe,originalDuration:Pe,type:je,currentStartMin:xe,currentDuration:Pe,isTouch:!0});const Ft=Xt=>{Xt.cancelable&&Xt.preventDefault();const fn=(Xt.touches?Xt.touches[0].clientY:0)-ee,yn=Math.round(fn/cs*60/15)*15;if(je==="move"){let _n=xe+yn;_n=Math.max(0,Math.min(1440-Pe,_n)),Ee(Fn=>Fn?{...Fn,currentStartMin:_n}:null)}else{let _n=Pe+yn;_n=Math.max(15,_n),Ee(Fn=>Fn?{...Fn,currentDuration:_n}:null)}},nn=()=>{try{const Xt=Ue.current;if(Xt&&Xt.taskId===Fe.id){const{currentStartMin:Jt,currentDuration:fn}=Xt,yn=ae(Fe);if(!yn.canEdit){d==null||d({msg:yn.reason||"",type:"error"});return}const _n=qe(Jt),Fn=qe(Jt+fn),Hn=new Date(p);Hn.setHours(Math.floor(Jt/60)),Hn.setMinutes(Jt%60);const is={start_time:_n,duration:fn,end_time:Fn,start_date:Hn.toISOString()};i(Fe.id,is),S&&M(Gs=>Gs.map(ui=>ui.id===Fe.id?{...ui,...is}:ui))}}finally{Ee(null),pt()}};Ne.current={move:Ft,end:nn},window.addEventListener("touchmove",Ft,{passive:!1}),window.addEventListener("touchend",nn),window.addEventListener("touchcancel",nn)},1e3),window.addEventListener("touchmove",_t),window.addEventListener("touchend",et),window.addEventListener("touchcancel",et)},Et=(X,Fe,je)=>{var Ye;if(X.stopPropagation(),X.preventDefault(),S&&(je==="move"||je==="resize")&&!((Ye=Fe.tags)==null?void 0:Ye.some(xe=>{var et;const Pe=Oe.find(_t=>_t.id===xe);return(et=Pe==null?void 0:Pe.name)==null?void 0:et.includes("-Wei")}))){d==null||d({msg:" Wei",type:"error"});return}const He=Re(Fe.start_time);Ee({taskId:Fe.id,initialY:X.clientY,originalStartMin:He,originalDuration:Fe.duration||60,type:je,currentStartMin:He,currentDuration:Fe.duration||60})},ue=(X,Fe)=>{X.dataTransfer.setData("text/plain",Fe.id),X.dataTransfer.setData("from-allday","true")},Se=async X=>{X.preventDefault();const Fe=X.dataTransfer.getData("text/plain");if(X.dataTransfer.getData("from-allday"),!Fe)return;const je=X.currentTarget.getBoundingClientRect(),He=X.currentTarget.scrollTop||0,Ye=X.clientY-je.top+He,ee=Math.floor(Ye/cs*60/15)*15,xe=(S?k:r).find(_t=>_t.id===Fe),Pe=(xe==null?void 0:xe.duration)||60,et=new Date(p);et.setHours(Math.floor(ee/60)),et.setMinutes(ee%60),await Be.updateTask(Fe,{start_date:et.toISOString(),start_time:qe(ee),end_time:qe(ee+Pe),duration:Pe,is_all_day:!1})},nt=async X=>{X.preventDefault();const Fe=X.dataTransfer.getData("text/plain");Fe&&await Be.updateTask(Fe,{start_date:p.toISOString(),is_all_day:!0,start_time:null,end_time:null,duration:null})},ft=X=>{X.preventDefault(),X.dataTransfer.dropEffect="move"},ct=X=>{$(null);const Fe=X.currentTarget.getBoundingClientRect(),je=X.clientY-Fe.top,He=Math.floor(je/cs*60/15)*15;if(window.innerWidth<768){const Ye=new Date(p);Ye.setHours(Math.floor(He/60)),Ye.setMinutes(He%60);const ee=at(),xe=ee?[ee.id]:[],Pe={id:"new",title:"",start_time:qe(He),duration:60,end_time:qe(He+60),start_date:ks(p,"yyyy-MM-dd"),is_all_day:!1,tags:xe};P(Pe),l("new");return}E({startY:X.clientY,startMin:He,currentDuration:60})};x.useEffect(()=>{if((!oe||oe.isTouch)&&!_)return;const X=Pe=>{if(oe){const et=Pe-oe.initialY,_t=Math.round(et/cs*60/15)*15;if(oe.type==="move"){let Vt=oe.originalStartMin+_t;Vt=Math.max(0,Math.min(1440-oe.currentDuration,Vt)),Ee(Ft=>Ft?{...Ft,currentStartMin:Vt}:null)}else{let Vt=oe.originalDuration+_t;Vt=Math.max(15,Vt),Ee(Ft=>Ft?{...Ft,currentDuration:Vt}:null)}}else if(_){const et=Pe-_.startY;let Vt=60+Math.round(et/cs*60/15)*15;Vt<15&&(Vt=15),E(Ft=>Ft?{...Ft,currentDuration:Vt}:null)}},Fe=()=>{if(oe){const{taskId:Pe,currentStartMin:et,currentDuration:_t}=oe,Vt=(S?k:r).find(fn=>fn.id===Pe);if(Vt){const fn=ae(Vt);if(!fn.canEdit){d==null||d({msg:fn.reason||"",type:"error"}),Ee(null);return}}const Ft=qe(et),nn=qe(et+_t),Xt=new Date(p);Xt.setHours(Math.floor(et/60)),Xt.setMinutes(et%60);const Jt={start_time:Ft,duration:_t,end_time:nn,start_date:Xt.toISOString()};i(Pe,Jt),S&&M(fn=>fn.map(yn=>yn.id===Pe?{...yn,...Jt}:yn)),Ee(null)}else if(_){const Pe=new Date(p);Pe.setHours(Math.floor(_.startMin/60)),Pe.setMinutes(_.startMin%60);const et=at(),_t=et?[et.id]:[],Vt={id:"new",title:"",start_time:qe(_.startMin),duration:_.currentDuration,end_time:qe(_.startMin+_.currentDuration),start_date:Pe.toISOString(),is_all_day:!1,tags:_t};P(Vt),l("new"),E(null)}},je=Pe=>X(Pe.clientY),He=()=>Fe(),Ye=Pe=>{Pe.cancelable&&Pe.preventDefault(),X(Pe.touches[0].clientY)},ee=()=>Fe(),xe=()=>Fe();return window.addEventListener("mousemove",je),window.addEventListener("mouseup",He),window.addEventListener("touchmove",Ye,{passive:!1}),window.addEventListener("touchend",ee),window.addEventListener("touchcancel",xe),()=>{window.removeEventListener("mousemove",je),window.removeEventListener("mouseup",He),window.removeEventListener("touchmove",Ye),window.removeEventListener("touchend",ee),window.removeEventListener("touchcancel",xe)}},[oe,_,p,i,S,s]);const Qe=x.useRef(null),It=x.useRef({x:0,y:0}),Lt=x.useRef(!1),J=x.useRef(0),ye=x.useRef(60),Ge=X=>{pt(),oe&&Ee(null),$(null)},kt=X=>{const Fe=X.touches[0];if(Lt.current&&_e.current){const Ye=_e.current.getBoundingClientRect(),ee=_e.current.scrollTop;let et=(Fe.clientY-Ye.top+ee)/cs*60-J.current;et<15&&(et=15),et=Math.round(et/15)*15,ye.current=et,E(_t=>_t&&{..._t,currentDuration:et});return}const je=Math.abs(Fe.clientX-It.current.x),He=Math.abs(Fe.clientY-It.current.y);(je>10||He>10)&&Qe.current&&(clearTimeout(Qe.current),Qe.current=null)},Y=()=>{if(Qe.current&&(clearTimeout(Qe.current),Qe.current=null),Lt.current){Lt.current=!1;const X=J.current,Fe=ye.current,je=qe(X),He=qe(X+Fe),Ye=Oe.find(xe=>xe.name.includes("-Wei"))||Oe.find(xe=>xe.name.toLowerCase().includes("wei")&&!xe.name.toLowerCase().includes("google")),ee=Ye?[Ye.id]:[];P({title:"",start_time:je,end_time:He,start_date:ks(p,"yyyy-MM-dd"),duration:Fe,is_all_day:!1,tags:ee}),l("new"),E(null)}},ze=async()=>{ge(!0);const X=ke;if(X.length===0&&!confirm("")){ge(!1);return}const Fe=X.map(Ft=>({id:Ft.id,title:Ft.title,start_time:Ft.start_time,end_time:Ft.end_time,status:Ft.status,tags:Ft.tags,duration:Ft.duration,start_date:Ft.start_date})),je=new Set(Fe.flatMap(Ft=>Ft.tags||[])),He=s.find(Ft=>Ft.name.includes("-Wei"));He&&je.add(He.id);const Ye=s.filter(Ft=>je.has(Ft.id)).map(Ft=>({id:Ft.id,name:Ft.name,color:Ft.color}));if(a&&ve)try{const Ft=ks(p,"yyyy-MM-dd"),{data:nn,error:Xt}=await ve.from("schedule_snapshots").insert({data:{tasks:Fe,tags:Ye,date:Ft},created_by:a.id,title:`Heart Schedule - ${Ft}`}).select("id").single();if(nn&&!Xt){const Jt=`${window.location.origin}/share/heart/s/${nn.id}`;V(Jt),navigator.clipboard.writeText(Jt).catch(()=>console.warn("Auto-copy failed")),ge(!1);return}else console.error("Snapshot Creation Error:",Xt)}catch(Ft){console.error("Snapshot Exception:",Ft)}const ee=JSON.stringify(Ye),xe=encodeURIComponent(ee),Pe=JSON.stringify(Fe),et=encodeURIComponent(Pe),_t=ks(p,"yyyy-MM-dd"),Vt=`${window.location.origin}/share/heart/${(a==null?void 0:a.id)||"share"}?date=${_t}&d=${et}&tags=${xe}`;V(Vt),navigator.clipboard.writeText(Vt).catch(()=>{}),ge(!1)},lt=x.useMemo(()=>{const X=fe.map(Fe=>oe&&oe.taskId===Fe.id?{...Fe,start_time:qe(oe.currentStartMin),duration:oe.currentDuration}:Fe);return Dt(X)},[fe,oe]);return c.jsxs("div",{className:"fixed inset-0 z-[1000] bg-white/95 backdrop-blur-xl flex flex-col overflow-hidden font-sans text-gray-800",children:[c.jsx("div",{className:"absolute top-0 right-0 w-[50vh] h-[50vh] bg-pink-200/20 rounded-full blur-[100px] pointer-events-none"}),c.jsx("div",{className:"absolute bottom-0 left-0 w-[50vh] h-[50vh] bg-purple-200/20 rounded-full blur-[100px] pointer-events-none"}),c.jsxs("header",{className:"flex-shrink-0 px-3 py-2 md:px-6 md:py-4 flex items-center justify-between relative z-10 bg-white/50 backdrop-blur-sm border-b border-pink-100",children:[!e&&t&&c.jsx("button",{onClick:t,className:"p-1 md:p-2 rounded-full hover:bg-gray-100 text-gray-500",children:c.jsx(un,{size:18,className:"md:w-5 md:h-5"})}),e&&c.jsx("div",{className:"w-8 md:w-10"}),c.jsxs("div",{className:"flex bg-gray-100/50 p-1 rounded-full items-center",children:[c.jsxs("button",{onClick:()=>h("schedule"),className:`
                            flex items-center gap-1 md:gap-2 px-3 py-1.5 rounded-full transition-all text-sm font-bold
                            ${f==="schedule"?"bg-white shadow-sm text-pink-500":"text-gray-400 hover:text-gray-600"}
                        `,children:[c.jsx(ou,{size:16,className:f==="schedule"?"fill-pink-500":""}),c.jsx("span",{className:f==="schedule"?"":"hidden md:inline",children:""})]}),c.jsxs("button",{onClick:()=>h("moments"),className:`
                            flex items-center gap-1 md:gap-2 px-3 py-1.5 rounded-full transition-all text-sm font-bold
                            ${f==="moments"?"bg-white shadow-sm text-purple-600":"text-gray-400 hover:text-gray-600"}
                        `,children:[c.jsx(CI,{size:16,className:f==="moments"?"fill-purple-200 text-purple-600":""}),c.jsx("span",{className:f==="moments"?"":"hidden md:inline",children:""})]})]}),c.jsxs("div",{className:"flex items-center gap-1 md:gap-2 hidden",children:[c.jsx(ou,{className:"text-pink-500 fill-pink-500 animate-pulse md:w-6 md:h-6",size:20}),c.jsx("span",{className:"hidden md:inline text-lg font-bold tracking-wide bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent",children:"Our Time"}),c.jsx("span",{className:"md:hidden text-base font-bold text-pink-500",children:"Our Time"})]}),c.jsxs("div",{className:"flex gap-1 md:gap-2 items-center",children:[c.jsx("button",{onClick:()=>ht(),disabled:!te,className:`p-1 md:p-2 rounded-full transition-colors ${te?"hover:bg-gray-100 text-gray-700":"text-gray-300 cursor-not-allowed"}`,title:" (Ctrl+Z)",children:c.jsx(Dg,{size:16,className:"md:w-[18px] md:h-[18px]"})}),c.jsx("button",{onClick:()=>vt(),disabled:!Z,className:`p-1 md:p-2 rounded-full transition-colors ${Z?"hover:bg-gray-100 text-gray-700":"text-gray-300 cursor-not-allowed"}`,title:" (Ctrl+Shift+Z)",children:c.jsx(Mv,{size:16,className:"md:w-[18px] md:h-[18px]"})}),c.jsx("button",{onClick:()=>w(!v),className:`p-1 md:p-2 rounded-full transition-colors ${v?"bg-pink-100 text-pink-600":"hover:bg-gray-100 text-gray-500"}`,children:c.jsx(HI,{size:18,className:"md:w-5 md:h-5"})}),c.jsx("button",{onClick:()=>R(!0),className:"p-1 md:p-2 rounded-full bg-pink-50 text-pink-500 hover:bg-pink-100",children:c.jsx(Uz,{size:18,className:"md:w-5 md:h-5"})})]})]}),f==="schedule"?c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex items-center justify-between px-6 py-2 relative z-10 bg-white/30 backdrop-blur-sm border-b border-gray-100",children:[c.jsx("button",{onClick:()=>m(bne(p,1)),className:"p-1 text-gray-400 hover:text-pink-500",children:c.jsx(Ou,{size:18})}),c.jsxs("div",{className:"text-center cursor-pointer",onClick:()=>m(new Date),children:[c.jsx("div",{className:"text-lg font-bold text-gray-800",children:ks(p,"M d",{locale:bE})}),c.jsx("div",{className:"text-[10px] text-pink-500 font-medium tracking-widest uppercase",children:ks(p,"EEEE",{locale:bE})}),(()=>{const X=NR(p);return X?c.jsxs("div",{className:"text-[10px] text-amber-600 font-bold mt-0.5 tracking-wide",children:[" ",X]}):null})()]}),c.jsx("button",{onClick:()=>m(OR(p,1)),className:"p-1 text-gray-400 hover:text-pink-500",children:c.jsx(rs,{size:18})})]}),c.jsx(bo,{children:v&&c.jsx(Pr.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"overflow-hidden border-b border-gray-100 bg-gray-50/80 backdrop-blur",children:c.jsxs("div",{className:"p-4",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-2 font-medium",children:""}),c.jsx("div",{className:"flex flex-wrap gap-2",children:Oe.map(X=>c.jsx("button",{onClick:()=>Q(X.id),className:`px-3 py-1 rounded-full text-xs transition-all border ${b.includes(X.id)?"bg-pink-500 text-white border-pink-500 shadow-md transform scale-105":"bg-white text-gray-600 border-gray-200"}`,children:X.name},X.id))})]})})}),c.jsxs("div",{ref:_e,className:"flex-1 overflow-y-auto relative z-0 hide-scrollbar scroll-smooth",children:[Me.length>0&&c.jsxs("div",{className:"sticky top-0 z-30 bg-gradient-to-b from-pink-50/90 to-purple-50/90 backdrop-blur-md border-b-2 border-pink-200/50 px-6 py-2",onDragOver:ft,onDrop:nt,onDoubleClick:async()=>{const X=await Be.addTask({title:"",start_date:p.toISOString(),is_all_day:!0,status:"inbox"});l(X)},children:[c.jsxs("div",{className:"text-[10px] font-bold text-pink-600 uppercase tracking-wider flex items-center gap-1.5 cursor-pointer select-none",onClick:()=>j(!A),children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-pink-500"}),"",c.jsx("span",{className:"text-pink-400 ml-auto",children:A?c.jsx(yp,{size:14}):c.jsx(ts,{size:14})})]}),A&&c.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Me.map(X=>{var je;const Fe=((je=s.find(He=>{var Ye;return(Ye=X.tags)==null?void 0:Ye.includes(He.id)}))==null?void 0:je.color)||"#ec4899";return c.jsx("div",{draggable:!0,onDragStart:He=>ue(He,X),onClick:()=>{const He=ae(X);if(!He.canEdit){d==null||d({msg:He.reason||"",type:"error"});return}l(X.id)},className:"group relative px-3 py-1.5 rounded-full text-xs font-medium cursor-pointer transition-all hover:shadow-md hover:scale-105 border-2",style:{backgroundColor:Fe+"20",borderColor:Fe+"60",color:Fe},children:c.jsxs("div",{className:"flex items-center gap-1.5",children:[X.status==="completed"&&c.jsx(bf,{size:12,className:"flex-shrink-0"}),c.jsx("span",{className:"truncate max-w-[200px]",children:X.title||"()"})]})},X.id)})})]}),c.jsxs("div",{className:"relative min-h-[1536px] w-full bg-white/40 cursor-crosshair",onMouseDown:ct,onTouchStart:Ge,onTouchMove:kt,onTouchEnd:Y,onDragOver:ft,onDrop:Se,children:[Array.from({length:24}).map((X,Fe)=>c.jsxs("div",{className:"absolute w-full border-t border-gray-100 flex pointer-events-none",style:{top:Fe*cs,height:cs},children:[c.jsxs("div",{className:"w-14 text-[10px] text-gray-400 font-mono text-right pr-2 -mt-2 select-none",children:[Fe.toString().padStart(2,"0"),":00"]}),c.jsx("div",{className:"flex-1 border-l border-gray-50 h-full relative",children:c.jsx("div",{className:"absolute top-1/2 w-full border-t border-gray-50 border-dashed"})})]},Fe)),Qh(new Date,p)&&c.jsx("div",{className:"absolute left-14 right-0 border-t-2 border-red-400 z-20 pointer-events-none flex items-center",style:{top:(new Date().getHours()*60+new Date().getMinutes())/60*cs},children:c.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full -ml-1"})}),_&&c.jsx("div",{className:"absolute left-16 right-2 bg-pink-100/50 border-2 border-pink-400 border-dashed rounded-xl z-30 pointer-events-none",style:{top:`${_.startMin/60*cs}px`,height:`${_.currentDuration/60*cs}px`},children:c.jsxs("div",{className:"p-2 text-xs font-bold text-pink-600",children:[qe(_.startMin)," - ",qe(_.startMin+_.currentDuration)," ..."]})}),c.jsx("div",{className:"absolute top-0 right-2 left-16 bottom-0 pointer-events-none",children:fe.map(X=>{const Fe=(oe==null?void 0:oe.taskId)===X.id,je=lt[X.id],He=Fe?{top:`${oe.currentStartMin/60*cs}px`,height:`${oe.currentDuration/60*cs}px`,left:(je==null?void 0:je.left)||"0%",width:(je==null?void 0:je.width)||"100%",zIndex:50}:{...xt(X),left:(je==null?void 0:je.left)||"0%",width:(je==null?void 0:je.width)||"100%"};let Ye="#ec4899";if(X.tags&&X.tags.length>0){const xe=Oe.filter(et=>X.tags.includes(et.id)),Pe=xe.find(et=>et.name.toLowerCase().includes("google"))||xe[0];Pe&&Pe.color&&(Ye=Pe.color)}const ee=X.status==="completed"?{}:{borderColor:Ye,backgroundColor:`${Ye}1A`,borderLeftWidth:"4px",borderLeftColor:Ye};return c.jsxs("div",{style:{...He,...ee},className:`absolute w-full rounded-r-xl rounded-l-md border p-2 text-xs flex flex-col overflow-hidden transition-all shadow-sm group pointer-events-auto
                                        ${X.status==="completed"?"bg-gray-50 border-gray-200 opacity-60":"hover:shadow-md"}
                                        ${Fe?"shadow-xl ring-2 ring-pink-400 opacity-90 cursor-grabbing":"cursor-grab"}
                                        ${O===X.id?"ring-2 ring-pink-500 z-10 shadow-md":""}
                                    `,onClick:xe=>{xe.stopPropagation(),Fe||$(X.id)},onDoubleClick:xe=>{if(xe.stopPropagation(),!Fe){const Pe=ae(X);if(!Pe.canEdit){d==null||d({msg:Pe.reason||"",type:"error"});return}l(X.id),P(null)}},onMouseDown:xe=>{const Pe=ae(X);if(!Pe.canEdit){xe.stopPropagation(),xe.preventDefault(),d==null||d({msg:Pe.reason||"",type:"error"});return}Et(xe,X,"move")},onTouchStart:xe=>dt(xe,X,"move"),children:[O===X.id&&c.jsx("div",{className:"absolute top-1 right-1 p-1.5 bg-red-500 text-white rounded-full shadow-lg z-50 cursor-pointer transform hover:scale-110 active:scale-95 transition-all",onClick:xe=>{xe.stopPropagation();const Pe=ae(X);if(!Pe.canEdit){d==null||d({msg:Pe.reason||"",type:"error"});return}Be.deleteTask(X.id),$(null)},children:c.jsx(Er,{size:14})}),c.jsxs("div",{className:"flex items-start gap-1 font-bold text-gray-800 w-full",children:[c.jsx("div",{className:"w-2 h-2 rounded-full mt-1 shrink-0",style:{backgroundColor:X.status==="completed"?"#9ca3af":Ye}}),c.jsx("span",{className:"whitespace-normal break-words leading-tight w-full",children:X.title}),X.status==="completed"&&c.jsx(bf,{size:12,className:"text-gray-400 shrink-0 mt-0.5"})]}),c.jsx("div",{className:"text-[10px] text-gray-500 truncate shrink-0 font-mono",children:Fe?`${qe(oe.currentStartMin)} - ${qe(oe.currentStartMin+oe.currentDuration)}`:`${X.start_time} - ${X.end_time||qe(Re(X.start_time)+(X.duration||60))}`}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-3 cursor-ns-resize flex items-center justify-center opacity-0 group-hover:opacity-100 hover:bg-black/5",onMouseDown:xe=>{const Pe=ae(X);if(!Pe.canEdit){xe.stopPropagation(),xe.preventDefault(),d==null||d({msg:Pe.reason||"",type:"error"});return}Et(xe,X,"resize")},onTouchStart:xe=>{const Pe=ae(X);if(!Pe.canEdit){xe.stopPropagation(),xe.preventDefault(),d==null||d({msg:Pe.reason||"",type:"error"});return}xe.stopPropagation(),dt(xe,X,"resize")},children:c.jsx(MI,{size:12,className:"text-gray-400"})})]},X.id)})}),Me.length===0&&fe.length===0&&!_&&c.jsxs("div",{className:"absolute top-1/3 left-0 right-0 text-center text-gray-400 pointer-events-none",children:[c.jsx(ou,{size:48,className:"mx-auto mb-2 opacity-20"}),c.jsxs("p",{children:["",c.jsx("br",{}),c.jsx("span",{className:"text-xs opacity-50",children:""})]})]})]})]}),c.jsx("div",{className:"md:hidden fixed bottom-6 right-6 z-[900]",children:c.jsx("button",{onClick:()=>{const X="08:00",Fe="09:00",je=at(),He=je?[je.id]:[];P({title:"",start_time:X,end_time:Fe,start_date:ks(p,"yyyy-MM-dd"),duration:60,is_all_day:!1,tags:He}),l("new")},className:"w-14 h-14 bg-pink-500 rounded-full shadow-lg flex items-center justify-center text-white active:scale-95 transition-transform",children:c.jsx(ni,{size:28})})})]}):c.jsx("div",{className:"flex-1 overflow-y-auto relative custom-scrollbar",children:c.jsx(Pne,{tasks:Be.tasks,tags:Be.tags,isGuest:S,onAddTask:ie,onUpdateTask:he,onDeleteTask:se,scrollRef:y})}),c.jsx(bo,{children:T&&c.jsx("div",{className:"fixed inset-0 z-[1100] bg-black/40 backdrop-blur-sm flex items-center justify-center p-4",children:c.jsxs(Pr.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl",children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsx("h3",{className:"text-xl font-bold",children:""}),c.jsx("button",{onClick:()=>{R(!1),V(null)},children:c.jsx(un,{size:20})})]}),W?c.jsxs("div",{className:"space-y-4",children:[c.jsx("div",{className:"bg-green-50 text-green-700 p-3 rounded-lg text-sm text-center",children:""}),c.jsxs("div",{className:"relative",children:[c.jsx("input",{type:"text",value:W,readOnly:!0,className:"w-full bg-gray-50 border border-gray-200 rounded-lg py-2 px-3 text-sm text-gray-600 pr-10",onClick:X=>X.currentTarget.select()}),c.jsx("button",{onClick:()=>{navigator.clipboard.writeText(W),d==null||d({msg:"",type:"success"})},className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-900",children:c.jsx(d2,{size:16})})]}),c.jsx("button",{onClick:()=>{navigator.clipboard.writeText(W),d==null||d({msg:"",type:"success"})},className:"w-full py-3 bg-gray-900 text-white rounded-xl font-medium",children:""})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"bg-pink-50 rounded-xl p-4 flex flex-col items-center mb-6",children:c.jsxs("p",{className:"text-center text-sm text-gray-600",children:["",c.jsx("br",{}),""]})}),c.jsx("button",{onClick:ze,disabled:D,className:"w-full py-3 bg-gray-900 text-white rounded-xl font-medium flex items-center justify-center gap-2 disabled:opacity-50",children:D?c.jsx(c.Fragment,{children:"..."}):c.jsxs(c.Fragment,{children:[c.jsx(d2,{size:18})," "]})})]})]})})}),u&&c.jsx(En.Provider,{value:Be,children:c.jsx("div",{className:"absolute inset-0 z-[1200]",children:c.jsx(xb,{initialData:u==="new"?I:S?k.find(X=>X.id===u):r.find(X=>X.id===u),isReadOnly:(()=>{if(u==="new")return!1;const X=S?k.find(Fe=>Fe.id===u):r.find(Fe=>Fe.id===u);return X?!ae(X).canEdit:!1})(),onClose:()=>{l(null),P(null)}})})})]})},fre=()=>{const{user:t,logout:e,syncStatus:n,view:r,setView:s,tagFilter:i,setTagFilter:o,tasks:a,tags:l,toast:u,setToast:d,undo:f,redo:h,canUndo:p,canRedo:m,canNavigateBack:y,navigateBack:b,archiveCompletedTasks:g,editingTaskId:v,setEditingTaskId:w,themeSettings:T,sidebarWidth:R,setSidebarWidth:k,sidebarCollapsed:M,selectedTaskIds:S,dragState:C}=x.useContext(En),[_,E]=x.useState(!1),[I,P]=x.useState(!1),[O,$]=x.useState(!1),[A,j]=x.useState(!1),[W,V]=x.useState(!1),[D,ge]=x.useState(!1),[me,F]=x.useState(!1),[U,ne]=x.useState(typeof window<"u"&&window.innerWidth<768);x.useEffect(()=>{const te=()=>ne(window.innerWidth<768);return window.addEventListener("resize",te),()=>window.removeEventListener("resize",te)},[]);const[Oe,at]=x.useState(()=>{const te=localStorage.getItem("fabPosition");return te?JSON.parse(te):{x:window.innerWidth-80,y:window.innerHeight-80}}),[ae,_e]=x.useState(!1),le=x.useRef({x:0,y:0});x.useEffect(()=>{const te=ie=>{if(ae){const he=Math.max(20,Math.min(window.innerWidth-70,ie.clientX-le.current.x)),se=Math.max(20,Math.min(window.innerHeight-70,ie.clientY-le.current.y));at({x:he,y:se})}},Z=()=>{ae&&(_e(!1),localStorage.setItem("fabPosition",JSON.stringify(Oe)))};return window.addEventListener("mousemove",te),window.addEventListener("mouseup",Z),()=>{window.removeEventListener("mousemove",te),window.removeEventListener("mouseup",Z)}},[ae,Oe]);const Ce={small:"text-sm",normal:"text-base",large:"text-lg"}[T.fontSize]||"text-base",Le=T.fontWeight==="thin"?"font-light":"font-bold",Ve=T.fontFamily==="things"?"font-things":"font-sans",st=v?a.find(te=>te.id===v):null;x.useEffect(()=>{const te=Z=>{Z.key==="k"&&(Z.metaKey||Z.ctrlKey)&&(Z.preventDefault(),E(ie=>!ie)),Z.key==="Escape"&&(v?w(null):D?ge(!1):E(!1)),(Z.metaKey||Z.ctrlKey)&&Z.shiftKey&&Z.code==="KeyM"&&S.length>0&&(Z.preventDefault(),ge(!0))};return window.addEventListener("keydown",te),()=>window.removeEventListener("keydown",te)},[v,w,S,D]),x.useEffect(()=>{const te=ie=>{if(!I)return;let he=ie.clientX;he<150&&(he=150),he>400&&(he=400),k(he)},Z=()=>{P(!1),document.body.style.cursor="default"};return I&&(window.addEventListener("mousemove",te),window.addEventListener("mouseup",Z),document.body.style.cursor="col-resize"),()=>{window.removeEventListener("mousemove",te),window.removeEventListener("mouseup",Z)}},[I]);const Be=()=>{var te;return i?((te=l.find(Z=>Z.id===i))==null?void 0:te.name)||"Tags":r==="focus"?"Focus":r.charAt(0).toUpperCase()+r.slice(1)},ht=C!=null&&C.draggedId?a.find(te=>te.id===C.draggedId):null,vt=S.includes((C==null?void 0:C.draggedId)||"")?S.length:1;return c.jsxs("div",{"data-theme":T.themeMode&&T.themeMode!=="light"?T.themeMode:void 0,className:`flex h-screen bg-theme-main text-theme-primary ${Ve} selection:bg-indigo-50 selection:text-indigo-900`,children:[(C==null?void 0:C.isDragging)&&ht&&c.jsx(ote,{task:ht,position:C.ghostPosition,count:vt}),c.jsxs("div",{style:{width:M?64:R},className:`relative flex-shrink-0 hidden md:block transition-all duration-300 ease-in-out ${C!=null&&C.isDragging,"z-10"}`,children:[c.jsx(lE,{view:r,setView:s,tagFilter:i,setTagFilter:o}),!M&&!(C!=null&&C.isDragging)&&c.jsx("div",{className:"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-theme-main/10 transition-colors z-50",onMouseDown:()=>P(!0)})]}),O&&c.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 md:hidden",onClick:()=>$(!1),children:c.jsx("div",{className:"absolute left-0 top-0 h-full w-[280px] bg-theme-sidebar shadow-2xl animate-in slide-in-from-left duration-200",onClick:te=>te.stopPropagation(),children:c.jsx(lE,{view:r,setView:te=>{s(te),$(!1)},tagFilter:i,setTagFilter:te=>{o(te),$(!1)}})})}),c.jsxs("main",{className:"flex-1 flex flex-col relative overflow-hidden bg-theme-main",children:[c.jsxs("header",{"data-app-header":"true",className:"h-14 flex items-center justify-between px-4 md:px-8 border-b border-theme z-30 sticky top-0 bg-theme-header backdrop-blur-sm",children:[c.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[c.jsx("button",{className:"md:hidden p-1 -ml-2 text-theme-secondary hover:bg-theme-hover rounded",onClick:()=>$(!0),children:c.jsx(Az,{size:20})}),y&&c.jsxs("button",{onClick:b,className:"p-1 hover:bg-theme-hover rounded text-theme-secondary flex items-center gap-1 text-sm font-medium transition-colors",title:" (Alt + Left)",children:[c.jsx(jI,{size:16}),c.jsx("span",{className:"hidden md:inline",children:""})]}),y&&c.jsx("span",{className:"text-theme-secondary",children:"|"}),c.jsx("h2",{className:`${Ce} ${Le} tracking-tight text-theme-primary`,children:Be()})]}),c.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[S.length===1&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:()=>j(!0),className:"p-1.5 rounded hover:bg-indigo-500/10 text-indigo-400 transition-colors animate-in zoom-in duration-200 flex items-center gap-1",title:"72 (Mission 72 Transformations)",children:[c.jsx("span",{className:"text-xl leading-none filter drop-shadow-sm",children:""}),c.jsx("span",{className:"hidden lg:inline text-xs font-bold text-indigo-400",children:"72"})]}),c.jsxs("button",{onClick:()=>V(!0),className:"p-1.5 rounded hover:bg-amber-500/10 text-amber-500 transition-colors animate-in zoom-in duration-200 flex items-center gap-1",title:"GTD ",children:[c.jsx("span",{className:"text-xl leading-none filter drop-shadow-sm",children:""}),c.jsx("span",{className:"hidden lg:inline text-xs font-bold text-amber-600",children:""})]})]}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1"}),c.jsxs("button",{onClick:g,className:"p-1.5 rounded hover:bg-theme-hover text-theme-tertiary hover:text-emerald-500 transition-colors",title:" (Archive Completed)",children:[" ",c.jsx(am,{size:16})," "]}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1"}),c.jsx("button",{disabled:!p,onClick:f,className:`p-1 rounded hover:bg-theme-hover ${p?"opacity-100":"opacity-30"}`,title:" (Ctrl+Z)",children:c.jsx(Dg,{size:14})}),c.jsx("button",{disabled:!m,onClick:h,className:`p-1 rounded hover:bg-theme-hover ${m?"opacity-100":"opacity-30"}`,title:" (Ctrl+Shift+Z)",children:c.jsx(Mv,{size:14})}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1"}),c.jsxs("div",{className:`flex items-center ${(t==null?void 0:t.email)==="bibo1243@gmail.com"?"":"hidden"}`,children:[c.jsx("button",{onClick:()=>F(!0),className:"p-1.5 rounded-full hover:bg-pink-50 text-pink-400 hover:text-pink-600 transition-colors",title:" (Shared Schedule)",children:c.jsx(ou,{size:18,className:me?"fill-pink-500 text-pink-500":""})}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1 inline-block"})]}),c.jsx(fte,{})]}),c.jsxs("div",{className:"flex items-center gap-1.5 pl-2 border-l border-theme ml-1",children:[c.jsxs("div",{className:"hidden md:flex flex-col items-end group relative",children:[c.jsx("span",{className:"text-[9px] text-theme-tertiary uppercase tracking-wider font-bold leading-none mb-0.5",children:"User"}),c.jsx("span",{className:"text-[10px] font-mono text-theme-secondary leading-none cursor-help",title:(t==null?void 0:t.id)||"Loading...",children:(t==null?void 0:t.email)||((t==null?void 0:t.id)==="00000000-0000-0000-0000-000000000000"?"Demo":t!=null&&t.id?`ID: ${t.id.slice(0,6)}...`:"Loading...")})]}),c.jsxs("div",{className:"w-6 h-6 rounded-full bg-indigo-500/20 text-indigo-400 flex items-center justify-center border border-indigo-500/30 relative group cursor-pointer",title:" (Logout)",onClick:e,children:[c.jsx(KI,{size:12,className:"group-hover:hidden"}),c.jsx(Mz,{size:12,className:"hidden group-hover:block text-red-500"})]})]}),c.jsxs("div",{className:`flex items-center gap-1 text-[10px] ml-1 ${n==="synced"?"text-green-500":n==="error"?"text-red-500":"text-orange-400"}`,children:[n==="synced"?c.jsx(cz,{size:12}):c.jsx(lz,{size:12,className:"animate-pulse"}),c.jsx("span",{className:"uppercase tracking-wider hidden lg:inline",children:n==="synced"?"Synced":n==="error"?"Error":"Syncing..."})]}),n==="error"&&c.jsx("div",{className:"text-[10px] text-red-500 flex items-center gap-1",children:c.jsx(Jf,{size:12})})]})]}),c.jsx(tte,{}),c.jsx("div",{className:`flex-1 overflow-y-auto scroll-smooth no-scrollbar prevent-pull-refresh ${r!=="focus"&&r!=="project"&&r!=="annualplan"?"p-2 md:p-4":""}`,children:r==="journal"?c.jsx(Bee,{}):r==="focus"?c.jsx(Yee,{}):r==="project"?c.jsx(Qee,{}):r==="annualplan"?c.jsx(ete,{}):r==="matrix"?c.jsx(ste,{}):r==="worklog"?c.jsx(ite,{}):c.jsx("div",{className:"w-full md:w-[calc(100%-100px)] mx-auto mt-2 md:mt-8",children:c.jsx(TR,{})})}),v&&(r==="calendar"||r==="journal"||r==="focus"||r==="matrix")&&st&&c.jsx(xb,{initialData:st,onClose:()=>w(null)}),c.jsx("button",{onMouseDown:te=>{le.current={x:te.clientX-Oe.x,y:te.clientY-Oe.y};const Z=te.clientX,ie=te.clientY,he=se=>{(Math.abs(se.clientX-Z)>5||Math.abs(se.clientY-ie)>5)&&(_e(!0),window.removeEventListener("mousemove",he))};window.addEventListener("mousemove",he),window.addEventListener("mouseup",()=>window.removeEventListener("mousemove",he),{once:!0})},onClick:()=>{ae||E(!0)},style:{left:Oe.x,top:Oe.y},className:`fixed z-40 h-14 w-14 rounded-full bg-indigo-600 text-white shadow-xl hover:bg-indigo-700 transition-all flex items-center justify-center group fab-mobile md:hidden ${ae?"cursor-grabbing scale-110":"cursor-grab hover:scale-105 active:scale-95"}`,title:"Create New Task (Drag to move)",children:c.jsx(ni,{size:28,className:"group-hover:rotate-90 transition-transform duration-200"})}),_&&!U&&c.jsx(xb,{onClose:()=>E(!1)}),_&&U&&c.jsx(yb,{taskId:void 0,onClose:()=>E(!1)}),A&&S.length===1&&c.jsx(rte,{taskId:S[0],onClose:()=>j(!1)}),W&&S.length===1&&c.jsx(pte,{taskId:S[0],onClose:()=>V(!1)}),u&&c.jsx(nte,{toast:u,onClose:()=>d(null)}),v&&U&&c.jsx(yb,{taskId:v,onClose:()=>w(null)}),D&&c.jsx(lte,{onClose:()=>ge(!1)}),me&&c.jsx(UR,{onClose:()=>F(!1)})]})]})},hre=()=>{const[t,e]=x.useState(!1),[n,r]=x.useState(""),[s,i]=x.useState(""),[o,a]=x.useState("signin"),[l,u]=x.useState(null),[d,f]=x.useState(null),h=async p=>{p.preventDefault(),e(!0),u(null),f(null);let m=n,y=s;n.toLowerCase()==="demo"&&s.toLowerCase()==="demo"&&(m="demo@demo.com",y="demodemo");try{if(!ve)throw new Error("Supabase client not initialized");if(o==="signup"){const{data:b,error:g}=await ve.auth.signUp({email:m,password:y});if(g)throw g;b.session?(f("..."),setTimeout(()=>{window.location.reload()},500)):b.user&&!b.session&&f("")}else{const{error:b}=await ve.auth.signInWithPassword({email:m,password:y});if(b)throw b;window.location.reload()}}catch(b){u(b.message)}finally{e(!1)}};return c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:c.jsxs("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[c.jsxs("div",{className:"flex flex-col items-center mb-8",children:[c.jsx("div",{className:"w-12 h-12 bg-indigo-600 rounded-xl flex items-center justify-center text-white mb-4 shadow-lg shadow-indigo-200",children:c.jsx(r1,{size:24})}),c.jsx("h1",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:"Things Clone"}),c.jsx("p",{className:"text-sm text-gray-500 mt-2",children:""})]}),l&&c.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-600 text-sm rounded-lg border border-red-100",children:l}),d&&c.jsx("div",{className:"mb-4 p-3 bg-green-50 text-green-600 text-sm rounded-lg border border-green-100",children:d}),c.jsxs("form",{onSubmit:h,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1 ml-1",children:"Email"}),c.jsxs("div",{className:"relative",children:[c.jsx(Dz,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),c.jsx("input",{type:"text",required:!0,value:n,onChange:p=>r(p.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-100 focus:border-indigo-400 outline-none transition-all text-sm",placeholder:"name@example.com  demo"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1 ml-1",children:"Password"}),c.jsxs("div",{className:"relative",children:[c.jsx(La,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),c.jsx("input",{type:"password",required:!0,value:s,onChange:p=>i(p.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-100 focus:border-indigo-400 outline-none transition-all text-sm",placeholder:"",minLength:6})]})]}),c.jsx("button",{type:"submit",disabled:t,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2.5 rounded-lg transition-all flex items-center justify-center gap-2 shadow-lg shadow-indigo-100 disabled:opacity-70 disabled:cursor-not-allowed",children:t?c.jsx(yi,{className:"animate-spin",size:18}):c.jsxs(c.Fragment,{children:[o==="signin"?"":"",c.jsx(Nv,{size:16})]})})]}),c.jsx("div",{className:"mt-6 text-center",children:c.jsx("button",{type:"button",onClick:()=>a(o==="signin"?"signup":"signin"),className:"text-sm text-indigo-600 hover:text-indigo-500 font-medium",children:o==="signin"?"":""})}),c.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-100",children:[c.jsx("p",{className:"text-xs text-gray-400 text-center mb-3",children:" Demo "}),c.jsx("button",{type:"button",onClick:async()=>{e(!0),u(null);try{if(!ve)throw new Error("Supabase client not initialized");const{error:p}=await ve.auth.signInWithPassword({email:"demo@demo.com",password:"demodemo"});if(p)throw p;window.location.reload()}catch(p){u("Demo : "+p.message)}finally{e(!1)}},disabled:t,className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 rounded-lg transition-all flex items-center justify-center gap-2 text-sm disabled:opacity-70",children:" Demo "}),c.jsxs("p",{className:"text-[10px] text-gray-400 text-center mt-2",children:[" ",c.jsx("span",{className:"font-mono font-bold",children:"demo"})," "]})]})]})})},pre=()=>{const{isRecording:t,recordingTime:e,stopRecording:n,analyser:r,recordingTaskId:s}=x.useContext(Ru),{setFocusedTaskId:i,tasks:o,setView:a,setExpandedTaskIds:l,setEditingTaskId:u}=x.useContext(En),[d,f]=x.useState(!1),h=x.useRef(null),p=x.useRef(),m=()=>{if(!s)return;a("allview");const b=o.find(g=>g.id===s);if(b){let g=b;const v=[];for(;g.parent_id;){v.push(g.parent_id);const w=o.find(T=>T.id===g.parent_id);if(!w)break;g=w}v.length>0&&l(w=>[...new Set([...w,...v])])}i(s),u(s),f(!1)};if(x.useEffect(()=>{if(!t||!r||!h.current)return;const b=h.current,g=b.getContext("2d");if(!g)return;const v=r.frequencyBinCount,w=new Uint8Array(v),T=()=>{if(!r)return;p.current=requestAnimationFrame(T),r.getByteTimeDomainData(w),g.clearRect(0,0,b.width,b.height),g.lineWidth=2,g.strokeStyle="rgba(255, 255, 255, 0.8)",g.beginPath();const R=b.width/v;let k=0;for(let M=0;M<v;M++){const C=w[M]/128*b.height/2;M===0?g.moveTo(k,C):g.lineTo(k,C),k+=R}g.lineTo(b.width,b.height/2),g.stroke()};return T(),()=>{p.current&&cancelAnimationFrame(p.current)}},[t,r]),!t)return null;const y=b=>{const g=Math.floor(b/1e3),v=Math.floor(g/60),w=g%60;return`${v.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`};return d?c.jsx("div",{className:"fixed bottom-6 left-6 z-[99999] animate-in fade-in zoom-in duration-300 cursor-pointer group",onClick:m,title:"Recording in progress. Click to locate task.",children:c.jsxs("div",{className:"bg-black/80 backdrop-blur-md border border-emerald-500/30 rounded-full p-2.5 shadow-2xl flex items-center justify-center relative hover:bg-black/90 transition-all hover:scale-110",children:[c.jsx("div",{className:"w-2.5 h-2.5 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_10px_rgba(16,185,129,0.8)]"}),c.jsx("div",{className:"absolute left-full ml-3 bg-black/90 text-white text-[10px] px-2 py-1 rounded-md whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none border border-white/10 shadow-xl font-mono",children:y(e)})]})}):c.jsx("div",{className:"fixed bottom-6 left-1/2 transform -translate-x-1/2 z-[99999] animate-in fade-in slide-in-from-bottom-4 duration-300","data-recording-capsule":!0,children:c.jsxs("div",{className:"bg-black/90 backdrop-blur-xl text-white rounded-full flex items-center p-2 pl-4 pr-3 shadow-2xl border border-white/10 gap-3 min-w-[200px] hover:scale-[1.01] transition-transform",children:[c.jsx("button",{onClick:b=>{b.stopPropagation(),b.preventDefault(),n()},className:"w-8 h-8 rounded-full bg-red-500/20 text-red-400 flex items-center justify-center hover:bg-red-500 hover:text-white transition-all cursor-pointer",title:"Stop Recording",children:c.jsx(Vz,{size:12,fill:"currentColor"})}),c.jsx("div",{className:"flex flex-col items-center min-w-[50px] cursor-pointer hover:opacity-80 transition-opacity",onClick:m,title:"Click to locate task",children:c.jsx("span",{className:"font-mono text-sm font-medium tabular-nums tracking-wider text-white",children:y(e)})}),c.jsx("div",{className:"w-20 h-8 relative opacity-80 flex items-center cursor-pointer",onClick:m,title:"Click to locate task",children:c.jsx("canvas",{ref:h,width:80,height:32,className:"w-full h-full"})}),c.jsx("div",{className:"h-6 w-[1px] bg-white/10 mx-1"}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:m,className:"p-1.5 text-gray-400 hover:text-white hover:bg-white/10 rounded-full transition-colors",title:"Locate Recording Task",children:c.jsx(Iz,{size:14})}),c.jsx("button",{onClick:()=>f(!0),className:"p-1.5 text-gray-400 hover:text-white hover:bg-white/10 rounded-full transition-colors",title:"Minimize",children:c.jsx(ts,{size:16})})]})]})})},vE=()=>c.jsx("div",{className:"w-full h-screen bg-gray-100 flex items-center justify-center",children:c.jsx("div",{className:"w-full h-full md:max-w-[430px] md:h-[90vh] md:rounded-[3rem] md:border-8 md:border-gray-900 bg-white relative shadow-2xl overflow-hidden",children:c.jsx(UR,{isStandalone:!0})})}),mre=()=>{const{user:t,loading:e}=x.useContext(En);if(e)return c.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:c.jsxs("div",{className:"flex flex-col items-center gap-3",children:[c.jsx("div",{className:"w-8 h-8 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"}),c.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"Loading workspace..."})]})});const n=t&&t.aud==="authenticated";return c.jsxs(T3,{children:[c.jsx(ud,{path:"/share/heart/s/:snapshotId",element:c.jsx(vE,{})}),c.jsx(ud,{path:"/share/heart/:userId",element:c.jsx(vE,{})}),c.jsx(ud,{path:"/login",element:n?c.jsx(LS,{to:"/",replace:!0}):c.jsx(hre,{})}),c.jsx(ud,{path:"/*",element:n?c.jsx(fre,{}):c.jsx(LS,{to:"/login",replace:!0})})]})};function gre(){return c.jsx(J3,{children:c.jsx(G6,{children:c.jsx(q6,{children:c.jsxs(J6,{children:[c.jsx(mre,{}),c.jsx(pre,{})]})})})})}Gy.createRoot(document.getElementById("root")).render(c.jsx(gre,{}));
