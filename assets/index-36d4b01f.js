(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var Dp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cg(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var vE={exports:{}},ug={},kE={exports:{}},En={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Uf=Symbol.for("react.element"),eO=Symbol.for("react.portal"),tO=Symbol.for("react.fragment"),nO=Symbol.for("react.strict_mode"),rO=Symbol.for("react.profiler"),sO=Symbol.for("react.provider"),iO=Symbol.for("react.context"),oO=Symbol.for("react.forward_ref"),aO=Symbol.for("react.suspense"),lO=Symbol.for("react.memo"),cO=Symbol.for("react.lazy"),kk=Symbol.iterator;function uO(t){return t===null||typeof t!="object"?null:(t=kk&&t[kk]||t["@@iterator"],typeof t=="function"?t:null)}var SE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_E=Object.assign,TE={};function Nu(t,e,n){this.props=t,this.context=e,this.refs=TE,this.updater=n||SE}Nu.prototype.isReactComponent={};Nu.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Nu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function CE(){}CE.prototype=Nu.prototype;function bb(t,e,n){this.props=t,this.context=e,this.refs=TE,this.updater=n||SE}var wb=bb.prototype=new CE;wb.constructor=bb;_E(wb,Nu.prototype);wb.isPureReactComponent=!0;var Sk=Array.isArray,EE=Object.prototype.hasOwnProperty,vb={current:null},NE={key:!0,ref:!0,__self:!0,__source:!0};function jE(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)EE.call(e,r)&&!NE.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:Uf,type:t,key:i,ref:o,props:s,_owner:vb.current}}function dO(t,e){return{$$typeof:Uf,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function kb(t){return typeof t=="object"&&t!==null&&t.$$typeof===Uf}function fO(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var _k=/\/+/g;function o0(t,e){return typeof t=="object"&&t!==null&&t.key!=null?fO(""+t.key):e.toString(36)}function ep(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Uf:case eO:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+o0(o,0):r,Sk(s)?(n="",t!=null&&(n=t.replace(_k,"$&/")+"/"),ep(s,e,n,"",function(u){return u})):s!=null&&(kb(s)&&(s=dO(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(_k,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Sk(t))for(var a=0;a<t.length;a++){i=t[a];var l=r+o0(i,a);o+=ep(i,e,n,l,s)}else if(l=uO(t),typeof l=="function")for(t=l.call(t),a=0;!(i=t.next()).done;)i=i.value,l=r+o0(i,a++),o+=ep(i,e,n,l,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function uh(t,e,n){if(t==null)return t;var r=[],s=0;return ep(t,r,"","",function(i){return e.call(n,i,s++)}),r}function hO(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var js={current:null},tp={transition:null},pO={ReactCurrentDispatcher:js,ReactCurrentBatchConfig:tp,ReactCurrentOwner:vb};function IE(){throw Error("act(...) is not supported in production builds of React.")}En.Children={map:uh,forEach:function(t,e,n){uh(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return uh(t,function(){e++}),e},toArray:function(t){return uh(t,function(e){return e})||[]},only:function(t){if(!kb(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};En.Component=Nu;En.Fragment=tO;En.Profiler=rO;En.PureComponent=bb;En.StrictMode=nO;En.Suspense=aO;En.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pO;En.act=IE;En.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=_E({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=vb.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)EE.call(e,l)&&!NE.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Uf,type:t.type,key:s,ref:i,props:r,_owner:o}};En.createContext=function(t){return t={$$typeof:iO,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:sO,_context:t},t.Consumer=t};En.createElement=jE;En.createFactory=function(t){var e=jE.bind(null,t);return e.type=t,e};En.createRef=function(){return{current:null}};En.forwardRef=function(t){return{$$typeof:oO,render:t}};En.isValidElement=kb;En.lazy=function(t){return{$$typeof:cO,_payload:{_status:-1,_result:t},_init:hO}};En.memo=function(t,e){return{$$typeof:lO,type:t,compare:e===void 0?null:e}};En.startTransition=function(t){var e=tp.transition;tp.transition={};try{t()}finally{tp.transition=e}};En.unstable_act=IE;En.useCallback=function(t,e){return js.current.useCallback(t,e)};En.useContext=function(t){return js.current.useContext(t)};En.useDebugValue=function(){};En.useDeferredValue=function(t){return js.current.useDeferredValue(t)};En.useEffect=function(t,e){return js.current.useEffect(t,e)};En.useId=function(){return js.current.useId()};En.useImperativeHandle=function(t,e,n){return js.current.useImperativeHandle(t,e,n)};En.useInsertionEffect=function(t,e){return js.current.useInsertionEffect(t,e)};En.useLayoutEffect=function(t,e){return js.current.useLayoutEffect(t,e)};En.useMemo=function(t,e){return js.current.useMemo(t,e)};En.useReducer=function(t,e,n){return js.current.useReducer(t,e,n)};En.useRef=function(t){return js.current.useRef(t)};En.useState=function(t){return js.current.useState(t)};En.useSyncExternalStore=function(t,e,n){return js.current.useSyncExternalStore(t,e,n)};En.useTransition=function(){return js.current.useTransition()};En.version="18.3.1";kE.exports=En;var x=kE.exports;const Ln=cg(x);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mO=x,gO=Symbol.for("react.element"),yO=Symbol.for("react.fragment"),xO=Object.prototype.hasOwnProperty,bO=mO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,wO={key:!0,ref:!0,__self:!0,__source:!0};function ME(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)xO.call(e,r)&&!wO.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:gO,type:t,key:i,ref:o,props:s,_owner:bO.current}}ug.Fragment=yO;ug.jsx=ME;ug.jsxs=ME;vE.exports=ug;var c=vE.exports,Gy={},DE={exports:{}},li={},AE={exports:{}},RE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(K,G){var R=K.length;K.push(G);e:for(;0<R;){var Ee=R-1>>>1,ge=K[Ee];if(0<s(ge,G))K[Ee]=G,K[R]=ge,R=Ee;else break e}}function n(K){return K.length===0?null:K[0]}function r(K){if(K.length===0)return null;var G=K[0],R=K.pop();if(R!==G){K[0]=R;e:for(var Ee=0,ge=K.length,F=ge>>>1;Ee<F;){var B=2*(Ee+1)-1,se=K[B],We=B+1,ut=K[We];if(0>s(se,R))We<ge&&0>s(ut,se)?(K[Ee]=ut,K[We]=R,Ee=We):(K[Ee]=se,K[B]=R,Ee=B);else if(We<ge&&0>s(ut,R))K[Ee]=ut,K[We]=R,Ee=We;else break e}}return G}function s(K,G){var R=K.sortIndex-G.sortIndex;return R!==0?R:K.id-G.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],u=[],d=1,f=null,h=3,p=!1,m=!1,y=!1,b=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(K){for(var G=n(u);G!==null;){if(G.callback===null)r(u);else if(G.startTime<=K)r(u),G.sortIndex=G.expirationTime,e(l,G);else break;G=n(u)}}function _(K){if(y=!1,w(K),!m)if(n(l)!==null)m=!0,M(D);else{var G=n(u);G!==null&&I(_,G.startTime-K)}}function D(K,G){m=!1,y&&(y=!1,g(N),N=-1),p=!0;var R=h;try{for(w(G),f=n(l);f!==null&&(!(f.expirationTime>G)||K&&!T());){var Ee=f.callback;if(typeof Ee=="function"){f.callback=null,h=f.priorityLevel;var ge=Ee(f.expirationTime<=G);G=t.unstable_now(),typeof ge=="function"?f.callback=ge:f===n(l)&&r(l),w(G)}else r(l);f=n(l)}if(f!==null)var F=!0;else{var B=n(u);B!==null&&I(_,B.startTime-G),F=!1}return F}finally{f=null,h=R,p=!1}}var k=!1,A=null,N=-1,E=5,S=-1;function T(){return!(t.unstable_now()-S<E)}function C(){if(A!==null){var K=t.unstable_now();S=K;var G=!0;try{G=A(!0,K)}finally{G?O():(k=!1,A=null)}}else k=!1}var O;if(typeof v=="function")O=function(){v(C)};else if(typeof MessageChannel<"u"){var P=new MessageChannel,H=P.port2;P.port1.onmessage=C,O=function(){H.postMessage(null)}}else O=function(){b(C,0)};function M(K){A=K,k||(k=!0,O())}function I(K,G){N=b(function(){K(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(K){K.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,M(D))},t.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<K?Math.floor(1e3/K):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(K){switch(h){case 1:case 2:case 3:var G=3;break;default:G=h}var R=h;h=G;try{return K()}finally{h=R}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(K,G){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var R=h;h=K;try{return G()}finally{h=R}},t.unstable_scheduleCallback=function(K,G,R){var Ee=t.unstable_now();switch(typeof R=="object"&&R!==null?(R=R.delay,R=typeof R=="number"&&0<R?Ee+R:Ee):R=Ee,K){case 1:var ge=-1;break;case 2:ge=250;break;case 5:ge=1073741823;break;case 4:ge=1e4;break;default:ge=5e3}return ge=R+ge,K={id:d++,callback:G,priorityLevel:K,startTime:R,expirationTime:ge,sortIndex:-1},R>Ee?(K.sortIndex=R,e(u,K),n(l)===null&&K===n(u)&&(y?(g(N),N=-1):y=!0,I(_,R-Ee))):(K.sortIndex=ge,e(l,K),m||p||(m=!0,M(D))),K},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(K){var G=h;return function(){var R=h;h=G;try{return K.apply(this,arguments)}finally{h=R}}}})(RE);AE.exports=RE;var vO=AE.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kO=x,oi=vO;function Dt(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var OE=new Set,Gd={};function nc(t,e){pu(t,e),pu(t+"Capture",e)}function pu(t,e){for(Gd[t]=e,t=0;t<e.length;t++)OE.add(e[t])}var qo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),qy=Object.prototype.hasOwnProperty,SO=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Tk={},Ck={};function _O(t){return qy.call(Ck,t)?!0:qy.call(Tk,t)?!1:SO.test(t)?Ck[t]=!0:(Tk[t]=!0,!1)}function TO(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function CO(t,e,n,r){if(e===null||typeof e>"u"||TO(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Is(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var ss={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ss[t]=new Is(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ss[e]=new Is(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ss[t]=new Is(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ss[t]=new Is(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ss[t]=new Is(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ss[t]=new Is(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ss[t]=new Is(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ss[t]=new Is(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ss[t]=new Is(t,5,!1,t.toLowerCase(),null,!1,!1)});var Sb=/[\-:]([a-z])/g;function _b(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Sb,_b);ss[e]=new Is(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Sb,_b);ss[e]=new Is(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Sb,_b);ss[e]=new Is(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ss[t]=new Is(t,1,!1,t.toLowerCase(),null,!1,!1)});ss.xlinkHref=new Is("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ss[t]=new Is(t,1,!1,t.toLowerCase(),null,!0,!0)});function Tb(t,e,n,r){var s=ss.hasOwnProperty(e)?ss[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(CO(e,n,s,r)&&(n=null),r||s===null?_O(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var ta=kO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,dh=Symbol.for("react.element"),Ic=Symbol.for("react.portal"),Mc=Symbol.for("react.fragment"),Cb=Symbol.for("react.strict_mode"),Yy=Symbol.for("react.profiler"),PE=Symbol.for("react.provider"),LE=Symbol.for("react.context"),Eb=Symbol.for("react.forward_ref"),Jy=Symbol.for("react.suspense"),Xy=Symbol.for("react.suspense_list"),Nb=Symbol.for("react.memo"),da=Symbol.for("react.lazy"),$E=Symbol.for("react.offscreen"),Ek=Symbol.iterator;function Wu(t){return t===null||typeof t!="object"?null:(t=Ek&&t[Ek]||t["@@iterator"],typeof t=="function"?t:null)}var pr=Object.assign,a0;function od(t){if(a0===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);a0=e&&e[1]||""}return`
`+a0+t}var l0=!1;function c0(t,e){if(!t||l0)return"";l0=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{l0=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?od(t):""}function EO(t){switch(t.tag){case 5:return od(t.type);case 16:return od("Lazy");case 13:return od("Suspense");case 19:return od("SuspenseList");case 0:case 2:case 15:return t=c0(t.type,!1),t;case 11:return t=c0(t.type.render,!1),t;case 1:return t=c0(t.type,!0),t;default:return""}}function Qy(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Mc:return"Fragment";case Ic:return"Portal";case Yy:return"Profiler";case Cb:return"StrictMode";case Jy:return"Suspense";case Xy:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case LE:return(t.displayName||"Context")+".Consumer";case PE:return(t._context.displayName||"Context")+".Provider";case Eb:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Nb:return e=t.displayName||null,e!==null?e:Qy(t.type)||"Memo";case da:e=t._payload,t=t._init;try{return Qy(t(e))}catch{}}return null}function NO(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qy(e);case 8:return e===Cb?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ua(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function zE(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function jO(t){var e=zE(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function fh(t){t._valueTracker||(t._valueTracker=jO(t))}function FE(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=zE(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Ap(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Zy(t,e){var n=e.checked;return pr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Nk(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ua(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function BE(t,e){e=e.checked,e!=null&&Tb(t,"checked",e,!1)}function ex(t,e){BE(t,e);var n=Ua(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?tx(t,e.type,n):e.hasOwnProperty("defaultValue")&&tx(t,e.type,Ua(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function jk(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function tx(t,e,n){(e!=="number"||Ap(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var ad=Array.isArray;function Qc(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ua(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function nx(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Dt(91));return pr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Ik(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Dt(92));if(ad(n)){if(1<n.length)throw Error(Dt(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ua(n)}}function UE(t,e){var n=Ua(e.value),r=Ua(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Mk(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function HE(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function rx(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?HE(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var hh,VE=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(hh=hh||document.createElement("div"),hh.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=hh.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function qd(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var xd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},IO=["Webkit","ms","Moz","O"];Object.keys(xd).forEach(function(t){IO.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),xd[e]=xd[t]})});function WE(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||xd.hasOwnProperty(t)&&xd[t]?(""+e).trim():e+"px"}function KE(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=WE(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var MO=pr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function sx(t,e){if(e){if(MO[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Dt(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Dt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Dt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Dt(62))}}function ix(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ox=null;function jb(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ax=null,Zc=null,eu=null;function Dk(t){if(t=Wf(t)){if(typeof ax!="function")throw Error(Dt(280));var e=t.stateNode;e&&(e=mg(e),ax(t.stateNode,t.type,e))}}function GE(t){Zc?eu?eu.push(t):eu=[t]:Zc=t}function qE(){if(Zc){var t=Zc,e=eu;if(eu=Zc=null,Dk(t),e)for(t=0;t<e.length;t++)Dk(e[t])}}function YE(t,e){return t(e)}function JE(){}var u0=!1;function XE(t,e,n){if(u0)return t(e,n);u0=!0;try{return YE(t,e,n)}finally{u0=!1,(Zc!==null||eu!==null)&&(JE(),qE())}}function Yd(t,e){var n=t.stateNode;if(n===null)return null;var r=mg(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Dt(231,e,typeof n));return n}var lx=!1;if(qo)try{var Ku={};Object.defineProperty(Ku,"passive",{get:function(){lx=!0}}),window.addEventListener("test",Ku,Ku),window.removeEventListener("test",Ku,Ku)}catch{lx=!1}function DO(t,e,n,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(d){this.onError(d)}}var bd=!1,Rp=null,Op=!1,cx=null,AO={onError:function(t){bd=!0,Rp=t}};function RO(t,e,n,r,s,i,o,a,l){bd=!1,Rp=null,DO.apply(AO,arguments)}function OO(t,e,n,r,s,i,o,a,l){if(RO.apply(this,arguments),bd){if(bd){var u=Rp;bd=!1,Rp=null}else throw Error(Dt(198));Op||(Op=!0,cx=u)}}function rc(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function QE(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Ak(t){if(rc(t)!==t)throw Error(Dt(188))}function PO(t){var e=t.alternate;if(!e){if(e=rc(t),e===null)throw Error(Dt(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return Ak(s),t;if(i===r)return Ak(s),e;i=i.sibling}throw Error(Dt(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o)throw Error(Dt(189))}}if(n.alternate!==r)throw Error(Dt(190))}if(n.tag!==3)throw Error(Dt(188));return n.stateNode.current===n?t:e}function ZE(t){return t=PO(t),t!==null?eN(t):null}function eN(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=eN(t);if(e!==null)return e;t=t.sibling}return null}var tN=oi.unstable_scheduleCallback,Rk=oi.unstable_cancelCallback,LO=oi.unstable_shouldYield,$O=oi.unstable_requestPaint,Sr=oi.unstable_now,zO=oi.unstable_getCurrentPriorityLevel,Ib=oi.unstable_ImmediatePriority,nN=oi.unstable_UserBlockingPriority,Pp=oi.unstable_NormalPriority,FO=oi.unstable_LowPriority,rN=oi.unstable_IdlePriority,dg=null,xo=null;function BO(t){if(xo&&typeof xo.onCommitFiberRoot=="function")try{xo.onCommitFiberRoot(dg,t,void 0,(t.current.flags&128)===128)}catch{}}var Zi=Math.clz32?Math.clz32:VO,UO=Math.log,HO=Math.LN2;function VO(t){return t>>>=0,t===0?32:31-(UO(t)/HO|0)|0}var ph=64,mh=4194304;function ld(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Lp(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~s;a!==0?r=ld(a):(i&=o,i!==0&&(r=ld(i)))}else o=n&~s,o!==0?r=ld(o):i!==0&&(r=ld(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Zi(e),s=1<<n,r|=t[n],e&=~s;return r}function WO(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function KO(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-Zi(i),a=1<<o,l=s[o];l===-1?(!(a&n)||a&r)&&(s[o]=WO(a,e)):l<=e&&(t.expiredLanes|=a),i&=~a}}function ux(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function sN(){var t=ph;return ph<<=1,!(ph&4194240)&&(ph=64),t}function d0(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Hf(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Zi(e),t[e]=n}function GO(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Zi(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Mb(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Zi(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var $n=0;function iN(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var oN,Db,aN,lN,cN,dx=!1,gh=[],Na=null,ja=null,Ia=null,Jd=new Map,Xd=new Map,xa=[],qO="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ok(t,e){switch(t){case"focusin":case"focusout":Na=null;break;case"dragenter":case"dragleave":ja=null;break;case"mouseover":case"mouseout":Ia=null;break;case"pointerover":case"pointerout":Jd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xd.delete(e.pointerId)}}function Gu(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Wf(e),e!==null&&Db(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function YO(t,e,n,r,s){switch(e){case"focusin":return Na=Gu(Na,t,e,n,r,s),!0;case"dragenter":return ja=Gu(ja,t,e,n,r,s),!0;case"mouseover":return Ia=Gu(Ia,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Jd.set(i,Gu(Jd.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Xd.set(i,Gu(Xd.get(i)||null,t,e,n,r,s)),!0}return!1}function uN(t){var e=_l(t.target);if(e!==null){var n=rc(e);if(n!==null){if(e=n.tag,e===13){if(e=QE(n),e!==null){t.blockedOn=e,cN(t.priority,function(){aN(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function np(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=fx(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);ox=r,n.target.dispatchEvent(r),ox=null}else return e=Wf(n),e!==null&&Db(e),t.blockedOn=n,!1;e.shift()}return!0}function Pk(t,e,n){np(t)&&n.delete(e)}function JO(){dx=!1,Na!==null&&np(Na)&&(Na=null),ja!==null&&np(ja)&&(ja=null),Ia!==null&&np(Ia)&&(Ia=null),Jd.forEach(Pk),Xd.forEach(Pk)}function qu(t,e){t.blockedOn===e&&(t.blockedOn=null,dx||(dx=!0,oi.unstable_scheduleCallback(oi.unstable_NormalPriority,JO)))}function Qd(t){function e(s){return qu(s,t)}if(0<gh.length){qu(gh[0],t);for(var n=1;n<gh.length;n++){var r=gh[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Na!==null&&qu(Na,t),ja!==null&&qu(ja,t),Ia!==null&&qu(Ia,t),Jd.forEach(e),Xd.forEach(e),n=0;n<xa.length;n++)r=xa[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<xa.length&&(n=xa[0],n.blockedOn===null);)uN(n),n.blockedOn===null&&xa.shift()}var tu=ta.ReactCurrentBatchConfig,$p=!0;function XO(t,e,n,r){var s=$n,i=tu.transition;tu.transition=null;try{$n=1,Ab(t,e,n,r)}finally{$n=s,tu.transition=i}}function QO(t,e,n,r){var s=$n,i=tu.transition;tu.transition=null;try{$n=4,Ab(t,e,n,r)}finally{$n=s,tu.transition=i}}function Ab(t,e,n,r){if($p){var s=fx(t,e,n,r);if(s===null)v0(t,e,r,zp,n),Ok(t,r);else if(YO(s,t,e,n,r))r.stopPropagation();else if(Ok(t,r),e&4&&-1<qO.indexOf(t)){for(;s!==null;){var i=Wf(s);if(i!==null&&oN(i),i=fx(t,e,n,r),i===null&&v0(t,e,r,zp,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else v0(t,e,r,null,n)}}var zp=null;function fx(t,e,n,r){if(zp=null,t=jb(r),t=_l(t),t!==null)if(e=rc(t),e===null)t=null;else if(n=e.tag,n===13){if(t=QE(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return zp=t,null}function dN(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(zO()){case Ib:return 1;case nN:return 4;case Pp:case FO:return 16;case rN:return 536870912;default:return 16}default:return 16}}var Sa=null,Rb=null,rp=null;function fN(){if(rp)return rp;var t,e=Rb,n=e.length,r,s="value"in Sa?Sa.value:Sa.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return rp=s.slice(t,1<r?1-r:void 0)}function sp(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function yh(){return!0}function Lk(){return!1}function ci(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?yh:Lk,this.isPropagationStopped=Lk,this}return pr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=yh)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=yh)},persist:function(){},isPersistent:yh}),e}var ju={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ob=ci(ju),Vf=pr({},ju,{view:0,detail:0}),ZO=ci(Vf),f0,h0,Yu,fg=pr({},Vf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pb,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Yu&&(Yu&&t.type==="mousemove"?(f0=t.screenX-Yu.screenX,h0=t.screenY-Yu.screenY):h0=f0=0,Yu=t),f0)},movementY:function(t){return"movementY"in t?t.movementY:h0}}),$k=ci(fg),eP=pr({},fg,{dataTransfer:0}),tP=ci(eP),nP=pr({},Vf,{relatedTarget:0}),p0=ci(nP),rP=pr({},ju,{animationName:0,elapsedTime:0,pseudoElement:0}),sP=ci(rP),iP=pr({},ju,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),oP=ci(iP),aP=pr({},ju,{data:0}),zk=ci(aP),lP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},uP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dP(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=uP[t])?!!e[t]:!1}function Pb(){return dP}var fP=pr({},Vf,{key:function(t){if(t.key){var e=lP[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=sp(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?cP[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pb,charCode:function(t){return t.type==="keypress"?sp(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?sp(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),hP=ci(fP),pP=pr({},fg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fk=ci(pP),mP=pr({},Vf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pb}),gP=ci(mP),yP=pr({},ju,{propertyName:0,elapsedTime:0,pseudoElement:0}),xP=ci(yP),bP=pr({},fg,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),wP=ci(bP),vP=[9,13,27,32],Lb=qo&&"CompositionEvent"in window,wd=null;qo&&"documentMode"in document&&(wd=document.documentMode);var kP=qo&&"TextEvent"in window&&!wd,hN=qo&&(!Lb||wd&&8<wd&&11>=wd),Bk=String.fromCharCode(32),Uk=!1;function pN(t,e){switch(t){case"keyup":return vP.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mN(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Dc=!1;function SP(t,e){switch(t){case"compositionend":return mN(e);case"keypress":return e.which!==32?null:(Uk=!0,Bk);case"textInput":return t=e.data,t===Bk&&Uk?null:t;default:return null}}function _P(t,e){if(Dc)return t==="compositionend"||!Lb&&pN(t,e)?(t=fN(),rp=Rb=Sa=null,Dc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return hN&&e.locale!=="ko"?null:e.data;default:return null}}var TP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hk(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!TP[t.type]:e==="textarea"}function gN(t,e,n,r){GE(r),e=Fp(e,"onChange"),0<e.length&&(n=new Ob("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var vd=null,Zd=null;function CP(t){EN(t,0)}function hg(t){var e=Oc(t);if(FE(e))return t}function EP(t,e){if(t==="change")return e}var yN=!1;if(qo){var m0;if(qo){var g0="oninput"in document;if(!g0){var Vk=document.createElement("div");Vk.setAttribute("oninput","return;"),g0=typeof Vk.oninput=="function"}m0=g0}else m0=!1;yN=m0&&(!document.documentMode||9<document.documentMode)}function Wk(){vd&&(vd.detachEvent("onpropertychange",xN),Zd=vd=null)}function xN(t){if(t.propertyName==="value"&&hg(Zd)){var e=[];gN(e,Zd,t,jb(t)),XE(CP,e)}}function NP(t,e,n){t==="focusin"?(Wk(),vd=e,Zd=n,vd.attachEvent("onpropertychange",xN)):t==="focusout"&&Wk()}function jP(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return hg(Zd)}function IP(t,e){if(t==="click")return hg(e)}function MP(t,e){if(t==="input"||t==="change")return hg(e)}function DP(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var to=typeof Object.is=="function"?Object.is:DP;function ef(t,e){if(to(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!qy.call(e,s)||!to(t[s],e[s]))return!1}return!0}function Kk(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Gk(t,e){var n=Kk(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Kk(n)}}function bN(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?bN(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function wN(){for(var t=window,e=Ap();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ap(t.document)}return e}function $b(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function AP(t){var e=wN(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&bN(n.ownerDocument.documentElement,n)){if(r!==null&&$b(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=Gk(n,i);var o=Gk(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var RP=qo&&"documentMode"in document&&11>=document.documentMode,Ac=null,hx=null,kd=null,px=!1;function qk(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;px||Ac==null||Ac!==Ap(r)||(r=Ac,"selectionStart"in r&&$b(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),kd&&ef(kd,r)||(kd=r,r=Fp(hx,"onSelect"),0<r.length&&(e=new Ob("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Ac)))}function xh(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Rc={animationend:xh("Animation","AnimationEnd"),animationiteration:xh("Animation","AnimationIteration"),animationstart:xh("Animation","AnimationStart"),transitionend:xh("Transition","TransitionEnd")},y0={},vN={};qo&&(vN=document.createElement("div").style,"AnimationEvent"in window||(delete Rc.animationend.animation,delete Rc.animationiteration.animation,delete Rc.animationstart.animation),"TransitionEvent"in window||delete Rc.transitionend.transition);function pg(t){if(y0[t])return y0[t];if(!Rc[t])return t;var e=Rc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in vN)return y0[t]=e[n];return t}var kN=pg("animationend"),SN=pg("animationiteration"),_N=pg("animationstart"),TN=pg("transitionend"),CN=new Map,Yk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ya(t,e){CN.set(t,e),nc(e,[t])}for(var x0=0;x0<Yk.length;x0++){var b0=Yk[x0],OP=b0.toLowerCase(),PP=b0[0].toUpperCase()+b0.slice(1);Ya(OP,"on"+PP)}Ya(kN,"onAnimationEnd");Ya(SN,"onAnimationIteration");Ya(_N,"onAnimationStart");Ya("dblclick","onDoubleClick");Ya("focusin","onFocus");Ya("focusout","onBlur");Ya(TN,"onTransitionEnd");pu("onMouseEnter",["mouseout","mouseover"]);pu("onMouseLeave",["mouseout","mouseover"]);pu("onPointerEnter",["pointerout","pointerover"]);pu("onPointerLeave",["pointerout","pointerover"]);nc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));nc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));nc("onBeforeInput",["compositionend","keypress","textInput","paste"]);nc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));nc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));nc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),LP=new Set("cancel close invalid load scroll toggle".split(" ").concat(cd));function Jk(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,OO(r,e,void 0,t),t.currentTarget=null}function EN(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;Jk(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;Jk(s,a,u),i=l}}}if(Op)throw t=cx,Op=!1,cx=null,t}function Jn(t,e){var n=e[bx];n===void 0&&(n=e[bx]=new Set);var r=t+"__bubble";n.has(r)||(NN(e,t,2,!1),n.add(r))}function w0(t,e,n){var r=0;e&&(r|=4),NN(n,t,r,e)}var bh="_reactListening"+Math.random().toString(36).slice(2);function tf(t){if(!t[bh]){t[bh]=!0,OE.forEach(function(n){n!=="selectionchange"&&(LP.has(n)||w0(n,!1,t),w0(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[bh]||(e[bh]=!0,w0("selectionchange",!1,e))}}function NN(t,e,n,r){switch(dN(e)){case 1:var s=XO;break;case 4:s=QO;break;default:s=Ab}n=s.bind(null,e,n,t),s=void 0,!lx||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function v0(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=_l(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}XE(function(){var u=i,d=jb(n),f=[];e:{var h=CN.get(t);if(h!==void 0){var p=Ob,m=t;switch(t){case"keypress":if(sp(n)===0)break e;case"keydown":case"keyup":p=hP;break;case"focusin":m="focus",p=p0;break;case"focusout":m="blur",p=p0;break;case"beforeblur":case"afterblur":p=p0;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=$k;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=tP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=gP;break;case kN:case SN:case _N:p=sP;break;case TN:p=xP;break;case"scroll":p=ZO;break;case"wheel":p=wP;break;case"copy":case"cut":case"paste":p=oP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Fk}var y=(e&4)!==0,b=!y&&t==="scroll",g=y?h!==null?h+"Capture":null:h;y=[];for(var v=u,w;v!==null;){w=v;var _=w.stateNode;if(w.tag===5&&_!==null&&(w=_,g!==null&&(_=Yd(v,g),_!=null&&y.push(nf(v,_,w)))),b)break;v=v.return}0<y.length&&(h=new p(h,m,null,n,d),f.push({event:h,listeners:y}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",h&&n!==ox&&(m=n.relatedTarget||n.fromElement)&&(_l(m)||m[Yo]))break e;if((p||h)&&(h=d.window===d?d:(h=d.ownerDocument)?h.defaultView||h.parentWindow:window,p?(m=n.relatedTarget||n.toElement,p=u,m=m?_l(m):null,m!==null&&(b=rc(m),m!==b||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=u),p!==m)){if(y=$k,_="onMouseLeave",g="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(y=Fk,_="onPointerLeave",g="onPointerEnter",v="pointer"),b=p==null?h:Oc(p),w=m==null?h:Oc(m),h=new y(_,v+"leave",p,n,d),h.target=b,h.relatedTarget=w,_=null,_l(d)===u&&(y=new y(g,v+"enter",m,n,d),y.target=w,y.relatedTarget=b,_=y),b=_,p&&m)t:{for(y=p,g=m,v=0,w=y;w;w=uc(w))v++;for(w=0,_=g;_;_=uc(_))w++;for(;0<v-w;)y=uc(y),v--;for(;0<w-v;)g=uc(g),w--;for(;v--;){if(y===g||g!==null&&y===g.alternate)break t;y=uc(y),g=uc(g)}y=null}else y=null;p!==null&&Xk(f,h,p,y,!1),m!==null&&b!==null&&Xk(f,b,m,y,!0)}}e:{if(h=u?Oc(u):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var D=EP;else if(Hk(h))if(yN)D=MP;else{D=jP;var k=NP}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(D=IP);if(D&&(D=D(t,u))){gN(f,D,n,d);break e}k&&k(t,h,u),t==="focusout"&&(k=h._wrapperState)&&k.controlled&&h.type==="number"&&tx(h,"number",h.value)}switch(k=u?Oc(u):window,t){case"focusin":(Hk(k)||k.contentEditable==="true")&&(Ac=k,hx=u,kd=null);break;case"focusout":kd=hx=Ac=null;break;case"mousedown":px=!0;break;case"contextmenu":case"mouseup":case"dragend":px=!1,qk(f,n,d);break;case"selectionchange":if(RP)break;case"keydown":case"keyup":qk(f,n,d)}var A;if(Lb)e:{switch(t){case"compositionstart":var N="onCompositionStart";break e;case"compositionend":N="onCompositionEnd";break e;case"compositionupdate":N="onCompositionUpdate";break e}N=void 0}else Dc?pN(t,n)&&(N="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(N="onCompositionStart");N&&(hN&&n.locale!=="ko"&&(Dc||N!=="onCompositionStart"?N==="onCompositionEnd"&&Dc&&(A=fN()):(Sa=d,Rb="value"in Sa?Sa.value:Sa.textContent,Dc=!0)),k=Fp(u,N),0<k.length&&(N=new zk(N,t,null,n,d),f.push({event:N,listeners:k}),A?N.data=A:(A=mN(n),A!==null&&(N.data=A)))),(A=kP?SP(t,n):_P(t,n))&&(u=Fp(u,"onBeforeInput"),0<u.length&&(d=new zk("onBeforeInput","beforeinput",null,n,d),f.push({event:d,listeners:u}),d.data=A))}EN(f,e)})}function nf(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Fp(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Yd(t,n),i!=null&&r.unshift(nf(t,i,s)),i=Yd(t,e),i!=null&&r.push(nf(t,i,s))),t=t.return}return r}function uc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Xk(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=Yd(n,i),l!=null&&o.unshift(nf(n,l,a))):s||(l=Yd(n,i),l!=null&&o.push(nf(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var $P=/\r\n?/g,zP=/\u0000|\uFFFD/g;function Qk(t){return(typeof t=="string"?t:""+t).replace($P,`
`).replace(zP,"")}function wh(t,e,n){if(e=Qk(e),Qk(t)!==e&&n)throw Error(Dt(425))}function Bp(){}var mx=null,gx=null;function yx(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var xx=typeof setTimeout=="function"?setTimeout:void 0,FP=typeof clearTimeout=="function"?clearTimeout:void 0,Zk=typeof Promise=="function"?Promise:void 0,BP=typeof queueMicrotask=="function"?queueMicrotask:typeof Zk<"u"?function(t){return Zk.resolve(null).then(t).catch(UP)}:xx;function UP(t){setTimeout(function(){throw t})}function k0(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Qd(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Qd(e)}function Ma(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function eS(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Iu=Math.random().toString(36).slice(2),fo="__reactFiber$"+Iu,rf="__reactProps$"+Iu,Yo="__reactContainer$"+Iu,bx="__reactEvents$"+Iu,HP="__reactListeners$"+Iu,VP="__reactHandles$"+Iu;function _l(t){var e=t[fo];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Yo]||n[fo]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=eS(t);t!==null;){if(n=t[fo])return n;t=eS(t)}return e}t=n,n=t.parentNode}return null}function Wf(t){return t=t[fo]||t[Yo],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Oc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Dt(33))}function mg(t){return t[rf]||null}var wx=[],Pc=-1;function Ja(t){return{current:t}}function er(t){0>Pc||(t.current=wx[Pc],wx[Pc]=null,Pc--)}function Wn(t,e){Pc++,wx[Pc]=t.current,t.current=e}var Ha={},xs=Ja(Ha),Us=Ja(!1),Wl=Ha;function mu(t,e){var n=t.type.contextTypes;if(!n)return Ha;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Hs(t){return t=t.childContextTypes,t!=null}function Up(){er(Us),er(xs)}function tS(t,e,n){if(xs.current!==Ha)throw Error(Dt(168));Wn(xs,e),Wn(Us,n)}function jN(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Dt(108,NO(t)||"Unknown",s));return pr({},n,r)}function Hp(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ha,Wl=xs.current,Wn(xs,t),Wn(Us,Us.current),!0}function nS(t,e,n){var r=t.stateNode;if(!r)throw Error(Dt(169));n?(t=jN(t,e,Wl),r.__reactInternalMemoizedMergedChildContext=t,er(Us),er(xs),Wn(xs,t)):er(Us),Wn(Us,n)}var zo=null,gg=!1,S0=!1;function IN(t){zo===null?zo=[t]:zo.push(t)}function WP(t){gg=!0,IN(t)}function Xa(){if(!S0&&zo!==null){S0=!0;var t=0,e=$n;try{var n=zo;for($n=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}zo=null,gg=!1}catch(s){throw zo!==null&&(zo=zo.slice(t+1)),tN(Ib,Xa),s}finally{$n=e,S0=!1}}return null}var Lc=[],$c=0,Vp=null,Wp=0,wi=[],vi=0,Kl=null,Bo=1,Uo="";function fl(t,e){Lc[$c++]=Wp,Lc[$c++]=Vp,Vp=t,Wp=e}function MN(t,e,n){wi[vi++]=Bo,wi[vi++]=Uo,wi[vi++]=Kl,Kl=t;var r=Bo;t=Uo;var s=32-Zi(r)-1;r&=~(1<<s),n+=1;var i=32-Zi(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Bo=1<<32-Zi(e)+s|n<<s|r,Uo=i+t}else Bo=1<<i|n<<s|r,Uo=t}function zb(t){t.return!==null&&(fl(t,1),MN(t,1,0))}function Fb(t){for(;t===Vp;)Vp=Lc[--$c],Lc[$c]=null,Wp=Lc[--$c],Lc[$c]=null;for(;t===Kl;)Kl=wi[--vi],wi[vi]=null,Uo=wi[--vi],wi[vi]=null,Bo=wi[--vi],wi[vi]=null}var ii=null,ni=null,ir=!1,Xi=null;function DN(t,e){var n=_i(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function rS(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ii=t,ni=Ma(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ii=t,ni=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Kl!==null?{id:Bo,overflow:Uo}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=_i(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ii=t,ni=null,!0):!1;default:return!1}}function vx(t){return(t.mode&1)!==0&&(t.flags&128)===0}function kx(t){if(ir){var e=ni;if(e){var n=e;if(!rS(t,e)){if(vx(t))throw Error(Dt(418));e=Ma(n.nextSibling);var r=ii;e&&rS(t,e)?DN(r,n):(t.flags=t.flags&-4097|2,ir=!1,ii=t)}}else{if(vx(t))throw Error(Dt(418));t.flags=t.flags&-4097|2,ir=!1,ii=t}}}function sS(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ii=t}function vh(t){if(t!==ii)return!1;if(!ir)return sS(t),ir=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!yx(t.type,t.memoizedProps)),e&&(e=ni)){if(vx(t))throw AN(),Error(Dt(418));for(;e;)DN(t,e),e=Ma(e.nextSibling)}if(sS(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Dt(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ni=Ma(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ni=null}}else ni=ii?Ma(t.stateNode.nextSibling):null;return!0}function AN(){for(var t=ni;t;)t=Ma(t.nextSibling)}function gu(){ni=ii=null,ir=!1}function Bb(t){Xi===null?Xi=[t]:Xi.push(t)}var KP=ta.ReactCurrentBatchConfig;function Ju(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Dt(309));var r=n.stateNode}if(!r)throw Error(Dt(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(Dt(284));if(!n._owner)throw Error(Dt(290,t))}return t}function kh(t,e){throw t=Object.prototype.toString.call(e),Error(Dt(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function iS(t){var e=t._init;return e(t._payload)}function RN(t){function e(g,v){if(t){var w=g.deletions;w===null?(g.deletions=[v],g.flags|=16):w.push(v)}}function n(g,v){if(!t)return null;for(;v!==null;)e(g,v),v=v.sibling;return null}function r(g,v){for(g=new Map;v!==null;)v.key!==null?g.set(v.key,v):g.set(v.index,v),v=v.sibling;return g}function s(g,v){return g=Oa(g,v),g.index=0,g.sibling=null,g}function i(g,v,w){return g.index=w,t?(w=g.alternate,w!==null?(w=w.index,w<v?(g.flags|=2,v):w):(g.flags|=2,v)):(g.flags|=1048576,v)}function o(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,v,w,_){return v===null||v.tag!==6?(v=I0(w,g.mode,_),v.return=g,v):(v=s(v,w),v.return=g,v)}function l(g,v,w,_){var D=w.type;return D===Mc?d(g,v,w.props.children,_,w.key):v!==null&&(v.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===da&&iS(D)===v.type)?(_=s(v,w.props),_.ref=Ju(g,v,w),_.return=g,_):(_=dp(w.type,w.key,w.props,null,g.mode,_),_.ref=Ju(g,v,w),_.return=g,_)}function u(g,v,w,_){return v===null||v.tag!==4||v.stateNode.containerInfo!==w.containerInfo||v.stateNode.implementation!==w.implementation?(v=M0(w,g.mode,_),v.return=g,v):(v=s(v,w.children||[]),v.return=g,v)}function d(g,v,w,_,D){return v===null||v.tag!==7?(v=Pl(w,g.mode,_,D),v.return=g,v):(v=s(v,w),v.return=g,v)}function f(g,v,w){if(typeof v=="string"&&v!==""||typeof v=="number")return v=I0(""+v,g.mode,w),v.return=g,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case dh:return w=dp(v.type,v.key,v.props,null,g.mode,w),w.ref=Ju(g,null,v),w.return=g,w;case Ic:return v=M0(v,g.mode,w),v.return=g,v;case da:var _=v._init;return f(g,_(v._payload),w)}if(ad(v)||Wu(v))return v=Pl(v,g.mode,w,null),v.return=g,v;kh(g,v)}return null}function h(g,v,w,_){var D=v!==null?v.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return D!==null?null:a(g,v,""+w,_);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case dh:return w.key===D?l(g,v,w,_):null;case Ic:return w.key===D?u(g,v,w,_):null;case da:return D=w._init,h(g,v,D(w._payload),_)}if(ad(w)||Wu(w))return D!==null?null:d(g,v,w,_,null);kh(g,w)}return null}function p(g,v,w,_,D){if(typeof _=="string"&&_!==""||typeof _=="number")return g=g.get(w)||null,a(v,g,""+_,D);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case dh:return g=g.get(_.key===null?w:_.key)||null,l(v,g,_,D);case Ic:return g=g.get(_.key===null?w:_.key)||null,u(v,g,_,D);case da:var k=_._init;return p(g,v,w,k(_._payload),D)}if(ad(_)||Wu(_))return g=g.get(w)||null,d(v,g,_,D,null);kh(v,_)}return null}function m(g,v,w,_){for(var D=null,k=null,A=v,N=v=0,E=null;A!==null&&N<w.length;N++){A.index>N?(E=A,A=null):E=A.sibling;var S=h(g,A,w[N],_);if(S===null){A===null&&(A=E);break}t&&A&&S.alternate===null&&e(g,A),v=i(S,v,N),k===null?D=S:k.sibling=S,k=S,A=E}if(N===w.length)return n(g,A),ir&&fl(g,N),D;if(A===null){for(;N<w.length;N++)A=f(g,w[N],_),A!==null&&(v=i(A,v,N),k===null?D=A:k.sibling=A,k=A);return ir&&fl(g,N),D}for(A=r(g,A);N<w.length;N++)E=p(A,g,N,w[N],_),E!==null&&(t&&E.alternate!==null&&A.delete(E.key===null?N:E.key),v=i(E,v,N),k===null?D=E:k.sibling=E,k=E);return t&&A.forEach(function(T){return e(g,T)}),ir&&fl(g,N),D}function y(g,v,w,_){var D=Wu(w);if(typeof D!="function")throw Error(Dt(150));if(w=D.call(w),w==null)throw Error(Dt(151));for(var k=D=null,A=v,N=v=0,E=null,S=w.next();A!==null&&!S.done;N++,S=w.next()){A.index>N?(E=A,A=null):E=A.sibling;var T=h(g,A,S.value,_);if(T===null){A===null&&(A=E);break}t&&A&&T.alternate===null&&e(g,A),v=i(T,v,N),k===null?D=T:k.sibling=T,k=T,A=E}if(S.done)return n(g,A),ir&&fl(g,N),D;if(A===null){for(;!S.done;N++,S=w.next())S=f(g,S.value,_),S!==null&&(v=i(S,v,N),k===null?D=S:k.sibling=S,k=S);return ir&&fl(g,N),D}for(A=r(g,A);!S.done;N++,S=w.next())S=p(A,g,N,S.value,_),S!==null&&(t&&S.alternate!==null&&A.delete(S.key===null?N:S.key),v=i(S,v,N),k===null?D=S:k.sibling=S,k=S);return t&&A.forEach(function(C){return e(g,C)}),ir&&fl(g,N),D}function b(g,v,w,_){if(typeof w=="object"&&w!==null&&w.type===Mc&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case dh:e:{for(var D=w.key,k=v;k!==null;){if(k.key===D){if(D=w.type,D===Mc){if(k.tag===7){n(g,k.sibling),v=s(k,w.props.children),v.return=g,g=v;break e}}else if(k.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===da&&iS(D)===k.type){n(g,k.sibling),v=s(k,w.props),v.ref=Ju(g,k,w),v.return=g,g=v;break e}n(g,k);break}else e(g,k);k=k.sibling}w.type===Mc?(v=Pl(w.props.children,g.mode,_,w.key),v.return=g,g=v):(_=dp(w.type,w.key,w.props,null,g.mode,_),_.ref=Ju(g,v,w),_.return=g,g=_)}return o(g);case Ic:e:{for(k=w.key;v!==null;){if(v.key===k)if(v.tag===4&&v.stateNode.containerInfo===w.containerInfo&&v.stateNode.implementation===w.implementation){n(g,v.sibling),v=s(v,w.children||[]),v.return=g,g=v;break e}else{n(g,v);break}else e(g,v);v=v.sibling}v=M0(w,g.mode,_),v.return=g,g=v}return o(g);case da:return k=w._init,b(g,v,k(w._payload),_)}if(ad(w))return m(g,v,w,_);if(Wu(w))return y(g,v,w,_);kh(g,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,v!==null&&v.tag===6?(n(g,v.sibling),v=s(v,w),v.return=g,g=v):(n(g,v),v=I0(w,g.mode,_),v.return=g,g=v),o(g)):n(g,v)}return b}var yu=RN(!0),ON=RN(!1),Kp=Ja(null),Gp=null,zc=null,Ub=null;function Hb(){Ub=zc=Gp=null}function Vb(t){var e=Kp.current;er(Kp),t._currentValue=e}function Sx(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function nu(t,e){Gp=t,Ub=zc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(zs=!0),t.firstContext=null)}function Di(t){var e=t._currentValue;if(Ub!==t)if(t={context:t,memoizedValue:e,next:null},zc===null){if(Gp===null)throw Error(Dt(308));zc=t,Gp.dependencies={lanes:0,firstContext:t}}else zc=zc.next=t;return e}var Tl=null;function Wb(t){Tl===null?Tl=[t]:Tl.push(t)}function PN(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,Wb(e)):(n.next=s.next,s.next=n),e.interleaved=n,Jo(t,r)}function Jo(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var fa=!1;function Kb(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function LN(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Vo(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Da(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,An&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Jo(t,n)}return s=r.interleaved,s===null?(e.next=e,Wb(r)):(e.next=s.next,s.next=e),r.interleaved=e,Jo(t,n)}function ip(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Mb(t,n)}}function oS(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function qp(t,e,n,r){var s=t.updateQueue;fa=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var d=t.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=u:a.next=u,d.lastBaseUpdate=l))}if(i!==null){var f=s.baseState;o=0,d=u=l=null,a=i;do{var h=a.lane,p=a.eventTime;if((r&h)===h){d!==null&&(d=d.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=t,y=a;switch(h=e,p=n,y.tag){case 1:if(m=y.payload,typeof m=="function"){f=m.call(p,f,h);break e}f=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=y.payload,h=typeof m=="function"?m.call(p,f,h):m,h==null)break e;f=pr({},f,h);break e;case 2:fa=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=s.effects,h===null?s.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(u=d=p,l=f):d=d.next=p,o|=h;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;h=a,a=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(1);if(d===null&&(l=f),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=d,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);ql|=o,t.lanes=o,t.memoizedState=f}}function aS(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(Dt(191,s));s.call(r)}}}var Kf={},bo=Ja(Kf),sf=Ja(Kf),of=Ja(Kf);function Cl(t){if(t===Kf)throw Error(Dt(174));return t}function Gb(t,e){switch(Wn(of,e),Wn(sf,t),Wn(bo,Kf),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:rx(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=rx(e,t)}er(bo),Wn(bo,e)}function xu(){er(bo),er(sf),er(of)}function $N(t){Cl(of.current);var e=Cl(bo.current),n=rx(e,t.type);e!==n&&(Wn(sf,t),Wn(bo,n))}function qb(t){sf.current===t&&(er(bo),er(sf))}var dr=Ja(0);function Yp(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var _0=[];function Yb(){for(var t=0;t<_0.length;t++)_0[t]._workInProgressVersionPrimary=null;_0.length=0}var op=ta.ReactCurrentDispatcher,T0=ta.ReactCurrentBatchConfig,Gl=0,hr=null,Or=null,zr=null,Jp=!1,Sd=!1,af=0,GP=0;function us(){throw Error(Dt(321))}function Jb(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!to(t[n],e[n]))return!1;return!0}function Xb(t,e,n,r,s,i){if(Gl=i,hr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,op.current=t===null||t.memoizedState===null?XP:QP,t=n(r,s),Sd){i=0;do{if(Sd=!1,af=0,25<=i)throw Error(Dt(301));i+=1,zr=Or=null,e.updateQueue=null,op.current=ZP,t=n(r,s)}while(Sd)}if(op.current=Xp,e=Or!==null&&Or.next!==null,Gl=0,zr=Or=hr=null,Jp=!1,e)throw Error(Dt(300));return t}function Qb(){var t=af!==0;return af=0,t}function io(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zr===null?hr.memoizedState=zr=t:zr=zr.next=t,zr}function Ai(){if(Or===null){var t=hr.alternate;t=t!==null?t.memoizedState:null}else t=Or.next;var e=zr===null?hr.memoizedState:zr.next;if(e!==null)zr=e,Or=t;else{if(t===null)throw Error(Dt(310));Or=t,t={memoizedState:Or.memoizedState,baseState:Or.baseState,baseQueue:Or.baseQueue,queue:Or.queue,next:null},zr===null?hr.memoizedState=zr=t:zr=zr.next=t}return zr}function lf(t,e){return typeof e=="function"?e(t):e}function C0(t){var e=Ai(),n=e.queue;if(n===null)throw Error(Dt(311));n.lastRenderedReducer=t;var r=Or,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var d=u.lane;if((Gl&d)===d)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var f={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,hr.lanes|=d,ql|=d}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,to(r,e.memoizedState)||(zs=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,hr.lanes|=i,ql|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function E0(t){var e=Ai(),n=e.queue;if(n===null)throw Error(Dt(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);to(i,e.memoizedState)||(zs=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function zN(){}function FN(t,e){var n=hr,r=Ai(),s=e(),i=!to(r.memoizedState,s);if(i&&(r.memoizedState=s,zs=!0),r=r.queue,Zb(HN.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||zr!==null&&zr.memoizedState.tag&1){if(n.flags|=2048,cf(9,UN.bind(null,n,r,s,e),void 0,null),Ur===null)throw Error(Dt(349));Gl&30||BN(n,e,s)}return s}function BN(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=hr.updateQueue,e===null?(e={lastEffect:null,stores:null},hr.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function UN(t,e,n,r){e.value=n,e.getSnapshot=r,VN(e)&&WN(t)}function HN(t,e,n){return n(function(){VN(e)&&WN(t)})}function VN(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!to(t,n)}catch{return!0}}function WN(t){var e=Jo(t,1);e!==null&&eo(e,t,1,-1)}function lS(t){var e=io();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:lf,lastRenderedState:t},e.queue=t,t=t.dispatch=JP.bind(null,hr,t),[e.memoizedState,t]}function cf(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=hr.updateQueue,e===null?(e={lastEffect:null,stores:null},hr.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function KN(){return Ai().memoizedState}function ap(t,e,n,r){var s=io();hr.flags|=t,s.memoizedState=cf(1|e,n,void 0,r===void 0?null:r)}function yg(t,e,n,r){var s=Ai();r=r===void 0?null:r;var i=void 0;if(Or!==null){var o=Or.memoizedState;if(i=o.destroy,r!==null&&Jb(r,o.deps)){s.memoizedState=cf(e,n,i,r);return}}hr.flags|=t,s.memoizedState=cf(1|e,n,i,r)}function cS(t,e){return ap(8390656,8,t,e)}function Zb(t,e){return yg(2048,8,t,e)}function GN(t,e){return yg(4,2,t,e)}function qN(t,e){return yg(4,4,t,e)}function YN(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function JN(t,e,n){return n=n!=null?n.concat([t]):null,yg(4,4,YN.bind(null,e,t),n)}function ew(){}function XN(t,e){var n=Ai();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Jb(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function QN(t,e){var n=Ai();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Jb(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function ZN(t,e,n){return Gl&21?(to(n,e)||(n=sN(),hr.lanes|=n,ql|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,zs=!0),t.memoizedState=n)}function qP(t,e){var n=$n;$n=n!==0&&4>n?n:4,t(!0);var r=T0.transition;T0.transition={};try{t(!1),e()}finally{$n=n,T0.transition=r}}function ej(){return Ai().memoizedState}function YP(t,e,n){var r=Ra(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},tj(t))nj(e,n);else if(n=PN(t,e,n,r),n!==null){var s=Cs();eo(n,t,r,s),rj(n,e,r)}}function JP(t,e,n){var r=Ra(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(tj(t))nj(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(s.hasEagerState=!0,s.eagerState=a,to(a,o)){var l=e.interleaved;l===null?(s.next=s,Wb(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}n=PN(t,e,s,r),n!==null&&(s=Cs(),eo(n,t,r,s),rj(n,e,r))}}function tj(t){var e=t.alternate;return t===hr||e!==null&&e===hr}function nj(t,e){Sd=Jp=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function rj(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Mb(t,n)}}var Xp={readContext:Di,useCallback:us,useContext:us,useEffect:us,useImperativeHandle:us,useInsertionEffect:us,useLayoutEffect:us,useMemo:us,useReducer:us,useRef:us,useState:us,useDebugValue:us,useDeferredValue:us,useTransition:us,useMutableSource:us,useSyncExternalStore:us,useId:us,unstable_isNewReconciler:!1},XP={readContext:Di,useCallback:function(t,e){return io().memoizedState=[t,e===void 0?null:e],t},useContext:Di,useEffect:cS,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ap(4194308,4,YN.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ap(4194308,4,t,e)},useInsertionEffect:function(t,e){return ap(4,2,t,e)},useMemo:function(t,e){var n=io();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=io();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=YP.bind(null,hr,t),[r.memoizedState,t]},useRef:function(t){var e=io();return t={current:t},e.memoizedState=t},useState:lS,useDebugValue:ew,useDeferredValue:function(t){return io().memoizedState=t},useTransition:function(){var t=lS(!1),e=t[0];return t=qP.bind(null,t[1]),io().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=hr,s=io();if(ir){if(n===void 0)throw Error(Dt(407));n=n()}else{if(n=e(),Ur===null)throw Error(Dt(349));Gl&30||BN(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,cS(HN.bind(null,r,i,t),[t]),r.flags|=2048,cf(9,UN.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=io(),e=Ur.identifierPrefix;if(ir){var n=Uo,r=Bo;n=(r&~(1<<32-Zi(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=af++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=GP++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},QP={readContext:Di,useCallback:XN,useContext:Di,useEffect:Zb,useImperativeHandle:JN,useInsertionEffect:GN,useLayoutEffect:qN,useMemo:QN,useReducer:C0,useRef:KN,useState:function(){return C0(lf)},useDebugValue:ew,useDeferredValue:function(t){var e=Ai();return ZN(e,Or.memoizedState,t)},useTransition:function(){var t=C0(lf)[0],e=Ai().memoizedState;return[t,e]},useMutableSource:zN,useSyncExternalStore:FN,useId:ej,unstable_isNewReconciler:!1},ZP={readContext:Di,useCallback:XN,useContext:Di,useEffect:Zb,useImperativeHandle:JN,useInsertionEffect:GN,useLayoutEffect:qN,useMemo:QN,useReducer:E0,useRef:KN,useState:function(){return E0(lf)},useDebugValue:ew,useDeferredValue:function(t){var e=Ai();return Or===null?e.memoizedState=t:ZN(e,Or.memoizedState,t)},useTransition:function(){var t=E0(lf)[0],e=Ai().memoizedState;return[t,e]},useMutableSource:zN,useSyncExternalStore:FN,useId:ej,unstable_isNewReconciler:!1};function Gi(t,e){if(t&&t.defaultProps){e=pr({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function _x(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:pr({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var xg={isMounted:function(t){return(t=t._reactInternals)?rc(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Cs(),s=Ra(t),i=Vo(r,s);i.payload=e,n!=null&&(i.callback=n),e=Da(t,i,s),e!==null&&(eo(e,t,s,r),ip(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Cs(),s=Ra(t),i=Vo(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Da(t,i,s),e!==null&&(eo(e,t,s,r),ip(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Cs(),r=Ra(t),s=Vo(n,r);s.tag=2,e!=null&&(s.callback=e),e=Da(t,s,r),e!==null&&(eo(e,t,r,n),ip(e,t,r))}};function uS(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!ef(n,r)||!ef(s,i):!0}function sj(t,e,n){var r=!1,s=Ha,i=e.contextType;return typeof i=="object"&&i!==null?i=Di(i):(s=Hs(e)?Wl:xs.current,r=e.contextTypes,i=(r=r!=null)?mu(t,s):Ha),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=xg,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function dS(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&xg.enqueueReplaceState(e,e.state,null)}function Tx(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Kb(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Di(i):(i=Hs(e)?Wl:xs.current,s.context=mu(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(_x(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&xg.enqueueReplaceState(s,s.state,null),qp(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function bu(t,e){try{var n="",r=e;do n+=EO(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function N0(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Cx(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var e4=typeof WeakMap=="function"?WeakMap:Map;function ij(t,e,n){n=Vo(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Zp||(Zp=!0,Px=r),Cx(t,e)},n}function oj(t,e,n){n=Vo(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Cx(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Cx(t,e),typeof r!="function"&&(Aa===null?Aa=new Set([this]):Aa.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function fS(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new e4;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=p4.bind(null,t,e,n),e.then(t,t))}function hS(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function pS(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Vo(-1,1),e.tag=2,Da(n,e,1))),n.lanes|=1),t)}var t4=ta.ReactCurrentOwner,zs=!1;function _s(t,e,n,r){e.child=t===null?ON(e,null,n,r):yu(e,t.child,n,r)}function mS(t,e,n,r,s){n=n.render;var i=e.ref;return nu(e,s),r=Xb(t,e,n,r,i,s),n=Qb(),t!==null&&!zs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Xo(t,e,s)):(ir&&n&&zb(e),e.flags|=1,_s(t,e,r,s),e.child)}function gS(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!lw(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,aj(t,e,i,r,s)):(t=dp(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:ef,n(o,r)&&t.ref===e.ref)return Xo(t,e,s)}return e.flags|=1,t=Oa(i,r),t.ref=e.ref,t.return=e,e.child=t}function aj(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(ef(i,r)&&t.ref===e.ref)if(zs=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(zs=!0);else return e.lanes=t.lanes,Xo(t,e,s)}return Ex(t,e,n,r,s)}function lj(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Wn(Bc,Qs),Qs|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Wn(Bc,Qs),Qs|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Wn(Bc,Qs),Qs|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Wn(Bc,Qs),Qs|=r;return _s(t,e,s,n),e.child}function cj(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Ex(t,e,n,r,s){var i=Hs(n)?Wl:xs.current;return i=mu(e,i),nu(e,s),n=Xb(t,e,n,r,i,s),r=Qb(),t!==null&&!zs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Xo(t,e,s)):(ir&&r&&zb(e),e.flags|=1,_s(t,e,n,s),e.child)}function yS(t,e,n,r,s){if(Hs(n)){var i=!0;Hp(e)}else i=!1;if(nu(e,s),e.stateNode===null)lp(t,e),sj(e,n,r),Tx(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=Di(u):(u=Hs(n)?Wl:xs.current,u=mu(e,u));var d=n.getDerivedStateFromProps,f=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&dS(e,o,r,u),fa=!1;var h=e.memoizedState;o.state=h,qp(e,r,o,s),l=e.memoizedState,a!==r||h!==l||Us.current||fa?(typeof d=="function"&&(_x(e,n,d,r),l=e.memoizedState),(a=fa||uS(e,n,a,r,h,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,LN(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:Gi(e.type,a),o.props=u,f=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Di(l):(l=Hs(n)?Wl:xs.current,l=mu(e,l));var p=n.getDerivedStateFromProps;(d=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||h!==l)&&dS(e,o,r,l),fa=!1,h=e.memoizedState,o.state=h,qp(e,r,o,s);var m=e.memoizedState;a!==f||h!==m||Us.current||fa?(typeof p=="function"&&(_x(e,n,p,r),m=e.memoizedState),(u=fa||uS(e,n,u,r,h,m,l)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),o.props=r,o.state=m,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return Nx(t,e,n,r,i,s)}function Nx(t,e,n,r,s,i){cj(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&nS(e,n,!1),Xo(t,e,i);r=e.stateNode,t4.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=yu(e,t.child,null,i),e.child=yu(e,null,a,i)):_s(t,e,a,i),e.memoizedState=r.state,s&&nS(e,n,!0),e.child}function uj(t){var e=t.stateNode;e.pendingContext?tS(t,e.pendingContext,e.pendingContext!==e.context):e.context&&tS(t,e.context,!1),Gb(t,e.containerInfo)}function xS(t,e,n,r,s){return gu(),Bb(s),e.flags|=256,_s(t,e,n,r),e.child}var jx={dehydrated:null,treeContext:null,retryLane:0};function Ix(t){return{baseLanes:t,cachePool:null,transitions:null}}function dj(t,e,n){var r=e.pendingProps,s=dr.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Wn(dr,s&1),t===null)return kx(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=vg(o,r,0,null),t=Pl(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Ix(n),e.memoizedState=jx,t):tw(e,o));if(s=t.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return n4(t,e,o,r,a,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Oa(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Oa(a,i):(i=Pl(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?Ix(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=jx,r}return i=t.child,t=i.sibling,r=Oa(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function tw(t,e){return e=vg({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Sh(t,e,n,r){return r!==null&&Bb(r),yu(e,t.child,null,n),t=tw(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function n4(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=N0(Error(Dt(422))),Sh(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=vg({mode:"visible",children:r.children},s,0,null),i=Pl(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&yu(e,t.child,null,o),e.child.memoizedState=Ix(o),e.memoizedState=jx,i);if(!(e.mode&1))return Sh(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(Dt(419)),r=N0(i,r,void 0),Sh(t,e,o,r)}if(a=(o&t.childLanes)!==0,zs||a){if(r=Ur,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Jo(t,s),eo(r,t,s,-1))}return aw(),r=N0(Error(Dt(421))),Sh(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=m4.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,ni=Ma(s.nextSibling),ii=e,ir=!0,Xi=null,t!==null&&(wi[vi++]=Bo,wi[vi++]=Uo,wi[vi++]=Kl,Bo=t.id,Uo=t.overflow,Kl=e),e=tw(e,r.children),e.flags|=4096,e)}function bS(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Sx(t.return,e,n)}function j0(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function fj(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(_s(t,e,r.children,n),r=dr.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&bS(t,n,e);else if(t.tag===19)bS(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Wn(dr,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Yp(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),j0(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Yp(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}j0(e,!0,n,null,i);break;case"together":j0(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function lp(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Xo(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ql|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Dt(153));if(e.child!==null){for(t=e.child,n=Oa(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Oa(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function r4(t,e,n){switch(e.tag){case 3:uj(e),gu();break;case 5:$N(e);break;case 1:Hs(e.type)&&Hp(e);break;case 4:Gb(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Wn(Kp,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Wn(dr,dr.current&1),e.flags|=128,null):n&e.child.childLanes?dj(t,e,n):(Wn(dr,dr.current&1),t=Xo(t,e,n),t!==null?t.sibling:null);Wn(dr,dr.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return fj(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Wn(dr,dr.current),r)break;return null;case 22:case 23:return e.lanes=0,lj(t,e,n)}return Xo(t,e,n)}var hj,Mx,pj,mj;hj=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Mx=function(){};pj=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Cl(bo.current);var i=null;switch(n){case"input":s=Zy(t,s),r=Zy(t,r),i=[];break;case"select":s=pr({},s,{value:void 0}),r=pr({},r,{value:void 0}),i=[];break;case"textarea":s=nx(t,s),r=nx(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Bp)}sx(n,r);var o;n=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Gd.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(i||(i=[]),i.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Gd.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Jn("scroll",t),i||a===l||(i=[])):(i=i||[]).push(u,l))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};mj=function(t,e,n,r){n!==r&&(e.flags|=4)};function Xu(t,e){if(!ir)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function ds(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function s4(t,e,n){var r=e.pendingProps;switch(Fb(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ds(e),null;case 1:return Hs(e.type)&&Up(),ds(e),null;case 3:return r=e.stateNode,xu(),er(Us),er(xs),Yb(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(vh(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Xi!==null&&(zx(Xi),Xi=null))),Mx(t,e),ds(e),null;case 5:qb(e);var s=Cl(of.current);if(n=e.type,t!==null&&e.stateNode!=null)pj(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Dt(166));return ds(e),null}if(t=Cl(bo.current),vh(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[fo]=e,r[rf]=i,t=(e.mode&1)!==0,n){case"dialog":Jn("cancel",r),Jn("close",r);break;case"iframe":case"object":case"embed":Jn("load",r);break;case"video":case"audio":for(s=0;s<cd.length;s++)Jn(cd[s],r);break;case"source":Jn("error",r);break;case"img":case"image":case"link":Jn("error",r),Jn("load",r);break;case"details":Jn("toggle",r);break;case"input":Nk(r,i),Jn("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Jn("invalid",r);break;case"textarea":Ik(r,i),Jn("invalid",r)}sx(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&wh(r.textContent,a,t),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&wh(r.textContent,a,t),s=["children",""+a]):Gd.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Jn("scroll",r)}switch(n){case"input":fh(r),jk(r,i,!0);break;case"textarea":fh(r),Mk(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Bp)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=HE(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[fo]=e,t[rf]=r,hj(t,e,!1,!1),e.stateNode=t;e:{switch(o=ix(n,r),n){case"dialog":Jn("cancel",t),Jn("close",t),s=r;break;case"iframe":case"object":case"embed":Jn("load",t),s=r;break;case"video":case"audio":for(s=0;s<cd.length;s++)Jn(cd[s],t);s=r;break;case"source":Jn("error",t),s=r;break;case"img":case"image":case"link":Jn("error",t),Jn("load",t),s=r;break;case"details":Jn("toggle",t),s=r;break;case"input":Nk(t,r),s=Zy(t,r),Jn("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=pr({},r,{value:void 0}),Jn("invalid",t);break;case"textarea":Ik(t,r),s=nx(t,r),Jn("invalid",t);break;default:s=r}sx(n,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?KE(t,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&VE(t,l)):i==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&qd(t,l):typeof l=="number"&&qd(t,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Gd.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Jn("scroll",t):l!=null&&Tb(t,i,l,o))}switch(n){case"input":fh(t),jk(t,r,!1);break;case"textarea":fh(t),Mk(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ua(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?Qc(t,!!r.multiple,i,!1):r.defaultValue!=null&&Qc(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Bp)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ds(e),null;case 6:if(t&&e.stateNode!=null)mj(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Dt(166));if(n=Cl(of.current),Cl(bo.current),vh(e)){if(r=e.stateNode,n=e.memoizedProps,r[fo]=e,(i=r.nodeValue!==n)&&(t=ii,t!==null))switch(t.tag){case 3:wh(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&wh(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[fo]=e,e.stateNode=r}return ds(e),null;case 13:if(er(dr),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ir&&ni!==null&&e.mode&1&&!(e.flags&128))AN(),gu(),e.flags|=98560,i=!1;else if(i=vh(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(Dt(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Dt(317));i[fo]=e}else gu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ds(e),i=!1}else Xi!==null&&(zx(Xi),Xi=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||dr.current&1?Pr===0&&(Pr=3):aw())),e.updateQueue!==null&&(e.flags|=4),ds(e),null);case 4:return xu(),Mx(t,e),t===null&&tf(e.stateNode.containerInfo),ds(e),null;case 10:return Vb(e.type._context),ds(e),null;case 17:return Hs(e.type)&&Up(),ds(e),null;case 19:if(er(dr),i=e.memoizedState,i===null)return ds(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)Xu(i,!1);else{if(Pr!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Yp(t),o!==null){for(e.flags|=128,Xu(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Wn(dr,dr.current&1|2),e.child}t=t.sibling}i.tail!==null&&Sr()>wu&&(e.flags|=128,r=!0,Xu(i,!1),e.lanes=4194304)}else{if(!r)if(t=Yp(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Xu(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!ir)return ds(e),null}else 2*Sr()-i.renderingStartTime>wu&&n!==1073741824&&(e.flags|=128,r=!0,Xu(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Sr(),e.sibling=null,n=dr.current,Wn(dr,r?n&1|2:n&1),e):(ds(e),null);case 22:case 23:return ow(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Qs&1073741824&&(ds(e),e.subtreeFlags&6&&(e.flags|=8192)):ds(e),null;case 24:return null;case 25:return null}throw Error(Dt(156,e.tag))}function i4(t,e){switch(Fb(e),e.tag){case 1:return Hs(e.type)&&Up(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return xu(),er(Us),er(xs),Yb(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return qb(e),null;case 13:if(er(dr),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Dt(340));gu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return er(dr),null;case 4:return xu(),null;case 10:return Vb(e.type._context),null;case 22:case 23:return ow(),null;case 24:return null;default:return null}}var _h=!1,ms=!1,o4=typeof WeakSet=="function"?WeakSet:Set,Jt=null;function Fc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){xr(t,e,r)}else n.current=null}function Dx(t,e,n){try{n()}catch(r){xr(t,e,r)}}var wS=!1;function a4(t,e){if(mx=$p,t=wN(),$b(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,u=0,d=0,f=t,h=null;t:for(;;){for(var p;f!==n||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(p=f.firstChild)!==null;)h=f,f=p;for(;;){if(f===t)break t;if(h===n&&++u===s&&(a=o),h===i&&++d===r&&(l=o),(p=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=p}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(gx={focusedElem:t,selectionRange:n},$p=!1,Jt=e;Jt!==null;)if(e=Jt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Jt=t;else for(;Jt!==null;){e=Jt;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var y=m.memoizedProps,b=m.memoizedState,g=e.stateNode,v=g.getSnapshotBeforeUpdate(e.elementType===e.type?y:Gi(e.type,y),b);g.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Dt(163))}}catch(_){xr(e,e.return,_)}if(t=e.sibling,t!==null){t.return=e.return,Jt=t;break}Jt=e.return}return m=wS,wS=!1,m}function _d(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Dx(e,n,i)}s=s.next}while(s!==r)}}function bg(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Ax(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function gj(t){var e=t.alternate;e!==null&&(t.alternate=null,gj(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[fo],delete e[rf],delete e[bx],delete e[HP],delete e[VP])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function yj(t){return t.tag===5||t.tag===3||t.tag===4}function vS(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||yj(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Rx(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Bp));else if(r!==4&&(t=t.child,t!==null))for(Rx(t,e,n),t=t.sibling;t!==null;)Rx(t,e,n),t=t.sibling}function Ox(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Ox(t,e,n),t=t.sibling;t!==null;)Ox(t,e,n),t=t.sibling}var Xr=null,Yi=!1;function ra(t,e,n){for(n=n.child;n!==null;)xj(t,e,n),n=n.sibling}function xj(t,e,n){if(xo&&typeof xo.onCommitFiberUnmount=="function")try{xo.onCommitFiberUnmount(dg,n)}catch{}switch(n.tag){case 5:ms||Fc(n,e);case 6:var r=Xr,s=Yi;Xr=null,ra(t,e,n),Xr=r,Yi=s,Xr!==null&&(Yi?(t=Xr,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Xr.removeChild(n.stateNode));break;case 18:Xr!==null&&(Yi?(t=Xr,n=n.stateNode,t.nodeType===8?k0(t.parentNode,n):t.nodeType===1&&k0(t,n),Qd(t)):k0(Xr,n.stateNode));break;case 4:r=Xr,s=Yi,Xr=n.stateNode.containerInfo,Yi=!0,ra(t,e,n),Xr=r,Yi=s;break;case 0:case 11:case 14:case 15:if(!ms&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Dx(n,e,o),s=s.next}while(s!==r)}ra(t,e,n);break;case 1:if(!ms&&(Fc(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){xr(n,e,a)}ra(t,e,n);break;case 21:ra(t,e,n);break;case 22:n.mode&1?(ms=(r=ms)||n.memoizedState!==null,ra(t,e,n),ms=r):ra(t,e,n);break;default:ra(t,e,n)}}function kS(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new o4),e.forEach(function(r){var s=g4.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function zi(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Xr=a.stateNode,Yi=!1;break e;case 3:Xr=a.stateNode.containerInfo,Yi=!0;break e;case 4:Xr=a.stateNode.containerInfo,Yi=!0;break e}a=a.return}if(Xr===null)throw Error(Dt(160));xj(i,o,s),Xr=null,Yi=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){xr(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)bj(e,t),e=e.sibling}function bj(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(zi(e,t),so(t),r&4){try{_d(3,t,t.return),bg(3,t)}catch(y){xr(t,t.return,y)}try{_d(5,t,t.return)}catch(y){xr(t,t.return,y)}}break;case 1:zi(e,t),so(t),r&512&&n!==null&&Fc(n,n.return);break;case 5:if(zi(e,t),so(t),r&512&&n!==null&&Fc(n,n.return),t.flags&32){var s=t.stateNode;try{qd(s,"")}catch(y){xr(t,t.return,y)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&BE(s,i),ix(a,o);var u=ix(a,i);for(o=0;o<l.length;o+=2){var d=l[o],f=l[o+1];d==="style"?KE(s,f):d==="dangerouslySetInnerHTML"?VE(s,f):d==="children"?qd(s,f):Tb(s,d,f,u)}switch(a){case"input":ex(s,i);break;case"textarea":UE(s,i);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?Qc(s,!!i.multiple,p,!1):h!==!!i.multiple&&(i.defaultValue!=null?Qc(s,!!i.multiple,i.defaultValue,!0):Qc(s,!!i.multiple,i.multiple?[]:"",!1))}s[rf]=i}catch(y){xr(t,t.return,y)}}break;case 6:if(zi(e,t),so(t),r&4){if(t.stateNode===null)throw Error(Dt(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(y){xr(t,t.return,y)}}break;case 3:if(zi(e,t),so(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Qd(e.containerInfo)}catch(y){xr(t,t.return,y)}break;case 4:zi(e,t),so(t);break;case 13:zi(e,t),so(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(sw=Sr())),r&4&&kS(t);break;case 22:if(d=n!==null&&n.memoizedState!==null,t.mode&1?(ms=(u=ms)||d,zi(e,t),ms=u):zi(e,t),so(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!d&&t.mode&1)for(Jt=t,d=t.child;d!==null;){for(f=Jt=d;Jt!==null;){switch(h=Jt,p=h.child,h.tag){case 0:case 11:case 14:case 15:_d(4,h,h.return);break;case 1:Fc(h,h.return);var m=h.stateNode;if(typeof m.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(y){xr(r,n,y)}}break;case 5:Fc(h,h.return);break;case 22:if(h.memoizedState!==null){_S(f);continue}}p!==null?(p.return=h,Jt=p):_S(f)}d=d.sibling}e:for(d=null,f=t;;){if(f.tag===5){if(d===null){d=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=WE("display",o))}catch(y){xr(t,t.return,y)}}}else if(f.tag===6){if(d===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(y){xr(t,t.return,y)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:zi(e,t),so(t),r&4&&kS(t);break;case 21:break;default:zi(e,t),so(t)}}function so(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(yj(n)){var r=n;break e}n=n.return}throw Error(Dt(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(qd(s,""),r.flags&=-33);var i=vS(t);Ox(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=vS(t);Rx(t,a,o);break;default:throw Error(Dt(161))}}catch(l){xr(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function l4(t,e,n){Jt=t,wj(t)}function wj(t,e,n){for(var r=(t.mode&1)!==0;Jt!==null;){var s=Jt,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||_h;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||ms;a=_h;var u=ms;if(_h=o,(ms=l)&&!u)for(Jt=s;Jt!==null;)o=Jt,l=o.child,o.tag===22&&o.memoizedState!==null?TS(s):l!==null?(l.return=o,Jt=l):TS(s);for(;i!==null;)Jt=i,wj(i),i=i.sibling;Jt=s,_h=a,ms=u}SS(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,Jt=i):SS(t)}}function SS(t){for(;Jt!==null;){var e=Jt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ms||bg(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ms)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Gi(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&aS(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}aS(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var f=d.dehydrated;f!==null&&Qd(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Dt(163))}ms||e.flags&512&&Ax(e)}catch(h){xr(e,e.return,h)}}if(e===t){Jt=null;break}if(n=e.sibling,n!==null){n.return=e.return,Jt=n;break}Jt=e.return}}function _S(t){for(;Jt!==null;){var e=Jt;if(e===t){Jt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Jt=n;break}Jt=e.return}}function TS(t){for(;Jt!==null;){var e=Jt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{bg(4,e)}catch(l){xr(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){xr(e,s,l)}}var i=e.return;try{Ax(e)}catch(l){xr(e,i,l)}break;case 5:var o=e.return;try{Ax(e)}catch(l){xr(e,o,l)}}}catch(l){xr(e,e.return,l)}if(e===t){Jt=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Jt=a;break}Jt=e.return}}var c4=Math.ceil,Qp=ta.ReactCurrentDispatcher,nw=ta.ReactCurrentOwner,Ei=ta.ReactCurrentBatchConfig,An=0,Ur=null,Nr=null,ns=0,Qs=0,Bc=Ja(0),Pr=0,uf=null,ql=0,wg=0,rw=0,Td=null,Ps=null,sw=0,wu=1/0,Po=null,Zp=!1,Px=null,Aa=null,Th=!1,_a=null,em=0,Cd=0,Lx=null,cp=-1,up=0;function Cs(){return An&6?Sr():cp!==-1?cp:cp=Sr()}function Ra(t){return t.mode&1?An&2&&ns!==0?ns&-ns:KP.transition!==null?(up===0&&(up=sN()),up):(t=$n,t!==0||(t=window.event,t=t===void 0?16:dN(t.type)),t):1}function eo(t,e,n,r){if(50<Cd)throw Cd=0,Lx=null,Error(Dt(185));Hf(t,n,r),(!(An&2)||t!==Ur)&&(t===Ur&&(!(An&2)&&(wg|=n),Pr===4&&ba(t,ns)),Vs(t,r),n===1&&An===0&&!(e.mode&1)&&(wu=Sr()+500,gg&&Xa()))}function Vs(t,e){var n=t.callbackNode;KO(t,e);var r=Lp(t,t===Ur?ns:0);if(r===0)n!==null&&Rk(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Rk(n),e===1)t.tag===0?WP(CS.bind(null,t)):IN(CS.bind(null,t)),BP(function(){!(An&6)&&Xa()}),n=null;else{switch(iN(r)){case 1:n=Ib;break;case 4:n=nN;break;case 16:n=Pp;break;case 536870912:n=rN;break;default:n=Pp}n=Nj(n,vj.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function vj(t,e){if(cp=-1,up=0,An&6)throw Error(Dt(327));var n=t.callbackNode;if(ru()&&t.callbackNode!==n)return null;var r=Lp(t,t===Ur?ns:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=tm(t,r);else{e=r;var s=An;An|=2;var i=Sj();(Ur!==t||ns!==e)&&(Po=null,wu=Sr()+500,Ol(t,e));do try{f4();break}catch(a){kj(t,a)}while(1);Hb(),Qp.current=i,An=s,Nr!==null?e=0:(Ur=null,ns=0,e=Pr)}if(e!==0){if(e===2&&(s=ux(t),s!==0&&(r=s,e=$x(t,s))),e===1)throw n=uf,Ol(t,0),ba(t,r),Vs(t,Sr()),n;if(e===6)ba(t,r);else{if(s=t.current.alternate,!(r&30)&&!u4(s)&&(e=tm(t,r),e===2&&(i=ux(t),i!==0&&(r=i,e=$x(t,i))),e===1))throw n=uf,Ol(t,0),ba(t,r),Vs(t,Sr()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(Dt(345));case 2:hl(t,Ps,Po);break;case 3:if(ba(t,r),(r&130023424)===r&&(e=sw+500-Sr(),10<e)){if(Lp(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Cs(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=xx(hl.bind(null,t,Ps,Po),e);break}hl(t,Ps,Po);break;case 4:if(ba(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-Zi(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Sr()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*c4(r/1960))-r,10<r){t.timeoutHandle=xx(hl.bind(null,t,Ps,Po),r);break}hl(t,Ps,Po);break;case 5:hl(t,Ps,Po);break;default:throw Error(Dt(329))}}}return Vs(t,Sr()),t.callbackNode===n?vj.bind(null,t):null}function $x(t,e){var n=Td;return t.current.memoizedState.isDehydrated&&(Ol(t,e).flags|=256),t=tm(t,e),t!==2&&(e=Ps,Ps=n,e!==null&&zx(e)),t}function zx(t){Ps===null?Ps=t:Ps.push.apply(Ps,t)}function u4(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!to(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ba(t,e){for(e&=~rw,e&=~wg,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Zi(e),r=1<<n;t[n]=-1,e&=~r}}function CS(t){if(An&6)throw Error(Dt(327));ru();var e=Lp(t,0);if(!(e&1))return Vs(t,Sr()),null;var n=tm(t,e);if(t.tag!==0&&n===2){var r=ux(t);r!==0&&(e=r,n=$x(t,r))}if(n===1)throw n=uf,Ol(t,0),ba(t,e),Vs(t,Sr()),n;if(n===6)throw Error(Dt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,hl(t,Ps,Po),Vs(t,Sr()),null}function iw(t,e){var n=An;An|=1;try{return t(e)}finally{An=n,An===0&&(wu=Sr()+500,gg&&Xa())}}function Yl(t){_a!==null&&_a.tag===0&&!(An&6)&&ru();var e=An;An|=1;var n=Ei.transition,r=$n;try{if(Ei.transition=null,$n=1,t)return t()}finally{$n=r,Ei.transition=n,An=e,!(An&6)&&Xa()}}function ow(){Qs=Bc.current,er(Bc)}function Ol(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,FP(n)),Nr!==null)for(n=Nr.return;n!==null;){var r=n;switch(Fb(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Up();break;case 3:xu(),er(Us),er(xs),Yb();break;case 5:qb(r);break;case 4:xu();break;case 13:er(dr);break;case 19:er(dr);break;case 10:Vb(r.type._context);break;case 22:case 23:ow()}n=n.return}if(Ur=t,Nr=t=Oa(t.current,null),ns=Qs=e,Pr=0,uf=null,rw=wg=ql=0,Ps=Td=null,Tl!==null){for(e=0;e<Tl.length;e++)if(n=Tl[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}Tl=null}return t}function kj(t,e){do{var n=Nr;try{if(Hb(),op.current=Xp,Jp){for(var r=hr.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Jp=!1}if(Gl=0,zr=Or=hr=null,Sd=!1,af=0,nw.current=null,n===null||n.return===null){Pr=1,uf=e,Nr=null;break}e:{var i=t,o=n.return,a=n,l=e;if(e=ns,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,d=a,f=d.tag;if(!(d.mode&1)&&(f===0||f===11||f===15)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=hS(o);if(p!==null){p.flags&=-257,pS(p,o,a,i,e),p.mode&1&&fS(i,u,e),e=p,l=u;var m=e.updateQueue;if(m===null){var y=new Set;y.add(l),e.updateQueue=y}else m.add(l);break e}else{if(!(e&1)){fS(i,u,e),aw();break e}l=Error(Dt(426))}}else if(ir&&a.mode&1){var b=hS(o);if(b!==null){!(b.flags&65536)&&(b.flags|=256),pS(b,o,a,i,e),Bb(bu(l,a));break e}}i=l=bu(l,a),Pr!==4&&(Pr=2),Td===null?Td=[i]:Td.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var g=ij(i,l,e);oS(i,g);break e;case 1:a=l;var v=i.type,w=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Aa===null||!Aa.has(w)))){i.flags|=65536,e&=-e,i.lanes|=e;var _=oj(i,a,e);oS(i,_);break e}}i=i.return}while(i!==null)}Tj(n)}catch(D){e=D,Nr===n&&n!==null&&(Nr=n=n.return);continue}break}while(1)}function Sj(){var t=Qp.current;return Qp.current=Xp,t===null?Xp:t}function aw(){(Pr===0||Pr===3||Pr===2)&&(Pr=4),Ur===null||!(ql&268435455)&&!(wg&268435455)||ba(Ur,ns)}function tm(t,e){var n=An;An|=2;var r=Sj();(Ur!==t||ns!==e)&&(Po=null,Ol(t,e));do try{d4();break}catch(s){kj(t,s)}while(1);if(Hb(),An=n,Qp.current=r,Nr!==null)throw Error(Dt(261));return Ur=null,ns=0,Pr}function d4(){for(;Nr!==null;)_j(Nr)}function f4(){for(;Nr!==null&&!LO();)_j(Nr)}function _j(t){var e=Ej(t.alternate,t,Qs);t.memoizedProps=t.pendingProps,e===null?Tj(t):Nr=e,nw.current=null}function Tj(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=i4(n,e),n!==null){n.flags&=32767,Nr=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Pr=6,Nr=null;return}}else if(n=s4(n,e,Qs),n!==null){Nr=n;return}if(e=e.sibling,e!==null){Nr=e;return}Nr=e=t}while(e!==null);Pr===0&&(Pr=5)}function hl(t,e,n){var r=$n,s=Ei.transition;try{Ei.transition=null,$n=1,h4(t,e,n,r)}finally{Ei.transition=s,$n=r}return null}function h4(t,e,n,r){do ru();while(_a!==null);if(An&6)throw Error(Dt(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Dt(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(GO(t,i),t===Ur&&(Nr=Ur=null,ns=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Th||(Th=!0,Nj(Pp,function(){return ru(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Ei.transition,Ei.transition=null;var o=$n;$n=1;var a=An;An|=4,nw.current=null,a4(t,n),bj(n,t),AP(gx),$p=!!mx,gx=mx=null,t.current=n,l4(n),$O(),An=a,$n=o,Ei.transition=i}else t.current=n;if(Th&&(Th=!1,_a=t,em=s),i=t.pendingLanes,i===0&&(Aa=null),BO(n.stateNode),Vs(t,Sr()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Zp)throw Zp=!1,t=Px,Px=null,t;return em&1&&t.tag!==0&&ru(),i=t.pendingLanes,i&1?t===Lx?Cd++:(Cd=0,Lx=t):Cd=0,Xa(),null}function ru(){if(_a!==null){var t=iN(em),e=Ei.transition,n=$n;try{if(Ei.transition=null,$n=16>t?16:t,_a===null)var r=!1;else{if(t=_a,_a=null,em=0,An&6)throw Error(Dt(331));var s=An;for(An|=4,Jt=t.current;Jt!==null;){var i=Jt,o=i.child;if(Jt.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(Jt=u;Jt!==null;){var d=Jt;switch(d.tag){case 0:case 11:case 15:_d(8,d,i)}var f=d.child;if(f!==null)f.return=d,Jt=f;else for(;Jt!==null;){d=Jt;var h=d.sibling,p=d.return;if(gj(d),d===u){Jt=null;break}if(h!==null){h.return=p,Jt=h;break}Jt=p}}}var m=i.alternate;if(m!==null){var y=m.child;if(y!==null){m.child=null;do{var b=y.sibling;y.sibling=null,y=b}while(y!==null)}}Jt=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,Jt=o;else e:for(;Jt!==null;){if(i=Jt,i.flags&2048)switch(i.tag){case 0:case 11:case 15:_d(9,i,i.return)}var g=i.sibling;if(g!==null){g.return=i.return,Jt=g;break e}Jt=i.return}}var v=t.current;for(Jt=v;Jt!==null;){o=Jt;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,Jt=w;else e:for(o=v;Jt!==null;){if(a=Jt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:bg(9,a)}}catch(D){xr(a,a.return,D)}if(a===o){Jt=null;break e}var _=a.sibling;if(_!==null){_.return=a.return,Jt=_;break e}Jt=a.return}}if(An=s,Xa(),xo&&typeof xo.onPostCommitFiberRoot=="function")try{xo.onPostCommitFiberRoot(dg,t)}catch{}r=!0}return r}finally{$n=n,Ei.transition=e}}return!1}function ES(t,e,n){e=bu(n,e),e=ij(t,e,1),t=Da(t,e,1),e=Cs(),t!==null&&(Hf(t,1,e),Vs(t,e))}function xr(t,e,n){if(t.tag===3)ES(t,t,n);else for(;e!==null;){if(e.tag===3){ES(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Aa===null||!Aa.has(r))){t=bu(n,t),t=oj(e,t,1),e=Da(e,t,1),t=Cs(),e!==null&&(Hf(e,1,t),Vs(e,t));break}}e=e.return}}function p4(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Cs(),t.pingedLanes|=t.suspendedLanes&n,Ur===t&&(ns&n)===n&&(Pr===4||Pr===3&&(ns&130023424)===ns&&500>Sr()-sw?Ol(t,0):rw|=n),Vs(t,e)}function Cj(t,e){e===0&&(t.mode&1?(e=mh,mh<<=1,!(mh&130023424)&&(mh=4194304)):e=1);var n=Cs();t=Jo(t,e),t!==null&&(Hf(t,e,n),Vs(t,n))}function m4(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Cj(t,n)}function g4(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Dt(314))}r!==null&&r.delete(e),Cj(t,n)}var Ej;Ej=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Us.current)zs=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return zs=!1,r4(t,e,n);zs=!!(t.flags&131072)}else zs=!1,ir&&e.flags&1048576&&MN(e,Wp,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;lp(t,e),t=e.pendingProps;var s=mu(e,xs.current);nu(e,n),s=Xb(null,e,r,t,s,n);var i=Qb();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Hs(r)?(i=!0,Hp(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Kb(e),s.updater=xg,e.stateNode=s,s._reactInternals=e,Tx(e,r,t,n),e=Nx(null,e,r,!0,i,n)):(e.tag=0,ir&&i&&zb(e),_s(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(lp(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=x4(r),t=Gi(r,t),s){case 0:e=Ex(null,e,r,t,n);break e;case 1:e=yS(null,e,r,t,n);break e;case 11:e=mS(null,e,r,t,n);break e;case 14:e=gS(null,e,r,Gi(r.type,t),n);break e}throw Error(Dt(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Gi(r,s),Ex(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Gi(r,s),yS(t,e,r,s,n);case 3:e:{if(uj(e),t===null)throw Error(Dt(387));r=e.pendingProps,i=e.memoizedState,s=i.element,LN(t,e),qp(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=bu(Error(Dt(423)),e),e=xS(t,e,r,n,s);break e}else if(r!==s){s=bu(Error(Dt(424)),e),e=xS(t,e,r,n,s);break e}else for(ni=Ma(e.stateNode.containerInfo.firstChild),ii=e,ir=!0,Xi=null,n=ON(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(gu(),r===s){e=Xo(t,e,n);break e}_s(t,e,r,n)}e=e.child}return e;case 5:return $N(e),t===null&&kx(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,yx(r,s)?o=null:i!==null&&yx(r,i)&&(e.flags|=32),cj(t,e),_s(t,e,o,n),e.child;case 6:return t===null&&kx(e),null;case 13:return dj(t,e,n);case 4:return Gb(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=yu(e,null,r,n):_s(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Gi(r,s),mS(t,e,r,s,n);case 7:return _s(t,e,e.pendingProps,n),e.child;case 8:return _s(t,e,e.pendingProps.children,n),e.child;case 12:return _s(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Wn(Kp,r._currentValue),r._currentValue=o,i!==null)if(to(i.value,o)){if(i.children===s.children&&!Us.current){e=Xo(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=Vo(-1,n&-n),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}i.lanes|=n,l=i.alternate,l!==null&&(l.lanes|=n),Sx(i.return,n,e),a.lanes|=n;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(Dt(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Sx(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}_s(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,nu(e,n),s=Di(s),r=r(s),e.flags|=1,_s(t,e,r,n),e.child;case 14:return r=e.type,s=Gi(r,e.pendingProps),s=Gi(r.type,s),gS(t,e,r,s,n);case 15:return aj(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Gi(r,s),lp(t,e),e.tag=1,Hs(r)?(t=!0,Hp(e)):t=!1,nu(e,n),sj(e,r,s),Tx(e,r,s,n),Nx(null,e,r,!0,t,n);case 19:return fj(t,e,n);case 22:return lj(t,e,n)}throw Error(Dt(156,e.tag))};function Nj(t,e){return tN(t,e)}function y4(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _i(t,e,n,r){return new y4(t,e,n,r)}function lw(t){return t=t.prototype,!(!t||!t.isReactComponent)}function x4(t){if(typeof t=="function")return lw(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Eb)return 11;if(t===Nb)return 14}return 2}function Oa(t,e){var n=t.alternate;return n===null?(n=_i(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function dp(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")lw(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Mc:return Pl(n.children,s,i,e);case Cb:o=8,s|=8;break;case Yy:return t=_i(12,n,e,s|2),t.elementType=Yy,t.lanes=i,t;case Jy:return t=_i(13,n,e,s),t.elementType=Jy,t.lanes=i,t;case Xy:return t=_i(19,n,e,s),t.elementType=Xy,t.lanes=i,t;case $E:return vg(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case PE:o=10;break e;case LE:o=9;break e;case Eb:o=11;break e;case Nb:o=14;break e;case da:o=16,r=null;break e}throw Error(Dt(130,t==null?t:typeof t,""))}return e=_i(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Pl(t,e,n,r){return t=_i(7,t,r,e),t.lanes=n,t}function vg(t,e,n,r){return t=_i(22,t,r,e),t.elementType=$E,t.lanes=n,t.stateNode={isHidden:!1},t}function I0(t,e,n){return t=_i(6,t,null,e),t.lanes=n,t}function M0(t,e,n){return e=_i(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function b4(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=d0(0),this.expirationTimes=d0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=d0(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function cw(t,e,n,r,s,i,o,a,l){return t=new b4(t,e,n,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=_i(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Kb(i),t}function w4(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ic,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function jj(t){if(!t)return Ha;t=t._reactInternals;e:{if(rc(t)!==t||t.tag!==1)throw Error(Dt(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Hs(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Dt(171))}if(t.tag===1){var n=t.type;if(Hs(n))return jN(t,n,e)}return e}function Ij(t,e,n,r,s,i,o,a,l){return t=cw(n,r,!0,t,s,i,o,a,l),t.context=jj(null),n=t.current,r=Cs(),s=Ra(n),i=Vo(r,s),i.callback=e??null,Da(n,i,s),t.current.lanes=s,Hf(t,s,r),Vs(t,r),t}function kg(t,e,n,r){var s=e.current,i=Cs(),o=Ra(s);return n=jj(n),e.context===null?e.context=n:e.pendingContext=n,e=Vo(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Da(s,e,o),t!==null&&(eo(t,s,o,i),ip(t,s,o)),o}function nm(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function NS(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function uw(t,e){NS(t,e),(t=t.alternate)&&NS(t,e)}function v4(){return null}var Mj=typeof reportError=="function"?reportError:function(t){console.error(t)};function dw(t){this._internalRoot=t}Sg.prototype.render=dw.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Dt(409));kg(t,e,null,null)};Sg.prototype.unmount=dw.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Yl(function(){kg(null,t,null,null)}),e[Yo]=null}};function Sg(t){this._internalRoot=t}Sg.prototype.unstable_scheduleHydration=function(t){if(t){var e=lN();t={blockedOn:null,target:t,priority:e};for(var n=0;n<xa.length&&e!==0&&e<xa[n].priority;n++);xa.splice(n,0,t),n===0&&uN(t)}};function fw(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function _g(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function jS(){}function k4(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=nm(o);i.call(u)}}var o=Ij(e,r,t,0,null,!1,!1,"",jS);return t._reactRootContainer=o,t[Yo]=o.current,tf(t.nodeType===8?t.parentNode:t),Yl(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=nm(l);a.call(u)}}var l=cw(t,0,!1,null,null,!1,!1,"",jS);return t._reactRootContainer=l,t[Yo]=l.current,tf(t.nodeType===8?t.parentNode:t),Yl(function(){kg(e,l,n,r)}),l}function Tg(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=nm(o);a.call(l)}}kg(e,o,t,s)}else o=k4(n,e,t,s,r);return nm(o)}oN=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=ld(e.pendingLanes);n!==0&&(Mb(e,n|1),Vs(e,Sr()),!(An&6)&&(wu=Sr()+500,Xa()))}break;case 13:Yl(function(){var r=Jo(t,1);if(r!==null){var s=Cs();eo(r,t,1,s)}}),uw(t,1)}};Db=function(t){if(t.tag===13){var e=Jo(t,134217728);if(e!==null){var n=Cs();eo(e,t,134217728,n)}uw(t,134217728)}};aN=function(t){if(t.tag===13){var e=Ra(t),n=Jo(t,e);if(n!==null){var r=Cs();eo(n,t,e,r)}uw(t,e)}};lN=function(){return $n};cN=function(t,e){var n=$n;try{return $n=t,e()}finally{$n=n}};ax=function(t,e,n){switch(e){case"input":if(ex(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=mg(r);if(!s)throw Error(Dt(90));FE(r),ex(r,s)}}}break;case"textarea":UE(t,n);break;case"select":e=n.value,e!=null&&Qc(t,!!n.multiple,e,!1)}};YE=iw;JE=Yl;var S4={usingClientEntryPoint:!1,Events:[Wf,Oc,mg,GE,qE,iw]},Qu={findFiberByHostInstance:_l,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},_4={bundleType:Qu.bundleType,version:Qu.version,rendererPackageName:Qu.rendererPackageName,rendererConfig:Qu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ta.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=ZE(t),t===null?null:t.stateNode},findFiberByHostInstance:Qu.findFiberByHostInstance||v4,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ch=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ch.isDisabled&&Ch.supportsFiber)try{dg=Ch.inject(_4),xo=Ch}catch{}}li.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=S4;li.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!fw(e))throw Error(Dt(200));return w4(t,e,null,n)};li.createRoot=function(t,e){if(!fw(t))throw Error(Dt(299));var n=!1,r="",s=Mj;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=cw(t,1,!1,null,null,n,!1,r,s),t[Yo]=e.current,tf(t.nodeType===8?t.parentNode:t),new dw(e)};li.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Dt(188)):(t=Object.keys(t).join(","),Error(Dt(268,t)));return t=ZE(e),t=t===null?null:t.stateNode,t};li.flushSync=function(t){return Yl(t)};li.hydrate=function(t,e,n){if(!_g(e))throw Error(Dt(200));return Tg(null,t,e,!0,n)};li.hydrateRoot=function(t,e,n){if(!fw(t))throw Error(Dt(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=Mj;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Ij(e,null,t,1,n??null,s,!1,i,o),t[Yo]=e.current,tf(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Sg(e)};li.render=function(t,e,n){if(!_g(e))throw Error(Dt(200));return Tg(null,t,e,!1,n)};li.unmountComponentAtNode=function(t){if(!_g(t))throw Error(Dt(40));return t._reactRootContainer?(Yl(function(){Tg(null,null,t,!1,function(){t._reactRootContainer=null,t[Yo]=null})}),!0):!1};li.unstable_batchedUpdates=iw;li.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!_g(n))throw Error(Dt(200));if(t==null||t._reactInternals===void 0)throw Error(Dt(38));return Tg(t,e,n,!1,r)};li.version="18.3.1-next-f1338f8080-20240426";function Dj(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Dj)}catch(t){console.error(t)}}Dj(),DE.exports=li;var or=DE.exports;const T4=cg(or);var IS=or;Gy.createRoot=IS.createRoot,Gy.hydrateRoot=IS.hydrateRoot;const C4="modulepreload",E4=function(t){return"/"+t},MS={},hw=function(e,n,r){if(!n||n.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(n.map(i=>{if(i=E4(i),i in MS)return;MS[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":C4,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((d,f)=>{u.addEventListener("load",d),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};var DS="popstate";function N4(t={}){function e(r,s){let{pathname:i,search:o,hash:a}=r.location;return Fx("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:df(s)}return I4(e,n,null,t)}function ar(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ri(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function j4(){return Math.random().toString(36).substring(2,10)}function AS(t,e){return{usr:t.state,key:t.key,idx:e}}function Fx(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Mu(e):e,state:n,key:e&&e.key||r||j4()}}function df({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Mu(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function I4(t,e,n,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a="POP",l=null,u=d();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function d(){return(o.state||{idx:null}).idx}function f(){a="POP";let b=d(),g=b==null?null:b-u;u=b,l&&l({action:a,location:y.location,delta:g})}function h(b,g){a="PUSH";let v=Fx(y.location,b,g);n&&n(v,b),u=d()+1;let w=AS(v,u),_=y.createHref(v);try{o.pushState(w,"",_)}catch(D){if(D instanceof DOMException&&D.name==="DataCloneError")throw D;s.location.assign(_)}i&&l&&l({action:a,location:y.location,delta:1})}function p(b,g){a="REPLACE";let v=Fx(y.location,b,g);n&&n(v,b),u=d();let w=AS(v,u),_=y.createHref(v);o.replaceState(w,"",_),i&&l&&l({action:a,location:y.location,delta:0})}function m(b){return M4(b)}let y={get action(){return a},get location(){return t(s,o)},listen(b){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(DS,f),l=b,()=>{s.removeEventListener(DS,f),l=null}},createHref(b){return e(s,b)},createURL:m,encodeLocation(b){let g=m(b);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:h,replace:p,go(b){return o.go(b)}};return y}function M4(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),ar(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:df(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function Aj(t,e,n="/"){return D4(t,e,n,!1)}function D4(t,e,n,r){let s=typeof e=="string"?Mu(e):e,i=Qo(s.pathname||"/",n);if(i==null)return null;let o=Rj(t);A4(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let u=V4(i);a=U4(o[l],u,r)}return a}function Rj(t,e=[],n=[],r="",s=!1){let i=(o,a,l=s,u)=>{let d={relativePath:u===void 0?o.path||"":u,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};if(d.relativePath.startsWith("/")){if(!d.relativePath.startsWith(r)&&l)return;ar(d.relativePath.startsWith(r),`Absolute route path "${d.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),d.relativePath=d.relativePath.slice(r.length)}let f=Wo([r,d.relativePath]),h=n.concat(d);o.children&&o.children.length>0&&(ar(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${f}".`),Rj(o.children,e,h,f,l)),!(o.path==null&&!o.index)&&e.push({path:f,score:F4(f,o.index),routesMeta:h})};return t.forEach((o,a)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))i(o,a);else for(let u of Oj(o.path))i(o,a,!0,u)}),e}function Oj(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=Oj(r.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function A4(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:B4(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var R4=/^:[\w-]+$/,O4=3,P4=2,L4=1,$4=10,z4=-2,RS=t=>t==="*";function F4(t,e){let n=t.split("/"),r=n.length;return n.some(RS)&&(r+=z4),e&&(r+=P4),n.filter(s=>!RS(s)).reduce((s,i)=>s+(R4.test(i)?O4:i===""?L4:$4),r)}function B4(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function U4(t,e,n=!1){let{routesMeta:r}=t,s={},i="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],u=a===r.length-1,d=i==="/"?e:e.slice(i.length)||"/",f=rm({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},d),h=l.route;if(!f&&u&&n&&!r[r.length-1].route.index&&(f=rm({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},d)),!f)return null;Object.assign(s,f.params),o.push({params:s,pathname:Wo([i,f.pathname]),pathnameBase:q4(Wo([i,f.pathnameBase])),route:h}),f.pathnameBase!=="/"&&(i=Wo([i,f.pathnameBase]))}return o}function rm(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=H4(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((u,{paramName:d,isOptional:f},h)=>{if(d==="*"){let m=a[h]||"";o=i.slice(0,i.length-m.length).replace(/(.)\/+$/,"$1")}const p=a[h];return f&&!p?u[d]=void 0:u[d]=(p||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:t}}function H4(t,e=!1,n=!0){Ri(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function V4(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ri(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Qo(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var Pj=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,W4=t=>Pj.test(t);function K4(t,e="/"){let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?Mu(t):t,i;if(n)if(W4(n))i=n;else{if(n.includes("//")){let o=n;n=n.replace(/\/\/+/g,"/"),Ri(!1,`Pathnames cannot have embedded double slashes - normalizing ${o} -> ${n}`)}n.startsWith("/")?i=OS(n.substring(1),"/"):i=OS(n,e)}else i=e;return{pathname:i,search:Y4(r),hash:J4(s)}}function OS(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function D0(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function G4(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function pw(t){let e=G4(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function mw(t,e,n,r=!1){let s;typeof t=="string"?s=Mu(t):(s={...t},ar(!s.pathname||!s.pathname.includes("?"),D0("?","pathname","search",s)),ar(!s.pathname||!s.pathname.includes("#"),D0("#","pathname","hash",s)),ar(!s.search||!s.search.includes("#"),D0("#","search","hash",s)));let i=t===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=n;else{let f=e.length-1;if(!r&&o.startsWith("..")){let h=o.split("/");for(;h[0]==="..";)h.shift(),f-=1;s.pathname=h.join("/")}a=f>=0?e[f]:"/"}let l=K4(s,a),u=o&&o!=="/"&&o.endsWith("/"),d=(i||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(u||d)&&(l.pathname+="/"),l}var Wo=t=>t.join("/").replace(/\/\/+/g,"/"),q4=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Y4=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,J4=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,X4=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function Q4(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function Z4(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Lj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function $j(t,e){let n=t;if(typeof n!="string"||!Pj.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,s=!1;if(Lj)try{let i=new URL(window.location.href),o=n.startsWith("//")?new URL(i.protocol+n):new URL(n),a=Qo(o.pathname,e);o.origin===i.origin&&a!=null?n=a+o.search+o.hash:s=!0}catch{Ri(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:s,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var zj=["POST","PUT","PATCH","DELETE"];new Set(zj);var e3=["GET",...zj];new Set(e3);var Du=x.createContext(null);Du.displayName="DataRouter";var Cg=x.createContext(null);Cg.displayName="DataRouterState";var t3=x.createContext(!1),Fj=x.createContext({isTransitioning:!1});Fj.displayName="ViewTransition";var n3=x.createContext(new Map);n3.displayName="Fetchers";var r3=x.createContext(null);r3.displayName="Await";var ui=x.createContext(null);ui.displayName="Navigation";var Gf=x.createContext(null);Gf.displayName="Location";var No=x.createContext({outlet:null,matches:[],isDataRoute:!1});No.displayName="Route";var gw=x.createContext(null);gw.displayName="RouteError";var Bj="REACT_ROUTER_ERROR",s3="REDIRECT",i3="ROUTE_ERROR_RESPONSE";function o3(t){if(t.startsWith(`${Bj}:${s3}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function a3(t){if(t.startsWith(`${Bj}:${i3}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new X4(e.status,e.statusText,e.data)}catch{}}function l3(t,{relative:e}={}){ar(Au(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=x.useContext(ui),{hash:s,pathname:i,search:o}=qf(t,{relative:e}),a=i;return n!=="/"&&(a=i==="/"?n:Wo([n,i])),r.createHref({pathname:a,search:o,hash:s})}function Au(){return x.useContext(Gf)!=null}function Qa(){return ar(Au(),"useLocation() may be used only in the context of a <Router> component."),x.useContext(Gf).location}var Uj="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Hj(t){x.useContext(ui).static||x.useLayoutEffect(t)}function Vj(){let{isDataRoute:t}=x.useContext(No);return t?v3():c3()}function c3(){ar(Au(),"useNavigate() may be used only in the context of a <Router> component.");let t=x.useContext(Du),{basename:e,navigator:n}=x.useContext(ui),{matches:r}=x.useContext(No),{pathname:s}=Qa(),i=JSON.stringify(pw(r)),o=x.useRef(!1);return Hj(()=>{o.current=!0}),x.useCallback((l,u={})=>{if(Ri(o.current,Uj),!o.current)return;if(typeof l=="number"){n.go(l);return}let d=mw(l,JSON.parse(i),s,u.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Wo([e,d.pathname])),(u.replace?n.replace:n.push)(d,u.state,u)},[e,n,i,s,t])}x.createContext(null);function qf(t,{relative:e}={}){let{matches:n}=x.useContext(No),{pathname:r}=Qa(),s=JSON.stringify(pw(n));return x.useMemo(()=>mw(t,JSON.parse(s),r,e==="path"),[t,s,r,e])}function u3(t,e){return Wj(t,e)}function Wj(t,e,n,r,s){var v;ar(Au(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=x.useContext(ui),{matches:o}=x.useContext(No),a=o[o.length-1],l=a?a.params:{},u=a?a.pathname:"/",d=a?a.pathnameBase:"/",f=a&&a.route;{let w=f&&f.path||"";Gj(u,!f||w.endsWith("*")||w.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${w}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${w}"> to <Route path="${w==="/"?"*":`${w}/*`}">.`)}let h=Qa(),p;if(e){let w=typeof e=="string"?Mu(e):e;ar(d==="/"||((v=w.pathname)==null?void 0:v.startsWith(d)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${w.pathname}" was given in the \`location\` prop.`),p=w}else p=h;let m=p.pathname||"/",y=m;if(d!=="/"){let w=d.replace(/^\//,"").split("/");y="/"+m.replace(/^\//,"").split("/").slice(w.length).join("/")}let b=Aj(t,{pathname:y});Ri(f||b!=null,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),Ri(b==null||b[b.length-1].route.element!==void 0||b[b.length-1].route.Component!==void 0||b[b.length-1].route.lazy!==void 0,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let g=m3(b&&b.map(w=>Object.assign({},w,{params:Object.assign({},l,w.params),pathname:Wo([d,i.encodeLocation?i.encodeLocation(w.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?d:Wo([d,i.encodeLocation?i.encodeLocation(w.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathnameBase])})),o,n,r,s);return e&&g?x.createElement(Gf.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...p},navigationType:"POP"}},g):g}function d3(){let t=w3(),e=Q4(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=x.createElement(x.Fragment,null,x.createElement("p",null," Hey developer "),x.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",x.createElement("code",{style:i},"ErrorBoundary")," or"," ",x.createElement("code",{style:i},"errorElement")," prop on your route.")),x.createElement(x.Fragment,null,x.createElement("h2",null,"Unexpected Application Error!"),x.createElement("h3",{style:{fontStyle:"italic"}},e),n?x.createElement("pre",{style:s},n):null,o)}var f3=x.createElement(d3,null),Kj=class extends x.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=a3(t.digest);n&&(t=n)}let e=t!==void 0?x.createElement(No.Provider,{value:this.props.routeContext},x.createElement(gw.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?x.createElement(h3,{error:t},e):e}};Kj.contextType=t3;var A0=new WeakMap;function h3({children:t,error:e}){let{basename:n}=x.useContext(ui);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=o3(e.digest);if(r){let s=A0.get(e);if(s)throw s;let i=$j(r.location,n);if(Lj&&!A0.get(e))if(i.isExternal||r.reloadDocument)window.location.href=i.absoluteURL||i.to;else{const o=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(i.to,{replace:r.replace}));throw A0.set(e,o),o}return x.createElement("meta",{httpEquiv:"refresh",content:`0;url=${i.absoluteURL||i.to}`})}}return t}function p3({routeContext:t,match:e,children:n}){let r=x.useContext(Du);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),x.createElement(No.Provider,{value:t},n)}function m3(t,e=[],n=null,r=null,s=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,o=n==null?void 0:n.errors;if(o!=null){let d=i.findIndex(f=>f.route.id&&(o==null?void 0:o[f.route.id])!==void 0);ar(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,d+1))}let a=!1,l=-1;if(n)for(let d=0;d<i.length;d++){let f=i[d];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(l=d),f.route.id){let{loaderData:h,errors:p}=n,m=f.route.loader&&!h.hasOwnProperty(f.route.id)&&(!p||p[f.route.id]===void 0);if(f.route.lazy||m){a=!0,l>=0?i=i.slice(0,l+1):i=[i[0]];break}}}let u=n&&r?(d,f)=>{var h,p;r(d,{location:n.location,params:((p=(h=n.matches)==null?void 0:h[0])==null?void 0:p.params)??{},unstable_pattern:Z4(n.matches),errorInfo:f})}:void 0;return i.reduceRight((d,f,h)=>{let p,m=!1,y=null,b=null;n&&(p=o&&f.route.id?o[f.route.id]:void 0,y=f.route.errorElement||f3,a&&(l<0&&h===0?(Gj("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),m=!0,b=null):l===h&&(m=!0,b=f.route.hydrateFallbackElement||null)));let g=e.concat(i.slice(0,h+1)),v=()=>{let w;return p?w=y:m?w=b:f.route.Component?w=x.createElement(f.route.Component,null):f.route.element?w=f.route.element:w=d,x.createElement(p3,{match:f,routeContext:{outlet:d,matches:g,isDataRoute:n!=null},children:w})};return n&&(f.route.ErrorBoundary||f.route.errorElement||h===0)?x.createElement(Kj,{location:n.location,revalidation:n.revalidation,component:y,error:p,children:v(),routeContext:{outlet:null,matches:g,isDataRoute:!0},onError:u}):v()},null)}function yw(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function g3(t){let e=x.useContext(Du);return ar(e,yw(t)),e}function y3(t){let e=x.useContext(Cg);return ar(e,yw(t)),e}function x3(t){let e=x.useContext(No);return ar(e,yw(t)),e}function xw(t){let e=x3(t),n=e.matches[e.matches.length-1];return ar(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function b3(){return xw("useRouteId")}function w3(){var r;let t=x.useContext(gw),e=y3("useRouteError"),n=xw("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function v3(){let{router:t}=g3("useNavigate"),e=xw("useNavigate"),n=x.useRef(!1);return Hj(()=>{n.current=!0}),x.useCallback(async(s,i={})=>{Ri(n.current,Uj),n.current&&(typeof s=="number"?await t.navigate(s):await t.navigate(s,{fromRouteId:e,...i}))},[t,e])}var PS={};function Gj(t,e,n){!e&&!PS[t]&&(PS[t]=!0,Ri(!1,n))}x.memo(k3);function k3({routes:t,future:e,state:n,onError:r}){return Wj(t,void 0,n,r,e)}function LS({to:t,replace:e,state:n,relative:r}){ar(Au(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=x.useContext(ui);Ri(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=x.useContext(No),{pathname:o}=Qa(),a=Vj(),l=mw(t,pw(i),o,r==="path"),u=JSON.stringify(l);return x.useEffect(()=>{a(JSON.parse(u),{replace:e,state:n,relative:r})},[a,u,r,e,n]),null}function ud(t){ar(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function S3({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:s,static:i=!1,unstable_useTransitions:o}){ar(!Au(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=t.replace(/^\/*/,"/"),l=x.useMemo(()=>({basename:a,navigator:s,static:i,unstable_useTransitions:o,future:{}}),[a,s,i,o]);typeof n=="string"&&(n=Mu(n));let{pathname:u="/",search:d="",hash:f="",state:h=null,key:p="default"}=n,m=x.useMemo(()=>{let y=Qo(u,a);return y==null?null:{location:{pathname:y,search:d,hash:f,state:h,key:p},navigationType:r}},[a,u,d,f,h,p,r]);return Ri(m!=null,`<Router basename="${a}"> is not able to match the URL "${u}${d}${f}" because it does not start with the basename, so the <Router> won't render anything.`),m==null?null:x.createElement(ui.Provider,{value:l},x.createElement(Gf.Provider,{children:e,value:m}))}function _3({children:t,location:e}){return u3(Bx(t),e)}function Bx(t,e=[]){let n=[];return x.Children.forEach(t,(r,s)=>{if(!x.isValidElement(r))return;let i=[...e,s];if(r.type===x.Fragment){n.push.apply(n,Bx(r.props.children,i));return}ar(r.type===ud,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ar(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Bx(r.props.children,i)),n.push(o)}),n}var fp="get",hp="application/x-www-form-urlencoded";function Eg(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function T3(t){return Eg(t)&&t.tagName.toLowerCase()==="button"}function C3(t){return Eg(t)&&t.tagName.toLowerCase()==="form"}function E3(t){return Eg(t)&&t.tagName.toLowerCase()==="input"}function N3(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function j3(t,e){return t.button===0&&(!e||e==="_self")&&!N3(t)}var Eh=null;function I3(){if(Eh===null)try{new FormData(document.createElement("form"),0),Eh=!1}catch{Eh=!0}return Eh}var M3=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function R0(t){return t!=null&&!M3.has(t)?(Ri(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${hp}"`),null):t}function D3(t,e){let n,r,s,i,o;if(C3(t)){let a=t.getAttribute("action");r=a?Qo(a,e):null,n=t.getAttribute("method")||fp,s=R0(t.getAttribute("enctype"))||hp,i=new FormData(t)}else if(T3(t)||E3(t)&&(t.type==="submit"||t.type==="image")){let a=t.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=t.getAttribute("formaction")||a.getAttribute("action");if(r=l?Qo(l,e):null,n=t.getAttribute("formmethod")||a.getAttribute("method")||fp,s=R0(t.getAttribute("formenctype"))||R0(a.getAttribute("enctype"))||hp,i=new FormData(a,t),!I3()){let{name:u,type:d,value:f}=t;if(d==="image"){let h=u?`${u}.`:"";i.append(`${h}x`,"0"),i.append(`${h}y`,"0")}else u&&i.append(u,f)}}else{if(Eg(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=fp,r=null,s=hp,o=t}return i&&s==="text/plain"&&(o=i,i=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function bw(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function A3(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&Qo(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function R3(t,e){if(t.id in e)return e[t.id];try{let n=await hw(()=>import(t.module),[]);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function O3(t){return t!=null&&typeof t.page=="string"}function P3(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function L3(t,e,n){let r=await Promise.all(t.map(async s=>{let i=e.routes[s.route.id];if(i){let o=await R3(i,n);return o.links?o.links():[]}return[]}));return B3(r.flat(1).filter(P3).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function $S(t,e,n,r,s,i){let o=(l,u)=>n[u]?l.route.id!==n[u].route.id:!0,a=(l,u)=>{var d;return n[u].pathname!==l.pathname||((d=n[u].route.path)==null?void 0:d.endsWith("*"))&&n[u].params["*"]!==l.params["*"]};return i==="assets"?e.filter((l,u)=>o(l,u)||a(l,u)):i==="data"?e.filter((l,u)=>{var f;let d=r.routes[l.route.id];if(!d||!d.hasLoader)return!1;if(o(l,u)||a(l,u))return!0;if(l.route.shouldRevalidate){let h=l.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((f=n[0])==null?void 0:f.params)||{},nextUrl:new URL(t,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function $3(t,e,{includeHydrateFallback:n}={}){return z3(t.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function z3(t){return[...new Set(t)]}function F3(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function B3(t,e){let n=new Set,r=new Set(e);return t.reduce((s,i)=>{if(e&&!O3(i)&&i.as==="script"&&i.href&&r.has(i.href))return s;let a=JSON.stringify(F3(i));return n.has(a)||(n.add(a),s.push({key:a,link:i})),s},[])}function qj(){let t=x.useContext(Du);return bw(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function U3(){let t=x.useContext(Cg);return bw(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var ww=x.createContext(void 0);ww.displayName="FrameworkContext";function Yj(){let t=x.useContext(ww);return bw(t,"You must render this element inside a <HydratedRouter> element"),t}function H3(t,e){let n=x.useContext(ww),[r,s]=x.useState(!1),[i,o]=x.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:u,onMouseLeave:d,onTouchStart:f}=e,h=x.useRef(null);x.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let y=g=>{g.forEach(v=>{o(v.isIntersecting)})},b=new IntersectionObserver(y,{threshold:.5});return h.current&&b.observe(h.current),()=>{b.disconnect()}}},[t]),x.useEffect(()=>{if(r){let y=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(y)}}},[r]);let p=()=>{s(!0)},m=()=>{s(!1),o(!1)};return n?t!=="intent"?[i,h,{}]:[i,h,{onFocus:Zu(a,p),onBlur:Zu(l,m),onMouseEnter:Zu(u,p),onMouseLeave:Zu(d,m),onTouchStart:Zu(f,p)}]:[!1,h,{}]}function Zu(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function V3({page:t,...e}){let{router:n}=qj(),r=x.useMemo(()=>Aj(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?x.createElement(K3,{page:t,matches:r,...e}):null}function W3(t){let{manifest:e,routeModules:n}=Yj(),[r,s]=x.useState([]);return x.useEffect(()=>{let i=!1;return L3(t,e,n).then(o=>{i||s(o)}),()=>{i=!0}},[t,e,n]),r}function K3({page:t,matches:e,...n}){let r=Qa(),{manifest:s,routeModules:i}=Yj(),{basename:o}=qj(),{loaderData:a,matches:l}=U3(),u=x.useMemo(()=>$S(t,e,l,s,r,"data"),[t,e,l,s,r]),d=x.useMemo(()=>$S(t,e,l,s,r,"assets"),[t,e,l,s,r]),f=x.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let m=new Set,y=!1;if(e.forEach(g=>{var w;let v=s.routes[g.route.id];!v||!v.hasLoader||(!u.some(_=>_.route.id===g.route.id)&&g.route.id in a&&((w=i[g.route.id])!=null&&w.shouldRevalidate)||v.hasClientLoader?y=!0:m.add(g.route.id))}),m.size===0)return[];let b=A3(t,o,"data");return y&&m.size>0&&b.searchParams.set("_routes",e.filter(g=>m.has(g.route.id)).map(g=>g.route.id).join(",")),[b.pathname+b.search]},[o,a,r,s,u,e,t,i]),h=x.useMemo(()=>$3(d,s),[d,s]),p=W3(d);return x.createElement(x.Fragment,null,f.map(m=>x.createElement("link",{key:m,rel:"prefetch",as:"fetch",href:m,...n})),h.map(m=>x.createElement("link",{key:m,rel:"modulepreload",href:m,...n})),p.map(({key:m,link:y})=>x.createElement("link",{key:m,nonce:n.nonce,...y})))}function G3(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var q3=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{q3&&(window.__reactRouterVersion="7.11.0")}catch{}function Y3({basename:t,children:e,unstable_useTransitions:n,window:r}){let s=x.useRef();s.current==null&&(s.current=N4({window:r,v5Compat:!0}));let i=s.current,[o,a]=x.useState({action:i.action,location:i.location}),l=x.useCallback(u=>{n===!1?a(u):x.startTransition(()=>a(u))},[n]);return x.useLayoutEffect(()=>i.listen(l),[i,l]),x.createElement(S3,{basename:t,children:e,location:o.location,navigationType:o.action,navigator:i,unstable_useTransitions:n})}var Jj=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Xj=x.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:s,reloadDocument:i,replace:o,state:a,target:l,to:u,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:h,...p},m){let{basename:y,unstable_useTransitions:b}=x.useContext(ui),g=typeof u=="string"&&Jj.test(u),v=$j(u,y);u=v.to;let w=l3(u,{relative:s}),[_,D,k]=H3(r,p),A=Z3(u,{replace:o,state:a,target:l,preventScrollReset:d,relative:s,viewTransition:f,unstable_defaultShouldRevalidate:h,unstable_useTransitions:b});function N(S){e&&e(S),S.defaultPrevented||A(S)}let E=x.createElement("a",{...p,...k,href:v.absoluteURL||w,onClick:v.isExternal||i?e:N,ref:G3(m,D),target:l,"data-discover":!g&&n==="render"?"true":void 0});return _&&!g?x.createElement(x.Fragment,null,E,x.createElement(V3,{page:w})):E});Xj.displayName="Link";var J3=x.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:s=!1,style:i,to:o,viewTransition:a,children:l,...u},d){let f=qf(o,{relative:u.relative}),h=Qa(),p=x.useContext(Cg),{navigator:m,basename:y}=x.useContext(ui),b=p!=null&&sL(f)&&a===!0,g=m.encodeLocation?m.encodeLocation(f).pathname:f.pathname,v=h.pathname,w=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;n||(v=v.toLowerCase(),w=w?w.toLowerCase():null,g=g.toLowerCase()),w&&y&&(w=Qo(w,y)||w);const _=g!=="/"&&g.endsWith("/")?g.length-1:g.length;let D=v===g||!s&&v.startsWith(g)&&v.charAt(_)==="/",k=w!=null&&(w===g||!s&&w.startsWith(g)&&w.charAt(g.length)==="/"),A={isActive:D,isPending:k,isTransitioning:b},N=D?e:void 0,E;typeof r=="function"?E=r(A):E=[r,D?"active":null,k?"pending":null,b?"transitioning":null].filter(Boolean).join(" ");let S=typeof i=="function"?i(A):i;return x.createElement(Xj,{...u,"aria-current":N,className:E,ref:d,style:S,to:o,viewTransition:a},typeof l=="function"?l(A):l)});J3.displayName="NavLink";var X3=x.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:s,state:i,method:o=fp,action:a,onSubmit:l,relative:u,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:h,...p},m)=>{let{unstable_useTransitions:y}=x.useContext(ui),b=nL(),g=rL(a,{relative:u}),v=o.toLowerCase()==="get"?"get":"post",w=typeof a=="string"&&Jj.test(a),_=D=>{if(l&&l(D),D.defaultPrevented)return;D.preventDefault();let k=D.nativeEvent.submitter,A=(k==null?void 0:k.getAttribute("formmethod"))||o,N=()=>b(k||D.currentTarget,{fetcherKey:e,method:A,navigate:n,replace:s,state:i,relative:u,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:h});y&&n!==!1?x.startTransition(()=>N()):N()};return x.createElement("form",{ref:m,method:v,action:g,onSubmit:r?l:_,...p,"data-discover":!w&&t==="render"?"true":void 0})});X3.displayName="Form";function Q3(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Qj(t){let e=x.useContext(Du);return ar(e,Q3(t)),e}function Z3(t,{target:e,replace:n,state:r,preventScrollReset:s,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:a,unstable_useTransitions:l}={}){let u=Vj(),d=Qa(),f=qf(t,{relative:i});return x.useCallback(h=>{if(j3(h,e)){h.preventDefault();let p=n!==void 0?n:df(d)===df(f),m=()=>u(t,{replace:p,state:r,preventScrollReset:s,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:a});l?x.startTransition(()=>m()):m()}},[d,u,f,n,r,e,t,s,i,o,a,l])}var eL=0,tL=()=>`__${String(++eL)}__`;function nL(){let{router:t}=Qj("useSubmit"),{basename:e}=x.useContext(ui),n=b3(),r=t.fetch,s=t.navigate;return x.useCallback(async(i,o={})=>{let{action:a,method:l,encType:u,formData:d,body:f}=D3(i,e);if(o.navigate===!1){let h=o.fetcherKey||tL();await r(h,n,o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:d,body:f,formMethod:o.method||l,formEncType:o.encType||u,flushSync:o.flushSync})}else await s(o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:d,body:f,formMethod:o.method||l,formEncType:o.encType||u,replace:o.replace,state:o.state,fromRouteId:n,flushSync:o.flushSync,viewTransition:o.viewTransition})},[r,s,e,n])}function rL(t,{relative:e}={}){let{basename:n}=x.useContext(ui),r=x.useContext(No);ar(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...qf(t||".",{relative:e})},o=Qa();if(t==null){i.search=o.search;let a=new URLSearchParams(i.search),l=a.getAll("index");if(l.some(d=>d==="")){a.delete("index"),l.filter(f=>f).forEach(f=>a.append("index",f));let d=a.toString();i.search=d?`?${d}`:""}}return(!t||t===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(i.pathname=i.pathname==="/"?n:Wo([n,i.pathname])),df(i)}function sL(t,{relative:e}={}){let n=x.useContext(Fj);ar(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=Qj("useViewTransitionState"),s=qf(t,{relative:e});if(!n.isTransitioning)return!1;let i=Qo(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=Qo(n.nextLocation.pathname,r)||n.nextLocation.pathname;return rm(s.pathname,o)!=null||rm(s.pathname,i)!=null}function Ng(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function iL(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(d){try{u(r.next(d))}catch(f){o(f)}}function l(d){try{u(r.throw(d))}catch(f){o(f)}}function u(d){d.done?i(d.value):s(d.value).then(a,l)}u((r=r.apply(t,e||[])).next())})}const oL=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class vw extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class aL extends vw{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class zS extends vw{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class FS extends vw{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ux;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Ux||(Ux={}));class lL{constructor(e,{headers:n={},customFetch:r,region:s=Ux.Any}={}){this.url=e,this.headers=n,this.region=s,this.fetch=oL(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return iL(this,arguments,void 0,function*(n,r={}){var s;let i,o;try{const{headers:a,method:l,body:u,signal:d,timeout:f}=r;let h={},{region:p}=r;p||(p=this.region);const m=new URL(`${this.url}/${n}`);p&&p!=="any"&&(h["x-region"]=p,m.searchParams.set("forceFunctionRegion",p));let y;u&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",y=u):typeof u=="string"?(h["Content-Type"]="text/plain",y=u):typeof FormData<"u"&&u instanceof FormData?y=u:(h["Content-Type"]="application/json",y=JSON.stringify(u)):y=u;let b=d;f&&(o=new AbortController,i=setTimeout(()=>o.abort(),f),d?(b=o.signal,d.addEventListener("abort",()=>o.abort())):b=o.signal);const g=yield this.fetch(m.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),a),body:y,signal:b}).catch(D=>{throw new aL(D)}),v=g.headers.get("x-relay-error");if(v&&v==="true")throw new zS(g);if(!g.ok)throw new FS(g);let w=((s=g.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),_;return w==="application/json"?_=yield g.json():w==="application/octet-stream"||w==="application/pdf"?_=yield g.blob():w==="text/event-stream"?_=g:w==="multipart/form-data"?_=yield g.formData():_=yield g.text(),{data:_,error:null,response:g}}catch(a){return{data:null,error:a,response:a instanceof FS||a instanceof zS?a.context:void 0}}finally{i&&clearTimeout(i)}})}}var cL=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},uL=class{constructor(t){var e,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var n=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let o=null,a=null,l=null,u=i.status,d=i.statusText;if(i.ok){var f,h;if(n.method!=="HEAD"){var p;const g=await i.text();g===""||(n.headers.get("Accept")==="text/csv"||n.headers.get("Accept")&&(!((p=n.headers.get("Accept"))===null||p===void 0)&&p.includes("application/vnd.pgrst.plan+text"))?a=g:a=JSON.parse(g))}const y=(f=n.headers.get("Prefer"))===null||f===void 0?void 0:f.match(/count=(exact|planned|estimated)/),b=(h=i.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");y&&b&&b.length>1&&(l=parseInt(b[1])),n.isMaybeSingle&&n.method==="GET"&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,u=406,d="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var m;const y=await i.text();try{o=JSON.parse(y),Array.isArray(o)&&i.status===404&&(a=[],o=null,u=200,d="OK")}catch{i.status===404&&y===""?(u=204,d="No Content"):o={message:y}}if(o&&n.isMaybeSingle&&(!(o==null||(m=o.details)===null||m===void 0)&&m.includes("0 rows"))&&(o=null,u=200,d="OK"),o&&n.shouldThrowOnError)throw new cL(o)}return{error:o,data:a,count:l,status:u,statusText:d}});return this.shouldThrowOnError||(s=s.catch(i=>{var o;let a="";const l=i==null?void 0:i.cause;if(l){var u,d,f,h;const m=(u=l==null?void 0:l.message)!==null&&u!==void 0?u:"",y=(d=l==null?void 0:l.code)!==null&&d!==void 0?d:"";a=`${(f=i==null?void 0:i.name)!==null&&f!==void 0?f:"FetchError"}: ${i==null?void 0:i.message}`,a+=`

Caused by: ${(h=l==null?void 0:l.name)!==null&&h!==void 0?h:"Error"}: ${m}`,y&&(a+=` (${y})`),l!=null&&l.stack&&(a+=`
${l.stack}`)}else{var p;a=(p=i==null?void 0:i.stack)!==null&&p!==void 0?p:""}return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:a,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),s.then(t,e)}returns(){return this}overrideTypes(){return this}},dL=class extends uL{select(t){let e=!1;const n=(t??"*").split("").map(r=>/\s/.test(r)&&!e?"":(r==='"'&&(e=!e),r)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:n,foreignTable:r,referencedTable:s=r}={}){const i=s?`${s}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:n=e}={}){const r=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${t}`),this}range(t,e,{foreignTable:n,referencedTable:r=n}={}){const s=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${t}`),this.url.searchParams.set(i,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:n=!1,buffers:r=!1,wal:s=!1,format:i="text"}={}){var o;const a=[t?"analyze":null,e?"verbose":null,n?"settings":null,r?"buffers":null,s?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const BS=new RegExp("[,()]");var _c=class extends dL{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&BS.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}notIn(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&BS.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`not.in.(${n})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:n,type:r}={}){let s="";r==="plain"?s="pl":r==="phrase"?s="ph":r==="websearch"&&(s="w");const i=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${s}fts${i}.${e}`),this}match(t){return Object.entries(t).forEach(([e,n])=>{this.url.searchParams.append(e,`eq.${n}`)}),this}not(t,e,n){return this.url.searchParams.append(t,`not.${e}.${n}`),this}or(t,{foreignTable:e,referencedTable:n=e}={}){const r=n?`${n}.or`:"or";return this.url.searchParams.append(r,`(${t})`),this}filter(t,e,n){return this.url.searchParams.append(t,`${e}.${n}`),this}},fL=class{constructor(t,{headers:e={},schema:n,fetch:r}){this.url=t,this.headers=new Headers(e),this.schema=n,this.fetch=r}select(t,e){const{head:n=!1,count:r}=e??{},s=n?"HEAD":"GET";let i=!1;const o=(t??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),r&&this.headers.append("Prefer",`count=${r}`),new _c({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:n=!0}={}){var r;const s="POST";if(e&&this.headers.append("Prefer",`count=${e}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const i=t.reduce((o,a)=>o.concat(Object.keys(a)),[]);if(i.length>0){const o=[...new Set(i)].map(a=>`"${a}"`);this.url.searchParams.set("columns",o.join(","))}}return new _c({method:s,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:n=!1,count:r,defaultToNull:s=!0}={}){var i;const o="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),e!==void 0&&this.url.searchParams.set("on_conflict",e),r&&this.headers.append("Prefer",`count=${r}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const a=t.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(a.length>0){const l=[...new Set(a)].map(u=>`"${u}"`);this.url.searchParams.set("columns",l.join(","))}}return new _c({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(t,{count:e}={}){var n;const r="PATCH";return e&&this.headers.append("Prefer",`count=${e}`),new _c({method:r,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:t}={}){var e;const n="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new _c({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},hL=class Zj{constructor(e,{headers:n={},schema:r,fetch:s}={}){this.url=e,this.headers=new Headers(n),this.schemaName=r,this.fetch=s}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new fL(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Zj(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,n={},{head:r=!1,get:s=!1,count:i}={}){var o;let a;const l=new URL(`${this.url}/rpc/${e}`);let u;r||s?(a=r?"HEAD":"GET",Object.entries(n).filter(([f,h])=>h!==void 0).map(([f,h])=>[f,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([f,h])=>{l.searchParams.append(f,h)})):(a="POST",u=n);const d=new Headers(this.headers);return i&&d.set("Prefer",`count=${i}`),new _c({method:a,url:l,headers:d,schema:this.schemaName,body:u,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};class pL{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const r=n.node,s=parseInt(r.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const r=this.getWebSocketConstructor();return new r(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const mL="2.89.0",gL=`realtime-js/${mL}`,eI="1.0.0",yL="2.0.0",US=eI,Hx=1e4,xL=1e3,bL=100;var ha;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(ha||(ha={}));var Ar;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Ar||(Ar={}));var Ji;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Ji||(Ji={}));var Vx;(function(t){t.websocket="websocket"})(Vx||(Vx={}));var xl;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(xl||(xl={}));class wL{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,n){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,r;const s=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(e){var n,r;const s=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:{},o=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,n,r){var s,i;const o=e.topic,a=(s=e.ref)!==null&&s!==void 0?s:"",l=(i=e.join_ref)!==null&&i!==void 0?i:"",u=e.payload.event,d=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},f=Object.keys(d).length===0?"":JSON.stringify(d);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`userEvent length ${u.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`metadata length ${f.length} exceeds maximum of 255`);const h=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+u.length+f.length,p=new ArrayBuffer(this.HEADER_LENGTH+h);let m=new DataView(p),y=0;m.setUint8(y++,this.KINDS.userBroadcastPush),m.setUint8(y++,l.length),m.setUint8(y++,a.length),m.setUint8(y++,o.length),m.setUint8(y++,u.length),m.setUint8(y++,f.length),m.setUint8(y++,n),Array.from(l,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(a,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(o,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(u,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(f,g=>m.setUint8(y++,g.charCodeAt(0)));var b=new Uint8Array(p.byteLength+r.byteLength);return b.set(new Uint8Array(p),0),b.set(new Uint8Array(r),p.byteLength),b.buffer}decode(e,n){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return n(r)}if(typeof e=="string"){const r=JSON.parse(e),[s,i,o,a,l]=r;return n({join_ref:s,ref:i,topic:o,event:a,payload:l})}return n({})}_binaryDecode(e){const n=new DataView(e),r=n.getUint8(0),s=new TextDecoder;switch(r){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,n,s)}}_decodeUserBroadcast(e,n,r){const s=n.getUint8(1),i=n.getUint8(2),o=n.getUint8(3),a=n.getUint8(4);let l=this.HEADER_LENGTH+4;const u=r.decode(e.slice(l,l+s));l=l+s;const d=r.decode(e.slice(l,l+i));l=l+i;const f=r.decode(e.slice(l,l+o));l=l+o;const h=e.slice(l,e.byteLength),p=a===this.JSON_ENCODING?JSON.parse(r.decode(h)):h,m={type:this.BROADCAST_EVENT,event:d,payload:p};return o>0&&(m.meta=JSON.parse(f)),{join_ref:null,ref:null,topic:u,event:this.BROADCAST_EVENT,payload:m}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e==null?void 0:e.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}_pick(e,n){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([r])=>n.includes(r)))}}class tI{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Hn;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Hn||(Hn={}));const HS=(t,e,n={})=>{var r;const s=(r=n.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=vL(o,t,e,s),i),{}):{}},vL=(t,e,n,r)=>{const s=e.find(a=>a.name===t),i=s==null?void 0:s.type,o=n[t];return i&&!r.includes(i)?nI(i,o):Wx(o)},nI=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return TL(e,n)}switch(t){case Hn.bool:return kL(e);case Hn.float4:case Hn.float8:case Hn.int2:case Hn.int4:case Hn.int8:case Hn.numeric:case Hn.oid:return SL(e);case Hn.json:case Hn.jsonb:return _L(e);case Hn.timestamp:return CL(e);case Hn.abstime:case Hn.date:case Hn.daterange:case Hn.int4range:case Hn.int8range:case Hn.money:case Hn.reltime:case Hn.text:case Hn.time:case Hn.timestamptz:case Hn.timetz:case Hn.tsrange:case Hn.tstzrange:return Wx(e);default:return Wx(e)}},Wx=t=>t,kL=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},SL=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},_L=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},TL=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let i;const o=t.slice(1,n);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>nI(e,a))}return t},CL=t=>typeof t=="string"?t.replace(" ","T"):t,rI=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class O0{constructor(e,n,r={},s=Hx){this.channel=e,this.event=n,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var VS;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(VS||(VS={}));class Ed{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ed.syncState(this.state,s,i,o),this.pendingDiffs.forEach(l=>{this.state=Ed.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Ed.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,s){const i=this.cloneDeep(e),o=this.transformState(n),a={},l={};return this.map(i,(u,d)=>{o[u]||(l[u]=d)}),this.map(o,(u,d)=>{const f=i[u];if(f){const h=d.map(b=>b.presence_ref),p=f.map(b=>b.presence_ref),m=d.filter(b=>p.indexOf(b.presence_ref)<0),y=f.filter(b=>h.indexOf(b.presence_ref)<0);m.length>0&&(a[u]=m),y.length>0&&(l[u]=y)}else a[u]=d}),this.syncDiff(i,{joins:a,leaves:l},r,s)}static syncDiff(e,n,r,s){const{joins:i,leaves:o}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(a,l)=>{var u;const d=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(l),d.length>0){const f=e[a].map(p=>p.presence_ref),h=d.filter(p=>f.indexOf(p.presence_ref)<0);e[a].unshift(...h)}r(a,d,l)}),this.map(o,(a,l)=>{let u=e[a];if(!u)return;const d=l.map(f=>f.presence_ref);u=u.filter(f=>d.indexOf(f.presence_ref)<0),e[a]=u,s(a,u,l),u.length===0&&delete e[a]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const s=e[r];return"metas"in s?n[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):n[r]=s,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var WS;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(WS||(WS={}));var Nd;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Nd||(Nd={}));var Lo;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Lo||(Lo={}));class Uc{constructor(e,n={config:{}},r){var s,i;if(this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=Ar.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new O0(this,Ji.join,this.params,this.timeout),this.rejoinTimer=new tI(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ar.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ar.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Ar.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ar.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Ar.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ji.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new Ed(this),this.broadcastEndpointURL=rI(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var r,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Ar.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,u=(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(p=>p.filter))!==null&&s!==void 0?s:[],d=!!this.bindings[Nd.PRESENCE]&&this.bindings[Nd.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,f={},h={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:d}),postgres_changes:u,private:l};this.socket.accessTokenValue&&(f.access_token=this.socket.accessTokenValue),this._onError(p=>e==null?void 0:e(Lo.CHANNEL_ERROR,p)),this._onClose(()=>e==null?void 0:e(Lo.CLOSED)),this.updateJoinPayload(Object.assign({config:h},f)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:p})=>{var m;if(this.socket._isManualToken()||this.socket.setAuth(),p===void 0){e==null||e(Lo.SUBSCRIBED);return}else{const y=this.bindings.postgres_changes,b=(m=y==null?void 0:y.length)!==null&&m!==void 0?m:0,g=[];for(let v=0;v<b;v++){const w=y[v],{filter:{event:_,schema:D,table:k,filter:A}}=w,N=p&&p[v];if(N&&N.event===_&&Uc.isFilterValueEqual(N.schema,D)&&Uc.isFilterValueEqual(N.table,k)&&Uc.isFilterValueEqual(N.filter,A))g.push(Object.assign(Object.assign({},w),{id:N.id}));else{this.unsubscribe(),this.state=Ar.errored,e==null||e(Lo.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(Lo.SUBSCRIBED);return}}).receive("error",p=>{this.state=Ar.errored,e==null||e(Lo.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Lo.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this.state===Ar.joined&&e===Nd.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,n,r)}async httpSend(e,n,r={}){var s;if(n==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(s=r.timeout)!==null&&s!==void 0?s:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const u=await a.json();l=u.error||u.message||l}catch{}return Promise.reject(new Error(l))}async send(e,n={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=u.body)===null||s===void 0?void 0:s.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const u=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ar.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ji.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new O0(this,Ji.leave,{},e),r.receive("ok",()=>{n(),s("ok")}).receive("timeout",()=>{n(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ar.closed,this.bindings={}}async _fetchWithTimeout(e,n,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:s.signal}));return clearTimeout(i),o}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new O0(this,e,n,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>bL){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:u,join:d}=Ji;if(r&&[a,l,u,d].indexOf(o)>=0&&r!==this._joinRef())return;let h=this._onMessage(o,n,r);if(n&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(p=>{var m,y,b;return((m=p.filter)===null||m===void 0?void 0:m.event)==="*"||((b=(y=p.filter)===null||y===void 0?void 0:y.event)===null||b===void 0?void 0:b.toLocaleLowerCase())===o}).map(p=>p.callback(h,r)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var m,y,b,g,v,w;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const _=p.id,D=(m=p.filter)===null||m===void 0?void 0:m.event;return _&&((y=n.ids)===null||y===void 0?void 0:y.includes(_))&&(D==="*"||(D==null?void 0:D.toLocaleLowerCase())===((b=n.data)===null||b===void 0?void 0:b.type.toLocaleLowerCase()))}else{const _=(v=(g=p==null?void 0:p.filter)===null||g===void 0?void 0:g.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return _==="*"||_===((w=n==null?void 0:n.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof h=="object"&&"ids"in h){const m=h.data,{schema:y,table:b,commit_timestamp:g,type:v,errors:w}=m;h=Object.assign(Object.assign({},{schema:y,table:b,commit_timestamp:g,eventType:v,new:{},old:{},errors:w}),this._getPayloadRecords(m))}p.callback(h,r)})}_isClosed(){return this.state===Ar.closed}_isJoined(){return this.state===Ar.joined}_isJoining(){return this.state===Ar.joining}_isLeaving(){return this.state===Ar.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const s=e.toLocaleLowerCase(),i={type:s,filter:n,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Uc.isEqual(s.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}static isFilterValueEqual(e,n){return(e??void 0)===(n??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ji.close,{},e)}_onError(e){this._on(Ji.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ar.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=HS(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=HS(e.columns,e.old_record)),n}}const P0=()=>{},Nh={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},EL=[1e3,2e3,5e3,1e4],NL=1e4,jL=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class IL{constructor(e,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Hx,this.transport=null,this.heartbeatIntervalMs=Nh.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=P0,this.ref=0,this.reconnectTimer=null,this.vsn=US,this.logger=P0,this.conn=null,this.sendBuffer=[],this.serializer=new wL,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>s?(...i)=>s(...i):(...i)=>fetch(...i),!(!((r=n==null?void 0:n.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${Vx.websocket}`,this.httpEndpoint=rI(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=pL.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case ha.connecting:return xl.Connecting;case ha.open:return xl.Open;case ha.closing:return xl.Closing;default:return xl.Closed}}isConnected(){return this.connectionState()===xl.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===r);if(s)return s;{const i=new Uc(`realtime:${e}`,n,this);return this.channels.push(i),i}}push(e){const{topic:n,event:r,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${n} ${r} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(xL,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},Nh.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:s,payload:i,ref:o}=n,a=o?`(${o})`:"",l=i.status||"";this.log("receive",`${l} ${r} ${s} ${a}`.trim(),i),this.channels.filter(u=>u._isMember(r)).forEach(u=>u._trigger(s,i,o)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===ha.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===ha.open||this.conn.readyState===ha.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this._terminateWorker()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ji.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(n);return`${e}${r}${s}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([jL],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n,r=!1;if(e)n=e,r=!0;else if(this.accessToken)try{n=await this.accessToken()}catch(s){this.log("error","Error fetching access token from callback",s),n=this.accessTokenValue}else n=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(s=>{const i={access_token:n,version:gL};n&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(Ji.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(n=>{this.log("error",`Error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(n)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new tI(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Nh.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,r,s,i,o,a,l,u,d,f,h,p;switch(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:Hx,this.heartbeatIntervalMs=(s=e==null?void 0:e.heartbeatIntervalMs)!==null&&s!==void 0?s:Nh.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e==null?void 0:e.heartbeatCallback)!==null&&a!==void 0?a:P0,this.vsn=(l=e==null?void 0:e.vsn)!==null&&l!==void 0?l:US,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(u=e==null?void 0:e.reconnectAfterMs)!==null&&u!==void 0?u:m=>EL[m-1]||NL,this.vsn){case eI:this.encode=(d=e==null?void 0:e.encode)!==null&&d!==void 0?d:(m,y)=>y(JSON.stringify(m)),this.decode=(f=e==null?void 0:e.decode)!==null&&f!==void 0?f:(m,y)=>y(JSON.parse(m));break;case yL:this.encode=(h=e==null?void 0:e.encode)!==null&&h!==void 0?h:this.serializer.encode.bind(this.serializer),this.decode=(p=e==null?void 0:e.decode)!==null&&p!==void 0?p:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var ff=class extends Error{constructor(t,e){var n;super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((n=e.icebergType)==null?void 0:n.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function ML(t,e,n){const r=new URL(e,t);if(n)for(const[s,i]of Object.entries(n))i!==void 0&&r.searchParams.set(s,i);return r.toString()}async function DL(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function AL(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:n,path:r,query:s,body:i,headers:o}){const a=ML(t.baseUrl,r,s),l=await DL(t.auth),u=await e(a,{method:n,headers:{...i?{"Content-Type":"application/json"}:{},...l,...o},body:i?JSON.stringify(i):void 0}),d=await u.text(),f=(u.headers.get("content-type")||"").includes("application/json"),h=f&&d?JSON.parse(d):d;if(!u.ok){const p=f?h:void 0,m=p==null?void 0:p.error;throw new ff((m==null?void 0:m.message)??`Request failed with status ${u.status}`,{status:u.status,icebergType:m==null?void 0:m.type,icebergCode:m==null?void 0:m.code,details:p})}return{status:u.status,headers:u.headers,data:h}}}}function jh(t){return t.join("")}var RL=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:jh(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(r=>({namespace:r}))}async createNamespace(t,e){const n={namespace:t.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${jh(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${jh(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${jh(t.namespace)}`}),!0}catch(e){if(e instanceof ff&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(n){if(n instanceof ff&&n.status===409)return;throw n}}};function dc(t){return t.join("")}var OL=class{constructor(t,e="",n){this.client=t,this.prefix=e,this.accessDelegation=n}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${dc(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const n={};return this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${dc(t.namespace)}/tables`,body:e,headers:n})).data.metadata}async updateTable(t,e){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${dc(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${dc(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${dc(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${dc(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(n){if(n instanceof ff&&n.status===404)return!1;throw n}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(n){if(n instanceof ff&&n.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw n}}},PL=class{constructor(t){var r;let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const n=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=AL({baseUrl:n,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(r=t.accessDelegation)==null?void 0:r.join(","),this.namespaceOps=new RL(this.client,e),this.tableOps=new OL(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},jg=class extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}};function ur(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var LL=class extends jg{constructor(t,e,n){super(t),this.name="StorageApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Kx=class extends jg{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}};const kw=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),$L=()=>Response,Gx=t=>{if(Array.isArray(t))return t.map(n=>Gx(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const s=n.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=Gx(r)}),e},zL=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},FL=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function hf(t){"@babel/helpers - typeof";return hf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hf(t)}function BL(t,e){if(hf(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(hf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function UL(t){var e=BL(t,"string");return hf(e)=="symbol"?e:e+""}function HL(t,e,n){return(e=UL(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function KS(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function an(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?KS(Object(n),!0).forEach(function(r){HL(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):KS(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const L0=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},VL=async(t,e,n)=>{t instanceof await $L()&&!(n!=null&&n.noResolveJson)?t.json().then(r=>{const s=t.status||500,i=(r==null?void 0:r.statusCode)||s+"";e(new LL(L0(r),s,i))}).catch(r=>{e(new Kx(L0(r),r))}):e(new Kx(L0(t),t))},WL=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?s:(zL(r)?(s.headers=an({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,e!=null&&e.duplex&&(s.duplex=e.duplex),an(an({},s),n))};async function Yf(t,e,n,r,s,i){return new Promise((o,a)=>{t(n,WL(e,r,s,i)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>VL(l,a,r))})}async function pf(t,e,n,r){return Yf(t,"GET",e,n,r)}async function qi(t,e,n,r,s){return Yf(t,"POST",e,r,s,n)}async function qx(t,e,n,r,s){return Yf(t,"PUT",e,r,s,n)}async function KL(t,e,n,r){return Yf(t,"HEAD",e,an(an({},n),{},{noResolveJson:!0}),r)}async function Sw(t,e,n,r,s){return Yf(t,"DELETE",e,r,s,n)}var GL=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(ur(e))return{data:null,error:e};throw e}}};let sI;sI=Symbol.toStringTag;var qL=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[sI]="BlobDownloadBuilder",this.promise=null}asStream(){return new GL(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(ur(e))return{data:null,error:e};throw e}}};const YL={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},GS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var JL=class{constructor(t,e={},n,r){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.bucketId=n,this.fetch=kw(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(t,e,n,r){var s=this;try{let i;const o=an(an({},GS),r);let a=an(an({},s.headers),t==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",s.encodeMetadata(l)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),l&&!i.has("metadata")&&i.append("metadata",s.encodeMetadata(l))):(i=n,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=s.toBase64(s.encodeMetadata(l))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),r!=null&&r.headers&&(a=an(an({},a),r.headers));const u=s._removeEmptyFolders(e),d=s._getFinalPath(u),f=await(t=="PUT"?qx:qi)(s.fetch,`${s.url}/object/${d}`,i,an({headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:u,id:f.Id,fullPath:f.Key},error:null}}catch(i){if(s.shouldThrowOnError)throw i;if(ur(i))return{data:null,error:i};throw i}}async upload(t,e,n){return this.uploadOrUpdate("POST",t,e,n)}async uploadToSignedUrl(t,e,n,r){var s=this;const i=s._removeEmptyFolders(t),o=s._getFinalPath(i),a=new URL(s.url+`/object/upload/sign/${o}`);a.searchParams.set("token",e);try{let l;const u=an({upsert:GS.upsert},r),d=an(an({},s.headers),{"x-upsert":String(u.upsert)});return typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",u.cacheControl)):(l=n,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType),{data:{path:i,fullPath:(await qx(s.fetch,a.toString(),l,{headers:d})).Key},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(ur(l))return{data:null,error:l};throw l}}async createSignedUploadUrl(t,e){var n=this;try{let r=n._getFinalPath(t);const s=an({},n.headers);e!=null&&e.upsert&&(s["x-upsert"]="true");const i=await qi(n.fetch,`${n.url}/object/upload/sign/${r}`,{},{headers:s}),o=new URL(n.url+i.url),a=o.searchParams.get("token");if(!a)throw new jg("No token returned by API");return{data:{signedUrl:o.toString(),path:t,token:a},error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(ur(r))return{data:null,error:r};throw r}}async update(t,e,n){return this.uploadOrUpdate("PUT",t,e,n)}async move(t,e,n){var r=this;try{return{data:await qi(r.fetch,`${r.url}/object/move`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers}),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(ur(s))return{data:null,error:s};throw s}}async copy(t,e,n){var r=this;try{return{data:{path:(await qi(r.fetch,`${r.url}/object/copy`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers})).Key},error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(ur(s))return{data:null,error:s};throw s}}async createSignedUrl(t,e,n){var r=this;try{let s=r._getFinalPath(t),i=await qi(r.fetch,`${r.url}/object/sign/${s}`,an({expiresIn:e},n!=null&&n.transform?{transform:n.transform}:{}),{headers:r.headers});const o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${r.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(ur(s))return{data:null,error:s};throw s}}async createSignedUrls(t,e,n){var r=this;try{const s=await qi(r.fetch,`${r.url}/object/sign/${r.bucketId}`,{expiresIn:e,paths:t},{headers:r.headers}),i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(o=>an(an({},o),{},{signedUrl:o.signedURL?encodeURI(`${r.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(ur(s))return{data:null,error:s};throw s}}download(t,e){const n=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",r=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),s=r?`?${r}`:"",i=this._getFinalPath(t),o=()=>pf(this.fetch,`${this.url}/${n}/${i}${s}`,{headers:this.headers,noResolveJson:!0});return new qL(o,this.shouldThrowOnError)}async info(t){var e=this;const n=e._getFinalPath(t);try{return{data:Gx(await pf(e.fetch,`${e.url}/object/info/${n}`,{headers:e.headers})),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(ur(r))return{data:null,error:r};throw r}}async exists(t){var e=this;const n=e._getFinalPath(t);try{return await KL(e.fetch,`${e.url}/object/${n}`,{headers:e.headers}),{data:!0,error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(ur(r)&&r instanceof Kx){const s=r.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:r}}throw r}}getPublicUrl(t,e){const n=this._getFinalPath(t),r=[],s=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";s!==""&&r.push(s);const i=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",o=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});o!==""&&r.push(o);let a=r.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${n}${a}`)}}}async remove(t){var e=this;try{return{data:await Sw(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}}async list(t,e,n){var r=this;try{const s=an(an(an({},YL),e),{},{prefix:t||""});return{data:await qi(r.fetch,`${r.url}/object/list/${r.bucketId}`,s,{headers:r.headers},n),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(ur(s))return{data:null,error:s};throw s}}async listV2(t,e){var n=this;try{const r=an({},t);return{data:await qi(n.fetch,`${n.url}/object/list-v2/${n.bucketId}`,r,{headers:n.headers},e),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(ur(r))return{data:null,error:r};throw r}}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const iI="2.89.0",oI={"X-Client-Info":`storage-js/${iI}`};var XL=class{constructor(t,e={},n,r){this.shouldThrowOnError=!1;const s=new URL(t);r!=null&&r.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href.replace(/\/$/,""),this.headers=an(an({},oI),e),this.fetch=kw(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(t){var e=this;try{const n=e.listBucketOptionsToQueryString(t);return{data:await pf(e.fetch,`${e.url}/bucket${n}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await pf(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}}async createBucket(t,e={public:!1}){var n=this;try{return{data:await qi(n.fetch,`${n.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(ur(r))return{data:null,error:r};throw r}}async updateBucket(t,e){var n=this;try{return{data:await qx(n.fetch,`${n.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(ur(r))return{data:null,error:r};throw r}}async emptyBucket(t){var e=this;try{return{data:await qi(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await Sw(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},QL=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=an(an({},oI),e),this.fetch=kw(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await qi(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}}async listBuckets(t){var e=this;try{const n=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&n.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&n.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&n.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&n.set("sortOrder",t.sortOrder),t!=null&&t.search&&n.set("search",t.search);const r=n.toString(),s=r?`${e.url}/bucket?${r}`:`${e.url}/bucket`;return{data:await pf(e.fetch,s,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await Sw(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}}from(t){var e=this;if(!FL(t))throw new jg("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new PL({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(n,{get(s,i){const o=s[i];return typeof o!="function"?o:async(...a)=>{try{return{data:await o.apply(s,a),error:null}}catch(l){if(r)throw l;return{data:null,error:l}}}}})}};const _w={"X-Client-Info":`storage-js/${iI}`,"Content-Type":"application/json"};var aI=class extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Zs(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}var $0=class extends aI{constructor(t,e,n){super(t),this.name="StorageVectorsApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},ZL=class extends aI{constructor(t,e){super(t),this.name="StorageVectorsUnknownError",this.originalError=e}};const Tw=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),e$=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},qS=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),t$=async(t,e,n)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const r=t.status||500,s=t;if(typeof s.json=="function")s.json().then(i=>{const o=(i==null?void 0:i.statusCode)||(i==null?void 0:i.code)||r+"";e(new $0(qS(i),r,o))}).catch(()=>{const i=r+"";e(new $0(s.statusText||`HTTP ${r} error`,r,i))});else{const i=r+"";e(new $0(s.statusText||`HTTP ${r} error`,r,i))}}else e(new ZL(qS(t),t))},n$=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?s:(e$(r)?(s.headers=an({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,an(an({},s),n))};async function r$(t,e,n,r,s,i){return new Promise((o,a)=>{t(n,n$(e,r,s,i)).then(l=>{if(!l.ok)throw l;if(r!=null&&r.noResolveJson)return l;const u=l.headers.get("content-type");return!u||!u.includes("application/json")?{}:l.json()}).then(l=>o(l)).catch(l=>t$(l,a,r))})}async function ei(t,e,n,r,s){return r$(t,"POST",e,r,s,n)}var s$=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=an(an({},_w),e),this.fetch=Tw(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(t){var e=this;try{return{data:await ei(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Zs(n))return{data:null,error:n};throw n}}async getIndex(t,e){var n=this;try{return{data:await ei(n.fetch,`${n.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(Zs(r))return{data:null,error:r};throw r}}async listIndexes(t){var e=this;try{return{data:await ei(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Zs(n))return{data:null,error:n};throw n}}async deleteIndex(t,e){var n=this;try{return{data:await ei(n.fetch,`${n.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers})||{},error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(Zs(r))return{data:null,error:r};throw r}}},i$=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=an(an({},_w),e),this.fetch=Tw(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(t){var e=this;try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await ei(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Zs(n))return{data:null,error:n};throw n}}async getVectors(t){var e=this;try{return{data:await ei(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Zs(n))return{data:null,error:n};throw n}}async listVectors(t){var e=this;try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:await ei(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Zs(n))return{data:null,error:n};throw n}}async queryVectors(t){var e=this;try{return{data:await ei(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Zs(n))return{data:null,error:n};throw n}}async deleteVectors(t){var e=this;try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await ei(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Zs(n))return{data:null,error:n};throw n}}},o$=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=an(an({},_w),e),this.fetch=Tw(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await ei(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Zs(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await ei(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Zs(n))return{data:null,error:n};throw n}}async listBuckets(t={}){var e=this;try{return{data:await ei(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Zs(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await ei(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Zs(n))return{data:null,error:n};throw n}}},a$=class extends o${constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new l$(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,n=this;return e().call(n,t)}async getBucket(t){var e=()=>super.getBucket,n=this;return e().call(n,t)}async listBuckets(t={}){var e=()=>super.listBuckets,n=this;return e().call(n,t)}async deleteBucket(t){var e=()=>super.deleteBucket,n=this;return e().call(n,t)}},l$=class extends s${constructor(t,e,n,r){super(t,e,r),this.vectorBucketName=n}async createIndex(t){var e=()=>super.createIndex,n=this;return e().call(n,an(an({},t),{},{vectorBucketName:n.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,n=this;return e().call(n,an(an({},t),{},{vectorBucketName:n.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,n=this;return e().call(n,n.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,n=this;return e().call(n,n.vectorBucketName,t)}index(t){return new c$(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},c$=class extends i${constructor(t,e,n,r,s){super(t,e,s),this.vectorBucketName=n,this.indexName=r}async putVectors(t){var e=()=>super.putVectors,n=this;return e().call(n,an(an({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async getVectors(t){var e=()=>super.getVectors,n=this;return e().call(n,an(an({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,n=this;return e().call(n,an(an({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,n=this;return e().call(n,an(an({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,n=this;return e().call(n,an(an({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}},u$=class extends XL{constructor(t,e={},n,r){super(t,e,n,r)}from(t){return new JL(this.url,this.headers,t,this.fetch)}get vectors(){return new a$(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new QL(this.url+"/iceberg",this.headers,this.fetch)}};const lI="2.89.0",Tc=30*1e3,Yx=3,z0=Yx*Tc,d$="http://localhost:9999",f$="supabase.auth.token",h$={"X-Client-Info":`gotrue-js/${lI}`},Jx="X-Supabase-Api-Version",cI={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},p$=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,m$=10*60*1e3;class mf extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function Qt(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class g$ extends mf{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function y$(t){return Qt(t)&&t.name==="AuthApiError"}class bl extends mf{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class na extends mf{constructor(e,n,r,s){super(e,r,s),this.name=n,this.status=r}}class Ys extends na{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function x$(t){return Qt(t)&&t.name==="AuthSessionMissingError"}class fc extends na{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ih extends na{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Mh extends na{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function b$(t){return Qt(t)&&t.name==="AuthImplicitGrantRedirectError"}class YS extends na{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class w$ extends na{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Xx extends na{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function F0(t){return Qt(t)&&t.name==="AuthRetryableFetchError"}class JS extends na{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class Qx extends na{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const sm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),XS=` 	
\r=`.split(""),v$=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<XS.length;e+=1)t[XS[e].charCodeAt(0)]=-2;for(let e=0;e<sm.length;e+=1)t[sm[e].charCodeAt(0)]=e;return t})();function QS(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(sm[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(sm[r]),e.queuedBits-=6}}function uI(t,e,n){const r=v$[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function ZS(t){const e=[],n=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{_$(o,r,n)};for(let o=0;o<t.length;o+=1)uI(t.charCodeAt(o),s,i);return e.join("")}function k$(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function S$(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|s)+65536,n+=1}k$(r,e)}}function _$(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if(!(t>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function su(t){const e=[],n={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<t.length;s+=1)uI(t.charCodeAt(s),n,r);return new Uint8Array(e)}function T$(t){const e=[];return S$(t,n=>e.push(n)),new Uint8Array(e)}function El(t){const e=[],n={queue:0,queuedBits:0},r=s=>{e.push(s)};return t.forEach(s=>QS(s,n,r)),QS(null,n,r),e.join("")}function C$(t){return Math.round(Date.now()/1e3)+t}function E$(){return Symbol("auth-callback")}const Jr=()=>typeof window<"u"&&typeof document<"u",ll={tested:!1,writable:!1},dI=()=>{if(!Jr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ll.tested)return ll.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),ll.tested=!0,ll.writable=!0}catch{ll.tested=!0,ll.writable=!1}return ll.writable};function N$(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return n.searchParams.forEach((r,s)=>{e[s]=r}),e}const fI=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),j$=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Cc=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},cl=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Yr=async(t,e)=>{await t.removeItem(e)};class Ig{constructor(){this.promise=new Ig.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}Ig.promiseConstructor=Promise;function B0(t){const e=t.split(".");if(e.length!==3)throw new Qx("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!p$.test(e[r]))throw new Qx("JWT not in base64url format");return{header:JSON.parse(ZS(e[0])),payload:JSON.parse(ZS(e[1])),signature:su(e[2]),raw:{header:e[0],payload:e[1]}}}async function I$(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function M$(t,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await t(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function D$(t){return("0"+t.toString(16)).substr(-2)}function A$(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let s="";for(let i=0;i<56;i++)s+=n.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,D$).join("")}async function R$(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function O$(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await R$(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function hc(t,e,n=!1){const r=A$();let s=r;n&&(s+="/PASSWORD_RECOVERY"),await Cc(t,`${e}-code-verifier`,s);const i=await O$(r);return[i,r===i?"plain":"s256"]}const P$=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function L$(t){const e=t.headers.get(Jx);if(!e||!e.match(P$))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function $$(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function z$(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const F$=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function pc(t){if(!F$.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function U0(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function B$(t,e){return new Proxy(t,{get:(n,r,s)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,s)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,r,s)}})}function e2(t){return JSON.parse(JSON.stringify(t))}const pl=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),U$=[502,503,504];async function t2(t){var e;if(!j$(t))throw new Xx(pl(t),0);if(U$.includes(t.status))throw new Xx(pl(t),t.status);let n;try{n=await t.json()}catch(i){throw new bl(pl(i),i)}let r;const s=L$(t);if(s&&s.getTime()>=cI["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new JS(pl(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Ys}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new JS(pl(n),t.status,n.weak_password.reasons);throw new g$(pl(n),t.status||500,r)}const H$=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),n))};async function on(t,e,n,r){var s;const i=Object.assign({},r==null?void 0:r.headers);i[Jx]||(i[Jx]=cI["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await V$(t,e,n+a,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function V$(t,e,n,r,s,i){const o=H$(e,r,s,i);let a;try{a=await t(n,Object.assign({},o))}catch(l){throw console.error(l),new Xx(pl(l),0)}if(a.ok||await t2(a),r!=null&&r.noResolveJson)return a;try{return await a.json()}catch(l){await t2(l)}}function Vi(t){var e;let n=null;G$(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=C$(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function n2(t){const e=Vi(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function wa(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function W$(t){return{data:t,error:null}}function K$(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i}=t,o=Ng(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function r2(t){return t}function G$(t){return t.access_token&&t.refresh_token&&t.expires_in}const H0=["global","local","others"];class q${constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=fI(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=H0[0]){if(H0.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${H0.join(", ")}`);try{return await on(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Qt(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await on(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:wa})}catch(r){if(Qt(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=Ng(e,["options"]),s=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await on(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:K$,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(Qt(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await on(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:wa})}catch(n){if(Qt(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,s,i,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},d=await on(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:r2});if(d.error)throw d.error;const f=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(m.split(";")[1].split("=")[1]);u[`${b}Page`]=y}),u.total=parseInt(h)),{data:Object.assign(Object.assign({},f),u),error:null}}catch(u){if(Qt(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){pc(e);try{return await on(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:wa})}catch(n){if(Qt(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){pc(e);try{return await on(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:wa})}catch(r){if(Qt(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){pc(e);try{return await on(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:wa})}catch(r){if(Qt(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){pc(e.userId);try{const{data:n,error:r}=await on(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:n,error:r}}catch(n){if(Qt(n))return{data:null,error:n};throw n}}async _deleteFactor(e){pc(e.userId),pc(e.id);try{return{data:await on(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Qt(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,r,s,i,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},d=await on(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:r2});if(d.error)throw d.error;const f=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(m.split(";")[1].split("=")[1]);u[`${b}Page`]=y}),u.total=parseInt(h)),{data:Object.assign(Object.assign({},f),u),error:null}}catch(u){if(Qt(u))return{data:{clients:[]},error:u};throw u}}async _createOAuthClient(e){try{return await on(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Qt(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await on(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Qt(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await on(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Qt(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await on(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Qt(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await on(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Qt(n))return{data:null,error:n};throw n}}}function s2(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const mc={debug:!!(globalThis&&dI()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class hI extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Y$ extends hI{}async function J$(t,e,n){mc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),mc.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){mc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,s.name);try{return await n()}finally{mc.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,s.name)}}else{if(e===0)throw mc.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Y$(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(mc.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function X$(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function pI(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function Q$(t){return parseInt(t,16)}function Z$(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function e6(t){var e;const{chainId:n,domain:r,expirationTime:s,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:l,resources:u,scheme:d,uri:f,version:h}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!f)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const p=pI(t.address),m=d?`${d}://${r}`:r,y=t.statement?`${t.statement}
`:"",b=`${m} wants you to sign in with your Ethereum account:
${p}

${y}`;let g=`URI: ${f}
Version: ${h}
Chain ID: ${n}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(s&&(g+=`
Expiration Time: ${s.toISOString()}`),a&&(g+=`
Not Before: ${a.toISOString()}`),l&&(g+=`
Request ID: ${l}`),u){let v=`
Resources:`;for(const w of u){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);v+=`
- ${w}`}g+=v}return`${b}
${g}`}class Cr extends Error{constructor({message:e,code:n,cause:r,name:s}){var i;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(i=s??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=n}}class im extends Cr{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function t6({error:t,options:e}){var n,r,s;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Cr({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new Cr({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new Cr({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Cr({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new Cr({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new Cr({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new Cr({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new Cr({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const o=window.location.hostname;if(mI(o)){if(i.rp.id!==o)return new Cr({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Cr({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Cr({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new Cr({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Cr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function n6({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Cr({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new Cr({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(mI(r)){if(n.rpId!==r)return new Cr({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Cr({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new Cr({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Cr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class r6{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const s6=new r6;function i6(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:r}=t,s=Ng(t,["challenge","user","excludeCredentials"]),i=su(e).buffer,o=Object.assign(Object.assign({},n),{id:su(n.id).buffer}),a=Object.assign(Object.assign({},s),{challenge:i,user:o});if(r&&r.length>0){a.excludeCredentials=new Array(r.length);for(let l=0;l<r.length;l++){const u=r[l];a.excludeCredentials[l]=Object.assign(Object.assign({},u),{id:su(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return a}function o6(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,r=Ng(t,["challenge","allowCredentials"]),s=su(e).buffer,i=Object.assign(Object.assign({},r),{challenge:s});if(n&&n.length>0){i.allowCredentials=new Array(n.length);for(let o=0;o<n.length;o++){const a=n[o];i.allowCredentials[o]=Object.assign(Object.assign({},a),{id:su(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return i}function a6(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:El(new Uint8Array(t.response.attestationObject)),clientDataJSON:El(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function l6(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,r=t.getClientExtensionResults(),s=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:El(new Uint8Array(s.authenticatorData)),clientDataJSON:El(new Uint8Array(s.clientDataJSON)),signature:El(new Uint8Array(s.signature)),userHandle:s.userHandle?El(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function mI(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function i2(){var t,e;return!!(Jr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function c6(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new im("Browser returned unexpected credential type",e)}:{data:null,error:new im("Empty credential response",e)}}catch(e){return{data:null,error:t6({error:e,options:t})}}}async function u6(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new im("Browser returned unexpected credential type",e)}:{data:null,error:new im("Empty credential response",e)}}catch(e){return{data:null,error:n6({error:e,options:t})}}}const d6={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},f6={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function om(...t){const e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),n=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),r={};for(const s of t)if(s)for(const i in s){const o=s[i];if(o!==void 0)if(Array.isArray(o))r[i]=o;else if(n(o))r[i]=o;else if(e(o)){const a=r[i];e(a)?r[i]=om(a,o):r[i]=om(o)}else r[i]=o}return r}function h6(t,e){return om(d6,t,e||{})}function p6(t,e){return om(f6,t,e||{})}class m6{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:r,signal:s},i){try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!o)return{data:null,error:a};const l=s??s6.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:u}=o.webauthn.credential_options.publicKey;u.name||(u.name=`${u.id}:${r}`),u.displayName||(u.displayName=u.name)}switch(o.webauthn.type){case"create":{const u=h6(o.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:d,error:f}=await c6({publicKey:u,signal:l});return d?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:f}}case"request":{const u=p6(o.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:d,error:f}=await u6(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:u,signal:l}));return d?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:f}}}}catch(o){return Qt(o)?{data:null,error:o}:{data:null,error:new bl("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!n)return{data:null,error:new mf("rpId is required for WebAuthn authentication")};try{if(!i2())return{data:null,error:new bl("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:r},signal:s},{request:i});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:n,rpOrigins:r,credential_response:l.credential_response}})}catch(o){return Qt(o)?{data:null,error:o}:{data:null,error:new bl("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!n)return{data:null,error:new mf("rpId is required for WebAuthn registration")};try{if(!i2())return{data:null,error:new bl("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(d=>{var f;return(f=d.data)===null||f===void 0?void 0:f.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===e&&h.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d==null?void 0:d.id}):void 0),{data:null,error:a};const{data:l,error:u}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:s},{create:i});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:n,rpOrigins:r,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:u}}catch(o){return Qt(o)?{data:null,error:o}:{data:null,error:new bl("Unexpected error in register",o)}}}}X$();const g6={url:d$,storageKey:f$,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:h$,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function o2(t,e,n){return await n()}const gc={};class gf{get jwks(){var e,n;return(n=(e=gc[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){gc[this.storageKey]=Object.assign(Object.assign({},gc[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=gc[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){gc[this.storageKey]=Object.assign(Object.assign({},gc[this.storageKey]),{cachedAt:e})}constructor(e){var n,r,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},g6),e);if(this.storageKey=i.storageKey,this.instanceID=(n=gf.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,gf.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&Jr()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new q$({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=fI(i.fetch),this.lock=i.lock||o2,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:this.persistSession&&Jr()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=J$:this.lock=o2,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new m6(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:dI()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=s2(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=s2(this.memoryStorage)),Jr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${lI}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},r="none";if(Jr()&&(n=N$(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),Jr()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:i}=await this._getSessionFromURL(n,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),b$(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Qt(n)?this._returnResult({error:n}):this._returnResult({error:new bl("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,s;try{const i=await on(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:Vi}),{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(i){if(Qt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var n,r,s;try{let i;if("email"in e){const{email:d,password:f,options:h}=e;let p=null,m=null;this.flowType==="pkce"&&([p,m]=await hc(this.storage,this.storageKey)),i=await on(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:d,password:f,data:(n=h==null?void 0:h.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:p,code_challenge_method:m},xform:Vi})}else if("phone"in e){const{phone:d,password:f,options:h}=e;i=await on(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:f,data:(r=h==null?void 0:h.data)!==null&&r!==void 0?r:{},channel:(s=h==null?void 0:h.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:Vi})}else throw new Ih("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return await Yr(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(i){if(await Yr(this.storage,`${this.storageKey}-code-verifier`),Qt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let n;if("email"in e){const{email:i,password:o,options:a}=e;n=await on(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:n2})}else if("phone"in e){const{phone:i,password:o,options:a}=e;n=await on(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:n2})}else throw new Ih("You must provide either an email or phone number and a password");const{data:r,error:s}=n;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!r||!r.session||!r.user){const i=new fc;return this._returnResult({data:{user:null,session:null},error:i})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(n){if(Qt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,r,s,i,o,a,l,u,d,f,h;let p,m;if("message"in e)p=e.message,m=e.signature;else{const{chain:y,wallet:b,statement:g,options:v}=e;let w;if(Jr())if(typeof b=="object")w=b;else{const E=window;if("ethereum"in E&&typeof E.ethereum=="object"&&"request"in E.ethereum&&typeof E.ethereum.request=="function")w=E.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!(v!=null&&v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=b}const _=new URL((n=v==null?void 0:v.url)!==null&&n!==void 0?n:window.location.href),D=await w.request({method:"eth_requestAccounts"}).then(E=>E).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!D||D.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const k=pI(D[0]);let A=(r=v==null?void 0:v.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!A){const E=await w.request({method:"eth_chainId"});A=Q$(E)}const N={domain:_.host,address:k,statement:g,uri:_.href,version:"1",chainId:A,nonce:(s=v==null?void 0:v.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(o=(i=v==null?void 0:v.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=v==null?void 0:v.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=v==null?void 0:v.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(u=v==null?void 0:v.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(d=v==null?void 0:v.signInWithEthereum)===null||d===void 0?void 0:d.resources};p=e6(N),m=await w.request({method:"personal_sign",params:[Z$(p),k]})}try{const{data:y,error:b}=await on(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:m},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:Vi});if(b)throw b;if(!y||!y.session||!y.user){const g=new fc;return this._returnResult({data:{user:null,session:null},error:g})}return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),this._returnResult({data:Object.assign({},y),error:b})}catch(y){if(Qt(y))return this._returnResult({data:{user:null,session:null},error:y});throw y}}async signInWithSolana(e){var n,r,s,i,o,a,l,u,d,f,h,p;let m,y;if("message"in e)m=e.message,y=e.signature;else{const{chain:b,wallet:g,statement:v,options:w}=e;let _;if(Jr())if(typeof g=="object")_=g;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))_=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof g!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");_=g}const D=new URL((n=w==null?void 0:w.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in _&&_.signIn){const k=await _.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:D.host,uri:D.href}),v?{statement:v}:null));let A;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")A=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)A=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in A&&"signature"in A&&(typeof A.signedMessage=="string"||A.signedMessage instanceof Uint8Array)&&A.signature instanceof Uint8Array)m=typeof A.signedMessage=="string"?A.signedMessage:new TextDecoder().decode(A.signedMessage),y=A.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in _)||typeof _.signMessage!="function"||!("publicKey"in _)||typeof _!="object"||!_.publicKey||!("toBase58"in _.publicKey)||typeof _.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${D.host} wants you to sign in with your Solana account:`,_.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${D.href}`,`Issued At: ${(s=(r=w==null?void 0:w.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=w==null?void 0:w.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((a=w==null?void 0:w.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((u=w==null?void 0:w.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((f=(d=w==null?void 0:w.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||f===void 0)&&f.length?["Resources",...w.signInWithSolana.resources.map(A=>`- ${A}`)]:[]].join(`
`);const k=await _.signMessage(new TextEncoder().encode(m),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=k}}try{const{data:b,error:g}=await on(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:El(y)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Vi});if(g)throw g;if(!b||!b.session||!b.user){const v=new fc;return this._returnResult({data:{user:null,session:null},error:v})}return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),this._returnResult({data:Object.assign({},b),error:g})}catch(b){if(Qt(b))return this._returnResult({data:{user:null,session:null},error:b});throw b}}async _exchangeCodeForSession(e){const n=await cl(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(n??"").split("/");try{if(!r&&this.flowType==="pkce")throw new w$;const{data:i,error:o}=await on(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Vi});if(await Yr(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const a=new fc;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(await Yr(this.storage,`${this.storageKey}-code-verifier`),Qt(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:n,provider:r,token:s,access_token:i,nonce:o}=e,a=await on(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:Vi}),{data:l,error:u}=a;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!l||!l.session||!l.user){const d=new fc;return this._returnResult({data:{user:null,session:null},error:d})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:u})}catch(n){if(Qt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,r,s,i,o;try{if("email"in e){const{email:a,options:l}=e;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await hc(this.storage,this.storageKey));const{error:f}=await on(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:f})}if("phone"in e){const{phone:a,options:l}=e,{data:u,error:d}=await on(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:d})}throw new Ih("You must provide either an email or phone number.")}catch(a){if(await Yr(this.storage,`${this.storageKey}-code-verifier`),Qt(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var n,r;try{let s,i;"options"in e&&(s=(n=e.options)===null||n===void 0?void 0:n.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await on(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Vi});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,u=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(s){if(Qt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(e){var n,r,s,i,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await hc(this.storage,this.storageKey));const u=await on(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:W$});return!((i=u.data)===null||i===void 0)&&i.url&&Jr()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(u.data.url),this._returnResult(u)}catch(a){if(await Yr(this.storage,`${this.storageKey}-code-verifier`),Qt(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Ys;const{error:s}=await on(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(Qt(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:o}=await on(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:o,error:a}=await on(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a})}throw new Ih("You must provide either an email or phone number and a type")}catch(n){if(Qt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await cl(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<z0:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const o=await cl(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=U0()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=B$(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const n=await this._acquireLock(-1,async()=>await this._getUser());return n.data.user&&(this.suppressGetSessionWarning=!0),n}async _getUser(e){try{return e?await on(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:wa}):await this._useSession(async n=>{var r,s,i;const{data:o,error:a}=n;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ys}:await on(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:wa})})}catch(n){if(Qt(n))return x$(n)&&(await this._removeSession(),await Yr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new Ys;const o=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await hc(this.storage,this.storageKey));const{data:u,error:d}=await on(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:wa});if(d)throw d;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(r){if(await Yr(this.storage,`${this.storageKey}-code-verifier`),Qt(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ys;const n=Date.now()/1e3;let r=n,s=!0,i=null;const{payload:o}=B0(e.access_token);if(o.exp&&(r=o.exp,s=r<=n),s){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(n){if(Qt(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:o,error:a}=n;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Ys;const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(Qt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!Jr())throw new Mh("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Mh(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new YS("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Mh("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new YS("No code detected.");const{data:v,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const _=new URL(window.location.href);return _.searchParams.delete("code"),window.history.replaceState(window.history.state,"",_.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:u}=e;if(!i||!a||!o||!u)throw new Mh("No session defined in URL");const d=Math.round(Date.now()/1e3),f=parseInt(a);let h=d+f;l&&(h=parseInt(l));const p=h-d;p*1e3<=Tc&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${f}s`);const m=h-f;d-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,h,d):d-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,h,d);const{data:y,error:b}=await this._getUser(i);if(b)throw b;const g={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:f,expires_at:h,refresh_token:o,token_type:u,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:g,redirectType:e.type},error:null})}catch(r){if(Qt(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await cl(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({error:i});const o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(y$(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await Yr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=E$(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,s;try{const{data:{session:i},error:o}=n;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,n={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await hc(this.storage,this.storageKey,!0));try{return await on(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(i){if(await Yr(this.storage,`${this.storageKey}-code-verifier`),Qt(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:r,error:s}=await this._useSession(async i=>{var o,a,l,u,d;const{data:f,error:h}=i;if(h)throw h;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await on(this.fetch,"GET",p,{headers:this.headers,jwt:(d=(u=f.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(s)throw s;return Jr()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(Qt(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var r;try{const{error:s,data:{session:i}}=n;if(s)throw s;const{options:o,provider:a,token:l,access_token:u,nonce:d}=e,f=await on(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=i==null?void 0:i.access_token)!==null&&r!==void 0?r:void 0,body:{provider:a,id_token:l,access_token:u,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Vi}),{data:h,error:p}=f;return p?this._returnResult({data:{user:null,session:null},error:p}):!h||!h.session||!h.user?this._returnResult({data:{user:null,session:null},error:new fc}):(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:p}))}catch(s){if(await Yr(this.storage,`${this.storageKey}-code-verifier`),Qt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,s;const{data:i,error:o}=n;if(o)throw o;return await on(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await M$(async s=>(s>0&&await I$(200*Math.pow(2,s-1)),this._debug(n,"refreshing attempt",s),await on(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Vi})),(s,i)=>{const o=200*Math.pow(2,s);return i&&F0(i)&&Date.now()+o-r<Tc})}catch(r){if(this._debug(n,"error",r),Qt(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),Jr()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const s=await cl(this.storage,this.storageKey);if(s&&this.userStorage){let o=await cl(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:s.user},await Cc(this.userStorage,this.storageKey+"-user",o)),s.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:U0()}else if(s&&!s.user&&!s.user){const o=await cl(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(s.user=o.user,await Yr(this.storage,this.storageKey+"-user"),await Cc(this.storage,this.storageKey,s)):s.user=U0()}if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),s!==null&&await this._removeSession();return}const i=((n=s.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<z0;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${z0}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:o}=await this._callRefreshToken(s.refresh_token);o&&(console.error(o),F0(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(s.access_token);!a&&(o!=null&&o.user)?(s.user=o.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(r,"error",s),console.error(s);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Ys;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Ig;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Ys;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={data:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),Qt(i)){const o={data:null,error:i};return F0(i)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,n,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,n)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Yr(this.storage,`${this.storageKey}-code-verifier`);const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await Cc(this.userStorage,this.storageKey+"-user",{user:n.user});const s=Object.assign({},n);delete s.user;const i=e2(s);await Cc(this.storage,this.storageKey,i)}else{const s=e2(n);await Cc(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Yr(this.storage,this.storageKey),await Yr(this.storage,this.storageKey+"-code-verifier"),await Yr(this.storage,this.storageKey+"-user"),this.userStorage&&await Yr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Jr()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Tc);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/Tc);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Tc}ms, refresh threshold is ${Yx} ticks`),s<=Yx&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof hI)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Jr()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const s=[`provider=${encodeURIComponent(n)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await hc(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;return i?this._returnResult({data:null,error:i}):await on(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,s;const{data:i,error:o}=n;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:u}=await on(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return u?this._returnResult({data:null,error:u}):(e.factorType==="totp"&&l.type==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?a6(e.webauthn.credential_response):l6(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await on(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({data:null,error:i});const o=await on(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:i6(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:o6(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const s={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])s.all.push(i),i.status==="verified"&&s[i.factor_type].push(i);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var e,n;const{data:{session:r},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=B0(r.access_token);let o=null;i.aal&&(o=i.aal);let a=o;((n=(e=r.user.factors)===null||e===void 0?void 0:e.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(a="aal2");const u=i.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:u},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;return s?this._returnResult({data:null,error:s}):r?await on(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Ys})})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:s},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Ys});const o=await on(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&Jr()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Qt(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:s},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Ys});const o=await on(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&Jr()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Qt(r))return this._returnResult({data:null,error:r});throw r}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;return r?this._returnResult({data:null,error:r}):n?await on(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new Ys})})}catch(e){if(Qt(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;return s?this._returnResult({data:null,error:s}):r?(await on(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Ys})})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(a=>a.kid===e);if(r)return r;const s=Date.now();if(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+m$>s)return r;const{data:i,error:o}=await on(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,r=i.keys.find(a=>a.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:p,error:m}=await this.getSession();if(m||!p.session)return this._returnResult({data:null,error:m});r=p.session.access_token}const{header:s,payload:i,signature:o,raw:{header:a,payload:l}}=B0(r);n!=null&&n.allowExpired||$$(i.exp);const u=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!u){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:i,header:s,signature:o},error:null}}const d=z$(s.alg),f=await crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!await crypto.subtle.verify(d,f,o,T$(`${a}.${l}`)))throw new Qx("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(r){if(Qt(r))return this._returnResult({data:null,error:r});throw r}}}gf.nextInstanceID={};const y6=gf,x6="2.89.0";let dd="";typeof Deno<"u"?dd="deno":typeof document<"u"?dd="web":typeof navigator<"u"&&navigator.product==="ReactNative"?dd="react-native":dd="node";const b6={"X-Client-Info":`supabase-js-${dd}/${x6}`},w6={headers:b6},v6={schema:"public"},k6={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},S6={};function yf(t){"@babel/helpers - typeof";return yf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yf(t)}function _6(t,e){if(yf(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(yf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function T6(t){var e=_6(t,"string");return yf(e)=="symbol"?e:e+""}function C6(t,e,n){return(e=T6(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function gr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?a2(Object(n),!0).forEach(function(r){C6(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a2(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const E6=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),N6=()=>Headers,j6=(t,e,n)=>{const r=E6(n),s=N6();return async(i,o)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:t;let u=new s(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",t),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),r(i,gr(gr({},o),{},{headers:u}))}};function I6(t){return t.endsWith("/")?t:t+"/"}function M6(t,e){var n,r;const{db:s,auth:i,realtime:o,global:a}=t,{db:l,auth:u,realtime:d,global:f}=e,h={db:gr(gr({},l),s),auth:gr(gr({},u),i),realtime:gr(gr({},d),o),storage:{},global:gr(gr(gr({},f),a),{},{headers:gr(gr({},(n=f==null?void 0:f.headers)!==null&&n!==void 0?n:{}),(r=a==null?void 0:a.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return t.accessToken?h.accessToken=t.accessToken:delete h.accessToken,h}function D6(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(I6(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var A6=class extends y6{constructor(t){super(t)}},R6=class{constructor(t,e,n){var r,s;this.supabaseUrl=t,this.supabaseKey=e;const i=D6(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,a={db:v6,realtime:S6,auth:gr(gr({},k6),{},{storageKey:o}),global:w6},l=M6(n??{},a);if(this.storageKey=(r=l.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(s=l.global.headers)!==null&&s!==void 0?s:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(d,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}});else{var u;this.auth=this._initSupabaseAuthClient((u=l.auth)!==null&&u!==void 0?u:{},this.headers,l.global.fetch)}this.fetch=j6(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(gr({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(d=>this.realtime.setAuth(d)).catch(d=>console.warn("Failed to set initial Realtime auth token:",d)),this.rest=new hL(new URL("rest/v1",i).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new u$(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new lL(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,n)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,n;if(t.accessToken)return await t.accessToken();const{data:r}=await t.auth.getSession();return(e=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:s,storageKey:i,flowType:o,lock:a,debug:l,throwOnError:u},d,f){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new A6({url:this.authUrl.href,headers:gr(gr({},h),d),storageKey:i,autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:s,flowType:o,lock:a,debug:l,throwOnError:u,fetch:f,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new IL(this.realtimeUrl.href,gr(gr({},t),{},{params:gr(gr({},{apikey:this.supabaseKey}),t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(t,e,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const O6=(t,e,n)=>new R6(t,e,n);function P6(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}P6()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const gI="https://acrkclmderqewcwugsnl.supabase.co",pp="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFjcmtjbG1kZXJxZXdjd3Vnc25sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNTc0MzAsImV4cCI6MjA4MTgzMzQzMH0.UT2vJTXpPO5tR9sUD8YU0gJ_47Zpe3yJiLzllUljPDw";console.log("Supabase Config:",{url:gI,keyLength:pp==null?void 0:pp.length});let yI=null;try{yI=O6(gI,pp)}catch(t){console.error("Error creating Supabase client:",t)}const be=yI,xI=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),L6=(t,e)=>{const n=new Date,r=t.toLowerCase().trim();if(/^\d+$/.test(r)){const i=parseInt(r,10);let o=n.getMonth(),a=n.getFullYear();i<n.getDate()&&(o++,o>11&&(o=0,a++));const l=new Date(a,o,i);if(l.getMonth()===o)return l}if(["","today","td"].includes(r))return n;if(["","tmr","tm"].includes(r))return new Date(n.setDate(n.getDate()+1));if([""].includes(r))return new Date(n.setDate(n.getDate()+2));const s=r.match(/^\+(\d+)$/);return s?new Date(n.setDate(n.getDate()+parseInt(s[1]))):null},$6=(t,e="zh")=>t?new Date(t).toLocaleDateString(e==="zh"?"zh-TW":"en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",bI=(t,e=!0,n="zh")=>{if(!t)return"";const r=new Date(t),s=new Date;s.setHours(0,0,0,0);const i=new Date(r.getTime());i.setHours(0,0,0,0);const o=Math.floor((i.getTime()-s.getTime())/(1e3*60*60*24));let a="";if(o===0?a=n==="zh"?"":"Today":o===1?a=n==="zh"?"":"Tomorrow":o===-1?a=n==="zh"?"":"Yesterday":o<0?a=n==="zh"?`${Math.abs(o)} `:`${Math.abs(o)}d ago`:a=n==="zh"?`${r.getMonth()+1}${r.getDate()}`:r.toLocaleDateString("en-US",{month:"short",day:"numeric"}),e){const l=r.getHours(),u=r.getMinutes();(l!==0||u!==0)&&(a+=` ${String(l).padStart(2,"0")}:${String(u).padStart(2,"0")}`)}return a},Ti=(t,e)=>t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate(),Cw=t=>t?Ti(new Date(t),new Date):!1,Zx=t=>t?new Date(t).getTime()<new Date().setHours(0,0,0,0):!1,Ew=(t,e,n)=>{if(!t)return!1;const r=n.filter(s=>s.parent_id===t);for(const s of r)if(s.id===e||Ew(s.id,e,n))return!0;return!1},z6=t=>{if(!t)return[];const e=/data-type="mention"[^>]*data-id="([^"]+)"/g,n=[];let r;for(;(r=e.exec(t))!==null;)n.push(r[1]);return n},F6=(t,e)=>{var r;return(r=t.tags)!=null&&r.some(s=>e.includes(s))?!0:z6(t.description).some(s=>e.includes(s))},mp=(t,e)=>{let n=t,r=t.parent_id;const s=new Set([t.id]);for(;r&&!s.has(r);){s.add(r);const i=e.find(o=>o.id===r);if(i)n=i,r=i.parent_id;else break}return n},B6=(t,e)=>{const n=new Date(t),r=new Date(n);switch(e.type){case"daily":r.setDate(r.getDate()+e.interval);break;case"weekly":if(e.weekdays&&e.weekdays.length>0){let s=!1;for(let i=1;i<=7*e.interval;i++){const o=new Date(n);if(o.setDate(o.getDate()+i),e.weekdays.includes(o.getDay())){r.setTime(o.getTime()),s=!0;break}}s||r.setDate(r.getDate()+7*e.interval)}else r.setDate(r.getDate()+7*e.interval);break;case"monthly":if(r.setMonth(r.getMonth()+e.interval),e.monthDay){const s=Math.min(e.monthDay,l2(r));r.setDate(s)}break;case"yearly":if(r.setFullYear(r.getFullYear()+e.interval),e.yearMonth!==void 0&&e.yearDay!==void 0){r.setMonth(e.yearMonth-1);const s=Math.min(e.yearDay,l2(r));r.setDate(s)}break}if(e.endDate){const s=new Date(e.endDate);if(r>s)return null}return r.toISOString()},l2=t=>new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),U6=(t,e="zh")=>{if(t.originalText)return t.originalText;const n=t.interval;let r="";if(e==="zh")switch(t.type){case"daily":r=n===1?"":`${n}`;break;case"weekly":r=n===1?"":`${n}`;break;case"monthly":t.monthDay?r=n===1?`${t.monthDay}`:`${n}${t.monthDay}`:r=n===1?"":`${n}`;break;case"yearly":t.yearMonth&&t.yearDay?r=`${t.yearMonth}${t.yearDay}`:r=n===1?"":`${n}`;break}else switch(t.type){case"daily":r=n===1?"Every day":`Every ${n} days`;break;case"weekly":r=n===1?"Every week":`Every ${n} weeks`;break;case"monthly":t.monthDay?r=n===1?`Monthly on day ${t.monthDay}`:`Every ${n} months on day ${t.monthDay}`:r=n===1?"Every month":`Every ${n} months`;break;case"yearly":r=n===1?"Every year":`Every ${n} years`;break}if(t.endDate){const s=new Date(t.endDate).toLocaleDateString(e==="zh"?"zh-TW":"en-US");r+=e==="zh"?` (${s})`:` (until ${s})`}return r},wI=()=>new Promise((t,e)=>{var r;if((r=window.google)!=null&&r.accounts){t();return}document.querySelector('script[src="https://accounts.google.com/gsi/client"]');const n=document.createElement("script");n.src="https://accounts.google.com/gsi/client",n.async=!0,n.defer=!0,n.onload=()=>t(),n.onerror=e,document.body.appendChild(n)}),wl=async t=>{const e=await fetch("https://www.googleapis.com/calendar/v3/users/me/calendarList",{headers:{Authorization:`Bearer ${t}`}});if(!e.ok)throw new Error("Failed to fetch calendar list");return(await e.json()).items||[]},vI=async(t,e,n,r)=>{var u;const s=new Date(n).toISOString(),i=new Date(r),o=new URLSearchParams({timeMin:s,timeMax:i.toISOString(),singleEvents:"true",orderBy:"startTime",maxResults:"2500"}),a=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events?${o}`,{headers:{Authorization:`Bearer ${t}`}}),l=await a.json();if(!a.ok)throw new Error(((u=l.error)==null?void 0:u.message)||"Failed to fetch calendar events");return l.items||[]},e1=async(t,e,n,r)=>{var o,a;let i=0;for(;i<3;){i++;const l=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events/${encodeURIComponent(n)}`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(l.ok)return;if(l.status===403||l.status===429){const f=(((o=(await l.clone().json().catch(()=>({}))).error)==null?void 0:o.message)||"").toLowerCase();if((f.includes("rate limit")||f.includes("quota")||l.status===429)&&i<3){const h=i*1500;console.warn(`[Google Sync] Rate Limit Hit. Retrying update in ${h}ms... (Attempt ${i}/3)`),await new Promise(p=>setTimeout(p,h));continue}}const u=await l.json();throw new Error(((a=u.error)==null?void 0:a.message)||"Failed to update Google event")}},la=async(t,e,n)=>{var s;const r=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events/${encodeURIComponent(n)}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!r.ok){const i=await r.json();throw new Error(((s=i.error)==null?void 0:s.message)||"Failed to delete Google event")}},Ro=async(t,e,n)=>{var i;const r=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){const o=await r.json();throw new Error(((i=o.error)==null?void 0:i.message)||"Failed to create Google event")}return(await r.json()).id},kI=async(t,e,n)=>{let r={singleEvents:"true",maxResults:"2500"};const s=new Date,i=new Date;if(i.setFullYear(s.getFullYear()+2),n)r.syncToken=n;else{const u=new Date;u.setMonth(u.getMonth()-1),r.timeMin=u.toISOString(),r.timeMax=i.toISOString()}let o=[],a,l;try{do{const u=new URLSearchParams({...r,...l?{pageToken:l}:{}}),d=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events?${u}`,{headers:{Authorization:`Bearer ${t}`}});if(d.status===410)return{events:[],fullSyncRequired:!0};if(!d.ok)throw new Error("Sync Request Failed");const f=await d.json();if(f.items){const h=i.getTime(),p=f.items.filter(m=>m.recurringEventId?!1:m.start&&(m.start.dateTime||m.start.date)?new Date(m.start.dateTime||m.start.date).getTime()<h:!0);o.push(...p)}l=f.nextPageToken,a=f.nextSyncToken}while(l);return{events:o,nextSyncToken:a}}catch(u){throw console.error(u),u}},H6=Object.freeze(Object.defineProperty({__proto__:null,createGoogleEvent:Ro,deleteGoogleEvent:la,fetchCalendarList:wl,fetchGoogleEvents:vI,fetchUpdatedGoogleEvents:kI,loadGoogleScript:wI,updateGoogleEvent:e1},Symbol.toStringTag,{value:"Module"})),V6="v1.6.0",gp=28,SI=new Image;SI.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";const Qn={slate:{color:"#64748b",bg:"bg-slate-50",text:"text-slate-600",accent:"text-slate-600",badge:"bg-slate-100 text-slate-600 border-slate-200",border:"border-slate-500",ring:"focus-within:ring-slate-200",buttonRing:"focus:ring-slate-200 focus:border-slate-300",dot:"bg-slate-400",breadcrumb:"bg-slate-50 text-slate-600 hover:bg-slate-100",indicator:"bg-slate-500",ringColor:"ring-slate-400"},gray:{color:"#6b7280",bg:"bg-gray-50",text:"text-gray-600",accent:"text-gray-600",badge:"bg-gray-100 text-gray-600 border-gray-200",border:"border-gray-300",ring:"focus-within:ring-gray-200",buttonRing:"focus:ring-gray-200 focus:border-gray-300",dot:"bg-gray-400",breadcrumb:"bg-gray-50 text-gray-600 hover:bg-gray-100",indicator:"bg-gray-500",ringColor:"ring-gray-400"},zinc:{color:"#71717a",bg:"bg-zinc-50",text:"text-zinc-600",accent:"text-zinc-600",badge:"bg-zinc-100 text-zinc-600 border-zinc-200",border:"border-zinc-500",ring:"focus-within:ring-zinc-200",buttonRing:"focus:ring-zinc-200 focus:border-zinc-300",dot:"bg-zinc-400",breadcrumb:"bg-zinc-50 text-zinc-600 hover:bg-zinc-100",indicator:"bg-zinc-500",ringColor:"ring-zinc-400"},neutral:{color:"#737373",bg:"bg-neutral-50",text:"text-neutral-600",accent:"text-neutral-600",badge:"bg-neutral-100 text-neutral-600 border-neutral-200",border:"border-neutral-500",ring:"focus-within:ring-neutral-200",buttonRing:"focus:ring-neutral-200 focus:border-neutral-300",dot:"bg-neutral-400",breadcrumb:"bg-neutral-50 text-neutral-600 hover:bg-neutral-100",indicator:"bg-neutral-500",ringColor:"ring-neutral-400"},stone:{color:"#78716c",bg:"bg-stone-50",text:"text-stone-600",accent:"text-stone-600",badge:"bg-stone-100 text-stone-600 border-stone-200",border:"border-stone-500",ring:"focus-within:ring-stone-200",buttonRing:"focus:ring-stone-200 focus:border-stone-300",dot:"bg-stone-400",breadcrumb:"bg-stone-50 text-stone-600 hover:bg-stone-100",indicator:"bg-stone-500",ringColor:"ring-stone-400"},red:{color:"#ef4444",bg:"bg-red-50",text:"text-red-600",accent:"text-red-600",badge:"bg-red-100 text-red-600 border-red-200",border:"border-red-500",ring:"focus-within:ring-red-200",buttonRing:"focus:ring-red-200 focus:border-red-300",dot:"bg-red-400",breadcrumb:"bg-red-50 text-red-600 hover:bg-red-100",indicator:"bg-red-500",ringColor:"ring-red-400"},orange:{color:"#f97316",bg:"bg-orange-50",text:"text-orange-600",accent:"text-orange-600",badge:"bg-orange-100 text-orange-600 border-orange-200",border:"border-orange-500",ring:"focus-within:ring-orange-200",buttonRing:"focus:ring-orange-200 focus:border-orange-300",dot:"bg-orange-400",breadcrumb:"bg-orange-50 text-orange-600 hover:bg-orange-100",indicator:"bg-orange-500",ringColor:"ring-orange-400"},amber:{color:"#f59e0b",bg:"bg-amber-50",text:"text-amber-600",accent:"text-amber-600",badge:"bg-amber-100 text-amber-600 border-amber-200",border:"border-amber-500",ring:"focus-within:ring-amber-200",buttonRing:"focus:ring-amber-200 focus:border-amber-300",dot:"bg-amber-400",breadcrumb:"bg-amber-50 text-amber-600 hover:bg-amber-100",indicator:"bg-amber-500",ringColor:"ring-amber-400"},yellow:{color:"#eab308",bg:"bg-yellow-50",text:"text-yellow-600",accent:"text-yellow-600",badge:"bg-yellow-100 text-yellow-600 border-yellow-200",border:"border-yellow-500",ring:"focus-within:ring-yellow-200",buttonRing:"focus:ring-yellow-200 focus:border-yellow-300",dot:"bg-yellow-400",breadcrumb:"bg-yellow-50 text-yellow-600 hover:bg-yellow-100",indicator:"bg-yellow-500",ringColor:"ring-yellow-400"},lime:{color:"#84cc16",bg:"bg-lime-50",text:"text-lime-600",accent:"text-lime-600",badge:"bg-lime-100 text-lime-600 border-lime-200",border:"border-lime-500",ring:"focus-within:ring-lime-200",buttonRing:"focus:ring-lime-200 focus:border-lime-300",dot:"bg-lime-400",breadcrumb:"bg-lime-50 text-lime-600 hover:bg-lime-100",indicator:"bg-lime-500",ringColor:"ring-lime-400"},green:{color:"#10b981",bg:"bg-green-50",text:"text-green-600",accent:"text-green-600",badge:"bg-green-100 text-green-600 border-green-200",border:"border-green-500",ring:"focus-within:ring-green-200",buttonRing:"focus:ring-green-200 focus:border-green-300",dot:"bg-green-400",breadcrumb:"bg-green-50 text-green-600 hover:bg-green-100",indicator:"bg-green-500",ringColor:"ring-green-400"},emerald:{color:"#10b981",bg:"bg-emerald-50",text:"text-emerald-600",accent:"text-emerald-600",badge:"bg-emerald-100 text-emerald-600 border-emerald-200",border:"border-emerald-500",ring:"focus-within:ring-emerald-200",buttonRing:"focus:ring-emerald-200 focus:border-emerald-300",dot:"bg-emerald-400",breadcrumb:"bg-emerald-50 text-emerald-600 hover:bg-emerald-100",indicator:"bg-emerald-500",ringColor:"ring-emerald-400"},teal:{color:"#14b8a6",bg:"bg-teal-50",text:"text-teal-600",accent:"text-teal-600",badge:"bg-teal-100 text-teal-600 border-teal-200",border:"border-teal-500",ring:"focus-within:ring-teal-200",buttonRing:"focus:ring-teal-200 focus:border-teal-300",dot:"bg-teal-400",breadcrumb:"bg-teal-50 text-teal-600 hover:bg-teal-100",indicator:"bg-teal-500",ringColor:"ring-teal-400"},cyan:{color:"#06b6d4",bg:"bg-cyan-50",text:"text-cyan-600",accent:"text-cyan-600",badge:"bg-cyan-100 text-cyan-600 border-cyan-200",border:"border-cyan-500",ring:"focus-within:ring-cyan-200",buttonRing:"focus:ring-cyan-200 focus:border-cyan-300",dot:"bg-cyan-400",breadcrumb:"bg-cyan-50 text-cyan-600 hover:bg-cyan-100",indicator:"bg-cyan-500",ringColor:"ring-cyan-400"},sky:{color:"#0ea5e9",bg:"bg-sky-50",text:"text-sky-600",accent:"text-sky-600",badge:"bg-sky-100 text-sky-600 border-sky-200",border:"border-sky-500",ring:"focus-within:ring-sky-200",buttonRing:"focus:ring-sky-200 focus:border-sky-300",dot:"bg-sky-400",breadcrumb:"bg-sky-50 text-sky-600 hover:bg-sky-100",indicator:"bg-sky-500",ringColor:"ring-sky-400"},blue:{color:"#3b82f6",bg:"bg-blue-50",text:"text-blue-600",accent:"text-blue-600",badge:"bg-blue-100 text-blue-600 border-blue-200",border:"border-blue-500",ring:"focus-within:ring-blue-200",buttonRing:"focus:ring-blue-200 focus:border-blue-300",dot:"bg-blue-400",breadcrumb:"bg-blue-50 text-blue-600 hover:bg-blue-100",indicator:"bg-blue-500",ringColor:"ring-blue-400"},indigo:{color:"#6366f1",bg:"bg-indigo-50",text:"text-indigo-600",accent:"text-indigo-600",badge:"bg-indigo-100 text-indigo-600 border-indigo-200",border:"border-indigo-500",ring:"focus-within:ring-indigo-200",buttonRing:"focus:ring-indigo-200 focus:border-indigo-300",dot:"bg-indigo-400",breadcrumb:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100",indicator:"bg-indigo-500",ringColor:"ring-indigo-400"},violet:{color:"#8b5cf6",bg:"bg-violet-50",text:"text-violet-600",accent:"text-violet-600",badge:"bg-violet-100 text-violet-600 border-violet-200",border:"border-violet-500",ring:"focus-within:ring-violet-200",buttonRing:"focus:ring-violet-200 focus:border-violet-300",dot:"bg-violet-400",breadcrumb:"bg-violet-50 text-violet-600 hover:bg-violet-100",indicator:"bg-violet-500",ringColor:"ring-violet-400"},purple:{color:"#a855f7",bg:"bg-purple-50",text:"text-purple-600",accent:"text-purple-600",badge:"bg-purple-100 text-purple-600 border-purple-200",border:"border-purple-500",ring:"focus-within:ring-purple-200",buttonRing:"focus:ring-purple-200 focus:border-purple-300",dot:"bg-purple-400",breadcrumb:"bg-purple-50 text-purple-600 hover:bg-purple-100",indicator:"bg-purple-500",ringColor:"ring-purple-400"},fuchsia:{color:"#d946ef",bg:"bg-fuchsia-50",text:"text-fuchsia-600",accent:"text-fuchsia-600",badge:"bg-fuchsia-100 text-fuchsia-600 border-fuchsia-200",border:"border-fuchsia-500",ring:"focus-within:ring-fuchsia-200",buttonRing:"focus:ring-fuchsia-200 focus:border-fuchsia-300",dot:"bg-fuchsia-400",breadcrumb:"bg-fuchsia-50 text-fuchsia-600 hover:bg-fuchsia-100",indicator:"bg-fuchsia-500",ringColor:"ring-fuchsia-400"},pink:{color:"#ec4899",bg:"bg-pink-50",text:"text-pink-600",accent:"text-pink-600",badge:"bg-pink-100 text-pink-600 border-pink-200",border:"border-pink-500",ring:"focus-within:ring-pink-200",buttonRing:"focus:ring-pink-200 focus:border-pink-300",dot:"bg-pink-400",breadcrumb:"bg-pink-50 text-pink-600 hover:bg-pink-100",indicator:"bg-pink-500",ringColor:"ring-pink-400"},rose:{color:"#f43f5e",bg:"bg-rose-50",text:"text-rose-600",accent:"text-rose-600",badge:"bg-rose-100 text-rose-600 border-rose-200",border:"border-rose-500",ring:"focus-within:ring-rose-200",buttonRing:"focus:ring-rose-200 focus:border-rose-300",dot:"bg-rose-400",breadcrumb:"bg-rose-50 text-rose-600 hover:bg-rose-100",indicator:"bg-rose-500",ringColor:"ring-rose-400"}},W6={zh:{inbox:"",today:"",upcoming:"",anytime:"",someday:"",logbook:"",trash:"",tags:"",focus:"",journal:"",prompt:"",newTag:"",subTagPlaceholder:"...",tagStyle:"",selectTagColor:"",addSubTag:"",rename:"",deleteTagConfirm:"",deleteTag:"",settings:"",logout:"",emptyTrash:"",emptyTrashConfirm:"",trashEmptyTitle:"",restoreTrash:"",restoreTrashConfirm:"",putBack:"",delete:"",archive:"",notesPlaceholder:"...",addTagPlaceholder:"...",attachFiles:"",aiPolishSuggestions:"AI ",suggestedTitle:" ()",suggestedContent:" ()",aiPolishApplied:" AI ",confirmReplace:"",dateInputPlaceholder:": 5, , ...",identified:"",scheduleTitle:"",noSchedule:"",confirmDate:"",addNotePlaceholder:"...",from:"",addNewTag:"",presentationMode:"",editMode:"",linkAttachments:"",linkedTo:"",noParagraphs:"",clickToLink:"",paragraph:"",noAttachmentsLinked:"",save:"",cancel:"",share:"",aiPolish:"AI ",aiAssistant:"AI ",undo:"",redo:"",dismiss:"",permanentlyDeleted:"",restored:"",appearance:"",fontSize:"",fontWeight:"",fontFamily:"",language:"",timeFormat:"",calendarSettings:"",showLunar:"",showTaiwanHolidays:"",aiSettings:"AI ",provider:"",fontNormal:"",fontThin:"",sizeSmall:"",sizeNormal:"",sizeLarge:"",fontSystem:"",fontThings:"",theme:""},en:{inbox:"Inbox",today:"Today",upcoming:"Upcoming",anytime:"Anytime",someday:"Inspiration",logbook:"Logbook",trash:"Trash",tags:"Tags",focus:"Focus",journal:"Note",prompt:"Prompt",newTag:"New Tag",subTagPlaceholder:"Subtag name...",tagStyle:"Tag Style",selectTagColor:"Select tag color",addSubTag:"Add Subtag",rename:"Rename",deleteTagConfirm:"Are you sure you want to delete this tag?",deleteTag:"Delete Tag",settings:"Settings",logout:"Logout",emptyTrash:"Empty Trash",emptyTrashConfirm:"Are you sure you want to permanently delete all items in the trash? This action is irreversible.",trashEmptyTitle:"Trash",restoreTrash:"Restore All",restoreTrashConfirm:"Are you sure you want to restore all items in the trash?",putBack:"Put Back",delete:"Delete",archive:"Archive",notesPlaceholder:"Notes...",addTagPlaceholder:"Add tag...",attachFiles:"Files",aiPolishSuggestions:"AI Polish Suggestions",suggestedTitle:"Suggested Title (Editable)",suggestedContent:"Suggested Content (Editable)",aiPolishApplied:"AI polish applied",confirmReplace:"Confirm Replace",dateInputPlaceholder:"Type: 5, tomorrow, next Fri...",identified:"Identified",scheduleTitle:"Schedule",noSchedule:"No tasks scheduled",confirmDate:"Confirm Date",addNotePlaceholder:"Add a note...",from:"From",addNewTag:"Add",presentationMode:"Presentation Mode",editMode:"Edit Mode",linkAttachments:"Link Attachments",linkedTo:"Linked to",noParagraphs:"No paragraphs yet",clickToLink:"Click to link attachments",paragraph:"Paragraph",noAttachmentsLinked:"No attachments linked",save:"Save",cancel:"Cancel",share:"Share",aiPolish:"AI Polish",aiAssistant:"AI Assistant",undo:"Undo",redo:"Redo",dismiss:"Dismiss",permanentlyDeleted:"Permanently deleted",restored:"Restored",appearance:"Appearance",fontSize:"Font Size",fontWeight:"Font Weight",fontFamily:"Font Family",language:"Language",timeFormat:"Time Format",calendarSettings:"Calendar Settings",showLunar:"Show Lunar",showTaiwanHolidays:"Show Holidays",aiSettings:"AI Settings",provider:"Provider",fontNormal:"Normal",fontThin:"Thin",sizeSmall:"Small",sizeNormal:"Normal",sizeLarge:"Large",fontSystem:"Default",fontThings:"Thin",theme:"Theme"}},ul=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),jn=x.createContext({}),K6=({children:t})=>{const[e,n]=x.useState(null),[r,s]=x.useState([]),[i,o]=x.useState([]),[a,l]=x.useState([]),[u,d]=x.useState(!0),[f,h]=x.useState(null),[p,m]=x.useState("synced"),[y,b]=x.useState(null),[g,v]=x.useState([]),[w,_]=x.useState(null),[D,k]=x.useState(null),[A,N]=x.useState(null),[E,S]=x.useState([]),T=$=>{if(typeof $=="function")N(z=>{const L=$(z);if(L===null)return null;const V=Q.current.find(U=>U.id===L);return V!=null&&V.is_locked&&!E.includes(L)?(console.warn("Blocked editing locked task:",L),z):L});else{if($===null){N(null);return}const z=Q.current.find(L=>L.id===$);if(z!=null&&z.is_locked&&!E.includes($)){console.warn("Blocked editing locked task:",$);return}N($)}},C=A,O=$=>{S(z=>[...z,$]),setTimeout(()=>{S(z=>z.filter(L=>L!==$))},3e4)},[P,H]=x.useState(()=>{const $=localStorage.getItem(`expanded_tasks_${e==null?void 0:e.id}`);return $?JSON.parse($):[]}),[M,I]=x.useState({}),[K,G]=x.useState([]),[R,Ee]=x.useState(!1),[ge,F]=x.useState(!1),[B,se]=x.useState(()=>{const $=localStorage.getItem("locked_google_tag_ids");return $?JSON.parse($):[]}),We=x.useCallback($=>{se(z=>{const V=z.includes($)?z.filter(U=>U!==$):[...z,$];return localStorage.setItem("locked_google_tag_ids",JSON.stringify(V)),V})},[]),ut=x.useCallback($=>{if(!$.tags||$.tags.length===0)return!1;for(const z of $.tags)if(B.includes(z)){const L=a.find(V=>V.id===z);if(L&&L.name.startsWith("Google:"))return!0}return!1},[B,a]);x.useEffect(()=>{const $=localStorage.getItem("viewTagFilters");if($)try{const z=JSON.parse($),L={};Object.keys(z).forEach(V=>{Array.isArray(z[V])?L[V]={include:z[V],exclude:[]}:L[V]=z[V]}),I(L)}catch(z){console.error("Failed to parse viewTagFilters",z)}},[]);const oe=($,z)=>{I(L=>{const V={...L,[$]:z};return localStorage.setItem("viewTagFilters",JSON.stringify(V)),V})},je=x.useMemo(()=>{const $={},z=L=>{if($[L])return $[L];const V=a.find(U=>U.id===L);return V?V.parent_id?V.color==="#6366f1"||!V.color?($[L]=z(V.parent_id),$[L]):($[L]=V.color,$[L]):($[L]=V.color||"#6366f1",$[L]):"#6366f1"};return a.forEach(L=>z(L.id)),$},[a]),[te,$e]=x.useState(()=>localStorage.getItem(`last_view_${e==null?void 0:e.id}`)||"inbox"),[Te,Je]=x.useState(null),[Ye,Ke]=x.useState([]),lt=x.useRef([]);lt.current=Ye;const[St,X]=x.useState({additionalTags:[],startDate:null,dueDate:null,color:null}),[ee,ie]=x.useState(()=>{const $=localStorage.getItem(`theme_settings_${e==null?void 0:e.id}`),z={fontWeight:"thin",fontSize:"normal",fontFamily:"system",timeFormat:"24h",showLunar:!1,showTaiwanHolidays:!1,language:"zh"};return $?{...z,...JSON.parse($)}:z}),ce=ee.language||"zh",Z=$=>{ie(z=>({...z,language:$}))};x.useEffect(()=>{ee.themeMode&&ee.themeMode!=="light"?document.documentElement.setAttribute("data-theme",ee.themeMode):document.documentElement.removeAttribute("data-theme")},[ee.themeMode]),x.useEffect(()=>{const $=ee.fontFamily||"system";document.documentElement.setAttribute("data-font",$)},[ee.fontFamily]);const ne=x.useCallback($=>W6[ce][$]||$,[ce]),[Se,Ie]=x.useState(null),[fe,Oe]=x.useState(null),[et,xt]=x.useState(()=>{const $=localStorage.getItem(`calendar_current_date_${e==null?void 0:e.id}`);return $?new Date($):new Date}),[It,ue]=x.useState(()=>parseInt(localStorage.getItem(`sidebar_width_${e==null?void 0:e.id}`)||"260")),[Ne,Ue]=x.useState(()=>localStorage.getItem(`sidebar_collapsed_${e==null?void 0:e.id}`)==="true"),[Ze,xe]=x.useState(()=>parseInt(localStorage.getItem(`focus_split_width_${e==null?void 0:e.id}`)||"400")),[ct,dt]=x.useState(!1);x.useEffect(()=>{e!=null&&e.id&&localStorage.setItem(`sidebar_collapsed_${e.id}`,Ne.toString())},[Ne]),x.useEffect(()=>{te==="focus"&&(v([]),k(null))},[te]),x.useEffect(()=>{const $=V=>{const U=/Mac|iPod|iPhone|iPad/.test(navigator.userAgent);(V.ctrlKey||V.metaKey&&!U)&&dt(!0)},z=V=>{const U=/Mac|iPod|iPhone|iPad/.test(navigator.userAgent);!V.ctrlKey&&!(V.metaKey&&!U)&&dt(!1)},L=()=>dt(!1);return window.addEventListener("keydown",$),window.addEventListener("keyup",z),window.addEventListener("blur",L),()=>{window.removeEventListener("keydown",$),window.removeEventListener("keyup",z),window.removeEventListener("blur",L)}},[]),x.useEffect(()=>{e!=null&&e.id&&localStorage.setItem(`calendar_current_date_${e.id}`,et.toISOString())},[et]),x.useEffect(()=>{if(e!=null&&e.id){const $=localStorage.getItem(`focus_split_width_${e.id}`);$&&xe(parseInt($))}},[e==null?void 0:e.id]),x.useEffect(()=>{e!=null&&e.id&&localStorage.setItem(`focus_split_width_${e.id}`,Ze.toString())},[Ze,e==null?void 0:e.id]),x.useEffect(()=>{e&&console.warn("[AppContext] Current User ID:",e.id,"Email:",e.email)},[e]);const ft=x.useMemo(()=>{const $={};return r.forEach(z=>{if(z.status==="deleted"||z.status==="logged")return;const L=z.start_date||z.due_date;if(L){const V=L.split("T")[0];$[V]=($[V]||0)+1}}),$},[r]),[de,ve]=x.useState(()=>{const $=localStorage.getItem(`expanded_tags_${e==null?void 0:e.id}`);return $?JSON.parse($):[]}),[tt,st]=x.useState([]),[ht,Xe]=x.useState([]),[At,jt]=x.useState([]),Q=x.useRef([]),[me,He]=x.useState({isDragging:!1,draggedId:null,originalDepth:0,dragOffsetX:0,dropIndex:null,dropDepth:0,indicatorTop:0,indicatorLeft:0,indicatorWidth:0,ghostPosition:{x:0,y:0},anchorTaskIndex:null}),J=x.useRef({}),Pe=x.useRef(null),ze=x.useRef(null);x.useEffect(()=>{if(!be){h("Supabase client not initialized"),d(!1);return}(async()=>{try{let L=localStorage.getItem("gtd_user_id");(!L||!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(L))&&(console.warn("Invalid or missing User ID, resetting to default."),L="00000000-0000-0000-0000-000000000000",localStorage.setItem("gtd_user_id",L));let U;if(be){const{data:{session:Y},error:he}=await be.auth.getSession();if(he)throw he;U=(Y==null?void 0:Y.user)||{id:L},n(U)}else U={id:L},n(U);if(U!=null&&U.id){const Y=localStorage.getItem(`expanded_tasks_${U.id}`);Y&&H(JSON.parse(Y));const he=localStorage.getItem(`last_view_${U.id}`);he&&$e(he);const De=localStorage.getItem(`sidebar_width_${U.id}`);De&&ue(parseInt(De));const Be=localStorage.getItem(`expanded_tags_${U.id}`);Be&&ve(JSON.parse(Be));const Qe=localStorage.getItem(`theme_settings_${U.id}`);Qe&&ie(JSON.parse(Qe))}}catch(L){console.error("Initialization error:",L),h(L.message||"Failed to initialize app"),d(!1)}})();const{data:z}=(be==null?void 0:be.auth.onAuthStateChange(async(L,V)=>{L==="SIGNED_IN"?n(V==null?void 0:V.user):L==="SIGNED_OUT"&&n(null)}))||{data:{subscription:{unsubscribe:()=>{}}}};return()=>{z.subscription.unsubscribe()}},[]),x.useEffect(()=>{Q.current=r},[r]),x.useEffect(()=>{if(!e||!be)return;(async()=>{try{if(be){let V=[],U=0;const Y=1e3;let he=!0;for(;he;){const{data:Ce,error:Le}=await be.from("tasks").select("*").eq("user_id",e.id).order("order_index",{ascending:!0}).order("created_at",{ascending:!0}).range(U,U+Y-1);if(Le){console.error("[Debug] Fetch Error:",Le);break}Ce&&Ce.length>0?(V=[...V,...Ce],Ce.length<Y?he=!1:U+=Y):he=!1}const De=V,{data:Be,error:Qe}=await be.from("tags").select("*").eq("user_id",e.id);Qe&&console.error("Tags fetch error:",Qe);const ot=(Be||[]).sort((Ce,Le)=>(Ce.order_index||0)-(Le.order_index||0));if(l(ot||[]),De){const Ce=De.map(Le=>({...Le,parent_id:Le.parent_id||null,tags:Le.tags||[],images:Le.images||[],attachments:Le.attachments||[],attachment_links:Le.attachment_links||[],view_orders:Le.view_orders||{}}));s(Ce),Q.current=Ce}const{data:_t,error:at}=await be.from("archived_tasks").select("*").eq("user_id",e.id).order("archived_at",{ascending:!1});if(at)console.warn("Failed to fetch archived tasks (table may not exist yet):",at);else if(_t){const Ce=_t.map(Le=>({...Le,parent_id:Le.parent_id||null,original_parent_id:Le.original_parent_id||null,tags:Le.tags||[],images:Le.images||[],attachments:Le.attachments||[],view_orders:Le.view_orders||{},is_all_day:!0,start_time:null,end_time:null,duration:null}));o(Ce)}const{data:wt,error:Ge}=await be.from("search_history").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(50);Ge?console.warn("Failed to fetch search history (table may not exist yet):",Ge):wt&&G(wt)}}catch(V){console.error("Error fetching data:",V)}finally{d(!1)}})();const z=be.channel("tasks_changes").on("postgres_changes",{event:"*",schema:"public",table:"tasks",filter:`user_id=eq.${e.id}`},V=>{if(!(V.new&&J.current[V.new.id]&&Date.now()-J.current[V.new.id]<2e3))if(V.eventType==="INSERT"){const U={...V.new,parent_id:V.new.parent_id||null,tags:V.new.tags||[],images:V.new.images||[],attachments:V.new.attachments||[],attachment_links:V.new.attachment_links||[],view_orders:V.new.view_orders||{}};s(Y=>{if(Y.some(De=>De.id===U.id))return Y;const he=[U,...Y].sort((De,Be)=>(De.order_index||0)-(Be.order_index||0)||De.created_at.localeCompare(Be.created_at));return Q.current=he,he})}else if(V.eventType==="UPDATE"){const U={...V.new,tags:V.new.tags||[],images:V.new.images||[],attachments:V.new.attachments||[],attachment_links:V.new.attachment_links||[],view_orders:V.new.view_orders||{}};s(Y=>{const he=Y.map(De=>De.id===U.id?U:De).sort((De,Be)=>(De.order_index||0)-(Be.order_index||0)||De.created_at.localeCompare(Be.created_at));return Q.current=he,he})}else V.eventType==="DELETE"&&s(U=>{const Y=U.filter(he=>he.id!==V.old.id);return Q.current=Y,Y})}).subscribe(),L=be.channel("tags_changes").on("postgres_changes",{event:"*",schema:"public",table:"tags",filter:`user_id=eq.${e.id}`},V=>{V.eventType==="INSERT"?l(U=>U.some(Y=>Y.id===V.new.id)?U:[...U,V.new]):V.eventType==="DELETE"&&l(U=>U.filter(Y=>Y.id!==V.old.id))}).subscribe();return()=>{z.unsubscribe(),L.unsubscribe()}},[e]);const mt=$=>{console.error($),m("error"),b({msg:`Sync Failed: ${$.message||"Unknown error"}`,type:"error"})},Wt=$=>{J.current[$]=Date.now()};x.useEffect(()=>{if(!e||!be)return;const $=async z=>{const L=z.detail;if(!L||!L.taskId||!L.file)return;const V=L.taskId,U=L.file,Y=L.markers||[],he=L.recordingId,De=Q.current.find(Be=>Be.id===V);if(!De){console.warn("[AppContext] Task not found for recording:",V),b({msg:"",type:"error"});return}try{const Be=`${Date.now()}_${ul()}.${U.name.split(".").pop()}`,ot=`${(e==null?void 0:e.id)||"anonymous"}/${Be}`,{error:_t}=await be.storage.from("attachments").upload(ot,U,{contentType:U.type,upsert:!1});if(_t){console.error("Upload voice error:",_t),b({msg:"",type:"error"});return}const{data:at}=be.storage.from("attachments").getPublicUrl(ot);if(at){const wt={name:U.name,url:at.publicUrl,size:U.size,type:U.type,markers:Y,recordingId:he},Ce=[...De.attachments||[],wt];Wt(V),s(we=>{const Me=we.map(Ve=>Ve.id===V?{...Ve,attachments:Ce}:Ve);return Q.current=Me,Me});const{error:Le}=await be.from("tasks").update({attachments:Ce}).eq("id",V);if(Le)console.error("Failed to update task attachments:",Le),b({msg:"",type:"error"});else{window.dispatchEvent(new CustomEvent("recording-saved",{detail:{taskId:V,attachment:wt}}));const we=V;b({msg:"",type:"info",onClick:()=>{window.dispatchEvent(new CustomEvent("navigate-to-task",{detail:{taskId:we,openForEdit:!0}}))},actionLabel:""})}}}catch(Be){console.error("[AppContext] Error saving recording:",Be),b({msg:"",type:"error"})}};return window.addEventListener("audio-recording-completed",$),()=>window.removeEventListener("audio-recording-completed",$)},[e]);const Dn=async $=>{const z=new Date,L=[];for(let he=1;he<=10;he++){const De=new Date(z);De.setDate(z.getDate()+he),De.setHours(0,0,0,0);const Be=r.filter(Qe=>{if(!Qe.start_date)return!1;const ot=new Date(Qe.start_date);return Ti(ot,De)&&!Qe.completed_at}).length;L.push({date:De,count:Be})}const V=Math.min(...L.map(he=>he.count)),U=L.filter(he=>he.count===V),Y=U[Math.floor(Math.random()*U.length)];await $r($,{start_date:Y.date.toISOString()}),b({msg:` ${Y.date.getMonth()+1}/${Y.date.getDate()} (: ${Y.count})`,type:"info"})},Ht=$=>{const z=[$],L=V=>{r.filter(Y=>Y.parent_id===V).forEach(Y=>{z.push(Y.id),L(Y.id)})};return L($),z},cn=async($,z)=>{if(!be)return;const L=Ht($);s(U=>{const Y=U.map(he=>he.id===$?{...he,is_locked:!0,lock_password:z}:L.includes(he.id)?{...he,is_locked:!0,lock_password:void 0}:he);return Q.current=Y,Y}),await be.from("tasks").update({is_locked:!0,lock_password:z}).eq("id",$);const V=L.filter(U=>U!==$);if(V.length>0)for(const U of V)await be.from("tasks").update({is_locked:!0,lock_password:null}).eq("id",U);b({msg:` ${L.length-1} `,type:"info"})},pe=async($,z)=>{if(!be)return!1;const L=r.find(he=>he.id===$);if(!L||!L.is_locked)return!0;let V=L,U=L;for(;U.parent_id;){const he=r.find(De=>De.id===U.parent_id);if(he&&he.is_locked&&he.lock_password&&(V=he),!he)break;U=he}if(V.lock_password!==z)return b({msg:"",type:"error"}),!1;const Y=Ht($);s(he=>{const De=he.map(Be=>Y.includes(Be.id)?{...Be,is_locked:!1,lock_password:void 0}:Be);return Q.current=De,De});for(const he of Y)await be.from("tasks").update({is_locked:!1,lock_password:null}).eq("id",he);return b({msg:"",type:"info"}),!0},q=($,z)=>{const L=r.find(Y=>Y.id===$);if(!L||!L.is_locked)return!0;let V=L,U=L;for(;U.parent_id;){const Y=r.find(he=>he.id===U.parent_id);if(Y&&Y.is_locked&&Y.lock_password&&(V=Y),!Y)break;U=Y}return V.lock_password===z},ye=async()=>{const $=r.filter(V=>!!V.completed_at&&V.status!=="logged"&&V.status!=="deleted");if($.length===0)return;const z=$.map(V=>V.id),L=$.map(V=>({...V,status:"logged",original_parent_id:V.parent_id,archived_at:new Date().toISOString()}));if(s(V=>{const U=V.filter(Y=>!z.includes(Y.id));return Q.current=U,U}),o(V=>[...V,...L]),be){const{error:V}=await be.from("archived_tasks").insert(L.map(Y=>({id:Y.id,user_id:Y.user_id,title:Y.title,description:Y.description,status:Y.status,original_parent_id:Y.original_parent_id,parent_id:Y.parent_id,is_project:Y.is_project,order_index:Y.order_index,view_orders:Y.view_orders,tags:Y.tags,color:Y.color,start_date:Y.start_date,due_date:Y.due_date,completed_at:Y.completed_at,reviewed_at:Y.reviewed_at,images:Y.images,attachments:Y.attachments,created_at:Y.created_at,archived_at:Y.archived_at})));if(V){mt(V);return}const{error:U}=await be.from("tasks").delete().in("id",z);U&&mt(U)}Zt({type:"ARCHIVE",payload:{originalTasks:$,archivedRecords:L}}),b({msg:` ${z.length} `,type:"info",undo:nn})},Re=async $=>{const z=i.find(U=>U.id===$);if(!z)return;let L=z.original_parent_id;L&&(r.find(Y=>Y.id===L)||(L=null));const V={id:z.id,user_id:z.user_id,title:z.title,description:z.description,status:"completed",parent_id:L,is_project:z.is_project,order_index:z.order_index,view_orders:z.view_orders,tags:z.tags,color:z.color,start_date:z.start_date,due_date:z.due_date,completed_at:z.completed_at,reviewed_at:z.reviewed_at,images:z.images,attachments:z.attachments,created_at:z.created_at,is_all_day:!0,start_time:null,end_time:null,duration:null};if(o(U=>U.filter(Y=>Y.id!==$)),s(U=>{const Y=[...U,V];return Q.current=Y,Y}),be){const{error:U}=await be.from("tasks").insert({id:V.id,user_id:V.user_id,title:V.title,description:V.description,status:V.status,parent_id:V.parent_id,is_project:V.is_project,order_index:V.order_index,view_orders:V.view_orders,tags:V.tags,color:V.color,start_date:V.start_date,due_date:V.due_date,completed_at:V.completed_at,reviewed_at:V.reviewed_at,images:V.images,created_at:V.created_at});if(U){mt(U);return}const{error:Y}=await be.from("archived_tasks").delete().eq("id",$);Y&&mt(Y)}b({msg:"",type:"info"})},_e=async $=>{if(i.find(L=>L.id===$)){if(o(L=>L.filter(V=>V.id!==$)),be){const{error:L}=await be.from("archived_tasks").delete().eq("id",$);L&&mt(L)}b({msg:"",type:"info"})}},it=async($,z)=>{const L=i.find(U=>U.id===$);if(!L)return;const V={...L,...z};if(o(U=>U.map(Y=>Y.id===$?V:Y)),be){const{error:U}=await be.from("archived_tasks").update(z).eq("id",$);U&&mt(U)}},Fe=async $=>{if($.length!==0){if(o(z=>z.filter(L=>!$.includes(L.id))),be){const{error:z}=await be.from("archived_tasks").delete().in("id",$);z&&mt(z)}b({msg:` ${$.length} `,type:"info"})}},gt=async($,z,L)=>{if(!be||!e)return;const V={id:ul(),user_id:e.id,query:$,filters:z,name:L||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};G(Y=>[V,...Y].slice(0,50));const{error:U}=await be.from("search_history").insert({id:V.id,user_id:V.user_id,query:V.query,filters:V.filters,name:V.name,created_at:V.created_at,updated_at:V.updated_at});U&&console.warn("Failed to save search history:",U)},Pt=async $=>{if(!be)return;G(L=>L.filter(V=>V.id!==$));const{error:z}=await be.from("search_history").delete().eq("id",$);z&&console.warn("Failed to delete search history:",z)},Ft=async()=>{Ut(),m("syncing");const $=[...r];if(s([]),Q.current=[],st([]),Xe([]),be){const{error:z}=await be.from("tasks").delete().neq("id","00000000-0000-0000-0000-000000000000");if(z){mt(z),s($);return}}m("synced"),b({msg:"",type:"info"})},Ut=()=>{const $={tasks:r,tags:a,user_id:e.id,version:1,exported_at:new Date().toISOString()},z=new Blob([JSON.stringify($,null,2)],{type:"application/json"}),L=URL.createObjectURL(z),V=document.createElement("a");V.href=L,V.download=`things-clone-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(V),V.click(),document.body.removeChild(V),URL.revokeObjectURL(L),b({msg:"",type:"info"})},Kt=async $=>{if(!be)return;const z=new FileReader;z.onload=async L=>{var V;try{const U=(V=L.target)==null?void 0:V.result,Y=JSON.parse(U);if(!Y.tasks||!Y.tags)throw new Error("");if(m("syncing"),Y.tags.length>0){const{error:he}=await be.from("tags").upsert(Y.tags.map(De=>({...De,user_id:e.id})));if(he)throw he}if(Y.tasks.length>0){const{error:he}=await be.from("tasks").upsert(Y.tasks.map(De=>({...De,user_id:e.id})));if(he)throw he}b({msg:"...",type:"info"}),setTimeout(()=>window.location.reload(),1e3)}catch(U){mt(U)}},z.readAsText($)},Zt=$=>{st(z=>[...z,$]),Xe([])},nn=async()=>{if(tt.length===0)return;const $=tt[tt.length-1];if(st(tt.slice(0,-1)),Xe(z=>[...z,$]),$.type==="ADD"){const z=$.payload.data.id;Wt(z),s(L=>L.filter(V=>V.id!==z)),be&&await be.from("tasks").delete().eq("id",z)}else if($.type==="DELETE"){const z=$.payload.data;Wt(z.id),s(L=>[...L,z].sort((V,U)=>(V.order_index||0)-(U.order_index||0)||V.created_at.localeCompare(U.created_at))),be&&await be.from("tasks").insert([z])}else if($.type==="UPDATE"){const{id:z,before:L}=$.payload;await $r(z,L,[],{skipHistory:!0})}else if($.type==="BATCH_UPDATE"){const L=$.payload.map(V=>({id:V.id,data:V.before}));await qn(L,{skipHistory:!0})}else if($.type==="ADD_TAG"){const z=$.payload.data.id;l(L=>L.filter(V=>V.id!==z)),be&&await be.from("tags").delete().eq("id",z)}else if($.type==="DELETE_TAG"){const z=$.payload.data;l(L=>[...L,z].sort((V,U)=>(V.order_index||0)-(U.order_index||0))),be&&await be.from("tags").insert([z])}else if($.type==="UPDATE_TAG"){const{id:z,before:L}=$.payload;l(V=>V.map(U=>U.id===z?{...U,...L}:U).sort((U,Y)=>(U.order_index||0)-(Y.order_index||0))),be&&await be.from("tags").update(L).eq("id",z)}else if($.type==="ARCHIVE"){const{originalTasks:z,archivedRecords:L}=$.payload,V=L.map(U=>U.id);o(U=>U.filter(Y=>!V.includes(Y.id))),s(U=>{const Y=[...U,...z].sort((he,De)=>(he.order_index||0)-(De.order_index||0)||he.created_at.localeCompare(De.created_at));return Q.current=Y,Y}),be&&(await be.from("archived_tasks").delete().in("id",V),await be.from("tasks").insert(z))}else if($.type==="BATCH_DELETE"){const z=$.payload.data;s(L=>[...L,...z].sort((V,U)=>(V.order_index||0)-(U.order_index||0)||V.created_at.localeCompare(U.created_at))),be&&await be.from("tasks").insert(z)}b({msg:"",type:"info"})},rn=async()=>{if(ht.length===0)return;const $=ht[ht.length-1];if(Xe(ht.slice(0,-1)),st(z=>[...z,$]),$.type==="ADD"){const z=$.payload.data;Wt(z.id),s(L=>[...L,z].sort((V,U)=>(V.order_index||0)-(U.order_index||0)||V.created_at.localeCompare(U.created_at))),be&&await be.from("tasks").insert([z])}else if($.type==="DELETE"){const z=$.payload.data.id;Wt(z),s(L=>L.filter(V=>V.id!==z)),be&&await be.from("tasks").delete().eq("id",z)}else if($.type==="UPDATE"){const{id:z,after:L}=$.payload;await $r(z,L,[],{skipHistory:!0})}else if($.type==="BATCH_UPDATE"){const L=$.payload.map(V=>({id:V.id,data:V.after}));await qn(L,{skipHistory:!0})}else if($.type==="ADD_TAG"){const z=$.payload.data;l(L=>[...L,z].sort((V,U)=>(V.order_index||0)-(U.order_index||0))),be&&await be.from("tags").insert([z])}else if($.type==="DELETE_TAG"){const z=$.payload.data.id;l(L=>L.filter(V=>V.id!==z)),be&&await be.from("tags").delete().eq("id",z)}else if($.type==="UPDATE_TAG"){const{id:z,after:L}=$.payload;l(V=>V.map(U=>U.id===z?{...U,...L}:U).sort((U,Y)=>(U.order_index||0)-(Y.order_index||0))),be&&await be.from("tags").update(L).eq("id",z)}else if($.type==="ARCHIVE"){const{originalTasks:z,archivedRecords:L}=$.payload,V=z.map(U=>U.id);s(U=>{const Y=U.filter(he=>!V.includes(he.id));return Q.current=Y,Y}),o(U=>[...U,...L]),be&&(await be.from("archived_tasks").insert(L.map(U=>({id:U.id,user_id:U.user_id,title:U.title,description:U.description,status:U.status,original_parent_id:U.original_parent_id,parent_id:U.parent_id,is_project:U.is_project,order_index:U.order_index,view_orders:U.view_orders,tags:U.tags,color:U.color,start_date:U.start_date,due_date:U.due_date,completed_at:U.completed_at,reviewed_at:U.reviewed_at,images:U.images,attachments:U.attachments,created_at:U.created_at,archived_at:U.archived_at}))),await be.from("tasks").delete().in("id",V))}else if($.type==="BATCH_DELETE"){const L=$.payload.data.map(V=>V.id);s(V=>V.filter(U=>!L.includes(U.id))),be&&await be.from("tasks").delete().in("id",L)}b({msg:"",type:"info"})},vn=async()=>{if(!be)return;const{error:$}=await be.auth.signOut();$?mt($):b({msg:"",type:"info"})};x.useEffect(()=>{const $=z=>{C||(z.metaKey||z.ctrlKey)&&z.key==="z"&&(z.preventDefault(),z.shiftKey?rn():nn())};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)},[tt,ht,r,C]);const Gn=($,z=!1,L)=>{const V=r.find(wt=>wt.id===$);if(!V)return;const U=wt=>a.find(Ge=>wt.some(Ce=>Ge.name.trim().toLowerCase()===Ce.toLowerCase())),Y=U(["note","journal","",""]),he=U(["prompt",""]),De=Y,Be=U(["someday","inspiration","","/"]),Qe=U(["project",""]),ot=U(["schedule",""]);let _t=L||"inbox";L||(Y&&V.tags.includes(Y.id)?_t="journal":he&&V.tags.includes(he.id)?_t="prompt":De&&V.tags.includes(De.id)?_t="journal":Be&&V.tags.includes(Be.id)?_t="waiting":Qe&&V.tags.includes(Qe.id)?r.some(Ge=>Ge.parent_id===$&&Ge.status!=="deleted")&&(_t="projects"):ot&&V.tags.includes(ot.id)?_t="focus":(V.start_date||V.due_date)&&(_t="today")),jt(wt=>[...wt,{view:te,focusedId:D,editingId:C,searchOpen:R}]),$e(_t),k($);let at=r.find(wt=>wt.id===$);for(;at&&at.parent_id;)P.includes(at.parent_id)||dn(at.parent_id,!0),at=r.find(wt=>wt.id===(at==null?void 0:at.parent_id));z&&setTimeout(()=>T($),100)},Gr=()=>{if(At.length===0)return;const $=At[At.length-1];jt(L=>L.slice(0,-1)),$e($.view),k($.focusedId);const z=$.editingId||$.focusedId;z&&setTimeout(()=>T(z),150),$.searchOpen!==void 0&&Ee($.searchOpen)};x.useEffect(()=>{const $=z=>{const L=z.detail;L!=null&&L.taskId&&Gn(L.taskId,L.openForEdit||!1)};return window.addEventListener("navigate-to-task",$),()=>window.removeEventListener("navigate-to-task",$)},[r,a,te,D,P]);const ls=x.useCallback(($,z,L,V,U,Y)=>{var Tt;if(ee.showImportedGoogleEvents===!1){const qe=a.filter(re=>re.name.startsWith("Google:")).map(re=>re.id);qe.length>0&&($=$.filter(re=>!re.tags.some(Ae=>qe.includes(Ae))))}const he=qe=>{var re;return(re=a.find(Ae=>qe.some(nt=>Ae.name.trim().toLowerCase()===nt.toLowerCase())))==null?void 0:re.id},De=he(["prompt",""]),Be=he(["journal","note","",""]),Qe=he(["someday","inspiration","","/"]),ot=he(["project",""]),_t=(Tt=a.find(qe=>qe.name==="#prompt"))==null?void 0:Tt.id,at=he(["schedule",""]),wt=he(["annual","annualplan","",""]);if(z==="schedule")return $.filter(qe=>(!!qe.due_date||!!qe.start_date)&&qe.status!=="deleted"&&qe.status!=="logged").sort((qe,re)=>{const Ae=new Date(qe.start_date||qe.due_date||0).getTime(),nt=new Date(re.start_date||re.due_date||0).getTime();return Ae-nt}).map((qe,re)=>({data:qe,depth:0,hasChildren:!1,isExpanded:!1,path:[],index:re}));if(z==="recent")return $.filter(qe=>qe.status!=="deleted").sort((qe,re)=>{const Ae=new Date(qe.updated_at||qe.created_at||0).getTime();return new Date(re.updated_at||re.created_at||0).getTime()-Ae}).slice(0,100).map((qe,re)=>({data:qe,depth:0,hasChildren:!1,isExpanded:!1,path:[],index:re}));const Ce=(()=>{if(L){const qe=Ae=>{const nt=a.filter(rt=>rt.parent_id===Ae);return[Ae,...nt.flatMap(rt=>qe(rt.id))]},re=qe(L);return Ae=>{if(!F6(Ae,re))return!1;const nt=Y[L]||{include:[],exclude:[]},{include:rt,exclude:kt}=Array.isArray(nt)?{include:nt,exclude:[]}:nt;return rt.length>0&&!Ae.tags.some($t=>rt.includes($t))||kt.length>0&&Ae.tags.some($t=>kt.includes($t))||U.additionalTags.length>0&&!U.additionalTags.every($t=>{var zt;return(zt=Ae.tags)==null?void 0:zt.includes($t)})||U.color&&Ae.color!==U.color||U.startDate&&(!Ae.start_date||new Date(Ae.start_date)<new Date(U.startDate))||U.dueDate&&(!Ae.due_date||new Date(Ae.due_date)>new Date(U.dueDate))?!1:Ae.status!=="deleted"&&Ae.status!=="logged"}}switch(z){case"inbox":return $.filter(re=>re.status==="inbox").forEach(re=>{re.parent_id&&console.log(`[Inbox Debug] Hidden task "${re.title}": has parent_id ${re.parent_id}`)}),re=>{if(re.parent_id||re.status==="deleted"||re.status==="logged")return!1;const Ae=!!re.completed_at,nt=!re.start_date&&!re.due_date&&(!re.tags||re.tags.length===0),rt=re.status==="inbox";if(nt){const Yt=Y.inbox||{include:[],exclude:[]};return!((Array.isArray(Yt)?Yt:Yt.include||[]).length>0)}if(!rt&&!Ae||!Ae&&(re.start_date||re.due_date)||!Ae&&(at&&re.tags.includes(at)||re.tags.some(Yt=>{const ln=a.find(gn=>gn.id===Yt);return ln&&["schedule",""].includes(ln.name.trim().toLowerCase())}))||!Ae&&(ot&&re.tags.includes(ot)||wt&&re.tags.includes(wt)||Qe&&re.tags.includes(Qe)||Be&&re.tags.includes(Be)||De&&re.tags.includes(De)||_t&&re.tags.includes(_t)))return!1;const kt=Y.inbox||{include:[],exclude:[]},{include:$t,exclude:zt}=Array.isArray(kt)?{include:kt,exclude:[]}:kt;return!($t.length>0&&!re.tags.some(Yt=>$t.includes(Yt))||zt.length>0&&re.tags.some(Yt=>zt.includes(Yt)))};case"allview":return re=>{if(re.parent_id||re.status==="deleted"||at&&re.tags.includes(at))return!1;const Ae=Y.allview||{include:[],exclude:[]},{include:nt,exclude:rt}=Array.isArray(Ae)?{include:Ae,exclude:[]}:Ae;return!(nt.length>0&&!re.tags.some(kt=>nt.includes(kt))||rt.length>0&&re.tags.some(kt=>rt.includes(kt)))};case"newtable":return re=>{if(re.parent_id||re.status==="deleted"||re.status==="logged"||De&&re.tags.includes(De)||Be&&re.tags.includes(Be)||Qe&&re.tags.includes(Qe)||!re.start_date&&!re.due_date)return!1;const Ae=new Date;Ae.setHours(23,59,59,999);const nt=re.start_date?new Date(re.start_date):re.due_date?new Date(re.due_date):null;return!(!nt||nt>Ae)};case"focus":return re=>!(re.status==="deleted"||re.status==="logged"||re.start_date||re.due_date||De&&re.tags.includes(De)||Be&&re.tags.includes(Be)||Qe&&re.tags.includes(Qe)||re.status==="waiting"||$.some(nt=>nt.parent_id===re.id&&nt.status!=="deleted"&&nt.status!=="logged"));case"today":return re=>{if(re.status==="logged"||re.status==="deleted"||re.status==="waiting"||re.status==="someday"||at&&re.tags.includes(at)||re.tags.some(zt=>{const Yt=a.find(ln=>ln.id===zt);return Yt&&["schedule",""].includes(Yt.name.trim().toLowerCase())}))return!1;const Ae=Y.today||{include:[],exclude:[]},{include:nt,exclude:rt}=Array.isArray(Ae)?{include:Ae,exclude:[]}:Ae;if(nt.length>0&&!re.tags.some(zt=>nt.includes(zt))||rt.length>0&&re.tags.some(zt=>rt.includes(zt)))return!1;const kt=["note","project"],$t=a.filter(zt=>kt.includes(zt.name.trim().toLowerCase())).map(zt=>zt.id);return!(re.tags&&re.tags.some(zt=>$t.includes(zt))||!re.start_date&&!re.due_date)};case"waiting":return re=>{const Ae=Y.waiting||{include:[],exclude:[]},{include:nt,exclude:rt}=Array.isArray(Ae)?{include:Ae,exclude:[]}:Ae;if(nt.length>0&&!re.tags.some(Yt=>nt.includes(Yt))||rt.length>0&&re.tags.some(Yt=>rt.includes(Yt))||re.status==="deleted"||re.status==="logged")return!1;const kt=re.status==="waiting",$t=re.status==="someday",zt=re.tags.some(Yt=>{const ln=a.find(yn=>yn.id===Yt);return ln?ln.name.trim().toLowerCase()==="someday":!1});return kt||$t||zt};case"journal":return re=>{if(!Be)return!1;const Ae=Y.journal||{include:[],exclude:[]},{include:nt,exclude:rt}=Array.isArray(Ae)?{include:Ae,exclude:[]}:Ae;return nt.length>0&&!re.tags.some(kt=>nt.includes(kt))||rt.length>0&&re.tags.some(kt=>rt.includes(kt))?!1:re.status!=="deleted"&&re.status!=="logged"&&re.tags.includes(Be)};case"prompt":return re=>{const Ae=a.find($t=>$t.name.trim().toLowerCase()==="prompt");if(!Ae)return!1;const nt=Y.prompt||{include:[],exclude:[]},{include:rt,exclude:kt}=Array.isArray(nt)?{include:nt,exclude:[]}:nt;return rt.length>0&&!re.tags.some($t=>rt.includes($t))||kt.length>0&&re.tags.some($t=>kt.includes($t))?!1:re.status!=="deleted"&&re.status!=="logged"&&re.tags.includes(Ae.id)};case"log":case"logbook":return re=>{if(re.status!=="logged")return!1;const Ae=Y.logbook||Y.log||{include:[],exclude:[]},{include:nt,exclude:rt}=Array.isArray(Ae)?{include:Ae,exclude:[]}:Ae;return!(nt.length>0&&!re.tags.some(kt=>nt.includes(kt))||rt.length>0&&re.tags.some(kt=>rt.includes(kt)))};case"recent":return re=>{if(re.status==="deleted")return!1;const Ae=Y.recent||{include:[],exclude:[]},{include:nt,exclude:rt}=Array.isArray(Ae)?{include:Ae,exclude:[]}:Ae;return!(nt.length>0&&!re.tags.some(kt=>nt.includes(kt))||rt.length>0&&re.tags.some(kt=>rt.includes(kt)))};case"trash":return re=>{if(re.status!=="deleted")return!1;const Ae=Y.trash||{include:[],exclude:[]},{include:nt,exclude:rt}=Array.isArray(Ae)?{include:Ae,exclude:[]}:Ae;return!(nt.length>0&&!re.tags.some(kt=>nt.includes(kt))||rt.length>0&&re.tags.some(kt=>rt.includes(kt)))};default:return re=>{if(re.status==="deleted"||re.status==="logged"||at&&re.tags.includes(at)||re.tags.some($t=>{const zt=a.find(Yt=>Yt.id===$t);return zt&&["schedule",""].includes(zt.name.trim().toLowerCase())}))return!1;const nt=Y[z]||{include:[],exclude:[]},{include:rt,exclude:kt}=Array.isArray(nt)?{include:nt,exclude:[]}:nt;return!(rt.length>0&&!re.tags.some($t=>rt.includes($t))||kt.length>0&&re.tags.some($t=>kt.includes($t)))}}})(),Le=z==="allview"||z==="project"?"inbox":z,we=qe=>qe.view_orders&&qe.view_orders[Le]!==void 0?qe.view_orders[Le]:qe.order_index||0;if(z==="focus"||z==="today"){const qe=nt=>{const rt=nt.start_date||nt.due_date;if(rt){const $t=new Date(rt);return`${$t.getFullYear()}-${String($t.getMonth()+1).padStart(2,"0")}-${String($t.getDate()).padStart(2,"0")}`}const kt=new Date;return`${kt.getFullYear()}-${String(kt.getMonth()+1).padStart(2,"0")}-${String(kt.getDate()).padStart(2,"0")}`},re=nt=>nt.view_orders&&nt.view_orders.today!==void 0?nt.view_orders.today:9e8+new Date(nt.created_at).getTime()/1e3;return $.filter(Ce).sort((nt,rt)=>{if(z==="today"){const kt=qe(nt),$t=qe(rt);return kt!==$t?kt.localeCompare($t):re(nt)-re(rt)}return we(nt)-we(rt)||nt.created_at.localeCompare(rt.created_at)}).map((nt,rt)=>({data:nt,depth:0,hasChildren:!1,isExpanded:!1,path:[nt.id],index:rt}))}const Me=$.filter(qe=>{if(!Ce(qe))return!1;const re=qe.parent_id||null;if(!re)return!0;const Ae=$.find(nt=>nt.id===re);return!Ae||!Ce(Ae)}).sort((qe,re)=>we(qe)-we(re)||qe.created_at.localeCompare(re.created_at)),Ve=new Set;let Ct=0;const bt=(qe,re=0,Ae=[])=>{let nt=[];return qe.forEach(rt=>{if(Ve.has(rt.id))return;Ve.add(rt.id);const kt=$.filter(ln=>ln.parent_id===rt.id&&ln.status!=="logged"&&ln.status!=="deleted").sort((ln,gn)=>we(ln)-we(gn)||ln.created_at.localeCompare(gn.created_at)),$t=kt.length>0,zt=V.includes(rt.id),Yt=[...Ae,rt.id];nt.push({data:rt,depth:re,hasChildren:$t,isExpanded:zt,path:Yt,index:Ct++}),$t&&zt&&(nt=[...nt,...bt(kt,re+1,Yt)])}),nt};return bt(Me)},[a,ee.showImportedGoogleEvents]),xn=x.useMemo(()=>ls(r,te,Te,P,St,M),[r,te,Te,P,St,M,ls,a]);x.useEffect(()=>{if(te!=="today"||!be)return;let $=xn.filter(he=>{var Be;return((Be=he.data.view_orders)==null?void 0:Be.today)===void 0});const z=new Map;xn.forEach(he=>{var Be;const De=(Be=he.data.view_orders)==null?void 0:Be.today;if(De!==void 0){const Qe=z.get(De)||[];Qe.push(he.data.id),z.set(De,Qe)}});const L=new Set;if(z.forEach(he=>{if(he.length>1)for(let De=1;De<he.length;De++)L.add(he[De])}),L.size>0){const he=xn.filter(De=>L.has(De.data.id));console.warn("[Today] Found duplicate orders, re-assigning:",he.map(De=>De.data.title)),$=[...$,...he]}if($.length===0)return;let V=0;xn.forEach(he=>{var Be;const De=(Be=he.data.view_orders)==null?void 0:Be.today;De!==void 0&&De>V&&(V=De)});const Y=[...$].sort((he,De)=>he.data.created_at.localeCompare(De.data.created_at)).map((he,De)=>({id:he.data.id,view_orders:{...he.data.view_orders||{},today:V+1e4*(De+1)}}));s(he=>{const De=he.map(Be=>{const Qe=Y.find(ot=>ot.id===Be.id);return Qe?{...Be,view_orders:Qe.view_orders}:Be});return Q.current=De,De}),Y.forEach(async({id:he,view_orders:De})=>{be&&await be.from("tasks").update({view_orders:De}).eq("id",he)})},[te,xn,be]),x.useEffect(()=>{if(te!=="waiting"||!be)return;let $=xn.filter(U=>{var he;return((he=U.data.view_orders)==null?void 0:he.waiting)===void 0});if($.length===0)return;let z=0;xn.forEach(U=>{var he;const Y=(he=U.data.view_orders)==null?void 0:he.waiting;Y!==void 0&&Y>z&&(z=Y)});const V=[...$].sort((U,Y)=>U.data.created_at.localeCompare(Y.data.created_at)).map((U,Y)=>({id:U.data.id,view_orders:{...U.data.view_orders||{},waiting:z+1e4*(Y+1)}}));s(U=>{const Y=U.map(he=>{const De=V.find(Be=>Be.id===he.id);return De?{...he,view_orders:De.view_orders}:he});return Q.current=Y,Y}),V.forEach(async({id:U,view_orders:Y})=>{be&&await be.from("tasks").update({view_orders:Y}).eq("id",U)})},[te,xn,be]);const di=($,z)=>{k(z);const L=$.shiftKey||$.shiftKey,V=$.ctrlKey||$.metaKey;if(L){const U=w||D||z;_(U);const Y=xn.findIndex(De=>De.data.id===U),he=xn.findIndex(De=>De.data.id===z);if(Y!==-1&&he!==-1){const[De,Be]=Y<he?[Y,he]:[he,Y],Qe=xn.slice(De,Be+1).map(ot=>ot.data.id);v(Qe)}}else V?(_(z),v(U=>U.includes(z)?U.filter(Y=>Y!==z):[...U,z])):(_(z),v([z]))},no=x.useCallback(($,z)=>{const L=document.getElementById("drag-ghost");L&&(L.style.left=`${$}px`,L.style.top=`${z}px`)},[]);x.useEffect(()=>{ze.current=document.querySelector("main")},[]);const cs=($,z)=>{if(te==="schedule"){$.preventDefault();return}const L=g.includes(z.data.id)?g:[z.data.id];g.includes(z.data.id)||v([z.data.id]),$.dataTransfer.setData("text/plain",z.data.id),$.dataTransfer.setData("application/json",JSON.stringify(L)),$.dataTransfer.effectAllowed="move",$.dataTransfer.setDragImage(SI,0,0);const V=$.currentTarget.getBoundingClientRect(),U=$.clientX-V.left;He(Y=>({...Y,isDragging:!0,draggedId:z.data.id,originalDepth:z.depth,dragOffsetX:U,ghostPosition:{x:$.clientX,y:$.clientY}}))},sl=$=>{He(z=>({...z,...$}))},il=async $=>{Pe.current&&(clearInterval(Pe.current),Pe.current=null);const{draggedId:z,dropIndex:L,dropDepth:V}=me;if(He(we=>({...we,isDragging:!1,draggedId:null,dropIndex:null})),!z||L===null)return;const U=$||xn,Y=te==="allview"||te==="project"?"inbox":te,he=g.includes(z)?g:[z],De=we=>Y==="today"?9e8+new Date(we.created_at).getTime()/1e3:we.order_index||0,Be=r.filter(we=>he.includes(we.id)).sort((we,Me)=>{var bt,Tt;const Ve=((bt=we.view_orders)==null?void 0:bt[Y])!==void 0?we.view_orders[Y]:De(we),Ct=((Tt=Me.view_orders)==null?void 0:Tt[Y])!==void 0?Me.view_orders[Y]:De(Me);return Ve-Ct});let Qe=null;if(te!=="today"&&L>0){const we=U[L-1];if(V>we.depth)Qe=we.data.id,dn(Qe,!0);else if(V===we.depth)Qe=we.data.parent_id;else{let Me=L-1;for(;Me>=0;){if(U[Me].depth===V-1){Qe=U[Me].data.id;break}if(U[Me].depth<V-1)break;Me--}if(V===0){const Ve=U.find(Ct=>Ct.depth===0&&!he.includes(Ct.data.id));Qe=Ve?Ve.data.parent_id:null}}}else Qe=null;for(const we of Be){if(Qe&&Ew(we.id,Qe,r)){b({msg:"",type:"error"});return}if(Qe){const Me=r.find(Ve=>Ve.id===Qe);if(Me&&!Me.is_project&&we.is_project){b({msg:"",type:"error"});return}}}let ot=-1e4,_t=9999999999;const at=we=>we.view_orders&&we.view_orders[Y]!==void 0?we.view_orders[Y]:Y==="today"?9e8+new Date(we.created_at).getTime()/1e3:we.order_index||0;let wt=null;if(te==="today"){const we=re=>re.start_date?new Date(re.start_date).toISOString().split("T")[0]:re.due_date?new Date(re.due_date).toISOString().split("T")[0]:null;let Me=null;for(let re=L-1;re>=0&&!(!he.includes(U[re].data.id)&&(Me=we(U[re].data),Me));re--);let Ve=null;for(let re=L;re<U.length&&!(!he.includes(U[re].data.id)&&(Ve=we(U[re].data),Ve));re++);const Ct=me.anchorTaskIndex;if(Ct!==null&&Ct>=0&&Ct<U.length){const re=U[Ct].data;he.includes(re.id)||(wt=we(re))}wt||(wt=Me||Ve),wt||(wt=new Date().toISOString().split("T")[0]);const bt=U.map((re,Ae)=>({...re,originalIndex:Ae})).filter(re=>!he.includes(re.data.id)&&we(re.data)===wt),Tt=bt.filter(re=>re.originalIndex<L),qe=bt.filter(re=>re.originalIndex>=L);if(Tt.length>0){const re=Tt[Tt.length-1];ot=at(re.data)}if(qe.length>0){const re=qe[0];_t=at(re.data)}}else{for(let we=L-1;we>=0;we--){const Me=U[we];if(!he.includes(Me.data.id)){if(Me.depth===V){ot=at(Me.data);break}else if(Me.depth<V)break}}for(let we=L;we<U.length;we++){const Me=U[we];if(!he.includes(Me.data.id)){if(Me.depth===V){_t=at(Me.data);break}else if(Me.depth<V)break}}}ot===-1e4&&_t===9999999999?(ot=0,_t=2e4):ot===-1e4?ot=_t-2e4:_t===9999999999&&(_t=ot+2e4);const Ge=Be.length,Ce=(_t-ot)/(Ge+1),Le=Be.map((we,Me)=>{const Ve=ot+Ce*(Me+1),Ct={...we.view_orders||{},[Y]:Ve},bt={id:we.id,view_orders:Ct};return te!=="today"&&(bt.parent_id=Qe),te==="today"&&wt&&(bt.start_date=wt,bt.is_all_day=!0),bt});ks(Le)},jo=async($,z)=>{const L=Q.current,V=L.find(Qe=>Qe.id===$);if(!V)return;Wt($);const U=te==="allview"||te==="project"?"inbox":te,Y=Qe=>Qe.view_orders&&Qe.view_orders[U]!==void 0?Qe.view_orders[U]:U==="today"?9e8+new Date(Qe.created_at).getTime()/1e3:Qe.order_index||0,De=g.includes($)?te==="today"?g:g.filter(Qe=>{const ot=L.find(_t=>_t.id===Qe);return ot&&(ot.parent_id||null)===(V.parent_id||null)}):[$],Be=L.filter(Qe=>De.includes(Qe.id)).sort((Qe,ot)=>Y(Qe)-Y(ot));if(z==="up"||z==="down"){const Qe=te==="today";let ot=[];if(te==="project")ot=L.filter(Ge=>(Ge.parent_id||null)===(V.parent_id||null)&&Ge.status!=="deleted"&&Ge.status!=="logged").sort((Ge,Ce)=>Y(Ge)-Y(Ce));else if(Qe){const Ge=we=>we.start_date?new Date(we.start_date).toISOString().split("T")[0]:we.due_date?new Date(we.due_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],Ce=Ge(V),Le=new Set(xn.map(we=>we.data.id));Le.add(V.id),ot=L.filter(we=>Le.has(we.id)&&Ge(we)===Ce).sort((we,Me)=>Y(we)-Y(Me))}else ot=xn.filter(Ge=>(Ge.data.parent_id||null)===(V.parent_id||null)).map(Ge=>Ge.data);const _t=Be.map(Ge=>ot.findIndex(Ce=>Ce.id===Ge.id)).filter(Ge=>Ge!==-1);if(_t.length===0)return;const at=Math.min(..._t),wt=Math.max(..._t);if(z==="up"){if(at===0){if(Qe){const Ve=qe=>{const re=qe.start_date||qe.due_date;if(re){const nt=new Date(re);return`${nt.getFullYear()}-${String(nt.getMonth()+1).padStart(2,"0")}-${String(nt.getDate()).padStart(2,"0")}`}const Ae=new Date;return`${Ae.getFullYear()}-${String(Ae.getMonth()+1).padStart(2,"0")}-${String(Ae.getDate()).padStart(2,"0")}`},Ct=Ve(V),bt=Array.from(new Set(xn.map(qe=>Ve(qe.data)))).sort(),Tt=bt.indexOf(Ct);if(Tt>0){const qe=bt[Tt-1],re=xn.filter(rt=>Ve(rt.data)===qe).map(rt=>rt.data).sort((rt,kt)=>Y(rt)-Y(kt));let Ae;re.length>0?Ae=Y(re[re.length-1])+1e4:Ae=0;const nt=Be.map((rt,kt)=>({id:rt.id,start_date:qe,view_orders:{...rt.view_orders||{},[U]:Ae+1e4*kt}}));ks(nt);return}}return}const Ge=at-1,Ce=at-2,Le=Y(ot[Ge]),we=Ce>=0?Y(ot[Ce]):Le-2e4;if(Le-we<.1){console.log("[Task Reorder] Gap too small, rebalancing list...");const Ve=new Set(Be.map(Ae=>Ae.id)),Ct=ot.filter(Ae=>!Ve.has(Ae.id)),bt=ot[Ge];let Tt=Ct.findIndex(Ae=>Ae.id===bt.id);Tt===-1&&(Tt=0);const qe=[...Ct];qe.splice(Tt,0,...Be);const re=qe.map((Ae,nt)=>({id:Ae.id,view_orders:{...Ae.view_orders||{},[U]:1e4*(nt+1)}}));ks(re)}else{const Ve=(Le-we)/(Be.length+1),Ct=Be.map((bt,Tt)=>({id:bt.id,view_orders:{...bt.view_orders||{},[U]:we+Ve*(Tt+1)}}));ks(Ct)}}else{if(wt===ot.length-1){if(Qe){const Ve=qe=>{const re=qe.start_date||qe.due_date;if(re){const nt=new Date(re);return`${nt.getFullYear()}-${String(nt.getMonth()+1).padStart(2,"0")}-${String(nt.getDate()).padStart(2,"0")}`}const Ae=new Date;return`${Ae.getFullYear()}-${String(Ae.getMonth()+1).padStart(2,"0")}-${String(Ae.getDate()).padStart(2,"0")}`},Ct=Ve(V),bt=Array.from(new Set(xn.map(qe=>Ve(qe.data)))).sort(),Tt=bt.indexOf(Ct);if(Tt<bt.length-1){const qe=bt[Tt+1],re=xn.filter(rt=>Ve(rt.data)===qe).map(rt=>rt.data).sort((rt,kt)=>Y(rt)-Y(kt));let Ae;re.length>0?Ae=Y(re[0])-1e4*Be.length:Ae=0;const nt=Be.map((rt,kt)=>({id:rt.id,start_date:qe,view_orders:{...rt.view_orders||{},[U]:Ae+1e4*kt}}));ks(nt);return}}return}const Ge=wt+1,Ce=wt+2,Le=Y(ot[Ge]),we=Ce<ot.length?Y(ot[Ce]):Le+2e4;if(we-Le<.1){console.log("[Task Reorder] Gap too small (down), rebalancing list...");const Ve=new Set(Be.map(Ae=>Ae.id)),Ct=ot.filter(Ae=>!Ve.has(Ae.id)),bt=ot[Ge];let Tt=Ct.findIndex(Ae=>Ae.id===bt.id);Tt===-1&&(Tt=Ct.length);const qe=[...Ct];qe.splice(Tt+1,0,...Be);const re=qe.map((Ae,nt)=>({id:Ae.id,view_orders:{...Ae.view_orders||{},[U]:1e4*(nt+1)}}));ks(re)}else{const Ve=(we-Le)/(Be.length+1),Ct=Be.map((bt,Tt)=>({id:bt.id,view_orders:{...bt.view_orders||{},[U]:Le+Ve*(Tt+1)}}));ks(Ct)}}}else if(z==="right"){if(te==="today"){const Ge=Be[0],Ce=xn.findIndex(Ve=>Ve.data.id===Ge.id);if(Ce<=0){b({msg:"",type:"info"});return}const Le=xn[Ce-1].data.id,we=(Ve,Ct)=>{let bt=r.find(Tt=>Tt.id===Ve);for(;bt&&bt.parent_id;){if(bt.parent_id===Ct)return!0;bt=r.find(Tt=>Tt.id===bt.parent_id)}return!1};for(const Ve of Be)if(Le===Ve.id||we(Le,Ve.id)){b({msg:"",type:"error"});return}const Me=Be.map(Ve=>({id:Ve.id,parent_id:Le}));ks(Me),b({msg:` ${Be.length} `,type:"info"});return}let Qe=null;const ot=Be[0];if(te==="project"){const Ge=L.filter(Le=>(Le.parent_id||null)===(ot.parent_id||null)&&Le.status!=="deleted"&&Le.status!=="logged").sort((Le,we)=>Y(Le)-Y(we)),Ce=Ge.findIndex(Le=>Le.id===ot.id);Ce>0&&(Qe=Ge[Ce-1].id)}else{const Ge=xn.findIndex(Ce=>Ce.data.id===ot.id);if(Ge>0){const Ce=xn[Ge];for(let Le=Ge-1;Le>=0;Le--){if(xn[Le].depth===Ce.depth){Qe=xn[Le].data.id;break}if(xn[Le].depth<Ce.depth)break}}}if(!Qe)return;const _t=L.filter(Ge=>Ge.parent_id===Qe&&Ge.status!=="deleted"&&Ge.status!=="logged").sort((Ge,Ce)=>Y(Ge)-Y(Ce));let at=(_t[_t.length-1]?Y(_t[_t.length-1]):0)+1e4;P.includes(Qe)||dn(Qe,!0);const wt=Be.map(Ge=>{const Ce=at;return at+=1e4,{id:Ge.id,parent_id:Qe,order_index:Ce,view_orders:{...Ge.view_orders||{},[U]:Ce}}});ks(wt),b({msg:` ${Be.length} `,type:"info"})}else if(z==="left"){if(te==="today"){const _t=[];let at=0;for(const wt of Be){if(!wt.parent_id)continue;const Ge=L.find(Le=>Le.id===wt.parent_id);if(!Ge)continue;const Ce=Ge.parent_id||null;_t.push({id:wt.id,parent_id:Ce}),at++}_t.length>0?(ks(_t),b({msg:` ${at} `,type:"info"})):b({msg:"",type:"info"});return}const Qe=[];let ot=0;for(const _t of Be){if(!_t.parent_id)continue;const at=L.find(Me=>Me.id===_t.parent_id);if(!at)continue;if(te==="project"){const Me=a.find(Ve=>Ve.name.trim().toLowerCase()==="project");if(Me&&at.tags.includes(Me.id)){b({msg:" ",type:"info"});continue}}const wt=at.parent_id,Ge=L.filter(Me=>Me.parent_id===wt&&Me.status!=="deleted"&&Me.status!=="logged").sort((Me,Ve)=>Y(Me)-Y(Ve)),Ce=Ge.findIndex(Me=>Me.id===at.id),Le=Ge[Ce+1];let we;Le?we=(Y(at)+Y(Le))/2:we=Y(at)+1e4,Qe.push({id:_t.id,parent_id:wt,order_index:we,view_orders:{..._t.view_orders||{},[U]:we}}),ot++}Qe.length>0&&(ks(Qe),b({msg:` ${ot} `,type:"info"}))}},ks=async $=>{const z=$.map(Y=>{const he=Q.current.find(Qe=>Qe.id===Y.id),De={},Be={};return he&&Object.keys(Y).forEach(Qe=>{Qe!=="id"&&(De[Qe]=he[Qe],Be[Qe]=Y[Qe])}),{id:Y.id,before:De,after:Be}});Zt({type:"BATCH_UPDATE",payload:z});const L=Q.current.map(Y=>{const he=$.find(De=>De.id===Y.id);return he?{...Y,...he}:Y}).sort((Y,he)=>(Y.order_index||0)-(he.order_index||0)||Y.created_at.localeCompare(he.created_at));if(Q.current=L,s(L),be){const Y=be;await Promise.all($.map(he=>Y.from("tasks").update(he).eq("id",he.id)))}const V=JSON.parse(localStorage.getItem("task_google_map")||"{}"),U=$.filter(Y=>V[Y.id]&&(Y.start_date!==void 0||Y.is_all_day!==void 0));U.length>0&&Promise.resolve(localStorage.getItem("google_access_token")).then(async Y=>{Y&&await Promise.all(U.map(async he=>{const De=V[he.id],Be=L.find(Ge=>Ge.id===he.id);if(!Be)return;const Qe={},ot=he.is_all_day!==void 0?he.is_all_day:Be.is_all_day,_t=he.start_date||Be.start_date;if(!_t)return;const at=new Date(_t);if(isNaN(at.getTime()))return;const wt=at.toLocaleDateString("en-CA");if(ot){Qe.start={date:wt};const Ge=new Date(at);Ge.setDate(Ge.getDate()+1),Qe.end={date:Ge.toLocaleDateString("en-CA")}}else{const Ge=Me=>Me.length===5?Me+":00":Me,Ce=Ge(he.start_time||Be.start_time||"09:00:00");let Le=Be.end_time?Ge(Be.end_time):null;if(!Le){const[Me,Ve]=Ce.split(":").map(Number);Le=`${String((Me+1)%24).padStart(2,"0")}:${String(Ve).padStart(2,"0")}:00`}const we=Intl.DateTimeFormat().resolvedOptions().timeZone;Qe.start={dateTime:`${wt}T${Ce}`,timeZone:we},Qe.end={dateTime:`${wt}T${Le}`,timeZone:we}}try{const Ge=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${De.calId}/events/${De.evtId}`,{method:"PATCH",headers:{Authorization:`Bearer ${Y}`,"Content-Type":"application/json"},body:JSON.stringify(Qe)});if(!Ge.ok){const Ce=await Ge.text();console.error("Batch Google Sync Failed",Ce),Ge.status===401&&b({msg:"Google  Google",type:"error"})}}catch(Ge){console.error("Google Batch Sync Error",Ge)}}))})},Io=async($,z=[],L)=>{if(!be)return"";m("syncing");const V=L||ul(),U=r.length>0?Math.max(...r.map(ot=>ot.order_index||0)):0,Y=$.order_index!==void 0?$.order_index:U+1e4;Wt(V);const he={...$,id:V,user_id:e.id,parent_id:$.parent_id||null,created_at:new Date().toISOString(),tags:$.tags||[],images:$.images||[],order_index:Y,view_orders:$.view_orders||{},is_all_day:$.is_all_day||!1,start_time:$.start_time||null,end_time:$.end_time||null,duration:$.duration||null,reviewed_at:null,dependencies:$.dependencies||[]};Zt({type:"ADD",payload:{data:he}}),s(ot=>{const _t=[...ot,he].sort((at,wt)=>(at.order_index||0)-(wt.order_index||0)||at.created_at.localeCompare(wt.created_at));return Q.current=_t,_t});const{error:De}=await be.from("tasks").insert([he]);if(De)return console.error("Task Insert Error:",De),s(ot=>ot.filter(_t=>_t.id!==V)),mt(De),"";const Be=a.find(ot=>(he.tags||[]).includes(ot.id)&&ot.name.startsWith("Google:")),Qe=he.start_date&&(he.start_time||he.is_all_day);if(Be&&Qe){const ot=localStorage.getItem("google_access_token");if(ot){console.log("[Google Sync] New task has Google tag, creating event...");const _t=Be.name.replace("Google:","").trim();wl(ot).then(async at=>{const wt=at.find(Me=>Me.summary===_t),Ge=wt?wt.id:"primary",Ce={summary:he.title,description:he.description||""},Le=new Date(he.start_date).toLocaleDateString("en-CA"),we=Intl.DateTimeFormat().resolvedOptions().timeZone;if(he.is_all_day){Ce.start={date:Le};const Me=new Date(Le),Ve=new Date(Me);Ve.setDate(Ve.getDate()+1),Ce.end={date:Ve.toLocaleDateString("en-CA")}}else if(he.start_time){const Me=he.start_time.length>5?he.start_time.substring(0,5):he.start_time,Ve=`${Le}T${Me}:00`;let Ct="";if(he.end_time)Ct=he.end_time.length>5?he.end_time.substring(0,5):he.end_time;else{const bt=new Date(Ve);bt.setHours(bt.getHours()+1),Ct=`${String(bt.getHours()).padStart(2,"0")}:${String(bt.getMinutes()).padStart(2,"0")}`}Ce.start={dateTime:Ve,timeZone:we},Ce.end={dateTime:`${Le}T${Ct}:00`,timeZone:we}}if(Ce.start)try{const Me=await Ro(ot,Ge,Ce);if(Me){const Ve=JSON.parse(localStorage.getItem("task_google_map")||"{}");Ve[V]={evtId:Me,calId:Ge},localStorage.setItem("task_google_map",JSON.stringify(Ve)),console.log("[Google Sync] Created event for new task:",V,"eventId:",Me),b({msg:"Google ",type:"info"})}}catch(Me){console.error("[Google Sync] Failed to create event for new task:",Me)}}).catch(at=>console.error("[Google Sync] Calendar list fetch failed:",at))}}return m("synced"),V},ol=async($,z=null,L)=>{if(!be)return;m("syncing");let V=Q.current.length>0?Math.max(...Q.current.map(ot=>ot.order_index||0)):0;const U=[],Y=new Date().toISOString(),he=(ot,_t)=>{for(const at of ot){V+=1e4;const wt=at.id||ul();Wt(wt);const Ge={id:wt,user_id:e.id,parent_id:_t,created_at:Y,title:at.title,description:at.description,start_date:at.start_date||null,due_date:at.due_date||null,order_index:V,view_orders:{today:0},dependencies:at.dependencies||[],is_all_day:at.is_all_day!==void 0?at.is_all_day:!0,start_time:at.start_time||null,end_time:at.end_time||null,duration:at.duration||null,color:at.color,tags:at.tags||[],status:at.status||"todo",images:at.images||[],reviewed_at:null,reminder_minutes:at.reminder_minutes||null,google_event_id:at.google_event_id||null,google_calendar_id:at.google_calendar_id||null};U.push(Ge),at.subtasks&&at.subtasks.length>0&&he(at.subtasks,wt)}};if(he($,z),U.length===0)return;s(ot=>{const _t=[...ot,...U].sort((at,wt)=>(at.order_index||0)-(wt.order_index||0)||at.created_at.localeCompare(wt.created_at));return Q.current=_t,_t});const De=500;let Be=0;const Qe=U.length;try{const ot=JSON.parse(localStorage.getItem("task_google_map")||"{}");for(let _t=0;_t<Qe;_t+=De){const at=U.slice(_t,_t+De),wt=at.map(Ce=>{const{google_event_id:Le,google_calendar_id:we,...Me}=Ce;return Me}),{error:Ge}=await be.from("tasks").insert(wt);if(Ge){console.error("Batch insert error in chunk "+_t,Ge),mt(Ge);break}at.forEach(Ce=>{Ce.google_event_id&&Ce.google_calendar_id&&(ot[Ce.id]={evtId:Ce.google_event_id,calId:Ce.google_calendar_id})}),Be+=at.length,L&&L(Be,Qe),await new Promise(Ce=>setTimeout(Ce,10))}localStorage.setItem("task_google_map",JSON.stringify(ot))}catch(ot){console.error("Batch process failed",ot)}m("synced")},nr=async $=>{if(!be||$.length===0)return[];m("syncing");const z=[],L=new Map,V=Y=>{const he=Q.current.filter(Be=>Be.parent_id===Y);let De=[];return he.forEach(Be=>{De.push(Be),De=[...De,...V(Be.id)]}),De};let U=Q.current.length>0?Math.max(...Q.current.map(Y=>Y.order_index||0)):0;try{for(const Y of $){const he=Q.current.find(ot=>ot.id===Y);if(!he)continue;const De=V(Y);U+=1e4;const Be=ul();L.set(Y,Be);const Qe={...he,id:Be,title:he.title+" ()",created_at:new Date().toISOString(),order_index:U,view_orders:{},reviewed_at:null};delete Qe.user_id,await Io(Qe,[],Be),z.push(Be);for(const ot of De){U+=1e4;const _t=ul();L.set(ot.id,_t);const at=L.get(ot.parent_id)||ot.parent_id,wt={...ot,id:_t,parent_id:at,created_at:new Date().toISOString(),order_index:U,view_orders:{},reviewed_at:null};delete wt.user_id,await Io(wt,[],_t)}}}catch(Y){mt(Y)}finally{m("synced")}return z},$r=async($,z,L=[],V)=>{var wt,Ge;if(console.warn("[updateTask] CALLED:",$,"status:",z.status),!be)return;const U=r.find(Ce=>Ce.id===$);if(U&&ut(U)&&!(V!=null&&V.skipGoogleLockCheck)){console.warn("[updateTask] BLOCKED: Task is locked via Google tag:",$),b({msg:" Google ",type:"error"});return}if(m("syncing"),Wt($),te==="inbox"&&U&&!U.parent_id){const Ce=a.find($t=>$t.name.trim().toLowerCase()==="project"),Le=a.find($t=>$t.name.includes("")),we=a.find($t=>$t.name.trim().toLowerCase()==="note"),Me=a.find($t=>$t.name.trim().toLowerCase()==="prompt"),Ve=a.find($t=>$t.name==="#prompt"),Ct=a.find($t=>$t.name.trim().toLowerCase()==="journal"),bt=a.find($t=>$t.name.trim().toLowerCase()==="someday"),Tt=a.find($t=>["annual","annualplan","",""].some(zt=>$t.name.trim().toLowerCase().includes(zt))),qe=a.find($t=>["schedule",""].includes($t.name.trim().toLowerCase())),re=z.tags||U.tags||[],Ae=U.tags||[],nt=z.tags&&(Ce&&re.includes(Ce.id)&&!Ae.includes(Ce.id)||Le&&re.includes(Le.id)&&!Ae.includes(Le.id)||we&&re.includes(we.id)&&!Ae.includes(we.id)||Me&&re.includes(Me.id)&&!Ae.includes(Me.id)||Ve&&re.includes(Ve.id)&&!Ae.includes(Ve.id)||Ct&&re.includes(Ct.id)&&!Ae.includes(Ct.id)||bt&&re.includes(bt.id)&&!Ae.includes(bt.id)||Tt&&re.includes(Tt.id)&&!Ae.includes(Tt.id)||qe&&re.includes(qe.id)&&!Ae.includes(qe.id)),rt=z.status&&(z.status==="someday"||z.status==="waiting")&&U.status!=="someday"&&U.status!=="waiting";(z.start_date&&!U.start_date||z.due_date&&!U.due_date||z.parent_id&&!U.parent_id||nt||rt)&&!lt.current.includes($)&&Sn($)}if(U&&!(V!=null&&V.skipHistory)){const Ce={};let Le=!1;Object.keys(z).forEach(we=>{const Me=U[we],Ve=z[we];Ce[we]=Me,Array.isArray(Me)||Array.isArray(Ve)||Me&&typeof Me=="object"?JSON.stringify(Me)!==JSON.stringify(Ve)&&(Le=!0):Me!==Ve&&(Le=!0)}),Le&&Zt({type:"UPDATE",payload:{id:$,before:Ce,after:z}})}if(z.start_date&&U){const Ce=new Date().toISOString().split("T")[0],Le=z.start_date===Ce||z.start_date.startsWith(Ce),we=((wt=U.view_orders)==null?void 0:wt.today)!==void 0;if(Le&&!we){const Me=Q.current.filter(bt=>{const Tt=bt.start_date||bt.due_date;return Tt&&(Tt===Ce||Tt.startsWith(Ce))});let Ve=0;Me.forEach(bt=>{var qe;const Tt=((qe=bt.view_orders)==null?void 0:qe.today)??bt.order_index??0;Tt>Ve&&(Ve=Tt)});const Ct=Ve+1e4;z.view_orders={...U.view_orders||{},...z.view_orders||{},today:Ct}}}const Y=z.completed_at&&(!U||!U.completed_at);let he=[];if(Y){const Ce=Le=>{const Me=Q.current.filter(Ct=>Ct.parent_id===Le&&!Ct.completed_at).map(Ct=>Ct.id),Ve=Me.flatMap(Ct=>Ce(Ct));return[...Me,...Ve]};he=Ce($)}s(Ce=>{const Le=new Date().toISOString();let we=Ce.map(Me=>Me.id===$?{...Me,...z,updated_at:Le}:Me);return he.length>0&&(we=we.map(Me=>he.includes(Me.id)?{...Me,completed_at:z.completed_at,status:"completed",updated_at:Le}:Me)),Q.current=we,we});const{google_event_id:De,google_calendar_id:Be,...Qe}=z,{error:ot}=await be.from("tasks").update(Qe).eq("id",$);if(ot){U&&s(Ce=>{const Le=Ce.map(we=>we.id===$?U:we);return Q.current=Le,Le}),mt(ot);return}else{console.log("[updateTask] Database update successful, proceeding to Google sync check");const Ce=JSON.parse(localStorage.getItem("task_google_map")||"{}");De&&Be&&(Ce[$]={evtId:De,calId:Be},localStorage.setItem("task_google_map",JSON.stringify(Ce)));const Le=Ce[$];if(z.status==="deleted"&&console.log("[Google Sync Check] Task being deleted:",$,"Has Google mapping:",!!Le),U&&Le&&Le.evtId!=="PENDING"){const we=localStorage.getItem("google_access_token");if(we){const Me={...U,...z},Ve={};if(z.tags!==void 0){const bt=a.find(qe=>(U.tags||[]).includes(qe.id)&&qe.name.startsWith("Google:")),Tt=a.find(qe=>(z.tags||[]).includes(qe.id)&&qe.name.startsWith("Google:"));if(bt&&Tt&&bt.id!==Tt.id){console.log("[Google Sync] Calendar tag changed from",bt.name,"to",Tt.name),bt.name.replace("Google:","").trim();const qe=Tt.name.replace("Google:","").trim();wl(we).then(async re=>{var nt;const Ae=re.find(rt=>rt.summary===qe);if(Ae)try{await la(we,Le.calId,Le.evtId),console.log("[Google Sync] Deleted event from old calendar:",Le.calId);const rt={summary:Me.title,description:Me.description||""},kt=(nt=Me.start_date)==null?void 0:nt.split("T")[0],$t=Intl.DateTimeFormat().resolvedOptions().timeZone;if(Me.is_all_day&&kt){rt.start={date:kt};const zt=new Date(kt);zt.setDate(zt.getDate()+1),rt.end={date:zt.toISOString().split("T")[0]}}else if(Me.start_time&&kt){const zt=(Me.start_time||"").substring(0,5);rt.start={dateTime:`${kt}T${zt}:00`,timeZone:$t};const Yt=Me.end_time?Me.end_time.substring(0,5):(()=>{const ln=new Date(`${kt}T${zt}:00`);return ln.setHours(ln.getHours()+1),`${String(ln.getHours()).padStart(2,"0")}:${String(ln.getMinutes()).padStart(2,"0")}`})();rt.end={dateTime:`${kt}T${Yt}:00`,timeZone:$t}}if(rt.start){const zt=await Ro(we,Ae.id,rt);if(zt){const Yt=JSON.parse(localStorage.getItem("task_google_map")||"{}");Yt[$]={evtId:zt,calId:Ae.id},localStorage.setItem("task_google_map",JSON.stringify(Yt)),console.log("[Google Sync] Moved event to new calendar:",Ae.id,"new event ID:",zt),b({msg:` ${qe}`,type:"info"})}}}catch(rt){console.error("[Google Sync] Calendar move failed:",rt),b({msg:"",type:"error"})}}).catch(re=>console.error("[Google Sync] Failed to fetch calendars for move:",re));return}}if(!(z.title!==void 0||z.status!==void 0||z.start_date!==void 0||z.start_time!==void 0||z.end_time!==void 0||z.is_all_day!==void 0))return;if(z.title!==void 0&&z.title!==U.title&&(Ve.summary=Me.title),z.description!==void 0&&z.description!==U.description&&(Ve.description=Me.description||""),z.status==="deleted"){console.log("[Google Sync] Task moved to trash, calling DELETE API"),la(we,Le.calId,Le.evtId).then(()=>{b({msg:"Google ",type:"info"});const bt=JSON.parse(localStorage.getItem("task_google_map")||"{}");delete bt[$],localStorage.setItem("task_google_map",JSON.stringify(bt))}).catch(bt=>console.error("Google Delete Error",bt));return}else z.status&&U.status==="deleted"&&(Ve.status="confirmed",console.log("[Google Sync] Task restored, setting event status to confirmed"),Ve.status="confirmed",console.log("[Google Sync] Task restored, setting event status to confirmed"));try{const bt=rt=>{if(!rt)return null;if(typeof rt=="string"){const kt=rt.match(/^(\d{4}-\d{2}-\d{2})/);return kt?kt[1]:null}return null},Tt=rt=>{if(!rt)return null;if(typeof rt=="string"){const kt=rt.match(/^(\d{1,2}):(\d{2})/);if(kt)return`${kt[1].padStart(2,"0")}:${kt[2]}`}return null};if((z.start_date!==void 0&&bt(z.start_date)!==bt(U.start_date)||z.start_time!==void 0&&Tt(z.start_time)!==Tt(U.start_time)||z.end_time!==void 0&&Tt(z.end_time)!==Tt(U.end_time)||z.is_all_day!==void 0&&z.is_all_day!==U.is_all_day)&&Me.start_date){const rt=Intl.DateTimeFormat().resolvedOptions().timeZone,kt=bt(Me.start_date),$t=zt=>{if(!zt)return null;if(typeof zt=="string"){const Yt=zt.match(/^(\d{1,2}):(\d{2})(?::(\d{2}))?/);if(Yt){const ln=Yt[1].padStart(2,"0"),gn=Yt[2],yn=Yt[3]||"00";return`${ln}:${gn}:${yn}`}}return null};if(Me.is_all_day&&kt){Ve.start={date:kt};const zt=new Date(kt);zt.setDate(zt.getDate()+1);const Yt=zt.toISOString().split("T")[0];Ve.end={date:Yt}}else if(kt&&Me.start_time){const zt=$t(Me.start_time);if(zt){const Yt=`${kt}T${zt}`;Ve.start={dateTime:Yt,timeZone:rt};let ln="";const gn=$t(Me.end_time);if(gn)ln=`${kt}T${gn}`;else{const yn=new Date(Yt),Fn=new Date(yn.getTime()+60*60*1e3),vr=String(Fn.getHours()).padStart(2,"0"),rr=String(Fn.getMinutes()).padStart(2,"0");ln=`${kt}T${vr}:${rr}:00`}Ve.end={dateTime:ln,timeZone:rt}}}}if(Ve.start||Ve.end){const rt=Ve.start&&(Ve.start.date||Ve.start.dateTime),kt=Ve.end&&(Ve.end.date||Ve.end.dateTime);(!rt||!kt)&&(delete Ve.start,delete Ve.end,console.log("[Google Sync] Removed invalid date objects from payload"))}const Ae=Object.keys(Ve).length>0&&(Ve.summary||Ve.status||Ve.start&&Ve.end);if(z.is_all_day!==void 0&&U.is_all_day!==z.is_all_day&&Ve.start&&Ve.end){console.log("[Google Sync] Event TYPE change detected (is_all_day:",U.is_all_day,"->",z.is_all_day,"), using delete+create"),On.current=!0;const rt=Le.evtId;Un.current.add(rt),(async()=>{try{await la(we,Le.calId,rt);const kt={summary:Me.title,description:Me.description||"",start:Ve.start,end:Ve.end},$t=await Ro(we,Le.calId,kt);Un.current.add($t);const zt=JSON.parse(localStorage.getItem("task_google_map")||"{}");zt[$]={evtId:$t,calId:Le.calId},localStorage.setItem("task_google_map",JSON.stringify(zt)),b({msg:"Google ",type:"info"}),console.log("[Google Sync] Event type change completed with new ID:",$t)}catch(kt){console.error("Failed to recreate event:",kt),b({msg:"Google : ",type:"error"})}finally{On.current=!1}})()}else Ae&&(console.log("[Google Sync] Updating event:",Le.evtId),console.log("[Google Sync] Full payload:",JSON.stringify(Ve,null,2)),e1(we,Le.calId,Le.evtId,Ve).then(()=>b({msg:"Google ",type:"info"})).catch(async rt=>{console.error("Google Update Error",rt,"Payload:",Ve),(rt.message||"").includes("conflict")||b({msg:`Google : ${rt.message}`,type:"error"})}))}catch(bt){console.error("Date parsing error",bt)}}}}const at=JSON.parse(localStorage.getItem("task_google_map")||"{}")[$];if(U&&!at&&U.status==="deleted"&&z.status&&z.status!=="deleted"){const Ce=localStorage.getItem("google_access_token"),Le={...U,...z},we=Le.start_date&&(Le.start_time||Le.is_all_day);if(Ce&&we){console.log("[Google Sync] Task restored from trash. Recreating Google Event..."),b({msg:" Google ...",type:"info"});const Me={summary:Le.title,description:Le.description||""},Ve=Le.start_date.split("T")[0];if(Le.is_all_day){Me.start={date:Ve};const Ct=new Date(Ve);Ct.setDate(Ct.getDate()+1),Me.end={date:Ct.toISOString().split("T")[0]}}else if(Le.start_time){const Ct=Le.start_time.length>5?Le.start_time.substring(0,5):Le.start_time,bt=`${Ve}T${Ct}:00`;let Tt="";if(Le.end_time)Tt=Le.end_time.length>5?Le.end_time.substring(0,5):Le.end_time;else{const Ae=new Date(bt);Ae.setHours(Ae.getHours()+1);const nt=String(Ae.getHours()).padStart(2,"0"),rt=String(Ae.getMinutes()).padStart(2,"0");Tt=`${nt}:${rt}`}const qe=`${Ve}T${Tt}:00`,re=Intl.DateTimeFormat().resolvedOptions().timeZone;Me.start={dateTime:bt,timeZone:re},Me.end={dateTime:qe,timeZone:re}}Me.start&&Ro(Ce,"primary",Me).then(Ct=>{if(Ct){const bt=JSON.parse(localStorage.getItem("task_google_map")||"{}");bt[$]={evtId:Ct,calId:"primary"},localStorage.setItem("task_google_map",JSON.stringify(bt)),b({msg:"Google ",type:"info"})}}).catch(Ct=>console.error("Restore Google Error:",Ct))}}if(U&&!at){const Ce={...U,...z,completed_at:null},Le=z.tags!==void 0?z.tags:U.tags||[],we=a.find(Ve=>Le.includes(Ve.id)&&Ve.name.startsWith("Google:")),Me=Ce.start_date&&(Ce.start_time||Ce.is_all_day);if(we&&Me&&Ce.status!=="deleted"){const Ve=localStorage.getItem("google_access_token");if(Ve){const Ct=JSON.parse(localStorage.getItem("task_google_map")||"{}");if(((Ge=Ct[$])==null?void 0:Ge.evtId)==="PENDING")return;Ct[$]={evtId:"PENDING",calId:"primary"},localStorage.setItem("task_google_map",JSON.stringify(Ct)),console.log("[Google Sync] Found Google Tag:",we.name,"Creating event..."),b({msg:" Google ...",type:"info"});const bt=we.name.replace("Google:","").trim();let Tt="primary";wl(Ve).then(async qe=>{var kt;const re=qe.find($t=>$t.summary===bt);re?(Tt=re.id,console.log("[Google Sync] Resolved Calendar ID:",Tt)):console.warn("[Google Sync] Calendar not found:",bt,"Using primary.");const Ae={summary:Ce.title,description:Ce.description||""},nt=new Date(Ce.start_date).toLocaleDateString("en-CA"),rt=Intl.DateTimeFormat().resolvedOptions().timeZone;if(Ce.is_all_day){Ae.start={date:nt};const $t=new Date(nt),zt=new Date($t);zt.setDate(zt.getDate()+1),Ae.end={date:zt.toLocaleDateString("en-CA")}}else if(Ce.start_time){const $t=Ce.start_time.length>5?Ce.start_time.substring(0,5):Ce.start_time,zt=`${nt}T${$t}:00`;let Yt="";if(Ce.end_time)Yt=Ce.end_time.length>5?Ce.end_time.substring(0,5):Ce.end_time;else{const gn=new Date(zt);gn.setHours(gn.getHours()+1);const yn=String(gn.getHours()).padStart(2,"0"),Fn=String(gn.getMinutes()).padStart(2,"0");Yt=`${yn}:${Fn}`}const ln=`${nt}T${Yt}:00`;Ae.start={dateTime:zt,timeZone:rt},Ae.end={dateTime:ln,timeZone:rt}}if(Ae.start)try{const $t=await Ro(Ve,Tt,Ae);if($t){const zt=JSON.parse(localStorage.getItem("task_google_map")||"{}");zt[$]={evtId:$t,calId:Tt},localStorage.setItem("task_google_map",JSON.stringify(zt)),b({msg:"Google ",type:"info"})}}catch($t){console.error("[Google Sync] Creation failed",$t);const zt=JSON.parse(localStorage.getItem("task_google_map")||"{}");((kt=zt[$])==null?void 0:kt.evtId)==="PENDING"&&(delete zt[$],localStorage.setItem("task_google_map",JSON.stringify(zt))),b({msg:"Google ",type:"error"})}}).catch(qe=>{var Ae;console.error("Fetch calendars failed",qe);const re=JSON.parse(localStorage.getItem("task_google_map")||"{}");((Ae=re[$])==null?void 0:Ae.evtId)==="PENDING"&&(delete re[$],localStorage.setItem("task_google_map",JSON.stringify(re)))})}}}if(he.length>0&&await be.from("tasks").update({completed_at:z.completed_at,status:"completed"}).in("id",he),L.length>0&&await be.from("tasks").update({parent_id:$}).in("id",L),Y&&(U!=null&&U.repeat_rule)&&U.repeat_rule.triggerMode!=="on_schedule"){const Ce=B6(U.start_date||new Date().toISOString(),U.repeat_rule);if(Ce){const Le={user_id:U.user_id,title:U.title,description:U.repeat_rule.copyDescription!==!1?U.description:null,status:"todo",parent_id:U.parent_id,start_date:Ce,due_date:null,is_project:U.is_project,tags:U.tags,color:U.color,order_index:U.order_index,is_all_day:U.is_all_day,start_time:U.is_all_day?null:U.start_time,end_time:U.is_all_day?null:U.end_time,duration:U.duration,reminder_minutes:U.reminder_minutes!==void 0?U.reminder_minutes:null,repeat_rule:U.repeat_rule},{data:we,error:Me}=await be.from("tasks").insert(Le).select().single();if(we&&!Me){s(Ct=>{const bt=[...Ct,we];return Q.current=bt,bt});const Ve=U6(U.repeat_rule,(ee==null?void 0:ee.language)||"zh");b({msg:`  (${Ve})`,type:"info"})}}}m("synced")},qn=async($,z)=>{if(!be||$.length===0)return;const L=$.filter(({id:Ge})=>{const Ce=Q.current.find(Le=>Le.id===Ge);return Ce&&ut(Ce)});L.length>0&&(console.warn("[batchUpdateTasks] BLOCKED:",L.length,"tasks are locked via Google tag"),b({msg:`${L.length}  Google `,type:"error"}));const V=$.filter(({id:Ge})=>{const Ce=Q.current.find(Le=>Le.id===Ge);return!Ce||!ut(Ce)});if(V.length===0)return;const U=V;if(m("syncing"),te==="inbox"){const Ge=a.find(bt=>bt.name.trim().toLowerCase()==="project"),Ce=a.find(bt=>bt.name.includes("")),Le=a.find(bt=>bt.name.trim().toLowerCase()==="note"),we=a.find(bt=>bt.name.trim().toLowerCase()==="prompt"),Me=a.find(bt=>bt.name==="#prompt"),Ve=a.find(bt=>bt.name.trim().toLowerCase()==="journal"),Ct=a.find(bt=>bt.name.trim().toLowerCase()==="someday");U.forEach(({id:bt,data:Tt})=>{const qe=Q.current.find(re=>re.id===bt);if(qe&&!qe.parent_id){const re=Tt.tags||qe.tags||[],Ae=qe.tags||[],nt=Tt.tags&&(Ge&&re.includes(Ge.id)&&!Ae.includes(Ge.id)||Ce&&re.includes(Ce.id)&&!Ae.includes(Ce.id)||Le&&re.includes(Le.id)&&!Ae.includes(Le.id)||we&&re.includes(we.id)&&!Ae.includes(we.id)||Me&&re.includes(Me.id)&&!Ae.includes(Me.id)||Ve&&re.includes(Ve.id)&&!Ae.includes(Ve.id)||Ct&&re.includes(Ct.id)&&!Ae.includes(Ct.id)),rt=Tt.status&&(Tt.status==="someday"||Tt.status==="waiting")&&qe.status!=="someday"&&qe.status!=="waiting";(Tt.start_date&&!qe.start_date||Tt.due_date&&!qe.due_date||Tt.parent_id&&!qe.parent_id||nt||rt)&&!lt.current.includes(bt)&&Sn(bt)}})}const Y=JSON.parse(localStorage.getItem("task_google_map")||"{}"),he=U.map(Ge=>{const{google_event_id:Ce,google_calendar_id:Le,...we}=Ge.data;return Ce&&Le&&(Y[Ge.id]={evtId:Ce,calId:Le}),{id:Ge.id,data:we}});localStorage.setItem("task_google_map",JSON.stringify(Y));const De=localStorage.getItem("google_access_token"),Be=[];let Qe=!1;De&&$.forEach(({id:Ge,data:Ce})=>{const Le=Q.current.find(we=>we.id===Ge);if(Le&&Le.status==="deleted"&&Ce.status&&Ce.status!=="deleted"&&!Y[Ge]){const we={...Le,...Ce};we.start_date&&(we.start_time||we.is_all_day)&&(Qe=!0,Be.push((async()=>{try{console.log("[batchUpdateTasks] Restoring Google Event for:",Ge);const Ve={summary:we.title,description:we.description||""},Ct=we.start_date.split("T")[0];if(we.is_all_day){Ve.start={date:Ct};const bt=new Date(Ct);bt.setDate(bt.getDate()+1),Ve.end={date:bt.toISOString().split("T")[0]}}else if(we.start_time){const bt=we.start_time.length>5?we.start_time.substring(0,5):we.start_time,Tt=`${Ct}T${bt}:00`;let qe="";if(we.end_time)qe=we.end_time.length>5?we.end_time.substring(0,5):we.end_time;else{const nt=new Date(Tt);nt.setHours(nt.getHours()+1);const rt=String(nt.getHours()).padStart(2,"0"),kt=String(nt.getMinutes()).padStart(2,"0");qe=`${rt}:${kt}`}const re=`${Ct}T${qe}:00`,Ae=Intl.DateTimeFormat().resolvedOptions().timeZone;Ve.start={dateTime:Tt,timeZone:Ae},Ve.end={dateTime:re,timeZone:Ae}}if(Ve.start){const bt=await Ro(De,"primary",Ve);bt&&(Y[Ge]={evtId:bt,calId:"primary"})}}catch(Ve){console.error("[batchUpdateTasks] Restore Error",Ve)}})()))}}),Qe&&(b({msg:" Google ...",type:"info"}),await Promise.all(Be),localStorage.setItem("task_google_map",JSON.stringify(Y)));const ot=[];let _t=!1;De&&$.forEach(({id:Ge,data:Ce})=>{const Le=Q.current.find(Ct=>Ct.id===Ge);if(!Le||Ce.status==="deleted"||Le.status==="deleted"&&Ce.status&&Ce.status!=="deleted")return;const Me={...Le,...Ce},Ve=Y[Ge];if(Ve){const Ct={};if(Ce.title&&(Ct.summary=Ce.title),Ce.description!==void 0&&(Ct.description=Ce.description),Ce.start_date||Ce.start_time||Ce.end_time||Ce.is_all_day!==void 0){const qe=new Date(Me.start_date).toLocaleDateString("en-CA"),re=Intl.DateTimeFormat().resolvedOptions().timeZone;if(console.log("[Batch Sync] Date change detected:",{taskId:Ge,is_all_day:Me.is_all_day,start_time:Me.start_time,end_time:Me.end_time,dateStr:qe}),Me.is_all_day){Ct.start={date:qe};const Ae=new Date(qe);Ae.setDate(Ae.getDate()+1),Ct.end={date:Ae.toLocaleDateString("en-CA")}}else{const Ae=Me.start_time||"09:00",nt=Me.end_time||"10:00",rt=Ae.length>5?Ae.substring(0,5):Ae,kt=`${qe}T${rt}:00`,$t=nt.length>5?nt.substring(0,5):nt;Ct.end={dateTime:`${qe}T${$t}:00`,timeZone:re},Ct.start={dateTime:kt,timeZone:re}}console.log("[Batch Sync] Payload constructed:",JSON.stringify(Ct,null,2))}if(Ce.is_all_day!==void 0&&Le.is_all_day!==Ce.is_all_day&&Ct.start&&Ct.end){console.log("[Batch Sync] Event TYPE change detected (is_all_day:",Le.is_all_day,"->",Ce.is_all_day,"), using delete+create"),_t=!0,On.current=!0;const qe=Ve.evtId;Un.current.add(qe),console.log("[Batch Sync] Marked old event as replaced:",qe),ot.push((async()=>{try{await la(De,Ve.calId,qe),console.log("[Batch Sync] Old event deleted");const re={summary:Me.title,description:Me.description||"",start:Ct.start,end:Ct.end},Ae=await Ro(De,Ve.calId,re);console.log("[Batch Sync] New event created:",Ae),Un.current.add(Ae),console.log("[Batch Sync] Marked new event to skip in sync:",Ae);const nt=JSON.parse(localStorage.getItem("task_google_map")||"{}");nt[Ge]={evtId:Ae,calId:Ve.calId},localStorage.setItem("task_google_map",JSON.stringify(nt)),Y[Ge]={evtId:Ae,calId:Ve.calId},console.log("[Batch Sync] Event type change completed successfully")}catch(re){console.error("[Batch Sync] Failed to recreate event:",re.message)}finally{On.current=!1}})())}else Object.keys(Ct).length>0&&(_t=!0,ot.push(e1(De,Ve.calId,Ve.evtId,Ct).then(()=>console.log("[Batch Sync] Update success for task:",Ge)).catch(async qe=>{const re=qe.message||"";console.error("[Batch Sync] Update failed for task:",Ge,"Error:",re)})))}else{const Ct=Ce.tags!==void 0?Ce.tags:Le.tags||[],bt=a.find(qe=>Ct.includes(qe.id)&&qe.name.startsWith("Google:")),Tt=Me.start_date&&(Me.start_time||Me.is_all_day);bt&&Tt&&(_t=!0,ot.push((async()=>{try{const qe=bt.name.replace("Google:","").trim();let re="primary";const nt=(await wl(De)).find(zt=>zt.summary===qe);nt&&(re=nt.id);const rt={summary:Me.title,description:Me.description||""},kt=new Date(Me.start_date).toLocaleDateString("en-CA"),$t=Intl.DateTimeFormat().resolvedOptions().timeZone;if(Me.is_all_day){rt.start={date:kt};const zt=new Date(kt);zt.setDate(zt.getDate()+1),rt.end={date:zt.toLocaleDateString("en-CA")}}else if(Me.start_time){const zt=Me.start_time.length>5?Me.start_time.substring(0,5):Me.start_time,Yt=`${kt}T${zt}:00`;let ln="";if(Me.end_time)ln=Me.end_time.length>5?Me.end_time.substring(0,5):Me.end_time;else{const gn=new Date(Yt);gn.setHours(gn.getHours()+1);const yn=String(gn.getHours()).padStart(2,"0"),Fn=String(gn.getMinutes()).padStart(2,"0");ln=`${yn}:${Fn}`}rt.start={dateTime:Yt,timeZone:$t},rt.end={dateTime:`${kt}T${ln}:00`,timeZone:$t}}if(rt.start){const zt=await Ro(De,re,rt);zt&&(Y[Ge]={evtId:zt,calId:re})}}catch(qe){console.error("Batch Create Fail",qe)}})()))}}),_t&&(b({msg:" Google...",type:"info"}),await Promise.all(ot),localStorage.setItem("task_google_map",JSON.stringify(Y)));const at=[];he.forEach(({id:Ge,data:Ce})=>{Wt(Ge);const Le=Q.current.find(we=>we.id===Ge);if(Le){const we={};Object.keys(Ce).forEach(Me=>{we[Me]=Le[Me]}),at.push({id:Ge,before:we,after:Ce})}}),at.length>0&&!(z!=null&&z.skipHistory)&&Zt({type:"BATCH_UPDATE",payload:at});const wt=new Date().toISOString();s(Ge=>{const Ce=Ge.map(Le=>{const we=he.find(Me=>Me.id===Le.id);return we?{...Le,...we.data,updated_at:wt}:Le});return Q.current=Ce,Ce}),await Promise.all(he.map(({id:Ge,data:Ce})=>be.from("tasks").update(Ce).eq("id",Ge))),m("synced")},Pi=async($,z=!1)=>{if($.length===0)return;const L=$.filter(he=>{const De=Q.current.find(Be=>Be.id===he);return De&&ut(De)});L.length>0&&(console.warn("[batchDeleteTasks] BLOCKED:",L.length,"tasks are locked via Google tag"),b({msg:`${L.length}  Google `,type:"error"}));const V=$.filter(he=>{const De=Q.current.find(Be=>Be.id===he);return!De||!ut(De)});if(V.length===0)return;const U=V;if(m("syncing"),!z){const he=JSON.parse(localStorage.getItem("task_google_map")||"{}"),De=localStorage.getItem("google_access_token");let Be=0;if(De){const _t=U.map(async at=>{const wt=he[at];if(wt)try{console.log("[batchDeleteTasks] Deleting Google Event:",wt.evtId),await la(De,wt.calId,wt.evtId),delete he[at],Be++}catch(Ge){console.error("[batchDeleteTasks] Google Delete Error:",Ge)}});await Promise.all(_t),Be>0&&localStorage.setItem("task_google_map",JSON.stringify(he))}const Qe=U.map(_t=>({id:_t,data:{status:"deleted"}}));await qn(Qe);const ot=Be>0?` ${U.length}  ( ${Be}  Google )`:` ${U.length} `;b({msg:ot,undo:()=>nn()});return}const Y=Q.current.filter(he=>U.includes(he.id));if(Y.length===0){m("synced");return}if(be)for(const he of Y){if(he.attachments&&he.attachments.length>0)for(const De of he.attachments)try{const Qe=new URL(De.url).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(Qe){const ot=Qe[1];await be.storage.from("attachments").remove([ot])}}catch(Be){console.warn("Failed to delete attachment:",Be)}if(he.images&&he.images.length>0)for(const De of he.images)try{const Qe=new URL(De).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(Qe){const ot=Qe[1];await be.storage.from("attachments").remove([ot])}}catch(Be){console.warn("Failed to delete image:",Be)}}if(Zt({type:"BATCH_DELETE",payload:{data:Y}}),s(he=>{const De=he.filter(Be=>!$.includes(Be.id));return Q.current=De,De}),be)for(let De=0;De<$.length;De+=100){const Be=$.slice(De,De+100),{error:Qe}=await be.from("tasks").delete().in("id",Be);Qe&&console.error("Batch delete chunk error:",Qe)}m("synced"),b({msg:` ${$.length} `,type:"info"})},ac=async($,z=!1)=>{console.warn("[deleteTask] CALLED! id:",$,"permanent:",z);const L=r.find(V=>V.id===$);if(L&&ut(L)){console.warn("[deleteTask] BLOCKED: Task is locked via Google tag:",$),b({msg:" Google ",type:"error"});return}if(m("syncing"),Wt($),!z){if(L){console.log("[deleteTask] Soft deleting task:",$);const V=JSON.parse(localStorage.getItem("task_google_map")||"{}"),U=V[$];if(U){b({msg:" Google ...",type:"info"});const Y=localStorage.getItem("google_access_token");Y&&(console.log("[deleteTask] Found Google Event, deleting:",U.evtId),la(Y,U.calId,U.evtId).then(()=>{console.log("[deleteTask] Google Event deleted successfully"),b({msg:"Google ",type:"info"}),delete V[$],localStorage.setItem("task_google_map",JSON.stringify(V))}).catch(he=>{console.error("[deleteTask] Google Delete Error:",he),b({msg:"Google : "+he.message,type:"error"})}))}else console.warn("[deleteTask] No Google mapping found for task:",$);await $r($,{status:"deleted"}),b({msg:" (v2)",undo:()=>nn()})}return}if(L!=null&&L.attachments&&L.attachments.length>0&&be)for(const V of L.attachments)try{const Y=new URL(V.url).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(Y){const he=Y[1];await be.storage.from("attachments").remove([he])}}catch(U){console.warn("Failed to delete attachment:",U)}if(L!=null&&L.images&&L.images.length>0&&be)for(const V of L.images)try{const Y=new URL(V).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(Y){const he=Y[1];await be.storage.from("attachments").remove([he])}}catch(U){console.warn("Failed to delete image:",U)}if(L&&Zt({type:"DELETE",payload:{data:L}}),s(V=>{const U=V.filter(Y=>Y.id!==$);return Q.current=U,U}),be){const{error:V}=await be.from("tasks").delete().eq("id",$);if(V){mt(V),L&&s(U=>{const Y=[L,...U];return Q.current=Y,Y});return}else if(L){const Y=JSON.parse(localStorage.getItem("task_google_map")||"{}")[L.id];if(Y){const he=localStorage.getItem("google_access_token");he&&la(he,Y.calId,Y.evtId).then(()=>b({msg:"Google ",type:"info"})).catch(De=>console.error("Google Delete Error",De))}}}m("synced"),b({msg:"",type:"info"})},fi=async $=>{const z=r.find(L=>L.id===$);z&&z.status==="deleted"&&(await $r($,{status:"inbox"}),b({msg:" Inbox",type:"info"}))},Dr=async()=>{const $=r.filter(L=>L.status==="deleted");if($.length===0)return;const z=$.map(L=>({id:L.id,data:{status:"inbox"}}));await qn(z),b({msg:"",type:"info",undo:()=>nn()})},le=async()=>{const $=r.filter(z=>z.status==="deleted");$.length!==0&&await Pi($.map(z=>z.id),!0)},Et=async $=>{if(!be)return;const z=new Date().toISOString();s(L=>L.map(V=>V.id===$?{...V,reviewed_at:z}:V)),await be.from("tasks").update({reviewed_at:z}).eq("id",$),b({msg:"",type:"info"})},Bt=async($,z=null)=>{if(!be||!$.trim())return null;const L=ul(),U=a.filter(ot=>ot.parent_id===z).reduce((ot,_t)=>Math.max(ot,_t.order_index||0),0)+1e4,Y=a.find(ot=>ot.id===z),he=(Y==null?void 0:Y.color)||"#6366f1",De={id:L,name:$,parent_id:z,user_id:e.id,color:he,order_index:U};Zt({type:"ADD_TAG",payload:{data:De}}),l(ot=>[...ot,De].sort((_t,at)=>(_t.order_index||0)-(at.order_index||0)));const{data:Be,error:Qe}=await be.from("tags").insert([{name:$,parent_id:z,user_id:e.id,color:he,order_index:U}]).select();return Qe?(l(ot=>ot.filter(_t=>_t.id!==L)),null):(l(ot=>{const _t=Be[0];return ot.some(wt=>wt.id===_t.id)?ot.filter(wt=>wt.id!==L):ot.map(wt=>wt.id===L?_t:wt).sort((wt,Ge)=>(wt.order_index||0)-(Ge.order_index||0))}),Be[0].id)},Vt=async($,z)=>{if(!be)return;const L=a.find(V=>V.id===$);if(L){const V={};Object.keys(z).forEach(U=>V[U]=L[U]),Zt({type:"UPDATE_TAG",payload:{id:$,before:V,after:z}})}l(V=>V.map(U=>U.id===$?{...U,...z}:U).sort((U,Y)=>(U.order_index||0)-(Y.order_index||0))),await be.from("tags").update(z).eq("id",$)},Lt=async $=>{if(!be)return;const z=a.find(L=>L.id===$);z&&Zt({type:"DELETE_TAG",payload:{data:z}}),l(L=>L.filter(V=>V.id!==$)),await be.from("tags").delete().eq("id",$)},dn=($,z)=>{H(L=>{const V=L.includes($),U=z!==void 0?z?V?L:[...L,$]:L.filter(Y=>Y!==$):V?L.filter(Y=>Y!==$):[...L,$];return e!=null&&e.id&&localStorage.setItem(`expanded_tasks_${e.id}`,JSON.stringify(U)),U})},In=$=>{$e(z=>{const L=typeof $=="function"?$(z):$;return e!=null&&e.id&&localStorage.setItem(`last_view_${e.id}`,L),L!==z&&Ke([]),L})},lr=$=>{ue($),e!=null&&e.id&&localStorage.setItem(`sidebar_width_${e.id}`,$.toString())},zn=()=>Ue($=>!$),Cn=$=>{ve(z=>{const L=typeof $=="function"?$(z):$;return e!=null&&e.id&&localStorage.setItem(`expanded_tags_${e.id}`,JSON.stringify(L)),L})},Sn=$=>{Ke(z=>z.includes($)?z:[...z,$])},Yn=()=>{Ke([])},cr=$=>{ie(z=>{const L=typeof $=="function"?$(z):$;return e!=null&&e.id&&localStorage.setItem(`theme_settings_${e.id}`,JSON.stringify(L)),L})},Li=async($,z)=>{const L=new Date,V=L.getFullYear(),U=String(L.getMonth()+1).padStart(2,"0"),Y=String(L.getDate()).padStart(2,"0"),he=`${V}-${U}-${Y}`,De=wt=>a.find(Ge=>wt.some(Ce=>Ge.name.trim().toLowerCase()===Ce.toLowerCase())),Be=De(["project",""]),Qe=De(["someday"]),ot=De(["journal","note","",""]),_t=De(["prompt",""]);for(const wt of $){const Ge=Q.current.find(Ce=>Ce.id===wt);if(Ge)switch(z){case"today":case"newtable":await $r(wt,{start_date:he});break;case"project":if(Be){const Ce=Ge.tags.includes(Be.id)?Ge.tags:[...Ge.tags,Be.id];await $r(wt,{tags:Ce}),Q.current.some(we=>we.parent_id===wt&&we.status!=="deleted")||await Io({title:"",parent_id:wt,status:"active",importance:null,tags:[],notes:"",start_date:null,due_date:null})}break;case"waiting":if(Qe){const Ce=Ge.tags.includes(Qe.id)?Ge.tags:[...Ge.tags,Qe.id];await $r(wt,{tags:Ce,status:"someday"})}else await $r(wt,{status:"someday"});break;case"journal":if(ot){const Ce=Ge.tags.includes(ot.id)?Ge.tags:[...Ge.tags,ot.id];await $r(wt,{tags:Ce})}break;case"prompt":if(_t){const Ce=Ge.tags.includes(_t.id)?Ge.tags:[...Ge.tags,_t.id];await $r(wt,{tags:Ce})}break}}v([]),k(null);const at={today:"",newtable:"",project:"",waiting:"/",journal:"",prompt:""};b({msg:` ${$.length} ${at[z]||z}`,type:"info"})},hi=x.useRef(!1),On=x.useRef(!1),Un=x.useRef(new Set),wr=async()=>{var z,L,V,U,Y,he;if(console.log("[Google Sync] Attempting sync..."),hi.current){console.log("[Google Sync] Already syncing, skipping.");return}if(On.current){console.log("[Google Sync] Event recreation in progress, skipping to avoid conflicts.");return}let $=localStorage.getItem("google_access_token");if(!$){console.log("[Google Sync] No token found, skipping.");return}try{const De=await fetch("https://www.googleapis.com/calendar/v3/users/me/calendarList?maxResults=1",{headers:{Authorization:`Bearer ${$}`}});if(De.status===401){console.log("[Google Sync] Token expired, attempting silent refresh...");const Be=localStorage.getItem("google_client_id");if(Be&&((L=(z=window.google)==null?void 0:z.accounts)!=null&&L.oauth2))try{const Qe=await new Promise(ot=>{window.google.accounts.oauth2.initTokenClient({client_id:Be,scope:"https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar.readonly",callback:at=>{at.error?(console.log("[Google Sync] Silent refresh failed:",at.error),ot(null)):(console.log("[Google Sync] Silent refresh successful!"),ot(at.access_token))}}).requestAccessToken({prompt:""}),setTimeout(()=>ot(null),5e3)});if(Qe)$=Qe,localStorage.setItem("google_access_token",Qe),console.log("[Google Sync] Token refreshed successfully");else{console.error("[Google Sync] Silent refresh returned no token"),b({msg:"Google  Google ",type:"error"}),localStorage.removeItem("google_access_token");return}}catch(Qe){console.error("[Google Sync] Silent refresh error:",Qe),b({msg:"Google  Google ",type:"error"}),localStorage.removeItem("google_access_token");return}else{console.log("[Google Sync] Google script not loaded, attempting to load...");try{const{loadGoogleScript:Qe}=await hw(()=>Promise.resolve().then(()=>H6),void 0);await Qe(),b({msg:"Google  Google ",type:"error"})}catch{b({msg:"Google  Google ",type:"error"})}localStorage.removeItem("google_access_token");return}}else if(!De.ok){console.error("[Google Sync] Token validation failed:",De.status),b({msg:"Google API ",type:"error"});return}}catch(De){console.error("[Google Sync] Token validation error:",De),b({msg:" Google ",type:"error"});return}console.log("[Google Sync] Starting sync..."),console.log("[Google Sync] replacedEventIdsRef has",Un.current.size,"entries:",Array.from(Un.current)),hi.current=!0;try{const De=JSON.parse(localStorage.getItem("task_google_map")||"{}"),Be=new Set;Object.values(De).forEach(we=>{we.calId&&Be.add(we.calId)});let Qe=[];try{window.google_calendar_list_cache?Qe=window.google_calendar_list_cache:(Qe=await wl($),window.google_calendar_list_cache=Qe)}catch(we){console.error("[Google Sync] List Calendars Check failed",we)}const ot=a.filter(we=>we.name.startsWith("Google:"));if(console.log("[Google Sync] Found Google tags:",ot.map(we=>we.name)),Qe.length>0){const we=a.filter(Me=>Me.name.startsWith("Google:")).map(Me=>Me.name.replace("Google:","").trim());console.log("[Google Sync] Tag names to match:",we),we.forEach(Me=>{const Ve=Qe.find(Ct=>Ct.summary===Me);console.log(`[Google Sync] Matching "${Me}" -> ${Ve?Ve.id:"NOT FOUND"}`),Ve&&Be.add(Ve.id)})}else console.log("[Google Sync] No calendars to match against");const _t=JSON.parse(localStorage.getItem("google_sync_tokens")||"{}");let at=[...Q.current];const wt={...De};let Ge=!1;console.log("[Google Sync] Syncing calendars:",Array.from(Be));for(const we of Array.from(Be)){const Me=_t[we];console.log(`[Google Sync] Checking calendar: ${we}, hasToken: ${!!Me}`);try{const{events:Ve,nextSyncToken:Ct,fullSyncRequired:bt}=await kI($,we,Me);if(console.log(`[Google Sync] Calendar ${we}: ${Ve.length} events, fullSyncRequired: ${bt}`),bt){console.log(`[Google Sync] Full sync required for ${we}, will retry next time.`),delete _t[we];continue}if(Ct&&(_t[we]=Ct),Ve.length>0){console.log(`[Google Sync] Got ${Ve.length} updates for ${we}:`,Ve.map(Tt=>({id:Tt.id,summary:Tt.summary,status:Tt.status}))),Ge=!0;for(const Tt of Ve){if(Un.current.has(Tt.id)){console.log("[Google Sync] Ignoring replaced event (type change in progress):",Tt.id);continue}const qe=Object.keys(wt).find(re=>wt[re].evtId===Tt.id);if(console.log(`[Google Sync] Processing event: "${Tt.summary}" (${Tt.id})`,{hasMapping:!!qe,mappedTaskId:qe||"none",eventStatus:Tt.status}),Tt.status==="cancelled"){if(qe){const re=wt[qe];if(re&&re.calId===we){const Ae=at.find(nt=>nt.id===qe);Ae&&Ae.status!=="deleted"&&(Wt(qe),at=at.map(nt=>nt.id===qe?{...nt,status:"deleted"}:nt),be&&await be.from("tasks").update({status:"deleted"}).eq("id",qe),console.log("[Google Auto-Sync] Deleted Task",qe,"from calendar",we))}else console.log(`[Google Sync] Ignored deletion of ${qe} from ${we} (mapped to ${re==null?void 0:re.calId})`)}}else{const re=Tt.summary||"(No Title)",Ae=Tt.description||"";let nt=null,rt=null,kt=null,$t=!1;if(Tt.start.date)$t=!0,nt=Tt.start.date;else if(Tt.start.dateTime){const zt=new Date(Tt.start.dateTime);nt=zt.toLocaleDateString("en-CA"),rt=zt.toTimeString().substring(0,5),Tt.end.dateTime&&(kt=new Date(Tt.end.dateTime).toTimeString().substring(0,5))}if(nt)if(qe){const zt=at.findIndex(Yt=>Yt.id===qe);if(zt!==-1){const Yt=at[zt],ln=Yt.status==="deleted",gn=Yt.title!==re||Yt.description!==Ae||((V=Yt.start_date)==null?void 0:V.split("T")[0])!==nt||(Yt.start_time||"").substring(0,5)!==(rt||"")||(Yt.end_time||"").substring(0,5)!==(kt||"")||Yt.is_all_day!==$t||ln;console.log(`[Google Sync] Checking update for "${re}": changed=${gn}, isDeleted=${ln}`,{oldTitle:Yt.title,newTitle:re,oldDate:(U=Yt.start_date)==null?void 0:U.split("T")[0],newDate:nt,oldIsAllDay:Yt.is_all_day,newIsAllDay:$t,oldStartTime:Yt.start_time,newStartTime:rt});const yn=(Y=wt[qe])==null?void 0:Y.calId,Fn=yn&&yn!==we;if(gn||Fn){const vr={title:re,description:Ae,start_date:nt,is_all_day:$t,status:"todo"};rt&&(vr.start_time=rt),kt&&(vr.end_time=kt);let rr=[...Yt.tags||[]];if(Qe.length>0){const lc=Qe.find(ro=>ro.id===we)||(we==="primary"?Qe.find(ro=>ro.primary):null);if(lc){const ro=`Google:${lc.summary}`,Hu=a.find(cc=>cc.name===ro);if(Fn){const cc=a.filter(al=>al.name.startsWith("Google:")).map(al=>al.id);rr=rr.filter(al=>!cc.includes(al)),console.log("[Google Sync] Calendar changed from",yn,"to",we)}Hu&&!rr.includes(Hu.id)&&(rr.push(Hu.id),console.log("[Google Sync] Switched tag to:",ro)),vr.tags=rr,wt[qe]={evtId:Tt.id,calId:we}}}at[zt]={...Yt,...vr},Wt(qe),be&&await be.from("tasks").update(vr).eq("id",qe),console.log("[Google Sync] Updated Task",qe,"with",vr),Ge=!0}}else{console.log(`[Google Sync] Stale mapping for "${re}" (taskId: ${qe}), trying to find by title...`),delete wt[qe];const Yt=a.filter(gn=>gn.name.startsWith("Google:")).map(gn=>gn.id),ln=at.find(gn=>{var yn;return gn.title===re&&gn.status!=="deleted"&&((yn=gn.tags)==null?void 0:yn.some(Fn=>Yt.includes(Fn)))});if(ln){console.log(`[Google Sync] Found matching task by title: "${re}" -> ${ln.id}`);const gn=at.findIndex(yn=>yn.id===ln.id);if(gn!==-1){const yn=at[gn],Fn=yn.status==="deleted",vr=yn.title!==re||yn.description!==Ae||((he=yn.start_date)==null?void 0:he.split("T")[0])!==nt||(yn.start_time||"").substring(0,5)!==(rt||"")||(yn.end_time||"").substring(0,5)!==(kt||"")||yn.is_all_day!==$t||Fn;if(console.log(`[Google Sync] (Recovered) Checking update for "${re}": changed=${vr}`),vr){const rr={title:re,description:Ae,start_date:nt,is_all_day:$t,status:"todo"};rt&&(rr.start_time=rt),kt&&(rr.end_time=kt),at[gn]={...yn,...rr},Wt(ln.id),be&&await be.from("tasks").update(rr).eq("id",ln.id),console.log("[Google Sync] (Recovered) Updated Task",ln.id,"with",rr),Ge=!0}wt[ln.id]={evtId:Tt.id,calId:we},console.log("[Google Sync] Updated mapping:",ln.id,"->",Tt.id)}}else console.log(`[Google Sync] No matching task found for "${re}", will be created on next sync if tag exists`)}}else{const zt=JSON.parse(localStorage.getItem("task_google_map")||"{}");if(Object.values(zt).some(Fn=>Fn.evtId===Tt.id)){console.log("[Google Sync] Event already mapped (found in fresh check), skipping creation:",Tt.id);continue}let ln=[],gn=!1;if(Qe.length>0){let Fn=Qe.find(vr=>vr.id===we);if(!Fn&&we==="primary"&&(Fn=Qe.find(vr=>vr.primary===!0)),Fn){const vr=`Google:${Fn.summary}`,rr=a.find(lc=>lc.name===vr);rr?(ln.push(rr.id),console.log("[Google Sync] Assigned tag:",vr,"to new task:",re),gn=!0):console.log("[Google Sync] Tag not found:",vr,"- skipping creation")}}if(!gn)continue;const yn={user_id:e==null?void 0:e.id,title:re,description:Ae,status:"todo",start_date:nt,start_time:rt,end_time:kt,is_all_day:$t,tags:ln,order_index:0};if(be&&e){const{data:Fn}=await be.from("tasks").insert(yn).select().single();Fn&&(at.push(Fn),wt[Fn.id]={evtId:Tt.id,calId:we},console.log("[Google Sync] Created Task",Fn.id,"with mapping:",{evtId:Tt.id,calId:we},"title:",re))}}}}}}catch{}}Ge&&(at.sort((we,Me)=>(we.order_index||0)-(Me.order_index||0)||we.created_at.localeCompare(Me.created_at)),s(at),b({msg:"Google ",type:"info"}));const Le={...JSON.parse(localStorage.getItem("task_google_map")||"{}"),...wt};localStorage.setItem("task_google_map",JSON.stringify(Le)),localStorage.setItem("google_sync_tokens",JSON.stringify(_t)),console.log("[Google Sync] Saved",Object.keys(wt).length,"mappings. Total:",Object.keys(Le).length)}finally{console.log("[Google Sync] Sync completed."),hi.current=!1,Un.current.size>0&&(console.log("[Google Sync] Cleared",Un.current.size,"replaced event IDs"),Un.current.clear())}};return x.useEffect(()=>{if(console.log("[Google Sync] useEffect running, user:",!!e),!e)return;console.log("[Google Sync] Setting up 60s interval and 3s initial timeout...");const $=setInterval(()=>{console.log("[Google Sync] 60s interval triggered"),wr()},6e4),z=setTimeout(()=>{console.log("[Google Sync] Initial 3s timeout triggered"),wr()},3e3);return()=>{console.log("[Google Sync] Cleaning up interval and timeout"),clearInterval($),clearTimeout(z)}},[e,a]),c.jsx(jn.Provider,{value:{user:e,tasks:r,tags:a,visibleTasks:xn,loading:u,syncStatus:p,dragState:me,startDrag:cs,updateDropState:sl,endDrag:il,updateGhostPosition:no,addTask:Io,batchAddTasks:ol,duplicateTasks:nr,updateTask:$r,batchUpdateTasks:qn,deleteTask:ac,batchDeleteTasks:Pi,addTag:Bt,updateTag:Vt,deleteTag:Lt,keyboardMove:jo,smartReschedule:Dn,lockTask:cn,unlockTask:pe,verifyTaskPassword:q,temporarilyUnlockTask:O,archiveCompletedTasks:ye,archivedTasks:i,restoreArchivedTask:Re,deleteArchivedTask:_e,updateArchivedTask:it,batchDeleteArchivedTasks:Fe,clearAllTasks:Ft,exportData:Ut,importData:Kt,syncGoogleToApp:wr,undo:nn,redo:rn,canUndo:tt.length>0,canRedo:ht.length>0,logout:vn,navigateToTask:Gn,navigateBack:Gr,canNavigateBack:At.length>0,toast:y,setToast:b,selectedTaskIds:g,setSelectedTaskIds:v,handleSelection:di,selectionAnchor:w,setSelectionAnchor:_,focusedTaskId:D,setFocusedTaskId:k,editingTaskId:C,setEditingTaskId:T,inlineEditingTaskId:fe,setInlineEditingTaskId:Oe,expandedTaskIds:P,setExpandedTaskIds:H,toggleExpansion:dn,view:te,setView:In,tagFilter:Te,setTagFilter:Je,advancedFilters:St,setAdvancedFilters:X,themeSettings:ee,setThemeSettings:cr,calculateVisibleTasks:ls,pendingFocusTaskId:Se,setPendingFocusTaskId:Ie,leavingTaskIds:Ye,addLeavingTask:Sn,dismissLeavingTasks:Yn,initError:f,sidebarWidth:It,setSidebarWidth:lr,sidebarCollapsed:Ne,toggleSidebar:zn,expandedTags:de,setExpandedTags:Cn,calendarDate:et,setCalendarDate:xt,taskCounts:ft,focusSplitWidth:Ze,setFocusSplitWidth:xe,reviewTask:Et,restoreTask:fi,restoreTrash:Dr,emptyTrash:le,moveTaskToView:Li,isCmdPressed:ct,tagsWithResolvedColors:je,language:ce,setLanguage:Z,t:ne,viewTagFilters:M,updateViewTagFilter:oe,constructionModeEnabled:ge,setConstructionModeEnabled:F,searchHistory:K,addSearchHistory:gt,deleteSearchHistory:Pt,searchOpen:R,setSearchOpen:Ee,lockedGoogleTagIds:B,toggleGoogleTagLock:We,isTaskGoogleLocked:ut},children:t})},Ru=x.createContext({isRecording:!1,recordingTime:0,startRecording:async()=>{},stopRecording:()=>{},cancelRecording:()=>{},addMarker:()=>null,recordingTaskId:null,audioMarkers:[],currentRecordingId:null,analyser:null,audioContext:null}),G6=({children:t})=>{x.useContext(jn);const[e,n]=x.useState(!1),[r,s]=x.useState(0),[i,o]=x.useState(null),[a,l]=x.useState([]),[u,d]=x.useState(null),f=x.useRef(null),h=x.useRef(null),p=x.useRef(null),m=x.useRef(null),y=x.useRef(null),b=x.useRef([]),g=x.useRef(null),v=x.useRef(0),w=x.useRef(e),_=x.useRef(r),D=x.useRef(i),k=x.useRef(a);x.useEffect(()=>{w.current=e,_.current=r,D.current=i,k.current=a},[e,r,i,a]);const A=async T=>{if(e){console.warn("[RecordingContext] Cannot start recording - another recording is already in progress for task:",i);return}try{const C=await navigator.mediaDevices.getUserMedia({audio:!0});y.current=C;const O=new(window.AudioContext||window.webkitAudioContext);h.current=O;const P=O.createAnalyser();P.fftSize=2048,p.current=P;const H=O.createMediaStreamSource(C);H.connect(P),m.current=H;const M=MediaRecorder.isTypeSupported("audio/mp4")?"audio/mp4":"audio/webm",I=new MediaRecorder(C,{mimeType:M,audioBitsPerSecond:32e3});f.current=I,b.current=[];const K=`rec_${Date.now()}_${crypto.randomUUID()}`;d(K),I.ondataavailable=G=>{G.data.size>0&&b.current.push(G.data)},I.onstop=async()=>{const G=new Blob(b.current,{type:M}),R=M.split("/")[1],Ee=new Date,F=`Recording ${`${Ee.getFullYear()}.${String(Ee.getMonth()+1).padStart(2,"0")}.${String(Ee.getDate()).padStart(2,"0")} ${String(Ee.getHours()).padStart(2,"0")}:${String(Ee.getMinutes()).padStart(2,"0")}`}.${R}`,B=new File([G],F,{type:M});y.current&&y.current.getTracks().forEach(ut=>ut.stop()),h.current&&h.current.state!=="closed"&&h.current.close();const se=D.current,We=k.current;se?(console.log(`[RecordingContext] Saving recording for Task ${se}`,B,We),window.dispatchEvent(new CustomEvent("audio-recording-completed",{detail:{file:B,taskId:se,markers:We,duration:_.current,recordingId:K}}))):console.warn("Recording stopped but no Task ID associated."),n(!1),o(null),l([]),s(0),d(null)},I.start(100),n(!0),o(T||null),s(0),l([]),v.current=Date.now(),g.current=setInterval(()=>{const G=Date.now()-v.current;s(G)},100)}catch(C){console.error("[RecordingContext] Failed to start recording",C)}},N=()=>{f.current&&f.current.state!=="inactive"&&f.current.stop(),g.current&&(clearInterval(g.current),g.current=null)},E=()=>{f.current&&f.current.state!=="inactive"&&(f.current.onstop=null,f.current.stop()),g.current&&(clearInterval(g.current),g.current=null),y.current&&y.current.getTracks().forEach(T=>T.stop()),h.current&&h.current.state!=="closed"&&h.current.close(),n(!1),o(null),l([]),s(0)},S=()=>{if(!e)return null;const T=r,O={id:`rec-marker-${Date.now()}`,time:T};return l(P=>[...P,O]),O};return c.jsx(Ru.Provider,{value:{isRecording:e,recordingTime:r,startRecording:A,stopRecording:N,cancelRecording:E,addMarker:S,recordingTaskId:i,audioMarkers:a,currentRecordingId:u,analyser:p.current,audioContext:h.current},children:t})},_I=x.createContext({reminders:[],addReminder:()=>{},markAsSeen:()=>{},snoozeReminder:()=>{},clearAllSeen:()=>{},clearAllUnseen:()=>{},clearAll:()=>{},unseenCount:0,isReminderPanelOpen:!1,setIsReminderPanelOpen:()=>{}}),c2="app_reminders",u2="app_reminder_signatures",q6=1e4,Y6=({children:t})=>{const{tasks:e,setToast:n,user:r}=x.useContext(jn),[s,i]=x.useState([]),[o,a]=x.useState(!1),[l,u]=x.useState({}),[d,f]=x.useState(!1),h=x.useRef(null),p=x.useRef(!1),m=x.useRef(null),y=x.useRef([]),b=x.useRef({}),g=x.useRef([]),v=x.useRef(!1);x.useEffect(()=>{y.current=s},[s]),x.useEffect(()=>{b.current=l},[l]),x.useEffect(()=>{g.current=e},[e]),x.useEffect(()=>{v.current=d},[d]),x.useEffect(()=>{(async()=>{const T=(r==null?void 0:r.id)||null;if(!(m.current===T&&p.current)){if(!T){i([]),u({}),f(!1),m.current=null,p.current=!0;return}if(m.current=T,be)try{const{data:C,error:O}=await be.from("reminders").select("*").eq("user_id",T).order("triggered_at",{ascending:!1});if(!O&&C){f(!0);const P=C.map(M=>({id:M.id,task_id:M.task_id,task_title:M.task_title,task_color:M.task_color||"gray",triggered_at:M.triggered_at,due_time:M.due_time,seen:M.seen||!1,snoozed_until:M.snoozed_until||null}));i(P);const{data:H}=await be.from("reminder_signatures").select("*").eq("user_id",T);if(H){const M={};H.forEach(I=>{M[I.task_id]=I.signature}),u(M),b.current=M}console.log("[Reminder] Loaded from Supabase:",P.length),p.current=!0;return}}catch(C){console.warn("[Reminder] Supabase load failed, falling back to local:",C)}f(!1);try{const C=localStorage.getItem(c2);C&&i(JSON.parse(C));const O=localStorage.getItem(u2);if(O){const P=JSON.parse(O);u(P),b.current=P}}catch(C){console.error(C)}p.current=!0}})()},[r==null?void 0:r.id]),x.useEffect(()=>{if(!(r!=null&&r.id)||!be)return;if(!d){console.log("[Reminder] Sync disabled, skipping subscription");return}console.log("[Reminder] Subscribing to realtime channels...");const S=be.channel("reminders-sync",{config:{broadcast:{self:!1}}}).on("postgres_changes",{event:"*",schema:"public",table:"reminders",filter:`user_id=eq.${r.id}`},C=>{if(C.eventType==="INSERT"){const O=C.new;i(P=>P.some(H=>H.id===O.id)?P:[{id:O.id,task_id:O.task_id,task_title:O.task_title,task_color:O.task_color||"gray",triggered_at:O.triggered_at,due_time:O.due_time,seen:O.seen||!1,snoozed_until:O.snoozed_until||null},...P])}else if(C.eventType==="UPDATE"){const O=C.new;i(P=>P.map(H=>H.id===O.id?{...H,seen:O.seen||!1,snoozed_until:O.snoozed_until||null}:H))}else if(C.eventType==="DELETE"){const O=C.old;i(P=>P.filter(H=>H.id!==O.id))}}).on("broadcast",{event:"clear-action"},C=>{C.payload.type==="clearSeen"?i(O=>O.filter(P=>!P.seen)):C.payload.type==="clearUnseen"?i(O=>O.filter(P=>P.seen)):C.payload.type==="clearAll"&&i([])}).subscribe(C=>{C==="SUBSCRIBED"&&console.log("[Reminder] Reminders channel subscribed")}),T=be.channel("signatures-sync").on("postgres_changes",{event:"INSERT",schema:"public",table:"reminder_signatures",filter:`user_id=eq.${r.id}`},C=>{const O=C.new;u(P=>P[O.task_id]===O.signature?P:{...P,[O.task_id]:O.signature})}).subscribe(C=>{C==="SUBSCRIBED"&&console.log("[Reminder] Signatures channel subscribed")});return()=>{console.log("[Reminder] Unsubscribing..."),be.removeChannel(S),be.removeChannel(T)}},[r==null?void 0:r.id,d]),x.useEffect(()=>{!p.current||d||localStorage.setItem(c2,JSON.stringify(s))},[s,d]),x.useEffect(()=>{!p.current||d||localStorage.setItem(u2,JSON.stringify(l))},[l,d]);const w=x.useCallback(async(S,T,C=!0)=>{const O=g.current.find(H=>H.id===S);if(!O)return;const P=O.start_date||O.due_date;if(P){if(v.current&&be&&(r!=null&&r.id)){const{error:H}=await be.from("reminder_signatures").insert([{user_id:r.id,task_id:S,signature:T}]);if(H){const{data:I}=await be.from("reminder_signatures").select("signature").eq("user_id",r.id).eq("task_id",S).single();if(I&&I.signature===T){u(K=>({...K,[S]:T}));return}I&&await be.from("reminder_signatures").update({signature:T}).eq("user_id",r.id).eq("task_id",S)}const M=(await hw(()=>import("./index-c620dda6.js"),[])).v4();await be.from("reminders").insert([{id:M,user_id:r.id,task_id:S,task_title:O.title,task_color:O.color,triggered_at:new Date().toISOString(),due_time:P,seen:!1}]),u(I=>({...I,[S]:T}))}else{const H={id:`${S}_${Date.now()}`,task_id:S,task_title:O.title,task_color:O.color,triggered_at:new Date().toISOString(),due_time:P,seen:!1,snoozed_until:null};i(M=>[H,...M]),u(M=>({...M,[S]:T})),C&&(n({type:"info",msg:` : ${O.title}`,actionLabel:"",onClick:()=>a(!0)}),"Notification"in window&&Notification.permission==="granted"&&(new Notification("",{body:O.title,icon:"/favicon.ico"}).onclick=()=>{window.focus(),a(!0)}),a(!0))}v.current&&C&&(n({type:"info",msg:` : ${O.title}`,actionLabel:"",onClick:()=>a(!0)}),"Notification"in window&&Notification.permission==="granted"&&(new Notification("",{body:O.title,icon:"/favicon.ico"}).onclick=()=>{window.focus(),a(!0)}),a(!0))}},[n,r==null?void 0:r.id]),_=x.useCallback(async S=>{i(T=>T.map(C=>C.id===S?{...C,seen:!0}:C)),v.current&&be&&await be.from("reminders").update({seen:!0}).eq("id",S)},[]),D=x.useCallback(async(S,T)=>{const C=new Date(Date.now()+T*60*1e3).toISOString();i(O=>O.map(P=>P.id===S?{...P,snoozed_until:C,seen:!0}:P)),n({type:"info",msg:`  ${T} `}),v.current&&be&&await be.from("reminders").update({snoozed_until:C,seen:!0}).eq("id",S)},[n]),k=x.useCallback(async()=>{const T=y.current.filter(C=>C.seen).map(C=>C.id);i(C=>C.filter(O=>!O.seen)),v.current&&be&&T.length>0&&(await be.channel("reminders-sync").send({type:"broadcast",event:"clear-action",payload:{type:"clearSeen"}}),await be.from("reminders").delete().in("id",T))},[]),A=x.useCallback(async()=>{const T=y.current.filter(C=>!C.seen).map(C=>C.id);i(C=>C.filter(O=>O.seen)),v.current&&be&&T.length>0&&(await be.channel("reminders-sync").send({type:"broadcast",event:"clear-action",payload:{type:"clearUnseen"}}),await be.from("reminders").delete().in("id",T))},[]),N=x.useCallback(async()=>{i([]),v.current&&be&&(r!=null&&r.id)&&(await be.channel("reminders-sync").send({type:"broadcast",event:"clear-action",payload:{type:"clearAll"}}),await be.from("reminders").delete().eq("user_id",r.id))},[r==null?void 0:r.id]),E=x.useCallback(()=>{if(!p.current)return;const S=new Date,T=g.current,C=b.current;T.forEach(O=>{if(["completed","deleted","canceled"].includes(O.status))return;const P=O.start_date||O.due_date;if(!P)return;let H;if(O.is_all_day||!O.start_time)H=new Date(P),P.includes("T")||H.setHours(0,0,0,0);else{const[G,R]=(O.start_time||"00:00").split(":").map(Number),Ee=P.split("T")[0];H=new Date(Ee),H.setHours(G,R,0,0)}let M=O.reminder_minutes;if(M===void 0)try{const G=localStorage.getItem(`task_reminder_${O.id}`);G&&(M=JSON.parse(G))}catch{}if(M===void 0&&!O.is_all_day&&O.start_time&&(M=0),M==null)return;const I=new Date(H.getTime()-M*60*1e3),K=`${H.getTime()}_${M}`;C[O.id]!==K&&S>=I&&w(O.id,K,!0)}),y.current.forEach(async O=>{if(O.snoozed_until){const P=new Date(O.snoozed_until);S>=P&&(T.find(M=>M.id===O.task_id)&&(n({type:"info",msg:` : ${O.task_title}`,actionLabel:"",onClick:()=>a(!0)}),"Notification"in window&&Notification.permission==="granted"&&(new Notification("",{body:O.task_title}).onclick=()=>{window.focus(),a(!0)}),a(!0)),i(M=>M.map(I=>I.id===O.id?{...I,snoozed_until:null,seen:!1}:I)),v.current&&be&&await be.from("reminders").update({snoozed_until:null,seen:!1}).eq("id",O.id))}})},[w,n]);return x.useEffect(()=>{const S=setTimeout(E,2e3);return h.current=setInterval(E,q6),()=>{clearTimeout(S),h.current&&clearInterval(h.current)}},[E]),c.jsx(_I.Provider,{value:{reminders:s,addReminder:w,markAsSeen:_,snoozeReminder:D,clearAllSeen:k,clearAllUnseen:A,clearAll:N,unseenCount:s.filter(S=>!S.seen).length,isReminderPanelOpen:o,setIsReminderPanelOpen:a},children:t})};var J6={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const X6=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Q6=(t,e)=>{const n=x.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:a,...l},u)=>x.createElement("svg",{ref:u,...J6,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:`lucide lucide-${X6(t)}`,...l},[...e.map(([d,f])=>x.createElement(d,f)),...(Array.isArray(a)?a:[a])||[]]));return n.displayName=`${t}`,n};var vt=Q6;const Jf=vt("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Z6=vt("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),am=vt("Archive",[["rect",{width:"20",height:"5",x:"2",y:"4",rx:"2",key:"uhwcea"}],["path",{d:"M4 9v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9",key:"shkvi4"}],["path",{d:"M10 13h4",key:"ytezjc"}]]),TI=vt("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Nw=vt("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),ez=vt("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),tz=vt("AtSign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),t1=vt("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Va=vt("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),nz=vt("Bold",[["path",{d:"M14 12a4 4 0 0 0 0-8H6v8",key:"v2sylx"}],["path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z",key:"1ef5ya"}]]),xf=vt("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]),CI=vt("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}]]),rz=vt("Bot",[["rect",{width:"18",height:"10",x:"3",y:"11",rx:"2",key:"1ofdy3"}],["circle",{cx:"12",cy:"5",r:"2",key:"f1ur92"}],["path",{d:"M12 7v4",key:"xawao1"}],["line",{x1:"8",x2:"8",y1:"16",y2:"16",key:"h6x27f"}],["line",{x1:"16",x2:"16",y1:"16",y2:"16",key:"5lty7f"}]]),fd=vt("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),sz=vt("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]),EI=vt("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]),So=vt("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),bf=vt("CheckCircle2",[["path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",key:"14v8dr"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),iz=vt("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),Zn=vt("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),rs=vt("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Ou=vt("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),is=vt("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),yp=vt("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),oz=vt("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Oi=vt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),az=vt("CloudLightning",[["path",{d:"M6 16.326A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 .5 8.973",key:"1cez44"}],["path",{d:"m13 12-3 5h4l-3 5",key:"1t22er"}]]),lz=vt("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),cz=vt("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]),uz=vt("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]),NI=vt("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),dz=vt("CornerDownRight",[["polyline",{points:"15 10 20 15 15 20",key:"1q7qjw"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),jI=vt("CornerUpLeft",[["polyline",{points:"9 14 4 9 9 4",key:"881910"}],["path",{d:"M20 20v-7a4 4 0 0 0-4-4H4",key:"1nkjon"}]]),fz=vt("Crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]),iu=vt("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),II=vt("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),hz=vt("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Xf=vt("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),pz=vt("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),mz=vt("FolderKanban",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]]),gz=vt("FolderOpen",[["path",{d:"m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.93a2 2 0 0 1 1.66.9l.82 1.2a2 2 0 0 0 1.66.9H18a2 2 0 0 1 2 2v2",key:"1nmvlm"}]]),yz=vt("FolderPlus",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["line",{x1:"12",x2:"12",y1:"10",y2:"16",key:"3c25pp"}],["line",{x1:"9",x2:"15",y1:"13",y2:"13",key:"10hoct"}]]),xz=vt("FolderTree",[["path",{d:"M13 10h7a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"10jzg2"}],["path",{d:"M13 21h7a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.88a1 1 0 0 1-.9-.55l-.44-.9a1 1 0 0 0-.9-.55H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"1b9nqm"}],["path",{d:"M3 3v2c0 1.1.9 2 2 2h3",key:"1wqwis"}],["path",{d:"M3 3v13c0 1.1.9 2 2 2h3",key:"1bqeom"}]]),bz=vt("GanttChartSquare",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 8h7",key:"kbo1nt"}],["path",{d:"M8 12h6",key:"ikassy"}],["path",{d:"M11 16h5",key:"oq65wt"}]]),MI=vt("GripHorizontal",[["circle",{cx:"12",cy:"9",r:"1",key:"124mty"}],["circle",{cx:"19",cy:"9",r:"1",key:"1ruzo2"}],["circle",{cx:"5",cy:"9",r:"1",key:"1a8b28"}],["circle",{cx:"12",cy:"15",r:"1",key:"1e56xg"}],["circle",{cx:"19",cy:"15",r:"1",key:"1a92ep"}],["circle",{cx:"5",cy:"15",r:"1",key:"5r1jwy"}]]),DI=vt("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),wz=vt("Hammer",[["path",{d:"m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9",key:"1afvon"}],["path",{d:"M17.64 15 22 10.64",key:"zsji6s"}],["path",{d:"m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25v-.86L16.01 4.6a5.56 5.56 0 0 0-3.94-1.64H9l.92.82A6.18 6.18 0 0 1 12 8.4v1.56l2 2h2.47l2.26 1.91",key:"lehyy1"}]]),vz=vt("Heading1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]),kz=vt("Heading2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]),ou=vt("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),Sz=vt("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),_z=vt("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),wf=vt("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),n1=vt("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]),AI=vt("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Tz=vt("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]),RI=vt("Layers",[["polygon",{points:"12 2 2 7 12 12 22 7 12 2",key:"1b0ttc"}],["polyline",{points:"2 17 12 22 22 17",key:"imjtdl"}],["polyline",{points:"2 12 12 17 22 12",key:"5dexcv"}]]),OI=vt("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),r1=vt("Layout",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"3",x2:"21",y1:"9",y2:"9",key:"1vqk6q"}],["line",{x1:"9",x2:"9",y1:"21",y2:"9",key:"wpwpyp"}]]),Cz=vt("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),d2=vt("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),Ez=vt("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]),Nz=vt("ListTodo",[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]),PI=vt("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),xi=vt("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),jz=vt("LocateFixed",[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Pa=vt("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Iz=vt("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Mz=vt("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Dz=vt("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),LI=vt("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Az=vt("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),Rz=vt("MoveRight",[["path",{d:"M18 8L22 12L18 16",key:"1r0oui"}],["path",{d:"M2 12H22",key:"1m8cig"}]]),jw=vt("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),Oz=vt("PanelLeftClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]]),Pz=vt("PanelLeftOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]]),go=vt("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),$I=vt("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),Iw=vt("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),Mg=vt("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),zI=vt("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),ri=vt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Mw=vt("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]),s1=vt("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),FI=vt("Repeat2",[["path",{d:"m2 9 3-3 3 3",key:"1ltn5i"}],["path",{d:"M13 18H7a2 2 0 0 1-2-2V6",key:"1r6tfw"}],["path",{d:"m22 15-3 3-3-3",key:"4rnwn2"}],["path",{d:"M11 6h6a2 2 0 0 1 2 2v10",key:"2f72bc"}]]),Lz=vt("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]),BI=vt("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),$z=vt("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),UI=vt("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Hc=vt("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),zz=vt("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Fz=vt("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),HI=vt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Bz=vt("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),Uz=vt("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]),Rs=vt("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),Hz=vt("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),VI=vt("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Ll=vt("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),WI=vt("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),jr=vt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Vz=vt("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),Dg=vt("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]),i1=vt("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),Wz=vt("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),KI=vt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Kz=vt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),o1=vt("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),Gz=vt("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]),a1=vt("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),qz=vt("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),hn=vt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function l1(t,e){x.useEffect(()=>{const n=r=>{!t.current||t.current.contains(r.target)||e(r)};return document.addEventListener("mousedown",n),document.addEventListener("touchstart",n),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)}},[t,e])}const vf=x.createContext({});function Dw(t){const e=x.useRef(null);return e.current===null&&(e.current=t()),e.current}const Aw=typeof window<"u",Rw=Aw?x.useLayoutEffect:x.useEffect,Ag=x.createContext(null);function Ow(t,e){t.indexOf(e)===-1&&t.push(e)}function Pw(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const Zo=(t,e,n)=>n>e?e:n<t?t:n;let Lw=()=>{};const ea={},GI=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function qI(t){return typeof t=="object"&&t!==null}const YI=t=>/^0[^.\s]+$/u.test(t);function $w(t){let e;return()=>(e===void 0&&(e=t()),e)}const Ni=t=>t,Yz=(t,e)=>n=>e(t(n)),Qf=(...t)=>t.reduce(Yz),kf=(t,e,n)=>{const r=e-t;return r===0?1:(n-t)/r};class zw{constructor(){this.subscriptions=[]}add(e){return Ow(this.subscriptions,e),()=>Pw(this.subscriptions,e)}notify(e,n,r){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](e,n,r);else for(let i=0;i<s;i++){const o=this.subscriptions[i];o&&o(e,n,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const wo=t=>t*1e3,Ci=t=>t/1e3;function JI(t,e){return e?t*(1e3/e):0}const XI=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,Jz=1e-7,Xz=12;function Qz(t,e,n,r,s){let i,o,a=0;do o=e+(n-e)/2,i=XI(o,r,s)-t,i>0?n=o:e=o;while(Math.abs(i)>Jz&&++a<Xz);return o}function Zf(t,e,n,r){if(t===e&&n===r)return Ni;const s=i=>Qz(i,0,1,t,n);return i=>i===0||i===1?i:XI(s(i),e,r)}const QI=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,ZI=t=>e=>1-t(1-e),eM=Zf(.33,1.53,.69,.99),Fw=ZI(eM),tM=QI(Fw),nM=t=>(t*=2)<1?.5*Fw(t):.5*(2-Math.pow(2,-10*(t-1))),Bw=t=>1-Math.sin(Math.acos(t)),rM=ZI(Bw),sM=QI(Bw),Zz=Zf(.42,0,1,1),eF=Zf(0,0,.58,1),iM=Zf(.42,0,.58,1),tF=t=>Array.isArray(t)&&typeof t[0]!="number",oM=t=>Array.isArray(t)&&typeof t[0]=="number",nF={linear:Ni,easeIn:Zz,easeInOut:iM,easeOut:eF,circIn:Bw,circInOut:sM,circOut:rM,backIn:Fw,backInOut:tM,backOut:eM,anticipate:nM},rF=t=>typeof t=="string",f2=t=>{if(oM(t)){Lw(t.length===4);const[e,n,r,s]=t;return Zf(e,n,r,s)}else if(rF(t))return nF[t];return t},Dh=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],h2={value:null,addProjectionMetrics:null};function sF(t,e){let n=new Set,r=new Set,s=!1,i=!1;const o=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1},l=0;function u(f){o.has(f)&&(d.schedule(f),t()),l++,f(a)}const d={schedule:(f,h=!1,p=!1)=>{const y=p&&s?n:r;return h&&o.add(f),y.has(f)||y.add(f),f},cancel:f=>{r.delete(f),o.delete(f)},process:f=>{if(a=f,s){i=!0;return}s=!0,[n,r]=[r,n],n.forEach(u),e&&h2.value&&h2.value.frameloop[e].push(l),l=0,n.clear(),s=!1,i&&(i=!1,d.process(f))}};return d}const iF=40;function aM(t,e){let n=!1,r=!0;const s={delta:0,timestamp:0,isProcessing:!1},i=()=>n=!0,o=Dh.reduce((w,_)=>(w[_]=sF(i,e?_:void 0),w),{}),{setup:a,read:l,resolveKeyframes:u,preUpdate:d,update:f,preRender:h,render:p,postRender:m}=o,y=()=>{const w=ea.useManualTiming?s.timestamp:performance.now();n=!1,ea.useManualTiming||(s.delta=r?1e3/60:Math.max(Math.min(w-s.timestamp,iF),1)),s.timestamp=w,s.isProcessing=!0,a.process(s),l.process(s),u.process(s),d.process(s),f.process(s),h.process(s),p.process(s),m.process(s),s.isProcessing=!1,n&&e&&(r=!1,t(y))},b=()=>{n=!0,r=!0,s.isProcessing||t(y)};return{schedule:Dh.reduce((w,_)=>{const D=o[_];return w[_]=(k,A=!1,N=!1)=>(n||b(),D.schedule(k,A,N)),w},{}),cancel:w=>{for(let _=0;_<Dh.length;_++)o[Dh[_]].cancel(w)},state:s,steps:o}}const{schedule:tr,cancel:Wa,state:Zr,steps:V0}=aM(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ni,!0);let xp;function oF(){xp=void 0}const Fs={now:()=>(xp===void 0&&Fs.set(Zr.isProcessing||ea.useManualTiming?Zr.timestamp:performance.now()),xp),set:t=>{xp=t,queueMicrotask(oF)}},lM=t=>e=>typeof e=="string"&&e.startsWith(t),cM=lM("--"),aF=lM("var(--"),Uw=t=>aF(t)?lF.test(t.split("/*")[0].trim()):!1,lF=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Pu={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},Sf={...Pu,transform:t=>Zo(0,1,t)},Ah={...Pu,default:1},jd=t=>Math.round(t*1e5)/1e5,Hw=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function cF(t){return t==null}const uF=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Vw=(t,e)=>n=>!!(typeof n=="string"&&uF.test(n)&&n.startsWith(t)||e&&!cF(n)&&Object.prototype.hasOwnProperty.call(n,e)),uM=(t,e,n)=>r=>{if(typeof r!="string")return r;const[s,i,o,a]=r.match(Hw);return{[t]:parseFloat(s),[e]:parseFloat(i),[n]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},dF=t=>Zo(0,255,t),W0={...Pu,transform:t=>Math.round(dF(t))},Nl={test:Vw("rgb","red"),parse:uM("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:r=1})=>"rgba("+W0.transform(t)+", "+W0.transform(e)+", "+W0.transform(n)+", "+jd(Sf.transform(r))+")"};function fF(t){let e="",n="",r="",s="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),r=t.substring(5,7),s=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),r=t.substring(3,4),s=t.substring(4,5),e+=e,n+=n,r+=r,s+=s),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:s?parseInt(s,16)/255:1}}const c1={test:Vw("#"),parse:fF,transform:Nl.transform},eh=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),ca=eh("deg"),vo=eh("%"),un=eh("px"),hF=eh("vh"),pF=eh("vw"),p2=(()=>({...vo,parse:t=>vo.parse(t)/100,transform:t=>vo.transform(t*100)}))(),Vc={test:Vw("hsl","hue"),parse:uM("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:r=1})=>"hsla("+Math.round(t)+", "+vo.transform(jd(e))+", "+vo.transform(jd(n))+", "+jd(Sf.transform(r))+")"},Er={test:t=>Nl.test(t)||c1.test(t)||Vc.test(t),parse:t=>Nl.test(t)?Nl.parse(t):Vc.test(t)?Vc.parse(t):c1.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?Nl.transform(t):Vc.transform(t),getAnimatableNone:t=>{const e=Er.parse(t);return e.alpha=0,Er.transform(e)}},mF=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function gF(t){var e,n;return isNaN(t)&&typeof t=="string"&&(((e=t.match(Hw))==null?void 0:e.length)||0)+(((n=t.match(mF))==null?void 0:n.length)||0)>0}const dM="number",fM="color",yF="var",xF="var(",m2="${}",bF=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function _f(t){const e=t.toString(),n=[],r={color:[],number:[],var:[]},s=[];let i=0;const a=e.replace(bF,l=>(Er.test(l)?(r.color.push(i),s.push(fM),n.push(Er.parse(l))):l.startsWith(xF)?(r.var.push(i),s.push(yF),n.push(l)):(r.number.push(i),s.push(dM),n.push(parseFloat(l))),++i,m2)).split(m2);return{values:n,split:a,indexes:r,types:s}}function hM(t){return _f(t).values}function pM(t){const{split:e,types:n}=_f(t),r=e.length;return s=>{let i="";for(let o=0;o<r;o++)if(i+=e[o],s[o]!==void 0){const a=n[o];a===dM?i+=jd(s[o]):a===fM?i+=Er.transform(s[o]):i+=s[o]}return i}}const wF=t=>typeof t=="number"?0:Er.test(t)?Er.getAnimatableNone(t):t;function vF(t){const e=hM(t);return pM(t)(e.map(wF))}const Ka={test:gF,parse:hM,createTransformer:pM,getAnimatableNone:vF};function K0(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function kF({hue:t,saturation:e,lightness:n,alpha:r}){t/=360,e/=100,n/=100;let s=0,i=0,o=0;if(!e)s=i=o=n;else{const a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;s=K0(l,a,t+1/3),i=K0(l,a,t),o=K0(l,a,t-1/3)}return{red:Math.round(s*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:r}}function lm(t,e){return n=>n>0?e:t}const fr=(t,e,n)=>t+(e-t)*n,G0=(t,e,n)=>{const r=t*t,s=n*(e*e-r)+r;return s<0?0:Math.sqrt(s)},SF=[c1,Nl,Vc],_F=t=>SF.find(e=>e.test(t));function g2(t){const e=_F(t);if(!e)return!1;let n=e.parse(t);return e===Vc&&(n=kF(n)),n}const y2=(t,e)=>{const n=g2(t),r=g2(e);if(!n||!r)return lm(t,e);const s={...n};return i=>(s.red=G0(n.red,r.red,i),s.green=G0(n.green,r.green,i),s.blue=G0(n.blue,r.blue,i),s.alpha=fr(n.alpha,r.alpha,i),Nl.transform(s))},u1=new Set(["none","hidden"]);function TF(t,e){return u1.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function CF(t,e){return n=>fr(t,e,n)}function Ww(t){return typeof t=="number"?CF:typeof t=="string"?Uw(t)?lm:Er.test(t)?y2:jF:Array.isArray(t)?mM:typeof t=="object"?Er.test(t)?y2:EF:lm}function mM(t,e){const n=[...t],r=n.length,s=t.map((i,o)=>Ww(i)(i,e[o]));return i=>{for(let o=0;o<r;o++)n[o]=s[o](i);return n}}function EF(t,e){const n={...t,...e},r={};for(const s in n)t[s]!==void 0&&e[s]!==void 0&&(r[s]=Ww(t[s])(t[s],e[s]));return s=>{for(const i in r)n[i]=r[i](s);return n}}function NF(t,e){const n=[],r={color:0,var:0,number:0};for(let s=0;s<e.values.length;s++){const i=e.types[s],o=t.indexes[i][r[i]],a=t.values[o]??0;n[s]=a,r[i]++}return n}const jF=(t,e)=>{const n=Ka.createTransformer(e),r=_f(t),s=_f(e);return r.indexes.var.length===s.indexes.var.length&&r.indexes.color.length===s.indexes.color.length&&r.indexes.number.length>=s.indexes.number.length?u1.has(t)&&!s.values.length||u1.has(e)&&!r.values.length?TF(t,e):Qf(mM(NF(r,s),s.values),n):lm(t,e)};function gM(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?fr(t,e,n):Ww(t)(t,e)}const IF=t=>{const e=({timestamp:n})=>t(n);return{start:(n=!0)=>tr.update(e,n),stop:()=>Wa(e),now:()=>Zr.isProcessing?Zr.timestamp:Fs.now()}},yM=(t,e,n=10)=>{let r="";const s=Math.max(Math.round(e/n),2);for(let i=0;i<s;i++)r+=Math.round(t(i/(s-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},cm=2e4;function Kw(t){let e=0;const n=50;let r=t.next(e);for(;!r.done&&e<cm;)e+=n,r=t.next(e);return e>=cm?1/0:e}function MF(t,e=100,n){const r=n({...t,keyframes:[0,e]}),s=Math.min(Kw(r),cm);return{type:"keyframes",ease:i=>r.next(s*i).value/e,duration:Ci(s)}}const DF=5;function xM(t,e,n){const r=Math.max(e-DF,0);return JI(n-t(r),e-r)}const yr={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},q0=.001;function AF({duration:t=yr.duration,bounce:e=yr.bounce,velocity:n=yr.velocity,mass:r=yr.mass}){let s,i,o=1-e;o=Zo(yr.minDamping,yr.maxDamping,o),t=Zo(yr.minDuration,yr.maxDuration,Ci(t)),o<1?(s=u=>{const d=u*o,f=d*t,h=d-n,p=d1(u,o),m=Math.exp(-f);return q0-h/p*m},i=u=>{const f=u*o*t,h=f*n+n,p=Math.pow(o,2)*Math.pow(u,2)*t,m=Math.exp(-f),y=d1(Math.pow(u,2),o);return(-s(u)+q0>0?-1:1)*((h-p)*m)/y}):(s=u=>{const d=Math.exp(-u*t),f=(u-n)*t+1;return-q0+d*f},i=u=>{const d=Math.exp(-u*t),f=(n-u)*(t*t);return d*f});const a=5/t,l=OF(s,i,a);if(t=wo(t),isNaN(l))return{stiffness:yr.stiffness,damping:yr.damping,duration:t};{const u=Math.pow(l,2)*r;return{stiffness:u,damping:o*2*Math.sqrt(r*u),duration:t}}}const RF=12;function OF(t,e,n){let r=n;for(let s=1;s<RF;s++)r=r-t(r)/e(r);return r}function d1(t,e){return t*Math.sqrt(1-e*e)}const PF=["duration","bounce"],LF=["stiffness","damping","mass"];function x2(t,e){return e.some(n=>t[n]!==void 0)}function $F(t){let e={velocity:yr.velocity,stiffness:yr.stiffness,damping:yr.damping,mass:yr.mass,isResolvedFromDuration:!1,...t};if(!x2(t,LF)&&x2(t,PF))if(t.visualDuration){const n=t.visualDuration,r=2*Math.PI/(n*1.2),s=r*r,i=2*Zo(.05,1,1-(t.bounce||0))*Math.sqrt(s);e={...e,mass:yr.mass,stiffness:s,damping:i}}else{const n=AF(t);e={...e,...n,mass:yr.mass},e.isResolvedFromDuration=!0}return e}function um(t=yr.visualDuration,e=yr.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:r,restDelta:s}=n;const i=n.keyframes[0],o=n.keyframes[n.keyframes.length-1],a={done:!1,value:i},{stiffness:l,damping:u,mass:d,duration:f,velocity:h,isResolvedFromDuration:p}=$F({...n,velocity:-Ci(n.velocity||0)}),m=h||0,y=u/(2*Math.sqrt(l*d)),b=o-i,g=Ci(Math.sqrt(l/d)),v=Math.abs(b)<5;r||(r=v?yr.restSpeed.granular:yr.restSpeed.default),s||(s=v?yr.restDelta.granular:yr.restDelta.default);let w;if(y<1){const D=d1(g,y);w=k=>{const A=Math.exp(-y*g*k);return o-A*((m+y*g*b)/D*Math.sin(D*k)+b*Math.cos(D*k))}}else if(y===1)w=D=>o-Math.exp(-g*D)*(b+(m+g*b)*D);else{const D=g*Math.sqrt(y*y-1);w=k=>{const A=Math.exp(-y*g*k),N=Math.min(D*k,300);return o-A*((m+y*g*b)*Math.sinh(N)+D*b*Math.cosh(N))/D}}const _={calculatedDuration:p&&f||null,next:D=>{const k=w(D);if(p)a.done=D>=f;else{let A=D===0?m:0;y<1&&(A=D===0?wo(m):xM(w,D,k));const N=Math.abs(A)<=r,E=Math.abs(o-k)<=s;a.done=N&&E}return a.value=a.done?o:k,a},toString:()=>{const D=Math.min(Kw(_),cm),k=yM(A=>_.next(D*A).value,D,30);return D+"ms "+k},toTransition:()=>{}};return _}um.applyToOptions=t=>{const e=MF(t,100,um);return t.ease=e.ease,t.duration=wo(e.duration),t.type="keyframes",t};function f1({keyframes:t,velocity:e=0,power:n=.8,timeConstant:r=325,bounceDamping:s=10,bounceStiffness:i=500,modifyTarget:o,min:a,max:l,restDelta:u=.5,restSpeed:d}){const f=t[0],h={done:!1,value:f},p=N=>a!==void 0&&N<a||l!==void 0&&N>l,m=N=>a===void 0?l:l===void 0||Math.abs(a-N)<Math.abs(l-N)?a:l;let y=n*e;const b=f+y,g=o===void 0?b:o(b);g!==b&&(y=g-f);const v=N=>-y*Math.exp(-N/r),w=N=>g+v(N),_=N=>{const E=v(N),S=w(N);h.done=Math.abs(E)<=u,h.value=h.done?g:S};let D,k;const A=N=>{p(h.value)&&(D=N,k=um({keyframes:[h.value,m(h.value)],velocity:xM(w,N,h.value),damping:s,stiffness:i,restDelta:u,restSpeed:d}))};return A(0),{calculatedDuration:null,next:N=>{let E=!1;return!k&&D===void 0&&(E=!0,_(N),A(N)),D!==void 0&&N>=D?k.next(N-D):(!E&&_(N),h)}}}function zF(t,e,n){const r=[],s=n||ea.mix||gM,i=t.length-1;for(let o=0;o<i;o++){let a=s(t[o],t[o+1]);if(e){const l=Array.isArray(e)?e[o]||Ni:e;a=Qf(l,a)}r.push(a)}return r}function FF(t,e,{clamp:n=!0,ease:r,mixer:s}={}){const i=t.length;if(Lw(i===e.length),i===1)return()=>e[0];if(i===2&&e[0]===e[1])return()=>e[1];const o=t[0]===t[1];t[0]>t[i-1]&&(t=[...t].reverse(),e=[...e].reverse());const a=zF(e,r,s),l=a.length,u=d=>{if(o&&d<t[0])return e[0];let f=0;if(l>1)for(;f<t.length-2&&!(d<t[f+1]);f++);const h=kf(t[f],t[f+1],d);return a[f](h)};return n?d=>u(Zo(t[0],t[i-1],d)):u}function BF(t,e){const n=t[t.length-1];for(let r=1;r<=e;r++){const s=kf(0,e,r);t.push(fr(n,1,s))}}function UF(t){const e=[0];return BF(e,t.length-1),e}function HF(t,e){return t.map(n=>n*e)}function VF(t,e){return t.map(()=>e||iM).splice(0,t.length-1)}function Id({duration:t=300,keyframes:e,times:n,ease:r="easeInOut"}){const s=tF(r)?r.map(f2):f2(r),i={done:!1,value:e[0]},o=HF(n&&n.length===e.length?n:UF(e),t),a=FF(o,e,{ease:Array.isArray(s)?s:VF(e,s)});return{calculatedDuration:t,next:l=>(i.value=a(l),i.done=l>=t,i)}}const WF=t=>t!==null;function Gw(t,{repeat:e,repeatType:n="loop"},r,s=1){const i=t.filter(WF),a=s<0||e&&n!=="loop"&&e%2===1?0:i.length-1;return!a||r===void 0?i[a]:r}const KF={decay:f1,inertia:f1,tween:Id,keyframes:Id,spring:um};function bM(t){typeof t.type=="string"&&(t.type=KF[t.type])}class qw{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,n){return this.finished.then(e,n)}}const GF=t=>t/100;class Yw extends qw{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var r,s;const{motionValue:n}=this.options;n&&n.updatedAt!==Fs.now()&&this.tick(Fs.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(s=(r=this.options).onStop)==null||s.call(r))},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;bM(e);const{type:n=Id,repeat:r=0,repeatDelay:s=0,repeatType:i,velocity:o=0}=e;let{keyframes:a}=e;const l=n||Id;l!==Id&&typeof a[0]!="number"&&(this.mixKeyframes=Qf(GF,gM(a[0],a[1])),a=[0,100]);const u=l({...e,keyframes:a});i==="mirror"&&(this.mirroredGenerator=l({...e,keyframes:[...a].reverse(),velocity:-o})),u.calculatedDuration===null&&(u.calculatedDuration=Kw(u));const{calculatedDuration:d}=u;this.calculatedDuration=d,this.resolvedDuration=d+s,this.totalDuration=this.resolvedDuration*(r+1)-s,this.generator=u}updateTime(e){const n=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(e,n=!1){const{generator:r,totalDuration:s,mixKeyframes:i,mirroredGenerator:o,resolvedDuration:a,calculatedDuration:l}=this;if(this.startTime===null)return r.next(0);const{delay:u=0,keyframes:d,repeat:f,repeatType:h,repeatDelay:p,type:m,onUpdate:y,finalKeyframe:b}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-s/this.speed,this.startTime)),n?this.currentTime=e:this.updateTime(e);const g=this.currentTime-u*(this.playbackSpeed>=0?1:-1),v=this.playbackSpeed>=0?g<0:g>s;this.currentTime=Math.max(g,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=s);let w=this.currentTime,_=r;if(f){const N=Math.min(this.currentTime,s)/a;let E=Math.floor(N),S=N%1;!S&&N>=1&&(S=1),S===1&&E--,E=Math.min(E,f+1),!!(E%2)&&(h==="reverse"?(S=1-S,p&&(S-=p/a)):h==="mirror"&&(_=o)),w=Zo(0,1,S)*a}const D=v?{done:!1,value:d[0]}:_.next(w);i&&(D.value=i(D.value));let{done:k}=D;!v&&l!==null&&(k=this.playbackSpeed>=0?this.currentTime>=s:this.currentTime<=0);const A=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&k);return A&&m!==f1&&(D.value=Gw(d,this.options,b,this.speed)),y&&y(D.value),A&&this.finish(),D}then(e,n){return this.finished.then(e,n)}get duration(){return Ci(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Ci(e)}get time(){return Ci(this.currentTime)}set time(e){var n;e=wo(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),(n=this.driver)==null||n.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Fs.now());const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=Ci(this.currentTime))}play(){var s,i;if(this.isStopped)return;const{driver:e=IF,startTime:n}=this.options;this.driver||(this.driver=e(o=>this.tick(o))),(i=(s=this.options).onPlay)==null||i.call(s);const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=n??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Fs.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,n;this.notifyFinished(),this.teardown(),this.state="finished",(n=(e=this.options).onComplete)==null||n.call(e)}cancel(){var e,n;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(n=(e=this.options).onCancel)==null||n.call(e)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var n;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(n=this.driver)==null||n.stop(),e.observe(this)}}function qF(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const jl=t=>t*180/Math.PI,h1=t=>{const e=jl(Math.atan2(t[1],t[0]));return p1(e)},YF={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:h1,rotateZ:h1,skewX:t=>jl(Math.atan(t[1])),skewY:t=>jl(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},p1=t=>(t=t%360,t<0&&(t+=360),t),b2=h1,w2=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),v2=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),JF={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:w2,scaleY:v2,scale:t=>(w2(t)+v2(t))/2,rotateX:t=>p1(jl(Math.atan2(t[6],t[5]))),rotateY:t=>p1(jl(Math.atan2(-t[2],t[0]))),rotateZ:b2,rotate:b2,skewX:t=>jl(Math.atan(t[4])),skewY:t=>jl(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function m1(t){return t.includes("scale")?1:0}function g1(t,e){if(!t||t==="none")return m1(e);const n=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,s;if(n)r=JF,s=n;else{const a=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=YF,s=a}if(!s)return m1(e);const i=r[e],o=s[1].split(",").map(QF);return typeof i=="function"?i(o):o[i]}const XF=(t,e)=>{const{transform:n="none"}=getComputedStyle(t);return g1(n,e)};function QF(t){return parseFloat(t.trim())}const Lu=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],$u=(()=>new Set(Lu))(),k2=t=>t===Pu||t===un,ZF=new Set(["x","y","z"]),eB=Lu.filter(t=>!ZF.has(t));function tB(t){const e=[];return eB.forEach(n=>{const r=t.getValue(n);r!==void 0&&(e.push([n,r.get()]),r.set(n.startsWith("scale")?1:0))}),e}const $l={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>g1(e,"x"),y:(t,{transform:e})=>g1(e,"y")};$l.translateX=$l.x;$l.translateY=$l.y;const zl=new Set;let y1=!1,x1=!1,b1=!1;function wM(){if(x1){const t=Array.from(zl).filter(r=>r.needsMeasurement),e=new Set(t.map(r=>r.element)),n=new Map;e.forEach(r=>{const s=tB(r);s.length&&(n.set(r,s),r.render())}),t.forEach(r=>r.measureInitialState()),e.forEach(r=>{r.render();const s=n.get(r);s&&s.forEach(([i,o])=>{var a;(a=r.getValue(i))==null||a.set(o)})}),t.forEach(r=>r.measureEndState()),t.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}x1=!1,y1=!1,zl.forEach(t=>t.complete(b1)),zl.clear()}function vM(){zl.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(x1=!0)})}function nB(){b1=!0,vM(),wM(),b1=!1}class Jw{constructor(e,n,r,s,i,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=r,this.motionValue=s,this.element=i,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(zl.add(this),y1||(y1=!0,tr.read(vM),tr.resolveKeyframes(wM))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:r,motionValue:s}=this;if(e[0]===null){const i=s==null?void 0:s.get(),o=e[e.length-1];if(i!==void 0)e[0]=i;else if(r&&n){const a=r.readValue(n,o);a!=null&&(e[0]=a)}e[0]===void 0&&(e[0]=o),s&&i===void 0&&s.set(e[0])}qF(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),zl.delete(this)}cancel(){this.state==="scheduled"&&(zl.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const rB=t=>t.startsWith("--");function sB(t,e,n){rB(e)?t.style.setProperty(e,n):t.style[e]=n}const iB=$w(()=>window.ScrollTimeline!==void 0),oB={};function aB(t,e){const n=$w(t);return()=>oB[e]??n()}const kM=aB(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),hd=([t,e,n,r])=>`cubic-bezier(${t}, ${e}, ${n}, ${r})`,S2={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:hd([0,.65,.55,1]),circOut:hd([.55,0,1,.45]),backIn:hd([.31,.01,.66,-.59]),backOut:hd([.33,1.53,.69,.99])};function SM(t,e){if(t)return typeof t=="function"?kM()?yM(t,e):"ease-out":oM(t)?hd(t):Array.isArray(t)?t.map(n=>SM(n,e)||S2.easeOut):S2[t]}function lB(t,e,n,{delay:r=0,duration:s=300,repeat:i=0,repeatType:o="loop",ease:a="easeOut",times:l}={},u=void 0){const d={[e]:n};l&&(d.offset=l);const f=SM(a,s);Array.isArray(f)&&(d.easing=f);const h={delay:r,duration:s,easing:Array.isArray(f)?"linear":f,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"};return u&&(h.pseudoElement=u),t.animate(d,h)}function _M(t){return typeof t=="function"&&"applyToOptions"in t}function cB({type:t,...e}){return _M(t)&&kM()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class uB extends qw{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:n,name:r,keyframes:s,pseudoElement:i,allowFlatten:o=!1,finalKeyframe:a,onComplete:l}=e;this.isPseudoElement=!!i,this.allowFlatten=o,this.options=e,Lw(typeof e.type!="string");const u=cB(e);this.animation=lB(n,r,s,u,i),u.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!i){const d=Gw(s,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(d):sB(n,r,d),this.animation.cancel()}l==null||l(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,n;(n=(e=this.animation).finish)==null||n.call(e)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,n;this.isPseudoElement||(n=(e=this.animation).commitStyles)==null||n.call(e)}get duration(){var n,r;const e=((r=(n=this.animation.effect)==null?void 0:n.getComputedTiming)==null?void 0:r.call(n).duration)||0;return Ci(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Ci(e)}get time(){return Ci(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=wo(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:n}){var r;return this.allowFlatten&&((r=this.animation.effect)==null||r.updateTiming({easing:"linear"})),this.animation.onfinish=null,e&&iB()?(this.animation.timeline=e,Ni):n(this)}}const TM={anticipate:nM,backInOut:tM,circInOut:sM};function dB(t){return t in TM}function fB(t){typeof t.ease=="string"&&dB(t.ease)&&(t.ease=TM[t.ease])}const _2=10;class hB extends uB{constructor(e){fB(e),bM(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:n,onUpdate:r,onComplete:s,element:i,...o}=this.options;if(!n)return;if(e!==void 0){n.set(e);return}const a=new Yw({...o,autoplay:!1}),l=wo(this.finishedTime??this.time);n.setWithVelocity(a.sample(l-_2).value,a.sample(l).value,_2),a.stop()}}const T2=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Ka.test(t)||t==="0")&&!t.startsWith("url("));function pB(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function mB(t,e,n,r){const s=t[0];if(s===null)return!1;if(e==="display"||e==="visibility")return!0;const i=t[t.length-1],o=T2(s,e),a=T2(i,e);return!o||!a?!1:pB(t)||(n==="spring"||_M(n))&&r}function w1(t){t.duration=0,t.type="keyframes"}const gB=new Set(["opacity","clipPath","filter","transform"]),yB=$w(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function xB(t){var d;const{motionValue:e,name:n,repeatDelay:r,repeatType:s,damping:i,type:o}=t;if(!(((d=e==null?void 0:e.owner)==null?void 0:d.current)instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:u}=e.owner.getProps();return yB()&&n&&gB.has(n)&&(n!=="transform"||!u)&&!l&&!r&&s!=="mirror"&&i!==0&&o!=="inertia"}const bB=40;class wB extends qw{constructor({autoplay:e=!0,delay:n=0,type:r="keyframes",repeat:s=0,repeatDelay:i=0,repeatType:o="loop",keyframes:a,name:l,motionValue:u,element:d,...f}){var m;super(),this.stop=()=>{var y,b;this._animation&&(this._animation.stop(),(y=this.stopTimeline)==null||y.call(this)),(b=this.keyframeResolver)==null||b.cancel()},this.createdAt=Fs.now();const h={autoplay:e,delay:n,type:r,repeat:s,repeatDelay:i,repeatType:o,name:l,motionValue:u,element:d,...f},p=(d==null?void 0:d.KeyframeResolver)||Jw;this.keyframeResolver=new p(a,(y,b,g)=>this.onKeyframesResolved(y,b,h,!g),l,u,d),(m=this.keyframeResolver)==null||m.scheduleResolve()}onKeyframesResolved(e,n,r,s){this.keyframeResolver=void 0;const{name:i,type:o,velocity:a,delay:l,isHandoff:u,onUpdate:d}=r;this.resolvedAt=Fs.now(),mB(e,i,o,a)||((ea.instantAnimations||!l)&&(d==null||d(Gw(e,r,n))),e[0]=e[e.length-1],w1(r),r.repeat=0);const h={startTime:s?this.resolvedAt?this.resolvedAt-this.createdAt>bB?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...r,keyframes:e},p=!u&&xB(h)?new hB({...h,element:h.motionValue.owner.current}):new Yw(h);p.finished.then(()=>this.notifyFinished()).catch(Ni),this.pendingTimeline&&(this.stopTimeline=p.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=p}get finished(){return this._animation?this.animation.finished:this._finished}then(e,n){return this.finished.finally(e).then(()=>{})}get animation(){var e;return this._animation||((e=this.keyframeResolver)==null||e.resume(),nB()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),(e=this.keyframeResolver)==null||e.cancel()}}const vB=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function kB(t){const e=vB.exec(t);if(!e)return[,];const[,n,r,s]=e;return[`--${n??r}`,s]}function CM(t,e,n=1){const[r,s]=kB(t);if(!r)return;const i=window.getComputedStyle(e).getPropertyValue(r);if(i){const o=i.trim();return GI(o)?parseFloat(o):o}return Uw(s)?CM(s,e,n+1):s}function Xw(t,e){return(t==null?void 0:t[e])??(t==null?void 0:t.default)??t}const EM=new Set(["width","height","top","left","right","bottom",...Lu]),SB={test:t=>t==="auto",parse:t=>t},NM=t=>e=>e.test(t),jM=[Pu,un,vo,ca,pF,hF,SB],C2=t=>jM.find(NM(t));function _B(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||YI(t):!0}const TB=new Set(["brightness","contrast","saturate","opacity"]);function CB(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[r]=n.match(Hw)||[];if(!r)return t;const s=n.replace(r,"");let i=TB.has(e)?1:0;return r!==n&&(i*=100),e+"("+i+s+")"}const EB=/\b([a-z-]*)\(.*?\)/gu,v1={...Ka,getAnimatableNone:t=>{const e=t.match(EB);return e?e.map(CB).join(" "):t}},E2={...Pu,transform:Math.round},NB={rotate:ca,rotateX:ca,rotateY:ca,rotateZ:ca,scale:Ah,scaleX:Ah,scaleY:Ah,scaleZ:Ah,skew:ca,skewX:ca,skewY:ca,distance:un,translateX:un,translateY:un,translateZ:un,x:un,y:un,z:un,perspective:un,transformPerspective:un,opacity:Sf,originX:p2,originY:p2,originZ:un},Qw={borderWidth:un,borderTopWidth:un,borderRightWidth:un,borderBottomWidth:un,borderLeftWidth:un,borderRadius:un,radius:un,borderTopLeftRadius:un,borderTopRightRadius:un,borderBottomRightRadius:un,borderBottomLeftRadius:un,width:un,maxWidth:un,height:un,maxHeight:un,top:un,right:un,bottom:un,left:un,padding:un,paddingTop:un,paddingRight:un,paddingBottom:un,paddingLeft:un,margin:un,marginTop:un,marginRight:un,marginBottom:un,marginLeft:un,backgroundPositionX:un,backgroundPositionY:un,...NB,zIndex:E2,fillOpacity:Sf,strokeOpacity:Sf,numOctaves:E2},jB={...Qw,color:Er,backgroundColor:Er,outlineColor:Er,fill:Er,stroke:Er,borderColor:Er,borderTopColor:Er,borderRightColor:Er,borderBottomColor:Er,borderLeftColor:Er,filter:v1,WebkitFilter:v1},IM=t=>jB[t];function MM(t,e){let n=IM(t);return n!==v1&&(n=Ka),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const IB=new Set(["auto","none","0"]);function MB(t,e,n){let r=0,s;for(;r<t.length&&!s;){const i=t[r];typeof i=="string"&&!IB.has(i)&&_f(i).values.length&&(s=t[r]),r++}if(s&&n)for(const i of e)t[i]=MM(n,s)}class DB extends Jw{constructor(e,n,r,s,i){super(e,n,r,s,i,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:r}=this;if(!n||!n.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let u=e[l];if(typeof u=="string"&&(u=u.trim(),Uw(u))){const d=CM(u,n.current);d!==void 0&&(e[l]=d),l===e.length-1&&(this.finalKeyframe=u)}}if(this.resolveNoneKeyframes(),!EM.has(r)||e.length!==2)return;const[s,i]=e,o=C2(s),a=C2(i);if(o!==a)if(k2(o)&&k2(a))for(let l=0;l<e.length;l++){const u=e[l];typeof u=="string"&&(e[l]=parseFloat(u))}else $l[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,r=[];for(let s=0;s<e.length;s++)(e[s]===null||_B(e[s]))&&r.push(s);r.length&&MB(e,r,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:r}=this;if(!e||!e.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=$l[r](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const s=n[n.length-1];s!==void 0&&e.getValue(r,s).jump(s,!1)}measureEndState(){var a;const{element:e,name:n,unresolvedKeyframes:r}=this;if(!e||!e.current)return;const s=e.getValue(n);s&&s.jump(this.measuredOrigin,!1);const i=r.length-1,o=r[i];r[i]=$l[n](e.measureViewportBox(),window.getComputedStyle(e.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),(a=this.removedTransforms)!=null&&a.length&&this.removedTransforms.forEach(([l,u])=>{e.getValue(l).set(u)}),this.resolveNoneKeyframes()}}function AB(t,e,n){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let r=document;e&&(r=e.current);const s=(n==null?void 0:n[t])??r.querySelectorAll(t);return s?Array.from(s):[]}return Array.from(t)}const DM=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function AM(t){return qI(t)&&"offsetHeight"in t}const N2=30,RB=t=>!isNaN(parseFloat(t));class OB{constructor(e,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{var i;const s=Fs.now();if(this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&((i=this.events.change)==null||i.notify(this.current),this.dependents))for(const o of this.dependents)o.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=Fs.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=RB(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new zw);const r=this.events[e].add(n);return e==="change"?()=>{r(),tr.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,n,r){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;(e=this.events.change)==null||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Fs.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>N2)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,N2);return JI(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,n;(e=this.dependents)==null||e.clear(),(n=this.events.destroy)==null||n.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function vu(t,e){return new OB(t,e)}const{schedule:Zw,cancel:gre}=aM(queueMicrotask,!1),Ki={x:!1,y:!1};function RM(){return Ki.x||Ki.y}function PB(t){return t==="x"||t==="y"?Ki[t]?null:(Ki[t]=!0,()=>{Ki[t]=!1}):Ki.x||Ki.y?null:(Ki.x=Ki.y=!0,()=>{Ki.x=Ki.y=!1})}function OM(t,e){const n=AB(t),r=new AbortController,s={passive:!0,...e,signal:r.signal};return[n,s,()=>r.abort()]}function j2(t){return!(t.pointerType==="touch"||RM())}function LB(t,e,n={}){const[r,s,i]=OM(t,n),o=a=>{if(!j2(a))return;const{target:l}=a,u=e(l,a);if(typeof u!="function"||!l)return;const d=f=>{j2(f)&&(u(f),l.removeEventListener("pointerleave",d))};l.addEventListener("pointerleave",d,s)};return r.forEach(a=>{a.addEventListener("pointerenter",o,s)}),i}const PM=(t,e)=>e?t===e?!0:PM(t,e.parentElement):!1,ev=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,$B=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function zB(t){return $B.has(t.tagName)||t.tabIndex!==-1}const bp=new WeakSet;function I2(t){return e=>{e.key==="Enter"&&t(e)}}function Y0(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const FB=(t,e)=>{const n=t.currentTarget;if(!n)return;const r=I2(()=>{if(bp.has(n))return;Y0(n,"down");const s=I2(()=>{Y0(n,"up")}),i=()=>Y0(n,"cancel");n.addEventListener("keyup",s,e),n.addEventListener("blur",i,e)});n.addEventListener("keydown",r,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",r),e)};function M2(t){return ev(t)&&!RM()}function BB(t,e,n={}){const[r,s,i]=OM(t,n),o=a=>{const l=a.currentTarget;if(!M2(a))return;bp.add(l);const u=e(l,a),d=(p,m)=>{window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",h),bp.has(l)&&bp.delete(l),M2(p)&&typeof u=="function"&&u(p,{success:m})},f=p=>{d(p,l===window||l===document||n.useGlobalTarget||PM(l,p.target))},h=p=>{d(p,!1)};window.addEventListener("pointerup",f,s),window.addEventListener("pointercancel",h,s)};return r.forEach(a=>{(n.useGlobalTarget?window:a).addEventListener("pointerdown",o,s),AM(a)&&(a.addEventListener("focus",u=>FB(u,s)),!zB(a)&&!a.hasAttribute("tabindex")&&(a.tabIndex=0))}),i}function LM(t){return qI(t)&&"ownerSVGElement"in t}function UB(t){return LM(t)&&t.tagName==="svg"}const ys=t=>!!(t&&t.getVelocity),HB=[...jM,Er,Ka],VB=t=>HB.find(NM(t)),tv=x.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function D2(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function WB(...t){return e=>{let n=!1;const r=t.map(s=>{const i=D2(s,e);return!n&&typeof i=="function"&&(n=!0),i});if(n)return()=>{for(let s=0;s<r.length;s++){const i=r[s];typeof i=="function"?i():D2(t[s],null)}}}}function KB(...t){return x.useCallback(WB(...t),t)}class GB extends x.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const r=n.offsetParent,s=AM(r)&&r.offsetWidth||0,i=this.props.sizeRef.current;i.height=n.offsetHeight||0,i.width=n.offsetWidth||0,i.top=n.offsetTop,i.left=n.offsetLeft,i.right=s-i.width-i.left}return null}componentDidUpdate(){}render(){return this.props.children}}function qB({children:t,isPresent:e,anchorX:n,root:r}){const s=x.useId(),i=x.useRef(null),o=x.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=x.useContext(tv),l=KB(i,t==null?void 0:t.ref);return x.useInsertionEffect(()=>{const{width:u,height:d,top:f,left:h,right:p}=o.current;if(e||!i.current||!u||!d)return;const m=n==="left"?`left: ${h}`:`right: ${p}`;i.current.dataset.motionPopId=s;const y=document.createElement("style");a&&(y.nonce=a);const b=r??document.head;return b.appendChild(y),y.sheet&&y.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${u}px !important;
            height: ${d}px !important;
            ${m}px !important;
            top: ${f}px !important;
          }
        `),()=>{b.contains(y)&&b.removeChild(y)}},[e]),c.jsx(GB,{isPresent:e,childRef:i,sizeRef:o,children:x.cloneElement(t,{ref:l})})}const YB=({children:t,initial:e,isPresent:n,onExitComplete:r,custom:s,presenceAffectsLayout:i,mode:o,anchorX:a,root:l})=>{const u=Dw(JB),d=x.useId();let f=!0,h=x.useMemo(()=>(f=!1,{id:d,initial:e,isPresent:n,custom:s,onExitComplete:p=>{u.set(p,!0);for(const m of u.values())if(!m)return;r&&r()},register:p=>(u.set(p,!1),()=>u.delete(p))}),[n,u,r]);return i&&f&&(h={...h}),x.useMemo(()=>{u.forEach((p,m)=>u.set(m,!1))},[n]),x.useEffect(()=>{!n&&!u.size&&r&&r()},[n]),o==="popLayout"&&(t=c.jsx(qB,{isPresent:n,anchorX:a,root:l,children:t})),c.jsx(Ag.Provider,{value:h,children:t})};function JB(){return new Map}function $M(t=!0){const e=x.useContext(Ag);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:r,register:s}=e,i=x.useId();x.useEffect(()=>{if(t)return s(i)},[t]);const o=x.useCallback(()=>t&&r&&r(i),[i,r,t]);return!n&&r?[!1,o]:[!0]}const Rh=t=>t.key||"";function A2(t){const e=[];return x.Children.forEach(t,n=>{x.isValidElement(n)&&e.push(n)}),e}const ko=({children:t,custom:e,initial:n=!0,onExitComplete:r,presenceAffectsLayout:s=!0,mode:i="sync",propagate:o=!1,anchorX:a="left",root:l})=>{const[u,d]=$M(o),f=x.useMemo(()=>A2(t),[t]),h=o&&!u?[]:f.map(Rh),p=x.useRef(!0),m=x.useRef(f),y=Dw(()=>new Map),[b,g]=x.useState(f),[v,w]=x.useState(f);Rw(()=>{p.current=!1,m.current=f;for(let k=0;k<v.length;k++){const A=Rh(v[k]);h.includes(A)?y.delete(A):y.get(A)!==!0&&y.set(A,!1)}},[v,h.length,h.join("-")]);const _=[];if(f!==b){let k=[...f];for(let A=0;A<v.length;A++){const N=v[A],E=Rh(N);h.includes(E)||(k.splice(A,0,N),_.push(N))}return i==="wait"&&_.length&&(k=_),w(A2(k)),g(f),null}const{forceRender:D}=x.useContext(vf);return c.jsx(c.Fragment,{children:v.map(k=>{const A=Rh(k),N=o&&!u?!1:f===v||h.includes(A),E=()=>{if(y.has(A))y.set(A,!0);else return;let S=!0;y.forEach(T=>{T||(S=!1)}),S&&(D==null||D(),w(m.current),o&&(d==null||d()),r&&r())};return c.jsx(YB,{isPresent:N,initial:!p.current||n?void 0:!1,custom:e,presenceAffectsLayout:s,mode:i,root:l,onExitComplete:N?void 0:E,anchorX:a,children:k},A)})})},XB=x.createContext(null);function QB(){const t=x.useRef(!1);return Rw(()=>(t.current=!0,()=>{t.current=!1}),[]),t}function ZB(){const t=QB(),[e,n]=x.useState(0),r=x.useCallback(()=>{t.current&&n(e+1)},[e]);return[x.useCallback(()=>tr.postRender(r),[r]),e]}const eU=t=>!t.isLayoutDirty&&t.willUpdate(!1);function R2(){const t=new Set,e=new WeakMap,n=()=>t.forEach(eU);return{add:r=>{t.add(r),e.set(r,r.addEventListener("willUpdate",n))},remove:r=>{t.delete(r);const s=e.get(r);s&&(s(),e.delete(r)),n()},dirty:n}}const zM=t=>t===!0,tU=t=>zM(t===!0)||t==="id",nU=({children:t,id:e,inherit:n=!0})=>{const r=x.useContext(vf),s=x.useContext(XB),[i,o]=ZB(),a=x.useRef(null),l=r.id||s;a.current===null&&(tU(n)&&l&&(e=e?l+"-"+e:l),a.current={id:e,group:zM(n)&&r.group||R2()});const u=x.useMemo(()=>({...a.current,forceRender:i}),[o]);return c.jsx(vf.Provider,{value:u,children:t})},FM=x.createContext({strict:!1}),O2={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ku={};for(const t in O2)ku[t]={isEnabled:e=>O2[t].some(n=>!!e[n])};function rU(t){for(const e in t)ku[e]={...ku[e],...t[e]}}const sU=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function dm(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||sU.has(t)}let BM=t=>!dm(t);function iU(t){typeof t=="function"&&(BM=e=>e.startsWith("on")?!dm(e):t(e))}try{iU(require("@emotion/is-prop-valid").default)}catch{}function oU(t,e,n){const r={};for(const s in t)s==="values"&&typeof t.values=="object"||(BM(s)||n===!0&&dm(s)||!e&&!dm(s)||t.draggable&&s.startsWith("onDrag"))&&(r[s]=t[s]);return r}const Rg=x.createContext({});function Og(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function Tf(t){return typeof t=="string"||Array.isArray(t)}const nv=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],rv=["initial",...nv];function Pg(t){return Og(t.animate)||rv.some(e=>Tf(t[e]))}function UM(t){return!!(Pg(t)||t.variants)}function aU(t,e){if(Pg(t)){const{initial:n,animate:r}=t;return{initial:n===!1||Tf(n)?n:void 0,animate:Tf(r)?r:void 0}}return t.inherit!==!1?e:{}}function lU(t){const{initial:e,animate:n}=aU(t,x.useContext(Rg));return x.useMemo(()=>({initial:e,animate:n}),[P2(e),P2(n)])}function P2(t){return Array.isArray(t)?t.join(" "):t}function L2(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const ed={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(un.test(t))t=parseFloat(t);else return t;const n=L2(t,e.target.x),r=L2(t,e.target.y);return`${n}% ${r}%`}},cU={correct:(t,{treeScale:e,projectionDelta:n})=>{const r=t,s=Ka.parse(t);if(s.length>5)return r;const i=Ka.createTransformer(t),o=typeof s[0]!="number"?1:0,a=n.x.scale*e.x,l=n.y.scale*e.y;s[0+o]/=a,s[1+o]/=l;const u=fr(a,l,.5);return typeof s[2+o]=="number"&&(s[2+o]/=u),typeof s[3+o]=="number"&&(s[3+o]/=u),i(s)}},k1={borderRadius:{...ed,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ed,borderTopRightRadius:ed,borderBottomLeftRadius:ed,borderBottomRightRadius:ed,boxShadow:cU};function HM(t,{layout:e,layoutId:n}){return $u.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!k1[t]||t==="opacity")}const uU={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},dU=Lu.length;function fU(t,e,n){let r="",s=!0;for(let i=0;i<dU;i++){const o=Lu[i],a=t[o];if(a===void 0)continue;let l=!0;if(typeof a=="number"?l=a===(o.startsWith("scale")?1:0):l=parseFloat(a)===0,!l||n){const u=DM(a,Qw[o]);if(!l){s=!1;const d=uU[o]||o;r+=`${d}(${u}) `}n&&(e[o]=u)}}return r=r.trim(),n?r=n(e,s?"":r):s&&(r="none"),r}function sv(t,e,n){const{style:r,vars:s,transformOrigin:i}=t;let o=!1,a=!1;for(const l in e){const u=e[l];if($u.has(l)){o=!0;continue}else if(cM(l)){s[l]=u;continue}else{const d=DM(u,Qw[l]);l.startsWith("origin")?(a=!0,i[l]=d):r[l]=d}}if(e.transform||(o||n?r.transform=fU(e,t.transform,n):r.transform&&(r.transform="none")),a){const{originX:l="50%",originY:u="50%",originZ:d=0}=i;r.transformOrigin=`${l} ${u} ${d}`}}const iv=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function VM(t,e,n){for(const r in e)!ys(e[r])&&!HM(r,n)&&(t[r]=e[r])}function hU({transformTemplate:t},e){return x.useMemo(()=>{const n=iv();return sv(n,e,t),Object.assign({},n.vars,n.style)},[e])}function pU(t,e){const n=t.style||{},r={};return VM(r,n,t),Object.assign(r,hU(t,e)),r}function mU(t,e){const n={},r=pU(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=r,n}const gU={offset:"stroke-dashoffset",array:"stroke-dasharray"},yU={offset:"strokeDashoffset",array:"strokeDasharray"};function xU(t,e,n=1,r=0,s=!0){t.pathLength=1;const i=s?gU:yU;t[i.offset]=un.transform(-r);const o=un.transform(e),a=un.transform(n);t[i.array]=`${o} ${a}`}function WM(t,{attrX:e,attrY:n,attrScale:r,pathLength:s,pathSpacing:i=1,pathOffset:o=0,...a},l,u,d){if(sv(t,a,u),l){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:f,style:h}=t;f.transform&&(h.transform=f.transform,delete f.transform),(h.transform||f.transformOrigin)&&(h.transformOrigin=f.transformOrigin??"50% 50%",delete f.transformOrigin),h.transform&&(h.transformBox=(d==null?void 0:d.transformBox)??"fill-box",delete f.transformBox),e!==void 0&&(f.x=e),n!==void 0&&(f.y=n),r!==void 0&&(f.scale=r),s!==void 0&&xU(f,s,i,o,!1)}const KM=()=>({...iv(),attrs:{}}),GM=t=>typeof t=="string"&&t.toLowerCase()==="svg";function bU(t,e,n,r){const s=x.useMemo(()=>{const i=KM();return WM(i,e,GM(r),t.transformTemplate,t.style),{...i.attrs,style:{...i.style}}},[e]);if(t.style){const i={};VM(i,t.style,t),s.style={...i,...s.style}}return s}const wU=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function ov(t){return typeof t!="string"||t.includes("-")?!1:!!(wU.indexOf(t)>-1||/[A-Z]/u.test(t))}function vU(t,e,n,{latestValues:r},s,i=!1){const a=(ov(t)?bU:mU)(e,r,s,t),l=oU(e,typeof t=="string",i),u=t!==x.Fragment?{...l,...a,ref:n}:{},{children:d}=e,f=x.useMemo(()=>ys(d)?d.get():d,[d]);return x.createElement(t,{...u,children:f})}function $2(t){const e=[{},{}];return t==null||t.values.forEach((n,r)=>{e[0][r]=n.get(),e[1][r]=n.getVelocity()}),e}function av(t,e,n,r){if(typeof e=="function"){const[s,i]=$2(r);e=e(n!==void 0?n:t.custom,s,i)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[s,i]=$2(r);e=e(n!==void 0?n:t.custom,s,i)}return e}function wp(t){return ys(t)?t.get():t}function kU({scrapeMotionValuesFromProps:t,createRenderState:e},n,r,s){return{latestValues:SU(n,r,s,t),renderState:e()}}function SU(t,e,n,r){const s={},i=r(t,{});for(const h in i)s[h]=wp(i[h]);let{initial:o,animate:a}=t;const l=Pg(t),u=UM(t);e&&u&&!l&&t.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let d=n?n.initial===!1:!1;d=d||o===!1;const f=d?a:o;if(f&&typeof f!="boolean"&&!Og(f)){const h=Array.isArray(f)?f:[f];for(let p=0;p<h.length;p++){const m=av(t,h[p]);if(m){const{transitionEnd:y,transition:b,...g}=m;for(const v in g){let w=g[v];if(Array.isArray(w)){const _=d?w.length-1:0;w=w[_]}w!==null&&(s[v]=w)}for(const v in y)s[v]=y[v]}}}return s}const qM=t=>(e,n)=>{const r=x.useContext(Rg),s=x.useContext(Ag),i=()=>kU(t,e,r,s);return n?i():Dw(i)};function lv(t,e,n){var i;const{style:r}=t,s={};for(const o in r)(ys(r[o])||e.style&&ys(e.style[o])||HM(o,t)||((i=n==null?void 0:n.getValue(o))==null?void 0:i.liveStyle)!==void 0)&&(s[o]=r[o]);return s}const _U=qM({scrapeMotionValuesFromProps:lv,createRenderState:iv});function YM(t,e,n){const r=lv(t,e,n);for(const s in t)if(ys(t[s])||ys(e[s])){const i=Lu.indexOf(s)!==-1?"attr"+s.charAt(0).toUpperCase()+s.substring(1):s;r[i]=t[s]}return r}const TU=qM({scrapeMotionValuesFromProps:YM,createRenderState:KM}),CU=Symbol.for("motionComponentSymbol");function Wc(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function EU(t,e,n){return x.useCallback(r=>{r&&t.onMount&&t.onMount(r),e&&(r?e.mount(r):e.unmount()),n&&(typeof n=="function"?n(r):Wc(n)&&(n.current=r))},[e])}const cv=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),NU="framerAppearId",JM="data-"+cv(NU),XM=x.createContext({});function jU(t,e,n,r,s){var y,b;const{visualElement:i}=x.useContext(Rg),o=x.useContext(FM),a=x.useContext(Ag),l=x.useContext(tv).reducedMotion,u=x.useRef(null);r=r||o.renderer,!u.current&&r&&(u.current=r(t,{visualState:e,parent:i,props:n,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:l}));const d=u.current,f=x.useContext(XM);d&&!d.projection&&s&&(d.type==="html"||d.type==="svg")&&IU(u.current,n,s,f);const h=x.useRef(!1);x.useInsertionEffect(()=>{d&&h.current&&d.update(n,a)});const p=n[JM],m=x.useRef(!!p&&!((y=window.MotionHandoffIsComplete)!=null&&y.call(window,p))&&((b=window.MotionHasOptimisedAnimation)==null?void 0:b.call(window,p)));return Rw(()=>{d&&(h.current=!0,window.MotionIsMounted=!0,d.updateFeatures(),d.scheduleRenderMicrotask(),m.current&&d.animationState&&d.animationState.animateChanges())}),x.useEffect(()=>{d&&(!m.current&&d.animationState&&d.animationState.animateChanges(),m.current&&(queueMicrotask(()=>{var g;(g=window.MotionHandoffMarkAsComplete)==null||g.call(window,p)}),m.current=!1),d.enteringChildren=void 0)}),d}function IU(t,e,n,r){const{layoutId:s,layout:i,drag:o,dragConstraints:a,layoutScroll:l,layoutRoot:u,layoutCrossfade:d}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:QM(t.parent)),t.projection.setOptions({layoutId:s,layout:i,alwaysMeasureLayout:!!o||a&&Wc(a),visualElement:t,animationType:typeof i=="string"?i:"both",initialPromotionConfig:r,crossfade:d,layoutScroll:l,layoutRoot:u})}function QM(t){if(t)return t.options.allowProjection!==!1?t.projection:QM(t.parent)}function J0(t,{forwardMotionProps:e=!1}={},n,r){n&&rU(n);const s=ov(t)?TU:_U;function i(a,l){let u;const d={...x.useContext(tv),...a,layoutId:MU(a)},{isStatic:f}=d,h=lU(a),p=s(a,f);if(!f&&Aw){DU();const m=AU(d);u=m.MeasureLayout,h.visualElement=jU(t,p,d,r,m.ProjectionNode)}return c.jsxs(Rg.Provider,{value:h,children:[u&&h.visualElement?c.jsx(u,{visualElement:h.visualElement,...d}):null,vU(t,a,EU(p,h.visualElement,l),p,f,e)]})}i.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const o=x.forwardRef(i);return o[CU]=t,o}function MU({layoutId:t}){const e=x.useContext(vf).id;return e&&t!==void 0?e+"-"+t:t}function DU(t,e){x.useContext(FM).strict}function AU(t){const{drag:e,layout:n}=ku;if(!e&&!n)return{};const r={...e,...n};return{MeasureLayout:e!=null&&e.isEnabled(t)||n!=null&&n.isEnabled(t)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function RU(t,e){if(typeof Proxy>"u")return J0;const n=new Map,r=(i,o)=>J0(i,o,t,e),s=(i,o)=>r(i,o);return new Proxy(s,{get:(i,o)=>o==="create"?r:(n.has(o)||n.set(o,J0(o,void 0,t,e)),n.get(o))})}function ZM({top:t,left:e,right:n,bottom:r}){return{x:{min:e,max:n},y:{min:t,max:r}}}function OU({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function PU(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),r=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:r.y,right:r.x}}function X0(t){return t===void 0||t===1}function S1({scale:t,scaleX:e,scaleY:n}){return!X0(t)||!X0(e)||!X0(n)}function ml(t){return S1(t)||eD(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function eD(t){return z2(t.x)||z2(t.y)}function z2(t){return t&&t!=="0%"}function fm(t,e,n){const r=t-n,s=e*r;return n+s}function F2(t,e,n,r,s){return s!==void 0&&(t=fm(t,s,r)),fm(t,n,r)+e}function _1(t,e=0,n=1,r,s){t.min=F2(t.min,e,n,r,s),t.max=F2(t.max,e,n,r,s)}function tD(t,{x:e,y:n}){_1(t.x,e.translate,e.scale,e.originPoint),_1(t.y,n.translate,n.scale,n.originPoint)}const B2=.999999999999,U2=1.0000000000001;function LU(t,e,n,r=!1){const s=n.length;if(!s)return;e.x=e.y=1;let i,o;for(let a=0;a<s;a++){i=n[a],o=i.projectionDelta;const{visualElement:l}=i.options;l&&l.props.style&&l.props.style.display==="contents"||(r&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Gc(t,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,tD(t,o)),r&&ml(i.latestValues)&&Gc(t,i.latestValues))}e.x<U2&&e.x>B2&&(e.x=1),e.y<U2&&e.y>B2&&(e.y=1)}function Kc(t,e){t.min=t.min+e,t.max=t.max+e}function H2(t,e,n,r,s=.5){const i=fr(t.min,t.max,s);_1(t,e,n,i,r)}function Gc(t,e){H2(t.x,e.x,e.scaleX,e.scale,e.originX),H2(t.y,e.y,e.scaleY,e.scale,e.originY)}function nD(t,e){return ZM(PU(t.getBoundingClientRect(),e))}function $U(t,e,n){const r=nD(t,n),{scroll:s}=e;return s&&(Kc(r.x,s.offset.x),Kc(r.y,s.offset.y)),r}const V2=()=>({translate:0,scale:1,origin:0,originPoint:0}),qc=()=>({x:V2(),y:V2()}),W2=()=>({min:0,max:0}),Rr=()=>({x:W2(),y:W2()}),T1={current:null},rD={current:!1};function zU(){if(rD.current=!0,!!Aw)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>T1.current=t.matches;t.addEventListener("change",e),e()}else T1.current=!1}const FU=new WeakMap;function BU(t,e,n){for(const r in e){const s=e[r],i=n[r];if(ys(s))t.addValue(r,s);else if(ys(i))t.addValue(r,vu(s,{owner:t}));else if(i!==s)if(t.hasValue(r)){const o=t.getValue(r);o.liveStyle===!0?o.jump(s):o.hasAnimated||o.set(s)}else{const o=t.getStaticValue(r);t.addValue(r,vu(o!==void 0?o:s,{owner:t}))}}for(const r in n)e[r]===void 0&&t.removeValue(r);return e}const K2=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class UU{scrapeMotionValuesFromProps(e,n,r){return{}}constructor({parent:e,props:n,presenceContext:r,reducedMotionConfig:s,blockInitialAnimation:i,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Jw,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const h=Fs.now();this.renderScheduledAt<h&&(this.renderScheduledAt=h,tr.render(this.render,!1,!0))};const{latestValues:l,renderState:u}=o;this.latestValues=l,this.baseTarget={...l},this.initialValues=n.initial?{...l}:{},this.renderState=u,this.parent=e,this.props=n,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=s,this.options=a,this.blockInitialAnimation=!!i,this.isControllingVariants=Pg(n),this.isVariantNode=UM(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...f}=this.scrapeMotionValuesFromProps(n,{},this);for(const h in f){const p=f[h];l[h]!==void 0&&ys(p)&&p.set(l[h])}}mount(e){var n;this.current=e,FU.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,s)=>this.bindToMotionValue(s,r)),rD.current||zU(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:T1.current,(n=this.parent)==null||n.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var e;this.projection&&this.projection.unmount(),Wa(this.notifyUpdate),Wa(this.render),this.valueSubscriptions.forEach(n=>n()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(e=this.parent)==null||e.removeChild(this);for(const n in this.events)this.events[n].clear();for(const n in this.features){const r=this.features[n];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=$u.has(e);r&&this.onBindTransform&&this.onBindTransform();const s=n.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&tr.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let i;window.MotionCheckAppearSync&&(i=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{s(),i&&i(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in ku){const n=ku[e];if(!n)continue;const{isEnabled:r,Feature:s}=n;if(!this.features[e]&&s&&r(this.props)&&(this.features[e]=new s(this)),this.features[e]){const i=this.features[e];i.isMounted?i.update():(i.mount(),i.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Rr()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let r=0;r<K2.length;r++){const s=K2[r];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const i="on"+s,o=e[i];o&&(this.propEventSubscriptions[s]=this.on(s,o))}this.prevMotionValues=BU(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const r=this.values.get(e);n!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&n!==void 0&&(r=vu(n===null?void 0:n,{owner:this}),this.addValue(e,r)),r}readValue(e,n){let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(GI(r)||YI(r))?r=parseFloat(r):!VB(r)&&Ka.test(n)&&(r=MM(e,n)),this.setBaseTarget(e,ys(r)?r.get():r)),ys(r)?r.get():r}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var i;const{initial:n}=this.props;let r;if(typeof n=="string"||typeof n=="object"){const o=av(this.props,n,(i=this.presenceContext)==null?void 0:i.custom);o&&(r=o[e])}if(n&&r!==void 0)return r;const s=this.getBaseTargetFromProps(this.props,e);return s!==void 0&&!ys(s)?s:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new zw),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}scheduleRenderMicrotask(){Zw.render(this.render)}}class sD extends UU{constructor(){super(...arguments),this.KeyframeResolver=DB}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:r}){delete n[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;ys(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function iD(t,{style:e,vars:n},r,s){const i=t.style;let o;for(o in e)i[o]=e[o];s==null||s.applyProjectionStyles(i,r);for(o in n)i.setProperty(o,n[o])}function HU(t){return window.getComputedStyle(t)}class VU extends sD{constructor(){super(...arguments),this.type="html",this.renderInstance=iD}readValueFromInstance(e,n){var r;if($u.has(n))return(r=this.projection)!=null&&r.isProjecting?m1(n):XF(e,n);{const s=HU(e),i=(cM(n)?s.getPropertyValue(n):s[n])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:n}){return nD(e,n)}build(e,n,r){sv(e,n,r.transformTemplate)}scrapeMotionValuesFromProps(e,n,r){return lv(e,n,r)}}const oD=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function WU(t,e,n,r){iD(t,e,void 0,r);for(const s in e.attrs)t.setAttribute(oD.has(s)?s:cv(s),e.attrs[s])}class KU extends sD{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Rr}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if($u.has(n)){const r=IM(n);return r&&r.default||0}return n=oD.has(n)?n:cv(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,r){return YM(e,n,r)}build(e,n,r){WM(e,n,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(e,n,r,s){WU(e,n,r,s)}mount(e){this.isSVGTag=GM(e.tagName),super.mount(e)}}const GU=(t,e)=>ov(t)?new KU(e):new VU(e,{allowProjection:t!==x.Fragment});function au(t,e,n){const r=t.getProps();return av(r,e,n!==void 0?n:r.custom,t)}const C1=t=>Array.isArray(t);function qU(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,vu(n))}function YU(t){return C1(t)?t[t.length-1]||0:t}function JU(t,e){const n=au(t,e);let{transitionEnd:r={},transition:s={},...i}=n||{};i={...i,...r};for(const o in i){const a=YU(i[o]);qU(t,o,a)}}function XU(t){return!!(ys(t)&&t.add)}function E1(t,e){const n=t.getValue("willChange");if(XU(n))return n.add(e);if(!n&&ea.WillChange){const r=new ea.WillChange("auto");t.addValue("willChange",r),r.add(e)}}function aD(t){return t.props[JM]}const QU=t=>t!==null;function ZU(t,{repeat:e,repeatType:n="loop"},r){const s=t.filter(QU),i=e&&n!=="loop"&&e%2===1?0:s.length-1;return!i||r===void 0?s[i]:r}const e8={type:"spring",stiffness:500,damping:25,restSpeed:10},t8=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),n8={type:"keyframes",duration:.8},r8={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},s8=(t,{keyframes:e})=>e.length>2?n8:$u.has(t)?t.startsWith("scale")?t8(e[1]):e8:r8;function i8({when:t,delay:e,delayChildren:n,staggerChildren:r,staggerDirection:s,repeat:i,repeatType:o,repeatDelay:a,from:l,elapsed:u,...d}){return!!Object.keys(d).length}const uv=(t,e,n,r={},s,i)=>o=>{const a=Xw(r,t)||{},l=a.delay||r.delay||0;let{elapsed:u=0}=r;u=u-wo(l);const d={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-u,onUpdate:h=>{e.set(h),a.onUpdate&&a.onUpdate(h)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:t,motionValue:e,element:i?void 0:s};i8(a)||Object.assign(d,s8(t,d)),d.duration&&(d.duration=wo(d.duration)),d.repeatDelay&&(d.repeatDelay=wo(d.repeatDelay)),d.from!==void 0&&(d.keyframes[0]=d.from);let f=!1;if((d.type===!1||d.duration===0&&!d.repeatDelay)&&(w1(d),d.delay===0&&(f=!0)),(ea.instantAnimations||ea.skipAnimations)&&(f=!0,w1(d),d.delay=0),d.allowFlatten=!a.type&&!a.ease,f&&!i&&e.get()!==void 0){const h=ZU(d.keyframes,a);if(h!==void 0){tr.update(()=>{d.onUpdate(h),d.onComplete()});return}}return a.isSync?new Yw(d):new wB(d)};function o8({protectedKeys:t,needsAnimating:e},n){const r=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,r}function lD(t,e,{delay:n=0,transitionOverride:r,type:s}={}){let{transition:i=t.getDefaultTransition(),transitionEnd:o,...a}=e;r&&(i=r);const l=[],u=s&&t.animationState&&t.animationState.getState()[s];for(const d in a){const f=t.getValue(d,t.latestValues[d]??null),h=a[d];if(h===void 0||u&&o8(u,d))continue;const p={delay:n,...Xw(i||{},d)},m=f.get();if(m!==void 0&&!f.isAnimating&&!Array.isArray(h)&&h===m&&!p.velocity)continue;let y=!1;if(window.MotionHandoffAnimation){const g=aD(t);if(g){const v=window.MotionHandoffAnimation(g,d,tr);v!==null&&(p.startTime=v,y=!0)}}E1(t,d),f.start(uv(d,f,h,t.shouldReduceMotion&&EM.has(d)?{type:!1}:p,t,y));const b=f.animation;b&&l.push(b)}return o&&Promise.all(l).then(()=>{tr.update(()=>{o&&JU(t,o)})}),l}function cD(t,e,n,r=0,s=1){const i=Array.from(t).sort((u,d)=>u.sortNodePosition(d)).indexOf(e),o=t.size,a=(o-1)*r;return typeof n=="function"?n(i,o):s===1?i*r:a-i*r}function N1(t,e,n={}){var l;const r=au(t,e,n.type==="exit"?(l=t.presenceContext)==null?void 0:l.custom:void 0);let{transition:s=t.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(s=n.transitionOverride);const i=r?()=>Promise.all(lD(t,r,n)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?(u=0)=>{const{delayChildren:d=0,staggerChildren:f,staggerDirection:h}=s;return a8(t,e,u,d,f,h,n)}:()=>Promise.resolve(),{when:a}=s;if(a){const[u,d]=a==="beforeChildren"?[i,o]:[o,i];return u().then(()=>d())}else return Promise.all([i(),o(n.delay)])}function a8(t,e,n=0,r=0,s=0,i=1,o){const a=[];for(const l of t.variantChildren)l.notify("AnimationStart",e),a.push(N1(l,e,{...o,delay:n+(typeof r=="function"?0:r)+cD(t.variantChildren,l,r,s,i)}).then(()=>l.notify("AnimationComplete",e)));return Promise.all(a)}function l8(t,e,n={}){t.notify("AnimationStart",e);let r;if(Array.isArray(e)){const s=e.map(i=>N1(t,i,n));r=Promise.all(s)}else if(typeof e=="string")r=N1(t,e,n);else{const s=typeof e=="function"?au(t,e,n.custom):e;r=Promise.all(lD(t,s,n))}return r.then(()=>{t.notify("AnimationComplete",e)})}function uD(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}const c8=rv.length;function dD(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?dD(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<c8;n++){const r=rv[n],s=t.props[r];(Tf(s)||s===!1)&&(e[r]=s)}return e}const u8=[...nv].reverse(),d8=nv.length;function f8(t){return e=>Promise.all(e.map(({animation:n,options:r})=>l8(t,n,r)))}function h8(t){let e=f8(t),n=G2(),r=!0;const s=l=>(u,d)=>{var h;const f=au(t,d,l==="exit"?(h=t.presenceContext)==null?void 0:h.custom:void 0);if(f){const{transition:p,transitionEnd:m,...y}=f;u={...u,...y,...m}}return u};function i(l){e=l(t)}function o(l){const{props:u}=t,d=dD(t.parent)||{},f=[],h=new Set;let p={},m=1/0;for(let b=0;b<d8;b++){const g=u8[b],v=n[g],w=u[g]!==void 0?u[g]:d[g],_=Tf(w),D=g===l?v.isActive:null;D===!1&&(m=b);let k=w===d[g]&&w!==u[g]&&_;if(k&&r&&t.manuallyAnimateOnMount&&(k=!1),v.protectedKeys={...p},!v.isActive&&D===null||!w&&!v.prevProp||Og(w)||typeof w=="boolean")continue;const A=p8(v.prevProp,w);let N=A||g===l&&v.isActive&&!k&&_||b>m&&_,E=!1;const S=Array.isArray(w)?w:[w];let T=S.reduce(s(g),{});D===!1&&(T={});const{prevResolvedValues:C={}}=v,O={...C,...T},P=I=>{N=!0,h.has(I)&&(E=!0,h.delete(I)),v.needsAnimating[I]=!0;const K=t.getValue(I);K&&(K.liveStyle=!1)};for(const I in O){const K=T[I],G=C[I];if(p.hasOwnProperty(I))continue;let R=!1;C1(K)&&C1(G)?R=!uD(K,G):R=K!==G,R?K!=null?P(I):h.add(I):K!==void 0&&h.has(I)?P(I):v.protectedKeys[I]=!0}v.prevProp=w,v.prevResolvedValues=T,v.isActive&&(p={...p,...T}),r&&t.blockInitialAnimation&&(N=!1);const H=k&&A;N&&(!H||E)&&f.push(...S.map(I=>{const K={type:g};if(typeof I=="string"&&r&&!H&&t.manuallyAnimateOnMount&&t.parent){const{parent:G}=t,R=au(G,I);if(G.enteringChildren&&R){const{delayChildren:Ee}=R.transition||{};K.delay=cD(G.enteringChildren,t,Ee)}}return{animation:I,options:K}}))}if(h.size){const b={};if(typeof u.initial!="boolean"){const g=au(t,Array.isArray(u.initial)?u.initial[0]:u.initial);g&&g.transition&&(b.transition=g.transition)}h.forEach(g=>{const v=t.getBaseTarget(g),w=t.getValue(g);w&&(w.liveStyle=!0),b[g]=v??null}),f.push({animation:b})}let y=!!f.length;return r&&(u.initial===!1||u.initial===u.animate)&&!t.manuallyAnimateOnMount&&(y=!1),r=!1,y?e(f):Promise.resolve()}function a(l,u){var f;if(n[l].isActive===u)return Promise.resolve();(f=t.variantChildren)==null||f.forEach(h=>{var p;return(p=h.animationState)==null?void 0:p.setActive(l,u)}),n[l].isActive=u;const d=o(l);for(const h in n)n[h].protectedKeys={};return d}return{animateChanges:o,setActive:a,setAnimateFunction:i,getState:()=>n,reset:()=>{n=G2()}}}function p8(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!uD(e,t):!1}function dl(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function G2(){return{animate:dl(!0),whileInView:dl(),whileHover:dl(),whileTap:dl(),whileDrag:dl(),whileFocus:dl(),exit:dl()}}class Za{constructor(e){this.isMounted=!1,this.node=e}update(){}}class m8 extends Za{constructor(e){super(e),e.animationState||(e.animationState=h8(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Og(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)==null||e.call(this)}}let g8=0;class y8 extends Za{constructor(){super(...arguments),this.id=g8++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const s=this.node.animationState.setActive("exit",!e);n&&!e&&s.then(()=>{n(this.id)})}mount(){const{register:e,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const x8={animation:{Feature:m8},exit:{Feature:y8}};function Cf(t,e,n,r={passive:!0}){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n)}function th(t){return{point:{x:t.pageX,y:t.pageY}}}const b8=t=>e=>ev(e)&&t(e,th(e));function Md(t,e,n,r){return Cf(t,e,b8(n),r)}const fD=1e-4,w8=1-fD,v8=1+fD,hD=.01,k8=0-hD,S8=0+hD;function Ts(t){return t.max-t.min}function _8(t,e,n){return Math.abs(t-e)<=n}function q2(t,e,n,r=.5){t.origin=r,t.originPoint=fr(e.min,e.max,t.origin),t.scale=Ts(n)/Ts(e),t.translate=fr(n.min,n.max,t.origin)-t.originPoint,(t.scale>=w8&&t.scale<=v8||isNaN(t.scale))&&(t.scale=1),(t.translate>=k8&&t.translate<=S8||isNaN(t.translate))&&(t.translate=0)}function Dd(t,e,n,r){q2(t.x,e.x,n.x,r?r.originX:void 0),q2(t.y,e.y,n.y,r?r.originY:void 0)}function Y2(t,e,n){t.min=n.min+e.min,t.max=t.min+Ts(e)}function T8(t,e,n){Y2(t.x,e.x,n.x),Y2(t.y,e.y,n.y)}function J2(t,e,n){t.min=e.min-n.min,t.max=t.min+Ts(e)}function hm(t,e,n){J2(t.x,e.x,n.x),J2(t.y,e.y,n.y)}function gi(t){return[t("x"),t("y")]}const pD=({current:t})=>t?t.ownerDocument.defaultView:null,X2=(t,e)=>Math.abs(t-e);function C8(t,e){const n=X2(t.x,e.x),r=X2(t.y,e.y);return Math.sqrt(n**2+r**2)}class mD{constructor(e,n,{transformPagePoint:r,contextWindow:s=window,dragSnapToOrigin:i=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=Z0(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,m=C8(h.offset,{x:0,y:0})>=this.distanceThreshold;if(!p&&!m)return;const{point:y}=h,{timestamp:b}=Zr;this.history.push({...y,timestamp:b});const{onStart:g,onMove:v}=this.handlers;p||(g&&g(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),v&&v(this.lastMoveEvent,h)},this.handlePointerMove=(h,p)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=Q0(p,this.transformPagePoint),tr.update(this.updatePoint,!0)},this.handlePointerUp=(h,p)=>{this.end();const{onEnd:m,onSessionEnd:y,resumeAnimation:b}=this.handlers;if(this.dragSnapToOrigin&&b&&b(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=Z0(h.type==="pointercancel"?this.lastMoveEventInfo:Q0(p,this.transformPagePoint),this.history);this.startEvent&&m&&m(h,g),y&&y(h,g)},!ev(e))return;this.dragSnapToOrigin=i,this.handlers=n,this.transformPagePoint=r,this.distanceThreshold=o,this.contextWindow=s||window;const a=th(e),l=Q0(a,this.transformPagePoint),{point:u}=l,{timestamp:d}=Zr;this.history=[{...u,timestamp:d}];const{onSessionStart:f}=n;f&&f(e,Z0(l,this.history)),this.removeListeners=Qf(Md(this.contextWindow,"pointermove",this.handlePointerMove),Md(this.contextWindow,"pointerup",this.handlePointerUp),Md(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Wa(this.updatePoint)}}function Q0(t,e){return e?{point:e(t.point)}:t}function Q2(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Z0({point:t},e){return{point:t,delta:Q2(t,gD(e)),offset:Q2(t,E8(e)),velocity:N8(e,.1)}}function E8(t){return t[0]}function gD(t){return t[t.length-1]}function N8(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,r=null;const s=gD(t);for(;n>=0&&(r=t[n],!(s.timestamp-r.timestamp>wo(e)));)n--;if(!r)return{x:0,y:0};const i=Ci(s.timestamp-r.timestamp);if(i===0)return{x:0,y:0};const o={x:(s.x-r.x)/i,y:(s.y-r.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function j8(t,{min:e,max:n},r){return e!==void 0&&t<e?t=r?fr(e,t,r.min):Math.max(t,e):n!==void 0&&t>n&&(t=r?fr(n,t,r.max):Math.min(t,n)),t}function Z2(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function I8(t,{top:e,left:n,bottom:r,right:s}){return{x:Z2(t.x,n,s),y:Z2(t.y,e,r)}}function e_(t,e){let n=e.min-t.min,r=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,r]=[r,n]),{min:n,max:r}}function M8(t,e){return{x:e_(t.x,e.x),y:e_(t.y,e.y)}}function D8(t,e){let n=.5;const r=Ts(t),s=Ts(e);return s>r?n=kf(e.min,e.max-r,t.min):r>s&&(n=kf(t.min,t.max-s,e.min)),Zo(0,1,n)}function A8(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const j1=.35;function R8(t=j1){return t===!1?t=0:t===!0&&(t=j1),{x:t_(t,"left","right"),y:t_(t,"top","bottom")}}function t_(t,e,n){return{min:n_(t,e),max:n_(t,n)}}function n_(t,e){return typeof t=="number"?t:t[e]||0}const O8=new WeakMap;class P8{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Rr(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:n=!1,distanceThreshold:r}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const i=f=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(th(f).point)},o=(f,h)=>{const{drag:p,dragPropagation:m,onDragStart:y}=this.getProps();if(p&&!m&&(this.openDragLock&&this.openDragLock(),this.openDragLock=PB(p),!this.openDragLock))return;this.latestPointerEvent=f,this.latestPanInfo=h,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),gi(g=>{let v=this.getAxisMotionValue(g).get()||0;if(vo.test(v)){const{projection:w}=this.visualElement;if(w&&w.layout){const _=w.layout.layoutBox[g];_&&(v=Ts(_)*(parseFloat(v)/100))}}this.originPoint[g]=v}),y&&tr.postRender(()=>y(f,h)),E1(this.visualElement,"transform");const{animationState:b}=this.visualElement;b&&b.setActive("whileDrag",!0)},a=(f,h)=>{this.latestPointerEvent=f,this.latestPanInfo=h;const{dragPropagation:p,dragDirectionLock:m,onDirectionLock:y,onDrag:b}=this.getProps();if(!p&&!this.openDragLock)return;const{offset:g}=h;if(m&&this.currentDirection===null){this.currentDirection=L8(g),this.currentDirection!==null&&y&&y(this.currentDirection);return}this.updateAxis("x",h.point,g),this.updateAxis("y",h.point,g),this.visualElement.render(),b&&b(f,h)},l=(f,h)=>{this.latestPointerEvent=f,this.latestPanInfo=h,this.stop(f,h),this.latestPointerEvent=null,this.latestPanInfo=null},u=()=>gi(f=>{var h;return this.getAnimationState(f)==="paused"&&((h=this.getAxisMotionValue(f).animation)==null?void 0:h.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new mD(e,{onSessionStart:i,onStart:o,onMove:a,onSessionEnd:l,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,distanceThreshold:r,contextWindow:pD(this.visualElement)})}stop(e,n){const r=e||this.latestPointerEvent,s=n||this.latestPanInfo,i=this.isDragging;if(this.cancel(),!i||!s||!r)return;const{velocity:o}=s;this.startAnimation(o);const{onDragEnd:a}=this.getProps();a&&tr.postRender(()=>a(r,s))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,r){const{drag:s}=this.getProps();if(!r||!Oh(e,s,this.currentDirection))return;const i=this.getAxisMotionValue(e);let o=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(o=j8(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){var i;const{dragConstraints:e,dragElastic:n}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(i=this.visualElement.projection)==null?void 0:i.layout,s=this.constraints;e&&Wc(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&r?this.constraints=I8(r.layoutBox,e):this.constraints=!1,this.elastic=R8(n),s!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&gi(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=A8(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!Wc(e))return!1;const r=e.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const i=$U(r,s.root,this.visualElement.getTransformPagePoint());let o=M8(s.layout.layoutBox,i);if(n){const a=n(OU(o));this.hasMutatedConstraints=!!a,a&&(o=ZM(a))}return o}startAnimation(e){const{drag:n,dragMomentum:r,dragElastic:s,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),l=this.constraints||{},u=gi(d=>{if(!Oh(d,n,this.currentDirection))return;let f=l&&l[d]||{};o&&(f={min:0,max:0});const h=s?200:1e6,p=s?40:1e7,m={type:"inertia",velocity:r?e[d]:0,bounceStiffness:h,bounceDamping:p,timeConstant:750,restDelta:1,restSpeed:10,...i,...f};return this.startAxisValueAnimation(d,m)});return Promise.all(u).then(a)}startAxisValueAnimation(e,n){const r=this.getAxisMotionValue(e);return E1(this.visualElement,e),r.start(uv(e,r,0,n,this.visualElement,!1))}stopAnimation(){gi(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){gi(e=>{var n;return(n=this.getAxisMotionValue(e).animation)==null?void 0:n.pause()})}getAnimationState(e){var n;return(n=this.getAxisMotionValue(e).animation)==null?void 0:n.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps(),s=r[n];return s||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){gi(n=>{const{drag:r}=this.getProps();if(!Oh(n,r,this.currentDirection))return;const{projection:s}=this.visualElement,i=this.getAxisMotionValue(n);if(s&&s.layout){const{min:o,max:a}=s.layout.layoutBox[n];i.set(e[n]-fr(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:r}=this.visualElement;if(!Wc(n)||!r||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};gi(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const l=a.get();s[o]=D8({min:l,max:l},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),gi(o=>{if(!Oh(o,e,null))return;const a=this.getAxisMotionValue(o),{min:l,max:u}=this.constraints[o];a.set(fr(l,u,s[o]))})}addListeners(){if(!this.visualElement.current)return;O8.set(this.visualElement,this);const e=this.visualElement.current,n=Md(e,"pointerdown",l=>{const{drag:u,dragListener:d=!0}=this.getProps();u&&d&&this.start(l)}),r=()=>{const{dragConstraints:l}=this.getProps();Wc(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,i=s.addEventListener("measure",r);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),tr.read(r);const o=Cf(window,"resize",()=>this.scalePositionWithinConstraints()),a=s.addEventListener("didUpdate",({delta:l,hasLayoutChanged:u})=>{this.isDragging&&u&&(gi(d=>{const f=this.getAxisMotionValue(d);f&&(this.originPoint[d]+=l[d].translate,f.set(f.get()+l[d].translate))}),this.visualElement.render())});return()=>{o(),n(),i(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:r=!1,dragPropagation:s=!1,dragConstraints:i=!1,dragElastic:o=j1,dragMomentum:a=!0}=e;return{...e,drag:n,dragDirectionLock:r,dragPropagation:s,dragConstraints:i,dragElastic:o,dragMomentum:a}}}function Oh(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function L8(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class $8 extends Za{constructor(e){super(e),this.removeGroupControls=Ni,this.removeListeners=Ni,this.controls=new P8(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ni}unmount(){this.removeGroupControls(),this.removeListeners()}}const r_=t=>(e,n)=>{t&&tr.postRender(()=>t(e,n))};class z8 extends Za{constructor(){super(...arguments),this.removePointerDownListener=Ni}onPointerDown(e){this.session=new mD(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:pD(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:r,onPanEnd:s}=this.node.getProps();return{onSessionStart:r_(e),onStart:r_(n),onMove:r,onEnd:(i,o)=>{delete this.session,s&&tr.postRender(()=>s(i,o))}}}mount(){this.removePointerDownListener=Md(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const vp={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let ey=!1;class F8 extends x.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r,layoutId:s}=this.props,{projection:i}=e;i&&(n.group&&n.group.add(i),r&&r.register&&s&&r.register(i),ey&&i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),vp.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:r,drag:s,isPresent:i}=this.props,{projection:o}=r;return o&&(o.isPresent=i,ey=!0,s||e.layoutDependency!==n||n===void 0||e.isPresent!==i?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||tr.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Zw.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r}=this.props,{projection:s}=e;ey=!0,s&&(s.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(s),r&&r.deregister&&r.deregister(s))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function yD(t){const[e,n]=$M(),r=x.useContext(vf);return c.jsx(F8,{...t,layoutGroup:r,switchLayoutGroup:x.useContext(XM),isPresent:e,safeToRemove:n})}function B8(t,e,n){const r=ys(t)?t:vu(t);return r.start(uv("",r,e,n)),r.animation}const U8=(t,e)=>t.depth-e.depth;class H8{constructor(){this.children=[],this.isDirty=!1}add(e){Ow(this.children,e),this.isDirty=!0}remove(e){Pw(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(U8),this.isDirty=!1,this.children.forEach(e)}}function V8(t,e){const n=Fs.now(),r=({timestamp:s})=>{const i=s-n;i>=e&&(Wa(r),t(i-e))};return tr.setup(r,!0),()=>Wa(r)}const xD=["TopLeft","TopRight","BottomLeft","BottomRight"],W8=xD.length,s_=t=>typeof t=="string"?parseFloat(t):t,i_=t=>typeof t=="number"||un.test(t);function K8(t,e,n,r,s,i){s?(t.opacity=fr(0,n.opacity??1,G8(r)),t.opacityExit=fr(e.opacity??1,0,q8(r))):i&&(t.opacity=fr(e.opacity??1,n.opacity??1,r));for(let o=0;o<W8;o++){const a=`border${xD[o]}Radius`;let l=o_(e,a),u=o_(n,a);if(l===void 0&&u===void 0)continue;l||(l=0),u||(u=0),l===0||u===0||i_(l)===i_(u)?(t[a]=Math.max(fr(s_(l),s_(u),r),0),(vo.test(u)||vo.test(l))&&(t[a]+="%")):t[a]=u}(e.rotate||n.rotate)&&(t.rotate=fr(e.rotate||0,n.rotate||0,r))}function o_(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const G8=bD(0,.5,rM),q8=bD(.5,.95,Ni);function bD(t,e,n){return r=>r<t?0:r>e?1:n(kf(t,e,r))}function a_(t,e){t.min=e.min,t.max=e.max}function Fi(t,e){a_(t.x,e.x),a_(t.y,e.y)}function l_(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function c_(t,e,n,r,s){return t-=e,t=fm(t,1/n,r),s!==void 0&&(t=fm(t,1/s,r)),t}function Y8(t,e=0,n=1,r=.5,s,i=t,o=t){if(vo.test(e)&&(e=parseFloat(e),e=fr(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=fr(i.min,i.max,r);t===i&&(a-=e),t.min=c_(t.min,e,n,a,s),t.max=c_(t.max,e,n,a,s)}function u_(t,e,[n,r,s],i,o){Y8(t,e[n],e[r],e[s],e.scale,i,o)}const J8=["x","scaleX","originX"],X8=["y","scaleY","originY"];function d_(t,e,n,r){u_(t.x,e,J8,n?n.x:void 0,r?r.x:void 0),u_(t.y,e,X8,n?n.y:void 0,r?r.y:void 0)}function f_(t){return t.translate===0&&t.scale===1}function wD(t){return f_(t.x)&&f_(t.y)}function h_(t,e){return t.min===e.min&&t.max===e.max}function Q8(t,e){return h_(t.x,e.x)&&h_(t.y,e.y)}function p_(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function vD(t,e){return p_(t.x,e.x)&&p_(t.y,e.y)}function m_(t){return Ts(t.x)/Ts(t.y)}function g_(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class Z8{constructor(){this.members=[]}add(e){Ow(this.members,e),e.scheduleRender()}remove(e){if(Pw(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(s=>e===s);if(n===0)return!1;let r;for(let s=n;s>=0;s--){const i=this.members[s];if(i.isPresent!==!1){r=i;break}}return r?(this.promote(r),!0):!1}promote(e,n){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,n&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:s}=e.options;s===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:r}=e;n.onExitComplete&&n.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function e9(t,e,n){let r="";const s=t.x.translate/e.x,i=t.y.translate/e.y,o=(n==null?void 0:n.z)||0;if((s||i||o)&&(r=`translate3d(${s}px, ${i}px, ${o}px) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:u,rotate:d,rotateX:f,rotateY:h,skewX:p,skewY:m}=n;u&&(r=`perspective(${u}px) ${r}`),d&&(r+=`rotate(${d}deg) `),f&&(r+=`rotateX(${f}deg) `),h&&(r+=`rotateY(${h}deg) `),p&&(r+=`skewX(${p}deg) `),m&&(r+=`skewY(${m}deg) `)}const a=t.x.scale*e.x,l=t.y.scale*e.y;return(a!==1||l!==1)&&(r+=`scale(${a}, ${l})`),r||"none"}const ty=["","X","Y","Z"],t9=1e3;let n9=0;function ny(t,e,n,r){const{latestValues:s}=e;s[t]&&(n[t]=s[t],e.setStaticValue(t,0),r&&(r[t]=0))}function kD(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=aD(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:s,layoutId:i}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",tr,!(s||i))}const{parent:r}=t;r&&!r.hasCheckedOptimisedAppear&&kD(r)}function SD({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:r,resetTransform:s}){return class{constructor(o={},a=e==null?void 0:e()){this.id=n9++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(i9),this.nodes.forEach(c9),this.nodes.forEach(u9),this.nodes.forEach(o9)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new H8)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new zw),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const l=this.eventHandlers.get(o);l&&l.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=LM(o)&&!UB(o),this.instance=o;const{layoutId:a,layout:l,visualElement:u}=this.options;if(u&&!u.current&&u.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(l||a)&&(this.isLayoutDirty=!0),t){let d,f=0;const h=()=>this.root.updateBlockedByResize=!1;tr.read(()=>{f=window.innerWidth}),t(o,()=>{const p=window.innerWidth;p!==f&&(f=p,this.root.updateBlockedByResize=!0,d&&d(),d=V8(h,250),vp.hasAnimatedSinceResize&&(vp.hasAnimatedSinceResize=!1,this.nodes.forEach(b_)))})}a&&this.root.registerSharedNode(a,this),this.options.animate!==!1&&u&&(a||l)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:f,hasRelativeLayoutChanged:h,layout:p})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const m=this.options.transition||u.getDefaultTransition()||m9,{onLayoutAnimationStart:y,onLayoutAnimationComplete:b}=u.getProps(),g=!this.targetLayout||!vD(this.targetLayout,p),v=!f&&h;if(this.options.layoutRoot||this.resumeFrom||v||f&&(g||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const w={...Xw(m,"layout"),onPlay:y,onComplete:b};(u.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w),this.setAnimationOrigin(d,v)}else f||b_(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=p})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Wa(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(d9),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&kD(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let d=0;d<this.path.length;d++){const f=this.path[d];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:a,layout:l}=this.options;if(a===void 0&&!l)return;const u=this.getTransformTemplate();this.prevTransformTemplateValue=u?u(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(y_);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(x_);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(l9),this.nodes.forEach(r9),this.nodes.forEach(s9)):this.nodes.forEach(x_),this.clearAllSnapshots();const a=Fs.now();Zr.delta=Zo(0,1e3/60,a-Zr.timestamp),Zr.timestamp=a,Zr.isProcessing=!0,V0.update.process(Zr),V0.preRender.process(Zr),V0.render.process(Zr),Zr.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Zw.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(a9),this.sharedNodes.forEach(f9)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,tr.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){tr.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Ts(this.snapshot.measuredBox.x)&&!Ts(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=Rr(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a&&this.instance){const l=r(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:l,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!s)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!wD(this.projectionDelta),l=this.getTransformTemplate(),u=l?l(this.latestValues,""):void 0,d=u!==this.prevTransformTemplateValue;o&&this.instance&&(a||ml(this.latestValues)||d)&&(s(this.instance,u),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let l=this.removeElementScroll(a);return o&&(l=this.removeTransform(l)),g9(l),{animationId:this.root.animationId,measuredBox:a,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var u;const{visualElement:o}=this.options;if(!o)return Rr();const a=o.measureViewportBox();if(!(((u=this.scroll)==null?void 0:u.wasRoot)||this.path.some(y9))){const{scroll:d}=this.root;d&&(Kc(a.x,d.offset.x),Kc(a.y,d.offset.y))}return a}removeElementScroll(o){var l;const a=Rr();if(Fi(a,o),(l=this.scroll)!=null&&l.wasRoot)return a;for(let u=0;u<this.path.length;u++){const d=this.path[u],{scroll:f,options:h}=d;d!==this.root&&f&&h.layoutScroll&&(f.wasRoot&&Fi(a,o),Kc(a.x,f.offset.x),Kc(a.y,f.offset.y))}return a}applyTransform(o,a=!1){const l=Rr();Fi(l,o);for(let u=0;u<this.path.length;u++){const d=this.path[u];!a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&Gc(l,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),ml(d.latestValues)&&Gc(l,d.latestValues)}return ml(this.latestValues)&&Gc(l,this.latestValues),l}removeTransform(o){const a=Rr();Fi(a,o);for(let l=0;l<this.path.length;l++){const u=this.path[l];if(!u.instance||!ml(u.latestValues))continue;S1(u.latestValues)&&u.updateSnapshot();const d=Rr(),f=u.measurePageBox();Fi(d,f),d_(a,u.latestValues,u.snapshot?u.snapshot.layoutBox:void 0,d)}return ml(this.latestValues)&&d_(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Zr.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var p;const a=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=a.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=a.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=a.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==a;if(!(o||l&&this.isSharedProjectionDirty||this.isProjectionDirty||(p=this.parent)!=null&&p.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:f}=this.options;if(!this.layout||!(d||f))return;this.resolvedRelativeTargetAt=Zr.timestamp;const h=this.getClosestProjectingParent();h&&this.linkedParentVersion!==h.layoutVersion&&!h.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(h&&h.layout?this.createRelativeTarget(h,this.layout.layoutBox,h.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Rr(),this.targetWithTransforms=Rr()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),T8(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Fi(this.target,this.layout.layoutBox),tD(this.target,this.targetDelta)):Fi(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,h&&!!h.resumingFrom==!!this.resumingFrom&&!h.options.layoutScroll&&h.target&&this.animationProgress!==1?this.createRelativeTarget(h,this.target,h.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||S1(this.parent.latestValues)||eD(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(o,a,l){this.relativeParent=o,this.linkedParentVersion=o.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Rr(),this.relativeTargetOrigin=Rr(),hm(this.relativeTargetOrigin,a,l),Fi(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var m;const o=this.getLead(),a=!!this.resumingFrom||this!==o;let l=!0;if((this.isProjectionDirty||(m=this.parent)!=null&&m.isProjectionDirty)&&(l=!1),a&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===Zr.timestamp&&(l=!1),l)return;const{layout:u,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||d))return;Fi(this.layoutCorrected,this.layout.layoutBox);const f=this.treeScale.x,h=this.treeScale.y;LU(this.layoutCorrected,this.treeScale,this.path,a),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=Rr());const{target:p}=o;if(!p){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(l_(this.prevProjectionDelta.x,this.projectionDelta.x),l_(this.prevProjectionDelta.y,this.projectionDelta.y)),Dd(this.projectionDelta,this.layoutCorrected,p,this.latestValues),(this.treeScale.x!==f||this.treeScale.y!==h||!g_(this.projectionDelta.x,this.prevProjectionDelta.x)||!g_(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",p))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var a;if((a=this.options.visualElement)==null||a.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=qc(),this.projectionDelta=qc(),this.projectionDeltaWithTransform=qc()}setAnimationOrigin(o,a=!1){const l=this.snapshot,u=l?l.latestValues:{},d={...this.latestValues},f=qc();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const h=Rr(),p=l?l.source:void 0,m=this.layout?this.layout.source:void 0,y=p!==m,b=this.getStack(),g=!b||b.members.length<=1,v=!!(y&&!g&&this.options.crossfade===!0&&!this.path.some(p9));this.animationProgress=0;let w;this.mixTargetDelta=_=>{const D=_/1e3;w_(f.x,o.x,D),w_(f.y,o.y,D),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(hm(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),h9(this.relativeTarget,this.relativeTargetOrigin,h,D),w&&Q8(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=Rr()),Fi(w,this.relativeTarget)),y&&(this.animationValues=d,K8(d,u,this.latestValues,D,v,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=D},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){var a,l,u;this.notifyListeners("animationStart"),(a=this.currentAnimation)==null||a.stop(),(u=(l=this.resumingFrom)==null?void 0:l.currentAnimation)==null||u.stop(),this.pendingAnimation&&(Wa(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=tr.update(()=>{vp.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=vu(0)),this.currentAnimation=B8(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:d=>{this.mixTargetDelta(d),o.onUpdate&&o.onUpdate(d)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(t9),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:l,layout:u,latestValues:d}=o;if(!(!a||!l||!u)){if(this!==o&&this.layout&&u&&_D(this.options.animationType,this.layout.layoutBox,u.layoutBox)){l=this.target||Rr();const f=Ts(this.layout.layoutBox.x);l.x.min=o.target.x.min,l.x.max=l.x.min+f;const h=Ts(this.layout.layoutBox.y);l.y.min=o.target.y.min,l.y.max=l.y.min+h}Fi(a,l),Gc(a,d),Dd(this.projectionDeltaWithTransform,this.layoutCorrected,a,d)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new Z8),this.sharedNodes.get(o).add(a);const u=a.options.initialPromotionConfig;a.promote({transition:u?u.transition:void 0,preserveFollowOpacity:u&&u.shouldPreserveFollowOpacity?u.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var a;const{layoutId:o}=this.options;return o?((a=this.getStack())==null?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:o}=this.options;return o?(a=this.getStack())==null?void 0:a.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:l}={}){const u=this.getStack();u&&u.promote(this,l),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:l}=o;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(a=!0),!a)return;const u={};l.z&&ny("z",o,u,this.animationValues);for(let d=0;d<ty.length;d++)ny(`rotate${ty[d]}`,o,u,this.animationValues),ny(`skew${ty[d]}`,o,u,this.animationValues);o.render();for(const d in u)o.setStaticValue(d,u[d]),this.animationValues&&(this.animationValues[d]=u[d]);o.scheduleRender()}applyProjectionStyles(o,a){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const l=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=wp(a==null?void 0:a.pointerEvents)||"",o.transform=l?l(this.latestValues,""):"none";return}const u=this.getLead();if(!this.projectionDelta||!this.layout||!u.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=wp(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!ml(this.latestValues)&&(o.transform=l?l({},""):"none",this.hasProjected=!1);return}o.visibility="";const d=u.animationValues||u.latestValues;this.applyTransformsToTarget();let f=e9(this.projectionDeltaWithTransform,this.treeScale,d);l&&(f=l(d,f)),o.transform=f;const{x:h,y:p}=this.projectionDelta;o.transformOrigin=`${h.origin*100}% ${p.origin*100}% 0`,u.animationValues?o.opacity=u===this?d.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:o.opacity=u===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const m in k1){if(d[m]===void 0)continue;const{correct:y,applyTo:b,isCSSVariable:g}=k1[m],v=f==="none"?d[m]:y(d[m],u);if(b){const w=b.length;for(let _=0;_<w;_++)o[b[_]]=v}else g?this.options.visualElement.renderState.vars[m]=v:o[m]=v}this.options.layoutId&&(o.pointerEvents=u===this?wp(a==null?void 0:a.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var a;return(a=o.currentAnimation)==null?void 0:a.stop()}),this.root.nodes.forEach(y_),this.root.sharedNodes.clear()}}}function r9(t){t.updateLayout()}function s9(t){var n;const e=((n=t.resumeFrom)==null?void 0:n.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:s}=t.layout,{animationType:i}=t.options,o=e.source!==t.layout.source;i==="size"?gi(f=>{const h=o?e.measuredBox[f]:e.layoutBox[f],p=Ts(h);h.min=r[f].min,h.max=h.min+p}):_D(i,e.layoutBox,r)&&gi(f=>{const h=o?e.measuredBox[f]:e.layoutBox[f],p=Ts(r[f]);h.max=h.min+p,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[f].max=t.relativeTarget[f].min+p)});const a=qc();Dd(a,r,e.layoutBox);const l=qc();o?Dd(l,t.applyTransform(s,!0),e.measuredBox):Dd(l,r,e.layoutBox);const u=!wD(a);let d=!1;if(!t.resumeFrom){const f=t.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:h,layout:p}=f;if(h&&p){const m=Rr();hm(m,e.layoutBox,h.layoutBox);const y=Rr();hm(y,r,p.layoutBox),vD(m,y)||(d=!0),f.options.layoutRoot&&(t.relativeTarget=y,t.relativeTargetOrigin=m,t.relativeParent=f)}}}t.notifyListeners("didUpdate",{layout:r,snapshot:e,delta:l,layoutDelta:a,hasLayoutChanged:u,hasRelativeLayoutChanged:d})}else if(t.isLead()){const{onExitComplete:r}=t.options;r&&r()}t.options.transition=void 0}function i9(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function o9(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function a9(t){t.clearSnapshot()}function y_(t){t.clearMeasurements()}function x_(t){t.isLayoutDirty=!1}function l9(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function b_(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function c9(t){t.resolveTargetDelta()}function u9(t){t.calcProjection()}function d9(t){t.resetSkewAndRotation()}function f9(t){t.removeLeadSnapshot()}function w_(t,e,n){t.translate=fr(e.translate,0,n),t.scale=fr(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function v_(t,e,n,r){t.min=fr(e.min,n.min,r),t.max=fr(e.max,n.max,r)}function h9(t,e,n,r){v_(t.x,e.x,n.x,r),v_(t.y,e.y,n.y,r)}function p9(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const m9={duration:.45,ease:[.4,0,.1,1]},k_=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),S_=k_("applewebkit/")&&!k_("chrome/")?Math.round:Ni;function __(t){t.min=S_(t.min),t.max=S_(t.max)}function g9(t){__(t.x),__(t.y)}function _D(t,e,n){return t==="position"||t==="preserve-aspect"&&!_8(m_(e),m_(n),.2)}function y9(t){var e;return t!==t.root&&((e=t.scroll)==null?void 0:e.wasRoot)}const x9=SD({attachResizeListener:(t,e)=>Cf(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),ry={current:void 0},TD=SD({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!ry.current){const t=new x9({});t.mount(window),t.setOptions({layoutScroll:!0}),ry.current=t}return ry.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),b9={pan:{Feature:z8},drag:{Feature:$8,ProjectionNode:TD,MeasureLayout:yD}};function T_(t,e,n){const{props:r}=t;t.animationState&&r.whileHover&&t.animationState.setActive("whileHover",n==="Start");const s="onHover"+n,i=r[s];i&&tr.postRender(()=>i(e,th(e)))}class w9 extends Za{mount(){const{current:e}=this.node;e&&(this.unmount=LB(e,(n,r)=>(T_(this.node,r,"Start"),s=>T_(this.node,s,"End"))))}unmount(){}}class v9 extends Za{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Qf(Cf(this.node.current,"focus",()=>this.onFocus()),Cf(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function C_(t,e,n){const{props:r}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&r.whileTap&&t.animationState.setActive("whileTap",n==="Start");const s="onTap"+(n==="End"?"":n),i=r[s];i&&tr.postRender(()=>i(e,th(e)))}class k9 extends Za{mount(){const{current:e}=this.node;e&&(this.unmount=BB(e,(n,r)=>(C_(this.node,r,"Start"),(s,{success:i})=>C_(this.node,s,i?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const I1=new WeakMap,sy=new WeakMap,S9=t=>{const e=I1.get(t.target);e&&e(t)},_9=t=>{t.forEach(S9)};function T9({root:t,...e}){const n=t||document;sy.has(n)||sy.set(n,{});const r=sy.get(n),s=JSON.stringify(e);return r[s]||(r[s]=new IntersectionObserver(_9,{root:t,...e})),r[s]}function C9(t,e,n){const r=T9(e);return I1.set(t,n),r.observe(t),()=>{I1.delete(t),r.unobserve(t)}}const E9={some:0,all:1};class N9 extends Za{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:r,amount:s="some",once:i}=e,o={root:n?n.current:void 0,rootMargin:r,threshold:typeof s=="number"?s:E9[s]},a=l=>{const{isIntersecting:u}=l;if(this.isInView===u||(this.isInView=u,i&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:d,onViewportLeave:f}=this.node.getProps(),h=u?d:f;h&&h(l)};return C9(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(j9(e,n))&&this.startObserver()}unmount(){}}function j9({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const I9={inView:{Feature:N9},tap:{Feature:k9},focus:{Feature:v9},hover:{Feature:w9}},M9={layout:{ProjectionNode:TD,MeasureLayout:yD}},D9={...x8,...I9,...b9,...M9},Lr=RU(D9,GU),A9=({url:t,fileName:e,autoPlay:n=!1,markers:r=[],onClose:s,seekToTime:i})=>{const o=x.useRef(null),[a,l]=x.useState(n),[u,d]=x.useState(0),[f,h]=x.useState(0);x.useEffect(()=>{n&&o.current&&o.current.play().catch(console.error)},[t,n]);const p=()=>{o.current&&(a?o.current.pause():o.current.play(),l(!a))},m=()=>{o.current&&h(o.current.currentTime)},y=()=>{o.current&&d(o.current.duration)},b=_=>{const D=parseFloat(_.target.value);o.current&&(o.current.currentTime=D,h(D))},g=_=>{if(o.current){const D=Math.min(Math.max(o.current.currentTime+_,0),u);o.current.currentTime=D,h(D)}},v=_=>{if(o.current){const D=_/1e3;o.current.currentTime=D,h(D),o.current.play().catch(console.error),l(!0)}};x.useEffect(()=>{i!=null&&o.current&&v(i)},[i]);const w=_=>{if(isNaN(_))return"0:00";const D=Math.floor(_/60),k=Math.floor(_%60);return`${D}:${k.toString().padStart(2,"0")}`};return c.jsxs("div",{className:"w-full bg-slate-50 border border-indigo-100 rounded-xl p-3 mb-4 animate-in fade-in slide-in-from-top-2 flex flex-col gap-2 shadow-sm sticky top-0 z-10 backdrop-blur-sm bg-slate-50/95",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 flex-shrink-0",children:c.jsx(o1,{size:16})}),c.jsx("span",{className:"text-xs font-medium text-slate-700 truncate",title:e,children:e||"Audio Recording"}),r.length>0&&c.jsxs("span",{className:"text-[10px] text-slate-400 bg-slate-200 px-1.5 py-0.5 rounded-full",children:[r.length," "]})]}),s&&c.jsx("button",{onClick:s,className:"p-1 hover:bg-slate-200 rounded-full text-slate-400 hover:text-slate-600 transition-colors",children:c.jsx(hn,{size:14})})]}),c.jsx("audio",{ref:o,src:t,onTimeUpdate:m,onLoadedMetadata:y,onEnded:()=>l(!1),className:"hidden"}),c.jsxs("div",{className:"flex items-center justify-between gap-3",children:[c.jsxs("button",{onClick:()=>g(-5),className:"flex items-center gap-0.5 px-2 py-1 text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors text-xs",title:" 5 ",children:[c.jsx(BI,{size:14}),c.jsx("span",{className:"font-mono text-[10px]",children:"5s"})]}),c.jsx("button",{onClick:p,className:"w-10 h-10 flex items-center justify-center bg-indigo-600 text-white rounded-full hover:bg-indigo-700 shadow-md transition-all active:scale-95",children:a?c.jsx($I,{size:20,fill:"currentColor"}):c.jsx(zI,{size:20,fill:"currentColor",className:"ml-1"})}),c.jsxs("button",{onClick:()=>g(5),className:"flex items-center gap-0.5 px-2 py-1 text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors text-xs",title:" 5 ",children:[c.jsx("span",{className:"font-mono text-[10px]",children:"5s"}),c.jsx($z,{size:14})]}),c.jsxs("div",{className:"flex-1 flex items-center gap-2 min-w-0",children:[c.jsx("span",{className:"text-[10px] font-mono tabular-nums text-slate-500 w-8 text-right",children:w(f)}),c.jsxs("div",{className:"relative flex-1 h-8 flex items-center group select-none",children:[c.jsx("div",{className:"absolute inset-0 flex items-center pointer-events-none",children:c.jsx("div",{className:"w-full h-1 bg-slate-200 rounded-full overflow-visible relative",children:c.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-100 rounded-full",style:{width:`${f/(u||1)*100}%`}})})}),c.jsx("input",{type:"range",min:0,max:u||100,value:f,onChange:b,className:"absolute inset-0 w-full opacity-0 cursor-pointer z-10"})]}),c.jsx("span",{className:"text-[10px] font-mono tabular-nums text-slate-500 w-8",children:w(u)})]})]})]})},CD=({checked:t,isCanceled:e=!1,onChange:n,size:r=18,color:s="blue",isRoot:i=!1})=>{const o={gray:{root:"bg-gray-500 border-gray-500 text-white",sub:"bg-gray-100 border-gray-200 text-gray-500",hover:"hover:border-gray-500",border:"border-gray-400"},blue:{root:"bg-blue-500 border-blue-500 text-white",sub:"bg-blue-100 border-blue-200 text-blue-500",hover:"hover:border-blue-500",border:"border-blue-400"},indigo:{root:"bg-indigo-500 border-indigo-500 text-white",sub:"bg-indigo-100 border-indigo-200 text-indigo-500",hover:"hover:border-indigo-500",border:"border-indigo-400"},red:{root:"bg-red-500 border-red-500 text-white",sub:"bg-red-100 border-red-200 text-red-500",hover:"hover:border-red-500",border:"border-red-400"},orange:{root:"bg-orange-500 border-orange-500 text-white",sub:"bg-orange-100 border-orange-200 text-orange-500",hover:"hover:border-orange-500",border:"border-orange-400"},amber:{root:"bg-amber-500 border-amber-500 text-white",sub:"bg-amber-100 border-amber-200 text-amber-500",hover:"hover:border-amber-500",border:"border-amber-400"},green:{root:"bg-emerald-500 border-emerald-500 text-white",sub:"bg-emerald-100 border-emerald-200 text-emerald-500",hover:"hover:border-emerald-500",border:"border-emerald-400"},teal:{root:"bg-teal-500 border-teal-500 text-white",sub:"bg-teal-100 border-teal-200 text-teal-500",hover:"hover:border-teal-500",border:"border-teal-400"},cyan:{root:"bg-cyan-500 border-cyan-500 text-white",sub:"bg-cyan-100 border-cyan-200 text-cyan-500",hover:"hover:border-cyan-500",border:"border-cyan-400"},sky:{root:"bg-sky-500 border-sky-500 text-white",sub:"bg-sky-100 border-sky-200 text-sky-500",hover:"hover:border-sky-500",border:"border-sky-400"},purple:{root:"bg-purple-500 border-purple-500 text-white",sub:"bg-purple-100 border-purple-200 text-purple-500",hover:"hover:border-purple-500",border:"border-purple-400"},fuchsia:{root:"bg-fuchsia-500 border-fuchsia-500 text-white",sub:"bg-fuchsia-100 border-fuchsia-200 text-fuchsia-500",hover:"hover:border-fuchsia-500",border:"border-fuchsia-400"},pink:{root:"bg-pink-500 border-pink-500 text-white",sub:"bg-pink-100 border-pink-200 text-pink-500",hover:"hover:border-pink-500",border:"border-pink-400"},rose:{root:"bg-rose-500 border-rose-500 text-white",sub:"bg-rose-100 border-rose-200 text-rose-500",hover:"hover:border-rose-500",border:"border-rose-400"}},a=o[s]||o.gray,l=i?a.root:a.sub,d=`bg-transparent ${i?"border-2":""} ${a.border} ${a.hover}`;return c.jsx("div",{onClick:n,className:`group relative cursor-pointer flex items-center justify-center transition-all duration-200 ease-out border shadow-sm ${t||e?l:d}`,style:{width:r,height:r,borderRadius:r*.25},children:e?c.jsx(hn,{size:r*.7,className:"text-current scale-100 opacity-100",strokeWidth:3}):c.jsx(Zn,{size:r*.7,className:`transition-all duration-300 ease-back-out ${t?"scale-100 opacity-100":"scale-50 opacity-0"}`,strokeWidth:3})})},E_=({label:t,value:e,onChange:n,theme:r,tasks:s,innerRef:i,colorClass:o})=>{const{themeSettings:a,language:l,t:u}=x.useContext(jn),[d,f]=x.useState(""),[h,p]=x.useState(!1),[m,y]=x.useState(new Date),[b,g]=x.useState(null),[v,w]=x.useState(null),[_,D]=x.useState({top:0,left:0}),k=x.useRef(null),A=x.useRef(null),N=x.useRef(!1),E=x.useRef(!1),S=x.useRef(null),T=i||S;x.useEffect(()=>{const oe=je=>{h&&k.current&&!k.current.contains(je.target)&&A.current&&!A.current.contains(je.target)&&(p(!1),f(""),w(null))};return document.addEventListener("mousedown",oe),()=>document.removeEventListener("mousedown",oe)},[h]),x.useEffect(()=>{if(e){const oe=new Date(e);isNaN(oe.getTime())||y(oe)}},[e]);const C=oe=>{const je=oe.target.value;f(je);const te=L6(je);te?(y(te),w(te),g(te)):w(null)},O=()=>{var je;const oe=v||b||m;if(oe){if(e){const te=new Date(e);oe.setHours(te.getHours(),te.getMinutes())}n(oe.toISOString()),p(!1),f(""),E.current=!0,(je=T.current)==null||je.focus(),setTimeout(()=>E.current=!1,200)}},P=()=>{if(T.current){const oe=T.current.getBoundingClientRect(),je=window.innerWidth,te=window.innerHeight,$e=288,Te=400;let Je=oe.left,Ye=oe.bottom+8;Ye+Te>te&&oe.top-Te>0&&(Ye=oe.top-Te-8),Je+$e>je&&(Je=je-$e-10),D({top:Ye,left:Je})}},H=oe=>{var je;oe.key==="Enter"?(oe.preventDefault(),oe.metaKey||oe.ctrlKey||oe.stopPropagation(),h?O():(P(),p(!0))):oe.key==="Escape"?(oe.preventDefault(),h&&(oe.stopPropagation(),p(!1),f(""),E.current=!0,(je=T.current)==null||je.focus(),setTimeout(()=>E.current=!1,200))):oe.key===" "&&(oe.preventDefault(),oe.stopPropagation(),P(),p(!0))},M=oe=>{},I=oe=>{N.current||E.current||(P(),p(!0))},K=()=>{h||P(),p(!h)},G=oe=>s.filter(je=>{if(je.status==="completed"||je.status==="deleted")return!1;const te=je.start_date?new Date(je.start_date):null,$e=je.due_date?new Date(je.due_date):null;return te&&Ti(te,oe)||$e&&Ti($e,oe)}),R=oe=>{const je=new Date(m.getFullYear(),m.getMonth(),oe);y(je),g(je),w(je)},Ee=()=>{const oe=new Date(m.getFullYear(),m.getMonth()+1,0).getDate(),je=new Date(m.getFullYear(),m.getMonth(),1).getDay(),te=[];for(let $e=0;$e<je;$e++)te.push(c.jsx("div",{className:"h-8 w-8"},`empty-${$e}`));for(let $e=1;$e<=oe;$e++){const Te=new Date(m.getFullYear(),m.getMonth(),$e),Je=e&&Ti(new Date(e),Te),Ye=v&&Ti(v,Te),lt=G(Te).length;let St="bg-transparent";lt>=1&&lt<=3?St="bg-green-400":lt>=4&&lt<=10?St="bg-yellow-400":lt>10&&(St="bg-red-500");const X=Cw(Te.toISOString());let ee="h-8 w-8 rounded-full flex items-center justify-center text-xs relative transition-all ";Ye?ee+="bg-indigo-600/80 text-white font-bold shadow-md":Je?ee+="bg-indigo-500 text-white font-bold":(ee+="hover:bg-theme-hover text-theme-primary",X&&(ee+=" text-red-500 font-bold")),X?ee+=" border-2 border-red-400":ee+=" border-2 border-transparent",te.push(c.jsxs("button",{type:"button",onMouseDown:ie=>ie.preventDefault(),onClick:()=>R($e),onMouseEnter:()=>g(Te),className:ee,children:[$e,!Je&&!Ye&&lt>0&&c.jsx("div",{className:`absolute bottom-1 w-1 h-1 rounded-full ${St}`})]},$e))}return te},ge=v||b||(e?new Date(e):null),F=ge?G(ge):[],B=(r==null?void 0:r.buttonRing)||"focus:ring-indigo-300 focus:border-indigo-300",se=o||(r==null?void 0:r.text)||"text-theme-tertiary",We={small:"text-[11px]",normal:"text-xs",large:"text-sm"}[a.fontSize]||"text-xs",ut=a.fontWeight==="thin"?"font-light":"font-medium";return c.jsxs("div",{className:"relative",ref:k,onBlur:M,children:[c.jsxs("button",{ref:T,type:"button",onMouseDown:()=>{N.current=!0,setTimeout(()=>N.current=!1,200)},onClick:K,onKeyDown:H,onFocus:I,className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border ${We} ${ut} ${B}
            ${e?`${se} border-theme bg-theme-hover hover:border-theme-hover hover:scale-[1.02]`:"text-theme-tertiary border-transparent hover:bg-theme-hover hover:text-theme-secondary"}
            focus:outline-none focus:bg-theme-card focus:ring-1 focus:border-theme
        `,children:[c.jsx(So,{size:13}),c.jsx("span",{children:e?bI(e,!1,l):t}),e&&c.jsx(hn,{size:12,className:"ml-1 hover:text-red-500",onClick:oe=>{oe.stopPropagation(),n(null)}})]}),h&&or.createPortal(c.jsxs("div",{ref:A,className:"fixed bg-theme-card rounded-xl shadow-2xl border border-theme p-4 z-[99999] w-72 max-w-[90vw] animate-in fade-in zoom-in duration-100",style:{top:_.top,left:_.left},onClick:oe=>oe.stopPropagation(),onMouseDown:oe=>oe.stopPropagation(),children:[c.jsxs("div",{className:"mb-3 relative",children:[c.jsx("input",{autoFocus:!0,type:"text",placeholder:u("dateInputPlaceholder"),className:"w-full text-xs box-border bg-theme-main border border-theme rounded p-2 text-theme-primary focus:ring-2 focus:ring-indigo-500/50 outline-none pr-8",value:d,onChange:C,onKeyDown:H}),v&&c.jsxs("div",{className:"absolute right-2 top-2 text-[10px] text-indigo-500 font-bold bg-theme-hover px-1 rounded animate-pulse",children:[u("identified"),": ",$6(v.toISOString(),l)]})]}),c.jsxs("div",{className:"flex justify-between items-center mb-2 text-theme-primary",children:[c.jsx("button",{type:"button",onMouseDown:oe=>oe.preventDefault(),onClick:()=>y(new Date(m.getFullYear(),m.getMonth()-1,1)),className:"p-1 hover:bg-theme-hover rounded",children:c.jsx(Ou,{size:16})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"font-bold text-sm cursor-pointer hover:text-indigo-500 transition-colors",title:u("backToToday"),onClick:()=>y(new Date),children:m.toLocaleString(l==="zh"?"zh-TW":"en-US",{month:"long",year:"numeric"})}),c.jsx("button",{type:"button",onMouseDown:oe=>oe.preventDefault(),onClick:()=>y(new Date),className:"text-[10px] px-1.5 py-0.5 bg-indigo-50 text-indigo-600 rounded-full hover:bg-indigo-100 font-bold",children:""})]}),c.jsx("button",{type:"button",onMouseDown:oe=>oe.preventDefault(),onClick:()=>y(new Date(m.getFullYear(),m.getMonth()+1,1)),className:"p-1 hover:bg-theme-hover rounded",children:c.jsx(is,{size:16})})]}),c.jsxs("div",{className:"grid grid-cols-7 gap-1 mb-2 text-center text-xs font-bold text-theme-tertiary",children:[(l==="zh"?["","","","","","",""]:["S","M","T","W","T","F","S"]).map(oe=>c.jsx("span",{children:oe},oe)),Ee()]}),c.jsxs("div",{className:"border-t border-theme pt-3 mt-3",children:[c.jsxs("div",{className:"text-[10px] font-bold text-theme-tertiary mb-2 flex justify-between items-center",children:[c.jsx("span",{children:ge?`${ge.getMonth()+1}/${ge.getDate()} ${u("scheduleTitle")}`:u("scheduleTitle")}),c.jsx("span",{className:"bg-theme-hover px-1.5 rounded text-theme-secondary",children:F.length})]}),c.jsx("div",{className:"max-h-24 overflow-y-auto space-y-1 custom-scrollbar",children:F.length>0?F.map(oe=>c.jsx("div",{className:"text-[10px] bg-theme-hover p-1 rounded truncate border-l-2 border-indigo-400 pl-2 text-theme-secondary",children:oe.title},oe.id)):c.jsx("div",{className:"text-[10px] text-theme-tertiary italic text-center py-2",children:u("noSchedule")})})]}),c.jsx("button",{type:"button",onMouseDown:oe=>oe.preventDefault(),onClick:O,className:"w-full mt-3 bg-indigo-600 text-white text-xs font-bold py-1.5 rounded hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-500/20",children:u("confirmDate")})]}),document.body)]})},M1=({icon:t,label:e,items:n,selectedIds:r,onSelect:s,onSearch:i,placeholder:o,allowAdd:a,onDeleteItem:l,innerRef:u,multiSelect:d=!1,theme:f})=>{const{themeSettings:h,t:p}=x.useContext(jn),[m,y]=x.useState(!1),[b,g]=x.useState(""),[v,w]=x.useState(-1),[_,D]=x.useState({top:0,left:0}),[k,A]=x.useState(!1),[N,E]=x.useState(null),[S,T]=x.useState(null),[C,O]=x.useState(""),[P,H]=x.useState(-1),M=x.useRef(null),I=x.useRef(null),K=x.useRef(!1),G=x.useRef(!1),R=x.useRef(null),Ee=x.useRef(null),ge=x.useRef(null),F=u||ge;x.useEffect(()=>{const ne=Se=>{m&&M.current&&!M.current.contains(Se.target)&&I.current&&!I.current.contains(Se.target)&&(y(!1),g(""),A(!1),E(null),T(null))};return document.addEventListener("mousedown",ne),()=>document.removeEventListener("mousedown",ne)},[m]);const B=x.useMemo(()=>!n||!Array.isArray(n)?[]:n.filter(ne=>ne?(ne.title||ne.name||"").toLowerCase().includes(b.toLowerCase()):!1),[n,b]),se=x.useMemo(()=>!n||!Array.isArray(n)?[]:n.filter(ne=>ne?(ne.title||ne.name||"").toLowerCase().includes(C.toLowerCase()):!1),[n,C]),We=a&&b.trim()&&!B.some(ne=>(ne.title||ne.name||"").toLowerCase()===b.trim().toLowerCase()),ut=B.length+(We?1:0),oe=x.useMemo(()=>r.length===0?null:n.find(ne=>r.includes(ne.id)),[n,r]),je=oe&&(oe.title||oe.name)||e,te=(ne,Se,Ie)=>{var fe;s(ne,Se,Ie),d?(g(""),w(-1),y(!0),setTimeout(()=>{var Oe;return(Oe=R.current)==null?void 0:Oe.focus()},0)):(g(""),y(!1),K.current=!0,(fe=F.current)==null||fe.focus(),setTimeout(()=>K.current=!1,200)),A(!1),E(null),T(null),O("")},$e=()=>{E(b.trim()),A(!0),O(""),setTimeout(()=>{var ne;return(ne=Ee.current)==null?void 0:ne.focus()},50)},Te=()=>{N&&te(null,N,S)},Je=()=>{A(!1),E(null),T(null),O(""),setTimeout(()=>{var ne;return(ne=R.current)==null?void 0:ne.focus()},50)},Ye=()=>{if(F.current){const ne=F.current.getBoundingClientRect(),Se=window.innerWidth,Ie=window.innerHeight,fe=280,Oe=350;let et=ne.left,xt=ne.bottom+8;xt+Oe>Ie&&ne.top-Oe>0&&(xt=ne.top-Oe-8),et+fe>Se&&(et=Se-fe-10),D({top:xt,left:et})}},Ke=ne=>{var Se,Ie,fe;if(k){const Oe=se.length+1;if(ne.key==="Escape")ne.preventDefault(),ne.stopPropagation(),Je();else if(ne.key==="ArrowDown"){ne.preventDefault();const et=P+1>=Oe?-1:P+1;H(et),T(et===-1?null:((Se=se[et])==null?void 0:Se.id)||null)}else if(ne.key==="ArrowUp"){ne.preventDefault();const et=P-1<-1?Oe-1:P-1;H(et),T(et===-1?null:((Ie=se[et])==null?void 0:Ie.id)||null)}else ne.key==="Enter"&&(ne.preventDefault(),ne.stopPropagation(),Te());return}ne.key==="ArrowDown"?(ne.preventDefault(),m||(Ye(),y(!0)),w(Oe=>Oe===-1?0:(Oe+1)%ut)):ne.key==="ArrowUp"?(ne.preventDefault(),m||(Ye(),y(!0)),w(Oe=>Oe<=0?ut-1:Oe-1)):ne.key==="Enter"?(ne.preventDefault(),ne.metaKey||ne.ctrlKey||ne.stopPropagation(),m?v>=0&&v<B.length?te(B[v].id):We&&(v===B.length||v===-1)&&$e():(Ye(),y(!0))):ne.key==="Escape"&&(ne.preventDefault(),m&&(ne.stopPropagation(),y(!1),K.current=!0,(fe=F.current)==null||fe.focus(),setTimeout(()=>K.current=!1,200)))},lt=ne=>{},St=ne=>{G.current||K.current||(Ye(),y(!0))},X=()=>{m||Ye(),y(!m)},ee=(f==null?void 0:f.buttonRing)||"focus:ring-indigo-300 focus:border-indigo-300",ie={small:"text-[11px]",normal:"text-xs",large:"text-sm"}[h.fontSize]||"text-xs",ce=h.fontWeight==="thin"?"font-light":"font-medium",Z=ne=>{if(!ne)return null;const Se=n.find(Ie=>Ie.id===ne);return Se?Se.title||Se.name:null};return c.jsxs("div",{className:"relative",ref:M,onBlur:lt,children:[c.jsxs("button",{ref:F,type:"button",onMouseDown:()=>{G.current=!0,setTimeout(()=>G.current=!1,200)},onClick:X,onKeyDown:Ke,onFocus:St,className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border ${ie} ${ce}
                    ${r.length>0?"text-indigo-600 bg-theme-hover border-theme shadow-sm":"text-theme-tertiary border-transparent hover:bg-theme-hover hover:text-theme-secondary"}
                    focus:outline-none focus:bg-theme-card focus:ring-1 focus:border-theme ${ee}`,children:[c.jsx(t,{size:13})," ",c.jsx("span",{className:"truncate max-w-[80px]",children:je})]}),m&&or.createPortal(c.jsx("div",{ref:I,className:"fixed bg-theme-card rounded-lg shadow-xl border border-theme z-[99999] w-72 p-2 animate-in fade-in zoom-in duration-100",style:{top:_.top,left:_.left},onClick:ne=>ne.stopPropagation(),onMouseDown:ne=>ne.stopPropagation(),children:k?c.jsxs("div",{className:"animate-in slide-in-from-right-2 duration-150",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-theme",children:[c.jsx("button",{type:"button",onClick:Je,className:"text-xs text-theme-tertiary hover:text-theme-primary transition-colors",children:" "}),c.jsxs("span",{className:"text-xs font-medium text-theme-primary",children:[' "',N,'"']})]}),c.jsxs("div",{className:"mb-2",children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-theme-tertiary mb-1",children:[c.jsx(xz,{size:11}),c.jsx("span",{children:""})]}),c.jsx("input",{ref:Ee,type:"text",placeholder:"...",className:"w-full text-xs box-border bg-theme-main border border-theme rounded p-2 text-theme-primary focus:ring-1 focus:ring-indigo-500/50 outline-none",value:C,onChange:ne=>O(ne.target.value),onKeyDown:Ke})]}),c.jsxs("div",{className:"max-h-40 overflow-y-auto space-y-0.5 custom-scrollbar mb-2",children:[c.jsxs("div",{onMouseDown:ne=>{ne.preventDefault(),T(null),H(-1)},onMouseEnter:()=>H(-1),className:`px-2 py-1.5 text-xs rounded cursor-pointer flex items-center justify-between ${P===-1?"bg-indigo-50 text-indigo-700 ring-1 ring-indigo-200":"text-theme-secondary hover:bg-theme-hover"}`,children:[c.jsx("span",{className:"text-theme-tertiary italic",children:""}),S===null&&c.jsx(Zn,{size:12,className:"text-indigo-600"})]}),se.map((ne,Se)=>c.jsxs("div",{onMouseDown:Ie=>{Ie.preventDefault(),T(ne.id),H(Se)},onMouseEnter:()=>H(Se),className:`px-2 py-1.5 text-xs rounded cursor-pointer flex items-center justify-between ${P===Se?"bg-indigo-50 text-indigo-700 ring-1 ring-indigo-200":"text-theme-secondary hover:bg-theme-hover"}`,style:{paddingLeft:ne.depth?`${ne.depth*12+8}px`:"8px"},children:[c.jsxs("div",{className:"flex items-center gap-1.5 truncate",children:[c.jsx("span",{className:"truncate",children:ne.title||ne.name}),ne.parentName&&c.jsx("span",{className:"text-[9px] text-theme-tertiary font-normal bg-theme-hover px-1 rounded truncate",children:ne.parentName})]}),S===ne.id&&c.jsx(Zn,{size:12,className:"text-indigo-600"})]},ne.id))]}),S&&c.jsxs("div",{className:"text-[10px] text-theme-tertiary mb-2 px-1",children:[" ",c.jsx("span",{className:"font-medium text-indigo-600",children:Z(S)})," "]}),c.jsxs("button",{type:"button",onClick:Te,className:"w-full py-2 px-3 bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-medium rounded-lg transition-colors flex items-center justify-center gap-1.5",children:[c.jsx(ri,{size:14}),""]})]}):c.jsxs(c.Fragment,{children:[c.jsx("input",{ref:R,autoFocus:!0,type:"text",placeholder:o,className:"w-full text-xs box-border bg-theme-main border-none rounded p-2 mb-1 text-theme-primary focus:ring-1 focus:ring-indigo-500/50 outline-none",value:b,onChange:ne=>{g(ne.target.value),w(-1),i&&i(ne.target.value)},onKeyDown:Ke}),c.jsxs("div",{className:"max-h-48 overflow-y-auto space-y-0.5 custom-scrollbar",children:[B.map((ne,Se)=>c.jsxs("div",{onMouseDown:Ie=>{Ie.preventDefault(),te(ne.id)},onMouseEnter:()=>w(Se),className:`px-2 py-1.5 text-xs rounded cursor-pointer flex items-center justify-between group ${Se===v?"bg-theme-selection text-theme-primary":"text-theme-secondary hover:bg-theme-hover"}`,style:{paddingLeft:ne.depth?`${ne.depth*12+8}px`:"8px"},children:[c.jsxs("div",{className:"flex items-center gap-1.5 truncate",children:[c.jsx("span",{className:"truncate",children:ne.title||ne.name}),ne.parentName&&c.jsxs("span",{className:"text-[9px] text-theme-tertiary font-normal bg-theme-hover px-1 rounded truncate",children:[p("from"),": ",ne.parentName]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[r.includes(ne.id)&&c.jsx(Zn,{size:12,className:"text-indigo-600"}),l&&c.jsx(jr,{size:12,className:"text-gray-400 opacity-0 group-hover:opacity-100 hover:text-red-500",onClick:Ie=>{Ie.stopPropagation(),l(ne.id)}})]})]},ne.id)),We&&c.jsxs("div",{onMouseEnter:()=>w(B.length),className:`px-2 py-1.5 text-xs cursor-pointer rounded flex items-center gap-1 ${v===B.length?"bg-theme-selection text-theme-primary":"text-indigo-600 hover:bg-theme-hover"}`,onMouseDown:ne=>{ne.preventDefault(),$e()},children:[c.jsx(ri,{size:12})," ",p("addNewTag"),' "',b,'"',c.jsx(is,{size:12,className:"ml-auto opacity-50"})]})]})]})}),document.body)]})},ED=({tag:t,onRemove:e,size:n="normal"})=>{const{themeSettings:r,tagsWithResolvedColors:s}=x.useContext(jn),i={small:{text:{small:"text-[8px]",normal:"text-[9px]",large:"text-[10px]"},padding:"px-1.5 py-0.5"},normal:{text:{small:"text-[9px]",normal:"text-[10px]",large:"text-xs"},padding:"px-2 py-0.5"}},o=i[n].text[r.fontSize]||i[n].text.normal,a=i[n].padding,l=r.fontWeight==="thin"?"font-light":"font-normal";return c.jsxs("div",{className:`inline-flex items-center gap-1 bg-theme-hover text-theme-secondary ${a} rounded-md border border-theme ${o} ${l}`,children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:s[t.id]||t.color}}),c.jsx("span",{children:t.name}),e&&c.jsx("button",{type:"button",onClick:e,className:"hover:text-theme-primary",children:c.jsx(hn,{size:10})})]})};function R9(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in t)){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(t)}function ND(t,e){return new Promise(function(n,r){let s;return O9(t).then(function(i){try{return s=i,n(new Blob([e.slice(0,2),s,e.slice(2)],{type:"image/jpeg"}))}catch(o){return r(o)}},r)})}const O9=t=>new Promise((e,n)=>{const r=new FileReader;r.addEventListener("load",({target:{result:s}})=>{const i=new DataView(s);let o=0;if(i.getUint16(o)!==65496)return n("not a valid JPEG");for(o+=2;;){const a=i.getUint16(o);if(a===65498)break;const l=i.getUint16(o+2);if(a===65505&&i.getUint32(o+4)===1165519206){const u=o+10;let d;switch(i.getUint16(u)){case 18761:d=!0;break;case 19789:d=!1;break;default:return n("TIFF header contains invalid endian")}if(i.getUint16(u+2,d)!==42)return n("TIFF header contains invalid version");const f=i.getUint32(u+4,d),h=u+f+2+12*i.getUint16(u+f,d);for(let p=u+f+2;p<h;p+=12)if(i.getUint16(p,d)==274){if(i.getUint16(p+2,d)!==3)return n("Orientation data type is invalid");if(i.getUint32(p+4,d)!==1)return n("Orientation data count is invalid");i.setUint16(p+8,1,d);break}return e(s.slice(o,o+2+l))}o+=2+l}return e(new Blob)}),r.readAsArrayBuffer(t)});var pm={},P9={get exports(){return pm},set exports(t){pm=t}};(function(t){var e,n,r={};P9.exports=r,r.parse=function(s,i){for(var o=r.bin.readUshort,a=r.bin.readUint,l=0,u={},d=new Uint8Array(s),f=d.length-4;a(d,f)!=101010256;)f--;l=f,l+=4;var h=o(d,l+=4);o(d,l+=2);var p=a(d,l+=2),m=a(d,l+=4);l+=4,l=m;for(var y=0;y<h;y++){a(d,l),l+=4,l+=4,l+=4,a(d,l+=4),p=a(d,l+=4);var b=a(d,l+=4),g=o(d,l+=4),v=o(d,l+2),w=o(d,l+4);l+=6;var _=a(d,l+=8);l+=4,l+=g+v+w,r._readLocal(d,_,u,p,b,i)}return u},r._readLocal=function(s,i,o,a,l,u){var d=r.bin.readUshort,f=r.bin.readUint;f(s,i),d(s,i+=4),d(s,i+=2);var h=d(s,i+=2);f(s,i+=2),f(s,i+=4),i+=4;var p=d(s,i+=8),m=d(s,i+=2);i+=2;var y=r.bin.readUTF8(s,i,p);if(i+=p,i+=m,u)o[y]={size:l,csize:a};else{var b=new Uint8Array(s.buffer,i);if(h==0)o[y]=new Uint8Array(b.buffer.slice(i,i+a));else{if(h!=8)throw"unknown compression method: "+h;var g=new Uint8Array(l);r.inflateRaw(b,g),o[y]=g}}},r.inflateRaw=function(s,i){return r.F.inflate(s,i)},r.inflate=function(s,i){return s[0],s[1],r.inflateRaw(new Uint8Array(s.buffer,s.byteOffset+2,s.length-6),i)},r.deflate=function(s,i){i==null&&(i={level:6});var o=0,a=new Uint8Array(50+Math.floor(1.1*s.length));a[o]=120,a[o+1]=156,o+=2,o=r.F.deflateRaw(s,a,o,i.level);var l=r.adler(s,0,s.length);return a[o+0]=l>>>24&255,a[o+1]=l>>>16&255,a[o+2]=l>>>8&255,a[o+3]=l>>>0&255,new Uint8Array(a.buffer,0,o+4)},r.deflateRaw=function(s,i){i==null&&(i={level:6});var o=new Uint8Array(50+Math.floor(1.1*s.length)),a=r.F.deflateRaw(s,o,a,i.level);return new Uint8Array(o.buffer,0,a)},r.encode=function(s,i){i==null&&(i=!1);var o=0,a=r.bin.writeUint,l=r.bin.writeUshort,u={};for(var d in s){var f=!r._noNeed(d)&&!i,h=s[d],p=r.crc.crc(h,0,h.length);u[d]={cpr:f,usize:h.length,crc:p,file:f?r.deflateRaw(h):h}}for(var d in u)o+=u[d].file.length+30+46+2*r.bin.sizeUTF8(d);o+=22;var m=new Uint8Array(o),y=0,b=[];for(var d in u){var g=u[d];b.push(y),y=r._writeHeader(m,y,d,g,0)}var v=0,w=y;for(var d in u)g=u[d],b.push(y),y=r._writeHeader(m,y,d,g,1,b[v++]);var _=y-w;return a(m,y,101010256),y+=4,l(m,y+=4,v),l(m,y+=2,v),a(m,y+=2,_),a(m,y+=4,w),y+=4,y+=2,m.buffer},r._noNeed=function(s){var i=s.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(i)!=-1},r._writeHeader=function(s,i,o,a,l,u){var d=r.bin.writeUint,f=r.bin.writeUshort,h=a.file;return d(s,i,l==0?67324752:33639248),i+=4,l==1&&(i+=2),f(s,i,20),f(s,i+=2,0),f(s,i+=2,a.cpr?8:0),d(s,i+=2,0),d(s,i+=4,a.crc),d(s,i+=4,h.length),d(s,i+=4,a.usize),f(s,i+=4,r.bin.sizeUTF8(o)),f(s,i+=2,0),i+=2,l==1&&(i+=2,i+=2,d(s,i+=6,u),i+=4),i+=r.bin.writeUTF8(s,i,o),l==0&&(s.set(h,i),i+=h.length),i},r.crc={table:function(){for(var s=new Uint32Array(256),i=0;i<256;i++){for(var o=i,a=0;a<8;a++)1&o?o=3988292384^o>>>1:o>>>=1;s[i]=o}return s}(),update:function(s,i,o,a){for(var l=0;l<a;l++)s=r.crc.table[255&(s^i[o+l])]^s>>>8;return s},crc:function(s,i,o){return 4294967295^r.crc.update(4294967295,s,i,o)}},r.adler=function(s,i,o){for(var a=1,l=0,u=i,d=i+o;u<d;){for(var f=Math.min(u+5552,d);u<f;)l+=a+=s[u++];a%=65521,l%=65521}return l<<16|a},r.bin={readUshort:function(s,i){return s[i]|s[i+1]<<8},writeUshort:function(s,i,o){s[i]=255&o,s[i+1]=o>>8&255},readUint:function(s,i){return 16777216*s[i+3]+(s[i+2]<<16|s[i+1]<<8|s[i])},writeUint:function(s,i,o){s[i]=255&o,s[i+1]=o>>8&255,s[i+2]=o>>16&255,s[i+3]=o>>24&255},readASCII:function(s,i,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(s[i+l]);return a},writeASCII:function(s,i,o){for(var a=0;a<o.length;a++)s[i+a]=o.charCodeAt(a)},pad:function(s){return s.length<2?"0"+s:s},readUTF8:function(s,i,o){for(var a,l="",u=0;u<o;u++)l+="%"+r.bin.pad(s[i+u].toString(16));try{a=decodeURIComponent(l)}catch{return r.bin.readASCII(s,i,o)}return a},writeUTF8:function(s,i,o){for(var a=o.length,l=0,u=0;u<a;u++){var d=o.charCodeAt(u);if(!(4294967168&d))s[i+l]=d,l++;else if(!(4294965248&d))s[i+l]=192|d>>6,s[i+l+1]=128|d>>0&63,l+=2;else if(!(4294901760&d))s[i+l]=224|d>>12,s[i+l+1]=128|d>>6&63,s[i+l+2]=128|d>>0&63,l+=3;else{if(4292870144&d)throw"e";s[i+l]=240|d>>18,s[i+l+1]=128|d>>12&63,s[i+l+2]=128|d>>6&63,s[i+l+3]=128|d>>0&63,l+=4}}return l},sizeUTF8:function(s){for(var i=s.length,o=0,a=0;a<i;a++){var l=s.charCodeAt(a);if(!(4294967168&l))o++;else if(!(4294965248&l))o+=2;else if(!(4294901760&l))o+=3;else{if(4292870144&l)throw"e";o+=4}}return o}},r.F={},r.F.deflateRaw=function(s,i,o,a){var l=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],u=r.F.U,d=r.F._goodIndex;r.F._hash;var f=r.F._putsE,h=0,p=o<<3,m=0,y=s.length;if(a==0){for(;h<y;)f(i,p,h+(T=Math.min(65535,y-h))==y?1:0),p=r.F._copyExact(s,h,T,i,p+8),h+=T;return p>>>3}var b=u.lits,g=u.strt,v=u.prev,w=0,_=0,D=0,k=0,A=0,N=0;for(y>2&&(g[N=r.F._hash(s,0)]=0),h=0;h<y;h++){if(A=N,h+1<y-2){N=r.F._hash(s,h+1);var E=h+1&32767;v[E]=g[N],g[N]=E}if(m<=h){(w>14e3||_>26697)&&y-h>100&&(m<h&&(b[w]=h-m,w+=2,m=h),p=r.F._writeBlock(h==y-1||m==y?1:0,b,w,k,s,D,h-D,i,p),w=_=k=0,D=h);var S=0;h<y-2&&(S=r.F._bestMatch(s,h,v,A,Math.min(l[2],y-h),l[3]));var T=S>>>16,C=65535&S;if(S!=0){C=65535&S;var O=d(T=S>>>16,u.of0);u.lhst[257+O]++;var P=d(C,u.df0);u.dhst[P]++,k+=u.exb[O]+u.dxb[P],b[w]=T<<23|h-m,b[w+1]=C<<16|O<<8|P,w+=2,m=h+T}else u.lhst[s[h]]++;_++}}for(D==h&&s.length!=0||(m<h&&(b[w]=h-m,w+=2,m=h),p=r.F._writeBlock(1,b,w,k,s,D,h-D,i,p),w=0,_=0,w=_=k=0,D=h);7&p;)p++;return p>>>3},r.F._bestMatch=function(s,i,o,a,l,u){var d=32767&i,f=o[d],h=d-f+32768&32767;if(f==d||a!=r.F._hash(s,i-h))return 0;for(var p=0,m=0,y=Math.min(32767,i);h<=y&&--u!=0&&f!=d;){if(p==0||s[i+p]==s[i+p-h]){var b=r.F._howLong(s,i,h);if(b>p){if(m=h,(p=b)>=l)break;h+2<b&&(b=h+2);for(var g=0,v=0;v<b-2;v++){var w=i-h+v+32768&32767,_=w-o[w]+32768&32767;_>g&&(g=_,f=w)}}}h+=(d=f)-(f=o[d])+32768&32767}return p<<16|m},r.F._howLong=function(s,i,o){if(s[i]!=s[i-o]||s[i+1]!=s[i+1-o]||s[i+2]!=s[i+2-o])return 0;var a=i,l=Math.min(s.length,i+258);for(i+=3;i<l&&s[i]==s[i-o];)i++;return i-a},r.F._hash=function(s,i){return(s[i]<<8|s[i+1])+(s[i+2]<<4)&65535},r.saved=0,r.F._writeBlock=function(s,i,o,a,l,u,d,f,h){var p,m,y,b,g,v,w,_,D,k=r.F.U,A=r.F._putsF,N=r.F._putsE;k.lhst[256]++,m=(p=r.F.getTrees())[0],y=p[1],b=p[2],g=p[3],v=p[4],w=p[5],_=p[6],D=p[7];var E=32+(h+3&7?8-(h+3&7):0)+(d<<3),S=a+r.F.contSize(k.fltree,k.lhst)+r.F.contSize(k.fdtree,k.dhst),T=a+r.F.contSize(k.ltree,k.lhst)+r.F.contSize(k.dtree,k.dhst);T+=14+3*w+r.F.contSize(k.itree,k.ihst)+(2*k.ihst[16]+3*k.ihst[17]+7*k.ihst[18]);for(var C=0;C<286;C++)k.lhst[C]=0;for(C=0;C<30;C++)k.dhst[C]=0;for(C=0;C<19;C++)k.ihst[C]=0;var O=E<S&&E<T?0:S<T?1:2;if(A(f,h,s),A(f,h+1,O),h+=3,O==0){for(;7&h;)h++;h=r.F._copyExact(l,u,d,f,h)}else{var P,H;if(O==1&&(P=k.fltree,H=k.fdtree),O==2){r.F.makeCodes(k.ltree,m),r.F.revCodes(k.ltree,m),r.F.makeCodes(k.dtree,y),r.F.revCodes(k.dtree,y),r.F.makeCodes(k.itree,b),r.F.revCodes(k.itree,b),P=k.ltree,H=k.dtree,N(f,h,g-257),N(f,h+=5,v-1),N(f,h+=5,w-4),h+=4;for(var M=0;M<w;M++)N(f,h+3*M,k.itree[1+(k.ordr[M]<<1)]);h+=3*w,h=r.F._codeTiny(_,k.itree,f,h),h=r.F._codeTiny(D,k.itree,f,h)}for(var I=u,K=0;K<o;K+=2){for(var G=i[K],R=G>>>23,Ee=I+(8388607&G);I<Ee;)h=r.F._writeLit(l[I++],P,f,h);if(R!=0){var ge=i[K+1],F=ge>>16,B=ge>>8&255,se=255&ge;N(f,h=r.F._writeLit(257+B,P,f,h),R-k.of0[B]),h+=k.exb[B],A(f,h=r.F._writeLit(se,H,f,h),F-k.df0[se]),h+=k.dxb[se],I+=R}}h=r.F._writeLit(256,P,f,h)}return h},r.F._copyExact=function(s,i,o,a,l){var u=l>>>3;return a[u]=o,a[u+1]=o>>>8,a[u+2]=255-a[u],a[u+3]=255-a[u+1],u+=4,a.set(new Uint8Array(s.buffer,i,o),u),l+(o+4<<3)},r.F.getTrees=function(){for(var s=r.F.U,i=r.F._hufTree(s.lhst,s.ltree,15),o=r.F._hufTree(s.dhst,s.dtree,15),a=[],l=r.F._lenCodes(s.ltree,a),u=[],d=r.F._lenCodes(s.dtree,u),f=0;f<a.length;f+=2)s.ihst[a[f]]++;for(f=0;f<u.length;f+=2)s.ihst[u[f]]++;for(var h=r.F._hufTree(s.ihst,s.itree,7),p=19;p>4&&s.itree[1+(s.ordr[p-1]<<1)]==0;)p--;return[i,o,h,l,d,p,a,u]},r.F.getSecond=function(s){for(var i=[],o=0;o<s.length;o+=2)i.push(s[o+1]);return i},r.F.nonZero=function(s){for(var i="",o=0;o<s.length;o+=2)s[o+1]!=0&&(i+=(o>>1)+",");return i},r.F.contSize=function(s,i){for(var o=0,a=0;a<i.length;a++)o+=i[a]*s[1+(a<<1)];return o},r.F._codeTiny=function(s,i,o,a){for(var l=0;l<s.length;l+=2){var u=s[l],d=s[l+1];a=r.F._writeLit(u,i,o,a);var f=u==16?2:u==17?3:7;u>15&&(r.F._putsE(o,a,d,f),a+=f)}return a},r.F._lenCodes=function(s,i){for(var o=s.length;o!=2&&s[o-1]==0;)o-=2;for(var a=0;a<o;a+=2){var l=s[a+1],u=a+3<o?s[a+3]:-1,d=a+5<o?s[a+5]:-1,f=a==0?-1:s[a-1];if(l==0&&u==l&&d==l){for(var h=a+5;h+2<o&&s[h+2]==l;)h+=2;(p=Math.min(h+1-a>>>1,138))<11?i.push(17,p-3):i.push(18,p-11),a+=2*p-2}else if(l==f&&u==l&&d==l){for(h=a+5;h+2<o&&s[h+2]==l;)h+=2;var p=Math.min(h+1-a>>>1,6);i.push(16,p-3),a+=2*p-2}else i.push(l,0)}return o>>>1},r.F._hufTree=function(s,i,o){var a=[],l=s.length,u=i.length,d=0;for(d=0;d<u;d+=2)i[d]=0,i[d+1]=0;for(d=0;d<l;d++)s[d]!=0&&a.push({lit:d,f:s[d]});var f=a.length,h=a.slice(0);if(f==0)return 0;if(f==1){var p=a[0].lit;return h=p==0?1:0,i[1+(p<<1)]=1,i[1+(h<<1)]=1,1}a.sort(function(_,D){return _.f-D.f});var m=a[0],y=a[1],b=0,g=1,v=2;for(a[0]={lit:-1,f:m.f+y.f,l:m,r:y,d:0};g!=f-1;)m=b!=g&&(v==f||a[b].f<a[v].f)?a[b++]:a[v++],y=b!=g&&(v==f||a[b].f<a[v].f)?a[b++]:a[v++],a[g++]={lit:-1,f:m.f+y.f,l:m,r:y};var w=r.F.setDepth(a[g-1],0);for(w>o&&(r.F.restrictDepth(h,o,w),w=o),d=0;d<f;d++)i[1+(h[d].lit<<1)]=h[d].d;return w},r.F.setDepth=function(s,i){return s.lit!=-1?(s.d=i,i):Math.max(r.F.setDepth(s.l,i+1),r.F.setDepth(s.r,i+1))},r.F.restrictDepth=function(s,i,o){var a=0,l=1<<o-i,u=0;for(s.sort(function(f,h){return h.d==f.d?f.f-h.f:h.d-f.d}),a=0;a<s.length&&s[a].d>i;a++){var d=s[a].d;s[a].d=i,u+=l-(1<<o-d)}for(u>>>=o-i;u>0;)(d=s[a].d)<i?(s[a].d++,u-=1<<i-d-1):a++;for(;a>=0;a--)s[a].d==i&&u<0&&(s[a].d--,u++);u!=0&&console.log("debt left")},r.F._goodIndex=function(s,i){var o=0;return i[16|o]<=s&&(o|=16),i[8|o]<=s&&(o|=8),i[4|o]<=s&&(o|=4),i[2|o]<=s&&(o|=2),i[1|o]<=s&&(o|=1),o},r.F._writeLit=function(s,i,o,a){return r.F._putsF(o,a,i[s<<1]),a+i[1+(s<<1)]},r.F.inflate=function(s,i){var o=Uint8Array;if(s[0]==3&&s[1]==0)return i||new o(0);var a=r.F,l=a._bitsF,u=a._bitsE,d=a._decodeTiny,f=a.makeCodes,h=a.codes2map,p=a._get17,m=a.U,y=i==null;y&&(i=new o(s.length>>>2<<3));for(var b,g,v=0,w=0,_=0,D=0,k=0,A=0,N=0,E=0,S=0;v==0;)if(v=l(s,S,1),w=l(s,S+1,2),S+=3,w!=0){if(y&&(i=r.F._check(i,E+(1<<17))),w==1&&(b=m.flmap,g=m.fdmap,A=511,N=31),w==2){_=u(s,S,5)+257,D=u(s,S+5,5)+1,k=u(s,S+10,4)+4,S+=14;for(var T=0;T<38;T+=2)m.itree[T]=0,m.itree[T+1]=0;var C=1;for(T=0;T<k;T++){var O=u(s,S+3*T,3);m.itree[1+(m.ordr[T]<<1)]=O,O>C&&(C=O)}S+=3*k,f(m.itree,C),h(m.itree,C,m.imap),b=m.lmap,g=m.dmap,S=d(m.imap,(1<<C)-1,_+D,s,S,m.ttree);var P=a._copyOut(m.ttree,0,_,m.ltree);A=(1<<P)-1;var H=a._copyOut(m.ttree,_,D,m.dtree);N=(1<<H)-1,f(m.ltree,P),h(m.ltree,P,b),f(m.dtree,H),h(m.dtree,H,g)}for(;;){var M=b[p(s,S)&A];S+=15&M;var I=M>>>4;if(!(I>>>8))i[E++]=I;else{if(I==256)break;var K=E+I-254;if(I>264){var G=m.ldef[I-257];K=E+(G>>>3)+u(s,S,7&G),S+=7&G}var R=g[p(s,S)&N];S+=15&R;var Ee=R>>>4,ge=m.ddef[Ee],F=(ge>>>4)+l(s,S,15&ge);for(S+=15&ge,y&&(i=r.F._check(i,E+(1<<17)));E<K;)i[E]=i[E++-F],i[E]=i[E++-F],i[E]=i[E++-F],i[E]=i[E++-F];E=K}}}else{7&S&&(S+=8-(7&S));var B=4+(S>>>3),se=s[B-4]|s[B-3]<<8;y&&(i=r.F._check(i,E+se)),i.set(new o(s.buffer,s.byteOffset+B,se),E),S=B+se<<3,E+=se}return i.length==E?i:i.slice(0,E)},r.F._check=function(s,i){var o=s.length;if(i<=o)return s;var a=new Uint8Array(Math.max(o<<1,i));return a.set(s,0),a},r.F._decodeTiny=function(s,i,o,a,l,u){for(var d=r.F._bitsE,f=r.F._get17,h=0;h<o;){var p=s[f(a,l)&i];l+=15&p;var m=p>>>4;if(m<=15)u[h]=m,h++;else{var y=0,b=0;m==16?(b=3+d(a,l,2),l+=2,y=u[h-1]):m==17?(b=3+d(a,l,3),l+=3):m==18&&(b=11+d(a,l,7),l+=7);for(var g=h+b;h<g;)u[h]=y,h++}}return l},r.F._copyOut=function(s,i,o,a){for(var l=0,u=0,d=a.length>>>1;u<o;){var f=s[u+i];a[u<<1]=0,a[1+(u<<1)]=f,f>l&&(l=f),u++}for(;u<d;)a[u<<1]=0,a[1+(u<<1)]=0,u++;return l},r.F.makeCodes=function(s,i){for(var o,a,l,u,d=r.F.U,f=s.length,h=d.bl_count,p=0;p<=i;p++)h[p]=0;for(p=1;p<f;p+=2)h[s[p]]++;var m=d.next_code;for(o=0,h[0]=0,a=1;a<=i;a++)o=o+h[a-1]<<1,m[a]=o;for(l=0;l<f;l+=2)(u=s[l+1])!=0&&(s[l]=m[u],m[u]++)},r.F.codes2map=function(s,i,o){for(var a=s.length,l=r.F.U.rev15,u=0;u<a;u+=2)if(s[u+1]!=0)for(var d=u>>1,f=s[u+1],h=d<<4|f,p=i-f,m=s[u]<<p,y=m+(1<<p);m!=y;)o[l[m]>>>15-i]=h,m++},r.F.revCodes=function(s,i){for(var o=r.F.U.rev15,a=15-i,l=0;l<s.length;l+=2){var u=s[l]<<i-s[l+1];s[l]=o[u]>>>a}},r.F._putsE=function(s,i,o){o<<=7&i;var a=i>>>3;s[a]|=o,s[a+1]|=o>>>8},r.F._putsF=function(s,i,o){o<<=7&i;var a=i>>>3;s[a]|=o,s[a+1]|=o>>>8,s[a+2]|=o>>>16},r.F._bitsE=function(s,i,o){return(s[i>>>3]|s[1+(i>>>3)]<<8)>>>(7&i)&(1<<o)-1},r.F._bitsF=function(s,i,o){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16)>>>(7&i)&(1<<o)-1},r.F._get17=function(s,i){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16)>>>(7&i)},r.F._get25=function(s,i){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16|s[3+(i>>>3)]<<24)>>>(7&i)},r.F.U=(e=Uint16Array,n=Uint32Array,{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new n(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new n(286),dhst:new n(30),ihst:new n(19),lits:new n(15e3),strt:new e(65536),prev:new e(32768)}),function(){for(var s=r.F.U,i=0;i<32768;i++){var o=i;o=(4278255360&(o=(4042322160&(o=(3435973836&(o=(2863311530&o)>>>1|(1431655765&o)<<1))>>>2|(858993459&o)<<2))>>>4|(252645135&o)<<4))>>>8|(16711935&o)<<8,s.rev15[i]=(o>>>16|o<<16)>>>17}function a(l,u,d){for(;u--!=0;)l.push(0,d)}for(i=0;i<32;i++)s.ldef[i]=s.of0[i]<<3|s.exb[i],s.ddef[i]=s.df0[i]<<4|s.dxb[i];a(s.fltree,144,8),a(s.fltree,112,9),a(s.fltree,24,7),a(s.fltree,8,8),r.F.makeCodes(s.fltree,9),r.F.codes2map(s.fltree,9,s.flmap),r.F.revCodes(s.fltree,9),a(s.fdtree,32,5),r.F.makeCodes(s.fdtree,5),r.F.codes2map(s.fdtree,5,s.fdmap),r.F.revCodes(s.fdtree,5),a(s.itree,19,0),a(s.ltree,286,0),a(s.dtree,30,0),a(s.ttree,320,0)}()})();var L9=R9({__proto__:null,default:pm},[pm]);const Wi=function(){var t={nextZero(d,f){for(;d[f]!=0;)f++;return f},readUshort:(d,f)=>d[f]<<8|d[f+1],writeUshort(d,f,h){d[f]=h>>8&255,d[f+1]=255&h},readUint:(d,f)=>16777216*d[f]+(d[f+1]<<16|d[f+2]<<8|d[f+3]),writeUint(d,f,h){d[f]=h>>24&255,d[f+1]=h>>16&255,d[f+2]=h>>8&255,d[f+3]=255&h},readASCII(d,f,h){let p="";for(let m=0;m<h;m++)p+=String.fromCharCode(d[f+m]);return p},writeASCII(d,f,h){for(let p=0;p<h.length;p++)d[f+p]=h.charCodeAt(p)},readBytes(d,f,h){const p=[];for(let m=0;m<h;m++)p.push(d[f+m]);return p},pad:d=>d.length<2?`0${d}`:d,readUTF8(d,f,h){let p,m="";for(let y=0;y<h;y++)m+=`%${t.pad(d[f+y].toString(16))}`;try{p=decodeURIComponent(m)}catch{return t.readASCII(d,f,h)}return p}};function e(d,f,h,p){const m=f*h,y=i(p),b=Math.ceil(f*y/8),g=new Uint8Array(4*m),v=new Uint32Array(g.buffer),{ctype:w}=p,{depth:_}=p,D=t.readUshort;if(w==6){const G=m<<2;if(_==8)for(var k=0;k<G;k+=4)g[k]=d[k],g[k+1]=d[k+1],g[k+2]=d[k+2],g[k+3]=d[k+3];if(_==16)for(k=0;k<G;k++)g[k]=d[k<<1]}else if(w==2){const G=p.tabs.tRNS;if(G==null){if(_==8)for(k=0;k<m;k++){var A=3*k;v[k]=255<<24|d[A+2]<<16|d[A+1]<<8|d[A]}if(_==16)for(k=0;k<m;k++)A=6*k,v[k]=255<<24|d[A+4]<<16|d[A+2]<<8|d[A]}else{var N=G[0];const R=G[1],Ee=G[2];if(_==8)for(k=0;k<m;k++){var E=k<<2;A=3*k,v[k]=255<<24|d[A+2]<<16|d[A+1]<<8|d[A],d[A]==N&&d[A+1]==R&&d[A+2]==Ee&&(g[E+3]=0)}if(_==16)for(k=0;k<m;k++)E=k<<2,A=6*k,v[k]=255<<24|d[A+4]<<16|d[A+2]<<8|d[A],D(d,A)==N&&D(d,A+2)==R&&D(d,A+4)==Ee&&(g[E+3]=0)}}else if(w==3){const G=p.tabs.PLTE,R=p.tabs.tRNS,Ee=R?R.length:0;if(_==1)for(var S=0;S<h;S++){var T=S*b,C=S*f;for(k=0;k<f;k++){E=C+k<<2;var O=3*(P=d[T+(k>>3)]>>7-((7&k)<<0)&1);g[E]=G[O],g[E+1]=G[O+1],g[E+2]=G[O+2],g[E+3]=P<Ee?R[P]:255}}if(_==2)for(S=0;S<h;S++)for(T=S*b,C=S*f,k=0;k<f;k++)E=C+k<<2,O=3*(P=d[T+(k>>2)]>>6-((3&k)<<1)&3),g[E]=G[O],g[E+1]=G[O+1],g[E+2]=G[O+2],g[E+3]=P<Ee?R[P]:255;if(_==4)for(S=0;S<h;S++)for(T=S*b,C=S*f,k=0;k<f;k++)E=C+k<<2,O=3*(P=d[T+(k>>1)]>>4-((1&k)<<2)&15),g[E]=G[O],g[E+1]=G[O+1],g[E+2]=G[O+2],g[E+3]=P<Ee?R[P]:255;if(_==8)for(k=0;k<m;k++){var P;E=k<<2,O=3*(P=d[k]),g[E]=G[O],g[E+1]=G[O+1],g[E+2]=G[O+2],g[E+3]=P<Ee?R[P]:255}}else if(w==4){if(_==8)for(k=0;k<m;k++){E=k<<2;var H=d[M=k<<1];g[E]=H,g[E+1]=H,g[E+2]=H,g[E+3]=d[M+1]}if(_==16)for(k=0;k<m;k++){var M;E=k<<2,H=d[M=k<<2],g[E]=H,g[E+1]=H,g[E+2]=H,g[E+3]=d[M+2]}}else if(w==0)for(N=p.tabs.tRNS?p.tabs.tRNS:-1,S=0;S<h;S++){const G=S*b,R=S*f;if(_==1)for(var I=0;I<f;I++){var K=(H=255*(d[G+(I>>>3)]>>>7-(7&I)&1))==255*N?0:255;v[R+I]=K<<24|H<<16|H<<8|H}else if(_==2)for(I=0;I<f;I++)K=(H=85*(d[G+(I>>>2)]>>>6-((3&I)<<1)&3))==85*N?0:255,v[R+I]=K<<24|H<<16|H<<8|H;else if(_==4)for(I=0;I<f;I++)K=(H=17*(d[G+(I>>>1)]>>>4-((1&I)<<2)&15))==17*N?0:255,v[R+I]=K<<24|H<<16|H<<8|H;else if(_==8)for(I=0;I<f;I++)K=(H=d[G+I])==N?0:255,v[R+I]=K<<24|H<<16|H<<8|H;else if(_==16)for(I=0;I<f;I++)H=d[G+(I<<1)],K=D(d,G+(I<<1))==N?0:255,v[R+I]=K<<24|H<<16|H<<8|H}return g}function n(d,f,h,p){const m=i(d),y=Math.ceil(h*m/8),b=new Uint8Array((y+1+d.interlace)*p);return f=d.tabs.CgBI?s(f,b):r(f,b),d.interlace==0?f=o(f,d,0,h,p):d.interlace==1&&(f=function(v,w){const _=w.width,D=w.height,k=i(w),A=k>>3,N=Math.ceil(_*k/8),E=new Uint8Array(D*N);let S=0;const T=[0,0,4,0,2,0,1],C=[0,4,0,2,0,1,0],O=[8,8,8,4,4,2,2],P=[8,8,4,4,2,2,1];let H=0;for(;H<7;){const I=O[H],K=P[H];let G=0,R=0,Ee=T[H];for(;Ee<D;)Ee+=I,R++;let ge=C[H];for(;ge<_;)ge+=K,G++;const F=Math.ceil(G*k/8);o(v,w,S,G,R);let B=0,se=T[H];for(;se<D;){let We=C[H],ut=S+B*F<<3;for(;We<_;){var M;if(k==1&&(M=(M=v[ut>>3])>>7-(7&ut)&1,E[se*N+(We>>3)]|=M<<7-((7&We)<<0)),k==2&&(M=(M=v[ut>>3])>>6-(7&ut)&3,E[se*N+(We>>2)]|=M<<6-((3&We)<<1)),k==4&&(M=(M=v[ut>>3])>>4-(7&ut)&15,E[se*N+(We>>1)]|=M<<4-((1&We)<<2)),k>=8){const oe=se*N+We*A;for(let je=0;je<A;je++)E[oe+je]=v[(ut>>3)+je]}ut+=k,We+=K}B++,se+=I}G*R!=0&&(S+=R*(1+F)),H+=1}return E}(f,d)),f}function r(d,f){return s(new Uint8Array(d.buffer,2,d.length-6),f)}var s=function(){const d={H:{}};return d.H.N=function(f,h){const p=Uint8Array;let m,y,b=0,g=0,v=0,w=0,_=0,D=0,k=0,A=0,N=0;if(f[0]==3&&f[1]==0)return h||new p(0);const E=d.H,S=E.b,T=E.e,C=E.R,O=E.n,P=E.A,H=E.Z,M=E.m,I=h==null;for(I&&(h=new p(f.length>>>2<<5));b==0;)if(b=S(f,N,1),g=S(f,N+1,2),N+=3,g!=0){if(I&&(h=d.H.W(h,A+(1<<17))),g==1&&(m=M.J,y=M.h,D=511,k=31),g==2){v=T(f,N,5)+257,w=T(f,N+5,5)+1,_=T(f,N+10,4)+4,N+=14;let G=1;for(var K=0;K<38;K+=2)M.Q[K]=0,M.Q[K+1]=0;for(K=0;K<_;K++){const ge=T(f,N+3*K,3);M.Q[1+(M.X[K]<<1)]=ge,ge>G&&(G=ge)}N+=3*_,O(M.Q,G),P(M.Q,G,M.u),m=M.w,y=M.d,N=C(M.u,(1<<G)-1,v+w,f,N,M.v);const R=E.V(M.v,0,v,M.C);D=(1<<R)-1;const Ee=E.V(M.v,v,w,M.D);k=(1<<Ee)-1,O(M.C,R),P(M.C,R,m),O(M.D,Ee),P(M.D,Ee,y)}for(;;){const G=m[H(f,N)&D];N+=15&G;const R=G>>>4;if(!(R>>>8))h[A++]=R;else{if(R==256)break;{let Ee=A+R-254;if(R>264){const We=M.q[R-257];Ee=A+(We>>>3)+T(f,N,7&We),N+=7&We}const ge=y[H(f,N)&k];N+=15&ge;const F=ge>>>4,B=M.c[F],se=(B>>>4)+S(f,N,15&B);for(N+=15&B;A<Ee;)h[A]=h[A++-se],h[A]=h[A++-se],h[A]=h[A++-se],h[A]=h[A++-se];A=Ee}}}}else{7&N&&(N+=8-(7&N));const G=4+(N>>>3),R=f[G-4]|f[G-3]<<8;I&&(h=d.H.W(h,A+R)),h.set(new p(f.buffer,f.byteOffset+G,R),A),N=G+R<<3,A+=R}return h.length==A?h:h.slice(0,A)},d.H.W=function(f,h){const p=f.length;if(h<=p)return f;const m=new Uint8Array(p<<1);return m.set(f,0),m},d.H.R=function(f,h,p,m,y,b){const g=d.H.e,v=d.H.Z;let w=0;for(;w<p;){const _=f[v(m,y)&h];y+=15&_;const D=_>>>4;if(D<=15)b[w]=D,w++;else{let k=0,A=0;D==16?(A=3+g(m,y,2),y+=2,k=b[w-1]):D==17?(A=3+g(m,y,3),y+=3):D==18&&(A=11+g(m,y,7),y+=7);const N=w+A;for(;w<N;)b[w]=k,w++}}return y},d.H.V=function(f,h,p,m){let y=0,b=0;const g=m.length>>>1;for(;b<p;){const v=f[b+h];m[b<<1]=0,m[1+(b<<1)]=v,v>y&&(y=v),b++}for(;b<g;)m[b<<1]=0,m[1+(b<<1)]=0,b++;return y},d.H.n=function(f,h){const p=d.H.m,m=f.length;let y,b,g,v;const w=p.j;for(var _=0;_<=h;_++)w[_]=0;for(_=1;_<m;_+=2)w[f[_]]++;const D=p.K;for(y=0,w[0]=0,b=1;b<=h;b++)y=y+w[b-1]<<1,D[b]=y;for(g=0;g<m;g+=2)v=f[g+1],v!=0&&(f[g]=D[v],D[v]++)},d.H.A=function(f,h,p){const m=f.length,y=d.H.m.r;for(let b=0;b<m;b+=2)if(f[b+1]!=0){const g=b>>1,v=f[b+1],w=g<<4|v,_=h-v;let D=f[b]<<_;const k=D+(1<<_);for(;D!=k;)p[y[D]>>>15-h]=w,D++}},d.H.l=function(f,h){const p=d.H.m.r,m=15-h;for(let y=0;y<f.length;y+=2){const b=f[y]<<h-f[y+1];f[y]=p[b]>>>m}},d.H.M=function(f,h,p){p<<=7&h;const m=h>>>3;f[m]|=p,f[m+1]|=p>>>8},d.H.I=function(f,h,p){p<<=7&h;const m=h>>>3;f[m]|=p,f[m+1]|=p>>>8,f[m+2]|=p>>>16},d.H.e=function(f,h,p){return(f[h>>>3]|f[1+(h>>>3)]<<8)>>>(7&h)&(1<<p)-1},d.H.b=function(f,h,p){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16)>>>(7&h)&(1<<p)-1},d.H.Z=function(f,h){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16)>>>(7&h)},d.H.i=function(f,h){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16|f[3+(h>>>3)]<<24)>>>(7&h)},d.H.m=function(){const f=Uint16Array,h=Uint32Array;return{K:new f(16),j:new f(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new f(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new h(32),J:new f(512),_:[],h:new f(32),$:[],w:new f(32768),C:[],v:[],d:new f(32768),D:[],u:new f(512),Q:[],r:new f(32768),s:new h(286),Y:new h(30),a:new h(19),t:new h(15e3),k:new f(65536),g:new f(32768)}}(),function(){const f=d.H.m;for(var h=0;h<32768;h++){let m=h;m=(2863311530&m)>>>1|(1431655765&m)<<1,m=(3435973836&m)>>>2|(858993459&m)<<2,m=(4042322160&m)>>>4|(252645135&m)<<4,m=(4278255360&m)>>>8|(16711935&m)<<8,f.r[h]=(m>>>16|m<<16)>>>17}function p(m,y,b){for(;y--!=0;)m.push(0,b)}for(h=0;h<32;h++)f.q[h]=f.S[h]<<3|f.T[h],f.c[h]=f.p[h]<<4|f.z[h];p(f._,144,8),p(f._,112,9),p(f._,24,7),p(f._,8,8),d.H.n(f._,9),d.H.A(f._,9,f.J),d.H.l(f._,9),p(f.$,32,5),d.H.n(f.$,5),d.H.A(f.$,5,f.h),d.H.l(f.$,5),p(f.Q,19,0),p(f.C,286,0),p(f.D,30,0),p(f.v,320,0)}(),d.H.N}();function i(d){return[1,null,3,1,2,null,4][d.ctype]*d.depth}function o(d,f,h,p,m){let y=i(f);const b=Math.ceil(p*y/8);let g,v;y=Math.ceil(y/8);let w=d[h],_=0;if(w>1&&(d[h]=[0,0,1][w-2]),w==3)for(_=y;_<b;_++)d[_+1]=d[_+1]+(d[_+1-y]>>>1)&255;for(let D=0;D<m;D++)if(g=h+D*b,v=g+D+1,w=d[v-1],_=0,w==0)for(;_<b;_++)d[g+_]=d[v+_];else if(w==1){for(;_<y;_++)d[g+_]=d[v+_];for(;_<b;_++)d[g+_]=d[v+_]+d[g+_-y]}else if(w==2)for(;_<b;_++)d[g+_]=d[v+_]+d[g+_-b];else if(w==3){for(;_<y;_++)d[g+_]=d[v+_]+(d[g+_-b]>>>1);for(;_<b;_++)d[g+_]=d[v+_]+(d[g+_-b]+d[g+_-y]>>>1)}else{for(;_<y;_++)d[g+_]=d[v+_]+a(0,d[g+_-b],0);for(;_<b;_++)d[g+_]=d[v+_]+a(d[g+_-y],d[g+_-b],d[g+_-y-b])}return d}function a(d,f,h){const p=d+f-h,m=p-d,y=p-f,b=p-h;return m*m<=y*y&&m*m<=b*b?d:y*y<=b*b?f:h}function l(d,f,h){h.width=t.readUint(d,f),f+=4,h.height=t.readUint(d,f),f+=4,h.depth=d[f],f++,h.ctype=d[f],f++,h.compress=d[f],f++,h.filter=d[f],f++,h.interlace=d[f],f++}function u(d,f,h,p,m,y,b,g,v){const w=Math.min(f,m),_=Math.min(h,y);let D=0,k=0;for(let H=0;H<_;H++)for(let M=0;M<w;M++)if(b>=0&&g>=0?(D=H*f+M<<2,k=(g+H)*m+b+M<<2):(D=(-g+H)*f-b+M<<2,k=H*m+M<<2),v==0)p[k]=d[D],p[k+1]=d[D+1],p[k+2]=d[D+2],p[k+3]=d[D+3];else if(v==1){var A=d[D+3]*.00392156862745098,N=d[D]*A,E=d[D+1]*A,S=d[D+2]*A,T=p[k+3]*(1/255),C=p[k]*T,O=p[k+1]*T,P=p[k+2]*T;const I=1-A,K=A+T*I,G=K==0?0:1/K;p[k+3]=255*K,p[k+0]=(N+C*I)*G,p[k+1]=(E+O*I)*G,p[k+2]=(S+P*I)*G}else if(v==2)A=d[D+3],N=d[D],E=d[D+1],S=d[D+2],T=p[k+3],C=p[k],O=p[k+1],P=p[k+2],A==T&&N==C&&E==O&&S==P?(p[k]=0,p[k+1]=0,p[k+2]=0,p[k+3]=0):(p[k]=N,p[k+1]=E,p[k+2]=S,p[k+3]=A);else if(v==3){if(A=d[D+3],N=d[D],E=d[D+1],S=d[D+2],T=p[k+3],C=p[k],O=p[k+1],P=p[k+2],A==T&&N==C&&E==O&&S==P)continue;if(A<220&&T>20)return!1}return!0}return{decode:function(f){const h=new Uint8Array(f);let p=8;const m=t,y=m.readUshort,b=m.readUint,g={tabs:{},frames:[]},v=new Uint8Array(h.length);let w,_=0,D=0;const k=[137,80,78,71,13,10,26,10];for(var A=0;A<8;A++)if(h[A]!=k[A])throw"The input is not a PNG file!";for(;p<h.length;){const H=m.readUint(h,p);p+=4;const M=m.readASCII(h,p,4);if(p+=4,M=="IHDR")l(h,p,g);else if(M=="iCCP"){for(var N=p;h[N]!=0;)N++;m.readASCII(h,p,N-p),h[N+1];const I=h.slice(N+2,p+H);let K=null;try{K=r(I)}catch{K=s(I)}g.tabs[M]=K}else if(M=="CgBI")g.tabs[M]=h.slice(p,p+4);else if(M=="IDAT"){for(A=0;A<H;A++)v[_+A]=h[p+A];_+=H}else if(M=="acTL")g.tabs[M]={num_frames:b(h,p),num_plays:b(h,p+4)},w=new Uint8Array(h.length);else if(M=="fcTL"){D!=0&&((P=g.frames[g.frames.length-1]).data=n(g,w.slice(0,D),P.rect.width,P.rect.height),D=0);const I={x:b(h,p+12),y:b(h,p+16),width:b(h,p+4),height:b(h,p+8)};let K=y(h,p+22);K=y(h,p+20)/(K==0?100:K);const G={rect:I,delay:Math.round(1e3*K),dispose:h[p+24],blend:h[p+25]};g.frames.push(G)}else if(M=="fdAT"){for(A=0;A<H-4;A++)w[D+A]=h[p+A+4];D+=H-4}else if(M=="pHYs")g.tabs[M]=[m.readUint(h,p),m.readUint(h,p+4),h[p+8]];else if(M=="cHRM")for(g.tabs[M]=[],A=0;A<8;A++)g.tabs[M].push(m.readUint(h,p+4*A));else if(M=="tEXt"||M=="zTXt"){g.tabs[M]==null&&(g.tabs[M]={});var E=m.nextZero(h,p),S=m.readASCII(h,p,E-p),T=p+H-E-1;if(M=="tEXt")O=m.readASCII(h,E+1,T);else{var C=r(h.slice(E+2,E+2+T));O=m.readUTF8(C,0,C.length)}g.tabs[M][S]=O}else if(M=="iTXt"){g.tabs[M]==null&&(g.tabs[M]={}),E=0,N=p,E=m.nextZero(h,N),S=m.readASCII(h,N,E-N);const I=h[N=E+1];var O;h[N+1],N+=2,E=m.nextZero(h,N),m.readASCII(h,N,E-N),N=E+1,E=m.nextZero(h,N),m.readUTF8(h,N,E-N),T=H-((N=E+1)-p),I==0?O=m.readUTF8(h,N,T):(C=r(h.slice(N,N+T)),O=m.readUTF8(C,0,C.length)),g.tabs[M][S]=O}else if(M=="PLTE")g.tabs[M]=m.readBytes(h,p,H);else if(M=="hIST"){const I=g.tabs.PLTE.length/3;for(g.tabs[M]=[],A=0;A<I;A++)g.tabs[M].push(y(h,p+2*A))}else if(M=="tRNS")g.ctype==3?g.tabs[M]=m.readBytes(h,p,H):g.ctype==0?g.tabs[M]=y(h,p):g.ctype==2&&(g.tabs[M]=[y(h,p),y(h,p+2),y(h,p+4)]);else if(M=="gAMA")g.tabs[M]=m.readUint(h,p)/1e5;else if(M=="sRGB")g.tabs[M]=h[p];else if(M=="bKGD")g.ctype==0||g.ctype==4?g.tabs[M]=[y(h,p)]:g.ctype==2||g.ctype==6?g.tabs[M]=[y(h,p),y(h,p+2),y(h,p+4)]:g.ctype==3&&(g.tabs[M]=h[p]);else if(M=="IEND")break;p+=H,m.readUint(h,p),p+=4}var P;return D!=0&&((P=g.frames[g.frames.length-1]).data=n(g,w.slice(0,D),P.rect.width,P.rect.height)),g.data=n(g,v,g.width,g.height),delete g.compress,delete g.interlace,delete g.filter,g},toRGBA8:function(f){const h=f.width,p=f.height;if(f.tabs.acTL==null)return[e(f.data,h,p,f).buffer];const m=[];f.frames[0].data==null&&(f.frames[0].data=f.data);const y=h*p*4,b=new Uint8Array(y),g=new Uint8Array(y),v=new Uint8Array(y);for(let _=0;_<f.frames.length;_++){const D=f.frames[_],k=D.rect.x,A=D.rect.y,N=D.rect.width,E=D.rect.height,S=e(D.data,N,E,f);if(_!=0)for(var w=0;w<y;w++)v[w]=b[w];if(D.blend==0?u(S,N,E,b,h,p,k,A,0):D.blend==1&&u(S,N,E,b,h,p,k,A,1),m.push(b.buffer.slice(0)),D.dispose!=0){if(D.dispose==1)u(g,N,E,b,h,p,k,A,0);else if(D.dispose==2)for(w=0;w<y;w++)b[w]=v[w]}}return m},_paeth:a,_copyTile:u,_bin:t}}();(function(){const{_copyTile:t}=Wi,{_bin:e}=Wi,n=Wi._paeth;var r={table:function(){const N=new Uint32Array(256);for(let E=0;E<256;E++){let S=E;for(let T=0;T<8;T++)1&S?S=3988292384^S>>>1:S>>>=1;N[E]=S}return N}(),update(N,E,S,T){for(let C=0;C<T;C++)N=r.table[255&(N^E[S+C])]^N>>>8;return N},crc:(N,E,S)=>4294967295^r.update(4294967295,N,E,S)};function s(N,E,S,T){E[S]+=N[0]*T>>4,E[S+1]+=N[1]*T>>4,E[S+2]+=N[2]*T>>4,E[S+3]+=N[3]*T>>4}function i(N){return Math.max(0,Math.min(255,N))}function o(N,E){const S=N[0]-E[0],T=N[1]-E[1],C=N[2]-E[2],O=N[3]-E[3];return S*S+T*T+C*C+O*O}function a(N,E,S,T,C,O,P){P==null&&(P=1);const H=T.length,M=[];for(var I=0;I<H;I++){const se=T[I];M.push([se>>>0&255,se>>>8&255,se>>>16&255,se>>>24&255])}for(I=0;I<H;I++){let se=4294967295;for(var K=0,G=0;G<H;G++){var R=o(M[I],M[G]);G!=I&&R<se&&(se=R,K=G)}}const Ee=new Uint32Array(C.buffer),ge=new Int16Array(E*S*4),F=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(I=0;I<F.length;I++)F[I]=255*((F[I]+.5)/16-.5);for(let se=0;se<S;se++)for(let We=0;We<E;We++){var B;I=4*(se*E+We),P!=2?B=[i(N[I]+ge[I]),i(N[I+1]+ge[I+1]),i(N[I+2]+ge[I+2]),i(N[I+3]+ge[I+3])]:(R=F[4*(3&se)+(3&We)],B=[i(N[I]+R),i(N[I+1]+R),i(N[I+2]+R),i(N[I+3]+R)]),K=0;let ut=16777215;for(G=0;G<H;G++){const te=o(B,M[G]);te<ut&&(ut=te,K=G)}const oe=M[K],je=[B[0]-oe[0],B[1]-oe[1],B[2]-oe[2],B[3]-oe[3]];P==1&&(We!=E-1&&s(je,ge,I+4,7),se!=S-1&&(We!=0&&s(je,ge,I+4*E-4,3),s(je,ge,I+4*E,5),We!=E-1&&s(je,ge,I+4*E+4,1))),O[I>>2]=K,Ee[I>>2]=T[K]}}function l(N,E,S,T,C){C==null&&(C={});const{crc:O}=r,P=e.writeUint,H=e.writeUshort,M=e.writeASCII;let I=8;const K=N.frames.length>1;let G,R=!1,Ee=33+(K?20:0);if(C.sRGB!=null&&(Ee+=13),C.pHYs!=null&&(Ee+=21),C.iCCP!=null&&(G=pako.deflate(C.iCCP),Ee+=21+G.length+4),N.ctype==3){for(var ge=N.plte.length,F=0;F<ge;F++)N.plte[F]>>>24!=255&&(R=!0);Ee+=8+3*ge+4+(R?8+1*ge+4:0)}for(var B=0;B<N.frames.length;B++)K&&(Ee+=38),Ee+=(oe=N.frames[B]).cimg.length+12,B!=0&&(Ee+=4);Ee+=12;const se=new Uint8Array(Ee),We=[137,80,78,71,13,10,26,10];for(F=0;F<8;F++)se[F]=We[F];if(P(se,I,13),I+=4,M(se,I,"IHDR"),I+=4,P(se,I,E),I+=4,P(se,I,S),I+=4,se[I]=N.depth,I++,se[I]=N.ctype,I++,se[I]=0,I++,se[I]=0,I++,se[I]=0,I++,P(se,I,O(se,I-17,17)),I+=4,C.sRGB!=null&&(P(se,I,1),I+=4,M(se,I,"sRGB"),I+=4,se[I]=C.sRGB,I++,P(se,I,O(se,I-5,5)),I+=4),C.iCCP!=null){const je=13+G.length;P(se,I,je),I+=4,M(se,I,"iCCP"),I+=4,M(se,I,"ICC profile"),I+=11,I+=2,se.set(G,I),I+=G.length,P(se,I,O(se,I-(je+4),je+4)),I+=4}if(C.pHYs!=null&&(P(se,I,9),I+=4,M(se,I,"pHYs"),I+=4,P(se,I,C.pHYs[0]),I+=4,P(se,I,C.pHYs[1]),I+=4,se[I]=C.pHYs[2],I++,P(se,I,O(se,I-13,13)),I+=4),K&&(P(se,I,8),I+=4,M(se,I,"acTL"),I+=4,P(se,I,N.frames.length),I+=4,P(se,I,C.loop!=null?C.loop:0),I+=4,P(se,I,O(se,I-12,12)),I+=4),N.ctype==3){for(P(se,I,3*(ge=N.plte.length)),I+=4,M(se,I,"PLTE"),I+=4,F=0;F<ge;F++){const je=3*F,te=N.plte[F],$e=255&te,Te=te>>>8&255,Je=te>>>16&255;se[I+je+0]=$e,se[I+je+1]=Te,se[I+je+2]=Je}if(I+=3*ge,P(se,I,O(se,I-3*ge-4,3*ge+4)),I+=4,R){for(P(se,I,ge),I+=4,M(se,I,"tRNS"),I+=4,F=0;F<ge;F++)se[I+F]=N.plte[F]>>>24&255;I+=ge,P(se,I,O(se,I-ge-4,ge+4)),I+=4}}let ut=0;for(B=0;B<N.frames.length;B++){var oe=N.frames[B];K&&(P(se,I,26),I+=4,M(se,I,"fcTL"),I+=4,P(se,I,ut++),I+=4,P(se,I,oe.rect.width),I+=4,P(se,I,oe.rect.height),I+=4,P(se,I,oe.rect.x),I+=4,P(se,I,oe.rect.y),I+=4,H(se,I,T[B]),I+=2,H(se,I,1e3),I+=2,se[I]=oe.dispose,I++,se[I]=oe.blend,I++,P(se,I,O(se,I-30,30)),I+=4);const je=oe.cimg;P(se,I,(ge=je.length)+(B==0?0:4)),I+=4;const te=I;M(se,I,B==0?"IDAT":"fdAT"),I+=4,B!=0&&(P(se,I,ut++),I+=4),se.set(je,I),I+=ge,P(se,I,O(se,te,I-te)),I+=4}return P(se,I,0),I+=4,M(se,I,"IEND"),I+=4,P(se,I,O(se,I-4,4)),I+=4,se.buffer}function u(N,E,S){for(let T=0;T<N.frames.length;T++){const C=N.frames[T];C.rect.width;const O=C.rect.height,P=new Uint8Array(O*C.bpl+O);C.cimg=p(C.img,O,C.bpp,C.bpl,P,E,S)}}function d(N,E,S,T,C){const O=C[0],P=C[1],H=C[2],M=C[3],I=C[4],K=C[5];let G=6,R=8,Ee=255;for(var ge=0;ge<N.length;ge++){const lt=new Uint8Array(N[ge]);for(var F=lt.length,B=0;B<F;B+=4)Ee&=lt[B+3]}const se=Ee!=255,We=function(St,X,ee,ie,ce,Z){const ne=[];for(var Se=0;Se<St.length;Se++){const It=new Uint8Array(St[Se]),ue=new Uint32Array(It.buffer);var Ie;let Ne=0,Ue=0,Ze=X,xe=ee,ct=ie?1:0;if(Se!=0){const dt=Z||ie||Se==1||ne[Se-2].dispose!=0?1:2;let ft=0,de=1e9;for(let ve=0;ve<dt;ve++){var fe=new Uint8Array(St[Se-1-ve]);const tt=new Uint32Array(St[Se-1-ve]);let st=X,ht=ee,Xe=-1,At=-1;for(let Q=0;Q<ee;Q++)for(let me=0;me<X;me++)ue[et=Q*X+me]!=tt[et]&&(me<st&&(st=me),me>Xe&&(Xe=me),Q<ht&&(ht=Q),Q>At&&(At=Q));Xe==-1&&(st=ht=Xe=At=0),ce&&((1&st)==1&&st--,(1&ht)==1&&ht--);const jt=(Xe-st+1)*(At-ht+1);jt<de&&(de=jt,ft=ve,Ne=st,Ue=ht,Ze=Xe-st+1,xe=At-ht+1)}fe=new Uint8Array(St[Se-1-ft]),ft==1&&(ne[Se-1].dispose=2),Ie=new Uint8Array(Ze*xe*4),t(fe,X,ee,Ie,Ze,xe,-Ne,-Ue,0),ct=t(It,X,ee,Ie,Ze,xe,-Ne,-Ue,3)?1:0,ct==1?h(It,X,ee,Ie,{x:Ne,y:Ue,width:Ze,height:xe}):t(It,X,ee,Ie,Ze,xe,-Ne,-Ue,0)}else Ie=It.slice(0);ne.push({rect:{x:Ne,y:Ue,width:Ze,height:xe},img:Ie,blend:ct,dispose:0})}if(ie)for(Se=0;Se<ne.length;Se++){if((xt=ne[Se]).blend==1)continue;const It=xt.rect,ue=ne[Se-1].rect,Ne=Math.min(It.x,ue.x),Ue=Math.min(It.y,ue.y),Ze={x:Ne,y:Ue,width:Math.max(It.x+It.width,ue.x+ue.width)-Ne,height:Math.max(It.y+It.height,ue.y+ue.height)-Ue};ne[Se-1].dispose=1,Se-1!=0&&f(St,X,ee,ne,Se-1,Ze,ce),f(St,X,ee,ne,Se,Ze,ce)}let Oe=0;if(St.length!=1)for(var et=0;et<ne.length;et++){var xt;Oe+=(xt=ne[et]).rect.width*xt.rect.height}return ne}(N,E,S,O,P,H),ut={},oe=[],je=[];if(T!=0){const lt=[];for(B=0;B<We.length;B++)lt.push(We[B].img.buffer);const St=function(ce){let Z=0;for(var ne=0;ne<ce.length;ne++)Z+=ce[ne].byteLength;const Se=new Uint8Array(Z);let Ie=0;for(ne=0;ne<ce.length;ne++){const fe=new Uint8Array(ce[ne]),Oe=fe.length;for(let et=0;et<Oe;et+=4){let xt=fe[et],It=fe[et+1],ue=fe[et+2];const Ne=fe[et+3];Ne==0&&(xt=It=ue=0),Se[Ie+et]=xt,Se[Ie+et+1]=It,Se[Ie+et+2]=ue,Se[Ie+et+3]=Ne}Ie+=Oe}return Se.buffer}(lt),X=y(St,T);for(B=0;B<X.plte.length;B++)oe.push(X.plte[B].est.rgba);let ee=0;for(B=0;B<We.length;B++){const ie=($e=We[B]).img.length;var te=new Uint8Array(X.inds.buffer,ee>>2,ie>>2);je.push(te);const ce=new Uint8Array(X.abuf,ee,ie);K&&a($e.img,$e.rect.width,$e.rect.height,oe,ce,te),$e.img.set(ce),ee+=ie}}else for(ge=0;ge<We.length;ge++){var $e=We[ge];const lt=new Uint32Array($e.img.buffer);var Te=$e.rect.width;for(F=lt.length,te=new Uint8Array(F),je.push(te),B=0;B<F;B++){const St=lt[B];if(B!=0&&St==lt[B-1])te[B]=te[B-1];else if(B>Te&&St==lt[B-Te])te[B]=te[B-Te];else{let X=ut[St];if(X==null&&(ut[St]=X=oe.length,oe.push(St),oe.length>=300))break;te[B]=X}}}const Je=oe.length;for(Je<=256&&I==0&&(R=Je<=2?1:Je<=4?2:Je<=16?4:8,R=Math.max(R,M)),ge=0;ge<We.length;ge++){($e=We[ge]).rect.x,$e.rect.y,Te=$e.rect.width;const lt=$e.rect.height;let St=$e.img;new Uint32Array(St.buffer);let X=4*Te,ee=4;if(Je<=256&&I==0){X=Math.ceil(R*Te/8);var Ye=new Uint8Array(X*lt);const ie=je[ge];for(let ce=0;ce<lt;ce++){B=ce*X;const Z=ce*Te;if(R==8)for(var Ke=0;Ke<Te;Ke++)Ye[B+Ke]=ie[Z+Ke];else if(R==4)for(Ke=0;Ke<Te;Ke++)Ye[B+(Ke>>1)]|=ie[Z+Ke]<<4-4*(1&Ke);else if(R==2)for(Ke=0;Ke<Te;Ke++)Ye[B+(Ke>>2)]|=ie[Z+Ke]<<6-2*(3&Ke);else if(R==1)for(Ke=0;Ke<Te;Ke++)Ye[B+(Ke>>3)]|=ie[Z+Ke]<<7-1*(7&Ke)}St=Ye,G=3,ee=1}else if(se==0&&We.length==1){Ye=new Uint8Array(Te*lt*3);const ie=Te*lt;for(B=0;B<ie;B++){const ce=3*B,Z=4*B;Ye[ce]=St[Z],Ye[ce+1]=St[Z+1],Ye[ce+2]=St[Z+2]}St=Ye,G=2,ee=3,X=3*Te}$e.img=St,$e.bpl=X,$e.bpp=ee}return{ctype:G,depth:R,plte:oe,frames:We}}function f(N,E,S,T,C,O,P){const H=Uint8Array,M=Uint32Array,I=new H(N[C-1]),K=new M(N[C-1]),G=C+1<N.length?new H(N[C+1]):null,R=new H(N[C]),Ee=new M(R.buffer);let ge=E,F=S,B=-1,se=-1;for(let ut=0;ut<O.height;ut++)for(let oe=0;oe<O.width;oe++){const je=O.x+oe,te=O.y+ut,$e=te*E+je,Te=Ee[$e];Te==0||T[C-1].dispose==0&&K[$e]==Te&&(G==null||G[4*$e+3]!=0)||(je<ge&&(ge=je),je>B&&(B=je),te<F&&(F=te),te>se&&(se=te))}B==-1&&(ge=F=B=se=0),P&&((1&ge)==1&&ge--,(1&F)==1&&F--),O={x:ge,y:F,width:B-ge+1,height:se-F+1};const We=T[C];We.rect=O,We.blend=1,We.img=new Uint8Array(O.width*O.height*4),T[C-1].dispose==0?(t(I,E,S,We.img,O.width,O.height,-O.x,-O.y,0),h(R,E,S,We.img,O)):t(R,E,S,We.img,O.width,O.height,-O.x,-O.y,0)}function h(N,E,S,T,C){t(N,E,S,T,C.width,C.height,-C.x,-C.y,2)}function p(N,E,S,T,C,O,P){const H=[];let M,I=[0,1,2,3,4];O!=-1?I=[O]:(E*T>5e5||S==1)&&(I=[0]),P&&(M={level:0});const K=L9;for(var G=0;G<I.length;G++){for(let ge=0;ge<E;ge++)m(C,N,ge,T,S,I[G]);H.push(K.deflate(C,M))}let R,Ee=1e9;for(G=0;G<H.length;G++)H[G].length<Ee&&(R=G,Ee=H[G].length);return H[R]}function m(N,E,S,T,C,O){const P=S*T;let H=P+S;if(N[H]=O,H++,O==0)if(T<500)for(var M=0;M<T;M++)N[H+M]=E[P+M];else N.set(new Uint8Array(E.buffer,P,T),H);else if(O==1){for(M=0;M<C;M++)N[H+M]=E[P+M];for(M=C;M<T;M++)N[H+M]=E[P+M]-E[P+M-C]+256&255}else if(S==0){for(M=0;M<C;M++)N[H+M]=E[P+M];if(O==2)for(M=C;M<T;M++)N[H+M]=E[P+M];if(O==3)for(M=C;M<T;M++)N[H+M]=E[P+M]-(E[P+M-C]>>1)+256&255;if(O==4)for(M=C;M<T;M++)N[H+M]=E[P+M]-n(E[P+M-C],0,0)+256&255}else{if(O==2)for(M=0;M<T;M++)N[H+M]=E[P+M]+256-E[P+M-T]&255;if(O==3){for(M=0;M<C;M++)N[H+M]=E[P+M]+256-(E[P+M-T]>>1)&255;for(M=C;M<T;M++)N[H+M]=E[P+M]+256-(E[P+M-T]+E[P+M-C]>>1)&255}if(O==4){for(M=0;M<C;M++)N[H+M]=E[P+M]+256-n(0,E[P+M-T],0)&255;for(M=C;M<T;M++)N[H+M]=E[P+M]+256-n(E[P+M-C],E[P+M-T],E[P+M-C-T])&255}}}function y(N,E){const S=new Uint8Array(N),T=S.slice(0),C=new Uint32Array(T.buffer),O=b(T,E),P=O[0],H=O[1],M=S.length,I=new Uint8Array(M>>2);let K;if(S.length<2e7)for(var G=0;G<M;G+=4)K=g(P,R=S[G]*(1/255),Ee=S[G+1]*(1/255),ge=S[G+2]*(1/255),F=S[G+3]*(1/255)),I[G>>2]=K.ind,C[G>>2]=K.est.rgba;else for(G=0;G<M;G+=4){var R=S[G]*.00392156862745098,Ee=S[G+1]*(1/255),ge=S[G+2]*(1/255),F=S[G+3]*(1/255);for(K=P;K.left;)K=v(K.est,R,Ee,ge,F)<=0?K.left:K.right;I[G>>2]=K.ind,C[G>>2]=K.est.rgba}return{abuf:T.buffer,inds:I,plte:H}}function b(N,E,S){S==null&&(S=1e-4);const T=new Uint32Array(N.buffer),C={i0:0,i1:N.length,bst:null,est:null,tdst:0,left:null,right:null};C.bst=D(N,C.i0,C.i1),C.est=k(C.bst);const O=[C];for(;O.length<E;){let H=0,M=0;for(var P=0;P<O.length;P++)O[P].est.L>H&&(H=O[P].est.L,M=P);if(H<S)break;const I=O[M],K=w(N,T,I.i0,I.i1,I.est.e,I.est.eMq255);if(I.i0>=K||I.i1<=K){I.est.L=0;continue}const G={i0:I.i0,i1:K,bst:null,est:null,tdst:0,left:null,right:null};G.bst=D(N,G.i0,G.i1),G.est=k(G.bst);const R={i0:K,i1:I.i1,bst:null,est:null,tdst:0,left:null,right:null};for(R.bst={R:[],m:[],N:I.bst.N-G.bst.N},P=0;P<16;P++)R.bst.R[P]=I.bst.R[P]-G.bst.R[P];for(P=0;P<4;P++)R.bst.m[P]=I.bst.m[P]-G.bst.m[P];R.est=k(R.bst),I.left=G,I.right=R,O[M]=G,O.push(R)}for(O.sort((H,M)=>M.bst.N-H.bst.N),P=0;P<O.length;P++)O[P].ind=P;return[C,O]}function g(N,E,S,T,C){if(N.left==null)return N.tdst=function(G,R,Ee,ge,F){const B=R-G[0],se=Ee-G[1],We=ge-G[2],ut=F-G[3];return B*B+se*se+We*We+ut*ut}(N.est.q,E,S,T,C),N;const O=v(N.est,E,S,T,C);let P=N.left,H=N.right;O>0&&(P=N.right,H=N.left);const M=g(P,E,S,T,C);if(M.tdst<=O*O)return M;const I=g(H,E,S,T,C);return I.tdst<M.tdst?I:M}function v(N,E,S,T,C){const{e:O}=N;return O[0]*E+O[1]*S+O[2]*T+O[3]*C-N.eMq}function w(N,E,S,T,C,O){for(T-=4;S<T;){for(;_(N,S,C)<=O;)S+=4;for(;_(N,T,C)>O;)T-=4;if(S>=T)break;const P=E[S>>2];E[S>>2]=E[T>>2],E[T>>2]=P,S+=4,T-=4}for(;_(N,S,C)>O;)S-=4;return S+4}function _(N,E,S){return N[E]*S[0]+N[E+1]*S[1]+N[E+2]*S[2]+N[E+3]*S[3]}function D(N,E,S){const T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=[0,0,0,0],O=S-E>>2;for(let P=E;P<S;P+=4){const H=N[P]*.00392156862745098,M=N[P+1]*(1/255),I=N[P+2]*(1/255),K=N[P+3]*(1/255);C[0]+=H,C[1]+=M,C[2]+=I,C[3]+=K,T[0]+=H*H,T[1]+=H*M,T[2]+=H*I,T[3]+=H*K,T[5]+=M*M,T[6]+=M*I,T[7]+=M*K,T[10]+=I*I,T[11]+=I*K,T[15]+=K*K}return T[4]=T[1],T[8]=T[2],T[9]=T[6],T[12]=T[3],T[13]=T[7],T[14]=T[11],{R:T,m:C,N:O}}function k(N){const{R:E}=N,{m:S}=N,{N:T}=N,C=S[0],O=S[1],P=S[2],H=S[3],M=T==0?0:1/T,I=[E[0]-C*C*M,E[1]-C*O*M,E[2]-C*P*M,E[3]-C*H*M,E[4]-O*C*M,E[5]-O*O*M,E[6]-O*P*M,E[7]-O*H*M,E[8]-P*C*M,E[9]-P*O*M,E[10]-P*P*M,E[11]-P*H*M,E[12]-H*C*M,E[13]-H*O*M,E[14]-H*P*M,E[15]-H*H*M],K=I,G=A;let R=[Math.random(),Math.random(),Math.random(),Math.random()],Ee=0,ge=0;if(T!=0)for(let B=0;B<16&&(R=G.multVec(K,R),ge=Math.sqrt(G.dot(R,R)),R=G.sml(1/ge,R),!(B!=0&&Math.abs(ge-Ee)<1e-9));B++)Ee=ge;const F=[C*M,O*M,P*M,H*M];return{Cov:I,q:F,e:R,L:Ee,eMq255:G.dot(G.sml(255,F),R),eMq:G.dot(R,F),rgba:(Math.round(255*F[3])<<24|Math.round(255*F[2])<<16|Math.round(255*F[1])<<8|Math.round(255*F[0])<<0)>>>0}}var A={multVec:(N,E)=>[N[0]*E[0]+N[1]*E[1]+N[2]*E[2]+N[3]*E[3],N[4]*E[0]+N[5]*E[1]+N[6]*E[2]+N[7]*E[3],N[8]*E[0]+N[9]*E[1]+N[10]*E[2]+N[11]*E[3],N[12]*E[0]+N[13]*E[1]+N[14]*E[2]+N[15]*E[3]],dot:(N,E)=>N[0]*E[0]+N[1]*E[1]+N[2]*E[2]+N[3]*E[3],sml:(N,E)=>[N*E[0],N*E[1],N*E[2],N*E[3]]};Wi.encode=function(E,S,T,C,O,P,H){C==null&&(C=0),H==null&&(H=!1);const M=d(E,S,T,C,[!1,!1,!1,0,H,!1]);return u(M,-1),l(M,S,T,O,P)},Wi.encodeLL=function(E,S,T,C,O,P,H,M){const I={ctype:0+(C==1?0:2)+(O==0?0:4),depth:P,frames:[]},K=(C+O)*P,G=K*S;for(let R=0;R<E.length;R++)I.frames.push({rect:{x:0,y:0,width:S,height:T},img:new Uint8Array(E[R]),blend:0,dispose:1,bpp:Math.ceil(K/8),bpl:Math.ceil(G/8)});return u(I,0,!0),l(I,S,T,H,M)},Wi.encode.compress=d,Wi.encode.dither=a,Wi.quantize=y,Wi.quantize.getKDtree=b,Wi.quantize.getNearest=g})();const jD={toArrayBuffer(t,e){const n=t.width,r=t.height,s=n<<2,i=t.getContext("2d").getImageData(0,0,n,r),o=new Uint32Array(i.data.buffer),a=(32*n+31)/32<<2,l=a*r,u=122+l,d=new ArrayBuffer(u),f=new DataView(d),h=1<<20;let p,m,y,b,g=h,v=0,w=0,_=0;function D(N){f.setUint16(w,N,!0),w+=2}function k(N){f.setUint32(w,N,!0),w+=4}function A(N){w+=N}D(19778),k(u),A(4),k(122),k(108),k(n),k(-r>>>0),D(1),D(32),k(3),k(l),k(2835),k(2835),A(8),k(16711680),k(65280),k(255),k(4278190080),k(1466527264),function N(){for(;v<r&&g>0;){for(b=122+v*a,p=0;p<s;)g--,m=o[_++],y=m>>>24,f.setUint32(b+p,m<<8|y),p+=4;v++}_<o.length?(g=h,setTimeout(N,jD._dly)):e(d)}()},toBlob(t,e){this.toArrayBuffer(t,n=>{e(new Blob([n],{type:"image/bmp"}))})},_dly:9};var Ls={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},$9={[Ls.CHROME]:16384,[Ls.FIREFOX]:11180,[Ls.DESKTOP_SAFARI]:16384,[Ls.IE]:8192,[Ls.IOS]:4096,[Ls.ETC]:8192};const dv=typeof window<"u",ID=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,mm=dv&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),z9=(dv||ID)&&(mm&&mm.getOriginalSymbol(window,"File")||typeof File<"u"&&File),MD=(dv||ID)&&(mm&&mm.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function fv(t,e,n=Date.now()){return new Promise(r=>{const s=t.split(","),i=s[0].match(/:(.*?);/)[1],o=globalThis.atob(s[1]);let a=o.length;const l=new Uint8Array(a);for(;a--;)l[a]=o.charCodeAt(a);const u=new Blob([l],{type:i});u.name=e,u.lastModified=n,r(u)})}function DD(t){return new Promise((e,n)=>{const r=new MD;r.onload=()=>e(r.result),r.onerror=s=>n(s),r.readAsDataURL(t)})}function AD(t){return new Promise((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=s=>n(s),r.src=t})}function Il(){if(Il.cachedResult!==void 0)return Il.cachedResult;let t=Ls.ETC;const{userAgent:e}=navigator;return/Chrom(e|ium)/i.test(e)?t=Ls.CHROME:/iP(ad|od|hone)/i.test(e)&&/WebKit/i.test(e)?t=Ls.IOS:/Safari/i.test(e)?t=Ls.DESKTOP_SAFARI:/Firefox/i.test(e)?t=Ls.FIREFOX:(/MSIE/i.test(e)||document.documentMode)&&(t=Ls.IE),Il.cachedResult=t,Il.cachedResult}function RD(t,e){const n=Il(),r=$9[n];let s=t,i=e,o=s*i;const a=s>i?i/s:s/i;for(;o>r*r;){const l=(r+s)/2,u=(r+i)/2;l<u?(i=u,s=u*a):(i=l*a,s=l),o=s*i}return{width:s,height:i}}function Lg(t,e){let n,r;try{if(n=new OffscreenCanvas(t,e),r=n.getContext("2d"),r===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{n=document.createElement("canvas"),r=n.getContext("2d")}return n.width=t,n.height=e,[n,r]}function OD(t,e){const{width:n,height:r}=RD(t.width,t.height),[s,i]=Lg(n,r);return e&&/jpe?g/.test(e)&&(i.fillStyle="white",i.fillRect(0,0,s.width,s.height)),i.drawImage(t,0,0,s.width,s.height),s}function kp(){return kp.cachedResult!==void 0||(kp.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),kp.cachedResult}function gm(t,e={}){return new Promise(function(n,r){let s,i;var o=function(){try{return i=OD(s,e.fileType||t.type),n([s,i])}catch(l){return r(l)}},a=function(l){try{var u=function(d){try{throw d}catch(f){return r(f)}};try{let d;return DD(t).then(function(f){try{return d=f,AD(d).then(function(h){try{return s=h,function(){try{return o()}catch(p){return r(p)}}()}catch(p){return u(p)}},u)}catch(h){return u(h)}},u)}catch(d){u(d)}}catch(d){return r(d)}};try{if(kp()||[Ls.DESKTOP_SAFARI,Ls.MOBILE_SAFARI].includes(Il()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(t).then(function(l){try{return s=l,o()}catch{return a()}},a)}catch{a()}})}function ym(t,e,n,r,s=1){return new Promise(function(i,o){let a;if(e==="image/png"){let f,h,p;return f=t.getContext("2d"),{data:h}=f.getImageData(0,0,t.width,t.height),p=Wi.encode([h.buffer],t.width,t.height,4096*s),a=new Blob([p],{type:e}),a.name=n,a.lastModified=r,l.call(this)}{let f=function(){return l.call(this)};var u=f;if(e==="image/bmp")return new Promise(h=>jD.toBlob(t,h)).then((function(h){try{return a=h,a.name=n,a.lastModified=r,f.call(this)}catch(p){return o(p)}}).bind(this),o);{let h=function(){return f.call(this)};var d=h;if(typeof OffscreenCanvas=="function"&&t instanceof OffscreenCanvas)return t.convertToBlob({type:e,quality:s}).then((function(p){try{return a=p,a.name=n,a.lastModified=r,h.call(this)}catch(m){return o(m)}}).bind(this),o);{let p;return p=t.toDataURL(e,s),fv(p,n,r).then((function(m){try{return a=m,h.call(this)}catch(y){return o(y)}}).bind(this),o)}}}function l(){return i(a)}})}function uo(t){t.width=0,t.height=0}function Yc(){return new Promise(function(t,e){let n,r,s,i;return Yc.cachedResult!==void 0?t(Yc.cachedResult):fv("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(o){try{return n=o,gm(n).then(function(a){try{return r=a[1],ym(r,n.type,n.name,n.lastModified).then(function(l){try{return s=l,uo(r),gm(s).then(function(u){try{return i=u[0],Yc.cachedResult=i.width===1&&i.height===2,t(Yc.cachedResult)}catch(d){return e(d)}},e)}catch(u){return e(u)}},e)}catch(l){return e(l)}},e)}catch(a){return e(a)}},e)})}function PD(t){return new Promise((e,n)=>{const r=new MD;r.onload=s=>{const i=new DataView(s.target.result);if(i.getUint16(0,!1)!=65496)return e(-2);const o=i.byteLength;let a=2;for(;a<o;){if(i.getUint16(a+2,!1)<=8)return e(-1);const l=i.getUint16(a,!1);if(a+=2,l==65505){if(i.getUint32(a+=2,!1)!=1165519206)return e(-1);const u=i.getUint16(a+=6,!1)==18761;a+=i.getUint32(a+4,u);const d=i.getUint16(a,u);a+=2;for(let f=0;f<d;f++)if(i.getUint16(a+12*f,u)==274)return e(i.getUint16(a+12*f+8,u))}else{if((65280&l)!=65280)break;a+=i.getUint16(a,!1)}}return e(-1)},r.onerror=s=>n(s),r.readAsArrayBuffer(t)})}function LD(t,e){const{width:n}=t,{height:r}=t,{maxWidthOrHeight:s}=e;let i,o=t;return isFinite(s)&&(n>s||r>s)&&([o,i]=Lg(n,r),n>r?(o.width=s,o.height=r/n*s):(o.width=n/r*s,o.height=s),i.drawImage(t,0,0,o.width,o.height),uo(t)),o}function $D(t,e){const{width:n}=t,{height:r}=t,[s,i]=Lg(n,r);switch(e>4&&e<9?(s.width=r,s.height=n):(s.width=n,s.height=r),e){case 2:i.transform(-1,0,0,1,n,0);break;case 3:i.transform(-1,0,0,-1,n,r);break;case 4:i.transform(1,0,0,-1,0,r);break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,r,0);break;case 7:i.transform(0,-1,-1,0,r,n);break;case 8:i.transform(0,-1,1,0,0,n)}return i.drawImage(t,0,0,n,r),uo(t),s}function N_(t,e,n=0){return new Promise(function(r,s){let i,o,a,l,u,d,f,h,p,m,y,b,g,v,w,_,D,k,A,N;function E(T=5){if(e.signal&&e.signal.aborted)throw e.signal.reason;i+=T,e.onProgress(Math.min(i,100))}function S(T){if(e.signal&&e.signal.aborted)throw e.signal.reason;i=Math.min(Math.max(T,i),100),e.onProgress(i)}return i=n,o=e.maxIteration||10,a=1024*e.maxSizeMB*1024,E(),gm(t,e).then((function(T){try{return[,l]=T,E(),u=LD(l,e),E(),new Promise(function(C,O){var P;if(!(P=e.exifOrientation))return PD(t).then((function(M){try{return P=M,H.call(this)}catch(I){return O(I)}}).bind(this),O);function H(){return C(P)}return H.call(this)}).then((function(C){try{return d=C,E(),Yc().then((function(O){try{return f=O?u:$D(u,d),E(),h=e.initialQuality||1,p=e.fileType||t.type,ym(f,p,t.name,t.lastModified,h).then((function(P){try{{let K=function(){if(o--&&(w>a||w>g)){let R,Ee;return R=N?.95*A.width:A.width,Ee=N?.95*A.height:A.height,[D,k]=Lg(R,Ee),k.drawImage(A,0,0,R,Ee),h*=p==="image/png"?.85:.95,ym(D,p,t.name,t.lastModified,h).then(function(ge){try{return _=ge,uo(A),A=D,w=_.size,S(Math.min(99,Math.floor((v-w)/(v-a)*100))),K}catch(F){return s(F)}},s)}return[1]},G=function(){return uo(A),uo(D),uo(u),uo(f),uo(l),S(100),r(_)};var M=K,I=G;if(m=P,E(),y=m.size>a,b=m.size>t.size,!y&&!b)return S(100),r(m);var H;return g=t.size,v=m.size,w=v,A=f,N=!e.alwaysKeepResolution&&y,(H=(function(R){for(;R;){if(R.then)return void R.then(H,s);try{if(R.pop){if(R.length)return R.pop()?G.call(this):R;R=K}else R=R.call(this)}catch(Ee){return s(Ee)}}}).bind(this))(K)}}catch(K){return s(K)}}).bind(this),s)}catch(P){return s(P)}}).bind(this),s)}catch(O){return s(O)}}).bind(this),s)}catch(C){return s(C)}}).bind(this),s)})}const F9=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let iy;function B9(t,e){return new Promise((n,r)=>{iy||(iy=function(o){const a=[];return typeof o=="function"?a.push(`(${o})()`):a.push(o),URL.createObjectURL(new Blob(a))}(F9));const s=new Worker(iy);s.addEventListener("message",function(o){if(e.signal&&e.signal.aborted)s.terminate();else if(o.data.progress===void 0){if(o.data.error)return r(new Error(o.data.error)),void s.terminate();n(o.data.file),s.terminate()}else e.onProgress(o.data.progress)}),s.addEventListener("error",r),e.signal&&e.signal.addEventListener("abort",()=>{r(e.signal.reason),s.terminate()}),s.postMessage({file:t,imageCompressionLibUrl:e.libURL,options:{...e,onProgress:void 0,signal:void 0}})})}function hs(t,e){return new Promise(function(n,r){let s,i,o,a,l,u;if(s={...e},o=0,{onProgress:a}=s,s.maxSizeMB=s.maxSizeMB||Number.POSITIVE_INFINITY,l=typeof s.useWebWorker!="boolean"||s.useWebWorker,delete s.useWebWorker,s.onProgress=p=>{o=p,typeof a=="function"&&a(o)},!(t instanceof Blob||t instanceof z9))return r(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(t.type))return r(new Error("The file given is not an image"));if(u=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!l||typeof Worker!="function"||u)return N_(t,s).then((function(p){try{return i=p,h.call(this)}catch(m){return r(m)}}).bind(this),r);var d=(function(){try{return h.call(this)}catch(p){return r(p)}}).bind(this),f=function(p){try{return N_(t,s).then(function(m){try{return i=m,d()}catch(y){return r(y)}},r)}catch(m){return r(m)}};try{return s.libURL=s.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",B9(t,s).then(function(p){try{return i=p,d()}catch{return f()}},f)}catch{f()}function h(){try{i.name=t.name,i.lastModified=t.lastModified}catch{}try{s.preserveExif&&t.type==="image/jpeg"&&(!s.fileType||s.fileType&&s.fileType===t.type)&&(i=ND(t,i))}catch{}return n(i)}})}hs.getDataUrlFromFile=DD,hs.getFilefromDataUrl=fv,hs.loadImage=AD,hs.drawImageInCanvas=OD,hs.drawFileInCanvas=gm,hs.canvasToFile=ym,hs.getExifOrientation=PD,hs.handleMaxWidthOrHeight=LD,hs.followExifOrientation=$D,hs.cleanupCanvasMemory=uo,hs.isAutoOrientationInBrowser=Yc,hs.approximateBelowMaximumCanvasSizeOfBrowser=RD,hs.copyExifWithoutOrientation=ND,hs.getBrowserName=Il,hs.version="2.0.2";function Qr(t){this.content=t}Qr.prototype={constructor:Qr,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,s=r.find(t),i=r.content.slice();return s==-1?i.push(n||t,e):(i[s+1]=e,n&&(i[s]=n)),new Qr(i)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new Qr(n)},addToStart:function(t,e){return new Qr([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new Qr(n)},addBefore:function(t,e,n){var r=this.remove(e),s=r.content.slice(),i=r.find(t);return s.splice(i==-1?s.length:i,0,e,n),new Qr(s)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=Qr.from(t),t.size?new Qr(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Qr.from(t),t.size?new Qr(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Qr.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};Qr.from=function(t){if(t instanceof Qr)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new Qr(e)};function zD(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let s=t.child(r),i=e.child(r);if(s==i){n+=s.nodeSize;continue}if(!s.sameMarkup(i))return n;if(s.isText&&s.text!=i.text){for(let o=0;s.text[o]==i.text[o];o++)n++;return n}if(s.content.size||i.content.size){let o=zD(s.content,i.content,n+1);if(o!=null)return o}n+=s.nodeSize}}function FD(t,e,n,r){for(let s=t.childCount,i=e.childCount;;){if(s==0||i==0)return s==i?null:{a:n,b:r};let o=t.child(--s),a=e.child(--i),l=o.nodeSize;if(o==a){n-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let u=0,d=Math.min(o.text.length,a.text.length);for(;u<d&&o.text[o.text.length-u-1]==a.text[a.text.length-u-1];)u++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let u=FD(o.content,a.content,n-1,r-1);if(u)return u}n-=l,r-=l}}class Nt{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,s=0,i){for(let o=0,a=0;a<n;o++){let l=this.content[o],u=a+l.nodeSize;if(u>e&&r(l,s+a,i||null,o)!==!1&&l.content.size){let d=a+1;l.nodesBetween(Math.max(0,e-d),Math.min(l.content.size,n-d),r,s+d)}a=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,s){let i="",o=!0;return this.nodesBetween(e,n,(a,l)=>{let u=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?s?typeof s=="function"?s(a):s:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&u||a.isTextblock)&&r&&(o?o=!1:i+=r),i+=u},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,s=this.content.slice(),i=0;for(n.isText&&n.sameMarkup(r)&&(s[s.length-1]=n.withText(n.text+r.text),i=1);i<e.content.length;i++)s.push(e.content[i]);return new Nt(s,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],s=0;if(n>e)for(let i=0,o=0;o<n;i++){let a=this.content[i],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),r.push(a),s+=a.nodeSize),o=l}return new Nt(r,s)}cutByIndex(e,n){return e==n?Nt.empty:e==0&&n==this.content.length?this:new Nt(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let s=this.content.slice(),i=this.size+n.nodeSize-r.nodeSize;return s[e]=n,new Nt(s,i)}addToStart(e){return new Nt([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Nt(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let s=this.content[n];e(s,r,n),r+=s.nodeSize}}findDiffStart(e,n=0){return zD(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return FD(this,e,n,r)}findIndex(e){if(e==0)return Ph(0,e);if(e==this.size)return Ph(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let s=this.child(n),i=r+s.nodeSize;if(i>=e)return i==e?Ph(n+1,i):Ph(n,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return Nt.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new Nt(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Nt.empty;let n,r=0;for(let s=0;s<e.length;s++){let i=e[s];r+=i.nodeSize,s&&i.isText&&e[s-1].sameMarkup(i)?(n||(n=e.slice(0,s)),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new Nt(n||e,r)}static from(e){if(!e)return Nt.empty;if(e instanceof Nt)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Nt([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Nt.empty=new Nt([],0);const oy={index:0,offset:0};function Ph(t,e){return oy.index=t,oy.offset=e,oy}function xm(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!xm(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!xm(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let Bn=class D1{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let s=0;s<e.length;s++){let i=e[s];if(this.eq(i))return e;if(this.type.excludes(i.type))n||(n=e.slice(0,s));else{if(i.type.excludes(this.type))return e;!r&&i.type.rank>this.type.rank&&(n||(n=e.slice(0,s)),n.push(this),r=!0),n&&n.push(i)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&xm(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let s=r.create(n.attrs);return r.checkAttrs(s.attrs),s}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return D1.none;if(e instanceof D1)return[e];let n=e.slice();return n.sort((r,s)=>r.type.rank-s.type.rank),n}};Bn.none=[];class bm extends Error{}class qt{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=UD(this.content,e+this.openStart,n);return r&&new qt(r,this.openStart,this.openEnd)}removeBetween(e,n){return new qt(BD(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return qt.empty;let r=n.openStart||0,s=n.openEnd||0;if(typeof r!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new qt(Nt.fromJSON(e,n.content),r,s)}static maxOpen(e,n=!0){let r=0,s=0;for(let i=e.firstChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.firstChild)r++;for(let i=e.lastChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.lastChild)s++;return new qt(e,r,s)}}qt.empty=new qt(Nt.empty,0,0);function BD(t,e,n){let{index:r,offset:s}=t.findIndex(e),i=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(s==e||i.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,i.copy(BD(i.content,e-s-1,n-s-1)))}function UD(t,e,n,r){let{index:s,offset:i}=t.findIndex(e),o=t.maybeChild(s);if(i==e||o.isText)return r&&!r.canReplace(s,s,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=UD(o.content,e-i-1,n,o);return a&&t.replaceChild(s,o.copy(a))}function U9(t,e,n){if(n.openStart>t.depth)throw new bm("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new bm("Inconsistent open depths");return HD(t,e,n,0)}function HD(t,e,n,r){let s=t.index(r),i=t.node(r);if(s==e.index(r)&&r<t.depth-n.openStart){let o=HD(t,e,n,r+1);return i.copy(i.content.replaceChild(s,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,a=o.content;return Bl(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=H9(n,t);return Bl(i,WD(t,o,a,e,r))}else return Bl(i,wm(t,e,r))}function VD(t,e){if(!e.type.compatibleContent(t.type))throw new bm("Cannot join "+e.type.name+" onto "+t.type.name)}function A1(t,e,n){let r=t.node(n);return VD(r,e.node(n)),r}function Fl(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Ad(t,e,n,r){let s=(e||t).node(n),i=0,o=e?e.index(n):s.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(Fl(t.nodeAfter,r),i++));for(let a=i;a<o;a++)Fl(s.child(a),r);e&&e.depth==n&&e.textOffset&&Fl(e.nodeBefore,r)}function Bl(t,e){return t.type.checkContent(e),t.copy(e)}function WD(t,e,n,r,s){let i=t.depth>s&&A1(t,e,s+1),o=r.depth>s&&A1(n,r,s+1),a=[];return Ad(null,t,s,a),i&&o&&e.index(s)==n.index(s)?(VD(i,o),Fl(Bl(i,WD(t,e,n,r,s+1)),a)):(i&&Fl(Bl(i,wm(t,e,s+1)),a),Ad(e,n,s,a),o&&Fl(Bl(o,wm(n,r,s+1)),a)),Ad(r,null,s,a),new Nt(a)}function wm(t,e,n){let r=[];if(Ad(null,t,n,r),t.depth>n){let s=A1(t,e,n+1);Fl(Bl(s,wm(t,e,n+1)),r)}return Ad(e,null,n,r),new Nt(r)}function H9(t,e){let n=e.depth-t.openStart,s=e.node(n).copy(t.content);for(let i=n-1;i>=0;i--)s=e.node(i).copy(Nt.from(s));return{start:s.resolveNoCache(t.openStart+n),end:s.resolveNoCache(s.content.size-t.openEnd-n)}}class Ef{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],s=e.child(n);return r?e.child(n).cut(r):s}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],s=n==0?0:this.path[n*3-1]+1;for(let i=0;i<e;i++)s+=r.child(i).nodeSize;return s}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return Bn.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),s=e.maybeChild(n);if(!r){let a=r;r=s,s=a}let i=r.marks;for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!s||!i[o].isInSet(s.marks))&&(i=i[o--].removeFromSet(i));return i}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,s=e.parent.maybeChild(e.index());for(var i=0;i<r.length;i++)r[i].type.spec.inclusive===!1&&(!s||!r[i].isInSet(s.marks))&&(r=r[i--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new vm(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],s=0,i=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(i),u=i-l;if(r.push(o,a,s+l),!u||(o=o.child(a),o.isText))break;i=u-1,s+=l+1}return new Ef(n,r,i)}static resolveCached(e,n){let r=j_.get(e);if(r)for(let i=0;i<r.elts.length;i++){let o=r.elts[i];if(o.pos==n)return o}else j_.set(e,r=new V9);let s=r.elts[r.i]=Ef.resolve(e,n);return r.i=(r.i+1)%W9,s}}class V9{constructor(){this.elts=[],this.i=0}}const W9=12,j_=new WeakMap;class vm{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const K9=Object.create(null);let Ko=class R1{constructor(e,n,r,s=Bn.none){this.type=e,this.attrs=n,this.marks=s,this.content=r||Nt.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,s=0){this.content.nodesBetween(e,n,r,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,s){return this.content.textBetween(e,n,r,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&xm(this.attrs,n||e.defaultAttrs||K9)&&Bn.sameSet(this.marks,r||Bn.none)}copy(e=null){return e==this.content?this:new R1(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new R1(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return qt.empty;let s=this.resolve(e),i=this.resolve(n),o=r?0:s.sharedDepth(n),a=s.start(o),u=s.node(o).content.cut(s.pos-a,i.pos-a);return new qt(u,s.depth-o,i.depth-o)}replace(e,n,r){return U9(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:s}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(s==e||n.isText)return n;e-=s+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let s=this.content.child(n-1);return{node:s,index:n-1,offset:r-s.nodeSize}}resolve(e){return Ef.resolveCached(this,e)}resolveNoCache(e){return Ef.resolve(this,e)}rangeHasMark(e,n,r){let s=!1;return n>e&&this.nodesBetween(e,n,i=>(r.isInSet(i.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),KD(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=Nt.empty,s=0,i=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,s,i),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=s;l<i;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,s){if(s&&!this.type.allowsMarks(s))return!1;let i=this.contentMatchAt(e).matchType(r),o=i&&i.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Bn.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!Bn.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let s=Nt.fromJSON(e,n.content),i=e.nodeType(n.type).create(n.attrs,s,r);return i.type.checkAttrs(i.attrs),i}};Ko.prototype.text=void 0;class km extends Ko{constructor(e,n,r,s){if(super(e,n,null,s),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):KD(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new km(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new km(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function KD(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class Jl{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new G9(e,n);if(r.next==null)return Jl.empty;let s=GD(r);r.next&&r.err("Unexpected trailing text");let i=eH(Z9(s));return tH(i,r),i}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let s=this;for(let i=n;s&&i<r;i++)s=s.matchType(e.child(i).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let s=[this];function i(o,a){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return Nt.from(a.map(u=>u.createAndFill()));for(let u=0;u<o.next.length;u++){let{type:d,next:f}=o.next[u];if(!(d.isText||d.hasRequiredAttrs())&&s.indexOf(f)==-1){s.push(f);let h=i(f,a.concat(d));if(h)return h}}return null}return i(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let s=r.shift(),i=s.match;if(i.matchType(e)){let o=[];for(let a=s;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<i.next.length;o++){let{type:a,next:l}=i.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!s.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:s}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let s=0;s<r.next.length;s++)e.indexOf(r.next[s].next)==-1&&n(r.next[s].next)}return n(this),e.map((r,s)=>{let i=s+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)i+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return i}).join(`
`)}}Jl.empty=new Jl(!0);class G9{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function GD(t){let e=[];do e.push(q9(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function q9(t){let e=[];do e.push(Y9(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function Y9(t){let e=Q9(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=J9(t,e);else break;return e}function I_(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function J9(t,e){let n=I_(t),r=n;return t.eat(",")&&(t.next!="}"?r=I_(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function X9(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let s=[];for(let i in n){let o=n[i];o.isInGroup(e)&&s.push(o)}return s.length==0&&t.err("No node type or group '"+e+"' found"),s}function Q9(t){if(t.eat("(")){let e=GD(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=X9(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function Z9(t){let e=[[]];return s(i(t,0),n()),e;function n(){return e.push([])-1}function r(o,a,l){let u={term:l,to:a};return e[o].push(u),u}function s(o,a){o.forEach(l=>l.to=a)}function i(o,a){if(o.type=="choice")return o.exprs.reduce((l,u)=>l.concat(i(u,a)),[]);if(o.type=="seq")for(let l=0;;l++){let u=i(o.exprs[l],a);if(l==o.exprs.length-1)return u;s(u,a=n())}else if(o.type=="star"){let l=n();return r(a,l),s(i(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return s(i(o.expr,a),l),s(i(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(i(o.expr,a));if(o.type=="range"){let l=a;for(let u=0;u<o.min;u++){let d=n();s(i(o.expr,l),d),l=d}if(o.max==-1)s(i(o.expr,l),l);else for(let u=o.min;u<o.max;u++){let d=n();r(l,d),s(i(o.expr,l),d),l=d}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function qD(t,e){return e-t}function M_(t,e){let n=[];return r(e),n.sort(qD);function r(s){let i=t[s];if(i.length==1&&!i[0].term)return r(i[0].to);n.push(s);for(let o=0;o<i.length;o++){let{term:a,to:l}=i[o];!a&&n.indexOf(l)==-1&&r(l)}}}function eH(t){let e=Object.create(null);return n(M_(t,0));function n(r){let s=[];r.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let u;for(let d=0;d<s.length;d++)s[d][0]==a&&(u=s[d][1]);M_(t,l).forEach(d=>{u||s.push([a,u=[]]),u.indexOf(d)==-1&&u.push(d)})})});let i=e[r.join(",")]=new Jl(r.indexOf(t.length-1)>-1);for(let o=0;o<s.length;o++){let a=s[o][1].sort(qD);i.next.push({type:s[o][0],next:e[a.join(",")]||n(a)})}return i}}function tH(t,e){for(let n=0,r=[t];n<r.length;n++){let s=r[n],i=!s.validEnd,o=[];for(let a=0;a<s.next.length;a++){let{type:l,next:u}=s.next[a];o.push(l.name),i&&!(l.isText||l.hasRequiredAttrs())&&(i=!1),r.indexOf(u)==-1&&r.push(u)}i&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function YD(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function JD(t,e){let n=Object.create(null);for(let r in t){let s=e&&e[r];if(s===void 0){let i=t[r];if(i.hasDefault)s=i.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=s}return n}function XD(t,e,n,r){for(let s in e)if(!(s in t))throw new RangeError(`Unsupported attribute ${s} for ${n} of type ${s}`);for(let s in t){let i=t[s];i.validate&&i.validate(e[s])}}function QD(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new rH(t,r,e[r]);return n}let D_=class ZD{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=QD(e,r.attrs),this.defaultAttrs=YD(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Jl.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:JD(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Ko(this,this.computeAttrs(e),Nt.from(n),Bn.setFrom(r))}createChecked(e=null,n,r){return n=Nt.from(n),this.checkContent(n),new Ko(this,this.computeAttrs(e),n,Bn.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=Nt.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let s=this.contentMatch.matchFragment(n),i=s&&s.fillBefore(Nt.empty,!0);return i?new Ko(this,e,n.append(i),Bn.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){XD(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:Bn.none:e}static compile(e,n){let r=Object.create(null);e.forEach((i,o)=>r[i]=new ZD(i,n,o));let s=n.spec.topNode||"doc";if(!r[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function nH(t,e,n){let r=n.split("|");return s=>{let i=s===null?"null":typeof s;if(r.indexOf(i)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${i}`)}}class rH{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?nH(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class $g{constructor(e,n,r,s){this.name=e,this.rank=n,this.schema=r,this.spec=s,this.attrs=QD(e,s.attrs),this.excluded=null;let i=YD(this.attrs);this.instance=i?new Bn(this,i):null}create(e=null){return!e&&this.instance?this.instance:new Bn(this,JD(this.attrs,e))}static compile(e,n){let r=Object.create(null),s=0;return e.forEach((i,o)=>r[i]=new $g(i,s++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){XD(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}let eA=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let s in e)n[s]=e[s];n.nodes=Qr.from(e.nodes),n.marks=Qr.from(e.marks||{}),this.nodes=D_.compile(this.spec.nodes,this),this.marks=$g.compile(this.spec.marks,this);let r=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let i=this.nodes[s],o=i.spec.content||"",a=i.spec.marks;if(i.contentMatch=r[o]||(r[o]=Jl.parse(o,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=a=="_"?null:a?A_(this,a.split(" ")):a==""||!i.inlineContent?[]:null}for(let s in this.marks){let i=this.marks[s],o=i.spec.excludes;i.excluded=o==null?[i]:o==""?[]:A_(this,o.split(" "))}this.nodeFromJSON=s=>Ko.fromJSON(this,s),this.markFromJSON=s=>Bn.fromJSON(this,s),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,s){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof D_){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,s)}text(e,n){let r=this.nodes.text;return new km(r,r.defaultAttrs,e,Bn.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}};function A_(t,e){let n=[];for(let r=0;r<e.length;r++){let s=e[r],i=t.marks[s],o=i;if(i)n.push(i);else for(let a in t.marks){let l=t.marks[a];(s=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(s)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function sH(t){return t.tag!=null}function iH(t){return t.style!=null}class La{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(s=>{if(sH(s))this.tags.push(s);else if(iH(s)){let i=/[^=]*/.exec(s.style)[0];r.indexOf(i)<0&&r.push(i),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let i=e.nodes[s.node];return i.contentMatch.matchType(i)})}parse(e,n={}){let r=new O_(this,n,!1);return r.addAll(e,Bn.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new O_(this,n,!0);return r.addAll(e,Bn.none,n.from,n.to),qt.maxOpen(r.finish())}matchTag(e,n,r){for(let s=r?this.tags.indexOf(r)+1:0;s<this.tags.length;s++){let i=this.tags[s];if(lH(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||n.matchesContext(i.context))){if(i.getAttrs){let o=i.getAttrs(e);if(o===!1)continue;i.attrs=o||void 0}return i}}}matchStyle(e,n,r,s){for(let i=s?this.styles.indexOf(s)+1:0;i<this.styles.length;i++){let o=this.styles[i],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(s){let i=s.priority==null?50:s.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<i)break}n.splice(o,0,s)}for(let s in e.marks){let i=e.marks[s].spec.parseDOM;i&&i.forEach(o=>{r(o=P_(o)),o.mark||o.ignore||o.clearMark||(o.mark=s)})}for(let s in e.nodes){let i=e.nodes[s].spec.parseDOM;i&&i.forEach(o=>{r(o=P_(o)),o.node||o.ignore||o.mark||(o.node=s)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new La(e,La.schemaRules(e)))}}const tA={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},oH={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},nA={ol:!0,ul:!0},Nf=1,O1=2,Rd=4;function R_(t,e,n){return e!=null?(e?Nf:0)|(e==="full"?O1:0):t&&t.whitespace=="pre"?Nf|O1:n&~Rd}class Lh{constructor(e,n,r,s,i,o){this.type=e,this.attrs=n,this.marks=r,this.solid=s,this.options=o,this.content=[],this.activeMarks=Bn.none,this.match=i||(o&Rd?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(Nt.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,s;return(s=r.findWrapping(e.type))?(this.match=r,s):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Nf)){let r=this.content[this.content.length-1],s;if(r&&r.isText&&(s=/[ \t\r\n\u000c]+$/.exec(r.text))){let i=r;r.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-s[0].length))}}let n=Nt.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(Nt.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!tA.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class O_{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let s=n.topNode,i,o=R_(null,n.preserveWhitespace,0)|(r?Rd:0);s?i=new Lh(s.type,s.attrs,Bn.none,!0,n.topMatch||s.type.contentMatch,o):r?i=new Lh(null,null,Bn.none,!0,null,o):i=new Lh(e.schema.topNodeType,null,Bn.none,!0,null,o),this.nodes=[i],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,s=this.top,i=s.options&O1?"full":this.localPreserveWS||(s.options&Nf)>0,{schema:o}=this.parser;if(i==="full"||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(i)if(i==="full")r=r.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=r.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),n,!0),a[l]&&this.insertNode(o.text(a[l]),n,!/\S/.test(a[l]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let a=s.content[s.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(o.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let s=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;nA.hasOwnProperty(o)&&this.parser.normalizeLists&&aH(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:oH.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let u,d=this.needsBlock;if(tA.hasOwnProperty(o))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),u=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let f=l&&l.skip?n:this.readStyles(e,n);f&&this.addAll(e,f),u&&this.sync(i),this.needsBlock=d}else{let u=this.readStyles(e,n);u&&this.addElementByRule(e,l,u,l.consuming===!1?a:void 0)}this.localPreserveWS=s}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let i=this.parser.matchedStyles[s],o=r.getPropertyValue(i);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(i,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(u=>!l.clearMark(u)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,s){let i,o;if(n.node)if(o=this.parser.schema.nodes[n.node],o.isLeaf)this.insertNode(o.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,n.attrs||null,r,n.preserveWhitespace);l&&(i=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(s)this.addElement(e,r,s);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}i&&this.sync(a)&&this.open--}addAll(e,n,r,s){let i=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=s==null?null:e.childNodes[s];o!=a;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o,n);this.findAtPoint(e,i)}findPlace(e,n,r){let s,i;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],u=l.findWrapping(e);if(u&&(!s||s.length>u.length+a)&&(s=u,i=l,!u.length))break;if(l.solid){if(r)break;a+=2}}if(!s)return null;this.sync(i);for(let o=0;o<s.length;o++)n=this.enterInner(s[o],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(n=this.enterInner(i,null,n))}let s=this.findPlace(e,n,r);if(s){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let o=Bn.none;for(let a of s.concat(e.marks))(i.type?i.type.allowsMarkType(a.type):L_(a.type,e.type))&&(o=a.addToSet(o));return i.content.push(e.mark(o)),!0}return!1}enter(e,n,r,s){let i=this.findPlace(e.create(n),r,!1);return i&&(i=this.enterInner(e,n,r,!0,s)),i}enterInner(e,n,r,s=!1,i){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=R_(e,i,o.options);o.options&Rd&&o.content.length==0&&(a|=Rd);let l=Bn.none;return r=r.filter(u=>(o.type?o.type.allowsMarkType(u.type):L_(u.type,e))?(l=u.addToSet(l),!1):!0),this.nodes.push(new Lh(e,n,l,s,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=Nf)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let s=r.length-1;s>=0;s--)e+=r[s].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&e.nodeType==1&&e.contains(this.find[s].node)&&n.compareDocumentPosition(this.find[s].node)&(r?2:4)&&(this.find[s].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,s=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(s?0:1),o=(a,l)=>{for(;a>=0;a--){let u=n[a];if(u==""){if(a==n.length-1||a==0)continue;for(;l>=i;l--)if(o(a-1,l))return!0;return!1}else{let d=l>0||l==0&&s?this.nodes[l].type:r&&l>=i?r.node(l-i).type:null;if(!d||d.name!=u&&!d.isInGroup(u))return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function aH(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&nA.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function lH(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function P_(t){let e={};for(let n in t)e[n]=t[n];return e}function L_(t,e){let n=e.schema.nodes;for(let r in n){let s=n[r];if(!s.allowsMarkType(t))continue;let i=[],o=a=>{i.push(a);for(let l=0;l<a.edgeCount;l++){let{type:u,next:d}=a.edge(l);if(u==e||i.indexOf(d)<0&&o(d))return!0}};if(o(s.contentMatch))return!0}}class sc{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=ay(n).createDocumentFragment());let s=r,i=[];return e.forEach(o=>{if(i.length||o.marks.length){let a=0,l=0;for(;a<i.length&&l<o.marks.length;){let u=o.marks[l];if(!this.marks[u.type.name]){l++;continue}if(!u.eq(i[a][0])||u.type.spec.spanning===!1)break;a++,l++}for(;a<i.length;)s=i.pop()[1];for(;l<o.marks.length;){let u=o.marks[l++],d=this.serializeMark(u,o.isInline,n);d&&(i.push([u,s]),s.appendChild(d.dom),s=d.contentDOM||d.dom)}}s.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:s}=Sp(ay(n),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,s)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let s=e.marks.length-1;s>=0;s--){let i=this.serializeMark(e.marks[s],e.isInline,n);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(e,n,r={}){let s=this.marks[e.type.name];return s&&Sp(ay(r),s(e,n),null,e.attrs)}static renderSpec(e,n,r=null,s){return Sp(e,n,r,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new sc(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=$_(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return $_(e.marks)}}function $_(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function ay(t){return t.document||window.document}const z_=new WeakMap;function cH(t){let e=z_.get(t);return e===void 0&&z_.set(t,e=uH(t)),e}function uH(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let s=0;s<r.length;s++)n(r[s]);else for(let s in r)n(r[s])}return n(t),e}function Sp(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let s=e[0],i;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(i=cH(r))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=s.indexOf(" ");o>0&&(n=s.slice(0,o),s=s.slice(o+1));let a,l=n?t.createElementNS(n,s):t.createElement(s),u=e[1],d=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){d=2;for(let f in u)if(u[f]!=null){let h=f.indexOf(" ");h>0?l.setAttributeNS(f.slice(0,h),f.slice(h+1),u[f]):f=="style"&&l.style?l.style.cssText=u[f]:l.setAttribute(f,u[f])}}for(let f=d;f<e.length;f++){let h=e[f];if(h===0){if(f<e.length-1||f>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:p,contentDOM:m}=Sp(t,h,n,r);if(l.appendChild(p),m){if(a)throw new RangeError("Multiple content holes");a=m}}}return{dom:l,contentDOM:a}}const rA=65535,sA=Math.pow(2,16);function dH(t,e){return t+e*sA}function F_(t){return t&rA}function fH(t){return(t-(t&rA))/sA}const iA=1,oA=2,_p=4,aA=8;class P1{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&aA)>0}get deletedBefore(){return(this.delInfo&(iA|_p))>0}get deletedAfter(){return(this.delInfo&(oA|_p))>0}get deletedAcross(){return(this.delInfo&_p)>0}}class ti{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&ti.empty)return ti.empty}recover(e){let n=0,r=F_(e);if(!this.inverted)for(let s=0;s<r;s++)n+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[r*3]+n+fH(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let s=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?s:0);if(l>e)break;let u=this.ranges[a+i],d=this.ranges[a+o],f=l+u;if(e<=f){let h=u?e==l?-1:e==f?1:n:n,p=l+s+(h<0?0:d);if(r)return p;let m=e==(n<0?l:f)?null:dH(a/3,e-l),y=e==l?oA:e==f?iA:_p;return(n<0?e!=l:e!=f)&&(y|=aA),new P1(p,y,m)}s+=d-u}return r?e+s:new P1(e+s,0,null)}touches(e,n){let r=0,s=F_(n),i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let u=this.ranges[a+i],d=l+u;if(e<=d&&a==s*3)return!0;r+=this.ranges[a+o]-u}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let s=0,i=0;s<this.ranges.length;s+=3){let o=this.ranges[s],a=o-(this.inverted?i:0),l=o+(this.inverted?0:i),u=this.ranges[s+n],d=this.ranges[s+r];e(a,a+u,l,l+d),i+=d-u}}invert(){return new ti(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?ti.empty:new ti(e<0?[0,-e,0]:[0,0,e])}}ti.empty=new ti([]);class jf{constructor(e,n,r=0,s=e?e.length:0){this.mirror=n,this.from=r,this.to=s,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new jf(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let s=e.getMirror(n);this.appendMap(e._maps[n],s!=null&&s<n?r+s:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let s=e.getMirror(n);this.appendMap(e._maps[n].invert(),s!=null&&s>n?r-s-1:void 0)}}invert(){let e=new jf;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let s=0;for(let i=this.from;i<this.to;i++){let o=this._maps[i],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(i);if(l!=null&&l>i&&l<this.to){i=l,e=this._maps[l].recover(a.recover);continue}}s|=a.delInfo,e=a.pos}return r?e:new P1(e,s,null)}}const ly=Object.create(null);class ws{getMap(){return ti.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=ly[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in ly)throw new RangeError("Duplicate use of step JSON ID "+e);return ly[e]=n,n.prototype.jsonID=e,n}}class Ir{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new Ir(e,null)}static fail(e){return new Ir(null,e)}static fromReplace(e,n,r,s){try{return Ir.ok(e.replace(n,r,s))}catch(i){if(i instanceof bm)return Ir.fail(i.message);throw i}}}function hv(t,e,n){let r=[];for(let s=0;s<t.childCount;s++){let i=t.child(s);i.content.size&&(i=i.copy(hv(i.content,e,i))),i.isInline&&(i=e(i,n,s)),r.push(i)}return Nt.fromArray(r)}class Ta extends ws{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),s=r.node(r.sharedDepth(this.to)),i=new qt(hv(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),s),n.openStart,n.openEnd);return Ir.fromReplace(e,this.from,this.to,i)}invert(){return new yo(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Ta(n.pos,r.pos,this.mark)}merge(e){return e instanceof Ta&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ta(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Ta(n.from,n.to,e.markFromJSON(n.mark))}}ws.jsonID("addMark",Ta);class yo extends ws{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new qt(hv(n.content,s=>s.mark(this.mark.removeFromSet(s.marks)),e),n.openStart,n.openEnd);return Ir.fromReplace(e,this.from,this.to,r)}invert(){return new Ta(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new yo(n.pos,r.pos,this.mark)}merge(e){return e instanceof yo&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new yo(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new yo(n.from,n.to,e.markFromJSON(n.mark))}}ws.jsonID("removeMark",yo);class Ca extends ws{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return Ir.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return Ir.fromReplace(e,this.pos,this.pos+1,new qt(Nt.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let s=0;s<n.marks.length;s++)if(!n.marks[s].isInSet(r))return new Ca(this.pos,n.marks[s]);return new Ca(this.pos,this.mark)}}return new Xl(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Ca(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Ca(n.pos,e.markFromJSON(n.mark))}}ws.jsonID("addNodeMark",Ca);class Xl extends ws{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return Ir.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return Ir.fromReplace(e,this.pos,this.pos+1,new qt(Nt.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new Ca(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Xl(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Xl(n.pos,e.markFromJSON(n.mark))}}ws.jsonID("removeNodeMark",Xl);class Fr extends ws{constructor(e,n,r,s=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=s}apply(e){return this.structure&&L1(e,this.from,this.to)?Ir.fail("Structure replace would overwrite content"):Ir.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new ti([this.from,this.to-this.from,this.slice.size])}invert(e){return new Fr(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new Fr(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof Fr)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?qt.empty:new qt(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Fr(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?qt.empty:new qt(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Fr(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Fr(n.from,n.to,qt.fromJSON(e,n.slice),!!n.structure)}}ws.jsonID("replace",Fr);class Hr extends ws{constructor(e,n,r,s,i,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=s,this.slice=i,this.insert=o,this.structure=a}apply(e){if(this.structure&&(L1(e,this.from,this.gapFrom)||L1(e,this.gapTo,this.to)))return Ir.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return Ir.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?Ir.fromReplace(e,this.from,this.to,r):Ir.fail("Content does not fit in gap")}getMap(){return new ti([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new Hr(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),s=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||s<n.pos||i>r.pos?null:new Hr(n.pos,r.pos,s,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Hr(n.from,n.to,n.gapFrom,n.gapTo,qt.fromJSON(e,n.slice),n.insert,!!n.structure)}}ws.jsonID("replaceAround",Hr);function L1(t,e,n){let r=t.resolve(e),s=n-e,i=r.depth;for(;s>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,s--;if(s>0){let o=r.node(i).maybeChild(r.indexAfter(i));for(;s>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,s--}}return!1}function hH(t,e,n,r){let s=[],i=[],o,a;t.doc.nodesBetween(e,n,(l,u,d)=>{if(!l.isInline)return;let f=l.marks;if(!r.isInSet(f)&&d.type.allowsMarkType(r.type)){let h=Math.max(u,e),p=Math.min(u+l.nodeSize,n),m=r.addToSet(f);for(let y=0;y<f.length;y++)f[y].isInSet(m)||(o&&o.to==h&&o.mark.eq(f[y])?o.to=p:s.push(o=new yo(h,p,f[y])));a&&a.to==h?a.to=p:i.push(a=new Ta(h,p,r))}}),s.forEach(l=>t.step(l)),i.forEach(l=>t.step(l))}function pH(t,e,n,r){let s=[],i=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;i++;let l=null;if(r instanceof $g){let u=o.marks,d;for(;d=r.isInSet(u);)(l||(l=[])).push(d),u=d.removeFromSet(u)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let u=Math.min(a+o.nodeSize,n);for(let d=0;d<l.length;d++){let f=l[d],h;for(let p=0;p<s.length;p++){let m=s[p];m.step==i-1&&f.eq(s[p].style)&&(h=m)}h?(h.to=u,h.step=i):s.push({style:f,from:Math.max(a,e),to:u,step:i})}}}),s.forEach(o=>t.step(new yo(o.from,o.to,o.style)))}function pv(t,e,n,r=n.contentMatch,s=!0){let i=t.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<i.childCount;l++){let u=i.child(l),d=a+u.nodeSize,f=r.matchType(u.type);if(!f)o.push(new Fr(a,d,qt.empty));else{r=f;for(let h=0;h<u.marks.length;h++)n.allowsMarkType(u.marks[h].type)||t.step(new yo(a,d,u.marks[h]));if(s&&u.isText&&n.whitespace!="pre"){let h,p=/\r?\n|\r/g,m;for(;h=p.exec(u.text);)m||(m=new qt(Nt.from(n.schema.text(" ",n.allowedMarks(u.marks))),0,0)),o.push(new Fr(a+h.index,a+h.index+h[0].length,m))}}a=d}if(!r.validEnd){let l=r.fillBefore(Nt.empty,!0);t.replace(a,a,new qt(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function mH(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function zu(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth,s=0,i=0;;--r){let o=t.$from.node(r),a=t.$from.index(r)+s,l=t.$to.indexAfter(r)-i;if(r<t.depth&&o.canReplace(a,l,n))return r;if(r==0||o.type.spec.isolating||!mH(o,a,l))break;a&&(s=1),l<o.childCount&&(i=1)}return null}function gH(t,e,n){let{$from:r,$to:s,depth:i}=e,o=r.before(i+1),a=s.after(i+1),l=o,u=a,d=Nt.empty,f=0;for(let m=i,y=!1;m>n;m--)y||r.index(m)>0?(y=!0,d=Nt.from(r.node(m).copy(d)),f++):l--;let h=Nt.empty,p=0;for(let m=i,y=!1;m>n;m--)y||s.after(m+1)<s.end(m)?(y=!0,h=Nt.from(s.node(m).copy(h)),p++):u++;t.step(new Hr(l,u,o,a,new qt(d.append(h),f,p),d.size-f,!0))}function mv(t,e,n=null,r=t){let s=yH(t,e),i=s&&xH(r,e);return i?s.map(B_).concat({type:e,attrs:n}).concat(i.map(B_)):null}function B_(t){return{type:t,attrs:null}}function yH(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.contentMatchAt(r).findWrapping(e);if(!i)return null;let o=i.length?i[0]:e;return n.canReplaceWith(r,s,o)?i:null}function xH(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.child(r),o=e.contentMatch.findWrapping(i.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let u=r;l&&u<s;u++)l=l.matchType(n.child(u).type);return!l||!l.validEnd?null:o}function bH(t,e,n){let r=Nt.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let a=n[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=Nt.from(n[o].type.create(n[o].attrs,r))}let s=e.start,i=e.end;t.step(new Hr(s,i,s,i,new qt(r,0,0),n.length,!0))}function wH(t,e,n,r,s){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{let l=typeof s=="function"?s(o):s;if(o.isTextblock&&!o.hasMarkup(r,l)&&vH(t.doc,t.mapping.slice(i).map(a),r)){let u=null;if(r.schema.linebreakReplacement){let p=r.whitespace=="pre",m=!!r.contentMatch.matchType(r.schema.linebreakReplacement);p&&!m?u=!1:!p&&m&&(u=!0)}u===!1&&cA(t,o,a,i),pv(t,t.mapping.slice(i).map(a,1),r,void 0,u===null);let d=t.mapping.slice(i),f=d.map(a,1),h=d.map(a+o.nodeSize,1);return t.step(new Hr(f,h,f+1,h-1,new qt(Nt.from(r.create(l,null,o.marks)),0,0),1,!0)),u===!0&&lA(t,o,a,i),!1}})}function lA(t,e,n,r){e.forEach((s,i)=>{if(s.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(s.text);){let l=t.mapping.slice(r).map(n+1+i+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function cA(t,e,n,r){e.forEach((s,i)=>{if(s.type==s.type.schema.linebreakReplacement){let o=t.mapping.slice(r).map(n+1+i);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function vH(t,e,n){let r=t.resolve(e),s=r.index();return r.parent.canReplaceWith(s,s+1,n)}function kH(t,e,n,r,s){let i=t.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let o=n.create(r,null,s||i.marks);if(i.isLeaf)return t.replaceWith(e,e+i.nodeSize,o);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new Hr(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new qt(Nt.from(o),0,0),1,!0))}function lu(t,e,n=1,r){let s=t.resolve(e),i=s.depth-n,o=r&&r[r.length-1]||s.parent;if(i<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!o.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let u=s.depth-1,d=n-2;u>i;u--,d--){let f=s.node(u),h=s.index(u);if(f.type.spec.isolating)return!1;let p=f.content.cutByIndex(h,f.childCount),m=r&&r[d+1];m&&(p=p.replaceChild(0,m.type.create(m.attrs)));let y=r&&r[d]||f;if(!f.canReplace(h+1,f.childCount)||!y.type.validContent(p))return!1}let a=s.indexAfter(i),l=r&&r[0];return s.node(i).canReplaceWith(a,a,l?l.type:s.node(i+1).type)}function SH(t,e,n=1,r){let s=t.doc.resolve(e),i=Nt.empty,o=Nt.empty;for(let a=s.depth,l=s.depth-n,u=n-1;a>l;a--,u--){i=Nt.from(s.node(a).copy(i));let d=r&&r[u];o=Nt.from(d?d.type.create(d.attrs,o):s.node(a).copy(o))}t.step(new Fr(e,e,new qt(i.append(o),n,n),!0))}function el(t,e){let n=t.resolve(e),r=n.index();return uA(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function _H(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let s=0;s<e.childCount;s++){let i=e.child(s),o=i.type==r?t.type.schema.nodes.text:i.type;if(n=n.matchType(o),!n||!t.type.allowsMarks(i.marks))return!1}return n.validEnd}function uA(t,e){return!!(t&&e&&!t.isLeaf&&_H(t,e))}function zg(t,e,n=-1){let r=t.resolve(e);for(let s=r.depth;;s--){let i,o,a=r.index(s);if(s==r.depth?(i=r.nodeBefore,o=r.nodeAfter):n>0?(i=r.node(s+1),a++,o=r.node(s).maybeChild(a)):(i=r.node(s).maybeChild(a-1),o=r.node(s+1)),i&&!i.isTextblock&&uA(i,o)&&r.node(s).canReplace(a,a+1))return e;if(s==0)break;e=n<0?r.before(s):r.after(s)}}function TH(t,e,n){let r=null,{linebreakReplacement:s}=t.doc.type.schema,i=t.doc.resolve(e-n),o=i.node().type;if(s&&o.inlineContent){let d=o.whitespace=="pre",f=!!o.contentMatch.matchType(s);d&&!f?r=!1:!d&&f&&(r=!0)}let a=t.steps.length;if(r===!1){let d=t.doc.resolve(e+n);cA(t,d.node(),d.before(),a)}o.inlineContent&&pv(t,e+n-1,o,i.node().contentMatchAt(i.index()),r==null);let l=t.mapping.slice(a),u=l.map(e-n);if(t.step(new Fr(u,l.map(e+n,-1),qt.empty,!0)),r===!0){let d=t.doc.resolve(u);lA(t,d.node(),d.before(),t.steps.length)}return t}function CH(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let s=r.depth-1;s>=0;s--){let i=r.index(s);if(r.node(s).canReplaceWith(i,i,n))return r.before(s+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(let s=r.depth-1;s>=0;s--){let i=r.indexAfter(s);if(r.node(s).canReplaceWith(i,i,n))return r.after(s+1);if(i<r.node(s).childCount)return null}return null}function dA(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let s=n.content;for(let i=0;i<n.openStart;i++)s=s.firstChild.content;for(let i=1;i<=(n.openStart==0&&n.size?2:1);i++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),u=r.node(o),d=!1;if(i==1)d=u.canReplace(l,l,s);else{let f=u.contentMatchAt(l).findWrapping(s.firstChild.type);d=f&&u.canReplaceWith(l,l,f[0])}if(d)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function Fg(t,e,n=e,r=qt.empty){if(e==n&&!r.size)return null;let s=t.resolve(e),i=t.resolve(n);return fA(s,i,r)?new Fr(e,n,r):new EH(s,i,r).fit()}function fA(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class EH{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=Nt.empty;for(let s=0;s<=e.depth;s++){let i=e.node(s);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=Nt.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,s=this.close(e<0?this.$to:r.doc.resolve(e));if(!s)return null;let i=this.placed,o=r.depth,a=s.depth;for(;o&&a&&i.childCount==1;)i=i.firstChild.content,o--,a--;let l=new qt(i,o,a);return e>-1?new Hr(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new Fr(r.pos,s.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,s=this.unplaced.openEnd;r<e;r++){let i=n.firstChild;if(n.childCount>1&&(s=0),i.type.spec.isolating&&s<=r){e=r;break}n=i.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let s,i=null;r?(i=cy(this.unplaced.content,r-1).firstChild,s=i.content):s=this.unplaced.content;let o=s.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:u}=this.frontier[a],d,f=null;if(n==1&&(o?u.matchType(o.type)||(f=u.fillBefore(Nt.from(o),!1)):i&&l.compatibleContent(i.type)))return{sliceDepth:r,frontierDepth:a,parent:i,inject:f};if(n==2&&o&&(d=u.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:i,wrap:d};if(i&&u.matchType(i.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=cy(e,n);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new qt(e,n+1,Math.max(r,s.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=cy(e,n);if(s.childCount<=1&&n>0){let i=e.size-n<=n+s.size;this.unplaced=new qt(pd(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new qt(pd(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:s,wrap:i}){for(;this.depth>n;)this.closeFrontierNode();if(i)for(let y=0;y<i.length;y++)this.openFrontierNode(i[y]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,u=0,d=[],{match:f,type:h}=this.frontier[n];if(s){for(let y=0;y<s.childCount;y++)d.push(s.child(y));f=f.matchFragment(s)}let p=a.size+e-(o.content.size-o.openEnd);for(;u<a.childCount;){let y=a.child(u),b=f.matchType(y.type);if(!b)break;u++,(u>1||l==0||y.content.size)&&(f=b,d.push(hA(y.mark(h.allowedMarks(y.marks)),u==1?l:0,u==a.childCount?p:-1)))}let m=u==a.childCount;m||(p=-1),this.placed=md(this.placed,n,Nt.from(d)),this.frontier[n].match=f,m&&p<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let y=0,b=a;y<p;y++){let g=b.lastChild;this.frontier.push({type:g.type,match:g.contentMatchAt(g.childCount)}),b=g.content}this.unplaced=m?e==0?qt.empty:new qt(pd(o.content,e-1,1),e-1,p<0?o.openEnd:e-1):new qt(pd(o.content,e,u),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!uy(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,s=this.$to.after(r);for(;r>1&&s==this.$to.end(--r);)++s;return s}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:s}=this.frontier[n],i=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=uy(e,n,s,r,i);if(o){for(let a=n-1;a>=0;a--){let{match:l,type:u}=this.frontier[a],d=uy(e,a,u,l,!0);if(!d||d.childCount)continue e}return{depth:n,fit:o,move:i?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=md(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let s=e.node(r),i=s.type.contentMatch.fillBefore(s.content,!0,e.index(r));this.openFrontierNode(s.type,s.attrs,i)}return e}openFrontierNode(e,n=null,r){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=md(this.placed,this.depth,Nt.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(Nt.empty,!0);n.childCount&&(this.placed=md(this.placed,this.frontier.length,n))}}function pd(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(pd(t.firstChild.content,e-1,n)))}function md(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(md(t.lastChild.content,e-1,n)))}function cy(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function hA(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,hA(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(Nt.empty,!0)))),t.copy(r)}function uy(t,e,n,r,s){let i=t.node(e),o=s?t.indexAfter(e):t.index(e);if(o==i.childCount&&!n.compatibleContent(i.type))return null;let a=r.fillBefore(i.content,!0,o);return a&&!NH(n,i.content,o)?a:null}function NH(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function jH(t){return t.spec.defining||t.spec.definingForContent}function IH(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let s=t.doc.resolve(e),i=t.doc.resolve(n);if(fA(s,i,r))return t.step(new Fr(e,n,r));let o=mA(s,i);o[o.length-1]==0&&o.pop();let a=-(s.depth+1);o.unshift(a);for(let h=s.depth,p=s.pos-1;h>0;h--,p--){let m=s.node(h).type.spec;if(m.defining||m.definingAsContext||m.isolating)break;o.indexOf(h)>-1?a=h:s.before(h)==p&&o.splice(1,0,-h)}let l=o.indexOf(a),u=[],d=r.openStart;for(let h=r.content,p=0;;p++){let m=h.firstChild;if(u.push(m),p==r.openStart)break;h=m.content}for(let h=d-1;h>=0;h--){let p=u[h],m=jH(p.type);if(m&&!p.sameMarkup(s.node(Math.abs(a)-1)))d=h;else if(m||!p.type.isTextblock)break}for(let h=r.openStart;h>=0;h--){let p=(h+d+1)%(r.openStart+1),m=u[p];if(m)for(let y=0;y<o.length;y++){let b=o[(y+l)%o.length],g=!0;b<0&&(g=!1,b=-b);let v=s.node(b-1),w=s.index(b-1);if(v.canReplaceWith(w,w,m.type,m.marks))return t.replace(s.before(b),g?i.after(b):n,new qt(pA(r.content,0,r.openStart,p),p,r.openEnd))}}let f=t.steps.length;for(let h=o.length-1;h>=0&&(t.replace(e,n,r),!(t.steps.length>f));h--){let p=o[h];p<0||(e=s.before(p),n=i.after(p))}}function pA(t,e,n,r,s){if(e<n){let i=t.firstChild;t=t.replaceChild(0,i.copy(pA(i.content,e+1,n,r,i)))}if(e>r){let i=s.contentMatchAt(0),o=i.fillBefore(t).append(t);t=o.append(i.matchFragment(o).fillBefore(Nt.empty,!0))}return t}function MH(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let s=CH(t.doc,e,r.type);s!=null&&(e=n=s)}t.replaceRange(e,n,new qt(Nt.from(r),0,0))}function DH(t,e,n){let r=t.doc.resolve(e),s=t.doc.resolve(n),i=mA(r,s);for(let o=0;o<i.length;o++){let a=i[o],l=o==i.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),s.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),s.indexAfter(a-1))))return t.delete(r.before(a),s.after(a))}for(let o=1;o<=r.depth&&o<=s.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&s.end(o)-n!=s.depth-o&&r.start(o-1)==s.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),s.index(o-1)))return t.delete(r.before(o),n);t.delete(e,n)}function mA(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let s=r;s>=0;s--){let i=t.start(s);if(i<t.pos-(t.depth-s)||e.end(s)>e.pos+(e.depth-s)||t.node(s).type.spec.isolating||e.node(s).type.spec.isolating)break;(i==e.start(s)||s==t.depth&&s==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&s&&e.start(s-1)==i-1)&&n.push(s)}return n}class cu extends ws{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return Ir.fail("No node at attribute step's position");let r=Object.create(null);for(let i in n.attrs)r[i]=n.attrs[i];r[this.attr]=this.value;let s=n.type.create(r,null,n.marks);return Ir.fromReplace(e,this.pos,this.pos+1,new qt(Nt.from(s),0,n.isLeaf?0:1))}getMap(){return ti.empty}invert(e){return new cu(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new cu(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new cu(n.pos,n.attr,n.value)}}ws.jsonID("attr",cu);class If extends ws{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let s in e.attrs)n[s]=e.attrs[s];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return Ir.ok(r)}getMap(){return ti.empty}invert(e){return new If(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new If(n.attr,n.value)}}ws.jsonID("docAttr",If);let Su=class extends Error{};Su=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};Su.prototype=Object.create(Error.prototype);Su.prototype.constructor=Su;Su.prototype.name="TransformError";class gA{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new jf}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new Su(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=qt.empty){let s=Fg(this.doc,e,n,r);return s&&this.step(s),this}replaceWith(e,n,r){return this.replace(e,n,new qt(Nt.from(r),0,0))}delete(e,n){return this.replace(e,n,qt.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return IH(this,e,n,r),this}replaceRangeWith(e,n,r){return MH(this,e,n,r),this}deleteRange(e,n){return DH(this,e,n),this}lift(e,n){return gH(this,e,n),this}join(e,n=1){return TH(this,e,n),this}wrap(e,n){return bH(this,e,n),this}setBlockType(e,n=e,r,s=null){return wH(this,e,n,r,s),this}setNodeMarkup(e,n,r=null,s){return kH(this,e,n,r,s),this}setNodeAttribute(e,n,r){return this.step(new cu(e,n,r)),this}setDocAttribute(e,n){return this.step(new If(e,n)),this}addNodeMark(e,n){return this.step(new Ca(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof Bn)n.isInSet(r.marks)&&this.step(new Xl(e,n));else{let s=r.marks,i,o=[];for(;i=n.isInSet(s);)o.push(new Xl(e,i)),s=i.removeFromSet(s);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,n=1,r){return SH(this,e,n,r),this}addMark(e,n,r){return hH(this,e,n,r),this}removeMark(e,n,r){return pH(this,e,n,r),this}clearIncompatible(e,n,r){return pv(this,e,n,r),this}}const dy=Object.create(null);class bn{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new AH(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=qt.empty){let r=n.content.lastChild,s=null;for(let a=0;a<n.openEnd;a++)s=r,r=r.lastChild;let i=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:u}=o[a],d=e.mapping.slice(i);e.replaceRange(d.map(l.pos),d.map(u.pos),a?qt.empty:n),a==0&&V_(e,i,(r?r.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){let{$from:o,$to:a}=s[i],l=e.mapping.slice(r),u=l.map(o.pos),d=l.map(a.pos);i?e.deleteRange(u,d):(e.replaceRangeWith(u,d,n),V_(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let s=e.parent.inlineContent?new mn(e):Ec(e.node(0),e.parent,e.pos,e.index(),n,r);if(s)return s;for(let i=e.depth-1;i>=0;i--){let o=n<0?Ec(e.node(0),e.node(i),e.before(i+1),e.index(i),n,r):Ec(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new ji(e.node(0))}static atStart(e){return Ec(e,e,0,0,1)||new ji(e)}static atEnd(e){return Ec(e,e,e.content.size,e.childCount,-1)||new ji(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=dy[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in dy)throw new RangeError("Duplicate use of selection JSON ID "+e);return dy[e]=n,n.prototype.jsonID=e,n}getBookmark(){return mn.between(this.$anchor,this.$head).getBookmark()}}bn.prototype.visible=!0;class AH{constructor(e,n){this.$from=e,this.$to=n}}let U_=!1;function H_(t){!U_&&!t.parent.inlineContent&&(U_=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class mn extends bn{constructor(e,n=e){H_(e),H_(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return bn.near(r);let s=e.resolve(n.map(this.anchor));return new mn(s.parent.inlineContent?s:r,r)}replace(e,n=qt.empty){if(super.replace(e,n),n==qt.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof mn&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Bg(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new mn(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let s=e.resolve(n);return new this(s,r==n?s:e.resolve(r))}static between(e,n,r){let s=e.pos-n.pos;if((!r||s)&&(r=s>=0?1:-1),!n.parent.inlineContent){let i=bn.findFrom(n,r,!0)||bn.findFrom(n,-r,!0);if(i)n=i.$head;else return bn.near(n,r)}return e.parent.inlineContent||(s==0?e=n:(e=(bn.findFrom(e,-r,!0)||bn.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=s<0&&(e=n))),new mn(e,n)}}bn.jsonID("text",mn);class Bg{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Bg(e.map(this.anchor),e.map(this.head))}resolve(e){return mn.between(e.resolve(this.anchor),e.resolve(this.head))}}class tn extends bn{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:s}=n.mapResult(this.anchor),i=e.resolve(s);return r?bn.near(i):new tn(i)}content(){return new qt(Nt.from(this.node),0,0)}eq(e){return e instanceof tn&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new gv(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new tn(e.resolve(n.anchor))}static create(e,n){return new tn(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}tn.prototype.visible=!1;bn.jsonID("node",tn);class gv{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new Bg(r,r):new gv(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&tn.isSelectable(r)?new tn(n):bn.near(n)}}class ji extends bn{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=qt.empty){if(n==qt.empty){e.delete(0,e.doc.content.size);let r=bn.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new ji(e)}map(e){return new ji(e)}eq(e){return e instanceof ji}getBookmark(){return RH}}bn.jsonID("all",ji);const RH={map(){return this},resolve(t){return new ji(t)}};function Ec(t,e,n,r,s,i=!1){if(e.inlineContent)return mn.create(t,n);for(let o=r-(s>0?0:1);s>0?o<e.childCount:o>=0;o+=s){let a=e.child(o);if(a.isAtom){if(!i&&tn.isSelectable(a))return tn.create(t,n-(s<0?a.nodeSize:0))}else{let l=Ec(t,a,n+s,s<0?a.childCount:0,s,i);if(l)return l}n+=a.nodeSize*s}return null}function V_(t,e,n){let r=t.steps.length-1;if(r<e)return;let s=t.steps[r];if(!(s instanceof Fr||s instanceof Hr))return;let i=t.mapping.maps[r],o;i.forEach((a,l,u,d)=>{o==null&&(o=d)}),t.setSelection(bn.near(t.doc.resolve(o),n))}const W_=1,$h=2,K_=4;class OH extends gA{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|W_)&~$h,this.storedMarks=null,this}get selectionSet(){return(this.updated&W_)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=$h,this}ensureMarks(e){return Bn.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&$h)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~$h,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||Bn.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let s=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(s.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),!e)return this.deleteRange(n,r);let i=this.storedMarks;if(!i){let o=this.doc.resolve(n);i=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,s.text(e,i)),!this.selection.empty&&this.selection.to==n+e.length&&this.setSelection(bn.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=K_,this}get scrolledIntoView(){return(this.updated&K_)>0}}function G_(t,e){return!e||!t?t:t.bind(e)}class gd{constructor(e,n,r){this.name=e,this.init=G_(n.init,r),this.apply=G_(n.apply,r)}}const PH=[new gd("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new gd("selection",{init(t,e){return t.selection||bn.atStart(e.doc)},apply(t){return t.selection}}),new gd("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new gd("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class fy{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=PH.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new gd(r.key,r.spec.state,r))})}}class Jc{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let s=this.config.plugins[r];if(s.spec.filterTransaction&&!s.spec.filterTransaction.call(s,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),s=null;for(;;){let i=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=s?s[o].n:0,u=s?s[o].state:this,d=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,u,r);if(d&&r.filterTransaction(d,o)){if(d.setMeta("appendedTransaction",e),!s){s=[];for(let f=0;f<this.config.plugins.length;f++)s.push(f<o?{state:r,n:n.length}:{state:this,n:0})}n.push(d),r=r.applyInner(d),i=!0}s&&(s[o]={state:r,n:n.length})}}if(!i)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new Jc(this.config),r=this.config.fields;for(let s=0;s<r.length;s++){let i=r[s];n[i.name]=i.apply(e,this[i.name],this,n)}return n}get tr(){return new OH(this)}static create(e){let n=new fy(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new Jc(n);for(let s=0;s<n.fields.length;s++)r[n.fields[s].name]=n.fields[s].init(e,r);return r}reconfigure(e){let n=new fy(this.schema,e.plugins),r=n.fields,s=new Jc(n);for(let i=0;i<r.length;i++){let o=r[i].name;s[o]=this.hasOwnProperty(o)?this[o]:r[i].init(e,s)}return s}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[r],i=s.spec.state;i&&i.toJSON&&(n[r]=i.toJSON.call(s,this[s.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new fy(e.schema,e.plugins),i=new Jc(s);return s.fields.forEach(o=>{if(o.name=="doc")i.doc=Ko.fromJSON(e.schema,n.doc);else if(o.name=="selection")i.selection=bn.fromJSON(i.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(i.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],u=l.spec.state;if(l.key==o.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){i[o.name]=u.fromJSON.call(l,e,n[a],i);return}}i[o.name]=o.init(e,i)}}),i}}function yA(t,e,n){for(let r in t){let s=t[r];s instanceof Function?s=s.bind(e):r=="handleDOMEvents"&&(s=yA(s,e,{})),n[r]=s}return n}class Mr{constructor(e){this.spec=e,this.props={},e.props&&yA(e.props,this,this.props),this.key=e.key?e.key.key:xA("plugin")}getState(e){return e[this.key]}}const hy=Object.create(null);function xA(t){return t in hy?t+"$"+ ++hy[t]:(hy[t]=0,t+"$")}class as{constructor(e="key"){this.key=xA(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const es=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},_u=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let $1=null;const $o=function(t,e,n){let r=$1||($1=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},LH=function(){$1=null},Ql=function(t,e,n,r){return n&&(q_(t,e,n,r,-1)||q_(t,e,n,r,1))},$H=/^(img|br|input|textarea|hr)$/i;function q_(t,e,n,r,s){for(var i;;){if(t==n&&e==r)return!0;if(e==(s<0?0:Si(t))){let o=t.parentNode;if(!o||o.nodeType!=1||nh(t)||$H.test(t.nodeName)||t.contentEditable=="false")return!1;e=es(t)+(s<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(s<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((i=o.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=s;else return!1;else t=o,e=s<0?Si(t):0}else return!1}}function Si(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function zH(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=Si(t)}else if(t.parentNode&&!nh(t))e=es(t),t=t.parentNode;else return null}}function FH(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!nh(t))e=es(t)+1,t=t.parentNode;else return null}}function BH(t,e,n){for(let r=e==0,s=e==Si(t);r||s;){if(t==n)return!0;let i=es(t);if(t=t.parentNode,!t)return!1;r=r&&i==0,s=s&&i==Si(t)}}function nh(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Ug=function(t){return t.focusNode&&Ql(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function vl(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function UH(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function HH(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(Si(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(Si(r.startContainer),r.startOffset)}}}const _o=typeof navigator<"u"?navigator:null,Y_=typeof document<"u"?document:null,tl=_o&&_o.userAgent||"",z1=/Edge\/(\d+)/.exec(tl),bA=/MSIE \d/.exec(tl),F1=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(tl),Ws=!!(bA||F1||z1),$a=bA?document.documentMode:F1?+F1[1]:z1?+z1[1]:0,Ii=!Ws&&/gecko\/(\d+)/i.test(tl);Ii&&+(/Firefox\/(\d+)/.exec(tl)||[0,0])[1];const B1=!Ws&&/Chrome\/(\d+)/.exec(tl),Br=!!B1,wA=B1?+B1[1]:0,bs=!Ws&&!!_o&&/Apple Computer/.test(_o.vendor),Tu=bs&&(/Mobile\/\w+/.test(tl)||!!_o&&_o.maxTouchPoints>2),bi=Tu||(_o?/Mac/.test(_o.platform):!1),vA=_o?/Win/.test(_o.platform):!1,Ho=/Android \d/.test(tl),rh=!!Y_&&"webkitFontSmoothing"in Y_.documentElement.style,VH=rh?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function WH(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function Mo(t,e){return typeof t=="number"?t:t[e]}function KH(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function J_(t,e,n){let r=t.someProp("scrollThreshold")||0,s=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument;for(let o=n||t.dom;o;){if(o.nodeType!=1){o=_u(o);continue}let a=o,l=a==i.body,u=l?WH(i):KH(a),d=0,f=0;if(e.top<u.top+Mo(r,"top")?f=-(u.top-e.top+Mo(s,"top")):e.bottom>u.bottom-Mo(r,"bottom")&&(f=e.bottom-e.top>u.bottom-u.top?e.top+Mo(s,"top")-u.top:e.bottom-u.bottom+Mo(s,"bottom")),e.left<u.left+Mo(r,"left")?d=-(u.left-e.left+Mo(s,"left")):e.right>u.right-Mo(r,"right")&&(d=e.right-u.right+Mo(s,"right")),d||f)if(l)i.defaultView.scrollBy(d,f);else{let p=a.scrollLeft,m=a.scrollTop;f&&(a.scrollTop+=f),d&&(a.scrollLeft+=d);let y=a.scrollLeft-p,b=a.scrollTop-m;e={left:e.left-y,top:e.top-b,right:e.right-y,bottom:e.bottom-b}}let h=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(h))break;o=h=="absolute"?o.offsetParent:_u(o)}}function GH(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,s;for(let i=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(i,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,s=l.top;break}}return{refDOM:r,refTop:s,stack:kA(t.dom)}}function kA(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=_u(r));return e}function qH({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;SA(n,r==0?0:r-e)}function SA(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:s,left:i}=t[n];r.scrollTop!=s+e&&(r.scrollTop=s+e),r.scrollLeft!=i&&(r.scrollLeft=i)}}let yc=null;function YH(t){if(t.setActive)return t.setActive();if(yc)return t.focus(yc);let e=kA(t);t.focus(yc==null?{get preventScroll(){return yc={preventScroll:!0},!0}}:void 0),yc||(yc=!1,SA(e,0))}function _A(t,e){let n,r=2e8,s,i=0,o=e.top,a=e.top,l,u;for(let d=t.firstChild,f=0;d;d=d.nextSibling,f++){let h;if(d.nodeType==1)h=d.getClientRects();else if(d.nodeType==3)h=$o(d).getClientRects();else continue;for(let p=0;p<h.length;p++){let m=h[p];if(m.top<=o&&m.bottom>=a){o=Math.max(m.bottom,o),a=Math.min(m.top,a);let y=m.left>e.left?m.left-e.left:m.right<e.left?e.left-m.right:0;if(y<r){n=d,r=y,s=y&&n.nodeType==3?{left:m.right<e.left?m.right:m.left,top:e.top}:e,d.nodeType==1&&y&&(i=f+(e.left>=(m.left+m.right)/2?1:0));continue}}else m.top>e.top&&!l&&m.left<=e.left&&m.right>=e.left&&(l=d,u={left:Math.max(m.left,Math.min(m.right,e.left)),top:m.top});!n&&(e.left>=m.right&&e.top>=m.top||e.left>=m.left&&e.top>=m.bottom)&&(i=f+1)}}return!n&&l&&(n=l,s=u,r=0),n&&n.nodeType==3?JH(n,s):!n||r&&n.nodeType==1?{node:t,offset:i}:_A(n,s)}function JH(t,e){let n=t.nodeValue.length,r=document.createRange(),s;for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let o=ua(r,1);if(o.top!=o.bottom&&yv(e,o)){s={node:t,offset:i+(e.left>=(o.left+o.right)/2?1:0)};break}}return r.detach(),s||{node:t,offset:0}}function yv(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function XH(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function QH(t,e,n){let{node:r,offset:s}=_A(e,n),i=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();i=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,s,i)}function ZH(t,e,n,r){let s=-1;for(let i=e,o=!1;i!=t.dom;){let a=t.docView.nearestDesc(i,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>r.left||l.top>r.top?s=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(s=a.posAfter),o=!0),!a.contentDOM&&s<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;i=a.dom.parentNode}return s>-1?s:t.docView.posFromDOM(e,n,-1)}function TA(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let s=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),i=s;;){let o=t.childNodes[i];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let u=a[l];if(yv(e,u))return TA(o,e,u)}}if((i=(i+1)%r)==s)break}return t}function eV(t,e){let n=t.dom.ownerDocument,r,s=0,i=HH(n,e.left,e.top);i&&({node:r,offset:s}=i);let o=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),a;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let u=t.dom.getBoundingClientRect();if(!yv(e,u)||(o=TA(t.dom,e,u),!o))return null}if(bs)for(let u=o;r&&u;u=_u(u))u.draggable&&(r=void 0);if(o=XH(o,e),r){if(Ii&&r.nodeType==1&&(s=Math.min(s,r.childNodes.length),s<r.childNodes.length)){let d=r.childNodes[s],f;d.nodeName=="IMG"&&(f=d.getBoundingClientRect()).right<=e.left&&f.bottom>e.top&&s++}let u;rh&&s&&r.nodeType==1&&(u=r.childNodes[s-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&s--,r==t.dom&&s==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(s==0||r.nodeType!=1||r.childNodes[s-1].nodeName!="BR")&&(a=ZH(t,r,s,e))}a==null&&(a=QH(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function X_(t){return t.top<t.bottom||t.left<t.right}function ua(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(X_(r))return r}return Array.prototype.find.call(n,X_)||t.getBoundingClientRect()}const tV=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function CA(t,e,n){let{node:r,offset:s,atom:i}=t.docView.domFromPos(e,n<0?-1:1),o=rh||Ii;if(r.nodeType==3)if(o&&(tV.test(r.nodeValue)||(n<0?!s:s==r.nodeValue.length))){let l=ua($o(r,s,s),n);if(Ii&&s&&/\s/.test(r.nodeValue[s-1])&&s<r.nodeValue.length){let u=ua($o(r,s-1,s-1),-1);if(u.top==l.top){let d=ua($o(r,s,s+1),-1);if(d.top!=l.top)return td(d,d.left<u.left)}}return l}else{let l=s,u=s,d=n<0?1:-1;return n<0&&!s?(u++,d=-1):n>=0&&s==r.nodeValue.length?(l--,d=1):n<0?l--:u++,td(ua($o(r,l,u),d),d<0)}if(!t.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&s&&(n<0||s==Si(r))){let l=r.childNodes[s-1];if(l.nodeType==1)return py(l.getBoundingClientRect(),!1)}if(i==null&&s<Si(r)){let l=r.childNodes[s];if(l.nodeType==1)return py(l.getBoundingClientRect(),!0)}return py(r.getBoundingClientRect(),n>=0)}if(i==null&&s&&(n<0||s==Si(r))){let l=r.childNodes[s-1],u=l.nodeType==3?$o(l,Si(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(u)return td(ua(u,1),!1)}if(i==null&&s<Si(r)){let l=r.childNodes[s];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let u=l?l.nodeType==3?$o(l,0,o?0:1):l.nodeType==1?l:null:null;if(u)return td(ua(u,-1),!0)}return td(ua(r.nodeType==3?$o(r):r,-n),n>=0)}function td(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function py(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function EA(t,e,n){let r=t.state,s=t.root.activeElement;r!=e&&t.updateState(e),s!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),s!=t.dom&&s&&s.focus()}}function nV(t,e,n){let r=e.selection,s=n=="up"?r.$from:r.$to;return EA(t,e,()=>{let{node:i}=t.docView.domFromPos(s.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(i,!0);if(!a)break;if(a.node.isBlock){i=a.contentDOM||a.dom;break}i=a.dom.parentNode}let o=CA(t,s.pos,1);for(let a=i.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=$o(a,0,a.nodeValue.length).getClientRects();else continue;for(let u=0;u<l.length;u++){let d=l[u];if(d.bottom>d.top+1&&(n=="up"?o.top-d.top>(d.bottom-o.top)*2:d.bottom-o.bottom>(o.bottom-d.top)*2))return!1}}return!0})}const rV=/[\u0590-\u08ac]/;function sV(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let s=r.parentOffset,i=!s,o=s==r.parent.content.size,a=t.domSelection();return a?!rV.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?i:o:EA(t,e,()=>{let{focusNode:l,focusOffset:u,anchorNode:d,anchorOffset:f}=t.domSelectionRange(),h=a.caretBidiLevel;a.modify("move",n,"character");let p=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:m,focusOffset:y}=t.domSelectionRange(),b=m&&!p.contains(m.nodeType==1?m:m.parentNode)||l==m&&u==y;try{a.collapse(d,f),l&&(l!=d||u!=f)&&a.extend&&a.extend(l,u)}catch{}return h!=null&&(a.caretBidiLevel=h),b}):r.pos==r.start()||r.pos==r.end()}let Q_=null,Z_=null,eT=!1;function iV(t,e,n){return Q_==e&&Z_==n?eT:(Q_=e,Z_=n,eT=n=="up"||n=="down"?nV(t,e,n):sV(t,e,n))}const Mi=0,tT=1,Ml=2,To=3;class sh{constructor(e,n,r,s){this.parent=e,this.children=n,this.dom=r,this.contentDOM=s,this.dirty=Mi,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let s=this.children[n];if(s==e)return r;r+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let i,o;if(e==this.contentDOM)i=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(o)+o.size:this.posAtStart}else{let i,o;if(e==this.contentDOM)i=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(o):this.posAtEnd}let s;if(e==this.dom&&this.contentDOM)s=n>es(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!1;break}if(i.previousSibling)break}if(s==null&&n==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!0;break}if(i.nextSibling)break}}return s??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,s=e;s;s=s.parentNode){let i=this.getDesc(s),o;if(i&&(!n||i.node))if(r&&(o=i.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return i}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let s=e;s;s=s.parentNode){let i=this.getDesc(s);if(i)return i.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let s=this.children[n],i=r+s.size;if(r==e&&i!=r){for(;!s.border&&s.children.length;)for(let o=0;o<s.children.length;o++){let a=s.children[o];if(a.size){s=a;break}}return s}if(e<i)return s.descAt(e-r-s.border);r=i}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,s=0;for(let i=0;r<this.children.length;r++){let o=this.children[r],a=i+o.size;if(a>e||o instanceof jA){s=e-i;break}i=a}if(s)return this.children[r].domFromPos(s-this.children[r].border,n);for(let i;r&&!(i=this.children[r-1]).size&&i instanceof NA&&i.side>=0;r--);if(n<=0){let i,o=!0;for(;i=r?this.children[r-1]:null,!(!i||i.dom.parentNode==this.contentDOM);r--,o=!1);return i&&n&&o&&!i.border&&!i.domAtom?i.domFromPos(i.size,n):{node:this.contentDOM,offset:i?es(i.dom)+1:0}}else{let i,o=!0;for(;i=r<this.children.length?this.children[r]:null,!(!i||i.dom.parentNode==this.contentDOM);r++,o=!1);return i&&o&&!i.border&&!i.domAtom?i.domFromPos(0,n):{node:this.contentDOM,offset:i?es(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,i=-1;for(let o=r,a=0;;a++){let l=this.children[a],u=o+l.size;if(s==-1&&e<=u){let d=o+l.border;if(e>=d&&n<=u-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,d);e=o;for(let f=a;f>0;f--){let h=this.children[f-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){s=es(h.dom)+1;break}e-=h.size}s==-1&&(s=0)}if(s>-1&&(u>n||a==this.children.length-1)){n=u;for(let d=a+1;d<this.children.length;d++){let f=this.children[d];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(-1)){i=es(f.dom);break}n+=f.size}i==-1&&(i=this.contentDOM.childNodes.length);break}o=u}return{node:this.contentDOM,from:e,to:n,fromOffset:s,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,s=!1){let i=Math.min(e,n),o=Math.max(e,n);for(let p=0,m=0;p<this.children.length;p++){let y=this.children[p],b=m+y.size;if(i>m&&o<b)return y.setSelection(e-m-y.border,n-m-y.border,r,s);m=b}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),u=r.root.getSelection(),d=r.domSelectionRange(),f=!1;if((Ii||bs)&&e==n){let{node:p,offset:m}=a;if(p.nodeType==3){if(f=!!(m&&p.nodeValue[m-1]==`
`),f&&m==p.nodeValue.length)for(let y=p,b;y;y=y.parentNode){if(b=y.nextSibling){b.nodeName=="BR"&&(a=l={node:b.parentNode,offset:es(b)+1});break}let g=y.pmViewDesc;if(g&&g.node&&g.node.isBlock)break}}else{let y=p.childNodes[m-1];f=y&&(y.nodeName=="BR"||y.contentEditable=="false")}}if(Ii&&d.focusNode&&d.focusNode!=l.node&&d.focusNode.nodeType==1){let p=d.focusNode.childNodes[d.focusOffset];p&&p.contentEditable=="false"&&(s=!0)}if(!(s||f&&bs)&&Ql(a.node,a.offset,d.anchorNode,d.anchorOffset)&&Ql(l.node,l.offset,d.focusNode,d.focusOffset))return;let h=!1;if((u.extend||e==n)&&!(f&&Ii)){u.collapse(a.node,a.offset);try{e!=n&&u.extend(l.node,l.offset),h=!0}catch{}}if(!h){if(e>n){let m=a;a=l,l=m}let p=document.createRange();p.setEnd(l.node,l.offset),p.setStart(a.node,a.offset),u.removeAllRanges(),u.addRange(p)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,s=0;s<this.children.length;s++){let i=this.children[s],o=r+i.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let a=r+i.border,l=o-i.border;if(e>=a&&n<=l){this.dirty=e==r||n==o?Ml:tT,e==a&&n==l&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=To:i.markDirty(e-a,n-a);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?Ml:To}r=o}this.dirty=Ml}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?Ml:tT;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class NA extends sh{constructor(e,n,r,s){let i,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!i)return s;if(i.parent)return i.parent.posBeforeChild(i)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,i=this}matchesWidget(e){return this.dirty==Mi&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class oV extends sh{constructor(e,n,r,s){super(e,[],n,null),this.textDOM=r,this.text=s}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class Zl extends sh{constructor(e,n,r,s,i){super(e,[],r,s),this.mark=n,this.spec=i}static create(e,n,r,s){let i=s.nodeViews[n.type.name],o=i&&i(n,s,r);return(!o||!o.dom)&&(o=sc.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new Zl(e,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&To||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=To&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=Mi){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Mi}}slice(e,n,r){let s=Zl.create(this.parent,this.mark,!0,r),i=this.children,o=this.size;n<o&&(i=H1(i,n,o,r)),e>0&&(i=H1(i,0,e,r));for(let a=0;a<i.length;a++)i[a].parent=s;return s.children=i,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class za extends sh{constructor(e,n,r,s,i,o,a,l,u){super(e,[],i,o),this.node=n,this.outerDeco=r,this.innerDeco=s,this.nodeDOM=a}static create(e,n,r,s,i,o){let a=i.nodeViews[n.type.name],l,u=a&&a(n,i,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,s),d=u&&u.dom,f=u&&u.contentDOM;if(n.isText){if(!d)d=document.createTextNode(n.text);else if(d.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else d||({dom:d,contentDOM:f}=sc.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!f&&!n.isText&&d.nodeName!="BR"&&(d.hasAttribute("contenteditable")||(d.contentEditable="false"),n.type.spec.draggable&&(d.draggable=!0));let h=d;return d=DA(d,r,n),u?l=new aV(e,n,r,s,d,f||null,h,u,i,o+1):n.isText?new Hg(e,n,r,s,d,h,i):new za(e,n,r,s,d,f||null,h,i,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>Nt.empty)}return e}matchesNode(e,n,r){return this.dirty==Mi&&e.eq(this.node)&&Sm(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,s=n,i=e.composing?this.localCompositionInfo(e,n):null,o=i&&i.pos>-1?i:null,a=i&&i.pos<0,l=new cV(this,o&&o.node,e);fV(this.node,this.innerDeco,(u,d,f)=>{u.spec.marks?l.syncToMarks(u.spec.marks,r,e):u.type.side>=0&&!f&&l.syncToMarks(d==this.node.childCount?Bn.none:this.node.child(d).marks,r,e),l.placeWidget(u,e,s)},(u,d,f,h)=>{l.syncToMarks(u.marks,r,e);let p;l.findNodeMatch(u,d,f,h)||a&&e.state.selection.from>s&&e.state.selection.to<s+u.nodeSize&&(p=l.findIndexWithChild(i.node))>-1&&l.updateNodeAt(u,d,f,p,e)||l.updateNextNode(u,d,f,e,h,s)||l.addNode(u,d,f,e,s),s+=u.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==Ml)&&(o&&this.protectLocalComposition(e,o),IA(this.contentDOM,this.children,e),Tu&&hV(this.dom))}localCompositionInfo(e,n){let{from:r,to:s}=e.state.selection;if(!(e.state.selection instanceof mn)||r<n||s>n+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let o=i.nodeValue,a=pV(this.node.content,o,r-n,s-n);return a<0?null:{node:i,pos:a,text:o}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:s}){if(this.getDesc(n))return;let i=n;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let o=new oV(this,i,n,s);e.input.compositionNodes.push(o),this.children=H1(this.children,r,r+s.length,e,o)}update(e,n,r,s){return this.dirty==To||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,s),!0)}updateInner(e,n,r,s){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=Mi}updateOuterDeco(e){if(Sm(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=MA(this.dom,this.nodeDOM,U1(this.outerDeco,this.node,n),U1(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function nT(t,e,n,r,s){DA(r,e,t);let i=new za(void 0,t,e,n,r,r,r,s,0);return i.contentDOM&&i.updateChildren(s,0),i}class Hg extends za{constructor(e,n,r,s,i,o,a){super(e,n,r,s,i,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,s){return this.dirty==To||this.dirty!=Mi&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=Mi||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=Mi,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let s=this.node.cut(e,n),i=document.createTextNode(s.text);return new Hg(this.parent,s,this.outerDeco,this.innerDeco,i,i,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=To)}get domAtom(){return!1}isText(e){return this.node.text==e}}class jA extends sh{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Mi&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class aV extends za{constructor(e,n,r,s,i,o,a,l,u,d){super(e,n,r,s,i,o,a,u,d),this.spec=l}update(e,n,r,s){if(this.dirty==To)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,n,r);return i&&this.updateInner(e,n,r,s),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,s){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function IA(t,e,n){let r=t.firstChild,s=!1;for(let i=0;i<e.length;i++){let o=e[i],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=rT(r),s=!0;r=r.nextSibling}else s=!0,t.insertBefore(a,r);if(o instanceof Zl){let l=r?r.previousSibling:t.lastChild;IA(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=rT(r),s=!0;s&&n.trackWrites==t&&(n.trackWrites=null)}const Od=function(t){t&&(this.nodeName=t)};Od.prototype=Object.create(null);const Dl=[new Od];function U1(t,e,n){if(t.length==0)return Dl;let r=n?Dl[0]:new Od,s=[r];for(let i=0;i<t.length;i++){let o=t[i].type.attrs;if(o){o.nodeName&&s.push(r=new Od(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&s.length==1&&s.push(r=new Od(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return s}function MA(t,e,n,r){if(n==Dl&&r==Dl)return e;let s=e;for(let i=0;i<r.length;i++){let o=r[i],a=n[i];if(i){let l;a&&a.nodeName==o.nodeName&&s!=t&&(l=s.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(s),a=Dl[0]),s=l}lV(s,a||Dl[0],o)}return s}function lV(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],s=n.class?n.class.split(" ").filter(Boolean):[];for(let i=0;i<r.length;i++)s.indexOf(r[i])==-1&&t.classList.remove(r[i]);for(let i=0;i<s.length;i++)r.indexOf(s[i])==-1&&t.classList.add(s[i]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,s;for(;s=r.exec(e.style);)t.style.removeProperty(s[1])}n.style&&(t.style.cssText+=n.style)}}function DA(t,e,n){return MA(t,t,Dl,U1(e,n,t.nodeType!=1))}function Sm(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function rT(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class cV{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=uV(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let s=0,i=this.stack.length>>1,o=Math.min(i,e.length);for(;s<o&&(s==i-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&e[s].type.spec.spanning!==!1;)s++;for(;s<i;)this.destroyRest(),this.top.dirty=Mi,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let u=this.top.children[l];if(u.matchesMark(e[i])&&!this.isLocked(u.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=Zl.create(this.top,e[i],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,i++}}findNodeMatch(e,n,r,s){let i=-1,o;if(s>=this.preMatch.index&&(o=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))i=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let u=this.top.children[a];if(u.matchesNode(e,n,r)&&!this.preMatch.matched.has(u)){i=a;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,n,r,s,i){let o=this.top.children[s];return o.dirty==To&&o.dom==o.contentDOM&&(o.dirty=Ml),o.update(e,n,r,i)?(this.destroyBetween(this.index,s),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let s=this.index;s<this.top.children.length;s++)if(this.top.children[s]==r)return s}return-1}e=n}}updateNextNode(e,n,r,s,i,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof za){let u=this.preMatch.matched.get(l);if(u!=null&&u!=i)return!1;let d=l.dom,f,h=this.isLocked(d)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=To&&Sm(n,l.outerDeco));if(!h&&l.update(e,n,r,s))return this.destroyBetween(this.index,a),l.dom!=d&&(this.changed=!0),this.index++,!0;if(!h&&(f=this.recreateWrapper(l,e,n,r,s,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=f,f.contentDOM&&(f.dirty=Ml,f.updateChildren(s,o+1),f.dirty=Mi),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,s,i,o){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!Sm(r,e.outerDeco)||!s.eq(e.innerDeco))return null;let a=za.create(this.top,n,r,s,i,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,n,r,s,i){let o=za.create(this.top,e,n,r,s,i);o.contentDOM&&o.updateChildren(s,i+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,n,r){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(s&&s.matchesWidget(e)&&(e==s.widget||!s.widget.type.toDOM.parentNode))this.index++;else{let i=new NA(this.top,e,n,r);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof Zl;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof Hg)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((bs||Br)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let s=new jA(this.top,[],r,null);n!=this.top?n.children.push(s):n.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function uV(t,e){let n=e,r=n.children.length,s=t.childCount,i=new Map,o=[];e:for(;s>0;){let a;for(;;)if(r){let u=n.children[r-1];if(u instanceof Zl)n=u,r=u.children.length;else{a=u,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(s-1))break;--s,i.set(a,s),o.push(a)}}return{index:s,matched:i,matches:o.reverse()}}function dV(t,e){return t.type.side-e.type.side}function fV(t,e,n,r){let s=e.locals(t),i=0;if(s.length==0){for(let u=0;u<t.childCount;u++){let d=t.child(u);r(d,s,e.forChild(i,d),u),i+=d.nodeSize}return}let o=0,a=[],l=null;for(let u=0;;){let d,f;for(;o<s.length&&s[o].to==i;){let b=s[o++];b.widget&&(d?(f||(f=[d])).push(b):d=b)}if(d)if(f){f.sort(dV);for(let b=0;b<f.length;b++)n(f[b],u,!!l)}else n(d,u,!!l);let h,p;if(l)p=-1,h=l,l=null;else if(u<t.childCount)p=u,h=t.child(u++);else break;for(let b=0;b<a.length;b++)a[b].to<=i&&a.splice(b--,1);for(;o<s.length&&s[o].from<=i&&s[o].to>i;)a.push(s[o++]);let m=i+h.nodeSize;if(h.isText){let b=m;o<s.length&&s[o].from<b&&(b=s[o].from);for(let g=0;g<a.length;g++)a[g].to<b&&(b=a[g].to);b<m&&(l=h.cut(b-i),h=h.cut(0,b-i),m=b,p=-1)}else for(;o<s.length&&s[o].to<m;)o++;let y=h.isInline&&!h.isLeaf?a.filter(b=>!b.inline):a.slice();r(h,y,e.forChild(i,h),p),i=m}}function hV(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function pV(t,e,n,r){for(let s=0,i=0;s<t.childCount&&i<=r;){let o=t.child(s++),a=i;if(i+=o.nodeSize,!o.isText)continue;let l=o.text;for(;s<t.childCount;){let u=t.child(s++);if(i+=u.nodeSize,!u.isText)break;l+=u.text}if(i>=n){if(i>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let u=a<r?l.lastIndexOf(e,r-a-1):-1;if(u>=0&&u+e.length+a>=n)return a+u;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function H1(t,e,n,r,s){let i=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],u=a,d=a+=l.size;u>=n||d<=e?i.push(l):(u<e&&i.push(l.slice(0,e-u,r)),s&&(i.push(s),s=void 0),d>n&&i.push(l.slice(n-u,l.size,r)))}return i}function xv(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let s=t.docView.nearestDesc(n.focusNode),i=s&&s.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,u;if(Ug(n)){for(l=o;s&&!s.node;)s=s.parent;let f=s.node;if(s&&f.isAtom&&tn.isSelectable(f)&&s.parent&&!(f.isInline&&BH(n.focusNode,n.focusOffset,s.dom))){let h=s.posBefore;u=new tn(o==h?a:r.resolve(h))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let f=o,h=o;for(let p=0;p<n.rangeCount;p++){let m=n.getRangeAt(p);f=Math.min(f,t.docView.posFromDOM(m.startContainer,m.startOffset,1)),h=Math.max(h,t.docView.posFromDOM(m.endContainer,m.endOffset,-1))}if(f<0)return null;[l,o]=h==t.state.selection.anchor?[h,f]:[f,h],a=r.resolve(o)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let d=r.resolve(l);if(!u){let f=e=="pointer"||t.state.selection.head<a.pos&&!i?1:-1;u=bv(t,d,a,f)}return u}function AA(t){return t.editable?t.hasFocus():OA(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Go(t,e=!1){let n=t.state.selection;if(RA(t,n),!!AA(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&Br){let r=t.domSelectionRange(),s=t.domObserver.currentSelection;if(r.anchorNode&&s.anchorNode&&Ql(r.anchorNode,r.anchorOffset,s.anchorNode,s.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)gV(t);else{let{anchor:r,head:s}=n,i,o;sT&&!(n instanceof mn)&&(n.$from.parent.inlineContent||(i=iT(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=iT(t,n.to))),t.docView.setSelection(r,s,t,e),sT&&(i&&oT(i),o&&oT(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&mV(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const sT=bs||Br&&wA<63;function iT(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),s=r<n.childNodes.length?n.childNodes[r]:null,i=r?n.childNodes[r-1]:null;if(bs&&s&&s.contentEditable=="false")return my(s);if((!s||s.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(s)return my(s);if(i)return my(i)}}function my(t){return t.contentEditable="true",bs&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function oT(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function mV(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,s=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=s)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!AA(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function gV(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,es(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&Ws&&$a<=11&&(n.disabled=!0,n.disabled=!1)}function RA(t,e){if(e instanceof tn){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(aT(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else aT(t)}function aT(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function bv(t,e,n,r){return t.someProp("createSelectionBetween",s=>s(t,e,n))||mn.between(e,n,r)}function lT(t){return t.editable&&!t.hasFocus()?!1:OA(t)}function OA(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function yV(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return Ql(e.node,e.offset,n.anchorNode,n.anchorOffset)}function V1(t,e){let{$anchor:n,$head:r}=t.selection,s=e>0?n.max(r):n.min(r),i=s.parent.inlineContent?s.depth?t.doc.resolve(e>0?s.after():s.before()):null:s;return i&&bn.findFrom(i,e)}function pa(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function cT(t,e,n){let r=t.state.selection;if(r instanceof mn)if(n.indexOf("s")>-1){let{$head:s}=r,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let o=t.state.doc.resolve(s.pos+i.nodeSize*(e<0?-1:1));return pa(t,new mn(r.$anchor,o))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let s=V1(t.state,e);return s&&s instanceof tn?pa(t,s):!1}else if(!(bi&&n.indexOf("m")>-1)){let s=r.$head,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter,o;if(!i||i.isText)return!1;let a=e<0?s.pos-i.nodeSize:s.pos;return i.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?tn.isSelectable(i)?pa(t,new tn(e<0?t.state.doc.resolve(s.pos-i.nodeSize):s)):rh?pa(t,new mn(t.state.doc.resolve(e<0?a:a+i.nodeSize))):!1:!1}}else return!1;else{if(r instanceof tn&&r.node.isInline)return pa(t,new mn(e>0?r.$to:r.$from));{let s=V1(t.state,e);return s?pa(t,s):!1}}}function _m(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Pd(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function xc(t,e){return e<0?xV(t):bV(t)}function xV(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s,i,o=!1;for(Ii&&n.nodeType==1&&r<_m(n)&&Pd(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(Pd(a,-1))s=n,i=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(PA(n))break;{let a=n.previousSibling;for(;a&&Pd(a,-1);)s=n.parentNode,i=es(a),a=a.previousSibling;if(a)n=a,r=_m(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?W1(t,n,r):s&&W1(t,s,i)}function bV(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s=_m(n),i,o;for(;;)if(r<s){if(n.nodeType!=1)break;let a=n.childNodes[r];if(Pd(a,1))i=n,o=++r;else break}else{if(PA(n))break;{let a=n.nextSibling;for(;a&&Pd(a,1);)i=a.parentNode,o=es(a)+1,a=a.nextSibling;if(a)n=a,r=0,s=_m(n);else{if(n=n.parentNode,n==t.dom)break;r=s=0}}}i&&W1(t,i,o)}function PA(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function wV(t,e){for(;t&&e==t.childNodes.length&&!nh(t);)e=es(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function vV(t,e){for(;t&&!e&&!nh(t);)e=es(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function W1(t,e,n){if(e.nodeType!=3){let i,o;(o=wV(e,n))?(e=o,n=0):(i=vV(e,n))&&(e=i,n=i.nodeValue.length)}let r=t.domSelection();if(!r)return;if(Ug(r)){let i=document.createRange();i.setEnd(e,n),i.setStart(e,n),r.removeAllRanges(),r.addRange(i)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:s}=t;setTimeout(()=>{t.state==s&&Go(t)},50)}function uT(t,e){let n=t.state.doc.resolve(e);if(!(Br||vA)&&n.parent.inlineContent){let s=t.coordsAtPos(e);if(e>n.start()){let i=t.coordsAtPos(e-1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left<s.left?"ltr":"rtl"}if(e<n.end()){let i=t.coordsAtPos(e+1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left>s.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function dT(t,e,n){let r=t.state.selection;if(r instanceof mn&&!r.empty||n.indexOf("s")>-1||bi&&n.indexOf("m")>-1)return!1;let{$from:s,$to:i}=r;if(!s.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=V1(t.state,e);if(o&&o instanceof tn)return pa(t,o)}if(!s.parent.inlineContent){let o=e<0?s:i,a=r instanceof ji?bn.near(o,e):bn.findFrom(o,e);return a?pa(t,a):!1}return!1}function fT(t,e){if(!(t.state.selection instanceof mn))return!0;let{$head:n,$anchor:r,empty:s}=t.state.selection;if(!n.sameParent(r))return!0;if(!s)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let o=t.state.tr;return e<0?o.delete(n.pos-i.nodeSize,n.pos):o.delete(n.pos,n.pos+i.nodeSize),t.dispatch(o),!0}return!1}function hT(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function kV(t){if(!bs||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;hT(t,r,"true"),setTimeout(()=>hT(t,r,"false"),20)}return!1}function SV(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function _V(t,e){let n=e.keyCode,r=SV(e);if(n==8||bi&&n==72&&r=="c")return fT(t,-1)||xc(t,-1);if(n==46&&!e.shiftKey||bi&&n==68&&r=="c")return fT(t,1)||xc(t,1);if(n==13||n==27)return!0;if(n==37||bi&&n==66&&r=="c"){let s=n==37?uT(t,t.state.selection.from)=="ltr"?-1:1:-1;return cT(t,s,r)||xc(t,s)}else if(n==39||bi&&n==70&&r=="c"){let s=n==39?uT(t,t.state.selection.from)=="ltr"?1:-1:1;return cT(t,s,r)||xc(t,s)}else{if(n==38||bi&&n==80&&r=="c")return dT(t,-1,r)||xc(t,-1);if(n==40||bi&&n==78&&r=="c")return kV(t)||dT(t,1,r)||xc(t,1);if(r==(bi?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function wv(t,e){t.someProp("transformCopied",p=>{e=p(e,t)});let n=[],{content:r,openStart:s,openEnd:i}=e;for(;s>1&&i>1&&r.childCount==1&&r.firstChild.childCount==1;){s--,i--;let p=r.firstChild;n.push(p.type.name,p.attrs!=p.type.defaultAttrs?p.attrs:null),r=p.content}let o=t.someProp("clipboardSerializer")||sc.fromSchema(t.state.schema),a=UA(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let u=l.firstChild,d,f=0;for(;u&&u.nodeType==1&&(d=BA[u.nodeName.toLowerCase()]);){for(let p=d.length-1;p>=0;p--){let m=a.createElement(d[p]);for(;l.firstChild;)m.appendChild(l.firstChild);l.appendChild(m),f++}u=l.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${s} ${i}${f?` -${f}`:""} ${JSON.stringify(n)}`);let h=t.someProp("clipboardTextSerializer",p=>p(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:h,slice:e}}function LA(t,e,n,r,s){let i=s.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=!!e&&(r||i||!n);if(l){if(t.someProp("transformPastedText",h=>{e=h(e,i||r,t)}),i)return a=new qt(Nt.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",h=>{a=h(a,t,!0)}),a;let f=t.someProp("clipboardTextParser",h=>h(e,s,r,t));if(f)a=f;else{let h=s.marks(),{schema:p}=t.state,m=sc.fromSchema(p);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(y=>{let b=o.appendChild(document.createElement("p"));y&&b.appendChild(m.serializeNode(p.text(y,h)))})}}else t.someProp("transformPastedHTML",f=>{n=f(n,t)}),o=NV(n),rh&&jV(o);let u=o&&o.querySelector("[data-pm-slice]"),d=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let f=+d[3];f>0;f--){let h=o.firstChild;for(;h&&h.nodeType!=1;)h=h.nextSibling;if(!h)break;o=h}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||La.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||d),context:s,ruleFromNode(h){return h.nodeName=="BR"&&!h.nextSibling&&h.parentNode&&!TV.test(h.parentNode.nodeName)?{ignore:!0}:null}})),d)a=IV(pT(a,+d[1],+d[2]),d[4]);else if(a=qt.maxOpen(CV(a.content,s),!0),a.openStart||a.openEnd){let f=0,h=0;for(let p=a.content.firstChild;f<a.openStart&&!p.type.spec.isolating;f++,p=p.firstChild);for(let p=a.content.lastChild;h<a.openEnd&&!p.type.spec.isolating;h++,p=p.lastChild);a=pT(a,f,h)}return t.someProp("transformPasted",f=>{a=f(a,t,l)}),a}const TV=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function CV(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let s=e.node(n).contentMatchAt(e.index(n)),i,o=[];if(t.forEach(a=>{if(!o)return;let l=s.findWrapping(a.type),u;if(!l)return o=null;if(u=o.length&&i.length&&zA(l,i,a,o[o.length-1],0))o[o.length-1]=u;else{o.length&&(o[o.length-1]=FA(o[o.length-1],i.length));let d=$A(a,l);o.push(d),s=s.matchType(d.type),i=l}}),o)return Nt.from(o)}return t}function $A(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,Nt.from(t));return t}function zA(t,e,n,r,s){if(s<t.length&&s<e.length&&t[s]==e[s]){let i=zA(t,e,n,r.lastChild,s+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(s==t.length-1?n.type:t[s+1]))return r.copy(r.content.append(Nt.from($A(n,t,s+1))))}}function FA(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,FA(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(Nt.empty,!0);return t.copy(n.append(r))}function K1(t,e,n,r,s,i){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(i=0),s<r-1&&(a=K1(a,e,n,r,s+1,i)),s>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,i<=s).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(Nt.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function pT(t,e,n){return e<t.openStart&&(t=new qt(K1(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new qt(K1(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const BA={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let mT=null;function UA(){return mT||(mT=document.implementation.createHTMLDocument("title"))}let gy=null;function EV(t){let e=window.trustedTypes;return e?(gy||(gy=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),gy.createHTML(t)):t}function NV(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=UA().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),s;if((s=r&&BA[r[1].toLowerCase()])&&(t=s.map(i=>"<"+i+">").join("")+t+s.map(i=>"</"+i+">").reverse().join("")),n.innerHTML=EV(t),s)for(let i=0;i<s.length;i++)n=n.querySelector(s[i])||n;return n}function jV(t){let e=t.querySelectorAll(Br?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==""&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function IV(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:s,openStart:i,openEnd:o}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;s=Nt.from(l.create(r[a+1],s)),i++,o++}return new qt(s,i,o)}const Es={},Ns={},MV={touchstart:!0,touchmove:!0};class DV{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function AV(t){for(let e in Es){let n=Es[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{OV(t,r)&&!vv(t,r)&&(t.editable||!(r.type in Ns))&&n(t,r)},MV[e]?{passive:!0}:void 0)}bs&&t.dom.addEventListener("input",()=>null),G1(t)}function Ea(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function RV(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function G1(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>vv(t,r))})}function vv(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function OV(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function PV(t,e){!vv(t,e)&&Es[e.type]&&(t.editable||!(e.type in Ns))&&Es[e.type](t,e)}Ns.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!VA(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(Ho&&Br&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),Tu&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",s=>s(t,vl(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||_V(t,n)?n.preventDefault():Ea(t,"key")};Ns.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Ns.keypress=(t,e)=>{let n=e;if(VA(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||bi&&n.metaKey)return;if(t.someProp("handleKeyPress",s=>s(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof mn)||!r.$from.sameParent(r.$to)){let s=String.fromCharCode(n.charCode),i=()=>t.state.tr.insertText(s).scrollIntoView();!/[\r\n]/.test(s)&&!t.someProp("handleTextInput",o=>o(t,r.$from.pos,r.$to.pos,s,i))&&t.dispatch(i()),n.preventDefault()}};function Vg(t){return{left:t.clientX,top:t.clientY}}function LV(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function kv(t,e,n,r,s){if(r==-1)return!1;let i=t.state.doc.resolve(r);for(let o=i.depth+1;o>0;o--)if(t.someProp(e,a=>o>i.depth?a(t,n,i.nodeAfter,i.before(o),s,!0):a(t,n,i.node(o),i.before(o),s,!1)))return!0;return!1}function uu(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);n=="pointer"&&r.setMeta("pointer",!0),t.dispatch(r)}function $V(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&tn.isSelectable(r)?(uu(t,new tn(n),"pointer"),!0):!1}function zV(t,e){if(e==-1)return!1;let n=t.state.selection,r,s;n instanceof tn&&(r=n.node);let i=t.state.doc.resolve(e);for(let o=i.depth+1;o>0;o--){let a=o>i.depth?i.nodeAfter:i.node(o);if(tn.isSelectable(a)){r&&n.$from.depth>0&&o>=n.$from.depth&&i.before(n.$from.depth+1)==n.$from.pos?s=i.before(n.$from.depth):s=i.before(o);break}}return s!=null?(uu(t,tn.create(t.state.doc,s),"pointer"),!0):!1}function FV(t,e,n,r,s){return kv(t,"handleClickOn",e,n,r)||t.someProp("handleClick",i=>i(t,e,r))||(s?zV(t,n):$V(t,n))}function BV(t,e,n,r){return kv(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",s=>s(t,e,r))}function UV(t,e,n,r){return kv(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",s=>s(t,e,r))||HV(t,n,r)}function HV(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(uu(t,mn.create(r,0,r.content.size),"pointer"),!0):!1;let s=r.resolve(e);for(let i=s.depth+1;i>0;i--){let o=i>s.depth?s.nodeAfter:s.node(i),a=s.before(i);if(o.inlineContent)uu(t,mn.create(r,a+1,a+1+o.content.size),"pointer");else if(tn.isSelectable(o))uu(t,tn.create(r,a),"pointer");else continue;return!0}}function Sv(t){return Tm(t)}const HA=bi?"metaKey":"ctrlKey";Es.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=Sv(t),s=Date.now(),i="singleClick";s-t.input.lastClick.time<500&&LV(n,t.input.lastClick)&&!n[HA]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?i="doubleClick":t.input.lastClick.type=="doubleClick"&&(i="tripleClick")),t.input.lastClick={time:s,x:n.clientX,y:n.clientY,type:i,button:n.button};let o=t.posAtCoords(Vg(n));o&&(i=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new VV(t,o,n,!!r)):(i=="doubleClick"?BV:UV)(t,o.pos,o.inside,n)?n.preventDefault():Ea(t,"pointer"))};class VV{constructor(e,n,r,s){this.view=e,this.pos=n,this.event=r,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[HA],this.allowDefault=r.shiftKey;let i,o;if(n.inside>-1)i=e.state.doc.nodeAt(n.inside),o=n.inside;else{let d=e.state.doc.resolve(n.pos);i=d.parent,o=d.depth?d.before():0}const a=s?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:u}=e.state;(r.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||u instanceof tn&&u.from<=o&&u.to>o)&&(this.mightDrag={node:i,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Ii&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Ea(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Go(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(Vg(e))),this.updateAllowDefault(e),this.allowDefault||!n?Ea(this.view,"pointer"):FV(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||bs&&this.mightDrag&&!this.mightDrag.node.isAtom||Br&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(uu(this.view,bn.near(this.view.state.doc.resolve(n.pos)),"pointer"),e.preventDefault()):Ea(this.view,"pointer")}move(e){this.updateAllowDefault(e),Ea(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Es.touchstart=t=>{t.input.lastTouch=Date.now(),Sv(t),Ea(t,"pointer")};Es.touchmove=t=>{t.input.lastTouch=Date.now(),Ea(t,"pointer")};Es.contextmenu=t=>Sv(t);function VA(t,e){return t.composing?!0:bs&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const WV=Ho?5e3:-1;Ns.compositionstart=Ns.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof mn&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)||Br&&vA&&KV(t)))t.markCursor=t.state.storedMarks||n.marks(),Tm(t,!0),t.markCursor=null;else if(Tm(t,!e.selection.empty),Ii&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let s=r.focusNode,i=r.focusOffset;s&&s.nodeType==1&&i!=0;){let o=i<0?s.lastChild:s.childNodes[i-1];if(!o)break;if(o.nodeType==3){let a=t.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else s=o,i=-1}}t.input.composing=!0}WA(t,WV)};function KV(t){let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(!e||e.nodeType!=1||n>=e.childNodes.length)return!1;let r=e.childNodes[n];return r.nodeType==1&&r.contentEditable=="false"}Ns.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,WA(t,20))};function WA(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Tm(t),e))}function KA(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=qV());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function GV(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=zH(e.focusNode,e.focusOffset),r=FH(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let s=r.pmViewDesc,i=t.domObserver.lastChangedTextNode;if(n==i||r==i)return i;if(!s||!s.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let o=n.pmViewDesc;if(!(!o||!o.isText(n.nodeValue)))return r}}return n||r}function qV(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Tm(t,e=!1){if(!(Ho&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),KA(t),e||t.docView&&t.docView.dirty){let n=xv(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function YV(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),s=document.createRange();s.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(s),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const Mf=Ws&&$a<15||Tu&&VH<604;Es.copy=Ns.cut=(t,e)=>{let n=e,r=t.state.selection,s=n.type=="cut";if(r.empty)return;let i=Mf?null:n.clipboardData,o=r.content(),{dom:a,text:l}=wv(t,o);i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):YV(t,a),s&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function JV(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function XV(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let s=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?Df(t,r.value,null,s,e):Df(t,r.textContent,r.innerHTML,s,e)},50)}function Df(t,e,n,r,s){let i=LA(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,s,i||qt.empty)))return!0;if(!i)return!1;let o=JV(i),a=o?t.state.tr.replaceSelectionWith(o,r):t.state.tr.replaceSelection(i);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function GA(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Ns.paste=(t,e)=>{let n=e;if(t.composing&&!Ho)return;let r=Mf?null:n.clipboardData,s=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&Df(t,GA(r),r.getData("text/html"),s,n)?n.preventDefault():XV(t,n)};class qA{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const QV=bi?"altKey":"ctrlKey";function YA(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[QV]}Es.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let s=t.state.selection,i=s.empty?null:t.posAtCoords(Vg(n)),o;if(!(i&&i.pos>=s.from&&i.pos<=(s instanceof tn?s.to-1:s.to))){if(r&&r.mightDrag)o=tn.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let f=t.docView.nearestDesc(n.target,!0);f&&f.node.type.spec.draggable&&f!=t.docView&&(o=tn.create(t.state.doc,f.posBefore))}}let a=(o||t.state.selection).content(),{dom:l,text:u,slice:d}=wv(t,a);(!n.dataTransfer.files.length||!Br||wA>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(Mf?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",Mf||n.dataTransfer.setData("text/plain",u),t.dragging=new qA(d,YA(t,n),o)};Es.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Ns.dragover=Ns.dragenter=(t,e)=>e.preventDefault();Ns.drop=(t,e)=>{try{ZV(t,e,t.dragging)}finally{t.dragging=null}};function ZV(t,e,n){if(!e.dataTransfer)return;let r=t.posAtCoords(Vg(e));if(!r)return;let s=t.state.doc.resolve(r.pos),i=n&&n.slice;i?t.someProp("transformPasted",p=>{i=p(i,t,!1)}):i=LA(t,GA(e.dataTransfer),Mf?null:e.dataTransfer.getData("text/html"),!1,s);let o=!!(n&&YA(t,e));if(t.someProp("handleDrop",p=>p(t,e,i||qt.empty,o))){e.preventDefault();return}if(!i)return;e.preventDefault();let a=i?dA(t.state.doc,s.pos,i):s.pos;a==null&&(a=s.pos);let l=t.state.tr;if(o){let{node:p}=n;p?p.replace(l):l.deleteSelection()}let u=l.mapping.map(a),d=i.openStart==0&&i.openEnd==0&&i.content.childCount==1,f=l.doc;if(d?l.replaceRangeWith(u,u,i.content.firstChild):l.replaceRange(u,u,i),l.doc.eq(f))return;let h=l.doc.resolve(u);if(d&&tn.isSelectable(i.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(i.content.firstChild))l.setSelection(new tn(h));else{let p=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach((m,y,b,g)=>p=g),l.setSelection(bv(t,h,l.doc.resolve(p)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}Es.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&Go(t)},20))};Es.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Es.beforeinput=(t,e)=>{if(Br&&Ho&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",i=>i(t,vl(8,"Backspace")))))return;let{$cursor:s}=t.state.selection;s&&s.pos>0&&t.dispatch(t.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let t in Ns)Es[t]=Ns[t];function Af(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class Cm{constructor(e,n){this.toDOM=e,this.spec=n||Ul,this.side=this.spec.side||0}map(e,n,r,s){let{pos:i,deleted:o}=e.mapResult(n.from+s,this.side<0?-1:1);return o?null:new Bs(i-r,i-r,this)}valid(){return!0}eq(e){return this==e||e instanceof Cm&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Af(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Fa{constructor(e,n){this.attrs=e,this.spec=n||Ul}map(e,n,r,s){let i=e.map(n.from+s,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+s,this.spec.inclusiveEnd?1:-1)-r;return i>=o?null:new Bs(i,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof Fa&&Af(this.attrs,e.attrs)&&Af(this.spec,e.spec)}static is(e){return e.type instanceof Fa}destroy(){}}class _v{constructor(e,n){this.attrs=e,this.spec=n||Ul}map(e,n,r,s){let i=e.mapResult(n.from+s,1);if(i.deleted)return null;let o=e.mapResult(n.to+s,-1);return o.deleted||o.pos<=i.pos?null:new Bs(i.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:s}=e.content.findIndex(n.from),i;return s==n.from&&!(i=e.child(r)).isText&&s+i.nodeSize==n.to}eq(e){return this==e||e instanceof _v&&Af(this.attrs,e.attrs)&&Af(this.spec,e.spec)}destroy(){}}class Bs{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new Bs(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new Bs(e,e,new Cm(n,r))}static inline(e,n,r,s){return new Bs(e,n,new Fa(r,s))}static node(e,n,r,s){return new Bs(e,n,new _v(r,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof Fa}get widget(){return this.type instanceof Cm}}const Nc=[],Ul={};class kr{constructor(e,n){this.local=e.length?e:Nc,this.children=n.length?n:Nc}static create(e,n){return n.length?Em(n,e,0,Ul):ps}find(e,n,r){let s=[];return this.findInner(e??0,n??1e9,s,0,r),s}findInner(e,n,r,s,i){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!i||i(a.spec))&&r.push(a.copy(a.from+s,a.to+s))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,r,s+a,i)}}map(e,n,r){return this==ps||e.maps.length==0?this:this.mapInner(e,n,0,0,r||Ul)}mapInner(e,n,r,s,i){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,s);l&&l.type.valid(n,l)?(o||(o=[])).push(l):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?e7(this.children,o||[],e,n,r,s,i):o?new kr(o.sort(Hl),Nc):ps}add(e,n){return n.length?this==ps?kr.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let s,i=0;e.forEach((a,l)=>{let u=l+r,d;if(d=XA(n,a,u)){for(s||(s=this.children.slice());i<s.length&&s[i]<l;)i+=3;s[i]==l?s[i+2]=s[i+2].addInner(a,d,u+1):s.splice(i,0,l,l+a.nodeSize,Em(d,a,u+1,Ul)),i+=3}});let o=JA(i?QA(n):n,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new kr(o.length?this.local.concat(o).sort(Hl):this.local,s||this.children)}remove(e){return e.length==0||this==ps?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,s=this.local;for(let i=0;i<r.length;i+=3){let o,a=r[i]+n,l=r[i+1]+n;for(let d=0,f;d<e.length;d++)(f=e[d])&&f.from>a&&f.to<l&&(e[d]=null,(o||(o=[])).push(f));if(!o)continue;r==this.children&&(r=this.children.slice());let u=r[i+2].removeInner(o,a+1);u!=ps?r[i+2]=u:(r.splice(i,3),i-=3)}if(s.length){for(let i=0,o;i<e.length;i++)if(o=e[i])for(let a=0;a<s.length;a++)s[a].eq(o,n)&&(s==this.local&&(s=this.local.slice()),s.splice(a--,1))}return r==this.children&&s==this.local?this:s.length||r.length?new kr(s,r):ps}forChild(e,n){if(this==ps)return this;if(n.isLeaf)return kr.empty;let r,s;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let i=e+1,o=i+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>i&&l.type instanceof Fa){let u=Math.max(i,l.from)-i,d=Math.min(o,l.to)-i;u<d&&(s||(s=[])).push(l.copy(u,d))}}if(s){let a=new kr(s.sort(Hl),Nc);return r?new va([a,r]):a}return r||ps}eq(e){if(this==e)return!0;if(!(e instanceof kr)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return Tv(this.localsInner(e))}localsInner(e){if(this==ps)return Nc;if(e.inlineContent||!this.local.some(Fa.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Fa||n.push(this.local[r]);return n}forEachSet(e){e(this)}}kr.empty=new kr([],[]);kr.removeOverlap=Tv;const ps=kr.empty;class va{constructor(e){this.members=e}map(e,n){const r=this.members.map(s=>s.map(e,n,Ul));return va.from(r)}forChild(e,n){if(n.isLeaf)return kr.empty;let r=[];for(let s=0;s<this.members.length;s++){let i=this.members[s].forChild(e,n);i!=ps&&(i instanceof va?r=r.concat(i.members):r.push(i))}return va.from(r)}eq(e){if(!(e instanceof va)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let s=0;s<this.members.length;s++){let i=this.members[s].localsInner(e);if(i.length)if(!n)n=i;else{r&&(n=n.slice(),r=!1);for(let o=0;o<i.length;o++)n.push(i[o])}}return n?Tv(r?n:n.sort(Hl)):Nc}static from(e){switch(e.length){case 0:return ps;case 1:return e[0];default:return new va(e.every(n=>n instanceof kr)?e:e.reduce((n,r)=>n.concat(r instanceof kr?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function e7(t,e,n,r,s,i,o){let a=t.slice();for(let u=0,d=i;u<n.maps.length;u++){let f=0;n.maps[u].forEach((h,p,m,y)=>{let b=y-m-(p-h);for(let g=0;g<a.length;g+=3){let v=a[g+1];if(v<0||h>v+d-f)continue;let w=a[g]+d-f;p>=w?a[g+1]=h<=w?-2:-1:h>=d&&b&&(a[g]+=b,a[g+1]+=b)}f+=b}),d=n.maps[u].map(d,-1)}let l=!1;for(let u=0;u<a.length;u+=3)if(a[u+1]<0){if(a[u+1]==-2){l=!0,a[u+1]=-1;continue}let d=n.map(t[u]+i),f=d-s;if(f<0||f>=r.content.size){l=!0;continue}let h=n.map(t[u+1]+i,-1),p=h-s,{index:m,offset:y}=r.content.findIndex(f),b=r.maybeChild(m);if(b&&y==f&&y+b.nodeSize==p){let g=a[u+2].mapInner(n,b,d+1,t[u]+i+1,o);g!=ps?(a[u]=f,a[u+1]=p,a[u+2]=g):(a[u+1]=-2,l=!0)}else l=!0}if(l){let u=t7(a,t,e,n,s,i,o),d=Em(u,r,0,o);e=d.local;for(let f=0;f<a.length;f+=3)a[f+1]<0&&(a.splice(f,3),f-=3);for(let f=0,h=0;f<d.children.length;f+=3){let p=d.children[f];for(;h<a.length&&a[h]<p;)h+=3;a.splice(h,0,d.children[f],d.children[f+1],d.children[f+2])}}return new kr(e.sort(Hl),a)}function JA(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let s=t[r];n.push(new Bs(s.from+e,s.to+e,s.type))}return n}function t7(t,e,n,r,s,i,o){function a(l,u){for(let d=0;d<l.local.length;d++){let f=l.local[d].map(r,s,u);f?n.push(f):o.onRemove&&o.onRemove(l.local[d].spec)}for(let d=0;d<l.children.length;d+=3)a(l.children[d+2],l.children[d]+u+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+i+1);return n}function XA(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,s=null;for(let i=0,o;i<t.length;i++)(o=t[i])&&o.from>n&&o.to<r&&((s||(s=[])).push(o),t[i]=null);return s}function QA(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function Em(t,e,n,r){let s=[],i=!1;e.forEach((a,l)=>{let u=XA(t,a,l+n);if(u){i=!0;let d=Em(u,a,n+l+1,r);d!=ps&&s.push(l,l+a.nodeSize,d)}});let o=JA(i?QA(t):t,-n).sort(Hl);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||s.length?new kr(o,s):ps}function Hl(t,e){return t.from-e.from||t.to-e.to}function Tv(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let s=n+1;s<e.length;s++){let i=e[s];if(i.from==r.from){i.to!=r.to&&(e==t&&(e=t.slice()),e[s]=i.copy(i.from,r.to),gT(e,s+1,i.copy(r.to,i.to)));continue}else{i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),gT(e,s,r.copy(i.from,r.to)));break}}}return e}function gT(t,e,n){for(;e<t.length&&Hl(n,t[e])>0;)e++;t.splice(e,0,n)}function yy(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=ps&&e.push(r)}),t.cursorWrapper&&e.push(kr.create(t.state.doc,[t.cursorWrapper.deco])),va.from(e)}const n7={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},r7=Ws&&$a<=11;class s7{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class i7{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new s7,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let s=0;s<r.length;s++)this.queue.push(r[s]);Ws&&$a<=11&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),r7&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,n7)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(lT(this.view)){if(this.suppressingSelectionUpdates)return Go(this.view);if(Ws&&$a<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Ql(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let i=e.focusNode;i;i=_u(i))n.add(i);for(let i=e.anchorNode;i;i=_u(i))if(n.has(i)){r=i;break}let s=r&&this.view.docView.nearestDesc(r);if(s&&s.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&lT(e)&&!this.ignoreSelectionChange(r),i=-1,o=-1,a=!1,l=[];if(e.editable)for(let d=0;d<n.length;d++){let f=this.registerMutation(n[d],l);f&&(i=i<0?f.from:Math.min(f.from,i),o=o<0?f.to:Math.max(f.to,o),f.typeOver&&(a=!0))}if(Ii&&l.length){let d=l.filter(f=>f.nodeName=="BR");if(d.length==2){let[f,h]=d;f.parentNode&&f.parentNode.parentNode==h.parentNode?h.remove():f.remove()}else{let{focusNode:f}=this.currentSelection;for(let h of d){let p=h.parentNode;p&&p.nodeName=="LI"&&(!f||l7(e,f)!=p)&&h.remove()}}}else if((Br||bs)&&l.some(d=>d.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let d of l)if(d.nodeName=="BR"&&d.parentNode){let f=d.nextSibling;f&&f.nodeType==1&&f.contentEditable=="false"&&d.parentNode.removeChild(d)}}let u=null;i<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Ug(r)&&(u=xv(e))&&u.eq(bn.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Go(e),this.currentSelection.set(r),e.scrollToSelection()):(i>-1||s)&&(i>-1&&(e.docView.markDirty(i,o),o7(e)),this.handleDOMChange(i,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||Go(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let d=0;d<e.addedNodes.length;d++){let f=e.addedNodes[d];n.push(f),f.nodeType==3&&(this.lastChangedTextNode=f)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let s=e.previousSibling,i=e.nextSibling;if(Ws&&$a<=11&&e.addedNodes.length)for(let d=0;d<e.addedNodes.length;d++){let{previousSibling:f,nextSibling:h}=e.addedNodes[d];(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(s=f),(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(i=h)}let o=s&&s.parentNode==e.target?es(s)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=i&&i.parentNode==e.target?es(i):e.target.childNodes.length,u=r.localPosFromDOM(e.target,l,1);return{from:a,to:u}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let yT=new WeakMap,xT=!1;function o7(t){if(!yT.has(t)&&(yT.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=Ii,xT)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),xT=!0}}function bT(t,e){let n=e.startContainer,r=e.startOffset,s=e.endContainer,i=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return Ql(o.node,o.offset,s,i)&&([n,r,s,i]=[s,i,n,r]),{anchorNode:n,anchorOffset:r,focusNode:s,focusOffset:i}}function a7(t,e){if(e.getComposedRanges){let s=e.getComposedRanges(t.root)[0];if(s)return bT(t,s)}let n;function r(s){s.preventDefault(),s.stopImmediatePropagation(),n=s.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?bT(t,n):null}function l7(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function c7(t,e,n){let{node:r,fromOffset:s,toOffset:i,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),u,d=l.anchorNode;if(d&&t.dom.contains(d.nodeType==1?d:d.parentNode)&&(u=[{node:d,offset:l.anchorOffset}],Ug(l)||u.push({node:l.focusNode,offset:l.focusOffset})),Br&&t.input.lastKeyCode===8)for(let b=i;b>s;b--){let g=r.childNodes[b-1],v=g.pmViewDesc;if(g.nodeName=="BR"&&!v){i=b;break}if(!v||v.size)break}let f=t.state.doc,h=t.someProp("domParser")||La.fromSchema(t.state.schema),p=f.resolve(o),m=null,y=h.parse(r,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:s,to:i,preserveWhitespace:p.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:u7,context:p});if(u&&u[0].pos!=null){let b=u[0].pos,g=u[1]&&u[1].pos;g==null&&(g=b),m={anchor:b+o,head:g+o}}return{doc:y,sel:m,from:o,to:a}}function u7(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(bs&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||bs&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const d7=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function f7(t,e,n,r,s){let i=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let A=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,N=xv(t,A);if(N&&!t.state.selection.eq(N)){if(Br&&Ho&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",S=>S(t,vl(13,"Enter"))))return;let E=t.state.tr.setSelection(N);A=="pointer"?E.setMeta("pointer",!0):A=="key"&&E.scrollIntoView(),i&&E.setMeta("composition",i),t.dispatch(E)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l=t.state.selection,u=c7(t,e,n),d=t.state.doc,f=d.slice(u.from,u.to),h,p;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(h=t.state.selection.to,p="end"):(h=t.state.selection.from,p="start"),t.input.lastKeyCode=null;let m=m7(f.content,u.doc.content,u.from,h,p);if(m&&t.input.domChangeCount++,(Tu&&t.input.lastIOSEnter>Date.now()-225||Ho)&&s.some(A=>A.nodeType==1&&!d7.test(A.nodeName))&&(!m||m.endA>=m.endB)&&t.someProp("handleKeyDown",A=>A(t,vl(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!m)if(r&&l instanceof mn&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))m={start:l.from,endA:l.to,endB:l.to};else{if(u.sel){let A=wT(t,t.state.doc,u.sel);if(A&&!A.eq(t.state.selection)){let N=t.state.tr.setSelection(A);i&&N.setMeta("composition",i),t.dispatch(N)}}return}t.state.selection.from<t.state.selection.to&&m.start==m.endB&&t.state.selection instanceof mn&&(m.start>t.state.selection.from&&m.start<=t.state.selection.from+2&&t.state.selection.from>=u.from?m.start=t.state.selection.from:m.endA<t.state.selection.to&&m.endA>=t.state.selection.to-2&&t.state.selection.to<=u.to&&(m.endB+=t.state.selection.to-m.endA,m.endA=t.state.selection.to)),Ws&&$a<=11&&m.endB==m.start+1&&m.endA==m.start&&m.start>u.from&&u.doc.textBetween(m.start-u.from-1,m.start-u.from+1)==" "&&(m.start--,m.endA--,m.endB--);let y=u.doc.resolveNoCache(m.start-u.from),b=u.doc.resolveNoCache(m.endB-u.from),g=d.resolve(m.start),v=y.sameParent(b)&&y.parent.inlineContent&&g.end()>=m.endA;if((Tu&&t.input.lastIOSEnter>Date.now()-225&&(!v||s.some(A=>A.nodeName=="DIV"||A.nodeName=="P"))||!v&&y.pos<u.doc.content.size&&(!y.sameParent(b)||!y.parent.inlineContent)&&y.pos<b.pos&&!/\S/.test(u.doc.textBetween(y.pos,b.pos,"","")))&&t.someProp("handleKeyDown",A=>A(t,vl(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>m.start&&p7(d,m.start,m.endA,y,b)&&t.someProp("handleKeyDown",A=>A(t,vl(8,"Backspace")))){Ho&&Br&&t.domObserver.suppressSelectionUpdates();return}Br&&m.endB==m.start&&(t.input.lastChromeDelete=Date.now()),Ho&&!v&&y.start()!=b.start()&&b.parentOffset==0&&y.depth==b.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==m.endA&&(m.endB-=2,b=u.doc.resolveNoCache(m.endB-u.from),setTimeout(()=>{t.someProp("handleKeyDown",function(A){return A(t,vl(13,"Enter"))})},20));let w=m.start,_=m.endA,D=A=>{let N=A||t.state.tr.replace(w,_,u.doc.slice(m.start-u.from,m.endB-u.from));if(u.sel){let E=wT(t,N.doc,u.sel);E&&!(Br&&t.composing&&E.empty&&(m.start!=m.endB||t.input.lastChromeDelete<Date.now()-100)&&(E.head==w||E.head==N.mapping.map(_)-1)||Ws&&E.empty&&E.head==w)&&N.setSelection(E)}return i&&N.setMeta("composition",i),N.scrollIntoView()},k;if(v)if(y.pos==b.pos){Ws&&$a<=11&&y.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>Go(t),20));let A=D(t.state.tr.delete(w,_)),N=d.resolve(m.start).marksAcross(d.resolve(m.endA));N&&A.ensureMarks(N),t.dispatch(A)}else if(m.endA==m.endB&&(k=h7(y.parent.content.cut(y.parentOffset,b.parentOffset),g.parent.content.cut(g.parentOffset,m.endA-g.start())))){let A=D(t.state.tr);k.type=="add"?A.addMark(w,_,k.mark):A.removeMark(w,_,k.mark),t.dispatch(A)}else if(y.parent.child(y.index()).isText&&y.index()==b.index()-(b.textOffset?0:1)){let A=y.parent.textBetween(y.parentOffset,b.parentOffset),N=()=>D(t.state.tr.insertText(A,w,_));t.someProp("handleTextInput",E=>E(t,w,_,A,N))||t.dispatch(N())}else t.dispatch(D());else t.dispatch(D())}function wT(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:bv(t,e.resolve(n.anchor),e.resolve(n.head))}function h7(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,s=n,i=r,o,a,l;for(let d=0;d<r.length;d++)s=r[d].removeFromSet(s);for(let d=0;d<n.length;d++)i=n[d].removeFromSet(i);if(s.length==1&&i.length==0)a=s[0],o="add",l=d=>d.mark(a.addToSet(d.marks));else if(s.length==0&&i.length==1)a=i[0],o="remove",l=d=>d.mark(a.removeFromSet(d.marks));else return null;let u=[];for(let d=0;d<e.childCount;d++)u.push(l(e.child(d)));if(Nt.from(u).eq(t))return{mark:a,type:o}}function p7(t,e,n,r,s){if(n-e<=s.pos-r.pos||xy(r,!0,!1)<s.pos)return!1;let i=t.resolve(e);if(!r.parent.isTextblock){let a=i.nodeAfter;return a!=null&&n==e+a.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=t.resolve(xy(i,!0,!0));return!o.parent.isTextblock||o.pos>n||xy(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function xy(t,e,n){let r=t.depth,s=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,s++,e=!1;if(n){let i=t.node(r).maybeChild(t.indexAfter(r));for(;i&&!i.isLeaf;)i=i.firstChild,s++}return s}function m7(t,e,n,r,s){let i=t.findDiffStart(e,n);if(i==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(s=="end"){let l=Math.max(0,i-Math.min(o,a));r-=o+l-i}if(o<i&&t.size<e.size){let l=r<=i&&r>=o?i-r:0;i-=l,i&&i<e.size&&vT(e.textBetween(i-1,i+1))&&(i+=l?1:-1),a=i+(a-o),o=i}else if(a<i){let l=r<=i&&r>=a?i-r:0;i-=l,i&&i<t.size&&vT(t.textBetween(i-1,i+1))&&(i+=l?1:-1),o=i+(o-a),a=i}return{start:i,endA:o,endB:a}}function vT(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class ZA{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new DV,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(CT),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=_T(this),ST(this),this.nodeViews=TT(this),this.docView=nT(this.state.doc,kT(this),yy(this),this.dom,this),this.domObserver=new i7(this,(r,s,i,o)=>f7(this,r,s,i,o)),this.domObserver.start(),AV(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&G1(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(CT),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let s=this.state,i=!1,o=!1;e.storedMarks&&this.composing&&(KA(this),o=!0),this.state=e;let a=s.plugins!=e.plugins||this._props.plugins!=n.plugins;if(a||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let p=TT(this);y7(p,this.nodeViews)&&(this.nodeViews=p,i=!0)}(a||n.handleDOMEvents!=this._props.handleDOMEvents)&&G1(this),this.editable=_T(this),ST(this);let l=yy(this),u=kT(this),d=s.plugins!=e.plugins&&!s.doc.eq(e.doc)?"reset":e.scrollToSelection>s.scrollToSelection?"to selection":"preserve",f=i||!this.docView.matchesNode(e.doc,u,l);(f||!e.selection.eq(s.selection))&&(o=!0);let h=d=="preserve"&&o&&this.dom.style.overflowAnchor==null&&GH(this);if(o){this.domObserver.stop();let p=f&&(Ws||Br)&&!this.composing&&!s.selection.empty&&!e.selection.empty&&g7(s.selection,e.selection);if(f){let m=Br?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=GV(this)),(i||!this.docView.update(e.doc,u,l,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=nT(e.doc,u,l,this.dom,this)),m&&!this.trackWrites&&(p=!0)}p||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&yV(this))?Go(this,p):(RA(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),!((r=this.dragging)===null||r===void 0)&&r.node&&!s.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,s),d=="reset"?this.dom.scrollTop=0:d=="to selection"?this.scrollToSelection():h&&qH(h)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof tn){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&J_(this,n.getBoundingClientRect(),e)}else J_(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,s=-1;if(this.state.doc.nodeAt(r.from)==r.node)s=r.from;else{let i=r.from+(this.state.doc.content.size-n.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==r.node&&(s=i)}this.dragging=new qA(e.slice,e.move,s<0?void 0:tn.create(this.state.doc,s))}someProp(e,n){let r=this._props&&this._props[e],s;if(r!=null&&(s=n?n(r):r))return s;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(s=n?n(a):a))return s}let i=this.state.plugins;if(i)for(let o=0;o<i.length;o++){let a=i[o].props[e];if(a!=null&&(s=n?n(a):a))return s}}hasFocus(){if(Ws){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&YH(this.dom),Go(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return eV(this,e)}coordsAtPos(e,n=1){return CA(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let s=this.docView.posFromDOM(e,n,r);if(s==null)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(e,n){return iV(this,n||this.state,e)}pasteHTML(e,n){return Df(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return Df(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return wv(this,e)}destroy(){this.docView&&(RV(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],yy(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,LH())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return PV(this,e)}domSelectionRange(){let e=this.domSelection();return e?bs&&this.root.nodeType===11&&UH(this.dom.ownerDocument)==this.dom&&a7(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}ZA.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function kT(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[Bs.node(0,t.state.doc.content.size,e)]}function ST(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:Bs.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function _T(t){return!t.someProp("editable",e=>e(t.state)===!1)}function g7(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function TT(t){let e=Object.create(null);function n(r){for(let s in r)Object.prototype.hasOwnProperty.call(e,s)||(e[s]=r[s])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function y7(t,e){let n=0,r=0;for(let s in t){if(t[s]!=e[s])return!0;n++}for(let s in e)r++;return n!=r}function CT(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Ga={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Nm={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},x7=typeof navigator<"u"&&/Mac/.test(navigator.platform),b7=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var ts=0;ts<10;ts++)Ga[48+ts]=Ga[96+ts]=String(ts);for(var ts=1;ts<=24;ts++)Ga[ts+111]="F"+ts;for(var ts=65;ts<=90;ts++)Ga[ts]=String.fromCharCode(ts+32),Nm[ts]=String.fromCharCode(ts);for(var by in Ga)Nm.hasOwnProperty(by)||(Nm[by]=Ga[by]);function w7(t){var e=x7&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||b7&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?Nm:Ga)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const v7=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),k7=typeof navigator<"u"&&/Win/.test(navigator.platform);function S7(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,s,i,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))v7?o=!0:s=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),s&&(n="Ctrl-"+n),o&&(n="Meta-"+n),i&&(n="Shift-"+n),n}function _7(t){let e=Object.create(null);for(let n in t)e[S7(n)]=t[n];return e}function wy(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function T7(t){return new Mr({props:{handleKeyDown:e5(t)}})}function e5(t){let e=_7(t);return function(n,r){let s=w7(r),i,o=e[wy(s,r)];if(o&&o(n.state,n.dispatch,n))return!0;if(s.length==1&&s!=" "){if(r.shiftKey){let a=e[wy(s,r,!1)];if(a&&a(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(k7&&r.ctrlKey&&r.altKey)&&(i=Ga[r.keyCode])&&i!=s){let a=e[wy(i,r)];if(a&&a(n.state,n.dispatch,n))return!0}}return!1}}const C7=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function t5(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const E7=(t,e,n)=>{let r=t5(t,n);if(!r)return!1;let s=Cv(r);if(!s){let o=r.blockRange(),a=o&&zu(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let i=s.nodeBefore;if(i5(t,s,e,-1))return!0;if(r.parent.content.size==0&&(Cu(i,"end")||tn.isSelectable(i)))for(let o=r.depth;;o--){let a=Fg(t.doc,r.before(o),r.after(o),qt.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(Cu(i,"end")?bn.findFrom(l.doc.resolve(l.mapping.map(s.pos,-1)),-1):tn.create(l.doc,s.pos-i.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos-i.nodeSize,s.pos).scrollIntoView()),!0):!1},N7=(t,e,n)=>{let r=t5(t,n);if(!r)return!1;let s=Cv(r);return s?n5(t,s,e):!1},j7=(t,e,n)=>{let r=r5(t,n);if(!r)return!1;let s=Ev(r);return s?n5(t,s,e):!1};function n5(t,e,n){let r=e.nodeBefore,s=r,i=e.pos-1;for(;!s.isTextblock;i--){if(s.type.spec.isolating)return!1;let d=s.lastChild;if(!d)return!1;s=d}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let d=a.firstChild;if(!d)return!1;a=d}let u=Fg(t.doc,i,l,qt.empty);if(!u||u.from!=i||u instanceof Fr&&u.slice.size>=l-i)return!1;if(n){let d=t.tr.step(u);d.setSelection(mn.create(d.doc,i)),n(d.scrollIntoView())}return!0}function Cu(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const I7=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;i=Cv(r)}let o=i&&i.nodeBefore;return!o||!tn.isSelectable(o)?!1:(e&&e(t.tr.setSelection(tn.create(t.doc,i.pos-o.nodeSize)).scrollIntoView()),!0)};function Cv(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function r5(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const M7=(t,e,n)=>{let r=r5(t,n);if(!r)return!1;let s=Ev(r);if(!s)return!1;let i=s.nodeAfter;if(i5(t,s,e,1))return!0;if(r.parent.content.size==0&&(Cu(i,"start")||tn.isSelectable(i))){let o=Fg(t.doc,r.before(),r.after(),qt.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(Cu(i,"start")?bn.findFrom(a.doc.resolve(a.mapping.map(s.pos)),1):tn.create(a.doc,a.mapping.map(s.pos))),e(a.scrollIntoView())}return!0}}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos,s.pos+i.nodeSize).scrollIntoView()),!0):!1},D7=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;i=Ev(r)}let o=i&&i.nodeAfter;return!o||!tn.isSelectable(o)?!1:(e&&e(t.tr.setSelection(tn.create(t.doc,i.pos)).scrollIntoView()),!0)};function Ev(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const A7=(t,e)=>{let n=t.selection,r=n instanceof tn,s;if(r){if(n.node.isTextblock||!el(t.doc,n.from))return!1;s=n.from}else if(s=zg(t.doc,n.from,-1),s==null)return!1;if(e){let i=t.tr.join(s);r&&i.setSelection(tn.create(i.doc,s-t.doc.resolve(s).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},R7=(t,e)=>{let n=t.selection,r;if(n instanceof tn){if(n.node.isTextblock||!el(t.doc,n.to))return!1;r=n.to}else if(r=zg(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},O7=(t,e)=>{let{$from:n,$to:r}=t.selection,s=n.blockRange(r),i=s&&zu(s);return i==null?!1:(e&&e(t.tr.lift(s,i).scrollIntoView()),!0)},P7=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function s5(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const L7=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let s=n.node(-1),i=n.indexAfter(-1),o=s5(s.contentMatchAt(i));if(!o||!s.canReplaceWith(i,i,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(bn.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},$7=(t,e)=>{let n=t.selection,{$from:r,$to:s}=n;if(n instanceof ji||r.parent.inlineContent||s.parent.inlineContent)return!1;let i=s5(s.parent.contentMatchAt(s.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let o=(!r.parentOffset&&s.index()<s.parent.childCount?r:s).pos,a=t.tr.insert(o,i.createAndFill());a.setSelection(mn.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},z7=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let i=n.before();if(lu(t.doc,i))return e&&e(t.tr.split(i).scrollIntoView()),!0}let r=n.blockRange(),s=r&&zu(r);return s==null?!1:(e&&e(t.tr.lift(r,s).scrollIntoView()),!0)},F7=(t,e)=>{let{$from:n,to:r}=t.selection,s,i=n.sharedDepth(r);return i==0?!1:(s=n.before(i),e&&e(t.tr.setSelection(tn.create(t.doc,s))),!0)};function B7(t,e,n){let r=e.nodeBefore,s=e.nodeAfter,i=e.index();return!r||!s||!r.type.compatibleContent(s.type)?!1:!r.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(s.isTextblock||el(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function i5(t,e,n,r){let s=e.nodeBefore,i=e.nodeAfter,o,a,l=s.type.spec.isolating||i.type.spec.isolating;if(!l&&B7(t,e,n))return!0;let u=!l&&e.parent.canReplace(e.index(),e.index()+1);if(u&&(o=(a=s.contentMatchAt(s.childCount)).findWrapping(i.type))&&a.matchType(o[0]||i.type).validEnd){if(n){let p=e.pos+i.nodeSize,m=Nt.empty;for(let g=o.length-1;g>=0;g--)m=Nt.from(o[g].create(null,m));m=Nt.from(s.copy(m));let y=t.tr.step(new Hr(e.pos-1,p,e.pos,p,new qt(m,1,0),o.length,!0)),b=y.doc.resolve(p+2*o.length);b.nodeAfter&&b.nodeAfter.type==s.type&&el(y.doc,b.pos)&&y.join(b.pos),n(y.scrollIntoView())}return!0}let d=i.type.spec.isolating||r>0&&l?null:bn.findFrom(e,1),f=d&&d.$from.blockRange(d.$to),h=f&&zu(f);if(h!=null&&h>=e.depth)return n&&n(t.tr.lift(f,h).scrollIntoView()),!0;if(u&&Cu(i,"start",!0)&&Cu(s,"end")){let p=s,m=[];for(;m.push(p),!p.isTextblock;)p=p.lastChild;let y=i,b=1;for(;!y.isTextblock;y=y.firstChild)b++;if(p.canReplace(p.childCount,p.childCount,y.content)){if(n){let g=Nt.empty;for(let w=m.length-1;w>=0;w--)g=Nt.from(m[w].copy(g));let v=t.tr.step(new Hr(e.pos-m.length,e.pos+i.nodeSize,e.pos+b,e.pos+i.nodeSize-b,new qt(g,m.length,0),0,!0));n(v.scrollIntoView())}return!0}}return!1}function o5(t){return function(e,n){let r=e.selection,s=t<0?r.$from:r.$to,i=s.depth;for(;s.node(i).isInline;){if(!i)return!1;i--}return s.node(i).isTextblock?(n&&n(e.tr.setSelection(mn.create(e.doc,t<0?s.start(i):s.end(i)))),!0):!1}}const U7=o5(-1),H7=o5(1);function V7(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,o=s.blockRange(i),a=o&&mv(o,t,e);return a?(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function ET(t,e=null){return function(n,r){let s=!1;for(let i=0;i<n.selection.ranges.length&&!s;i++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[i];n.doc.nodesBetween(o,a,(l,u)=>{if(s)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)s=!0;else{let d=n.doc.resolve(u),f=d.index();s=d.parent.canReplaceWith(f,f+1,t)}})}if(!s)return!1;if(r){let i=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[o];i.setBlockType(a,l,t,e)}r(i.scrollIntoView())}return!0}}typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function W7(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,o=s.blockRange(i);if(!o)return!1;let a=r?n.tr:null;return K7(a,o,t,e)?(r&&r(a.scrollIntoView()),!0):!1}}function K7(t,e,n,r=null){let s=!1,i=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);i=new vm(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new vm(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),s=!0}let a=mv(i,n,r,e);return a?(t&&G7(t,e,a,s,n),!0):!1}function G7(t,e,n,r,s){let i=Nt.empty;for(let d=n.length-1;d>=0;d--)i=Nt.from(n[d].type.create(n[d].attrs,i));t.step(new Hr(e.start-(r?2:0),e.end,e.start,e.end,new qt(i,0,0),n.length,!0));let o=0;for(let d=0;d<n.length;d++)n[d].type==s&&(o=d+1);let a=n.length-o,l=e.start+n.length-(r?2:0),u=e.parent;for(let d=e.startIndex,f=e.endIndex,h=!0;d<f;d++,h=!1)!h&&lu(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=u.child(d).nodeSize;return t}function q7(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,o=>o.childCount>0&&o.firstChild.type==t);return i?n?r.node(i.depth-1).type==t?Y7(e,n,t,i):J7(e,n,i):!0:!1}}function Y7(t,e,n,r){let s=t.tr,i=r.end,o=r.$to.end(r.depth);i<o&&(s.step(new Hr(i-1,o,i,o,new qt(Nt.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new vm(s.doc.resolve(r.$from.pos),s.doc.resolve(o),r.depth));const a=zu(r);if(a==null)return!1;s.lift(r,a);let l=s.doc.resolve(s.mapping.map(i,-1)-1);return el(s.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&s.join(l.pos),e(s.scrollIntoView()),!0}function J7(t,e,n){let r=t.tr,s=n.parent;for(let p=n.end,m=n.endIndex-1,y=n.startIndex;m>y;m--)p-=s.child(m).nodeSize,r.delete(p-1,p+1);let i=r.doc.resolve(n.start),o=i.nodeAfter;if(r.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==s.childCount,u=i.node(-1),d=i.index(-1);if(!u.canReplace(d+(a?0:1),d+1,o.content.append(l?Nt.empty:Nt.from(s))))return!1;let f=i.pos,h=f+o.nodeSize;return r.step(new Hr(f-(a?1:0),h+(l?1:0),f+1,h-1,new qt((a?Nt.empty:Nt.from(s.copy(Nt.empty))).append(l?Nt.empty:Nt.from(s.copy(Nt.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function X7(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,u=>u.childCount>0&&u.firstChild.type==t);if(!i)return!1;let o=i.startIndex;if(o==0)return!1;let a=i.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let u=l.lastChild&&l.lastChild.type==a.type,d=Nt.from(u?t.create():null),f=new qt(Nt.from(t.create(null,Nt.from(a.type.create(null,d)))),u?3:1,0),h=i.start,p=i.end;n(e.tr.step(new Hr(h-(u?3:1),p,h,p,f,1,!0)).scrollIntoView())}return!0}}function Wg(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:s}=n,{storedMarks:i}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return r},get doc(){return s},get tr(){return r=n.selection,s=n.doc,i=n.storedMarks,n}}}class Kg{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:r}=this,{view:s}=n,{tr:i}=r,o=this.buildProps(i);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...d)=>{const f=l(...d)(o);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(i),f}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,a=[],l=!!e,u=e||i.tr,d=()=>(!l&&n&&!u.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(u),a.every(h=>h===!0)),f={...Object.fromEntries(Object.entries(r).map(([h,p])=>[h,(...y)=>{const b=this.buildProps(u,n),g=p(...y)(b);return a.push(g),f}])),run:d};return f}createCan(e){const{rawCommands:n,state:r}=this,s=!1,i=e||r.tr,o=this.buildProps(i,s);return{...Object.fromEntries(Object.entries(n).map(([l,u])=>[l,(...d)=>u(...d)({...o,dispatch:void 0})])),chain:()=>this.createChain(i,s)}}buildProps(e,n=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,a={tr:e,editor:s,view:o,state:Wg({state:i,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e,n),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([l,u])=>[l,(...d)=>u(...d)(a)]))}};return a}}class Q7{constructor(){this.callbacks={}}on(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),this}emit(e,...n){const r=this.callbacks[e];return r&&r.forEach(s=>s.apply(this,n)),this}off(e,n){const r=this.callbacks[e];return r&&(n?this.callbacks[e]=r.filter(s=>s!==n):delete this.callbacks[e]),this}once(e,n){const r=(...s)=>{this.off(e,r),n.apply(this,s)};return this.on(e,r)}removeAllListeners(){this.callbacks={}}}function Xt(t,e,n){return t.config[e]===void 0&&t.parent?Xt(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?Xt(t.parent,e,n):null}):t.config[e]}function Gg(t){const e=t.filter(s=>s.type==="extension"),n=t.filter(s=>s.type==="node"),r=t.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function a5(t){const e=[],{nodeExtensions:n,markExtensions:r}=Gg(t),s=[...n,...r],i={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:s},l=Xt(o,"addGlobalAttributes",a);if(!l)return;l().forEach(d=>{d.types.forEach(f=>{Object.entries(d.attributes).forEach(([h,p])=>{e.push({type:f,name:h,attribute:{...i,...p}})})})})}),s.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=Xt(o,"addAttributes",a);if(!l)return;const u=l();Object.entries(u).forEach(([d,f])=>{const h={...i,...f};typeof(h==null?void 0:h.default)=="function"&&(h.default=h.default()),h!=null&&h.isRequired&&(h==null?void 0:h.default)===void 0&&delete h.default,e.push({type:o.name,name:d,attribute:h})})}),e}function Wr(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function Mn(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([s,i])=>{if(!r[s]){r[s]=i;return}if(s==="class"){const a=i?String(i).split(" "):[],l=r[s]?r[s].split(" "):[],u=a.filter(d=>!l.includes(d));r[s]=[...l,...u].join(" ")}else if(s==="style"){const a=i?i.split(";").map(d=>d.trim()).filter(Boolean):[],l=r[s]?r[s].split(";").map(d=>d.trim()).filter(Boolean):[],u=new Map;l.forEach(d=>{const[f,h]=d.split(":").map(p=>p.trim());u.set(f,h)}),a.forEach(d=>{const[f,h]=d.split(":").map(p=>p.trim());u.set(f,h)}),r[s]=Array.from(u.entries()).map(([d,f])=>`${d}: ${f}`).join("; ")}else r[s]=i}),r},{})}function q1(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>Mn(n,r),{})}function l5(t){return typeof t=="function"}function _n(t,e=void 0,...n){return l5(t)?e?t.bind(e)(...n):t(...n):t}function Z7(t={}){return Object.keys(t).length===0&&t.constructor===Object}function eW(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function NT(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const s=e.reduce((i,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):eW(n.getAttribute(o.name));return a==null?i:{...i,[o.name]:a}},{});return{...r,...s}}}}function jT(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&Z7(n)?!1:n!=null))}function tW(t,e){var n;const r=a5(t),{nodeExtensions:s,markExtensions:i}=Gg(t),o=(n=s.find(u=>Xt(u,"topNode")))===null||n===void 0?void 0:n.name,a=Object.fromEntries(s.map(u=>{const d=r.filter(g=>g.type===u.name),f={name:u.name,options:u.options,storage:u.storage,editor:e},h=t.reduce((g,v)=>{const w=Xt(v,"extendNodeSchema",f);return{...g,...w?w(u):{}}},{}),p=jT({...h,content:_n(Xt(u,"content",f)),marks:_n(Xt(u,"marks",f)),group:_n(Xt(u,"group",f)),inline:_n(Xt(u,"inline",f)),atom:_n(Xt(u,"atom",f)),selectable:_n(Xt(u,"selectable",f)),draggable:_n(Xt(u,"draggable",f)),code:_n(Xt(u,"code",f)),whitespace:_n(Xt(u,"whitespace",f)),linebreakReplacement:_n(Xt(u,"linebreakReplacement",f)),defining:_n(Xt(u,"defining",f)),isolating:_n(Xt(u,"isolating",f)),attrs:Object.fromEntries(d.map(g=>{var v;return[g.name,{default:(v=g==null?void 0:g.attribute)===null||v===void 0?void 0:v.default}]}))}),m=_n(Xt(u,"parseHTML",f));m&&(p.parseDOM=m.map(g=>NT(g,d)));const y=Xt(u,"renderHTML",f);y&&(p.toDOM=g=>y({node:g,HTMLAttributes:q1(g,d)}));const b=Xt(u,"renderText",f);return b&&(p.toText=b),[u.name,p]})),l=Object.fromEntries(i.map(u=>{const d=r.filter(b=>b.type===u.name),f={name:u.name,options:u.options,storage:u.storage,editor:e},h=t.reduce((b,g)=>{const v=Xt(g,"extendMarkSchema",f);return{...b,...v?v(u):{}}},{}),p=jT({...h,inclusive:_n(Xt(u,"inclusive",f)),excludes:_n(Xt(u,"excludes",f)),group:_n(Xt(u,"group",f)),spanning:_n(Xt(u,"spanning",f)),code:_n(Xt(u,"code",f)),attrs:Object.fromEntries(d.map(b=>{var g;return[b.name,{default:(g=b==null?void 0:b.attribute)===null||g===void 0?void 0:g.default}]}))}),m=_n(Xt(u,"parseHTML",f));m&&(p.parseDOM=m.map(b=>NT(b,d)));const y=Xt(u,"renderHTML",f);return y&&(p.toDOM=b=>y({mark:b,HTMLAttributes:q1(b,d)})),[u.name,p]}));return new eA({topNode:o,nodes:a,marks:l})}function vy(t,e){return e.nodes[t]||e.marks[t]||null}function IT(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function Nv(t,e){const n=sc.fromSchema(e).serializeFragment(t),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(n),s.innerHTML}const nW=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(s,i,o,a)=>{var l,u;const d=((u=(l=s.type.spec).toText)===null||u===void 0?void 0:u.call(l,{node:s,pos:i,parent:o,index:a}))||s.textContent||"%leaf%";n+=s.isAtom&&!s.isText?d:d.slice(0,Math.max(0,r-i))}),n};function jv(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class qg{constructor(e){this.find=e.find,this.handler=e.handler}}const rW=(t,e)=>{if(jv(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function zh(t){var e;const{editor:n,from:r,to:s,text:i,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const u=l.state.doc.resolve(r);if(u.parent.type.spec.code||!((e=u.nodeBefore||u.nodeAfter)===null||e===void 0)&&e.marks.find(h=>h.type.spec.code))return!1;let d=!1;const f=nW(u)+i;return o.forEach(h=>{if(d)return;const p=rW(f,h.find);if(!p)return;const m=l.state.tr,y=Wg({state:l.state,transaction:m}),b={from:r-(p[0].length-i.length),to:s},{commands:g,chain:v,can:w}=new Kg({editor:n,state:y});h.handler({state:y,range:b,match:p,commands:g,chain:v,can:w})===null||!m.steps.length||(m.setMeta(a,{transform:m,from:r,to:s,text:i}),l.dispatch(m),d=!0)}),d}function sW(t){const{editor:e,rules:n}=t,r=new Mr({state:{init(){return null},apply(s,i,o){const a=s.getMeta(r);if(a)return a;const l=s.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:d}=l;typeof d=="string"?d=d:d=Nv(Nt.from(d),o.schema);const{from:f}=l,h=f+d.length;zh({editor:e,from:f,to:h,text:d,rules:n,plugin:r})}),s.selectionSet||s.docChanged?null:i}},props:{handleTextInput(s,i,o,a){return zh({editor:e,from:i,to:o,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:i}=s.state.selection;i&&zh({editor:e,from:i.pos,to:i.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(s,i){if(i.key!=="Enter")return!1;const{$cursor:o}=s.state.selection;return o?zh({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function iW(t){return Object.prototype.toString.call(t).slice(8,-1)}function Fh(t){return iW(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function Yg(t,e){const n={...t};return Fh(t)&&Fh(e)&&Object.keys(e).forEach(r=>{Fh(e[r])&&Fh(t[r])?n[r]=Yg(t[r],e[r]):n[r]=e[r]}),n}class ai{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=_n(Xt(this,"addOptions",{name:this.name}))),this.storage=_n(Xt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new ai(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>Yg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new ai(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=_n(Xt(n,"addOptions",{name:n.name})),n.storage=_n(Xt(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const o=s.marks();if(!!!o.find(u=>(u==null?void 0:u.type.name)===n.name))return!1;const l=o.find(u=>(u==null?void 0:u.type.name)===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",s.pos),e.view.dispatch(r),!0}return!1}}function oW(t){return typeof t=="number"}class aW{constructor(e){this.find=e.find,this.handler=e.handler}}const lW=(t,e,n)=>{if(jv(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(s=>{const i=[s.text];return i.index=s.index,i.input=t,i.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(s.replaceWith)),i}):[]};function cW(t){const{editor:e,state:n,from:r,to:s,rule:i,pasteEvent:o,dropEvent:a}=t,{commands:l,chain:u,can:d}=new Kg({editor:e,state:n}),f=[];return n.doc.nodesBetween(r,s,(p,m)=>{if(!p.isTextblock||p.type.spec.code)return;const y=Math.max(r,m),b=Math.min(s,m+p.content.size),g=p.textBetween(y-m,b-m,void 0,"");lW(g,i.find,o).forEach(w=>{if(w.index===void 0)return;const _=y+w.index+1,D=_+w[0].length,k={from:n.tr.mapping.map(_),to:n.tr.mapping.map(D)},A=i.handler({state:n,range:k,match:w,commands:l,chain:u,can:d,pasteEvent:o,dropEvent:a});f.push(A)})}),f.every(p=>p!==null)}let Bh=null;const uW=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)===null||e===void 0||e.setData("text/html",t),n};function dW(t){const{editor:e,rules:n}=t;let r=null,s=!1,i=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:d,from:f,to:h,rule:p,pasteEvt:m})=>{const y=d.tr,b=Wg({state:d,transaction:y});if(!(!cW({editor:e,state:b,from:Math.max(f-1,0),to:h.b-1,rule:p,pasteEvent:m,dropEvent:a})||!y.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,y}};return n.map(d=>new Mr({view(f){const h=m=>{var y;r=!((y=f.dom.parentElement)===null||y===void 0)&&y.contains(m.target)?f.dom.parentElement:null,r&&(Bh=e)},p=()=>{Bh&&(Bh=null)};return window.addEventListener("dragstart",h),window.addEventListener("dragend",p),{destroy(){window.removeEventListener("dragstart",h),window.removeEventListener("dragend",p)}}},props:{handleDOMEvents:{drop:(f,h)=>{if(i=r===f.dom.parentElement,a=h,!i){const p=Bh;p!=null&&p.isEditable&&setTimeout(()=>{const m=p.state.selection;m&&p.commands.deleteRange({from:m.from,to:m.to})},10)}return!1},paste:(f,h)=>{var p;const m=(p=h.clipboardData)===null||p===void 0?void 0:p.getData("text/html");return o=h,s=!!(m!=null&&m.includes("data-pm-slice")),!1}}},appendTransaction:(f,h,p)=>{const m=f[0],y=m.getMeta("uiEvent")==="paste"&&!s,b=m.getMeta("uiEvent")==="drop"&&!i,g=m.getMeta("applyPasteRules"),v=!!g;if(!y&&!b&&!v)return;if(v){let{text:D}=g;typeof D=="string"?D=D:D=Nv(Nt.from(D),p.schema);const{from:k}=g,A=k+D.length,N=uW(D);return l({rule:d,state:p,from:k,to:{b:A},pasteEvt:N})}const w=h.doc.content.findDiffStart(p.doc.content),_=h.doc.content.findDiffEnd(p.doc.content);if(!(!oW(w)||!_||w===_.b))return l({rule:d,state:p,from:w,to:_,pasteEvt:o})}}))}function fW(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}class Xc{constructor(e,n){this.splittableMarks=[],this.editor=n,this.extensions=Xc.resolve(e),this.schema=tW(this.extensions,n),this.setupExtensions()}static resolve(e){const n=Xc.sort(Xc.flatten(e)),r=fW(n.map(s=>s.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(s=>`'${s}'`).join(", ")}]. This can lead to issues.`),n}static flatten(e){return e.map(n=>{const r={name:n.name,options:n.options,storage:n.storage},s=Xt(n,"addExtensions",r);return s?[n,...this.flatten(s())]:n}).flat(10)}static sort(e){return e.sort((r,s)=>{const i=Xt(r,"priority")||100,o=Xt(s,"priority")||100;return i>o?-1:i<o?1:0})}get commands(){return this.extensions.reduce((e,n)=>{const r={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:vy(n.name,this.schema)},s=Xt(n,"addCommands",r);return s?{...e,...s()}:e},{})}get plugins(){const{editor:e}=this,n=Xc.sort([...this.extensions].reverse()),r=[],s=[],i=n.map(o=>{const a={name:o.name,options:o.options,storage:o.storage,editor:e,type:vy(o.name,this.schema)},l=[],u=Xt(o,"addKeyboardShortcuts",a);let d={};if(o.type==="mark"&&Xt(o,"exitable",a)&&(d.ArrowRight=()=>ai.handleExit({editor:e,mark:o})),u){const y=Object.fromEntries(Object.entries(u()).map(([b,g])=>[b,()=>g({editor:e})]));d={...d,...y}}const f=T7(d);l.push(f);const h=Xt(o,"addInputRules",a);IT(o,e.options.enableInputRules)&&h&&r.push(...h());const p=Xt(o,"addPasteRules",a);IT(o,e.options.enablePasteRules)&&p&&s.push(...p());const m=Xt(o,"addProseMirrorPlugins",a);if(m){const y=m();l.push(...y)}return l}).flat();return[sW({editor:e,rules:r}),...dW({editor:e,rules:s}),...i]}get attributes(){return a5(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:n}=Gg(this.extensions);return Object.fromEntries(n.filter(r=>!!Xt(r,"addNodeView")).map(r=>{const s=this.attributes.filter(l=>l.type===r.name),i={name:r.name,options:r.options,storage:r.storage,editor:e,type:Wr(r.name,this.schema)},o=Xt(r,"addNodeView",i);if(!o)return[];const a=(l,u,d,f,h)=>{const p=q1(l,s);return o()({node:l,view:u,getPos:d,decorations:f,innerDecorations:h,editor:e,extension:r,HTMLAttributes:p})};return[r.name,a]}))}setupExtensions(){this.extensions.forEach(e=>{var n;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:vy(e.name,this.schema)};e.type==="mark"&&(!((n=_n(Xt(e,"keepOnSplit",r)))!==null&&n!==void 0)||n)&&this.splittableMarks.push(e.name);const s=Xt(e,"onBeforeCreate",r),i=Xt(e,"onCreate",r),o=Xt(e,"onUpdate",r),a=Xt(e,"onSelectionUpdate",r),l=Xt(e,"onTransaction",r),u=Xt(e,"onFocus",r),d=Xt(e,"onBlur",r),f=Xt(e,"onDestroy",r);s&&this.editor.on("beforeCreate",s),i&&this.editor.on("create",i),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),u&&this.editor.on("focus",u),d&&this.editor.on("blur",d),f&&this.editor.on("destroy",f)})}}class Kr{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=_n(Xt(this,"addOptions",{name:this.name}))),this.storage=_n(Xt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Kr(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>Yg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new Kr({...this.config,...e});return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=_n(Xt(n,"addOptions",{name:n.name})),n.storage=_n(Xt(n,"addStorage",{name:n.name,options:n.options})),n}}function c5(t,e,n){const{from:r,to:s}=e,{blockSeparator:i=`

`,textSerializers:o={}}=n||{};let a="";return t.nodesBetween(r,s,(l,u,d,f)=>{var h;l.isBlock&&u>r&&(a+=i);const p=o==null?void 0:o[l.type.name];if(p)return d&&(a+=p({node:l,pos:u,parent:d,index:f,range:e})),!1;l.isText&&(a+=(h=l==null?void 0:l.text)===null||h===void 0?void 0:h.slice(Math.max(r,u)-u,s-u))}),a}function u5(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}const hW=Kr.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Mr({key:new as("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:s}=e,{ranges:i}=s,o=Math.min(...i.map(d=>d.$from.pos)),a=Math.max(...i.map(d=>d.$to.pos)),l=u5(n);return c5(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),pW=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window==null?void 0:window.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),mW=(t=!1)=>({commands:e})=>e.setContent("",t),gW=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:s}=r;return n&&s.forEach(({$from:i,$to:o})=>{t.doc.nodesBetween(i.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:u,mapping:d}=e,f=u.resolve(d.map(l)),h=u.resolve(d.map(l+a.nodeSize)),p=f.blockRange(h);if(!p)return;const m=zu(p);if(a.type.isTextblock){const{defaultType:y}=f.parent.contentMatchAt(f.index());e.setNodeMarkup(p.start,y)}(m||m===0)&&e.lift(p,m)})}),!0},yW=t=>e=>t(e),xW=()=>({state:t,dispatch:e})=>$7(t,e),bW=(t,e)=>({editor:n,tr:r})=>{const{state:s}=n,i=s.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const o=r.mapping.map(e);return r.insert(o,i.content),r.setSelection(new mn(r.doc.resolve(Math.max(o-1,0)))),!0},wW=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const s=t.selection.$anchor;for(let i=s.depth;i>0;i-=1)if(s.node(i).type===r.type){if(e){const a=s.before(i),l=s.after(i);t.delete(a,l).scrollIntoView()}return!0}return!1},vW=t=>({tr:e,state:n,dispatch:r})=>{const s=Wr(t,n.schema),i=e.selection.$anchor;for(let o=i.depth;o>0;o-=1)if(i.node(o).type===s){if(r){const l=i.before(o),u=i.after(o);e.delete(l,u).scrollIntoView()}return!0}return!1},kW=t=>({tr:e,dispatch:n})=>{const{from:r,to:s}=t;return n&&e.delete(r,s),!0},SW=()=>({state:t,dispatch:e})=>C7(t,e),_W=()=>({commands:t})=>t.keyboardShortcut("Enter"),TW=()=>({state:t,dispatch:e})=>L7(t,e);function jm(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(s=>n.strict?e[s]===t[s]:jv(e[s])?e[s].test(t[s]):e[s]===t[s]):!0}function d5(t,e,n={}){return t.find(r=>r.type===e&&jm(Object.fromEntries(Object.keys(n).map(s=>[s,r.attrs[s]])),n))}function MT(t,e,n={}){return!!d5(t,e,n)}function Iv(t,e,n){var r;if(!t||!e)return;let s=t.parent.childAfter(t.parentOffset);if((!s.node||!s.node.marks.some(d=>d.type===e))&&(s=t.parent.childBefore(t.parentOffset)),!s.node||!s.node.marks.some(d=>d.type===e)||(n=n||((r=s.node.marks[0])===null||r===void 0?void 0:r.attrs),!d5([...s.node.marks],e,n)))return;let o=s.index,a=t.start()+s.offset,l=o+1,u=a+s.node.nodeSize;for(;o>0&&MT([...t.parent.child(o-1).marks],e,n);)o-=1,a-=t.parent.child(o).nodeSize;for(;l<t.parent.childCount&&MT([...t.parent.child(l).marks],e,n);)u+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:u}}function nl(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const CW=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const i=nl(t,r.schema),{doc:o,selection:a}=n,{$from:l,from:u,to:d}=a;if(s){const f=Iv(l,i,e);if(f&&f.from<=u&&f.to>=d){const h=mn.create(o,f.from,f.to);n.setSelection(h)}}return!0},EW=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function f5(t){return t instanceof mn}function Al(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function h5(t,e=null){if(!e)return null;const n=bn.atStart(t),r=bn.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const s=n.from,i=r.to;return e==="all"?mn.create(t,Al(0,s,i),Al(t.content.size,s,i)):mn.create(t,Al(e,s,i),Al(e,s,i))}function p5(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Jg(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const NW=(t=null,e={})=>({editor:n,view:r,tr:s,dispatch:i})=>{e={scrollIntoView:!0,...e};const o=()=>{(Jg()||p5())&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e!=null&&e.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(i&&t===null&&!f5(n.state.selection))return o(),!0;const a=h5(s.doc,t)||n.state.selection,l=n.state.selection.eq(a);return i&&(l||s.setSelection(a),l&&s.storedMarks&&s.setStoredMarks(s.storedMarks),o()),!0},jW=(t,e)=>n=>t.every((r,s)=>e(r,{...n,index:s})),IW=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),m5=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&m5(r)}return t};function Uh(t){const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return m5(n)}function Rf(t,e,n){if(t instanceof Ko||t instanceof Nt)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,s=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return Nt.fromArray(t.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(i){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",i),Rf("",e,n)}if(s){if(n.errorOnInvalidContent){let o=!1,a="";const l=new eA({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(o=!0,a=typeof u=="string"?u:u.outerHTML,null)}]}})});if(n.slice?La.fromSchema(l).parseSlice(Uh(t),n.parseOptions):La.fromSchema(l).parse(Uh(t),n.parseOptions),n.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const i=La.fromSchema(e);return n.slice?i.parseSlice(Uh(t),n.parseOptions).content:i.parse(Uh(t),n.parseOptions)}return Rf("",e,n)}function MW(t,e,n){const r=t.steps.length-1;if(r<e)return;const s=t.steps[r];if(!(s instanceof Fr||s instanceof Hr))return;const i=t.mapping.maps[r];let o=0;i.forEach((a,l,u,d)=>{o===0&&(o=d)}),t.setSelection(bn.near(t.doc.resolve(o),n))}const DW=t=>!("type"in t),AW=(t,e,n)=>({tr:r,dispatch:s,editor:i})=>{var o;if(s){n={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=b=>{i.emit("contentError",{editor:i,error:b,disableCollaboration:()=>{i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{Rf(e,i.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(b){l(b)}try{a=Rf(e,i.schema,{parseOptions:u,errorOnInvalidContent:(o=n.errorOnInvalidContent)!==null&&o!==void 0?o:i.options.enableContentCheck})}catch(b){return l(b),!1}let{from:d,to:f}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},h=!0,p=!0;if((DW(a)?a:[a]).forEach(b=>{b.check(),h=h?b.isText&&b.marks.length===0:!1,p=p?b.isBlock:!1}),d===f&&p){const{parent:b}=r.doc.resolve(d);b.isTextblock&&!b.type.spec.code&&!b.childCount&&(d-=1,f+=1)}let y;if(h){if(Array.isArray(e))y=e.map(b=>b.text||"").join("");else if(e instanceof Nt){let b="";e.forEach(g=>{g.text&&(b+=g.text)}),y=b}else typeof e=="object"&&e&&e.text?y=e.text:y=e;r.insertText(y,d,f)}else y=a,r.replaceWith(d,f,y);n.updateSelection&&MW(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:d,text:y}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:d,text:y})}return!0},RW=()=>({state:t,dispatch:e})=>A7(t,e),OW=()=>({state:t,dispatch:e})=>R7(t,e),PW=()=>({state:t,dispatch:e})=>E7(t,e),LW=()=>({state:t,dispatch:e})=>M7(t,e),$W=()=>({state:t,dispatch:e,tr:n})=>{try{const r=zg(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},zW=()=>({state:t,dispatch:e,tr:n})=>{try{const r=zg(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},FW=()=>({state:t,dispatch:e})=>N7(t,e),BW=()=>({state:t,dispatch:e})=>j7(t,e);function g5(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function UW(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,s,i,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))Jg()||g5()?o=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),s&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),i&&(n=`Shift-${n}`),n}const HW=t=>({editor:e,view:n,tr:r,dispatch:s})=>{const i=UW(t).split(/-(?!$)/),o=i.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",u=>u(n,a))});return l==null||l.steps.forEach(u=>{const d=u.map(r.mapping);d&&s&&r.maybeStep(d)}),!0};function Of(t,e,n={}){const{from:r,to:s,empty:i}=t.selection,o=e?Wr(e,t.schema):null,a=[];t.doc.nodesBetween(r,s,(f,h)=>{if(f.isText)return;const p=Math.max(r,h),m=Math.min(s,h+f.nodeSize);a.push({node:f,from:p,to:m})});const l=s-r,u=a.filter(f=>o?o.name===f.node.type.name:!0).filter(f=>jm(f.node.attrs,n,{strict:!1}));return i?!!u.length:u.reduce((f,h)=>f+h.to-h.from,0)>=l}const VW=(t,e={})=>({state:n,dispatch:r})=>{const s=Wr(t,n.schema);return Of(n,s,e)?O7(n,r):!1},WW=()=>({state:t,dispatch:e})=>z7(t,e),KW=t=>({state:e,dispatch:n})=>{const r=Wr(t,e.schema);return q7(r)(e,n)},GW=()=>({state:t,dispatch:e})=>P7(t,e);function Xg(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function DT(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,s)=>(n.includes(s)||(r[s]=t[s]),r),{})}const qW=(t,e)=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=Xg(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(i=Wr(t,r.schema)),a==="mark"&&(o=nl(t,r.schema)),s&&n.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(u,d)=>{i&&i===u.type&&n.setNodeMarkup(d,void 0,DT(u.attrs,e)),o&&u.marks.length&&u.marks.forEach(f=>{o===f.type&&n.addMark(d,d+u.nodeSize,o.create(DT(f.attrs,e)))})})}),!0):!1},YW=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),JW=()=>({tr:t,dispatch:e})=>{if(e){const n=new ji(t.doc);t.setSelection(n)}return!0},XW=()=>({state:t,dispatch:e})=>I7(t,e),QW=()=>({state:t,dispatch:e})=>D7(t,e),ZW=()=>({state:t,dispatch:e})=>F7(t,e),eK=()=>({state:t,dispatch:e})=>H7(t,e),tK=()=>({state:t,dispatch:e})=>U7(t,e);function Y1(t,e,n={},r={}){return Rf(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}const nK=(t,e=!1,n={},r={})=>({editor:s,tr:i,dispatch:o,commands:a})=>{var l,u;const{doc:d}=i;if(n.preserveWhitespace!=="full"){const f=Y1(t,s.schema,n,{errorOnInvalidContent:(l=r.errorOnInvalidContent)!==null&&l!==void 0?l:s.options.enableContentCheck});return o&&i.replaceWith(0,d.content.size,f).setMeta("preventUpdate",!e),!0}return o&&i.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:d.content.size},t,{parseOptions:n,errorOnInvalidContent:(u=r.errorOnInvalidContent)!==null&&u!==void 0?u:s.options.enableContentCheck})};function y5(t,e){const n=nl(e,t.schema),{from:r,to:s,empty:i}=t.selection,o=[];i?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,s,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function rK(t,e){const n=new gA(t);return e.forEach(r=>{r.steps.forEach(s=>{n.step(s)})}),n}function Mv(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function Tp(t,e){const n=[];return t.descendants((r,s)=>{e(r)&&n.push({node:r,pos:s})}),n}function sK(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(s,i)=>{n(s)&&r.push({node:s,pos:i})}),r}function iK(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function Fu(t){return e=>iK(e.$from,t)}function oK(t,e){const n={from:0,to:t.content.size};return c5(t,n,e)}function aK(t,e){const n=Wr(e,t.schema),{from:r,to:s}=t.selection,i=[];t.doc.nodesBetween(r,s,a=>{i.push(a)});const o=i.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function x5(t,e){const n=Xg(typeof e=="string"?e:e.name,t.schema);return n==="node"?aK(t,e):n==="mark"?y5(t,e):{}}function lK(t,e=JSON.stringify){const n={};return t.filter(r=>{const s=e(r);return Object.prototype.hasOwnProperty.call(n,s)?!1:n[s]=!0})}function cK(t){const e=lK(t);return e.length===1?e:e.filter((n,r)=>!e.filter((i,o)=>o!==r).some(i=>n.oldRange.from>=i.oldRange.from&&n.oldRange.to<=i.oldRange.to&&n.newRange.from>=i.newRange.from&&n.newRange.to<=i.newRange.to))}function uK(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((s,i)=>{const o=[];if(s.ranges.length)s.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=n[i];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const u=e.slice(i).map(a,-1),d=e.slice(i).map(l),f=e.invert().map(u,-1),h=e.invert().map(d);r.push({oldRange:{from:f,to:h},newRange:{from:u,to:d}})})}),cK(r)}function Dv(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(s=>{const i=n.resolve(t),o=Iv(i,s.type);o&&r.push({mark:s,...o})}):n.nodesBetween(t,e,(s,i)=>{!s||(s==null?void 0:s.nodeSize)===void 0||r.push(...s.marks.map(o=>({from:i,to:i+s.nodeSize,mark:o})))}),r}function Cp(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const s=t.find(i=>i.type===e&&i.name===r);return s?s.attribute.keepOnSplit:!1}))}function J1(t,e,n={}){const{empty:r,ranges:s}=t.selection,i=e?nl(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(f=>i?i.name===f.type.name:!0).find(f=>jm(f.attrs,n,{strict:!1}));let o=0;const a=[];if(s.forEach(({$from:f,$to:h})=>{const p=f.pos,m=h.pos;t.doc.nodesBetween(p,m,(y,b)=>{if(!y.isText&&!y.marks.length)return;const g=Math.max(p,b),v=Math.min(m,b+y.nodeSize),w=v-g;o+=w,a.push(...y.marks.map(_=>({mark:_,from:g,to:v})))})}),o===0)return!1;const l=a.filter(f=>i?i.name===f.mark.type.name:!0).filter(f=>jm(f.mark.attrs,n,{strict:!1})).reduce((f,h)=>f+h.to-h.from,0),u=a.filter(f=>i?f.mark.type!==i&&f.mark.type.excludes(i):!0).reduce((f,h)=>f+h.to-h.from,0);return(l>0?l+u:l)>=o}function b5(t,e,n={}){if(!e)return Of(t,null,n)||J1(t,null,n);const r=Xg(e,t.schema);return r==="node"?Of(t,e,n):r==="mark"?J1(t,e,n):!1}function AT(t,e){const{nodeExtensions:n}=Gg(e),r=n.find(o=>o.name===t);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},i=_n(Xt(r,"group",s));return typeof i!="string"?!1:i.split(" ").includes("list")}function Av(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!==null&&r!==void 0?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let s=!0;return t.content.forEach(i=>{s!==!1&&(Av(i,{ignoreWhitespace:n,checkChildren:e})||(s=!1))}),s}return!1}function dK(t){return t instanceof tn}function fK(t,e,n){var r;const{selection:s}=e;let i=null;if(f5(s)&&(i=s.$cursor),i){const a=(r=t.storedMarks)!==null&&r!==void 0?r:i.marks();return!!n.isInSet(a)||!a.some(l=>l.type.excludes(n))}const{ranges:o}=s;return o.some(({$from:a,$to:l})=>{let u=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(d,f,h)=>{if(u)return!1;if(d.isInline){const p=!h||h.type.allowsMarkType(n),m=!!n.isInSet(d.marks)||!d.marks.some(y=>y.type.excludes(n));u=p&&m}return!u}),u})}const hK=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const{selection:i}=n,{empty:o,ranges:a}=i,l=nl(t,r.schema);if(s)if(o){const u=y5(r,l);n.addStoredMark(l.create({...u,...e}))}else a.forEach(u=>{const d=u.$from.pos,f=u.$to.pos;r.doc.nodesBetween(d,f,(h,p)=>{const m=Math.max(p,d),y=Math.min(p+h.nodeSize,f);h.marks.find(g=>g.type===l)?h.marks.forEach(g=>{l===g.type&&n.addMark(m,y,l.create({...g.attrs,...e}))}):n.addMark(m,y,l.create(e))})});return fK(r,n,l)},pK=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),mK=(t,e={})=>({state:n,dispatch:r,chain:s})=>{const i=Wr(t,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),i.isTextblock?s().command(({commands:a})=>ET(i,{...o,...e})(n)?!0:a.clearNodes()).command(({state:a})=>ET(i,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},gK=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,s=Al(t,0,r.content.size),i=tn.create(r,s);e.setSelection(i)}return!0},yK=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:s,to:i}=typeof t=="number"?{from:t,to:t}:t,o=mn.atStart(r).from,a=mn.atEnd(r).to,l=Al(s,o,a),u=Al(i,o,a),d=mn.create(r,l,u);e.setSelection(d)}return!0},xK=t=>({state:e,dispatch:n})=>{const r=Wr(t,e.schema);return X7(r)(e,n)};function RT(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(s=>e==null?void 0:e.includes(s.type.name));t.tr.ensureMarks(r)}}const bK=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:s})=>{const{selection:i,doc:o}=e,{$from:a,$to:l}=i,u=s.extensionManager.attributes,d=Cp(u,a.node().type.name,a.node().attrs);if(i instanceof tn&&i.node.isBlock)return!a.parentOffset||!lu(o,a.pos)?!1:(r&&(t&&RT(n,s.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const f=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:Mv(a.node(-1).contentMatchAt(a.indexAfter(-1)));let p=f&&h?[{type:h,attrs:d}]:void 0,m=lu(e.doc,e.mapping.map(a.pos),1,p);if(!p&&!m&&lu(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(m=!0,p=h?[{type:h,attrs:d}]:void 0),r){if(m&&(i instanceof mn&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,p),h&&!f&&!a.parentOffset&&a.parent.type!==h)){const y=e.mapping.map(a.before()),b=e.doc.resolve(y);a.node(-1).canReplaceWith(b.index(),b.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}t&&RT(n,s.extensionManager.splittableMarks),e.scrollIntoView()}return m},wK=(t,e={})=>({tr:n,state:r,dispatch:s,editor:i})=>{var o;const a=Wr(t,r.schema),{$from:l,$to:u}=r.selection,d=r.selection.node;if(d&&d.isBlock||l.depth<2||!l.sameParent(u))return!1;const f=l.node(-1);if(f.type!==a)return!1;const h=i.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(s){let g=Nt.empty;const v=l.index(-1)?1:l.index(-2)?2:3;for(let N=l.depth-v;N>=l.depth-3;N-=1)g=Nt.from(l.node(N).copy(g));const w=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,_={...Cp(h,l.node().type.name,l.node().attrs),...e},D=((o=a.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(_))||void 0;g=g.append(Nt.from(a.createAndFill(null,D)||void 0));const k=l.before(l.depth-(v-1));n.replace(k,l.after(-w),new qt(g,4-v,0));let A=-1;n.doc.nodesBetween(k,n.doc.content.size,(N,E)=>{if(A>-1)return!1;N.isTextblock&&N.content.size===0&&(A=E+1)}),A>-1&&n.setSelection(mn.near(n.doc.resolve(A))),n.scrollIntoView()}return!0}const p=u.pos===l.end()?f.contentMatchAt(0).defaultType:null,m={...Cp(h,f.type.name,f.attrs),...e},y={...Cp(h,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,u.pos);const b=p?[{type:a,attrs:m},{type:p,attrs:y}]:[{type:a,attrs:m}];if(!lu(n.doc,l.pos,2))return!1;if(s){const{selection:g,storedMarks:v}=r,{splittableMarks:w}=i.extensionManager,_=v||g.$to.parentOffset&&g.$from.marks();if(n.split(l.pos,2,b).scrollIntoView(),!_||!s)return!0;const D=_.filter(k=>w.includes(k.type.name));n.ensureMarks(D)}return!0},ky=(t,e)=>{const n=Fu(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&el(t.doc,n.pos)&&t.join(n.pos),!0},Sy=(t,e)=>{const n=Fu(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&el(t.doc,r)&&t.join(r),!0},vK=(t,e,n,r={})=>({editor:s,tr:i,state:o,dispatch:a,chain:l,commands:u,can:d})=>{const{extensions:f,splittableMarks:h}=s.extensionManager,p=Wr(t,o.schema),m=Wr(e,o.schema),{selection:y,storedMarks:b}=o,{$from:g,$to:v}=y,w=g.blockRange(v),_=b||y.$to.parentOffset&&y.$from.marks();if(!w)return!1;const D=Fu(k=>AT(k.type.name,f))(y);if(w.depth>=1&&D&&w.depth-D.depth<=1){if(D.node.type===p)return u.liftListItem(m);if(AT(D.node.type.name,f)&&p.validContent(D.node.content)&&a)return l().command(()=>(i.setNodeMarkup(D.pos,p),!0)).command(()=>ky(i,p)).command(()=>Sy(i,p)).run()}return!n||!_||!a?l().command(()=>d().wrapInList(p,r)?!0:u.clearNodes()).wrapInList(p,r).command(()=>ky(i,p)).command(()=>Sy(i,p)).run():l().command(()=>{const k=d().wrapInList(p,r),A=_.filter(N=>h.includes(N.type.name));return i.ensureMarks(A),k?!0:u.clearNodes()}).wrapInList(p,r).command(()=>ky(i,p)).command(()=>Sy(i,p)).run()},kK=(t,e={},n={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:i=!1}=n,o=nl(t,r.schema);return J1(r,o,e)?s.unsetMark(o,{extendEmptyMarkRange:i}):s.setMark(o,e)},SK=(t,e,n={})=>({state:r,commands:s})=>{const i=Wr(t,r.schema),o=Wr(e,r.schema),a=Of(r,i,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?s.setNode(o,l):s.setNode(i,{...l,...n})},_K=(t,e={})=>({state:n,commands:r})=>{const s=Wr(t,n.schema);return Of(n,s,e)?r.lift(s):r.wrapIn(s,e)},TK=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const s=n[r];let i;if(s.spec.isInputRules&&(i=s.getState(t))){if(e){const o=t.tr,a=i.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(i.text){const l=o.doc.resolve(i.from).marks();o.replaceWith(i.from,i.to,t.schema.text(i.text,l))}else o.delete(i.from,i.to)}return!0}}return!1},CK=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:s}=n;return r||e&&s.forEach(i=>{t.removeMark(i.$from.pos,i.$to.pos)}),!0},EK=(t,e={})=>({tr:n,state:r,dispatch:s})=>{var i;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=nl(t,r.schema),{$from:u,empty:d,ranges:f}=a;if(!s)return!0;if(d&&o){let{from:h,to:p}=a;const m=(i=u.marks().find(b=>b.type===l))===null||i===void 0?void 0:i.attrs,y=Iv(u,l,m);y&&(h=y.from,p=y.to),n.removeMark(h,p,l)}else f.forEach(h=>{n.removeMark(h.$from.pos,h.$to.pos,l)});return n.removeStoredMark(l),!0},NK=(t,e={})=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=Xg(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(i=Wr(t,r.schema)),a==="mark"&&(o=nl(t,r.schema)),s&&n.selection.ranges.forEach(l=>{const u=l.$from.pos,d=l.$to.pos;let f,h,p,m;n.selection.empty?r.doc.nodesBetween(u,d,(y,b)=>{i&&i===y.type&&(p=Math.max(b,u),m=Math.min(b+y.nodeSize,d),f=b,h=y)}):r.doc.nodesBetween(u,d,(y,b)=>{b<u&&i&&i===y.type&&(p=Math.max(b,u),m=Math.min(b+y.nodeSize,d),f=b,h=y),b>=u&&b<=d&&(i&&i===y.type&&n.setNodeMarkup(b,void 0,{...y.attrs,...e}),o&&y.marks.length&&y.marks.forEach(g=>{if(o===g.type){const v=Math.max(b,u),w=Math.min(b+y.nodeSize,d);n.addMark(v,w,o.create({...g.attrs,...e}))}}))}),h&&(f!==void 0&&n.setNodeMarkup(f,void 0,{...h.attrs,...e}),o&&h.marks.length&&h.marks.forEach(y=>{o===y.type&&n.addMark(p,m,o.create({...y.attrs,...e}))}))}),!0):!1},jK=(t,e={})=>({state:n,dispatch:r})=>{const s=Wr(t,n.schema);return V7(s,e)(n,r)},IK=(t,e={})=>({state:n,dispatch:r})=>{const s=Wr(t,n.schema);return W7(s,e)(n,r)};var MK=Object.freeze({__proto__:null,blur:pW,clearContent:mW,clearNodes:gW,command:yW,createParagraphNear:xW,cut:bW,deleteCurrentNode:wW,deleteNode:vW,deleteRange:kW,deleteSelection:SW,enter:_W,exitCode:TW,extendMarkRange:CW,first:EW,focus:NW,forEach:jW,insertContent:IW,insertContentAt:AW,joinBackward:PW,joinDown:OW,joinForward:LW,joinItemBackward:$W,joinItemForward:zW,joinTextblockBackward:FW,joinTextblockForward:BW,joinUp:RW,keyboardShortcut:HW,lift:VW,liftEmptyBlock:WW,liftListItem:KW,newlineInCode:GW,resetAttributes:qW,scrollIntoView:YW,selectAll:JW,selectNodeBackward:XW,selectNodeForward:QW,selectParentNode:ZW,selectTextblockEnd:eK,selectTextblockStart:tK,setContent:nK,setMark:hK,setMeta:pK,setNode:mK,setNodeSelection:gK,setTextSelection:yK,sinkListItem:xK,splitBlock:bK,splitListItem:wK,toggleList:vK,toggleMark:kK,toggleNode:SK,toggleWrap:_K,undoInputRule:TK,unsetAllMarks:CK,unsetMark:EK,updateAttributes:NK,wrapIn:jK,wrapInList:IK});const DK=Kr.create({name:"commands",addCommands(){return{...MK}}}),AK=Kr.create({name:"drop",addProseMirrorPlugins(){return[new Mr({key:new as("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),RK=Kr.create({name:"editable",addProseMirrorPlugins(){return[new Mr({key:new as("editable"),props:{editable:()=>this.editor.options.editable}})]}}),OK=new as("focusEvents"),PK=Kr.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Mr({key:OK,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),LK=Kr.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:u}=a,{empty:d,$anchor:f}=l,{pos:h,parent:p}=f,m=f.parent.isTextblock&&h>0?a.doc.resolve(h-1):f,y=m.parent.type.spec.isolating,b=f.pos-f.parentOffset,g=y&&m.parent.childCount===1?b===f.pos:bn.atStart(u).from===h;return!d||!p.type.isTextblock||p.textContent.length||!g||g&&f.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...r},i={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Jg()||g5()?i:s},addProseMirrorPlugins(){return[new Mr({key:new as("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(y=>y.getMeta("composition")))return;const r=t.some(y=>y.docChanged)&&!e.doc.eq(n.doc),s=t.some(y=>y.getMeta("preventClearDocument"));if(!r||s)return;const{empty:i,from:o,to:a}=e.selection,l=bn.atStart(e.doc).from,u=bn.atEnd(e.doc).to;if(i||!(o===l&&a===u)||!Av(n.doc))return;const h=n.tr,p=Wg({state:n,transaction:h}),{commands:m}=new Kg({editor:this.editor,state:p});if(m.clearNodes(),!!h.steps.length)return h}})]}}),$K=Kr.create({name:"paste",addProseMirrorPlugins(){return[new Mr({key:new as("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),zK=Kr.create({name:"tabindex",addProseMirrorPlugins(){return[new Mr({key:new as("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class kl{get name(){return this.node.type.name}constructor(e,n,r=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=s}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new kl(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new kl(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new kl(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const s=n.isBlock&&!n.isTextblock,i=n.isAtom&&!n.isText,o=this.pos+r+(i?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!s&&a.depth<=this.depth)return;const l=new kl(a,this.editor,s,s?n:null);s&&(l.actualDepth=this.depth+1),e.push(new kl(a,this.editor,s,s?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,s=this.parent;for(;s&&!r;){if(s.node.type.name===e)if(Object.keys(n).length>0){const i=s.node.attrs,o=Object.keys(n);for(let a=0;a<o.length;a+=1){const l=o[a];if(i[l]!==n[l])break}}else r=s;s=s.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let s=[];if(!this.children||this.children.length===0)return s;const i=Object.keys(n);return this.children.forEach(o=>{r&&s.length>0||(o.node.type.name===e&&i.every(l=>n[l]===o.node.attrs[l])&&s.push(o),!(r&&s.length>0)&&(s=s.concat(o.querySelectorAll(e,n,r))))}),s}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}}const FK=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function BK(t,e,n){const r=document.querySelector(`style[data-tiptap-style${n?`-${n}`:""}]`);if(r!==null)return r;const s=document.createElement("style");return e&&s.setAttribute("nonce",e),s.setAttribute(`data-tiptap-style${n?`-${n}`:""}`,""),s.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(s),s}let UK=class extends Q7{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:r,moved:s})=>this.options.onDrop(n,r,s)),this.on("paste",({event:n,slice:r})=>this.options.onPaste(n,r)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=BK(FK,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,n){const r=l5(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let r=n;if([].concat(e).forEach(i=>{const o=typeof i=="string"?`${i}$`:i.key;r=r.filter(a=>!a.key.startsWith(o))}),n.length===r.length)return;const s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}createExtensionManager(){var e,n;const s=[...this.options.enableCoreExtensions?[RK,hW.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||n===void 0?void 0:n.blockSeparator}),DK,PK,LK,zK,AK,$K].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i==null?void 0:i.type));this.extensionManager=new Xc(s,this)}createCommandManager(){this.commandManager=new Kg({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let n;try{n=Y1(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>a.name!=="collaboration"),this.createExtensionManager()}}),n=Y1(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const r=h5(n,this.options.autofocus);this.view=new ZA(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:Jc.create({doc:n,selection:r||void 0})});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(o)});return}const n=this.state.apply(e),r=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const s=e.getMeta("focus"),i=e.getMeta("blur");s&&this.emit("focus",{editor:this,event:s.event,transaction:e}),i&&this.emit("blur",{editor:this,event:i.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return x5(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,s=typeof e=="string"?n:e;return b5(this.state,r,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Nv(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return oK(this.state.doc,{blockSeparator:n,textSerializers:{...u5(this.schema),...r}})}get isEmpty(){return Av(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelector(e,n))||null}$nodes(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new kl(n,this)}get $doc(){return this.$pos(0)}};function ec(t){return new qg({find:t.find,handler:({state:e,range:n,match:r})=>{const s=_n(t.getAttributes,void 0,r);if(s===!1||s===null)return null;const{tr:i}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),u=n.from+a.indexOf(o),d=u+o.length;if(Dv(n.from,n.to,e.doc).filter(p=>p.mark.type.excluded.find(y=>y===t.type&&y!==p.mark.type)).filter(p=>p.to>u).length)return null;d<n.to&&i.delete(d,n.to),u>n.from&&i.delete(n.from+l,u);const h=n.from+l+o.length;i.addMark(n.from+l,h,t.type.create(s||{})),i.removeStoredMark(t.type)}}})}function HK(t){return new qg({find:t.find,handler:({state:e,range:n,match:r})=>{const s=_n(t.getAttributes,void 0,r)||{},{tr:i}=e,o=n.from;let a=n.to;const l=t.type.create(s);if(r[1]){const u=r[0].lastIndexOf(r[1]);let d=o+u;d>a?d=a:a=d+r[1].length;const f=r[0][r[0].length-1];i.insertText(f,o+r[0].length-1),i.replaceWith(d,a,l)}else if(r[0]){const u=t.type.isInline?o:o-1;i.insert(u,t.type.create(s)).delete(i.mapping.map(o),i.mapping.map(a))}i.scrollIntoView()}})}function X1(t){return new qg({find:t.find,handler:({state:e,range:n,match:r})=>{const s=e.doc.resolve(n.from),i=_n(t.getAttributes,void 0,r)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,i)}})}function Eu(t){return new qg({find:t.find,handler:({state:e,range:n,match:r,chain:s})=>{const i=_n(t.getAttributes,void 0,r)||{},o=e.tr.delete(n.from,n.to),l=o.doc.resolve(n.from).blockRange(),u=l&&mv(l,t.type,i);if(!u)return null;if(o.wrap(l,u),t.keepMarks&&t.editor){const{selection:f,storedMarks:h}=e,{splittableMarks:p}=t.editor.extensionManager,m=h||f.$to.parentOffset&&f.$from.marks();if(m){const y=m.filter(b=>p.includes(b.type.name));o.ensureMarks(y)}}if(t.keepAttributes){const f=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(f,i).run()}const d=o.doc.resolve(n.from-1).nodeBefore;d&&d.type===t.type&&el(o.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,d))&&o.join(n.from-1)}})}class br{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=_n(Xt(this,"addOptions",{name:this.name}))),this.storage=_n(Xt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new br(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>Yg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new br(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=_n(Xt(n,"addOptions",{name:n.name})),n.storage=_n(Xt(n,"addStorage",{name:n.name,options:n.options})),n}}class VK{constructor(e,n,r){this.isDragging=!1,this.component=e,this.editor=n.editor,this.options={stopEvent:null,ignoreMutation:null,...r},this.extension=n.extension,this.node=n.node,this.decorations=n.decorations,this.innerDecorations=n.innerDecorations,this.view=n.view,this.HTMLAttributes=n.HTMLAttributes,this.getPos=n.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(e){var n,r,s,i,o,a,l;const{view:u}=this.editor,d=e.target,f=d.nodeType===3?(n=d.parentElement)===null||n===void 0?void 0:n.closest("[data-drag-handle]"):d.closest("[data-drag-handle]");if(!this.dom||!((r=this.contentDOM)===null||r===void 0)&&r.contains(d)||!f)return;let h=0,p=0;if(this.dom!==f){const v=this.dom.getBoundingClientRect(),w=f.getBoundingClientRect(),_=(s=e.offsetX)!==null&&s!==void 0?s:(i=e.nativeEvent)===null||i===void 0?void 0:i.offsetX,D=(o=e.offsetY)!==null&&o!==void 0?o:(a=e.nativeEvent)===null||a===void 0?void 0:a.offsetY;h=w.x-v.x+_,p=w.y-v.y+D}const m=this.dom.cloneNode(!0);(l=e.dataTransfer)===null||l===void 0||l.setDragImage(m,h,p);const y=this.getPos();if(typeof y!="number")return;const b=tn.create(u.state.doc,y),g=u.state.tr.setSelection(b);u.dispatch(g)}stopEvent(e){var n;if(!this.dom)return!1;if(typeof this.options.stopEvent=="function")return this.options.stopEvent({event:e});const r=e.target;if(!(this.dom.contains(r)&&!(!((n=this.contentDOM)===null||n===void 0)&&n.contains(r))))return!1;const i=e.type.startsWith("drag"),o=e.type==="drop";if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(r.tagName)||r.isContentEditable)&&!o&&!i)return!0;const{isEditable:l}=this.editor,{isDragging:u}=this,d=!!this.node.type.spec.draggable,f=tn.isSelectable(this.node),h=e.type==="copy",p=e.type==="paste",m=e.type==="cut",y=e.type==="mousedown";if(!d&&f&&i&&e.target===this.dom&&e.preventDefault(),d&&i&&!u&&e.target===this.dom)return e.preventDefault(),!1;if(d&&l&&!u&&y){const b=r.closest("[data-drag-handle]");b&&(this.dom===b||this.dom.contains(b))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!(u||o||h||p||m||y&&f)}ignoreMutation(e){return!this.dom||!this.contentDOM?!0:typeof this.options.ignoreMutation=="function"?this.options.ignoreMutation({mutation:e}):this.node.isLeaf||this.node.isAtom?!0:e.type==="selection"||this.dom.contains(e.target)&&e.type==="childList"&&(Jg()||p5())&&this.editor.isFocused&&[...Array.from(e.addedNodes),...Array.from(e.removedNodes)].every(r=>r.isContentEditable)?!1:this.contentDOM===e.target&&e.type==="attributes"?!0:!this.contentDOM.contains(e.target)}updateAttributes(e){this.editor.commands.command(({tr:n})=>{const r=this.getPos();return typeof r!="number"?!1:(n.setNodeMarkup(r,void 0,{...this.node.attrs,...e}),!0)})}deleteNode(){const e=this.getPos();if(typeof e!="number")return;const n=e+this.node.nodeSize;this.editor.commands.deleteRange({from:e,to:n})}}function qa(t){return new aW({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:s})=>{const i=_n(t.getAttributes,void 0,r,s);if(i===!1||i===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let u=n.to;if(a){const d=l.search(/\S/),f=n.from+l.indexOf(a),h=f+a.length;if(Dv(n.from,n.to,e.doc).filter(m=>m.mark.type.excluded.find(b=>b===t.type&&b!==m.mark.type)).filter(m=>m.to>f).length)return null;h<n.to&&o.delete(h,n.to),f>n.from&&o.delete(n.from+d,f),u=n.from+d+a.length,o.addMark(n.from+d,u,t.type.create(i||{})),o.removeStoredMark(t.type)}}})}function WK(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof tn){const i=r.index();return r.parent.canReplaceWith(i,i+1,e)}let s=r.depth;for(;s>=0;){const i=r.index(s);if(r.node(s).contentMatchAt(i).matchType(e))return!0;s-=1}return!1}function KK(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}const GK=(...t)=>e=>{t.forEach(n=>{typeof n=="function"?n(e):n&&(n.current=e)})},qK=({renderers:t})=>Ln.createElement(Ln.Fragment,null,Object.entries(t).map(([e,n])=>T4.createPortal(n.reactElement,n.element,e)));class YK extends Ln.Component{constructor(e){super(e),this.editorContentRef=Ln.createRef(),this.initialized=!1,this.state={renderers:{}}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const{editor:e}=this.props;if(e&&e.options.element){if(e.contentComponent)return;const n=this.editorContentRef.current;n.append(...e.options.element.childNodes),e.setOptions({element:n}),e.contentComponent=this,e.createNodeViews(),this.initialized=!0}}maybeFlushSync(e){this.initialized?or.flushSync(e):e()}setRenderer(e,n){this.maybeFlushSync(()=>{this.setState(({renderers:r})=>({renderers:{...r,[e]:n}}))})}removeRenderer(e){this.maybeFlushSync(()=>{this.setState(({renderers:n})=>{const r={...n};return delete r[e],{renderers:r}})})}componentWillUnmount(){const{editor:e}=this.props;if(!e||(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),e.contentComponent=null,!e.options.element.firstChild))return;const n=document.createElement("div");n.append(...e.options.element.childNodes),e.setOptions({element:n})}render(){const{editor:e,innerRef:n,...r}=this.props;return Ln.createElement(Ln.Fragment,null,Ln.createElement("div",{ref:GK(n,this.editorContentRef),...r}),Ln.createElement(qK,{renderers:this.state.renderers}))}}const JK=x.forwardRef((t,e)=>{const n=Ln.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return Ln.createElement(YK,{key:n,innerRef:e,...t})}),XK=Ln.memo(JK);class QK extends UK{constructor(){super(...arguments),this.contentComponent=null}}const ZK=(t={},e=[])=>{const n=x.useRef(null),[,r]=x.useState({}),{onBeforeCreate:s,onBlur:i,onCreate:o,onDestroy:a,onFocus:l,onSelectionUpdate:u,onTransaction:d,onUpdate:f}=t,h=x.useRef(s),p=x.useRef(i),m=x.useRef(o),y=x.useRef(a),b=x.useRef(l),g=x.useRef(u),v=x.useRef(d),w=x.useRef(f);return x.useEffect(()=>{n.current&&(s&&(n.current.off("beforeCreate",h.current),n.current.on("beforeCreate",s),h.current=s),i&&(n.current.off("blur",p.current),n.current.on("blur",i),p.current=i),o&&(n.current.off("create",m.current),n.current.on("create",o),m.current=o),a&&(n.current.off("destroy",y.current),n.current.on("destroy",a),y.current=a),l&&(n.current.off("focus",b.current),n.current.on("focus",l),b.current=l),u&&(n.current.off("selectionUpdate",g.current),n.current.on("selectionUpdate",u),g.current=u),d&&(n.current.off("transaction",v.current),n.current.on("transaction",d),v.current=d),f&&(n.current.off("update",w.current),n.current.on("update",f),w.current=f))},[s,i,o,a,l,u,d,f,n.current]),x.useEffect(()=>{let _=!0;return n.current=new QK(t),n.current.on("transaction",()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{_&&r({})})})}),()=>{_=!1}},e),x.useEffect(()=>()=>{var _;return(_=n.current)===null||_===void 0?void 0:_.destroy()},[]),n.current},eG=x.createContext({editor:null});eG.Consumer;const w5=x.createContext({onDragStart:void 0}),tG=()=>x.useContext(w5);Ln.forwardRef((t,e)=>{const{onDragStart:n}=tG(),r=t.as||"div";return Ln.createElement(r,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:n,style:{whiteSpace:"normal",...t.style}})});function nG(t){return!!(typeof t=="function"&&t.prototype&&t.prototype.isReactComponent)}function rG(t){var e;return typeof t=="object"&&((e=t.$$typeof)===null||e===void 0?void 0:e.toString())==="Symbol(react.forward_ref)"}class sG{constructor(e,{editor:n,props:r={},as:s="div",className:i="",attrs:o}){this.ref=null,this.id=Math.floor(Math.random()*4294967295).toString(),this.component=e,this.editor=n,this.props=r,this.element=document.createElement(s),this.element.classList.add("react-renderer"),i&&this.element.classList.add(...i.split(" ")),o&&Object.keys(o).forEach(a=>{this.element.setAttribute(a,o[a])}),this.render()}render(){var e,n;const r=this.component,s=this.props;(nG(r)||rG(r))&&(s.ref=i=>{this.ref=i}),this.reactElement=Ln.createElement(r,{...s}),(n=(e=this.editor)===null||e===void 0?void 0:e.contentComponent)===null||n===void 0||n.setRenderer(this.id,this)}updateProps(e={}){this.props={...this.props,...e},this.render()}destroy(){var e,n;(n=(e=this.editor)===null||e===void 0?void 0:e.contentComponent)===null||n===void 0||n.removeRenderer(this.id)}}class iG extends VK{mount(){const e={editor:this.editor,node:this.node,decorations:this.decorations,selected:!1,extension:this.extension,getPos:()=>this.getPos(),updateAttributes:(i={})=>this.updateAttributes(i),deleteNode:()=>this.deleteNode()};if(!this.component.displayName){const i=o=>o.charAt(0).toUpperCase()+o.substring(1);this.component.displayName=i(this.extension.name)}const n=i=>{const o=this.component,a=this.onDragStart.bind(this),l=u=>{u&&this.contentDOMElement&&u.firstChild!==this.contentDOMElement&&u.appendChild(this.contentDOMElement)};return Ln.createElement(Ln.Fragment,null,Ln.createElement(w5.Provider,{value:{onDragStart:a,nodeViewContentRef:l}},Ln.createElement(o,{...i})))};n.displayName="ReactNodeView",this.node.isLeaf?this.contentDOMElement=null:this.options.contentDOMElementTag?this.contentDOMElement=document.createElement(this.options.contentDOMElementTag):this.contentDOMElement=document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.style.whiteSpace="inherit");let r=this.node.isInline?"span":"div";this.options.as&&(r=this.options.as);const{className:s=""}=this.options;this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.editor.on("selectionUpdate",this.handleSelectionUpdate),this.renderer=new sG(n,{editor:this.editor,props:e,as:r,className:`node-${this.node.type.name} ${s}`.trim(),attrs:this.options.attrs})}get dom(){var e;if(this.renderer.element.firstElementChild&&!(!((e=this.renderer.element.firstElementChild)===null||e===void 0)&&e.hasAttribute("data-node-view-wrapper")))throw Error("Please use the NodeViewWrapper component for your node view.");return this.renderer.element}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){const{from:e,to:n}=this.editor.state.selection;if(e<=this.getPos()&&n>=this.getPos()+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(e,n){const r=s=>{this.renderer.updateProps(s)};if(e.type!==this.node.type)return!1;if(typeof this.options.update=="function"){const s=this.node,i=this.decorations;return this.node=e,this.decorations=n,this.options.update({oldNode:s,oldDecorations:i,newNode:e,newDecorations:n,updateProps:()=>r({node:e,decorations:n})})}return e===this.node&&this.decorations===n||(this.node=e,this.decorations=n,r({node:e,decorations:n})),!0}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.element.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.element.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}}function oG(t,e){return n=>n.editor.contentComponent?new iG(t,n,e):{}}const aG=/^\s*>\s$/,lG=br.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",Mn(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Eu({find:aG,type:this.type})]}}),cG=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,uG=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,dG=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,fG=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,hG=ai.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",Mn(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[ec({find:cG,type:this.type}),ec({find:dG,type:this.type})]},addPasteRules(){return[qa({find:uG,type:this.type}),qa({find:fG,type:this.type})]}}),pG="listItem",OT="textStyle",PT=/^\s*([-+*])\s$/,mG=br.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",Mn(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(pG,this.editor.getAttributes(OT)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=Eu({find:PT,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=Eu({find:PT,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(OT),editor:this.editor})),[t]}}),gG=/(^|[^`])`([^`]+)`(?!`)/,yG=/(^|[^`])`([^`]+)`(?!`)/g,xG=ai.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",Mn(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[ec({find:gG,type:this.type})]},addPasteRules(){return[qa({find:yG,type:this.type})]}}),bG=/^```([a-z]+)?[\s\n]$/,wG=/^~~~([a-z]+)?[\s\n]$/,vG=br.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,i=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",Mn(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:s}=n;if(!s||r.parent.type!==this.type)return!1;const i=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!i||!o?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:s,empty:i}=n;if(!i||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const a=s.after();return a===void 0?!1:r.nodeAt(a)?t.commands.command(({tr:u})=>(u.setSelection(bn.near(r.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[X1({find:bG,type:this.type,getAttributes:t=>({language:t[1]})}),X1({find:wG,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Mr({key:new as("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,i=s==null?void 0:s.mode;if(!n||!i)return!1;const{tr:o,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:i},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(mn.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),kG=br.create({name:"doc",topNode:!0,content:"block+"});function SG(t={}){return new Mr({view(e){return new _G(e,t)}})}class _G{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let i=o=>{this[s](o)};return e.dom.addEventListener(s,i),{name:s,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,s=this.editorView.dom,i=s.getBoundingClientRect(),o=i.width/s.offsetWidth,a=i.height/s.offsetHeight;if(n){let f=e.nodeBefore,h=e.nodeAfter;if(f||h){let p=this.editorView.nodeDOM(this.cursorPos-(f?f.nodeSize:0));if(p){let m=p.getBoundingClientRect(),y=f?m.bottom:m.top;f&&h&&(y=(y+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let b=this.width/2*a;r={left:m.left,right:m.right,top:y-b,bottom:y+b}}}}if(!r){let f=this.editorView.coordsAtPos(this.cursorPos),h=this.width/2*o;r={left:f.left-h,right:f.left+h,top:f.top,bottom:f.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let u,d;if(!l||l==document.body&&getComputedStyle(l).position=="static")u=-pageXOffset,d=-pageYOffset;else{let f=l.getBoundingClientRect(),h=f.width/l.offsetWidth,p=f.height/l.offsetHeight;u=f.left-l.scrollLeft*h,d=f.top-l.scrollTop*p}this.element.style.left=(r.left-u)/o+"px",this.element.style.top=(r.top-d)/a+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),s=r&&r.type.spec.disableDropCursor,i=typeof s=="function"?s(this.editorView,n,e):s;if(n&&!i){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=dA(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const TG=Kr.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[SG(this.options)]}});class sr extends bn{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return sr.valid(r)?new sr(r):bn.near(r)}content(){return qt.empty}eq(e){return e instanceof sr&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new sr(e.resolve(n.pos))}getBookmark(){return new Rv(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!CG(e)||!EG(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let s=n.contentMatchAt(e.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&sr.valid(e))return e;let s=e.pos,i=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){i=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;s+=n;let l=e.doc.resolve(s);if(sr.valid(l))return l}for(;;){let o=n>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!tn.isSelectable(i)){e=e.doc.resolve(s+i.nodeSize*n),r=!1;continue e}break}i=o,s+=n;let a=e.doc.resolve(s);if(sr.valid(a))return a}return null}}}sr.prototype.visible=!1;sr.findFrom=sr.findGapCursorFrom;bn.jsonID("gapcursor",sr);class Rv{constructor(e){this.pos=e}map(e){return new Rv(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return sr.valid(n)?new sr(n):bn.near(n)}}function v5(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function CG(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n-1);;s=s.lastChild){if(s.childCount==0&&!s.inlineContent||v5(s.type))return!0;if(s.inlineContent)return!1}}return!0}function EG(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n);;s=s.firstChild){if(s.childCount==0&&!s.inlineContent||v5(s.type))return!0;if(s.inlineContent)return!1}}return!0}function NG(){return new Mr({props:{decorations:DG,createSelectionBetween(t,e,n){return e.pos==n.pos&&sr.valid(n)?new sr(n):null},handleClick:IG,handleKeyDown:jG,handleDOMEvents:{beforeinput:MG}}})}const jG=e5({ArrowLeft:Hh("horiz",-1),ArrowRight:Hh("horiz",1),ArrowUp:Hh("vert",-1),ArrowDown:Hh("vert",1)});function Hh(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,s,i){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof mn){if(!i.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let u=sr.findGapCursorFrom(a,e,l);return u?(s&&s(r.tr.setSelection(new sr(u))),!0):!1}}function IG(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!sr.valid(r))return!1;let s=t.posAtCoords({left:n.clientX,top:n.clientY});return s&&s.inside>-1&&tn.isSelectable(t.state.doc.nodeAt(s.inside))?!1:(t.dispatch(t.state.tr.setSelection(new sr(r))),!0)}function MG(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof sr))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let s=Nt.empty;for(let o=r.length-1;o>=0;o--)s=Nt.from(r[o].createAndFill(null,s));let i=t.state.tr.replace(n.pos,n.pos,new qt(s,0,0));return i.setSelection(mn.near(i.doc.resolve(n.pos+1))),t.dispatch(i),!1}function DG(t){if(!(t.selection instanceof sr))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",kr.create(t.doc,[Bs.widget(t.selection.head,e,{key:"gapcursor"})])}const AG=Kr.create({name:"gapCursor",addProseMirrorPlugins(){return[NG()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=_n(Xt(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),RG=br.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",Mn(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:s,storedMarks:i}=n;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=i||s.$to.parentOffset&&s.$from.marks();return e().insertContent({type:this.name}).command(({tr:u,dispatch:d})=>{if(d&&l&&o){const f=l.filter(h=>a.includes(h.type.name));u.ensureMarks(f)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),OG=br.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,Mn(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>X1({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var Im=200,Vr=function(){};Vr.prototype.append=function(e){return e.length?(e=Vr.from(e),!this.length&&e||e.length<Im&&this.leafAppend(e)||this.length<Im&&e.leafPrepend(this)||this.appendInner(e)):this};Vr.prototype.prepend=function(e){return e.length?Vr.from(e).append(this):this};Vr.prototype.appendInner=function(e){return new PG(this,e)};Vr.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?Vr.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};Vr.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Vr.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};Vr.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var s=[];return this.forEach(function(i,o){return s.push(e(i,o))},n,r),s};Vr.from=function(e){return e instanceof Vr?e:e&&e.length?new k5(e):Vr.empty};var k5=function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(s,i){return s==0&&i==this.length?this:new e(this.values.slice(s,i))},e.prototype.getInner=function(s){return this.values[s]},e.prototype.forEachInner=function(s,i,o,a){for(var l=i;l<o;l++)if(s(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(s,i,o,a){for(var l=i-1;l>=o;l--)if(s(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(s){if(this.length+s.length<=Im)return new e(this.values.concat(s.flatten()))},e.prototype.leafPrepend=function(s){if(this.length+s.length<=Im)return new e(s.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(Vr);Vr.empty=new k5([]);var PG=function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,s,i,o){var a=this.left.length;if(s<a&&this.left.forEachInner(r,s,Math.min(i,a),o)===!1||i>a&&this.right.forEachInner(r,Math.max(s-a,0),Math.min(this.length,i)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,s,i,o){var a=this.left.length;if(s>a&&this.right.forEachInvertedInner(r,s-a,Math.max(i,a)-a,o+a)===!1||i<a&&this.left.forEachInvertedInner(r,Math.min(s,a),i,o)===!1)return!1},e.prototype.sliceInner=function(r,s){if(r==0&&s==this.length)return this;var i=this.left.length;return s<=i?this.left.slice(r,s):r>=i?this.right.slice(r-i,s-i):this.left.slice(r,i).append(this.right.slice(0,s-i))},e.prototype.leafAppend=function(r){var s=this.right.leafAppend(r);if(s)return new e(this.left,s)},e.prototype.leafPrepend=function(r){var s=this.left.leafPrepend(r);if(s)return new e(s,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(Vr);const LG=500;class Qi{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let s,i;n&&(s=this.remapping(r,this.items.length),i=s.maps.length);let o=e.tr,a,l,u=[],d=[];return this.items.forEach((f,h)=>{if(!f.step){s||(s=this.remapping(r,h+1),i=s.maps.length),i--,d.push(f);return}if(s){d.push(new oo(f.map));let p=f.step.map(s.slice(i)),m;p&&o.maybeStep(p).doc&&(m=o.mapping.maps[o.mapping.maps.length-1],u.push(new oo(m,void 0,void 0,u.length+d.length))),i--,m&&s.appendMap(m,i)}else o.maybeStep(f.step);if(f.selection)return a=s?f.selection.map(s.slice(i)):f.selection,l=new Qi(this.items.slice(0,r).append(d.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,r,s){let i=[],o=this.eventCount,a=this.items,l=!s&&a.length?a.get(a.length-1):null;for(let d=0;d<e.steps.length;d++){let f=e.steps[d].invert(e.docs[d]),h=new oo(e.mapping.maps[d],f,n),p;(p=l&&l.merge(h))&&(h=p,d?i.pop():a=a.slice(0,a.length-1)),i.push(h),n&&(o++,n=void 0),s||(l=h)}let u=o-r.depth;return u>zG&&(a=$G(a,u),o-=u),new Qi(a.append(i),o)}remapping(e,n){let r=new jf;return this.items.forEach((s,i)=>{let o=s.mirrorOffset!=null&&i-s.mirrorOffset>=e?r.maps.length-s.mirrorOffset:void 0;r.appendMap(s.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new Qi(this.items.append(e.map(n=>new oo(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],s=Math.max(0,this.items.length-n),i=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(h=>{h.selection&&a--},s);let l=n;this.items.forEach(h=>{let p=i.getMirror(--l);if(p==null)return;o=Math.min(o,p);let m=i.maps[p];if(h.step){let y=e.steps[p].invert(e.docs[p]),b=h.selection&&h.selection.map(i.slice(l+1,p));b&&a++,r.push(new oo(m,y,b))}else r.push(new oo(m))},s);let u=[];for(let h=n;h<o;h++)u.push(new oo(i.maps[h]));let d=this.items.slice(0,s).append(u).append(r),f=new Qi(d,a);return f.emptyItemCount()>LG&&(f=f.compress(this.items.length-r.length)),f}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,s=[],i=0;return this.items.forEach((o,a)=>{if(a>=e)s.push(o),o.selection&&i++;else if(o.step){let l=o.step.map(n.slice(r)),u=l&&l.getMap();if(r--,u&&n.appendMap(u,r),l){let d=o.selection&&o.selection.map(n.slice(r));d&&i++;let f=new oo(u.invert(),l,d),h,p=s.length-1;(h=s.length&&s[p].merge(f))?s[p]=h:s.push(f)}}else o.map&&r--},this.items.length,0),new Qi(Vr.from(s.reverse()),i)}}Qi.empty=new Qi(Vr.empty,0);function $G(t,e){let n;return t.forEach((r,s)=>{if(r.selection&&e--==0)return n=s,!1}),t.slice(n)}class oo{constructor(e,n,r,s){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new oo(n.getMap().invert(),n,this.selection)}}}class ma{constructor(e,n,r,s,i){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=s,this.prevComposition=i}}const zG=20;function FG(t,e,n,r){let s=n.getMeta(Vl),i;if(s)return s.historyState;n.getMeta(HG)&&(t=new ma(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(Vl))return o.getMeta(Vl).redo?new ma(t.done.addTransform(n,void 0,r,Ep(e)),t.undone,LT(n.mapping.maps),t.prevTime,t.prevComposition):new ma(t.done,t.undone.addTransform(n,void 0,r,Ep(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!BG(n,t.prevRanges)),u=o?_y(t.prevRanges,n.mapping):LT(n.mapping.maps);return new ma(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,Ep(e)),Qi.empty,u,n.time,a??t.prevComposition)}else return(i=n.getMeta("rebased"))?new ma(t.done.rebased(n,i),t.undone.rebased(n,i),_y(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new ma(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),_y(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function BG(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,s)=>{for(let i=0;i<e.length;i+=2)r<=e[i+1]&&s>=e[i]&&(n=!0)}),n}function LT(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,s,i,o)=>e.push(i,o));return e}function _y(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let s=e.map(t[r],1),i=e.map(t[r+1],-1);s<=i&&n.push(s,i)}return n}function UG(t,e,n){let r=Ep(e),s=Vl.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,r);if(!i)return null;let o=i.selection.resolve(i.transform.doc),a=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),s,r),l=new ma(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(o).setMeta(Vl,{redo:n,historyState:l})}let Ty=!1,$T=null;function Ep(t){let e=t.plugins;if($T!=e){Ty=!1,$T=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){Ty=!0;break}}return Ty}const Vl=new as("history"),HG=new as("closeHistory");function VG(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Mr({key:Vl,state:{init(){return new ma(Qi.empty,Qi.empty,null,0,-1)},apply(e,n,r){return FG(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,s=r=="historyUndo"?_5:r=="historyRedo"?T5:null;return!s||!e.editable?!1:(n.preventDefault(),s(e.state,e.dispatch))}}}})}function S5(t,e){return(n,r)=>{let s=Vl.getState(n);if(!s||(t?s.undone:s.done).eventCount==0)return!1;if(r){let i=UG(s,n,t);i&&r(e?i.scrollIntoView():i)}return!0}}const _5=S5(!1,!0),T5=S5(!0,!0),WG=Kr.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>_5(t,e),redo:()=>({state:t,dispatch:e})=>T5(t,e)}},addProseMirrorPlugins(){return[VG(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),KG=br.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",Mn(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!WK(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$from:r,$to:s}=n,i=t();return r.parentOffset===0?i.insertContentAt({from:Math.max(r.pos-1,0),to:s.pos},{type:this.name}):dK(n)?i.insertContentAt(s.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({tr:o,dispatch:a})=>{var l;if(a){const{$to:u}=o.selection,d=u.end();if(u.nodeAfter)u.nodeAfter.isTextblock?o.setSelection(mn.create(o.doc,u.pos+1)):u.nodeAfter.isBlock?o.setSelection(tn.create(o.doc,u.pos)):o.setSelection(mn.create(o.doc,u.pos));else{const f=(l=u.parent.type.contentMatch.defaultType)===null||l===void 0?void 0:l.create();f&&(o.insert(d,f),o.setSelection(mn.create(o.doc,d+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[HK({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),GG=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,qG=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,YG=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,JG=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,XG=ai.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",Mn(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[ec({find:GG,type:this.type}),ec({find:YG,type:this.type})]},addPasteRules(){return[qa({find:qG,type:this.type}),qa({find:JG,type:this.type})]}}),QG=br.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",Mn(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),ZG="listItem",zT="textStyle",FT=/^(\d+)\.\s$/,eq=br.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",Mn(this.options.HTMLAttributes,n),0]:["ol",Mn(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(ZG,this.editor.getAttributes(zT)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=Eu({find:FT,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=Eu({find:FT,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(zT)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),tq=br.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",Mn(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),nq=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,rq=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,sq=ai.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",Mn(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[ec({find:nq,type:this.type})]},addPasteRules(){return[qa({find:rq,type:this.type})]}}),iq=br.create({name:"text",group:"inline"}),oq=Kr.create({name:"starterKit",addExtensions(){var t,e,n,r,s,i,o,a,l,u,d,f,h,p,m,y,b,g;const v=[];return this.options.blockquote!==!1&&v.push(lG.configure((t=this.options)===null||t===void 0?void 0:t.blockquote)),this.options.bold!==!1&&v.push(hG.configure((e=this.options)===null||e===void 0?void 0:e.bold)),this.options.bulletList!==!1&&v.push(mG.configure((n=this.options)===null||n===void 0?void 0:n.bulletList)),this.options.code!==!1&&v.push(xG.configure((r=this.options)===null||r===void 0?void 0:r.code)),this.options.codeBlock!==!1&&v.push(vG.configure((s=this.options)===null||s===void 0?void 0:s.codeBlock)),this.options.document!==!1&&v.push(kG.configure((i=this.options)===null||i===void 0?void 0:i.document)),this.options.dropcursor!==!1&&v.push(TG.configure((o=this.options)===null||o===void 0?void 0:o.dropcursor)),this.options.gapcursor!==!1&&v.push(AG.configure((a=this.options)===null||a===void 0?void 0:a.gapcursor)),this.options.hardBreak!==!1&&v.push(RG.configure((l=this.options)===null||l===void 0?void 0:l.hardBreak)),this.options.heading!==!1&&v.push(OG.configure((u=this.options)===null||u===void 0?void 0:u.heading)),this.options.history!==!1&&v.push(WG.configure((d=this.options)===null||d===void 0?void 0:d.history)),this.options.horizontalRule!==!1&&v.push(KG.configure((f=this.options)===null||f===void 0?void 0:f.horizontalRule)),this.options.italic!==!1&&v.push(XG.configure((h=this.options)===null||h===void 0?void 0:h.italic)),this.options.listItem!==!1&&v.push(QG.configure((p=this.options)===null||p===void 0?void 0:p.listItem)),this.options.orderedList!==!1&&v.push(eq.configure((m=this.options)===null||m===void 0?void 0:m.orderedList)),this.options.paragraph!==!1&&v.push(tq.configure((y=this.options)===null||y===void 0?void 0:y.paragraph)),this.options.strike!==!1&&v.push(sq.configure((b=this.options)===null||b===void 0?void 0:b.strike)),this.options.text!==!1&&v.push(iq.configure((g=this.options)===null||g===void 0?void 0:g.text)),v}}),aq="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",lq="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",Q1="numeric",Z1="ascii",eb="alpha",Ld="asciinumeric",yd="alphanumeric",tb="domain",C5="emoji",cq="scheme",uq="slashscheme",Cy="whitespace";function dq(t,e){return t in e||(e[t]=[]),e[t]}function Rl(t,e,n){e[Q1]&&(e[Ld]=!0,e[yd]=!0),e[Z1]&&(e[Ld]=!0,e[eb]=!0),e[Ld]&&(e[yd]=!0),e[eb]&&(e[yd]=!0),e[yd]&&(e[tb]=!0),e[C5]&&(e[tb]=!0);for(const r in e){const s=dq(r,n);s.indexOf(t)<0&&s.push(t)}}function fq(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function $s(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}$s.groups={};$s.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const s=e.jr[r][0],i=e.jr[r][1];if(i&&s.test(t))return i}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let s=0;s<t.length;s++)this.tt(t[s],e,n,r)},tr(t,e,n,r){r=r||$s.groups;let s;return e&&e.j?s=e:(s=new $s(e),n&&r&&Rl(e,n,r)),this.jr.push([t,s]),s},ts(t,e,n,r){let s=this;const i=t.length;if(!i)return s;for(let o=0;o<i-1;o++)s=s.tt(t[o]);return s.tt(t[i-1],e,n,r)},tt(t,e,n,r){r=r||$s.groups;const s=this;if(e&&e.j)return s.j[t]=e,e;const i=e;let o,a=s.go(t);if(a?(o=new $s,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new $s,i){if(r)if(o.t&&typeof o.t=="string"){const l=Object.assign(fq(o.t,r),n);Rl(i,l,r)}else n&&Rl(i,n,r);o.t=i}return s.j[t]=o,o}};const kn=(t,e,n,r,s)=>t.ta(e,n,r,s),mr=(t,e,n,r,s)=>t.tr(e,n,r,s),BT=(t,e,n,r,s)=>t.ts(e,n,r,s),Mt=(t,e,n,r,s)=>t.tt(e,n,r,s),Oo="WORD",nb="UWORD",E5="ASCIINUMERICAL",N5="ALPHANUMERICAL",Pf="LOCALHOST",rb="TLD",sb="UTLD",Np="SCHEME",jc="SLASH_SCHEME",Ov="NUM",ib="WS",Pv="NL",$d="OPENBRACE",zd="CLOSEBRACE",Mm="OPENBRACKET",Dm="CLOSEBRACKET",Am="OPENPAREN",Rm="CLOSEPAREN",Om="OPENANGLEBRACKET",Pm="CLOSEANGLEBRACKET",Lm="FULLWIDTHLEFTPAREN",$m="FULLWIDTHRIGHTPAREN",zm="LEFTCORNERBRACKET",Fm="RIGHTCORNERBRACKET",Bm="LEFTWHITECORNERBRACKET",Um="RIGHTWHITECORNERBRACKET",Hm="FULLWIDTHLESSTHAN",Vm="FULLWIDTHGREATERTHAN",Wm="AMPERSAND",Km="APOSTROPHE",Gm="ASTERISK",ga="AT",qm="BACKSLASH",Ym="BACKTICK",Jm="CARET",ka="COLON",Lv="COMMA",Xm="DOLLAR",ao="DOT",Qm="EQUALS",$v="EXCLAMATION",yi="HYPHEN",Fd="PERCENT",Zm="PIPE",eg="PLUS",tg="POUND",Bd="QUERY",zv="QUOTE",j5="FULLWIDTHMIDDLEDOT",Fv="SEMI",lo="SLASH",Ud="TILDE",ng="UNDERSCORE",I5="EMOJI",rg="SYM";var M5=Object.freeze({__proto__:null,ALPHANUMERICAL:N5,AMPERSAND:Wm,APOSTROPHE:Km,ASCIINUMERICAL:E5,ASTERISK:Gm,AT:ga,BACKSLASH:qm,BACKTICK:Ym,CARET:Jm,CLOSEANGLEBRACKET:Pm,CLOSEBRACE:zd,CLOSEBRACKET:Dm,CLOSEPAREN:Rm,COLON:ka,COMMA:Lv,DOLLAR:Xm,DOT:ao,EMOJI:I5,EQUALS:Qm,EXCLAMATION:$v,FULLWIDTHGREATERTHAN:Vm,FULLWIDTHLEFTPAREN:Lm,FULLWIDTHLESSTHAN:Hm,FULLWIDTHMIDDLEDOT:j5,FULLWIDTHRIGHTPAREN:$m,HYPHEN:yi,LEFTCORNERBRACKET:zm,LEFTWHITECORNERBRACKET:Bm,LOCALHOST:Pf,NL:Pv,NUM:Ov,OPENANGLEBRACKET:Om,OPENBRACE:$d,OPENBRACKET:Mm,OPENPAREN:Am,PERCENT:Fd,PIPE:Zm,PLUS:eg,POUND:tg,QUERY:Bd,QUOTE:zv,RIGHTCORNERBRACKET:Fm,RIGHTWHITECORNERBRACKET:Um,SCHEME:Np,SEMI:Fv,SLASH:lo,SLASH_SCHEME:jc,SYM:rg,TILDE:Ud,TLD:rb,UNDERSCORE:ng,UTLD:sb,UWORD:nb,WORD:Oo,WS:ib});const Do=/[a-z]/,nd=/\p{L}/u,Ey=/\p{Emoji}/u,Ao=/\d/,Ny=/\s/,UT="\r",jy=`
`,hq="",pq="",Iy="";let Vh=null,Wh=null;function mq(t=[]){const e={};$s.groups=e;const n=new $s;Vh==null&&(Vh=HT(aq)),Wh==null&&(Wh=HT(lq)),Mt(n,"'",Km),Mt(n,"{",$d),Mt(n,"}",zd),Mt(n,"[",Mm),Mt(n,"]",Dm),Mt(n,"(",Am),Mt(n,")",Rm),Mt(n,"<",Om),Mt(n,">",Pm),Mt(n,"",Lm),Mt(n,"",$m),Mt(n,"",zm),Mt(n,"",Fm),Mt(n,"",Bm),Mt(n,"",Um),Mt(n,"",Hm),Mt(n,"",Vm),Mt(n,"&",Wm),Mt(n,"*",Gm),Mt(n,"@",ga),Mt(n,"`",Ym),Mt(n,"^",Jm),Mt(n,":",ka),Mt(n,",",Lv),Mt(n,"$",Xm),Mt(n,".",ao),Mt(n,"=",Qm),Mt(n,"!",$v),Mt(n,"-",yi),Mt(n,"%",Fd),Mt(n,"|",Zm),Mt(n,"+",eg),Mt(n,"#",tg),Mt(n,"?",Bd),Mt(n,'"',zv),Mt(n,"/",lo),Mt(n,";",Fv),Mt(n,"~",Ud),Mt(n,"_",ng),Mt(n,"\\",qm),Mt(n,"",j5);const r=mr(n,Ao,Ov,{[Q1]:!0});mr(r,Ao,r);const s=mr(r,Do,E5,{[Ld]:!0}),i=mr(r,nd,N5,{[yd]:!0}),o=mr(n,Do,Oo,{[Z1]:!0});mr(o,Ao,s),mr(o,Do,o),mr(s,Ao,s),mr(s,Do,s);const a=mr(n,nd,nb,{[eb]:!0});mr(a,Do),mr(a,Ao,i),mr(a,nd,a),mr(i,Ao,i),mr(i,Do),mr(i,nd,i);const l=Mt(n,jy,Pv,{[Cy]:!0}),u=Mt(n,UT,ib,{[Cy]:!0}),d=mr(n,Ny,ib,{[Cy]:!0});Mt(n,Iy,d),Mt(u,jy,l),Mt(u,Iy,d),mr(u,Ny,d),Mt(d,UT),Mt(d,jy),mr(d,Ny,d),Mt(d,Iy,d);const f=mr(n,Ey,I5,{[C5]:!0});Mt(f,"#"),mr(f,Ey,f),Mt(f,hq,f);const h=Mt(f,pq);Mt(h,"#"),mr(h,Ey,f);const p=[[Do,o],[Ao,s]],m=[[Do,null],[nd,a],[Ao,i]];for(let y=0;y<Vh.length;y++)sa(n,Vh[y],rb,Oo,p);for(let y=0;y<Wh.length;y++)sa(n,Wh[y],sb,nb,m);Rl(rb,{tld:!0,ascii:!0},e),Rl(sb,{utld:!0,alpha:!0},e),sa(n,"file",Np,Oo,p),sa(n,"mailto",Np,Oo,p),sa(n,"http",jc,Oo,p),sa(n,"https",jc,Oo,p),sa(n,"ftp",jc,Oo,p),sa(n,"ftps",jc,Oo,p),Rl(Np,{scheme:!0,ascii:!0},e),Rl(jc,{slashscheme:!0,ascii:!0},e),t=t.sort((y,b)=>y[0]>b[0]?1:-1);for(let y=0;y<t.length;y++){const b=t[y][0],v=t[y][1]?{[cq]:!0}:{[uq]:!0};b.indexOf("-")>=0?v[tb]=!0:Do.test(b)?Ao.test(b)?v[Ld]=!0:v[Z1]=!0:v[Q1]=!0,BT(n,b,b,v)}return BT(n,"localhost",Pf,{ascii:!0}),n.jd=new $s(rg),{start:n,tokens:Object.assign({groups:e},M5)}}function D5(t,e){const n=gq(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=n.length,s=[];let i=0,o=0;for(;o<r;){let a=t,l=null,u=0,d=null,f=-1,h=-1;for(;o<r&&(l=a.go(n[o]));)a=l,a.accepts()?(f=0,h=0,d=a):f>=0&&(f+=n[o].length,h++),u+=n[o].length,i+=n[o].length,o++;i-=f,o-=h,u-=f,s.push({t:d.t,v:e.slice(i-u,i),s:i-u,e:i})}return s}function gq(t){const e=[],n=t.length;let r=0;for(;r<n;){let s=t.charCodeAt(r),i,o=s<55296||s>56319||r+1===n||(i=t.charCodeAt(r+1))<56320||i>57343?t[r]:t.slice(r,r+2);e.push(o),r+=o.length}return e}function sa(t,e,n,r,s){let i;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];t.j[l]?i=t.j[l]:(i=new $s(r),i.jr=s.slice(),t.j[l]=i),t=i}return i=new $s(n),i.jr=s.slice(),t.j[e[o-1]]=i,i}function HT(t){const e=[],n=[];let r=0,s="0123456789";for(;r<t.length;){let i=0;for(;s.indexOf(t[r+i])>=0;)i++;if(i>0){e.push(n.join(""));for(let o=parseInt(t.substring(r,r+i),10);o>0;o--)n.pop();r+=i}else n.push(t[r]),r++}return e}const Lf={defaultProtocol:"http",events:null,format:VT,formatHref:VT,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Bv(t,e=null){let n=Object.assign({},Lf);t&&(n=Object.assign(n,t instanceof Bv?t.o:t));const r=n.ignoreTags,s=[];for(let i=0;i<r.length;i++)s.push(r[i].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=s}Bv.prototype={o:Lf,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let s=this.o[t];return s&&(typeof s=="object"?(s=n.t in s?s[n.t]:Lf[t],typeof s=="function"&&r&&(s=s(e,n))):typeof s=="function"&&r&&(s=s(e,n.t,n)),s)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function VT(t){return t}function A5(t,e){this.t="token",this.v=t,this.tk=e}A5.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=Lf.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),s=t.get("tagName",n,e),i=this.toFormattedString(t),o={},a=t.get("className",n,e),l=t.get("target",n,e),u=t.get("rel",n,e),d=t.getObj("attributes",n,e),f=t.getObj("events",n,e);return o.href=r,a&&(o.class=a),l&&(o.target=l),u&&(o.rel=u),d&&Object.assign(o,d),{tagName:s,attributes:o,content:i,eventListeners:f}}};function Qg(t,e){class n extends A5{constructor(s,i){super(s,i),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const WT=Qg("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),KT=Qg("text"),yq=Qg("nl"),Kh=Qg("url",{isLink:!0,toHref(t=Lf.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==Pf&&t[1].t===ka}}),mi=t=>new $s(t);function xq({groups:t}){const e=t.domain.concat([Wm,Gm,ga,qm,Ym,Jm,Xm,Qm,yi,Ov,Fd,Zm,eg,tg,lo,rg,Ud,ng]),n=[Km,ka,Lv,ao,$v,Fd,Bd,zv,Fv,Om,Pm,$d,zd,Dm,Mm,Am,Rm,Lm,$m,zm,Fm,Bm,Um,Hm,Vm],r=[Wm,Km,Gm,qm,Ym,Jm,Xm,Qm,yi,$d,zd,Fd,Zm,eg,tg,Bd,lo,rg,Ud,ng],s=mi(),i=Mt(s,Ud);kn(i,r,i),kn(i,t.domain,i);const o=mi(),a=mi(),l=mi();kn(s,t.domain,o),kn(s,t.scheme,a),kn(s,t.slashscheme,l),kn(o,r,i),kn(o,t.domain,o);const u=Mt(o,ga);Mt(i,ga,u),Mt(a,ga,u),Mt(l,ga,u);const d=Mt(i,ao);kn(d,r,i),kn(d,t.domain,i);const f=mi();kn(u,t.domain,f),kn(f,t.domain,f);const h=Mt(f,ao);kn(h,t.domain,f);const p=mi(WT);kn(h,t.tld,p),kn(h,t.utld,p),Mt(u,Pf,p);const m=Mt(f,yi);Mt(m,yi,m),kn(m,t.domain,f),kn(p,t.domain,f),Mt(p,ao,h),Mt(p,yi,m);const y=Mt(p,ka);kn(y,t.numeric,WT);const b=Mt(o,yi),g=Mt(o,ao);Mt(b,yi,b),kn(b,t.domain,o),kn(g,r,i),kn(g,t.domain,o);const v=mi(Kh);kn(g,t.tld,v),kn(g,t.utld,v),kn(v,t.domain,o),kn(v,r,i),Mt(v,ao,g),Mt(v,yi,b),Mt(v,ga,u);const w=Mt(v,ka),_=mi(Kh);kn(w,t.numeric,_);const D=mi(Kh),k=mi();kn(D,e,D),kn(D,n,k),kn(k,e,D),kn(k,n,k),Mt(v,lo,D),Mt(_,lo,D);const A=Mt(a,ka),N=Mt(l,ka),E=Mt(N,lo),S=Mt(E,lo);kn(a,t.domain,o),Mt(a,ao,g),Mt(a,yi,b),kn(l,t.domain,o),Mt(l,ao,g),Mt(l,yi,b),kn(A,t.domain,D),Mt(A,lo,D),Mt(A,Bd,D),kn(S,t.domain,D),kn(S,e,D),Mt(S,lo,D);const T=[[$d,zd],[Mm,Dm],[Am,Rm],[Om,Pm],[Lm,$m],[zm,Fm],[Bm,Um],[Hm,Vm]];for(let C=0;C<T.length;C++){const[O,P]=T[C],H=Mt(D,O);Mt(k,O,H),Mt(H,P,D);const M=mi(Kh);kn(H,e,M);const I=mi();kn(H,n),kn(M,e,M),kn(M,n,I),kn(I,e,M),kn(I,n,I),Mt(M,P,D),Mt(I,P,D)}return Mt(s,Pf,v),Mt(s,Pv,yq),{start:s,tokens:M5}}function bq(t,e,n){let r=n.length,s=0,i=[],o=[];for(;s<r;){let a=t,l=null,u=null,d=0,f=null,h=-1;for(;s<r&&!(l=a.go(n[s].t));)o.push(n[s++]);for(;s<r&&(u=l||a.go(n[s].t));)l=null,a=u,a.accepts()?(h=0,f=a):h>=0&&h++,s++,d++;if(h<0)s-=d,s<r&&(o.push(n[s]),s++);else{o.length>0&&(i.push(My(KT,e,o)),o=[]),s-=h,d-=h;const p=f.t,m=n.slice(s-d,s);i.push(My(p,e,m))}}return o.length>0&&i.push(My(KT,e,o)),i}function My(t,e,n){const r=n[0].s,s=n[n.length-1].e,i=e.slice(r,s);return new t(i,n)}const wq=typeof console<"u"&&console&&console.warn||(()=>{}),vq="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Xn={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function kq(){return $s.groups={},Xn.scanner=null,Xn.parser=null,Xn.tokenQueue=[],Xn.pluginQueue=[],Xn.customSchemes=[],Xn.initialized=!1,Xn}function GT(t,e=!1){if(Xn.initialized&&wq(`linkifyjs: already initialized - will not register custom scheme "${t}" ${vq}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Xn.customSchemes.push([t,e])}function Sq(){Xn.scanner=mq(Xn.customSchemes);for(let t=0;t<Xn.tokenQueue.length;t++)Xn.tokenQueue[t][1]({scanner:Xn.scanner});Xn.parser=xq(Xn.scanner.tokens);for(let t=0;t<Xn.pluginQueue.length;t++)Xn.pluginQueue[t][1]({scanner:Xn.scanner,parser:Xn.parser});return Xn.initialized=!0,Xn}function R5(t){return Xn.initialized||Sq(),bq(Xn.parser.start,t,D5(Xn.scanner.start,t))}R5.scan=D5;function Uv(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new Bv(n),s=R5(t),i=[];for(let o=0;o<s.length;o++){const a=s[o];a.isLink&&(!e||a.t===e)&&r.check(a)&&i.push(a.toFormattedObject(r))}return i}function _q(t){return new Mr({key:new as("autolink"),appendTransaction:(e,n,r)=>{const s=e.some(u=>u.docChanged)&&!n.doc.eq(r.doc),i=e.some(u=>u.getMeta("preventAutolink"));if(!s||i)return;const{tr:o}=r,a=rK(n.doc,[...e]);if(uK(a).forEach(({newRange:u})=>{const d=sK(r.doc,u,p=>p.isTextblock);let f,h;if(d.length>1?(f=d[0],h=r.doc.textBetween(f.pos,f.pos+f.node.nodeSize,void 0," ")):d.length&&r.doc.textBetween(u.from,u.to," "," ").endsWith(" ")&&(f=d[0],h=r.doc.textBetween(f.pos,u.to,void 0," ")),f&&h){const p=h.split(" ").filter(b=>b!=="");if(p.length<=0)return!1;const m=p[p.length-1],y=f.pos+h.lastIndexOf(m);if(!m)return!1;Uv(m).filter(b=>b.isLink).map(b=>({...b,from:y+b.start+1,to:y+b.end+1})).filter(b=>r.schema.marks.code?!r.doc.rangeHasMark(b.from,b.to,r.schema.marks.code):!0).filter(b=>t.validate?t.validate(b.value):!0).forEach(b=>{Dv(b.from,b.to,r.doc).some(g=>g.mark.type===t.type)||o.addMark(b.from,b.to,t.type.create({href:b.href}))})}}),!!o.steps.length)return o}})}function Tq(t){return new Mr({key:new as("handleClickLink"),props:{handleClick:(e,n,r)=>{var s,i;if(r.button!==0)return!1;let o=r.target;const a=[];for(;o.nodeName!=="DIV";)a.push(o),o=o.parentNode;if(!a.find(h=>h.nodeName==="A"))return!1;const l=x5(e.state,t.type.name),u=r.target,d=(s=u==null?void 0:u.href)!==null&&s!==void 0?s:l.href,f=(i=u==null?void 0:u.target)!==null&&i!==void 0?i:l.target;return u&&d?(window.open(d,f),!0):!1}}})}function Cq(t){return new Mr({key:new as("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{state:s}=e,{selection:i}=s,{empty:o}=i;if(o)return!1;let a="";r.content.forEach(u=>{a+=u.textContent});const l=Uv(a).find(u=>u.isLink&&u.value===a);return!a||!l?!1:(t.editor.commands.setMark(t.type,{href:l.href}),!0)}}})}const Eq=ai.create({name:"link",priority:1e3,keepOnSplit:!1,onCreate(){this.options.protocols.forEach(t=>{if(typeof t=="string"){GT(t);return}GT(t.scheme,t.optionalSlashes)})},onDestroy(){kq()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},validate:void 0}},addAttributes(){return{href:{default:null},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:'a[href]:not([href *= "javascript:" i])'}]},renderHTML({HTMLAttributes:t}){var e;return!((e=t.href)===null||e===void 0)&&e.startsWith("javascript:")?["a",Mn(this.options.HTMLAttributes,{...t,href:""}),0]:["a",Mn(this.options.HTMLAttributes,t),0]},addCommands(){return{setLink:t=>({chain:e})=>e().setMark(this.name,t).setMeta("preventAutolink",!0).run(),toggleLink:t=>({chain:e})=>e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run(),unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[qa({find:t=>{const e=[];if(t){const n=Uv(t).filter(r=>r.isLink);n.length&&n.forEach(r=>e.push({text:r.value,data:{href:r.href},index:r.start}))}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[];return this.options.autolink&&t.push(_q({type:this.type,validate:this.options.validate})),this.options.openOnClick&&t.push(Tq({type:this.type})),this.options.linkOnPaste&&t.push(Cq({editor:this.editor,type:this.type})),t}}),Nq=Kr.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,considerAnyAsEmpty:!1,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new Mr({key:new as("placeholder"),props:{decorations:({doc:t,selection:e})=>{var n;const r=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:s}=e,i=[];if(!r)return null;const{firstChild:o}=t.content,a=o&&o.type.isLeaf,l=o&&o.isAtom,u=this.options.considerAnyAsEmpty?!0:o&&o.type.name===((n=t.type.contentMatch.defaultType)===null||n===void 0?void 0:n.name),d=t.content.childCount<=1&&o&&u&&o.nodeSize<=2&&(!a||!l);return t.descendants((f,h)=>{const p=s>=h&&s<=h+f.nodeSize,m=!f.isLeaf&&!f.childCount;if((p||!this.options.showOnlyCurrent)&&m){const y=[this.options.emptyNodeClass];d&&y.push(this.options.emptyEditorClass);const b=Bs.node(h,h+f.nodeSize,{class:y.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:f,pos:h,hasAnchor:p}):this.options.placeholder});i.push(b)}return this.options.includeChildren}),kr.create(t,i)}}})]}}),jq=br.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",Mn(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}}),Iq=/^\s*(\[([( |x])?\])\s$/,Mq=br.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList"}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>t.getAttribute("data-checked")==="true",renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",Mn(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:n,editor:r})=>{const s=document.createElement("li"),i=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div");return i.contentEditable="false",a.type="checkbox",a.addEventListener("change",u=>{if(!r.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:d}=u.target;r.isEditable&&typeof n=="function"&&r.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:f})=>{const h=n(),p=f.doc.nodeAt(h);return f.setNodeMarkup(h,void 0,{...p==null?void 0:p.attrs,checked:d}),!0}).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,d)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([u,d])=>{s.setAttribute(u,d)}),s.dataset.checked=t.attrs.checked,t.attrs.checked&&a.setAttribute("checked","checked"),i.append(a,o),s.append(i,l),Object.entries(e).forEach(([u,d])=>{s.setAttribute(u,d)}),{dom:s,contentDOM:l,update:u=>u.type!==this.type?!1:(s.dataset.checked=u.attrs.checked,u.attrs.checked?a.setAttribute("checked","checked"):a.removeAttribute("checked"),!0)}}},addInputRules(){return[Eu({find:Iq,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),Dq=t=>{if(!t.children.length)return;const e=t.querySelectorAll("span");e&&e.forEach(n=>{var r,s;const i=n.getAttribute("style"),o=(s=(r=n.parentElement)===null||r===void 0?void 0:r.closest("span"))===null||s===void 0?void 0:s.getAttribute("style");n.setAttribute("style",`${o};${i}`)})},Aq=ai.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{},mergeNestedSpanStyles:!1}},parseHTML(){return[{tag:"span",getAttrs:t=>t.hasAttribute("style")?(this.options.mergeNestedSpanStyles&&Dq(t),{}):!1}]},renderHTML({HTMLAttributes:t}){return["span",Mn(this.options.HTMLAttributes,t),0]},addCommands(){return{removeEmptyTextStyle:()=>({tr:t})=>{const{selection:e}=t;return t.doc.nodesBetween(e.from,e.to,(n,r)=>{if(n.isTextblock)return!0;n.marks.filter(s=>s.type===this.type).some(s=>Object.values(s.attrs).some(i=>!!i))||t.removeMark(r,r+n.nodeSize,this.type)}),!0}}}}),Rq=Kr.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:t=>{var e;return(e=t.style.color)===null||e===void 0?void 0:e.replace(/['"]+/g,"")},renderHTML:t=>t.color?{style:`color: ${t.color}`}:{}}}}]},addCommands(){return{setColor:t=>({chain:e})=>e().setMark("textStyle",{color:t}).run(),unsetColor:()=>({chain:t})=>t().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}),Oq=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))$/,Pq=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))/g,Lq=ai.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",Mn(this.options.HTMLAttributes,t),0]},addCommands(){return{setHighlight:t=>({commands:e})=>e.setMark(this.name,t),toggleHighlight:t=>({commands:e})=>e.toggleMark(this.name,t),unsetHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[ec({find:Oq,type:this.type})]},addPasteRules(){return[qa({find:Pq,type:this.type})]}}),sg=(t,e)=>e.view.domAtPos(t).node.offsetParent!==null,$q=(t,e,n)=>{for(let r=t.depth;r>0;r-=1){const s=t.node(r),i=e(s),o=sg(t.start(r),n);if(i&&o)return{pos:r>0?t.before(r):0,start:t.start(r),depth:r,node:s}}},qT=(t,e)=>{const{state:n,view:r,extensionManager:s}=t,{schema:i,selection:o}=n,{empty:a,$anchor:l}=o,u=!!s.extensions.find(g=>g.name==="gapCursor");if(!a||l.parent.type!==i.nodes.detailsSummary||!u||e==="right"&&l.parentOffset!==l.parent.nodeSize-2)return!1;const d=Fu(g=>g.type===i.nodes.details)(o);if(!d)return!1;const f=Tp(d.node,g=>g.type===i.nodes.detailsContent);if(!f.length||sg(d.start+f[0].pos+1,t))return!1;const p=n.doc.resolve(d.pos+d.node.nodeSize),m=sr.findFrom(p,1,!1);if(!m)return!1;const{tr:y}=n,b=new sr(m);return y.setSelection(b),y.scrollIntoView(),r.dispatch(y),!0},zq=br.create({name:"details",content:"detailsSummary detailsContent",group:"block",defining:!0,isolating:!0,allowGapCursor:!1,addOptions(){return{persist:!1,openClassName:"is-open",HTMLAttributes:{}}},addAttributes(){return this.options.persist?{open:{default:!1,parseHTML:t=>t.hasAttribute("open"),renderHTML:({open:t})=>t?{open:""}:{}}}:[]},parseHTML(){return[{tag:"details"}]},renderHTML({HTMLAttributes:t}){return["details",Mn(this.options.HTMLAttributes,t),0]},addNodeView(){return({editor:t,getPos:e,node:n,HTMLAttributes:r})=>{const s=document.createElement("div"),i=Mn(this.options.HTMLAttributes,r,{"data-type":this.name});Object.entries(i).forEach(([u,d])=>s.setAttribute(u,d));const o=document.createElement("button");o.type="button",s.append(o);const a=document.createElement("div");s.append(a);const l=u=>{if(u!==void 0)if(u){if(s.classList.contains(this.options.openClassName))return;s.classList.add(this.options.openClassName)}else{if(!s.classList.contains(this.options.openClassName))return;s.classList.remove(this.options.openClassName)}else s.classList.toggle(this.options.openClassName);const d=new Event("toggleDetailsContent"),f=a.querySelector(':scope > div[data-type="detailsContent"]');f==null||f.dispatchEvent(d)};return n.attrs.open&&setTimeout(()=>l()),o.addEventListener("click",()=>{if(l(),!this.options.persist){t.commands.focus(void 0,{scrollIntoView:!1});return}if(t.isEditable&&typeof e=="function"){const{from:u,to:d}=t.state.selection;t.chain().command(({tr:f})=>{const h=e(),p=f.doc.nodeAt(h);return(p==null?void 0:p.type)!==this.type?!1:(f.setNodeMarkup(h,void 0,{open:!p.attrs.open}),!0)}).setTextSelection({from:u,to:d}).focus(void 0,{scrollIntoView:!1}).run()}}),{dom:s,contentDOM:a,ignoreMutation(u){return u.type==="selection"?!1:!s.contains(u.target)||s===u.target},update:u=>u.type!==this.type?!1:(u.attrs.open!==void 0&&l(u.attrs.open),!0)}}},addCommands(){return{setDetails:()=>({state:t,chain:e})=>{var n;const{schema:r,selection:s}=t,{$from:i,$to:o}=s,a=i.blockRange(o);if(!a)return!1;const l=t.doc.slice(a.start,a.end);if(!r.nodes.detailsContent.contentMatch.matchFragment(l.content))return!1;const d=((n=l.toJSON())===null||n===void 0?void 0:n.content)||[];return e().insertContentAt({from:a.start,to:a.end},{type:this.name,content:[{type:"detailsSummary"},{type:"detailsContent",content:d}]}).setTextSelection(a.start+2).run()},unsetDetails:()=>({state:t,chain:e})=>{const{selection:n,schema:r}=t,s=Fu(g=>g.type===this.type)(n);if(!s)return!1;const i=Tp(s.node,g=>g.type===r.nodes.detailsSummary),o=Tp(s.node,g=>g.type===r.nodes.detailsContent);if(!i.length||!o.length)return!1;const a=i[0],l=o[0],u=s.pos,d=t.doc.resolve(u),f=u+s.node.nodeSize,h={from:u,to:f},p=l.node.content.toJSON()||[],m=d.parent.type.contentMatch.defaultType,b=[m==null?void 0:m.create(null,a.node.content).toJSON(),...p];return e().insertContentAt(h,b).setTextSelection(u+1).run()}}},addKeyboardShortcuts(){return{Backspace:()=>{const{schema:t,selection:e}=this.editor.state,{empty:n,$anchor:r}=e;return!n||r.parent.type!==t.nodes.detailsSummary?!1:r.parentOffset!==0?this.editor.commands.command(({tr:s})=>{const i=r.pos-1,o=r.pos;return s.delete(i,o),!0}):this.editor.commands.unsetDetails()},Enter:({editor:t})=>{const{state:e,view:n}=t,{schema:r,selection:s}=e,{$head:i}=s;if(i.parent.type!==r.nodes.detailsSummary)return!1;const o=sg(i.after()+1,t),a=o?e.doc.nodeAt(i.after()):i.node(-2);if(!a)return!1;const l=o?0:i.indexAfter(-1),u=Mv(a.contentMatchAt(l));if(!u||!a.canReplaceWith(l,l,u))return!1;const d=u.createAndFill();if(!d)return!1;const f=o?i.after()+1:i.after(-1),h=e.tr.replaceWith(f,f,d),p=h.doc.resolve(f),m=bn.near(p,1);return h.setSelection(m),h.scrollIntoView(),n.dispatch(h),!0},ArrowRight:({editor:t})=>qT(t,"right"),ArrowDown:({editor:t})=>qT(t,"down")}},addProseMirrorPlugins(){return[new Mr({key:new as("detailsSelection"),appendTransaction:(t,e,n)=>{const{editor:r,type:s}=this;if(!t.some(b=>b.selectionSet)||!e.selection.empty||!n.selection.empty||!b5(n,s.name))return;const{$from:a}=n.selection;if(sg(a.pos,r))return;const u=$q(a,b=>b.type===s,r);if(!u)return;const d=Tp(u.node,b=>b.type===n.schema.nodes.detailsSummary);if(!d.length)return;const f=d[0],p=(e.selection.from<n.selection.from?"forward":"backward")==="forward"?u.start+f.pos:u.pos+f.pos+f.node.nodeSize,m=mn.create(n.doc,p);return n.tr.setSelection(m)}})]}}),Fq=br.create({name:"detailsSummary",content:"text*",defining:!0,selectable:!1,isolating:!0,addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"summary"}]},renderHTML({HTMLAttributes:t}){return["summary",Mn(this.options.HTMLAttributes,t),0]}}),Bq=br.create({name:"detailsContent",content:"block+",defining:!0,selectable:!1,addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:`div[data-type="${this.name}"]`}]},renderHTML({HTMLAttributes:t}){return["div",Mn(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},addNodeView(){return({HTMLAttributes:t})=>{const e=document.createElement("div"),n=Mn(this.options.HTMLAttributes,t,{"data-type":this.name,hidden:"hidden"});return Object.entries(n).forEach(([r,s])=>e.setAttribute(r,s)),e.addEventListener("toggleDetailsContent",()=>{e.toggleAttribute("hidden")}),{dom:e,contentDOM:e,ignoreMutation(r){return r.type==="selection"?!1:!e.contains(r.target)||e===r.target},update:r=>r.type===this.type}}},addKeyboardShortcuts(){return{Enter:({editor:t})=>{const{state:e,view:n}=t,{selection:r}=e,{$from:s,empty:i}=r,o=Fu(T=>T.type===this.type)(r);if(!i||!o||!o.node.childCount)return!1;const a=s.index(o.depth),{childCount:l}=o.node;if(!(l===a+1))return!1;const d=o.node.type.contentMatch.defaultType,f=d==null?void 0:d.createAndFill();if(!f)return!1;const h=e.doc.resolve(o.pos+1),p=l-1,m=o.node.child(p),y=h.posAtIndex(p,o.depth);if(!m.eq(f))return!1;const g=s.node(-3);if(!g)return!1;const v=s.indexAfter(-3),w=Mv(g.contentMatchAt(v));if(!w||!g.canReplaceWith(v,v,w))return!1;const _=w.createAndFill();if(!_)return!1;const{tr:D}=e,k=s.after(-2);D.replaceWith(k,k,_);const A=D.doc.resolve(k),N=bn.near(A,1);D.setSelection(N);const E=y,S=y+m.nodeSize;return D.delete(E,S),D.scrollIntoView(),n.dispatch(D),!0}}}});function Uq(t){var e;const{char:n,allowSpaces:r,allowToIncludeChar:s,allowedPrefixes:i,startOfLine:o,$position:a}=t,l=r&&!s,u=KK(n),d=new RegExp(`\\s${u}$`),f=o?"^":"",h=s?"":u,p=l?new RegExp(`${f}${u}.*?(?=\\s${h}|$)`,"gm"):new RegExp(`${f}(?:^)?${u}[^\\s${h}]*`,"gm"),m=((e=a.nodeBefore)===null||e===void 0?void 0:e.isText)&&a.nodeBefore.text;if(!m)return null;const y=a.pos-m.length,b=Array.from(m.matchAll(p)).pop();if(!b||b.input===void 0||b.index===void 0)return null;const g=b.input.slice(Math.max(0,b.index-1),b.index),v=new RegExp(`^[${i==null?void 0:i.join("")}\0]?$`).test(g);if(i!==null&&!v)return null;const w=y+b.index;let _=w+b[0].length;return l&&d.test(m.slice(_-1,_+1))&&(b[0]+=" ",_+=1),w<a.pos&&_>=a.pos?{range:{from:w,to:_},query:b[0].slice(n.length),text:b[0]}:null}const Hq=new as("suggestion");function Vq({pluginKey:t=Hq,editor:e,char:n="@",allowSpaces:r=!1,allowToIncludeChar:s=!1,allowedPrefixes:i=[" "],startOfLine:o=!1,decorationTag:a="span",decorationClass:l="suggestion",decorationContent:u="",decorationEmptyClass:d="is-empty",command:f=()=>null,items:h=()=>[],render:p=()=>({}),allow:m=()=>!0,findSuggestionMatch:y=Uq}){let b;const g=p==null?void 0:p(),v=new Mr({key:t,view(){return{update:async(w,_)=>{var D,k,A,N,E,S,T;const C=(D=this.key)===null||D===void 0?void 0:D.getState(_),O=(k=this.key)===null||k===void 0?void 0:k.getState(w.state),P=C.active&&O.active&&C.range.from!==O.range.from,H=!C.active&&O.active,M=C.active&&!O.active,I=!H&&!M&&C.query!==O.query,K=H||P&&I,G=I||P,R=M||P&&I;if(!K&&!G&&!R)return;const Ee=R&&!K?C:O,ge=w.dom.querySelector(`[data-decoration-id="${Ee.decorationId}"]`);b={editor:e,range:Ee.range,query:Ee.query,text:Ee.text,items:[],command:F=>f({editor:e,range:Ee.range,props:F}),decorationNode:ge,clientRect:ge?()=>{var F;const{decorationId:B}=(F=this.key)===null||F===void 0?void 0:F.getState(e.state),se=w.dom.querySelector(`[data-decoration-id="${B}"]`);return(se==null?void 0:se.getBoundingClientRect())||null}:null},K&&((A=g==null?void 0:g.onBeforeStart)===null||A===void 0||A.call(g,b)),G&&((N=g==null?void 0:g.onBeforeUpdate)===null||N===void 0||N.call(g,b)),(G||K)&&(b.items=await h({editor:e,query:Ee.query})),R&&((E=g==null?void 0:g.onExit)===null||E===void 0||E.call(g,b)),G&&((S=g==null?void 0:g.onUpdate)===null||S===void 0||S.call(g,b)),K&&((T=g==null?void 0:g.onStart)===null||T===void 0||T.call(g,b))},destroy:()=>{var w;b&&((w=g==null?void 0:g.onExit)===null||w===void 0||w.call(g,b))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(w,_,D,k){const{isEditable:A}=e,{composing:N}=e.view,{selection:E}=w,{empty:S,from:T}=E,C={..._};if(C.composing=N,A&&(S||e.view.composing)){(T<_.range.from||T>_.range.to)&&!N&&!_.composing&&(C.active=!1);const O=y({char:n,allowSpaces:r,allowToIncludeChar:s,allowedPrefixes:i,startOfLine:o,$position:E.$from}),P=`id_${Math.floor(Math.random()*4294967295)}`;O&&m({editor:e,state:k,range:O.range,isActive:_.active})?(C.active=!0,C.decorationId=_.decorationId?_.decorationId:P,C.range=O.range,C.query=O.query,C.text=O.text):C.active=!1}else C.active=!1;return C.active||(C.decorationId=null,C.range={from:0,to:0},C.query=null,C.text=null),C}},props:{handleKeyDown(w,_){var D;const{active:k,range:A}=v.getState(w.state);return k&&((D=g==null?void 0:g.onKeyDown)===null||D===void 0?void 0:D.call(g,{view:w,event:_,range:A}))||!1},decorations(w){const{active:_,range:D,decorationId:k,query:A}=v.getState(w);if(!_)return null;const N=!(A!=null&&A.length),E=[l];return N&&E.push(d),kr.create(w.doc,[Bs.inline(D.from,D.to,{nodeName:a,class:E.join(" "),"data-decoration-id":k,"data-decoration-content":u})])}}});return v}function Wq({editor:t,overrideSuggestionOptions:e,extensionName:n,char:r="@"}){const s=new as;return{editor:t,char:r,pluginKey:s,command:({editor:i,range:o,props:a})=>{var l,u,d;const f=i.view.state.selection.$to.nodeAfter;((l=f==null?void 0:f.text)===null||l===void 0?void 0:l.startsWith(" "))&&(o.to+=1),i.chain().focus().insertContentAt(o,[{type:n,attrs:{...a,mentionSuggestionChar:r}},{type:"text",text:" "}]).run(),(d=(u=i.view.dom.ownerDocument.defaultView)===null||u===void 0?void 0:u.getSelection())===null||d===void 0||d.collapseToEnd()},allow:({state:i,range:o})=>{const a=i.doc.resolve(o.from),l=i.schema.nodes[n];return!!a.parent.type.contentMatch.matchType(l)},...e}}function O5(t){return(t.options.suggestions.length?t.options.suggestions:[t.options.suggestion]).map(e=>Wq({editor:t.editor,overrideSuggestionOptions:e,extensionName:t.name,char:e.char}))}function YT(t,e){const n=O5(t),r=n.find(s=>s.char===e);return r||(n.length?n[0]:null)}const Kq=br.create({name:"mention",priority:101,addOptions(){return{HTMLAttributes:{},renderText({node:t,suggestion:e}){var n,r;return`${(n=e==null?void 0:e.char)!==null&&n!==void 0?n:"@"}${(r=t.attrs.label)!==null&&r!==void 0?r:t.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:t,node:e,suggestion:n}){var r,s;return["span",Mn(this.HTMLAttributes,t.HTMLAttributes),`${(r=n==null?void 0:n.char)!==null&&r!==void 0?r:"@"}${(s=e.attrs.label)!==null&&s!==void 0?s:e.attrs.id}`]},suggestions:[],suggestion:{}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}},mentionSuggestionChar:{default:"@",parseHTML:t=>t.getAttribute("data-mention-suggestion-char"),renderHTML:t=>({"data-mention-suggestion-char":t.mentionSuggestionChar})}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:e}){const n=YT(this,t.attrs.mentionSuggestionChar);if(this.options.renderLabel!==void 0)return console.warn("renderLabel is deprecated use renderText and renderHTML instead"),["span",Mn({"data-type":this.name},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:t,suggestion:n})];const r={...this.options};r.HTMLAttributes=Mn({"data-type":this.name},this.options.HTMLAttributes,e);const s=this.options.renderHTML({options:r,node:t,suggestion:n});return typeof s=="string"?["span",Mn({"data-type":this.name},this.options.HTMLAttributes,e),s]:s},renderText({node:t}){const e={options:this.options,node:t,suggestion:YT(this,t.attrs.mentionSuggestionChar)};return this.options.renderLabel!==void 0?(console.warn("renderLabel is deprecated use renderText and renderHTML instead"),this.options.renderLabel(e)):this.options.renderText(e)},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:t,state:e})=>{let n=!1;const{selection:r}=e,{empty:s,anchor:i}=r;if(!s)return!1;e.doc.nodesBetween(i-1,i,(l,u)=>{if(l.type.name===this.name)return n=!0,t.insertText(this.options.deleteTriggerWithBackspace?"":this.options.suggestion.char||"",u,u+l.nodeSize),!1});let o=new Ko,a=0;return e.doc.nodesBetween(i-1,i,(l,u)=>{if(l.type.name===this.name)return n=!0,o=l,a=u,!1}),n&&t.insertText(this.options.deleteTriggerWithBackspace?"":o.attrs.mentionSuggestionChar,a,a+o.nodeSize),n})}},addProseMirrorPlugins(){return O5(this).map(Vq)}}),Gq=(t,e)=>Kr.create({name:"keyboardNavigation",addKeyboardShortcuts(){return{Enter:()=>(e&&e(),!1),Tab:({editor:n})=>{var a;if(n.isEmpty)return!1;const{state:r}=n,{selection:s}=r,{$from:i}=s;return((a=i.node(-1))==null?void 0:a.type.name)==="listItem"?n.commands.sinkListItem("listItem"):n.commands.insertContent("")},"Shift-Tab":({editor:n})=>{var a;if(n.isEmpty)return!1;const{state:r}=n,{selection:s}=r,{$from:i}=s;if(((a=i.node(-1))==null?void 0:a.type.name)==="listItem")return n.commands.liftListItem("listItem");{const{$anchor:l}=s,d=l.parent.textContent.substring(0,l.parentOffset).match(/[\u00A0 ]{1,4}$/);if(d){const f=l.pos-d[0].length,h=l.pos;return n.commands.deleteRange({from:f,to:h}),!0}}return!0},"Mod-Enter":()=>t?(t(),!0):!1,Escape:()=>!1,"Mod-Alt-5":({editor:n})=>n.chain().focus().toggleBulletList().run(),"Mod-Alt-6":({editor:n})=>n.chain().focus().toggleOrderedList().run(),"Mod-Alt-7":({editor:n})=>n.isActive("details")?n.chain().focus().unsetDetails().run():n.chain().focus().setDetails().run()}}}),qq=ai.create({name:"timestamp",inclusive:!1,excludes:"",addAttributes(){return{time:{default:0,parseHTML:t=>parseInt(t.getAttribute("data-time")||"0",10),renderHTML:t=>t.time?{"data-time":t.time}:{}},recordingId:{default:null,parseHTML:t=>t.getAttribute("data-recording-id"),renderHTML:t=>t.recordingId?{"data-recording-id":t.recordingId,class:"timestamp-marker cursor-pointer hover:bg-indigo-100/50 hover:text-indigo-800 transition-colors rounded-sm px-[1px]",title:`Jump to ${Math.floor(t.time/1e3)}s`}:{}}}},parseHTML(){return[{tag:"span[data-time]"}]},renderHTML({HTMLAttributes:t}){return["span",Mn(t),0]}}),Yq=br.create({name:"paragraph",priority:1e3,group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",Mn(t),0]},addAttributes(){return{"data-paragraph-id":{default:null,parseHTML:t=>t.getAttribute("data-paragraph-id"),renderHTML:t=>t["data-paragraph-id"]?{"data-paragraph-id":t["data-paragraph-id"]}:{}},"data-timestamp":{default:null,parseHTML:t=>t.getAttribute("data-timestamp"),renderHTML:t=>t["data-timestamp"]?{"data-timestamp":t["data-timestamp"],class:"cursor-pointer hover:bg-indigo-50/50 transition-colors rounded px-1 -mx-1",title:"Click to play audio"}:{}}}}}),Jq=ai.create({name:"attachmentLink",addAttributes(){return{attachmentUrls:{default:[],parseHTML:t=>{const e=t.getAttribute("data-attachment-urls");return e?JSON.parse(e):[]},renderHTML:t=>!t.attachmentUrls||t.attachmentUrls.length===0?{}:{"data-attachment-urls":JSON.stringify(t.attachmentUrls)}}}},parseHTML(){return[{tag:"span[data-attachment-link]"}]},renderHTML({HTMLAttributes:t}){return["span",Mn(t,{"data-attachment-link":"true",class:"attachment-link-text cursor-pointer"}),0]}}),Xq=({node:t})=>null,Qq=br.create({name:"audioMarker",group:"inline",inline:!0,atom:!0,addAttributes(){return{id:{default:null},time:{default:null},label:{default:"0:00"},fileName:{default:null}}},parseHTML(){return[{tag:'span[data-type="audio-marker"]'}]},renderHTML({HTMLAttributes:t}){return["span",Mn(t,{"data-type":"audio-marker"})]},addNodeView(){return oG(Xq)}}),Zg=x.forwardRef(({initialContent:t,onChange:e,onExit:n,onPolish:r,onEditorReady:s,editable:i=!0,className:o="",placeholder:a="",textSizeClass:l="text-base",descFontClass:u="font-normal",autoFocus:d=!1,onAudioMarkerClick:f,activeMarkerIds:h,onMarkersChange:p,attachments:m=[],taskColor:y="#6366f1",availableTags:b=[],onCreateTag:g},v)=>{const{t:w}=x.useContext(jn),[_,D]=x.useState(!1),[k,A]=x.useState({top:0,left:0}),N=x.useRef(null),E=x.useRef(b),S=x.useRef(g),T=x.useRef(!1),C=x.useRef(e);x.useEffect(()=>{E.current=b},[b]),x.useEffect(()=>{S.current=g},[g]),x.useEffect(()=>{C.current=e},[e]);const[O,P]=x.useState(!1),[H,M]=x.useState({top:0,left:0}),[I,K]=x.useState(null),[G,R]=x.useState([]),[Ee,ge]=x.useState(!1),[F,B]=x.useState({top:0,left:0}),[se,We]=x.useState([]);x.useImperativeHandle(v,()=>({toggleRecording:()=>{},chain:()=>{var ee;return(ee=Ke.current)==null?void 0:ee.chain()},focus:()=>{var ee;return(ee=Ke.current)==null?void 0:ee.commands.focus()},insertContent:ee=>{var ie;return(ie=Ke.current)==null?void 0:ie.commands.insertContent(ee)},getEditor:()=>Ke.current}));const ut=x.useContext(Ru),oe=(ut==null?void 0:ut.isRecording)||!1,je=(ut==null?void 0:ut.recordingTime)||0,te=(ut==null?void 0:ut.addMarker)||(()=>null),$e=(ut==null?void 0:ut.currentRecordingId)||null,Te=x.useRef(je),Je=x.useRef($e),Ye=x.useRef(oe);x.useEffect(()=>{Te.current=je,Je.current=$e,Ye.current=oe},[je,$e,oe]);const Ke=x.useRef(null);x.useEffect(()=>{window.__activeMarkerIds=h,window.dispatchEvent(new CustomEvent("active-markers-change",{detail:{ids:h}}))},[h]),x.useEffect(()=>{const ee=ie=>{var ce;f&&((ce=ie.detail)==null?void 0:ce.time)!==void 0&&f(ie.detail.time)};return window.addEventListener("audio-marker-click",ee),()=>{window.removeEventListener("audio-marker-click",ee)}},[f]);const lt=ee=>{const ie=Math.floor(ee/1e3),ce=Math.floor(ie/60),Z=ie%60;return`${ce.toString().padStart(2,"0")}:${Z.toString().padStart(2,"0")}`},St=()=>{if(oe&&Ke.current){const ee=te();if(ee){const{id:ie,time:ce}=ee;console.log("Enter pressed during recording at:",ce);const Z=lt(ce);Ke.current.chain().insertContent({type:"audioMarker",attrs:{id:ie,time:ce,label:Z}}).insertContent(" ").run()}}},X=ZK({extensions:[oq.configure({paragraph:!1,bulletList:{keepMarks:!0,keepAttributes:!1},orderedList:{keepMarks:!0,keepAttributes:!1}}),Yq,qq,Qq,Aq,Rq,Lq.configure({multicolor:!0}),Eq.configure({openOnClick:!1,autolink:!0}),Nq.configure({placeholder:a||w("addNotePlaceholder"),emptyEditorClass:"is-editor-empty before:content-[attr(data-placeholder)] before:text-slate-300 before:float-left before:pointer-events-none before:h-0"}),jq,Mq.configure({nested:!0}),zq.configure({persist:!0,HTMLAttributes:{class:"details"}}),Fq,Bq,Jq,Kq.configure({HTMLAttributes:{class:"tag-mention"},renderLabel({node:ee}){return ee.attrs.label??ee.attrs.id},suggestion:{char:"@",allowSpaces:!1,items:({query:ee})=>{const ie=E.current;if(!ee)return ie.slice(0,10);const ce=ee.toLowerCase();return ie.filter(ne=>ne.name.toLowerCase().includes(ce)).slice(0,10)},render:()=>{let ee=null,ie=0,ce=[],Z=null;return{onStart:ne=>{var Ie;T.current=!0,ce=ne.items,ie=0,ee=document.createElement("div"),ee.className="mention-suggestion-popup fixed z-[99999] bg-white dark:bg-gray-800 shadow-lg rounded-lg border border-gray-200 dark:border-gray-700 py-1 min-w-[200px] max-w-[300px] max-h-[300px] overflow-y-auto",document.body.appendChild(ee),Z={command:ne.command,query:ne.query,range:ne.range,onKeyDown:({event:fe})=>{if(fe.key==="ArrowDown"){fe.preventDefault();const Oe=ce.length>0?ce.length:0,xt=(Z==null?void 0:Z.query)&&Z.query.trim().length>0?Oe+1:Oe;return ie=(ie+1)%xt,Z==null||Z.updateItems(ce,Z.query),!0}if(fe.key==="ArrowUp"){fe.preventDefault();const et=(Z==null?void 0:Z.query)&&Z.query.trim().length>0?ce.length+1:ce.length;return ie=(ie-1+et)%et,Z==null||Z.updateItems(ce,Z.query),!0}return fe.key==="Enter"?(fe.preventDefault(),Z==null||Z.selectItem(ie),!0):fe.key==="Escape"?(fe.preventDefault(),!0):!1},updateItems:(fe,Oe)=>{if(ce=fe,!ee)return;const et=Oe&&Oe.trim().length>0&&!fe.some(xt=>xt.name.toLowerCase()===Oe.toLowerCase());if(ee.innerHTML="",fe.length===0&&!et){ee.innerHTML='<div class="px-3 py-2 text-sm text-gray-400"></div>';return}if(fe.forEach((xt,It)=>{const ue=document.createElement("div");ue.className=`px-3 py-2 cursor-pointer flex items-center gap-2 text-sm ${It===ie?"bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,ue.innerHTML=`
                                                <span class="w-2 h-2 rounded-full" style="background-color: ${xt.color||"#6366f1"}"></span>
                                                <span class="truncate">${xt.name}</span>
                                            `,ue.addEventListener("mouseenter",()=>{ie=It,Z==null||Z.updateItems(ce,Oe)}),ue.addEventListener("mousedown",Ne=>{Ne.preventDefault(),Z==null||Z.selectItem(It)}),ee.appendChild(ue)}),et){const xt=fe.length,It=document.createElement("div");It.className=`px-3 py-2 cursor-pointer flex items-center gap-2 text-sm border-t border-gray-100 dark:border-gray-700 ${ie===xt?"bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,It.innerHTML=`
                                                <span class="text-green-500">+</span>
                                                <span> "<strong>${Oe}</strong>"</span>
                                            `,It.addEventListener("mouseenter",()=>{ie=xt,Z==null||Z.updateItems(ce,Oe)}),It.addEventListener("mousedown",ue=>{ue.preventDefault(),Z==null||Z.selectItem(xt)}),ee.appendChild(It)}},selectItem:async fe=>{const Oe=(Z==null?void 0:Z.query)&&Z.query.trim().length>0&&!ce.some(ue=>ue.name.toLowerCase()===Z.query.toLowerCase()),et=Z==null?void 0:Z.command,xt=Z==null?void 0:Z.range,It=Ke.current;if(fe<ce.length){const ue=ce[fe];et&&et({id:ue.id,label:ue.name})}else if(Oe&&S.current&&xt&&It){const ue=Z.query.trim(),{from:Ne,to:Ue}=xt;ee&&(ee.remove(),ee=null),T.current=!1;const Ze=await S.current(ue);Ze&&Ke.current&&Ke.current.chain().focus().deleteRange({from:Ne,to:Ue}).insertContentAt(Ne,{type:"mention",attrs:{id:Ze.id,label:Ze.name}}).run()}}},Z.updateItems(ce,ne.query);const Se=(Ie=ne.clientRect)==null?void 0:Ie.call(ne);Se&&ee&&(ee.style.left=`${Se.left}px`,ee.style.top=`${Se.bottom+5}px`)},onUpdate:ne=>{var Ie;ce=ne.items,Z&&(Z.query=ne.query,Z.range=ne.range,ie=0,Z.updateItems(ce,ne.query));const Se=(Ie=ne.clientRect)==null?void 0:Ie.call(ne);Se&&ee&&(ee.style.left=`${Se.left}px`,ee.style.top=`${Se.bottom+5}px`)},onKeyDown:ne=>(Z==null?void 0:Z.onKeyDown(ne))??!1,onExit:()=>{T.current=!1,ee&&(ee.remove(),ee=null),Z=null}}}}}),Gq(n,St)],content:t,editable:i,editorProps:{attributes:{class:`prose prose-sm max-w-none focus:outline-none min-h-[100px] text-theme-secondary ${l} ${u} leading-relaxed custom-scrollbar selection:bg-indigo-100`,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"}},onUpdate:({editor:ee})=>{if(!window.__imeComposing){if(e){const ie=ee.getHTML();e(ee.isEmpty?"":ie)}if(p){const ie=[];ee.state.doc.descendants(ce=>{ce.type.name==="audioMarker"&&ce.attrs.id&&ie.push({id:ce.attrs.id,time:ce.attrs.time||0})}),p(ie)}}},onCreate:({editor:ee})=>{if(s&&s(ee),p){const ie=[];ee.state.doc.descendants(ce=>{ce.type.name==="audioMarker"&&ce.attrs.id&&ie.push({id:ce.attrs.id,time:ce.attrs.time||0})}),p(ie)}},onSelectionUpdate:({editor:ee})=>{if(window.__imeComposing)return;N.current&&clearTimeout(N.current);const{from:ie,to:ce}=ee.state.selection;ie!==ce&&i?N.current=setTimeout(()=>{const Z=window.getSelection();if(Z&&Z.rangeCount>0){const Se=Z.getRangeAt(0).getBoundingClientRect(),Ie={top:Se.bottom+5,left:Se.left+Se.width/2};A(Ie),M(Ie),D(!0)}},500):(D(!1),P(!1))}});return x.useEffect(()=>{if(!X)return;const ee=({transaction:Se})=>{if(!window.__imeComposing&&Ye.current&&Te.current>=0&&Se.docChanged){const Ie=Te.current,{selection:fe}=X.state;if(!fe.empty)return;const Oe=fe.$from,et=Oe.parent.textContent.substring(0,Oe.parentOffset),xt=et.lastIndexOf("@");if(xt!==-1&&!et.substring(xt+1).includes(" ")||T.current)return;const ue=Oe.marks().find(Ue=>Ue.type.name==="timestamp");let Ne=!0;if(ue){const Ue=ue.attrs.time;Ie-Ue<2e3&&(Ne=!1)}if(Ne){const Ue=Je.current;X.commands.setMark("timestamp",{time:Ie,recordingId:Ue})}else ue&&X.commands.setMark("timestamp",ue.attrs)}};let ie=null;const ce=()=>{window.__imeComposing=!0,X&&(ie=X.state.selection.from)},Z=()=>{if(window.__imeComposing=!1,Ye.current&&Te.current>=0&&X&&ie!==null){const Se=Te.current,Ie=Je.current,fe=ie;ie=null,setTimeout(()=>{if(!X)return;const{selection:Oe}=X.state,et=Oe.from;if(et>fe){const xt=Oe.$from,It=xt.parent.textContent.substring(0,xt.parentOffset),ue=It.lastIndexOf("@");if(ue!==-1&&!It.substring(ue+1).includes(" ")){if(C.current){const Ue=X.getHTML();C.current(X.isEmpty?"":Ue)}return}try{X.chain().setTextSelection({from:fe,to:et}).setMark("timestamp",{time:Se,recordingId:Ie}).setTextSelection(et).run()}catch(Ne){console.warn("Failed to apply timestamp mark:",Ne)}}if(C.current){const xt=X.getHTML();C.current(X.isEmpty?"":xt)}},50)}else ie=null,X&&C.current&&setTimeout(()=>{if(X&&C.current){const Se=X.getHTML();C.current(X.isEmpty?"":Se)}},50)},ne=X.view.dom;return ne.addEventListener("compositionstart",ce),ne.addEventListener("compositionend",Z),X.on("selectionUpdate",ee),X.on("update",ee),()=>{X.off("update",ee),X.off("selectionUpdate",ee),ne.removeEventListener("compositionstart",ce),ne.removeEventListener("compositionend",Z),window.__imeComposing=!1}},[X,oe]),x.useEffect(()=>{if(X&&t!==void 0){const ee=X.getHTML(),ie=ce=>ce==="<p></p>"||ce==="";if(ie(ee)&&ie(t)||X.isFocused)return;ee!==t&&X.commands.setContent(t,!1)}},[t,X]),x.useEffect(()=>{X&&(Ke.current=X,X.toggleRecording=()=>{},X.isRecording=!1,X.scrollToParagraph=ee=>{if(!ee)return;let ie=null,ce=null,Z=null;X.state.doc.descendants((Ie,fe)=>{if(Ie.type.name==="audioMarker"&&Ie.attrs.id===ee)return ie=fe,!1}),ie!==null&&X.state.doc.descendants((Ie,fe)=>{if(Ie.type.name==="audioMarker"&&fe>ie&&ce===null)return ce=fe,Z=Ie.attrs.id,!1});const ne=ce!==null?ce:ie,Se=Z!==null?Z:ee;ne!==null&&(X.chain().setTextSelection(ne).scrollIntoView().focus().run(),setTimeout(()=>{const Ie=document.querySelector(`[data-id="${Se}"]`);Ie&&(Ie.style.transition="all 0.3s ease",Ie.style.backgroundColor="#fef08a",Ie.style.color="#854d0e",Ie.style.borderColor="#fbbf24",Ie.style.transform="scale(1.2)",setTimeout(()=>{Ie.style.transition="all 1s ease",Ie.style.backgroundColor="",Ie.style.color="",Ie.style.borderColor="",Ie.style.transform=""},2e3))},50))})},[X]),x.useEffect(()=>{X&&d&&X.commands.focus("end")},[X,d]),x.useEffect(()=>{X&&s&&s(X)},[X,s]),X?c.jsxs("div",{className:`note-editor-wrapper ${o} relative bg-transparent border-none`,style:{"--attachment-link-color":y},onClickCapture:ee=>{const ie=ee.target,ce=ie.closest("[data-time]");if(ce){const Se=ce.getAttribute("data-time"),Ie=ce.getAttribute("data-recording-id")||void 0,fe=parseInt(Se||"0",10);if(!isNaN(fe)&&f){f(fe,Ie);return}}const Z=ie.closest("[data-timestamp]");if(Z){const Se=parseInt(Z.getAttribute("data-timestamp")||"0",10);if(!isNaN(Se)&&f){f(Se);return}}const ne=ie.closest("[data-attachment-link]");if(ne){ee.preventDefault(),ee.stopPropagation();const Se=ne.getAttribute("data-attachment-urls");if(Se)try{const Ie=JSON.parse(Se);if(Array.isArray(Ie)&&Ie.length>0){const fe=ne.getBoundingClientRect();B({top:fe.bottom+5,left:Math.min(fe.left,window.innerWidth-340)}),We(Ie),ge(!0)}}catch(Ie){console.error("Failed to parse attachment URLs",Ie)}}else ie.closest(".attachment-popup")||ge(!1)},children:[c.jsx(XK,{editor:X}),_&&c.jsxs("div",{className:"fixed z-50 bg-white rounded-lg shadow-2xl border border-gray-200 p-2 flex gap-1.5 animate-in fade-in zoom-in-95 duration-200 items-center",style:{top:`${k.top}px`,left:`${k.left}px`,transform:"translateX(-50%)"},children:[c.jsx("button",{type:"button",onMouseDown:ee=>{ee.preventDefault(),ee.stopPropagation();const{from:ie,to:ce}=X.state.selection,Z=X.state.doc.textBetween(ie,ce," ");r==null||r(Z,{from:ie,to:ce},k),D(!1)},className:"w-8 h-8 rounded-lg bg-indigo-50 hover:bg-indigo-100 text-indigo-600 shadow-sm hover:scale-105 hover:ring-2 hover:ring-indigo-300 transition-all active:scale-95 flex items-center justify-center cursor-pointer",title:"AI  (Polish Selection)",children:c.jsx(Rs,{size:16})}),m.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"h-4 w-[1px] bg-gray-200 mx-1"}),c.jsx("button",{type:"button",onMouseDown:ee=>{ee.preventDefault(),ee.stopPropagation();const{from:ie,to:ce}=X.state.selection;if(ie!==ce){K({from:ie,to:ce});const Z=X.getAttributes("attachmentLink");R((Z==null?void 0:Z.attachmentUrls)||[]),P(!0),D(!1)}},className:"w-8 h-8 rounded-lg bg-amber-50 hover:bg-amber-100 text-amber-600 shadow-sm hover:scale-105 hover:ring-2 hover:ring-amber-300 transition-all active:scale-95 flex items-center justify-center cursor-pointer",title:" (Alt+A)",children:c.jsx(go,{size:16})})]}),c.jsx("div",{className:"h-4 w-[1px] bg-gray-200 mx-1"}),[{color:"#000000",label:""},{color:"#ef4444",label:""},{color:"#f97316",label:""},{color:"#f59e0b",label:""},{color:"#10b981",label:""},{color:"#3b82f6",label:""},{color:"#8b5cf6",label:""},{color:"#ec4899",label:""},{color:"#64748b",label:""}].map(({color:ee,label:ie})=>c.jsx("button",{type:"button",onMouseDown:ce=>{ce.preventDefault(),ce.stopPropagation(),X==null||X.chain().focus().setColor(ee).run(),D(!1)},className:"w-7 h-7 rounded-full border-2 border-white shadow-md hover:scale-110 hover:ring-2 hover:ring-indigo-300 transition-all active:scale-95 cursor-pointer",style:{backgroundColor:ee},title:ie},ee))]}),O&&m.length>0&&c.jsxs("div",{className:"fixed z-[99999] bg-white rounded-xl shadow-2xl border border-gray-100 p-3 min-w-[220px] max-w-[300px] animate-in fade-in zoom-in-95 duration-150",style:{top:H.top,left:H.left},children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("span",{className:"text-xs font-bold text-gray-600",children:""}),c.jsx("button",{type:"button",onClick:()=>{P(!1),R([])},className:"p-0.5 text-gray-400 hover:text-gray-600",children:c.jsx(hn,{size:14})})]}),c.jsx("div",{className:"space-y-1 max-h-[200px] overflow-y-auto mb-2",children:m.map((ee,ie)=>{const ce=G.includes(ee.url);return c.jsxs("button",{type:"button",onClick:()=>{R(ce?Z=>Z.filter(ne=>ne!==ee.url):Z=>[...Z,ee.url])},className:`w-full text-left px-2 py-1.5 rounded-lg flex items-center gap-2 text-xs transition-colors ${ce?"bg-indigo-50 text-indigo-700 border border-indigo-200":"hover:bg-gray-50 text-gray-600"}`,children:[c.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center flex-shrink-0 ${ce?"bg-indigo-500 border-indigo-500 text-white":"border-gray-300"}`,children:ce&&c.jsx(Zn,{size:12})}),c.jsx(go,{size:12,className:ce?"text-indigo-400":"text-gray-400"}),c.jsx("span",{className:"truncate",children:ee.name})]},ie)})}),c.jsxs("div",{className:"flex gap-2 pt-2 border-t border-gray-100",children:[c.jsx("button",{type:"button",onClick:()=>{P(!1),R([])},className:"flex-1 px-3 py-1.5 text-xs text-gray-500 hover:bg-gray-50 rounded-lg transition-colors",children:""}),c.jsxs("button",{type:"button",onClick:()=>{I&&X&&(G.length>0?X.chain().focus().setTextSelection(I).setMark("attachmentLink",{attachmentUrls:G}).run():X.chain().focus().setTextSelection(I).unsetMark("attachmentLink").run(),P(!1),K(null),R([]))},className:"flex-1 px-3 py-1.5 text-xs bg-indigo-500 text-white hover:bg-indigo-600 rounded-lg transition-colors font-medium",children:[" ",G.length>0&&`(${G.length})`]})]})]}),Ee&&se.length>0&&c.jsxs("div",{className:"fixed z-[99999] bg-white rounded-xl shadow-2xl border border-gray-100 p-3 min-w-[220px] max-w-[320px] animate-in fade-in zoom-in-95 duration-150",style:{top:F.top,left:F.left},children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("span",{className:"text-xs font-bold text-gray-600",children:""}),c.jsx("button",{type:"button",onClick:()=>ge(!1),className:"p-0.5 text-gray-400 hover:text-gray-600",children:c.jsx(hn,{size:14})})]}),c.jsx("div",{className:"space-y-1.5",children:se.map((ee,ie)=>{const ce=m.find(Z=>Z.url===ee);return ce?c.jsxs("div",{className:"flex items-center justify-between gap-2 px-2 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[c.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[c.jsx(go,{size:12,className:"text-gray-400 flex-shrink-0"}),c.jsx("span",{className:"text-xs text-gray-600 truncate",children:ce.name})]}),c.jsx("button",{type:"button",onClick:()=>{fetch(ee).then(Z=>Z.blob()).then(Z=>{const ne=window.URL.createObjectURL(Z),Se=document.createElement("a");Se.href=ne,Se.download=ce.name,document.body.appendChild(Se),Se.click(),document.body.removeChild(Se),window.URL.revokeObjectURL(ne)})},className:"p-1 text-indigo-500 hover:text-indigo-700 hover:bg-indigo-50 rounded transition-colors",title:"",children:c.jsx(iu,{size:14})})]},ie):null})})]}),c.jsx("style",{dangerouslySetInnerHTML:{__html:`
                .ProseMirror p.is-editor-empty:first-child::before {
                    content: attr(data-placeholder);
                    float: left;
                    color: #cbd5e1;
                    pointer-events: none;
                    height: 0;
                }
                .ProseMirror {
                    word-break: break-word;
                    max-height: calc(30 * 1.625em);
                    overflow-y: auto;
                }
                .note-editor-wrapper.h-full .ProseMirror {
                    height: 100%;
                    max-height: 100%;
                }
                .ProseMirror h1 { font-size: 1.25rem; font-weight: 700; margin-top: 0.5rem; margin-bottom: 0.5rem; color: #334155; }
                .ProseMirror h2 { font-size: 1.1rem; font-weight: 700; margin-top: 0.5rem; margin-bottom: 0.5rem; color: #475569; }
                .ProseMirror ul { list-style-type: disc; list-style-position: outside; padding-left: 2rem; margin-top: 0.25rem; margin-left: 0; }
                .ProseMirror ol { list-style-type: decimal; list-style-position: outside; padding-left: 2rem; margin-top: 0.25rem; margin-left: 0; }
                .ProseMirror li { padding-left: 0.25rem; }
            `}})]}):null});var JT;(function(t){t.STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object"})(JT||(JT={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var XT;(function(t){t.LANGUAGE_UNSPECIFIED="language_unspecified",t.PYTHON="python"})(XT||(XT={}));var QT;(function(t){t.OUTCOME_UNSPECIFIED="outcome_unspecified",t.OUTCOME_OK="outcome_ok",t.OUTCOME_FAILED="outcome_failed",t.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(QT||(QT={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZT=["user","model","function","system"];var eC;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(eC||(eC={}));var tC;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(tC||(tC={}));var nC;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(nC||(nC={}));var rC;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER"})(rC||(rC={}));var Hd;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.OTHER="OTHER"})(Hd||(Hd={}));var sC;(function(t){t.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",t.RETRIEVAL_QUERY="RETRIEVAL_QUERY",t.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",t.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",t.CLASSIFICATION="CLASSIFICATION",t.CLUSTERING="CLUSTERING"})(sC||(sC={}));var iC;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(iC||(iC={}));var oC;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(oC||(oC={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class bc extends gs{constructor(e,n){super(e),this.response=n}}class P5 extends gs{constructor(e,n,r,s){super(e),this.status=n,this.statusText=r,this.errorDetails=s}}class Ba extends gs{}class L5 extends gs{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zq="https://generativelanguage.googleapis.com",eY="v1beta",tY="0.24.1",nY="genai-js";var tc;(function(t){t.GENERATE_CONTENT="generateContent",t.STREAM_GENERATE_CONTENT="streamGenerateContent",t.COUNT_TOKENS="countTokens",t.EMBED_CONTENT="embedContent",t.BATCH_EMBED_CONTENTS="batchEmbedContents"})(tc||(tc={}));class rY{constructor(e,n,r,s,i){this.model=e,this.task=n,this.apiKey=r,this.stream=s,this.requestOptions=i}toString(){var e,n;const r=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||eY;let i=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||Zq}/${r}/${this.model}:${this.task}`;return this.stream&&(i+="?alt=sse"),i}}function sY(t){const e=[];return t!=null&&t.apiClient&&e.push(t.apiClient),e.push(`${nY}/${tY}`),e.join(" ")}async function iY(t){var e;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",sY(t.requestOptions)),n.append("x-goog-api-key",t.apiKey);let r=(e=t.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(s){throw new Ba(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${s.message}`)}for(const[s,i]of r.entries()){if(s==="x-goog-api-key")throw new Ba(`Cannot set reserved header name ${s}`);if(s==="x-goog-api-client")throw new Ba(`Header name ${s} can only be set using the apiClient field`);n.append(s,i)}}return n}async function oY(t,e,n,r,s,i){const o=new rY(t,e,n,r,i);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},uY(i)),{method:"POST",headers:await iY(o),body:s})}}async function ih(t,e,n,r,s,i={},o=fetch){const{url:a,fetchOptions:l}=await oY(t,e,n,r,s,i);return aY(a,l,o)}async function aY(t,e,n=fetch){let r;try{r=await n(t,e)}catch(s){lY(s,t)}return r.ok||await cY(r,t),r}function lY(t,e){let n=t;throw n.name==="AbortError"?(n=new L5(`Request aborted when fetching ${e.toString()}: ${t.message}`),n.stack=t.stack):t instanceof P5||t instanceof Ba||(n=new gs(`Error fetching from ${e.toString()}: ${t.message}`),n.stack=t.stack),n}async function cY(t,e){let n="",r;try{const s=await t.json();n=s.error.message,s.error.details&&(n+=` ${JSON.stringify(s.error.details)}`,r=s.error.details)}catch{}throw new P5(`Error fetching from ${e.toString()}: [${t.status} ${t.statusText}] ${n}`,t.status,t.statusText,r)}function uY(t){const e={};if((t==null?void 0:t.signal)!==void 0||(t==null?void 0:t.timeout)>=0){const n=new AbortController;(t==null?void 0:t.timeout)>=0&&setTimeout(()=>n.abort(),t.timeout),t!=null&&t.signal&&t.signal.addEventListener("abort",()=>{n.abort()}),e.signal=n.signal}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hv(t){return t.text=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),jp(t.candidates[0]))throw new bc(`${ya(t)}`,t);return dY(t)}else if(t.promptFeedback)throw new bc(`Text not available. ${ya(t)}`,t);return""},t.functionCall=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),jp(t.candidates[0]))throw new bc(`${ya(t)}`,t);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),aC(t)[0]}else if(t.promptFeedback)throw new bc(`Function call not available. ${ya(t)}`,t)},t.functionCalls=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),jp(t.candidates[0]))throw new bc(`${ya(t)}`,t);return aC(t)}else if(t.promptFeedback)throw new bc(`Function call not available. ${ya(t)}`,t)},t}function dY(t){var e,n,r,s;const i=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const o of(s=(r=t.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)o.text&&i.push(o.text),o.executableCode&&i.push("\n```"+o.executableCode.language+`
`+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&i.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}function aC(t){var e,n,r,s;const i=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const o of(s=(r=t.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)o.functionCall&&i.push(o.functionCall);if(i.length>0)return i}const fY=[Hd.RECITATION,Hd.SAFETY,Hd.LANGUAGE];function jp(t){return!!t.finishReason&&fY.includes(t.finishReason)}function ya(t){var e,n,r;let s="";if((!t.candidates||t.candidates.length===0)&&t.promptFeedback)s+="Response was blocked",!((e=t.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${t.promptFeedback.blockReason}`),!((n=t.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(s+=`: ${t.promptFeedback.blockReasonMessage}`);else if(!((r=t.candidates)===null||r===void 0)&&r[0]){const i=t.candidates[0];jp(i)&&(s+=`Candidate was blocked due to ${i.finishReason}`,i.finishMessage&&(s+=`: ${i.finishMessage}`))}return s}function $f(t){return this instanceof $f?(this.v=t,this):new $f(t)}function hY(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),s,i=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(h){r[h]&&(s[h]=function(p){return new Promise(function(m,y){i.push([h,p,m,y])>1||a(h,p)})})}function a(h,p){try{l(r[h](p))}catch(m){f(i[0][3],m)}}function l(h){h.value instanceof $f?Promise.resolve(h.value.v).then(u,d):f(i[0][2],h)}function u(h){a("next",h)}function d(h){a("throw",h)}function f(h,p){h(p),i.shift(),i.length&&a(i[0][0],i[0][1])}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lC=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function pY(t){const e=t.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=yY(e),[r,s]=n.tee();return{stream:gY(r),response:mY(s)}}async function mY(t){const e=[],n=t.getReader();for(;;){const{done:r,value:s}=await n.read();if(r)return Hv(xY(e));e.push(s)}}function gY(t){return hY(this,arguments,function*(){const n=t.getReader();for(;;){const{value:r,done:s}=yield $f(n.read());if(s)break;yield yield $f(Hv(r))}})}function yY(t){const e=t.getReader();return new ReadableStream({start(r){let s="";return i();function i(){return e.read().then(({value:o,done:a})=>{if(a){if(s.trim()){r.error(new gs("Failed to parse stream"));return}r.close();return}s+=o;let l=s.match(lC),u;for(;l;){try{u=JSON.parse(l[1])}catch{r.error(new gs(`Error parsing JSON response: "${l[1]}"`));return}r.enqueue(u),s=s.substring(l[0].length),l=s.match(lC)}return i()}).catch(o=>{let a=o;throw a.stack=o.stack,a.name==="AbortError"?a=new L5("Request aborted when reading from the stream"):a=new gs("Error reading from the stream"),a})}}})}function xY(t){const e=t[t.length-1],n={promptFeedback:e==null?void 0:e.promptFeedback};for(const r of t){if(r.candidates){let s=0;for(const i of r.candidates)if(n.candidates||(n.candidates=[]),n.candidates[s]||(n.candidates[s]={index:s}),n.candidates[s].citationMetadata=i.citationMetadata,n.candidates[s].groundingMetadata=i.groundingMetadata,n.candidates[s].finishReason=i.finishReason,n.candidates[s].finishMessage=i.finishMessage,n.candidates[s].safetyRatings=i.safetyRatings,i.content&&i.content.parts){n.candidates[s].content||(n.candidates[s].content={role:i.content.role||"user",parts:[]});const o={};for(const a of i.content.parts)a.text&&(o.text=a.text),a.functionCall&&(o.functionCall=a.functionCall),a.executableCode&&(o.executableCode=a.executableCode),a.codeExecutionResult&&(o.codeExecutionResult=a.codeExecutionResult),Object.keys(o).length===0&&(o.text=""),n.candidates[s].content.parts.push(o)}s++}r.usageMetadata&&(n.usageMetadata=r.usageMetadata)}return n}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $5(t,e,n,r){const s=await ih(e,tc.STREAM_GENERATE_CONTENT,t,!0,JSON.stringify(n),r);return pY(s)}async function z5(t,e,n,r){const i=await(await ih(e,tc.GENERATE_CONTENT,t,!1,JSON.stringify(n),r)).json();return{response:Hv(i)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F5(t){if(t!=null){if(typeof t=="string")return{role:"system",parts:[{text:t}]};if(t.text)return{role:"system",parts:[t]};if(t.parts)return t.role?t:{role:"system",parts:t.parts}}}function zf(t){let e=[];if(typeof t=="string")e=[{text:t}];else for(const n of t)typeof n=="string"?e.push({text:n}):e.push(n);return bY(e)}function bY(t){const e={role:"user",parts:[]},n={role:"function",parts:[]};let r=!1,s=!1;for(const i of t)"functionResponse"in i?(n.parts.push(i),s=!0):(e.parts.push(i),r=!0);if(r&&s)throw new gs("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!s)throw new gs("No content is provided for sending chat message.");return r?e:n}function wY(t,e){var n;let r={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(n=e==null?void 0:e.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const s=t.generateContentRequest!=null;if(t.contents){if(s)throw new Ba("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=t.contents}else if(s)r=Object.assign(Object.assign({},r),t.generateContentRequest);else{const i=zf(t);r.contents=[i]}return{generateContentRequest:r}}function cC(t){let e;return t.contents?e=t:e={contents:[zf(t)]},t.systemInstruction&&(e.systemInstruction=F5(t.systemInstruction)),e}function vY(t){return typeof t=="string"||Array.isArray(t)?{content:zf(t)}:t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uC=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],kY={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function SY(t){let e=!1;for(const n of t){const{role:r,parts:s}=n;if(!e&&r!=="user")throw new gs(`First content should be with role 'user', got ${r}`);if(!ZT.includes(r))throw new gs(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(ZT)}`);if(!Array.isArray(s))throw new gs("Content should have 'parts' property with an array of Parts");if(s.length===0)throw new gs("Each Content should have at least one part");const i={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const a of s)for(const l of uC)l in a&&(i[l]+=1);const o=kY[r];for(const a of uC)if(!o.includes(a)&&i[a]>0)throw new gs(`Content with role '${r}' can't contain '${a}' part`);e=!0}}function dC(t){var e;if(t.candidates===void 0||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;if(n===void 0||n.parts===void 0||n.parts.length===0)return!1;for(const r of n.parts)if(r===void 0||Object.keys(r).length===0||r.text!==void 0&&r.text==="")return!1;return!0}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fC="SILENT_ERROR";class _Y{constructor(e,n,r,s={}){this.model=n,this.params=r,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,r!=null&&r.history&&(SY(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,n={}){var r,s,i,o,a,l;await this._sendPromise;const u=zf(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,u]},f=Object.assign(Object.assign({},this._requestOptions),n);let h;return this._sendPromise=this._sendPromise.then(()=>z5(this._apiKey,this.model,d,f)).then(p=>{var m;if(dC(p.response)){this._history.push(u);const y=Object.assign({parts:[],role:"model"},(m=p.response.candidates)===null||m===void 0?void 0:m[0].content);this._history.push(y)}else{const y=ya(p.response);y&&console.warn(`sendMessage() was unsuccessful. ${y}. Inspect response object for details.`)}h=p}).catch(p=>{throw this._sendPromise=Promise.resolve(),p}),await this._sendPromise,h}async sendMessageStream(e,n={}){var r,s,i,o,a,l;await this._sendPromise;const u=zf(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,u]},f=Object.assign(Object.assign({},this._requestOptions),n),h=$5(this._apiKey,this.model,d,f);return this._sendPromise=this._sendPromise.then(()=>h).catch(p=>{throw new Error(fC)}).then(p=>p.response).then(p=>{if(dC(p)){this._history.push(u);const m=Object.assign({},p.candidates[0].content);m.role||(m.role="model"),this._history.push(m)}else{const m=ya(p);m&&console.warn(`sendMessageStream() was unsuccessful. ${m}. Inspect response object for details.`)}}).catch(p=>{p.message!==fC&&console.error(p)}),h}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TY(t,e,n,r){return(await ih(e,tc.COUNT_TOKENS,t,!1,JSON.stringify(n),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CY(t,e,n,r){return(await ih(e,tc.EMBED_CONTENT,t,!1,JSON.stringify(n),r)).json()}async function EY(t,e,n,r){const s=n.requests.map(o=>Object.assign(Object.assign({},o),{model:e}));return(await ih(e,tc.BATCH_EMBED_CONTENTS,t,!1,JSON.stringify({requests:s}),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hC{constructor(e,n,r={}){this.apiKey=e,this._requestOptions=r,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=F5(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(e,n={}){var r;const s=cC(e),i=Object.assign(Object.assign({},this._requestOptions),n);return z5(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}async generateContentStream(e,n={}){var r;const s=cC(e),i=Object.assign(Object.assign({},this._requestOptions),n);return $5(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}startChat(e){var n;return new _Y(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},e),this._requestOptions)}async countTokens(e,n={}){const r=wY(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),n);return TY(this.apiKey,this.model,r,s)}async embedContent(e,n={}){const r=vY(e),s=Object.assign(Object.assign({},this._requestOptions),n);return CY(this.apiKey,this.model,r,s)}async batchEmbedContents(e,n={}){const r=Object.assign(Object.assign({},this._requestOptions),n);return EY(this.apiKey,this.model,e,r)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NY{constructor(e){this.apiKey=e}getGenerativeModel(e,n){if(!e.model)throw new gs("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new hC(this.apiKey,e,n)}getGenerativeModelFromCachedContent(e,n,r){if(!e.name)throw new Ba("Cached content must contain a `name` field.");if(!e.model)throw new Ba("Cached content must contain a `model` field.");const s=["model","systemInstruction"];for(const o of s)if(n!=null&&n[o]&&e[o]&&(n==null?void 0:n[o])!==e[o]){if(o==="model"){const a=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,l=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(a===l)continue}throw new Ba(`Different value for "${o}" specified in modelParams (${n[o]}) and cachedContent (${e[o]})`)}const i=Object.assign(Object.assign({},n),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new hC(this.apiKey,i,r)}}const jY="AIzaSyBbGFzQkwhEmNQduYxaZnnxxHR-DlQjj98",Vv=()=>({provider:localStorage.getItem("ai_provider")||"gemini",googleKey:localStorage.getItem("google_ai_key")||jY,openaiKey:localStorage.getItem("openai_api_key")||"",baseUrl:localStorage.getItem("ai_base_url")||"https://api.openai.com/v1",modelName:localStorage.getItem("ai_model")||"gpt-3.5-turbo"}),IY=()=>{const{googleKey:t}=Vv();if(!t)throw new Error("Google API Key is missing. Please set it in Settings.");return new NY(t)},MY=async(t,e=!0)=>{var a,l;const{openaiKey:n,baseUrl:r,modelName:s}=Vv();if(!n)throw new Error("API Key is missing. Please set it in Settings.");let i=r.trim();i.endsWith("/")&&(i=i.slice(0,-1));const o=`${i}/chat/completions`;console.log(`Using OpenAI-compatible provider: ${i}, model: ${s}`);try{const u=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:s,messages:[{role:"system",content:e?"You are a helpful assistant. Output valid JSON only.":"You are a helpful assistant."},{role:"user",content:t}],temperature:.7})});if(!u.ok){const h=await u.text();throw new Error(`API Error: ${u.status} ${u.statusText} - ${h}`)}const f=((l=(a=(await u.json()).choices[0])==null?void 0:a.message)==null?void 0:l.content)||"";if(console.log("AI Raw Response:",f),!e)return f;try{let h=f;const p=f.match(/\{[\s\S]*\}/);p&&(h=p[0]);const m=h.replace(/```json/g,"").replace(/```/g,"").trim();try{return JSON.parse(m)}catch(y){if(m.includes('"fullResponse": "')){const b='"fullResponse": "',g=m.indexOf(b)+b.length,v=m.lastIndexOf('"');if(g>b.length-1&&v>g)return{fullResponse:m.substring(g,v).replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")}}throw y}}catch(h){throw console.warn("OpenAI JSON Parse failed"),h}}catch(u){throw console.error("OpenAI Provider Error:",u),u}},DY=async t=>{const e=IY(),n=["gemini-1.5-flash","gemini-2.0-flash-001","gemini-2.0-flash-lite-preview-02-05","gemini-1.5-pro","gemini-pro"];let r;for(const s of n)try{console.log(`[SimpleAI] Attempting to use model: ${s}`);const l=(await(await e.getGenerativeModel({model:s}).generateContent(t)).response).text();if(l)return l.trim()}catch(i){console.warn(`[SimpleAI] Model ${s} failed:`,i),r=i;continue}throw r||new Error("All AI models failed to respond")},ic=async t=>{const{provider:e}=Vv();if(e==="openai"){const n=await MY(t,!1);return typeof n=="string"?n:JSON.stringify(n)}return await DY(t)},B5=async(t,e,n)=>{const r=` AI 
  
  ${e}
  ${t}
  
  `,s=n&&n.trim()?n:r,i=(n==null?void 0:n.includes(""))||(n==null?void 0:n.includes("")),o=e.trim()?`
"${e}"

`:"",a=!!(n&&n.trim()),l=["1. Traditional Chinese","2.  JSON "];i?(l.push("3. "),l.push("4. ")):a?(l.push("3. "),l.push("4. ......"),l.push("5.  Markdown ")):(l.push("3. "),l.push("4.  Markdown ****"),l.push("5. "));const u=`
${s}

${o}
"${t}"


${l.join(`
`)}`;try{if(!t.trim())throw new Error("");return{fullResponse:await ic(u)}}catch(d){throw console.error("AI Assistant Error:",d),d}},U5=async t=>{const e=` AI Prompt 10 

  
  "${t}"`;try{return(await ic(e)).trim().replace(/^"|"$/g,"")}catch(n){return console.error("Generate Prompt Title Error:",n),t.slice(0,15)+(t.length>15?"...":"")}},AY=async(t,e)=>{const n=t.length>3e3?t.slice(0,3e3)+"...":t;let r;e?r=`${e}

  
  ---
    ${n}
  ---

    `:r=`SEOSEO

  
  1. 
  2. 15 - 30
  3. 
  4. 
  5. 
  6. 
  7. 

  
  - "5"
    - "90%"
    - ""

  
  ---
    ${n}
  ---

    SEO`,console.log("Generating SEO title for content length:",t.length);try{const s=await ic(r);return console.log("SEO Title AI result:",s),s.trim().replace(/^["]/g,"").replace(/["]$/g,"").replace(/^\d+[\.\s]+/,"").replace(/^[:]\s*/i,"").trim()||s.trim()}catch(s){throw console.error("Generate SEO Title Error:",s),s}},RY=async(t,e)=>{const n=t.length>3e3?t.slice(0,3e3)+"...":t,s=`SEO


(SEO)

${e.length>0?`
${e.join(", ")}`:""}


1. ---
2. 
3.  3-7 
4.  10 
5. 
6. 
7. 


---
${n}
---

`;console.log("Generating SEO keywords for content length:",t.length),console.log("Content preview:",t.slice(0,200));try{const i=await ic(s);return console.log("SEO Keywords AI result:",i),i.split(/[,\n]/).map(a=>a.trim()).filter(a=>a.length>0&&a.length<=20).slice(0,7)}catch(i){throw console.error("Generate SEO Keywords Error:",i),i}},OY=async(t,e,n,r,s,i)=>{const o=s.existingSchedule&&s.existingSchedule.length>0?`
Existing Schedule (Potential Conflicts):
${s.existingSchedule.join(`
`)}`:"",a=s.pastExperiences&&s.pastExperiences.length>0?`
Relevant Past Experience:
${s.pastExperiences.join(`
`)}`:"",l=`
Role:  AI (Chief Administrative Officer)

Source Task:
- : "${t}"
- /: "${e||"()"}"
- : ${n||""}
- : ${r||""}
- : ${s.today}
${i?`
: "${i}"`:""}
${o}
${a}

Instructions:
1. 
2.  (Relevant Past Experience)() 
3.  (Existing Schedule)() description 
4. 
5. 
   - "title": 
   - "description": 
   - "start_date": YYYY-MM-DD 
   - "due_date": YYYY-MM-DD 
6. "subtasks": 

Output Rules:
-  JSON 
-  Markdown... JSON
- 
- description  title 

JSON Format:
[
  {
    "title": "",
    "description": "...",
    "start_date": "YYYY-MM-DD",
    "due_date": "YYYY-MM-DD",
    "subtasks": []
  }
]
`;try{const u=await ic(l);console.log("Mission 72 Raw Output:",u);let d=u;const f=u.match(/\[[\s\S]*\]/);return f&&(d=f[0]),d=d.replace(/```json/g,"").replace(/```/g,"").trim(),JSON.parse(d)}catch(u){throw console.error("Mission 72 Planning Error:",u),new Error("AI ")}},PY=async(t,e)=>{if(e.length===0)return null;const n=e.map(s=>`- ${s.name} (ID: ${s.id}, : ${s.depth})`).join(`
`),r=`${t}


${n}


1. 
2. 
3.  "NONE"
4. 

 ID "NONE"`;try{const i=(await ic(r)).trim().replace(/["""'']/g,"");if(i==="NONE"||i.toLowerCase()==="none")return null;const o=e.find(l=>l.id===i);if(o)return o.id;const a=e.find(l=>i.toLowerCase().includes(l.name.toLowerCase())||l.name.toLowerCase().includes(i.toLowerCase()));return a?a.id:null}catch(s){return console.error("Find Best Parent Keyword Error:",s),null}},LY=async(t,e,n,r=[])=>{const s=`
 GTD (Getting Things Done) **** GTD 



- ${t.title}
- ${t.description||"()"}
- ${t.status}
- ${t.created_at}
- ${t.due_date||""}
- ()${t.start_date||""}
- ${t.tags.join(", ")||""}
- ${t.project_title||" ()"}

 ()
${e.length>0?e.join(`
`):"()"}


${r.map(i=>`${i.role==="user"?"":"GTD"}: ${i.content}`).join(`
`)}


"${n}"

GTD  (current_stage)
1. capture (): 
2. clarify (): 
3. organize (): ** (start_date) start_time (HH:MM) (due_date)**
4. engage (): 


1. ******** \`actions\` JSON
2. ****
3. **** \`start_date\`
4. ************ \`actions\` JSON reminder_minutes

 (JSON Only)
{
  "reply": "...",
  "current_stage": "capture" | "clarify" | "organize" | "engage",
  "actions": [
    { "type": "update_task", "params": { "start_date": "YYYY-MM-DD", "start_time": "09:00", "reminder_minutes": 0 } },
    { "type": "add_subtasks", "params": { "tasks": [{ "title": "...", "start_date": "...", "reminder_minutes": 10 }] } }
  ]
}
* \`actions\` 

 JSON
`;try{const i=await ic(s);let o=i;const a=i.match(/\{[\s\S]*\}/);return a&&(o=a[0]),o=o.replace(/```json/g,"").replace(/```/g,"").trim(),JSON.parse(o)}catch(i){return console.error("GTD Coach Error:",i),{reply:"",current_stage:"capture",actions:[]}}};function $Y(t,e){const n=e||{};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const zY=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,FY=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,BY={};function pC(t,e){return((e||BY).jsx?FY:zY).test(t)}const UY=/[ \t\n\f\r]/g;function HY(t){return typeof t=="object"?t.type==="text"?mC(t.value):!1:mC(t)}function mC(t){return t.replace(UY,"")===""}class oh{constructor(e,n,r){this.normal=n,this.property=e,r&&(this.space=r)}}oh.prototype.normal={};oh.prototype.property={};oh.prototype.space=void 0;function H5(t,e){const n={},r={};for(const s of t)Object.assign(n,s.property),Object.assign(r,s.normal);return new oh(n,r,e)}function ob(t){return t.toLowerCase()}class qs{constructor(e,n){this.attribute=n,this.property=e}}qs.prototype.attribute="";qs.prototype.booleanish=!1;qs.prototype.boolean=!1;qs.prototype.commaOrSpaceSeparated=!1;qs.prototype.commaSeparated=!1;qs.prototype.defined=!1;qs.prototype.mustUseProperty=!1;qs.prototype.number=!1;qs.prototype.overloadedBoolean=!1;qs.prototype.property="";qs.prototype.spaceSeparated=!1;qs.prototype.space=void 0;let VY=0;const wn=oc(),Tr=oc(),ab=oc(),Ot=oc(),Vn=oc(),du=oc(),Js=oc();function oc(){return 2**++VY}const lb=Object.freeze(Object.defineProperty({__proto__:null,boolean:wn,booleanish:Tr,commaOrSpaceSeparated:Js,commaSeparated:du,number:Ot,overloadedBoolean:ab,spaceSeparated:Vn},Symbol.toStringTag,{value:"Module"})),Dy=Object.keys(lb);class Wv extends qs{constructor(e,n,r,s){let i=-1;if(super(e,n),gC(this,"space",s),typeof r=="number")for(;++i<Dy.length;){const o=Dy[i];gC(this,Dy[i],(r&lb[o])===lb[o])}}}Wv.prototype.defined=!0;function gC(t,e,n){n&&(t[e]=n)}function Bu(t){const e={},n={};for(const[r,s]of Object.entries(t.properties)){const i=new Wv(r,t.transform(t.attributes||{},r),s,t.space);t.mustUseProperty&&t.mustUseProperty.includes(r)&&(i.mustUseProperty=!0),e[r]=i,n[ob(r)]=r,n[ob(i.attribute)]=r}return new oh(e,n,t.space)}const V5=Bu({properties:{ariaActiveDescendant:null,ariaAtomic:Tr,ariaAutoComplete:null,ariaBusy:Tr,ariaChecked:Tr,ariaColCount:Ot,ariaColIndex:Ot,ariaColSpan:Ot,ariaControls:Vn,ariaCurrent:null,ariaDescribedBy:Vn,ariaDetails:null,ariaDisabled:Tr,ariaDropEffect:Vn,ariaErrorMessage:null,ariaExpanded:Tr,ariaFlowTo:Vn,ariaGrabbed:Tr,ariaHasPopup:null,ariaHidden:Tr,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Vn,ariaLevel:Ot,ariaLive:null,ariaModal:Tr,ariaMultiLine:Tr,ariaMultiSelectable:Tr,ariaOrientation:null,ariaOwns:Vn,ariaPlaceholder:null,ariaPosInSet:Ot,ariaPressed:Tr,ariaReadOnly:Tr,ariaRelevant:null,ariaRequired:Tr,ariaRoleDescription:Vn,ariaRowCount:Ot,ariaRowIndex:Ot,ariaRowSpan:Ot,ariaSelected:Tr,ariaSetSize:Ot,ariaSort:null,ariaValueMax:Ot,ariaValueMin:Ot,ariaValueNow:Ot,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function W5(t,e){return e in t?t[e]:e}function K5(t,e){return W5(t,e.toLowerCase())}const WY=Bu({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:du,acceptCharset:Vn,accessKey:Vn,action:null,allow:null,allowFullScreen:wn,allowPaymentRequest:wn,allowUserMedia:wn,alt:null,as:null,async:wn,autoCapitalize:null,autoComplete:Vn,autoFocus:wn,autoPlay:wn,blocking:Vn,capture:null,charSet:null,checked:wn,cite:null,className:Vn,cols:Ot,colSpan:null,content:null,contentEditable:Tr,controls:wn,controlsList:Vn,coords:Ot|du,crossOrigin:null,data:null,dateTime:null,decoding:null,default:wn,defer:wn,dir:null,dirName:null,disabled:wn,download:ab,draggable:Tr,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:wn,formTarget:null,headers:Vn,height:Ot,hidden:ab,high:Ot,href:null,hrefLang:null,htmlFor:Vn,httpEquiv:Vn,id:null,imageSizes:null,imageSrcSet:null,inert:wn,inputMode:null,integrity:null,is:null,isMap:wn,itemId:null,itemProp:Vn,itemRef:Vn,itemScope:wn,itemType:Vn,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:wn,low:Ot,manifest:null,max:null,maxLength:Ot,media:null,method:null,min:null,minLength:Ot,multiple:wn,muted:wn,name:null,nonce:null,noModule:wn,noValidate:wn,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:wn,optimum:Ot,pattern:null,ping:Vn,placeholder:null,playsInline:wn,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:wn,referrerPolicy:null,rel:Vn,required:wn,reversed:wn,rows:Ot,rowSpan:Ot,sandbox:Vn,scope:null,scoped:wn,seamless:wn,selected:wn,shadowRootClonable:wn,shadowRootDelegatesFocus:wn,shadowRootMode:null,shape:null,size:Ot,sizes:null,slot:null,span:Ot,spellCheck:Tr,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Ot,step:null,style:null,tabIndex:Ot,target:null,title:null,translate:null,type:null,typeMustMatch:wn,useMap:null,value:Tr,width:Ot,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Vn,axis:null,background:null,bgColor:null,border:Ot,borderColor:null,bottomMargin:Ot,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:wn,declare:wn,event:null,face:null,frame:null,frameBorder:null,hSpace:Ot,leftMargin:Ot,link:null,longDesc:null,lowSrc:null,marginHeight:Ot,marginWidth:Ot,noResize:wn,noHref:wn,noShade:wn,noWrap:wn,object:null,profile:null,prompt:null,rev:null,rightMargin:Ot,rules:null,scheme:null,scrolling:Tr,standby:null,summary:null,text:null,topMargin:Ot,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Ot,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:wn,disableRemotePlayback:wn,prefix:null,property:null,results:Ot,security:null,unselectable:null},space:"html",transform:K5}),KY=Bu({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Js,accentHeight:Ot,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Ot,amplitude:Ot,arabicForm:null,ascent:Ot,attributeName:null,attributeType:null,azimuth:Ot,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Ot,by:null,calcMode:null,capHeight:Ot,className:Vn,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Ot,diffuseConstant:Ot,direction:null,display:null,dur:null,divisor:Ot,dominantBaseline:null,download:wn,dx:null,dy:null,edgeMode:null,editable:null,elevation:Ot,enableBackground:null,end:null,event:null,exponent:Ot,externalResourcesRequired:null,fill:null,fillOpacity:Ot,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:du,g2:du,glyphName:du,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Ot,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Ot,horizOriginX:Ot,horizOriginY:Ot,id:null,ideographic:Ot,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Ot,k:Ot,k1:Ot,k2:Ot,k3:Ot,k4:Ot,kernelMatrix:Js,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Ot,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Ot,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Ot,overlineThickness:Ot,paintOrder:null,panose1:null,path:null,pathLength:Ot,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Vn,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Ot,pointsAtY:Ot,pointsAtZ:Ot,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Js,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Js,rev:Js,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Js,requiredFeatures:Js,requiredFonts:Js,requiredFormats:Js,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Ot,specularExponent:Ot,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Ot,strikethroughThickness:Ot,string:null,stroke:null,strokeDashArray:Js,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Ot,strokeOpacity:Ot,strokeWidth:null,style:null,surfaceScale:Ot,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Js,tabIndex:Ot,tableValues:null,target:null,targetX:Ot,targetY:Ot,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Js,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Ot,underlineThickness:Ot,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Ot,values:null,vAlphabetic:Ot,vMathematical:Ot,vectorEffect:null,vHanging:Ot,vIdeographic:Ot,version:null,vertAdvY:Ot,vertOriginX:Ot,vertOriginY:Ot,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Ot,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:W5}),G5=Bu({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),q5=Bu({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:K5}),Y5=Bu({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),GY={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},qY=/[A-Z]/g,yC=/-[a-z]/g,YY=/^data[-\w.:]+$/i;function JY(t,e){const n=ob(e);let r=e,s=qs;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&YY.test(e)){if(e.charAt(4)==="-"){const i=e.slice(5).replace(yC,QY);r="data"+i.charAt(0).toUpperCase()+i.slice(1)}else{const i=e.slice(4);if(!yC.test(i)){let o=i.replace(qY,XY);o.charAt(0)!=="-"&&(o="-"+o),e="data"+o}}s=Wv}return new s(r,e)}function XY(t){return"-"+t.toLowerCase()}function QY(t){return t.charAt(1).toUpperCase()}const ZY=H5([V5,WY,G5,q5,Y5],"html"),Kv=H5([V5,KY,G5,q5,Y5],"svg");function eJ(t){return t.join(" ").trim()}var Gv={},xC=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,tJ=/\n/g,nJ=/^\s*/,rJ=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,sJ=/^:\s*/,iJ=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,oJ=/^[;\s]*/,aJ=/^\s+|\s+$/g,lJ=`
`,bC="/",wC="*",Sl="",cJ="comment",uJ="declaration";function dJ(t,e){if(typeof t!="string")throw new TypeError("First argument must be a string");if(!t)return[];e=e||{};var n=1,r=1;function s(m){var y=m.match(tJ);y&&(n+=y.length);var b=m.lastIndexOf(lJ);r=~b?m.length-b:r+m.length}function i(){var m={line:n,column:r};return function(y){return y.position=new o(m),u(),y}}function o(m){this.start=m,this.end={line:n,column:r},this.source=e.source}o.prototype.content=t;function a(m){var y=new Error(e.source+":"+n+":"+r+": "+m);if(y.reason=m,y.filename=e.source,y.line=n,y.column=r,y.source=t,!e.silent)throw y}function l(m){var y=m.exec(t);if(y){var b=y[0];return s(b),t=t.slice(b.length),y}}function u(){l(nJ)}function d(m){var y;for(m=m||[];y=f();)y!==!1&&m.push(y);return m}function f(){var m=i();if(!(bC!=t.charAt(0)||wC!=t.charAt(1))){for(var y=2;Sl!=t.charAt(y)&&(wC!=t.charAt(y)||bC!=t.charAt(y+1));)++y;if(y+=2,Sl===t.charAt(y-1))return a("End of comment missing");var b=t.slice(2,y-2);return r+=2,s(b),t=t.slice(y),r+=2,m({type:cJ,comment:b})}}function h(){var m=i(),y=l(rJ);if(y){if(f(),!l(sJ))return a("property missing ':'");var b=l(iJ),g=m({type:uJ,property:vC(y[0].replace(xC,Sl)),value:b?vC(b[0].replace(xC,Sl)):Sl});return l(oJ),g}}function p(){var m=[];d(m);for(var y;y=h();)y!==!1&&(m.push(y),d(m));return m}return u(),p()}function vC(t){return t?t.replace(aJ,Sl):Sl}var fJ=dJ,hJ=Dp&&Dp.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Gv,"__esModule",{value:!0});Gv.default=mJ;const pJ=hJ(fJ);function mJ(t,e){let n=null;if(!t||typeof t!="string")return n;const r=(0,pJ.default)(t),s=typeof e=="function";return r.forEach(i=>{if(i.type!=="declaration")return;const{property:o,value:a}=i;s?e(o,a,i):a&&(n=n||{},n[o]=a)}),n}var e0={};Object.defineProperty(e0,"__esModule",{value:!0});e0.camelCase=void 0;var gJ=/^--[a-zA-Z0-9_-]+$/,yJ=/-([a-z])/g,xJ=/^[^-]+$/,bJ=/^-(webkit|moz|ms|o|khtml)-/,wJ=/^-(ms)-/,vJ=function(t){return!t||xJ.test(t)||gJ.test(t)},kJ=function(t,e){return e.toUpperCase()},kC=function(t,e){return"".concat(e,"-")},SJ=function(t,e){return e===void 0&&(e={}),vJ(t)?t:(t=t.toLowerCase(),e.reactCompat?t=t.replace(wJ,kC):t=t.replace(bJ,kC),t.replace(yJ,kJ))};e0.camelCase=SJ;var _J=Dp&&Dp.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},TJ=_J(Gv),CJ=e0;function cb(t,e){var n={};return!t||typeof t!="string"||(0,TJ.default)(t,function(r,s){r&&s&&(n[(0,CJ.camelCase)(r,e)]=s)}),n}cb.default=cb;var EJ=cb;const NJ=cg(EJ),J5=X5("end"),qv=X5("start");function X5(t){return e;function e(n){const r=n&&n.position&&n.position[t]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function jJ(t){const e=qv(t),n=J5(t);if(e&&n)return{start:e,end:n}}function Vd(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?SC(t.position):"start"in t||"end"in t?SC(t):"line"in t||"column"in t?ub(t):""}function ub(t){return _C(t&&t.line)+":"+_C(t&&t.column)}function SC(t){return ub(t&&t.start)+"-"+ub(t&&t.end)}function _C(t){return t&&typeof t=="number"?t:1}class vs extends Error{constructor(e,n,r){super(),typeof n=="string"&&(r=n,n=void 0);let s="",i={},o=!1;if(n&&("line"in n&&"column"in n?i={place:n}:"start"in n&&"end"in n?i={place:n}:"type"in n?i={ancestors:[n],place:n.position}:i={...n}),typeof e=="string"?s=e:!i.cause&&e&&(o=!0,s=e.message,i.cause=e),!i.ruleId&&!i.source&&typeof r=="string"){const l=r.indexOf(":");l===-1?i.ruleId=r:(i.source=r.slice(0,l),i.ruleId=r.slice(l+1))}if(!i.place&&i.ancestors&&i.ancestors){const l=i.ancestors[i.ancestors.length-1];l&&(i.place=l.position)}const a=i.place&&"start"in i.place?i.place.start:i.place;this.ancestors=i.ancestors||void 0,this.cause=i.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file="",this.message=s,this.line=a?a.line:void 0,this.name=Vd(i.place)||"1:1",this.place=i.place||void 0,this.reason=this.message,this.ruleId=i.ruleId||void 0,this.source=i.source||void 0,this.stack=o&&i.cause&&typeof i.cause.stack=="string"?i.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}vs.prototype.file="";vs.prototype.name="";vs.prototype.reason="";vs.prototype.message="";vs.prototype.stack="";vs.prototype.column=void 0;vs.prototype.line=void 0;vs.prototype.ancestors=void 0;vs.prototype.cause=void 0;vs.prototype.fatal=void 0;vs.prototype.place=void 0;vs.prototype.ruleId=void 0;vs.prototype.source=void 0;const Yv={}.hasOwnProperty,IJ=new Map,MJ=/[A-Z]/g,DJ=new Set(["table","tbody","thead","tfoot","tr"]),AJ=new Set(["td","th"]),Q5="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function RJ(t,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=e.filePath||void 0;let r;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=UJ(n,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=BJ(n,e.jsx,e.jsxs)}const s={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:r,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?Kv:ZY,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},i=Z5(s,t,void 0);return i&&typeof i!="string"?i:s.create(t,s.Fragment,{children:i||void 0},void 0)}function Z5(t,e,n){if(e.type==="element")return OJ(t,e,n);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return PJ(t,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return $J(t,e,n);if(e.type==="mdxjsEsm")return LJ(t,e);if(e.type==="root")return zJ(t,e,n);if(e.type==="text")return FJ(t,e)}function OJ(t,e,n){const r=t.schema;let s=r;e.tagName.toLowerCase()==="svg"&&r.space==="html"&&(s=Kv,t.schema=s),t.ancestors.push(e);const i=tR(t,e.tagName,!1),o=HJ(t,e);let a=Xv(t,e);return DJ.has(e.tagName)&&(a=a.filter(function(l){return typeof l=="string"?!HY(l):!0})),eR(t,o,i,e),Jv(o,a),t.ancestors.pop(),t.schema=r,t.create(e,i,o,n)}function PJ(t,e){if(e.data&&e.data.estree&&t.evaluater){const r=e.data.estree.body[0];return r.type,t.evaluater.evaluateExpression(r.expression)}Ff(t,e.position)}function LJ(t,e){if(e.data&&e.data.estree&&t.evaluater)return t.evaluater.evaluateProgram(e.data.estree);Ff(t,e.position)}function $J(t,e,n){const r=t.schema;let s=r;e.name==="svg"&&r.space==="html"&&(s=Kv,t.schema=s),t.ancestors.push(e);const i=e.name===null?t.Fragment:tR(t,e.name,!0),o=VJ(t,e),a=Xv(t,e);return eR(t,o,i,e),Jv(o,a),t.ancestors.pop(),t.schema=r,t.create(e,i,o,n)}function zJ(t,e,n){const r={};return Jv(r,Xv(t,e)),t.create(e,t.Fragment,r,n)}function FJ(t,e){return e.value}function eR(t,e,n,r){typeof n!="string"&&n!==t.Fragment&&t.passNode&&(e.node=r)}function Jv(t,e){if(e.length>0){const n=e.length>1?e:e[0];n&&(t.children=n)}}function BJ(t,e,n){return r;function r(s,i,o,a){const u=Array.isArray(o.children)?n:e;return a?u(i,o,a):u(i,o)}}function UJ(t,e){return n;function n(r,s,i,o){const a=Array.isArray(i.children),l=qv(r);return e(s,i,o,a,{columnNumber:l?l.column-1:void 0,fileName:t,lineNumber:l?l.line:void 0},void 0)}}function HJ(t,e){const n={};let r,s;for(s in e.properties)if(s!=="children"&&Yv.call(e.properties,s)){const i=WJ(t,s,e.properties[s]);if(i){const[o,a]=i;t.tableCellAlignToStyle&&o==="align"&&typeof a=="string"&&AJ.has(e.tagName)?r=a:n[o]=a}}if(r){const i=n.style||(n.style={});i[t.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return n}function VJ(t,e){const n={};for(const r of e.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&t.evaluater){const i=r.data.estree.body[0];i.type;const o=i.expression;o.type;const a=o.properties[0];a.type,Object.assign(n,t.evaluater.evaluateExpression(a.argument))}else Ff(t,e.position);else{const s=r.name;let i;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&t.evaluater){const a=r.value.data.estree.body[0];a.type,i=t.evaluater.evaluateExpression(a.expression)}else Ff(t,e.position);else i=r.value===null?!0:r.value;n[s]=i}return n}function Xv(t,e){const n=[];let r=-1;const s=t.passKeys?new Map:IJ;for(;++r<e.children.length;){const i=e.children[r];let o;if(t.passKeys){const l=i.type==="element"?i.tagName:i.type==="mdxJsxFlowElement"||i.type==="mdxJsxTextElement"?i.name:void 0;if(l){const u=s.get(l)||0;o=l+"-"+u,s.set(l,u+1)}}const a=Z5(t,i,o);a!==void 0&&n.push(a)}return n}function WJ(t,e,n){const r=JY(t.schema,e);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?$Y(n):eJ(n)),r.property==="style"){let s=typeof n=="object"?n:KJ(t,String(n));return t.stylePropertyNameCase==="css"&&(s=GJ(s)),["style",s]}return[t.elementAttributeNameCase==="react"&&r.space?GY[r.property]||r.property:r.attribute,n]}}function KJ(t,e){try{return NJ(e,{reactCompat:!0})}catch(n){if(t.ignoreInvalidStyle)return{};const r=n,s=new vs("Cannot parse `style` attribute",{ancestors:t.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw s.file=t.filePath||void 0,s.url=Q5+"#cannot-parse-style-attribute",s}}function tR(t,e,n){let r;if(!n)r={type:"Literal",value:e};else if(e.includes(".")){const s=e.split(".");let i=-1,o;for(;++i<s.length;){const a=pC(s[i])?{type:"Identifier",name:s[i]}:{type:"Literal",value:s[i]};o=o?{type:"MemberExpression",object:o,property:a,computed:!!(i&&a.type==="Literal"),optional:!1}:a}r=o}else r=pC(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(r.type==="Literal"){const s=r.value;return Yv.call(t.components,s)?t.components[s]:s}if(t.evaluater)return t.evaluater.evaluateExpression(r);Ff(t)}function Ff(t,e){const n=new vs("Cannot handle MDX estrees without `createEvaluater`",{ancestors:t.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=t.filePath||void 0,n.url=Q5+"#cannot-handle-mdx-estrees-without-createevaluater",n}function GJ(t){const e={};let n;for(n in t)Yv.call(t,n)&&(e[qJ(n)]=t[n]);return e}function qJ(t){let e=t.replace(MJ,YJ);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function YJ(t){return"-"+t.toLowerCase()}const Ay={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},JJ={};function XJ(t,e){const n=e||JJ,r=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,s=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return nR(t,r,s)}function nR(t,e,n){if(QJ(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return TC(t.children,e,n)}return Array.isArray(t)?TC(t,e,n):""}function TC(t,e,n){const r=[];let s=-1;for(;++s<t.length;)r[s]=nR(t[s],e,n);return r.join("")}function QJ(t){return!!(t&&typeof t=="object")}const CC=document.createElement("i");function Qv(t){const e="&"+t+";";CC.innerHTML=e;const n=CC.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===e?!1:n}function Co(t,e,n,r){const s=t.length;let i=0,o;if(e<0?e=-e>s?0:s+e:e=e>s?s:e,n=n>0?n:0,r.length<1e4)o=Array.from(r),o.unshift(e,n),t.splice(...o);else for(n&&t.splice(e,n);i<r.length;)o=r.slice(i,i+1e4),o.unshift(e,0),t.splice(...o),i+=1e4,e+=1e4}function ki(t,e){return t.length>0?(Co(t,t.length,0,e),t):e}const EC={}.hasOwnProperty;function ZJ(t){const e={};let n=-1;for(;++n<t.length;)eX(e,t[n]);return e}function eX(t,e){let n;for(n in e){const s=(EC.call(t,n)?t[n]:void 0)||(t[n]={}),i=e[n];let o;if(i)for(o in i){EC.call(s,o)||(s[o]=[]);const a=i[o];tX(s[o],Array.isArray(a)?a:a?[a]:[])}}}function tX(t,e){let n=-1;const r=[];for(;++n<e.length;)(e[n].add==="after"?t:r).push(e[n]);Co(t,0,0,r)}function rR(t,e){const n=Number.parseInt(t,e);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function fu(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const ho=rl(/[A-Za-z]/),si=rl(/[\dA-Za-z]/),nX=rl(/[#-'*+\--9=?A-Z^-~]/);function db(t){return t!==null&&(t<32||t===127)}const fb=rl(/\d/),rX=rl(/[\dA-Fa-f]/),sX=rl(/[!-/:-@[-`{-~]/);function pn(t){return t!==null&&t<-2}function Ks(t){return t!==null&&(t<0||t===32)}function Rn(t){return t===-2||t===-1||t===32}const iX=rl(/\p{P}|\p{S}/u),oX=rl(/\s/);function rl(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function Uu(t){const e=[];let n=-1,r=0,s=0;for(;++n<t.length;){const i=t.charCodeAt(n);let o="";if(i===37&&si(t.charCodeAt(n+1))&&si(t.charCodeAt(n+2)))s=2;else if(i<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(i))||(o=String.fromCharCode(i));else if(i>55295&&i<57344){const a=t.charCodeAt(n+1);i<56320&&a>56319&&a<57344?(o=String.fromCharCode(i,a),s=1):o=""}else o=String.fromCharCode(i);o&&(e.push(t.slice(r,n),encodeURIComponent(o)),r=n+s+1,o=""),s&&(n+=s,s=0)}return e.join("")+t.slice(r)}function Kn(t,e,n,r){const s=r?r-1:Number.POSITIVE_INFINITY;let i=0;return o;function o(l){return Rn(l)?(t.enter(n),a(l)):e(l)}function a(l){return Rn(l)&&i++<s?(t.consume(l),a):(t.exit(n),e(l))}}const aX={tokenize:lX};function lX(t){const e=t.attempt(this.parser.constructs.contentInitial,r,s);let n;return e;function r(a){if(a===null){t.consume(a);return}return t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),Kn(t,e,"linePrefix")}function s(a){return t.enter("paragraph"),i(a)}function i(a){const l=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=l),n=l,o(a)}function o(a){if(a===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(a);return}return pn(a)?(t.consume(a),t.exit("chunkText"),i):(t.consume(a),o)}}const cX={tokenize:uX},NC={tokenize:dX};function uX(t){const e=this,n=[];let r=0,s,i,o;return a;function a(w){if(r<n.length){const _=n[r];return e.containerState=_[1],t.attempt(_[0].continuation,l,u)(w)}return u(w)}function l(w){if(r++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,s&&v();const _=e.events.length;let D=_,k;for(;D--;)if(e.events[D][0]==="exit"&&e.events[D][1].type==="chunkFlow"){k=e.events[D][1].end;break}g(r);let A=_;for(;A<e.events.length;)e.events[A][1].end={...k},A++;return Co(e.events,D+1,0,e.events.slice(_)),e.events.length=A,u(w)}return a(w)}function u(w){if(r===n.length){if(!s)return h(w);if(s.currentConstruct&&s.currentConstruct.concrete)return m(w);e.interrupt=!!(s.currentConstruct&&!s._gfmTableDynamicInterruptHack)}return e.containerState={},t.check(NC,d,f)(w)}function d(w){return s&&v(),g(r),h(w)}function f(w){return e.parser.lazy[e.now().line]=r!==n.length,o=e.now().offset,m(w)}function h(w){return e.containerState={},t.attempt(NC,p,m)(w)}function p(w){return r++,n.push([e.currentConstruct,e.containerState]),h(w)}function m(w){if(w===null){s&&v(),g(0),t.consume(w);return}return s=s||e.parser.flow(e.now()),t.enter("chunkFlow",{_tokenizer:s,contentType:"flow",previous:i}),y(w)}function y(w){if(w===null){b(t.exit("chunkFlow"),!0),g(0),t.consume(w);return}return pn(w)?(t.consume(w),b(t.exit("chunkFlow")),r=0,e.interrupt=void 0,a):(t.consume(w),y)}function b(w,_){const D=e.sliceStream(w);if(_&&D.push(null),w.previous=i,i&&(i.next=w),i=w,s.defineSkip(w.start),s.write(D),e.parser.lazy[w.start.line]){let k=s.events.length;for(;k--;)if(s.events[k][1].start.offset<o&&(!s.events[k][1].end||s.events[k][1].end.offset>o))return;const A=e.events.length;let N=A,E,S;for(;N--;)if(e.events[N][0]==="exit"&&e.events[N][1].type==="chunkFlow"){if(E){S=e.events[N][1].end;break}E=!0}for(g(r),k=A;k<e.events.length;)e.events[k][1].end={...S},k++;Co(e.events,N+1,0,e.events.slice(A)),e.events.length=k}}function g(w){let _=n.length;for(;_-- >w;){const D=n[_];e.containerState=D[1],D[0].exit.call(e,t)}n.length=w}function v(){s.write([null]),i=void 0,s=void 0,e.containerState._closeFlow=void 0}}function dX(t,e,n){return Kn(t,t.attempt(this.parser.constructs.document,e,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function jC(t){if(t===null||Ks(t)||oX(t))return 1;if(iX(t))return 2}function Zv(t,e,n){const r=[];let s=-1;for(;++s<t.length;){const i=t[s].resolveAll;i&&!r.includes(i)&&(e=i(e,n),r.push(i))}return e}const hb={name:"attention",resolveAll:fX,tokenize:hX};function fX(t,e){let n=-1,r,s,i,o,a,l,u,d;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(r=n;r--;)if(t[r][0]==="exit"&&t[r][1].type==="attentionSequence"&&t[r][1]._open&&e.sliceSerialize(t[r][1]).charCodeAt(0)===e.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[r][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[r][1].end.offset-t[r][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;l=t[r][1].end.offset-t[r][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const f={...t[r][1].end},h={...t[n][1].start};IC(f,-l),IC(h,l),o={type:l>1?"strongSequence":"emphasisSequence",start:f,end:{...t[r][1].end}},a={type:l>1?"strongSequence":"emphasisSequence",start:{...t[n][1].start},end:h},i={type:l>1?"strongText":"emphasisText",start:{...t[r][1].end},end:{...t[n][1].start}},s={type:l>1?"strong":"emphasis",start:{...o.start},end:{...a.end}},t[r][1].end={...o.start},t[n][1].start={...a.end},u=[],t[r][1].end.offset-t[r][1].start.offset&&(u=ki(u,[["enter",t[r][1],e],["exit",t[r][1],e]])),u=ki(u,[["enter",s,e],["enter",o,e],["exit",o,e],["enter",i,e]]),u=ki(u,Zv(e.parser.constructs.insideSpan.null,t.slice(r+1,n),e)),u=ki(u,[["exit",i,e],["enter",a,e],["exit",a,e],["exit",s,e]]),t[n][1].end.offset-t[n][1].start.offset?(d=2,u=ki(u,[["enter",t[n][1],e],["exit",t[n][1],e]])):d=0,Co(t,r-1,n-r+3,u),n=r+u.length-d-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function hX(t,e){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,s=jC(r);let i;return o;function o(l){return i=l,t.enter("attentionSequence"),a(l)}function a(l){if(l===i)return t.consume(l),a;const u=t.exit("attentionSequence"),d=jC(l),f=!d||d===2&&s||n.includes(l),h=!s||s===2&&d||n.includes(r);return u._open=!!(i===42?f:f&&(s||!h)),u._close=!!(i===42?h:h&&(d||!f)),e(l)}}function IC(t,e){t.column+=e,t.offset+=e,t._bufferIndex+=e}const pX={name:"autolink",tokenize:mX};function mX(t,e,n){let r=0;return s;function s(p){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),i}function i(p){return ho(p)?(t.consume(p),o):p===64?n(p):u(p)}function o(p){return p===43||p===45||p===46||si(p)?(r=1,a(p)):u(p)}function a(p){return p===58?(t.consume(p),r=0,l):(p===43||p===45||p===46||si(p))&&r++<32?(t.consume(p),a):(r=0,u(p))}function l(p){return p===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.exit("autolink"),e):p===null||p===32||p===60||db(p)?n(p):(t.consume(p),l)}function u(p){return p===64?(t.consume(p),d):nX(p)?(t.consume(p),u):n(p)}function d(p){return si(p)?f(p):n(p)}function f(p){return p===46?(t.consume(p),r=0,d):p===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.exit("autolink"),e):h(p)}function h(p){if((p===45||si(p))&&r++<63){const m=p===45?h:f;return t.consume(p),m}return n(p)}}const t0={partial:!0,tokenize:gX};function gX(t,e,n){return r;function r(i){return Rn(i)?Kn(t,s,"linePrefix")(i):s(i)}function s(i){return i===null||pn(i)?e(i):n(i)}}const sR={continuation:{tokenize:xX},exit:bX,name:"blockQuote",tokenize:yX};function yX(t,e,n){const r=this;return s;function s(o){if(o===62){const a=r.containerState;return a.open||(t.enter("blockQuote",{_container:!0}),a.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(o),t.exit("blockQuoteMarker"),i}return n(o)}function i(o){return Rn(o)?(t.enter("blockQuotePrefixWhitespace"),t.consume(o),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),e):(t.exit("blockQuotePrefix"),e(o))}}function xX(t,e,n){const r=this;return s;function s(o){return Rn(o)?Kn(t,i,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o):i(o)}function i(o){return t.attempt(sR,e,n)(o)}}function bX(t){t.exit("blockQuote")}const iR={name:"characterEscape",tokenize:wX};function wX(t,e,n){return r;function r(i){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(i),t.exit("escapeMarker"),s}function s(i){return sX(i)?(t.enter("characterEscapeValue"),t.consume(i),t.exit("characterEscapeValue"),t.exit("characterEscape"),e):n(i)}}const oR={name:"characterReference",tokenize:vX};function vX(t,e,n){const r=this;let s=0,i,o;return a;function a(f){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(f),t.exit("characterReferenceMarker"),l}function l(f){return f===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(f),t.exit("characterReferenceMarkerNumeric"),u):(t.enter("characterReferenceValue"),i=31,o=si,d(f))}function u(f){return f===88||f===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(f),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),i=6,o=rX,d):(t.enter("characterReferenceValue"),i=7,o=fb,d(f))}function d(f){if(f===59&&s){const h=t.exit("characterReferenceValue");return o===si&&!Qv(r.sliceSerialize(h))?n(f):(t.enter("characterReferenceMarker"),t.consume(f),t.exit("characterReferenceMarker"),t.exit("characterReference"),e)}return o(f)&&s++<i?(t.consume(f),d):n(f)}}const MC={partial:!0,tokenize:SX},DC={concrete:!0,name:"codeFenced",tokenize:kX};function kX(t,e,n){const r=this,s={partial:!0,tokenize:D};let i=0,o=0,a;return l;function l(k){return u(k)}function u(k){const A=r.events[r.events.length-1];return i=A&&A[1].type==="linePrefix"?A[2].sliceSerialize(A[1],!0).length:0,a=k,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),d(k)}function d(k){return k===a?(o++,t.consume(k),d):o<3?n(k):(t.exit("codeFencedFenceSequence"),Rn(k)?Kn(t,f,"whitespace")(k):f(k))}function f(k){return k===null||pn(k)?(t.exit("codeFencedFence"),r.interrupt?e(k):t.check(MC,y,_)(k)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),h(k))}function h(k){return k===null||pn(k)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),f(k)):Rn(k)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),Kn(t,p,"whitespace")(k)):k===96&&k===a?n(k):(t.consume(k),h)}function p(k){return k===null||pn(k)?f(k):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),m(k))}function m(k){return k===null||pn(k)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),f(k)):k===96&&k===a?n(k):(t.consume(k),m)}function y(k){return t.attempt(s,_,b)(k)}function b(k){return t.enter("lineEnding"),t.consume(k),t.exit("lineEnding"),g}function g(k){return i>0&&Rn(k)?Kn(t,v,"linePrefix",i+1)(k):v(k)}function v(k){return k===null||pn(k)?t.check(MC,y,_)(k):(t.enter("codeFlowValue"),w(k))}function w(k){return k===null||pn(k)?(t.exit("codeFlowValue"),v(k)):(t.consume(k),w)}function _(k){return t.exit("codeFenced"),e(k)}function D(k,A,N){let E=0;return S;function S(H){return k.enter("lineEnding"),k.consume(H),k.exit("lineEnding"),T}function T(H){return k.enter("codeFencedFence"),Rn(H)?Kn(k,C,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(H):C(H)}function C(H){return H===a?(k.enter("codeFencedFenceSequence"),O(H)):N(H)}function O(H){return H===a?(E++,k.consume(H),O):E>=o?(k.exit("codeFencedFenceSequence"),Rn(H)?Kn(k,P,"whitespace")(H):P(H)):N(H)}function P(H){return H===null||pn(H)?(k.exit("codeFencedFence"),A(H)):N(H)}}}function SX(t,e,n){const r=this;return s;function s(o){return o===null?n(o):(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),i)}function i(o){return r.parser.lazy[r.now().line]?n(o):e(o)}}const Ry={name:"codeIndented",tokenize:TX},_X={partial:!0,tokenize:CX};function TX(t,e,n){const r=this;return s;function s(u){return t.enter("codeIndented"),Kn(t,i,"linePrefix",4+1)(u)}function i(u){const d=r.events[r.events.length-1];return d&&d[1].type==="linePrefix"&&d[2].sliceSerialize(d[1],!0).length>=4?o(u):n(u)}function o(u){return u===null?l(u):pn(u)?t.attempt(_X,o,l)(u):(t.enter("codeFlowValue"),a(u))}function a(u){return u===null||pn(u)?(t.exit("codeFlowValue"),o(u)):(t.consume(u),a)}function l(u){return t.exit("codeIndented"),e(u)}}function CX(t,e,n){const r=this;return s;function s(o){return r.parser.lazy[r.now().line]?n(o):pn(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),s):Kn(t,i,"linePrefix",4+1)(o)}function i(o){const a=r.events[r.events.length-1];return a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):pn(o)?s(o):n(o)}}const EX={name:"codeText",previous:jX,resolve:NX,tokenize:IX};function NX(t){let e=t.length-4,n=3,r,s;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[e][1].type==="lineEnding"||t[e][1].type==="space")){for(r=n;++r<e;)if(t[r][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[e][1].type="codeTextPadding",n+=2,e-=2;break}}for(r=n-1,e++;++r<=e;)s===void 0?r!==e&&t[r][1].type!=="lineEnding"&&(s=r):(r===e||t[r][1].type==="lineEnding")&&(t[s][1].type="codeTextData",r!==s+2&&(t[s][1].end=t[r-1][1].end,t.splice(s+2,r-s-2),e-=r-s-2,r=s+2),s=void 0);return t}function jX(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function IX(t,e,n){let r=0,s,i;return o;function o(f){return t.enter("codeText"),t.enter("codeTextSequence"),a(f)}function a(f){return f===96?(t.consume(f),r++,a):(t.exit("codeTextSequence"),l(f))}function l(f){return f===null?n(f):f===32?(t.enter("space"),t.consume(f),t.exit("space"),l):f===96?(i=t.enter("codeTextSequence"),s=0,d(f)):pn(f)?(t.enter("lineEnding"),t.consume(f),t.exit("lineEnding"),l):(t.enter("codeTextData"),u(f))}function u(f){return f===null||f===32||f===96||pn(f)?(t.exit("codeTextData"),l(f)):(t.consume(f),u)}function d(f){return f===96?(t.consume(f),s++,d):s===r?(t.exit("codeTextSequence"),t.exit("codeText"),e(f)):(i.type="codeTextData",u(f))}}class MX{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,n){const r=n??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(e,r):e>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(e,n,r){const s=n||0;this.setCursor(Math.trunc(e));const i=this.right.splice(this.right.length-s,Number.POSITIVE_INFINITY);return r&&rd(this.left,r),i.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),rd(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),rd(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const n=this.left.splice(e,Number.POSITIVE_INFINITY);rd(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);rd(this.left,n.reverse())}}}function rd(t,e){let n=0;if(e.length<1e4)t.push(...e);else for(;n<e.length;)t.push(...e.slice(n,n+1e4)),n+=1e4}function aR(t){const e={};let n=-1,r,s,i,o,a,l,u;const d=new MX(t);for(;++n<d.length;){for(;n in e;)n=e[n];if(r=d.get(n),n&&r[1].type==="chunkFlow"&&d.get(n-1)[1].type==="listItemPrefix"&&(l=r[1]._tokenizer.events,i=0,i<l.length&&l[i][1].type==="lineEndingBlank"&&(i+=2),i<l.length&&l[i][1].type==="content"))for(;++i<l.length&&l[i][1].type!=="content";)l[i][1].type==="chunkText"&&(l[i][1]._isInFirstContentOfListItem=!0,i++);if(r[0]==="enter")r[1].contentType&&(Object.assign(e,DX(d,n)),n=e[n],u=!0);else if(r[1]._container){for(i=n,s=void 0;i--;)if(o=d.get(i),o[1].type==="lineEnding"||o[1].type==="lineEndingBlank")o[0]==="enter"&&(s&&(d.get(s)[1].type="lineEndingBlank"),o[1].type="lineEnding",s=i);else if(!(o[1].type==="linePrefix"||o[1].type==="listItemIndent"))break;s&&(r[1].end={...d.get(s)[1].start},a=d.slice(s,n),a.unshift(r),d.splice(s,n-s+1,a))}}return Co(t,0,Number.POSITIVE_INFINITY,d.slice(0)),!u}function DX(t,e){const n=t.get(e)[1],r=t.get(e)[2];let s=e-1;const i=[];let o=n._tokenizer;o||(o=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(o._contentTypeTextTrailing=!0));const a=o.events,l=[],u={};let d,f,h=-1,p=n,m=0,y=0;const b=[y];for(;p;){for(;t.get(++s)[1]!==p;);i.push(s),p._tokenizer||(d=r.sliceStream(p),p.next||d.push(null),f&&o.defineSkip(p.start),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(d),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),f=p,p=p.next}for(p=n;++h<a.length;)a[h][0]==="exit"&&a[h-1][0]==="enter"&&a[h][1].type===a[h-1][1].type&&a[h][1].start.line!==a[h][1].end.line&&(y=h+1,b.push(y),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(o.events=[],p?(p._tokenizer=void 0,p.previous=void 0):b.pop(),h=b.length;h--;){const g=a.slice(b[h],b[h+1]),v=i.pop();l.push([v,v+g.length-1]),t.splice(v,2,g)}for(l.reverse(),h=-1;++h<l.length;)u[m+l[h][0]]=m+l[h][1],m+=l[h][1]-l[h][0]-1;return u}const AX={resolve:OX,tokenize:PX},RX={partial:!0,tokenize:LX};function OX(t){return aR(t),t}function PX(t,e){let n;return r;function r(a){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),s(a)}function s(a){return a===null?i(a):pn(a)?t.check(RX,o,i)(a):(t.consume(a),s)}function i(a){return t.exit("chunkContent"),t.exit("content"),e(a)}function o(a){return t.consume(a),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,s}}function LX(t,e,n){const r=this;return s;function s(o){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),Kn(t,i,"linePrefix")}function i(o){if(o===null||pn(o))return n(o);const a=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):t.interrupt(r.parser.constructs.flow,n,e)(o)}}function lR(t,e,n,r,s,i,o,a,l){const u=l||Number.POSITIVE_INFINITY;let d=0;return f;function f(g){return g===60?(t.enter(r),t.enter(s),t.enter(i),t.consume(g),t.exit(i),h):g===null||g===32||g===41||db(g)?n(g):(t.enter(r),t.enter(o),t.enter(a),t.enter("chunkString",{contentType:"string"}),y(g))}function h(g){return g===62?(t.enter(i),t.consume(g),t.exit(i),t.exit(s),t.exit(r),e):(t.enter(a),t.enter("chunkString",{contentType:"string"}),p(g))}function p(g){return g===62?(t.exit("chunkString"),t.exit(a),h(g)):g===null||g===60||pn(g)?n(g):(t.consume(g),g===92?m:p)}function m(g){return g===60||g===62||g===92?(t.consume(g),p):p(g)}function y(g){return!d&&(g===null||g===41||Ks(g))?(t.exit("chunkString"),t.exit(a),t.exit(o),t.exit(r),e(g)):d<u&&g===40?(t.consume(g),d++,y):g===41?(t.consume(g),d--,y):g===null||g===32||g===40||db(g)?n(g):(t.consume(g),g===92?b:y)}function b(g){return g===40||g===41||g===92?(t.consume(g),y):y(g)}}function cR(t,e,n,r,s,i){const o=this;let a=0,l;return u;function u(p){return t.enter(r),t.enter(s),t.consume(p),t.exit(s),t.enter(i),d}function d(p){return a>999||p===null||p===91||p===93&&!l||p===94&&!a&&"_hiddenFootnoteSupport"in o.parser.constructs?n(p):p===93?(t.exit(i),t.enter(s),t.consume(p),t.exit(s),t.exit(r),e):pn(p)?(t.enter("lineEnding"),t.consume(p),t.exit("lineEnding"),d):(t.enter("chunkString",{contentType:"string"}),f(p))}function f(p){return p===null||p===91||p===93||pn(p)||a++>999?(t.exit("chunkString"),d(p)):(t.consume(p),l||(l=!Rn(p)),p===92?h:f)}function h(p){return p===91||p===92||p===93?(t.consume(p),a++,f):f(p)}}function uR(t,e,n,r,s,i){let o;return a;function a(h){return h===34||h===39||h===40?(t.enter(r),t.enter(s),t.consume(h),t.exit(s),o=h===40?41:h,l):n(h)}function l(h){return h===o?(t.enter(s),t.consume(h),t.exit(s),t.exit(r),e):(t.enter(i),u(h))}function u(h){return h===o?(t.exit(i),l(o)):h===null?n(h):pn(h)?(t.enter("lineEnding"),t.consume(h),t.exit("lineEnding"),Kn(t,u,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),d(h))}function d(h){return h===o||h===null||pn(h)?(t.exit("chunkString"),u(h)):(t.consume(h),h===92?f:d)}function f(h){return h===o||h===92?(t.consume(h),d):d(h)}}function Wd(t,e){let n;return r;function r(s){return pn(s)?(t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),n=!0,r):Rn(s)?Kn(t,r,n?"linePrefix":"lineSuffix")(s):e(s)}}const $X={name:"definition",tokenize:FX},zX={partial:!0,tokenize:BX};function FX(t,e,n){const r=this;let s;return i;function i(p){return t.enter("definition"),o(p)}function o(p){return cR.call(r,t,a,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(p)}function a(p){return s=fu(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),p===58?(t.enter("definitionMarker"),t.consume(p),t.exit("definitionMarker"),l):n(p)}function l(p){return Ks(p)?Wd(t,u)(p):u(p)}function u(p){return lR(t,d,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(p)}function d(p){return t.attempt(zX,f,f)(p)}function f(p){return Rn(p)?Kn(t,h,"whitespace")(p):h(p)}function h(p){return p===null||pn(p)?(t.exit("definition"),r.parser.defined.push(s),e(p)):n(p)}}function BX(t,e,n){return r;function r(a){return Ks(a)?Wd(t,s)(a):n(a)}function s(a){return uR(t,i,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(a)}function i(a){return Rn(a)?Kn(t,o,"whitespace")(a):o(a)}function o(a){return a===null||pn(a)?e(a):n(a)}}const UX={name:"hardBreakEscape",tokenize:HX};function HX(t,e,n){return r;function r(i){return t.enter("hardBreakEscape"),t.consume(i),s}function s(i){return pn(i)?(t.exit("hardBreakEscape"),e(i)):n(i)}}const VX={name:"headingAtx",resolve:WX,tokenize:KX};function WX(t,e){let n=t.length-2,r=3,s,i;return t[r][1].type==="whitespace"&&(r+=2),n-2>r&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(r===n-1||n-4>r&&t[n-2][1].type==="whitespace")&&(n-=r+1===n?2:4),n>r&&(s={type:"atxHeadingText",start:t[r][1].start,end:t[n][1].end},i={type:"chunkText",start:t[r][1].start,end:t[n][1].end,contentType:"text"},Co(t,r,n-r+1,[["enter",s,e],["enter",i,e],["exit",i,e],["exit",s,e]])),t}function KX(t,e,n){let r=0;return s;function s(d){return t.enter("atxHeading"),i(d)}function i(d){return t.enter("atxHeadingSequence"),o(d)}function o(d){return d===35&&r++<6?(t.consume(d),o):d===null||Ks(d)?(t.exit("atxHeadingSequence"),a(d)):n(d)}function a(d){return d===35?(t.enter("atxHeadingSequence"),l(d)):d===null||pn(d)?(t.exit("atxHeading"),e(d)):Rn(d)?Kn(t,a,"whitespace")(d):(t.enter("atxHeadingText"),u(d))}function l(d){return d===35?(t.consume(d),l):(t.exit("atxHeadingSequence"),a(d))}function u(d){return d===null||d===35||Ks(d)?(t.exit("atxHeadingText"),a(d)):(t.consume(d),u)}}const GX=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],AC=["pre","script","style","textarea"],qX={concrete:!0,name:"htmlFlow",resolveTo:XX,tokenize:QX},YX={partial:!0,tokenize:eQ},JX={partial:!0,tokenize:ZX};function XX(t){let e=t.length;for(;e--&&!(t[e][0]==="enter"&&t[e][1].type==="htmlFlow"););return e>1&&t[e-2][1].type==="linePrefix"&&(t[e][1].start=t[e-2][1].start,t[e+1][1].start=t[e-2][1].start,t.splice(e-2,2)),t}function QX(t,e,n){const r=this;let s,i,o,a,l;return u;function u(F){return d(F)}function d(F){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(F),f}function f(F){return F===33?(t.consume(F),h):F===47?(t.consume(F),i=!0,y):F===63?(t.consume(F),s=3,r.interrupt?e:R):ho(F)?(t.consume(F),o=String.fromCharCode(F),b):n(F)}function h(F){return F===45?(t.consume(F),s=2,p):F===91?(t.consume(F),s=5,a=0,m):ho(F)?(t.consume(F),s=4,r.interrupt?e:R):n(F)}function p(F){return F===45?(t.consume(F),r.interrupt?e:R):n(F)}function m(F){const B="CDATA[";return F===B.charCodeAt(a++)?(t.consume(F),a===B.length?r.interrupt?e:C:m):n(F)}function y(F){return ho(F)?(t.consume(F),o=String.fromCharCode(F),b):n(F)}function b(F){if(F===null||F===47||F===62||Ks(F)){const B=F===47,se=o.toLowerCase();return!B&&!i&&AC.includes(se)?(s=1,r.interrupt?e(F):C(F)):GX.includes(o.toLowerCase())?(s=6,B?(t.consume(F),g):r.interrupt?e(F):C(F)):(s=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(F):i?v(F):w(F))}return F===45||si(F)?(t.consume(F),o+=String.fromCharCode(F),b):n(F)}function g(F){return F===62?(t.consume(F),r.interrupt?e:C):n(F)}function v(F){return Rn(F)?(t.consume(F),v):S(F)}function w(F){return F===47?(t.consume(F),S):F===58||F===95||ho(F)?(t.consume(F),_):Rn(F)?(t.consume(F),w):S(F)}function _(F){return F===45||F===46||F===58||F===95||si(F)?(t.consume(F),_):D(F)}function D(F){return F===61?(t.consume(F),k):Rn(F)?(t.consume(F),D):w(F)}function k(F){return F===null||F===60||F===61||F===62||F===96?n(F):F===34||F===39?(t.consume(F),l=F,A):Rn(F)?(t.consume(F),k):N(F)}function A(F){return F===l?(t.consume(F),l=null,E):F===null||pn(F)?n(F):(t.consume(F),A)}function N(F){return F===null||F===34||F===39||F===47||F===60||F===61||F===62||F===96||Ks(F)?D(F):(t.consume(F),N)}function E(F){return F===47||F===62||Rn(F)?w(F):n(F)}function S(F){return F===62?(t.consume(F),T):n(F)}function T(F){return F===null||pn(F)?C(F):Rn(F)?(t.consume(F),T):n(F)}function C(F){return F===45&&s===2?(t.consume(F),M):F===60&&s===1?(t.consume(F),I):F===62&&s===4?(t.consume(F),Ee):F===63&&s===3?(t.consume(F),R):F===93&&s===5?(t.consume(F),G):pn(F)&&(s===6||s===7)?(t.exit("htmlFlowData"),t.check(YX,ge,O)(F)):F===null||pn(F)?(t.exit("htmlFlowData"),O(F)):(t.consume(F),C)}function O(F){return t.check(JX,P,ge)(F)}function P(F){return t.enter("lineEnding"),t.consume(F),t.exit("lineEnding"),H}function H(F){return F===null||pn(F)?O(F):(t.enter("htmlFlowData"),C(F))}function M(F){return F===45?(t.consume(F),R):C(F)}function I(F){return F===47?(t.consume(F),o="",K):C(F)}function K(F){if(F===62){const B=o.toLowerCase();return AC.includes(B)?(t.consume(F),Ee):C(F)}return ho(F)&&o.length<8?(t.consume(F),o+=String.fromCharCode(F),K):C(F)}function G(F){return F===93?(t.consume(F),R):C(F)}function R(F){return F===62?(t.consume(F),Ee):F===45&&s===2?(t.consume(F),R):C(F)}function Ee(F){return F===null||pn(F)?(t.exit("htmlFlowData"),ge(F)):(t.consume(F),Ee)}function ge(F){return t.exit("htmlFlow"),e(F)}}function ZX(t,e,n){const r=this;return s;function s(o){return pn(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),i):n(o)}function i(o){return r.parser.lazy[r.now().line]?n(o):e(o)}}function eQ(t,e,n){return r;function r(s){return t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),t.attempt(t0,e,n)}}const tQ={name:"htmlText",tokenize:nQ};function nQ(t,e,n){const r=this;let s,i,o;return a;function a(R){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(R),l}function l(R){return R===33?(t.consume(R),u):R===47?(t.consume(R),D):R===63?(t.consume(R),w):ho(R)?(t.consume(R),N):n(R)}function u(R){return R===45?(t.consume(R),d):R===91?(t.consume(R),i=0,m):ho(R)?(t.consume(R),v):n(R)}function d(R){return R===45?(t.consume(R),p):n(R)}function f(R){return R===null?n(R):R===45?(t.consume(R),h):pn(R)?(o=f,I(R)):(t.consume(R),f)}function h(R){return R===45?(t.consume(R),p):f(R)}function p(R){return R===62?M(R):R===45?h(R):f(R)}function m(R){const Ee="CDATA[";return R===Ee.charCodeAt(i++)?(t.consume(R),i===Ee.length?y:m):n(R)}function y(R){return R===null?n(R):R===93?(t.consume(R),b):pn(R)?(o=y,I(R)):(t.consume(R),y)}function b(R){return R===93?(t.consume(R),g):y(R)}function g(R){return R===62?M(R):R===93?(t.consume(R),g):y(R)}function v(R){return R===null||R===62?M(R):pn(R)?(o=v,I(R)):(t.consume(R),v)}function w(R){return R===null?n(R):R===63?(t.consume(R),_):pn(R)?(o=w,I(R)):(t.consume(R),w)}function _(R){return R===62?M(R):w(R)}function D(R){return ho(R)?(t.consume(R),k):n(R)}function k(R){return R===45||si(R)?(t.consume(R),k):A(R)}function A(R){return pn(R)?(o=A,I(R)):Rn(R)?(t.consume(R),A):M(R)}function N(R){return R===45||si(R)?(t.consume(R),N):R===47||R===62||Ks(R)?E(R):n(R)}function E(R){return R===47?(t.consume(R),M):R===58||R===95||ho(R)?(t.consume(R),S):pn(R)?(o=E,I(R)):Rn(R)?(t.consume(R),E):M(R)}function S(R){return R===45||R===46||R===58||R===95||si(R)?(t.consume(R),S):T(R)}function T(R){return R===61?(t.consume(R),C):pn(R)?(o=T,I(R)):Rn(R)?(t.consume(R),T):E(R)}function C(R){return R===null||R===60||R===61||R===62||R===96?n(R):R===34||R===39?(t.consume(R),s=R,O):pn(R)?(o=C,I(R)):Rn(R)?(t.consume(R),C):(t.consume(R),P)}function O(R){return R===s?(t.consume(R),s=void 0,H):R===null?n(R):pn(R)?(o=O,I(R)):(t.consume(R),O)}function P(R){return R===null||R===34||R===39||R===60||R===61||R===96?n(R):R===47||R===62||Ks(R)?E(R):(t.consume(R),P)}function H(R){return R===47||R===62||Ks(R)?E(R):n(R)}function M(R){return R===62?(t.consume(R),t.exit("htmlTextData"),t.exit("htmlText"),e):n(R)}function I(R){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(R),t.exit("lineEnding"),K}function K(R){return Rn(R)?Kn(t,G,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(R):G(R)}function G(R){return t.enter("htmlTextData"),o(R)}}const ek={name:"labelEnd",resolveAll:oQ,resolveTo:aQ,tokenize:lQ},rQ={tokenize:cQ},sQ={tokenize:uQ},iQ={tokenize:dQ};function oQ(t){let e=-1;const n=[];for(;++e<t.length;){const r=t[e][1];if(n.push(t[e]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const s=r.type==="labelImage"?4:2;r.type="data",e+=s}}return t.length!==n.length&&Co(t,0,t.length,n),t}function aQ(t,e){let n=t.length,r=0,s,i,o,a;for(;n--;)if(s=t[n][1],i){if(s.type==="link"||s.type==="labelLink"&&s._inactive)break;t[n][0]==="enter"&&s.type==="labelLink"&&(s._inactive=!0)}else if(o){if(t[n][0]==="enter"&&(s.type==="labelImage"||s.type==="labelLink")&&!s._balanced&&(i=n,s.type!=="labelLink")){r=2;break}}else s.type==="labelEnd"&&(o=n);const l={type:t[i][1].type==="labelLink"?"link":"image",start:{...t[i][1].start},end:{...t[t.length-1][1].end}},u={type:"label",start:{...t[i][1].start},end:{...t[o][1].end}},d={type:"labelText",start:{...t[i+r+2][1].end},end:{...t[o-2][1].start}};return a=[["enter",l,e],["enter",u,e]],a=ki(a,t.slice(i+1,i+r+3)),a=ki(a,[["enter",d,e]]),a=ki(a,Zv(e.parser.constructs.insideSpan.null,t.slice(i+r+4,o-3),e)),a=ki(a,[["exit",d,e],t[o-2],t[o-1],["exit",u,e]]),a=ki(a,t.slice(o+1)),a=ki(a,[["exit",l,e]]),Co(t,i,t.length,a),t}function lQ(t,e,n){const r=this;let s=r.events.length,i,o;for(;s--;)if((r.events[s][1].type==="labelImage"||r.events[s][1].type==="labelLink")&&!r.events[s][1]._balanced){i=r.events[s][1];break}return a;function a(h){return i?i._inactive?f(h):(o=r.parser.defined.includes(fu(r.sliceSerialize({start:i.end,end:r.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(h),t.exit("labelMarker"),t.exit("labelEnd"),l):n(h)}function l(h){return h===40?t.attempt(rQ,d,o?d:f)(h):h===91?t.attempt(sQ,d,o?u:f)(h):o?d(h):f(h)}function u(h){return t.attempt(iQ,d,f)(h)}function d(h){return e(h)}function f(h){return i._balanced=!0,n(h)}}function cQ(t,e,n){return r;function r(f){return t.enter("resource"),t.enter("resourceMarker"),t.consume(f),t.exit("resourceMarker"),s}function s(f){return Ks(f)?Wd(t,i)(f):i(f)}function i(f){return f===41?d(f):lR(t,o,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(f)}function o(f){return Ks(f)?Wd(t,l)(f):d(f)}function a(f){return n(f)}function l(f){return f===34||f===39||f===40?uR(t,u,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(f):d(f)}function u(f){return Ks(f)?Wd(t,d)(f):d(f)}function d(f){return f===41?(t.enter("resourceMarker"),t.consume(f),t.exit("resourceMarker"),t.exit("resource"),e):n(f)}}function uQ(t,e,n){const r=this;return s;function s(a){return cR.call(r,t,i,o,"reference","referenceMarker","referenceString")(a)}function i(a){return r.parser.defined.includes(fu(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(a):n(a)}function o(a){return n(a)}}function dQ(t,e,n){return r;function r(i){return t.enter("reference"),t.enter("referenceMarker"),t.consume(i),t.exit("referenceMarker"),s}function s(i){return i===93?(t.enter("referenceMarker"),t.consume(i),t.exit("referenceMarker"),t.exit("reference"),e):n(i)}}const fQ={name:"labelStartImage",resolveAll:ek.resolveAll,tokenize:hQ};function hQ(t,e,n){const r=this;return s;function s(a){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(a),t.exit("labelImageMarker"),i}function i(a){return a===91?(t.enter("labelMarker"),t.consume(a),t.exit("labelMarker"),t.exit("labelImage"),o):n(a)}function o(a){return a===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(a):e(a)}}const pQ={name:"labelStartLink",resolveAll:ek.resolveAll,tokenize:mQ};function mQ(t,e,n){const r=this;return s;function s(o){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(o),t.exit("labelMarker"),t.exit("labelLink"),i}function i(o){return o===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(o):e(o)}}const Oy={name:"lineEnding",tokenize:gQ};function gQ(t,e){return n;function n(r){return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),Kn(t,e,"linePrefix")}}const Ip={name:"thematicBreak",tokenize:yQ};function yQ(t,e,n){let r=0,s;return i;function i(u){return t.enter("thematicBreak"),o(u)}function o(u){return s=u,a(u)}function a(u){return u===s?(t.enter("thematicBreakSequence"),l(u)):r>=3&&(u===null||pn(u))?(t.exit("thematicBreak"),e(u)):n(u)}function l(u){return u===s?(t.consume(u),r++,l):(t.exit("thematicBreakSequence"),Rn(u)?Kn(t,a,"whitespace")(u):a(u))}}const As={continuation:{tokenize:vQ},exit:SQ,name:"list",tokenize:wQ},xQ={partial:!0,tokenize:_Q},bQ={partial:!0,tokenize:kQ};function wQ(t,e,n){const r=this,s=r.events[r.events.length-1];let i=s&&s[1].type==="linePrefix"?s[2].sliceSerialize(s[1],!0).length:0,o=0;return a;function a(p){const m=r.containerState.type||(p===42||p===43||p===45?"listUnordered":"listOrdered");if(m==="listUnordered"?!r.containerState.marker||p===r.containerState.marker:fb(p)){if(r.containerState.type||(r.containerState.type=m,t.enter(m,{_container:!0})),m==="listUnordered")return t.enter("listItemPrefix"),p===42||p===45?t.check(Ip,n,u)(p):u(p);if(!r.interrupt||p===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),l(p)}return n(p)}function l(p){return fb(p)&&++o<10?(t.consume(p),l):(!r.interrupt||o<2)&&(r.containerState.marker?p===r.containerState.marker:p===41||p===46)?(t.exit("listItemValue"),u(p)):n(p)}function u(p){return t.enter("listItemMarker"),t.consume(p),t.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||p,t.check(t0,r.interrupt?n:d,t.attempt(xQ,h,f))}function d(p){return r.containerState.initialBlankLine=!0,i++,h(p)}function f(p){return Rn(p)?(t.enter("listItemPrefixWhitespace"),t.consume(p),t.exit("listItemPrefixWhitespace"),h):n(p)}function h(p){return r.containerState.size=i+r.sliceSerialize(t.exit("listItemPrefix"),!0).length,e(p)}}function vQ(t,e,n){const r=this;return r.containerState._closeFlow=void 0,t.check(t0,s,i);function s(a){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,Kn(t,e,"listItemIndent",r.containerState.size+1)(a)}function i(a){return r.containerState.furtherBlankLines||!Rn(a)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,o(a)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,t.attempt(bQ,e,o)(a))}function o(a){return r.containerState._closeFlow=!0,r.interrupt=void 0,Kn(t,t.attempt(As,e,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a)}}function kQ(t,e,n){const r=this;return Kn(t,s,"listItemIndent",r.containerState.size+1);function s(i){const o=r.events[r.events.length-1];return o&&o[1].type==="listItemIndent"&&o[2].sliceSerialize(o[1],!0).length===r.containerState.size?e(i):n(i)}}function SQ(t){t.exit(this.containerState.type)}function _Q(t,e,n){const r=this;return Kn(t,s,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4+1);function s(i){const o=r.events[r.events.length-1];return!Rn(i)&&o&&o[1].type==="listItemPrefixWhitespace"?e(i):n(i)}}const RC={name:"setextUnderline",resolveTo:TQ,tokenize:CQ};function TQ(t,e){let n=t.length,r,s,i;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){r=n;break}t[n][1].type==="paragraph"&&(s=n)}else t[n][1].type==="content"&&t.splice(n,1),!i&&t[n][1].type==="definition"&&(i=n);const o={type:"setextHeading",start:{...t[r][1].start},end:{...t[t.length-1][1].end}};return t[s][1].type="setextHeadingText",i?(t.splice(s,0,["enter",o,e]),t.splice(i+1,0,["exit",t[r][1],e]),t[r][1].end={...t[i][1].end}):t[r][1]=o,t.push(["exit",o,e]),t}function CQ(t,e,n){const r=this;let s;return i;function i(u){let d=r.events.length,f;for(;d--;)if(r.events[d][1].type!=="lineEnding"&&r.events[d][1].type!=="linePrefix"&&r.events[d][1].type!=="content"){f=r.events[d][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||f)?(t.enter("setextHeadingLine"),s=u,o(u)):n(u)}function o(u){return t.enter("setextHeadingLineSequence"),a(u)}function a(u){return u===s?(t.consume(u),a):(t.exit("setextHeadingLineSequence"),Rn(u)?Kn(t,l,"lineSuffix")(u):l(u))}function l(u){return u===null||pn(u)?(t.exit("setextHeadingLine"),e(u)):n(u)}}const EQ={tokenize:NQ};function NQ(t){const e=this,n=t.attempt(t0,r,t.attempt(this.parser.constructs.flowInitial,s,Kn(t,t.attempt(this.parser.constructs.flow,s,t.attempt(AX,s)),"linePrefix")));return n;function r(i){if(i===null){t.consume(i);return}return t.enter("lineEndingBlank"),t.consume(i),t.exit("lineEndingBlank"),e.currentConstruct=void 0,n}function s(i){if(i===null){t.consume(i);return}return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),e.currentConstruct=void 0,n}}const jQ={resolveAll:fR()},IQ=dR("string"),MQ=dR("text");function dR(t){return{resolveAll:fR(t==="text"?DQ:void 0),tokenize:e};function e(n){const r=this,s=this.parser.constructs[t],i=n.attempt(s,o,a);return o;function o(d){return u(d)?i(d):a(d)}function a(d){if(d===null){n.consume(d);return}return n.enter("data"),n.consume(d),l}function l(d){return u(d)?(n.exit("data"),i(d)):(n.consume(d),l)}function u(d){if(d===null)return!0;const f=s[d];let h=-1;if(f)for(;++h<f.length;){const p=f[h];if(!p.previous||p.previous.call(r,r.previous))return!0}return!1}}}function fR(t){return e;function e(n,r){let s=-1,i;for(;++s<=n.length;)i===void 0?n[s]&&n[s][1].type==="data"&&(i=s,s++):(!n[s]||n[s][1].type!=="data")&&(s!==i+2&&(n[i][1].end=n[s-1][1].end,n.splice(i+2,s-i-2),s=i+2),i=void 0);return t?t(n,r):n}}function DQ(t,e){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const r=t[n-1][1],s=e.sliceStream(r);let i=s.length,o=-1,a=0,l;for(;i--;){const u=s[i];if(typeof u=="string"){for(o=u.length;u.charCodeAt(o-1)===32;)a++,o--;if(o)break;o=-1}else if(u===-2)l=!0,a++;else if(u!==-1){i++;break}}if(e._contentTypeTextTrailing&&n===t.length&&(a=0),a){const u={type:n===t.length||l||a<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:i?o:r.start._bufferIndex+o,_index:r.start._index+i,line:r.end.line,column:r.end.column-a,offset:r.end.offset-a},end:{...r.end}};r.end={...u.start},r.start.offset===r.end.offset?Object.assign(r,u):(t.splice(n,0,["enter",u,e],["exit",u,e]),n+=2)}n++}return t}const AQ={42:As,43:As,45:As,48:As,49:As,50:As,51:As,52:As,53:As,54:As,55:As,56:As,57:As,62:sR},RQ={91:$X},OQ={[-2]:Ry,[-1]:Ry,32:Ry},PQ={35:VX,42:Ip,45:[RC,Ip],60:qX,61:RC,95:Ip,96:DC,126:DC},LQ={38:oR,92:iR},$Q={[-5]:Oy,[-4]:Oy,[-3]:Oy,33:fQ,38:oR,42:hb,60:[pX,tQ],91:pQ,92:[UX,iR],93:ek,95:hb,96:EX},zQ={null:[hb,jQ]},FQ={null:[42,95]},BQ={null:[]},UQ=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:FQ,contentInitial:RQ,disable:BQ,document:AQ,flow:PQ,flowInitial:OQ,insideSpan:zQ,string:LQ,text:$Q},Symbol.toStringTag,{value:"Module"}));function HQ(t,e,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const s={},i=[];let o=[],a=[];const l={attempt:A(D),check:A(k),consume:v,enter:w,exit:_,interrupt:A(k,{interrupt:!0})},u={code:null,containerState:{},defineSkip:y,events:[],now:m,parser:t,previous:null,sliceSerialize:h,sliceStream:p,write:f};let d=e.tokenize.call(u,l);return e.resolveAll&&i.push(e),u;function f(T){return o=ki(o,T),b(),o[o.length-1]!==null?[]:(N(e,0),u.events=Zv(i,u.events,u),u.events)}function h(T,C){return WQ(p(T),C)}function p(T){return VQ(o,T)}function m(){const{_bufferIndex:T,_index:C,line:O,column:P,offset:H}=r;return{_bufferIndex:T,_index:C,line:O,column:P,offset:H}}function y(T){s[T.line]=T.column,S()}function b(){let T;for(;r._index<o.length;){const C=o[r._index];if(typeof C=="string")for(T=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===T&&r._bufferIndex<C.length;)g(C.charCodeAt(r._bufferIndex));else g(C)}}function g(T){d=d(T)}function v(T){pn(T)?(r.line++,r.column=1,r.offset+=T===-3?2:1,S()):T!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===o[r._index].length&&(r._bufferIndex=-1,r._index++)),u.previous=T}function w(T,C){const O=C||{};return O.type=T,O.start=m(),u.events.push(["enter",O,u]),a.push(O),O}function _(T){const C=a.pop();return C.end=m(),u.events.push(["exit",C,u]),C}function D(T,C){N(T,C.from)}function k(T,C){C.restore()}function A(T,C){return O;function O(P,H,M){let I,K,G,R;return Array.isArray(P)?ge(P):"tokenize"in P?ge([P]):Ee(P);function Ee(We){return ut;function ut(oe){const je=oe!==null&&We[oe],te=oe!==null&&We.null,$e=[...Array.isArray(je)?je:je?[je]:[],...Array.isArray(te)?te:te?[te]:[]];return ge($e)(oe)}}function ge(We){return I=We,K=0,We.length===0?M:F(We[K])}function F(We){return ut;function ut(oe){return R=E(),G=We,We.partial||(u.currentConstruct=We),We.name&&u.parser.constructs.disable.null.includes(We.name)?se():We.tokenize.call(C?Object.assign(Object.create(u),C):u,l,B,se)(oe)}}function B(We){return T(G,R),H}function se(We){return R.restore(),++K<I.length?F(I[K]):M}}}function N(T,C){T.resolveAll&&!i.includes(T)&&i.push(T),T.resolve&&Co(u.events,C,u.events.length-C,T.resolve(u.events.slice(C),u)),T.resolveTo&&(u.events=T.resolveTo(u.events,u))}function E(){const T=m(),C=u.previous,O=u.currentConstruct,P=u.events.length,H=Array.from(a);return{from:P,restore:M};function M(){r=T,u.previous=C,u.currentConstruct=O,u.events.length=P,a=H,S()}}function S(){r.line in s&&r.column<2&&(r.column=s[r.line],r.offset+=s[r.line]-1)}}function VQ(t,e){const n=e.start._index,r=e.start._bufferIndex,s=e.end._index,i=e.end._bufferIndex;let o;if(n===s)o=[t[n].slice(r,i)];else{if(o=t.slice(n,s),r>-1){const a=o[0];typeof a=="string"?o[0]=a.slice(r):o.shift()}i>0&&o.push(t[s].slice(0,i))}return o}function WQ(t,e){let n=-1;const r=[];let s;for(;++n<t.length;){const i=t[n];let o;if(typeof i=="string")o=i;else switch(i){case-5:{o="\r";break}case-4:{o=`
`;break}case-3:{o=`\r
`;break}case-2:{o=e?" ":"	";break}case-1:{if(!e&&s)continue;o=" ";break}default:o=String.fromCharCode(i)}s=i===-2,r.push(o)}return r.join("")}function KQ(t){const r={constructs:ZJ([UQ,...(t||{}).extensions||[]]),content:s(aX),defined:[],document:s(cX),flow:s(EQ),lazy:{},string:s(IQ),text:s(MQ)};return r;function s(i){return o;function o(a){return HQ(r,i,a)}}}function GQ(t){for(;!aR(t););return t}const OC=/[\0\t\n\r]/g;function qQ(){let t=1,e="",n=!0,r;return s;function s(i,o,a){const l=[];let u,d,f,h,p;for(i=e+(typeof i=="string"?i.toString():new TextDecoder(o||void 0).decode(i)),f=0,e="",n&&(i.charCodeAt(0)===65279&&f++,n=void 0);f<i.length;){if(OC.lastIndex=f,u=OC.exec(i),h=u&&u.index!==void 0?u.index:i.length,p=i.charCodeAt(h),!u){e=i.slice(f);break}if(p===10&&f===h&&r)l.push(-3),r=void 0;else switch(r&&(l.push(-5),r=void 0),f<h&&(l.push(i.slice(f,h)),t+=h-f),p){case 0:{l.push(65533),t++;break}case 9:{for(d=Math.ceil(t/4)*4,l.push(-2);t++<d;)l.push(-1);break}case 10:{l.push(-4),t=1;break}default:r=!0,t=1}f=h+1}return a&&(r&&l.push(-5),e&&l.push(e),l.push(null)),l}}const YQ=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function JQ(t){return t.replace(YQ,XQ)}function XQ(t,e,n){if(e)return e;if(n.charCodeAt(0)===35){const s=n.charCodeAt(1),i=s===120||s===88;return rR(n.slice(i?2:1),i?16:10)}return Qv(n)||t}const hR={}.hasOwnProperty;function QQ(t,e,n){return typeof e!="string"&&(n=e,e=void 0),ZQ(n)(GQ(KQ(n).document().write(qQ()(t,e,!0))))}function ZQ(t){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:i(ee),autolinkProtocol:E,autolinkEmail:E,atxHeading:i(Ke),blockQuote:i(te),characterEscape:E,characterReference:E,codeFenced:i($e),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:i($e,o),codeText:i(Te,o),codeTextData:E,data:E,codeFlowValue:E,definition:i(Je),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:i(Ye),hardBreakEscape:i(lt),hardBreakTrailing:i(lt),htmlFlow:i(St,o),htmlFlowData:E,htmlText:i(St,o),htmlTextData:E,image:i(X),label:o,link:i(ee),listItem:i(ce),listItemValue:h,listOrdered:i(ie,f),listUnordered:i(ie),paragraph:i(Z),reference:F,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:i(Ke),strong:i(ne),thematicBreak:i(Ie)},exit:{atxHeading:l(),atxHeadingSequence:D,autolink:l(),autolinkEmail:je,autolinkProtocol:oe,blockQuote:l(),characterEscapeValue:S,characterReferenceMarkerHexadecimal:se,characterReferenceMarkerNumeric:se,characterReferenceValue:We,characterReference:ut,codeFenced:l(b),codeFencedFence:y,codeFencedFenceInfo:p,codeFencedFenceMeta:m,codeFlowValue:S,codeIndented:l(g),codeText:l(H),codeTextData:S,data:S,definition:l(),definitionDestinationString:_,definitionLabelString:v,definitionTitleString:w,emphasis:l(),hardBreakEscape:l(C),hardBreakTrailing:l(C),htmlFlow:l(O),htmlFlowData:S,htmlText:l(P),htmlTextData:S,image:l(I),label:G,labelText:K,lineEnding:T,link:l(M),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:B,resourceDestinationString:R,resourceTitleString:Ee,resource:ge,setextHeading:l(N),setextHeadingLineSequence:A,setextHeadingText:k,strong:l(),thematicBreak:l()}};pR(e,(t||{}).mdastExtensions||[]);const n={};return r;function r(fe){let Oe={type:"root",children:[]};const et={stack:[Oe],tokenStack:[],config:e,enter:a,exit:u,buffer:o,resume:d,data:n},xt=[];let It=-1;for(;++It<fe.length;)if(fe[It][1].type==="listOrdered"||fe[It][1].type==="listUnordered")if(fe[It][0]==="enter")xt.push(It);else{const ue=xt.pop();It=s(fe,ue,It)}for(It=-1;++It<fe.length;){const ue=e[fe[It][0]];hR.call(ue,fe[It][1].type)&&ue[fe[It][1].type].call(Object.assign({sliceSerialize:fe[It][2].sliceSerialize},et),fe[It][1])}if(et.tokenStack.length>0){const ue=et.tokenStack[et.tokenStack.length-1];(ue[1]||PC).call(et,void 0,ue[0])}for(Oe.position={start:ia(fe.length>0?fe[0][1].start:{line:1,column:1,offset:0}),end:ia(fe.length>0?fe[fe.length-2][1].end:{line:1,column:1,offset:0})},It=-1;++It<e.transforms.length;)Oe=e.transforms[It](Oe)||Oe;return Oe}function s(fe,Oe,et){let xt=Oe-1,It=-1,ue=!1,Ne,Ue,Ze,xe;for(;++xt<=et;){const ct=fe[xt];switch(ct[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{ct[0]==="enter"?It++:It--,xe=void 0;break}case"lineEndingBlank":{ct[0]==="enter"&&(Ne&&!xe&&!It&&!Ze&&(Ze=xt),xe=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:xe=void 0}if(!It&&ct[0]==="enter"&&ct[1].type==="listItemPrefix"||It===-1&&ct[0]==="exit"&&(ct[1].type==="listUnordered"||ct[1].type==="listOrdered")){if(Ne){let dt=xt;for(Ue=void 0;dt--;){const ft=fe[dt];if(ft[1].type==="lineEnding"||ft[1].type==="lineEndingBlank"){if(ft[0]==="exit")continue;Ue&&(fe[Ue][1].type="lineEndingBlank",ue=!0),ft[1].type="lineEnding",Ue=dt}else if(!(ft[1].type==="linePrefix"||ft[1].type==="blockQuotePrefix"||ft[1].type==="blockQuotePrefixWhitespace"||ft[1].type==="blockQuoteMarker"||ft[1].type==="listItemIndent"))break}Ze&&(!Ue||Ze<Ue)&&(Ne._spread=!0),Ne.end=Object.assign({},Ue?fe[Ue][1].start:ct[1].end),fe.splice(Ue||xt,0,["exit",Ne,ct[2]]),xt++,et++}if(ct[1].type==="listItemPrefix"){const dt={type:"listItem",_spread:!1,start:Object.assign({},ct[1].start),end:void 0};Ne=dt,fe.splice(xt,0,["enter",dt,ct[2]]),xt++,et++,Ze=void 0,xe=!0}}}return fe[Oe][1]._spread=ue,et}function i(fe,Oe){return et;function et(xt){a.call(this,fe(xt),xt),Oe&&Oe.call(this,xt)}}function o(){this.stack.push({type:"fragment",children:[]})}function a(fe,Oe,et){this.stack[this.stack.length-1].children.push(fe),this.stack.push(fe),this.tokenStack.push([Oe,et||void 0]),fe.position={start:ia(Oe.start),end:void 0}}function l(fe){return Oe;function Oe(et){fe&&fe.call(this,et),u.call(this,et)}}function u(fe,Oe){const et=this.stack.pop(),xt=this.tokenStack.pop();if(xt)xt[0].type!==fe.type&&(Oe?Oe.call(this,fe,xt[0]):(xt[1]||PC).call(this,fe,xt[0]));else throw new Error("Cannot close `"+fe.type+"` ("+Vd({start:fe.start,end:fe.end})+"): its not open");et.position.end=ia(fe.end)}function d(){return XJ(this.stack.pop())}function f(){this.data.expectingFirstListItemValue=!0}function h(fe){if(this.data.expectingFirstListItemValue){const Oe=this.stack[this.stack.length-2];Oe.start=Number.parseInt(this.sliceSerialize(fe),10),this.data.expectingFirstListItemValue=void 0}}function p(){const fe=this.resume(),Oe=this.stack[this.stack.length-1];Oe.lang=fe}function m(){const fe=this.resume(),Oe=this.stack[this.stack.length-1];Oe.meta=fe}function y(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function b(){const fe=this.resume(),Oe=this.stack[this.stack.length-1];Oe.value=fe.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function g(){const fe=this.resume(),Oe=this.stack[this.stack.length-1];Oe.value=fe.replace(/(\r?\n|\r)$/g,"")}function v(fe){const Oe=this.resume(),et=this.stack[this.stack.length-1];et.label=Oe,et.identifier=fu(this.sliceSerialize(fe)).toLowerCase()}function w(){const fe=this.resume(),Oe=this.stack[this.stack.length-1];Oe.title=fe}function _(){const fe=this.resume(),Oe=this.stack[this.stack.length-1];Oe.url=fe}function D(fe){const Oe=this.stack[this.stack.length-1];if(!Oe.depth){const et=this.sliceSerialize(fe).length;Oe.depth=et}}function k(){this.data.setextHeadingSlurpLineEnding=!0}function A(fe){const Oe=this.stack[this.stack.length-1];Oe.depth=this.sliceSerialize(fe).codePointAt(0)===61?1:2}function N(){this.data.setextHeadingSlurpLineEnding=void 0}function E(fe){const et=this.stack[this.stack.length-1].children;let xt=et[et.length-1];(!xt||xt.type!=="text")&&(xt=Se(),xt.position={start:ia(fe.start),end:void 0},et.push(xt)),this.stack.push(xt)}function S(fe){const Oe=this.stack.pop();Oe.value+=this.sliceSerialize(fe),Oe.position.end=ia(fe.end)}function T(fe){const Oe=this.stack[this.stack.length-1];if(this.data.atHardBreak){const et=Oe.children[Oe.children.length-1];et.position.end=ia(fe.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(Oe.type)&&(E.call(this,fe),S.call(this,fe))}function C(){this.data.atHardBreak=!0}function O(){const fe=this.resume(),Oe=this.stack[this.stack.length-1];Oe.value=fe}function P(){const fe=this.resume(),Oe=this.stack[this.stack.length-1];Oe.value=fe}function H(){const fe=this.resume(),Oe=this.stack[this.stack.length-1];Oe.value=fe}function M(){const fe=this.stack[this.stack.length-1];if(this.data.inReference){const Oe=this.data.referenceType||"shortcut";fe.type+="Reference",fe.referenceType=Oe,delete fe.url,delete fe.title}else delete fe.identifier,delete fe.label;this.data.referenceType=void 0}function I(){const fe=this.stack[this.stack.length-1];if(this.data.inReference){const Oe=this.data.referenceType||"shortcut";fe.type+="Reference",fe.referenceType=Oe,delete fe.url,delete fe.title}else delete fe.identifier,delete fe.label;this.data.referenceType=void 0}function K(fe){const Oe=this.sliceSerialize(fe),et=this.stack[this.stack.length-2];et.label=JQ(Oe),et.identifier=fu(Oe).toLowerCase()}function G(){const fe=this.stack[this.stack.length-1],Oe=this.resume(),et=this.stack[this.stack.length-1];if(this.data.inReference=!0,et.type==="link"){const xt=fe.children;et.children=xt}else et.alt=Oe}function R(){const fe=this.resume(),Oe=this.stack[this.stack.length-1];Oe.url=fe}function Ee(){const fe=this.resume(),Oe=this.stack[this.stack.length-1];Oe.title=fe}function ge(){this.data.inReference=void 0}function F(){this.data.referenceType="collapsed"}function B(fe){const Oe=this.resume(),et=this.stack[this.stack.length-1];et.label=Oe,et.identifier=fu(this.sliceSerialize(fe)).toLowerCase(),this.data.referenceType="full"}function se(fe){this.data.characterReferenceType=fe.type}function We(fe){const Oe=this.sliceSerialize(fe),et=this.data.characterReferenceType;let xt;et?(xt=rR(Oe,et==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):xt=Qv(Oe);const It=this.stack[this.stack.length-1];It.value+=xt}function ut(fe){const Oe=this.stack.pop();Oe.position.end=ia(fe.end)}function oe(fe){S.call(this,fe);const Oe=this.stack[this.stack.length-1];Oe.url=this.sliceSerialize(fe)}function je(fe){S.call(this,fe);const Oe=this.stack[this.stack.length-1];Oe.url="mailto:"+this.sliceSerialize(fe)}function te(){return{type:"blockquote",children:[]}}function $e(){return{type:"code",lang:null,meta:null,value:""}}function Te(){return{type:"inlineCode",value:""}}function Je(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Ye(){return{type:"emphasis",children:[]}}function Ke(){return{type:"heading",depth:0,children:[]}}function lt(){return{type:"break"}}function St(){return{type:"html",value:""}}function X(){return{type:"image",title:null,url:"",alt:null}}function ee(){return{type:"link",title:null,url:"",children:[]}}function ie(fe){return{type:"list",ordered:fe.type==="listOrdered",start:null,spread:fe._spread,children:[]}}function ce(fe){return{type:"listItem",spread:fe._spread,checked:null,children:[]}}function Z(){return{type:"paragraph",children:[]}}function ne(){return{type:"strong",children:[]}}function Se(){return{type:"text",value:""}}function Ie(){return{type:"thematicBreak"}}}function ia(t){return{line:t.line,column:t.column,offset:t.offset}}function pR(t,e){let n=-1;for(;++n<e.length;){const r=e[n];Array.isArray(r)?pR(t,r):eZ(t,r)}}function eZ(t,e){let n;for(n in e)if(hR.call(e,n))switch(n){case"canContainEols":{const r=e[n];r&&t[n].push(...r);break}case"transforms":{const r=e[n];r&&t[n].push(...r);break}case"enter":case"exit":{const r=e[n];r&&Object.assign(t[n],r);break}}}function PC(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+Vd({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+Vd({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+Vd({start:e.start,end:e.end})+") is still open")}function tZ(t){const e=this;e.parser=n;function n(r){return QQ(r,{...e.data("settings"),...t,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function nZ(t,e){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(e),!0)};return t.patch(e,n),t.applyData(e,n)}function rZ(t,e){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(e,n),[t.applyData(e,n),{type:"text",value:`
`}]}function sZ(t,e){const n=e.value?e.value+`
`:"",r={},s=e.lang?e.lang.split(/\s+/):[];s.length>0&&(r.className=["language-"+s[0]]);let i={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]};return e.meta&&(i.data={meta:e.meta}),t.patch(e,i),i=t.applyData(e,i),i={type:"element",tagName:"pre",properties:{},children:[i]},t.patch(e,i),i}function iZ(t,e){const n={type:"element",tagName:"del",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function oZ(t,e){const n={type:"element",tagName:"em",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function aZ(t,e){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",r=String(e.identifier).toUpperCase(),s=Uu(r.toLowerCase()),i=t.footnoteOrder.indexOf(r);let o,a=t.footnoteCounts.get(r);a===void 0?(a=0,t.footnoteOrder.push(r),o=t.footnoteOrder.length):o=i+1,a+=1,t.footnoteCounts.set(r,a);const l={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+s,id:n+"fnref-"+s+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};t.patch(e,l);const u={type:"element",tagName:"sup",properties:{},children:[l]};return t.patch(e,u),t.applyData(e,u)}function lZ(t,e){const n={type:"element",tagName:"h"+e.depth,properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function cZ(t,e){if(t.options.allowDangerousHtml){const n={type:"raw",value:e.value};return t.patch(e,n),t.applyData(e,n)}}function mR(t,e){const n=e.referenceType;let r="]";if(n==="collapsed"?r+="[]":n==="full"&&(r+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+r}];const s=t.all(e),i=s[0];i&&i.type==="text"?i.value="["+i.value:s.unshift({type:"text",value:"["});const o=s[s.length-1];return o&&o.type==="text"?o.value+=r:s.push({type:"text",value:r}),s}function uZ(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return mR(t,e);const s={src:Uu(r.url||""),alt:e.alt};r.title!==null&&r.title!==void 0&&(s.title=r.title);const i={type:"element",tagName:"img",properties:s,children:[]};return t.patch(e,i),t.applyData(e,i)}function dZ(t,e){const n={src:Uu(e.url)};e.alt!==null&&e.alt!==void 0&&(n.alt=e.alt),e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"img",properties:n,children:[]};return t.patch(e,r),t.applyData(e,r)}function fZ(t,e){const n={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};t.patch(e,n);const r={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(e,r),t.applyData(e,r)}function hZ(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return mR(t,e);const s={href:Uu(r.url||"")};r.title!==null&&r.title!==void 0&&(s.title=r.title);const i={type:"element",tagName:"a",properties:s,children:t.all(e)};return t.patch(e,i),t.applyData(e,i)}function pZ(t,e){const n={href:Uu(e.url)};e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"a",properties:n,children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function mZ(t,e,n){const r=t.all(e),s=n?gZ(n):gR(e),i={},o=[];if(typeof e.checked=="boolean"){const d=r[0];let f;d&&d.type==="element"&&d.tagName==="p"?f=d:(f={type:"element",tagName:"p",properties:{},children:[]},r.unshift(f)),f.children.length>0&&f.children.unshift({type:"text",value:" "}),f.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),i.className=["task-list-item"]}let a=-1;for(;++a<r.length;){const d=r[a];(s||a!==0||d.type!=="element"||d.tagName!=="p")&&o.push({type:"text",value:`
`}),d.type==="element"&&d.tagName==="p"&&!s?o.push(...d.children):o.push(d)}const l=r[r.length-1];l&&(s||l.type!=="element"||l.tagName!=="p")&&o.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:i,children:o};return t.patch(e,u),t.applyData(e,u)}function gZ(t){let e=!1;if(t.type==="list"){e=t.spread||!1;const n=t.children;let r=-1;for(;!e&&++r<n.length;)e=gR(n[r])}return e}function gR(t){const e=t.spread;return e??t.children.length>1}function yZ(t,e){const n={},r=t.all(e);let s=-1;for(typeof e.start=="number"&&e.start!==1&&(n.start=e.start);++s<r.length;){const o=r[s];if(o.type==="element"&&o.tagName==="li"&&o.properties&&Array.isArray(o.properties.className)&&o.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const i={type:"element",tagName:e.ordered?"ol":"ul",properties:n,children:t.wrap(r,!0)};return t.patch(e,i),t.applyData(e,i)}function xZ(t,e){const n={type:"element",tagName:"p",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function bZ(t,e){const n={type:"root",children:t.wrap(t.all(e))};return t.patch(e,n),t.applyData(e,n)}function wZ(t,e){const n={type:"element",tagName:"strong",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function vZ(t,e){const n=t.all(e),r=n.shift(),s=[];if(r){const o={type:"element",tagName:"thead",properties:{},children:t.wrap([r],!0)};t.patch(e.children[0],o),s.push(o)}if(n.length>0){const o={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},a=qv(e.children[1]),l=J5(e.children[e.children.length-1]);a&&l&&(o.position={start:a,end:l}),s.push(o)}const i={type:"element",tagName:"table",properties:{},children:t.wrap(s,!0)};return t.patch(e,i),t.applyData(e,i)}function kZ(t,e,n){const r=n?n.children:void 0,i=(r?r.indexOf(e):1)===0?"th":"td",o=n&&n.type==="table"?n.align:void 0,a=o?o.length:e.children.length;let l=-1;const u=[];for(;++l<a;){const f=e.children[l],h={},p=o?o[l]:void 0;p&&(h.align=p);let m={type:"element",tagName:i,properties:h,children:[]};f&&(m.children=t.all(f),t.patch(f,m),m=t.applyData(f,m)),u.push(m)}const d={type:"element",tagName:"tr",properties:{},children:t.wrap(u,!0)};return t.patch(e,d),t.applyData(e,d)}function SZ(t,e){const n={type:"element",tagName:"td",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}const LC=9,$C=32;function _Z(t){const e=String(t),n=/\r?\n|\r/g;let r=n.exec(e),s=0;const i=[];for(;r;)i.push(zC(e.slice(s,r.index),s>0,!0),r[0]),s=r.index+r[0].length,r=n.exec(e);return i.push(zC(e.slice(s),s>0,!1)),i.join("")}function zC(t,e,n){let r=0,s=t.length;if(e){let i=t.codePointAt(r);for(;i===LC||i===$C;)r++,i=t.codePointAt(r)}if(n){let i=t.codePointAt(s-1);for(;i===LC||i===$C;)s--,i=t.codePointAt(s-1)}return s>r?t.slice(r,s):""}function TZ(t,e){const n={type:"text",value:_Z(String(e.value))};return t.patch(e,n),t.applyData(e,n)}function CZ(t,e){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(e,n),t.applyData(e,n)}const EZ={blockquote:nZ,break:rZ,code:sZ,delete:iZ,emphasis:oZ,footnoteReference:aZ,heading:lZ,html:cZ,imageReference:uZ,image:dZ,inlineCode:fZ,linkReference:hZ,link:pZ,listItem:mZ,list:yZ,paragraph:xZ,root:bZ,strong:wZ,table:vZ,tableCell:SZ,tableRow:kZ,text:TZ,thematicBreak:CZ,toml:Gh,yaml:Gh,definition:Gh,footnoteDefinition:Gh};function Gh(){}const yR=-1,n0=0,Kd=1,ig=2,tk=3,nk=4,rk=5,sk=6,xR=7,bR=8,FC=typeof self=="object"?self:globalThis,NZ=(t,e)=>{const n=(s,i)=>(t.set(i,s),s),r=s=>{if(t.has(s))return t.get(s);const[i,o]=e[s];switch(i){case n0:case yR:return n(o,s);case Kd:{const a=n([],s);for(const l of o)a.push(r(l));return a}case ig:{const a=n({},s);for(const[l,u]of o)a[r(l)]=r(u);return a}case tk:return n(new Date(o),s);case nk:{const{source:a,flags:l}=o;return n(new RegExp(a,l),s)}case rk:{const a=n(new Map,s);for(const[l,u]of o)a.set(r(l),r(u));return a}case sk:{const a=n(new Set,s);for(const l of o)a.add(r(l));return a}case xR:{const{name:a,message:l}=o;return n(new FC[a](l),s)}case bR:return n(BigInt(o),s);case"BigInt":return n(Object(BigInt(o)),s);case"ArrayBuffer":return n(new Uint8Array(o).buffer,o);case"DataView":{const{buffer:a}=new Uint8Array(o);return n(new DataView(a),o)}}return n(new FC[i](o),s)};return r},BC=t=>NZ(new Map,t)(0),wc="",{toString:jZ}={},{keys:IZ}=Object,sd=t=>{const e=typeof t;if(e!=="object"||!t)return[n0,e];const n=jZ.call(t).slice(8,-1);switch(n){case"Array":return[Kd,wc];case"Object":return[ig,wc];case"Date":return[tk,wc];case"RegExp":return[nk,wc];case"Map":return[rk,wc];case"Set":return[sk,wc];case"DataView":return[Kd,n]}return n.includes("Array")?[Kd,n]:n.includes("Error")?[xR,n]:[ig,n]},qh=([t,e])=>t===n0&&(e==="function"||e==="symbol"),MZ=(t,e,n,r)=>{const s=(o,a)=>{const l=r.push(o)-1;return n.set(a,l),l},i=o=>{if(n.has(o))return n.get(o);let[a,l]=sd(o);switch(a){case n0:{let d=o;switch(l){case"bigint":a=bR,d=o.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+l);d=null;break;case"undefined":return s([yR],o)}return s([a,d],o)}case Kd:{if(l){let h=o;return l==="DataView"?h=new Uint8Array(o.buffer):l==="ArrayBuffer"&&(h=new Uint8Array(o)),s([l,[...h]],o)}const d=[],f=s([a,d],o);for(const h of o)d.push(i(h));return f}case ig:{if(l)switch(l){case"BigInt":return s([l,o.toString()],o);case"Boolean":case"Number":case"String":return s([l,o.valueOf()],o)}if(e&&"toJSON"in o)return i(o.toJSON());const d=[],f=s([a,d],o);for(const h of IZ(o))(t||!qh(sd(o[h])))&&d.push([i(h),i(o[h])]);return f}case tk:return s([a,o.toISOString()],o);case nk:{const{source:d,flags:f}=o;return s([a,{source:d,flags:f}],o)}case rk:{const d=[],f=s([a,d],o);for(const[h,p]of o)(t||!(qh(sd(h))||qh(sd(p))))&&d.push([i(h),i(p)]);return f}case sk:{const d=[],f=s([a,d],o);for(const h of o)(t||!qh(sd(h)))&&d.push(i(h));return f}}const{message:u}=o;return s([a,{name:l,message:u}],o)};return i},UC=(t,{json:e,lossy:n}={})=>{const r=[];return MZ(!(e||n),!!e,new Map,r)(t),r},og=typeof structuredClone=="function"?(t,e)=>e&&("json"in e||"lossy"in e)?BC(UC(t,e)):structuredClone(t):(t,e)=>BC(UC(t,e));function DZ(t,e){const n=[{type:"text",value:""}];return e>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),n}function AZ(t,e){return"Back to reference "+(t+1)+(e>1?"-"+e:"")}function RZ(t){const e=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||DZ,r=t.options.footnoteBackLabel||AZ,s=t.options.footnoteLabel||"Footnotes",i=t.options.footnoteLabelTagName||"h2",o=t.options.footnoteLabelProperties||{className:["sr-only"]},a=[];let l=-1;for(;++l<t.footnoteOrder.length;){const u=t.footnoteById.get(t.footnoteOrder[l]);if(!u)continue;const d=t.all(u),f=String(u.identifier).toUpperCase(),h=Uu(f.toLowerCase());let p=0;const m=[],y=t.footnoteCounts.get(f);for(;y!==void 0&&++p<=y;){m.length>0&&m.push({type:"text",value:" "});let v=typeof n=="string"?n:n(l,p);typeof v=="string"&&(v={type:"text",value:v}),m.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+h+(p>1?"-"+p:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(l,p),className:["data-footnote-backref"]},children:Array.isArray(v)?v:[v]})}const b=d[d.length-1];if(b&&b.type==="element"&&b.tagName==="p"){const v=b.children[b.children.length-1];v&&v.type==="text"?v.value+=" ":b.children.push({type:"text",value:" "}),b.children.push(...m)}else d.push(...m);const g={type:"element",tagName:"li",properties:{id:e+"fn-"+h},children:t.wrap(d,!0)};t.patch(u,g),a.push(g)}if(a.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:i,properties:{...og(o),id:"footnote-label"},children:[{type:"text",value:s}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(a,!0)},{type:"text",value:`
`}]}}const wR=function(t){if(t==null)return $Z;if(typeof t=="function")return r0(t);if(typeof t=="object")return Array.isArray(t)?OZ(t):PZ(t);if(typeof t=="string")return LZ(t);throw new Error("Expected function, string, or object as test")};function OZ(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=wR(t[n]);return r0(r);function r(...s){let i=-1;for(;++i<e.length;)if(e[i].apply(this,s))return!0;return!1}}function PZ(t){const e=t;return r0(n);function n(r){const s=r;let i;for(i in t)if(s[i]!==e[i])return!1;return!0}}function LZ(t){return r0(e);function e(n){return n&&n.type===t}}function r0(t){return e;function e(n,r,s){return!!(zZ(n)&&t.call(this,n,typeof r=="number"?r:void 0,s||void 0))}}function $Z(){return!0}function zZ(t){return t!==null&&typeof t=="object"&&"type"in t}const vR=[],FZ=!0,HC=!1,BZ="skip";function UZ(t,e,n,r){let s;typeof e=="function"&&typeof n!="function"?(r=n,n=e):s=e;const i=wR(s),o=r?-1:1;a(t,void 0,[])();function a(l,u,d){const f=l&&typeof l=="object"?l:{};if(typeof f.type=="string"){const p=typeof f.tagName=="string"?f.tagName:typeof f.name=="string"?f.name:void 0;Object.defineProperty(h,"name",{value:"node ("+(l.type+(p?"<"+p+">":""))+")"})}return h;function h(){let p=vR,m,y,b;if((!e||i(l,u,d[d.length-1]||void 0))&&(p=HZ(n(l,d)),p[0]===HC))return p;if("children"in l&&l.children){const g=l;if(g.children&&p[0]!==BZ)for(y=(r?g.children.length:-1)+o,b=d.concat(g);y>-1&&y<g.children.length;){const v=g.children[y];if(m=a(v,y,b)(),m[0]===HC)return m;y=typeof m[1]=="number"?m[1]:y+o}}return p}}}function HZ(t){return Array.isArray(t)?t:typeof t=="number"?[FZ,t]:t==null?vR:[t]}function kR(t,e,n,r){let s,i,o;typeof e=="function"&&typeof n!="function"?(i=void 0,o=e,s=n):(i=e,o=n,s=r),UZ(t,i,a,s);function a(l,u){const d=u[u.length-1],f=d?d.children.indexOf(l):void 0;return o(l,f,d)}}const pb={}.hasOwnProperty,VZ={};function WZ(t,e){const n=e||VZ,r=new Map,s=new Map,i=new Map,o={...EZ,...n.handlers},a={all:u,applyData:GZ,definitionById:r,footnoteById:s,footnoteCounts:i,footnoteOrder:[],handlers:o,one:l,options:n,patch:KZ,wrap:YZ};return kR(t,function(d){if(d.type==="definition"||d.type==="footnoteDefinition"){const f=d.type==="definition"?r:s,h=String(d.identifier).toUpperCase();f.has(h)||f.set(h,d)}}),a;function l(d,f){const h=d.type,p=a.handlers[h];if(pb.call(a.handlers,h)&&p)return p(a,d,f);if(a.options.passThrough&&a.options.passThrough.includes(h)){if("children"in d){const{children:y,...b}=d,g=og(b);return g.children=a.all(d),g}return og(d)}return(a.options.unknownHandler||qZ)(a,d,f)}function u(d){const f=[];if("children"in d){const h=d.children;let p=-1;for(;++p<h.length;){const m=a.one(h[p],d);if(m){if(p&&h[p-1].type==="break"&&(!Array.isArray(m)&&m.type==="text"&&(m.value=VC(m.value)),!Array.isArray(m)&&m.type==="element")){const y=m.children[0];y&&y.type==="text"&&(y.value=VC(y.value))}Array.isArray(m)?f.push(...m):f.push(m)}}}return f}}function KZ(t,e){t.position&&(e.position=jJ(t))}function GZ(t,e){let n=e;if(t&&t.data){const r=t.data.hName,s=t.data.hChildren,i=t.data.hProperties;if(typeof r=="string")if(n.type==="element")n.tagName=r;else{const o="children"in n?n.children:[n];n={type:"element",tagName:r,properties:{},children:o}}n.type==="element"&&i&&Object.assign(n.properties,og(i)),"children"in n&&n.children&&s!==null&&s!==void 0&&(n.children=s)}return n}function qZ(t,e){const n=e.data||{},r="value"in e&&!(pb.call(n,"hProperties")||pb.call(n,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function YZ(t,e){const n=[];let r=-1;for(e&&n.push({type:"text",value:`
`});++r<t.length;)r&&n.push({type:"text",value:`
`}),n.push(t[r]);return e&&t.length>0&&n.push({type:"text",value:`
`}),n}function VC(t){let e=0,n=t.charCodeAt(e);for(;n===9||n===32;)e++,n=t.charCodeAt(e);return t.slice(e)}function WC(t,e){const n=WZ(t,e),r=n.one(t,void 0),s=RZ(n),i=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return s&&i.children.push({type:"text",value:`
`},s),i}function JZ(t,e){return t&&"run"in t?async function(n,r){const s=WC(n,{file:r,...e});await t.run(s,r)}:function(n,r){return WC(n,{file:r,...t||e})}}function KC(t){if(t)throw t}var Mp=Object.prototype.hasOwnProperty,SR=Object.prototype.toString,GC=Object.defineProperty,qC=Object.getOwnPropertyDescriptor,YC=function(e){return typeof Array.isArray=="function"?Array.isArray(e):SR.call(e)==="[object Array]"},JC=function(e){if(!e||SR.call(e)!=="[object Object]")return!1;var n=Mp.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&Mp.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!r)return!1;var s;for(s in e);return typeof s>"u"||Mp.call(e,s)},XC=function(e,n){GC&&n.name==="__proto__"?GC(e,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):e[n.name]=n.newValue},QC=function(e,n){if(n==="__proto__")if(Mp.call(e,n)){if(qC)return qC(e,n).value}else return;return e[n]},XZ=function t(){var e,n,r,s,i,o,a=arguments[0],l=1,u=arguments.length,d=!1;for(typeof a=="boolean"&&(d=a,a=arguments[1]||{},l=2),(a==null||typeof a!="object"&&typeof a!="function")&&(a={});l<u;++l)if(e=arguments[l],e!=null)for(n in e)r=QC(a,n),s=QC(e,n),a!==s&&(d&&s&&(JC(s)||(i=YC(s)))?(i?(i=!1,o=r&&YC(r)?r:[]):o=r&&JC(r)?r:{},XC(a,{name:n,newValue:t(d,o,s)})):typeof s<"u"&&XC(a,{name:n,newValue:s}));return a};const Py=cg(XZ);function mb(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function QZ(){const t=[],e={run:n,use:r};return e;function n(...s){let i=-1;const o=s.pop();if(typeof o!="function")throw new TypeError("Expected function as last argument, not "+o);a(null,...s);function a(l,...u){const d=t[++i];let f=-1;if(l){o(l);return}for(;++f<s.length;)(u[f]===null||u[f]===void 0)&&(u[f]=s[f]);s=u,d?ZZ(d,a)(...u):o(null,...u)}}function r(s){if(typeof s!="function")throw new TypeError("Expected `middelware` to be a function, not "+s);return t.push(s),e}}function ZZ(t,e){let n;return r;function r(...o){const a=t.length>o.length;let l;a&&o.push(s);try{l=t.apply(this,o)}catch(u){const d=u;if(a&&n)throw d;return s(d)}a||(l&&l.then&&typeof l.then=="function"?l.then(i,s):l instanceof Error?s(l):i(l))}function s(o,...a){n||(n=!0,e(o,...a))}function i(o){s(null,o)}}const co={basename:eee,dirname:tee,extname:nee,join:ree,sep:"/"};function eee(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');ah(t);let n=0,r=-1,s=t.length,i;if(e===void 0||e.length===0||e.length>t.length){for(;s--;)if(t.codePointAt(s)===47){if(i){n=s+1;break}}else r<0&&(i=!0,r=s+1);return r<0?"":t.slice(n,r)}if(e===t)return"";let o=-1,a=e.length-1;for(;s--;)if(t.codePointAt(s)===47){if(i){n=s+1;break}}else o<0&&(i=!0,o=s+1),a>-1&&(t.codePointAt(s)===e.codePointAt(a--)?a<0&&(r=s):(a=-1,r=o));return n===r?r=o:r<0&&(r=t.length),t.slice(n,r)}function tee(t){if(ah(t),t.length===0)return".";let e=-1,n=t.length,r;for(;--n;)if(t.codePointAt(n)===47){if(r){e=n;break}}else r||(r=!0);return e<0?t.codePointAt(0)===47?"/":".":e===1&&t.codePointAt(0)===47?"//":t.slice(0,e)}function nee(t){ah(t);let e=t.length,n=-1,r=0,s=-1,i=0,o;for(;e--;){const a=t.codePointAt(e);if(a===47){if(o){r=e+1;break}continue}n<0&&(o=!0,n=e+1),a===46?s<0?s=e:i!==1&&(i=1):s>-1&&(i=-1)}return s<0||n<0||i===0||i===1&&s===n-1&&s===r+1?"":t.slice(s,n)}function ree(...t){let e=-1,n;for(;++e<t.length;)ah(t[e]),t[e]&&(n=n===void 0?t[e]:n+"/"+t[e]);return n===void 0?".":see(n)}function see(t){ah(t);const e=t.codePointAt(0)===47;let n=iee(t,!e);return n.length===0&&!e&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),e?"/"+n:n}function iee(t,e){let n="",r=0,s=-1,i=0,o=-1,a,l;for(;++o<=t.length;){if(o<t.length)a=t.codePointAt(o);else{if(a===47)break;a=47}if(a===47){if(!(s===o-1||i===1))if(s!==o-1&&i===2){if(n.length<2||r!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(l=n.lastIndexOf("/"),l!==n.length-1){l<0?(n="",r=0):(n=n.slice(0,l),r=n.length-1-n.lastIndexOf("/")),s=o,i=0;continue}}else if(n.length>0){n="",r=0,s=o,i=0;continue}}e&&(n=n.length>0?n+"/..":"..",r=2)}else n.length>0?n+="/"+t.slice(s+1,o):n=t.slice(s+1,o),r=o-s-1;s=o,i=0}else a===46&&i>-1?i++:i=-1}return n}function ah(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const oee={cwd:aee};function aee(){return"/"}function gb(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function lee(t){if(typeof t=="string")t=new URL(t);else if(!gb(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(t.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return cee(t)}function cee(t){if(t.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=t.pathname;let n=-1;for(;++n<e.length;)if(e.codePointAt(n)===37&&e.codePointAt(n+1)===50){const r=e.codePointAt(n+2);if(r===70||r===102){const s=new TypeError("File URL path must not include encoded / characters");throw s.code="ERR_INVALID_FILE_URL_PATH",s}}return decodeURIComponent(e)}const Ly=["history","path","basename","stem","extname","dirname"];class _R{constructor(e){let n;e?gb(e)?n={path:e}:typeof e=="string"||uee(e)?n={value:e}:n=e:n={},this.cwd="cwd"in n?"":oee.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<Ly.length;){const i=Ly[r];i in n&&n[i]!==void 0&&n[i]!==null&&(this[i]=i==="history"?[...n[i]]:n[i])}let s;for(s in n)Ly.includes(s)||(this[s]=n[s])}get basename(){return typeof this.path=="string"?co.basename(this.path):void 0}set basename(e){zy(e,"basename"),$y(e,"basename"),this.path=co.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?co.dirname(this.path):void 0}set dirname(e){ZC(this.basename,"dirname"),this.path=co.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?co.extname(this.path):void 0}set extname(e){if($y(e,"extname"),ZC(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=co.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){gb(e)&&(e=lee(e)),zy(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?co.basename(this.path,this.extname):void 0}set stem(e){zy(e,"stem"),$y(e,"stem"),this.path=co.join(this.dirname||"",e+(this.extname||""))}fail(e,n,r){const s=this.message(e,n,r);throw s.fatal=!0,s}info(e,n,r){const s=this.message(e,n,r);return s.fatal=void 0,s}message(e,n,r){const s=new vs(e,n,r);return this.path&&(s.name=this.path+":"+s.name,s.file=this.path),s.fatal=!1,this.messages.push(s),s}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function $y(t,e){if(t&&t.includes(co.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+co.sep+"`")}function zy(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function ZC(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}function uee(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const dee=function(t){const r=this.constructor.prototype,s=r[t],i=function(){return s.apply(i,arguments)};return Object.setPrototypeOf(i,r),i},fee={}.hasOwnProperty;class ik extends dee{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=QZ()}copy(){const e=new ik;let n=-1;for(;++n<this.attachers.length;){const r=this.attachers[n];e.use(...r)}return e.data(Py(!0,{},this.namespace)),e}data(e,n){return typeof e=="string"?arguments.length===2?(Uy("data",this.frozen),this.namespace[e]=n,this):fee.call(this.namespace,e)&&this.namespace[e]||void 0:e?(Uy("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const s=n.call(e,...r);typeof s=="function"&&this.transformers.use(s)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=Yh(e),r=this.parser||this.Parser;return Fy("parse",r),r(String(n),n)}process(e,n){const r=this;return this.freeze(),Fy("process",this.parser||this.Parser),By("process",this.compiler||this.Compiler),n?s(void 0,n):new Promise(s);function s(i,o){const a=Yh(e),l=r.parse(a);r.run(l,a,function(d,f,h){if(d||!f||!h)return u(d);const p=f,m=r.stringify(p,h);mee(m)?h.value=m:h.result=m,u(d,h)});function u(d,f){d||!f?o(d):i?i(f):n(void 0,f)}}}processSync(e){let n=!1,r;return this.freeze(),Fy("processSync",this.parser||this.Parser),By("processSync",this.compiler||this.Compiler),this.process(e,s),tE("processSync","process",n),r;function s(i,o){n=!0,KC(i),r=o}}run(e,n,r){eE(e),this.freeze();const s=this.transformers;return!r&&typeof n=="function"&&(r=n,n=void 0),r?i(void 0,r):new Promise(i);function i(o,a){const l=Yh(n);s.run(e,l,u);function u(d,f,h){const p=f||e;d?a(d):o?o(p):r(void 0,p,h)}}}runSync(e,n){let r=!1,s;return this.run(e,n,i),tE("runSync","run",r),s;function i(o,a){KC(o),s=a,r=!0}}stringify(e,n){this.freeze();const r=Yh(n),s=this.compiler||this.Compiler;return By("stringify",s),eE(e),s(e,r)}use(e,...n){const r=this.attachers,s=this.namespace;if(Uy("use",this.frozen),e!=null)if(typeof e=="function")l(e,n);else if(typeof e=="object")Array.isArray(e)?a(e):o(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function i(u){if(typeof u=="function")l(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[d,...f]=u;l(d,f)}else o(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function o(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(u.plugins),u.settings&&(s.settings=Py(!0,s.settings,u.settings))}function a(u){let d=-1;if(u!=null)if(Array.isArray(u))for(;++d<u.length;){const f=u[d];i(f)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function l(u,d){let f=-1,h=-1;for(;++f<r.length;)if(r[f][0]===u){h=f;break}if(h===-1)r.push([u,...d]);else if(d.length>0){let[p,...m]=d;const y=r[h][1];mb(y)&&mb(p)&&(p=Py(!0,y,p)),r[h]=[u,p,...m]}}}}const hee=new ik().freeze();function Fy(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function By(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function Uy(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function eE(t){if(!mb(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function tE(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function Yh(t){return pee(t)?t:new _R(t)}function pee(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function mee(t){return typeof t=="string"||gee(t)}function gee(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const yee="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",nE=[],rE={allowDangerousHtml:!0},xee=/^(https?|ircs?|mailto|xmpp)$/i,bee=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function ok(t){const e=wee(t),n=vee(t);return kee(e.runSync(e.parse(n),n),t)}function wee(t){const e=t.rehypePlugins||nE,n=t.remarkPlugins||nE,r=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...rE}:rE;return hee().use(tZ).use(n).use(JZ,r).use(e)}function vee(t){const e=t.children||"",n=new _R;return typeof e=="string"&&(n.value=e),n}function kee(t,e){const n=e.allowedElements,r=e.allowElement,s=e.components,i=e.disallowedElements,o=e.skipHtml,a=e.unwrapDisallowed,l=e.urlTransform||See;for(const d of bee)Object.hasOwn(e,d.from)&&(""+d.from+(d.to?"use `"+d.to+"` instead":"remove it")+yee+d.id,void 0);return kR(t,u),RJ(t,{Fragment:c.Fragment,components:s,ignoreInvalidStyle:!0,jsx:c.jsx,jsxs:c.jsxs,passKeys:!0,passNode:!0});function u(d,f,h){if(d.type==="raw"&&h&&typeof f=="number")return o?h.children.splice(f,1):h.children[f]={type:"text",value:d.value},f;if(d.type==="element"){let p;for(p in Ay)if(Object.hasOwn(Ay,p)&&Object.hasOwn(d.properties,p)){const m=d.properties[p],y=Ay[p];(y===null||y.includes(d.tagName))&&(d.properties[p]=l(String(m||""),p,d))}}if(d.type==="element"){let p=n?!n.includes(d.tagName):i?i.includes(d.tagName):!1;if(!p&&r&&typeof f=="number"&&(p=!r(d,f,h)),p&&h&&typeof f=="number")return a&&d.children?h.children.splice(f,1,...d.children):h.children.splice(f,1),f}}}function See(t){const e=t.indexOf(":"),n=t.indexOf("?"),r=t.indexOf("#"),s=t.indexOf("/");return e===-1||s!==-1&&e>s||n!==-1&&e>n||r!==-1&&e>r||xee.test(t.slice(0,e))?t:""}const _ee=[{label:"",value:null},{label:"",value:0},{label:"5 ",value:5},{label:"15 ",value:15},{label:"30 ",value:30},{label:"1 ",value:60},{label:"2 ",value:120},{label:"1 ",value:1440}],Tee=({value:t,onChange:e})=>{const[n,r]=x.useState(!1),[s,i]=x.useState(""),[o,a]=x.useState("minutes"),l=()=>t==null?"":t===0?"":t<60?`${t} `:t<1440?`${t/60} `:`${t/1440} `,u=()=>{const f=parseInt(s);if(isNaN(f)||f<=0)return;let h=f;o==="hours"&&(h=f*60),o==="days"&&(h=f*1440),e(h),r(!1),i("")},d=t!=null;return c.jsxs("div",{className:"relative",children:[c.jsxs("button",{type:"button",onClick:()=>r(!n),className:`flex items-center gap-1.5 px-2 py-1 rounded-lg text-xs transition-colors ${d?"bg-orange-100 text-orange-600 hover:bg-orange-200":"bg-gray-100 text-gray-500 hover:bg-gray-200"}`,title:"",children:[d?c.jsx(Va,{size:12}):c.jsx(t1,{size:12}),c.jsx("span",{children:l()}),c.jsx(rs,{size:10})]}),n&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>r(!1)}),c.jsxs("div",{className:"absolute left-0 top-full mt-1 w-48 bg-white rounded-lg shadow-xl border border-gray-200 z-50 overflow-hidden",children:[_ee.map(f=>c.jsxs("button",{type:"button",onClick:()=>{e(f.value),r(!1)},className:`w-full px-3 py-2 text-left text-sm hover:bg-orange-50 transition-colors flex items-center gap-2 ${t===f.value?"bg-orange-100 text-orange-700 font-medium":"text-gray-700"}`,children:[f.value===null?c.jsx(t1,{size:12}):c.jsx(Va,{size:12}),f.label]},f.value??"null")),c.jsxs("div",{className:"border-t border-gray-100 p-2",children:[c.jsx("div",{className:"text-[10px] text-gray-400 mb-1.5",children:""}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("input",{type:"number",value:s,onChange:f=>i(f.target.value),placeholder:"",className:"flex-1 px-2 py-1 text-xs border rounded w-14",min:1}),c.jsxs("select",{value:o,onChange:f=>a(f.target.value),className:"px-1 py-1 text-xs border rounded",children:[c.jsx("option",{value:"minutes",children:""}),c.jsx("option",{value:"hours",children:""}),c.jsx("option",{value:"days",children:""})]}),c.jsx("button",{type:"button",onClick:u,className:"px-2 py-1 text-xs bg-orange-500 text-white rounded hover:bg-orange-600",children:""})]})]}),d&&c.jsxs("button",{type:"button",onClick:()=>{e(null),r(!1)},className:"w-full px-3 py-2 text-left text-xs text-red-500 hover:bg-red-50 border-t border-gray-100 flex items-center gap-2",children:[c.jsx(hn,{size:12}),""]})]})]})]})},sE=t=>{if(!t)return"";let e=t;e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/^### (.*$)/gm,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gm,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gm,"<h1>$1</h1>");const n=e.split(`
`);let r=!1,s=[];for(let i=0;i<n.length;i++){const o=n[i];if(/^[*-] /.test(o)||/^\d+\. /.test(o)){r||(s.push("<ul>"),r=!0);const l=o.replace(/^[*-] |^\d+\. /,"");s.push(`<li>${l}</li>`)}else r&&(s.push("</ul>"),r=!1),o.trim()===""||(o.startsWith("<h")?s.push(o):s.push(`<p>${o}</p>`))}return r&&s.push("</ul>"),s.join("")},iE=t=>{if(!t)return"";if(!t.includes("<")||!t.includes(">"))return t;let e=t;return e=e.replace(/<\/p>/gi,`
`),e=e.replace(/<br\s*\/?>/gi,`
`),e=e.replace(/<\/div>/gi,`
`),e=e.replace(/<[^>]+>/g,""),e=e.replace(/&nbsp;/g," "),e=e.replace(/&amp;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e.trim()},Cee="",Fo=({initialData:t,onClose:e,isQuickAdd:n=!1,isEmbedded:r=!1})=>{var dk,fk,hk;const{addTask:s,updateTask:i,tags:o,tasks:a,addTag:l,deleteTag:u,setFocusedTaskId:d,themeSettings:f,toggleExpansion:h,setSelectedTaskIds:p,deleteTask:m,visibleTasks:y,user:b,setToast:g,t:v,navigateToTask:w}=x.useContext(jn),[_,D]=x.useState((t==null?void 0:t.title)||""),[k,A]=x.useState((t==null?void 0:t.description)||""),[N,E]=x.useState((t==null?void 0:t.due_date)||null),[S,T]=x.useState((t==null?void 0:t.start_date)||null),[C,O]=x.useState((t==null?void 0:t.tags)||[]),[P,H]=x.useState((t==null?void 0:t.images)||[]),[M,I]=x.useState((t==null?void 0:t.attachments)||[]),[K,G]=x.useState(!1),[R,Ee]=x.useState((t==null?void 0:t.parent_id)||null),[ge,F]=x.useState([]),[B,se]=x.useState((t==null?void 0:t.is_project)||!1),[We,ut]=x.useState((t==null?void 0:t.color)||"gray"),[oe,je]=x.useState((t==null?void 0:t.importance)||"unplanned"),[te,$e]=x.useState((t==null?void 0:t.is_all_day)!==void 0?t.is_all_day:!0),[Te,Je]=x.useState(()=>{if(t!=null&&t.start_time)return t.start_time;if(t!=null&&t.start_date&&!(t!=null&&t.is_all_day)){const j=new Date(t.start_date);return`${String(j.getHours()).padStart(2,"0")}:${String(j.getMinutes()).padStart(2,"0")}`}return"09:00"}),[Ye,Ke]=x.useState(()=>{if(t!=null&&t.end_time)return t.end_time;if(t!=null&&t.start_date&&!(t!=null&&t.is_all_day)){const j=new Date(t.start_date),W=typeof t.duration=="number"?t.duration:60;return j.setMinutes(j.getMinutes()+W),`${String(j.getHours()).padStart(2,"0")}:${String(j.getMinutes()).padStart(2,"0")}`}return"10:00"}),[lt,St]=x.useState((t==null?void 0:t.duration)||""),[X,ee]=x.useState((t==null?void 0:t.repeat_rule)||null),[ie,ce]=x.useState(!1),[Z,ne]=x.useState(()=>{if(t!=null&&t.id)try{const j=localStorage.getItem(`task_reminder_${t.id}`);if(j!==null)return JSON.parse(j)}catch{}return(t==null?void 0:t.reminder_minutes)??null});x.useEffect(()=>{if(t!=null&&t.id)try{Z!==null?localStorage.setItem(`task_reminder_${t.id}`,JSON.stringify(Z)):localStorage.removeItem(`task_reminder_${t.id}`)}catch{}},[Z,t==null?void 0:t.id]);const[Se,Ie]=x.useState(!1),[fe,Oe]=x.useState(!1),[et,xt]=x.useState(!1),[It,ue]=x.useState(null),Ne=x.useRef(null),Ue=x.useRef(null),Ze=x.useRef(null),xe=x.useRef(null),[ct,dt]=x.useState(null),ft=x.useRef(null),de=x.useRef(null),[ve,tt]=x.useState(null),[st,ht]=x.useState(null),[Xe,At]=x.useState(null),[jt,Q]=x.useState(null),[me,He]=x.useState(null),[J,Pe]=x.useState(new Set),[ze,mt]=x.useState(!1),[Wt,Dn]=x.useState(!1),[Ht,cn]=x.useState(""),[pe,q]=x.useState(!1),[ye,Re]=x.useState(!1),[_e,it]=x.useState(""),[Fe,gt]=x.useState(""),[Pt,Ft]=x.useState(0),[Ut,Kt]=x.useState(0),[Zt,nn]=x.useState(!1),[rn,vn]=x.useState({isOpen:!1,title:"",content:"",history:[],historyIndex:-1}),[Gn,Gr]=x.useState(!1),[ls,xn]=x.useState(!1),[di,no]=x.useState([]),{isRecording:cs,startRecording:sl,stopRecording:il,recordingTaskId:jo,recordingTime:ks}=x.useContext(Ru),Io=j=>{const W=Math.floor(j/1e3),ae=Math.floor(W/60),ke=W%60;return`${ae}:${ke.toString().padStart(2,"0")}`},ol=async(j,W,ae)=>{if(console.log("TaskInput handleSaveAudio called with:",j.name,W,ae),!be)return;const ke=`${Date.now()}_${crypto.randomUUID()}.${j.name.split(".").pop()}`,yt=`${(b==null?void 0:b.id)||"anonymous"}/${ke}`;try{const{error:Rt}=await be.storage.from("attachments").upload(yt,j,{contentType:j.type,upsert:!1});if(Rt){console.error("Upload voice error:",Rt),g==null||g({msg:"",type:"error"});return}const{data:en}=be.storage.from("attachments").getPublicUrl(yt);if(en){const sn={name:j.name,url:en.publicUrl,size:j.size,type:j.type,markers:W,recordingId:ae},fn=[...M,sn];I(fn),t&&i(t.id,{attachments:fn},[],{skipHistory:!0}),g==null||g({msg:"",type:"info"})}}catch(Rt){console.error(Rt),g==null||g({msg:"",type:"error"})}};x.useEffect(()=>{const j=W=>{const ae=W.detail;ae&&ae.taskId===(t==null?void 0:t.id)&&ae.attachment&&(console.log("[TaskInput] Recording saved event - updating local attachments state"),I(ke=>ke.some(yt=>yt.url===ae.attachment.url)?ke:[...ke,ae.attachment]))};return window.addEventListener("recording-saved",j),()=>window.removeEventListener("recording-saved",j)},[t==null?void 0:t.id]);const[nr,$r]=x.useState((t==null?void 0:t.ai_history)||[]),[qn,Pi]=x.useState(t!=null&&t.ai_history?t.ai_history.length-1:-1),[ac,fi]=x.useState(""),[Dr,le]=x.useState(!1),[Et,Bt]=x.useState(!1),[Vt,Lt]=x.useState(!1),[dn,In]=x.useState(0),[lr,zn]=x.useState((t==null?void 0:t.attachment_links)||[]),[Cn,Sn]=x.useState(!1),Yn=x.useMemo(()=>{const j=o.find(W=>W.name.trim().toLowerCase()==="prompt");return j?a.filter(W=>W.tags.includes(j.id)&&W.status!=="deleted"&&W.status!=="logged").sort((W,ae)=>ae.created_at.localeCompare(W.created_at)):[]},[a,o]),cr=x.useMemo(()=>{if(!Fe.trim())return Yn;const j=Fe.toLowerCase();return Yn.filter(W=>W.title.toLowerCase().includes(j)||W.description&&W.description.toLowerCase().includes(j))},[Yn,Fe]),Li=x.useMemo(()=>Yn.slice(0,5),[Yn]);x.useEffect(()=>{if(!Fe.trim()){Kt(0),Ft(0);return}let j=0;cr.forEach(W=>{const ae=(W.title.match(new RegExp(Fe,"gi"))||[]).length,ke=W.description?(W.description.match(new RegExp(Fe,"gi"))||[]).length:0;j+=ae+ke}),Kt(j),Ft(0)},[Fe,cr]);const hi=j=>{vn(W=>{const ae={title:W.title,content:j},ke=[...W.history.slice(0,W.historyIndex+1),ae];return{...W,content:j,history:ke,historyIndex:ke.length-1}})},On=j=>{vn(W=>{const ae={title:j,content:W.content},ke=[...W.history.slice(0,W.historyIndex+1),ae];return{...W,title:j,history:ke,historyIndex:ke.length-1}})},Un=()=>{vn(j=>{if(j.historyIndex<=0)return j;const W=j.historyIndex-1;return{...j,title:j.history[W].title,content:j.history[W].content,historyIndex:W}})},wr=()=>{vn(j=>{if(j.historyIndex>=j.history.length-1)return j;const W=j.historyIndex+1;return{...j,title:j.history[W].title,content:j.history[W].content,historyIndex:W}})},$=t?!!t.completed_at:!1,z=x.useRef(null),L=x.useRef(null),V=x.useRef(null),U=x.useRef(null),Y=x.useRef(null),he=x.useRef(null),De=x.useRef(null),Be=x.useRef(null),[Qe,ot]=x.useState([]),[_t,at]=x.useState(!1),[wt,Ge]=x.useState(-1);x.useEffect(()=>{const j=setTimeout(()=>{if(t&&!n){const W={};let ae=!1;if(_!==(t.title||"")&&(W.title=_,ae=!0),k!==(t.description||"")&&(W.description=k,ae=!0),Te&&Te!==(t.start_time||"")&&(W.start_time=Te,ae=!0),Ye&&Ye!==(t.end_time||"")&&(W.end_time=Ye,ae=!0),lt&&String(lt)!==String(t.duration||60)&&(W.duration=Number(lt),ae=!0),te!==(t.is_all_day??!0)&&(W.is_all_day=te,ae=!0),S&&S!==t.start_date&&(W.start_date=S,ae=!0),ae){if((W.start_time||W.start_date)&&!te){const ke=W.start_date||S||t.start_date,pt=W.start_time||Te||t.start_time||"00:00";if(ke){const yt=new Date(ke),[Rt,en]=pt.split(":").map(Number);!isNaN(Rt)&&!isNaN(en)&&(yt.setHours(Rt,en,0,0),W.start_date=yt.toISOString())}}i(t.id,W,[],{skipHistory:!0})}}},800);return()=>clearTimeout(j)},[_,k,Te,Ye,lt,S,te,t,i,n]),x.useEffect(()=>{const j=W=>{(W.metaKey||W.ctrlKey)&&W.shiftKey&&(W.key==="v"||W.key==="V")&&(W.preventDefault(),W.stopPropagation(),cs?il():sl(t==null?void 0:t.id))};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[cs,sl,il,t==null?void 0:t.id]),x.useEffect(()=>{L.current},[k]),x.useEffect(()=>{if(!Xe||!ft.current)return;const j=()=>{const ae=ft.current;ae&&Xe&&(ae.chain().setTextSelection({from:Xe.from,to:Xe.to}).unsetHighlight().setTextSelection(ae.state.selection.to).run(),At(null))},W=setTimeout(()=>{document.addEventListener("click",j,{once:!0})},100);return()=>{clearTimeout(W),document.removeEventListener("click",j)}},[Xe]);const Ce=x.useRef(t);x.useEffect(()=>{const j=Ce.current;if(!t||!j){Ce.current=t;return}t.id!==j.id?(D(t.title||""),A(t.description||""),T(t.start_date||""),Je(t.start_time||""),Ke(t.end_time||""),St(t.duration||60),$e(t.is_all_day??!0),O(t.tags||[]),H(t.images||[]),Ee(t.parent_id||null),se(t.is_project||!1),ut(t.color||"gray"),je(t.importance||"unplanned")):(t.title!==j.title&&D(t.title||""),t.description!==j.description&&A(t.description||""),t.start_date!==j.start_date&&T(t.start_date||""),t.start_time!==j.start_time&&Je(t.start_time||""),t.end_time!==j.end_time&&Ke(t.end_time||""),t.duration!==j.duration&&St(t.duration||60),t.is_all_day!==j.is_all_day&&$e(t.is_all_day??!0),JSON.stringify(t.tags)!==JSON.stringify(j.tags)&&O(t.tags||[])),Ce.current=t},[t]);const Le=async j=>{let W;if(ve&&ft.current?W=ft.current.state.doc.textBetween(ve.from,ve.to," "):ft.current?W=ft.current.getText():W=k.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),!W||!W.trim()){g==null||g({msg:"Please enter or select some content first.",type:"error"});return}mt(!0),Re(!1),Bt(!0);try{if(Zt&&_e.trim()){let Rt=o.find(sn=>sn.name.trim().toLowerCase()==="prompt"),en=Rt==null?void 0:Rt.id;if(en||(en=await l("prompt")||void 0),en){const sn=await U5(_e);await s({title:sn,description:_e,tags:[en],status:"active"})}}const ke=await B5(W,ve?"":_,j),pt={id:crypto.randomUUID(),role:"assistant",content:ke.fullResponse,created_at:new Date().toISOString(),prompt:j||"AI Analysis",model:"gemini"},yt=[...nr,pt];$r(yt),Pi(yt.length-1),fi(ke.fullResponse),le(!1),it(""),t&&i(t.id,{ai_history:yt},[],{skipHistory:!0})}catch(ae){console.error(ae);let ke=ae.message||"";(ke.includes("429")||ke.includes("quota"))&&(ke="AI  1-2  API Key"),alert(`AI ${ke}`),Bt(!1)}finally{mt(!1)}},we=()=>{if(document.activeElement instanceof HTMLElement&&(de.current=document.activeElement),!k||!k.trim()){g==null||g({msg:"Please enter some content first.",type:"error"});return}if(Et){Bt(!1);return}if(nr.length>0){Bt(!0);return}it(""),Re(!0)},Me=()=>{Re(!1),tt(null)},[Ve,Ct]=x.useState(!1),bt=x.useMemo(()=>{const j=o.find(W=>W.name.trim().toLowerCase().includes("for"));return j?a.filter(W=>W.tags.includes(j.id)&&W.status!=="deleted"&&W.status!=="logged").sort((W,ae)=>ae.created_at.localeCompare(W.created_at)):[]},[a,o]),Tt=async j=>{document.activeElement instanceof HTMLElement&&(de.current=document.activeElement);let W;if(ft.current?W=ft.current.getText():W=k.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),console.log("Note content for title generation:",W.substring(0,200)+"..."),console.log("Content length:",W.length),!W||!W.trim()){g==null||g({msg:"",type:"error"});return}Dn(!0),Ct(!1);try{const ae=await AY(W,j);console.log("Generated SEO title:",ae),cn(ae),q(!0)}catch(ae){console.error("Generate title error:",ae),g==null||g({msg:"",type:"error"})}finally{Dn(!1)}},qe=async()=>{let j;if(ft.current?j=ft.current.getText():j=k.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),!j||!j.trim()){g==null||g({msg:"",type:"error"});return}bt.length>0?Ct(!0):(console.log("No custom title prompts found. Using default."),Tt())},re=()=>{D(Ht),q(!1),cn(""),g==null||g({msg:" SEO ",type:"info"})},Ae=()=>{q(!1),cn("")},nt=x.useMemo(()=>{var j;return(j=t==null?void 0:t.dependencies)!=null&&j.length?a.filter(W=>{var ae;return((ae=t.dependencies)==null?void 0:ae.includes(W.id))&&!W.completed_at}):[]},[t==null?void 0:t.dependencies,a]),rt=x.useMemo(()=>o.filter(j=>j.name.startsWith("#")).map(j=>j.name.slice(1)),[o]),kt=async()=>{let j="";if(ft.current&&typeof ft.current.getText=="function"&&(j=ft.current.getText()),(!j||!j.trim())&&(j=k.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim()),!j||!j.trim()){g==null||g({msg:"",type:"error"});return}console.log("Generating keywords for current task content:",j.slice(0,100)+(j.length>100?"...":"")),Gr(!0);try{const W=await RY(j,rt);no(W),xn(!0),console.log("Generated keywords:",W)}catch(W){console.error("Generate keywords error:",W),g==null||g({msg:"",type:"error"})}finally{Gr(!1)}},$t=async j=>{const W=`#${j}`;let ae=o.find(ke=>ke.name.toLowerCase()===W.toLowerCase());try{if(ae)C.includes(ae.id)?g==null||g({msg:` ${W} `,type:"info"}):(O(ke=>[...ke,ae.id]),g==null||g({msg:`: ${W}`,type:"info"}));else{let ke=o.find(fn=>fn.name==="#"),pt;if(ke)pt=ke.id;else{const fn=await l("#");if(!fn)throw new Error("Failed to create root keyword tag");pt=fn}const yt=(fn,Tn=0)=>{const Gt=o.find(Nn=>Nn.id===fn);return!Gt||!Gt.parent_id||Gt.parent_id===pt?Tn:yt(Gt.parent_id,Tn+1)},Rt=o.filter(fn=>{if(fn.parent_id===pt)return!0;let Tn=fn;const Gt=new Set;for(;Tn.parent_id&&!Gt.has(Tn.id);){if(Gt.add(Tn.id),Tn.parent_id===pt)return!0;const Nn=o.find(_r=>_r.id===Tn.parent_id);if(!Nn)break;Tn=Nn}return!1}).map(fn=>({id:fn.id,name:fn.name.replace(/^#/,""),parentId:fn.parent_id,depth:yt(fn.id)}));let en=pt;if(Rt.length>0){g==null||g({msg:"...",type:"info"});const fn=await PY(j,Rt);if(fn){en=fn;const Tn=o.find(Gt=>Gt.id===fn);console.log(`AI suggested parent for "${j}": ${Tn==null?void 0:Tn.name}`)}}const sn=await l(W,en);if(sn){C.includes(sn)||O(Gt=>[...Gt,sn]);const fn=o.find(Gt=>Gt.id===en),Tn=(fn==null?void 0:fn.name)||"#";g==null||g({msg:`: ${W} ( ${Tn})`,type:"info"})}else throw new Error("Failed to create tag")}no(ke=>ke.filter(pt=>pt!==j))}catch(ke){console.error("Error adding keyword tag:",ke),g==null||g({msg:"",type:"error"})}},zt=async()=>{const j=[...di];let W=0,ae=o.find(pt=>pt.name==="#"),ke=null;if(ae)ke=ae.id;else{const pt=await l("#");pt&&(ke=pt)}for(const pt of j){const yt=`#${pt}`;let Rt=o.find(en=>en.name.toLowerCase()===yt.toLowerCase());try{if(Rt)C.includes(Rt.id)||(O(en=>[...en,Rt.id]),W++);else{const en=await l(yt,ke);en&&!C.includes(en)&&(O(sn=>[...sn,en]),W++)}}catch(en){console.error("Error adding keyword tag:",pt,en)}}no([]),xn(!1),W>0?g==null||g({msg:` ${W}  #`,type:"info"}):g==null||g({msg:"",type:"info"})},Yt=j=>{no(W=>W.filter(ae=>ae!==j))},ln=j=>{if(!j)return We;let W=a.find(ke=>ke.id===j);const ae=new Set;for(;W&&W.parent_id&&!ae.has(W.id);){ae.add(W.id);const ke=a.find(pt=>pt.id===W.parent_id);if(ke)W=ke;else break}return(W==null?void 0:W.color)||"blue"},gn=x.useMemo(()=>ln(R),[R,a,We]),yn=Qn[gn]||Qn.blue;l1(Ne,j=>{if(n||ye||Et&&st||pe||Ve||ls||j&&cs&&jo===(t==null?void 0:t.id)&&j.target.closest("[data-recording-capsule]"))return;const W=j==null?void 0:j.target;if(!(W&&W.closest('[data-app-header="true"]')))if(t&&e)if(_.trim())rr();else{const ae=y.findIndex(pt=>pt.data.id===t.id),ke=y[ae-1];m(t.id),e(ke?ke.data.id:null)}else e&&(_.trim()||k.replace(/<[^>]*>/g,"").trim()?rr():e(null))});const Fn=x.useMemo(()=>{if(!(t!=null&&t.id))return a.filter(ae=>ae.status!=="deleted");const j=new Set,W=[t.id];for(;W.length>0;){const ae=W.shift();for(const ke of a)ke.parent_id===ae&&!j.has(ke.id)&&(j.add(ke.id),W.push(ke.id))}return a.filter(ae=>ae.id!==t.id&&!j.has(ae.id)&&ae.status!=="deleted")},[a,t]),vr=x.useMemo(()=>{const j=(W=null,ae=0,ke=null)=>{const pt=o.filter(Rt=>Rt.parent_id===W);let yt=[];return pt.forEach(Rt=>{yt.push({...Rt,depth:ae,parentName:ke}),yt=[...yt,...j(Rt.id,ae+1,Rt.name)]}),yt};return j()},[o]);x.useEffect(()=>{if(t!=null&&t.id){const j=a.filter(W=>W.parent_id===t.id).map(W=>W.id);F(j)}},[t,a]),x.useEffect(()=>{const j=!t||!t.title;if(_.length>=2&&j){const W=a.filter(ae=>ae.title.toLowerCase().includes(_.toLowerCase())&&ae.id!==(t==null?void 0:t.id));ot(W.slice(0,5)),at(W.length>0),Ge(-1)}else at(!1)},[_,a,t]),x.useEffect(()=>{!t&&z.current&&z.current.focus()},[t]);const rr=async()=>{let j=_.trim();const W=k.replace(/<[^>]*>/g,"").trim();if(!j&&W&&(j=W.split(`
`)[0].substring(0,30)||"Untitled Note"),!j)return;let ae=S;if(S&&!te&&Te){const pt=new Date(S),[yt,Rt]=Te.split(":").map(Number);pt.setHours(yt,Rt,0,0),ae=pt.toISOString()}else if(S&&te){const pt=new Date(S);pt.setHours(12,0,0,0),ae=pt.toISOString()}const ke={title:j,description:k,due_date:N,start_date:ae,parent_id:R,is_project:B||ge.length>0,tags:C,status:(t==null?void 0:t.status)||"inbox",color:gn,importance:oe,images:P,is_all_day:te,duration:lt?Number(lt):null,attachments:M,attachment_links:lr,ai_history:nr,repeat_rule:X,reminder_minutes:Z};if(e?e((t==null?void 0:t.id)||null):lc(),t&&t.id&&t.id!=="new")await i(t.id,ke,ge);else{const pt=await s(ke,ge);d(pt),p([pt])}},lc=()=>{D(""),A(""),E(null),T(null),O([]),H([]),I([]),Ee(null),F([]),se(!1),$e(!0),Je("09:00"),Ke("10:00"),St(""),ee(null),ne(null)},ro=async j=>{if(!(j.length===0||!be)){xt(!0);try{const W=[],ae=[];for(const Rt of j){if(Rt.size>104857600){g==null||g({msg:`: ${Rt.name} ( 100MB)`,type:"error"});continue}const en=Rt.type.startsWith("image/");let sn=Rt;if(en&&Rt.size>2*1024*1024)try{sn=await hs(Rt,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0})}catch(Ss){console.warn("Compression failed, using original file:",Ss)}const fn=Rt.name.split(".").pop()||(en?"jpg":"bin"),Tn=`${Date.now()}_${crypto.randomUUID()}.${fn}`,Nn=`${(b==null?void 0:b.id)||"anonymous"}/${Tn}`,{error:_r}=await be.storage.from("attachments").upload(Nn,sn,{contentType:Rt.type,upsert:!1});if(_r){console.error("Upload error:",_r);continue}const{data:Ms}=be.storage.from("attachments").getPublicUrl(Nn);if(Ms){const Ss={name:Rt.name,url:Ms.publicUrl,size:Rt.size,type:Rt.type};ae.push(Ss),en&&W.push(Ms.publicUrl)}}const pt=[...P,...W],yt=[...M,...ae];H(pt),I(yt),t&&(W.length>0||ae.length>0)&&i(t.id,{images:pt,attachments:yt},[],{skipHistory:!0})}catch(W){console.error("Error uploading files:",W)}finally{xt(!1),Ue.current&&(Ue.current.value="")}}},Hu=async j=>{const W=j.target;if(W.tagName==="INPUT"||W.tagName==="TEXTAREA"||W.isContentEditable){if(j.clipboardData.files.length>0){j.preventDefault();const ae=Array.from(j.clipboardData.files);await ro(ae);return}return}if(j.clipboardData.files.length>0){j.preventDefault();const ae=Array.from(j.clipboardData.files);await ro(ae)}},cc=async j=>{let W=[];"files"in j.target&&j.target.files?W=Array.from(j.target.files):"dataTransfer"in j&&j.dataTransfer.files&&(W=Array.from(j.dataTransfer.files)),await ro(W)},al=async j=>{const W=P.filter(ke=>ke!==j),ae=M.filter(ke=>ke.url!==j);if(H(W),I(ae),t&&i(t.id,{images:W,attachments:ae},[],{skipHistory:!0}),be)try{const pt=new URL(j).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(pt){const yt=pt[1];await be.storage.from("attachments").remove([yt])}}catch(ke){console.warn("Failed to delete image from storage:",ke)}},HR=async j=>{const W=j.target.files;if(!(!W||W.length===0||!be)){xt(!0);try{const ae=[],ke=[];for(const Rt of Array.from(W)){const en=Rt.name.split(".").pop()||"bin",sn=`${Date.now()}_${crypto.randomUUID()}.${en}`,fn=`${b.id}/${sn}`,{error:Tn}=await be.storage.from("attachments").upload(fn,Rt,{contentType:Rt.type,upsert:!1});if(Tn){console.error("Upload error:",Tn),g==null||g({msg:`: ${Rt.name}`,type:"error"});continue}const{data:Gt}=be.storage.from("attachments").getPublicUrl(fn);if(Gt){const Nn=Rt.type.startsWith("image/"),_r={name:Rt.name,url:Gt.publicUrl,size:Rt.size,type:Rt.type};ae.push(_r),Nn&&ke.push(Gt.publicUrl)}}const pt=[...M,...ae],yt=[...P,...ke];I(pt),H(yt),t&&(ae.length>0||ke.length>0)&&i(t.id,{attachments:pt,images:yt},[],{skipHistory:!0}),ae.length>0&&dt(ae[ae.length-1].url),g==null||g({msg:` ${ae.length} `,type:"info"})}catch(ae){console.error("Error uploading attachments:",ae),g==null||g({msg:"",type:"error"})}finally{xt(!1),Ze.current&&(Ze.current.value="")}}},pi=x.useRef(null),VR=async j=>{const W=M.find(Rt=>Rt.url===j);if(!W)return;pi.current&&(clearTimeout(pi.current.timeoutId),i0(pi.current.url));const ae=M.filter(Rt=>Rt.url!==j),ke=P.filter(Rt=>Rt!==j);I(ae),H(ke),t&&i(t.id,{attachments:ae,images:ke},[],{skipHistory:!0});const pt=setTimeout(()=>{i0(j),lh.current.push({type:"delete",attachment:W}),ch.current=[],pi.current=null},1e4);pi.current={url:j,attachment:W,timeoutId:pt};const yt=W.name||"";g==null||g({msg:`: ${yt.length>20?yt.slice(0,20)+"...":yt}`,type:"info",undo:()=>{var Rt,en;if(pi.current&&pi.current.url===j){if(clearTimeout(pi.current.timeoutId),pi.current=null,I(sn=>[...sn,W]),(Rt=W.type)!=null&&Rt.startsWith("image/")&&H(sn=>[...sn,W.url]),t){const sn=[...ae,W],fn=(en=W.type)!=null&&en.startsWith("image/")?[...ke,W.url]:ke;i(t.id,{attachments:sn,images:fn},[],{skipHistory:!0})}g==null||g({msg:"",type:"info"})}}})},i0=async j=>{if(be)try{const ae=new URL(j).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(ae){const ke=ae[1];await be.storage.from("attachments").remove([ke]),console.log("[TaskInput] Attachment deleted from storage:",ke)}}catch(W){console.warn("Failed to delete attachment from storage:",W)}},lh=x.useRef([]),ch=x.useRef([]),WR=()=>{var j,W;if(pi.current){const{attachment:ae,timeoutId:ke}=pi.current;if(clearTimeout(ke),pi.current=null,I(pt=>pt.some(Rt=>Rt.url===ae.url)?pt:[...pt,ae]),(j=ae.type)!=null&&j.startsWith("image/")&&H(pt=>pt.includes(ae.url)?pt:[...pt,ae.url]),t){const yt=[...M,ae];i(t.id,{attachments:yt},[],{skipHistory:!0})}return g==null||g({msg:"",type:"info"}),!0}if(lh.current.length>0){const ae=lh.current.pop();return ch.current.push(ae),ae.type==="delete"&&(I(ke=>[...ke,ae.attachment]),(W=ae.attachment.type)!=null&&W.startsWith("image/")&&H(ke=>[...ke,ae.attachment.url]),t&&i(t.id,{attachments:[...M,ae.attachment]},[],{skipHistory:!0}),g==null||g({msg:"",type:"info"})),!0}return!1},KR=()=>{if(ch.current.length>0){const j=ch.current.pop();return lh.current.push(j),j.type==="delete"&&(I(W=>W.filter(ae=>ae.url!==j.attachment.url)),H(W=>W.filter(ae=>ae!==j.attachment.url)),t&&i(t.id,{attachments:M.filter(W=>W.url!==j.attachment.url),images:P.filter(W=>W!==j.attachment.url)},[],{skipHistory:!0}),i0(j.attachment.url),g==null||g({msg:"",type:"info"})),!0}return!1};x.useEffect(()=>{const j=W=>{var ae;(ae=Ne.current)!=null&&ae.contains(document.activeElement)&&((W.ctrlKey||W.metaKey)&&W.key==="z"&&!W.shiftKey&&WR()&&(W.preventDefault(),W.stopPropagation()),(W.ctrlKey||W.metaKey)&&W.key==="z"&&W.shiftKey&&KR()&&(W.preventDefault(),W.stopPropagation()))};return window.addEventListener("keydown",j,!0),()=>window.removeEventListener("keydown",j,!0)},[M,P,t]);const GR=j=>j<1024?j+" B":j<1024*1024?(j/1024).toFixed(1)+" KB":(j/(1024*1024)).toFixed(1)+" MB",Vu=j=>{var pt,yt,Rt,en,sn,fn,Tn,Gt,Nn,_r,Ms,Ss,$i,pk,mk,gk,yk,xk,bk,wk,vk;j.preventDefault();const W=document.activeElement,ae=j.shiftKey,ke=(pt=Ne.current)==null?void 0:pt.querySelector(".ProseMirror");ae?W===z.current?(Ms=Be.current)==null||Ms.focus():W!=null&&W.classList.contains("ProseMirror")?(Ss=z.current)==null||Ss.focus():Be.current&&(W===Be.current||($i=Be.current.parentElement)!=null&&$i.contains(W))?te&&U.current?U.current.focus():!te&&De.current?setTimeout(()=>{var qr,Ds;(qr=De.current)==null||qr.focus(),(Ds=De.current)==null||Ds.select()},0):(pk=V.current)==null||pk.focus():W===U.current?(mk=V.current)==null||mk.focus():W===De.current?he.current?setTimeout(()=>{var qr,Ds;(qr=he.current)==null||qr.focus(),(Ds=he.current)==null||Ds.select()},0):(gk=V.current)==null||gk.focus():W===he.current?Y.current?setTimeout(()=>{var qr,Ds;(qr=Y.current)==null||qr.focus(),(Ds=Y.current)==null||Ds.select()},0):(yk=V.current)==null||yk.focus():W===Y.current?(xk=V.current)==null||xk.focus():V.current&&(W===V.current||(bk=V.current.parentElement)!=null&&bk.contains(W))?ke?ke.focus():(wk=z.current)==null||wk.focus():(vk=Be.current)==null||vk.focus():W===z.current?ke&&ke.focus():W!=null&&W.classList.contains("ProseMirror")?(yt=V.current)==null||yt.focus():W===V.current||V.current&&((Rt=V.current.parentElement)!=null&&Rt.contains(W))?te&&U.current?U.current.focus():!te&&Y.current?(Y.current.focus(),Y.current.select()):(en=Be.current)==null||en.focus():W===U.current?(sn=Be.current)==null||sn.focus():W===Y.current?he.current?setTimeout(()=>{var qr,Ds;(qr=he.current)==null||qr.focus(),(Ds=he.current)==null||Ds.select()},0):(fn=Be.current)==null||fn.focus():W===he.current?De.current?setTimeout(()=>{var qr,Ds;(qr=De.current)==null||qr.focus(),(Ds=De.current)==null||Ds.select()},0):(Tn=Be.current)==null||Tn.focus():W===De.current?setTimeout(()=>{var qr;(qr=Be.current)==null||qr.focus()},0):Be.current&&(W===Be.current||(Gt=Be.current.parentElement)!=null&&Gt.contains(W))?(Nn=z.current)==null||Nn.focus():(_r=z.current)==null||_r.focus()},ak=()=>{t&&i(t.id,{completed_at:$?null:new Date().toISOString(),reminder_minutes:Z})},lk=j=>{var pt,yt,Rt,en,sn,fn,Tn;if((j.ctrlKey||j.metaKey)&&j.key==="z"){j.stopPropagation();return}if(j.shiftKey){if(j.key==="S"||j.key==="s"){j.preventDefault(),(pt=V.current)==null||pt.focus();return}if(j.key==="T"||j.key==="t"){j.preventDefault(),(yt=Be.current)==null||yt.focus();return}}if(j.ctrlKey&&j.key==="."){j.preventDefault(),j.stopPropagation(),ak();return}if(Vt&&document.activeElement===z.current){if(j.key==="ArrowLeft"){j.preventDefault();const Gt=dn-1;In(Gt);const Nn=new Date;Nn.setDate(Nn.getDate()+Gt);const _r=Nn.toLocaleDateString("sv-SE"),Ss=["","","","","","",""][Nn.getDay()].replace("","");D($i=>$i.replace(/\d{4}-\d{2}-\d{2}[]$/,`${_r}${Ss}`));return}if(j.key==="ArrowRight"){j.preventDefault();const Gt=dn+1;In(Gt);const Nn=new Date;Nn.setDate(Nn.getDate()+Gt);const _r=Nn.toLocaleDateString("sv-SE"),Ss=["","","","","","",""][Nn.getDay()].replace("","");D($i=>$i.replace(/\d{4}-\d{2}-\d{2}[]$/,`${_r}${Ss}`));return}if(j.key==="Enter"){j.preventDefault(),Lt(!1),In(0);return}if(j.key==="Escape"){j.preventDefault(),Lt(!1),In(0),D(Gt=>Gt.replace(/\d{4}-\d{2}-\d{2}[]$/,""));return}}const W=document.activeElement,ae=(W==null?void 0:W.classList.contains("ProseMirror"))||(W==null?void 0:W.closest(".ProseMirror")),ke=k&&k.trim()&&k!=="<p></p>";if(j.key==="Tab"&&!ae){Vu(j);return}if(j.key==="Tab"&&ae&&!ke){Vu(j);return}if(_t){if(j.key==="ArrowDown"){j.preventDefault(),Ge(Gt=>Gt===-1?0:(Gt+1)%Qe.length);return}if(j.key==="ArrowUp"){j.preventDefault(),Ge(Gt=>Gt<=0?Qe.length-1:Gt-1);return}if((j.ctrlKey||j.metaKey)&&j.key==="Enter"&&wt>=0&&(j.preventDefault(),D(Qe[wt].title),at(!1)),j.key==="Escape"){j.preventDefault(),at(!1);return}}if(!j.nativeEvent.isComposing){if((j.ctrlKey||j.metaKey)&&j.key==="Enter"&&!ae){j.preventDefault(),j.stopPropagation(),rr();return}if((j.ctrlKey||j.metaKey)&&j.key==="Enter"&&ae){j.preventDefault(),j.stopPropagation(),(Rt=z.current)==null||Rt.focus();return}if(j.key==="Enter"&&!j.shiftKey){if(j.target.tagName==="TEXTAREA"||j.target.isContentEditable)return;j.preventDefault(),j.stopPropagation(),rr()}if(j.key==="Escape"){if(Et){j.preventDefault(),j.stopPropagation(),Bt(!1),(en=de.current)==null||en.focus();return}if(pe){j.preventDefault(),j.stopPropagation(),q(!1),(sn=de.current)==null||sn.focus();return}if(_t){j.preventDefault(),j.stopPropagation(),at(!1);return}if(ye){j.preventDefault(),j.stopPropagation(),Re(!1),(fn=de.current)==null||fn.focus();return}if(rn.isOpen){j.preventDefault(),j.stopPropagation(),vn(Gt=>({...Gt,isOpen:!1}));return}if(Vt){j.preventDefault(),j.stopPropagation(),Lt(!1);return}if(ae){j.preventDefault(),j.stopPropagation(),(Tn=z.current)==null||Tn.focus();return}}if(j.key==="Escape"&&e)if(j.preventDefault(),t&&!_.trim()){const Gt=y.findIndex(_r=>_r.data.id===t.id),Nn=y[Gt-1];m(t.id),e(Nn?Nn.data.id:null)}else rr()}},ck=j=>{if(Je(j),j&&Ye){const[W,ae]=j.split(":").map(Number),[ke,pt]=Ye.split(":").map(Number);if(!isNaN(W)&&!isNaN(ae)&&!isNaN(ke)&&!isNaN(pt)){const yt=W*60+ae,Rt=ke*60+pt;if(yt<Rt)St((Rt-yt).toString());else{const en=Number(lt)||60,sn=yt+en,fn=Math.floor(sn/60)%24,Tn=sn%60;Ke(`${String(fn).padStart(2,"0")}:${String(Tn).padStart(2,"0")}`)}}}},qR=j=>{if(Ke(j),j&&Te){const[W,ae]=Te.split(":").map(Number),[ke,pt]=j.split(":").map(Number);let yt=ke*60+pt-(W*60+ae);yt<0&&(yt+=1440),St(yt.toString())}},YR=j=>{if(St(j),j&&!isNaN(Number(j))&&Te){const W=Number(j),[ae,ke]=Te.split(":").map(Number),pt=new Date;pt.setHours(ae,ke+W),Ke(`${String(pt.getHours()).padStart(2,"0")}:${String(pt.getMinutes()).padStart(2,"0")}`)}},JR=f.fontWeight==="thin"?"font-extralight":"font-medium",XR=f.fontWeight==="thin"?"font-extralight":"font-normal",uk={small:"text-sm",normal:"text-base",large:"text-lg"}[f.fontSize]||"text-base",QR=t?`border-${gn}-200`:"border-gray-100/50",ZR=()=>{const j=st?Math.max(10,Math.min(st.top,window.innerHeight-500)):0,W=st?Math.max(220,Math.min(st.left,window.innerWidth-220)):0,ae=c.jsxs(Lr.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:st?"fixed bg-white rounded-xl shadow-2xl border border-gray-100 p-4 flex flex-col gap-4 overflow-hidden w-[400px]":"absolute top-[30px] right-0 w-[400px] bg-white rounded-xl shadow-2xl border border-gray-100 z-[100] p-4 flex flex-col gap-4 overflow-hidden",style:st?{top:j,left:W,transform:"translateX(-50%)",zIndex:99999}:{},children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("h3",{className:"text-sm font-bold text-slate-800 flex items-center gap-2",children:[c.jsx(Rs,{className:"text-indigo-500",size:16}),"AI "]}),c.jsx("button",{onClick:Me,className:"text-slate-400 hover:text-slate-600 transition-colors p-1 hover:bg-slate-100 rounded-full",children:c.jsx(hn,{size:16})})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("input",{type:"text",placeholder:"...",className:"w-full px-3 py-2 text-xs bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none transition-all",value:Fe,onChange:ke=>gt(ke.target.value)}),!Fe&&Li.length>0&&c.jsxs("div",{children:[c.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2",children:""}),c.jsx("div",{className:"flex flex-wrap gap-1.5",children:Li.map(ke=>c.jsx("button",{type:"button",onClick:()=>{it(ke.description||ke.title),gt("")},className:"text-[10px] px-2 py-1 rounded-full bg-indigo-50 text-indigo-600 hover:bg-indigo-100 transition-all border border-indigo-100 font-medium",title:ke.description||ke.title,children:ke.title},ke.id))})]}),c.jsx("textarea",{className:"w-full h-32 p-3 text-sm bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none resize-none transition-all placeholder:text-slate-300",placeholder:"...",value:_e,onChange:ke=>it(ke.target.value)}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"checkbox",id:"saveToLib",checked:Zt,onChange:ke=>nn(ke.target.checked),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-slate-300"}),c.jsx("label",{htmlFor:"saveToLib",className:"text-xs text-slate-500 cursor-pointer select-none",children:""})]}),c.jsxs("div",{className:"flex gap-2 justify-end",children:[c.jsxs("button",{onClick:()=>Le(Cee),className:"flex-1 py-2.5 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 rounded-xl text-[10px] font-bold transition-all border border-indigo-200 shadow-sm active:scale-95 flex flex-col items-center justify-center gap-0.5",title:"",children:[c.jsx(Rs,{size:12}),c.jsx("span",{children:""})]}),c.jsxs("button",{onClick:()=>Le(),className:"flex-1 py-2.5 bg-slate-50 hover:bg-slate-100 text-slate-600 rounded-xl text-[10px] font-bold transition-all border border-slate-200 shadow-sm active:scale-95 flex flex-col items-center justify-center gap-0.5",children:[c.jsx(fd,{size:12}),c.jsx("span",{children:""})]}),c.jsx("button",{onClick:()=>Le(_e),disabled:!_e.trim(),className:"flex-[2] py-2 bg-slate-800 hover:bg-slate-900 text-white rounded-xl text-xs font-bold transition-all shadow-md shadow-slate-200 disabled:opacity-50 disabled:grayscale active:scale-95",children:""})]})]}),cr.length>0&&c.jsxs("div",{className:"border-t border-gray-50 pt-3 mt-1",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest",children:Fe?"":""}),Fe&&Ut>0&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:"text-[10px] text-gray-500",children:[Pt+1," / ",Ut]}),c.jsxs("div",{className:"flex gap-0.5",children:[c.jsx("button",{onClick:()=>{Ft(ke=>ke>0?ke-1:Ut-1)},className:"p-1 hover:bg-gray-100 rounded text-gray-400 hover:text-gray-600",title:" (Cmd+Shift+G)",children:c.jsx(yp,{size:12})}),c.jsx("button",{onClick:()=>{Ft(ke=>ke<Ut-1?ke+1:0)},className:"p-1 hover:bg-gray-100 rounded text-gray-400 hover:text-gray-600",title:" (Cmd+G)",children:c.jsx(rs,{size:12})})]})]})]}),c.jsx("div",{className:"flex flex-col gap-1.5 max-h-[160px] overflow-y-auto custom-scrollbar pr-1",onKeyDown:ke=>{(ke.metaKey||ke.ctrlKey)&&ke.key==="g"&&(ke.preventDefault(),ke.shiftKey?Ft(pt=>pt>0?pt-1:Ut-1):Ft(pt=>pt<Ut-1?pt+1:0))},children:cr.map((ke,pt)=>{const yt=iE(ke.description||""),Rt=(en,sn,fn)=>{if(!sn.trim())return en;const Tn=en.split(new RegExp(`(${sn})`,"gi"));let Gt=0;for(let Nn=0;Nn<pt;Nn++){const _r=cr[Nn],Ms=iE(_r.description||""),Ss=(_r.title.match(new RegExp(sn,"gi"))||[]).length,$i=Ms?(Ms.match(new RegExp(sn,"gi"))||[]).length:0;Gt+=Ss+$i}if(!fn){const Nn=(ke.title.match(new RegExp(sn,"gi"))||[]).length;Gt+=Nn}return Tn.map((Nn,_r)=>{if(Nn.toLowerCase()===sn.toLowerCase()){const Ms=Gt===Pt,Ss=c.jsx("mark",{className:`${Ms?"bg-orange-400 text-white ring-2 ring-orange-500":"bg-yellow-200 text-slate-900"} font-bold px-0.5 rounded`,ref:Ms?$i=>{$i&&$i.scrollIntoView({behavior:"smooth",block:"center"})}:void 0,children:Nn},_r);return Gt++,Ss}return Nn})};return c.jsxs("button",{type:"button",onClick:()=>{it(yt||ke.title),gt(""),Ft(0)},className:"flex-shrink-0 text-left text-[11px] p-2 rounded-xl hover:bg-indigo-50 text-slate-600 hover:text-indigo-700 transition-all border border-slate-100 hover:border-indigo-100 shadow-sm bg-white active:scale-[0.98]",title:yt||ke.title,children:[c.jsx("div",{className:"font-medium",children:Rt(ke.title,Fe,!0)}),yt&&yt!==ke.title&&c.jsx("div",{className:"text-[10px] text-gray-400 mt-0.5 whitespace-pre-wrap line-clamp-3",children:Rt(yt,Fe,!1)})]},ke.id)})})]})]},"prompt-modal");return st?or.createPortal(c.jsx(ko,{children:ye&&ae}),document.body):c.jsx(ko,{children:ye&&ae})};return c.jsxs("div",{ref:Ne,className:`group transition-all w-full relative ${n||r?"bg-transparent":`mb-3 bg-white rounded-xl border ${QR} shadow-[0_4px_8px_rgba(0,0,0,0.08)]`} ${K?"ring-2 ring-indigo-400 border-indigo-400 bg-indigo-50/10":""}`,onKeyDown:lk,onPaste:Hu,onDragOver:j=>{j.preventDefault(),j.stopPropagation(),G(!0)},onDragLeave:j=>{j.preventDefault(),j.stopPropagation(),G(!1)},onDrop:j=>{j.preventDefault(),j.stopPropagation(),G(!1),cc(j)},children:[K&&c.jsx("div",{className:"absolute inset-0 bg-indigo-500/10 backdrop-blur-[1px] z-[50] flex items-center justify-center rounded-xl pointer-events-none",children:c.jsxs("div",{className:"bg-white px-4 py-2 rounded-full shadow-lg border border-indigo-200 flex items-center gap-2",children:[c.jsx(wf,{className:"text-indigo-500 animate-bounce",size:20}),c.jsx("span",{className:"text-sm font-bold text-indigo-600",children:""})]})}),t&&!r&&c.jsx("button",{onClick:j=>{j.stopPropagation(),window.open(`${window.location.origin}/share/${t.id}`,"_blank")},className:"absolute top-4 right-4 md:opacity-0 group-hover:opacity-100 transition-opacity p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg z-20",title:" (Share Task)",children:c.jsx(Uz,{size:16})}),c.jsxs("div",{className:`flex gap-4 ${t?"pl-5":"pl-6"} py-6`,children:[t?c.jsxs("div",{className:"mb-0.5",children:[" ",c.jsx(CD,{checked:$,onChange:j=>{j.stopPropagation(),ak()},size:20,color:gn,isRoot:!R})," "]}):c.jsx("button",{type:"button",tabIndex:-1,onClick:()=>se(!B),className:`mb-0.5 h-6 w-6 flex items-center justify-center transition-all ${B?yn.accent:"text-gray-300 hover:text-gray-400"}`,children:B?c.jsx(RI,{size:18}):c.jsx(oz,{size:18})}),c.jsxs("div",{className:"flex-1 space-y-4 relative pr-6",children:[c.jsx("div",{className:"flex items-end justify-between",children:c.jsxs("div",{className:"flex-1 relative space-y-2",children:[R&&(()=>{const j=a.find(W=>W.id===R);return j?c.jsxs("button",{type:"button",onClick:W=>{W.stopPropagation(),t&&_.trim()&&rr(),w(R,!0,"allview")},className:"flex items-center gap-1.5 text-xs text-theme-tertiary hover:text-indigo-600 transition-colors group/parent",children:[c.jsx(yp,{size:12,className:"opacity-50 group-hover/parent:opacity-100"}),c.jsx("span",{className:"truncate max-w-[200px] group-hover/parent:underline",children:j.title||""})]}):null})(),nt.length>0&&c.jsxs("div",{className:"flex items-center gap-2 text-xs text-amber-600 bg-amber-50 p-2 rounded-lg mb-2",children:[c.jsx(Jf,{size:14,className:"shrink-0"}),c.jsxs("span",{children:["",nt.map((j,W)=>c.jsxs("span",{children:[W>0&&", ",c.jsx("button",{type:"button",onClick:ae=>{ae.stopPropagation(),w(j.id,!0)},className:"hover:underline font-medium",children:j.title})]},j.id))]})]}),c.jsxs("div",{className:"flex items-center relative gap-2",children:[c.jsx("input",{ref:z,autoFocus:!0,type:"text",name:"data_task_input",autoComplete:"off",autoCorrect:"off",spellCheck:"false",value:_,onKeyDown:j=>{j.key==="Enter"&&console.log("[TaskInputDebug] Enter pressed",{isComposing:j.nativeEvent.isComposing,titleLen:_.length}),lk(j)},onFocus:()=>ce(_.length>0),onBlur:()=>setTimeout(()=>ce(!1),200),onChange:j=>{const W=j.target.value;if(ce(W.length>0),W.endsWith("@ ")&&!Vt){Lt(!0),In(0);const ae=new Date,ke=ae.toLocaleDateString("sv-SE"),yt=["","","","","","",""][ae.getDay()].replace("","");D(W.slice(0,-2)+`${ke}${yt}`)}else Vt&&!W.match(/\d{4}-\d{2}-\d{2}[]$/)&&Lt(!1),D(W)},placeholder:"...",className:`flex-1 ${uk} ${JR} transition-all duration-300 placeholder:font-light placeholder-gray-300 border-none bg-transparent focus:ring-0 outline-none p-0 leading-tight ${$?"opacity-30":Vt?"text-slate-400":"text-slate-800"}`}),ie&&_.length>0&&(()=>{const j=ae=>{const ke=a.find(Rt=>Rt.id===ae);if(!ke||!ke.parent_id)return"";const pt=a.find(Rt=>Rt.id===ke.parent_id);if(!pt)return"";const yt=j(pt.id);return yt?`${yt} > ${pt.title}`:pt.title},W=a.filter(ae=>ae.id!==(t==null?void 0:t.id)&&ae.title&&ae.title.toLowerCase().includes(_.toLowerCase())&&ae.title.toLowerCase()!==_.toLowerCase()).slice(0,5);return W.length===0?null:c.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 z-50 overflow-hidden animate-in slide-in-from-top-2 fade-in duration-200",children:W.map(ae=>{const ke=j(ae.id);return c.jsx("button",{type:"button",onMouseDown:pt=>{pt.preventDefault(),D(ae.title),ce(!1)},className:"w-full text-left px-4 py-2.5 text-sm hover:bg-slate-50 dark:hover:bg-slate-700/50 border-b border-slate-100 dark:border-slate-700/50 last:border-b-0 transition-colors group",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity",children:""}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:"text-slate-700 dark:text-slate-300 truncate",children:ae.title}),ke&&c.jsx("div",{className:"text-xs text-slate-400 dark:text-slate-500 truncate mt-0.5",children:ke})]})]})},ae.id)})})})(),_.trim()&&c.jsx("button",{type:"button",onClick:j=>{j.preventDefault(),j.stopPropagation(),console.log("[TaskInput] Manual Button Submit"),rr()},className:"p-1.5 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition-colors shadow-sm active:scale-95 flex-shrink-0 animate-in fade-in zoom-in duration-200",children:c.jsx(ez,{size:18})})]}),Ve&&or.createPortal(c.jsx("div",{className:"fixed inset-0 z-[9999999] flex items-center justify-center bg-black/20 backdrop-blur-sm",onClick:()=>Ct(!1),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl border border-slate-200 p-4 w-[400px] max-w-[90vw] animate-in fade-in zoom-in-95 duration-200",onClick:j=>j.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between mb-3 border-b border-slate-100 pb-2",children:[c.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[c.jsx(Rs,{size:16,className:"text-amber-500"}),c.jsx("h3",{className:"font-bold text-sm",children:" AI "})]}),c.jsx("button",{onClick:()=>Ct(!1),className:"text-slate-400 hover:text-slate-600",children:c.jsx(hn,{size:16})})]}),c.jsxs("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:[c.jsxs("button",{onClick:()=>Tt(),className:"w-full text-left p-3 rounded-lg border border-slate-100 hover:border-indigo-300 hover:bg-indigo-50 transition-all group",children:[c.jsx("div",{className:"font-medium text-sm text-slate-700 group-hover:text-indigo-700",children:" SEO "}),c.jsx("div",{className:"text-xs text-slate-500 mt-1",children:" SEO "})]}),bt.map(j=>c.jsxs("button",{onClick:()=>Tt(j.description||""),className:"w-full text-left p-3 rounded-lg border border-slate-100 hover:border-amber-300 hover:bg-amber-50 transition-all group",children:[c.jsx("div",{className:"font-medium text-sm text-slate-700 group-hover:text-amber-700",children:j.title}),c.jsx("div",{className:"text-xs text-slate-500 mt-1 line-clamp-2",children:(j.description||"").replace(/<[^>]+>/g,"")})]},j.id))]})]})}),document.body),pe&&or.createPortal(c.jsxs("div",{className:"fixed bg-theme-card rounded-xl shadow-2xl border border-theme p-4 animate-in fade-in zoom-in-95 duration-200",style:{top:z.current?z.current.getBoundingClientRect().bottom+8:100,left:z.current?z.current.getBoundingClientRect().left:100,width:z.current?z.current.getBoundingClientRect().width:300,zIndex:99999},children:[c.jsxs("div",{className:"flex items-center gap-2 text-indigo-400 mb-3",children:[c.jsx(a1,{size:14}),c.jsx("span",{className:"text-xs font-bold",children:"AI "})]}),c.jsx("input",{type:"text",autoFocus:!0,value:Ht,onChange:j=>cn(j.target.value),className:"w-full px-3 py-2 text-sm bg-theme-main border border-theme rounded-lg focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500/50 outline-none text-theme-primary",placeholder:"..."}),c.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[c.jsx("button",{type:"button",onClick:Ae,className:"px-3 py-1.5 text-xs text-theme-tertiary hover:bg-theme-hover rounded-lg transition-colors",children:""}),c.jsx("button",{type:"button",onClick:re,className:"px-3 py-1.5 text-xs bg-indigo-600 text-white hover:bg-indigo-700 rounded-lg transition-colors font-medium",children:""})]})]}),document.body),ls&&or.createPortal(c.jsx("div",{className:"fixed inset-0 z-[9999999] flex items-center justify-center bg-black/20 backdrop-blur-sm",onClick:j=>{j.stopPropagation(),xn(!1)},onMouseDown:j=>j.stopPropagation(),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl border border-slate-200 p-5 w-[450px] max-w-[90vw] animate-in fade-in zoom-in-95 duration-200",onClick:j=>j.stopPropagation(),onMouseDown:j=>j.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between mb-4 border-b border-slate-100 pb-3",children:[c.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[c.jsx(Ll,{size:16,className:"text-emerald-500"}),c.jsx("h3",{className:"font-bold text-sm",children:"AI "})]}),c.jsx("button",{onClick:j=>{j.stopPropagation(),xn(!1)},onMouseDown:j=>j.stopPropagation(),className:"text-slate-400 hover:text-slate-600",children:c.jsx(hn,{size:16})})]}),di.length>0&&c.jsxs("div",{className:"mb-4",children:[c.jsx("p",{className:"text-xs text-slate-500 mb-2",children:" SEO   "}),c.jsx("div",{className:"flex flex-wrap gap-2",children:di.map((j,W)=>c.jsxs("div",{className:"group flex items-center gap-1 px-3 py-1.5 bg-emerald-50 text-emerald-700 rounded-full text-xs font-medium border border-emerald-200 hover:bg-emerald-100 transition-all",onClick:ae=>ae.stopPropagation(),onMouseDown:ae=>ae.stopPropagation(),children:[c.jsx("span",{className:"text-emerald-500",children:"#"}),c.jsx("span",{children:j}),c.jsx("button",{onClick:ae=>{ae.stopPropagation(),$t(j)},onMouseDown:ae=>ae.stopPropagation(),className:"ml-1 text-emerald-600 hover:text-emerald-800 p-0.5 hover:bg-emerald-200 rounded",title:"",children:c.jsx(Zn,{size:12})}),c.jsx("button",{onClick:ae=>{ae.stopPropagation(),Yt(j)},onMouseDown:ae=>ae.stopPropagation(),className:"text-slate-400 hover:text-red-500 p-0.5 hover:bg-red-100 rounded",title:"",children:c.jsx(hn,{size:12})})]},W))})]}),Gn&&c.jsxs("div",{className:"flex items-center justify-center py-6 text-slate-500",children:[c.jsx(xi,{size:20,className:"animate-spin mr-2"}),c.jsx("span",{className:"text-sm",children:"..."})]}),c.jsxs("div",{className:"flex gap-2 justify-end mt-4 pt-3 border-t border-slate-100",children:[c.jsx("button",{onClick:j=>{j.stopPropagation(),xn(!1)},onMouseDown:j=>j.stopPropagation(),className:"px-4 py-2 text-xs text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:""}),c.jsxs("button",{onClick:j=>{j.stopPropagation(),kt()},onMouseDown:j=>j.stopPropagation(),disabled:Gn,className:"px-4 py-2 text-xs bg-indigo-600 text-white hover:bg-indigo-700 rounded-lg transition-colors font-medium disabled:opacity-50 flex items-center gap-1",children:[Gn?c.jsx(xi,{size:12,className:"animate-spin"}):c.jsx(Rs,{size:12}),""]}),di.length>0&&c.jsxs("button",{onClick:j=>{j.stopPropagation(),zt()},onMouseDown:j=>j.stopPropagation(),className:"px-4 py-2 text-xs bg-emerald-600 text-white hover:bg-emerald-700 rounded-lg transition-colors font-medium flex items-center gap-1",children:[c.jsx(Zn,{size:12}),""]})]})]})}),document.body),_t&&c.jsx("div",{className:"w-full mt-1 mb-2",children:c.jsx("div",{className:"bg-theme-hover rounded-lg overflow-hidden border border-theme",children:Qe.map((j,W)=>c.jsxs("div",{className:`px-3 py-1.5 text-xs cursor-pointer transition-colors flex justify-between items-center ${W===wt?"bg-theme-selection text-theme-primary font-medium":"text-theme-secondary hover:bg-theme-hover"}`,onClick:()=>{D(j.title),at(!1)},children:[c.jsx("span",{children:j.title}),W===wt&&c.jsx("span",{className:"text-[9px] text-indigo-400 font-normal",children:"Ctrl+Enter"})]},j.id))})}),c.jsxs("div",{className:"flex justify-end mb-1 gap-2",children:[c.jsxs("button",{type:"button",onClick:()=>{we(),ht(null)},disabled:ze,className:`flex items-center gap-1.5 text-xs transition-colors disabled:opacity-50 px-2 py-0.5 rounded-full ${Et?"bg-indigo-500/20 text-indigo-400 font-bold shadow-sm ring-1 ring-indigo-500/30":"text-indigo-500 hover:text-indigo-400 hover:bg-indigo-500/10 font-medium"}`,title:"AI Assistant Brain",children:[ze?c.jsx(xi,{size:12,className:"animate-spin"}):c.jsx(Rs,{size:12}),c.jsx("span",{children:"AI "})]}),c.jsxs("button",{type:"button",onClick:qe,disabled:Wt,className:`flex items-center gap-1.5 text-xs transition-colors disabled:opacity-50 px-2 py-0.5 rounded-full ${Wt?"bg-amber-500/20 text-amber-400 font-bold shadow-sm ring-1 ring-amber-500/30":"text-amber-500 hover:text-amber-400 hover:bg-amber-500/10 font-medium"}`,title:" SEO ",children:[Wt?c.jsx(xi,{size:12,className:"animate-spin"}):c.jsx(a1,{size:12}),c.jsx("span",{children:"AI "})]}),c.jsxs("button",{type:"button",onClick:()=>{xn(!0),kt()},disabled:Gn,className:`flex items-center gap-1.5 text-xs transition-colors disabled:opacity-50 px-2 py-0.5 rounded-full ${Gn?"bg-emerald-500/20 text-emerald-400 font-bold shadow-sm ring-1 ring-emerald-500/30":"text-emerald-500 hover:text-emerald-400 hover:bg-emerald-500/10 font-medium"}`,title:" SEO ",children:[Gn?c.jsx(xi,{size:12,className:"animate-spin"}):c.jsx(Ll,{size:12}),c.jsx("span",{children:"AI "})]}),ZR()]}),c.jsxs("div",{className:"flex flex-col md:flex-row gap-4 transition-all duration-300 items-stretch h-full",children:[c.jsxs("div",{className:"flex-1 transition-all duration-300 overflow-y-auto max-h-[55vh] flex flex-col no-scrollbar",children:[jt&&c.jsx(A9,{url:jt.url,fileName:jt.name,autoPlay:!0,markers:(dk=jt.markers)==null?void 0:dk.filter(j=>J.has(j.id)),seekToTime:me,onClose:()=>{Q(null),He(null)},onMarkerClick:j=>{ft.current&&ft.current.scrollToParagraph&&ft.current.scrollToParagraph(j.id)}}),c.jsx(Zg,{onEditorReady:j=>{ft.current=j},onPolish:(j,W,ae)=>{tt(W),ae&&ht(ae),Re(!0),it("")},initialContent:k,onChange:A,onExit:()=>{var j;return(j=V.current)==null?void 0:j.focus()},textSizeClass:uk,descFontClass:XR,className:"h-full",onSaveAudio:ol,onAudioMarkerClick:(j,W)=>{if(W){const ke=M.find(pt=>pt.recordingId===W);if(ke){Q({url:ke.url,name:ke.name,markers:ke.markers}),He(Math.max(0,j-4e3));return}}if(jt){He(Math.max(0,j-4e3));return}const ae=M.find(ke=>{var pt,yt;return ke.recordingId||((pt=ke.type)==null?void 0:pt.startsWith("audio/"))||((yt=ke.url)==null?void 0:yt.match(/\.(mp3|wav|webm|m4a|ogg)$/i))});ae&&(Q({url:ae.url,name:ae.name,markers:ae.markers}),He(Math.max(0,j-4e3)))},activeMarkerIds:((fk=jt==null?void 0:jt.markers)==null?void 0:fk.filter(j=>J.has(j.id)).map(j=>j.id))||null,onMarkersChange:j=>{Pe(new Set(j.map(W=>W.id)))},attachments:M,taskColor:gn,availableTags:o.map(j=>({id:j.id,name:j.name,color:j.color,parent_id:j.parent_id,order_index:j.order_index})),onCreateTag:async j=>{if(!l)return null;try{const W=await l(j,null);if(W)return{id:W,name:j,color:"#6366f1"}}catch(W){console.error("Failed to create tag from editor",W),g==null||g({msg:"",type:"error"})}return null}})]}),Et&&(()=>{var ke,pt;const j=st?Math.max(10,Math.min(st.top,window.innerHeight-500)):0,W=st?Math.min(st.left+220,window.innerWidth-360):0,ae=c.jsx("div",{className:st?"fixed w-[340px] shrink-0 animate-in slide-in-from-right-4 fade-in duration-300 flex flex-col max-h-[80vh] overflow-hidden bg-white rounded-2xl shadow-2xl":"w-full md:w-[340px] shrink-0 animate-in slide-in-from-right-4 md:slide-in-from-bottom-4 fade-in duration-500 border-l border-indigo-50 pl-0 md:pl-4 flex flex-col h-full overflow-hidden",style:st?{top:j,left:W,zIndex:99998}:{},children:ze?c.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400 gap-4 bg-slate-50/50 rounded-2xl border border-dashed border-slate-200",children:[c.jsxs("div",{className:"relative",children:[c.jsx(fd,{size:32,className:"text-indigo-400 animate-pulse"}),c.jsx(Rs,{size:16,className:"absolute -top-1 -right-1 text-amber-400 animate-bounce"})]}),c.jsxs("div",{className:"flex flex-col items-center gap-1",children:[c.jsx("span",{className:"text-[11px] font-bold text-slate-500",children:"..."}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("div",{className:"w-1 h-1 bg-indigo-400 rounded-full animate-bounce [animation-delay:-0.3s]"}),c.jsx("div",{className:"w-1 h-1 bg-indigo-400 rounded-full animate-bounce [animation-delay:-0.15s]"}),c.jsx("div",{className:"w-1 h-1 bg-indigo-400 rounded-full animate-bounce"})]})]})]}):nr.length>0?c.jsxs("div",{className:"flex flex-col gap-2 h-full",children:[c.jsxs("div",{className:"flex items-center justify-between px-2 pt-2",children:[c.jsxs("span",{className:"text-xs font-bold text-slate-400 ml-1",children:[" ",qn+1," / ",nr.length]}),c.jsxs("div",{className:"flex items-center gap-1 bg-slate-100 rounded-lg p-0.5",children:[c.jsx("button",{onClick:()=>{const yt=Math.max(0,qn-1);Pi(yt),fi(nr[yt].content)},disabled:qn===0,className:"p-1 hover:bg-white rounded-md disabled:opacity-30 transition-all text-slate-600",title:"",children:c.jsx(Ou,{size:12})}),c.jsx("button",{onClick:()=>{const yt=Math.min(nr.length-1,qn+1);Pi(yt),fi(nr[yt].content)},disabled:qn===nr.length-1,className:"p-1 hover:bg-white rounded-md disabled:opacity-30 transition-all text-slate-600",title:"",children:c.jsx(is,{size:12})}),c.jsx("div",{className:"w-px h-3 bg-slate-300 mx-0.5"}),c.jsx("button",{onClick:()=>{const yt=nr.filter((Rt,en)=>en!==qn);if($r(yt),yt.length!==0){const Rt=Math.min(qn,yt.length-1);Pi(Rt),fi(yt[Rt].content)}t&&i(t.id,{ai_history:yt},[],{skipHistory:!0})},className:"p-1 hover:bg-red-50 text-slate-400 hover:text-red-500 rounded-md transition-all",title:"",children:c.jsx(jr,{size:12})})]})]}),c.jsxs("div",{className:"bg-white rounded-2xl shadow-xl shadow-indigo-100/20 border border-indigo-50 overflow-hidden flex flex-col animate-in zoom-in-95 duration-300 flex-1",children:[c.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 p-3 shrink-0",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2 text-white",children:[c.jsx(fd,{size:16,className:"animate-pulse"}),c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-xs font-bold tracking-wider",children:"AI "}),c.jsx("span",{className:"text-[10px] text-indigo-100 opacity-80 truncate max-w-[200px]",children:(ke=nr[qn])==null?void 0:ke.prompt})]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:()=>{it(""),Re(!0)},className:"p-1 text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-colors",title:"",children:c.jsx(Rs,{size:14})}),c.jsx("button",{onClick:()=>{Bt(!1),tt(null)},className:"p-1 text-white/60 hover:text-white transition-colors",children:c.jsx(hn,{size:14})})]})]})}),c.jsxs("div",{className:"p-4 flex flex-col gap-3 overflow-hidden flex-1",children:[Dr?c.jsx("textarea",{value:ac,onChange:yt=>fi(yt.target.value),className:"w-full h-full min-h-[200px] p-3 text-[13px] text-slate-700 leading-relaxed border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none resize-none"}):c.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar pr-1",children:c.jsx("div",{className:"markdown-content text-[13px] text-slate-700 leading-relaxed prose prose-sm prose-indigo max-w-none",children:c.jsx(ok,{children:((pt=nr[qn])==null?void 0:pt.content)||""})})}),c.jsx("div",{className:"flex flex-col gap-2 pt-2 border-t border-slate-50 shrink-0",children:Dr?c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:()=>{const yt=[...nr];yt[qn]={...yt[qn],content:ac},$r(yt),t&&i(t.id,{ai_history:yt},[],{skipHistory:!0}),le(!1)},className:"flex-1 flex items-center justify-center gap-2 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-indigo-200 active:scale-95",children:[c.jsx(Zn,{size:14}),""]}),c.jsx("button",{onClick:()=>{var yt;fi(((yt=nr[qn])==null?void 0:yt.content)||""),le(!1)},className:"px-3 py-2 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-xl text-xs font-bold transition-all active:scale-95",children:""})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("button",{onClick:()=>{var yt;fi(((yt=nr[qn])==null?void 0:yt.content)||""),le(!0)},className:"flex items-center justify-center gap-1.5 py-2 bg-slate-50 hover:bg-slate-100 text-slate-600 rounded-xl text-[11px] font-bold transition-all border border-slate-200 active:scale-95",children:[c.jsx(Iw,{size:13}),""]}),c.jsxs("button",{onClick:async()=>{var Rt,en;const yt=((Rt=o.find(sn=>sn.name.includes("")))==null?void 0:Rt.id)||await l("");yt&&(await s({title:` ${_||""}`,description:((en=nr[qn])==null?void 0:en.content)||"",tags:[yt],status:"active",color:"purple"}),g==null||g({msg:"",type:"info"}))},className:"flex items-center justify-center gap-1.5 py-2 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-xl text-[11px] font-bold transition-all border border-purple-200 shadow-sm active:scale-95",children:[c.jsx(iu,{size:13}),""]})]}),c.jsxs("button",{onClick:()=>{var fn,Tn;const yt=((fn=nr[qn])==null?void 0:fn.content)||"",Rt=((Tn=nr[qn])==null?void 0:Tn.prompt)||"",en=sE(yt);let sn="AI ";if(Rt){const Gt=Rt.replace(/<[^>]*>/g,"").trim();Gt.includes("")||Gt.includes("")||Gt.includes("")?sn="AI ":Gt.includes("")||Gt.includes("")||Gt.includes("")?sn="AI ":Gt.includes("")||Gt.includes("")||Gt.includes("")?sn="AI ":Gt.includes("")||Gt.includes("")?sn="AI ":Gt.includes("")||Gt.includes("")||Gt.includes("translate")?sn="AI ":Gt.includes("")||Gt.includes("")||Gt.includes("")?sn="AI ":Gt.includes("")||Gt.includes("")?sn="AI ":Gt.includes("")||Gt.includes("")?sn="AI ":Gt.includes("")||Gt.includes("")?sn="AI ":Gt.length>0&&(sn="AI "+Gt.slice(0,6).replace(/[]/g,""))}A(Gt=>Gt+`<p><br><strong>--- ${sn} ---</strong></p>`+en),g==null||g({msg:"",type:"info"}),Bt(!1)},className:"flex items-center justify-center gap-2 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-indigo-200 active:scale-95",children:[c.jsx(Nw,{size:14}),""]}),ve&&c.jsxs("button",{onClick:()=>{var yt;if(ft.current){const Rt=ft.current,en=ve.from,sn=((yt=nr[qn])==null?void 0:yt.content)||"",fn=sE(sn),Tn=en;Rt.commands.insertContentAt(ve,fn),setTimeout(()=>{Rt.chain().setTextSelection({from:en,to:Tn}).setHighlight({color:"#fef08a"}).setTextSelection(Tn).focus().run(),At({from:en,to:Tn})},50),tt(null),ht(null),Bt(!1),g==null||g({msg:"",type:"info"})}},className:"flex items-center justify-center gap-2 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-xl text-xs font-bold transition-all border border-green-200 shadow-sm active:scale-95",children:[c.jsx(Zn,{size:14}),""]})]})})]})]})]}):c.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400 gap-4 bg-slate-50/50 rounded-2xl border border-dashed border-slate-200",children:[c.jsx(fd,{size:32,className:"text-slate-300"}),c.jsx("span",{className:"text-xs text-slate-400",children:" AI "})]})});return st?or.createPortal(ae,document.body):ae})()]}),P.length>0&&c.jsx("div",{className:"grid grid-cols-4 gap-2 mt-2",children:P.map((j,W)=>{var yt;const ae=M.find(Rt=>Rt.url===j),ke=j.match(/\.(jpg|jpeg|png|gif|webp|avif)/i)||((yt=ae==null?void 0:ae.type)==null?void 0:yt.startsWith("image/")),pt=(ae==null?void 0:ae.name)||"Image";return c.jsxs("div",{className:"relative group aspect-square rounded-lg overflow-hidden border border-gray-100 shadow-sm cursor-pointer bg-gray-50 flex items-center justify-center",onClick:()=>ke?ue(j):window.open(j,"_blank"),children:[ke?c.jsx("img",{src:j,alt:pt,className:"w-full h-full object-cover transition-transform group-hover:scale-105"}):c.jsxs("div",{className:"flex flex-col items-center gap-1 p-2",children:[c.jsx("div",{className:"w-8 h-8 rounded bg-white border border-gray-200 flex items-center justify-center shadow-sm",children:c.jsx(go,{size:16,className:"text-gray-400"})}),c.jsx("span",{className:"text-[9px] text-gray-500 truncate w-full px-1 text-center font-medium leading-tight",children:pt})]}),c.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors"}),c.jsx("button",{type:"button",onClick:Rt=>{Rt.stopPropagation(),al(j)},className:"absolute top-1 right-1 p-1 bg-black/50 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-500 z-10",children:c.jsx(hn,{size:10})})]},W)})}),M.length>0&&c.jsxs("div",{className:"mt-2",children:[c.jsxs("button",{type:"button",onClick:()=>Sn(!Cn),className:`w-full flex items-center justify-between gap-2 px-2.5 py-1.5 rounded-lg border transition-all ${Cn?"bg-indigo-50 border-indigo-200":"bg-gray-50 border-gray-100 hover:bg-gray-100"}`,children:[c.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[c.jsx(go,{size:12,className:Cn?"text-indigo-500":"text-gray-400"}),c.jsxs("span",{className:`text-xs font-medium ${Cn?"text-indigo-700":"text-gray-600"}`,children:[M.length," "]}),M.filter(j=>{var W;return((W=j.type)==null?void 0:W.startsWith("audio/"))||j.name.match(/\.(mp3|wav|ogg|m4a|webm)$/i)}).length>0&&c.jsxs("span",{className:"text-[10px] text-indigo-500 bg-indigo-50 px-1.5 py-0.5 rounded-full flex items-center gap-1",children:[c.jsx(o1,{size:9}),M.filter(j=>{var W;return((W=j.type)==null?void 0:W.startsWith("audio/"))||j.name.match(/\.(mp3|wav|ogg|m4a|webm)$/i)}).length]}),!Cn&&c.jsx("span",{className:"text-[10px] text-gray-400 truncate max-w-[200px]",children:M.map(j=>j.name.split(".")[0]).join(", ")})]}),c.jsx(rs,{size:14,className:`text-gray-400 transition-transform ${Cn?"rotate-180":""}`})]}),Cn&&c.jsx("div",{className:"mt-1.5 space-y-1 animate-in slide-in-from-top-2 duration-200",children:M.map(j=>{var W;return c.jsxs("div",{className:`group flex items-center gap-2 px-2 py-1 rounded-md border transition-colors ${(jt==null?void 0:jt.url)===j.url?"bg-indigo-50 border-indigo-200 ring-1 ring-indigo-300/50":"bg-theme-card border-theme hover:border-theme"}`,children:[(W=j.type)!=null&&W.startsWith("audio/")||j.name.match(/\.(mp3|wav|ogg|m4a|webm|mp4)$/i)?c.jsx("button",{type:"button",onClick:ae=>{ae.preventDefault(),Q({url:j.url,name:j.name,markers:j.markers})},className:"p-0.5 text-indigo-500 bg-indigo-50 rounded-full hover:bg-indigo-100",children:c.jsx(o1,{size:10})}):c.jsx(go,{size:10,className:"text-gray-400 flex-shrink-0"}),c.jsx("input",{ref:ae=>{ae&&ct===j.url&&(ae.focus(),dt(null))},type:"text",value:j.name,onChange:ae=>{const ke=ae.target.value;I(pt=>pt.map(yt=>yt.url===j.url?{...yt,name:ke}:yt))},onBlur:()=>{t&&i(t.id,{attachments:M},[],{skipHistory:!0})},onKeyDown:ae=>{var ke;ae.key==="Enter"&&(ae.preventDefault(),ae.stopPropagation(),ae.target.blur(),(ke=xe.current)==null||ke.focus())},className:"flex-1 text-[11px] text-theme-secondary bg-transparent border-none focus:outline-none focus:bg-indigo-50/50 rounded px-1 truncate min-w-0"}),c.jsx("button",{type:"button",onClick:ae=>{ae.preventDefault(),fetch(j.url).then(ke=>ke.blob()).then(ke=>{const pt=window.URL.createObjectURL(ke),yt=document.createElement("a");yt.href=pt,yt.download=j.name,document.body.appendChild(yt),yt.click(),window.URL.revokeObjectURL(pt),document.body.removeChild(yt)}).catch(ke=>console.error("Download failed:",ke))},className:"p-0.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors opacity-0 group-hover:opacity-100",title:"",children:c.jsx(iu,{size:10})}),c.jsx("span",{className:"text-[9px] text-gray-400 flex-shrink-0",children:GR(j.size)}),c.jsx("button",{type:"button",onClick:()=>VR(j.url),className:"opacity-0 group-hover:opacity-100 p-0.5 hover:bg-red-50 rounded transition-all",children:c.jsx(hn,{size:10,className:"text-gray-400 hover:text-red-500"})})]},j.url)})})]})]})}),c.jsxs("div",{className:"flex items-center justify-between pt-1 flex-col items-start gap-2",children:[C.length>0&&(()=>{const j=C.filter(ae=>{const ke=o.find(pt=>pt.id===ae);return ke&&!ke.name.startsWith("#")}),W=C.filter(ae=>{const ke=o.find(pt=>pt.id===ae);return ke&&ke.name.startsWith("#")});return c.jsxs("div",{className:"flex flex-col gap-2 px-1 w-full",children:[j.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1",children:j.map(ae=>{const ke=o.find(pt=>pt.id===ae);return ke?c.jsx(ED,{tag:ke,onRemove:()=>O(pt=>pt.filter(yt=>yt!==ae))},ae):null})}),W.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1 pt-1 border-t border-emerald-100",children:W.map(ae=>{const ke=o.find(pt=>pt.id===ae);return ke?c.jsxs("div",{className:"flex items-center gap-1 h-5 px-2 rounded-full text-[10px] font-medium bg-emerald-50 text-emerald-700 border border-emerald-200",children:[c.jsx("span",{children:ke.name}),c.jsx("button",{type:"button",onClick:()=>O(pt=>pt.filter(yt=>yt!==ae)),className:"hover:text-red-500 transition-colors",children:c.jsx(hn,{size:10})})]},ae):null})})]})})(),c.jsxs("div",{className:"flex flex-col gap-3 w-full border-t border-gray-100 pt-3 mt-1",children:[c.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[!S&&c.jsxs("button",{type:"button",onClick:()=>T(new Date().toISOString()),className:"flex items-center gap-1 px-2 py-1.5 rounded-md bg-indigo-500/10 text-indigo-500 text-[10px] font-bold border border-indigo-500/20 hover:bg-indigo-500/20 transition-all animate-pulse hover:animate-none",title:"",children:[c.jsx(Rs,{size:11})," "]}),c.jsx(E_,{innerRef:V,label:"",value:S||void 0,onChange:T,theme:yn,tasks:a}),S&&c.jsx("div",{className:"flex items-center gap-2 bg-transparent rounded-md px-2 py-1 border border-theme",children:c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{ref:U,type:"checkbox",checked:te,onChange:j=>{const W=j.target.checked;$e(W),W||setTimeout(()=>{var ae,ke;(ae=Y.current)==null||ae.focus(),(ke=Y.current)==null||ke.select()},50)},className:"w-3 h-3 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-tighter",children:""})]})}),S&&c.jsx(Tee,{value:Z,onChange:ne}),c.jsx(E_,{tabIndex:-1,label:"",value:N||void 0,onChange:E,colorClass:"text-red-500",tasks:a,theme:yn}),c.jsx(M1,{innerRef:Be,icon:Ll,label:"",items:vr,selectedIds:C,placeholder:"...",allowAdd:!0,onDeleteItem:u,multiSelect:!0,theme:yn,onSelect:async(j,W,ae)=>{if(j)O(ke=>ke.includes(j)?ke.filter(pt=>pt!==j):[...ke,j]);else if(W){const ke=await l(W,ae??null);ke&&O(pt=>[...pt,ke])}}}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{type:"button",onClick:()=>Ie(!Se),className:`flex items-center gap-1 px-2 py-1.5 rounded-md text-[10px] font-bold border transition-all ${X?"bg-purple-50 text-purple-600 border-purple-200 hover:bg-purple-100":"bg-transparent text-theme-tertiary border-theme hover:bg-theme-hover"}`,title:"",children:[c.jsx(FI,{size:12}),X&&X.originalText||""]}),Se&&c.jsxs("div",{className:"absolute top-full left-0 mt-1 z-50 bg-white rounded-lg shadow-xl border border-gray-200 p-4 min-w-[280px]",children:[c.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-3",children:""}),c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsx("div",{className:"grid grid-cols-4 gap-1",children:[{type:"daily",label:""},{type:"weekly",label:""},{type:"monthly",label:""},{type:"yearly",label:""}].map(j=>c.jsx("button",{type:"button",onClick:()=>{ee(W=>({...W,type:j.type,interval:(W==null?void 0:W.interval)||1,originalText:`${(W==null?void 0:W.interval)||1}${j.type==="daily"?"":j.type==="weekly"?"":j.type==="monthly"?"":""}`,triggerMode:(W==null?void 0:W.triggerMode)||"on_complete"}))},className:`px-2 py-1.5 rounded text-xs font-medium transition-colors ${(X==null?void 0:X.type)===j.type?"bg-purple-500 text-white":"bg-gray-100 text-gray-600 hover:bg-purple-100"}`,children:j.label},j.type))})]}),X&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-sm text-gray-600",children:""}),c.jsx("input",{type:"number",min:1,max:365,value:X.interval,onChange:j=>{const W=Math.max(1,parseInt(j.target.value)||1);ee(ae=>ae?{...ae,interval:W,originalText:`${W}${ae.type==="daily"?"":ae.type==="weekly"?"":ae.type==="monthly"?"":""}`}:null)},className:"w-16 px-2 py-1 border border-gray-300 rounded text-sm text-center focus:border-purple-400 focus:outline-none"}),c.jsx("span",{className:"text-sm text-gray-600",children:X.type==="daily"?"":X.type==="weekly"?"":X.type==="monthly"?"":""})]})]}),(X==null?void 0:X.type)==="monthly"&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-sm text-gray-600",children:""}),c.jsx("input",{type:"number",min:1,max:31,value:X.monthDay||1,onChange:j=>{const W=Math.min(31,Math.max(1,parseInt(j.target.value)||1));ee(ae=>ae?{...ae,monthDay:W,originalText:`${ae.interval}${W}`}:null)},className:"w-16 px-2 py-1 border border-gray-300 rounded text-sm text-center focus:border-purple-400 focus:outline-none"}),c.jsx("span",{className:"text-sm text-gray-600",children:""})]})]}),X&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-gray-50",children:[c.jsx("input",{type:"radio",name:"triggerMode",checked:X.triggerMode!=="on_schedule",onChange:()=>ee(j=>j?{...j,triggerMode:"on_complete"}:null),className:"text-purple-500"}),c.jsxs("div",{children:[c.jsx("div",{className:"text-xs font-medium text-gray-700",children:""}),c.jsx("div",{className:"text-[10px] text-gray-400",children:""})]})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-gray-50",children:[c.jsx("input",{type:"radio",name:"triggerMode",checked:X.triggerMode==="on_schedule",onChange:()=>ee(j=>j?{...j,triggerMode:"on_schedule"}:null),className:"text-purple-500"}),c.jsxs("div",{children:[c.jsx("div",{className:"text-xs font-medium text-gray-700",children:""}),c.jsx("div",{className:"text-[10px] text-gray-400",children:""})]})]})]})]}),X&&c.jsx("div",{className:"mb-3",children:c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-gray-50",children:[c.jsx("input",{type:"checkbox",checked:X.copyDescription!==!1,onChange:j=>ee(W=>W?{...W,copyDescription:j.target.checked}:null),className:"w-3.5 h-3.5 text-purple-600 rounded border-gray-300 focus:ring-purple-500"}),c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-xs font-medium text-gray-700",children:""}),c.jsx("span",{className:"text-[10px] text-gray-400",children:""})]})]})}),X&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:" ()"}),c.jsx("input",{type:"date",value:X.endDate||"",onChange:j=>ee(W=>W?{...W,endDate:j.target.value||void 0}:null),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:border-purple-400 focus:outline-none",placeholder:""}),X.endDate&&c.jsx("button",{type:"button",onClick:()=>ee(j=>j?{...j,endDate:void 0}:null),className:"text-[10px] text-red-500 hover:underline mt-1",children:""})]}),c.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-100",children:[c.jsx("button",{type:"button",onClick:()=>{ee(null),Ie(!1)},className:"text-xs text-red-500 hover:text-red-600 font-medium",children:""}),c.jsx("button",{type:"button",onClick:()=>Ie(!1),className:"px-3 py-1 bg-purple-500 text-white text-xs font-medium rounded hover:bg-purple-600 transition-colors",children:""})]})]})]})]}),c.jsx(ko,{children:!te&&S&&c.jsxs(Lr.div,{initial:{height:0,opacity:0,marginTop:0},animate:{height:"auto",opacity:1,marginTop:0},exit:{height:0,opacity:0,marginTop:0},className:"overflow-hidden flex items-center gap-3 px-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Oi,{size:12,className:"text-theme-tertiary"}),c.jsxs("div",{className:"flex items-center bg-transparent border border-theme rounded-md px-2 py-0.5",children:[c.jsx("input",{ref:Y,type:"text",value:Te,onChange:j=>ck(j.target.value),onKeyDown:j=>{j.key==="Tab"?Vu(j):j.stopPropagation()},placeholder:"09:00",className:"bg-transparent border-none text-[11px] font-medium text-theme-primary focus:ring-0 outline-none p-0 w-12 placeholder:text-theme-tertiary"}),f.timeFormat==="12h"&&c.jsx("button",{onClick:()=>{const[j,W]=Te.split(" ");W&&ck(`${j} ${W==="AM"?"PM":"AM"}`)},className:"text-[10px] font-bold text-theme-tertiary hover:text-theme-secondary ml-1",children:Te.includes("PM")?"PM":"AM"})]}),c.jsx("span",{className:"text-theme-tertiary text-xs",children:""}),c.jsxs("div",{className:"flex items-center bg-transparent border border-theme rounded-md px-2 py-0.5",children:[c.jsx("input",{ref:he,type:"text",value:Ye,onChange:j=>qR(j.target.value),onKeyDown:j=>{j.key==="Tab"?Vu(j):j.stopPropagation()},placeholder:"10:00",className:"bg-transparent border-none text-[11px] font-medium text-theme-primary focus:ring-0 outline-none p-0 w-12 placeholder:text-theme-tertiary"}),f.timeFormat==="12h"&&c.jsx("span",{className:"text-[9px] font-bold text-indigo-400 ml-1",children:(()=>{const j=Ye.split(":");if(j.length!==2)return"";const W=parseInt(j[0]),ae=parseInt(j[1]);return isNaN(W)||isNaN(ae)?"":`${W%12||12}:${String(ae).padStart(2,"0")}${W<12?"AM":"PM"}`})()})]})]}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsxs("div",{className:"relative",children:[c.jsx("input",{ref:De,type:"text",placeholder:"",value:lt,onChange:j=>YR(j.target.value),onKeyDown:j=>{j.key==="Tab"?Vu(j):j.stopPropagation()},className:"w-14 bg-transparent border border-theme rounded-md px-2 py-0.5 text-[11px] font-medium text-theme-primary focus:ring-1 focus:ring-indigo-100 outline-none placeholder:text-theme-tertiary"}),c.jsx("span",{className:"absolute right-2 top-1.5 text-[8px] text-gray-400 font-bold pointer-events-none",children:"MIN"})]})})]})}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"file",ref:Ue,className:"hidden",multiple:!0,accept:"image/*",onChange:cc}),c.jsxs("button",{type:"button",tabIndex:-1,onClick:()=>{var j;return(j=Ue.current)==null?void 0:j.click()},className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border border-transparent hover:border-theme hover:bg-theme-hover text-theme-tertiary hover:text-theme-secondary focus:outline-none focus:bg-white focus:ring-1 ${(yn==null?void 0:yn.buttonRing)||"focus:ring-indigo-300"} focus:border-theme text-xs ${f.fontWeight==="thin"?"font-light":"font-medium"}`,children:[et?c.jsx(xi,{size:13,className:"animate-spin"}):c.jsx(wf,{size:13}),c.jsx("span",{children:""})]}),c.jsx("input",{ref:Ze,type:"file",multiple:!0,className:"hidden",onChange:HR}),c.jsxs("button",{ref:xe,type:"button",tabIndex:-1,onClick:()=>{var j;return(j=Ze.current)==null?void 0:j.click()},className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border border-transparent hover:border-theme hover:bg-theme-hover text-theme-tertiary hover:text-theme-secondary focus:outline-none focus:bg-white focus:ring-1 ${(yn==null?void 0:yn.buttonRing)||"focus:ring-indigo-300"} focus:border-theme text-xs ${f.fontWeight==="thin"?"font-light":"font-medium"}`,children:[et?c.jsx(xi,{size:13,className:"animate-spin"}):c.jsx(go,{size:13}),c.jsx("span",{children:v("attachFiles")})]}),c.jsxs("button",{type:"button",tabIndex:-1,onMouseDown:j=>j.preventDefault(),onClick:()=>{cs?jo===(t==null?void 0:t.id)?il():g==null||g({msg:"",type:"warning"}):t!=null&&t.id?sl(t.id):g==null||g({msg:"",type:"warning"})},className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border border-transparent hover:border-theme hover:bg-theme-hover text-theme-tertiary hover:text-theme-secondary focus:outline-none focus:bg-theme-card focus:ring-1 ${(yn==null?void 0:yn.buttonRing)||"focus:ring-indigo-300"} focus:border-theme text-xs ${f.fontWeight==="thin"?"font-light":"font-medium"} ${cs&&jo===(t==null?void 0:t.id)?"text-red-500 animate-pulse":""}`,title:cs?"":"",children:[c.jsx(LI,{size:13,strokeWidth:cs&&jo===(t==null?void 0:t.id)?3:2}),c.jsx("span",{children:cs&&jo===(t==null?void 0:t.id)?Io(ks):""})]}),c.jsx(M1,{tabIndex:-1,icon:yp,label:"",items:Fn,allowAdd:!0,selectedIds:R?[R]:[],placeholder:"...",theme:yn,onSelect:async(j,W)=>{let ae=j;if(!ae&&W&&(ae=await s({title:W,is_project:!0,status:"inbox"})),!ae&&!j)return;const ke=ae===R?null:ae;Ee(ke),t&&(ke&&h(ke,!0),await i(t.id,{parent_id:ke},[]))}})]}),!R&&c.jsxs("div",{className:"relative",children:[c.jsxs("button",{type:"button",onClick:()=>Oe(!fe),className:"flex items-center gap-1.5 px-2 py-1.5 rounded-md border border-transparent hover:border-theme hover:bg-theme-hover transition-all group",title:"",children:[c.jsx("div",{className:`w-3 h-3 rounded-full ${((hk=Qn[We])==null?void 0:hk.dot)||"bg-gray-400"} group-hover:scale-110 transition-transform`}),c.jsx("span",{className:"text-xs text-theme-tertiary group-hover:text-theme-secondary",children:""})]}),fe&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>Oe(!1)}),c.jsxs("div",{className:"absolute bottom-full left-0 mb-2 p-3 bg-white rounded-xl shadow-xl border border-gray-200 z-50 min-w-[200px] animate-in zoom-in-95 duration-100",children:[c.jsxs("div",{className:"text-xs font-semibold text-gray-500 mb-2 px-1 flex items-center gap-2",children:[c.jsx(jw,{size:12}),""]}),c.jsx("div",{className:"grid grid-cols-6 gap-2",children:Object.keys(Qn).map(j=>c.jsx("button",{type:"button",onClick:()=>{ut(j),Oe(!1)},className:`w-5 h-5 rounded-full ${Qn[j].dot} ${We===j?"ring-2 ring-offset-2 ring-gray-400 scale-110":"hover:scale-125 opacity-80 hover:opacity-100"} transition-all shadow-sm`,title:j},j))})]})]})]}),c.jsx("div",{className:"flex gap-1 p-1 bg-theme-hover rounded-lg border border-theme",title:"",children:[{level:"urgent",color:"bg-red-500",label:"",icon:""},{level:"planned",color:"bg-yellow-400",label:"",icon:""},{level:"delegated",color:"bg-green-500",label:"",icon:""},{level:"optional",color:"bg-gray-400",label:"",icon:""}].map(({level:j,color:W,label:ae})=>c.jsx("button",{tabIndex:-1,type:"button",onClick:()=>je(oe===j?void 0:j),title:ae,className:`w-4 h-4 rounded-full ${W} ${oe===j?"ring-2 ring-offset-1 ring-gray-500 scale-110":"opacity-50 hover:opacity-100 hover:scale-105"} transition-all`},j))})]})]})]})]})]}),It&&c.jsx("div",{className:"fixed inset-0 z-[100] bg-black/90 flex items-center justify-center p-4",onClick:()=>ue(null),children:c.jsxs("div",{className:"relative max-w-full max-h-full",onClick:j=>j.stopPropagation(),children:[c.jsx("img",{src:It,alt:"Preview",className:"max-w-full max-h-[90vh] rounded-lg shadow-2xl"}),c.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[c.jsx("a",{href:It,download:`attachment-${Date.now()}`,target:"_blank",rel:"noopener noreferrer",onClick:j=>j.stopPropagation(),className:"p-2 bg-black/50 hover:bg-black/70 text-white rounded-full backdrop-blur-sm transition-colors",title:"Download",children:c.jsx(iu,{size:20})}),c.jsx("button",{onClick:()=>ue(null),className:"p-2 bg-black/50 hover:bg-black/70 text-white rounded-full backdrop-blur-sm transition-colors",children:c.jsx(hn,{size:20})})]})]})}),rn.isOpen&&c.jsx("div",{className:"fixed inset-0 z-[150] flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm",onClick:()=>vn({...rn,isOpen:!1}),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 max-w-lg w-full animate-in zoom-in duration-200",onClick:j=>j.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[c.jsx(Rs,{size:18,className:"text-indigo-500"}),c.jsx("span",{children:v("aiPolishSuggestions")})]}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("button",{onClick:Un,disabled:rn.historyIndex<=0,className:"p-1.5 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors disabled:opacity-30 disabled:hover:bg-transparent disabled:hover:text-gray-500",title:v("undo"),children:c.jsx(Dg,{size:16})}),c.jsx("button",{onClick:wr,disabled:rn.historyIndex>=rn.history.length-1,className:"p-1.5 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors disabled:opacity-30 disabled:hover:bg-transparent disabled:hover:text-gray-500",title:v("redo"),children:c.jsx(Mw,{size:16})})]})]}),c.jsxs("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2",children:v("suggestedTitle")}),c.jsx("input",{className:"w-full p-2 mb-3 bg-white border border-gray-200 rounded-lg text-sm text-gray-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none shadow-sm transition-all font-medium",value:rn.title,onChange:j=>On(j.target.value),onKeyDown:j=>{(j.ctrlKey||j.metaKey)&&j.key==="z"?(j.preventDefault(),j.stopPropagation(),j.shiftKey?wr():Un()):(j.ctrlKey||j.metaKey)&&j.key==="y"&&(j.preventDefault(),j.stopPropagation(),wr())}}),c.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2",children:v("suggestedContent")}),c.jsx("textarea",{className:"w-full h-40 p-3 bg-white border border-gray-200 rounded-lg text-sm text-gray-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none resize-none leading-relaxed shadow-sm transition-all",value:rn.content,onChange:j=>hi(j.target.value),onKeyDown:j=>{(j.ctrlKey||j.metaKey)&&j.key==="z"?(j.preventDefault(),j.stopPropagation(),j.shiftKey?wr():Un()):(j.ctrlKey||j.metaKey)&&j.key==="y"&&(j.preventDefault(),j.stopPropagation(),wr())}})]}),c.jsxs("div",{className:"flex gap-3 justify-end",children:[c.jsx("button",{onClick:()=>vn({...rn,isOpen:!1}),className:"px-4 py-1.5 text-gray-600 hover:bg-gray-100 rounded text-sm font-medium transition-colors",children:v("cancel")}),c.jsxs("button",{onClick:()=>{D(rn.title),A(rn.content),vn({...rn,isOpen:!1,history:[],historyIndex:-1}),g({msg:v("aiPolishApplied"),type:"info"})},className:"px-4 py-1.5 bg-[#2563EB] hover:bg-[#1d4ed8] text-white rounded text-sm font-medium shadow-sm transition-colors flex items-center gap-1.5",children:[c.jsx(Zn,{size:14,strokeWidth:3}),v("confirmReplace")]})]})]})})]})},Eee=["gray","blue","indigo","red","orange","amber","green","teal","cyan","sky","purple","fuchsia","pink","rose"],oE={gray:"bg-gray-400",blue:"bg-blue-500",indigo:"bg-indigo-500",red:"bg-red-500",orange:"bg-orange-500",amber:"bg-amber-500",green:"bg-green-500",teal:"bg-teal-500",cyan:"bg-cyan-500",sky:"bg-sky-500",purple:"bg-purple-500",fuchsia:"bg-fuchsia-500",pink:"bg-pink-500",rose:"bg-rose-500"},aE=({text:t,query:e})=>{if(!e.trim()||!t)return c.jsx(c.Fragment,{children:t});try{const n=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp(`(${n})`,"gi"),s=t.split(r);return c.jsx(c.Fragment,{children:s.map((i,o)=>i.toLowerCase()===e.toLowerCase()?c.jsx("mark",{className:"bg-yellow-200 text-yellow-900 px-0.5 rounded",children:i},o):c.jsx("span",{children:i},o))})}catch{return c.jsx(c.Fragment,{children:t})}},Nee=({isOpen:t,onClose:e})=>{const{tasks:n,tags:r,searchHistory:s,addSearchHistory:i,deleteSearchHistory:o,setEditingTaskId:a,editingTaskId:l,navigateToTask:u,verifyTaskPassword:d,temporarilyUnlockTask:f,setToast:h}=x.useContext(jn),[p,m]=x.useState(""),[y,b]=x.useState({tags:[],startDate:null,endDate:null,colors:[]}),[g,v]=x.useState("or"),[w,_]=x.useState(""),[D,k]=x.useState(!1),[A,N]=x.useState(""),[E,S]=x.useState(!1),T=x.useRef(null),[C,O]=x.useState(!1),[P,H]=x.useState(""),[M,I]=x.useState(null),[K,G]=x.useState(null);x.useEffect(()=>{t&&T.current&&T.current.focus()},[t]);const R=x.useMemo(()=>!p.trim()&&y.tags.length===0&&!y.startDate&&!y.endDate&&y.colors.length===0?[]:n.filter(oe=>{if(oe.status==="deleted")return!1;const je=p.toLowerCase(),te=!p.trim()||oe.title.toLowerCase().includes(je)||oe.description&&oe.description.toLowerCase().includes(je);let $e=!0;if(y.tags.length>0){const Ye=oe.tags||[];g==="and"?$e=y.tags.every(Ke=>Ye.includes(Ke)):$e=y.tags.some(Ke=>Ye.includes(Ke))}let Te=!0;if(y.startDate||y.endDate){const Ye=oe.start_date||oe.due_date;if(!Ye)Te=!1;else{const Ke=St=>{const X=new Date(St);return isNaN(X.getTime())?NaN:X.setHours(0,0,0,0)},lt=Ke(Ye);if(isNaN(lt))Te=!1;else{if(y.startDate){const St=Ke(y.startDate);!isNaN(St)&&lt<St&&(Te=!1)}if(y.endDate){const St=Ke(y.endDate);!isNaN(St)&&lt>St&&(Te=!1)}}}}const Je=y.colors.length===0||y.colors.includes(oe.color);return te&&$e&&Te&&Je}),[n,p,y,g]),Ee=()=>{(p.trim()||y.tags.length>0||y.startDate||y.endDate||y.colors.length>0)&&i(p,y)},ge=()=>{A.trim()&&(i(p,y,A.trim()),N(""),S(!1))},F=oe=>{m(oe.query),b(oe.filters)},B=oe=>{b(je=>({...je,tags:je.tags.includes(oe)?je.tags.filter(te=>te!==oe):[...je.tags,oe]}))},se=oe=>{b(je=>({...je,colors:je.colors.includes(oe)?je.colors.filter(te=>te!==oe):[...je.colors,oe]}))},We=()=>{b({tags:[],startDate:null,endDate:null,colors:[]})},ut=y.tags.length>0||y.startDate||y.endDate||y.colors.length>0;return x.useEffect(()=>{if(!t)return;const oe=je=>{var te,$e,Te;if(je.key===" "&&((te=document.activeElement)!=null&&te.closest("[data-search-modal]"))&&(($e=document.activeElement)==null?void 0:$e.tagName)!=="INPUT"&&((Te=document.activeElement)==null?void 0:Te.tagName)!=="TEXTAREA"&&je.stopPropagation(),je.key==="Escape"){if(l)return;e()}};return window.addEventListener("keydown",oe,!0),()=>window.removeEventListener("keydown",oe,!0)},[t,e,l]),t?c.jsxs(c.Fragment,{children:[or.createPortal(c.jsx(ko,{children:c.jsx(Lr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-start justify-center pt-20",onClick:e,"data-search-modal":!0,children:c.jsxs(Lr.div,{initial:{opacity:0,scale:.95,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20},transition:{duration:.2},className:"w-full max-w-2xl bg-theme-card rounded-2xl shadow-2xl overflow-hidden",onClick:oe=>oe.stopPropagation(),children:[c.jsxs("div",{className:"p-4 border-b border-theme",children:[c.jsxs("div",{className:"flex items-center gap-3 bg-theme-hover rounded-xl px-4 py-3",children:[c.jsx(Hc,{size:20,className:"text-theme-tertiary"}),c.jsx("input",{ref:T,type:"text",value:p,onChange:oe=>m(oe.target.value),onKeyDown:oe=>{oe.key==="Enter"&&Ee()},placeholder:"...",className:"flex-1 bg-transparent outline-none text-theme-primary placeholder-theme-tertiary"}),p&&c.jsx("button",{onClick:()=>m(""),className:"text-theme-tertiary hover:text-theme-primary",children:c.jsx(hn,{size:18})})]}),c.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[c.jsxs("button",{onClick:()=>k(!D),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors ${D||ut?"bg-indigo-100 text-indigo-700":"bg-theme-hover text-theme-secondary hover:bg-theme-hover/80"}`,children:[D?c.jsx(rs,{size:14}):c.jsx(is,{size:14}),"",ut&&c.jsx("span",{className:"ml-1 w-5 h-5 bg-indigo-500 text-white rounded-full flex items-center justify-center text-[10px]",children:y.tags.length+(y.startDate||y.endDate?1:0)+y.colors.length})]}),c.jsxs("button",{onClick:()=>{m(""),b({tags:[],startDate:null,endDate:null,colors:[]})},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium bg-theme-hover text-theme-secondary hover:bg-theme-hover/80 transition-colors",children:[c.jsx(Oi,{size:14}),"",s.length>0&&c.jsx("span",{className:"ml-1 w-5 h-5 bg-gray-500 text-white rounded-full flex items-center justify-center text-[10px]",children:s.length})]}),ut&&c.jsx("button",{onClick:We,className:"text-xs text-theme-tertiary hover:text-theme-primary",children:""})]}),c.jsx(ko,{children:D&&c.jsxs(Lr.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-3 space-y-4 overflow-hidden",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary",children:[c.jsx(Ll,{size:12}),"",y.tags.length>0&&c.jsx("span",{className:"px-1.5 py-0.5 bg-indigo-100 text-indigo-600 rounded-full text-[10px]",children:y.tags.length})]}),y.tags.length>1&&c.jsxs("div",{className:"flex items-center bg-theme-hover rounded-lg p-0.5",children:[c.jsx("button",{onClick:()=>v("or"),className:`px-2 py-0.5 text-[10px] font-bold rounded-md transition-all ${g==="or"?"bg-theme-card text-indigo-600 shadow-sm":"text-theme-tertiary"}`,children:" OR"}),c.jsx("button",{onClick:()=>v("and"),className:`px-2 py-0.5 text-[10px] font-bold rounded-md transition-all ${g==="and"?"bg-theme-card text-indigo-600 shadow-sm":"text-theme-tertiary"}`,children:" AND"})]})]}),c.jsxs("div",{className:"relative mb-2",children:[c.jsx("input",{type:"text",value:w,onChange:oe=>_(oe.target.value),placeholder:"...",className:"w-full px-3 py-1.5 bg-theme-hover rounded-lg text-xs border-0 focus:ring-2 focus:ring-indigo-500 pl-8 text-theme-primary"}),c.jsx(Hc,{size:12,className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-theme-tertiary"})]}),y.tags.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1.5 mb-2 p-2 bg-indigo-50 rounded-lg",children:y.tags.map(oe=>{const je=r.find(te=>te.id===oe);return je?c.jsxs("button",{onClick:()=>B(je.id),className:"flex items-center gap-1.5 px-2 py-1 bg-indigo-500 text-white rounded-full text-xs font-medium hover:bg-indigo-600 transition-colors",children:[c.jsx("span",{children:je.name}),c.jsx(hn,{size:10})]},je.id):null})}),c.jsxs("div",{className:"max-h-32 overflow-y-auto",children:[c.jsx("div",{className:"grid grid-cols-3 gap-1",children:r.filter(oe=>!y.tags.includes(oe.id)).filter(oe=>!w||oe.name.toLowerCase().includes(w.toLowerCase())).map(oe=>c.jsxs("button",{onClick:()=>B(oe.id),className:"flex items-center gap-1.5 px-2 py-1.5 bg-theme-hover hover:bg-theme-hover/80 rounded-lg text-xs text-theme-secondary transition-colors text-left",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-400 flex-shrink-0"}),c.jsx("span",{className:"truncate",children:oe.name})]},oe.id))}),r.filter(oe=>!y.tags.includes(oe.id)).filter(oe=>!w||oe.name.toLowerCase().includes(w.toLowerCase())).length===0&&c.jsx("div",{className:"text-center text-xs text-theme-tertiary py-2",children:""})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary",children:[c.jsx(So,{size:12}),"",(y.startDate||y.endDate)&&c.jsx("span",{className:"px-1.5 py-0.5 bg-indigo-100 text-indigo-600 rounded-full text-[10px]",children:""})]}),(y.startDate||y.endDate)&&c.jsxs("button",{onClick:()=>b(oe=>({...oe,startDate:null,endDate:null})),className:"text-[10px] text-red-500 hover:text-red-600 flex items-center gap-1 z-10",children:[c.jsx(hn,{size:10}),""]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"date",value:y.startDate||"",onChange:oe=>b(je=>({...je,startDate:oe.target.value||null})),className:"px-3 py-1.5 rounded-lg bg-theme-hover text-xs border-0 focus:ring-2 focus:ring-indigo-500 text-theme-primary"}),c.jsx("span",{className:"text-theme-tertiary",children:""}),c.jsx("input",{type:"date",value:y.endDate||"",onChange:oe=>b(je=>({...je,endDate:oe.target.value||null})),className:"px-3 py-1.5 rounded-lg bg-theme-hover text-xs border-0 focus:ring-2 focus:ring-indigo-500 text-theme-primary"}),(y.startDate||y.endDate)&&c.jsx("button",{onClick:()=>b(oe=>({...oe,startDate:null,endDate:null})),className:"p-1.5 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-colors",title:"",children:c.jsx(hn,{size:14})})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary mb-2",children:[c.jsx(jw,{size:12}),""]}),c.jsx("div",{className:"flex flex-wrap gap-2",children:Eee.map(oe=>c.jsx("button",{onClick:()=>se(oe),className:`w-6 h-6 rounded-full ${oE[oe]} transition-transform ${y.colors.includes(oe)?"ring-2 ring-offset-2 ring-indigo-500 scale-110":"hover:scale-110"}`},oe))})]})]})})]}),c.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:R.length>0?c.jsxs("div",{className:"p-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("span",{className:"text-xs font-medium text-theme-secondary",children:[" ",R.length," "]}),E?c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"text",value:A,onChange:oe=>N(oe.target.value),placeholder:"...",className:"px-2 py-1 text-xs border rounded-lg w-32 bg-theme-hover text-theme-primary border-theme",autoFocus:!0}),c.jsx("button",{onClick:ge,className:"p-1 text-green-600 hover:text-green-700",children:c.jsx(Zn,{size:14})}),c.jsx("button",{onClick:()=>{S(!1),N("")},className:"p-1 text-theme-tertiary hover:text-theme-primary",children:c.jsx(hn,{size:14})})]}):c.jsxs("button",{onClick:()=>S(!0),className:"flex items-center gap-1 text-xs text-indigo-600 hover:text-indigo-700",children:[c.jsx(UI,{size:12}),""]})]}),c.jsx("div",{className:"space-y-1",children:R.map(oe=>{const je=oe.start_date||oe.due_date,te=je?new Date(je).toLocaleDateString("zh-TW",{year:"numeric",month:"short",day:"numeric"}):null,$e=l===oe.id,Te=!!oe.is_locked,Je=Te&&!oe.lock_password,Ye=lt=>{lt.stopPropagation(),Te?(I(oe.id),G("edit"),H(""),O(!0)):a(oe.id)},Ke=lt=>{lt==null||lt.stopPropagation(),Te?(I(oe.id),G("navigate"),H(""),O(!0)):(a(null),u(oe.id,!0),e())};return c.jsx("div",{className:"rounded-xl hover:bg-theme-hover transition-colors border border-transparent hover:border-theme",children:$e?c.jsx("div",{onClick:lt=>lt.stopPropagation(),onMouseDown:lt=>lt.stopPropagation(),children:c.jsx(Fo,{initialData:oe,onClose:()=>a(null)})}):c.jsx("div",{className:"p-3",children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("div",{className:`w-3 h-3 rounded-full mt-1 flex-shrink-0 ${oE[oe.color]}`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:`font-medium text-theme-primary flex items-center gap-1.5 ${Je?"blur-[4px] select-none":""}`,children:[Te&&c.jsx(Pa,{size:12,className:"text-amber-500 flex-shrink-0"}),c.jsx(aE,{text:oe.title,query:p})]}),oe.description&&!Je&&c.jsx("div",{className:"text-sm text-theme-secondary mt-1 max-h-20 overflow-y-auto",children:c.jsx(aE,{text:oe.description.replace(/<[^>]*>/g,""),query:p})}),oe.tags.length>0&&!Je&&c.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:oe.tags.map(lt=>{const St=r.find(X=>X.id===lt);return St?c.jsx("span",{className:"px-2 py-0.5 bg-theme-hover text-theme-secondary rounded-full text-[10px]",children:St.name},lt):null})})]}),c.jsxs("div",{className:"flex flex-col items-end gap-1 flex-shrink-0",children:[te&&c.jsx("span",{className:"text-xs text-theme-tertiary",children:te}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:Ye,className:"p-1 text-theme-tertiary hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors",title:Te?"":"",children:c.jsx(Zn,{size:14})}),c.jsx("button",{onClick:Ke,className:"p-1 text-theme-tertiary hover:text-emerald-600 hover:bg-emerald-50 rounded transition-colors",title:Te?"":"",children:c.jsx(II,{size:14})})]})]})]})})},oe.id)})})]}):p||ut?c.jsxs("div",{className:"p-8 text-center text-theme-tertiary",children:[c.jsx(Hc,{size:32,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{children:""})]}):s.length>0?c.jsxs("div",{className:"p-4",children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary mb-3",children:[c.jsx(Oi,{size:12}),""]}),c.jsx("div",{className:"space-y-1",children:s.map(oe=>c.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-theme-hover group",children:[c.jsxs("button",{onClick:()=>F(oe),className:"flex-1 text-left",children:[c.jsx("div",{className:"font-medium text-theme-primary text-sm",children:oe.name||oe.query||"()"}),c.jsxs("div",{className:"text-xs text-theme-tertiary mt-0.5",children:[new Date(oe.created_at).toLocaleDateString(),oe.filters.tags.length>0&&`  ${oe.filters.tags.length} `,oe.filters.colors.length>0&&`  ${oe.filters.colors.length} `]})]}),c.jsx("button",{onClick:()=>o(oe.id),className:"p-1 text-theme-tertiary hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:c.jsx(jr,{size:14})})]},oe.id))})]}):c.jsxs("div",{className:"p-8 text-center text-theme-tertiary",children:[c.jsx(Hc,{size:32,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{children:""})]})}),c.jsx("div",{className:"p-3 border-t border-theme bg-theme-hover flex justify-between items-center text-xs text-theme-tertiary",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("span",{children:[c.jsx("kbd",{className:"px-1.5 py-0.5 bg-theme-card border border-theme rounded text-theme-primary",children:"Enter"})," "]}),c.jsxs("span",{children:[c.jsx("kbd",{className:"px-1.5 py-0.5 bg-theme-card border border-theme rounded text-theme-primary",children:"Esc"})," "]})]})})]})})}),document.body),C&&or.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999]",onClick:()=>{O(!1),I(null),G(null)},children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-80 max-w-[90vw]",onClick:oe=>oe.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[c.jsx(Pa,{size:20,className:"text-amber-500"}),c.jsx("h3",{className:"text-lg font-bold",children:""})]}),c.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["",K==="edit"?"":"",""]}),c.jsx("input",{type:"password",placeholder:"",value:P,onChange:oe=>H(oe.target.value),onKeyDown:oe=>{oe.key==="Enter"&&M&&(d(M,P)?(f(M),K==="edit"?a(M):(a(null),u(M,!0),e()),O(!1),I(null),G(null)):h({msg:"",type:"error"})),oe.key==="Escape"&&(O(!1),I(null),G(null))},autoFocus:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-amber-500"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:()=>{O(!1),I(null),G(null)},className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:""}),c.jsx("button",{onClick:()=>{M&&(d(M,P)?(f(M),K==="edit"?a(M):(a(null),u(M,!0),e()),O(!1),I(null),G(null)):h({msg:"",type:"error"}))},className:"flex-1 px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors",children:""})]})]})}),document.body)]}):null},jee=({current:t,total:e})=>{const n=e>0?Math.round(t/e*100):0;return or.createPortal(c.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm",children:c.jsxs("div",{className:"bg-[#1e1e1e] p-6 rounded-xl shadow-2xl w-80 border border-white/10 text-center",children:[c.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Importing Calendar..."}),c.jsx("div",{className:"w-full bg-gray-700 h-2 rounded-full mb-2 overflow-hidden",children:c.jsx("div",{className:"bg-indigo-500 h-full transition-all duration-200",style:{width:`${n}%`}})}),c.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-2",children:[c.jsxs("span",{children:[t," / ",e]}),c.jsxs("span",{children:[n,"%"]})]})]})}),document.body)},Iee=["#6366f1","#f43f5e","#10b981","#f59e0b","#64748b"],Mee=({id:t,label:e,active:n,overdueCount:r,normalCount:s,icon:i,color:o,acceptsDrop:a,isEditing:l,editingViewName:u,setEditingViewName:d,setEditingViewId:f,saveViewName:h,setHoveredDropTarget:p,sidebarCollapsed:m,sidebarTextClass:y,sidebarFontClass:b,setView:g,setTagFilter:v,onEditFilter:w})=>{const{dragState:_,updateGhostPosition:D,endDrag:k,selectedTaskIds:A,moveTaskToView:N}=x.useContext(jn),E=o||(n?"var(--accent-color)":void 0),S=x.useRef(!1),[T,C]=x.useState(!1),O=M=>{a&&(M.preventDefault(),M.stopPropagation(),S.current||(S.current=!0,C(!0),p(t)),D(M.clientX,M.clientY))},P=M=>{M.preventDefault(),S.current=!1,C(!1),p(null)},H=async M=>{if(M.preventDefault(),M.stopPropagation(),S.current=!1,C(!1),p(null),!a){k();return}const I=A.length>0?A:_!=null&&_.draggedId?[_.draggedId]:[];I.length>0&&await N(I,t),k()};return c.jsx("div",{className:`relative group/nav-wrapper transition-all ${T?"ring-2 ring-indigo-500 ring-inset rounded-lg bg-indigo-50 dark:bg-indigo-900/40":""}`,onDragOver:O,onDragLeave:P,onDrop:H,children:c.jsxs("button",{onClick:()=>{!l&&g&&(g(t),v&&v(null))},onDoubleClick:M=>{M.stopPropagation(),w&&w(t)},style:{pointerEvents:a&&(_!=null&&_.isDragging)?"none":"auto"},className:`w-full flex items-center ${m?"justify-center px-1":"justify-between px-3"} py-3 md:py-1 rounded-lg mb-1 md:mb-0 transition-colors touch-manipulation ${y} ${b} ${n?"bg-theme-hover text-theme-primary font-bold":"text-theme-secondary font-medium hover:bg-theme-hover hover:text-theme-primary active:bg-theme-hover"}`,title:m?e:"",children:[c.jsxs("div",{className:`flex items-center gap-2 ${m?"justify-center w-full":""}`,children:[i&&c.jsx(i,{size:16,style:{color:E},className:!o&&!n?"text-theme-tertiary":""}),!m&&(l?c.jsx("input",{autoFocus:!0,value:u,onChange:M=>d(M.target.value),onKeyDown:M=>{M.stopPropagation(),M.key==="Enter"?h(t,u):M.key==="Escape"&&f(null)},onBlur:()=>h(t,u),onClick:M=>M.stopPropagation(),className:"bg-theme-card border border-indigo-300 rounded px-1 py-0.5 text-xs outline-none focus:ring-1 focus:ring-indigo-500 w-20 text-theme-primary"}):c.jsx("span",{children:e}))]}),!m&&c.jsxs("div",{className:"flex gap-2 items-center",children:[r>0&&c.jsx("span",{className:"text-[11px] font-semibold text-white bg-rose-400 rounded-full px-3.5 py-0.5 min-w-[26px] text-center shadow-sm",children:r}),s>0&&(t==="matrix"?c.jsx("span",{className:"text-[11px] font-semibold text-white bg-yellow-400 rounded-full px-3.5 py-0.5 min-w-[26px] text-center shadow-sm",children:s}):c.jsx("span",{className:"text-[11px] text-gray-400 font-medium",children:s}))]})]})})},lE=({view:t,setView:e,tagFilter:n,setTagFilter:r})=>{const[s,i]=x.useState(null),{tasks:o,tags:a,themeSettings:l,setThemeSettings:u,deleteTag:d,updateTag:f,addTag:h,clearAllTasks:p,exportData:m,importData:y,syncGoogleToApp:b,expandedTags:g,setExpandedTags:v,sidebarCollapsed:w,toggleSidebar:_,tagsWithResolvedColors:D,t:k,language:A,setLanguage:N,setAdvancedFilters:E,viewTagFilters:S,updateViewTagFilter:T,visibleTasks:C,setFocusedTaskId:O,moveTaskToView:P,selectedTaskIds:H,dragState:M,updateGhostPosition:I,endDrag:K,addTask:G,batchAddTasks:R,updateTask:Ee,batchUpdateTasks:ge,setToast:F,deleteTask:B,batchDeleteTasks:se,batchImportTasks:We,user:ut,searchOpen:oe,setSearchOpen:je,lockedGoogleTagIds:te,toggleGoogleTagLock:$e}=x.useContext(jn),[Te,Je]=x.useState(!1),[Ye,Ke]=x.useState(null),[lt,St]=x.useState(null),[X,ee]=x.useState(""),[ie,ce]=x.useState(()=>{try{return JSON.parse(localStorage.getItem("custom_view_names")||"{}")}catch{return{}}}),[Z,ne]=x.useState(""),[Se,Ie]=x.useState(!1),[fe,Oe]=x.useState(null),[et,xt]=x.useState(""),It=x.useRef(null),[ue,Ne]=x.useState({provider:localStorage.getItem("ai_provider")||"gemini",googleKey:localStorage.getItem("google_ai_key")||"",openaiKey:localStorage.getItem("openai_api_key")||"",baseUrl:localStorage.getItem("ai_base_url")||"https://api.openai.com/v1",modelName:localStorage.getItem("ai_model")||"gpt-3.5-turbo"}),[Ue,Ze]=x.useState(null),[xe,ct]=x.useState(null),[dt,ft]=x.useState(null),[de,ve]=x.useState(""),[tt,st]=x.useState(null),[ht,Xe]=x.useState(null),[At,jt]=x.useState(()=>{const le=localStorage.getItem("sidebar_tags_expanded");return le!==null?le==="true":!0}),Q=x.useRef(null),me=x.useRef(null),[He,J]=x.useState(!1),[Pe,ze]=x.useState(localStorage.getItem("google_client_id")||""),[mt,Wt]=x.useState({start:new Date().toISOString().split("T")[0],end:new Date(new Date().setMonth(new Date().getMonth()+1)).toISOString().split("T")[0]}),[Dn,Ht]=x.useState("date"),[cn,pe]=x.useState([]),[q,ye]=x.useState(new Set),[Re,_e]=x.useState(null),it=x.useRef(null),Fe=x.useRef(null),gt=x.useRef(null);l1(it,()=>Je(!1)),l1(Fe,()=>st(null)),x.useEffect(()=>{const le=Et=>{Et.key==="Escape"&&Ye&&Ke(null)};return window.addEventListener("keydown",le),()=>window.removeEventListener("keydown",le)},[Ye]),x.useEffect(()=>{Ye&&ne(ie[Ye]||"")},[Ye,ie]);const Pt=async()=>{const le=o.filter(Vt=>Vt.tags.some(Lt=>{const dn=a.find(In=>In.id===Lt);return dn&&dn.name.startsWith("Google:")}));if(le.length===0){alert(A==="zh"?" Google ":"No Google Calendar tasks found to delete");return}if(!confirm(A==="zh"?` ${le.length}  Google 
( App  Google )`:`Delete ${le.length} Google Calendar tasks?
(This will only delete local tasks, NOT Google Calendar events)`))return;const Et=JSON.parse(localStorage.getItem("task_google_map")||"{}"),Bt=le.map(Vt=>Vt.id);Bt.forEach(Vt=>{delete Et[Vt]}),localStorage.setItem("task_google_map",JSON.stringify(Et)),localStorage.removeItem("google_sync_tokens"),await se(Bt,!0),F({msg:` ${le.length}  Google `,type:"success"}),Je(!1)};x.useEffect(()=>{const le=Et=>{(Et.metaKey||Et.ctrlKey)&&Et.shiftKey&&(Et.key==="f"||Et.key==="F"||Et.key==="s"||Et.key==="S")&&(Et.preventDefault(),Et.stopPropagation(),je(!0)),Et.key==="Escape"&&(tt?st(null):oe&&je(!1))};return window.addEventListener("keydown",le),()=>window.removeEventListener("keydown",le)},[oe,tt]),x.useEffect(()=>{Se&&It.current&&It.current.focus(),dt?gt.current=dt:gt.current&&setTimeout(()=>{const le=document.querySelector(`[data-tag-id="${gt.current}"]`);le&&le.focus(),gt.current=null},50)},[Se,dt]);const Ft=async()=>{if(!Pe.trim()){alert(A==="zh"?" Settings  Google Client ID":"Please set Google Client ID in settings"),Je(!0);return}localStorage.setItem("google_client_id",Pe.trim());try{await wI(),me.current||(me.current=window.google.accounts.oauth2.initTokenClient({client_id:Pe,scope:"https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar.readonly",callback:async le=>{if(le.error){console.error(le);return}await Kt(le.access_token)}})),Ht("date"),J(!0)}catch{alert("Failed to load Google Sign-In script")}},Ut=()=>{me.current&&me.current.requestAccessToken({prompt:""})},Kt=async le=>{_e(le),localStorage.setItem("google_access_token",le);try{const Et=await wl(le);pe(Et);const Bt=Et.find(Vt=>Vt.primary);Bt&&ye(new Set([Bt.id])),Ht("select")}catch(Et){alert("Failed to fetch calendars: "+Et),J(!1)}},Zt=async()=>{var le,Et;if(Re){J(!1);try{i({current:0,total:0,importing:!0});let Bt=[],Vt=[];const Lt=A==="zh"?"":"Schedule";let dn=(le=a.find(Cn=>Cn.name.toLowerCase()==="schedule"||Cn.name===""))==null?void 0:le.id;dn||(dn=await h(Lt,null));for(const Cn of Array.from(q)){const Sn=cn.find(On=>On.id===Cn),Yn=`Google:${(Sn==null?void 0:Sn.summary)||"Calendar"}`;let cr=(Et=a.find(On=>On.name===Yn))==null?void 0:Et.id;cr||(cr=await h(Yn,null));const Li=await vI(Re,Cn,mt.start,mt.end),hi=JSON.parse(localStorage.getItem("task_google_map")||"{}");Li.forEach(On=>{const Un=!On.start.dateTime;let wr=On.start.date,$=null,z=null;if(!Un&&On.start.dateTime){const Y=new Date(On.start.dateTime),he=Y.getFullYear(),De=String(Y.getMonth()+1).padStart(2,"0"),Be=String(Y.getDate()).padStart(2,"0");wr=`${he}-${De}-${Be}`;const Qe=String(Y.getHours()).padStart(2,"0"),ot=String(Y.getMinutes()).padStart(2,"0");if($=`${Qe}:${ot}`,On.end.dateTime){const _t=new Date(On.end.dateTime),at=String(_t.getHours()).padStart(2,"0"),wt=String(_t.getMinutes()).padStart(2,"0");z=`${at}:${wt}`}}else wr=On.start.date;const L={title:On.summary||"(No Title)",description:On.description||"",status:"active",tags:[dn,cr].filter(Boolean),start_date:wr,start_time:$,end_time:z,is_all_day:Un,color:"blue",google_event_id:On.id,google_calendar_id:Cn},V=Object.keys(hi).find(Y=>hi[Y].evtId===On.id);let U=V?o.find(Y=>Y.id===V):null;U||(U=o.find(Y=>Y.title===(On.summary||"(No Title)")&&Y.start_date===wr&&!Object.keys(hi).includes(Y.id))),U?Vt.push({id:U.id,data:L}):Bt.push(L)})}const In=Bt.length+Vt.length;R&&Bt.length>0&&await R(Bt,null,(Cn,Sn)=>i({current:Cn,total:In,importing:!0})),ge&&Vt.length>0&&await ge(Vt);const lr=cn.filter(Cn=>!q.has(Cn.id));let zn=0;for(const Cn of lr){const Sn=`Google:${Cn.summary}`,Yn=a.find(cr=>cr.name===Sn);Yn&&(await d(Yn.id),zn++,console.log(`[Import] Removed tag for unselected calendar: ${Sn}`))}if(F){let Cn=`Synced ${In} events (Added: ${Bt.length}, Updated: ${Vt.length})`;zn>0&&(Cn+=`. Stopped sync for ${zn} unselected calendars.`),F({msg:Cn,type:"info"})}In===0&&alert("No events found")}catch(Bt){console.error(Bt),alert("Import Error: "+Bt.message)}finally{i(null)}}},nn=async(le,Et=null)=>{le==null||le.preventDefault(),et.trim()?(await h(et.trim(),Et),xt(""),Ie(!1),Oe(null),Et&&!g.includes(Et)&&v(Bt=>[...Bt,Et])):(Ie(!1),Oe(null))},rn=x.useMemo(()=>{const le=["prompt",""],Et=["journal","note","",""],Bt=["someday","inspiration","","/"],Vt=["note","journal","",""],Lt=["project",""],dn=["schedule",""],In=a.find(L=>le.some(V=>L.name.trim().toLowerCase()===V)),lr=a.find(L=>Et.some(V=>L.name.trim().toLowerCase()===V)),zn=a.find(L=>Bt.some(V=>L.name.trim().toLowerCase()===V)),Cn=a.find(L=>Vt.some(V=>L.name.trim().toLowerCase()===V)),Sn=a.find(L=>Lt.some(V=>L.name.trim().toLowerCase()===V)),Yn=a.find(L=>L.name==="#prompt"),cr=a.find(L=>dn.some(V=>L.name.toLowerCase()===V)),Li=In==null?void 0:In.id,hi=lr==null?void 0:lr.id,On=zn==null?void 0:zn.id,Un=Cn==null?void 0:Cn.id,wr=Sn==null?void 0:Sn.id,$=Yn==null?void 0:Yn.id,z=cr==null?void 0:cr.id;return{inbox:o.filter(L=>{if(L.parent_id||L.status==="deleted"||L.status==="logged")return!1;if(!L.start_date&&!L.due_date&&(!L.tags||L.tags.length===0))return!0;const U=!!L.completed_at;return!(!(L.status==="inbox")&&!U||Li&&L.tags.includes(Li)||hi&&L.tags.includes(hi)||On&&L.tags.includes(On)||Un&&L.tags.includes(Un)||$&&L.tags.includes($)||wr&&L.tags.includes(wr)&&o.some(De=>De.parent_id===L.id&&De.status!=="deleted")||!U&&(L.start_date||L.due_date))}).length,todayOverdue:(()=>o.filter(L=>!(L.status==="completed"||L.status==="deleted"||L.status==="logged"||L.status==="waiting"||L.status==="someday"||!Zx(L.start_date||L.due_date)||z&&L.tags.includes(z)||Un&&L.tags.includes(Un)||wr&&L.tags.includes(wr))).length)(),todayScheduled:(()=>o.filter(L=>!(L.status==="completed"||L.status==="deleted"||L.status==="logged"||L.status==="waiting"||L.status==="someday"||Zx(L.start_date||L.due_date)||!Cw(L.start_date||L.due_date)||z&&L.tags.includes(z)||Un&&L.tags.includes(Un)||wr&&L.tags.includes(wr))).length)(),prompt:o.filter(L=>L.status!=="deleted"&&L.status!=="logged"&&Li&&L.tags.includes(Li)&&!L.reviewed_at).length,logbook:o.filter(L=>L.status==="logged"&&!L.reviewed_at).length,waiting:o.filter(L=>L.status==="deleted"||L.status==="logged"?!1:(L.status==="waiting"||On&&L.tags.includes(On))&&!L.reviewed_at).length,trash:o.filter(L=>L.status==="deleted").length,note:o.filter(L=>L.status==="deleted"||L.status==="logged"?!1:Un&&L.tags.includes(Un)).length,matrixUrgent:o.filter(L=>L.parent_id||L.status==="deleted"||L.status==="logged"||L.status==="completed"||z&&L.tags.includes(z)?!1:L.importance==="urgent").length,matrixPlanned:o.filter(L=>L.parent_id||L.status==="deleted"||L.status==="logged"||L.status==="completed"||z&&L.tags.includes(z)?!1:L.importance==="important").length}},[o,a]),vn={small:"text-xs",normal:"text-sm",large:"text-base"}[l.fontSize]||"text-sm",Gn={small:"text-xs",normal:"text-sm",large:"text-base"}[l.fontSize]||"text-sm",Gr=l.fontWeight==="thin"?"font-normal":"",ls=(le,Et)=>{const Bt={...ie,[le]:Et};ce(Bt),localStorage.setItem("custom_view_names",JSON.stringify(Bt)),St(null)},[xn,di]=x.useState(null),no=async le=>{if(console.log("[Sidebar Drop] hoveredDropTarget:",xn),!xn||!M.isDragging)return;le.preventDefault(),le.stopPropagation();const Et=H.length>0?H:M.draggedId?[M.draggedId]:[];console.log("[Sidebar Drop] Moving tasks:",Et,"to:",xn),Et.length>0&&await P(Et,xn),di(null),K()},cs=x.useMemo(()=>{const le=(Et,Bt)=>a.filter(Vt=>Vt.parent_id===Et).sort((Vt,Lt)=>(Vt.order_index||0)-(Lt.order_index||0)).map(Vt=>({id:Vt.id,name:Vt.name,depth:Bt,parent_id:Vt.parent_id,data:Vt,isExpanded:g.includes(Vt.id),children:le(Vt.id,Bt+1)}));return le(null,0)},[a,g]),sl=(le,Et)=>{Et.stopPropagation(),v(Bt=>Bt.includes(le)?Bt.filter(Vt=>Vt!==le):[...Bt,le])},il=(le,Et)=>{le.dataTransfer.setData("tag_id",Et),Ze(Et)},jo=(le,Et)=>{if(le.preventDefault(),Ue===Et)return;const Bt=le.currentTarget.getBoundingClientRect(),Vt=le.clientY-Bt.top,Lt=Bt.height;let dn="inside";Vt<Lt*.25?dn="top":Vt>Lt*.75&&(dn="bottom"),ct({id:Et,position:dn})},ks=async(le,Et)=>{le.preventDefault();const Bt=le.dataTransfer.getData("tag_id");if(!Bt||Bt===Et){ct(null),Ze(null);return}const Vt=a.find(zn=>zn.id===Bt),Lt=a.find(zn=>zn.id===Et);if(!Vt||!Lt)return;let dn=Lt;for(;dn.parent_id;){if(dn.parent_id===Bt){ct(null),Ze(null);return}const zn=a.find(Cn=>Cn.id===dn.parent_id);if(!zn)break;dn=zn}let In=Vt.parent_id,lr=Vt.order_index||0;if((xe==null?void 0:xe.position)==="inside")In=Et,lr=a.filter(Sn=>Sn.parent_id===Et).reduce((Sn,Yn)=>Math.max(Sn,Yn.order_index||0),0)+1e4,g.includes(Et)||v(Sn=>[...Sn,Et]);else{In=Lt.parent_id;const zn=a.filter(Sn=>Sn.parent_id===Lt.parent_id).sort((Sn,Yn)=>(Sn.order_index||0)-(Yn.order_index||0)),Cn=zn.findIndex(Sn=>Sn.id===Et);if((xe==null?void 0:xe.position)==="top"){const Sn=zn[Cn-1],Yn=(Sn==null?void 0:Sn.order_index)||0,cr=Lt.order_index||0;lr=Sn?(Yn+cr)/2:cr-1e4}else{const Sn=zn[Cn+1],Yn=(Sn==null?void 0:Sn.order_index)||0,cr=Lt.order_index||0;lr=Sn?(cr+Yn)/2:cr+1e4}}await f(Bt,{parent_id:In,order_index:lr}),ct(null),Ze(null)},Io=async le=>{n===le&&r(null),await d(le)},ol=le=>{ft(le.id),ve(le.name),st(null)},nr=async()=>{dt&&de.trim()&&(await f(dt,{name:de}),ft(null))},$r=()=>{localStorage.setItem("ai_provider",ue.provider),localStorage.setItem("google_ai_key",ue.googleKey.trim()),localStorage.setItem("openai_api_key",ue.openaiKey.trim()),localStorage.setItem("ai_base_url",ue.baseUrl.trim()),localStorage.setItem("ai_model",ue.modelName.trim()),alert("AI Settings Saved!")},qn=le=>{le.target.files&&le.target.files[0]&&(y(le.target.files[0]),Je(!1))},Pi=le=>{dt||(r(le),e("inbox"),E({additionalTags:[],startDate:null,dueDate:null,color:null}),O(null))},ac=(le,Et)=>{if(dt!==Et){if(le.key==="ArrowRight"){le.preventDefault();const Bt=a.find(Vt=>Vt.id===Et);Bt&&a.some(Vt=>Vt.parent_id===Et)&&(g.includes(Et)||v(Vt=>[...Vt,Bt.id]))}if(le.key==="ArrowLeft"){le.preventDefault();const Bt=a.find(Vt=>Vt.id===Et);if(Bt)g.includes(Et)&&v(Vt=>Vt.filter(Lt=>Lt!==Et));else if(Bt.parent_id){const Vt=document.querySelector(`[data-tag-id="${Bt.parent_id}"]`);Vt&&(Vt.focus(),Pi(Bt.parent_id))}}if(le.key==="ArrowDown"||le.key==="ArrowUp"){le.preventDefault();const Bt=Array.from(document.querySelectorAll("[data-tag-id]")),Vt=Bt.findIndex(lr=>lr.getAttribute("data-tag-id")===Et);if(Vt===-1)return;const Lt=le.key==="ArrowDown"?(Vt+1)%Bt.length:(Vt-1+Bt.length)%Bt.length,dn=Bt[Lt];dn.focus();const In=dn.getAttribute("data-tag-id");In&&Pi(In)}if(le.key==="Tab"&&(le.preventDefault(),C.length>0&&O(C[0].data.id)),le.key==="Enter"){le.preventDefault();const Bt=a.find(Vt=>Vt.id===Et);Bt&&ol(Bt)}if(le.key==="Delete"||le.key==="Backspace"){le.preventDefault(),le.stopPropagation();const Bt=Et;setTimeout(()=>{confirm(k("deleteTagConfirm"))&&Io(Bt)},10)}}},fi=le=>{const Et=(xe==null?void 0:xe.id)===le.id;let Bt="border-transparent";Et&&((xe==null?void 0:xe.position)==="top"?Bt="border-t-2 border-t-indigo-500":(xe==null?void 0:xe.position)==="bottom"?Bt="border-b-2 border-b-indigo-500":Bt="bg-indigo-50 ring-1 ring-indigo-500");const Vt=dt===le.id;return c.jsxs("div",{className:"relative",children:[c.jsxs("div",{"data-tag-id":le.id,draggable:!Vt,onDragStart:Lt=>il(Lt,le.id),onDragOver:Lt=>jo(Lt,le.id),onDrop:Lt=>ks(Lt,le.id),onDragLeave:()=>ct(null),className:`relative group flex items-center gap-0.5 py-0.5 rounded pr-1 transition-all select-none outline-none ${Gn} ${Gr} ${n===le.id?"bg-theme-hover text-indigo-600 font-bold":"text-theme-secondary font-medium hover:text-theme-primary hover:bg-theme-hover"} ${Bt} ${w?"justify-center pl-0":""}`,style:{paddingLeft:w?"0":`${le.depth*6+6}px`},onClick:()=>{Vt||Pi(le.id)},onDoubleClick:Lt=>{Lt.stopPropagation(),ol(le)},tabIndex:0,onKeyDown:Lt=>ac(Lt,le.id),children:[le.children.length>0?c.jsx("button",{onClick:Lt=>sl(le.id,Lt),className:"p-0 hover:bg-theme-hover rounded text-theme-tertiary",children:le.isExpanded?c.jsx(rs,{size:10}):c.jsx(is,{size:10})}):c.jsx("div",{className:"w-[10px]"}),Vt?c.jsxs("div",{className:"flex items-center flex-1 gap-1",children:[c.jsx("input",{autoFocus:!0,className:"flex-1 min-w-0 bg-theme-card border border-indigo-500/50 rounded px-1 py-0.5 text-xs outline-none focus:ring-1 focus:ring-indigo-500 text-theme-primary",value:de,onChange:Lt=>ve(Lt.target.value),onKeyDown:Lt=>{Lt.key==="Enter"?nr():Lt.key==="Escape"&&ft(null)},onClick:Lt=>Lt.stopPropagation()}),c.jsx("button",{onClick:Lt=>{Lt.stopPropagation(),nr()},className:"text-green-600 hover:bg-green-100 p-0.5 rounded",children:c.jsx(Zn,{size:12})}),c.jsx("button",{onClick:Lt=>{Lt.stopPropagation(),ft(null)},className:"text-red-500 hover:bg-red-100 p-0.5 rounded",children:c.jsx(hn,{size:12})})]}):c.jsxs(c.Fragment,{children:[!w&&c.jsxs("span",{className:"truncate flex-1 text-left flex items-center gap-1",style:D[le.id]?{color:D[le.id],opacity:.5}:void 0,children:[le.name.startsWith("#")?le.name.slice(1):le.name,le.name.startsWith("Google:")&&te.includes(le.id)&&c.jsx(Pa,{size:9,className:"text-amber-500 flex-shrink-0"})]}),!w&&c.jsxs("div",{className:"flex items-center opacity-0 group-hover:opacity-100 transition-opacity",children:[c.jsx("button",{onClick:Lt=>{Lt.stopPropagation(),Oe(le.id),xt(""),le.isExpanded||v(dn=>[...dn,le.id])},className:"p-0.5 hover:bg-gray-200 rounded text-gray-400",title:k("addSubTag"),children:c.jsx(ri,{size:10})}),c.jsx("button",{onMouseDown:Lt=>{Lt.stopPropagation()},onClick:Lt=>{Lt.stopPropagation();const dn=Lt.currentTarget.getBoundingClientRect(),In=180,lr=window.innerHeight,Cn=dn.bottom+4+In>lr?dn.top-In-4:dn.bottom+4;Xe({top:Math.max(8,Cn),left:Math.max(8,dn.right-208)}),st(tt===le.id?null:le.id)},className:"p-0.5 hover:bg-gray-200 rounded text-gray-400",children:c.jsx(Az,{size:10})})]}),tt===le.id&&ht&&or.createPortal(c.jsxs("div",{ref:Fe,className:"fixed bg-theme-card rounded-xl shadow-2xl border border-theme p-3 w-52 animate-in fade-in slide-in-from-top-1 duration-200",style:{top:ht.top,left:Math.max(8,ht.left),zIndex:99999},onClick:Lt=>Lt.stopPropagation(),children:[c.jsxs("div",{className:"mb-3",children:[c.jsx("p",{className:"text-[9px] font-bold text-gray-400 mb-2 uppercase",children:k("tagStyle")}),c.jsx("div",{className:"grid grid-cols-5 gap-1.5 focus:outline-none",children:Iee.map(Lt=>c.jsx("button",{className:`w-6 h-6 rounded-full hover:scale-110 transition-transform ${le.data.color===Lt?"ring-2 ring-offset-1 ring-indigo-500 shadow-sm":""}`,style:{backgroundColor:Lt},onClick:dn=>{dn.stopPropagation(),f(le.id,{color:Lt}),st(null)},title:k("selectTagColor")},Lt))})]}),c.jsxs("div",{className:"space-y-0.5",children:[c.jsxs("button",{onClick:()=>{Oe(le.id),xt(""),st(null),le.isExpanded||v(Lt=>[...Lt,le.id])},className:"w-full flex items-center gap-2 px-2 py-1 hover:bg-theme-hover rounded text-[11px] text-theme-secondary font-medium",children:[c.jsx(ri,{size:11})," ",k("addSubTag")]}),c.jsxs("button",{onClick:()=>ol(le),className:"w-full flex items-center gap-2 px-2 py-1 hover:bg-theme-hover rounded text-[11px] text-theme-secondary font-medium",children:[c.jsx(Mg,{size:11})," ",k("rename")]}),le.name.startsWith("Google:")&&c.jsx("button",{onClick:Lt=>{Lt.stopPropagation(),$e(le.id),st(null)},className:`w-full flex items-center gap-2 px-2 py-1 hover:bg-theme-hover rounded text-[11px] font-medium ${te.includes(le.id)?"text-amber-600":"text-theme-secondary"}`,children:te.includes(le.id)?c.jsxs(c.Fragment,{children:[c.jsx(i1,{size:11})," "]}):c.jsxs(c.Fragment,{children:[c.jsx(Pa,{size:11})," "]})}),c.jsxs("button",{onClick:Lt=>{Lt.stopPropagation();const dn=le.id;st(null),setTimeout(()=>{confirm(k("deleteTagConfirm"))&&Io(dn)},10)},className:"w-full flex items-center gap-2 px-2 py-1 hover:bg-red-50 rounded text-[11px] text-red-600 font-medium",children:[c.jsx(jr,{size:11})," ",k("deleteTag")]})]})]}),document.body)]})]}),fe===le.id&&c.jsx("div",{className:"px-1 mb-0.5",style:{paddingLeft:`${(le.depth+1)*6+6}px`},children:c.jsx("form",{onSubmit:Lt=>nn(Lt,le.id),className:"relative",children:c.jsx("input",{autoFocus:!0,value:et,onChange:Lt=>xt(Lt.target.value),onKeyDown:Lt=>{Lt.key==="Escape"&&Oe(null),Lt.stopPropagation()},onBlur:()=>{et.trim()||Oe(null)},placeholder:k("subTagPlaceholder"),className:"w-full text-[10px] py-1 px-2 bg-indigo-50/30 border border-indigo-100/50 rounded outline-none focus:ring-1 focus:ring-indigo-200 transition-all font-medium text-gray-700 placeholder:text-gray-300"})})}),le.isExpanded&&le.children.map(Lt=>fi(Lt))]},le.id)},Dr=le=>{const Et=lt===le.id,Bt=["logbook","recent","trash","worklog"].includes(le.id),Vt=ie[le.id]||le.label;return c.jsx(Mee,{...le,label:Vt,isEditing:Et,editingViewName:X,setEditingViewName:ee,setEditingViewId:St,saveViewName:ls,setHoveredDropTarget:di,sidebarCollapsed:w,sidebarTextClass:vn,sidebarFontClass:Gr,setView:e,setTagFilter:r,onEditFilter:Bt?void 0:Lt=>Ke(Lt)})};return c.jsxs("aside",{className:"w-full bg-theme-sidebar border-r border-theme h-screen flex flex-col p-5 sticky top-0 overflow-hidden",onDragOver:le=>{M.isDragging&&(le.preventDefault(),I(le.clientX,le.clientY))},onDrop:no,children:[c.jsxs("div",{className:`mb-8 flex items-center ${w?"justify-center flex-col gap-4":"justify-between px-1"} opacity-60`,children:[!w&&c.jsxs("div",{className:"flex items-center gap-2 text-theme-secondary",children:[c.jsx(r1,{size:18})," ",c.jsx("span",{className:"text-xs font-bold tracking-widest uppercase text-theme-tertiary",children:k("appearance")})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:()=>je(!0),className:"hover:bg-theme-hover p-1 rounded transition-colors text-theme-secondary",title:" (K)",children:c.jsx(Hc,{size:18})}),c.jsx("button",{onClick:_,className:"hover:bg-theme-hover p-1 rounded transition-colors text-theme-secondary",children:w?c.jsx(Pz,{size:18}):c.jsx(Oz,{size:18})})]})]}),c.jsxs("nav",{className:"flex-1 overflow-y-auto no-scrollbar py-2",children:[c.jsx("div",{className:"mb-6",children:c.jsx(Dr,{id:"inbox",label:k("inbox"),normalCount:rn.inbox,active:t==="inbox"&&!n,icon:n1,color:"#1badf8"})}),c.jsxs("div",{className:"mb-6",children:[c.jsx(Dr,{id:"today",label:k("today"),overdueCount:rn.todayOverdue,normalCount:rn.todayScheduled,active:t==="today"&&!n,icon:VI,color:"#f5c94c",acceptsDrop:!0}),c.jsx(Dr,{id:"allview",label:"",active:t==="allview"&&!n,icon:RI,color:"#10b981"}),c.jsx(Dr,{id:"matrix",label:"",normalCount:rn.matrixUrgent,active:t==="matrix",icon:r1,color:"#6366f1"})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx(Dr,{id:"focus",label:"",active:t==="focus",icon:WI,color:"#ef4444"}),c.jsx(Dr,{id:"project",label:"",active:t==="project",icon:mz,color:"#f97316",acceptsDrop:!0}),c.jsx(Dr,{id:"annualplan",label:"",active:t==="annualplan",icon:fz,color:"#eab308"})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx(Dr,{id:"waiting",label:"/",active:t==="waiting"&&!n,icon:Oi,color:"#a855f7",acceptsDrop:!0}),c.jsx(Dr,{id:"journal",label:"",active:t==="journal"&&!n,icon:CI,color:"#34d399",acceptsDrop:!0}),c.jsx(Dr,{id:"prompt",label:k("prompt"),normalCount:rn.prompt,active:t==="prompt",icon:Cz,color:"#fbbf24",acceptsDrop:!0}),c.jsx(Dr,{id:"worklog",label:"",active:t==="worklog",icon:Xf,color:"#0ea5e9"})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx(Dr,{id:"logbook",label:k("logbook"),normalCount:rn.logbook,active:t==="logbook",icon:am,color:"#a16207"}),c.jsx(Dr,{id:"recent",label:"",active:t==="recent",icon:Sz,color:"#0891b2"}),c.jsx(Dr,{id:"trash",label:k("trash"),normalCount:rn.trash>1e3?rn.trash:void 0,active:t==="trash",icon:jr,color:"#9ca3af"})]}),!w&&c.jsxs("div",{className:"mt-2",children:[c.jsxs("div",{className:"flex items-center justify-between px-3 mb-2 group/tagheader cursor-pointer select-none",onClick:()=>{const le=!At;jt(le),localStorage.setItem("sidebar_tags_expanded",String(le))},children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("p",{className:"text-[10px] font-bold text-gray-300 uppercase tracking-wider",children:"TAGS"}),c.jsx("span",{className:"text-gray-300 transition-transform duration-200",style:{transform:At?"rotate(0deg)":"rotate(-90deg)"},children:c.jsx(rs,{size:10})})]}),c.jsx("button",{onClick:le=>{le.stopPropagation(),Ie(!0),At||jt(!0)},className:"opacity-0 group-hover/tagheader:opacity-100 p-0.5 hover:bg-gray-100 rounded text-gray-400 hover:text-gray-600 transition-all flex items-center justify-center",title:"",children:c.jsx(ri,{size:10})})]}),At&&c.jsxs("div",{className:"overflow-hidden",children:[Se&&c.jsx("div",{className:"px-3 overflow-hidden mb-2",children:c.jsxs("form",{onSubmit:nn,className:"relative",children:[c.jsx("input",{ref:It,value:et,onChange:le=>xt(le.target.value),onKeyDown:le=>{le.key==="Escape"&&Ie(!1),le.stopPropagation()},onBlur:()=>{et.trim()||Ie(!1)},placeholder:"...",className:"w-full text-xs py-1.5 px-2 bg-indigo-50/50 border border-indigo-100 rounded-md outline-none focus:ring-1 focus:ring-indigo-300 transition-all font-medium text-gray-700 placeholder:text-gray-300"}),c.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1",children:et.trim()&&c.jsx("button",{type:"submit",className:"text-indigo-500 hover:text-indigo-600",children:c.jsx(Zn,{size:12})})})]})}),c.jsxs("div",{className:"space-y-0",children:[cs.map(le=>fi(le)),!Se&&c.jsxs("button",{onClick:()=>Ie(!0),className:"w-full group flex items-center gap-1.5 px-3 py-1 text-gray-300 hover:text-gray-400 text-xs transition-colors transition-opacity opacity-0 hover:opacity-100",children:[c.jsx(ri,{size:10}),c.jsx("span",{className:"font-medium",children:k("addTagPlaceholder")})]})]})]})]})]}),c.jsxs("div",{className:"mt-auto pt-4 border-t border-gray-200 relative",children:[c.jsxs("div",{className:`flex ${w?"justify-center flex-col gap-2":"justify-between"} items-center`,children:[!w&&c.jsxs("div",{className:"text-[10px] text-gray-400 flex items-center gap-1",children:[c.jsx(AI,{size:10})," ",V6]}),c.jsx("button",{onClick:()=>Je(!Te),"aria-label":"Settings",className:"text-gray-400 hover:text-gray-600 p-1 rounded hover:bg-gray-100 transition-colors",children:c.jsx(HI,{size:14})})]}),Te&&c.jsx("div",{ref:it,className:"absolute bottom-full left-0 mb-2 w-full bg-white rounded-lg shadow-xl border border-gray-200 z-50 animate-in fade-in zoom-in duration-100 max-h-[60vh] overflow-y-auto",children:c.jsxs("div",{className:"p-3",children:[c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider",children:k("appearance")}),c.jsxs("div",{className:"space-y-3 mb-4",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:k("language")})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>N("zh"),className:`flex-1 text-[10px] py-1 rounded ${A==="zh"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:A==="zh"?"":"Chinese"}),c.jsx("button",{onClick:()=>N("en"),className:`flex-1 text-[10px] py-1 rounded ${A==="en"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:A==="zh"?"":"English"})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:A==="zh"?"":"Color Theme"})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>u(le=>({...le,themeMode:"light"})),className:`flex-1 text-[10px] py-1 rounded ${l.themeMode==="light"||!l.themeMode?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:A==="zh"?"":"Light"}),c.jsx("button",{onClick:()=>u(le=>({...le,themeMode:"dark"})),className:`flex-1 text-[10px] py-1 rounded ${l.themeMode==="dark"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:A==="zh"?"":"Dark"}),c.jsx("button",{onClick:()=>u(le=>({...le,themeMode:"programmer"})),className:`flex-1 text-[10px] py-1 rounded ${l.themeMode==="programmer"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:A==="zh"?"":"Dev"})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:k("fontSize")})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>u(le=>({...le,fontSize:"small"})),className:`flex-1 text-[10px] py-1 rounded ${l.fontSize==="small"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:k("sizeSmall")}),c.jsx("button",{onClick:()=>u(le=>({...le,fontSize:"normal"})),className:`flex-1 text-[10px] py-1 rounded ${l.fontSize==="normal"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:k("sizeNormal")}),c.jsx("button",{onClick:()=>u(le=>({...le,fontSize:"large"})),className:`flex-1 text-[10px] py-1 rounded ${l.fontSize==="large"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:k("sizeLarge")})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:k("timeFormat")})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>u(le=>({...le,timeFormat:"24h"})),className:`flex-1 text-[10px] py-1 rounded ${l.timeFormat==="24h"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:"24H"}),c.jsx("button",{onClick:()=>u(le=>({...le,timeFormat:"12h"})),className:`flex-1 text-[10px] py-1 rounded ${l.timeFormat==="12h"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:"12H"})]})]})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:k("calendarSettings")}),c.jsxs("div",{className:"mb-4 space-y-2",children:[c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showLunar,onChange:le=>u({...l,showLunar:le.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:k("showLunar")})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showTaiwanHolidays,onChange:le=>u({...l,showTaiwanHolidays:le.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:k("showTaiwanHolidays")})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showRelationshipLines!==!1,onChange:le=>u({...l,showRelationshipLines:le.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:""})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showImportedGoogleEvents!==!1,onChange:le=>u({...l,showImportedGoogleEvents:le.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:A==="zh"?" Google ":"Show Google Events"})]})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:"Google Calendar"}),c.jsxs("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"Client ID"}),c.jsx("input",{type:"text",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"your-client-id.apps.googleusercontent.com",value:Pe,onChange:le=>ze(le.target.value)})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:k("aiSettings")}),c.jsxs("div",{className:"mb-4 space-y-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] font-bold text-gray-400 uppercase mb-1",children:k("provider")}),c.jsxs("select",{value:ue.provider,onChange:le=>Ne(Et=>({...Et,provider:le.target.value})),className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",children:[c.jsx("option",{value:"gemini",children:"Google Gemini"}),c.jsx("option",{value:"openai",children:"OpenAI Compatible (DeepSeek/Moonshot)"})]})]}),ue.provider==="gemini"?c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsx("span",{className:"text-xs text-gray-600",children:"Gemini API Key"}),c.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-indigo-500 hover:underline",children:"Get Key"})]}),c.jsx("input",{type:"password",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"AIza...",value:ue.googleKey,onChange:le=>Ne(Et=>({...Et,googleKey:le.target.value}))})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"Base URL"}),c.jsx("input",{type:"text",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"https://api.deepseek.com",value:ue.baseUrl,onChange:le=>Ne(Et=>({...Et,baseUrl:le.target.value}))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"API Key"}),c.jsx("input",{type:"password",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"sk-...",value:ue.openaiKey,onChange:le=>Ne(Et=>({...Et,openaiKey:le.target.value}))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"Model Name"}),c.jsx("input",{type:"text",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"e.g. deepseek-chat",value:ue.modelName,onChange:le=>Ne(Et=>({...Et,modelName:le.target.value}))})]})]}),c.jsx("button",{onClick:$r,className:"w-full bg-indigo-600 text-white px-2 py-1.5 rounded text-xs hover:bg-indigo-700 transition-colors font-medium",children:"Save Settings"})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:"Data"}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("button",{onClick:()=>{confirm(A==="zh"?"":"Are you sure you want to delete all tasks? A backup will be downloaded first.")&&p()},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(jr,{size:12})," ",A==="zh"?"":"Delete All Tasks"]}),c.jsxs("button",{onClick:m,className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(iu,{size:12})," ",A==="zh"?"":"Backup Data"]}),c.jsxs("button",{onClick:()=>{var le;return(le=Q.current)==null?void 0:le.click()},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(Wz,{size:12})," ",A==="zh"?"":"Import Data"]}),c.jsxs("button",{onClick:Ft,className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(So,{size:12})," ",A==="zh"?" Google ":"Import Google Calendar"]}),c.jsxs("button",{onClick:()=>b&&b(),className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(s1,{size:12})," ",A==="zh"?" Google ":"Sync Google Calendar"]}),c.jsxs("button",{onClick:()=>{localStorage.removeItem("google_sync_tokens"),F({msg:"Sync tokens ...",type:"info"}),b&&b()},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-amber-50 rounded text-xs text-amber-600",children:[c.jsx(s1,{size:12})," ",A==="zh"?"":"Force Full Sync"]}),c.jsxs("button",{onClick:Pt,className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-red-600",children:[c.jsx(jr,{size:12})," ",A==="zh"?"":"Clear Imported Calendar"]}),c.jsxs("button",{onClick:async()=>{if(!confirm("Google:( Google )"))return;const le=JSON.parse(localStorage.getItem("task_google_map")||"{}"),Et=o.filter(Vt=>Vt.tags.some(Lt=>{const dn=a.find(In=>In.id===Lt);return dn&&dn.name.includes("")&&dn.name.toLowerCase().includes("google")}));let Bt=0;Et.forEach(Vt=>{le[Vt.id]&&delete le[Vt.id]}),localStorage.setItem("task_google_map",JSON.stringify(le));for(const Vt of Et)await B(Vt.id),Bt++;F({msg:` ${Bt} `,type:"success"})},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-orange-600",children:[c.jsx(jr,{size:12})," ",A==="zh"?" ()":"Clean CiXing Tasks (Local)"]}),c.jsx("input",{type:"file",ref:Q,className:"hidden",accept:".json",onChange:qn})]})]})})]}),Ye&&or.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-[9999] flex items-center justify-center",onClick:()=>Ke(null),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-80 max-h-[80vh] flex flex-col overflow-hidden",onClick:le=>le.stopPropagation(),children:[c.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h3",{className:"font-bold text-gray-700 text-sm",children:""}),c.jsx("button",{onClick:()=>Ke(null),className:"text-gray-400 hover:text-gray-600",children:c.jsx(hn,{size:16})})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-xs text-gray-500",children:""}),c.jsx("input",{type:"text",value:Z,onChange:le=>ne(le.target.value),onBlur:()=>{const le={...ie};Z.trim()?le[Ye]=Z:delete le[Ye],ce(le),localStorage.setItem("custom_view_names",JSON.stringify(le))},onKeyDown:le=>{le.key==="Enter"&&le.target.blur()},className:"flex-1 px-2 py-1 text-sm border border-gray-200 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:k(Ye)||Ye})]})]}),c.jsxs("div",{className:"p-2 overflow-y-auto flex-1 text-sm",children:[c.jsx("p",{className:"px-2 py-2 text-xs text-gray-500 mb-2 bg-yellow-50 rounded border border-yellow-100",children:" () /  () / "}),c.jsx("div",{className:"space-y-1",children:a.map(le=>{const Et=S[Ye]||{include:[],exclude:[]},{include:Bt,exclude:Vt}=Array.isArray(Et)?{include:Et,exclude:[]}:Et,Lt=Bt.includes(le.id),dn=Vt.includes(le.id);return c.jsxs("div",{className:"flex items-center gap-2 px-2 py-2 hover:bg-gray-50 rounded cursor-pointer select-none",onClick:()=>{let In=[...Bt],lr=[...Vt];Lt?(In=In.filter(zn=>zn!==le.id),lr.push(le.id)):dn?lr=lr.filter(zn=>zn!==le.id):In.push(le.id),T(Ye,{include:In,exclude:lr})},children:[c.jsxs("div",{className:"w-5 h-5 flex items-center justify-center",children:[Lt&&c.jsx(bf,{size:16,className:"text-green-500"}),dn&&c.jsx(qz,{size:16,className:"text-red-500"}),!Lt&&!dn&&c.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300"})]}),c.jsx("span",{style:{color:D[le.id]},children:le.name.startsWith("#")?le.name.slice(1):le.name})]},le.id)})})]}),c.jsx("div",{className:"p-3 border-t border-gray-100 flex justify-end",children:c.jsx("button",{onClick:()=>Ke(null),className:"px-4 py-1.5 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700",children:""})})]})}),document.body),He&&or.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-[9999] flex items-center justify-center",onClick:()=>J(!1),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-96 p-4 max-h-[80vh] flex flex-col",onClick:le=>le.stopPropagation(),children:[c.jsx("h3",{className:"font-bold text-gray-700 text-sm mb-4",children:Dn==="date"?A==="zh"?"":"Select Date Range":A==="zh"?"":"Select Calendars"}),Dn==="date"?c.jsxs("div",{className:"space-y-3 mb-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Start Date"}),c.jsx("input",{type:"date",className:"w-full border border-gray-200 rounded px-2 py-1 text-sm outline-none focus:ring-1 focus:ring-indigo-500",value:mt.start,onChange:le=>Wt(Et=>({...Et,start:le.target.value}))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"End Date"}),c.jsx("input",{type:"date",className:"w-full border border-gray-200 rounded px-2 py-1 text-sm outline-none focus:ring-1 focus:ring-indigo-500",value:mt.end,onChange:le=>Wt(Et=>({...Et,end:le.target.value}))})]}),c.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[c.jsx("button",{onClick:()=>J(!1),className:"px-3 py-1.5 text-gray-500 hover:bg-gray-100 rounded text-xs",children:"Cancel"}),c.jsx("button",{onClick:Ut,className:"px-3 py-1.5 bg-indigo-600 text-white rounded text-xs font-medium hover:bg-indigo-700",children:"Next"})]})]}):c.jsxs("div",{className:"mb-4 flex flex-col flex-1 overflow-hidden",children:[c.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 mb-4 border border-gray-100 rounded p-2",children:cn.map(le=>c.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer hover:bg-gray-50 p-1 rounded",children:[c.jsx("input",{type:"checkbox",checked:q.has(le.id),onChange:Et=>{const Bt=new Set(q);Et.target.checked?Bt.add(le.id):Bt.delete(le.id),ye(Bt)},className:"rounded text-indigo-600 focus:ring-indigo-500"}),c.jsx("span",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:le.backgroundColor||"#ccc"}}),c.jsx("span",{className:"truncate",children:le.summary})]},le.id))}),c.jsxs("div",{className:"flex justify-end gap-2 mt-auto",children:[c.jsx("button",{onClick:()=>Ht("date"),className:"px-3 py-1.5 text-gray-500 hover:bg-gray-100 rounded text-xs",children:"Back"}),c.jsx("button",{onClick:Zt,disabled:q.size===0,className:"px-3 py-1.5 bg-indigo-600 text-white rounded text-xs font-medium hover:bg-indigo-700 disabled:opacity-50",children:"Import"})]})]})]})}),document.body),s&&c.jsx(jee,{current:s.current,total:s.total}),c.jsx(Nee,{isOpen:oe,onClose:()=>je(!1)})]})},Dee=({initialTitle:t,onSave:e,onCancel:n,onSwitchToFull:r,className:s,fontClass:i})=>{const[o,a]=x.useState(t),l=x.useRef(null);x.useEffect(()=>{const d=setTimeout(()=>{if(l.current){l.current.focus();const f=l.current.value.length;l.current.setSelectionRange(f,f)}},50);return()=>clearTimeout(d)},[]);const u=d=>{d.stopPropagation(),d.key==="Enter"&&(d.preventDefault(),d.metaKey||d.ctrlKey?r(o):e(o)),d.key==="Escape"&&(d.preventDefault(),n())};return c.jsx("input",{ref:l,autoFocus:!0,value:o,onChange:d=>a(d.target.value),onBlur:()=>e(o),onKeyDown:u,onClick:d=>d.stopPropagation(),className:`bg-transparent outline-none border-none p-0 m-0 w-full text-gray-900 dark:text-gray-100 caret-gray-900 dark:caret-gray-100 font-normal ${i}`})},gl=({flatTask:t,isFocused:e,onEdit:n,onSelect:r,backgroundColor:s})=>{const{updateTask:i,setFocusedTaskId:o,editingTaskId:a,setEditingTaskId:l,inlineEditingTaskId:u,setInlineEditingTaskId:d,addTask:f,toggleExpansion:h,startDrag:p,keyboardMove:m,tasks:y,tags:b,dragState:g,navigateBack:v,view:w,canNavigateBack:_,smartReschedule:D,lockTask:k,unlockTask:A,verifyTaskPassword:N,temporarilyUnlockTask:E,selectedTaskIds:S,handleSelection:T,themeSettings:C,pendingFocusTaskId:O,setPendingFocusTaskId:P,setSelectedTaskIds:H,visibleTasks:M,t:I,language:K,batchDeleteTasks:G,batchUpdateTasks:R,setToast:Ee,tagFilter:ge}=x.useContext(jn),{recordingTaskId:F}=x.useContext(Ru),B=t.data,se=x.useRef(null),We=x.useRef(null),ut=x.useRef(null),[oe,je]=x.useState(!1),[te,$e]=x.useState(null),Te=typeof window<"u"&&window.innerWidth<768,[Je,Ye]=x.useState(!1),[Ke,lt]=x.useState("lock"),[St,X]=x.useState(""),[ee,ie]=x.useState(null),ce=t.isExpanded,Z=t.hasChildren,ne=!!B.completed_at&&(B.status==="completed"||B.status==="logged"),Se=B.status==="canceled",Ie=ne||Se,fe=S.includes(B.id),Oe=!!B.is_locked;Oe&&B.lock_password;const et=Oe&&!B.lock_password,xt=q=>{if(!q)return null;switch(q){case"urgent":return"red";case"planned":return"amber";case"delegated":return"green";case"unplanned":return"gray";default:return null}},It=q=>{const ye=xt(q.importance);if(ye)return ye;let Re=q;const _e=new Set;for(;Re.parent_id&&!_e.has(Re.id);){_e.add(Re.id);const it=y.find(Fe=>Fe.id===Re.parent_id);if(!it)break;Re=it}return Re.color||"blue"},ue=!1;x.useEffect(()=>{e&&se.current&&se.current.focus({preventScroll:!0})},[e]),x.useEffect(()=>{O===B.id&&(P(null),o(B.id),setTimeout(()=>{d(B.id)},50))},[O,B.id,P,o,d]);const Ne=q=>{q?B.status===q?i(B.id,{status:"active",completed_at:null}):i(B.id,{status:q,completed_at:new Date().toISOString()}):ne||Se?i(B.id,{status:"active",completed_at:null}):i(B.id,{status:"completed",completed_at:new Date().toISOString()})},Ue=q=>q.start_date?new Date(q.start_date).toISOString().split("T")[0]:q.due_date?new Date(q.due_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],Ze=q=>{if(w!=="today")return!1;const Re=(S.includes(B.id)?S:[B.id]).map(_e=>M.findIndex(it=>it.data.id===_e)).filter(_e=>_e!==-1).sort((_e,it)=>_e-it);if(Re.length===0)return!1;if(q==="up"){const _e=Re[0];if(_e===0)return!0;const it=M[_e].data,Fe=M[_e-1].data;return Ue(Fe)!==Ue(it)}else{const _e=Re[Re.length-1];if(_e===M.length-1)return!0;const it=M[_e].data,Fe=M[_e+1].data;return Ue(Fe)!==Ue(it)}},xe=q=>{const ye=S.includes(B.id)?S:[B.id],Re=ye.map(Ut=>y.find(Kt=>Kt.id===Ut)).filter(Ut=>Ut!==void 0).sort((Ut,Kt)=>{var rn,vn;const Zt=((rn=Ut.view_orders)==null?void 0:rn.today)??0,nn=((vn=Kt.view_orders)==null?void 0:vn.today)??0;return Zt-nn});if(Re.length===0)return;const _e=Re[0],it=_e.start_date?new Date(_e.start_date):new Date,Fe=new Date(it);Fe.setDate(Fe.getDate()+(q==="up"?-1:1));const gt=Fe.toISOString().split("T")[0],Pt=y.filter(Ut=>{var Zt,nn;return(((Zt=Ut.start_date)==null?void 0:Zt.split("T")[0])||((nn=Ut.due_date)==null?void 0:nn.split("T")[0]))===gt&&!ye.includes(Ut.id)}).sort((Ut,Kt)=>{var rn,vn;const Zt=((rn=Ut.view_orders)==null?void 0:rn.today)??0,nn=((vn=Kt.view_orders)==null?void 0:vn.today)??0;return Zt-nn});let Ft;q==="up"?Ft=Pt.reduce((Kt,Zt)=>{var nn;return Math.max(Kt,((nn=Zt.view_orders)==null?void 0:nn.today)??0)},0)+1e4:Ft=Pt.reduce((Kt,Zt)=>{var nn;return Math.min(Kt,((nn=Zt.view_orders)==null?void 0:nn.today)??9e8)},9e8)-(Re.length+1)*1e4,R(Re.map((Ut,Kt)=>({id:Ut.id,data:{start_date:gt,is_all_day:!0,view_orders:{...Ut.view_orders||{},today:Ft+Kt*1e4}}})))},ct=q=>{if(q.altKey&&!q.ctrlKey&&!q.metaKey){if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(q.key)&&(q.preventDefault(),q.stopPropagation()),w==="focus"||w==="recent"||ue||w==="allview"&&B.status==="logged")return;if(w==="today"){if(q.key==="ArrowUp"){if(Ze("up")){xe("up");return}m(B.id,"up");return}if(q.key==="ArrowDown"){if(Ze("down")){xe("down");return}m(B.id,"down");return}if(q.key==="ArrowRight"){m(B.id,"right");return}if(q.key==="ArrowLeft"){_?v():m(B.id,"left");return}}if(w==="upcoming"){if(q.key==="ArrowUp"){m(B.id,"up");return}if(q.key==="ArrowDown"){m(B.id,"down");return}return}if(q.key==="ArrowUp"){m(B.id,"up");return}if(q.key==="ArrowDown"){m(B.id,"down");return}if(q.key==="ArrowRight"){m(B.id,"right");return}if(q.key==="ArrowLeft"){_?v():m(B.id,"left");return}}if(q.key==="Tab"){if(q.preventDefault(),q.stopPropagation(),w==="focus"||w==="upcoming"||ue||w==="allview"&&B.status==="logged")return;if(q.shiftKey){if(t.depth===0&&ge){const ye=document.querySelector(`[data-tag-id="${ge}"]`);if(ye){ye.focus(),o(null),H([]);return}}_?v():m(B.id,"left")}else m(B.id,"right");return}if(q.key==="Delete"||q.key==="Backspace"&&!q.target.matches("input, textarea")){q.preventDefault(),q.stopPropagation();const ye=S.includes(B.id)?S:[B.id],Re=M.findIndex(it=>it.data.id===B.id);let _e=null;for(let it=Re+1;it<M.length;it++)if(!ye.includes(M[it].data.id)){_e=M[it];break}if(!_e){for(let it=Re-1;it>=0;it--)if(!ye.includes(M[it].data.id)){_e=M[it];break}}G(ye,w==="trash"),_e&&(o(_e.data.id),H([_e.data.id]));return}if((q.ctrlKey||q.metaKey)&&q.key==="."){q.preventDefault(),q.stopPropagation(),q.shiftKey?Ne("canceled"):Ne("completed");return}if(q.key==="Enter"&&(q.preventDefault(),q.stopPropagation(),Oe?(X(""),lt("verify"),q.metaKey||q.ctrlKey?ie(()=>()=>n()):ie(()=>()=>d(B.id)),Ye(!0)):q.metaKey||q.ctrlKey?n():d(B.id)),q.key===" "&&(w==="inbox"||w==="today"||w==="schedule"||w==="waiting"||w==="focus")){q.preventDefault(),q.stopPropagation();const ye=M.findIndex(Ft=>Ft.data.id===B.id),Re=Ft=>Ft.view_orders&&Ft.view_orders[w]!==void 0?Ft.view_orders[w]:w==="today"?9e8+new Date(Ft.created_at).getTime()/1e3:Ft.order_index||0,_e=Re(B),it=w==="today"?null:B.parent_id;let Fe=null;for(let Ft=ye+1;Ft<M.length;Ft++){const Ut=M[Ft];if(w==="today"){Fe=Re(Ut.data);break}else{if(Ut.depth<=t.depth&&Ut.data.parent_id!==it)break;if(Ut.data.parent_id===it){Fe=Re(Ut.data);break}}}let gt=_e+1e4;Fe!==null&&(gt=(_e+Fe)/2);const Pt={title:"",status:w==="waiting"?"someday":"inbox",parent_id:it,order_index:gt,view_orders:{[w]:gt}};if(w==="today"){const Ft=Ue(B);Pt.start_date=Ft,Pt.status="active",Pt.is_all_day=!0}else if(w==="waiting"){const Ft=b.find(Ut=>Ut.name.toLowerCase()==="someday");Ft&&(Pt.tags=[Ft.id])}f(Pt,[],void 0).then(Ft=>{Ft&&(P(Ft),H([]))})}if(q.ctrlKey){if(q.key==="t"&&(q.preventDefault(),q.stopPropagation(),i(B.id,{start_date:new Date().toISOString(),is_all_day:!0})),q.key==="]"){q.preventDefault(),q.stopPropagation();const ye=B.start_date?new Date(B.start_date):new Date;ye.setDate(ye.getDate()+1),i(B.id,{start_date:ye.toISOString(),is_all_day:!0})}if(q.key==="["){q.preventDefault(),q.stopPropagation();const ye=B.start_date?new Date(B.start_date):new Date;ye.setDate(ye.getDate()-1),i(B.id,{start_date:ye.toISOString(),is_all_day:!0})}}q.altKey&&(q.metaKey||q.ctrlKey)&&q.key==="r"&&(q.preventDefault(),q.stopPropagation(),D(B.id)),!q.altKey&&!q.ctrlKey&&!q.metaKey&&q.key!==" "&&(q.key==="ArrowRight"&&(q.preventDefault(),Z&&!ce&&h(B.id,!0)),q.key==="ArrowLeft"&&(q.preventDefault(),ce?h(B.id,!1):B.parent_id&&o(B.parent_id)))},dt=w==="focus",ft=w!=="focus"&&(g.draggedId===B.id||g.isDragging&&fe),jt=`group relative ${dt?"mb-0":"mb-1 md:mb-0.5"} rounded-lg outline-none select-none cursor-default ${dt?"py-0.5":"py-2 md:py-1.5"} ${fe?"bg-theme-selection":""} ${!fe&&!ft&&(e&&!fe&&!ft?"bg-theme-hover":"")} ${Ie&&w!=="logbook"&&w!=="trash"?"bg-emerald-50/30":Ie?"opacity-60 grayscale":""} ${ft?"opacity-40 scale-[0.98] blur-[0.5px] transition-all duration-200":"opacity-100 scale-100 transition-all duration-200"} transition-all duration-200 ease-in-out hover-effect active:bg-theme-hover touch-manipulation`,Q=()=>{const q=[];if(B.repeat_rule&&q.push(c.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-50 text-purple-600 flex items-center gap-0.5",title:B.repeat_rule.originalText||"",children:c.jsx(FI,{size:10})},"repeat")),B.start_date){const ye=Cw(B.start_date),Re=Zx(B.start_date)&&!Ie;let _e="bg-theme-hover text-theme-secondary";ye?_e="bg-yellow-50 text-yellow-600 font-medium":Re&&(_e="bg-red-50 text-red-600 font-medium"),q.push(c.jsxs("span",{className:`text-[10px] px-1.5 py-0.5 rounded border border-transparent ${_e} flex items-center gap-1`,children:[c.jsx(So,{size:10})," ",bI(B.start_date,!B.is_all_day,K)]},"date"))}return q.length===0?null:c.jsx(c.Fragment,{children:q})},me=dt||C.fontWeight==="thin"?"font-extralight":"font-semibold",He={small:"text-sm",normal:"text-base",large:"text-lg"}[C.fontSize]||"text-base",Pe=(()=>{if(w!=="focus"&&w!=="today"||!B.parent_id)return null;const q=[];let ye=y.find(it=>it.id===B.parent_id),Re="blue";const _e=new Set;for(;ye&&!_e.has(ye.id);)_e.add(ye.id),q.unshift({title:ye.title||"Untitled"}),ye.parent_id||(Re=ye.color||"blue"),ye=y.find(it=>it.id===ye.parent_id);return q.length===0?null:{items:q,rootColor:Re}})(),ze=dt?"text-[10px]":He,mt=dt?12:14,Wt=dt?12:16,Dn=dt?"text-[8px]":"text-[10px]",Ht=x.useCallback(q=>{if(!Te)return;const ye=q.touches[0];We.current={x:ye.clientX,y:ye.clientY,time:Date.now()},ut.current=setTimeout(()=>{je(!0),navigator.vibrate&&navigator.vibrate(50)},500)},[Te]),cn=x.useCallback(q=>{if(!We.current)return;const ye=q.touches[0],Re=Math.abs(ye.clientX-We.current.x),_e=Math.abs(ye.clientY-We.current.y);(Re>10||_e>10)&&ut.current&&(clearTimeout(ut.current),ut.current=null)},[]),pe=x.useCallback(()=>{ut.current&&(clearTimeout(ut.current),ut.current=null),je(!1),We.current=null},[]);return c.jsxs(Lr.div,{layout:!0,transition:{layout:{duration:.2,ease:"easeInOut"}},ref:se,"data-task-id":B.id,"data-task-index":t.index,draggable:!Te&&w!=="schedule"&&w!=="focus"&&!ue&&!(w==="allview"&&B.status==="logged"),onDragStart:q=>{if(w==="focus"||ue||w==="allview"&&B.status==="logged"){q.preventDefault();return}p(q,t)},className:`${jt} ${oe?"scale-[1.02] shadow-lg z-50":""}`,style:{marginLeft:`${w==="today"?0:t.depth*gp}px`,backgroundColor:s||"transparent"},tabIndex:0,onKeyDown:ct,onClick:q=>{q.stopPropagation(),q.preventDefault(),Te?a||(Oe?(X(""),lt("verify"),ie(()=>()=>setTimeout(()=>l(B.id),50)),Ye(!0)):setTimeout(()=>l(B.id),50)):(r||T)(q,B.id)},onDoubleClick:q=>{q.stopPropagation(),Te||(Oe?(X(""),lt("verify"),ie(()=>()=>n()),Ye(!0)):n())},onTouchStart:Ht,onTouchMove:cn,onTouchEnd:pe,children:[c.jsx("div",{className:`flex flex-col ${dt?"px-1":"px-3"}`,children:c.jsxs("div",{className:"flex items-center gap-3",children:[w==="recent"&&c.jsx("span",{className:"text-[10px] text-gray-300 font-light w-14 flex-shrink-0 tabular-nums",children:B.updated_at?new Date(B.updated_at).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"}):""}),w==="trash"?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-[18px] flex justify-center",children:c.jsx(jr,{size:14,className:"text-gray-300"})}),c.jsx("span",{className:"flex-1 text-gray-400 line-through truncate select-text",children:B.title}),c.jsx("button",{onClick:q=>{q.stopPropagation();const ye=S.includes(B.id)?S:[B.id];R(ye.map(Re=>({id:Re,data:{status:"inbox"}}))),Ee({msg:" Inbox",type:"info"})},className:"px-2 py-1 bg-white border border-gray-200 text-indigo-600 text-[10px] font-medium rounded hover:bg-indigo-50 hover:border-indigo-200 transition-colors shadow-sm whitespace-nowrap",children:I("putBack")})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex items-center gap-1",children:[Z&&w!=="today"?c.jsx("button",{onClick:q=>{q.stopPropagation(),h(B.id)},className:"text-slate-400 hover:text-slate-800 transition-transform",children:ce?c.jsx(rs,{size:mt}):c.jsx(is,{size:mt})}):c.jsx("div",{className:`${dt?"w-[12px]":"w-[16px]"}`}),c.jsx(CD,{checked:ne,isCanceled:Se,onChange:q=>{q.stopPropagation(),q.altKey?Ne("canceled"):Ne()},color:It(B),isRoot:!B.parent_id,size:dt?14:18})]}),c.jsxs("div",{className:"flex-1 min-w-0 cursor-text flex items-center overflow-hidden relative min-h-[1.5em]",children:[Oe&&c.jsx(Pa,{size:12,className:"text-amber-500 mr-1.5 flex-shrink-0"}),F===B.id&&c.jsx("div",{className:"mr-2 flex-shrink-0 w-2 h-2 rounded-full bg-red-500 animate-pulse shadow-[0_0_6px_rgba(239,68,68,0.6)]",title:"Recording..."}),c.jsx("span",{className:`${ze} ${me} transition-all duration-300 ${Ie?"opacity-30":"text-theme-primary"} ${Se?"line-through decoration-gray-400":""} mr-2 truncate block flex-shrink ${u===B.id?"opacity-0":""} ${et?"blur-[4px] select-none":""}`,children:B.title}),u===B.id&&c.jsx("div",{className:"absolute inset-0 bg-white dark:bg-gray-800 z-50 flex items-center pr-2",children:c.jsx(Dee,{initialTitle:B.title,className:`${ze} ${me}`,fontClass:"",onSave:q=>{q!==B.title&&i(B.id,{title:q}),d(null),se.current&&se.current.focus()},onCancel:()=>{d(null),se.current&&se.current.focus()},onSwitchToFull:async q=>{await i(B.id,{title:q}),d(null),n()}})}),Pe&&c.jsx("div",{className:"flex items-center gap-0.5 mr-2 flex-shrink-0",children:Pe.items.map((q,ye)=>{var Re,_e;return c.jsxs(Ln.Fragment,{children:[ye>0&&c.jsx(is,{size:10,className:"text-gray-300 flex-shrink-0",strokeWidth:1.5}),c.jsx("span",{className:`${dt?"text-[8px]":"text-[9px]"} font-semibold px-1.5 py-[1px] rounded transition-colors duration-200 truncate max-w-[150px]`,style:{backgroundColor:(((Re=Qn[Pe.rootColor])==null?void 0:Re.color)||"#6366f1")+"15",color:((_e=Qn[Pe.rootColor])==null?void 0:_e.color)||"#6366f1"},title:q.title,children:q.title})]},ye)})}),(B.tags||[]).length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"hidden md:flex items-center gap-1 mr-2 flex-shrink-0",children:(B.tags||[]).map(q=>{var _e;const ye=(_e=b.find(it=>it.id===q))==null?void 0:_e.name;if(!ye)return null;const Re=ye.startsWith("#");return c.jsx("div",{className:"relative flex-shrink-0",children:c.jsx("span",{className:`${Dn} border rounded-md px-1.5 py-px whitespace-nowrap ${Re?"bg-emerald-50 text-emerald-700 border-emerald-200":`border-theme ${ne?"text-theme-tertiary bg-theme-hover":"text-theme-secondary bg-theme-hover"}`}`,children:ye})},q)})}),c.jsxs("div",{className:"md:hidden flex items-center mr-2 text-slate-400 flex-shrink-0",children:[c.jsx(Ll,{size:Wt}),(B.tags||[]).length>1&&c.jsx("span",{className:`${dt?"text-[8px]":"text-[9px]"} ml-0.5`,children:(B.tags||[]).length})]})]}),B.description&&c.jsx(Xf,{size:12,className:"text-slate-400 mr-2 flex-shrink-0"}),B.attachments&&B.attachments.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"mr-2 flex-shrink-0 cursor-pointer",onMouseEnter:q=>{const ye=q.currentTarget.getBoundingClientRect();$e({visible:!0,x:ye.left+ye.width/2,y:ye.top-8,attachments:B.attachments||[]})},onMouseLeave:()=>$e(null),children:c.jsx(go,{size:12,className:"text-slate-400"})}),(te==null?void 0:te.visible)&&te.attachments===B.attachments&&or.createPortal(c.jsx("div",{className:"fixed z-[99999] pointer-events-none",style:{left:te.x,top:te.y,transform:"translate(-50%, -100%)"},children:c.jsxs("div",{className:"bg-gray-800 text-white text-[10px] px-2.5 py-2 rounded-lg shadow-2xl max-w-[220px]",children:[c.jsxs("div",{className:"font-semibold mb-1 text-[11px]",children:[B.attachments.length," "]}),B.attachments.slice(0,5).map((q,ye)=>c.jsx("div",{className:"truncate opacity-80 py-0.5",children:q.name},ye)),B.attachments.length>5&&c.jsxs("div",{className:"opacity-60 pt-1",children:["... ",B.attachments.length-5," "]})]})}),document.body)]}),c.jsxs("div",{className:`ml-auto ${Ie?"opacity-50":"opacity-100"} flex-shrink-0`,children:[" ",Q()," "]})]}),c.jsxs("div",{className:"opacity-100 md:opacity-0 md:group-hover:opacity-100 flex items-center gap-1 pl-2",children:[c.jsx("button",{onClick:q=>{q.stopPropagation(),X(""),lt(Oe?"unlock":"lock"),Ye(!0)},className:`p-1 transition-colors ${Oe?"text-amber-500 hover:text-amber-600":"text-slate-300 hover:text-amber-500"}`,title:Oe?"":"",children:Oe?c.jsx(i1,{size:Wt}):c.jsx(Pa,{size:Wt})}),c.jsx("button",{onClick:q=>{q.stopPropagation();const ye=S.includes(B.id)?S:[B.id];G(ye,w==="trash")},className:"p-1 hover:text-red-500 text-slate-300 transition-colors",children:c.jsx(jr,{size:Wt})})]})]})]})}),Je&&or.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999]",onClick:()=>{Ye(!1),ie(null)},children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-80 max-w-[90vw]",onClick:q=>q.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[Ke==="lock"?c.jsx(Pa,{size:20,className:"text-amber-500"}):c.jsx(i1,{size:20,className:"text-emerald-500"}),c.jsx("h3",{className:"text-lg font-bold",children:Ke==="lock"?"":Ke==="verify"?"":""})]}),c.jsx("p",{className:"text-sm text-gray-500 mb-4",children:Ke==="lock"?"":Ke==="verify"?"":""}),c.jsx("input",{type:"password",placeholder:"",value:St,onChange:q=>X(q.target.value),onKeyDown:q=>{q.key==="Enter"&&(Ke==="lock"?St.length>=1&&(k(B.id,St),Ye(!1)):Ke==="verify"?N(B.id,St)?(E(B.id),Ye(!1),ee&&ee(),ie(null)):Ee({msg:"",type:"error"}):A(B.id,St).then(ye=>{ye&&Ye(!1)})),q.key==="Escape"&&(Ye(!1),ie(null))},autoFocus:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-amber-500"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:()=>{Ye(!1),ie(null)},className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:""}),c.jsx("button",{onClick:()=>{Ke==="lock"?St.length>=1&&(k(B.id,St),Ye(!1)):Ke==="verify"?N(B.id,St)?(E(B.id),Ye(!1),ee&&ee(),ie(null)):Ee({msg:"",type:"error"}):A(B.id,St).then(q=>{q&&Ye(!1)})},className:`flex-1 px-4 py-2 rounded-lg transition-colors ${Ke==="lock"?"bg-amber-500 text-white hover:bg-amber-600":"bg-emerald-500 text-white hover:bg-emerald-600"}`,children:Ke==="lock"?"":Ke==="verify"?"":""})]})]})}),document.body)]})},Aee=({show:t,top:e,left:n,width:r,color:s})=>{if(!t)return null;const i=Qn[s]||Qn.blue;return c.jsx("div",{className:"absolute pointer-events-none z-10 transition-all duration-100 ease-out",style:{top:`${e}px`,left:`${n}px`,width:`${r}px`},children:c.jsx("div",{className:`h-0.5 ${i.indicator} rounded-full shadow-sm relative`,children:c.jsx("div",{className:`absolute -left-1.5 -top-[3px] w-2 h-2 ${i.indicator} rounded-full shadow-md`})})})},Ree={red:"#ef4444",orange:"#f97316",yellow:"#eab308",green:"#22c55e",blue:"#3b82f6",purple:"#a855f7",pink:"#ec4899",gray:"#9ca3af"},Oee=({containerRef:t,tasks:e})=>{const[n,r]=x.useState([]),s=x.useRef(null),i=x.useRef(null),o=x.useCallback(()=>{if(!t.current)return;const a=t.current.getBoundingClientRect(),l=t.current.querySelectorAll("[data-task-id]"),u=new Map;l.forEach(g=>{const v=g.getAttribute("data-task-id");if(v){const w=g.getBoundingClientRect();u.set(v,{top:w.top-a.top,height:w.height})}});const d=new Map(e.map(g=>[g.data.id,g.data])),f=new Set(e.map(g=>g.data.id)),h=g=>{let v=g,w=0;const _=new Set,D=[];for(;w<50&&!_.has(v);){_.add(v);const A=d.get(v);if(!A)break;if(D.push(v),!A.parent_id||!f.has(A.parent_id))return{rootId:v,color:A.color||"gray",depth:D.length-1};v=A.parent_id,w++}const k=d.get(g);return{rootId:g,color:(k==null?void 0:k.color)||"gray",depth:0}},p=new Map;e.forEach(g=>{const v=u.get(g.data.id);if(!v)return;const w=h(g.data.id);if(!p.has(w.rootId)){const D=u.get(w.rootId);p.set(w.rootId,{rootId:w.rootId,color:Ree[w.color]||w.color,rootTop:(D==null?void 0:D.top)||v.top,rootHeight:(D==null?void 0:D.height)||v.height,minTop:v.top,maxBottom:v.top+v.height,tasks:[],offsetX:0})}const _=p.get(w.rootId);_.minTop=Math.min(_.minTop,v.top),_.maxBottom=Math.max(_.maxBottom,v.top+v.height),w.depth>0&&_.tasks.push({taskId:g.data.id,rootId:w.rootId,rootColor:_.color,depth:w.depth,top:v.top,height:v.height})});const m=Array.from(p.values()).filter(g=>g.tasks.length>0);m.sort((g,v)=>g.rootTop-v.rootTop);const y=8,b=8;m.forEach((g,v)=>{g.offsetX=y+v*b}),r(m)},[t,e]);return x.useEffect(()=>{o();const a=t.current;a&&a.addEventListener("scroll",o),i.current=new ResizeObserver(o),a&&i.current.observe(a),window.addEventListener("resize",o);const l=setInterval(o,100);return()=>{a&&a.removeEventListener("scroll",o),i.current&&i.current.disconnect(),window.removeEventListener("resize",o),clearInterval(l)}},[o]),x.useEffect(()=>{const a=setTimeout(o,50);return()=>clearTimeout(a)},[e,o]),n.length===0?null:c.jsxs("svg",{ref:s,className:"absolute top-0 left-0 w-full h-full pointer-events-none z-10",style:{overflow:"visible"},children:[c.jsx("defs",{children:c.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[c.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),c.jsxs("feMerge",{children:[c.jsx("feMergeNode",{in:"coloredBlur"}),c.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),n.map((a,l)=>{const u=a.offsetX,d=a.rootTop+a.rootHeight/2,f=a.maxBottom-6;return c.jsxs("g",{children:[c.jsx("path",{d:`M ${u} ${d} L ${u} ${f}`,fill:"none",stroke:a.color,strokeWidth:"2",strokeOpacity:"0.3",strokeLinecap:"round"}),c.jsx("circle",{cx:u,cy:d,r:"4",fill:a.color,opacity:"0.9",filter:"url(#glow)"}),a.tasks.map((h,p)=>c.jsx("rect",{x:u-1.5,y:h.top+8,width:3,height:h.height-16,rx:1.5,ry:1.5,fill:h.rootColor,opacity:.6-(h.depth-1)*.1},`bar-${p}`))]},`group-${l}`)})]})},cE={"zh-TW":["","","","","","",""],en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},uE={"zh-TW":["1","2","3","4","5","6","7","8","9","10","11","12"],en:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},Pee=({date:t,isToday:e,isTomorrow:n,taskCount:r,language:s="zh-TW"})=>{var p,m;const i=new Date(t+"T12:00:00"),o=i.getDate(),a=((p=uE[s])==null?void 0:p[i.getMonth()])||uE.en[i.getMonth()],l=((m=cE[s])==null?void 0:m[i.getDay()])||cE.en[i.getDay()],u=i.getDay()===0||i.getDay()===6;let d="",f="";e?(d=s==="zh-TW"?"":"Today",f=`${a}${o}`):n?(d=s==="zh-TW"?"":"Tomorrow",f=`${a}${o}`):(d=`${a}${o}`,f=l);const h=()=>e?"text-blue-600":n?"text-orange-500":u?"text-purple-500":"text-gray-500";return c.jsxs("div",{className:"flex items-center gap-3 pt-6 pb-2 px-1 select-none","data-date-separator":t,children:[c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsx("span",{className:`text-[13px] font-semibold ${h()}`,children:d}),f&&c.jsx("span",{className:"text-[11px] text-gray-400 font-normal",children:f})]}),c.jsx("div",{className:"flex-1 h-[1px] bg-gray-200"}),r>0&&c.jsx("span",{className:"text-[10px] text-gray-400 tabular-nums",children:r})]})},Lee=(t,e)=>{const n=[];for(let r=0;r<e;r++){const s=new Date(t);s.setDate(s.getDate()+r);const i=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),a=String(s.getDate()).padStart(2,"0");n.push(`${i}-${o}-${a}`)}return n},$ee=t=>{const e=new Date,n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=`${n}-${r}-${s}`;return t===i},zee=t=>{const e=new Date;e.setDate(e.getDate()+1);const n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=`${n}-${r}-${s}`;return t===i},TR=({rootParentId:t})=>{const{visibleTasks:e,focusedTaskId:n,setFocusedTaskId:r,editingTaskId:s,setEditingTaskId:i,expandedTaskIds:o,endDrag:a,dragState:l,updateDropState:u,updateGhostPosition:d,selectedTaskIds:f,setSelectedTaskIds:h,handleSelection:p,selectionAnchor:m,tasks:y,tags:b,pendingFocusTaskId:g,setPendingFocusTaskId:v,view:w,addTask:_,reviewTask:D,emptyTrash:k,restoreTrash:A,t:N,archivedTasks:E,restoreArchivedTask:S,deleteArchivedTask:T,updateArchivedTask:C,batchDeleteArchivedTasks:O,batchDeleteTasks:P,batchUpdateTasks:H,duplicateTasks:M,leavingTaskIds:I,dismissLeavingTasks:K,themeSettings:G}=x.useContext(jn),R=x.useRef(null),Ee=x.useRef(null),ge=x.useRef(null),[F,B]=x.useState(new Date);x.useEffect(()=>{const de=()=>{const tt=new Date;tt.getDate()!==F.getDate()&&B(tt)},ve=setInterval(de,6e4);return window.addEventListener("focus",de),()=>{clearInterval(ve),window.removeEventListener("focus",de)}},[F]);const se=x.useRef(null),[We,ut]=x.useState("none"),oe=x.useMemo(()=>{if(!t)return e;const de=ht=>{const Xe=w==="allview"||w==="project"?"all":w;return ht.view_orders&&ht.view_orders[Xe]!==void 0?ht.view_orders[Xe]:ht.order_index||0},ve=y.filter(ht=>ht.parent_id===t&&ht.status!=="deleted"&&ht.status!=="logged").sort((ht,Xe)=>de(ht)-de(Xe)||(ht.created_at||"").localeCompare(Xe.created_at||""));let tt=0;const st=(ht,Xe=0,At=[])=>{let jt=[];return ht.forEach(Q=>{const me=y.filter(ze=>ze.parent_id===Q.id&&ze.status!=="logged"&&ze.status!=="deleted").sort((ze,mt)=>de(ze)-de(mt)||(ze.created_at||"").localeCompare(mt.created_at||"")),He=me.length>0,J=o.includes(Q.id),Pe=[...At,Q.id];jt.push({data:Q,depth:Xe,hasChildren:He,isExpanded:J,path:Pe,index:tt++}),He&&J&&(jt=[...jt,...st(me,Xe+1,Pe)])}),jt};return st(ve)},[e,t,y,o,w]);let je=t?oe:e;const te=x.useMemo(()=>{if(We==="none"||je.length===0)return null;let de=Date.now(),ve=0;return je.forEach(tt=>{const st=tt.data.updated_at?new Date(tt.data.updated_at).getTime():0;st>0&&(st<de&&(de=st),st>ve&&(ve=st))}),ve===de&&(ve=de+1),{minTime:de,maxTime:ve}},[We,je]),$e=de=>{if(!te||We==="none")return;const ve=de.updated_at?new Date(de.updated_at).getTime():0;if(ve===0)return;const tt=(ve-te.minTime)/(te.maxTime-te.minTime),st=Math.max(0,Math.min(1,tt));return We==="recent"?`rgba(255, 0, 0, ${.02+st*.18})`:`rgba(250, 204, 21, ${.02+st*.18})`},Te=x.useRef(null),Je=x.useCallback((de,ve)=>{r(ve);const tt=de.shiftKey||de.shiftKey,st=de.ctrlKey||de.metaKey;if(tt){const ht=Te.current||n||ve;Te.current=ht;const Xe=je.findIndex(jt=>jt.data.id===ht),At=je.findIndex(jt=>jt.data.id===ve);if(Xe!==-1&&At!==-1){const[jt,Q]=Xe<At?[Xe,At]:[At,Xe],me=je.slice(jt,Q+1).map(He=>He.data.id);h(me)}}else st?(Te.current=ve,h(ht=>ht.includes(ve)?ht.filter(Xe=>Xe!==ve):[...ht,ve])):(Te.current=ve,h([ve]))},[je,n,r,h]),Ye=w==="upcoming"?Je:p;x.useEffect(()=>{const de=ve=>{var ht;if(s)return;const tt=document.activeElement;if((tt==null?void 0:tt.tagName)==="INPUT"||(tt==null?void 0:tt.tagName)==="TEXTAREA"||tt!=null&&tt.isContentEditable||tt!=null&&tt.closest("[data-tag-id]")||document.querySelector("[data-search-modal]"))return;if((ve.metaKey||ve.ctrlKey)&&(ve.key==="a"||ve.key==="A")){ve.preventDefault();const Xe=je.map(At=>At.data.id);h(Xe);return}if((ve.metaKey||ve.ctrlKey)&&(ve.key==="t"||ve.key==="T")){ve.preventDefault();const Xe=f.length>0?f:n?[n]:[];if(Xe.length>0){const At=new Date().toISOString().split("T")[0];H(Xe.map(jt=>({id:jt,data:{start_date:At,status:"active"}})))}return}if((ve.metaKey||ve.ctrlKey)&&(ve.key==="d"||ve.key==="D")){ve.preventDefault();const Xe=f.length>0?f:n?[n]:[];Xe.length>0&&M(Xe);return}const st=je.findIndex(Xe=>Xe.data.id===n);if(ve.metaKey||ve.ctrlKey){if(ve.key==="ArrowUp"){if(ve.preventDefault(),je.length>0){const Xe=je[0];r(Xe.data.id),Ye({shiftKey:!1,ctrlKey:!1},Xe.data.id)}return}if(ve.key==="ArrowDown"){if(ve.preventDefault(),je.length>0){const Xe=je[je.length-1];r(Xe.data.id),Ye({shiftKey:!1,ctrlKey:!1},Xe.data.id)}return}}if(ve.shiftKey&&(ve.key==="ArrowDown"||ve.key==="ArrowUp")){ve.preventDefault();let Xe=st;ve.key==="ArrowDown"&&(Xe=Math.min(st+1,je.length-1)),ve.key==="ArrowUp"&&(Xe=Math.max(st-1,0));const At=je[Xe];At&&(r(At.data.id),Ye({shiftKey:!0,preventDefault:()=>{}},At.data.id));return}if(ve.key==="ArrowDown"&&!ve.altKey){ve.preventDefault();const Xe=st+1;if(Xe<je.length){const At=je[Xe];r(At.data.id),Ye({shiftKey:!1,ctrlKey:!1},At.data.id)}}else if(ve.key==="ArrowUp"&&!ve.altKey){ve.preventDefault();const Xe=st-1;if(Xe>=0){const At=je[Xe];r(At.data.id),Ye({shiftKey:!1,ctrlKey:!1},At.data.id)}}else if(ve.key==="Enter")st!==-1&&!s&&!ve.altKey&&w!=="trash"&&(ve.preventDefault(),i(je[st].data.id));else if(ve.key===" "&&!s&&w!=="trash")if(ve.preventDefault(),st!==-1){se.current=n;const Xe=je[st],At=Xe.data.parent_id,jt=ze=>ze.view_orders&&ze.view_orders[w]!==void 0?ze.view_orders[w]:w==="today"?9e8+new Date(ze.created_at).getTime()/1e3:ze.order_index||0,Q=jt(Xe.data);let me=null;for(let ze=st+1;ze<je.length;ze++){const mt=je[ze];if(mt.depth<=Xe.depth&&mt.data.parent_id!==At)break;if(mt.data.parent_id===At){me=jt(mt.data);break}}let He;me!==null?He=(Q+me)/2:He=Q+1e4;const J=b.find(ze=>ze.name.toLowerCase()==="prompt"),Pe={title:"",parent_id:At,status:Xe.data.status,tags:w==="prompt"&&J?[J.id]:Xe.data.tags,color:Xe.data.color,start_date:Xe.data.start_date,order_index:He,view_orders:{[w]:He}};_(Pe).then(ze=>{v(ze),h([])})}else{const Xe=new Date().toISOString().split("T")[0],At=b.find(ze=>ze.name.toLowerCase()==="prompt"),jt=b.find(ze=>ze.name.toLowerCase()==="note"),Q=b.find(ze=>ze.name.toLowerCase()==="journal"),me=b.find(ze=>ze.name.includes("")),He=ze=>ze.view_orders&&ze.view_orders[w]!==void 0?ze.view_orders[w]:w==="today"?9e8+new Date(ze.created_at).getTime()/1e3:ze.order_index||0;let J=1e4;if(je.length>0){const ze=je.filter(mt=>!mt.data.parent_id);if(ze.length>0){const mt=ze[ze.length-1];J=He(mt.data)+1e4}else{const mt=je[je.length-1];J=He(mt.data)+1e4}}const Pe={title:"",parent_id:null,status:"inbox",tags:[],order_index:J,view_orders:{[w]:J}};if(w==="today")Pe.start_date=Xe,Pe.status="active";else if(w==="prompt")Pe.status="active",At&&(Pe.tags=[At.id]);else if(w==="journal")Pe.status="active",jt?Pe.tags=[jt.id]:Q&&(Pe.tags=[Q.id]);else if(w==="waiting")Pe.status="waiting",me&&(Pe.tags=[me.id]);else if(w==="focus")Pe.status="active";else if(w==="upcoming"){const ze=new Date;ze.setDate(ze.getDate()+1),Pe.start_date=ze.toISOString().split("T")[0],Pe.status="active"}_(Pe).then(ze=>{v(ze),h([])})}else if((ve.key==="Delete"||ve.key==="Backspace")&&!s){if(["INPUT","TEXTAREA"].includes(((ht=document.activeElement)==null?void 0:ht.tagName)||""))return;const Xe=f.length>0?f:n?[n]:[];Xe.length>0&&(ve.preventDefault(),P(Xe,w==="trash"),n&&Xe.includes(n))}};return window.addEventListener("keydown",de),()=>window.removeEventListener("keydown",de)},[je,n,o,s,m,_,i,r,Ye,w,b,f,P,H,M]);const Ke=!1,lt=de=>{var ye;if(w==="focus"||w==="upcoming"||w==="recent"||(de.preventDefault(),!l.isDragging||!R.current))return;if(d(de.clientX,de.clientY),ge.current){u({dropIndex:null,indicatorTop:0});return}const ve=R.current.getBoundingClientRect(),tt=de.clientX,st=de.clientY,ht=tt-ve.left,Xe=100,At=10,jt=window.innerHeight,Q=document.querySelector("main");Q&&(st<Xe?Ee.current||(Ee.current=setInterval(()=>{Q.scrollTop-=At},16)):st>jt-Xe?Ee.current||(Ee.current=setInterval(()=>{Q.scrollTop+=At},16)):Ee.current&&(clearInterval(Ee.current),Ee.current=null));let me=-1,He=null,J=document.elementFromPoint(tt,st);for(;J&&J!==R.current&&J!==document.body;){if(J.hasAttribute("data-task-index")){me=parseInt(J.getAttribute("data-task-index")||"-1"),He=J.getBoundingClientRect();break}J=J.parentElement}if(me===-1&&je.length>0&&R.current){const Re=R.current.querySelector("[data-task-index]:last-child");if(Re){const _e=Re.getBoundingClientRect();st>_e.bottom&&(me=parseInt(Re.getAttribute("data-task-index")||"-1")+1,He=_e)}}if(me===-1){const Re=(ye=R.current)==null?void 0:ye.querySelector("[data-task-index]:first-child");if(Re){const _e=Re.getBoundingClientRect();st<_e.top&&(me=0,He=_e)}if(me===-1)return}let Pe=me,ze=me;if(He){const Re=He.top+He.height/2;st>Re&&me<je.length&&(Pe=me+1)}const mt=ht-l.dragOffsetX+l.originalDepth*gp;let Wt=Math.floor(mt/gp);Wt<0&&(Wt=0);const Dn=je[Pe-1],Ht=Dn?Dn.depth+1:0;Wt>Ht&&(Wt=Ht);let cn=0;He?Pe===me?cn=He.top-ve.top:cn=He.bottom-ve.top:Pe===0&&(cn=0);let pe=Wt*gp+40,q=ve.width-pe-20;w==="today"&&(Wt=0,pe=40,q=ve.width-60),u({dropIndex:Pe,dropDepth:Wt,indicatorTop:cn,indicatorLeft:pe,indicatorWidth:q,anchorTaskIndex:ze})},St=()=>{Ee.current&&(clearInterval(Ee.current),Ee.current=null),a(je)},X=de=>{const ve=de||se.current||n;i(null),ve&&(r(ve),h([ve]),setTimeout(()=>{var st;const tt=(st=R.current)==null?void 0:st.querySelector(`[data-task-id="${ve}"]`);tt&&(tt.focus(),tt.scrollIntoView({block:"nearest",behavior:"smooth"}))},100)),se.current=null,g&&v(null)},ee=()=>{if(l.dropIndex===null||l.dropIndex===0)return"blue";const de=je[l.dropIndex-1];return(de==null?void 0:de.data.color)||"blue"},ie=je,ce=x.useMemo(()=>w!=="inbox"||I.length===0?[]:I.map(de=>y.find(ve=>ve.id===de)).filter(Boolean).map((de,ve)=>({data:de,depth:0,hasChildren:!1,isExpanded:!1,path:[de.id],index:ve})),[w,I,y]),[Z,ne]=x.useState(!0),Se=je,Ie=x.useMemo(()=>{if(w!=="allview"&&w!=="logbook")return[];const de=new Map(E.map(ht=>[ht.id,ht])),ve=E.filter(ht=>!ht.parent_id||!de.has(ht.parent_id)).sort((ht,Xe)=>new Date(Xe.archived_at||Xe.completed_at||0).getTime()-new Date(ht.archived_at||ht.completed_at||0).getTime()),tt=[],st=(ht,Xe,At)=>{const jt=E.filter(Q=>Q.parent_id===ht.id);tt.push({data:ht,depth:Xe,hasChildren:jt.length>0,isExpanded:!0,path:[...At,ht.id],index:tt.length}),jt.forEach(Q=>st(Q,Xe+1,[...At,ht.id]))};return ve.forEach(ht=>st(ht,0,[])),tt},[E,w]),[fe,Oe]=x.useState(null),[et,xt]=x.useState(""),[It,ue]=x.useState([]),Ne=x.useRef(null),Ue=de=>{if(!de)return"";const ve=new Date(de);return`${ve.getFullYear()}-${String(ve.getMonth()+1).padStart(2,"0")}-${String(ve.getDate()).padStart(2,"0")}`},Ze=de=>{if(et){const ve=new Date(et);isNaN(ve.getTime())||C(de,{completed_at:ve.toISOString()})}Oe(null)},xe=(de,ve)=>{if(de.stopPropagation(),de.shiftKey&&Ne.current){const tt=Ie.findIndex(ht=>ht.data.id===Ne.current),st=Ie.findIndex(ht=>ht.data.id===ve);if(tt!==-1&&st!==-1){const[ht,Xe]=tt<st?[tt,st]:[st,tt],At=Ie.slice(ht,Xe+1).map(jt=>jt.data.id);ue(At)}}else de.metaKey||de.ctrlKey?(Ne.current=ve,ue(tt=>tt.includes(ve)?tt.filter(st=>st!==ve):[...tt,ve])):(Ne.current=ve,ue([ve]))};if(w==="logbook")return Ie.length===0?c.jsxs("div",{className:"text-center py-20 opacity-20",children:[c.jsx(n1,{size:48,className:"mx-auto"}),c.jsx("p",{className:"text-xs mt-2",children:""})]}):c.jsxs("div",{className:"pb-20 relative min-h-[500px]",onClick:()=>ue([]),children:[c.jsxs("div",{className:"flex items-center gap-2 mb-6 px-2",children:[c.jsx(am,{size:16,className:"text-gray-400"}),c.jsx("span",{className:"text-[13px] font-bold text-gray-500",children:""}),c.jsx("span",{className:"text-[11px] font-medium px-1.5 py-0.5 rounded-full bg-gray-100 text-gray-500",children:Ie.length}),c.jsx("div",{className:"flex-1 h-[2px] rounded-full bg-gradient-to-r from-gray-200 to-transparent"}),It.length>0&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:"text-[11px] text-indigo-600 font-medium",children:[" ",It.length," "]}),c.jsxs("button",{onClick:de=>{de.stopPropagation(),confirm(` ${It.length} `)&&(O(It),ue([]))},className:"px-2 py-1 bg-red-50 text-red-600 text-[10px] font-medium rounded hover:bg-red-100 transition-colors flex items-center gap-1",children:[c.jsx(jr,{size:12}),""]}),c.jsx("button",{onClick:de=>{de.stopPropagation(),ue([])},className:"px-2 py-1 bg-gray-100 text-gray-600 text-[10px] font-medium rounded hover:bg-gray-200 transition-colors",children:""})]})]}),Ie.map(de=>{const ve=It.includes(de.data.id);return c.jsx("div",{className:`relative group mb-1 py-2 px-3 rounded-lg transition-colors cursor-pointer ${ve?"bg-indigo-50 border border-indigo-200":"hover:bg-theme-hover"}`,style:{marginLeft:`${de.depth*24}px`},onClick:tt=>xe(tt,de.data.id),children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:`w-[18px] h-[18px] rounded-full border-2 flex items-center justify-center flex-shrink-0 ${ve?"border-indigo-500 bg-indigo-500":"border-emerald-500 bg-emerald-500"}`,children:c.jsx(Zn,{size:12,className:"text-white"})}),c.jsx("span",{className:"flex-1 text-theme-primary opacity-70 truncate",children:de.data.title}),c.jsxs("div",{className:"flex items-center gap-1 text-[11px] text-gray-400",children:[c.jsx(So,{size:12}),fe===de.data.id?c.jsx("input",{type:"date",autoFocus:!0,value:et,onChange:tt=>xt(tt.target.value),onBlur:()=>Ze(de.data.id),onKeyDown:tt=>{tt.key==="Enter"&&Ze(de.data.id),tt.key==="Escape"&&Oe(null)},onClick:tt=>tt.stopPropagation(),className:"bg-white border border-gray-300 rounded px-1 py-0.5 text-[11px] w-28"}):c.jsx("span",{className:"cursor-pointer hover:text-indigo-500 transition-colors",onDoubleClick:tt=>{tt.stopPropagation(),Oe(de.data.id),xt(Ue(de.data.completed_at))},title:"",children:Ue(de.data.completed_at)||""})]}),c.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[c.jsx("button",{onClick:tt=>{tt.stopPropagation(),S(de.data.id)},className:"px-2 py-1 bg-emerald-50 text-emerald-600 text-[10px] font-medium rounded hover:bg-emerald-100 transition-colors",children:""}),c.jsx("button",{onClick:tt=>{tt.stopPropagation(),confirm("")&&T(de.data.id)},className:"p-1 text-gray-400 hover:text-red-500 transition-colors",title:"",children:c.jsx(jr,{size:14})})]})]})},de.data.id)})]});if(je.length===0&&(w!=="allview"||Ie.length===0))return c.jsxs("div",{className:"text-center py-20 opacity-20",children:[c.jsx(n1,{size:48,className:"mx-auto"}),c.jsx("p",{className:"text-xs mt-2",children:"No tasks"})]});const ct=de=>de.start_date?new Date(de.start_date).toISOString().split("T")[0]:de.due_date?new Date(de.due_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],dt=()=>{const de=Lee(F,8),ve=new Map,tt=[],st=[],ht=F.getFullYear(),Xe=String(F.getMonth()+1).padStart(2,"0"),At=String(F.getDate()).padStart(2,"0"),jt=`${ht}-${Xe}-${At}`;return je.forEach(Q=>{const me=ct(Q.data);me<jt?tt.push(Q):de.includes(me)?(ve.has(me)||ve.set(me,[]),ve.get(me).push(Q)):st.push(Q)}),c.jsxs(c.Fragment,{children:[tt.length>0&&c.jsxs("div",{"data-date-group":"overdue",children:[c.jsxs("div",{className:"flex items-center gap-3 pt-2 pb-2 px-1 select-none",children:[c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsx("span",{className:"text-[13px] font-semibold text-red-500",children:""}),c.jsxs("span",{className:"text-[11px] text-red-400 font-normal",children:[tt.length," "]})]}),c.jsx("div",{className:"flex-1 h-[1px] bg-red-200"})]}),tt.map(Q=>c.jsx(Ln.Fragment,{children:s===Q.data.id?c.jsx(Fo,{initialData:Q.data,onClose:X},Q.data.id):c.jsx("div",{className:"relative group",children:c.jsx(gl,{flatTask:Q,isFocused:n===Q.data.id,onEdit:()=>i(Q.data.id)},Q.data.id)})},Q.data.id))]}),de.map(Q=>{const me=ve.get(Q)||[];return c.jsxs("div",{"data-date-group":Q,children:[c.jsx(Pee,{date:Q,isToday:$ee(Q),isTomorrow:zee(Q),taskCount:me.length}),me.length===0?c.jsx("div",{className:"h-12 mx-2 mb-2 border-2 border-dashed border-gray-200 rounded-lg flex items-center justify-center text-gray-300 text-xs transition-all hover:border-gray-300 hover:bg-gray-50","data-empty-drop-zone":Q,onDragEnter:He=>{He.preventDefault(),ge.current=Q,He.currentTarget.classList.add("border-blue-400","bg-blue-50","text-blue-400")},onDragOver:He=>{He.preventDefault(),He.dataTransfer.dropEffect="move",ge.current=Q,d(He.clientX,He.clientY)},onDragLeave:He=>{ge.current=null,He.currentTarget.classList.remove("border-blue-400","bg-blue-50","text-blue-400")},onDrop:He=>{He.preventDefault(),He.stopPropagation(),He.currentTarget.classList.remove("border-blue-400","bg-blue-50","text-blue-400");const J=ge.current||Q;ge.current=null;let Pe=[];try{const ze=He.dataTransfer.getData("application/json");ze&&(Pe=JSON.parse(ze))}catch{}if(Pe.length===0){const ze=He.dataTransfer.getData("text/plain");ze&&(Pe=[ze])}Pe.length===0&&l.draggedId&&(Pe=f.includes(l.draggedId)?f:[l.draggedId]),Pe.length>0&&H(Pe.map(ze=>({id:ze,data:{start_date:J,is_all_day:!0}}))),a()},children:""}):me.map(He=>c.jsx(Ln.Fragment,{children:s===He.data.id?c.jsx(Fo,{initialData:He.data,onClose:X},He.data.id):c.jsx("div",{className:"relative group",children:c.jsx(gl,{flatTask:He,isFocused:n===He.data.id,onEdit:()=>i(He.data.id)},He.data.id)})},He.data.id))]},Q)}),st.length>0&&(()=>{const Q=new Map;return st.forEach(He=>{const J=ct(He.data),Pe=new Date(J+"T12:00:00"),ze=`${Pe.getFullYear()}-${String(Pe.getMonth()+1).padStart(2,"0")}`;Q.has(ze)||Q.set(ze,[]),Q.get(ze).push(He)}),Array.from(Q.keys()).sort().map(He=>{const[J,Pe]=He.split("-"),ze=["1","2","3","4","5","6","7","8","9","10","11","12"][parseInt(Pe)-1],mt=Q.get(He),Wt=new Date().getFullYear(),Dn=parseInt(J)!==Wt;return c.jsxs("div",{"data-date-group":He,children:[c.jsxs("div",{className:"flex items-center gap-3 pt-6 pb-2 px-1 select-none",children:[c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsx("span",{className:"text-[13px] font-semibold text-gray-400",children:ze}),Dn&&c.jsx("span",{className:"text-[11px] text-gray-300 font-normal",children:J})]}),c.jsx("div",{className:"flex-1 h-[1px] bg-gray-200"}),c.jsx("span",{className:"text-[10px] text-gray-400 tabular-nums",children:mt.length})]}),mt.map(Ht=>c.jsx(Ln.Fragment,{children:s===Ht.data.id?c.jsx(Fo,{initialData:Ht.data,onClose:X},Ht.data.id):c.jsx("div",{className:"relative group",children:c.jsx(gl,{flatTask:Ht,isFocused:n===Ht.data.id,onEdit:()=>i(Ht.data.id)},Ht.data.id)})},Ht.data.id))]},He)})})()]})},ft=de=>de.map(ve=>c.jsx(Ln.Fragment,{children:s===ve.data.id?c.jsx(Fo,{initialData:ve.data,onClose:X},ve.data.id):c.jsx("div",{className:"relative group",children:c.jsx(gl,{flatTask:ve,isFocused:n===ve.data.id,onEdit:()=>i(ve.data.id),backgroundColor:$e(ve.data)},ve.data.id)})},ve.data.id));return c.jsx(c.Fragment,{children:c.jsxs("div",{ref:R,className:"pb-20 relative min-h-[500px]",onDragOver:lt,onDragLeave:de=>{var ve;(ve=R.current)!=null&&ve.contains(de.relatedTarget)||u({dropIndex:null})},onDrop:de=>{de.preventDefault(),St()},onDragEnd:St,children:[(w==="allview"||w==="project"||w==="inbox")&&c.jsx("div",{className:"flex justify-end px-4 py-2 border-b border-gray-100/50 mb-2 sticky top-0 bg-white/95 backdrop-blur z-20",children:c.jsxs("div",{className:"flex items-center gap-2 bg-gray-50/80 p-1 rounded-lg border border-gray-100",children:[c.jsx("span",{className:"text-[9px] text-gray-400 font-bold uppercase tracking-wider px-1",children:"Mark:"}),c.jsxs("div",{className:"flex gap-0.5",children:[c.jsx("button",{onClick:()=>ut("none"),className:`px-2 py-0.5 text-[10px] rounded transition-all ${We==="none"?"bg-white shadow-sm text-gray-800 font-bold":"text-gray-400 hover:text-gray-600"}`,children:"Off"}),c.jsxs("button",{onClick:()=>ut("recent"),className:`px-2 py-0.5 text-[10px] rounded transition-all flex items-center gap-1 ${We==="recent"?"bg-red-50 text-red-600 shadow-sm font-bold ring-1 ring-red-100":"text-gray-400 hover:text-red-500"}`,children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),"Recent"]}),c.jsxs("button",{onClick:()=>ut("frequent"),className:`px-2 py-0.5 text-[10px] rounded transition-all flex items-center gap-1 ${We==="frequent"?"bg-amber-50 text-amber-600 shadow-sm font-bold ring-1 ring-amber-100":"text-gray-400 hover:text-amber-500"}`,children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-amber-500"}),"Frequent"]})]})]})}),w==="today"&&G.showRelationshipLines!==!1&&c.jsx(Oee,{containerRef:R,tasks:je.map(de=>({data:{id:de.data.id,parent_id:de.data.parent_id,color:de.data.color}}))}),c.jsx(Aee,{show:l.isDragging&&l.dropIndex!==null,top:l.indicatorTop,left:l.indicatorLeft,width:l.indicatorWidth,depth:l.dropDepth,color:ee()}),w==="trash"&&c.jsxs("div",{className:"flex items-center justify-between mb-6 px-4 py-3 bg-gray-50 rounded-lg border border-dashed border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(jr,{className:"text-gray-400",size:18}),c.jsx("span",{className:"font-medium text-gray-500 text-sm",children:N("trashEmptyTitle")})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[je.length>0&&c.jsxs("button",{onClick:()=>{confirm(N("restoreTrashConfirm")||"Are you sure?")&&A()},className:"px-3 py-1.5 bg-white border border-gray-200 text-indigo-500 text-xs font-medium rounded hover:bg-indigo-50 hover:border-indigo-200 transition-colors shadow-sm flex items-center gap-1",children:[c.jsx(Dg,{size:12}),N("restoreTrash")||"Restore All"]}),je.length>0&&c.jsx("button",{onClick:()=>{confirm(N("emptyTrashConfirm"))&&k()},className:"px-3 py-1.5 bg-white border border-gray-200 text-red-500 text-xs font-medium rounded hover:bg-red-50 hover:border-red-200 transition-colors shadow-sm",children:N("emptyTrash")})]})]}),w==="today"?dt():w==="upcoming"?je.map((de,ve)=>c.jsx(Ln.Fragment,{children:s===de.data.id?c.jsx(Fo,{initialData:de.data,onClose:X},de.data.id):c.jsxs("div",{className:"relative group",children:[c.jsx("span",{className:"absolute -left-6 top-1/2 -translate-y-1/2 text-[9px] font-mono text-gray-300 select-none",children:ve+1}),c.jsx(gl,{flatTask:de,isFocused:n===de.data.id,onEdit:()=>i(de.data.id),onSelect:Je},de.data.id)]})},de.data.id)):w==="allview"?c.jsxs(c.Fragment,{children:[ft(Se),Ie.length>0&&c.jsxs("div",{className:"mt-12",children:[c.jsxs("button",{onClick:()=>ne(!Z),className:"flex items-center gap-2 mb-4 px-2 w-full text-left group",children:[Z?c.jsx(is,{size:14,className:"text-gray-400"}):c.jsx(rs,{size:14,className:"text-gray-400"}),c.jsx(am,{size:14,className:"text-gray-400"}),c.jsx("span",{className:"text-[13px] font-bold text-gray-400",children:""}),c.jsx("span",{className:"text-[11px] font-medium px-1.5 py-0.5 rounded-full bg-gray-100 text-gray-500",children:Ie.length}),c.jsx("div",{className:"flex-1 h-[2px] rounded-full bg-gradient-to-r from-gray-200 to-transparent"})]}),!Z&&c.jsx("div",{className:"opacity-60",children:Ie.map(de=>c.jsxs("div",{className:"relative group",style:{marginLeft:`${de.depth*24}px`},children:[c.jsx(gl,{flatTask:de,isFocused:!1,onEdit:()=>{}}),c.jsx("button",{onClick:ve=>{ve.stopPropagation(),S(de.data.id)},className:"absolute right-2 top-2 z-10 opacity-0 group-hover:opacity-100 px-3 py-1 bg-emerald-600 text-white text-[10px] font-bold rounded-full shadow-lg hover:bg-emerald-700 transition-all flex items-center gap-1",children:""})]},de.data.id))})]})]}):ft(ie),Ke,w==="inbox"&&ce.length>0&&c.jsxs("div",{className:"mt-8 border-2 border-dashed border-amber-200 rounded-xl p-4 bg-amber-50/50",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Rz,{size:16,className:"text-amber-500"}),c.jsxs("span",{className:"text-[13px] font-semibold text-amber-700",children:[ce.length," "]})]}),c.jsx("button",{onClick:K,className:"px-3 py-1 text-xs font-medium bg-amber-100 hover:bg-amber-200 text-amber-700 rounded-full transition-colors",children:""})]}),c.jsx("div",{className:"space-y-1 opacity-70",children:ce.map(de=>{const ve=b.find(me=>["project",""].includes(me.name.trim().toLowerCase())),tt=b.find(me=>me.name.includes("")||["someday","inspiration","/"].includes(me.name.trim().toLowerCase())),st=b.find(me=>["note","journal","",""].includes(me.name.trim().toLowerCase())),ht=b.find(me=>["prompt",""].includes(me.name.trim().toLowerCase())),Xe=st,At=tt,jt=de.data.tags||[];let Q="";return de.data.start_date?Q="":de.data.status==="someday"||de.data.status==="waiting"||At&&jt.includes(At.id)?Q="/":de.data.parent_id||ve&&jt.includes(ve.id)?Q="":tt&&jt.includes(tt.id)?Q="/":st&&jt.includes(st.id)||Xe&&jt.includes(Xe.id)?Q="":ht&&jt.includes(ht.id)&&(Q=""),c.jsxs("div",{className:"flex items-center justify-between p-2 bg-white/80 rounded-lg",children:[c.jsx("span",{className:"text-sm text-theme-primary truncate flex-1",children:de.data.title||"()"}),c.jsxs("span",{className:"text-[10px] text-amber-600 bg-amber-100 px-2 py-0.5 rounded-full ml-2",children:[" ",Q]})]},de.data.id)})})]})]})})},Fee=()=>{const{tasks:t,tags:e,addTask:n,addTag:r,user:s,t:i}=x.useContext(jn),[o,a]=x.useState(null),[l,u]=x.useState(null),[d,f]=x.useState(()=>{const E=localStorage.getItem(`note_view_expanded_${s==null?void 0:s.id}`);return E?JSON.parse(E):{}});x.useEffect(()=>{s!=null&&s.id&&localStorage.setItem(`note_view_expanded_${s.id}`,JSON.stringify(d))},[d,s==null?void 0:s.id]);const h=x.useMemo(()=>{const E=e.find(S=>S.name.trim().toLowerCase()==="note");return E?E.id:null},[e]),p=x.useMemo(()=>e.filter(E=>E.name.startsWith("#")),[e]),m=x.useMemo(()=>{if(!h)return[];let E=t.filter(S=>S.status!=="deleted"&&S.tags.includes(h));return l&&(E=E.filter(S=>S.tags.includes(l))),E.sort((S,T)=>new Date(T.created_at).getTime()-new Date(S.created_at).getTime())},[t,h,l]),y=x.useMemo(()=>{const E={},S=[];return m.forEach(T=>{const C=T.tags.filter(O=>{if(O===h)return!1;const P=e.find(H=>H.id===O);return P&&!P.name.startsWith("#")});if(C.length===0)S.push(T);else{const O=C[0];if(!E[O]){const P=e.find(H=>H.id===O);E[O]={tag:P,tasks:[]}}E[O].tasks.push(T)}}),{categories:E,uncategorized:S}},[m,h,e]),b=E=>E.tags.map(S=>e.find(T=>T.id===S)).filter(S=>S&&S.name.startsWith("#")),g=E=>{f(S=>({...S,[E]:!S[E]}))},v=E=>d[E]!==!1,w=async()=>{let E=h;if(E||(E=await r("note")),E){const S=await n({title:"",tags:[E],is_project:!1,status:"active"});setTimeout(()=>{a({id:S})},100)}},_=E=>{a(E)},D=()=>{a(null)},k=E=>{u(l===E?null:E)},A=E=>{const S=b(E);return c.jsxs("div",{onClick:()=>_(E),className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden cursor-pointer group hover:shadow-md transition-all hover:-translate-y-0.5",children:[E.images&&E.images.length>0&&c.jsx("div",{className:"aspect-[16/9] bg-gray-100 relative overflow-hidden",children:c.jsx("img",{src:E.images[0],alt:E.title,className:"w-full h-full object-cover transition-transform group-hover:scale-105"})}),c.jsxs("div",{className:"p-4",children:[S.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:S.map(T=>T&&c.jsx("button",{onClick:C=>{C.stopPropagation(),k(T.id)},className:`text-[10px] px-2 py-0.5 rounded-full font-medium transition-all ${l===T.id?"bg-emerald-500 text-white":"bg-emerald-50 text-emerald-600 hover:bg-emerald-100"}`,children:T.name},T.id))}),c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(Xf,{size:14,className:"text-indigo-400 mt-1 flex-shrink-0"}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h3",{className:`font-medium text-gray-800 line-clamp-2 text-sm ${E.title?"":"italic text-gray-400"}`,children:E.title||""}),E.description&&c.jsx("p",{className:"text-xs text-gray-500 line-clamp-2 mt-1",children:E.description.replace(/<[^>]*>/g,"").slice(0,100)})]})]}),c.jsxs("div",{className:"flex items-center justify-between mt-3 pt-2 border-t border-gray-50",children:[c.jsx("span",{className:"text-[10px] text-gray-400",children:new Date(E.created_at).toLocaleDateString()}),c.jsx("div",{className:"flex flex-wrap gap-1",children:E.tags.filter(T=>{if(T===h)return!1;const C=e.find(O=>O.id===T);return C&&!C.name.startsWith("#")}).slice(0,2).map(T=>{const C=e.find(O=>O.id===T);return C?c.jsx(ED,{tag:C,size:"small"},T):null})})]})]})]},E.id)},N=(E,S)=>{var C,O;const T=v(E);return c.jsxs("div",{className:"mb-6",children:[c.jsxs("button",{onClick:()=>g(E),className:"flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-gray-100 transition-colors w-full text-left group",children:[T?c.jsx(rs,{size:16,className:"text-gray-400"}):c.jsx(is,{size:16,className:"text-gray-400"}),c.jsx("span",{className:"font-bold text-sm",style:{color:((C=S.tag)==null?void 0:C.color)||"#6366f1"},children:((O=S.tag)==null?void 0:O.name)||""}),c.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(",S.tasks.length,")"]})]}),T&&c.jsx("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pl-6",children:S.tasks.map(A)})]},E)};return c.jsxs("div",{className:"h-full flex flex-col bg-white overflow-hidden relative",children:[c.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-white z-10",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("h2",{className:"font-bold text-gray-700 flex items-center gap-2",children:[c.jsx(xf,{size:18}),i("journal")]}),p.length>0&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(pz,{size:14,className:"text-gray-400"}),c.jsxs("div",{className:"flex flex-wrap gap-1",children:[p.slice(0,5).map(E=>c.jsx("button",{onClick:()=>k(E.id),className:`text-[10px] px-2 py-0.5 rounded-full font-medium transition-all ${l===E.id?"bg-emerald-500 text-white":"bg-gray-100 text-gray-600 hover:bg-emerald-50 hover:text-emerald-600"}`,children:E.name},E.id)),l&&c.jsxs("button",{onClick:()=>u(null),className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-red-50 text-red-500 hover:bg-red-100 flex items-center gap-1",children:[c.jsx(hn,{size:10}),""]})]})]})]}),c.jsxs("button",{onClick:w,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors shadow-sm",children:[c.jsx(ri,{size:16})," "]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-gray-50/50",children:m.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx(xf,{size:48,className:"mb-4 opacity-20"}),c.jsx("p",{className:"text-sm",children:l?"":""}),c.jsx("p",{className:"text-xs mt-1",children:l?"":"note"})]}):c.jsxs("div",{children:[Object.entries(y.categories).map(([E,S])=>N(E,S)),y.uncategorized.length>0&&c.jsxs("div",{className:"mb-6",children:[c.jsxs("button",{onClick:()=>g("_uncategorized"),className:"flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-gray-100 transition-colors w-full text-left group",children:[v("_uncategorized")?c.jsx(rs,{size:16,className:"text-gray-400"}):c.jsx(is,{size:16,className:"text-gray-400"}),c.jsx("span",{className:"font-bold text-sm text-gray-500",children:""}),c.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(",y.uncategorized.length,")"]})]}),v("_uncategorized")&&c.jsx("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pl-6",children:y.uncategorized.map(A)})]})]})}),o&&c.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm",onClick:D,children:c.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-2xl shadow-2xl max-h-[90vh] overflow-y-auto",onClick:E=>E.stopPropagation(),children:[c.jsx("div",{className:"p-2 border-b border-gray-100 flex justify-end",children:c.jsx("button",{onClick:D,className:"p-2 hover:bg-gray-100 rounded-full text-gray-500",children:c.jsx(hn,{size:20})})}),c.jsx("div",{className:"p-4",children:c.jsx(Fo,{initialData:t.find(E=>E.id===o.id),onClose:D})})]})})]})},Bee={"2024-01-01":"","2024-02-08":"","2024-02-09":"","2024-02-10":"","2024-02-11":"","2024-02-12":"","2024-02-13":"","2024-02-14":"","2024-02-28":"228","2024-04-04":"","2024-04-05":"","2024-06-10":"","2024-09-17":"","2024-10-10":"","2026-01-01":"","2026-02-16":"","2026-02-17":"","2026-02-18":"","2026-02-19":"","2026-02-28":"228","2026-04-04":"","2026-04-05":"","2026-06-19":"","2026-09-25":"","2026-10-10":""},CR=t=>{const e=t.toISOString().split("T")[0];return Bee[e]||null},ER=t=>{const e=t.getFullYear(),n=t.getMonth()+1,r=t.getDate();if(e===2025){if(n===12)return r===24?"":r===21?"":r===1?"":`${(r+10)%30||30}`;if(n===11)return`${(r+9)%30||30}`;if(n===1){if(r===1)return"";if(r===27)return"";if(r===28)return""}return`N${r%30||30}`}if(e===2026){if(n===1)return`${(r+12)%30||28}`;if(n===2){if(r===17)return"";if(r===16)return"";const s=r-17;return s>0?`${s+1}`:`${29+s}`}return`L${n}.${r}`}return""},Uee={"2025-01-05":"","2025-01-20":"","2025-02-03":"","2025-02-18":"","2025-03-05":"","2025-03-20":"","2025-04-04":"","2025-04-20":"","2025-05-05":"","2025-05-21":"","2025-06-05":"","2025-06-21":"","2025-07-07":"","2025-07-22":"","2025-08-07":"","2025-08-23":"","2025-09-07":"","2025-09-23":"","2025-10-08":"","2025-10-23":"","2025-11-07":"","2025-11-22":"","2025-12-07":"","2025-12-21":"","2026-01-05":"","2026-01-20":"","2026-02-04":"","2026-02-19":"","2026-03-06":"","2026-03-21":"","2026-04-05":"","2026-04-20":"","2026-05-06":"","2026-05-21":"","2026-06-06":"","2026-06-21":"","2026-07-07":"","2026-07-23":"","2026-08-08":"","2026-08-23":"","2026-09-08":"","2026-09-23":"","2026-10-08":"","2026-10-23":"","2026-11-07":"","2026-11-22":"","2026-12-07":"","2026-12-22":""},NR=t=>{const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),s=`${e}-${n}-${r}`;return Uee[s]||null},Bi=120,vc=52,Hee=({onDateClick:t,filterTags:e=[],filterTagsExclude:n=[],filterColors:r=[],filterProjects:s=[]})=>{const{tasks:i,tags:o,batchUpdateTasks:a,addTask:l,setEditingTaskId:u,editingTaskId:d,selectedTaskIds:f,setSelectedTaskIds:h,constructionModeEnabled:p,setConstructionModeEnabled:m,setCalendarDate:y,view:b,viewTagFilters:g,themeSettings:v,tagsWithResolvedColors:w}=x.useContext(jn),[_,D]=x.useState(null),k=x.useRef(new Map),A=x.useRef(new Map);x.useEffect(()=>{D(null)},[d]);const N=ie=>{var ne;if(ie.tags&&ie.tags.length>0){const Se=ie.tags.find(Ie=>{const fe=o.find(Oe=>Oe.id===Ie);return fe&&fe.name.toLowerCase().includes("google")});if(Se){if(w&&w[Se])return w[Se];const Ie=o.find(fe=>fe.id===Se);if(Ie!=null&&Ie.color)return Ie.color}for(const Ie of ie.tags){if(w&&w[Ie])return w[Ie];const fe=o.find(Oe=>Oe.id===Ie);if(fe!=null&&fe.color)return fe.color}}const ce=mp(ie,i);if(ce&&ce.color&&ce.color!=="gray"){const Se=Qn[ce.color];if(Se)return Se.color}const Z=ie.color||"blue";return((ne=Qn[Z])==null?void 0:ne.color)||Qn.blue.color},E=x.useRef(null),S=x.useRef(null),T=x.useRef(!1),C=x.useRef(null),[O,P]=x.useState([]),[H,M]=x.useState(null),[I,K]=x.useState(null),[G,R]=x.useState(new Date),[Ee,ge]=x.useState(null),[F,B]=x.useState(null),[se,We]=x.useState({start:0,end:200}),ut=Ln.useMemo(()=>{let ie=i.filter(ce=>ce.status!=="deleted");if(b==="focus"){const ce=g.focus||{include:[],exclude:[]},{include:Z,exclude:ne}=Array.isArray(ce)?{include:ce,exclude:[]}:ce;Z.length>0&&(ie=ie.filter(Se=>Se.tags.some(Ie=>Z.includes(Ie)))),ne.length>0&&(ie=ie.filter(Se=>!Se.tags.some(Ie=>ne.includes(Ie))))}return e.length>0&&(ie=ie.filter(ce=>ce.tags.some(Z=>e.includes(Z)))),n.length>0&&(ie=ie.filter(ce=>!ce.tags.some(Z=>n.includes(Z)))),r.length>0&&(ie=ie.filter(ce=>r.includes(ce.color))),s.length>0&&(ie=ie.filter(ce=>{if(s.includes(ce.id)||ce.parent_id&&s.includes(ce.parent_id))return!0;let Z=i.find(ne=>ne.id===ce.parent_id);for(;Z;){if(s.includes(Z.id))return!0;Z=i.find(ne=>ne.id===(Z==null?void 0:Z.parent_id))}return!1})),ie},[i,b,g,e,n,r,s]),oe=ie=>{const ce=ie.getDay(),Z=new Date(ie);Z.setDate(ie.getDate()-ce),Z.setHours(0,0,0,0);const ne=[];for(let Se=0;Se<7;Se++){const Ie=new Date(Z);Ie.setDate(Z.getDate()+Se),ne.push({date:Ie,isCurrentMonth:!0,isToday:Ti(Ie,new Date)})}return{id:Z.toDateString(),days:ne,firstDate:Z}},je=Ln.useMemo(()=>{const ie=new Map;return ut.forEach(ce=>{if(ce.status==="deleted"||ce.status==="logged")return;const Z=ce.start_date||ce.due_date;if(Z){const ne=new Date(Z),Se=`${ne.getFullYear()}-${ne.getMonth()}-${ne.getDate()}`;ie.has(Se)||ie.set(Se,[]),ie.get(Se).push(ce)}}),ie},[ut]),te=x.useCallback(ie=>{const ce=`${ie.getFullYear()}-${ie.getMonth()}-${ie.getDate()}`;return(je.get(ce)||[]).slice().sort((ne,Se)=>ne.is_all_day&&!Se.is_all_day?-1:!ne.is_all_day&&Se.is_all_day?1:!ne.is_all_day&&!Se.is_all_day?(ne.start_time||"").localeCompare(Se.start_time||""):(ne.order_index||0)-(Se.order_index||0))},[je]);x.useEffect(()=>{const ie=new Date,ce=[],Z=-vc,ne=vc;for(let Se=Z;Se<=ne;Se++){const Ie=new Date(ie);Ie.setDate(ie.getDate()+Se*7),ce.push(oe(Ie))}P(ce),setTimeout(()=>{if(E.current){const Ie=vc*Bi-E.current.clientHeight/2+Bi/2;E.current.scrollTop=Ie}},100)},[]),x.useLayoutEffect(()=>{if(T.current&&E.current){const ie=4*Bi;E.current.scrollTop+=ie,T.current=!1}},[O]);const $e=x.useCallback(()=>{const ie=E.current;if(!ie)return;const{scrollTop:ce,clientHeight:Z,scrollHeight:ne}=ie;ne-ce-Z<500&&P(xt=>{const It=xt[xt.length-1],ue=[];for(let Ne=1;Ne<=4;Ne++){const Ue=new Date(It.firstDate);Ue.setDate(Ue.getDate()+Ne*7),ue.push(oe(Ue))}return[...xt,...ue]}),ce<200&&!T.current&&(T.current=!0,P(xt=>{const It=xt[0],ue=[];for(let Ne=4;Ne>=1;Ne--){const Ue=new Date(It.firstDate);Ue.setDate(Ue.getDate()-Ne*7),ue.push(oe(Ue))}return[...ue,...xt]}));const Se=Math.floor((ce+100)/Bi),Ie=O[Se];if(Ie){const xt=Ie.days[3].date;R(xt)}const fe=6,Oe=Math.floor(ce/Bi)-fe,et=Math.ceil((ce+Z)/Bi)+fe;We(xt=>xt.start===Oe&&xt.end===et?xt:{start:Math.max(0,Oe),end:et})},[O]),Te=async(ie,ce)=>{const Z=ie.toDateString();if(p&&f.length>0){const ne=[...f];if(ce.altKey)for(const Se of ne){const Ie=i.find(fe=>fe.id===Se);Ie&&await l({...Ie,id:void 0,start_date:ie.toISOString()})}else{const Se=ne.map(Ie=>({id:Ie,data:{start_date:ie.toISOString()}}));await a(Se),h([]),m(!1)}M(Z),setTimeout(()=>M(null),600)}else ge(ie)},Je=(ie,ce)=>{ce.stopPropagation(),t&&t(ie)},Ye=async()=>{if(f.length===0)return;const ie=o.find(ne=>ne.name.toLowerCase()==="schedule"||ne.name==="");if(!ie)return;const ce=f.every(ne=>{var Ie;const Se=i.find(fe=>fe.id===ne);return(Ie=Se==null?void 0:Se.tags)==null?void 0:Ie.includes(ie.id)}),Z=f.map(ne=>{const Se=i.find(fe=>fe.id===ne);if(!Se)return null;let Ie=[...Se.tags||[]];return ce?Ie=Ie.filter(fe=>fe!==ie.id):Ie.includes(ie.id)||Ie.push(ie.id),{id:ne,data:{tags:Ie}}}).filter(Boolean);Z.length>0&&await a(Z)},Ke=(ie,ce)=>{ce.stopPropagation(),B({date:ie,title:""}),setTimeout(()=>{var Z;return(Z=C.current)==null?void 0:Z.focus()},50)},lt=async()=>{F&&(F.title.trim()&&await l({title:F.title.trim(),start_date:F.date.toISOString(),is_all_day:!0,status:"inbox",color:"gray"}),B(null))},St=["","","","","","",""],X=`${G.getFullYear()} ${G.getMonth()+1}`,ee=x.useCallback(()=>{const ie=new Date;y(ie);const ce=[];for(let Z=-vc;Z<=vc;Z++){const ne=new Date(ie);ne.setDate(ie.getDate()+Z*7),ce.push(oe(ne))}if(P(ce),E.current){const ne=vc*Bi-E.current.clientHeight/2+Bi/2;E.current.scrollTop=ne}},[oe,y,P]);return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main relative",children:[c.jsx("div",{className:"absolute top-12 left-1/2 -translate-x-1/2 z-40 pointer-events-none opacity-0 transition-opacity duration-300 data-[visible=true]:opacity-100","data-visible":!0,children:c.jsxs("div",{className:"bg-theme-header backdrop-blur-md shadow-lg border border-theme px-4 py-1.5 rounded-full text-sm font-bold text-theme-primary flex items-center gap-2",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-500"}),X]})}),c.jsxs("div",{ref:E,className:"flex-1 overflow-y-auto overflow-x-hidden relative",onScroll:$e,style:{scrollBehavior:"auto"},children:[c.jsx("div",{className:"flex border-b border-theme bg-theme-sidebar z-30 sticky top-0 shadow-sm min-h-[32px]",children:St.map((ie,ce)=>c.jsx("div",{className:`flex-1 text-center py-2 text-xs font-bold ${ce===0?"text-red-500":ce===6?"text-green-600":"text-theme-tertiary"}`,children:ie},ie))}),c.jsx("div",{className:"relative",style:{height:O.length*Bi},children:O.map((ie,ce)=>ce<se.start||ce>se.end||!E.current?null:c.jsx("div",{className:"flex w-full absolute left-0 right-0 border-b border-theme",style:{height:Bi,top:ce*Bi},children:ie.days.map((Z,ne)=>{const Se=Z.date.getDate()===1,Ie=te(Z.date),fe=H===Z.date.toDateString(),Oe=p&&f.length>0,et=Ee&&Ti(Z.date,Ee),xt=CR(Z.date),It=ER(Z.date),ue=NR(Z.date),Ne=Z.date.getDay()===0||Z.date.getDay()===6,Ue=Z.date.getDay()===0,Ze=Z.date.getDay()===6;return c.jsxs("div",{className:`
                                                flex-1 min-w-0 h-full border-r border-theme relative group
                                                ${et?"bg-indigo-500/10":""}
                                                ${Z.isToday&&!et?"bg-indigo-500/5":Ne&&!et?"bg-theme-sidebar":Z.date.getMonth()%2===0&&!et?"bg-theme-main":et?"":"bg-theme-hover/30"}
                                                ${fe?"ring-4 ring-green-400 bg-green-50 animate-pulse z-20":""}
                                                ${I===Z.date.toDateString()?"bg-indigo-500/20 ring-inset ring-2 ring-indigo-400 z-10 transition-colors duration-150":""}
                                                ${Oe?"cursor-pointer hover:ring-[1.5px] hover:ring-indigo-500 hover:shadow-sm hover:z-30 z-10":""}
                                                ${!Z.isToday&&!fe&&I!==Z.date.toDateString()&&!et?"hover:bg-theme-hover":""}
                                            `,onDragEnter:()=>K(Z.date.toDateString()),onDragOver:xe=>{xe.preventDefault(),xe.dataTransfer.dropEffect="move"},onDrop:xe=>{xe.preventDefault(),K(null);try{const ct=xe.dataTransfer.getData("application/json"),dt=JSON.parse(ct);if(Array.isArray(dt)&&dt.length>0){const ft=new Date(Z.date);ft.setHours(9,0,0,0);const de=xe.currentTarget.getBoundingClientRect(),tt=xe.clientY-de.top<de.height*.35,st=dt.map(ht=>({id:ht,data:{start_date:ft.toISOString(),is_all_day:tt,...tt?{start_time:null,end_time:null}:{start_time:"09:00",end_time:"10:00"}}}));a(st)}}catch(ct){console.error("Failed to parse drag data",ct)}},onClick:xe=>Te(Z.date,xe),onDoubleClick:xe=>Ke(Z.date,xe),children:[Se&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"absolute top-0 left-0 w-full border-t-2 border-indigo-500 z-10 shadow-sm"}),c.jsxs("div",{className:"absolute -top-3 left-2 bg-indigo-600 text-white text-xs font-bold px-2 py-0.5 rounded-full z-20 shadow-md",children:[Z.date.getFullYear()," ",Z.date.getMonth()+1,""]}),c.jsx("div",{className:"absolute top-2 left-2 text-6xl font-black text-indigo-500/5 pointer-events-none -z-10 select-none",children:Z.date.getMonth()+1})]}),c.jsxs("div",{className:"p-1 h-full flex flex-col gap-0.5 overflow-hidden",onDoubleClick:xe=>Je(Z.date,xe),children:[c.jsxs("div",{className:"flex items-start justify-between min-w-0 pointer-events-none",children:[c.jsxs("div",{className:"flex flex-col leading-none pt-0.5 pl-0.5 max-w-[70%] text-left",children:[v.showTaiwanHolidays&&xt&&c.jsx("span",{className:"text-[9px] font-bold truncate text-red-500",children:xt}),ue&&c.jsxs("span",{className:"text-[8px] font-bold truncate text-amber-600",children:[" ",ue]}),v.showLunar&&c.jsx("span",{className:`text-[8px] truncate ${xt||ue?"text-gray-400":"text-gray-300"}`,children:It})]}),c.jsx("div",{className:`
                                                        text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-full ml-auto flex-shrink-0
                                                        ${Z.isToday?"bg-indigo-600 text-white":Ue?"text-red-500":Ze?"text-green-600":"text-theme-tertiary group-hover:text-theme-secondary"}
                                                    `,children:Z.date.getDate()})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden space-y-0.5 no-scrollbar",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:[Ie.map(xe=>{var At,jt;const ct=N(xe),dt=xe.is_all_day,ft=f.includes(xe.id),de=(At=o.find(Q=>Q.name.toLowerCase()==="schedule"||Q.name===""))==null?void 0:At.id,ve=de&&((jt=xe.tags)==null?void 0:jt.includes(de)),tt=dt?{backgroundColor:ct,color:"white",boxShadow:"0 1px 1px rgba(0,0,0,0.1)",border:ft?"2px solid white":`1px solid ${ct}40`}:{backgroundColor:ft?ct+"30":ct+"1A",color:ct,borderLeft:`3px solid ${ct}`},st=Q=>Q?Q.replace(":",""):"",ht=Q=>{Q&&k.current.set(xe.id,Q)},Xe=Q=>{Q&&A.current.set(xe.id,Q)};return c.jsxs("div",{ref:Xe,id:`task-bubble-${xe.id}`,draggable:!0,onDragStart:Q=>{let me=[xe.id];if(f.includes(xe.id)&&(me=f),Q.dataTransfer.setData("application/json",JSON.stringify(me)),Q.dataTransfer.effectAllowed="move",D(null),S.current){const He=S.current.querySelector("#drag-ghost-count"),J=S.current.querySelector("#drag-ghost-title"),Pe=S.current.querySelector("#drag-ghost-stack-1"),ze=S.current.querySelector("#drag-ghost-stack-2");He&&(He.textContent=me.length.toString()),J&&(J.textContent=me.length>1?`${me.length} Tasks Selected`:xe.title),Pe&&(Pe.style.opacity=me.length>1?"1":"0"),ze&&(ze.style.opacity=me.length>2?"1":"0"),Q.dataTransfer.setDragImage(S.current,0,0)}},onDragEnd:()=>K(null),onClick:Q=>{Q.stopPropagation(),Q.metaKey||Q.ctrlKey||Q.shiftKey?f.includes(xe.id)?h(me=>me.filter(He=>He!==xe.id)):h(me=>[...me,xe.id]):h([xe.id])},onDoubleClick:Q=>{Q.stopPropagation(),u(xe.id)},onMouseEnter:()=>{const Q=k.current.get(xe.id),me=A.current.get(xe.id);if(Q&&me&&Q.scrollWidth>Q.clientWidth){const He=me.getBoundingClientRect();D({taskId:xe.id,title:xe.title,x:He.left,y:He.top-8})}},onMouseLeave:()=>D(null),className:`
                                                                    relative text-[9.5px] px-1.5 rounded-md cursor-pointer hover:brightness-95 transition-all mb-0.5
                                                                    flex items-center justify-between gap-1
                                                                    ${ft&&dt?"ring-2 ring-indigo-400 z-10":""}
                                                                    ${ft&&!dt?"z-10":""}
                                                                `,style:{...tt,height:"auto",minHeight:"22px",lineHeight:"1.2",...ve?{backgroundImage:"repeating-linear-gradient(45deg, rgba(255,255,255,0.1) 0px, rgba(255,255,255,0.1) 4px, transparent 4px, transparent 8px)"}:{}},children:[c.jsx("span",{ref:ht,className:"truncate flex-1 font-medium select-none",children:xe.title||""}),!dt&&(xe.start_time||xe.end_time)&&c.jsxs("div",{className:"flex flex-col items-end leading-none shrink-0 opacity-80",style:{fontSize:"7px",transform:"scale(0.95)",transformOrigin:"right center"},children:[xe.start_time&&c.jsx("span",{children:st(xe.start_time)}),xe.end_time&&c.jsx("span",{children:st(xe.end_time)})]})]},xe.id)}),F&&F.date.toDateString()===Z.date.toDateString()&&c.jsx("div",{className:"px-1.5 py-0.5 rounded-md border-2 border-dashed border-indigo-400 bg-indigo-50/50",children:c.jsx("input",{ref:C,type:"text",value:F.title,onChange:xe=>B({...F,title:xe.target.value}),onKeyDown:xe=>{xe.key==="Enter"&&lt(),xe.key==="Escape"&&B(null)},onBlur:lt,placeholder:"...",className:"w-full text-[9.5px] bg-transparent outline-none text-indigo-400 font-medium",autoFocus:!0})})]})]})]},ne)})},ie.id))})]}),f.length>0&&c.jsx("button",{onClick:Ye,className:`absolute bottom-6 right-24 w-10 h-10 border rounded-full shadow-lg flex items-center justify-center transition-all z-30
                        ${f.every(ie=>{var ne;const ce=i.find(Se=>Se.id===ie),Z=o.find(Se=>Se.name.toLowerCase()==="schedule"||Se.name==="");return Z&&((ne=ce==null?void 0:ce.tags)==null?void 0:ne.includes(Z.id))})?"bg-indigo-100 text-indigo-700 border-indigo-200":"bg-theme-card border-theme text-theme-secondary hover:text-indigo-600 hover:border-indigo-300"}`,title:" Schedule  ()",children:c.jsx(EI,{size:20})}),c.jsx("button",{onClick:ee,className:"absolute bottom-4 right-4 bg-indigo-600 text-white px-3 py-1.5 rounded-full shadow-lg text-xs font-bold hover:apply-indigo-700 transition-transform active:scale-95 flex items-center gap-1",children:"Today"}),c.jsx("div",{ref:S,className:"fixed top-[-1000px] left-[-1000px] z-50 pointer-events-none",children:c.jsxs("div",{className:"bg-theme-card backdrop-blur-xl border border-theme p-3 rounded-xl shadow-2xl flex items-center gap-3 w-48 relative overflow-hidden ring-1 ring-black/5",children:[c.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-50/50 to-purple-50/50 -z-10"}),c.jsx("div",{className:"absolute right-0 top-0 w-16 h-16 bg-indigo-500/10 rounded-full blur-2xl -mr-8 -mt-8"}),c.jsx("div",{id:"drag-ghost-count",className:"flex-shrink-0 w-8 h-8 bg-indigo-600 text-white rounded-lg flex items-center justify-center font-black text-sm shadow-indigo-200 shadow-lg transform rotate-[-6deg]",children:"1"}),c.jsxs("div",{className:"flex flex-col min-w-0",children:[c.jsx("span",{className:"text-[10px] uppercase tracking-wider text-indigo-500 font-bold",children:"Moving"}),c.jsx("span",{id:"drag-ghost-title",className:"text-sm font-bold text-gray-700 truncate leading-tight",children:"Task Title"})]}),c.jsx("div",{id:"drag-ghost-stack-1",className:"absolute top-1 left-1 w-full h-full bg-white/50 border border-gray-200/50 rounded-xl -z-20 transform rotate-2 scale-95 origin-center transition-opacity"}),c.jsx("div",{id:"drag-ghost-stack-2",className:"absolute top-2 left-2 w-full h-full bg-white/30 border border-gray-200/30 rounded-xl -z-30 transform rotate-4 scale-90 origin-center transition-opacity"})]})}),_&&or.createPortal(c.jsxs("div",{className:"fixed z-[9999] w-max max-w-[300px] bg-white/95 backdrop-blur-xl text-slate-800 text-base px-4 py-2.5 rounded-xl shadow-2xl break-words whitespace-normal leading-relaxed font-medium tracking-normal animate-in fade-in zoom-in-95 duration-150 pointer-events-none border border-slate-200/80 ring-1 ring-black/5",style:{left:_.x,top:_.y,transform:"translateY(-100%)"},children:[_.title,c.jsx("div",{className:"absolute left-4 top-full w-0 h-0 border-[6px] border-transparent border-t-white/95"})]}),document.body)]})},dE=60,oa=40,Vee=200,Jh=15,fE=500,Wee=["","","","","","",""],Kee=({filterTags:t=[],filterTagsExclude:e=[],filterColors:n=[],filterProjects:r=[]})=>{const{tasks:s,tags:i,calendarDate:o,setCalendarDate:a,editingTaskId:l,setEditingTaskId:u,addTask:d,handleSelection:f,selectedTaskIds:h,setSelectedTaskIds:p,batchDeleteTasks:m,batchUpdateTasks:y,tagsWithResolvedColors:b}=x.useContext(jn),g=(ue,Ne)=>{var Ze;if(ue.tags&&ue.tags.length>0){const xe=ue.tags.find(ft=>{const de=i.find(ve=>ve.id===ft);return de&&de.name.toLowerCase().includes("google")});if(xe){if(b&&b[xe])return b[xe];const ft=i.find(de=>de.id===xe);if(ft!=null&&ft.color)return ft.color}const ct=ue.tags[0];if(b&&b[ct])return b[ct];const dt=i.find(ft=>ft.id===ct);if(dt!=null&&dt.color)return dt.color}const Ue=Ne.color||ue.color||"blue";return((Ze=Qn[Ue])==null?void 0:Ze.color)||Qn.blue.color},v=x.useRef(null),w=x.useRef(null),[_,D]=x.useState([]),[k,A]=x.useState(new Date),N=x.useRef(!1),E=x.useRef(0),S=x.useRef(0),T=x.useRef(null),[C,O]=x.useState(Vee),[P,H]=x.useState(null),[M,I]=x.useState(72),[K,G]=x.useState(null),[R,Ee]=x.useState(null),ge=x.useRef(null),[F,B]=x.useState(null),[se,We]=x.useState(null),ut=x.useRef(null),oe=x.useMemo(()=>{const ue=new Map;let Ne=s.filter(Ue=>Ue.status!=="deleted"&&Ue.status!=="logged");return t.length>0&&(Ne=Ne.filter(Ue=>Ue.tags.some(Ze=>t.includes(Ze)))),e.length>0&&(Ne=Ne.filter(Ue=>!Ue.tags.some(Ze=>e.includes(Ze)))),n.length>0&&(Ne=Ne.filter(Ue=>n.includes(Ue.color))),r.length>0&&(Ne=Ne.filter(Ue=>{if(r.includes(Ue.id)||Ue.parent_id&&r.includes(Ue.parent_id))return!0;let Ze=s.find(xe=>xe.id===Ue.parent_id);for(;Ze;){if(r.includes(Ze.id))return!0;Ze=s.find(xe=>xe.id===(Ze==null?void 0:Ze.parent_id))}return!1})),Ne.forEach(Ue=>{const Ze=Ue.start_date||Ue.due_date;if(Ze){const xe=new Date(Ze),ct=`${xe.getFullYear()}-${xe.getMonth()}-${xe.getDate()}`;ue.has(ct)||ue.set(ct,[]),ue.get(ct).push(Ue)}}),ue},[s,t,e,n,r]),[je,te]=x.useState(!1),$e=9,Te=18,Je=20,Ye=ue=>je?ue>=$e&&ue<Te?dE:Je:dE,Ke=ue=>{let Ne=0;const Ue=Math.floor(ue/60);for(let xe=0;xe<Ue;xe++)Ne+=Ye(xe);const Ze=ue%60;return Ne+=Ze/60*Ye(Ue),Ne},lt=ue=>{let Ne=0;for(let Ue=0;Ue<24;Ue++){const Ze=Ye(Ue);if(ue<=Ne+Ze){const xe=(ue-Ne)/Ze;return Ue*60+xe*60}Ne+=Ze}return 24*60},St=()=>{let ue=0;for(let Ne=0;Ne<24;Ne++)ue+=Ye(Ne);return ue},X=ue=>{if(!ue)return 0;const[Ne,Ue]=ue.split(":").map(Number);return Ne*60+Ue},ee=ue=>{const Ne=Math.floor(ue/60),Ue=Math.floor(ue%60);return`${String(Ne).padStart(2,"0")}:${String(Ue).padStart(2,"0")}`};x.useEffect(()=>{const ue=new Date(o);ue.setHours(0,0,0,0);const Ne=[];for(let Ue=-Jh;Ue<=Jh;Ue++){const Ze=new Date(ue);Ze.setDate(ue.getDate()+Ue),Ne.push(Ze)}D(Ne),setTimeout(()=>{if(w.current){const Ue=Ne.length*C/2-w.current.clientWidth/2;w.current.scrollLeft=Ue}},0)},[]),x.useEffect(()=>{const ue=setInterval(()=>A(new Date),6e4);return()=>clearInterval(ue)},[]),x.useEffect(()=>{const ue=Ne=>{var Ue;if((Ne.key==="Delete"||Ne.key==="Backspace")&&h.length>0&&!l){if(["INPUT","TEXTAREA"].includes(((Ue=document.activeElement)==null?void 0:Ue.tagName)||""))return;Ne.preventDefault(),m(h,!1)}};return window.addEventListener("keydown",ue),()=>window.removeEventListener("keydown",ue)},[h,m,l]);const ie=()=>{const ue=new Date;ue.setHours(0,0,0,0);const Ne=_.findIndex(Ue=>Ti(Ue,ue));if(Ne!==-1&&w.current){const Ue=Ne*C-w.current.clientWidth/2+C/2;w.current.scrollTo({left:Ue,behavior:"smooth"});const Ze=Ke(k.getHours()*60+k.getMinutes()),xe=oa+M+4,ct=Math.max(0,Ze+xe-w.current.clientHeight/3);setTimeout(()=>{var dt;(dt=w.current)==null||dt.scrollTo({top:ct,behavior:"smooth"})},300)}else{a(ue);const Ue=[];for(let Ze=-Jh;Ze<=Jh;Ze++){const xe=new Date(ue);xe.setDate(ue.getDate()+Ze),Ue.push(xe)}D(Ue),setTimeout(()=>{if(w.current){const Ze=Ue.length*C/2-w.current.clientWidth/2;w.current.scrollLeft=Ze}},0)}},ce=async()=>{if(h.length===0)return;const ue=i.find(Ze=>Ze.name.toLowerCase()==="schedule"||Ze.name==="");if(!ue){console.warn("Schedule tag not found");return}const Ne=h.every(Ze=>{var ct;const xe=s.find(dt=>dt.id===Ze);return(ct=xe==null?void 0:xe.tags)==null?void 0:ct.includes(ue.id)}),Ue=h.map(Ze=>{const xe=s.find(dt=>dt.id===Ze);if(!xe)return null;let ct=[...xe.tags||[]];return Ne?ct=ct.filter(dt=>dt!==ue.id):ct.includes(ue.id)||ct.push(ue.id),{id:Ze,data:{tags:ct}}}).filter(Boolean);Ue.length>0&&await y(Ue)};x.useEffect(()=>{setTimeout(()=>ie(),100)},[]);const Z=()=>{const ue=w.current;if(!ue)return;const{scrollLeft:Ne,scrollWidth:Ue,clientWidth:Ze}=ue,xe=Ne<E.current;E.current=Ne,Ne<fE&&!N.current&&xe&&(N.current=!0,D(ct=>{const dt=ct[0],ft=[];for(let de=1;de<=7;de++){const ve=new Date(dt);ve.setDate(dt.getDate()-de),ft.unshift(ve)}return[...ft,...ct]})),Ue-(Ne+Ze)<fE&&D(ct=>{const dt=ct[ct.length-1],ft=[];for(let de=1;de<=7;de++){const ve=new Date(dt);ve.setDate(dt.getDate()+de),ft.push(ve)}return[...ct,...ft]})};x.useLayoutEffect(()=>{if(N.current&&w.current){const ue=7*C;w.current.scrollLeft+=ue,N.current=!1}},[_,C]),x.useEffect(()=>{if(!P)return;const ue=Ue=>{const Ze=Ue.clientX-P.initialMouseX,xe=Math.max(120,Math.min(400,P.initialWidth+Ze)),ct=xe-P.initialWidth,ft=P.columnIndex*ct;w.current&&(w.current.scrollLeft=P.initialScrollLeft+ft),O(xe)},Ne=()=>{H(null)};return window.addEventListener("mousemove",ue),window.addEventListener("mouseup",Ne),()=>{window.removeEventListener("mousemove",ue),window.removeEventListener("mouseup",Ne)}},[P]);const ne=(ue,Ne)=>{var Ue;ue.preventDefault(),ue.stopPropagation(),H({initialWidth:C,initialMouseX:ue.clientX,columnIndex:Ne,initialScrollLeft:((Ue=w.current)==null?void 0:Ue.scrollLeft)||0})};x.useEffect(()=>{if(!K)return;const ue=Ue=>{const Ze=Ue.clientY-K.initialMouseY,xe=Math.max(30,Math.min(200,K.initialHeight+Ze));I(xe)},Ne=()=>{G(null)};return window.addEventListener("mousemove",ue),window.addEventListener("mouseup",Ne),()=>{window.removeEventListener("mousemove",ue),window.removeEventListener("mouseup",Ne)}},[K]);const Se=ue=>{ue.preventDefault(),ue.stopPropagation(),G({initialHeight:M,initialMouseY:ue.clientY})};x.useEffect(()=>{const ue=()=>{S.current!==0&&w.current?(w.current.scrollLeft+=S.current,T.current=requestAnimationFrame(ue)):T.current=null},Ne=Ze=>{if(ut.current&&!se){const{initialMouseX:xe,initialMouseY:ct}=ut.current;if(Math.abs(Ze.clientX-xe)>3||Math.abs(Ze.clientY-ct)>3){const dt=ut.current.task;We({...ut.current,originalStartMin:X(dt.start_time),originalDuration:dt.duration||60,currentDate:ut.current.originalDate,currentStartMin:X(dt.start_time)||540,currentDuration:dt.duration||60,currentSection:ut.current.originalType,startOffsetMin:ut.current.startOffsetMin})}}if(se){if(Ze.preventDefault(),w.current){const{left:Xe,width:At}=w.current.getBoundingClientRect(),jt=Xe+At,Q=120;let me=0;const He=25;if(Ze.clientX<Xe+Q){const Pe=1-Math.max(0,Ze.clientX-Xe)/Q;me=-Math.max(2,Math.round(He*Pe))}else if(Ze.clientX>jt-Q){const Pe=1-Math.max(0,jt-Ze.clientX)/Q;me=Math.max(2,Math.round(He*Pe))}me!==S.current&&(S.current=me,me!==0&&!T.current&&ue())}const xe=document.elementsFromPoint(Ze.clientX,Ze.clientY);let ct=se.currentSection,dt=se.currentDate,ft=se.currentStartMin,de=se.currentDuration;const ve=xe.find(Xe=>Xe.getAttribute("data-drop-zone")==="allday"),tt=xe.find(Xe=>Xe.getAttribute("data-drop-zone")==="grid"),st=xe.find(Xe=>Xe.getAttribute("data-date")),ht=st==null?void 0:st.getAttribute("data-date");if(ht&&(dt=new Date(ht)),ve?ct="allday":tt&&(ct="grid"),ct==="grid"&&tt){const Xe=tt.getBoundingClientRect();let At=Ze.clientY-Xe.top,jt=lt(At);if(se.type==="move")jt=jt-se.startOffsetMin,ft=Math.round(jt/15)*15,ft=Math.max(0,Math.min(1425,ft));else if(se.type==="resize-bottom"){const Q=Math.round(jt/15)*15,me=Math.max(15,Q-se.originalStartMin);se.currentDuration=me,de=me,ft=se.originalStartMin}else if(se.type==="resize-top"){let Q=Math.round(jt/15)*15;const me=se.originalStartMin+se.originalDuration;let He=me-Q;He<15&&(He=15,Q=me-15),de=He,ft=Q}}We(Xe=>Xe?{...Xe,currentDate:dt,currentSection:ct,currentStartMin:ft,currentDuration:de}:null)}},Ue=async()=>{if(S.current=0,T.current&&(cancelAnimationFrame(T.current),T.current=null),se){const{task:Ze,currentDate:xe,currentSection:ct,currentStartMin:dt,currentDuration:ft,originalType:de,type:ve}=se,tt=h.includes(Ze.id)?h:[Ze.id],st=[],ht=xe.getTime()-se.originalDate.getTime(),Xe=Math.round(ht/864e5),At=dt-se.originalStartMin;for(const jt of tt){const Q=s.find(He=>He.id===jt);if(!Q)continue;const me={};if(Q.start_date){const He=new Date(Q.start_date);He.setDate(He.getDate()+Xe),me.start_date=He.toISOString()}else me.start_date=xe.toISOString();if(ct==="allday")me.is_all_day=!0;else if(me.is_all_day=!1,de==="grid"){let J=X(Q.start_time)+At;if(J<0&&(J=0),me.start_time=ee(J),me.start_date){const Pe=new Date(me.start_date);Pe.setHours(Math.floor(J/60)),Pe.setMinutes(J%60),me.start_date=Pe.toISOString()}ve==="resize-bottom"||ve==="resize-top"?me.duration=ft:me.duration=Q.duration||60,me.end_time=ee((X(me.start_time)||0)+(me.duration||60))}else me.start_time=ee(dt),me.duration=60,me.end_time=ee(dt+60);st.push({id:jt,data:me})}st.length>0&&await y(st)}We(null),ut.current=null};return window.addEventListener("mousemove",Ne),window.addEventListener("mouseup",Ue),()=>{window.removeEventListener("mousemove",Ne),window.removeEventListener("mouseup",Ue)}},[se,s,h,y]);const Ie=(ue,Ne,Ue,Ze,xe)=>{if(ue.button!==0)return;ue.preventDefault(),ue.stopPropagation(),f(ue,Ne.id);let ct=0,dt=200;const ft=ue.currentTarget;if(dt=ft.getBoundingClientRect().width,!xe){const ve=ft.closest(".schedule-body");if(ve){const tt=ve.getBoundingClientRect(),st=ue.clientY-tt.top;ct=lt(st)-X(Ne.start_time)}else ct=0}ut.current={task:Ne,initialMouseX:ue.clientX,initialMouseY:ue.clientY,originalDate:Ue,type:Ze,originalType:xe?"allday":"grid",startOffsetMin:ct,colWidth:dt}},fe=async(ue,Ne)=>{ue.stopPropagation(),p([]);const Ue=await d({title:"",start_date:Ne.toISOString(),is_all_day:!0,status:"inbox"});u(Ue)},Oe=(ue,Ne)=>{if(ue.button!==0)return;p([]);const Ue=ue.currentTarget.getBoundingClientRect(),Ze=ue.clientY-Ue.top,xe=Math.floor(lt(Ze)/15)*15;Ee({date:Ne,startMin:xe,duration:60,title:""}),setTimeout(()=>{var ct;return(ct=ge.current)==null?void 0:ct.focus()},50)},et=async()=>{R&&R.title.trim()&&await d({title:R.title,start_date:R.date.toISOString(),start_time:ee(R.startMin),duration:R.duration,status:"inbox",is_all_day:!1}),Ee(null)},xt=(ue,Ne)=>{if(ue.button!==0||ue.target.closest("[data-task-id]"))return;p([]);const Ze=ue.currentTarget.getBoundingClientRect(),xe=ue.clientY-Ze.top,ct=Math.floor(lt(xe)/15)*15;B({date:Ne,startMin:ct,endMin:ct,initialY:ue.clientY})};x.useEffect(()=>{if(!F)return;const ue=Ue=>{if(!w.current)return;const xe=document.querySelector(`div[data-date="${F.date.toISOString()}"]`);if(!xe)return;const ct=xe.querySelector(".schedule-body");if(!ct)return;const dt=ct.getBoundingClientRect(),ft=Ue.clientY-dt.top,de=Math.floor(lt(ft)/15)*15,ve=Math.max(0,Math.min(24*60-15,de));B(tt=>tt?{...tt,endMin:ve}:null)},Ne=()=>{if(F){const{date:Ue,startMin:Ze,endMin:xe}=F,ct=Math.min(Ze,xe),ft=Math.max(Ze,xe)-ct;ft>=15&&(Ee({date:Ue,startMin:ct,duration:Math.max(15,ft),title:""}),setTimeout(()=>{var de;return(de=ge.current)==null?void 0:de.focus()},50))}B(null)};return window.addEventListener("mousemove",ue),window.addEventListener("mouseup",Ne),()=>{window.removeEventListener("mousemove",ue),window.removeEventListener("mouseup",Ne)}},[F]);const It=ue=>{if(ue.length===0)return{};const Ne=ue.map(dt=>({id:dt.id,start:X(dt.start_time),end:X(dt.start_time)+(dt.duration||60)})).sort((dt,ft)=>dt.start-ft.start),Ue=[];let Ze=[],xe=-1;Ne.forEach(dt=>{Ze.length===0?(Ze.push(dt),xe=dt.end):dt.start<xe?(Ze.push(dt),xe=Math.max(xe,dt.end)):(Ue.push(Ze),Ze=[dt],xe=dt.end)}),Ze.length>0&&Ue.push(Ze);const ct={};return Ue.forEach(dt=>{const ft=[];dt.forEach(ht=>{let Xe=!1;for(let At=0;At<ft.length;At++){const jt=ft[At],Q=jt[jt.length-1];if(ht.start>=Q.end){jt.push(ht),Xe=!0;break}}Xe||ft.push([ht])});const ve=90/ft.length,tt={},st=[];dt.forEach(ht=>{let Xe=!1;for(let At=0;At<st.length;At++){const jt=st[At],Q=jt[jt.length-1];if(ht.start>=Q.end){jt.push(ht),tt[ht.id]=At,Xe=!0;break}}Xe||(st.push([ht]),tt[ht.id]=st.length-1)}),dt.forEach(ht=>{const Xe=tt[ht.id];ct[ht.id]={left:`${Xe*ve+2}%`,width:`${ve}%`}})}),ct};return c.jsxs("div",{ref:v,className:"h-full flex flex-col bg-theme-main overflow-hidden",children:[c.jsxs("div",{className:"flex bg-theme-header border-b border-theme p-2 items-center flex-shrink-0 z-40 shadow-sm justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Oi,{size:16,className:"text-theme-primary"}),c.jsx("span",{className:"font-bold text-theme-primary text-sm",children:"Schedule"})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-[10px] text-theme-tertiary font-medium",children:"WIDTH"}),c.jsx("input",{type:"range",min:"120",max:"400",value:C,onChange:ue=>O(Number(ue.target.value)),className:"w-20 h-1 bg-theme-hover rounded-lg appearance-none cursor-pointer accent-indigo-500"})]}),h.length>0&&c.jsxs("button",{onClick:ce,className:`px-3 py-1 border rounded-md text-xs font-bold shadow-sm flex items-center gap-1 transition-all
                                ${h.every(ue=>{var Ze;const Ne=s.find(xe=>xe.id===ue),Ue=i.find(xe=>xe.name.toLowerCase()==="schedule"||xe.name==="");return Ue&&((Ze=Ne==null?void 0:Ne.tags)==null?void 0:Ze.includes(Ue.id))})?"bg-indigo-100 text-indigo-700 border-indigo-200":"bg-theme-card border-theme text-theme-secondary hover:bg-theme-hover"}`,title:" Schedule ",children:[c.jsx(EI,{size:14}),h.length>1?`(${h.length})`:""]}),c.jsx("button",{onClick:ie,className:"px-3 py-1 bg-theme-card border border-theme rounded-md text-xs font-bold shadow-sm hover:bg-theme-hover text-theme-primary",children:"Today"}),c.jsx("button",{onClick:()=>te(!je),className:`px-3 py-1 border rounded-md text-xs font-bold shadow-sm transition-colors
                            ${je?"bg-indigo-600 text-white border-indigo-600":"bg-theme-card border-theme text-theme-tertiary hover:bg-theme-hover"}`,children:je?"Work Hours":"Full Day"})]})]}),c.jsxs("div",{ref:w,className:"flex-1 overflow-auto flex relative",onScroll:Z,children:[c.jsxs("div",{className:"sticky left-0 z-30 bg-theme-sidebar border-r border-theme flex-shrink-0 w-14 flex flex-col pointer-events-none select-none h-min relative",children:[c.jsx("div",{className:"sticky top-0 bg-theme-sidebar z-40 border-b border-theme flex-shrink-0",style:{height:oa+M+4}}),Array.from({length:24}).map((ue,Ne)=>c.jsx("div",{className:"text-[10px] text-theme-tertiary font-extralight text-center relative box-border",style:{height:Ye(Ne)},children:c.jsxs("span",{className:"absolute -top-1.5 left-0 right-0",children:[Ne,":00"]})},Ne)),c.jsx("div",{className:"absolute right-0 flex items-center z-50",style:{top:oa+M+4+Ke(k.getHours()*60+k.getMinutes())-8},children:c.jsx("div",{className:"bg-red-500 text-white text-[9px] font-bold px-1 py-0.5 rounded-sm shadow-sm",children:k.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})})}),c.jsx("div",{className:"h-20"})]}),_.map((ue,Ne)=>{const Ue=Ti(ue,k),Ze=`${ue.getFullYear()}-${ue.getMonth()}-${ue.getDate()}`,xe=oe.get(Ze)||[],ct=xe.filter(de=>!de.is_all_day&&de.start_time&&de.start_date),dt=xe.filter(de=>de.is_all_day||!de.start_time),ft=It(ct);return c.jsxs("div",{"data-date":ue.toISOString(),className:"flex-shrink-0 flex flex-col border-r border-theme bg-theme-main relative group h-min",style:{minWidth:C,width:C},children:[c.jsxs("div",{className:`sticky top-0 z-20 border-b border-theme px-1 py-0.5 text-center flex flex-col justify-start select-none shadow-sm relative
                                ${Ue?"bg-indigo-500/10 backdrop-blur-sm":"bg-theme-header backdrop-blur-sm"}
                            `,style:{height:oa+M+4},children:[c.jsx("div",{className:"absolute top-0 right-0 w-2 h-full cursor-col-resize z-30 hover:bg-indigo-400/30 transition-colors group-hover:opacity-100 opacity-0",onMouseDown:de=>ne(de,Ne)}),c.jsxs("div",{className:"flex items-center justify-center gap-1 flex-shrink-0",style:{height:oa-4},children:[c.jsxs("span",{className:`text-[10px] font-extralight ${Ue?"text-indigo-500":"text-theme-tertiary"}`,children:["",Wee[ue.getDay()]]}),c.jsx("span",{className:`text-lg font-extralight ${Ue?"text-indigo-500":"text-theme-primary"}`,children:ue.getDate()})]}),c.jsx("div",{"data-drop-zone":"allday",className:"overflow-y-auto space-y-1 py-1 border-t border-dashed border-theme custom-scrollbar px-1 cursor-cell transition-colors relative",style:{height:M},onDoubleClick:de=>fe(de,ue),children:dt.map(de=>{var jt,Q;const ve=mp(de,s),tt=g(de,ve),st=h.includes(de.id),ht=(se==null?void 0:se.task.id)===de.id,Xe=(jt=i.find(me=>me.name.toLowerCase()==="schedule"||me.name===""))==null?void 0:jt.id,At=Xe&&((Q=de.tags)==null?void 0:Q.includes(Xe));return c.jsxs("div",{onMouseDown:me=>Ie(me,de,ue,"move",!0),onDoubleClick:me=>{me.stopPropagation(),p([]),u(de.id)},className:`group/allday text-[10px] px-2 py-1 rounded-lg border text-center font-extralight transition-all w-full relative overflow-hidden cursor-grab active:cursor-grabbing
                                                    ${st?"ring-2 ring-offset-1":""}
                                                    ${ht?"opacity-30":""}
                                                `,style:{backgroundColor:At?`${tt}10`:st?tt+"40":tt+"18",backgroundImage:At?`repeating-linear-gradient(45deg, ${tt}20 0px, ${tt}20 4px, transparent 4px, transparent 8px)`:void 0,color:tt,borderColor:st?tt+"80":tt+"60",boxShadow:st?"2px 2px 4px rgba(0,0,0,0.12)":"2px 2px 3px rgba(0,0,0,0.08)","--tw-ring-color":st?tt+"60":void 0,...At?{fontWeight:"bold"}:{}},children:[c.jsx("div",{className:"absolute inset-0 opacity-0 group-hover/allday:opacity-100 transition-opacity pointer-events-none",style:{backgroundColor:tt+"15"}}),c.jsx("div",{className:"truncate pointer-events-none relative z-10",children:de.title||"Untitled"})]},de.id)})}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-2 cursor-ns-resize hover:bg-indigo-400/30 transition-colors z-30",onMouseDown:Se})]}),c.jsxs("div",{"data-drop-zone":"grid",className:"flex-1 relative overflow-hidden schedule-body",style:{height:St()},onDoubleClick:de=>Oe(de,ue),onMouseDown:de=>xt(de,ue),children:[Array.from({length:24}).map((de,ve)=>c.jsx("div",{className:"border-t border-theme box-border w-full pointer-events-none opacity-20",style:{height:Ye(ve)}},ve)),F&&Ti(F.date,ue)&&(()=>{const de=Math.min(F.startMin,F.endMin),ve=Math.max(F.startMin,F.endMin);if(ve-de<15)return null;const st=Ke(de),ht=Ke(ve);return c.jsx("div",{className:"absolute left-1 right-1 rounded-xl border-2 border-dashed border-indigo-400 bg-indigo-50/50 pointer-events-none z-40 flex items-center justify-center",style:{top:st,height:ht-st},children:c.jsxs("span",{className:"text-xs font-extralight text-indigo-600",children:[ee(de)," - ",ee(ve)]})})})(),Ue&&c.jsxs("div",{className:"absolute w-full flex items-center z-10 pointer-events-none",style:{top:Ke(k.getHours()*60+k.getMinutes())},children:[c.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 -ml-1"}),c.jsx("div",{className:"flex-1 border-t-2 border-red-500"})]}),ct.map(de=>{var me,He;const ve=ft[de.id];if(!ve||se&&se.task.id===de.id)return null;const tt=X(de.start_time),st=de.duration||60,ht=mp(de,s),Xe=g(de,ht),At=h.includes(de.id),jt=(me=i.find(J=>J.name.toLowerCase()==="schedule"||J.name===""))==null?void 0:me.id,Q=jt&&((He=de.tags)==null?void 0:He.includes(jt));return c.jsxs("div",{"data-task-id":de.id,onMouseDown:J=>Ie(J,de,ue,"move",!1),onDoubleClick:J=>{J.stopPropagation(),p([]),u(de.id)},className:`absolute rounded-xl border px-2 py-1.5 overflow-hidden select-none cursor-pointer hover:brightness-98 transition-all flex flex-col
                                                ${At?"ring-2 ring-offset-1":""}
                                            `,style:{top:Ke(tt),height:Ke(tt+st)-Ke(tt),left:ve.left,width:ve.width,backgroundColor:Q?`${Xe}10`:At?Xe+"40":Xe+"15",backgroundImage:Q?`repeating-linear-gradient(45deg, ${Xe}20 0px, ${Xe}20 4px, transparent 4px, transparent 8px)`:void 0,borderColor:Xe+"50",color:Xe,zIndex:10,boxShadow:"2px 2px 3px rgba(0,0,0,0.06)","--tw-ring-color":At?Xe+"60":void 0,...Q?{fontWeight:"bold"}:{}},children:[c.jsx("div",{className:"font-extralight text-[11px] truncate leading-normal pointer-events-none",children:de.title||""}),st>30&&c.jsxs("div",{className:"text-[9px] opacity-80 font-extralight mt-0.5 leading-normal pointer-events-none",children:[de.start_time," - ",de.end_time]}),c.jsx("div",{className:"absolute top-0 left-0 w-full h-3 cursor-ns-resize z-50 hover:bg-black/5 transition-colors",onMouseDown:J=>Ie(J,de,ue,"resize-top",!1)}),c.jsx("div",{className:"absolute bottom-0 left-0 w-full h-3 cursor-ns-resize z-50 hover:bg-black/5 transition-colors",onMouseDown:J=>Ie(J,de,ue,"resize-bottom",!1)})]},de.id)}),R&&Ti(R.date,ue)&&c.jsx("div",{className:"absolute z-50 rounded-xl border border-indigo-500 bg-theme-card shadow-xl overflow-hidden px-3 flex items-center",style:{top:Ke(R.startMin),height:Math.max(44,Ke(R.startMin+R.duration)-Ke(R.startMin)),left:"5%",width:"90%"},children:c.jsx("input",{ref:ge,value:R.title,onChange:de=>Ee({...R,title:de.target.value}),onKeyDown:de=>{de.key==="Enter"&&et(),de.key==="Escape"&&Ee(null)},onBlur:et,className:"w-full text-[12px] font-extralight bg-transparent outline-none text-indigo-400 leading-normal",placeholder:"New Task...",autoFocus:!0})})]})]},ue.toISOString())}),se&&(()=>{var xe,ct,dt;const ue=mp(se.task,s),Ne=g(se.task,ue);let Ue=0;const Ze=Array.from(document.querySelectorAll("div[data-date]")).find(ft=>ft.getAttribute("data-date")===se.currentDate.toISOString());if(Ze?Ue=Ze.getBoundingClientRect().left:Ue=se.initialMouseX,se.currentSection==="allday"){const de=(((xe=w.current)==null?void 0:xe.getBoundingClientRect().top)||0)+oa+2;return c.jsx("div",{className:"fixed z-[100] pointer-events-none rounded-lg border px-2 py-1 text-[10px] font-extralight text-center shadow-xl cursor-grabbing flex items-center justify-center bg-white",style:{left:Ue+4,top:de,width:(se.colWidth||200)-8,height:M-4,backgroundColor:Ne+"40",borderColor:Ne,color:Ne},children:se.task.title||"Untitled"})}else{const ft=((ct=w.current)==null?void 0:ct.getBoundingClientRect())||{top:0,left:0},de=((dt=w.current)==null?void 0:dt.scrollTop)||0,ve=Ke(se.currentStartMin),tt=Ke(se.currentStartMin+se.currentDuration)-ve,st=ft.top+oa+M+4+ve-de;return c.jsxs("div",{className:`fixed rounded-xl border px-2 py-1.5 shadow-2xl overflow-hidden select-none flex flex-col z-[100] bg-white ring-2 ring-indigo-400/50 ${se.type.startsWith("resize")?"cursor-ns-resize":"cursor-grabbing"}`,style:{top:Math.max(ft.top+oa+M+4,st),height:tt,left:Ue+4,width:(se.colWidth||190)-8,backgroundColor:"var(--bg-card)",borderColor:Ne,color:Ne,opacity:.95},children:[c.jsx("div",{className:"font-extralight text-[11px] truncate leading-normal",children:se.task.title||""}),c.jsxs("div",{className:"text-[9px] font-extralight mt-0.5 opacity-80 leading-normal",children:[ee(se.currentStartMin)," - ",ee(se.currentStartMin+se.currentDuration)]})]})}})()]})]})},Gee=Object.keys(Qn),qee=()=>{const{tasks:t,updateTask:e,selectedTaskIds:n,viewTagFilters:r,setEditingTaskId:s,focusSplitWidth:i,setFocusSplitWidth:o,themeSettings:a,setSelectedTaskIds:l,constructionModeEnabled:u,setConstructionModeEnabled:d,deleteTask:f,editingTaskId:h,batchDeleteTasks:p,setCalendarDate:m,tags:y,tagsWithResolvedColors:b}=x.useContext(jn),g=x.useRef(null),[v,w]=x.useState(!1),[_,D]=x.useState(()=>localStorage.getItem("focus_calendar_mode")||"calendar"),[k,A]=x.useState(null),[N,E]=x.useState(()=>{try{const X=localStorage.getItem("focus_filter_tags_include");return X?JSON.parse(X):[]}catch{return[]}}),[S,T]=x.useState(()=>{try{const X=localStorage.getItem("focus_filter_tags_exclude");return X?JSON.parse(X):[]}catch{return[]}}),[C,O]=x.useState(()=>{try{const X=localStorage.getItem("focus_filter_colors");return X?JSON.parse(X):[]}catch{return[]}}),[P,H]=x.useState(()=>{try{const X=localStorage.getItem("focus_filter_projects");return X?JSON.parse(X):[]}catch{return[]}}),[M,I]=x.useState(!1),[K,G]=x.useState(!1),[R,Ee]=x.useState(!1),ge=x.useRef(null),F=x.useRef(null),B=x.useRef(null);x.useEffect(()=>{localStorage.setItem("focus_filter_tags_include",JSON.stringify(N))},[N]),x.useEffect(()=>{localStorage.setItem("focus_filter_tags_exclude",JSON.stringify(S))},[S]),x.useEffect(()=>{localStorage.setItem("focus_filter_colors",JSON.stringify(C))},[C]),x.useEffect(()=>{localStorage.setItem("focus_filter_projects",JSON.stringify(P))},[P]);const se=x.useMemo(()=>t.filter(X=>X.is_project&&X.status!=="deleted"),[t]),We=N.length>0||S.length>0||C.length>0||P.length>0,ut=()=>{E([]),T([]),O([]),H([])},oe=X=>{N.includes(X)?(E(ee=>ee.filter(ie=>ie!==X)),T(ee=>[...ee,X])):S.includes(X)?T(ee=>ee.filter(ie=>ie!==X)):E(ee=>[...ee,X])};x.useEffect(()=>{const X=ee=>{ge.current&&!ge.current.contains(ee.target)&&I(!1),F.current&&!F.current.contains(ee.target)&&G(!1),B.current&&!B.current.contains(ee.target)&&Ee(!1)};return document.addEventListener("mousedown",X),()=>document.removeEventListener("mousedown",X)},[]),x.useEffect(()=>{localStorage.setItem("focus_calendar_mode",_)},[_]);const je=n.length>0&&n.some(X=>{const ee=t.find(ie=>ie.id===X);return ee&&!ee.start_date}),te=u&&je,$e=n.length>0&&n.some(X=>{const ee=t.find(ie=>ie.id===X);return ee&&ee.start_date}),Te=u&&$e&&!je,Je=x.useMemo(()=>{const X=r.focus||{include:[],exclude:[]},{include:ee,exclude:ie}=Array.isArray(X)?{include:X,exclude:[]}:X,ce=new Set(t.filter(ne=>ne.status==="deleted").map(ne=>ne.id));let Z=t.filter(ne=>ne.status==="inbox"&&!ne.start_date&&!ne.completed_at&&(!ne.parent_id||!ce.has(ne.parent_id)));return ee.length>0&&(Z=Z.filter(ne=>ne.tags.some(Se=>ee.includes(Se)))),ie.length>0&&(Z=Z.filter(ne=>!ne.tags.some(Se=>ie.includes(Se)))),Z.sort((ne,Se)=>(ne.order_index||0)-(Se.order_index||0))},[t,r]);x.useEffect(()=>{const X=ee=>{var ie,ce,Z;if(ee.key==="Escape"&&(te||Te)&&(d(!1),l([])),(ee.key==="Delete"||ee.key==="Backspace")&&!h){if(["INPUT","TEXTAREA"].includes(((ie=document.activeElement)==null?void 0:ie.tagName)||""))return;n.length>0&&(ee.preventDefault(),p(n,!1),l([]))}if(ee.key==="Enter"&&!h&&n.length>0){if(["INPUT","TEXTAREA"].includes(((ce=document.activeElement)==null?void 0:ce.tagName)||""))return;ee.preventDefault(),s(n[0])}if((ee.key==="ArrowUp"||ee.key==="ArrowDown")&&!h){if(["INPUT","TEXTAREA"].includes(((Z=document.activeElement)==null?void 0:Z.tagName)||"")||(ee.preventDefault(),Je.length===0))return;let ne=-1;n.length>0&&(ne=Je.findIndex(fe=>n.includes(fe.id)));let Se=0;ee.key==="ArrowDown"?ne===-1?Se=0:Se=Math.min(Je.length-1,ne+1):ne===-1?Se=Je.length-1:Se=Math.max(0,ne-1);const Ie=Je[Se];Ie&&(l([Ie.id]),Ke(Se),setTimeout(()=>{const fe=document.getElementById(`focus-task-${Ie.id}`);fe==null||fe.scrollIntoView({block:"nearest"})},0))}};return window.addEventListener("keydown",X),()=>window.removeEventListener("keydown",X)},[te,Te,l,d,n,f,h,Je]),x.useEffect(()=>{n.length===0&&d(!1)},[n]),x.useEffect(()=>{const X=ie=>{if(!v||!g.current)return;const ce=g.current.getBoundingClientRect();let Z=ie.clientX-ce.left;const ne=ce.width*.9;Z<100&&(Z=100),Z>ne&&(Z=ne),o(Z)},ee=()=>{w(!1),document.body.style.cursor="default"};return v&&(window.addEventListener("mousemove",X),window.addEventListener("mouseup",ee),document.body.style.cursor="col-resize"),()=>{window.removeEventListener("mousemove",X),window.removeEventListener("mouseup",ee)}},[v]);const[Ye,Ke]=x.useState(null),lt=(X,ee,ie)=>{if(ie.shiftKey&&Ye!==null){const ce=Math.min(Ye,ee),Z=Math.max(Ye,ee),ne=Je.slice(ce,Z+1).map(Se=>Se.id);l(ne)}else ie.metaKey||ie.ctrlKey?n.includes(X)?l(n.filter(ce=>ce!==X)):l([...n,X]):l([X]);Ke(ee)},St=(X,ee)=>{const ie=n.includes(X.id),ce={small:"text-xs",normal:"text-sm",large:"text-base"}[a.fontSize]||"text-sm",Z=a.fontFamily==="things"?"font-things":"font-sans",ne=X.color||"blue",Se=Qn[ne]||Qn.blue;return c.jsxs("div",{id:`focus-task-${X.id}`,onClick:Ie=>lt(X.id,ee,Ie),onDoubleClick:Ie=>{Ie.stopPropagation(),s(X.id)},className:`
                    group relative flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer
                    transition-all duration-150 ease-out
                    ${ie?`bg-indigo-50 ring-2 shadow-sm ${te||Te?"construction-glow ring-transparent":"ring-indigo-400"}`:"hover:bg-theme-hover active:bg-theme-hover"}
                `,style:ie&&(te||Te)?{"--glow-color":Se.color,"--tw-ring-color":Se.color}:{},children:[c.jsx("div",{className:`flex-shrink-0 w-4 h-4 rounded-full border-2 transition-colors ${ie?`${Se.border} ${Se.bg}`:"border-gray-300 group-hover:border-gray-400"}`,onClick:Ie=>{Ie.stopPropagation(),e(X.id,{status:"completed"})}}),c.jsxs("div",{className:"flex-1 min-w-0",children:[X.parent_id&&(()=>{const Ie=t.find(fe=>fe.id===X.parent_id);return Ie?c.jsxs("div",{className:"text-[9px] text-gray-400 truncate mb-0.5 flex items-center gap-1",children:[c.jsx("span",{className:"w-1 h-1 rounded-full bg-gray-300"}),Ie.title]}):null})(),c.jsx("div",{className:`${ce} ${Z} font-extralight text-theme-secondary truncate leading-tight`,children:X.title||c.jsx("span",{className:"text-theme-tertiary italic",children:""})})]})]},X.id)};return c.jsxs("div",{ref:g,className:"flex h-full w-full overflow-hidden bg-theme-main",children:[c.jsx("div",{style:{width:i},className:"flex flex-col h-full border-r border-theme flex-shrink-0 bg-theme-sidebar",children:c.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar px-2 py-3 space-y-4",children:[Je.length>0&&c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between px-2 mb-1",children:[c.jsxs("span",{className:`text-[9px] text-gray-400 ${a.fontFamily==="things"?"font-things":"font-sans"}`,children:[" (",Je.length,")"]}),n.length>0&&c.jsxs("button",{onClick:()=>d(!u),className:`flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] font-medium transition-all ${u?"bg-amber-100 text-amber-700 ring-1 ring-amber-300":"bg-gray-100 text-gray-500 hover:bg-gray-200"}`,title:u?"":"",children:[c.jsx(wz,{size:10}),u?"":""]})]}),c.jsx("div",{className:"space-y-1",children:Je.slice(0,50).map((X,ee)=>St(X,ee))})]}),Je.length===0&&c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx(bf,{size:32,className:"mb-2 opacity-30"}),c.jsx("p",{className:"text-sm",children:""})]})]})}),c.jsx("div",{onMouseDown:()=>w(!0),className:`w-1 cursor-col-resize hover:bg-indigo-400 group relative z-30 transition-colors flex items-center justify-center ${v?"bg-indigo-400":"bg-transparent"}`,children:c.jsx("div",{className:`absolute opacity-0 group-hover:opacity-100 transition-opacity p-0.5 bg-white border border-gray-200 rounded-md shadow-sm text-gray-400 ${v?"opacity-100":""}`,children:c.jsx(DI,{size:10})})}),c.jsxs("div",{className:"flex-1 h-full min-w-0 relative overflow-hidden flex flex-col",children:[c.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-theme bg-theme-header flex-shrink-0",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[k&&c.jsxs("button",{onClick:()=>{A(null),D("calendar")},className:"flex items-center gap-1 px-2 py-1.5 rounded-md text-xs font-medium text-theme-secondary hover:text-theme-primary hover:bg-theme-hover transition-all",title:"",children:[c.jsx(TI,{size:14}),""]}),c.jsxs("div",{className:"flex items-center gap-1 bg-theme-hover p-0.5 rounded-lg",children:[c.jsxs("button",{onClick:()=>{D("calendar"),A(null)},className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${_==="calendar"&&!k?"bg-theme-card text-indigo-500 shadow-sm":"text-theme-tertiary hover:text-theme-secondary"}`,children:[c.jsx(So,{size:14}),""]}),c.jsxs("button",{onClick:()=>{D("schedule"),A(null)},className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${_==="schedule"||k?"bg-theme-card text-indigo-500 shadow-sm":"text-theme-tertiary hover:text-theme-secondary"}`,children:[c.jsx(Oi,{size:14}),""]})]}),k&&c.jsxs("span",{className:"text-sm font-medium text-indigo-600",children:[k.getMonth()+1,"",k.getDate()," (",["","","","","","",""][k.getDay()],")"]})]}),c.jsx("div",{className:"text-[10px] text-gray-400",children:k?"":_==="schedule"?" 1-9 ":""})]}),c.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 border-b border-theme bg-theme-card/50 flex-shrink-0",children:[c.jsx("span",{className:"text-[9px] font-bold text-gray-400 uppercase tracking-wider",children:":"}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>I(!M),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-medium transition-all border ${N.length>0||S.length>0?"bg-indigo-50 text-indigo-600 border-indigo-200":"bg-theme-hover text-theme-tertiary border-transparent hover:text-theme-secondary"}`,children:[c.jsx(Ll,{size:11}),"",N.length+S.length>0&&c.jsx("span",{className:"ml-0.5 px-1 bg-indigo-500 text-white rounded-full text-[9px]",children:N.length+S.length}),c.jsx(rs,{size:10})]}),M&&c.jsxs("div",{ref:ge,className:"absolute top-full left-0 mt-1 w-56 bg-theme-card rounded-lg shadow-xl border border-theme z-50 p-1 max-h-64 overflow-y-auto",children:[c.jsxs("div",{className:"text-[9px] text-theme-tertiary px-2 py-1 border-b border-theme mb-1",children:[":   ",c.jsx("span",{className:"text-green-600",children:""}),"  ",c.jsx("span",{className:"text-red-500",children:""}),"  "]}),y.map(X=>{const ee=N.includes(X.id),ie=S.includes(X.id);return c.jsxs("button",{onClick:()=>oe(X.id),className:`w-full flex items-center justify-between px-2 py-1.5 text-xs rounded hover:bg-theme-hover transition-colors ${ee?"bg-green-50":ie?"bg-red-50":""}`,children:[c.jsxs("div",{className:"flex items-center gap-1.5",children:[c.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:b[X.id]||"#6366f1"}}),c.jsx("span",{className:"text-theme-secondary",children:X.name})]}),ee&&c.jsx(Zn,{size:12,className:"text-green-600"}),ie&&c.jsx(hn,{size:12,className:"text-red-500"})]},X.id)}),y.length===0&&c.jsx("div",{className:"text-xs text-theme-tertiary p-2",children:""})]})]}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>G(!K),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-medium transition-all border ${C.length>0?"bg-indigo-50 text-indigo-600 border-indigo-200":"bg-theme-hover text-theme-tertiary border-transparent hover:text-theme-secondary"}`,children:[c.jsx(jw,{size:11}),"",C.length>0&&c.jsx("span",{className:"ml-0.5 px-1 bg-indigo-500 text-white rounded-full text-[9px]",children:C.length}),c.jsx(rs,{size:10})]}),K&&c.jsx("div",{ref:F,className:"absolute top-full left-0 mt-1 w-48 bg-theme-card rounded-lg shadow-xl border border-theme z-50 p-2",children:c.jsx("div",{className:"grid grid-cols-7 gap-1",children:Gee.map(X=>{var ee;return c.jsx("button",{onClick:()=>{O(ie=>ie.includes(X)?ie.filter(ce=>ce!==X):[...ie,X])},className:`w-5 h-5 rounded-full transition-transform ${C.includes(X)?"ring-2 ring-offset-1 ring-indigo-500 scale-110":"hover:scale-110"}`,style:{backgroundColor:((ee=Qn[X])==null?void 0:ee.color)||"#6366f1"},title:X},X)})})})]}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>Ee(!R),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-medium transition-all border ${P.length>0?"bg-indigo-50 text-indigo-600 border-indigo-200":"bg-theme-hover text-theme-tertiary border-transparent hover:text-theme-secondary"}`,children:[c.jsx(gz,{size:11}),"",P.length>0&&c.jsx("span",{className:"ml-0.5 px-1 bg-indigo-500 text-white rounded-full text-[9px]",children:P.length}),c.jsx(rs,{size:10})]}),R&&c.jsxs("div",{ref:B,className:"absolute top-full left-0 mt-1 w-56 bg-theme-card rounded-lg shadow-xl border border-theme z-50 p-1 max-h-64 overflow-y-auto",children:[se.map(X=>{var ee;return c.jsxs("button",{onClick:()=>{H(ie=>ie.includes(X.id)?ie.filter(ce=>ce!==X.id):[...ie,X.id])},className:`w-full flex items-center justify-between px-2 py-1.5 text-xs rounded hover:bg-theme-hover transition-colors ${P.includes(X.id)?"bg-indigo-50":""}`,children:[c.jsxs("div",{className:"flex items-center gap-1.5",children:[c.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:((ee=Qn[X.color])==null?void 0:ee.color)||"#6366f1"}}),c.jsx("span",{className:"text-theme-secondary truncate",children:X.title})]}),P.includes(X.id)&&c.jsx(Zn,{size:12,className:"text-indigo-600"})]},X.id)}),se.length===0&&c.jsx("div",{className:"text-xs text-theme-tertiary p-2",children:""})]})]}),We&&c.jsxs("button",{onClick:ut,className:"flex items-center gap-1 text-[10px] text-red-500 hover:text-red-600 ml-auto",children:[c.jsx(hn,{size:11})," "]})]}),c.jsx("div",{className:"flex-1 relative z-10 h-full overflow-hidden",children:_==="calendar"&&!k?c.jsx(Hee,{onDateClick:X=>{A(X),m(X)},filterTags:N,filterTagsExclude:S,filterColors:C,filterProjects:P}):c.jsx(Kee,{filterTags:N,filterTagsExclude:S,filterColors:C,filterProjects:P})}),(te||Te)&&c.jsxs("div",{className:"absolute bottom-0 left-0 right-0 z-20",children:[c.jsx("div",{className:`h-12 opacity-45 transition-colors ${Te?"opacity-30":"opacity-45"}`,style:{backgroundImage:te?`repeating-linear-gradient(
                                    45deg,
                                    #fbbf24 0px,
                                    #fbbf24 10px,
                                    #1f2937 10px,
                                    #1f2937 20px
                                )`:`repeating-linear-gradient(
                                    45deg,
                                    #818cf8 0px,
                                    #818cf8 10px,
                                    #312e81 10px,
                                    #312e81 20px
                                )`,backgroundSize:"28px 28px"}}),c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:c.jsx("div",{className:`bg-white/95 backdrop-blur-sm px-4 py-2 rounded-lg shadow-lg border ${te?"border-amber-200":"border-indigo-200"}`,children:c.jsxs("span",{className:`text-sm font-bold ${te?"text-amber-700":"text-indigo-700"}`,children:[te?" ":" "," ",n.length,"    ESC "]})})})]})]})]})},Ui=40,Hy=50,Hi=40,Vy=250,jR=({plan:t,onUpdatePlan:e,onEditTask:n})=>{const[r,s]=x.useState(null),[i,o]=x.useState(null),[a,l]=x.useState(null),[u,d]=x.useState(null),[f,h]=x.useState(0),[p,m]=x.useState(0),[y,b]=x.useState(0),[g,v]=x.useState({x:0,y:0}),[w,_]=x.useState(null),D=x.useRef(null),k=x.useRef(null),A=x.useRef(null);A.current=w,x.useEffect(()=>{_(null)},[t]);const N=(te,$e=0,Te=[],Je=null)=>{let Ye=[];return te.forEach((Ke,lt)=>{const St=[...Te,lt];Ye.push({...Ke,depth:$e,path:St,parentId:Je}),Ke.subtasks&&Ke.subtasks.length>0&&(Ye=[...Ye,...N(Ke.subtasks,$e+1,St,Ke.id||null)])}),Ye},E=w||t,S=x.useMemo(()=>N(E),[E]),T=te=>S.find($e=>$e.id===te),C=te=>{if(!te)return null;const $e=new Date(te);return isNaN($e.getTime())?null:$e},{minDate:O,totalDays:P}=x.useMemo(()=>{let te=new Date,$e=new Date;$e.setDate(te.getDate()+14);let Te=!1;N(t).forEach(lt=>{const St=C(lt.start_date),X=C(lt.due_date);St&&((!Te||St<te)&&(te=St),Te=!0),X&&((!Te||X>$e||X>$e)&&($e=X),Te=!0)}),te.setDate(te.getDate()-2),$e.setDate($e.getDate()+5);const Ye=Math.abs($e.getTime()-te.getTime()),Ke=Math.ceil(Ye/(1e3*60*60*24));return{minDate:te,maxDate:$e,totalDays:Ke}},[t,w]),H=(te,$e)=>{const Te=te.getTime()-$e.getTime();return Math.ceil(Te/(1e3*60*60*24))},M=(te,$e)=>{const Te=new Date($e);return Te.setDate(Te.getDate()+te),Te.toISOString().split("T")[0]},I=(te,$e,Te)=>te.map(Je=>Je.id===$e?{...Je,...Te}:Je.subtasks?{...Je,subtasks:I(Je.subtasks,$e,Te)}:Je),K=(te,$e)=>{let Te=JSON.parse(JSON.stringify(te));if(!$e)return Te;const Je=[$e],Ye=new Set;for(;Je.length>0;){const Ke=Je.shift();if(Ye.has(Ke))continue;Ye.add(Ke);const lt=(ie,ce)=>{for(const Z of ie){if(Z.id===ce)return Z;if(Z.subtasks){const ne=lt(Z.subtasks,ce);if(ne)return ne}}return null},St=lt(Te,Ke);if(!St||!St.due_date)continue;const X=new Date(St.due_date),ee=ie=>{for(let ce=0;ce<ie.length;ce++){const Z=ie[ce];if(Z.dependencies&&Z.dependencies.includes(Ke)){const ne=Z.start_date?new Date(Z.start_date):null,Se=new Date(X);if(Se.setDate(Se.getDate()+1),!ne||ne<Se){const Ie=Z.start_date&&Z.due_date?new Date(Z.due_date).getTime()-new Date(Z.start_date).getTime():864e5,fe=Se.toISOString().split("T")[0],et=new Date(Se.getTime()+Ie).toISOString().split("T")[0];ie[ce]={...Z,start_date:fe,due_date:et},Z.id&&Je.push(Z.id)}}Z.subtasks&&ee(Z.subtasks)}};ee(Te)}return Te},G=(te,$e)=>{if(te.preventDefault(),te.stopPropagation(),!$e.id)return;s($e.id),o($e.id);const Te=$e.start_date?H(new Date($e.start_date),O):0,Je=$e.due_date?H(new Date($e.due_date),O):Te+1;m(Te),b(Je-Te),h(te.clientX),_(t)},R=(te,$e,Te)=>{if(te.preventDefault(),te.stopPropagation(),!$e.id)return;l({id:$e.id,dir:Te}),h(te.clientX);const Je=$e.start_date?H(new Date($e.start_date),O):0,Ye=$e.due_date?H(new Date($e.due_date),O):Je+1;m(Je),b(Ye-Je),_(t)},Ee=(te,$e)=>{var Je;if(te.preventDefault(),te.stopPropagation(),!$e.id)return;d($e.id);const Te=(Je=D.current)==null?void 0:Je.getBoundingClientRect();Te&&v({x:te.clientX-Te.left,y:te.clientY-Te.top})},ge=te=>{if(u&&D.current){const Je=D.current.getBoundingClientRect();v({x:te.clientX-Je.left,y:te.clientY-Je.top});return}if(!i&&!a||!D.current||!w)return;const $e=te.clientX-f,Te=Math.round($e/Ui);if(i){if(!T(i))return;const Ye=p+Te;if(Ye<0)return;const Ke=M(Ye,O),lt=M(Ye+y,O),St=I(w,i,{start_date:Ke,due_date:lt});_(St)}if(a){let Je=p,Ye=y;if(a.dir==="end")Ye=Math.max(1,y+Te);else{const X=y-1,ee=Math.min(Te,X);Je=p+ee,Ye=y-ee}if(Je<0)return;const Ke=M(Je,O),lt=M(Je+Ye,O),St=I(w,a.id,{start_date:Ke,due_date:lt});_(St)}},F=()=>{const te=A.current;if(i&&te){const $e=K(te,i);e($e)}else if(a&&te){const $e=K(te,a.id);e($e)}o(null),l(null),d(null),_(null)},B=(te,$e)=>{var Te;if(te.stopPropagation(),u&&$e.id&&u!==$e.id){if((Te=$e.dependencies)!=null&&Te.includes(u))return;const Je=[...$e.dependencies||[],u],Ye=I(t,$e.id,{dependencies:Je}),Ke=K(Ye,u);e(Ke)}d(null)};x.useEffect(()=>{const te=()=>{(i||a||u)&&F()},$e=Te=>{if(u&&D.current){const Je=D.current.getBoundingClientRect();v({x:Te.clientX-Je.left,y:Te.clientY-Je.top})}};return window.addEventListener("mouseup",te),window.addEventListener("mousemove",$e),()=>{window.removeEventListener("mouseup",te),window.removeEventListener("mousemove",$e)}},[i,a,u,t]);const se=()=>{const te=[],$e=[];for(let Te=0;Te<P;Te++){const Je=new Date(O);Je.setDate(Je.getDate()+Te);const Ye=Je.getDay()===0||Je.getDay()===6;te.push(c.jsx("line",{x1:Te*Ui,y1:0,x2:Te*Ui,y2:S.length*Hi,stroke:Ye?"#f3f4f6":"#e5e7eb",strokeWidth:1},`line - ${Te} `)),Te%1===0&&$e.push(c.jsxs("div",{className:"absolute top-0 flex flex-col items-center justify-end pb-2 text-xs text-gray-500 border-r border-gray-100",style:{left:Te*Ui,width:Ui,height:Hy},children:[c.jsx("span",{className:"font-bold",children:Je.getDate()}),c.jsx("span",{className:"text-[10px]",children:["","","","","","",""][Je.getDay()]})]},`head - ${Te} `))}return{lines:te,days:$e}},We=()=>{var $e,Te;const te=[];if(S.forEach(Je=>{Je.dependencies&&Je.dependencies.forEach(Ye=>{const Ke=T(Ye);if(Ke){const lt=Ke.due_date?H(new Date(Ke.due_date),O):0,St=Je.start_date?H(new Date(Je.start_date),O):0,X=S.findIndex(Ie=>Ie.id===Ke.id),ee=S.findIndex(Ie=>Ie.id===Je.id),ie=(lt+1)*Ui,ce=X*Hi+Hi/2,Z=St*Ui,ne=ee*Hi+Hi/2,Se=`M ${ie} ${ce} C ${ie+20} ${ce}, ${Z-20} ${ne}, ${Z} ${ne} `;te.push(c.jsx("g",{className:"group cursor-pointer pointer-events-auto",onClick:Ie=>{var Oe;if(Ie.stopPropagation(),window.confirm(`Remove dependency: ${Ke.title} -> ${Je.title}?`)&&Je.id){const et=(Oe=Je.dependencies)==null?void 0:Oe.filter(It=>It!==Ke.id),xt=I(t,Je.id,{dependencies:et});e(xt)}},children:c.jsx("path",{d:Se,fill:"none",stroke:"#94a3b8",strokeWidth:"2",markerEnd:"url(#arrowhead)",className:"group-hover:stroke-red-500"})},`${Ke.id} -${Je.id} `))}})}),u){const Je=T(u);if(Je&&D.current){const Ye=Je.due_date?H(new Date(Je.due_date),O):0,Ke=S.findIndex(ne=>ne.id===Je.id),lt=(($e=k.current)==null?void 0:$e.scrollLeft)||0,St=((Te=k.current)==null?void 0:Te.scrollTop)||0,X=(Ye+1)*Ui,ee=Ke*Hi+Hi/2,ie=g.x+lt-Vy,ce=g.y+St-Hy,Z=`M ${X} ${ee} L ${ie} ${ce} `;te.push(c.jsx("path",{d:Z,stroke:"#6366f1",strokeWidth:"2",strokeDasharray:"5,5"},"drawing"))}}return te},{lines:ut,days:oe}=se(),je=We();return c.jsxs("div",{className:"flex flex-col h-full border rounded-lg overflow-hidden bg-white select-none",ref:D,onMouseMove:ge,children:[c.jsxs("div",{className:"flex border-b",children:[c.jsx("div",{style:{width:Vy},className:"flex-shrink-0 border-r bg-gray-50 flex items-center px-4 font-bold text-gray-700",children:""}),c.jsx("div",{className:"flex-1 overflow-hidden relative",style:{height:Hy},children:c.jsx("div",{className:"absolute inset-0",ref:te=>{te&&k.current&&(te.scrollLeft=k.current.scrollLeft)},children:oe})})]}),c.jsxs("div",{className:"flex flex-1 overflow-auto",ref:k,children:[c.jsx("div",{style:{width:Vy},className:"flex-shrink-0 border-r bg-white sticky left-0 z-10",children:S.map((te,$e)=>c.jsxs("div",{style:{height:Hi,paddingLeft:te.depth*20},className:`flex flex-col justify-center px-4 border-b border-gray-50 bg-white cursor-pointer hover:bg-gray-50 transition-colors ${r===te.id?"!bg-indigo-50 border-l-4 border-l-indigo-500":""}`,onClick:()=>te.id&&s(te.id),onDoubleClick:()=>te.id&&(n==null?void 0:n(te.id)),children:[c.jsx("span",{className:"truncate text-sm text-gray-700 font-medium",children:te.title}),c.jsxs("span",{className:"text-[10px] text-gray-400",children:[te.start_date?te.start_date.split("T")[0].slice(5).replace("-","/"):"",te.start_date&&te.due_date&&te.start_date.split("T")[0]!==te.due_date.split("T")[0]?` - ${te.due_date.split("T")[0].slice(5).replace("-","/")}`:""]})]},$e))}),c.jsxs("div",{className:"relative",style:{width:P*Ui,height:S.length*Hi},children:[c.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",children:[c.jsx("defs",{children:c.jsx("marker",{id:"arrowhead",markerWidth:"5",markerHeight:"3.5",refX:"4",refY:"1.75",orient:"auto",children:c.jsx("polygon",{points:"0 0, 5 1.75, 0 3.5",fill:"#94a3b8"})})}),ut,je]}),S.map((te,$e)=>{const Te=te.start_date?H(new Date(te.start_date),O):-1;if(Te<0)return null;const Je=te.due_date?Math.max(1,H(new Date(te.due_date),O)-Te+1):1,Ye=Te*Ui,Ke=Je*Ui;return c.jsxs("div",{className:`absolute rounded-md shadow-sm border border-indigo-600 bg-indigo-500 hover:bg-indigo-600 group flex items-center justify-between px-2 transition-colors ${u&&u!==te.id?"ring-2 ring-indigo-300 ring-offset-1 z-20 cursor-crosshair":""} ${r===te.id?"ring-2 ring-white ring-offset-2 ring-offset-indigo-500":""}`,style:{left:Ye,top:$e*Hi+6,width:Ke,height:Hi-12,cursor:u?"crosshair":"grab"},onMouseDown:lt=>G(lt,te),onMouseUp:lt=>{u&&(lt.stopPropagation(),B(lt,te))},onDoubleClick:lt=>{lt.stopPropagation(),n&&te.id&&n(te.id)},children:[c.jsx("div",{className:`w-4 h-4 bg-white border-2 border-indigo-500 rounded-full cursor-cell absolute -left-2 top-1/2 -translate-y-1/2 hover:scale-125 transition-transform z-30 shadow-sm flex items-center justify-center ${u&&u!==te.id?"opacity-100 animate-pulse scale-110":"opacity-0"}`,onMouseUp:lt=>B(lt,te),children:c.jsx("div",{className:"w-1.5 h-1.5 bg-indigo-500 rounded-full"})}),c.jsx("span",{className:"text-xs text-white font-medium truncate pointer-events-none select-none drop-shadow-sm",children:Ke>30&&te.title}),c.jsx("div",{className:`w-4 h-4 bg-indigo-500 border-2 border-white rounded-full cursor-crosshair absolute -right-2 top-1/2 -translate-y-1/2 hover:scale-125 transition-transform z-30 shadow-sm ${u?"opacity-0":"opacity-0 group-hover:opacity-100"}`,onMouseDown:lt=>Ee(lt,te)}),c.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-3 cursor-ew-resize hover:bg-black/10 z-40 rounded-l-md",onMouseDown:lt=>R(lt,te,"start")}),c.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-3 cursor-ew-resize hover:bg-black/10 z-40 rounded-r-md",onMouseDown:lt=>R(lt,te,"end")})]},te.id)})]})]}),c.jsxs("div",{className:"h-6 bg-gray-50 border-t flex items-center px-4 text-xs text-gray-400 gap-4",children:[c.jsx("span",{children:""}),c.jsx("span",{children:""}),c.jsx("span",{children:""}),c.jsx("span",{children:""})]})]})},Yee="",Jee=({isOpen:t,onClose:e,position:n,customPrompt:r,setCustomPrompt:s,onRun:i,prompts:o,saveToLibrary:a,setSaveToLibrary:l,isLoading:u,history:d,historyIndex:f,setHistoryIndex:h,onDeleteHistory:p,onUpdateHistory:m,onReplace:y,onInsert:b})=>{const[g,v]=x.useState(""),[w,_]=x.useState("prompt"),[D,k]=x.useState(!1),[A,N]=x.useState("");x.useEffect(()=>{u?_("result"):d.length>0&&f>=0?(_("result"),N(d[f].content)):_("prompt")},[u,d.length,f]);const E=o.filter(O=>O.title.toLowerCase().includes(g.toLowerCase())||O.description&&O.description.toLowerCase().includes(g.toLowerCase()));if(!t)return null;const S=n?Math.max(10,Math.min(n.top,window.innerHeight-500)):100,T=n?Math.min(n.left,window.innerWidth-420):window.innerWidth/2-200,C=d[f];return or.createPortal(c.jsx(ko,{children:c.jsxs(Lr.div,{initial:{opacity:0,y:10,left:T,top:S},animate:{opacity:1,y:0,left:T,top:S},exit:{opacity:0,scale:.95},drag:!0,dragMomentum:!1,className:"fixed w-[400px] bg-white rounded-xl shadow-2xl border border-gray-100 flex flex-col overflow-hidden z-[99999]",style:{position:"fixed"},children:[c.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-100 bg-white cursor-move",children:[c.jsxs("h3",{className:"text-sm font-bold text-slate-800 flex items-center gap-2 pointer-events-none",children:[c.jsx(Rs,{className:"text-indigo-500",size:16}),"AI "]}),c.jsxs("div",{className:"flex items-center gap-1",children:[w==="result"&&!u&&c.jsx("button",{onClick:()=>_("prompt"),className:"p-1 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"",children:c.jsx(Rs,{size:14})}),c.jsx("button",{onClick:O=>{O.stopPropagation(),e()},className:"text-slate-400 hover:text-slate-600 transition-colors p-1 hover:bg-slate-100 rounded-full",children:c.jsx(hn,{size:16})})]})]}),c.jsx("div",{className:"flex-1 overflow-hidden flex flex-col bg-slate-50/50",children:w==="prompt"?c.jsxs("div",{className:"p-4 space-y-4",children:[c.jsx("input",{type:"text",placeholder:"...",className:"w-full px-3 py-2 text-xs bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-100 outline-none",value:g,onChange:O=>v(O.target.value),onKeyDown:O=>O.stopPropagation(),autoFocus:!0}),!g&&E.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1.5",children:E.slice(0,5).map(O=>c.jsx("button",{onClick:()=>{s(O.description||O.title),v("")},className:"text-[10px] px-2 py-1 rounded-full bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-100 font-medium",children:O.title},O.id))}),c.jsx("textarea",{className:"w-full h-32 p-3 text-sm bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-100 outline-none resize-none",placeholder:"...",value:r,onChange:O=>s(O.target.value),onKeyDown:O=>O.stopPropagation()}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"checkbox",id:"saveToLib",checked:a,onChange:O=>l(O.target.checked),className:"w-3.5 h-3.5 rounded text-indigo-600"}),c.jsx("label",{htmlFor:"saveToLib",className:"text-xs text-slate-500 select-none",children:""})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:()=>i(Yee),className:"flex-1 py-2 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 rounded-xl text-xs font-bold border border-indigo-200 flex items-center justify-center gap-1",children:[c.jsx(Rs,{size:14})," "]}),c.jsx("button",{onClick:()=>i(r),disabled:!r.trim(),className:"flex-[2] py-2 bg-slate-800 hover:bg-slate-900 text-white rounded-xl text-xs font-bold disabled:opacity-50",children:""})]})]}):c.jsx("div",{className:"flex flex-col h-auto max-h-[60vh]",children:u?c.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-4 text-slate-400",children:[c.jsx(fd,{size:32,className:"text-indigo-400 animate-pulse"}),c.jsx("span",{className:"text-xs font-bold",children:"..."})]}):C?c.jsxs(c.Fragment,{children:[d.length>1&&c.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-white border-b border-gray-50",children:[c.jsxs("span",{className:"text-[10px] font-bold text-gray-400",children:[f+1," / ",d.length]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:()=>h(Math.max(0,f-1)),disabled:f===0,className:"p-1 hover:bg-gray-100 rounded disabled:opacity-30",children:c.jsx(Ou,{size:14})}),c.jsx("button",{onClick:()=>h(Math.min(d.length-1,f+1)),disabled:f===d.length-1,className:"p-1 hover:bg-gray-100 rounded disabled:opacity-30",children:c.jsx(is,{size:14})}),c.jsx("div",{className:"w-px h-3 bg-gray-200 mx-1"}),c.jsx("button",{onClick:()=>p(f),className:"p-1 hover:bg-red-50 text-gray-400 hover:text-red-500 rounded",children:c.jsx(jr,{size:14})})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar bg-white",children:D?c.jsx("textarea",{className:"w-full h-full min-h-[150px] p-2 text-sm border border-indigo-200 rounded-lg focus:ring-2 focus:ring-indigo-100 outline-none resize-none",value:A,onChange:O=>N(O.target.value),onKeyDown:O=>O.stopPropagation()}):c.jsx("div",{className:"prose prose-sm max-w-none prose-indigo",children:c.jsx(ok,{children:C.content})})}),c.jsx("div",{className:"p-3 bg-gray-50 border-t border-gray-100 space-y-2",children:D?c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:()=>{m(f,A),k(!1)},className:"flex-1 py-1.5 bg-indigo-600 text-white rounded-lg text-xs font-bold flex items-center justify-center gap-1",children:[c.jsx(Zn,{size:12})," "]}),c.jsx("button",{onClick:()=>k(!1),className:"px-3 py-1.5 bg-gray-200 text-gray-600 rounded-lg text-xs font-bold",children:""})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("button",{onClick:()=>y(C.content),className:"py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-xs font-bold shadow-sm active:scale-95 flex items-center justify-center gap-1.5",children:[c.jsx(s1,{size:12})," "]}),c.jsxs("button",{onClick:()=>b(C.content),className:"py-2 bg-white hover:bg-gray-50 text-gray-700 border border-gray-200 rounded-lg text-xs font-bold shadow-sm active:scale-95 flex items-center justify-center gap-1.5",children:[c.jsx(Xf,{size:12})," "]})]}),c.jsxs("div",{className:"flex gap-2 justify-end",children:[c.jsxs("button",{onClick:()=>{N(C.content),k(!0)},className:"px-2 py-1 text-[10px] text-gray-500 hover:text-indigo-600 flex items-center gap-1",children:[c.jsx(Iw,{size:10})," "]}),c.jsxs("button",{onClick:()=>navigator.clipboard.writeText(C.content),className:"px-2 py-1 text-[10px] text-gray-500 hover:text-indigo-600 flex items-center gap-1",children:[c.jsx(NI,{size:10})," "]})]})]})})]}):null})})]},"ai-assistant-modal")}),document.body)},Xee=()=>{const{tasks:t,tags:e,themeSettings:n,updateTask:r,setEditingTaskId:s,editingTaskId:i,addTask:o,addTag:a,setView:l,batchUpdateTasks:u,batchDeleteTasks:d}=x.useContext(jn),[f,h]=x.useState(null),[p,m]=x.useState(null),[y,b]=x.useState(null),[g,v]=x.useState("list"),[w,_]=x.useState(()=>{const Q=localStorage.getItem("projectCardSize");return Q?parseInt(Q):280}),[D,k]=x.useState(()=>{const Q=localStorage.getItem("projectOrder");return Q?JSON.parse(Q):[]});x.useEffect(()=>{const Q=localStorage.getItem("openProjectId"),me=localStorage.getItem("previousView");Q&&(h(Q),localStorage.removeItem("openProjectId")),me&&(b(me),localStorage.removeItem("previousView"))},[]);const A=x.useMemo(()=>e.find(Q=>Q.name.toLowerCase()==="project"),[e]),N=x.useMemo(()=>A?t.filter(me=>!me.tags.includes(A.id)||me.status==="deleted"||me.status==="logged"?!1:t.some(J=>J.parent_id===me.id&&J.status!=="deleted")).map(me=>{const He=t.filter(Pe=>Pe.parent_id===me.id&&Pe.status!=="deleted").length,J=t.filter(Pe=>Pe.parent_id===me.id&&Pe.status==="completed").length;return{id:me.id,title:me.title,description:me.description,color:me.color||"blue",tags:me.tags,start_date:me.start_date,due_date:me.due_date,childCount:He,completedCount:J,coverImage:me.images&&me.images.length>0?me.images[0]:me.cover_image,order:me.project_order||0}}):[],[t,A]),E=x.useMemo(()=>e.filter(Q=>Q.name.includes("")).map(Q=>Q.id),[e]),S=x.useMemo(()=>D.length===0?[...N].sort((Q,me)=>{const He=Q.tags.some(Pe=>E.includes(Pe)),J=me.tags.some(Pe=>E.includes(Pe));return He&&!J?-1:!He&&J?1:0}):[...N].sort((Q,me)=>{const He=D.indexOf(Q.id),J=D.indexOf(me.id);return He===-1&&J===-1?0:He===-1?1:J===-1?-1:He-J}),[N,D,E]);x.useEffect(()=>{localStorage.setItem("projectCardSize",w.toString())},[w]);const T=x.useCallback(Q=>{const me=Q.map(He=>He.id);k(me),localStorage.setItem("projectOrder",JSON.stringify(me))},[]),[C,O]=x.useState(null),[P,H]=x.useState(null),M=x.useRef(new Map),I=x.useCallback((Q,me)=>{me?M.current.set(Q,me):M.current.delete(Q)},[]),K=x.useCallback((Q,me,He)=>{let J=null,Pe=1/0;return M.current.forEach((ze,mt)=>{if(mt===He)return;const Wt=ze.getBoundingClientRect(),Dn=Wt.left+Wt.width/2,Ht=Wt.top+Wt.height/2,cn=Math.sqrt(Math.pow(Q-Dn,2)+Math.pow(me-Ht,2));cn<Pe&&(Pe=cn,J=mt)}),J},[]),G=x.useCallback(Q=>{if(Q.preventDefault(),!C)return;const me=K(Q.clientX,Q.clientY,C);H(me)},[C,K]),R=x.useCallback(Q=>{if(Q.preventDefault(),!C||!P||C===P){O(null),H(null);return}const me=S.findIndex(mt=>mt.id===C),He=S.findIndex(mt=>mt.id===P);if(me===-1||He===-1){O(null),H(null);return}const J=[...S],[Pe]=J.splice(me,1),ze=J.findIndex(mt=>mt.id===P);J.splice(ze+1,0,Pe),T(J),O(null),H(null)},[C,P,S,T]),Ee=x.useCallback(()=>{O(null),H(null)},[]),ge=async Q=>{window.confirm(`
`)&&(await r(Q,{status:"deleted"}),p===Q&&m(null))},F=async()=>{let Q=A==null?void 0:A.id;if(Q||(Q=await a("project")||void 0),!Q){console.error("Failed to create project tag");return}const me=await o({title:"",tags:[Q],status:"todo"});me&&(await o({title:"",parent_id:me,status:"todo"}),h(me))},B=f?t.find(Q=>Q.id===f):null,se=n.fontFamily==="things"?"font-things":"font-sans",We=x.useRef(null),[ut,oe]=x.useState(null),[je,te]=x.useState(null),[$e,Te]=x.useState(!1),[Je,Ye]=x.useState(""),[Ke,lt]=x.useState(!1),[St,X]=x.useState(!1),[ee,ie]=x.useState([]),[ce,Z]=x.useState(-1);x.useEffect(()=>{B!=null&&B.ai_history?(ie(B.ai_history),Z(B.ai_history.length-1)):(ie([]),Z(-1))},[B==null?void 0:B.id,B==null?void 0:B.ai_history]);const ne=x.useMemo(()=>{if(!f)return[];t.filter(J=>J.parent_id===f&&J.status!=="deleted").sort((J,Pe)=>(J.order_index||0)-(Pe.order_index||0));const me=J=>t.filter(ze=>ze.parent_id===J&&ze.status!=="deleted").sort((ze,mt)=>(ze.order_index||0)-(mt.order_index||0)).map(ze=>({id:ze.id,title:ze.title,description:ze.description||void 0,start_date:ze.start_date,due_date:ze.due_date,dependencies:ze.dependencies||[],subtasks:me(ze.id)}));return[{id:f,title:(B==null?void 0:B.title)||"Project",start_date:B==null?void 0:B.start_date,due_date:B==null?void 0:B.due_date,description:(B==null?void 0:B.description)||void 0,dependencies:[],subtasks:me(f)}]},[f,t,B]),Se=async Q=>{const me=Ht=>{let cn=[];return Ht.forEach(pe=>{cn.push(pe),pe.subtasks&&(cn=cn.concat(me(pe.subtasks)))}),cn},He=me(Q),J=new Set(He.map(Ht=>Ht.id).filter(Boolean)),Pe=Ht=>{const cn=t.filter(q=>q.parent_id===Ht&&q.status!=="deleted");let pe=[...cn];return cn.forEach(q=>{pe=pe.concat(Pe(q.id))}),pe},mt=Pe(f).filter(Ht=>!J.has(Ht.id)).map(Ht=>Ht.id);mt.length>0&&await d(mt);const Wt=[];for(const Ht of He){if(!Ht.id||Ht.id===f)continue;const cn=t.find(Fe=>Fe.id===Ht.id);if(!cn)continue;const pe={};let q=!1;Ht.start_date!==cn.start_date&&(pe.start_date=Ht.start_date,q=!0),Ht.due_date!==cn.due_date&&(pe.due_date=Ht.due_date,q=!0);const ye=Ht.dependencies||[],Re=cn.dependencies||[],_e=[...ye].sort(),it=[...Re].sort();(_e.length!==it.length||!_e.every((Fe,gt)=>Fe===it[gt]))&&(pe.dependencies=Ht.dependencies,q=!0),q&&Wt.push({id:Ht.id,data:pe})}Wt.length>0&&await u(Wt);const Dn=He.filter(Ht=>!Ht.id);for(const Ht of Dn)await o({title:Ht.title||"New Task",parent_id:f,start_date:Ht.start_date,due_date:Ht.due_date,status:"todo"})},Ie=x.useMemo(()=>{const Q=e.find(me=>me.name.toLowerCase()==="prompt");return Q?t.filter(me=>me.tags.includes(Q.id)&&me.status!=="deleted"):[]},[t,e]),fe=async Q=>{let me="";if(ut&&We.current?me=We.current.state.doc.textBetween(ut.from,ut.to," "):We.current?me=We.current.getText():me=((B==null?void 0:B.description)||"").replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),!me.trim()){alert("");return}X(!0),Te(!0);try{if(Ke&&Je.trim()){const ze=e.find(Wt=>Wt.name.trim().toLowerCase()==="prompt");let mt=ze==null?void 0:ze.id;if(mt||(mt=await a("prompt")||void 0),mt){const Wt=await U5(Je);await o({title:Wt,description:Je,tags:[mt],status:"active"})}}const He=await B5(me,(B==null?void 0:B.title)||"",Q),J={id:crypto.randomUUID(),role:"assistant",content:He.fullResponse,created_at:new Date().toISOString(),prompt:Q||"AI Analysis",model:"gemini"},Pe=[...ee,J];ie(Pe),Z(Pe.length-1),f&&r(f,{ai_history:Pe},[],{skipHistory:!0}),Ye("")}catch(He){console.error(He),alert("AI Error: "+(He.message||"Unknown error"))}finally{X(!1)}},Oe=Q=>{if(We.current&&ut){We.current.chain().setTextSelection({from:ut.from,to:ut.to}).unsetHighlight().insertContent(Q).run();const me=We.current.getHTML();ft(me),oe(null),Te(!1)}else We.current&&alert("")},et=Q=>{if(We.current){We.current.commands.insertContent(Q);const me=We.current.getHTML();ft(me),Te(!1)}},xt=Q=>{const me=ee.filter((He,J)=>J!==Q);ie(me),me.length===0?Z(-1):Z(Math.min(ce,me.length-1)),f&&r(f,{ai_history:me},[],{skipHistory:!0})},It=(Q,me)=>{const He=[...ee];He[Q]={...He[Q],content:me},ie(He),f&&r(f,{ai_history:He},[],{skipHistory:!0})},[ue,Ne]=x.useState(!1),[Ue,Ze]=x.useState(350),[xe,ct]=x.useState(!1),[dt,ft]=x.useState(""),[de,ve]=x.useState(!1),[tt,st]=x.useState(""),ht=x.useRef(null),Xe=x.useRef(B==null?void 0:B.description);x.useEffect(()=>{if(f){const Q=localStorage.getItem(`projectNotesHeight_${f}`);Ze(Q?parseInt(Q):350)}},[f]),x.useEffect(()=>{(B==null?void 0:B.description)!==void 0&&B.description!==Xe.current&&(ft(B.description||""),Xe.current=B.description)},[B==null?void 0:B.description]),x.useEffect(()=>{ft((B==null?void 0:B.description)||""),Xe.current=B==null?void 0:B.description,B!=null&&B.description&&Ne(!0)},[f]),x.useEffect(()=>{const Q=setTimeout(()=>{f&&B&&dt!==B.description&&r(f,{description:dt})},500);return()=>clearTimeout(Q)},[dt,f]),x.useEffect(()=>{if(!xe)return;const Q=He=>{const J=Math.max(100,Math.min(800,He.clientY-200));Ze(J)},me=()=>{ct(!1),f&&localStorage.setItem(`projectNotesHeight_${f}`,Ue.toString())};return window.addEventListener("mousemove",Q),window.addEventListener("mouseup",me),()=>{window.removeEventListener("mousemove",Q),window.removeEventListener("mouseup",me)}},[xe,Ue,f]);const[At,jt]=x.useState(null);if(x.useEffect(()=>{if(!B){jt(null);return}const Q=B.images&&B.images.length>0?B.images[0]:B.cover_image;if(!Q){jt(null);return}const me=new window.Image;me.crossOrigin="Anonymous",me.src=Q,me.onload=()=>{try{const He=document.createElement("canvas"),J=He.getContext("2d");if(!J)return;He.width=50,He.height=50,J.drawImage(me,0,0,50,50);const Pe=J.getImageData(0,0,50,50).data,ze={};for(let Wt=0;Wt<Pe.length;Wt+=4){const Dn=Pe[Wt],Ht=Pe[Wt+1],cn=Pe[Wt+2];if(Pe[Wt+3]<200||Dn>240&&Ht>240&&cn>240)continue;const q=20,ye=Math.floor(Dn/q)*q,Re=Math.floor(Ht/q)*q,_e=Math.floor(cn/q)*q,it=`${ye},${Re},${_e}`;ze[it]=(ze[it]||0)+1}const mt=Object.entries(ze).sort(([,Wt],[,Dn])=>Dn-Wt).map(([Wt])=>Wt);if(mt.length>0){const Wt=q=>{const[ye,Re,_e]=q.split(",").map(Number);return Math.max(ye,Re,_e)-Math.min(ye,Re,_e)},Ht=mt.slice(0,15).sort((q,ye)=>Wt(ye)-Wt(q)),cn=Ht[0],pe=Ht[1]||cn;jt(`linear-gradient(135deg, rgba(${cn}, 0.25) 0%, rgba(${pe}, 0.2) 100%)`)}else jt(null)}catch(He){console.warn("Gradient extraction failed:",He),jt(null)}},me.onerror=()=>jt(null)},[B]),f&&B){const Q=Qn[B.color]||Qn.blue,me=N.find(He=>He.id===f);return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main",children:[c.jsxs("div",{className:"flex items-center gap-4 px-6 py-4 border-b relative transition-[background] duration-500 bg-theme-header",style:{borderBottomColor:Q.color+"30",backgroundImage:At||"none"},children:[c.jsx("button",{onClick:()=>{y?(l(y),b(null)):h(null)},className:"p-2 rounded-lg bg-transparent hover:bg-theme-hover text-theme-secondary hover:text-theme-primary transition-colors",title:y?"":"",children:c.jsx(TI,{size:20})}),c.jsx("div",{className:"flex-1 min-w-0",children:de?c.jsx("input",{ref:ht,type:"text",value:tt,onChange:He=>st(He.target.value),onKeyDown:He=>{He.key==="Enter"?(He.preventDefault(),tt.trim()&&f&&r(f,{title:tt.trim()}),ve(!1)):He.key==="Escape"&&(ve(!1),st(B.title))},onBlur:()=>{tt.trim()&&tt!==B.title&&f&&r(f,{title:tt.trim()}),ve(!1)},className:`text-xl font-bold text-theme-primary ${se} w-full bg-transparent border-b-2 border-indigo-400 outline-none`,autoFocus:!0}):c.jsx("h1",{className:`text-xl font-bold text-theme-primary ${se} truncate cursor-pointer hover:text-indigo-600 transition-colors`,onClick:()=>{st(B.title),ve(!0),setTimeout(()=>{var He;return(He=ht.current)==null?void 0:He.select()},0)},title:"",children:B.title})}),c.jsxs("div",{className:"px-3 py-1 rounded-full text-xs font-bold flex-shrink-0",style:{backgroundColor:Q.color+"20",color:Q.color},children:[(me==null?void 0:me.childCount)||0," "]}),c.jsxs("button",{onClick:()=>s(f),className:"flex items-center gap-1.5 px-3 py-1.5 bg-theme-hover hover:bg-theme-card rounded-lg text-sm text-theme-secondary hover:text-theme-primary transition-colors",title:"",children:[c.jsx(Iw,{size:14}),""]}),c.jsxs("div",{className:"flex items-center gap-1 bg-theme-hover p-0.5 rounded-lg ml-2",children:[c.jsx("button",{onClick:()=>v("list"),className:`p-1.5 rounded-md transition-all ${g==="list"?"bg-white shadow-sm text-indigo-500":"text-gray-400 hover:text-gray-600"}`,title:"",children:c.jsx(PI,{size:16})}),c.jsx("button",{onClick:()=>v("gantt"),className:`p-1.5 rounded-md transition-all ${g==="gantt"?"bg-white shadow-sm text-indigo-500":"text-gray-400 hover:text-gray-600"}`,title:"",children:c.jsx(bz,{size:16})})]})]}),B.description&&c.jsxs("div",{className:"border-b bg-theme-hover",style:{borderBottomColor:Q.color+"30"},children:[c.jsx("div",{className:"flex items-center gap-2 px-6 py-1 cursor-pointer hover:bg-theme-card transition-colors",onClick:()=>Ne(!ue),children:c.jsx(Lr.div,{animate:{rotate:ue?90:0},transition:{duration:.15},children:c.jsx(is,{size:16,className:"text-gray-400"})})}),ue&&c.jsxs("div",{className:"relative",children:[c.jsxs("div",{className:"px-6 pb-3 overflow-y-auto custom-scrollbar transition-all duration-200 relative group",style:{height:Ue},onKeyDown:He=>He.stopPropagation(),children:[c.jsx(Zg,{onEditorReady:He=>{We.current=He},onPolish:(He,J,Pe)=>{oe(J),Pe&&te(Pe),Te(!0),Ye("")},initialContent:dt,onChange:ft,editable:!0,descFontClass:"font-extralight",textSizeClass:"text-sm",className:"min-h-full pb-8 text-theme-secondary"}),c.jsx("button",{onClick:He=>{He.stopPropagation(),Ne(!1)},className:"absolute bottom-2 right-6 p-1.5 rounded-full bg-theme-main/80 hover:bg-theme-hover text-gray-400 hover:text-theme-secondary transition-all opacity-0 group-hover:opacity-100 flex items-center gap-1 text-xs font-medium backdrop-blur-sm z-10 border border-theme shadow-sm",title:"",children:c.jsx(is,{size:14,className:"-rotate-90"})})]}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1.5 cursor-ns-resize hover:bg-indigo-200 transition-colors group",onMouseDown:()=>ct(!0),children:c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-0 w-8 h-1 rounded-full bg-gray-300 group-hover:bg-indigo-400 transition-colors"})})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden relative",children:g==="list"?c.jsx(TR,{rootParentId:f}):c.jsx("div",{className:"h-full w-full",children:c.jsx(jR,{plan:ne,onUpdatePlan:Se,onEditTask:He=>s(He)})})}),i===f&&B&&c.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center bg-theme-main/95 backdrop-blur-sm overflow-y-auto pt-20",children:[c.jsx("div",{className:"w-full max-w-3xl px-4 pb-20",children:c.jsx(Fo,{initialData:B,onClose:()=>s(null)})}),c.jsx("button",{onClick:()=>s(null),className:"absolute top-6 right-6 p-2 text-gray-400 hover:text-theme-secondary rounded-full hover:bg-theme-hover transition-colors",children:c.jsx(hn,{size:24})})]}),c.jsx(Jee,{isOpen:$e,onClose:()=>Te(!1),position:je||void 0,customPrompt:Je,setCustomPrompt:Ye,onRun:fe,prompts:Ie,saveToLibrary:Ke,setSaveToLibrary:lt,isLoading:St,history:ee,historyIndex:ce,setHistoryIndex:Z,onDeleteHistory:xt,onUpdateHistory:It,onReplace:Oe,onInsert:et})]})}return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main",children:[c.jsxs("div",{className:"flex items-center justify-between px-6 py-4 bg-theme-header backdrop-blur-sm border-b border-gray-200/50",children:[c.jsxs("div",{children:[c.jsx("h1",{className:`text-xl font-bold text-theme-primary ${se}`,children:""}),c.jsxs("p",{className:"text-xs text-theme-secondary mt-0.5",children:[N.length," "]})]}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("button",{onClick:F,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg text-sm font-medium transition-colors shadow-sm",children:[c.jsx(yz,{size:16}),""]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(Fz,{size:14,className:"text-gray-400"}),c.jsx("input",{type:"range",min:180,max:400,value:w,onChange:Q=>_(parseInt(Q.target.value)),className:"w-24 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"}),c.jsxs("span",{className:"text-xs text-theme-secondary w-12",children:[w,"px"]})]})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6",onClick:()=>m(null),children:N.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx("div",{className:"w-24 h-24 bg-theme-hover rounded-2xl flex items-center justify-center mb-4",children:c.jsx(wf,{size:40,className:"opacity-30"})}),c.jsx("p",{className:"text-lg font-medium",children:""}),c.jsx("p",{className:"text-sm mt-1",children:"project"})]}):c.jsx(nU,{children:c.jsx("div",{className:"flex flex-wrap gap-5",style:{display:"flex",flexWrap:"wrap",gap:"20px"},onDragOver:G,onDrop:R,children:S.map(Q=>c.jsx(Qee,{project:Q,size:w,tags:e,isSelected:p===Q.id,isDragging:C===Q.id,isDropTarget:P===Q.id,onSelect:()=>m(Q.id),onDoubleClick:()=>h(Q.id),onDelete:()=>ge(Q.id),onDragStart:()=>O(Q.id),onDragEnd:Ee,registerRef:I,fontFamilyClass:se},Q.id))})})})]})},Qee=({project:t,size:e,tags:n,isSelected:r,isDragging:s,isDropTarget:i,onSelect:o,onDoubleClick:a,onDragStart:l,onDragEnd:u,registerRef:d,fontFamilyClass:f})=>{const h=Qn[t.color]||Qn.blue,p=x.useMemo(()=>t.tags.some(w=>{const _=n.find(D=>D.id===w);return _&&_.name.includes("")}),[t.tags,n]),m=t.childCount>0?t.completedCount/t.childCount:0,y=10,b=2*Math.PI*y,g=b-m*b,v=w=>{w.dataTransfer.effectAllowed="move",w.dataTransfer.setData("text/plain",t.id),l()};return c.jsx(Lr.div,{layout:!0,layoutId:t.id,transition:{layout:{type:"spring",stiffness:350,damping:25,mass:.8}},ref:w=>d(t.id,w),draggable:!0,onDragStart:v,onDragEnd:u,className:`relative transition-opacity duration-200 ${s?"opacity-50 scale-95":""}`,style:{width:e,...i&&{marginRight:"8px",borderRight:"4px solid #6366f1"}},onDoubleClick:w=>{w.stopPropagation(),a()},children:c.jsx(Lr.div,{onClick:w=>{w.stopPropagation(),s||o()},className:`
                    relative rounded-[20px] overflow-hidden cursor-pointer group flex flex-col
                    bg-white dark:bg-gray-800 
                    shadow-[0_2px_8px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)]
                    border border-gray-100 dark:border-gray-700
                    transition-all duration-300 ease-out
                    ${r?"ring-2 ring-indigo-500 shadow-md":""}
                    ${s?"ring-2 ring-indigo-400":""}
                    ${p?"ring-1 ring-yellow-400/50":""}
                `,style:{height:e*.75},whileHover:s?{}:{y:-4,scale:1.01},children:c.jsxs("div",{className:"p-5 flex flex-col h-full bg-gradient-to-br from-white to-gray-50/50 dark:from-gray-800 dark:to-gray-800/50",children:[c.jsxs("div",{className:"flex justify-between items-start mb-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-lg font-bold shadow-sm",style:{backgroundColor:p?"#fefce8":h.color+"15",color:p?"#ca8a04":h.color},children:p?c.jsx(Vz,{size:18}):t.title.charAt(0).toUpperCase()}),c.jsx("div",{className:"relative w-8 h-8 flex items-center justify-center",children:c.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[c.jsx("circle",{cx:"16",cy:"16",r:y,stroke:"currentColor",strokeWidth:"2.5",fill:"none",className:"text-gray-100 dark:text-gray-700"}),c.jsx("circle",{cx:"16",cy:"16",r:y,stroke:h.color,strokeWidth:"2.5",fill:"none",strokeDasharray:b,strokeDashoffset:g,strokeLinecap:"round",className:"transition-all duration-1000 ease-out"})]})})]}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:`font-bold text-[17px] text-gray-800 dark:text-gray-100 leading-tight mb-1 truncate ${f}`,children:t.title}),c.jsxs("p",{className:"text-[11px] font-medium text-gray-400 dark:text-gray-500 uppercase tracking-wide",children:[t.completedCount," / ",t.childCount," Completed"]})]}),c.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:c.jsx("div",{className:"p-1 rounded text-gray-300 hover:text-gray-500",children:c.jsx(DI,{size:14})})})]})})})},Wy=[{id:"learning",label:"",icon:xf,row:0,col:0,color:"from-blue-500 to-cyan-400"},{id:"experience",label:"",icon:uz,row:0,col:1,color:"from-purple-500 to-pink-400"},{id:"leisure",label:"",icon:cz,row:0,col:2,color:"from-green-500 to-emerald-400"},{id:"work",label:"",icon:sz,row:1,col:0,color:"from-orange-500 to-amber-400"},{id:"core",label:"",icon:VI,row:1,col:1,color:"from-yellow-500 to-orange-400",isCenter:!0},{id:"family",label:"",icon:_z,row:1,col:2,color:"from-rose-500 to-pink-400"},{id:"social",label:"",icon:Kz,row:2,col:0,color:"from-indigo-500 to-blue-400"},{id:"finance",label:"",icon:Gz,row:2,col:1,color:"from-emerald-500 to-teal-400"},{id:"health",label:"",icon:ou,row:2,col:2,color:"from-red-500 to-rose-400"}],Zee=()=>{const{tasks:t,tags:e,themeSettings:n,setView:r}=x.useContext(jn),[s,i]=x.useState(null),o=x.useMemo(()=>e.filter(h=>h.name.includes("")).map(h=>h.id),[e]),a=x.useMemo(()=>{const h={};return Wy.forEach(p=>{h[p.id]=e.filter(m=>m.name.includes(p.label)).map(m=>m.id)}),h},[e]),l=x.useMemo(()=>{const h=e.find(p=>p.name.toLowerCase()==="project");return h?t.filter(p=>{var m,y;return p.status!=="deleted"&&((m=p.tags)==null?void 0:m.includes(h.id))&&((y=p.tags)==null?void 0:y.some(b=>o.includes(b)))}).map(p=>({id:p.id,title:p.title,color:p.color||"blue",tags:p.tags||[]})):[]},[t,e,o]),u=x.useMemo(()=>{const h={};return Wy.forEach(p=>{h[p.id]=l.filter(m=>m.tags.some(y=>{var b;return(b=a[p.id])==null?void 0:b.includes(y)}))}),h},[l,a]),d=n.fontFamily==="things"?"font-things":"font-sans",f=h=>{localStorage.setItem("openProjectId",h),localStorage.setItem("previousView","annualplan"),r("project")};return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main",children:[c.jsx("div",{className:"flex items-center justify-between px-6 py-4 bg-theme-header backdrop-blur-sm border-b border-gray-200/50",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-xl shadow-lg",children:c.jsx(WI,{size:24,className:"text-white"})}),c.jsxs("div",{children:[c.jsx("h1",{className:`text-xl font-bold text-theme-primary ${d}`,children:""}),c.jsxs("p",{className:"text-xs text-theme-tertiary",children:[l.length," "]})]})]})}),c.jsx("div",{className:"flex-1 p-6 overflow-auto",onClick:()=>i(null),children:c.jsx("div",{className:"grid grid-cols-3 gap-4 h-full max-w-5xl mx-auto",children:Wy.map(h=>{const p=h.icon,m=u[h.id]||[];return c.jsxs(Lr.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:h.row*.1+h.col*.05},className:`
                                    relative rounded-2xl overflow-hidden
                                    bg-theme-card shadow-lg
                                    border border-gray-200/50 dark:border-gray-700/50
                                    ${h.isCenter?"ring-2 ring-yellow-400/50 shadow-yellow-100/30":""}
                                `,children:[c.jsxs("div",{className:`
                                    px-3 py-2 bg-gradient-to-r ${h.color}
                                    flex items-center gap-2
                                `,children:[c.jsx(p,{size:16,className:"text-white/90"}),c.jsx("span",{className:"text-sm font-bold text-white/95 drop-shadow-sm",children:h.label})]}),c.jsx("div",{className:"p-2 space-y-1 max-h-[calc(100%-40px)] overflow-y-auto",children:m.length===0?c.jsx("div",{className:"text-center py-4 text-theme-tertiary text-xs",children:""}):m.map(y=>{const b=Qn[y.color]||Qn.blue,g=s===y.id;return c.jsx(Lr.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:v=>{v.stopPropagation(),i(y.id)},onDoubleClick:v=>{v.stopPropagation(),f(y.id)},className:`
                                                        px-3 py-2 rounded-lg cursor-pointer
                                                        transition-all duration-150
                                                        ${g?"bg-indigo-100 dark:bg-indigo-900/30 ring-2 ring-indigo-500":"hover:bg-theme-hover"}
                                                    `,style:{borderLeft:`3px solid ${b.color}`},children:c.jsx("p",{className:`text-sm font-medium text-theme-primary line-clamp-2 ${d}`,children:y.title})},y.id)})}),m.length>0&&c.jsx("div",{className:"absolute top-2 right-2 px-2 py-0.5 bg-white/90 dark:bg-gray-800/90 rounded-full text-[10px] font-bold text-gray-600 dark:text-gray-300 shadow-sm",children:m.length})]},h.id)})})})]})},ete=()=>{const{advancedFilters:t,setAdvancedFilters:e,tags:n,tagFilter:r}=x.useContext(jn);if(!r)return null;const s=n.filter(l=>{let u=l;for(;u.parent_id;){if(u.parent_id===r)return!0;u=n.find(d=>d.id===u.parent_id)||{parent_id:null}}return!1}),i=l=>{l&&e(u=>({...u,additionalTags:u.additionalTags.includes(l)?u.additionalTags.filter(d=>d!==l):[...u.additionalTags,l]}))},o=()=>{e({additionalTags:[],startDate:null,dueDate:null,color:null})},a=t.additionalTags.length>0;return c.jsxs("div",{className:"px-8 py-3 border-b border-gray-50 bg-gray-50/30 flex items-center gap-4 relative z-20",children:[c.jsx("div",{className:"flex items-center gap-2",children:c.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Filters:"})}),c.jsx(M1,{icon:Ll,label:"Sub-tags",items:s,selectedIds:t.additionalTags,onSelect:i,multiSelect:!0,placeholder:"Filter by sub-tags..."}),a&&c.jsxs("button",{onClick:o,className:"ml-auto flex items-center gap-1 text-[10px] text-gray-400 hover:text-red-500 transition-colors",children:[c.jsx(hn,{size:12})," Clear"]})]})},tte=({toast:t,onClose:e})=>{const[n,r]=x.useState(!1);x.useEffect(()=>{requestAnimationFrame(()=>r(!0));const a=setTimeout(()=>{r(!1),setTimeout(e,300)},1e4);return()=>clearTimeout(a)},[t,e]);const s=()=>t.type==="error"?c.jsx(Jf,{size:16}):t.undo?c.jsx(iz,{size:16}):c.jsx(AI,{size:16}),i=()=>{t.onClick&&(t.onClick(),e())},o=a=>{a.stopPropagation(),r(!1),setTimeout(e,300)};return c.jsx("div",{className:`
                fixed top-4 left-1/2 -translate-x-1/2 z-[9999]
                transition-all duration-300 ease-out
                ${n?"opacity-100 translate-y-0":"opacity-0 -translate-y-4"}
            `,children:c.jsxs("div",{className:`
                    px-4 py-2.5 rounded-full shadow-lg flex items-center gap-3 backdrop-blur-md
                    ${t.type==="error"?"bg-red-500/90 text-white":"bg-gray-900/90 text-white"}
                    ${t.onClick?"cursor-pointer hover:bg-gray-800/95 transition-colors":""}
                `,onClick:t.onClick?i:void 0,children:[c.jsxs("div",{className:"flex items-center gap-2",children:[s(),c.jsx("span",{className:"text-sm font-medium",children:t.msg})]}),t.onClick&&!t.undo&&c.jsxs("div",{className:"flex items-center gap-1 text-xs text-white/70",children:[c.jsx(II,{size:12}),c.jsx("span",{children:t.actionLabel||""})]}),t.undo&&c.jsxs("button",{onClick:a=>{var l;a.stopPropagation(),(l=t.undo)==null||l.call(t),e()},className:"flex items-center gap-1 px-2.5 py-1 bg-white/20 hover:bg-white/30 rounded-full text-xs font-bold transition-colors",children:[c.jsx(BI,{size:12}),"Undo"]}),c.jsx("button",{onClick:o,className:"p-1 -mr-1.5 rounded-full hover:bg-white/20 transition-colors",title:"",children:c.jsx(hn,{size:14})})]})})},IR=t=>t.map(e=>({...e,id:e.id||crypto.randomUUID(),subtasks:e.subtasks?IR(e.subtasks):[]})),nte=({taskId:t,onClose:e})=>{const{tasks:n,tags:r,batchAddTasks:s,setToast:i}=x.useContext(jn),[o,a]=x.useState("prompt"),[l,u]=x.useState(null),[d,f]=x.useState(null),[h,p]=x.useState(!1),[m,y]=x.useState(""),[b,g]=x.useState(""),[v,w]=x.useState("list"),[_,D]=x.useState([]),[k,A]=x.useState(-1);x.useEffect(()=>{l&&_.length===0&&(D([l]),A(0))},[l]);const N=I=>{const K=_.slice(0,k+1);K.push(I),D(K),A(K.length-1),u(I)},E=()=>{if(k>0){const I=k-1;A(I),u(_[I])}},S=()=>{if(k<_.length-1){const I=k+1;A(I),u(_[I])}};x.useEffect(()=>{const I=K=>{(K.metaKey||K.ctrlKey)&&K.key==="z"&&(K.preventDefault(),K.stopPropagation(),K.shiftKey?S():E())};return window.addEventListener("keydown",I,{capture:!0}),()=>window.removeEventListener("keydown",I,{capture:!0})},[k,_]);const T=n.find(I=>I.id===t),C=x.useMemo(()=>{const I=r.find(K=>K.name.trim().toLowerCase()==="prompt");return I?n.filter(K=>K.tags.includes(I.id)&&K.status!=="deleted"&&K.status!=="logged").sort((K,G)=>G.created_at.localeCompare(K.created_at)):[]},[n,r]),O=x.useMemo(()=>{if(!b.trim())return C.slice(0,10);const I=b.toLowerCase();return C.filter(K=>K.title.toLowerCase().includes(I)||(K.description||"").toLowerCase().includes(I)).slice(0,10)},[C,b]),P=async()=>{if(!T){f("Task not found"),a("error");return}a("loading");try{const I=new Date().toISOString().split("T")[0],K=new Date,G=new Date;G.setDate(G.getDate()+14);const R=n.filter(se=>se.status!=="deleted"&&se.status!=="completed"&&se.status!=="logged").filter(se=>{const We=se.start_date||se.due_date;if(!We)return!1;const ut=new Date(We);return ut>=K&&ut<=G}).map(se=>{var We,ut;return`- ${((We=se.start_date)==null?void 0:We.split("T")[0])||((ut=se.due_date)==null?void 0:ut.split("T")[0])}: ${se.title}`}).slice(0,20),Ee=T.title.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g,"").match(/.{1,2}/g)||[],ge=n.filter(se=>se.status==="completed"||se.status==="logged").map(se=>{let We=0;return Ee.forEach(ut=>{se.title.includes(ut)&&We++}),{task:se,score:We}}).filter(se=>se.score>0).sort((se,We)=>We.score-se.score).slice(0,5).map(se=>`- [] ${se.task.title}: ${se.task.description||"()"}`),F=await OY(T.title,T.description||"",T.start_date||null,T.due_date||null,{today:I,existingSchedule:R,pastExperiences:ge},m||void 0),B=IR(F);u(B),D([B]),A(0),a("preview")}catch(I){console.error(I),f(I.message||"Failed to generate plan"),a("error")}},H=async()=>{if(l){p(!0);try{await s(l,t),i({msg:"72",type:"info"}),e()}catch(I){i({msg:""+I.message,type:"error"}),p(!1)}}},M=(I,K,G)=>{if(!l)return;const R=JSON.parse(JSON.stringify(l));let Ee=R;for(let ge=0;ge<I.length-1;ge++)Ee=Ee[I[ge]].subtasks;Ee[I[I.length-1]][K]=G,N(R)};return o==="prompt"?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-xl max-h-[80vh] flex flex-col animate-in slide-in-from-bottom-10 duration-200",children:[c.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-2xl",children:""}),c.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"72"})]}),c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 rounded-full p-1 hover:bg-gray-100",children:c.jsx(hn,{size:20})})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-6 flex flex-col gap-4",children:[c.jsx("div",{className:"bg-indigo-50 p-3 rounded-lg border border-indigo-100",children:c.jsxs("p",{className:"text-sm text-indigo-700",children:["",c.jsx("strong",{children:T==null?void 0:T.title})]})}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),c.jsx("textarea",{value:m,onChange:I=>y(I.target.value),placeholder:"...",className:"w-full border border-gray-200 rounded-lg p-3 text-sm focus:ring-2 focus:ring-indigo-200 focus:border-indigo-400 resize-none",rows:3})]}),C.length>0&&c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),c.jsx("input",{type:"text",value:b,onChange:I=>g(I.target.value),placeholder:"...",className:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm mb-2 focus:ring-2 focus:ring-indigo-200 focus:border-indigo-400"}),c.jsx("div",{className:"flex flex-col gap-1 max-h-40 overflow-y-auto",children:O.map(I=>c.jsxs("button",{onClick:()=>y(I.description||I.title),className:"text-left p-2 rounded-lg hover:bg-gray-50 border border-gray-100 text-sm transition-colors",children:[c.jsx("span",{className:"font-medium text-gray-800",children:I.title}),I.description&&c.jsxs("p",{className:"text-xs text-gray-500 line-clamp-1 mt-0.5",children:[I.description.slice(0,80),"..."]})]},I.id))})]})]}),c.jsxs("div",{className:"px-6 py-4 border-t bg-white flex justify-end gap-3",children:[c.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:""}),c.jsxs("button",{onClick:P,className:"px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg flex items-center gap-2",children:[c.jsx(a1,{size:18}),""]})]})]})}):o==="loading"?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/30 backdrop-blur-sm",children:c.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 flex flex-col items-center gap-4 animate-in zoom-in duration-200",children:[c.jsx(xi,{className:"w-12 h-12 text-indigo-600 animate-spin"}),c.jsx("p",{className:"text-lg font-medium text-gray-700",children:"72..."}),c.jsx("p",{className:"text-sm text-gray-500",children:""})]})}):o==="error"?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/30 backdrop-blur-sm",children:c.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 w-[400px] flex flex-col gap-4",children:[c.jsxs("div",{className:"flex items-center gap-3 text-red-600",children:[c.jsx(Jf,{size:24}),c.jsx("h3",{className:"text-lg font-bold",children:""})]}),c.jsx("p",{className:"text-gray-600",children:d}),c.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[c.jsx("button",{onClick:()=>a("prompt"),className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700",children:""}),c.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700",children:""})]})]})}):c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col animate-in slide-in-from-bottom-10 duration-200",children:[c.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between sticky top-0 bg-white rounded-t-xl z-10",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-2xl",children:""}),c.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"72"})]}),c.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg",children:[c.jsx("button",{onClick:()=>w("list"),className:`px-3 py-1.5 text-sm rounded-md transition-all ${v==="list"?"bg-white shadow-sm text-indigo-600 font-medium":"text-gray-500 hover:text-gray-700"}`,children:""}),c.jsx("button",{onClick:()=>w("gantt"),className:`px-3 py-1.5 text-sm rounded-md transition-all ${v==="gantt"?"bg-white shadow-sm text-indigo-600 font-medium":"text-gray-500 hover:text-gray-700"}`,children:""})]})]}),c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 rounded-full p-1 hover:bg-gray-100",children:c.jsx(hn,{size:20})})]}),c.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50/50 flex flex-col",children:v==="list"?c.jsxs("div",{className:"p-6",children:[c.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg border border-indigo-100 mb-4",children:[c.jsx("h3",{className:"font-bold text-indigo-900 mb-1",children:T==null?void 0:T.title}),c.jsx("p",{className:"text-sm text-indigo-700",children:"AI"})]}),c.jsx("div",{className:"flex flex-col gap-3",children:l==null?void 0:l.map((I,K)=>c.jsx(MR,{item:I,path:[K],onUpdate:M},K))})]}):c.jsx("div",{className:"flex-1 min-h-[500px] flex flex-col",children:l&&c.jsx(jR,{plan:l,onUpdatePlan:N})})}),c.jsxs("div",{className:"px-6 py-4 border-t bg-white rounded-b-xl flex justify-between sticky bottom-0 z-10",children:[c.jsxs("button",{onClick:()=>a("prompt"),className:"px-4 py-2 text-gray-500 hover:bg-gray-100 rounded-lg flex items-center gap-1",children:[c.jsx(Mg,{size:16})," "]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:e,className:"px-5 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",disabled:h,children:""}),c.jsxs("button",{onClick:H,disabled:h,className:"px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg shadow-sm flex items-center gap-2 disabled:opacity-70",children:[h?c.jsx(xi,{className:"animate-spin",size:18}):c.jsx(Zn,{size:18}),h?"...":""]})]})]})]})})},MR=({item:t,path:e,depth:n=0,onUpdate:r})=>{const[s,i]=x.useState(!0),o=t.subtasks&&t.subtasks.length>0;return c.jsxs("div",{className:"flex flex-col",children:[c.jsx("div",{className:`p-3 bg-white rounded-lg border border-gray-100 shadow-sm ${n>0?"ml-6":""}`,children:c.jsxs("div",{className:"flex items-start gap-2",children:[o?c.jsx("button",{onClick:()=>i(!s),className:"mt-1 text-gray-400 hover:text-gray-600",children:s?c.jsx(rs,{size:14}):c.jsx(is,{size:14})}):c.jsx("div",{className:"w-[14px] mt-1"}),c.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[c.jsx("input",{type:"text",value:t.title,onChange:a=>r(e,"title",a.target.value),className:"font-medium text-gray-800 bg-transparent border-b border-transparent hover:border-gray-200 focus:border-indigo-400 focus:outline-none px-1 py-0.5 w-full",placeholder:""}),c.jsxs("div",{className:"flex items-start gap-1",children:[c.jsx(Xf,{size:12,className:"text-gray-400 mt-1 flex-shrink-0"}),c.jsx("textarea",{value:t.description||"",onChange:a=>r(e,"description",a.target.value),placeholder:"...",className:"text-sm text-gray-600 bg-gray-50 border border-gray-100 rounded px-2 py-1 w-full resize-none focus:border-indigo-300 focus:outline-none",rows:2})]}),c.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(So,{size:12,className:"text-gray-400"}),c.jsx("span",{className:"text-gray-500",children:":"}),c.jsx("input",{type:"date",value:t.start_date||"",onChange:a=>r(e,"start_date",a.target.value),className:"border border-gray-200 rounded px-1 py-0.5 text-xs focus:border-indigo-400 focus:outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("span",{className:"text-gray-500",children:":"}),c.jsx("input",{type:"date",value:t.due_date||"",onChange:a=>r(e,"due_date",a.target.value),className:"border border-gray-200 rounded px-1 py-0.5 text-xs focus:border-indigo-400 focus:outline-none"})]})]})]})]})}),o&&s&&c.jsx("div",{className:"flex flex-col gap-2 mt-2 pl-6 relative",children:t.subtasks.map((a,l)=>c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"absolute left-[-12px] top-[-14px] bottom-[20px] w-px bg-gray-200 -z-10"}),c.jsx("div",{className:"absolute left-[-12px] top-[26px] w-[12px] h-px bg-gray-200 -z-10"}),c.jsx(MR,{item:a,path:[...e,l],depth:n+1,onUpdate:r})]},l))})]})},yb=({taskId:t,initialData:e,onClose:n})=>{const{tasks:r,tags:s,updateTask:i,addTask:o,addTag:a,deleteTask:l,toggleExpansion:u,setToast:d,user:f}=x.useContext(jn),{isRecording:h,startRecording:p,stopRecording:m,recordingTaskId:y}=x.useContext(Ru),b=t?r.find(J=>J.id===t):null,g=b||e||{},[v,w]=x.useState(g.title||""),[_,D]=x.useState(g.description||""),[k,A]=x.useState(g.start_date||""),[N,E]=x.useState(g.due_date||""),[S,T]=x.useState(g.tags||[]),[C,O]=x.useState(g.parent_id||null),[P,H]=x.useState(g.color||"blue"),[M,I]=x.useState(g.importance||"unplanned"),[K,G]=x.useState(g.repeat_rule||null),[R,Ee]=x.useState(g.images||[]),[ge,F]=x.useState(g.attachments||[]),[B,se]=x.useState(g.is_all_day!==!1),[We,ut]=x.useState(()=>{if(g.start_time)return g.start_time;if(g.start_date&&!g.is_all_day){const J=new Date(g.start_date);return`${String(J.getHours()).padStart(2,"0")}:${String(J.getMinutes()).padStart(2,"0")}`}return""}),[oe,je]=x.useState(()=>g.end_time?g.end_time:(g.start_date&&!g.is_all_day&&g.duration,"")),[te,$e]=x.useState(()=>{if(t)try{const J=localStorage.getItem(`task_reminder_${t}`);if(J!==null)return JSON.parse(J)}catch{}return(b==null?void 0:b.reminder_minutes)??null}),[Te,Je]=x.useState(null),[Ye,Ke]=x.useState(!1),[lt,St]=x.useState(!1),[X,ee]=x.useState(!1),[ie,ce]=x.useState(!1),[Z,ne]=x.useState(""),[Se,Ie]=x.useState(!1),fe=x.useRef(null),[Oe,et]=x.useState(!1),[xt,It]=x.useState(null),[ue,Ne]=x.useState(()=>{if(k){const J=new Date(k);return new Date(J.getFullYear(),J.getMonth(),1)}return new Date(new Date().getFullYear(),new Date().getMonth(),1)}),[Ue,Ze]=x.useState(null),xe=x.useRef(null),ct=x.useRef(null),dt=x.useRef(null),ft=x.useRef(null),de=x.useRef(null);if(x.useEffect(()=>{const J=setTimeout(()=>St(!0),100);return()=>clearTimeout(J)},[]),x.useEffect(()=>{b?(w(b.title||""),D((b==null?void 0:b.description)||""),A(()=>{const J=b.start_date;return J?J.includes("T")?ht(new Date(J)):J:""}),E(b.due_date||""),T(b.tags||[]),O(b.parent_id||null),H(b.color||"blue"),I(b.importance||"unplanned"),G(b.repeat_rule||null),Ee(b.images||[]),F(b.attachments||[])):!t&&e?(w(e.title||""),D(e.description||""),A(e.start_date||""),E(e.due_date||""),T(e.tags||[]),O(e.parent_id||null),H(e.color||"blue"),I(e.importance||"unplanned"),G(e.repeat_rule||null),Ee(e.images||[]),F(e.attachments||[])):t||(w(""),D(""),A(""),E(""),T([]),O(null),H("blue"),I("unplanned"),G(null),Ee([]),F([]))},[b,t,e]),x.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]),x.useEffect(()=>{if(!t&&lt&&ct.current){const J=()=>{if(ct.current){window.scrollTo(0,0);const Pe=document.querySelector(".mobile-task-editor-content");Pe&&(Pe.scrollTop=0),ct.current.focus({preventScroll:!0}),ct.current.click()}};J(),setTimeout(J,100),setTimeout(J,300)}},[t,lt]),t&&!b)return null;const ve=async()=>{if(console.log("[MobileTaskEditor] handleSave called, title:",v),!v.trim()){d==null||d({msg:"",type:"error"});return}try{let J=k||null;k&&!B&&We&&(J=`${k.split("T")[0]}T${We}:00`);let Pe=null;if(!B&&We&&oe){const[mt,Wt]=We.split(":").map(Number),[Dn,Ht]=oe.split(":").map(Number),cn=mt*60+Wt;Pe=Dn*60+Ht-cn,Pe<0&&(Pe+=24*60)}const ze={title:v.trim(),description:_,start_date:J,due_date:N||null,tags:S,parent_id:C,color:C?void 0:P,importance:M,repeat_rule:K,images:R,attachments:ge,is_all_day:B,start_time:B?null:We,end_time:B?null:oe,duration:Pe,reminder_minutes:te};if(console.log("[MobileTaskEditor] taskData:",ze),console.log("[MobileTaskEditor] taskId:",t),console.log("[MobileTaskEditor] addTask function:",typeof o),t)await i(t,ze),C&&u(C,!0);else{const mt=await o({...ze,status:"inbox"},[]);if(console.log("[MobileTaskEditor] addTask returned:",mt),!mt){console.error("[MobileTaskEditor] addTask returned empty - check supabaseClient"),d==null||d({msg:"",type:"error"});return}}d==null||d({msg:"",type:"info"}),n()}catch(J){console.error("[MobileTaskEditor] Save failed:",J),console.error("[MobileTaskEditor] Error details:",J==null?void 0:J.message,J==null?void 0:J.stack),d==null||d({msg:`: ${(J==null?void 0:J.message)||""}`,type:"error"})}},tt=()=>{t&&(l(t),d==null||d({msg:"",type:"info"})),n()},st=J=>{if(!J)return"";const Pe=new Date(J),ze=new Date,mt=new Date(ze);return mt.setDate(mt.getDate()+1),Pe.toDateString()===ze.toDateString()?"":Pe.toDateString()===mt.toDateString()?"":Pe.toLocaleDateString("zh-TW",{month:"short",day:"numeric",weekday:"short"})},ht=J=>{const Pe=J.getFullYear(),ze=String(J.getMonth()+1).padStart(2,"0"),mt=String(J.getDate()).padStart(2,"0");return`${Pe}-${ze}-${mt}`},Xe={urgent:{label:"",color:"bg-red-500",text:"text-red-600",bg:"bg-red-50"},planned:{label:"",color:"bg-amber-500",text:"text-amber-600",bg:"bg-amber-50"},delegated:{label:"",color:"bg-green-500",text:"text-green-600",bg:"bg-green-50"},unplanned:{label:"",color:"bg-gray-400",text:"text-gray-500",bg:"bg-gray-50"}},At=J=>{lt&&dt.current&&!dt.current.contains(J.target)&&n()},jt=async(J,Pe)=>{const ze=J.target.files;if(!ze||ze.length===0||!f||!be)return;ee(!0);const mt=ze[0];try{const Wt=`${Date.now()}_${xI()}.${mt.name.split(".").pop()}`,Ht=`${f.id}/${Wt}`,{error:cn}=await be.storage.from("attachments").upload(Ht,mt,{contentType:mt.type,upsert:!1});if(cn)throw cn;const{data:pe}=be.storage.from("attachments").getPublicUrl(Ht);if(pe){const q={name:mt.name,url:pe.publicUrl,size:mt.size,type:mt.type};if(Pe){if(Ee(ye=>[...ye,pe.publicUrl]),t){const ye=(b==null?void 0:b.images)||[];await i(t,{images:[...ye,pe.publicUrl]},[],{skipHistory:!0})}d==null||d({msg:"",type:"info"})}else{if(F(ye=>[...ye,q]),t){const ye=(b==null?void 0:b.attachments)||[];await i(t,{attachments:[...ye,q]},[],{skipHistory:!0})}d==null||d({msg:"",type:"info"})}}}catch(Wt){console.error(Wt),d==null||d({msg:"",type:"error"})}finally{ee(!1),J.target&&(J.target.value="")}},Q=async(J,Pe)=>{if(confirm("")){if(Pe){if(Ee(ze=>ze.filter(mt=>mt!==J)),t){const ze=(b==null?void 0:b.images)||[];await i(t,{images:ze.filter(mt=>mt!==J)},[],{skipHistory:!0})}}else if(F(ze=>ze.filter(mt=>mt.url!==J)),t){const ze=(b==null?void 0:b.attachments)||[];await i(t,{attachments:ze.filter(mt=>mt.url!==J)},[],{skipHistory:!0})}}},me=J=>{if(Ue===J&&xe.current)xe.current.paused?xe.current.play():(xe.current.pause(),Ze(null));else{xe.current&&xe.current.pause();const Pe=new Audio(J);Pe.onended=()=>Ze(null),xe.current=Pe,Pe.play(),Ze(J)}},He=c.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-end justify-center",onMouseDown:At,style:{touchAction:"none"},children:[c.jsx("div",{className:"absolute inset-0 bg-black/40"}),c.jsxs(Lr.div,{ref:dt,initial:{y:"100%"},animate:{y:0},transition:{type:"spring",damping:25,stiffness:300},onMouseDown:J=>J.stopPropagation(),onTouchStart:J=>J.stopPropagation(),className:"relative w-full bg-white rounded-t-3xl max-h-[80dvh] flex flex-col overflow-hidden shadow-2xl",children:[c.jsx("div",{className:"flex justify-center pt-3 pb-2 flex-shrink-0",children:c.jsx("div",{className:"w-10 h-1.5 bg-gray-300 rounded-full"})}),c.jsxs("div",{className:"flex items-center justify-between px-5 pb-3 border-b border-gray-100 flex-shrink-0",children:[c.jsx("button",{type:"button",onClick:n,className:"text-gray-500 p-2 -ml-2 active:bg-gray-100 rounded-full",children:c.jsx(hn,{size:24})}),h&&y===t?c.jsxs("div",{className:"flex items-center gap-2 text-red-500 animate-pulse font-medium",children:[c.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),"..."]}):c.jsx("h2",{className:"text-lg font-bold text-gray-800",children:t?"":""}),c.jsx("button",{type:"button",onClick:ve,className:"px-4 py-2 bg-indigo-600 text-white rounded-full font-bold text-sm active:bg-indigo-700",children:""})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-5 scroll-smooth mobile-task-editor-content pb-24",children:[c.jsxs("div",{className:"mb-6 relative",children:[c.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 block",children:""}),c.jsx("textarea",{ref:ct,autoFocus:!t,rows:1,name:`task_title_no_autofill_${Math.random()}`,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",value:v,onChange:J=>{w(J.target.value),Ie(J.target.value.length>0),J.target.style.height="auto",J.target.style.height=J.target.scrollHeight+"px"},onKeyDown:J=>{var Pe;J.key==="Enter"&&(J.preventDefault(),(Pe=ct.current)==null||Pe.blur())},onFocus:()=>Ie(v.length>0),onBlur:()=>setTimeout(()=>Ie(!1),200),placeholder:"...",className:"w-full text-xl font-medium text-gray-800 border-none outline-none bg-transparent placeholder-gray-300 p-0 resize-none overflow-hidden",style:{minHeight:"28px"}}),Se&&v.length>0&&(()=>{const J=r.filter(Pe=>Pe.id!==t&&Pe.title&&Pe.title.toLowerCase().includes(v.toLowerCase())&&Pe.title.toLowerCase()!==v.toLowerCase()).map(Pe=>Pe.title).filter((Pe,ze,mt)=>mt.indexOf(Pe)===ze).slice(0,5);return J.length===0?null:c.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white rounded-xl shadow-lg border border-gray-200 z-50 overflow-hidden",children:J.map((Pe,ze)=>c.jsx("button",{type:"button",onMouseDown:mt=>{mt.preventDefault(),w(Pe),Ie(!1)},className:"w-full text-left px-4 py-3 text-gray-700 hover:bg-indigo-50 border-b border-gray-100 last:border-b-0 transition-colors",children:Pe},ze))})})()]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-6",children:[c.jsxs("button",{type:"button",onClick:()=>Je(Te==="date"?null:"date"),className:`flex flex-col items-center justify-center p-3 rounded-2xl border transition-all ${Te==="date"||k?"border-indigo-500 bg-indigo-50":"border-gray-200 bg-white"}`,children:[c.jsx(So,{size:20,className:k?"text-indigo-600":"text-gray-400"}),c.jsx("span",{className:`text-[10px] mt-1.5 font-bold truncate w-full ${k?"text-indigo-600":"text-gray-500"}`,children:k?st(k):""})]}),c.jsxs("button",{type:"button",onClick:()=>ce(!0),className:`flex flex-col items-center justify-center p-3 rounded-2xl border transition-all ${ie||S.length>0?"border-purple-500 bg-purple-50":"border-gray-200 bg-white"}`,children:[c.jsx(tz,{size:20,className:S.length>0?"text-purple-600":"text-gray-400"}),c.jsx("span",{className:`text-[10px] mt-1.5 font-bold truncate w-full ${S.length>0?"text-purple-600":"text-gray-500"}`,children:S.length>0?`${S.length} `:""})]})]}),Te==="date"&&c.jsxs("div",{className:"bg-gray-50 rounded-2xl p-4 space-y-4 mb-6 animate-in slide-in-from-top-2",children:[c.jsxs("div",{className:"flex gap-2 flex-wrap",children:[c.jsx("button",{type:"button",onClick:()=>A(ht(new Date)),className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${k===ht(new Date)?"bg-indigo-600 text-white":"bg-white border border-gray-200 text-gray-700"}`,children:""}),c.jsx("button",{type:"button",onClick:()=>{const J=new Date;J.setDate(J.getDate()+1),A(ht(J))},className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${(()=>{const J=new Date;return J.setDate(J.getDate()+1),k===ht(J)})()?"bg-indigo-600 text-white":"bg-white border border-gray-200 text-gray-700"}`,children:""}),c.jsx("button",{type:"button",onClick:()=>A(""),className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${k?"bg-white border border-gray-200 text-gray-700":"bg-gray-600 text-white"}`,children:""})]}),c.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[c.jsxs("div",{className:"flex items-center justify-between p-2 border-b border-gray-100",children:[c.jsx("button",{type:"button",onClick:()=>Ne(new Date(ue.getFullYear(),ue.getMonth()-1,1)),className:"p-2 hover:bg-gray-100 rounded-lg",children:c.jsx(Ou,{size:18,className:"text-gray-600"})}),c.jsxs("span",{className:"text-sm font-bold text-gray-700",children:[ue.getFullYear()," ",ue.getMonth()+1,""]}),c.jsx("button",{type:"button",onClick:()=>Ne(new Date(ue.getFullYear(),ue.getMonth()+1,1)),className:"p-2 hover:bg-gray-100 rounded-lg",children:c.jsx(is,{size:18,className:"text-gray-600"})})]}),c.jsx("div",{className:"grid grid-cols-7 text-center text-[10px] font-bold text-gray-400 py-1 border-b border-gray-50",children:"".split("").map(J=>c.jsx("div",{children:J},J))}),c.jsx("div",{className:"grid grid-cols-7 gap-px bg-gray-100 p-px",children:(()=>{const J=new Date(ue.getFullYear(),ue.getMonth(),1),Pe=new Date(ue.getFullYear(),ue.getMonth()+1,0),ze=J.getDay(),mt=[];for(let Ht=0;Ht<ze;Ht++)mt.push(null);for(let Ht=1;Ht<=Pe.getDate();Ht++)mt.push(new Date(ue.getFullYear(),ue.getMonth(),Ht));const Wt=ht(new Date),Dn=k?k.split("T")[0]:"";return mt.map((Ht,cn)=>{if(!Ht)return c.jsx("div",{className:"bg-white"},`pad-${cn}`);const pe=ht(Ht),q=pe===Wt,ye=pe===Dn,Re=CR(Ht),_e=ER(Ht),it=Ht.getDay()===0||Ht.getDay()===6,Fe=r.filter(gt=>gt.id===t||!gt.start_date?!1:gt.start_date.split("T")[0]===pe).length;return c.jsxs("button",{type:"button",onClick:()=>A(pe),className:`relative bg-white p-1 min-h-[52px] flex flex-col items-center transition-all ${ye?"ring-2 ring-indigo-500 ring-inset":""} ${q?"bg-indigo-50":""}`,children:[c.jsx("span",{className:`text-sm font-bold ${ye?"text-indigo-600":Re?"text-red-500":it?"text-red-400":"text-gray-700"}`,children:Ht.getDate()}),Re?c.jsx("span",{className:"text-[8px] text-red-400 font-medium leading-tight truncate w-full text-center",children:Re}):_e?c.jsx("span",{className:"text-[8px] text-gray-400 leading-tight truncate w-full text-center",children:_e.slice(-2)}):null,Fe>0&&c.jsx("span",{className:"absolute bottom-0.5 right-0.5 w-4 h-4 bg-amber-500 text-white text-[9px] font-bold rounded-full flex items-center justify-center",children:Fe>9?"9+":Fe})]},pe)})})()})]}),c.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-xl border border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Oi,{size:18,className:"text-gray-500"}),c.jsx("span",{className:"text-sm font-medium text-gray-700",children:""})]}),c.jsx("button",{type:"button",onClick:()=>se(!B),className:`w-12 h-7 rounded-full transition-all ${B?"bg-indigo-600":"bg-gray-300"}`,children:c.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transition-transform ${B?"translate-x-6":"translate-x-1"}`})})]}),!B&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Oi,{size:18,className:"text-gray-500"}),c.jsx("input",{type:"time",value:We,onChange:J=>ut(J.target.value),className:"flex-1 p-3 bg-white rounded-xl border border-gray-200 text-center"}),c.jsx(Nw,{size:16,className:"text-gray-400"}),c.jsx("input",{type:"time",value:oe,onChange:J=>je(J.target.value),className:"flex-1 p-3 bg-white rounded-xl border border-gray-200 text-center"})]}),c.jsxs("div",{className:"p-3 bg-white rounded-xl border border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(Va,{size:18,className:"text-gray-500"}),c.jsx("span",{className:"text-sm font-medium text-gray-700",children:""})]}),c.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"",value:null},{label:"",value:0},{label:"5",value:5},{label:"15",value:15},{label:"30",value:30},{label:"1",value:60}].map(J=>c.jsx("button",{type:"button",onClick:()=>{$e(J.value),t&&(J.value!==null?localStorage.setItem(`task_reminder_${t}`,JSON.stringify(J.value)):localStorage.removeItem(`task_reminder_${t}`))},className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${te===J.value?"bg-indigo-600 text-white":"bg-gray-100 text-gray-600"}`,children:J.label},J.label))})]}),k&&(()=>{const J=k.split("T")[0],Pe=r.filter(ze=>ze.id===t||!ze.start_date?!1:ze.start_date.split("T")[0]===J).sort((ze,mt)=>{const Wt=ze.start_time||(ze.is_all_day===!1&&ze.start_date?new Date(ze.start_date).toTimeString().slice(0,5):"99:99"),Dn=mt.start_time||(mt.is_all_day===!1&&mt.start_date?new Date(mt.start_date).toTimeString().slice(0,5):"99:99");return Wt.localeCompare(Dn)});return Pe.length===0?null:c.jsxs("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-xl",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(So,{size:14,className:"text-amber-600"}),c.jsxs("span",{className:"text-xs font-bold text-amber-700",children:[" ",Pe.length," "]})]}),c.jsx("div",{className:"space-y-1.5 max-h-32 overflow-y-auto",children:Pe.map(ze=>c.jsxs("div",{className:"flex items-center gap-2 text-xs text-amber-800 bg-white/60 rounded-lg px-2 py-1.5",children:[c.jsx("span",{className:"font-medium text-amber-600 w-12 flex-shrink-0",children:ze.is_all_day!==!1?"":ze.start_time||(ze.start_date?new Date(ze.start_date).toTimeString().slice(0,5):"--:--")}),c.jsx("span",{className:"truncate",children:ze.title})]},ze.id))})]})})()]}),Te==="importance"&&c.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 mb-6 grid grid-cols-2 gap-3 animate-in slide-in-from-top-2",children:Object.keys(Xe).map(J=>c.jsxs("button",{onClick:()=>I(J),className:`flex items-center gap-2 p-3 rounded-xl border transition-all ${M===J?"border-gray-400 bg-white shadow-sm":"border-transparent hover:bg-white/50"}`,children:[c.jsx("div",{className:`w-3 h-3 rounded-full ${Xe[J].color}`}),c.jsx("span",{className:"text-sm font-bold text-gray-700",children:Xe[J].label}),M===J&&c.jsx(Zn,{size:16,className:"ml-auto text-gray-400"})]},J))}),Te==="repeat"&&c.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 mb-6 space-y-2 animate-in slide-in-from-top-2",children:[null,"daily","weekly","monthly"].map(J=>c.jsxs("button",{onClick:()=>G(J?{type:J,interval:1}:null),className:`w-full flex items-center justify-between p-3 rounded-xl ${(K==null?void 0:K.type)===J||!K&&!J?"bg-white shadow-sm border border-gray-200":"hover:bg-white/50"}`,children:[c.jsx("span",{className:"text-sm font-medium text-gray-700",children:{null:"",daily:"",weekly:"",monthly:""}[J]}),((K==null?void 0:K.type)===J||!K&&!J)&&c.jsx(Zn,{size:16,className:"text-blue-500"})]},J||"none"))}),Te==="tags"&&c.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 space-y-3 max-h-[40vh] overflow-y-auto mb-6 animate-in slide-in-from-top-2",children:s.map(J=>{const Pe=S.includes(J.id);return c.jsxs("button",{onClick:()=>T(ze=>Pe?ze.filter(mt=>mt!==J.id):[...ze,J.id]),className:`w-full flex items-center justify-between p-3 rounded-xl transition-all ${Pe?"bg-white shadow-sm border border-purple-200":"bg-white border border-gray-200"}`,children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:J.color||"#6366f1"}}),c.jsx("span",{className:"text-sm font-medium",children:J.name})]}),Pe&&c.jsx(Zn,{size:18,className:"text-purple-600"})]},J.id)})}),(ge&&ge.length>0||R&&R.length>0)&&c.jsxs("div",{className:"mb-6",children:[c.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 block",children:""}),c.jsxs("div",{className:"space-y-2",children:[R.map((J,Pe)=>c.jsxs("div",{className:"relative group rounded-xl overflow-hidden border border-gray-200",children:[c.jsx("img",{src:J,alt:"Attachment",className:"w-full h-32 object-cover"}),c.jsx("button",{onClick:()=>Q(J,!0),className:"absolute top-2 right-2 p-1.5 bg-black/50 text-white rounded-full",children:c.jsx(hn,{size:14})})]},J+Pe)),ge.map((J,Pe)=>{var ze;return c.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl border border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[(ze=J.type)!=null&&ze.startsWith("audio/")?c.jsx("button",{onClick:()=>me(J.url),className:`p-2 rounded-full ${Ue===J.url?"bg-indigo-100 text-indigo-600":"bg-gray-200 text-gray-600"}`,children:Ue===J.url?c.jsx($I,{size:16}):c.jsx(zI,{size:16})}):c.jsx("div",{className:"p-2 bg-gray-200 rounded-lg text-gray-500",children:c.jsx(go,{size:16})}),c.jsxs("div",{className:"flex flex-col overflow-hidden",children:[c.jsx("span",{className:"text-sm font-medium text-gray-700 truncate",children:J.name}),c.jsxs("span",{className:"text-[10px] text-gray-400",children:[Math.round((J.size||0)/1024)," KB"]})]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("a",{href:J.url,download:!0,target:"_blank",rel:"noreferrer",className:"p-2 text-gray-400 hover:text-indigo-600",children:c.jsx(iu,{size:16})}),c.jsx("button",{onClick:()=>Q(J.url,!1),className:"p-2 text-gray-400 hover:text-red-500",children:c.jsx(jr,{size:16})})]})]},J.url+Pe)})]})]}),c.jsxs("div",{className:"mb-6 min-h-[150px]",children:[c.jsx("div",{className:"flex items-center justify-between mb-2",children:c.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:""})}),c.jsx("div",{className:"bg-gray-50 rounded-xl px-1 py-1 focus-within:ring-2 focus-within:ring-indigo-100 border border-transparent",children:c.jsx(Zg,{ref:fe,initialContent:_||"",onChange:D,placeholder:"...",className:"min-h-[120px]",availableTags:s.map(J=>({...J,parent_id:J.parent_id||void 0})),onTagClick:()=>{}})})]}),ie&&c.jsxs("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center",onClick:()=>ce(!1),children:[c.jsx("div",{className:"absolute inset-0 bg-black/40"}),c.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-[90%] max-w-sm max-h-[60vh] flex flex-col overflow-hidden",onClick:J=>J.stopPropagation(),children:[c.jsxs("div",{className:"p-4 border-b border-gray-100",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h3",{className:"font-bold text-gray-800",children:""}),c.jsx("button",{onClick:()=>ce(!1),className:"p-1 text-gray-400 hover:text-gray-600",children:c.jsx(hn,{size:20})})]}),c.jsxs("div",{className:"relative",children:[c.jsx(Hc,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),c.jsx("input",{type:"text",inputMode:"text",name:`tag_search_no_autofill_${Math.random()}`,autoComplete:"one-time-code",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",value:Z,onChange:J=>ne(J.target.value),placeholder:"...",className:"w-full pl-9 pr-4 py-2.5 bg-gray-100 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200 appearance-none",autoFocus:!0})]}),S.length>0&&c.jsxs("div",{className:"px-4 pb-3",children:[c.jsxs("div",{className:"text-xs text-gray-500 mb-2 font-medium",children:[" (",S.length,")"]}),c.jsx("div",{className:"flex flex-wrap gap-2",children:S.map(J=>{const Pe=s.find(ze=>ze.id===J);return Pe?c.jsxs("button",{type:"button",onClick:()=>T(ze=>ze.filter(mt=>mt!==J)),className:"flex items-center gap-1.5 px-2.5 py-1.5 bg-purple-100 text-purple-700 rounded-lg text-xs font-medium hover:bg-purple-200 transition-colors",children:[c.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:Pe.color||"#6366f1"}}),c.jsx("span",{children:Pe.name}),c.jsx(hn,{size:12,className:"ml-0.5"})]},J):null})})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[Z.trim()&&!s.some(J=>J.name.toLowerCase()===Z.toLowerCase())&&c.jsx("div",{className:"mb-2 border-b border-gray-100 pb-2",children:Oe?c.jsxs("div",{className:"p-3 bg-indigo-50 rounded-xl space-y-3",children:[c.jsxs("div",{className:"text-sm font-bold text-indigo-700",children:[": ",Z]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:" ()"}),c.jsxs("select",{value:xt||"",onChange:J=>It(J.target.value||null),className:"w-full p-2 bg-white border border-gray-200 rounded-lg text-sm",children:[c.jsx("option",{value:"",children:" ()"}),s.filter(J=>!J.parent_id).map(J=>c.jsx("option",{value:J.id,children:J.name},J.id))]})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{type:"button",onClick:()=>{et(!1),It(null)},className:"flex-1 py-2 text-sm font-medium text-gray-600 bg-gray-200 rounded-lg",children:""}),c.jsx("button",{type:"button",onClick:async()=>{if(!Z.trim())return;const J=Z.trim();try{const Pe=await a(J,xt);Pe&&T(ze=>[...ze,Pe]),d==null||d({msg:` "${J}"`,type:"info"}),ne(""),et(!1),It(null)}catch(Pe){console.error("Failed to create tag:",Pe),d==null||d({msg:"",type:"error"})}},className:"flex-1 py-2 text-sm font-medium text-white bg-indigo-600 rounded-lg",children:""})]})]}):c.jsxs("button",{type:"button",onClick:()=>et(!0),className:"w-full flex items-center gap-3 p-3 bg-indigo-50 hover:bg-indigo-100 rounded-xl transition-colors text-left",children:[c.jsx("div",{className:"w-5 h-5 rounded-full bg-indigo-500 flex items-center justify-center text-white text-xs font-bold",children:"+"}),c.jsxs("span",{className:"text-sm font-medium text-indigo-700",children:[' "',Z,'"']})]})}),s.filter(J=>J.name.toLowerCase().includes(Z.toLowerCase())).map(J=>{var Pe;return c.jsxs("button",{type:"button",onClick:()=>{const ze=S.includes(J.id);T(ze?mt=>mt.filter(Wt=>Wt!==J.id):mt=>[...mt,J.id])},className:`w-full flex items-center gap-3 p-3 rounded-xl transition-colors text-left ${S.includes(J.id)?"bg-purple-50 border-2 border-purple-300":"hover:bg-gray-50 border-2 border-transparent"}`,children:[c.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:J.color||"#6366f1"}}),c.jsxs("div",{className:"flex flex-col flex-1",children:[c.jsx("span",{className:"text-sm font-medium text-gray-700",children:J.name}),J.parent_id&&c.jsx("span",{className:"text-[10px] text-gray-400",children:((Pe=s.find(ze=>ze.id===J.parent_id))==null?void 0:Pe.name)||""})]}),S.includes(J.id)&&c.jsx(Zn,{size:18,className:"text-purple-600 flex-shrink-0"})]},J.id)}),s.filter(J=>J.name.toLowerCase().includes(Z.toLowerCase())).length===0&&!Z.trim()&&c.jsx("div",{className:"p-4 text-center text-gray-400 text-sm",children:""})]})]})]}),c.jsx("div",{className:"pt-4 border-t border-gray-100 pb-4",children:Ye?c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:()=>Ke(!1),className:"flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-bold",children:""}),c.jsx("button",{onClick:tt,className:"flex-1 py-3 rounded-xl bg-red-500 text-white font-bold",children:""})]}):c.jsx("button",{onClick:()=>Ke(!0),className:"w-full py-3 text-red-500 font-bold bg-red-50 rounded-xl",children:""})})]}),c.jsxs("div",{className:"flex-shrink-0 border-t border-gray-100 p-3 bg-white/80 backdrop-blur-md pb-6 flex items-center justify-around",children:[c.jsx("input",{type:"file",ref:de,accept:"image/*",className:"hidden",onChange:J=>jt(J,!0)}),c.jsx("input",{type:"file",ref:ft,className:"hidden",onChange:J=>jt(J,!1)}),c.jsxs("button",{onClick:()=>{var J;return(J=de.current)==null?void 0:J.click()},disabled:X,className:"p-3 text-gray-500 active:bg-gray-100 rounded-full flex flex-col items-center gap-1",children:[c.jsx(wf,{size:24}),c.jsx("span",{className:"text-[10px]",children:""})]}),c.jsxs("button",{onClick:()=>{var J;return(J=ft.current)==null?void 0:J.click()},disabled:X,className:"p-3 text-gray-500 active:bg-gray-100 rounded-full flex flex-col items-center gap-1",children:[c.jsx(go,{size:24}),c.jsx("span",{className:"text-[10px]",children:""})]}),c.jsx("button",{onClick:async()=>{if(h)y===t||!t&&!y?m():d==null||d({msg:"",type:"error"});else{if(!t){d==null||d({msg:"",type:"error"});return}try{await p(t),d==null||d({msg:"",type:"info"})}catch(J){console.error("[MobileTaskEditor] Recording error:",J),d==null||d({msg:"",type:"error"})}}},className:`p-4 rounded-full transition-all flex items-center justify-center -mt-8 shadow-lg ${h&&y===t?"bg-red-500 text-white scale-110":"bg-indigo-600 text-white active:scale-95"}`,children:h&&y===t?c.jsx("div",{className:"w-6 h-6 bg-white rounded-sm"}):c.jsx(LI,{size:24})}),c.jsxs("button",{onClick:()=>Je(Te==="importance"?null:"importance"),className:`p-3 rounded-full flex flex-col items-center gap-1 ${M!=="unplanned"?"text-rose-600":"text-gray-500 active:bg-gray-100"}`,children:[c.jsx(Jf,{size:24}),c.jsx("span",{className:"text-[10px]",children:Xe[M].label})]}),c.jsxs("button",{onClick:()=>Je(Te==="repeat"?null:"repeat"),className:`p-3 rounded-full flex flex-col items-center gap-1 ${K?"text-blue-600":"text-gray-500 active:bg-gray-100"}`,children:[c.jsx(Lz,{size:24}),c.jsx("span",{className:"text-[10px]",children:""})]})]})]})]});return or.createPortal(He,document.body)},xb=({onClose:t,initialData:e})=>{const n=!!e,[r,s]=Ln.useState(window.innerWidth<768),[i,o]=Ln.useState({});return Ln.useEffect(()=>{const a=()=>{const l=window.innerWidth<768;s(l),window.visualViewport&&o(l?{height:`${window.visualViewport.height}px`,top:`${window.visualViewport.offsetTop}px`,position:"fixed",bottom:"auto"}:{})};return window.addEventListener("resize",a),window.visualViewport&&(window.visualViewport.addEventListener("resize",a),window.visualViewport.addEventListener("scroll",a)),a(),()=>{window.removeEventListener("resize",a),window.visualViewport&&(window.visualViewport.removeEventListener("resize",a),window.visualViewport.removeEventListener("scroll",a))}},[]),r?c.jsx(yb,{taskId:(e==null?void 0:e.id)==="new"||e==null?void 0:e.id,initialData:e,onClose:t}):c.jsx("div",{className:"fixed inset-0 z-[60] flex items-end md:items-center justify-center pointer-events-auto bg-black/20 md:bg-transparent",onClick:t,style:i,children:c.jsxs(Lr.div,{onClick:a=>a.stopPropagation(),drag:window.innerWidth>=768,dragMomentum:!1,dragElastic:.1,initial:{opacity:0,scale:.95,y:50},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:50},transition:{type:"spring",stiffness:300,damping:30},className:"bg-theme-card backdrop-blur-xl rounded-t-2xl md:rounded-2xl shadow-2xl w-full md:max-w-[600px] overflow-visible border border-theme ring-1 ring-black/5 flex flex-col max-h-[90vh] md:max-h-none",children:[c.jsx("div",{className:"md:hidden flex justify-center pt-2 pb-1",children:c.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full"})}),c.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-theme-header border-b border-theme cursor-grab active:cursor-grabbing backdrop-blur-sm select-none md:rounded-t-2xl",onPointerDown:a=>a.preventDefault(),children:[c.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[c.jsx(MI,{size:14,className:"text-gray-300 hidden md:block"}),c.jsx("span",{className:"text-xs md:text-[10px] font-bold uppercase tracking-widest text-theme-tertiary",children:n?"Edit Task":"New Task"})]}),c.jsxs("button",{onClick:t,className:"w-8 h-8 md:w-7 md:h-7 flex items-center justify-center hover:bg-gray-200/80 rounded-full text-gray-400 hover:text-gray-600 transition-colors bg-gray-100/50",onPointerDown:a=>a.stopPropagation(),children:[c.jsx(hn,{size:16,className:"md:hidden"}),c.jsx(hn,{size:14,className:"hidden md:block"})]})]}),c.jsx("div",{className:"p-0 overflow-auto",children:c.jsx(Fo,{initialData:e,onClose:t,isQuickAdd:!n,autoFocus:!n,isEmbedded:!0})})]})})},Xh=({title:t,importance:e,tasks:n,onDrop:r,onAddTask:s,setEditingTaskId:i,bgColor:o,borderColor:a,titleColor:l,infoText:u})=>{const{updateGhostPosition:d,endDrag:f}=x.useContext(jn),[h,p]=x.useState(!1),m=v=>{v.preventDefault(),p(!0),d(v.clientX,v.clientY)},y=()=>{p(!1)},b=v=>{v.preventDefault(),p(!1);const w=v.clientY,_=Array.from(v.currentTarget.querySelectorAll("[data-task-id]"));let D=null,k=Number.POSITIVE_INFINITY;_.forEach((N,E)=>{const S=N.getBoundingClientRect(),T=w-(S.top+S.height/2);Math.abs(T)<Math.abs(k)&&(k=T,D={element:N,offset:T,index:E})});let A;if(D){const N=D.index,E=n[N];if(E)if(D.offset<0){const S=n[N-1];S?A=((S.order_index||0)+(E.order_index||0))/2:A=(E.order_index||0)-1e4}else{const S=n[N+1];S?A=((E.order_index||0)+(S.order_index||0))/2:A=(E.order_index||0)+1e4}}else n.length>0?A=(n[n.length-1].order_index||0)+1e4:A=void 0;r(v,e,A)},g=()=>{p(!1),f()};return c.jsxs("div",{className:`flex flex-col h-full rounded-xl border-2 transition-all p-3 overflow-hidden ${h?"bg-indigo-50 border-indigo-400 scale-[1.01]":`${o} ${a}`}`,onDragOver:m,onDragLeave:y,onDrop:b,onDragEnd:g,children:[c.jsxs("div",{className:"flex justify-between items-center mb-3 flex-shrink-0",children:[c.jsxs("div",{className:"flex flex-col",children:[c.jsx("h3",{className:`font-bold text-lg ${l}`,children:t}),u&&c.jsx("span",{className:"text-[10px] text-gray-400 font-medium",children:u})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-xs font-medium text-gray-400 bg-white/50 px-2 py-0.5 rounded-full",children:n.length}),c.jsx("button",{onClick:()=>s(e),className:`p-1 rounded-full hover:bg-black/5 transition-colors ${l}`,children:c.jsx(ri,{size:16})})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar space-y-2 pr-1 pb-10",children:[n.map((v,w)=>c.jsx("div",{children:c.jsx(gl,{flatTask:{data:v,depth:0,hasChildren:!1,isExpanded:!1,path:[v.id],index:w},isFocused:!1,onEdit:()=>i(v.id)})},v.id)),n.length===0&&c.jsxs("div",{className:"h-full flex flex-col items-center justify-center opacity-30 text-center",children:[c.jsx("div",{className:`p-4 rounded-full bg-current mb-2 opacity-10 ${l}`,children:c.jsx(OI,{size:24})}),c.jsx("span",{className:`text-sm font-medium ${l}`,children:""})]})]})]})},rte=()=>{const{tasks:t,tags:e,viewTagFilters:n,updateTask:r,addTask:s,setEditingTaskId:i,setPendingFocusTaskId:o,endDrag:a}=x.useContext(jn),l=x.useMemo(()=>{var b;const h=(b=e.find(g=>["schedule",""].includes(g.name.trim().toLowerCase())))==null?void 0:b.id,p=n.matrix||{include:[],exclude:[]},{include:m,exclude:y}=Array.isArray(p)?{include:p,exclude:[]}:p;return t.filter(g=>!(g.status==="deleted"||g.status==="logged"||g.status==="completed"||g.parent_id||h&&g.tags.includes(h)||g.tags.some(w=>{const _=e.find(D=>D.id===w);return _&&["schedule",""].includes(_.name.trim().toLowerCase())})||m.length>0&&!g.tags.some(w=>m.includes(w))||y.length>0&&g.tags.some(w=>y.includes(w))))},[t,e,n]),u={urgent:l.filter(h=>h.importance==="urgent"),planned:l.filter(h=>h.importance==="planned"),delegated:l.filter(h=>h.importance==="delegated"),unplanned:l.filter(h=>!h.importance||h.importance==="unplanned"||h.importance==="optional")},d=async(h,p,m)=>{const y=h.dataTransfer.getData("text/plain");if(y){const b={importance:p};m!==void 0&&(b.order_index=m),await r(y,b),await a()}},f=async h=>{const p=await s({title:"",importance:h,status:"inbox"});p&&o(p)};return c.jsxs("div",{className:"h-full p-6 flex flex-col overflow-hidden bg-white",children:[c.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[c.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[c.jsx(OI,{className:"text-indigo-600"}),"Eisenhower Matrix"]}),c.jsx("div",{className:"text-xs text-gray-400 font-medium bg-gray-100 px-3 py-1 rounded-full",children:"Shift+Alt inside tasks to move"})]}),c.jsxs("div",{className:"flex-1 grid grid-cols-2 grid-rows-2 gap-4 min-h-0",children:[c.jsx(Xh,{title:" (Do Now)",infoText:"Urgent & Important",importance:"urgent",tasks:u.urgent,onDrop:d,onAddTask:f,setEditingTaskId:i,bgColor:"bg-red-50/50",borderColor:"border-red-100",titleColor:"text-red-600"}),c.jsx(Xh,{title:" (Plan)",infoText:"Not Urgent but Important",importance:"planned",tasks:u.planned,onDrop:d,onAddTask:f,setEditingTaskId:i,bgColor:"bg-amber-50/50",borderColor:"border-amber-100",titleColor:"text-amber-600"}),c.jsx(Xh,{title:" (Delegate)",infoText:"Urgent but Not Important",importance:"delegated",tasks:u.delegated,onDrop:d,onAddTask:f,setEditingTaskId:i,bgColor:"bg-green-50/50",borderColor:"border-green-100",titleColor:"text-green-600"}),c.jsx(Xh,{title:" (Unplanned)",infoText:"Neither Urgent nor Important",importance:"unplanned",tasks:u.unplanned,onDrop:d,onAddTask:f,setEditingTaskId:i,bgColor:"bg-gray-50/50",borderColor:"border-gray-200",titleColor:"text-gray-500"})]})]})},ste=()=>{const{user:t,setToast:e}=x.useContext(jn),[n,r]=x.useState(()=>{const S=localStorage.getItem(`work_logs_${t==null?void 0:t.id}`);return S?JSON.parse(S):[]}),[s,i]=x.useState(()=>new Date().toISOString().split("T")[0]),[o,a]=x.useState(!1),[l,u]=x.useState(""),[d,f]=x.useState(!1),h=S=>{localStorage.setItem(`work_logs_${t==null?void 0:t.id}`,JSON.stringify(S)),r(S)},p=x.useMemo(()=>n.find(S=>S.date===s),[n,s]),m=()=>{const S=new Date(s);S.setDate(S.getDate()-1),i(S.toISOString().split("T")[0])},y=()=>{const S=new Date(s);S.setDate(S.getDate()+1),i(S.toISOString().split("T")[0])},b=()=>{i(new Date().toISOString().split("T")[0])},g=S=>{const T=new Date(S),C=["","","","","","",""],O=T.getFullYear(),P=T.getMonth()+1,H=T.getDate(),M=C[T.getDay()];return`${O}${P}${H}${M}`},v=()=>`## ${g(s)}

### 

#### [/]
1. []
2. []

#### [/]
1. []
2. []

### 

|  |  |  |  |
|-------|------|------|------|
| 1 | [] | [] |  |
| 2 | [] | [] |  |

### 
- []
`,w=()=>{const S=v(),T={id:crypto.randomUUID(),date:s,content:S,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};h([...n,T]),u(S),a(!0)},_=()=>{u((p==null?void 0:p.content)||""),a(!0)},D=()=>{if(p){const S=n.map(T=>T.id===p.id?{...T,content:l,updated_at:new Date().toISOString()}:T);h(S)}a(!1),e==null||e({msg:"",type:"info"})},k=()=>{if(p&&confirm("")){const S=n.filter(T=>T.id!==p.id);h(S),a(!1),e==null||e({msg:"",type:"info"})}},A=async()=>{const T=((p==null?void 0:p.content)||"").replace(/^## /gm,"").replace(/^### /gm,"").replace(/^#### /gm,"").replace(/\*\*/g,"").replace(/\|/g,"	").replace(/-{3,}/g,"");try{await navigator.clipboard.writeText(T),f(!0),setTimeout(()=>f(!1),2e3),e==null||e({msg:"",type:"info"})}catch{e==null||e({msg:"",type:"error"})}},N=S=>S.split(`
`).map((T,C)=>{if(T.startsWith("## "))return c.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4 mt-6 first:mt-0",children:T.slice(3)},C);if(T.startsWith("### "))return c.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-3 mt-5",children:T.slice(4)},C);if(T.startsWith("#### "))return c.jsx("h4",{className:"text-base font-semibold text-gray-600 mb-2 mt-4",children:T.slice(5)},C);if(T.startsWith("| ")){const O=T.split("|").filter(H=>H.trim());return T.includes("---")?null:c.jsx("div",{className:"grid grid-cols-4 gap-2 px-2 py-1 text-sm border-b border-gray-100",children:O.map((H,M)=>c.jsx("span",{className:M===0?"font-medium":"text-gray-600",children:H.trim()},M))},C)}return T.match(/^\d+\. /)?c.jsx("p",{className:"text-sm text-gray-700 ml-6 mb-1",children:T},C):T.startsWith("- ")?c.jsxs("p",{className:"text-sm text-gray-700 ml-4 mb-1",children:[" ",T.slice(2)]},C):T.trim()===""?c.jsx("div",{className:"h-2"},C):c.jsx("p",{className:"text-sm text-gray-700 mb-1",children:T},C)}),E=s===new Date().toISOString().split("T")[0];return c.jsxs("div",{className:"h-full flex flex-col bg-white overflow-hidden",children:[c.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-white z-10",children:[c.jsx("div",{className:"flex items-center gap-4",children:c.jsxs("h2",{className:"font-bold text-gray-700 flex items-center gap-2",children:[c.jsx(xf,{size:18}),""]})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:m,className:"p-1.5 rounded hover:bg-gray-100 text-gray-500",children:c.jsx(Ou,{size:18})}),c.jsx("span",{className:"font-medium text-gray-700 min-w-[180px] text-center",children:g(s)}),c.jsx("button",{onClick:y,className:"p-1.5 rounded hover:bg-gray-100 text-gray-500",children:c.jsx(is,{size:18})}),!E&&c.jsx("button",{onClick:b,className:"ml-2 px-2 py-1 text-xs bg-indigo-50 text-indigo-600 rounded hover:bg-indigo-100",children:""})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[p&&!o&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:A,className:"flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[d?c.jsx(Zn,{size:14}):c.jsx(NI,{size:14}),d?"":""]}),c.jsxs("button",{onClick:_,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 text-sm font-medium transition-colors",children:[c.jsx(Mg,{size:14}),""]}),c.jsx("button",{onClick:k,className:"flex items-center gap-1 px-3 py-1.5 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 text-sm font-medium transition-colors",children:c.jsx(jr,{size:14})})]}),o&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:()=>a(!1),className:"flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[c.jsx(hn,{size:14}),""]}),c.jsxs("button",{onClick:D,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors",children:[c.jsx(UI,{size:14}),""]})]}),!p&&!o&&c.jsxs("button",{onClick:w,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors shadow-sm",children:[c.jsx(ri,{size:16}),""]})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-gray-50/50",children:o?c.jsx("div",{className:"max-w-3xl mx-auto",children:c.jsx("textarea",{value:l,onChange:S=>u(S.target.value),className:"w-full h-[calc(100vh-200px)] p-4 bg-white rounded-xl border border-gray-200 focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none font-mono text-sm resize-none",placeholder:"..."})}):p?c.jsx("div",{className:"max-w-3xl mx-auto bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:N(p.content)}):c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx(xf,{size:48,className:"mb-4 opacity-20"}),c.jsx("p",{className:"text-sm",children:""}),c.jsxs("button",{onClick:w,className:"mt-4 flex items-center gap-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors",children:[c.jsx(ri,{size:16}),""]})]})})]})},ite=({task:t,position:e,count:n})=>{const r=x.useRef(null);if(x.useLayoutEffect(()=>{e&&r.current&&(r.current.style.left=`${e.x}px`,r.current.style.top=`${e.y}px`)},[]),!e)return null;const s=c.jsxs("div",{ref:r,id:"drag-ghost",className:"fixed pointer-events-none rounded-lg border-2 border-indigo-500/50 p-3 w-64 flex items-center gap-3",style:{transform:"translate(16px, 16px) rotate(2deg)",zIndex:99999,backgroundColor:"#ffffff",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",opacity:1,isolation:"isolate"},children:[c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h4",{className:"font-medium text-sm text-gray-900 dark:text-gray-100 truncate",children:t.title||"()"}),n>1&&c.jsxs("p",{className:"text-xs text-indigo-500 font-medium",children:["+ ",n-1," "]})]}),c.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-pulse"})]});return or.createPortal(s,document.body)},ote=t=>{switch(t){case"inbox":return"";case"waiting":return"";case"active":return"";case"someday":return"/";case"reference":return"";case"completed":return"";case"archived":return"";case"logged":return"";default:return t}},ate=({onClose:t})=>{const{tasks:e,selectedTaskIds:n,updateTask:r,setToast:s,tags:i}=x.useContext(jn),[o,a]=x.useState(""),[l,u]=x.useState(0),d=x.useRef(null);x.useEffect(()=>{d.current&&d.current.focus()},[]),x.useEffect(()=>{u(0)},[o]);const f=y=>{y.key==="Escape"&&t()};x.useEffect(()=>(window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)),[]);const h=x.useMemo(()=>{if(!o.trim())return[];const y=o.toLowerCase();return e.filter(b=>{if(b.status==="deleted"||b.status==="archived"||b.status==="logged"||!b.title.toLowerCase().includes(y)||n.includes(b.id))return!1;for(const g of n)if(Ew(g,b.id,e))return!1;return!0}).slice(0,10)},[e,o,n]),p=async y=>{const b=e.find(g=>g.id===y);if(b)try{await Promise.all(n.map(g=>r(g,{parent_id:y}))),s({type:"success",msg:` ${n.length}  "${b.title}" `}),t()}catch(g){console.error(g),s({type:"error",msg:""})}},m=y=>{y.key==="ArrowDown"?(y.preventDefault(),u(b=>(b+1)%h.length)):y.key==="ArrowUp"?(y.preventDefault(),u(b=>(b-1+h.length)%h.length)):y.key==="Enter"&&(y.preventDefault(),h.length>0&&p(h[l].id))};return or.createPortal(c.jsx(ko,{children:c.jsx(Lr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-[99999] flex items-start justify-center pt-[20vh]",onClick:t,children:c.jsxs(Lr.div,{initial:{opacity:0,scale:.95,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20},transition:{duration:.15},className:"w-full max-w-xl bg-white rounded-xl shadow-2xl overflow-hidden border border-gray-200",onClick:y=>y.stopPropagation(),children:[c.jsxs("div",{className:"p-3 border-b border-gray-100 flex items-center gap-3",children:[c.jsx(dz,{className:"text-gray-400",size:20}),c.jsx("input",{ref:d,type:"text",value:o,onChange:y=>a(y.target.value),onKeyDown:m,placeholder:` ${n.length} ...`,className:"flex-1 bg-transparent border-none outline-none text-base text-gray-800 placeholder:text-gray-400"}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-500 px-1.5 py-0.5 rounded border border-gray-200",children:"ESC"})})]}),c.jsxs("div",{className:"max-h-[300px] overflow-y-auto",children:[h.length===0&&o.trim()!==""&&c.jsx("div",{className:"p-8 text-center text-gray-400 text-sm",children:""}),h.length===0&&o.trim()===""&&c.jsx("div",{className:"p-8 text-center text-gray-400 text-sm",children:"..."}),h.map((y,b)=>{var v;const g=b===l;return c.jsxs("button",{onClick:()=>p(y.id),onMouseEnter:()=>u(b),className:`w-full text-left p-3 flex items-center gap-3 transition-colors ${g?"bg-indigo-50":"hover:bg-gray-50"}`,children:[c.jsx("div",{className:`w-1 h-8 rounded-full ${g?"bg-indigo-500":"bg-transparent"}`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:`font-medium truncate ${g?"text-indigo-900":"text-gray-700"}`,children:y.title}),c.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1.5 text-xs",children:[c.jsx("span",{className:"px-1.5 py-0.5 rounded-md bg-gray-100 border border-gray-200 text-gray-500 font-medium",children:ote(y.status)}),y.parent_id?c.jsxs("span",{className:"flex items-center gap-1 text-indigo-600 bg-indigo-50 border border-indigo-100 px-1.5 py-0.5 rounded-md",children:[c.jsx(jI,{size:10}),c.jsx("span",{className:"max-w-[100px] truncate",children:((v=e.find(w=>w.id===y.parent_id))==null?void 0:v.title)||""})]}):c.jsx("span",{className:"text-gray-400 border border-gray-200 px-1.5 py-0.5 rounded-md",children:""}),y.tags&&y.tags.length>0&&c.jsx("div",{className:"flex gap-1 items-center",children:y.tags.map(w=>{const _=i.find(D=>D.id===w);return _?c.jsxs("span",{className:"px-1.5 py-0.5 rounded-md border text-[10px]",style:{backgroundColor:`${_.color}15`,borderColor:`${_.color}30`,color:_.color},children:["#",_.name]},w):null})})]})]}),g&&c.jsx("span",{className:"text-[10px] text-indigo-400 font-medium px-2 flex-shrink-0",children:"Enter "})]},y.id)})]})]})})}),document.body)},lte={gray:"bg-gray-400",blue:"bg-blue-500",indigo:"bg-indigo-500",red:"bg-red-500",orange:"bg-orange-500",amber:"bg-amber-500",green:"bg-green-500",teal:"bg-teal-500",cyan:"bg-cyan-500",sky:"bg-sky-500",purple:"bg-purple-500",fuchsia:"bg-fuchsia-500",pink:"bg-pink-500",rose:"bg-rose-500"},cte=[{label:"5 ",minutes:5},{label:"30 ",minutes:30},{label:"1 ",minutes:60},{label:"2 ",minutes:120}],ute=({reminder:t,onSnooze:e,onMarkSeen:n,onSelect:r,onEdit:s})=>{const[i,o]=x.useState(!1),[a,l]=x.useState(""),[u,d]=x.useState({top:0,left:0}),[f,h]=x.useState(null),p=x.useRef(null),m=x.useRef(null);x.useEffect(()=>{if(!t.snoozed_until){h(null);return}const w=()=>{const D=Date.now(),A=new Date(t.snoozed_until).getTime()-D;if(A<=0){h(null);return}const N=Math.floor(A/1e3),E=Math.floor(N/60),S=Math.floor(E/60);S>0?h(`${S}${E%60}`):E>0?h(`${E}${N%60}`):h(`${N}`)};w();const _=setInterval(w,1e3);return()=>clearInterval(_)},[t.snoozed_until]);const y=()=>{p.current?(clearTimeout(p.current),p.current=null,s()):p.current=setTimeout(()=>{p.current=null,r()},250)},b=w=>{const _=new Date(w),k=new Date().getTime()-_.getTime(),A=Math.floor(k/6e4),N=Math.floor(k/36e5),E=Math.floor(k/864e5);return A<1?"":A<60?`${A} `:N<24?`${N} `:`${E} `},g=w=>new Date(w).toLocaleString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),v=()=>{const w=parseInt(a);w>0&&(e(w),o(!1),l(""))};return c.jsx("div",{className:`p-3 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer ${t.seen?"opacity-60":""}`,onClick:y,children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("div",{className:`w-2 h-2 mt-2 rounded-full ${lte[t.task_color]} flex-shrink-0`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:"font-medium text-gray-800 truncate",children:t.task_title}),c.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500 flex-wrap",children:[c.jsx(Oi,{size:10}),c.jsxs("span",{children:["",g(t.due_time)]}),c.jsx("span",{className:"text-gray-300",children:""}),c.jsx("span",{children:b(t.triggered_at)}),f&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"text-gray-300",children:""}),c.jsxs("span",{className:"text-orange-500 font-medium",children:[" ",f]})]})]})]}),c.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",onClick:w=>w.stopPropagation(),children:[c.jsx("button",{onClick:n,className:`p-1.5 rounded-lg transition-colors ${t.seen?"bg-green-100 text-green-600":"hover:bg-gray-100 text-gray-400 hover:text-green-600"}`,title:t.seen?"":"",children:t.seen?c.jsx(Zn,{size:14}):c.jsx(hz,{size:14})}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{ref:m,onClick:()=>{if(!i&&m.current){const w=m.current.getBoundingClientRect();d({top:w.bottom+4,left:w.right-160})}o(!i)},className:"p-1.5 rounded-lg hover:bg-gray-100 text-gray-400 hover:text-orange-500 transition-colors flex items-center gap-0.5",title:"",children:[c.jsx(Va,{size:14}),c.jsx(rs,{size:10})]}),i&&or.createPortal(c.jsxs("div",{className:"fixed w-40 bg-white rounded-lg shadow-xl border border-gray-200 z-[10001] overflow-hidden",style:{top:u.top,left:u.left},"data-snooze-menu":"true",children:[cte.map(w=>c.jsxs("button",{onClick:()=>{e(w.minutes),o(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-orange-50 text-gray-700 hover:text-orange-600 transition-colors",children:[w.label,""]},w.minutes)),c.jsx("div",{className:"border-t border-gray-100 p-2",children:c.jsxs("div",{className:"flex gap-1",children:[c.jsx("input",{type:"number",value:a,onChange:w=>l(w.target.value),placeholder:"",className:"flex-1 px-2 py-1 text-xs border rounded w-16",min:1}),c.jsx("span",{className:"text-xs text-gray-500 self-center",children:""}),c.jsx("button",{onClick:v,className:"px-2 py-1 text-xs bg-orange-500 text-white rounded hover:bg-orange-600",children:""})]})})]}),document.body)]})]})]})})},dte=()=>{const{reminders:t,markAsSeen:e,snoozeReminder:n,clearAllSeen:r,clearAllUnseen:s,clearAll:i,unseenCount:o,isReminderPanelOpen:a,setIsReminderPanelOpen:l}=x.useContext(_I),{setFocusedTaskId:u,setSelectedTaskIds:d,navigateToTask:f}=x.useContext(jn),h=x.useRef(null);x.useEffect(()=>{const b=g=>{const v=g.target;if(h.current&&h.current.contains(v))return;const w=document.querySelector('[data-snooze-menu="true"]');w&&w.contains(v)||l(!1)};return a&&document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[a,l]);const p=b=>{u(b),d([b]),f(b,!1,"allview"),l(!1),setTimeout(()=>{const g=document.querySelector(`[data-task-id="${b}"]`);g&&g.scrollIntoView({behavior:"smooth",block:"center"})},300)},m=b=>{f(b,!0,"allview"),l(!1)},y=[...t].sort((b,g)=>b.seen!==g.seen?b.seen?1:-1:new Date(g.triggered_at).getTime()-new Date(b.triggered_at).getTime());return c.jsxs("div",{className:"relative",ref:h,children:[c.jsx("button",{onClick:()=>l(!a),className:`p-1.5 rounded-lg transition-colors ${a?"bg-orange-100 text-orange-600":"hover:bg-gray-100 text-gray-500 hover:text-orange-500"}`,title:"",children:c.jsxs("div",{className:"relative",children:[c.jsx(Va,{size:18}),o>0&&c.jsx("span",{className:"absolute -top-1.5 -right-1.5 w-3.5 h-3.5 bg-red-500 text-white text-[9px] font-bold rounded-full flex items-center justify-center animate-pulse ring-2 ring-white",children:o>9?"9+":o})]})}),c.jsx(ko,{children:a&&c.jsxs(Lr.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15},className:"absolute right-0 top-full mt-2 w-80 md:w-96 bg-white rounded-xl shadow-2xl border border-gray-200 z-[9999] overflow-hidden",children:[c.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 flex items-center justify-between bg-gradient-to-r from-orange-50 to-amber-50",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Va,{size:16,className:"text-orange-500"}),c.jsx("span",{className:"font-bold text-gray-800",children:""}),o>0&&c.jsxs("span",{className:"px-1.5 py-0.5 bg-red-500 text-white text-[10px] font-bold rounded-full",children:[o," "]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[o>0&&c.jsx("button",{onClick:s,className:"px-2 py-1 rounded-lg text-[10px] font-bold bg-red-100 text-red-600 hover:bg-red-200 transition-colors",title:"",children:""}),t.some(b=>b.seen)&&c.jsx("button",{onClick:r,className:"p-1.5 rounded-lg hover:bg-white/50 text-gray-400 hover:text-red-500 transition-colors",title:"",children:c.jsx(jr,{size:14})}),t.length>0&&c.jsx("button",{onClick:i,className:"p-1.5 rounded-lg hover:bg-white/50 text-gray-400 hover:text-red-500 transition-colors",title:"",children:c.jsx(hn,{size:14})})]})]}),c.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:y.length===0?c.jsxs("div",{className:"py-12 text-center text-gray-400",children:[c.jsx(t1,{size:32,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{className:"text-sm",children:""})]}):y.map(b=>c.jsx(ute,{reminder:b,onSnooze:g=>n(b.id,g),onMarkSeen:()=>e(b.id),onSelect:()=>p(b.task_id),onEdit:()=>m(b.task_id)},b.id))}),c.jsx("div",{className:"px-4 py-2 border-t border-gray-100 bg-gray-50 text-[10px] text-gray-400",children:c.jsx("span",{children:"  "})})]})})]})},fte={capture:{label:"",icon:"",color:"bg-gray-100 text-gray-600"},clarify:{label:"",icon:"",color:"bg-yellow-100 text-yellow-600"},organize:{label:"",icon:"",color:"bg-blue-100 text-blue-600"},engage:{label:"",icon:"",color:"bg-green-100 text-green-600"}},hte=({taskId:t,onClose:e})=>{const{tasks:n,tags:r,updateTask:s,batchAddTasks:i}=x.useContext(jn),[o,a]=x.useState(""),[l,u]=x.useState([]),[d,f]=x.useState(!1),h=x.useRef(null),p=x.useRef(!1),[m,y]=x.useState("capture"),[b,g]=x.useState([]),v=n.find(S=>S.id===t),w=()=>{setTimeout(()=>{var S;(S=h.current)==null||S.scrollIntoView({behavior:"smooth"})},100)};x.useEffect(()=>{w()},[l,b]),x.useEffect(()=>{if(v&&!p.current)if(p.current=!0,v.ai_history&&v.ai_history.length>0){const S=v.ai_history.map(T=>({id:T.id,role:T.role,content:T.content,timestamp:new Date(T.created_at).getTime()}));S.sort((T,C)=>T.timestamp-C.timestamp),u(S)}else D("",!0)},[v]);const _=async S=>{if(!v)return;const T={id:S.id,role:S.role,content:S.content,created_at:new Date(S.timestamp).toISOString()},C=v.ai_history||[];C.some(O=>O.id===S.id)||await s(v.id,{ai_history:[...C,T]},void 0,{skipHistory:!0})},D=async(S,T=!1)=>{if(!v||!S.trim()&&!T)return;g([]);let C=null;T||(C={id:crypto.randomUUID(),role:"user",content:S,timestamp:Date.now()},u(O=>[...O,C]),_(C),a("")),f(!0);try{const O=v.parent_id?n.find(ge=>ge.id===v.parent_id):null,P=v.tags.map(ge=>{var F;return((F=r.find(B=>B.id===ge))==null?void 0:F.name)||ge}),H={title:v.title,description:v.description||"",status:v.status,created_at:v.created_at,due_date:v.due_date,start_date:v.start_date,tags:P,project_title:O==null?void 0:O.title},M=new Date,I=new Date;I.setDate(M.getDate()+14);const K=n.filter(ge=>{if(ge.status==="completed"||ge.status==="deleted")return!1;const F=ge.start_date||ge.due_date;if(!F)return!1;const B=new Date(F);return B>=M&&B<=I}).sort((ge,F)=>(ge.start_date||ge.due_date||"").localeCompare(F.start_date||F.due_date||"")).map(ge=>{var F,B;return`[${((F=ge.start_date)==null?void 0:F.split("T")[0])||((B=ge.due_date)==null?void 0:B.split("T")[0])}] ${ge.title}`}).slice(0,30),G=l.filter(ge=>ge.role!=="system").map(ge=>({role:ge.role,content:ge.content}));C&&G.push({role:"user",content:C.content});const R=await LY(H,K,T?" GTD ":S,G);R.current_stage&&y(R.current_stage),R.actions&&R.actions.length>0&&g(R.actions);const Ee={id:crypto.randomUUID(),role:"assistant",content:R.reply,timestamp:Date.now()};u(ge=>[...ge,Ee]),_(Ee)}catch(O){console.error(O);const P={id:crypto.randomUUID(),role:"assistant",content:"",timestamp:Date.now()};u(H=>[...H,P])}finally{f(!1)}},k=async()=>{if(!v)return;const S=[];try{for(const T of b)if(T.type==="update_task"){const C={};if(T.params.title&&(C.title=T.params.title),T.params.description&&(C.description=T.params.description),T.params.due_date&&(C.due_date=T.params.due_date),T.params.start_date&&(C.start_date=T.params.start_date),T.params.start_time&&(C.start_time=T.params.start_time),T.params.reminder_minutes!==void 0&&(C.reminder_minutes=T.params.reminder_minutes),T.params.tags&&T.params.tags.length>0){const O=T.params.tags.map(P=>{const H=r.find(M=>M.name.toLowerCase()===P.toLowerCase());return H?H.id:null}).filter(Boolean);O.length>0&&(C.tags=O)}Object.keys(C).length>0&&(await s(v.id,C),S.push(""))}else T.type==="add_subtasks"&&T.params.tasks&&T.params.tasks.length>0&&(await i(T.params.tasks.map(C=>({...C,status:"todo",start_date:C.start_date,start_time:C.start_time,reminder_minutes:C.reminder_minutes,due_date:C.due_date})),v.id),S.push(` ${T.params.tasks.length} `));if(S.length>0){const T={id:crypto.randomUUID(),role:"system",content:S.map(C=>` ${C}`).join(`
`),timestamp:Date.now()};u(C=>[...C,T]),_(T)}g([])}catch(T){console.error("Action execution failed:",T),alert("")}},A=(S,T,C,O)=>{g(P=>{const H=[...P],M={...H[S]};if(M.type==="update_task")M.params={...M.params,[T]:C};else if(M.type==="add_subtasks"&&typeof O=="number"){const I=[...M.params.tasks];I[O]={...I[O],[T]:C},M.params={...M.params,tasks:I}}return H[S]=M,H})},N=S=>{g(T=>T.filter((C,O)=>O!==S))},E=(S,T)=>{g(C=>{const O=[...C],P=O[S];if(P.type==="add_subtasks"){const H=[...P.params.tasks];if(H.splice(T,1),H.length===0)return C.filter((M,I)=>I!==S);O[S]={...P,params:{...P.params,tasks:H}}}return O})};return v?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md h-[700px] flex flex-col animate-in slide-in-from-bottom-5 duration-200 overflow-hidden border border-indigo-100 font-sans",children:[c.jsxs("div",{className:"px-4 py-3 border-b bg-gradient-to-r from-indigo-50 to-white",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600",children:c.jsx(Rs,{size:16})}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-sm font-bold text-gray-900",children:"GTD "}),c.jsx("p",{className:"text-xs text-indigo-600 flex items-center gap-1",children:v.title.length>10?v.title.slice(0,10)+"...":v.title})]})]}),c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 p-1.5 rounded-full transition-colors",children:c.jsx(hn,{size:18})})]}),c.jsxs("div",{className:"flex justify-between items-center px-2 py-1 bg-gray-50 rounded-lg relative overflow-hidden",children:[Object.entries(fte).map(([S,T],C)=>{const O=m===S;return c.jsxs("div",{className:`flex flex-col items-center z-10 transition-all duration-300 ${O?"scale-110 opacity-100":"opacity-40 scale-90"}`,children:[c.jsx("span",{className:"text-base mb-0.5",children:T.icon}),c.jsx("span",{className:`text-[10px] font-bold ${O?"text-indigo-600":"text-gray-500"}`,children:T.label})]},S)}),c.jsx("div",{className:"absolute top-1/2 left-0 w-full h-0.5 bg-gray-200 -z-0 transform -translate-y-1/2"})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50/50 space-y-4",children:[l.map(S=>c.jsxs("div",{className:`flex gap-3 ${S.role==="user"?"flex-row-reverse":""}`,children:[c.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${S.role==="user"?"bg-gray-200":S.role==="system"?"bg-green-100 text-green-600":"bg-indigo-600 text-white"}`,children:S.role==="user"?c.jsx(KI,{size:14,className:"text-gray-600"}):S.role==="system"?c.jsx(bf,{size:14}):c.jsx(rz,{size:14})}),c.jsxs("div",{className:`max-w-[90%] rounded-2xl px-4 py-2.5 text-sm shadow-sm ${S.role==="user"?"bg-white text-gray-800 border border-gray-100 rounded-tr-none":S.role==="system"?"bg-green-50 text-green-800 border border-green-100":"bg-white text-gray-800 border border-indigo-100 rounded-tl-none"}`,children:[c.jsx("div",{className:"prose prose-sm prose-indigo max-w-none",children:c.jsx(ok,{children:S.content})}),c.jsx("span",{className:"text-[10px] text-gray-400 mt-1 block text-right",children:new Date(S.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},S.id)),b.length>0&&c.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-0 overflow-hidden shadow-sm animate-in fade-in slide-in-from-bottom-2",children:[c.jsx("div",{className:"px-3 py-2 bg-amber-100/50 border-b border-amber-200 flex items-center justify-between",children:c.jsxs("div",{className:"flex items-center gap-1.5 text-amber-800",children:[c.jsx(Z6,{size:14}),c.jsx("span",{className:"text-xs font-bold",children:" ()"})]})}),c.jsx("div",{className:"p-3 space-y-3",children:b.map((S,T)=>c.jsxs("div",{className:"bg-white rounded-lg border border-amber-100 p-2 shadow-sm relative group",children:[c.jsx("button",{onClick:()=>N(T),className:"absolute right-2 top-2 text-gray-300 hover:text-red-500 hover:bg-gray-100 p-1 rounded transition-all z-10",title:"",children:c.jsx(hn,{size:14})}),S.type==="update_task"&&c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500 font-bold uppercase tracking-wider mb-1",children:[c.jsx(Mg,{size:12})," "]}),c.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[S.params.title!==void 0&&c.jsx("input",{type:"text",value:S.params.title||"",onChange:C=>A(T,"title",C.target.value),className:"w-full text-xs font-bold border border-gray-200 rounded px-1.5 py-1 focus:ring-1 focus:ring-amber-300 outline-none",placeholder:""}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded border border-gray-100 flex-1",children:[c.jsx("span",{className:"text-[10px] text-gray-400",children:""}),c.jsx("input",{type:"date",value:S.params.start_date||"",onChange:C=>A(T,"start_date",C.target.value),className:"flex-1 text-xs bg-transparent outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded border border-gray-100 w-24",children:[c.jsx(Oi,{size:10,className:"text-gray-400"}),c.jsx("input",{type:"time",value:S.params.start_time||"",onChange:C=>A(T,"start_time",C.target.value),className:"flex-1 text-xs bg-transparent outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded border border-gray-100 w-28",children:[c.jsx(Va,{size:10,className:"text-gray-400"}),c.jsxs("select",{value:S.params.reminder_minutes??-1,onChange:C=>{const O=parseInt(C.target.value);A(T,"reminder_minutes",O===-1?null:O)},className:"flex-1 text-xs bg-transparent outline-none",children:[c.jsx("option",{value:-1,children:""}),c.jsx("option",{value:0,children:""}),c.jsx("option",{value:10,children:"10"}),c.jsx("option",{value:30,children:"30"}),c.jsx("option",{value:60,children:"1"})]})]})]}),S.params.description!==void 0&&c.jsx("textarea",{value:S.params.description||"",onChange:C=>A(T,"description",C.target.value),className:"w-full text-xs border border-gray-200 rounded px-1.5 py-1 focus:ring-1 focus:ring-amber-300 outline-none resize-none h-16",placeholder:""})]})]}),S.type==="add_subtasks"&&c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500 mb-2 font-bold uppercase tracking-wider",children:[c.jsx(Nz,{size:12})," "]}),c.jsx("ul",{className:"space-y-2",children:S.params.tasks.map((C,O)=>c.jsxs("li",{className:"flex flex-col gap-1.5 bg-gray-50 p-2 rounded relative group/item border border-transparent hover:border-gray-200 transition-colors",children:[c.jsxs("div",{className:"flex gap-2 w-full pr-5",children:[c.jsx("input",{type:"text",value:C.title,onChange:P=>A(T,"title",P.target.value,O),className:"flex-1 bg-white text-xs border border-gray-200 rounded px-1.5 py-1 focus:ring-1 focus:ring-amber-300 outline-none",placeholder:""}),c.jsx("button",{onClick:()=>E(T,O),className:"absolute right-1 top-1 text-gray-300 hover:text-red-500 p-1 opacity-0 group-hover/item:opacity-100 transition-opacity",title:"",children:c.jsx(jr,{size:12})})]}),c.jsxs("div",{className:"flex flex-wrap gap-2 text-[10px]",children:[c.jsxs("div",{className:"flex items-center gap-1 bg-white rounded border border-gray-200 px-1 py-0.5 min-w-[100px]",children:[c.jsx("span",{className:"text-gray-400",children:""}),c.jsx("input",{type:"date",value:C.start_date||"",onChange:P=>A(T,"start_date",P.target.value,O),className:"flex-1 outline-none min-w-0 bg-transparent"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-white rounded border border-gray-200 px-1 py-0.5 w-[80px]",children:[c.jsx(Oi,{size:10,className:"text-gray-400"}),c.jsx("input",{type:"time",value:C.start_time||"",onChange:P=>A(T,"start_time",P.target.value,O),className:"flex-1 outline-none min-w-0 bg-transparent"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-white rounded border border-gray-200 px-1 py-0.5 w-[85px]",children:[c.jsx(Va,{size:10,className:"text-gray-400"}),c.jsxs("select",{value:C.reminder_minutes??-1,onChange:P=>{const H=parseInt(P.target.value);A(T,"reminder_minutes",H===-1?null:H,O)},className:"flex-1 outline-none bg-transparent",children:[c.jsx("option",{value:-1,children:""}),c.jsx("option",{value:0,children:""}),c.jsx("option",{value:10,children:"10"}),c.jsx("option",{value:60,children:"1hr"})]})]})]})]},O))})]})]},T))}),c.jsxs("div",{className:"p-2 border-t border-amber-200/50 flex gap-2",children:[c.jsx("button",{onClick:()=>g([]),className:"flex-1 py-1.5 text-xs text-gray-500 hover:bg-gray-100 rounded-lg transition-colors",children:""}),c.jsxs("button",{onClick:k,className:"flex-1 py-1.5 bg-amber-500 hover:bg-amber-600 text-white rounded-lg text-sm font-bold shadow-sm transition-colors flex items-center justify-center gap-1.5",children:[" (",b.length,")"]})]})]}),d&&c.jsxs("div",{className:"flex gap-3",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-600 text-white flex items-center justify-center flex-shrink-0",children:c.jsx(xi,{size:14,className:"animate-spin"})}),c.jsxs("div",{className:"bg-white px-4 py-3 rounded-2xl rounded-tl-none shadow-sm border border-indigo-100 flex items-center gap-2",children:[c.jsx("span",{className:"w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),c.jsx("span",{className:"w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),c.jsx("span",{className:"w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]}),c.jsx("div",{ref:h})]}),c.jsxs("div",{className:"p-3 bg-white border-t border-gray-100",children:[c.jsxs("form",{onSubmit:S=>{S.preventDefault(),D(o)},className:"relative",children:[c.jsxs("div",{className:"relative flex items-end gap-2 bg-gray-50 border border-gray-200 rounded-2xl p-2 focus-within:ring-2 focus-within:ring-indigo-100 focus-within:border-indigo-300 transition-all",children:[c.jsx("textarea",{value:o,onChange:S=>{a(S.target.value),S.target.style.height="auto",S.target.style.height=S.target.scrollHeight+"px"},onKeyDown:S=>{S.key==="Enter"&&(S.metaKey||S.ctrlKey)&&(S.preventDefault(),D(o))},placeholder:" GTD ... (Cmd + Enter )",className:"flex-1 bg-transparent border-none focus:ring-0 text-sm resize-none max-h-32 min-h-[24px] py-1 px-1 custom-scrollbar leading-relaxed outline-none",disabled:d,rows:1,style:{height:"auto",minHeight:"24px"}}),c.jsx("button",{type:"submit",disabled:!o.trim()||d,className:"p-1.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors self-end mb-0.5",title:"Cmd + Enter ",children:c.jsx(zz,{size:16})})]}),c.jsx("div",{className:"text-[10px] text-gray-400 text-right mt-1 pr-1",children:"Cmd + Enter  / Enter "})]}),c.jsx("div",{className:"mt-2 flex gap-2 overflow-x-auto pb-1 no-scrollbar",children:["","","",""].map(S=>c.jsx("button",{onClick:()=>D(S),disabled:d,className:"px-2.5 py-1 bg-gray-50 hover:bg-indigo-50 text-gray-600 hover:text-indigo-600 border border-gray-100 hover:border-indigo-100 rounded-full text-xs whitespace-nowrap transition-colors",children:S},S))})]})]})}):null},DR=6048e5,pte=864e5,AR=6e4,RR=36e5,hE=Symbol.for("constructDateFrom");function Eo(t,e){return typeof t=="function"?t(e):t&&typeof t=="object"&&hE in t?t[hE](e):t instanceof Date?new t.constructor(e):new Date(e)}function Gs(t,e){return Eo(e||t,t)}function OR(t,e,n){const r=Gs(t,n==null?void 0:n.in);return isNaN(e)?Eo((n==null?void 0:n.in)||t,NaN):(e&&r.setDate(r.getDate()+e),r)}let mte={};function s0(){return mte}function Bf(t,e){var a,l,u,d;const n=s0(),r=(e==null?void 0:e.weekStartsOn)??((l=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:l.weekStartsOn)??n.weekStartsOn??((d=(u=n.locale)==null?void 0:u.options)==null?void 0:d.weekStartsOn)??0,s=Gs(t,e==null?void 0:e.in),i=s.getDay(),o=(i<r?7:0)+i-r;return s.setDate(s.getDate()-o),s.setHours(0,0,0,0),s}function ag(t,e){return Bf(t,{...e,weekStartsOn:1})}function PR(t,e){const n=Gs(t,e==null?void 0:e.in),r=n.getFullYear(),s=Eo(n,0);s.setFullYear(r+1,0,4),s.setHours(0,0,0,0);const i=ag(s),o=Eo(n,0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);const a=ag(o);return n.getTime()>=i.getTime()?r+1:n.getTime()>=a.getTime()?r:r-1}function pE(t){const e=Gs(t),n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),+t-+n}function LR(t,...e){const n=Eo.bind(null,t||e.find(r=>typeof r=="object"));return e.map(n)}function lg(t,e){const n=Gs(t,e==null?void 0:e.in);return n.setHours(0,0,0,0),n}function gte(t,e,n){const[r,s]=LR(n==null?void 0:n.in,t,e),i=lg(r),o=lg(s),a=+i-pE(i),l=+o-pE(o);return Math.round((a-l)/pte)}function yte(t,e){const n=PR(t,e),r=Eo((e==null?void 0:e.in)||t,0);return r.setFullYear(n,0,4),r.setHours(0,0,0,0),ag(r)}function Qh(t,e,n){const[r,s]=LR(n==null?void 0:n.in,t,e);return+lg(r)==+lg(s)}function xte(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function bte(t){return!(!xte(t)&&typeof t!="number"||isNaN(+Gs(t)))}function wte(t,e){const n=Gs(t,e==null?void 0:e.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}const vte={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},kte=(t,e,n)=>{let r;const s=vte[t];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",e.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function hu(t){return(e={})=>{const n=e.width?String(e.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const Ste={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},_te={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Tte={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Cte={date:hu({formats:Ste,defaultWidth:"full"}),time:hu({formats:_te,defaultWidth:"full"}),dateTime:hu({formats:Tte,defaultWidth:"full"})},Ete={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Nte=(t,e,n,r)=>Ete[t];function po(t){return(e,n)=>{const r=n!=null&&n.context?String(n.context):"standalone";let s;if(r==="formatting"&&t.formattingValues){const o=t.defaultFormattingWidth||t.defaultWidth,a=n!=null&&n.width?String(n.width):o;s=t.formattingValues[a]||t.formattingValues[o]}else{const o=t.defaultWidth,a=n!=null&&n.width?String(n.width):t.defaultWidth;s=t.values[a]||t.values[o]}const i=t.argumentCallback?t.argumentCallback(e):e;return s[i]}}const jte={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Ite={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Mte={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Dte={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Ate={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Rte={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Ote=(t,e)=>{const n=Number(t),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},Pte={ordinalNumber:Ote,era:po({values:jte,defaultWidth:"wide"}),quarter:po({values:Ite,defaultWidth:"wide",argumentCallback:t=>t-1}),month:po({values:Mte,defaultWidth:"wide"}),day:po({values:Dte,defaultWidth:"wide"}),dayPeriod:po({values:Ate,defaultWidth:"wide",formattingValues:Rte,defaultFormattingWidth:"wide"})};function mo(t){return(e,n={})=>{const r=n.width,s=r&&t.matchPatterns[r]||t.matchPatterns[t.defaultMatchWidth],i=e.match(s);if(!i)return null;const o=i[0],a=r&&t.parsePatterns[r]||t.parsePatterns[t.defaultParseWidth],l=Array.isArray(a)?$te(a,f=>f.test(o)):Lte(a,f=>f.test(o));let u;u=t.valueCallback?t.valueCallback(l):l,u=n.valueCallback?n.valueCallback(u):u;const d=e.slice(o.length);return{value:u,rest:d}}}function Lte(t,e){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return n}function $te(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return n}function $R(t){return(e,n={})=>{const r=e.match(t.matchPattern);if(!r)return null;const s=r[0],i=e.match(t.parsePattern);if(!i)return null;let o=t.valueCallback?t.valueCallback(i[0]):i[0];o=n.valueCallback?n.valueCallback(o):o;const a=e.slice(s.length);return{value:o,rest:a}}}const zte=/^(\d+)(th|st|nd|rd)?/i,Fte=/\d+/i,Bte={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Ute={any:[/^b/i,/^(a|c)/i]},Hte={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Vte={any:[/1/i,/2/i,/3/i,/4/i]},Wte={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Kte={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Gte={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},qte={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Yte={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Jte={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Xte={ordinalNumber:$R({matchPattern:zte,parsePattern:Fte,valueCallback:t=>parseInt(t,10)}),era:mo({matchPatterns:Bte,defaultMatchWidth:"wide",parsePatterns:Ute,defaultParseWidth:"any"}),quarter:mo({matchPatterns:Hte,defaultMatchWidth:"wide",parsePatterns:Vte,defaultParseWidth:"any",valueCallback:t=>t+1}),month:mo({matchPatterns:Wte,defaultMatchWidth:"wide",parsePatterns:Kte,defaultParseWidth:"any"}),day:mo({matchPatterns:Gte,defaultMatchWidth:"wide",parsePatterns:qte,defaultParseWidth:"any"}),dayPeriod:mo({matchPatterns:Yte,defaultMatchWidth:"any",parsePatterns:Jte,defaultParseWidth:"any"})},Qte={code:"en-US",formatDistance:kte,formatLong:Cte,formatRelative:Nte,localize:Pte,match:Xte,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Zte(t,e){const n=Gs(t,e==null?void 0:e.in);return gte(n,wte(n))+1}function ene(t,e){const n=Gs(t,e==null?void 0:e.in),r=+ag(n)-+yte(n);return Math.round(r/DR)+1}function zR(t,e){var d,f,h,p;const n=Gs(t,e==null?void 0:e.in),r=n.getFullYear(),s=s0(),i=(e==null?void 0:e.firstWeekContainsDate)??((f=(d=e==null?void 0:e.locale)==null?void 0:d.options)==null?void 0:f.firstWeekContainsDate)??s.firstWeekContainsDate??((p=(h=s.locale)==null?void 0:h.options)==null?void 0:p.firstWeekContainsDate)??1,o=Eo((e==null?void 0:e.in)||t,0);o.setFullYear(r+1,0,i),o.setHours(0,0,0,0);const a=Bf(o,e),l=Eo((e==null?void 0:e.in)||t,0);l.setFullYear(r,0,i),l.setHours(0,0,0,0);const u=Bf(l,e);return+n>=+a?r+1:+n>=+u?r:r-1}function tne(t,e){var a,l,u,d;const n=s0(),r=(e==null?void 0:e.firstWeekContainsDate)??((l=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:l.firstWeekContainsDate)??n.firstWeekContainsDate??((d=(u=n.locale)==null?void 0:u.options)==null?void 0:d.firstWeekContainsDate)??1,s=zR(t,e),i=Eo((e==null?void 0:e.in)||t,0);return i.setFullYear(s,0,r),i.setHours(0,0,0,0),Bf(i,e)}function nne(t,e){const n=Gs(t,e==null?void 0:e.in),r=+Bf(n,e)-+tne(n,e);return Math.round(r/DR)+1}function Pn(t,e){const n=t<0?"-":"",r=Math.abs(t).toString().padStart(e,"0");return n+r}const aa={y(t,e){const n=t.getFullYear(),r=n>0?n:1-n;return Pn(e==="yy"?r%100:r,e.length)},M(t,e){const n=t.getMonth();return e==="M"?String(n+1):Pn(n+1,2)},d(t,e){return Pn(t.getDate(),e.length)},a(t,e){const n=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(t,e){return Pn(t.getHours()%12||12,e.length)},H(t,e){return Pn(t.getHours(),e.length)},m(t,e){return Pn(t.getMinutes(),e.length)},s(t,e){return Pn(t.getSeconds(),e.length)},S(t,e){const n=e.length,r=t.getMilliseconds(),s=Math.trunc(r*Math.pow(10,n-3));return Pn(s,e.length)}},kc={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},mE={G:function(t,e,n){const r=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(t,e,n){if(e==="yo"){const r=t.getFullYear(),s=r>0?r:1-r;return n.ordinalNumber(s,{unit:"year"})}return aa.y(t,e)},Y:function(t,e,n,r){const s=zR(t,r),i=s>0?s:1-s;if(e==="YY"){const o=i%100;return Pn(o,2)}return e==="Yo"?n.ordinalNumber(i,{unit:"year"}):Pn(i,e.length)},R:function(t,e){const n=PR(t);return Pn(n,e.length)},u:function(t,e){const n=t.getFullYear();return Pn(n,e.length)},Q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return Pn(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return Pn(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(t,e,n){const r=t.getMonth();switch(e){case"M":case"MM":return aa.M(t,e);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(t,e,n){const r=t.getMonth();switch(e){case"L":return String(r+1);case"LL":return Pn(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(t,e,n,r){const s=nne(t,r);return e==="wo"?n.ordinalNumber(s,{unit:"week"}):Pn(s,e.length)},I:function(t,e,n){const r=ene(t);return e==="Io"?n.ordinalNumber(r,{unit:"week"}):Pn(r,e.length)},d:function(t,e,n){return e==="do"?n.ordinalNumber(t.getDate(),{unit:"date"}):aa.d(t,e)},D:function(t,e,n){const r=Zte(t);return e==="Do"?n.ordinalNumber(r,{unit:"dayOfYear"}):Pn(r,e.length)},E:function(t,e,n){const r=t.getDay();switch(e){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(t,e,n,r){const s=t.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return Pn(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(s,{width:"short",context:"formatting"});case"eeee":default:return n.day(s,{width:"wide",context:"formatting"})}},c:function(t,e,n,r){const s=t.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return Pn(i,e.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(s,{width:"narrow",context:"standalone"});case"cccccc":return n.day(s,{width:"short",context:"standalone"});case"cccc":default:return n.day(s,{width:"wide",context:"standalone"})}},i:function(t,e,n){const r=t.getDay(),s=r===0?7:r;switch(e){case"i":return String(s);case"ii":return Pn(s,e.length);case"io":return n.ordinalNumber(s,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(t,e,n){const s=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(t,e,n){const r=t.getHours();let s;switch(r===12?s=kc.noon:r===0?s=kc.midnight:s=r/12>=1?"pm":"am",e){case"b":case"bb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(t,e,n){const r=t.getHours();let s;switch(r>=17?s=kc.evening:r>=12?s=kc.afternoon:r>=4?s=kc.morning:s=kc.night,e){case"B":case"BB":case"BBB":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(t,e,n){if(e==="ho"){let r=t.getHours()%12;return r===0&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return aa.h(t,e)},H:function(t,e,n){return e==="Ho"?n.ordinalNumber(t.getHours(),{unit:"hour"}):aa.H(t,e)},K:function(t,e,n){const r=t.getHours()%12;return e==="Ko"?n.ordinalNumber(r,{unit:"hour"}):Pn(r,e.length)},k:function(t,e,n){let r=t.getHours();return r===0&&(r=24),e==="ko"?n.ordinalNumber(r,{unit:"hour"}):Pn(r,e.length)},m:function(t,e,n){return e==="mo"?n.ordinalNumber(t.getMinutes(),{unit:"minute"}):aa.m(t,e)},s:function(t,e,n){return e==="so"?n.ordinalNumber(t.getSeconds(),{unit:"second"}):aa.s(t,e)},S:function(t,e){return aa.S(t,e)},X:function(t,e,n){const r=t.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return yE(r);case"XXXX":case"XX":return yl(r);case"XXXXX":case"XXX":default:return yl(r,":")}},x:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"x":return yE(r);case"xxxx":case"xx":return yl(r);case"xxxxx":case"xxx":default:return yl(r,":")}},O:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+gE(r,":");case"OOOO":default:return"GMT"+yl(r,":")}},z:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+gE(r,":");case"zzzz":default:return"GMT"+yl(r,":")}},t:function(t,e,n){const r=Math.trunc(+t/1e3);return Pn(r,e.length)},T:function(t,e,n){return Pn(+t,e.length)}};function gE(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),s=Math.trunc(r/60),i=r%60;return i===0?n+String(s):n+String(s)+e+Pn(i,2)}function yE(t,e){return t%60===0?(t>0?"-":"+")+Pn(Math.abs(t)/60,2):yl(t,e)}function yl(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),s=Pn(Math.trunc(r/60),2),i=Pn(r%60,2);return n+s+e+i}const xE=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},FR=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},rne=(t,e)=>{const n=t.match(/(P+)(p+)?/)||[],r=n[1],s=n[2];if(!s)return xE(t,e);let i;switch(r){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",xE(r,e)).replace("{{time}}",FR(s,e))},sne={p:FR,P:rne},ine=/^D+$/,one=/^Y+$/,ane=["D","DD","YY","YYYY"];function lne(t){return ine.test(t)}function cne(t){return one.test(t)}function une(t,e,n){const r=dne(t,e,n);if(console.warn(r),ane.includes(t))throw new RangeError(r)}function dne(t,e,n){const r=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${r} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const fne=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,hne=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,pne=/^'([^]*?)'?$/,mne=/''/g,gne=/[a-zA-Z]/;function Os(t,e,n){var d,f,h,p,m,y,b,g;const r=s0(),s=(n==null?void 0:n.locale)??r.locale??Qte,i=(n==null?void 0:n.firstWeekContainsDate)??((f=(d=n==null?void 0:n.locale)==null?void 0:d.options)==null?void 0:f.firstWeekContainsDate)??r.firstWeekContainsDate??((p=(h=r.locale)==null?void 0:h.options)==null?void 0:p.firstWeekContainsDate)??1,o=(n==null?void 0:n.weekStartsOn)??((y=(m=n==null?void 0:n.locale)==null?void 0:m.options)==null?void 0:y.weekStartsOn)??r.weekStartsOn??((g=(b=r.locale)==null?void 0:b.options)==null?void 0:g.weekStartsOn)??0,a=Gs(t,n==null?void 0:n.in);if(!bte(a))throw new RangeError("Invalid time value");let l=e.match(hne).map(v=>{const w=v[0];if(w==="p"||w==="P"){const _=sne[w];return _(v,s.formatLong)}return v}).join("").match(fne).map(v=>{if(v==="''")return{isToken:!1,value:"'"};const w=v[0];if(w==="'")return{isToken:!1,value:yne(v)};if(mE[w])return{isToken:!0,value:v};if(w.match(gne))throw new RangeError("Format string contains an unescaped latin alphabet character `"+w+"`");return{isToken:!1,value:v}});s.localize.preprocessor&&(l=s.localize.preprocessor(a,l));const u={firstWeekContainsDate:i,weekStartsOn:o,locale:s};return l.map(v=>{if(!v.isToken)return v.value;const w=v.value;(!(n!=null&&n.useAdditionalWeekYearTokens)&&cne(w)||!(n!=null&&n.useAdditionalDayOfYearTokens)&&lne(w))&&une(w,e,String(t));const _=mE[w[0]];return _(a,w,s.localize,u)}).join("")}function yne(t){const e=t.match(pne);return e?e[1].replace(mne,"'"):t}function xne(t,e,n){return OR(t,-e,n)}function Xs(t,e){const n=()=>Eo(e==null?void 0:e.in,NaN),r=(e==null?void 0:e.additionalDigits)??2,s=kne(t);let i;if(s.date){const u=Sne(s.date,r);i=_ne(u.restDateString,u.year)}if(!i||isNaN(+i))return n();const o=+i;let a=0,l;if(s.time&&(a=Tne(s.time),isNaN(a)))return n();if(s.timezone){if(l=Cne(s.timezone),isNaN(l))return n()}else{const u=new Date(o+a),d=Gs(0,e==null?void 0:e.in);return d.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),d.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),d}return Gs(o+a+l,e==null?void 0:e.in)}const Zh={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},bne=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,wne=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,vne=/^([+-])(\d{2})(?::?(\d{2}))?$/;function kne(t){const e={},n=t.split(Zh.dateTimeDelimiter);let r;if(n.length>2)return e;if(/:/.test(n[0])?r=n[0]:(e.date=n[0],r=n[1],Zh.timeZoneDelimiter.test(e.date)&&(e.date=t.split(Zh.timeZoneDelimiter)[0],r=t.substr(e.date.length,t.length))),r){const s=Zh.timezone.exec(r);s?(e.time=r.replace(s[1],""),e.timezone=s[1]):e.time=r}return e}function Sne(t,e){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),r=t.match(n);if(!r)return{year:NaN,restDateString:""};const s=r[1]?parseInt(r[1]):null,i=r[2]?parseInt(r[2]):null;return{year:i===null?s:i*100,restDateString:t.slice((r[1]||r[2]).length)}}function _ne(t,e){if(e===null)return new Date(NaN);const n=t.match(bne);if(!n)return new Date(NaN);const r=!!n[4],s=id(n[1]),i=id(n[2])-1,o=id(n[3]),a=id(n[4]),l=id(n[5])-1;if(r)return Mne(e,a,l)?Ene(e,a,l):new Date(NaN);{const u=new Date(0);return!jne(e,i,o)||!Ine(e,s)?new Date(NaN):(u.setUTCFullYear(e,i,Math.max(s,o)),u)}}function id(t){return t?parseInt(t):1}function Tne(t){const e=t.match(wne);if(!e)return NaN;const n=Ky(e[1]),r=Ky(e[2]),s=Ky(e[3]);return Dne(n,r,s)?n*RR+r*AR+s*1e3:NaN}function Ky(t){return t&&parseFloat(t.replace(",","."))||0}function Cne(t){if(t==="Z")return 0;const e=t.match(vne);if(!e)return 0;const n=e[1]==="+"?-1:1,r=parseInt(e[2]),s=e[3]&&parseInt(e[3])||0;return Ane(r,s)?n*(r*RR+s*AR):NaN}function Ene(t,e,n){const r=new Date(0);r.setUTCFullYear(t,0,4);const s=r.getUTCDay()||7,i=(e-1)*7+n+1-s;return r.setUTCDate(r.getUTCDate()+i),r}const Nne=[31,null,31,30,31,30,31,31,30,31,30,31];function BR(t){return t%400===0||t%4===0&&t%100!==0}function jne(t,e,n){return e>=0&&e<=11&&n>=1&&n<=(Nne[e]||(BR(t)?29:28))}function Ine(t,e){return e>=1&&e<=(BR(t)?366:365)}function Mne(t,e,n){return e>=1&&e<=53&&n>=0&&n<=6}function Dne(t,e,n){return t===24?e===0&&n===0:n>=0&&n<60&&e>=0&&e<60&&t>=0&&t<25}function Ane(t,e){return e>=0&&e<=59}const Rne=({onSave:t,onCancel:e,initialData:n})=>{const{user:r,setToast:s}=x.useContext(jn),[i,o]=x.useState((n==null?void 0:n.description)||""),[a,l]=x.useState(((n==null?void 0:n.images)||[]).map(N=>({url:N}))),[u,d]=x.useState(!1),[f,h]=x.useState(!1),p=x.useRef(null),y=(()=>n!=null&&n.date&&!isNaN(n.date.getTime())?n.date:new Date)(),[b,g]=x.useState(Os(y,"yyyy-MM-dd")),[v,w]=x.useState(Os(y,"HH:mm")),_=async N=>new Promise(E=>{const S=new FileReader;S.readAsDataURL(N),S.onload=T=>{var O;const C=new Image;C.src=(O=T.target)==null?void 0:O.result,C.onload=()=>{const P=document.createElement("canvas");let H=C.width,M=C.height;const I=1920;H>M&&H>I?(M*=I/H,H=I):M>I&&(H*=I/M,M=I),P.width=H,P.height=M;const K=P.getContext("2d");K==null||K.drawImage(C,0,0,H,M);let G=.9;const R=()=>{P.toBlob(Ee=>{if(!Ee){E(null);return}if(Ee.size>300*1024&&G>.1)G-=.1,R();else{const ge=(Ee.size/1024).toFixed(1);E({blob:Ee,sizeText:`${ge} KB`})}},"image/jpeg",G)};R()}},S.onerror=()=>E(null)}),D=async N=>{const E=N.target.files;if(!(!E||E.length===0)&&!(!r||!be)){d(!0);try{const S=[];for(let T=0;T<E.length;T++){const C=E[T],O=await _(C);if(!O)continue;const{blob:P,sizeText:H}=O,M="jpg",I=`${Date.now()}_${xI()}.${M}`,K=`${r.id}/${I}`,{error:G}=await be.storage.from("attachments").upload(K,P,{contentType:"image/jpeg"});if(G)throw G;const{data:R}=be.storage.from("attachments").getPublicUrl(K);R&&S.push({url:R.publicUrl,sizeText:H,isNew:!0})}l(T=>[...T,...S])}catch(S){console.error("Upload error:",S),s==null||s({msg:"",type:"error"})}finally{d(!1),N.target&&(N.target.value="")}}},k=async()=>{const N=document.createElement("div");if(N.innerHTML=i,!(N.textContent||N.innerText||"").trim()&&a.length===0){s==null||s({msg:"",type:"warning"});return}h(!0);try{const S=new Date(`${b}T${v}`),T=a.map(C=>C.url);await t({description:i,images:T,date:S}),e()}catch(S){console.error("Save error:",S),s==null||s({msg:"",type:"error"})}finally{h(!1)}},A=N=>{var S;const E=(S=p.current)==null?void 0:S.getEditor();if(E)switch(N){case"bold":E.chain().focus().toggleBold().run();break;case"italic":E.chain().focus().toggleItalic().run();break;case"bulletList":E.chain().focus().toggleBulletList().run();break;case"orderedList":E.chain().focus().toggleOrderedList().run();break;case"h1":E.chain().focus().toggleHeading({level:1}).run();break;case"h2":E.chain().focus().toggleHeading({level:2}).run();break}};return c.jsxs("div",{className:"fixed inset-0 z-[1200] flex flex-col bg-white",children:[c.jsxs("div",{className:"flex flex-col border-b border-gray-100 bg-white/80 backdrop-blur-md sticky top-0 z-20",children:[c.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[c.jsx("button",{onClick:e,className:"p-2 -ml-2 text-gray-500 hover:bg-gray-100 rounded-full",children:c.jsx(hn,{size:24})}),c.jsx("div",{className:"font-bold text-lg text-gray-800",children:n?"":""}),c.jsx("button",{onClick:k,disabled:f||u,className:`px-4 py-1.5 rounded-full font-bold text-sm text-white transition-all ${f||u?"bg-gray-300":"bg-pink-500 hover:bg-pink-600 active:scale-95"}`,children:f?c.jsx(xi,{size:16,className:"animate-spin"}):""})]}),c.jsxs("div",{className:"px-4 pb-2 flex gap-2",children:[c.jsx("input",{type:"date",value:b,onChange:N=>g(N.target.value),className:"bg-gray-50 border border-gray-200 rounded-lg px-2 py-1 text-sm font-medium text-gray-700 outline-none focus:ring-2 focus:ring-pink-200"}),c.jsx("input",{type:"time",value:v,onChange:N=>w(N.target.value),className:"bg-gray-50 border border-gray-200 rounded-lg px-2 py-1 text-sm font-medium text-gray-700 outline-none focus:ring-2 focus:ring-pink-200"})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-32",children:[a.length>0&&c.jsx("div",{className:"grid grid-cols-2 gap-2 mb-4",children:a.map((N,E)=>c.jsxs("div",{className:"relative group aspect-square rounded-xl overflow-hidden bg-gray-100 border border-gray-200",children:[c.jsx("img",{src:N.url,alt:"Moment",className:"w-full h-full object-cover"}),N.sizeText&&c.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[10px] py-0.5 px-2 text-center pointer-events-none",children:N.sizeText}),c.jsx("button",{onClick:()=>l(S=>S.filter((T,C)=>C!==E)),className:"absolute top-2 right-2 p-1.5 bg-black/50 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:c.jsx(hn,{size:14})})]},E))}),c.jsx("div",{className:"min-h-[200px]",onClick:()=>{var N;return(N=p.current)==null?void 0:N.focus()},children:c.jsx(Zg,{ref:p,initialContent:i,onChange:o,placeholder:"...",textSizeClass:"text-lg",descFontClass:"font-newsreader",className:"moments-editor"})})]}),c.jsxs("div",{className:"sticky bottom-0 left-0 right-0 bg-white border-t border-gray-100 pb-safe pt-2 px-2 z-20 shadow-[0_-4px_12px_rgba(0,0,0,0.05)]",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2 px-2",children:[c.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 bg-pink-50 text-pink-600 rounded-full cursor-pointer active:scale-95 transition-transform select-none",children:[c.jsx(wf,{size:20}),c.jsx("span",{className:"text-sm font-bold",children:""}),c.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:D})]}),u&&c.jsx("span",{className:"text-xs text-gray-400 animate-pulse",children:"..."})]}),c.jsxs("div",{className:"flex items-center justify-between px-2 py-2 overflow-x-auto no-scrollbar",children:[c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 p-1 rounded-xl",children:[c.jsx(Sc,{icon:c.jsx(nz,{size:18}),onClick:()=>A("bold")}),c.jsx(Sc,{icon:c.jsx(Tz,{size:18}),onClick:()=>A("italic")})]}),c.jsx("div",{className:"w-px h-6 bg-gray-200 mx-2 shrink-0"}),c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 p-1 rounded-xl",children:[c.jsx(Sc,{icon:c.jsx(vz,{size:18}),onClick:()=>A("h1")}),c.jsx(Sc,{icon:c.jsx(kz,{size:18}),onClick:()=>A("h2")})]}),c.jsx("div",{className:"w-px h-6 bg-gray-200 mx-2 shrink-0"}),c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 p-1 rounded-xl",children:[c.jsx(Sc,{icon:c.jsx(PI,{size:18}),onClick:()=>A("bulletList")}),c.jsx(Sc,{icon:c.jsx(Ez,{size:18}),onClick:()=>A("orderedList")})]})]})]})]})},Sc=({icon:t,onClick:e})=>c.jsx("button",{type:"button",onMouseDown:n=>{n.preventDefault(),e()},className:"p-2 text-gray-600 hover:text-pink-500 hover:bg-white rounded-lg transition-all active:scale-90",children:t}),One=({tasks:t,tags:e,isGuest:n,onAddTask:r,onUpdateTask:s,onDeleteTask:i,scrollRef:o})=>{const{setToast:a}=x.useContext(jn),[l,u]=x.useState(!1),[d,f]=x.useState(null),[h,p]=x.useState(null),[m,y]=x.useState(20),b=x.useRef(null),g=x.useRef(null);x.useEffect(()=>{if(o!=null&&o.current&&g.current){const T=document.getElementById(`moment-${o.current}`);T&&T.scrollIntoView({behavior:"auto",block:"center"})}},[t]),x.useEffect(()=>{const T=g.current;if(!T)return;const C=()=>{const H=T.scrollTop+T.clientHeight/2;let M=null,I=1/0;T.querySelectorAll("[data-moment-id]").forEach(G=>{const R=G.getBoundingClientRect();R.top+R.height/2;const ge=G.offsetTop+G.offsetHeight/2,F=Math.abs(ge-H);F<I&&(I=F,M=G.getAttribute("data-moment-id"))}),M&&o&&(o.current=M,localStorage.setItem("heart_last_moment_id",M))};let O;const P=()=>{clearTimeout(O),O=setTimeout(C,100)};return T.addEventListener("scroll",P),()=>T.removeEventListener("scroll",P)},[m,t]);const v=x.useMemo(()=>e.find(T=>T.name==="OurTimeMoment"),[e]),w=x.useMemo(()=>e.find(T=>T.name.includes("Google:")||T.name==="Google:"),[e]),_=x.useMemo(()=>e.find(T=>T.name.includes("-Wei")||T.name==="-Wei"),[e]),D=T=>{try{let C=0;if(T.start_date){const O=T.start_date,P=T.start_time||"00:00",H=P.length>5?P.substring(0,5):P,M=Xs(`${O}T${H}`);isNaN(M.getTime())||(C=M.getTime())}if(C===0&&T.created_at){const O=new Date(T.created_at);isNaN(O.getTime())||(C=O.getTime())}return C}catch{return 0}},k=x.useMemo(()=>!v||!w&&!_?[]:t.filter(T=>{if(T.status==="trash"||T.status==="deleted"||T.is_deleted||T.deleted_at)return!1;const C=T.tags||[];if(!C.includes(v.id))return!1;const O=w&&C.includes(w.id),P=_&&C.includes(_.id);return O||P}).sort((T,C)=>{const O=D(T);return D(C)-O}),[t,v,w,_]),A=x.useMemo(()=>k.slice(0,m),[k,m]),N=x.useMemo(()=>{var O,P;const T=[];let C=0;for(;C<A.length;){const H=A[C],M=_&&((O=H.tags)==null?void 0:O.includes(_.id)),I=A[C+1];if(I){const K=_&&((P=I.tags)==null?void 0:P.includes(_.id));if(M!==K){T.push({type:"pair",items:[H,I]}),C+=2;continue}}T.push({type:"single",items:[H]}),C++}return T},[A,_]);x.useEffect(()=>{const T=new IntersectionObserver(C=>{C[0].isIntersecting&&y(O=>Math.min(O+20,k.length))},{threshold:.1});return b.current&&T.observe(b.current),()=>T.disconnect()},[k.length]);const E=async T=>{try{const C=T.date||new Date,O=Os(C,"yyyy-MM-dd"),P=Os(C,"HH:mm");if(d){const H={description:T.description,images:T.images,start_date:O,start_time:P};await s(d.id,H),a==null||a({msg:"",type:"info"})}else{const H=[];v&&H.push(v.id);let M=null;if(n?M=_==null?void 0:_.id:M=w==null?void 0:w.id,!M){const I=e.find(G=>G.name.includes("-Wei")),K=e.find(G=>G.name.includes("Google:"));n&&I?M=I.id:!n&&K&&(M=K.id)}if(M)H.push(M);else{a==null||a({msg:"",type:"error"});return}await r({title:Os(C,"yyyy-MM-dd HH:mm"),description:T.description,images:T.images,tags:H,start_date:O,start_time:P,is_all_day:!1,status:"inbox"}),a==null||a({msg:"",type:"success"})}u(!1),f(null)}catch(C){console.error(C),a==null||a({msg:"",type:"error"})}},S=(T,C,O)=>{const P=T.start_date?Xs(T.start_date):Xs(T.created_at),H=Os(P,"yyyy/MM/dd"),M=T.start_time?T.start_time.substring(0,5):Os(P,"HH:mm");return c.jsxs("div",{"data-moment-id":T.id,className:`
                    relative w-full flex ${C?"justify-end":"justify-start"}
                    ${O?"mt-16":""} 
                    group transition-all duration-500 animate-in fade-in slide-in-from-bottom-4
                `,children:[c.jsx("div",{className:`
                    absolute top-6 w-4 h-4 rounded-full z-10 shadow-sm border-4 border-white
                    ${C?"left-[-8px] bg-pink-400 ring-2 ring-pink-100":"right-[-8px] bg-indigo-400 ring-2 ring-indigo-100"}
                `}),c.jsxs("div",{className:`w-[90%] ${C?"pl-6 text-right":"pr-6 text-left"}`,children:[c.jsxs("div",{className:`
                        mb-1 flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-gray-400
                        ${C?"justify-end flex-row-reverse":"mt-8"}
                    `,children:[c.jsx(So,{size:12}),c.jsx("span",{children:H}),c.jsx("span",{className:"w-1 h-1 rounded-full bg-gray-300 mx-1"}),c.jsx(Oi,{size:12}),c.jsx("span",{children:M})]}),c.jsxs("div",{className:`
                            relative bg-white p-4 rounded-2xl shadow-sm border transition-all hover:shadow-md cursor-pointer
                            ${C?"border-pink-50 hover:border-pink-200 rounded-tl-none":"border-indigo-50 hover:border-indigo-200 rounded-tr-none"}
                        `,onDoubleClick:()=>{n&&C||!n&&!C?(f(T),u(!0)):a==null||a({msg:"",type:"warning"})},children:[T.images&&T.images.length>0&&c.jsx("div",{className:`grid gap-1 mb-3 rounded-lg overflow-hidden ${T.images.length>1?"grid-cols-2":"grid-cols-1"}`,children:T.images.map((I,K)=>c.jsx("img",{src:I,className:"w-full h-auto rounded-lg hover:scale-105 transition-transform duration-500 cursor-zoom-in",loading:"lazy",onClick:G=>{G.stopPropagation(),p(I)}},K))}),c.jsx("div",{className:`prose prose-sm max-w-none font-newsreader text-gray-600 leading-snug ${C?"prose-pink text-right":"prose-indigo text-left"}`,dangerouslySetInnerHTML:{__html:T.description||""}}),c.jsx("div",{className:`absolute top-2 ${C?"left-2":"right-2"} opacity-0 group-hover:opacity-100 transition-opacity`,children:c.jsx("button",{onClick:I=>{I.stopPropagation(),window.confirm("")&&i(T.id)},className:"p-1 text-gray-300 hover:text-red-400 hover:bg-gray-50 rounded-full",children:c.jsx(jr,{size:14})})})]})]})]},T.id)};return c.jsxs("div",{className:"relative min-h-full bg-slate-50 pb-20",children:[c.jsxs("div",{className:"max-w-4xl mx-auto px-2 md:px-4 py-8",children:[k.length===0&&c.jsxs("div",{className:"text-center py-20 opacity-50",children:[c.jsx(ou,{size:48,className:"mx-auto text-pink-300 mb-4 animate-pulse"}),c.jsx("p",{className:"text-gray-500 text-lg font-newsreader",children:"..."})]}),c.jsxs("div",{className:"relative space-y-0",children:[k.length>0&&c.jsx("div",{className:"absolute left-1/2 top-4 bottom-4 w-0.5 bg-gradient-to-b from-indigo-200 via-pink-200 to-transparent -translate-x-1/2 z-0"}),N.map((T,C)=>{var O,P,H;if(T.type==="pair"){const M=T.items[0],I=T.items[1],K=_&&((O=M.tags)==null?void 0:O.includes(_.id)),G=_&&((P=I.tags)==null?void 0:P.includes(_.id));return c.jsxs("div",{className:"grid grid-cols-2 w-full relative z-10",children:[c.jsx("div",{className:"w-full",children:K?G?null:S(I,!1,!0):S(M,!1,!1)}),c.jsx("div",{className:"w-full",children:K?S(M,!0,!1):G?S(I,!0,!0):null})]},`pair-${C}`)}else{const M=T.items[0],I=_&&((H=M.tags)==null?void 0:H.includes(_.id));return c.jsxs("div",{className:"grid grid-cols-2 w-full relative z-10",children:[c.jsx("div",{className:"w-full",children:!I&&S(M,!1,!1)}),c.jsx("div",{className:"w-full",children:I&&S(M,!0,!1)})]},`single-${C}`)}}),k.length>m&&c.jsx("div",{ref:b,className:"py-8 flex justify-center",children:c.jsx("div",{className:"w-8 h-8 border-4 border-pink-200 rounded-full animate-spin border-t-transparent"})})]})]}),c.jsx("button",{onClick:()=>{f(null),u(!0)},className:`
                    fixed bottom-6 right-6 w-14 h-14 text-white rounded-full shadow-lg flex items-center justify-center hover:scale-110 active:scale-95 transition-all z-50
                    bg-gradient-to-tr ${n?"from-pink-500 to-rose-500":"from-indigo-500 to-blue-600"}
                `,children:c.jsx(ri,{size:28})}),l&&c.jsx(Rne,{initialData:d?{description:d.description,images:d.images,date:(()=>{try{if(d.start_date){const C=d.start_time?d.start_time.substring(0,5):"00:00",O=Xs(`${d.start_date}T${C}`);if(!isNaN(O.getTime()))return O}const T=new Date(d.created_at);return isNaN(T.getTime())?new Date:T}catch{return new Date}})()}:void 0,onSave:E,onCancel:()=>{u(!1),f(null)}}),h&&c.jsx("div",{className:"fixed inset-0 z-[1300] bg-black/95 flex items-center justify-center p-4 animate-in fade-in duration-200",onClick:()=>p(null),children:c.jsx("img",{src:h,className:"max-w-full max-h-full object-contain cursor-zoom-out",onClick:T=>{T.stopPropagation(),p(null)}})})]})},Pne={lessThanXSeconds:{one:" 1 ",other:" {{count}} "},xSeconds:{one:"1 ",other:"{{count}} "},halfAMinute:"",lessThanXMinutes:{one:" 1 ",other:" {{count}} "},xMinutes:{one:"1 ",other:"{{count}} "},xHours:{one:"1 ",other:"{{count}} "},aboutXHours:{one:" 1 ",other:" {{count}} "},xDays:{one:"1 ",other:"{{count}} "},aboutXWeeks:{one:" 1 ",other:" {{count}} "},xWeeks:{one:"1 ",other:"{{count}} "},aboutXMonths:{one:" 1 ",other:" {{count}} "},xMonths:{one:"1 ",other:"{{count}} "},aboutXYears:{one:" 1 ",other:" {{count}} "},xYears:{one:"1 ",other:"{{count}} "},overXYears:{one:" 1 ",other:" {{count}} "},almostXYears:{one:" 1 ",other:" {{count}} "}},Lne=(t,e,n)=>{let r;const s=Pne[t];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",String(e)),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?r+"":r+"":r},$ne={full:"y''M''d'' EEEE",long:"y''M''d''",medium:"yyyy-MM-dd",short:"yy-MM-dd"},zne={full:"zzzz a h:mm:ss",long:"z a h:mm:ss",medium:"a h:mm:ss",short:"a h:mm"},Fne={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},Bne={date:hu({formats:$ne,defaultWidth:"full"}),time:hu({formats:zne,defaultWidth:"full"}),dateTime:hu({formats:Fne,defaultWidth:"full"})},Une={lastWeek:"''eeee p",yesterday:"'' p",today:"'' p",tomorrow:"'' p",nextWeek:"''eeee p",other:"P"},Hne=(t,e,n,r)=>Une[t],Vne={narrow:["",""],abbreviated:["",""],wide:["",""]},Wne={narrow:["1","2","3","4"],abbreviated:["","","",""],wide:["","","",""]},Kne={narrow:["","","","","","","","","","","",""],abbreviated:["1","2","3","4","5","6","7","8","9","10","11","12"],wide:["","","","","","","","","","","",""]},Gne={narrow:["","","","","","",""],short:["","","","","","",""],abbreviated:["","","","","","",""],wide:["","","","","","",""]},qne={narrow:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},abbreviated:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},wide:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""}},Yne={narrow:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},abbreviated:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},wide:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""}},Jne=(t,e)=>{const n=Number(t);switch(e==null?void 0:e.unit){case"date":return n+"";case"hour":return n+"";case"minute":return n+"";case"second":return n+"";default:return" "+n}},Xne={ordinalNumber:Jne,era:po({values:Vne,defaultWidth:"wide"}),quarter:po({values:Wne,defaultWidth:"wide",argumentCallback:t=>t-1}),month:po({values:Kne,defaultWidth:"wide"}),day:po({values:Gne,defaultWidth:"wide"}),dayPeriod:po({values:qne,defaultWidth:"wide",formattingValues:Yne,defaultFormattingWidth:"wide"})},Qne=/^(\s*)?\d+(|||)?/i,Zne=/\d+/i,ere={narrow:/^()/i,abbreviated:/^()/i,wide:/^(|)/i},tre={any:[/^()/i,/^()/i]},nre={narrow:/^[1234]/i,abbreviated:/^[]/i,wide:/^[]/i},rre={any:[/(1|)/i,/(2|)/i,/(3|)/i,/(4|)/i]},sre={narrow:/^(|||||||||[])/i,abbreviated:/^(|||||||||[]|\d|1[12])/i,wide:/^(|||||||||[])/i},ire={narrow:[/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^(?!(|))/i,/^/i,/^/i],any:[/^|1/i,/^|2/i,/^|3/i,/^|4/i,/^|5/i,/^|6/i,/^|7/i,/^|8/i,/^|9/i,/^(?!(|))|10/i,/^|11/i,/^|12/i]},ore={narrow:/^[]/i,short:/^[]/i,abbreviated:/^[]/i,wide:/^[]/i},are={any:[//i,//i,//i,//i,//i,//i,//i]},lre={any:/^(?|?||[]|?||?|)/i},cre={any:{am:/^?/i,pm:/^?/i,midnight:/^/i,noon:/^[]/i,morning:/^/i,afternoon:/^/i,evening:/^?/i,night:/^/i}},ure={ordinalNumber:$R({matchPattern:Qne,parsePattern:Zne,valueCallback:t=>parseInt(t,10)}),era:mo({matchPatterns:ere,defaultMatchWidth:"wide",parsePatterns:tre,defaultParseWidth:"any"}),quarter:mo({matchPatterns:nre,defaultMatchWidth:"wide",parsePatterns:rre,defaultParseWidth:"any",valueCallback:t=>t+1}),month:mo({matchPatterns:sre,defaultMatchWidth:"wide",parsePatterns:ire,defaultParseWidth:"any"}),day:mo({matchPatterns:ore,defaultMatchWidth:"wide",parsePatterns:are,defaultParseWidth:"any"}),dayPeriod:mo({matchPatterns:lre,defaultMatchWidth:"any",parsePatterns:cre,defaultParseWidth:"any"})},bE={code:"zh-TW",formatDistance:Lne,formatLong:Bne,formatRelative:Hne,localize:Xne,match:ure,options:{weekStartsOn:1,firstWeekContainsDate:4}},fs=64,UR=({onClose:t,isStandalone:e=!1})=>{const n=x.useContext(jn),{tasks:r,tags:s,updateTask:i,addTask:o,user:a,setEditingTaskId:l,editingTaskId:u,setToast:d,undo:f,redo:h,canUndo:p,canRedo:m}=n,[y,b]=x.useState(()=>localStorage.getItem("heart_view_mode")||"schedule"),[g,v]=x.useState(()=>{const pe=localStorage.getItem("heart_selected_date");return pe?Xs(pe):new Date}),w=x.useRef(localStorage.getItem("heart_last_moment_id"));x.useEffect(()=>{localStorage.setItem("heart_view_mode",y)},[y]),x.useEffect(()=>{y==="schedule"&&localStorage.setItem("heart_selected_date",g.toISOString())},[g,y]);const[_,D]=x.useState(()=>{const pe=localStorage.getItem("heart_schedule_tags");return pe?JSON.parse(pe):[]}),[k,A]=x.useState(!1),[N,E]=x.useState(!1),[S,T]=x.useState([]),[C,O]=x.useState(!1),[P,H]=x.useState(null),[M,I]=x.useState(null),[K,G]=x.useState(null),[R,Ee]=x.useState(!1),[ge,F]=x.useState(null),[B,se]=x.useState(!1),[We,ut]=x.useState([]),[oe,je]=x.useState(null),te=C?We:s,$e=()=>C?te.find(pe=>pe.name.includes("-Wei")):te.find(pe=>pe.name==="Google:")||te.find(pe=>pe.name.includes("Google:"))||te.find(pe=>pe.name.includes("")&&pe.name.toLowerCase().includes("google"))||te.find(pe=>pe.name.includes("")),Te=pe=>{const ye=(pe.tags||[]).some(Re=>{const _e=te.find(it=>it.id===Re);return _e&&_e.name.includes("-Wei")});return C?ye?{canEdit:!0}:{canEdit:!1,reason:"Guest -Wei"}:ye?{canEdit:!1,reason:"-Wei Guest "}:{canEdit:!0}},Je=x.useRef(null);x.useEffect(()=>{Je.current&&(Je.current.scrollTop=8*fs-20)},[e]),x.useEffect(()=>{var it;const pe=window.location.pathname,q=new URLSearchParams(window.location.search);if(pe.includes("/share/heart/s/")){const gt=(it=pe.split("/s/")[1])==null?void 0:it.split("/")[0];if(gt&&be){be.from("schedule_snapshots").select("data, created_by").eq("id",gt).single().then(({data:Pt,error:Ft})=>{if(Pt){if(Pt.created_by&&je(Pt.created_by),Pt.data){const{tasks:Ut,tags:Kt,date:Zt}=Pt.data;Ut&&T(Ut),Kt&&ut(Kt),Zt&&v(Xs(Zt)),O(!0)}}else Ft&&console.error("Error loading snapshot:",Ft)});return}}const ye=q.get("date"),Re=q.get("tags"),_e=q.get("d");if(ye&&v(Xs(ye)),Re)try{const Fe=JSON.parse(decodeURIComponent(Re));Array.isArray(Fe)&&ut(Fe)}catch(Fe){console.error("Failed to parse tags",Fe)}if(_e)try{const Fe=decodeURIComponent(_e);let gt;try{gt=JSON.parse(Fe)}catch{console.warn("Direct JSON parse failed")}gt&&Array.isArray(gt)&&(T(gt),O(!0))}catch(Fe){console.error("Failed to parse snapshot data",Fe)}},[]),x.useEffect(()=>{let pe=oe;if(!pe&&C){const _e=window.location.pathname.split("/"),it=_e.indexOf("heart"),Fe=it!==-1&&_e[it+1]?_e[it+1]:null;Fe&&Fe!=="share"&&Fe!=="s"&&(pe=Fe)}if(!C||!be||!pe)return;console.log("[GuestRealtime] Initializing sync for Owner:",pe);const q=async()=>{try{const{data:_e,error:it}=await be.from("tasks").select("*").eq("user_id",pe).neq("status","deleted");_e&&(console.log("[GuestRealtime] Loaded tasks:",_e.length),T(_e));const{data:Fe,error:gt}=await be.from("tags").select("*").eq("user_id",pe);Fe&&ut(Fe)}catch(_e){console.error("[GuestRealtime] Error loading initial data:",_e)}},ye=be.channel(`guest-tasks-${pe}`).on("postgres_changes",{event:"*",schema:"public",table:"tasks",filter:`user_id=eq.${pe}`},_e=>{const{eventType:it,new:Fe,old:gt}=_e;T(Pt=>it==="INSERT"?Pt.some(Ft=>Ft.id===Fe.id)?Pt:[...Pt,Fe]:it==="UPDATE"?Pt.map(Ft=>Ft.id===Fe.id?{...Ft,...Fe}:Ft):it==="DELETE"?Pt.filter(Ft=>Ft.id!==gt.id):Pt)}).subscribe(_e=>{_e==="SUBSCRIBED"&&q()}),Re=be.channel(`guest-tags-${pe}`).on("postgres_changes",{event:"*",schema:"public",table:"tags",filter:`user_id=eq.${pe}`},_e=>{const{eventType:it,new:Fe,old:gt}=_e;ut(Pt=>it==="INSERT"?Pt.some(Ft=>Ft.id===Fe.id)?Pt:[...Pt,Fe]:it==="UPDATE"?Pt.map(Ft=>Ft.id===Fe.id?{...Ft,...Fe}:Ft):it==="DELETE"?Pt.filter(Ft=>Ft.id!==gt.id):Pt)}).subscribe();return()=>{be.removeChannel(ye),be.removeChannel(Re)}},[C,oe]),x.useEffect(()=>{C&&S.length>0&&r.length>0&&T(pe=>pe.map(q=>{const ye=r.find(Re=>Re.id===q.id);return ye?{...q,...ye}:q}))},[r]);const Ye=x.useMemo(()=>{if(!C)return null;if(oe)return oe;const pe=window.location.pathname.split("/"),q=pe.indexOf("heart");if(q!==-1&&pe[q+1]){const ye=pe[q+1];return ye==="share"||ye==="s"?null:ye}return null},[C,oe]),Ke=x.useRef({past:[],future:[]}),lt=x.useRef(!1),St=pe=>{if(lt.current)return;const q=[...Ke.current.past,JSON.parse(JSON.stringify(pe))];q.length>20&&q.shift(),Ke.current.past=q,Ke.current.future=[]},X=async(pe,q)=>{if(!be)return;const ye=new Map(pe.map(_e=>[_e.id,_e])),Re=new Map(q.map(_e=>[_e.id,_e]));for(const _e of q){const it=ye.get(_e.id);if(!it)console.log("[GuestUndo] Restoring task:",_e.id),await be.from("tasks").update({status:"inbox"}).eq("id",_e.id);else if(_e.title!==it.title||_e.start_date!==it.start_date||_e.start_time!==it.start_time||_e.end_time!==it.end_time||_e.duration!==it.duration||_e.status!==it.status){console.log("[GuestUndo] Reverting update for:",_e.id);const{id:gt,user_id:Pt,created_at:Ft,...Ut}=_e;await be.from("tasks").update(Ut).eq("id",gt)}}for(const _e of pe)Re.has(_e.id)||(console.log("[GuestUndo] Deleting added task:",_e.id),await be.from("tasks").delete().eq("id",_e.id))},ee=x.useMemo(()=>{const pe=ye=>{if(ye.start_date&&!ye.is_all_day&&(!ye.start_time||!ye.end_time)){const Re={...ye},_e=new Date(ye.start_date),it=_e.getHours()*60+_e.getMinutes();if(Re.start_time||(Re.start_time=Ne(it)),!Re.end_time&&(Re.duration||ye.duration)){const Fe=Number(Re.duration||ye.duration);Re.end_time=Ne(it+Fe)}return Re}return ye},q={...n};return{...q,tasks:C?S:r,tags:te,undo:async()=>{if(!C)return q.undo();if(Ke.current.past.length===0)return;lt.current=!0;const ye=Ke.current.past.pop();ye&&(Ke.current.future.push(JSON.parse(JSON.stringify(S))),await X(S,ye),T(ye)),lt.current=!1},redo:async()=>{if(!C)return q.redo();if(Ke.current.future.length===0)return;lt.current=!0;const ye=Ke.current.future.pop();ye&&(Ke.current.past.push(JSON.parse(JSON.stringify(S))),await X(S,ye),T(ye)),lt.current=!1},canUndo:C?Ke.current.past.length>0:q.canUndo,canRedo:C?Ke.current.future.length>0:q.canRedo,updateTask:async(ye,Re,_e)=>{var Fe;if(ye==="new"){I(gt=>({...gt,...Re}));return}if(St(S),C){const gt=S.find(Pt=>Pt.id===ye);if(gt&&!((Fe=gt.tags)==null?void 0:Fe.some(Ft=>{var Kt;const Ut=te.find(Zt=>Zt.id===Ft);return(Kt=Ut==null?void 0:Ut.name)==null?void 0:Kt.includes("-Wei")}))){alert(" Wei");return}}const it=pe(Re);if(C&&Ye&&be){console.log("[Guest] Updating task:",ye,it);const{error:gt}=await be.from("tasks").update(it).eq("id",ye);if(gt){alert(`: ${gt.message}
`),console.error("Guest Update Error:",gt);return}}else await i(ye,it,_e);C&&T(gt=>gt.map(Pt=>Pt.id===ye?{...Pt,...it}:Pt))},addTask:async(ye,Re)=>{St(S);const _e=pe(ye);let it=ye.id||`guest-${Date.now()}`;ye.id||(it=crypto.randomUUID?crypto.randomUUID():`guest-${Date.now()}`);try{if(C&&Ye&&be){if(!Ye)return alert(` ID (URL ID: ${Ye})`),"";let Fe=_e.tags||[];if(Fe.length===0){const Ft=te.find(Ut=>Ut.name.includes("-Wei"))||te.find(Ut=>Ut.name.toLowerCase().includes("wei")&&!Ut.name.toLowerCase().includes("google"));if(Ft)Fe=[Ft.id];else if(_.length>0)Fe=_;else if(te.length>0){const Ut=te.find(Kt=>!Kt.name.toLowerCase().includes("google"));Fe=[Ut?Ut.id:te[0].id]}}const gt={..._e,id:it,user_id:Ye,created_at:new Date().toISOString(),status:"todo",tags:Fe};console.log("[Guest] Inserting task for owner:",Ye,gt);const{error:Pt}=await be.from("tasks").insert([gt]).select();if(Pt)throw Pt;d==null||d({msg:"",type:"info"})}else it=await o(_e,Re)}catch(Fe){if(console.warn("Guest addTask failed",Fe),alert(`: ${(Fe==null?void 0:Fe.message)||""}`),!C)return""}if(C){const Fe={id:it,..._e,user_id:Ye};T(gt=>[...gt,Fe])}return it},deleteTask:async ye=>{var Re;if(St(S),C){const _e=S.find(it=>it.id===ye);if(_e&&!((Re=_e.tags)==null?void 0:Re.some(Fe=>{var Pt;const gt=te.find(Ft=>Ft.id===Fe);return(Pt=gt==null?void 0:gt.name)==null?void 0:Pt.includes("-Wei")}))){d==null||d({msg:" Wei",type:"error"});return}}if(C&&Ye&&be){console.log("[Guest] Deleting task (soft):",ye);const{error:_e}=await be.from("tasks").update({status:"deleted"}).eq("id",ye);_e?(alert(`: ${_e.message}`),console.error("Guest Delete Error:",_e)):d==null||d({msg:"",type:"info"})}else await n.deleteTask(ye);C&&(T(_e=>_e.filter(it=>it.id!==ye)),K===ye&&G(null))}}},[n,C,S,te,Ye,be,K,d]),ie=ee.undo,ce=ee.redo,Z=ee.canUndo,ne=ee.canRedo,Se=ee.addTask,Ie=ee.updateTask,fe=ee.deleteTask;x.useEffect(()=>{if(!C)return;const pe=q=>{(q.metaKey||q.ctrlKey)&&q.key==="z"&&!q.shiftKey&&(q.preventDefault(),ie()),((q.metaKey||q.ctrlKey)&&q.key==="z"&&q.shiftKey||(q.metaKey||q.ctrlKey)&&q.key==="y")&&(q.preventDefault(),ce())};return window.addEventListener("keydown",pe),()=>window.removeEventListener("keydown",pe)},[C,ie,ce]);const Oe=pe=>{D(q=>{const ye=q.includes(pe)?q.filter(Re=>Re!==pe):[...q,pe];return localStorage.setItem("heart_schedule_tags",JSON.stringify(ye)),ye})};x.useEffect(()=>{const pe=async q=>{var Re;if(!K||u)return;const ye=(Re=document.activeElement)==null?void 0:Re.tagName;if(!(ye==="INPUT"||ye==="TEXTAREA"||document.activeElement.isContentEditable)&&(q.key==="Delete"||q.key==="Backspace")){if(q.preventDefault(),C){const it=S.find(Fe=>Fe.id===K);if(it){const Fe=Te(it);if(!Fe.canEdit){d==null||d({msg:Fe.reason||"",type:"error"});return}}}const _e=K;await ee.deleteTask(_e),G(null)}};return window.addEventListener("keydown",pe),()=>window.removeEventListener("keydown",pe)},[K,u,ee]);const et=x.useMemo(()=>C?S.filter(Re=>{if(Re.status==="deleted")return!1;let _e=null;return Re.start_date?_e=Xs(Re.start_date):Re.due_date&&(_e=Xs(Re.due_date)),!_e||!Qh(_e,g)?!1:_.length===0?!0:!Re.tags||Re.tags.length===0?!1:Re.tags.some(it=>_.includes(it))}):(!r.some(Re=>{const _e=Re.start_date?Xs(Re.start_date):Re.due_date?Xs(Re.due_date):null;return _e&&Qh(_e,g)&&Re.status!=="deleted"})&&S.length>0?S:r).filter(Re=>{if(Re.status==="deleted")return!1;let _e=null;return Re.start_date?_e=Xs(Re.start_date):Re.due_date&&(_e=Xs(Re.due_date)),!_e||!Qh(_e,g)?!1:_.length===0?!0:!Re.tags||Re.tags.length===0?!1:Re.tags.some(it=>_.includes(it))}),[r,g,_,S,C]),xt=x.useMemo(()=>et.filter(pe=>pe.is_all_day||!pe.start_time),[et]),It=x.useMemo(()=>et.filter(pe=>!pe.is_all_day&&pe.start_time),[et]),ue=pe=>{if(!pe)return 0;const[q,ye]=pe.split(":").map(Number);return q*60+ye},Ne=pe=>{const q=Math.floor(pe/60),ye=Math.floor(pe%60);return`${String(q).padStart(2,"0")}:${String(ye).padStart(2,"0")}`},Ue=pe=>{const q=ue(pe.start_time);let ye=pe.duration||60;const Re=q/60*fs,_e=ye/60*fs;return{top:`${Re}px`,height:`${Math.max(24,_e)}px`}},Ze=pe=>{if(pe.length===0)return{};const q=pe.map(Fe=>({id:Fe.id,start:ue(Fe.start_time),end:ue(Fe.start_time)+(Fe.duration||60)})).sort((Fe,gt)=>Fe.start-gt.start),ye=[];let Re=[],_e=-1;q.forEach(Fe=>{Re.length===0?(Re.push(Fe),_e=Fe.end):Fe.start<_e?(Re.push(Fe),_e=Math.max(_e,Fe.end)):(ye.push(Re),Re=[Fe],_e=Fe.end)}),Re.length>0&&ye.push(Re);const it={};return ye.forEach(Fe=>{const gt=[];Fe.forEach(Zt=>{let nn=!1;for(let rn=0;rn<gt.length;rn++){const vn=gt[rn],Gn=vn[vn.length-1];if(Zt.start>=Gn.end){vn.push(Zt),nn=!0;break}}nn||gt.push([Zt])});const Ft=100/gt.length,Ut={},Kt=[];Fe.forEach(Zt=>{let nn=!1;for(let rn=0;rn<Kt.length;rn++){const vn=Kt[rn],Gn=vn[vn.length-1];if(Zt.start>=Gn.end){vn.push(Zt),Ut[Zt.id]=rn,nn=!0;break}}nn||(Kt.push([Zt]),Ut[Zt.id]=Kt.length-1)}),Fe.forEach(Zt=>{const nn=Ut[Zt.id];it[Zt.id]={left:`${nn*Ft}%`,width:`${Ft}%`}})}),it},[xe,ct]=x.useState(null),dt=x.useRef(xe);x.useEffect(()=>{dt.current=xe},[xe]);const ft=x.useRef(null),de=x.useRef(null),ve=()=>{de.current&&(window.removeEventListener("touchmove",de.current.move),window.removeEventListener("touchend",de.current.end),window.removeEventListener("touchcancel",de.current.end),de.current=null)},tt=(pe,q,ye)=>{var Ut;if(C&&(ye==="move"||ye==="resize")&&!((Ut=q.tags)==null?void 0:Ut.some(Zt=>{var rn;const nn=te.find(vn=>vn.id===Zt);return(rn=nn==null?void 0:nn.name)==null?void 0:rn.includes("-Wei")})))return;const Re=pe.touches[0],_e=Re.clientX,it=Re.clientY,Fe=ue(q.start_time),gt=q.duration||60;ft.current&&clearTimeout(ft.current);const Pt=()=>{ft.current&&(clearTimeout(ft.current),ft.current=null),window.removeEventListener("touchmove",Ft),window.removeEventListener("touchend",Pt),window.removeEventListener("touchcancel",Pt)},Ft=Kt=>{const Zt=Kt.touches[0].clientX,nn=Kt.touches[0].clientY;(Math.abs(Zt-_e)>10||Math.abs(nn-it)>10)&&Pt()};ft.current=setTimeout(()=>{navigator.vibrate&&navigator.vibrate(50),Pt(),ve(),ct({taskId:q.id,initialY:it,originalStartMin:Fe,originalDuration:gt,type:ye,currentStartMin:Fe,currentDuration:gt,isTouch:!0});const Kt=nn=>{nn.cancelable&&nn.preventDefault();const vn=(nn.touches?nn.touches[0].clientY:0)-it,Gn=Math.round(vn/fs*60/15)*15;if(ye==="move"){let Gr=Fe+Gn;Gr=Math.max(0,Math.min(1440-gt,Gr)),ct(ls=>ls?{...ls,currentStartMin:Gr}:null)}else{let Gr=gt+Gn;Gr=Math.max(15,Gr),ct(ls=>ls?{...ls,currentDuration:Gr}:null)}},Zt=()=>{try{const nn=dt.current;if(nn&&nn.taskId===q.id){const{currentStartMin:rn,currentDuration:vn}=nn,Gn=Te(q);if(!Gn.canEdit){d==null||d({msg:Gn.reason||"",type:"error"});return}const Gr=Ne(rn),ls=Ne(rn+vn),xn=new Date(g);xn.setHours(Math.floor(rn/60)),xn.setMinutes(rn%60);const di={start_time:Gr,duration:vn,end_time:ls,start_date:xn.toISOString()};i(q.id,di),C&&T(no=>no.map(cs=>cs.id===q.id?{...cs,...di}:cs))}}finally{ct(null),ve()}};de.current={move:Kt,end:Zt},window.addEventListener("touchmove",Kt,{passive:!1}),window.addEventListener("touchend",Zt),window.addEventListener("touchcancel",Zt)},1e3),window.addEventListener("touchmove",Ft),window.addEventListener("touchend",Pt),window.addEventListener("touchcancel",Pt)},st=(pe,q,ye)=>{var _e;if(pe.stopPropagation(),pe.preventDefault(),C&&(ye==="move"||ye==="resize")&&!((_e=q.tags)==null?void 0:_e.some(Fe=>{var Pt;const gt=te.find(Ft=>Ft.id===Fe);return(Pt=gt==null?void 0:gt.name)==null?void 0:Pt.includes("-Wei")}))){d==null||d({msg:" Wei",type:"error"});return}const Re=ue(q.start_time);ct({taskId:q.id,initialY:pe.clientY,originalStartMin:Re,originalDuration:q.duration||60,type:ye,currentStartMin:Re,currentDuration:q.duration||60})},ht=(pe,q)=>{pe.dataTransfer.setData("text/plain",q.id),pe.dataTransfer.setData("from-allday","true")},Xe=async pe=>{pe.preventDefault();const q=pe.dataTransfer.getData("text/plain");if(pe.dataTransfer.getData("from-allday"),!q)return;const ye=pe.currentTarget.getBoundingClientRect(),Re=pe.currentTarget.scrollTop||0,_e=pe.clientY-ye.top+Re,it=Math.floor(_e/fs*60/15)*15,Fe=(C?S:r).find(Ft=>Ft.id===q),gt=(Fe==null?void 0:Fe.duration)||60,Pt=new Date(g);Pt.setHours(Math.floor(it/60)),Pt.setMinutes(it%60),await ee.updateTask(q,{start_date:Pt.toISOString(),start_time:Ne(it),end_time:Ne(it+gt),duration:gt,is_all_day:!1})},At=async pe=>{pe.preventDefault();const q=pe.dataTransfer.getData("text/plain");q&&await ee.updateTask(q,{start_date:g.toISOString(),is_all_day:!0,start_time:null,end_time:null,duration:null})},jt=pe=>{pe.preventDefault(),pe.dataTransfer.dropEffect="move"},Q=pe=>{G(null);const q=pe.currentTarget.getBoundingClientRect(),ye=pe.clientY-q.top,Re=Math.floor(ye/fs*60/15)*15;if(window.innerWidth<768){const _e=new Date(g);_e.setHours(Math.floor(Re/60)),_e.setMinutes(Re%60);const it=$e(),Fe=it?[it.id]:[],gt={id:"new",title:"",start_time:Ne(Re),duration:60,end_time:Ne(Re+60),start_date:Os(g,"yyyy-MM-dd"),is_all_day:!1,tags:Fe};I(gt),l("new");return}H({startY:pe.clientY,startMin:Re,currentDuration:60})};x.useEffect(()=>{if((!xe||xe.isTouch)&&!P)return;const pe=gt=>{if(xe){const Pt=gt-xe.initialY,Ft=Math.round(Pt/fs*60/15)*15;if(xe.type==="move"){let Ut=xe.originalStartMin+Ft;Ut=Math.max(0,Math.min(1440-xe.currentDuration,Ut)),ct(Kt=>Kt?{...Kt,currentStartMin:Ut}:null)}else{let Ut=xe.originalDuration+Ft;Ut=Math.max(15,Ut),ct(Kt=>Kt?{...Kt,currentDuration:Ut}:null)}}else if(P){const Pt=gt-P.startY;let Ut=60+Math.round(Pt/fs*60/15)*15;Ut<15&&(Ut=15),H(Kt=>Kt?{...Kt,currentDuration:Ut}:null)}},q=()=>{if(xe){const{taskId:gt,currentStartMin:Pt,currentDuration:Ft}=xe,Ut=(C?S:r).find(vn=>vn.id===gt);if(Ut){const vn=Te(Ut);if(!vn.canEdit){d==null||d({msg:vn.reason||"",type:"error"}),ct(null);return}}const Kt=Ne(Pt),Zt=Ne(Pt+Ft),nn=new Date(g);nn.setHours(Math.floor(Pt/60)),nn.setMinutes(Pt%60);const rn={start_time:Kt,duration:Ft,end_time:Zt,start_date:nn.toISOString()};i(gt,rn),C&&T(vn=>vn.map(Gn=>Gn.id===gt?{...Gn,...rn}:Gn)),ct(null)}else if(P){const gt=new Date(g);gt.setHours(Math.floor(P.startMin/60)),gt.setMinutes(P.startMin%60);const Pt=$e(),Ft=Pt?[Pt.id]:[],Ut={id:"new",title:"",start_time:Ne(P.startMin),duration:P.currentDuration,end_time:Ne(P.startMin+P.currentDuration),start_date:gt.toISOString(),is_all_day:!1,tags:Ft};I(Ut),l("new"),H(null)}},ye=gt=>pe(gt.clientY),Re=()=>q(),_e=gt=>{gt.cancelable&&gt.preventDefault(),pe(gt.touches[0].clientY)},it=()=>q(),Fe=()=>q();return window.addEventListener("mousemove",ye),window.addEventListener("mouseup",Re),window.addEventListener("touchmove",_e,{passive:!1}),window.addEventListener("touchend",it),window.addEventListener("touchcancel",Fe),()=>{window.removeEventListener("mousemove",ye),window.removeEventListener("mouseup",Re),window.removeEventListener("touchmove",_e),window.removeEventListener("touchend",it),window.removeEventListener("touchcancel",Fe)}},[xe,P,g,i,C,s]);const me=x.useRef(null),He=x.useRef({x:0,y:0}),J=x.useRef(!1),Pe=x.useRef(0),ze=x.useRef(60),mt=pe=>{ve(),xe&&ct(null),G(null)},Wt=pe=>{const q=pe.touches[0];if(J.current&&Je.current){const _e=Je.current.getBoundingClientRect(),it=Je.current.scrollTop;let Pt=(q.clientY-_e.top+it)/fs*60-Pe.current;Pt<15&&(Pt=15),Pt=Math.round(Pt/15)*15,ze.current=Pt,H(Ft=>Ft&&{...Ft,currentDuration:Pt});return}const ye=Math.abs(q.clientX-He.current.x),Re=Math.abs(q.clientY-He.current.y);(ye>10||Re>10)&&me.current&&(clearTimeout(me.current),me.current=null)},Dn=()=>{if(me.current&&(clearTimeout(me.current),me.current=null),J.current){J.current=!1;const pe=Pe.current,q=ze.current,ye=Ne(pe),Re=Ne(pe+q),_e=te.find(Fe=>Fe.name.includes("-Wei"))||te.find(Fe=>Fe.name.toLowerCase().includes("wei")&&!Fe.name.toLowerCase().includes("google")),it=_e?[_e.id]:[];I({title:"",start_time:ye,end_time:Re,start_date:Os(g,"yyyy-MM-dd"),duration:q,is_all_day:!1,tags:it}),l("new"),H(null)}},Ht=async()=>{se(!0);const pe=et;if(pe.length===0&&!confirm("")){se(!1);return}const q=pe.map(Kt=>({id:Kt.id,title:Kt.title,start_time:Kt.start_time,end_time:Kt.end_time,status:Kt.status,tags:Kt.tags,duration:Kt.duration,start_date:Kt.start_date})),ye=new Set(q.flatMap(Kt=>Kt.tags||[])),Re=s.find(Kt=>Kt.name.includes("-Wei"));Re&&ye.add(Re.id);const _e=s.filter(Kt=>ye.has(Kt.id)).map(Kt=>({id:Kt.id,name:Kt.name,color:Kt.color}));if(a&&be)try{const Kt=Os(g,"yyyy-MM-dd"),{data:Zt,error:nn}=await be.from("schedule_snapshots").insert({data:{tasks:q,tags:_e,date:Kt},created_by:a.id,title:`Heart Schedule - ${Kt}`}).select("id").single();if(Zt&&!nn){const rn=`${window.location.origin}/share/heart/s/${Zt.id}`;F(rn),navigator.clipboard.writeText(rn).catch(()=>console.warn("Auto-copy failed")),se(!1);return}else console.error("Snapshot Creation Error:",nn)}catch(Kt){console.error("Snapshot Exception:",Kt)}const it=JSON.stringify(_e),Fe=encodeURIComponent(it),gt=JSON.stringify(q),Pt=encodeURIComponent(gt),Ft=Os(g,"yyyy-MM-dd"),Ut=`${window.location.origin}/share/heart/${(a==null?void 0:a.id)||"share"}?date=${Ft}&d=${Pt}&tags=${Fe}`;F(Ut),navigator.clipboard.writeText(Ut).catch(()=>{}),se(!1)},cn=x.useMemo(()=>{const pe=It.map(q=>xe&&xe.taskId===q.id?{...q,start_time:Ne(xe.currentStartMin),duration:xe.currentDuration}:q);return Ze(pe)},[It,xe]);return c.jsxs("div",{className:"fixed inset-0 z-[1000] bg-white/95 backdrop-blur-xl flex flex-col overflow-hidden font-sans text-gray-800",children:[c.jsx("div",{className:"absolute top-0 right-0 w-[50vh] h-[50vh] bg-pink-200/20 rounded-full blur-[100px] pointer-events-none"}),c.jsx("div",{className:"absolute bottom-0 left-0 w-[50vh] h-[50vh] bg-purple-200/20 rounded-full blur-[100px] pointer-events-none"}),c.jsxs("header",{className:"flex-shrink-0 px-3 py-2 md:px-6 md:py-4 flex items-center justify-between relative z-10 bg-white/50 backdrop-blur-sm border-b border-pink-100",children:[!e&&t&&c.jsx("button",{onClick:t,className:"p-1 md:p-2 rounded-full hover:bg-gray-100 text-gray-500",children:c.jsx(hn,{size:18,className:"md:w-5 md:h-5"})}),e&&c.jsx("div",{className:"w-8 md:w-10"}),c.jsxs("div",{className:"flex bg-gray-100/50 p-1 rounded-full items-center",children:[c.jsxs("button",{onClick:()=>b("schedule"),className:`
                            flex items-center gap-1 md:gap-2 px-3 py-1.5 rounded-full transition-all text-sm font-bold
                            ${y==="schedule"?"bg-white shadow-sm text-pink-500":"text-gray-400 hover:text-gray-600"}
                        `,children:[c.jsx(ou,{size:16,className:y==="schedule"?"fill-pink-500":""}),c.jsx("span",{className:y==="schedule"?"":"hidden md:inline",children:""})]}),c.jsxs("button",{onClick:()=>b("moments"),className:`
                            flex items-center gap-1 md:gap-2 px-3 py-1.5 rounded-full transition-all text-sm font-bold
                            ${y==="moments"?"bg-white shadow-sm text-purple-600":"text-gray-400 hover:text-gray-600"}
                        `,children:[c.jsx(CI,{size:16,className:y==="moments"?"fill-purple-200 text-purple-600":""}),c.jsx("span",{className:y==="moments"?"":"hidden md:inline",children:""})]})]}),c.jsxs("div",{className:"flex items-center gap-1 md:gap-2 hidden",children:[c.jsx(ou,{className:"text-pink-500 fill-pink-500 animate-pulse md:w-6 md:h-6",size:20}),c.jsx("span",{className:"hidden md:inline text-lg font-bold tracking-wide bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent",children:"Our Time"}),c.jsx("span",{className:"md:hidden text-base font-bold text-pink-500",children:"Our Time"})]}),c.jsxs("div",{className:"flex gap-1 md:gap-2 items-center",children:[C&&c.jsxs("button",{onClick:()=>{O(!1),window.history.replaceState({},"",window.location.pathname)},className:"text-[10px] md:text-xs bg-amber-100 text-amber-700 px-2 py-0.5 md:px-3 md:py-1 rounded-full font-medium whitespace-nowrap",children:[c.jsx("span",{className:"md:hidden",children:""}),c.jsx("span",{className:"hidden md:inline",children:" ()"})]}),c.jsx("button",{onClick:()=>ie(),disabled:!Z,className:`p-1 md:p-2 rounded-full transition-colors ${Z?"hover:bg-gray-100 text-gray-700":"text-gray-300 cursor-not-allowed"}`,title:" (Ctrl+Z)",children:c.jsx(Dg,{size:16,className:"md:w-[18px] md:h-[18px]"})}),c.jsx("button",{onClick:()=>ce(),disabled:!ne,className:`p-1 md:p-2 rounded-full transition-colors ${ne?"hover:bg-gray-100 text-gray-700":"text-gray-300 cursor-not-allowed"}`,title:" (Ctrl+Shift+Z)",children:c.jsx(Mw,{size:16,className:"md:w-[18px] md:h-[18px]"})}),c.jsx("button",{onClick:()=>A(!k),className:`p-1 md:p-2 rounded-full transition-colors ${k?"bg-pink-100 text-pink-600":"hover:bg-gray-100 text-gray-500"}`,children:c.jsx(HI,{size:18,className:"md:w-5 md:h-5"})}),c.jsx("button",{onClick:()=>E(!0),className:"p-1 md:p-2 rounded-full bg-pink-50 text-pink-500 hover:bg-pink-100",children:c.jsx(Bz,{size:18,className:"md:w-5 md:h-5"})})]})]}),y==="schedule"?c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex items-center justify-between px-6 py-2 relative z-10 bg-white/30 backdrop-blur-sm border-b border-gray-100",children:[c.jsx("button",{onClick:()=>v(xne(g,1)),className:"p-1 text-gray-400 hover:text-pink-500",children:c.jsx(Ou,{size:18})}),c.jsxs("div",{className:"text-center cursor-pointer",onClick:()=>v(new Date),children:[c.jsx("div",{className:"text-lg font-bold text-gray-800",children:Os(g,"M d",{locale:bE})}),c.jsx("div",{className:"text-[10px] text-pink-500 font-medium tracking-widest uppercase",children:Os(g,"EEEE",{locale:bE})}),(()=>{const pe=NR(g);return pe?c.jsxs("div",{className:"text-[10px] text-amber-600 font-bold mt-0.5 tracking-wide",children:[" ",pe]}):null})()]}),c.jsx("button",{onClick:()=>v(OR(g,1)),className:"p-1 text-gray-400 hover:text-pink-500",children:c.jsx(is,{size:18})})]}),c.jsx(ko,{children:k&&c.jsx(Lr.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"overflow-hidden border-b border-gray-100 bg-gray-50/80 backdrop-blur",children:c.jsxs("div",{className:"p-4",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-2 font-medium",children:""}),c.jsx("div",{className:"flex flex-wrap gap-2",children:te.map(pe=>c.jsx("button",{onClick:()=>Oe(pe.id),className:`px-3 py-1 rounded-full text-xs transition-all border ${_.includes(pe.id)?"bg-pink-500 text-white border-pink-500 shadow-md transform scale-105":"bg-white text-gray-600 border-gray-200"}`,children:pe.name},pe.id))})]})})}),c.jsxs("div",{ref:Je,className:"flex-1 overflow-y-auto relative z-0 hide-scrollbar scroll-smooth",children:[xt.length>0&&c.jsxs("div",{className:"sticky top-0 z-30 bg-gradient-to-b from-pink-50/90 to-purple-50/90 backdrop-blur-md border-b-2 border-pink-200/50 px-6 py-2",onDragOver:jt,onDrop:At,onDoubleClick:async()=>{const pe=await ee.addTask({title:"",start_date:g.toISOString(),is_all_day:!0,status:"inbox"});l(pe)},children:[c.jsxs("div",{className:"text-[10px] font-bold text-pink-600 uppercase tracking-wider flex items-center gap-1.5 cursor-pointer select-none",onClick:()=>Ee(!R),children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-pink-500"}),"",c.jsx("span",{className:"text-pink-400 ml-auto",children:R?c.jsx(yp,{size:14}):c.jsx(rs,{size:14})})]}),R&&c.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:xt.map(pe=>{var ye;const q=((ye=s.find(Re=>{var _e;return(_e=pe.tags)==null?void 0:_e.includes(Re.id)}))==null?void 0:ye.color)||"#ec4899";return c.jsx("div",{draggable:!0,onDragStart:Re=>ht(Re,pe),onClick:()=>{const Re=Te(pe);if(!Re.canEdit){d==null||d({msg:Re.reason||"",type:"error"});return}l(pe.id)},className:"group relative px-3 py-1.5 rounded-full text-xs font-medium cursor-pointer transition-all hover:shadow-md hover:scale-105 border-2",style:{backgroundColor:q+"20",borderColor:q+"60",color:q},children:c.jsxs("div",{className:"flex items-center gap-1.5",children:[pe.status==="completed"&&c.jsx(bf,{size:12,className:"flex-shrink-0"}),c.jsx("span",{className:"truncate max-w-[200px]",children:pe.title||"()"})]})},pe.id)})})]}),c.jsxs("div",{className:"relative min-h-[1536px] w-full bg-white/40 cursor-crosshair",onMouseDown:Q,onTouchStart:mt,onTouchMove:Wt,onTouchEnd:Dn,onDragOver:jt,onDrop:Xe,children:[Array.from({length:24}).map((pe,q)=>c.jsxs("div",{className:"absolute w-full border-t border-gray-100 flex pointer-events-none",style:{top:q*fs,height:fs},children:[c.jsxs("div",{className:"w-14 text-[10px] text-gray-400 font-mono text-right pr-2 -mt-2 select-none",children:[q.toString().padStart(2,"0"),":00"]}),c.jsx("div",{className:"flex-1 border-l border-gray-50 h-full relative",children:c.jsx("div",{className:"absolute top-1/2 w-full border-t border-gray-50 border-dashed"})})]},q)),Qh(new Date,g)&&c.jsx("div",{className:"absolute left-14 right-0 border-t-2 border-red-400 z-20 pointer-events-none flex items-center",style:{top:(new Date().getHours()*60+new Date().getMinutes())/60*fs},children:c.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full -ml-1"})}),P&&c.jsx("div",{className:"absolute left-16 right-2 bg-pink-100/50 border-2 border-pink-400 border-dashed rounded-xl z-30 pointer-events-none",style:{top:`${P.startMin/60*fs}px`,height:`${P.currentDuration/60*fs}px`},children:c.jsxs("div",{className:"p-2 text-xs font-bold text-pink-600",children:[Ne(P.startMin)," - ",Ne(P.startMin+P.currentDuration)," ..."]})}),c.jsx("div",{className:"absolute top-0 right-2 left-16 bottom-0 pointer-events-none",children:It.map(pe=>{const q=(xe==null?void 0:xe.taskId)===pe.id,ye=cn[pe.id],Re=q?{top:`${xe.currentStartMin/60*fs}px`,height:`${xe.currentDuration/60*fs}px`,left:(ye==null?void 0:ye.left)||"0%",width:(ye==null?void 0:ye.width)||"100%",zIndex:50}:{...Ue(pe),left:(ye==null?void 0:ye.left)||"0%",width:(ye==null?void 0:ye.width)||"100%"};let _e="#ec4899";if(pe.tags&&pe.tags.length>0){const Fe=te.filter(Pt=>pe.tags.includes(Pt.id)),gt=Fe.find(Pt=>Pt.name.toLowerCase().includes("google"))||Fe[0];gt&&gt.color&&(_e=gt.color)}const it=pe.status==="completed"?{}:{borderColor:_e,backgroundColor:`${_e}1A`,borderLeftWidth:"4px",borderLeftColor:_e};return c.jsxs("div",{style:{...Re,...it},className:`absolute w-full rounded-r-xl rounded-l-md border p-2 text-xs flex flex-col overflow-hidden transition-all shadow-sm group pointer-events-auto
                                        ${pe.status==="completed"?"bg-gray-50 border-gray-200 opacity-60":"hover:shadow-md"}
                                        ${q?"shadow-xl ring-2 ring-pink-400 opacity-90 cursor-grabbing":"cursor-grab"}
                                        ${K===pe.id?"ring-2 ring-pink-500 z-10 shadow-md":""}
                                    `,onClick:Fe=>{Fe.stopPropagation(),q||G(pe.id)},onDoubleClick:Fe=>{if(Fe.stopPropagation(),!q){const gt=Te(pe);if(!gt.canEdit){d==null||d({msg:gt.reason||"",type:"error"});return}l(pe.id),I(null)}},onMouseDown:Fe=>{const gt=Te(pe);if(!gt.canEdit){Fe.stopPropagation(),Fe.preventDefault(),d==null||d({msg:gt.reason||"",type:"error"});return}st(Fe,pe,"move")},onTouchStart:Fe=>tt(Fe,pe,"move"),children:[K===pe.id&&c.jsx("div",{className:"absolute top-1 right-1 p-1.5 bg-red-500 text-white rounded-full shadow-lg z-50 cursor-pointer transform hover:scale-110 active:scale-95 transition-all",onClick:Fe=>{Fe.stopPropagation();const gt=Te(pe);if(!gt.canEdit){d==null||d({msg:gt.reason||"",type:"error"});return}ee.deleteTask(pe.id),G(null)},children:c.jsx(jr,{size:14})}),c.jsxs("div",{className:"flex items-start gap-1 font-bold text-gray-800 w-full",children:[c.jsx("div",{className:"w-2 h-2 rounded-full mt-1 shrink-0",style:{backgroundColor:pe.status==="completed"?"#9ca3af":_e}}),c.jsx("span",{className:"whitespace-normal break-words leading-tight w-full",children:pe.title}),pe.status==="completed"&&c.jsx(bf,{size:12,className:"text-gray-400 shrink-0 mt-0.5"})]}),c.jsx("div",{className:"text-[10px] text-gray-500 truncate shrink-0 font-mono",children:q?`${Ne(xe.currentStartMin)} - ${Ne(xe.currentStartMin+xe.currentDuration)}`:`${pe.start_time} - ${pe.end_time||Ne(ue(pe.start_time)+(pe.duration||60))}`}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-3 cursor-ns-resize flex items-center justify-center opacity-0 group-hover:opacity-100 hover:bg-black/5",onMouseDown:Fe=>{const gt=Te(pe);if(!gt.canEdit){Fe.stopPropagation(),Fe.preventDefault(),d==null||d({msg:gt.reason||"",type:"error"});return}st(Fe,pe,"resize")},onTouchStart:Fe=>{const gt=Te(pe);if(!gt.canEdit){Fe.stopPropagation(),Fe.preventDefault(),d==null||d({msg:gt.reason||"",type:"error"});return}Fe.stopPropagation(),tt(Fe,pe,"resize")},children:c.jsx(MI,{size:12,className:"text-gray-400"})})]},pe.id)})}),xt.length===0&&It.length===0&&!P&&c.jsxs("div",{className:"absolute top-1/3 left-0 right-0 text-center text-gray-400 pointer-events-none",children:[c.jsx(ou,{size:48,className:"mx-auto mb-2 opacity-20"}),c.jsxs("p",{children:["",c.jsx("br",{}),c.jsx("span",{className:"text-xs opacity-50",children:""})]})]})]})]}),c.jsx("div",{className:"md:hidden fixed bottom-6 right-6 z-[900]",children:c.jsx("button",{onClick:()=>{const pe="08:00",q="09:00",ye=$e(),Re=ye?[ye.id]:[];I({title:"",start_time:pe,end_time:q,start_date:Os(g,"yyyy-MM-dd"),duration:60,is_all_day:!1,tags:Re}),l("new")},className:"w-14 h-14 bg-pink-500 rounded-full shadow-lg flex items-center justify-center text-white active:scale-95 transition-transform",children:c.jsx(ri,{size:28})})})]}):c.jsx("div",{className:"flex-1 overflow-y-auto relative custom-scrollbar",children:c.jsx(One,{tasks:ee.tasks,tags:ee.tags,isGuest:C,onAddTask:Se,onUpdateTask:Ie,onDeleteTask:fe,scrollRef:w})}),c.jsx(ko,{children:N&&c.jsx("div",{className:"fixed inset-0 z-[1100] bg-black/40 backdrop-blur-sm flex items-center justify-center p-4",children:c.jsxs(Lr.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl",children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsx("h3",{className:"text-xl font-bold",children:""}),c.jsx("button",{onClick:()=>{E(!1),F(null)},children:c.jsx(hn,{size:20})})]}),ge?c.jsxs("div",{className:"space-y-4",children:[c.jsx("div",{className:"bg-green-50 text-green-700 p-3 rounded-lg text-sm text-center",children:""}),c.jsxs("div",{className:"relative",children:[c.jsx("input",{type:"text",value:ge,readOnly:!0,className:"w-full bg-gray-50 border border-gray-200 rounded-lg py-2 px-3 text-sm text-gray-600 pr-10",onClick:pe=>pe.currentTarget.select()}),c.jsx("button",{onClick:()=>{navigator.clipboard.writeText(ge),d==null||d({msg:"",type:"success"})},className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-900",children:c.jsx(d2,{size:16})})]}),c.jsx("button",{onClick:()=>{navigator.clipboard.writeText(ge),d==null||d({msg:"",type:"success"})},className:"w-full py-3 bg-gray-900 text-white rounded-xl font-medium",children:""})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"bg-pink-50 rounded-xl p-4 flex flex-col items-center mb-6",children:c.jsxs("p",{className:"text-center text-sm text-gray-600",children:["",c.jsx("br",{}),""]})}),c.jsx("button",{onClick:Ht,disabled:B,className:"w-full py-3 bg-gray-900 text-white rounded-xl font-medium flex items-center justify-center gap-2 disabled:opacity-50",children:B?c.jsx(c.Fragment,{children:"..."}):c.jsxs(c.Fragment,{children:[c.jsx(d2,{size:18})," "]})})]})]})})}),u&&c.jsx(jn.Provider,{value:ee,children:c.jsx("div",{className:"absolute inset-0 z-[1200]",children:c.jsx(xb,{initialData:u==="new"?M:C?S.find(pe=>pe.id===u):r.find(pe=>pe.id===u),onClose:()=>{l(null),I(null)}})})})]})},dre=()=>{const{user:t,logout:e,syncStatus:n,view:r,setView:s,tagFilter:i,setTagFilter:o,tasks:a,tags:l,toast:u,setToast:d,undo:f,redo:h,canUndo:p,canRedo:m,canNavigateBack:y,navigateBack:b,archiveCompletedTasks:g,editingTaskId:v,setEditingTaskId:w,themeSettings:_,sidebarWidth:D,setSidebarWidth:k,sidebarCollapsed:A,selectedTaskIds:N,dragState:E}=x.useContext(jn),[S,T]=x.useState(!1),[C,O]=x.useState(!1),[P,H]=x.useState(!1),[M,I]=x.useState(!1),[K,G]=x.useState(!1),[R,Ee]=x.useState(!1),[ge,F]=x.useState(!1),[B,se]=x.useState(typeof window<"u"&&window.innerWidth<768);x.useEffect(()=>{const X=()=>se(window.innerWidth<768);return window.addEventListener("resize",X),()=>window.removeEventListener("resize",X)},[]);const[We,ut]=x.useState(()=>{const X=localStorage.getItem("fabPosition");return X?JSON.parse(X):{x:window.innerWidth-80,y:window.innerHeight-80}}),[oe,je]=x.useState(!1),te=x.useRef({x:0,y:0});x.useEffect(()=>{const X=ie=>{if(oe){const ce=Math.max(20,Math.min(window.innerWidth-70,ie.clientX-te.current.x)),Z=Math.max(20,Math.min(window.innerHeight-70,ie.clientY-te.current.y));ut({x:ce,y:Z})}},ee=()=>{oe&&(je(!1),localStorage.setItem("fabPosition",JSON.stringify(We)))};return window.addEventListener("mousemove",X),window.addEventListener("mouseup",ee),()=>{window.removeEventListener("mousemove",X),window.removeEventListener("mouseup",ee)}},[oe,We]);const $e={small:"text-sm",normal:"text-base",large:"text-lg"}[_.fontSize]||"text-base",Te=_.fontWeight==="thin"?"font-light":"font-bold",Je=_.fontFamily==="things"?"font-things":"font-sans",Ye=v?a.find(X=>X.id===v):null;x.useEffect(()=>{const X=ee=>{ee.key==="k"&&(ee.metaKey||ee.ctrlKey)&&(ee.preventDefault(),T(ie=>!ie)),ee.key==="Escape"&&(v?w(null):R?Ee(!1):T(!1)),(ee.metaKey||ee.ctrlKey)&&ee.shiftKey&&ee.code==="KeyM"&&N.length>0&&(ee.preventDefault(),Ee(!0))};return window.addEventListener("keydown",X),()=>window.removeEventListener("keydown",X)},[v,w,N,R]),x.useEffect(()=>{const X=ie=>{if(!C)return;let ce=ie.clientX;ce<150&&(ce=150),ce>400&&(ce=400),k(ce)},ee=()=>{O(!1),document.body.style.cursor="default"};return C&&(window.addEventListener("mousemove",X),window.addEventListener("mouseup",ee),document.body.style.cursor="col-resize"),()=>{window.removeEventListener("mousemove",X),window.removeEventListener("mouseup",ee)}},[C]);const Ke=()=>{var X;return i?((X=l.find(ee=>ee.id===i))==null?void 0:X.name)||"Tags":r==="focus"?"Focus":r.charAt(0).toUpperCase()+r.slice(1)},lt=E!=null&&E.draggedId?a.find(X=>X.id===E.draggedId):null,St=N.includes((E==null?void 0:E.draggedId)||"")?N.length:1;return c.jsxs("div",{"data-theme":_.themeMode&&_.themeMode!=="light"?_.themeMode:void 0,className:`flex h-screen bg-theme-main text-theme-primary ${Je} selection:bg-indigo-50 selection:text-indigo-900`,children:[(E==null?void 0:E.isDragging)&&lt&&c.jsx(ite,{task:lt,position:E.ghostPosition,count:St}),c.jsxs("div",{style:{width:A?64:D},className:`relative flex-shrink-0 hidden md:block transition-all duration-300 ease-in-out ${E!=null&&E.isDragging,"z-10"}`,children:[c.jsx(lE,{view:r,setView:s,tagFilter:i,setTagFilter:o}),!A&&!(E!=null&&E.isDragging)&&c.jsx("div",{className:"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-theme-main/10 transition-colors z-50",onMouseDown:()=>O(!0)})]}),P&&c.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 md:hidden",onClick:()=>H(!1),children:c.jsx("div",{className:"absolute left-0 top-0 h-full w-[280px] bg-theme-sidebar shadow-2xl animate-in slide-in-from-left duration-200",onClick:X=>X.stopPropagation(),children:c.jsx(lE,{view:r,setView:X=>{s(X),H(!1)},tagFilter:i,setTagFilter:X=>{o(X),H(!1)}})})}),c.jsxs("main",{className:"flex-1 flex flex-col relative overflow-hidden bg-theme-main",children:[c.jsxs("header",{"data-app-header":"true",className:"h-14 flex items-center justify-between px-4 md:px-8 border-b border-theme z-30 sticky top-0 bg-theme-header backdrop-blur-sm",children:[c.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[c.jsx("button",{className:"md:hidden p-1 -ml-2 text-theme-secondary hover:bg-theme-hover rounded",onClick:()=>H(!0),children:c.jsx(Dz,{size:20})}),y&&c.jsxs("button",{onClick:b,className:"p-1 hover:bg-theme-hover rounded text-theme-secondary flex items-center gap-1 text-sm font-medium transition-colors",title:" (Alt + Left)",children:[c.jsx(jI,{size:16}),c.jsx("span",{className:"hidden md:inline",children:""})]}),y&&c.jsx("span",{className:"text-theme-secondary",children:"|"}),c.jsx("h2",{className:`${$e} ${Te} tracking-tight text-theme-primary`,children:Ke()})]}),c.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[N.length===1&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:()=>I(!0),className:"p-1.5 rounded hover:bg-indigo-500/10 text-indigo-400 transition-colors animate-in zoom-in duration-200 flex items-center gap-1",title:"72 (Mission 72 Transformations)",children:[c.jsx("span",{className:"text-xl leading-none filter drop-shadow-sm",children:""}),c.jsx("span",{className:"hidden lg:inline text-xs font-bold text-indigo-400",children:"72"})]}),c.jsxs("button",{onClick:()=>G(!0),className:"p-1.5 rounded hover:bg-amber-500/10 text-amber-500 transition-colors animate-in zoom-in duration-200 flex items-center gap-1",title:"GTD ",children:[c.jsx("span",{className:"text-xl leading-none filter drop-shadow-sm",children:""}),c.jsx("span",{className:"hidden lg:inline text-xs font-bold text-amber-600",children:""})]})]}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1"}),c.jsxs("button",{onClick:g,className:"p-1.5 rounded hover:bg-theme-hover text-theme-tertiary hover:text-emerald-500 transition-colors",title:" (Archive Completed)",children:[" ",c.jsx(am,{size:16})," "]}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1"}),c.jsx("button",{disabled:!p,onClick:f,className:`p-1 rounded hover:bg-theme-hover ${p?"opacity-100":"opacity-30"}`,title:" (Ctrl+Z)",children:c.jsx(Dg,{size:14})}),c.jsx("button",{disabled:!m,onClick:h,className:`p-1 rounded hover:bg-theme-hover ${m?"opacity-100":"opacity-30"}`,title:" (Ctrl+Shift+Z)",children:c.jsx(Mw,{size:14})}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1"}),c.jsxs("div",{className:`flex items-center ${(t==null?void 0:t.email)==="bibo1243@gmail.com"?"":"hidden"}`,children:[c.jsx("button",{onClick:()=>F(!0),className:"p-1.5 rounded-full hover:bg-pink-50 text-pink-400 hover:text-pink-600 transition-colors",title:" (Shared Schedule)",children:c.jsx(ou,{size:18,className:ge?"fill-pink-500 text-pink-500":""})}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1 inline-block"})]}),c.jsx(dte,{})]}),c.jsxs("div",{className:"flex items-center gap-1.5 pl-2 border-l border-theme ml-1",children:[c.jsxs("div",{className:"hidden md:flex flex-col items-end group relative",children:[c.jsx("span",{className:"text-[9px] text-theme-tertiary uppercase tracking-wider font-bold leading-none mb-0.5",children:"User"}),c.jsx("span",{className:"text-[10px] font-mono text-theme-secondary leading-none cursor-help",title:(t==null?void 0:t.id)||"Loading...",children:(t==null?void 0:t.email)||((t==null?void 0:t.id)==="00000000-0000-0000-0000-000000000000"?"Demo":t!=null&&t.id?`ID: ${t.id.slice(0,6)}...`:"Loading...")})]}),c.jsxs("div",{className:"w-6 h-6 rounded-full bg-indigo-500/20 text-indigo-400 flex items-center justify-center border border-indigo-500/30 relative group cursor-pointer",title:" (Logout)",onClick:e,children:[c.jsx(KI,{size:12,className:"group-hover:hidden"}),c.jsx(Iz,{size:12,className:"hidden group-hover:block text-red-500"})]})]}),c.jsxs("div",{className:`flex items-center gap-1 text-[10px] ml-1 ${n==="synced"?"text-green-500":n==="error"?"text-red-500":"text-orange-400"}`,children:[n==="synced"?c.jsx(lz,{size:12}):c.jsx(az,{size:12,className:"animate-pulse"}),c.jsx("span",{className:"uppercase tracking-wider hidden lg:inline",children:n==="synced"?"Synced":n==="error"?"Error":"Syncing..."})]}),n==="error"&&c.jsx("div",{className:"text-[10px] text-red-500 flex items-center gap-1",children:c.jsx(Jf,{size:12})})]})]}),c.jsx(ete,{}),c.jsx("div",{className:`flex-1 overflow-y-auto scroll-smooth no-scrollbar prevent-pull-refresh ${r!=="focus"&&r!=="project"&&r!=="annualplan"?"p-2 md:p-4":""}`,children:r==="journal"?c.jsx(Fee,{}):r==="focus"?c.jsx(qee,{}):r==="project"?c.jsx(Xee,{}):r==="annualplan"?c.jsx(Zee,{}):r==="matrix"?c.jsx(rte,{}):r==="worklog"?c.jsx(ste,{}):c.jsx("div",{className:"w-full md:w-[calc(100%-100px)] mx-auto mt-2 md:mt-8",children:c.jsx(TR,{})})}),v&&(r==="calendar"||r==="journal"||r==="focus"||r==="matrix")&&Ye&&c.jsx(xb,{initialData:Ye,onClose:()=>w(null)}),c.jsx("button",{onMouseDown:X=>{te.current={x:X.clientX-We.x,y:X.clientY-We.y};const ee=X.clientX,ie=X.clientY,ce=Z=>{(Math.abs(Z.clientX-ee)>5||Math.abs(Z.clientY-ie)>5)&&(je(!0),window.removeEventListener("mousemove",ce))};window.addEventListener("mousemove",ce),window.addEventListener("mouseup",()=>window.removeEventListener("mousemove",ce),{once:!0})},onClick:()=>{oe||T(!0)},style:{left:We.x,top:We.y},className:`fixed z-40 h-14 w-14 rounded-full bg-indigo-600 text-white shadow-xl hover:bg-indigo-700 transition-all flex items-center justify-center group fab-mobile md:hidden ${oe?"cursor-grabbing scale-110":"cursor-grab hover:scale-105 active:scale-95"}`,title:"Create New Task (Drag to move)",children:c.jsx(ri,{size:28,className:"group-hover:rotate-90 transition-transform duration-200"})}),S&&!B&&c.jsx(xb,{onClose:()=>T(!1)}),S&&B&&c.jsx(yb,{taskId:void 0,onClose:()=>T(!1)}),M&&N.length===1&&c.jsx(nte,{taskId:N[0],onClose:()=>I(!1)}),K&&N.length===1&&c.jsx(hte,{taskId:N[0],onClose:()=>G(!1)}),u&&c.jsx(tte,{toast:u,onClose:()=>d(null)}),v&&B&&c.jsx(yb,{taskId:v,onClose:()=>w(null)}),R&&c.jsx(ate,{onClose:()=>Ee(!1)}),ge&&c.jsx(UR,{onClose:()=>F(!1)})]})]})},fre=()=>{const[t,e]=x.useState(!1),[n,r]=x.useState(""),[s,i]=x.useState(""),[o,a]=x.useState("signin"),[l,u]=x.useState(null),[d,f]=x.useState(null),h=async p=>{p.preventDefault(),e(!0),u(null),f(null);let m=n,y=s;n.toLowerCase()==="demo"&&s.toLowerCase()==="demo"&&(m="demo@demo.com",y="demodemo");try{if(!be)throw new Error("Supabase client not initialized");if(o==="signup"){const{data:b,error:g}=await be.auth.signUp({email:m,password:y});if(g)throw g;b.session?(f("..."),setTimeout(()=>{window.location.reload()},500)):b.user&&!b.session&&f("")}else{const{error:b}=await be.auth.signInWithPassword({email:m,password:y});if(b)throw b;window.location.reload()}}catch(b){u(b.message)}finally{e(!1)}};return c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:c.jsxs("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[c.jsxs("div",{className:"flex flex-col items-center mb-8",children:[c.jsx("div",{className:"w-12 h-12 bg-indigo-600 rounded-xl flex items-center justify-center text-white mb-4 shadow-lg shadow-indigo-200",children:c.jsx(r1,{size:24})}),c.jsx("h1",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:"Things Clone"}),c.jsx("p",{className:"text-sm text-gray-500 mt-2",children:""})]}),l&&c.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-600 text-sm rounded-lg border border-red-100",children:l}),d&&c.jsx("div",{className:"mb-4 p-3 bg-green-50 text-green-600 text-sm rounded-lg border border-green-100",children:d}),c.jsxs("form",{onSubmit:h,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1 ml-1",children:"Email"}),c.jsxs("div",{className:"relative",children:[c.jsx(Mz,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),c.jsx("input",{type:"text",required:!0,value:n,onChange:p=>r(p.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-100 focus:border-indigo-400 outline-none transition-all text-sm",placeholder:"name@example.com  demo"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1 ml-1",children:"Password"}),c.jsxs("div",{className:"relative",children:[c.jsx(Pa,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),c.jsx("input",{type:"password",required:!0,value:s,onChange:p=>i(p.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-100 focus:border-indigo-400 outline-none transition-all text-sm",placeholder:"",minLength:6})]})]}),c.jsx("button",{type:"submit",disabled:t,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2.5 rounded-lg transition-all flex items-center justify-center gap-2 shadow-lg shadow-indigo-100 disabled:opacity-70 disabled:cursor-not-allowed",children:t?c.jsx(xi,{className:"animate-spin",size:18}):c.jsxs(c.Fragment,{children:[o==="signin"?"":"",c.jsx(Nw,{size:16})]})})]}),c.jsx("div",{className:"mt-6 text-center",children:c.jsx("button",{type:"button",onClick:()=>a(o==="signin"?"signup":"signin"),className:"text-sm text-indigo-600 hover:text-indigo-500 font-medium",children:o==="signin"?"":""})}),c.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-100",children:[c.jsx("p",{className:"text-xs text-gray-400 text-center mb-3",children:" Demo "}),c.jsx("button",{type:"button",onClick:async()=>{e(!0),u(null);try{if(!be)throw new Error("Supabase client not initialized");const{error:p}=await be.auth.signInWithPassword({email:"demo@demo.com",password:"demodemo"});if(p)throw p;window.location.reload()}catch(p){u("Demo : "+p.message)}finally{e(!1)}},disabled:t,className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 rounded-lg transition-all flex items-center justify-center gap-2 text-sm disabled:opacity-70",children:" Demo "}),c.jsxs("p",{className:"text-[10px] text-gray-400 text-center mt-2",children:[" ",c.jsx("span",{className:"font-mono font-bold",children:"demo"})," "]})]})]})})},hre=()=>{const{isRecording:t,recordingTime:e,stopRecording:n,analyser:r,recordingTaskId:s}=x.useContext(Ru),{setFocusedTaskId:i,tasks:o,setView:a,setExpandedTaskIds:l,setEditingTaskId:u}=x.useContext(jn),[d,f]=x.useState(!1),h=x.useRef(null),p=x.useRef(),m=()=>{if(!s)return;a("allview");const b=o.find(g=>g.id===s);if(b){let g=b;const v=[];for(;g.parent_id;){v.push(g.parent_id);const w=o.find(_=>_.id===g.parent_id);if(!w)break;g=w}v.length>0&&l(w=>[...new Set([...w,...v])])}i(s),u(s),f(!1)};if(x.useEffect(()=>{if(!t||!r||!h.current)return;const b=h.current,g=b.getContext("2d");if(!g)return;const v=r.frequencyBinCount,w=new Uint8Array(v),_=()=>{if(!r)return;p.current=requestAnimationFrame(_),r.getByteTimeDomainData(w),g.clearRect(0,0,b.width,b.height),g.lineWidth=2,g.strokeStyle="rgba(255, 255, 255, 0.8)",g.beginPath();const D=b.width/v;let k=0;for(let A=0;A<v;A++){const E=w[A]/128*b.height/2;A===0?g.moveTo(k,E):g.lineTo(k,E),k+=D}g.lineTo(b.width,b.height/2),g.stroke()};return _(),()=>{p.current&&cancelAnimationFrame(p.current)}},[t,r]),!t)return null;const y=b=>{const g=Math.floor(b/1e3),v=Math.floor(g/60),w=g%60;return`${v.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`};return d?c.jsx("div",{className:"fixed bottom-6 left-6 z-[99999] animate-in fade-in zoom-in duration-300 cursor-pointer group",onClick:m,title:"Recording in progress. Click to locate task.",children:c.jsxs("div",{className:"bg-black/80 backdrop-blur-md border border-emerald-500/30 rounded-full p-2.5 shadow-2xl flex items-center justify-center relative hover:bg-black/90 transition-all hover:scale-110",children:[c.jsx("div",{className:"w-2.5 h-2.5 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_10px_rgba(16,185,129,0.8)]"}),c.jsx("div",{className:"absolute left-full ml-3 bg-black/90 text-white text-[10px] px-2 py-1 rounded-md whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none border border-white/10 shadow-xl font-mono",children:y(e)})]})}):c.jsx("div",{className:"fixed bottom-6 left-1/2 transform -translate-x-1/2 z-[99999] animate-in fade-in slide-in-from-bottom-4 duration-300","data-recording-capsule":!0,children:c.jsxs("div",{className:"bg-black/90 backdrop-blur-xl text-white rounded-full flex items-center p-2 pl-4 pr-3 shadow-2xl border border-white/10 gap-3 min-w-[200px] hover:scale-[1.01] transition-transform",children:[c.jsx("button",{onClick:b=>{b.stopPropagation(),b.preventDefault(),n()},className:"w-8 h-8 rounded-full bg-red-500/20 text-red-400 flex items-center justify-center hover:bg-red-500 hover:text-white transition-all cursor-pointer",title:"Stop Recording",children:c.jsx(Hz,{size:12,fill:"currentColor"})}),c.jsx("div",{className:"flex flex-col items-center min-w-[50px] cursor-pointer hover:opacity-80 transition-opacity",onClick:m,title:"Click to locate task",children:c.jsx("span",{className:"font-mono text-sm font-medium tabular-nums tracking-wider text-white",children:y(e)})}),c.jsx("div",{className:"w-20 h-8 relative opacity-80 flex items-center cursor-pointer",onClick:m,title:"Click to locate task",children:c.jsx("canvas",{ref:h,width:80,height:32,className:"w-full h-full"})}),c.jsx("div",{className:"h-6 w-[1px] bg-white/10 mx-1"}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:m,className:"p-1.5 text-gray-400 hover:text-white hover:bg-white/10 rounded-full transition-colors",title:"Locate Recording Task",children:c.jsx(jz,{size:14})}),c.jsx("button",{onClick:()=>f(!0),className:"p-1.5 text-gray-400 hover:text-white hover:bg-white/10 rounded-full transition-colors",title:"Minimize",children:c.jsx(rs,{size:16})})]})]})})},wE=()=>c.jsx("div",{className:"w-full h-screen bg-gray-100 flex items-center justify-center",children:c.jsx("div",{className:"w-full h-full md:max-w-[430px] md:h-[90vh] md:rounded-[3rem] md:border-8 md:border-gray-900 bg-white relative shadow-2xl overflow-hidden",children:c.jsx(UR,{isStandalone:!0})})}),pre=()=>{const{user:t,loading:e}=x.useContext(jn);if(e)return c.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:c.jsxs("div",{className:"flex flex-col items-center gap-3",children:[c.jsx("div",{className:"w-8 h-8 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"}),c.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"Loading workspace..."})]})});const n=t&&t.aud==="authenticated";return c.jsxs(_3,{children:[c.jsx(ud,{path:"/share/heart/s/:snapshotId",element:c.jsx(wE,{})}),c.jsx(ud,{path:"/share/heart/:userId",element:c.jsx(wE,{})}),c.jsx(ud,{path:"/login",element:n?c.jsx(LS,{to:"/",replace:!0}):c.jsx(fre,{})}),c.jsx(ud,{path:"/*",element:n?c.jsx(dre,{}):c.jsx(LS,{to:"/login",replace:!0})})]})};function mre(){return c.jsx(Y3,{children:c.jsx(K6,{children:c.jsx(G6,{children:c.jsxs(Y6,{children:[c.jsx(pre,{}),c.jsx(hre,{})]})})})})}Gy.createRoot(document.getElementById("root")).render(c.jsx(mre,{}));
