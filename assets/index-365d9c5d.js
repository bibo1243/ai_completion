(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var Op=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fg(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var TE={exports:{}},hg={},CE={exports:{}},Sn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wf=Symbol.for("react.element"),iO=Symbol.for("react.portal"),oO=Symbol.for("react.fragment"),aO=Symbol.for("react.strict_mode"),lO=Symbol.for("react.profiler"),cO=Symbol.for("react.provider"),uO=Symbol.for("react.context"),dO=Symbol.for("react.forward_ref"),fO=Symbol.for("react.suspense"),hO=Symbol.for("react.memo"),pO=Symbol.for("react.lazy"),Ck=Symbol.iterator;function mO(t){return t===null||typeof t!="object"?null:(t=Ck&&t[Ck]||t["@@iterator"],typeof t=="function"?t:null)}var EE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},NE=Object.assign,jE={};function Mu(t,e,n){this.props=t,this.context=e,this.refs=jE,this.updater=n||EE}Mu.prototype.isReactComponent={};Mu.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Mu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function IE(){}IE.prototype=Mu.prototype;function Sb(t,e,n){this.props=t,this.context=e,this.refs=jE,this.updater=n||EE}var _b=Sb.prototype=new IE;_b.constructor=Sb;NE(_b,Mu.prototype);_b.isPureReactComponent=!0;var Ek=Array.isArray,ME=Object.prototype.hasOwnProperty,Tb={current:null},DE={key:!0,ref:!0,__self:!0,__source:!0};function AE(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)ME.call(e,r)&&!DE.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:Wf,type:t,key:i,ref:o,props:s,_owner:Tb.current}}function gO(t,e){return{$$typeof:Wf,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Cb(t){return typeof t=="object"&&t!==null&&t.$$typeof===Wf}function yO(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Nk=/\/+/g;function c0(t,e){return typeof t=="object"&&t!==null&&t.key!=null?yO(""+t.key):e.toString(36)}function rp(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Wf:case iO:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+c0(o,0):r,Ek(s)?(n="",t!=null&&(n=t.replace(Nk,"$&/")+"/"),rp(s,e,n,"",function(u){return u})):s!=null&&(Cb(s)&&(s=gO(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Nk,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Ek(t))for(var a=0;a<t.length;a++){i=t[a];var l=r+c0(i,a);o+=rp(i,e,n,l,s)}else if(l=mO(t),typeof l=="function")for(t=l.call(t),a=0;!(i=t.next()).done;)i=i.value,l=r+c0(i,a++),o+=rp(i,e,n,l,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function hh(t,e,n){if(t==null)return t;var r=[],s=0;return rp(t,r,"","",function(i){return e.call(n,i,s++)}),r}function xO(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Cs={current:null},sp={transition:null},bO={ReactCurrentDispatcher:Cs,ReactCurrentBatchConfig:sp,ReactCurrentOwner:Tb};function RE(){throw Error("act(...) is not supported in production builds of React.")}Sn.Children={map:hh,forEach:function(t,e,n){hh(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return hh(t,function(){e++}),e},toArray:function(t){return hh(t,function(e){return e})||[]},only:function(t){if(!Cb(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Sn.Component=Mu;Sn.Fragment=oO;Sn.Profiler=lO;Sn.PureComponent=Sb;Sn.StrictMode=aO;Sn.Suspense=fO;Sn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=bO;Sn.act=RE;Sn.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=NE({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Tb.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)ME.call(e,l)&&!DE.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Wf,type:t.type,key:s,ref:i,props:r,_owner:o}};Sn.createContext=function(t){return t={$$typeof:uO,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:cO,_context:t},t.Consumer=t};Sn.createElement=AE;Sn.createFactory=function(t){var e=AE.bind(null,t);return e.type=t,e};Sn.createRef=function(){return{current:null}};Sn.forwardRef=function(t){return{$$typeof:dO,render:t}};Sn.isValidElement=Cb;Sn.lazy=function(t){return{$$typeof:pO,_payload:{_status:-1,_result:t},_init:xO}};Sn.memo=function(t,e){return{$$typeof:hO,type:t,compare:e===void 0?null:e}};Sn.startTransition=function(t){var e=sp.transition;sp.transition={};try{t()}finally{sp.transition=e}};Sn.unstable_act=RE;Sn.useCallback=function(t,e){return Cs.current.useCallback(t,e)};Sn.useContext=function(t){return Cs.current.useContext(t)};Sn.useDebugValue=function(){};Sn.useDeferredValue=function(t){return Cs.current.useDeferredValue(t)};Sn.useEffect=function(t,e){return Cs.current.useEffect(t,e)};Sn.useId=function(){return Cs.current.useId()};Sn.useImperativeHandle=function(t,e,n){return Cs.current.useImperativeHandle(t,e,n)};Sn.useInsertionEffect=function(t,e){return Cs.current.useInsertionEffect(t,e)};Sn.useLayoutEffect=function(t,e){return Cs.current.useLayoutEffect(t,e)};Sn.useMemo=function(t,e){return Cs.current.useMemo(t,e)};Sn.useReducer=function(t,e,n){return Cs.current.useReducer(t,e,n)};Sn.useRef=function(t){return Cs.current.useRef(t)};Sn.useState=function(t){return Cs.current.useState(t)};Sn.useSyncExternalStore=function(t,e,n){return Cs.current.useSyncExternalStore(t,e,n)};Sn.useTransition=function(){return Cs.current.useTransition()};Sn.version="18.3.1";CE.exports=Sn;var x=CE.exports;const Ln=fg(x);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vO=x,wO=Symbol.for("react.element"),kO=Symbol.for("react.fragment"),SO=Object.prototype.hasOwnProperty,_O=vO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,TO={key:!0,ref:!0,__self:!0,__source:!0};function OE(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)SO.call(e,r)&&!TO.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:wO,type:t,key:i,ref:o,props:s,_owner:_O.current}}hg.Fragment=kO;hg.jsx=OE;hg.jsxs=OE;TE.exports=hg;var c=TE.exports,Xy={},PE={exports:{}},ai={},LE={exports:{}},$E={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(H,W){var R=H.length;H.push(W);e:for(;0<R;){var ae=R-1>>>1,re=H[ae];if(0<s(re,W))H[ae]=W,H[R]=re,R=ae;else break e}}function n(H){return H.length===0?null:H[0]}function r(H){if(H.length===0)return null;var W=H[0],R=H.pop();if(R!==W){H[0]=R;e:for(var ae=0,re=H.length,$=re>>>1;ae<$;){var z=2*(ae+1)-1,le=H[z],$e=z+1,Be=H[$e];if(0>s(le,R))$e<re&&0>s(Be,le)?(H[ae]=Be,H[$e]=R,ae=$e):(H[ae]=le,H[z]=R,ae=z);else if($e<re&&0>s(Be,R))H[ae]=Be,H[$e]=R,ae=$e;else break e}}return W}function s(H,W){var R=H.sortIndex-W.sortIndex;return R!==0?R:H.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],u=[],d=1,f=null,h=3,p=!1,m=!1,y=!1,b=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(H){for(var W=n(u);W!==null;){if(W.callback===null)r(u);else if(W.startTime<=H)r(u),W.sortIndex=W.expirationTime,e(l,W);else break;W=n(u)}}function C(H){if(y=!1,w(H),!m)if(n(l)!==null)m=!0,E(I);else{var W=n(u);W!==null&&j(C,W.startTime-H)}}function I(H,W){m=!1,y&&(y=!1,g(S),S=-1),p=!0;var R=h;try{for(w(W),f=n(l);f!==null&&(!(f.expirationTime>W)||H&&!N());){var ae=f.callback;if(typeof ae=="function"){f.callback=null,h=f.priorityLevel;var re=ae(f.expirationTime<=W);W=t.unstable_now(),typeof re=="function"?f.callback=re:f===n(l)&&r(l),w(W)}else r(l);f=n(l)}if(f!==null)var $=!0;else{var z=n(u);z!==null&&j(C,z.startTime-W),$=!1}return $}finally{f=null,h=R,p=!1}}var k=!1,D=null,S=-1,T=5,_=-1;function N(){return!(t.unstable_now()-_<T)}function A(){if(D!==null){var H=t.unstable_now();_=H;var W=!0;try{W=D(!0,H)}finally{W?O():(k=!1,D=null)}}else k=!1}var O;if(typeof v=="function")O=function(){v(A)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,V=L.port2;L.port1.onmessage=A,O=function(){V.postMessage(null)}}else O=function(){b(A,0)};function E(H){D=H,k||(k=!0,O())}function j(H,W){S=b(function(){H(t.unstable_now())},W)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(H){H.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,E(I))},t.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<H?Math.floor(1e3/H):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(H){switch(h){case 1:case 2:case 3:var W=3;break;default:W=h}var R=h;h=W;try{return H()}finally{h=R}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(H,W){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var R=h;h=H;try{return W()}finally{h=R}},t.unstable_scheduleCallback=function(H,W,R){var ae=t.unstable_now();switch(typeof R=="object"&&R!==null?(R=R.delay,R=typeof R=="number"&&0<R?ae+R:ae):R=ae,H){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=R+re,H={id:d++,callback:W,priorityLevel:H,startTime:R,expirationTime:re,sortIndex:-1},R>ae?(H.sortIndex=R,e(u,H),n(l)===null&&H===n(u)&&(y?(g(S),S=-1):y=!0,j(C,R-ae))):(H.sortIndex=re,e(l,H),m||p||(m=!0,E(I))),H},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(H){var W=h;return function(){var R=h;h=W;try{return H.apply(this,arguments)}finally{h=R}}}})($E);LE.exports=$E;var CO=LE.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var EO=x,ii=CO;function Rt(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var zE=new Set,Xd={};function oc(t,e){yu(t,e),yu(t+"Capture",e)}function yu(t,e){for(Xd[t]=e,t=0;t<e.length;t++)zE.add(e[t])}var Wo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Qy=Object.prototype.hasOwnProperty,NO=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,jk={},Ik={};function jO(t){return Qy.call(Ik,t)?!0:Qy.call(jk,t)?!1:NO.test(t)?Ik[t]=!0:(jk[t]=!0,!1)}function IO(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function MO(t,e,n,r){if(e===null||typeof e>"u"||IO(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Es(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var ns={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ns[t]=new Es(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ns[e]=new Es(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ns[t]=new Es(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ns[t]=new Es(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ns[t]=new Es(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ns[t]=new Es(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ns[t]=new Es(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ns[t]=new Es(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ns[t]=new Es(t,5,!1,t.toLowerCase(),null,!1,!1)});var Eb=/[\-:]([a-z])/g;function Nb(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Eb,Nb);ns[e]=new Es(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Eb,Nb);ns[e]=new Es(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Eb,Nb);ns[e]=new Es(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ns[t]=new Es(t,1,!1,t.toLowerCase(),null,!1,!1)});ns.xlinkHref=new Es("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ns[t]=new Es(t,1,!1,t.toLowerCase(),null,!0,!0)});function jb(t,e,n,r){var s=ns.hasOwnProperty(e)?ns[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(MO(e,n,s,r)&&(n=null),r||s===null?jO(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Qo=EO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ph=Symbol.for("react.element"),Dc=Symbol.for("react.portal"),Ac=Symbol.for("react.fragment"),Ib=Symbol.for("react.strict_mode"),Zy=Symbol.for("react.profiler"),FE=Symbol.for("react.provider"),BE=Symbol.for("react.context"),Mb=Symbol.for("react.forward_ref"),ex=Symbol.for("react.suspense"),tx=Symbol.for("react.suspense_list"),Db=Symbol.for("react.memo"),fa=Symbol.for("react.lazy"),UE=Symbol.for("react.offscreen"),Mk=Symbol.iterator;function qu(t){return t===null||typeof t!="object"?null:(t=Mk&&t[Mk]||t["@@iterator"],typeof t=="function"?t:null)}var fr=Object.assign,u0;function cd(t){if(u0===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);u0=e&&e[1]||""}return`
`+u0+t}var d0=!1;function f0(t,e){if(!t||d0)return"";d0=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{d0=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?cd(t):""}function DO(t){switch(t.tag){case 5:return cd(t.type);case 16:return cd("Lazy");case 13:return cd("Suspense");case 19:return cd("SuspenseList");case 0:case 2:case 15:return t=f0(t.type,!1),t;case 11:return t=f0(t.type.render,!1),t;case 1:return t=f0(t.type,!0),t;default:return""}}function nx(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ac:return"Fragment";case Dc:return"Portal";case Zy:return"Profiler";case Ib:return"StrictMode";case ex:return"Suspense";case tx:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case BE:return(t.displayName||"Context")+".Consumer";case FE:return(t._context.displayName||"Context")+".Provider";case Mb:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Db:return e=t.displayName||null,e!==null?e:nx(t.type)||"Memo";case fa:e=t._payload,t=t._init;try{return nx(t(e))}catch{}}return null}function AO(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return nx(e);case 8:return e===Ib?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ha(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function HE(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function RO(t){var e=HE(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function mh(t){t._valueTracker||(t._valueTracker=RO(t))}function VE(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=HE(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Pp(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function rx(t,e){var n=e.checked;return fr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Dk(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ha(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function WE(t,e){e=e.checked,e!=null&&jb(t,"checked",e,!1)}function sx(t,e){WE(t,e);var n=Ha(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?ix(t,e.type,n):e.hasOwnProperty("defaultValue")&&ix(t,e.type,Ha(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Ak(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function ix(t,e,n){(e!=="number"||Pp(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var ud=Array.isArray;function eu(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ha(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function ox(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Rt(91));return fr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Rk(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Rt(92));if(ud(n)){if(1<n.length)throw Error(Rt(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ha(n)}}function KE(t,e){var n=Ha(e.value),r=Ha(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Ok(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function GE(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ax(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?GE(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var gh,qE=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(gh=gh||document.createElement("div"),gh.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=gh.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Qd(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var wd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},OO=["Webkit","ms","Moz","O"];Object.keys(wd).forEach(function(t){OO.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),wd[e]=wd[t]})});function YE(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||wd.hasOwnProperty(t)&&wd[t]?(""+e).trim():e+"px"}function JE(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=YE(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var PO=fr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function lx(t,e){if(e){if(PO[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Rt(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Rt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Rt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Rt(62))}}function cx(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ux=null;function Ab(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var dx=null,tu=null,nu=null;function Pk(t){if(t=qf(t)){if(typeof dx!="function")throw Error(Rt(280));var e=t.stateNode;e&&(e=xg(e),dx(t.stateNode,t.type,e))}}function XE(t){tu?nu?nu.push(t):nu=[t]:tu=t}function QE(){if(tu){var t=tu,e=nu;if(nu=tu=null,Pk(t),e)for(t=0;t<e.length;t++)Pk(e[t])}}function ZE(t,e){return t(e)}function eN(){}var h0=!1;function tN(t,e,n){if(h0)return t(e,n);h0=!0;try{return ZE(t,e,n)}finally{h0=!1,(tu!==null||nu!==null)&&(eN(),QE())}}function Zd(t,e){var n=t.stateNode;if(n===null)return null;var r=xg(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Rt(231,e,typeof n));return n}var fx=!1;if(Wo)try{var Yu={};Object.defineProperty(Yu,"passive",{get:function(){fx=!0}}),window.addEventListener("test",Yu,Yu),window.removeEventListener("test",Yu,Yu)}catch{fx=!1}function LO(t,e,n,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(d){this.onError(d)}}var kd=!1,Lp=null,$p=!1,hx=null,$O={onError:function(t){kd=!0,Lp=t}};function zO(t,e,n,r,s,i,o,a,l){kd=!1,Lp=null,LO.apply($O,arguments)}function FO(t,e,n,r,s,i,o,a,l){if(zO.apply(this,arguments),kd){if(kd){var u=Lp;kd=!1,Lp=null}else throw Error(Rt(198));$p||($p=!0,hx=u)}}function ac(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function nN(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Lk(t){if(ac(t)!==t)throw Error(Rt(188))}function BO(t){var e=t.alternate;if(!e){if(e=ac(t),e===null)throw Error(Rt(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return Lk(s),t;if(i===r)return Lk(s),e;i=i.sibling}throw Error(Rt(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o)throw Error(Rt(189))}}if(n.alternate!==r)throw Error(Rt(190))}if(n.tag!==3)throw Error(Rt(188));return n.stateNode.current===n?t:e}function rN(t){return t=BO(t),t!==null?sN(t):null}function sN(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=sN(t);if(e!==null)return e;t=t.sibling}return null}var iN=ii.unstable_scheduleCallback,$k=ii.unstable_cancelCallback,UO=ii.unstable_shouldYield,HO=ii.unstable_requestPaint,wr=ii.unstable_now,VO=ii.unstable_getCurrentPriorityLevel,Rb=ii.unstable_ImmediatePriority,oN=ii.unstable_UserBlockingPriority,zp=ii.unstable_NormalPriority,WO=ii.unstable_LowPriority,aN=ii.unstable_IdlePriority,pg=null,mo=null;function KO(t){if(mo&&typeof mo.onCommitFiberRoot=="function")try{mo.onCommitFiberRoot(pg,t,void 0,(t.current.flags&128)===128)}catch{}}var Qi=Math.clz32?Math.clz32:YO,GO=Math.log,qO=Math.LN2;function YO(t){return t>>>=0,t===0?32:31-(GO(t)/qO|0)|0}var yh=64,xh=4194304;function dd(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Fp(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~s;a!==0?r=dd(a):(i&=o,i!==0&&(r=dd(i)))}else o=n&~s,o!==0?r=dd(o):i!==0&&(r=dd(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Qi(e),s=1<<n,r|=t[n],e&=~s;return r}function JO(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function XO(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-Qi(i),a=1<<o,l=s[o];l===-1?(!(a&n)||a&r)&&(s[o]=JO(a,e)):l<=e&&(t.expiredLanes|=a),i&=~a}}function px(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function lN(){var t=yh;return yh<<=1,!(yh&4194240)&&(yh=64),t}function p0(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Kf(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Qi(e),t[e]=n}function QO(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Qi(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Ob(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Qi(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var $n=0;function cN(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var uN,Pb,dN,fN,hN,mx=!1,bh=[],ja=null,Ia=null,Ma=null,ef=new Map,tf=new Map,ba=[],ZO="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function zk(t,e){switch(t){case"focusin":case"focusout":ja=null;break;case"dragenter":case"dragleave":Ia=null;break;case"mouseover":case"mouseout":Ma=null;break;case"pointerover":case"pointerout":ef.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":tf.delete(e.pointerId)}}function Ju(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=qf(e),e!==null&&Pb(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function eP(t,e,n,r,s){switch(e){case"focusin":return ja=Ju(ja,t,e,n,r,s),!0;case"dragenter":return Ia=Ju(Ia,t,e,n,r,s),!0;case"mouseover":return Ma=Ju(Ma,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return ef.set(i,Ju(ef.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,tf.set(i,Ju(tf.get(i)||null,t,e,n,r,s)),!0}return!1}function pN(t){var e=Cl(t.target);if(e!==null){var n=ac(e);if(n!==null){if(e=n.tag,e===13){if(e=nN(n),e!==null){t.blockedOn=e,hN(t.priority,function(){dN(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ip(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=gx(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);ux=r,n.target.dispatchEvent(r),ux=null}else return e=qf(n),e!==null&&Pb(e),t.blockedOn=n,!1;e.shift()}return!0}function Fk(t,e,n){ip(t)&&n.delete(e)}function tP(){mx=!1,ja!==null&&ip(ja)&&(ja=null),Ia!==null&&ip(Ia)&&(Ia=null),Ma!==null&&ip(Ma)&&(Ma=null),ef.forEach(Fk),tf.forEach(Fk)}function Xu(t,e){t.blockedOn===e&&(t.blockedOn=null,mx||(mx=!0,ii.unstable_scheduleCallback(ii.unstable_NormalPriority,tP)))}function nf(t){function e(s){return Xu(s,t)}if(0<bh.length){Xu(bh[0],t);for(var n=1;n<bh.length;n++){var r=bh[n];r.blockedOn===t&&(r.blockedOn=null)}}for(ja!==null&&Xu(ja,t),Ia!==null&&Xu(Ia,t),Ma!==null&&Xu(Ma,t),ef.forEach(e),tf.forEach(e),n=0;n<ba.length;n++)r=ba[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<ba.length&&(n=ba[0],n.blockedOn===null);)pN(n),n.blockedOn===null&&ba.shift()}var ru=Qo.ReactCurrentBatchConfig,Bp=!0;function nP(t,e,n,r){var s=$n,i=ru.transition;ru.transition=null;try{$n=1,Lb(t,e,n,r)}finally{$n=s,ru.transition=i}}function rP(t,e,n,r){var s=$n,i=ru.transition;ru.transition=null;try{$n=4,Lb(t,e,n,r)}finally{$n=s,ru.transition=i}}function Lb(t,e,n,r){if(Bp){var s=gx(t,e,n,r);if(s===null)_0(t,e,r,Up,n),zk(t,r);else if(eP(s,t,e,n,r))r.stopPropagation();else if(zk(t,r),e&4&&-1<ZO.indexOf(t)){for(;s!==null;){var i=qf(s);if(i!==null&&uN(i),i=gx(t,e,n,r),i===null&&_0(t,e,r,Up,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else _0(t,e,r,null,n)}}var Up=null;function gx(t,e,n,r){if(Up=null,t=Ab(r),t=Cl(t),t!==null)if(e=ac(t),e===null)t=null;else if(n=e.tag,n===13){if(t=nN(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Up=t,null}function mN(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(VO()){case Rb:return 1;case oN:return 4;case zp:case WO:return 16;case aN:return 536870912;default:return 16}default:return 16}}var _a=null,$b=null,op=null;function gN(){if(op)return op;var t,e=$b,n=e.length,r,s="value"in _a?_a.value:_a.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return op=s.slice(t,1<r?1-r:void 0)}function ap(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function vh(){return!0}function Bk(){return!1}function li(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?vh:Bk,this.isPropagationStopped=Bk,this}return fr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=vh)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=vh)},persist:function(){},isPersistent:vh}),e}var Du={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zb=li(Du),Gf=fr({},Du,{view:0,detail:0}),sP=li(Gf),m0,g0,Qu,mg=fr({},Gf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fb,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Qu&&(Qu&&t.type==="mousemove"?(m0=t.screenX-Qu.screenX,g0=t.screenY-Qu.screenY):g0=m0=0,Qu=t),m0)},movementY:function(t){return"movementY"in t?t.movementY:g0}}),Uk=li(mg),iP=fr({},mg,{dataTransfer:0}),oP=li(iP),aP=fr({},Gf,{relatedTarget:0}),y0=li(aP),lP=fr({},Du,{animationName:0,elapsedTime:0,pseudoElement:0}),cP=li(lP),uP=fr({},Du,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),dP=li(uP),fP=fr({},Du,{data:0}),Hk=li(fP),hP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gP(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=mP[t])?!!e[t]:!1}function Fb(){return gP}var yP=fr({},Gf,{key:function(t){if(t.key){var e=hP[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=ap(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?pP[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fb,charCode:function(t){return t.type==="keypress"?ap(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ap(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),xP=li(yP),bP=fr({},mg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Vk=li(bP),vP=fr({},Gf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fb}),wP=li(vP),kP=fr({},Du,{propertyName:0,elapsedTime:0,pseudoElement:0}),SP=li(kP),_P=fr({},mg,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),TP=li(_P),CP=[9,13,27,32],Bb=Wo&&"CompositionEvent"in window,Sd=null;Wo&&"documentMode"in document&&(Sd=document.documentMode);var EP=Wo&&"TextEvent"in window&&!Sd,yN=Wo&&(!Bb||Sd&&8<Sd&&11>=Sd),Wk=String.fromCharCode(32),Kk=!1;function xN(t,e){switch(t){case"keyup":return CP.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function bN(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Rc=!1;function NP(t,e){switch(t){case"compositionend":return bN(e);case"keypress":return e.which!==32?null:(Kk=!0,Wk);case"textInput":return t=e.data,t===Wk&&Kk?null:t;default:return null}}function jP(t,e){if(Rc)return t==="compositionend"||!Bb&&xN(t,e)?(t=gN(),op=$b=_a=null,Rc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return yN&&e.locale!=="ko"?null:e.data;default:return null}}var IP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gk(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!IP[t.type]:e==="textarea"}function vN(t,e,n,r){XE(r),e=Hp(e,"onChange"),0<e.length&&(n=new zb("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var _d=null,rf=null;function MP(t){MN(t,0)}function gg(t){var e=Lc(t);if(VE(e))return t}function DP(t,e){if(t==="change")return e}var wN=!1;if(Wo){var x0;if(Wo){var b0="oninput"in document;if(!b0){var qk=document.createElement("div");qk.setAttribute("oninput","return;"),b0=typeof qk.oninput=="function"}x0=b0}else x0=!1;wN=x0&&(!document.documentMode||9<document.documentMode)}function Yk(){_d&&(_d.detachEvent("onpropertychange",kN),rf=_d=null)}function kN(t){if(t.propertyName==="value"&&gg(rf)){var e=[];vN(e,rf,t,Ab(t)),tN(MP,e)}}function AP(t,e,n){t==="focusin"?(Yk(),_d=e,rf=n,_d.attachEvent("onpropertychange",kN)):t==="focusout"&&Yk()}function RP(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return gg(rf)}function OP(t,e){if(t==="click")return gg(e)}function PP(t,e){if(t==="input"||t==="change")return gg(e)}function LP(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var eo=typeof Object.is=="function"?Object.is:LP;function sf(t,e){if(eo(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Qy.call(e,s)||!eo(t[s],e[s]))return!1}return!0}function Jk(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Xk(t,e){var n=Jk(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Jk(n)}}function SN(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?SN(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function _N(){for(var t=window,e=Pp();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Pp(t.document)}return e}function Ub(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function $P(t){var e=_N(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&SN(n.ownerDocument.documentElement,n)){if(r!==null&&Ub(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=Xk(n,i);var o=Xk(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var zP=Wo&&"documentMode"in document&&11>=document.documentMode,Oc=null,yx=null,Td=null,xx=!1;function Qk(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;xx||Oc==null||Oc!==Pp(r)||(r=Oc,"selectionStart"in r&&Ub(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Td&&sf(Td,r)||(Td=r,r=Hp(yx,"onSelect"),0<r.length&&(e=new zb("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Oc)))}function wh(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Pc={animationend:wh("Animation","AnimationEnd"),animationiteration:wh("Animation","AnimationIteration"),animationstart:wh("Animation","AnimationStart"),transitionend:wh("Transition","TransitionEnd")},v0={},TN={};Wo&&(TN=document.createElement("div").style,"AnimationEvent"in window||(delete Pc.animationend.animation,delete Pc.animationiteration.animation,delete Pc.animationstart.animation),"TransitionEvent"in window||delete Pc.transitionend.transition);function yg(t){if(v0[t])return v0[t];if(!Pc[t])return t;var e=Pc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in TN)return v0[t]=e[n];return t}var CN=yg("animationend"),EN=yg("animationiteration"),NN=yg("animationstart"),jN=yg("transitionend"),IN=new Map,Zk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ja(t,e){IN.set(t,e),oc(e,[t])}for(var w0=0;w0<Zk.length;w0++){var k0=Zk[w0],FP=k0.toLowerCase(),BP=k0[0].toUpperCase()+k0.slice(1);Ja(FP,"on"+BP)}Ja(CN,"onAnimationEnd");Ja(EN,"onAnimationIteration");Ja(NN,"onAnimationStart");Ja("dblclick","onDoubleClick");Ja("focusin","onFocus");Ja("focusout","onBlur");Ja(jN,"onTransitionEnd");yu("onMouseEnter",["mouseout","mouseover"]);yu("onMouseLeave",["mouseout","mouseover"]);yu("onPointerEnter",["pointerout","pointerover"]);yu("onPointerLeave",["pointerout","pointerover"]);oc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));oc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));oc("onBeforeInput",["compositionend","keypress","textInput","paste"]);oc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));oc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));oc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var fd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),UP=new Set("cancel close invalid load scroll toggle".split(" ").concat(fd));function eS(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,FO(r,e,void 0,t),t.currentTarget=null}function MN(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;eS(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;eS(s,a,u),i=l}}}if($p)throw t=hx,$p=!1,hx=null,t}function qn(t,e){var n=e[Sx];n===void 0&&(n=e[Sx]=new Set);var r=t+"__bubble";n.has(r)||(DN(e,t,2,!1),n.add(r))}function S0(t,e,n){var r=0;e&&(r|=4),DN(n,t,r,e)}var kh="_reactListening"+Math.random().toString(36).slice(2);function of(t){if(!t[kh]){t[kh]=!0,zE.forEach(function(n){n!=="selectionchange"&&(UP.has(n)||S0(n,!1,t),S0(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[kh]||(e[kh]=!0,S0("selectionchange",!1,e))}}function DN(t,e,n,r){switch(mN(e)){case 1:var s=nP;break;case 4:s=rP;break;default:s=Lb}n=s.bind(null,e,n,t),s=void 0,!fx||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function _0(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Cl(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}tN(function(){var u=i,d=Ab(n),f=[];e:{var h=IN.get(t);if(h!==void 0){var p=zb,m=t;switch(t){case"keypress":if(ap(n)===0)break e;case"keydown":case"keyup":p=xP;break;case"focusin":m="focus",p=y0;break;case"focusout":m="blur",p=y0;break;case"beforeblur":case"afterblur":p=y0;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Uk;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=oP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=wP;break;case CN:case EN:case NN:p=cP;break;case jN:p=SP;break;case"scroll":p=sP;break;case"wheel":p=TP;break;case"copy":case"cut":case"paste":p=dP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Vk}var y=(e&4)!==0,b=!y&&t==="scroll",g=y?h!==null?h+"Capture":null:h;y=[];for(var v=u,w;v!==null;){w=v;var C=w.stateNode;if(w.tag===5&&C!==null&&(w=C,g!==null&&(C=Zd(v,g),C!=null&&y.push(af(v,C,w)))),b)break;v=v.return}0<y.length&&(h=new p(h,m,null,n,d),f.push({event:h,listeners:y}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",h&&n!==ux&&(m=n.relatedTarget||n.fromElement)&&(Cl(m)||m[Ko]))break e;if((p||h)&&(h=d.window===d?d:(h=d.ownerDocument)?h.defaultView||h.parentWindow:window,p?(m=n.relatedTarget||n.toElement,p=u,m=m?Cl(m):null,m!==null&&(b=ac(m),m!==b||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=u),p!==m)){if(y=Uk,C="onMouseLeave",g="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(y=Vk,C="onPointerLeave",g="onPointerEnter",v="pointer"),b=p==null?h:Lc(p),w=m==null?h:Lc(m),h=new y(C,v+"leave",p,n,d),h.target=b,h.relatedTarget=w,C=null,Cl(d)===u&&(y=new y(g,v+"enter",m,n,d),y.target=w,y.relatedTarget=b,C=y),b=C,p&&m)t:{for(y=p,g=m,v=0,w=y;w;w=fc(w))v++;for(w=0,C=g;C;C=fc(C))w++;for(;0<v-w;)y=fc(y),v--;for(;0<w-v;)g=fc(g),w--;for(;v--;){if(y===g||g!==null&&y===g.alternate)break t;y=fc(y),g=fc(g)}y=null}else y=null;p!==null&&tS(f,h,p,y,!1),m!==null&&b!==null&&tS(f,b,m,y,!0)}}e:{if(h=u?Lc(u):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var I=DP;else if(Gk(h))if(wN)I=PP;else{I=RP;var k=AP}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(I=OP);if(I&&(I=I(t,u))){vN(f,I,n,d);break e}k&&k(t,h,u),t==="focusout"&&(k=h._wrapperState)&&k.controlled&&h.type==="number"&&ix(h,"number",h.value)}switch(k=u?Lc(u):window,t){case"focusin":(Gk(k)||k.contentEditable==="true")&&(Oc=k,yx=u,Td=null);break;case"focusout":Td=yx=Oc=null;break;case"mousedown":xx=!0;break;case"contextmenu":case"mouseup":case"dragend":xx=!1,Qk(f,n,d);break;case"selectionchange":if(zP)break;case"keydown":case"keyup":Qk(f,n,d)}var D;if(Bb)e:{switch(t){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else Rc?xN(t,n)&&(S="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(S="onCompositionStart");S&&(yN&&n.locale!=="ko"&&(Rc||S!=="onCompositionStart"?S==="onCompositionEnd"&&Rc&&(D=gN()):(_a=d,$b="value"in _a?_a.value:_a.textContent,Rc=!0)),k=Hp(u,S),0<k.length&&(S=new Hk(S,t,null,n,d),f.push({event:S,listeners:k}),D?S.data=D:(D=bN(n),D!==null&&(S.data=D)))),(D=EP?NP(t,n):jP(t,n))&&(u=Hp(u,"onBeforeInput"),0<u.length&&(d=new Hk("onBeforeInput","beforeinput",null,n,d),f.push({event:d,listeners:u}),d.data=D))}MN(f,e)})}function af(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Hp(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Zd(t,n),i!=null&&r.unshift(af(t,i,s)),i=Zd(t,e),i!=null&&r.push(af(t,i,s))),t=t.return}return r}function fc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function tS(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=Zd(n,i),l!=null&&o.unshift(af(n,l,a))):s||(l=Zd(n,i),l!=null&&o.push(af(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var HP=/\r\n?/g,VP=/\u0000|\uFFFD/g;function nS(t){return(typeof t=="string"?t:""+t).replace(HP,`
`).replace(VP,"")}function Sh(t,e,n){if(e=nS(e),nS(t)!==e&&n)throw Error(Rt(425))}function Vp(){}var bx=null,vx=null;function wx(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var kx=typeof setTimeout=="function"?setTimeout:void 0,WP=typeof clearTimeout=="function"?clearTimeout:void 0,rS=typeof Promise=="function"?Promise:void 0,KP=typeof queueMicrotask=="function"?queueMicrotask:typeof rS<"u"?function(t){return rS.resolve(null).then(t).catch(GP)}:kx;function GP(t){setTimeout(function(){throw t})}function T0(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),nf(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);nf(e)}function Da(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function sS(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Au=Math.random().toString(36).slice(2),lo="__reactFiber$"+Au,lf="__reactProps$"+Au,Ko="__reactContainer$"+Au,Sx="__reactEvents$"+Au,qP="__reactListeners$"+Au,YP="__reactHandles$"+Au;function Cl(t){var e=t[lo];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Ko]||n[lo]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=sS(t);t!==null;){if(n=t[lo])return n;t=sS(t)}return e}t=n,n=t.parentNode}return null}function qf(t){return t=t[lo]||t[Ko],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Lc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Rt(33))}function xg(t){return t[lf]||null}var _x=[],$c=-1;function Xa(t){return{current:t}}function Qn(t){0>$c||(t.current=_x[$c],_x[$c]=null,$c--)}function Kn(t,e){$c++,_x[$c]=t.current,t.current=e}var Va={},ms=Xa(Va),Fs=Xa(!1),Yl=Va;function xu(t,e){var n=t.type.contextTypes;if(!n)return Va;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Bs(t){return t=t.childContextTypes,t!=null}function Wp(){Qn(Fs),Qn(ms)}function iS(t,e,n){if(ms.current!==Va)throw Error(Rt(168));Kn(ms,e),Kn(Fs,n)}function AN(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Rt(108,AO(t)||"Unknown",s));return fr({},n,r)}function Kp(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Va,Yl=ms.current,Kn(ms,t),Kn(Fs,Fs.current),!0}function oS(t,e,n){var r=t.stateNode;if(!r)throw Error(Rt(169));n?(t=AN(t,e,Yl),r.__reactInternalMemoizedMergedChildContext=t,Qn(Fs),Qn(ms),Kn(ms,t)):Qn(Fs),Kn(Fs,n)}var Po=null,bg=!1,C0=!1;function RN(t){Po===null?Po=[t]:Po.push(t)}function JP(t){bg=!0,RN(t)}function Qa(){if(!C0&&Po!==null){C0=!0;var t=0,e=$n;try{var n=Po;for($n=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Po=null,bg=!1}catch(s){throw Po!==null&&(Po=Po.slice(t+1)),iN(Rb,Qa),s}finally{$n=e,C0=!1}}return null}var zc=[],Fc=0,Gp=null,qp=0,bi=[],vi=0,Jl=null,$o=1,zo="";function pl(t,e){zc[Fc++]=qp,zc[Fc++]=Gp,Gp=t,qp=e}function ON(t,e,n){bi[vi++]=$o,bi[vi++]=zo,bi[vi++]=Jl,Jl=t;var r=$o;t=zo;var s=32-Qi(r)-1;r&=~(1<<s),n+=1;var i=32-Qi(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,$o=1<<32-Qi(e)+s|n<<s|r,zo=i+t}else $o=1<<i|n<<s|r,zo=t}function Hb(t){t.return!==null&&(pl(t,1),ON(t,1,0))}function Vb(t){for(;t===Gp;)Gp=zc[--Fc],zc[Fc]=null,qp=zc[--Fc],zc[Fc]=null;for(;t===Jl;)Jl=bi[--vi],bi[vi]=null,zo=bi[--vi],bi[vi]=null,$o=bi[--vi],bi[vi]=null}var si=null,ti=null,sr=!1,Ji=null;function PN(t,e){var n=Si(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function aS(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,si=t,ti=Da(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,si=t,ti=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Jl!==null?{id:$o,overflow:zo}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Si(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,si=t,ti=null,!0):!1;default:return!1}}function Tx(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Cx(t){if(sr){var e=ti;if(e){var n=e;if(!aS(t,e)){if(Tx(t))throw Error(Rt(418));e=Da(n.nextSibling);var r=si;e&&aS(t,e)?PN(r,n):(t.flags=t.flags&-4097|2,sr=!1,si=t)}}else{if(Tx(t))throw Error(Rt(418));t.flags=t.flags&-4097|2,sr=!1,si=t}}}function lS(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;si=t}function _h(t){if(t!==si)return!1;if(!sr)return lS(t),sr=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!wx(t.type,t.memoizedProps)),e&&(e=ti)){if(Tx(t))throw LN(),Error(Rt(418));for(;e;)PN(t,e),e=Da(e.nextSibling)}if(lS(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Rt(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ti=Da(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ti=null}}else ti=si?Da(t.stateNode.nextSibling):null;return!0}function LN(){for(var t=ti;t;)t=Da(t.nextSibling)}function bu(){ti=si=null,sr=!1}function Wb(t){Ji===null?Ji=[t]:Ji.push(t)}var XP=Qo.ReactCurrentBatchConfig;function Zu(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Rt(309));var r=n.stateNode}if(!r)throw Error(Rt(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(Rt(284));if(!n._owner)throw Error(Rt(290,t))}return t}function Th(t,e){throw t=Object.prototype.toString.call(e),Error(Rt(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function cS(t){var e=t._init;return e(t._payload)}function $N(t){function e(g,v){if(t){var w=g.deletions;w===null?(g.deletions=[v],g.flags|=16):w.push(v)}}function n(g,v){if(!t)return null;for(;v!==null;)e(g,v),v=v.sibling;return null}function r(g,v){for(g=new Map;v!==null;)v.key!==null?g.set(v.key,v):g.set(v.index,v),v=v.sibling;return g}function s(g,v){return g=Pa(g,v),g.index=0,g.sibling=null,g}function i(g,v,w){return g.index=w,t?(w=g.alternate,w!==null?(w=w.index,w<v?(g.flags|=2,v):w):(g.flags|=2,v)):(g.flags|=1048576,v)}function o(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,v,w,C){return v===null||v.tag!==6?(v=A0(w,g.mode,C),v.return=g,v):(v=s(v,w),v.return=g,v)}function l(g,v,w,C){var I=w.type;return I===Ac?d(g,v,w.props.children,C,w.key):v!==null&&(v.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===fa&&cS(I)===v.type)?(C=s(v,w.props),C.ref=Zu(g,v,w),C.return=g,C):(C=pp(w.type,w.key,w.props,null,g.mode,C),C.ref=Zu(g,v,w),C.return=g,C)}function u(g,v,w,C){return v===null||v.tag!==4||v.stateNode.containerInfo!==w.containerInfo||v.stateNode.implementation!==w.implementation?(v=R0(w,g.mode,C),v.return=g,v):(v=s(v,w.children||[]),v.return=g,v)}function d(g,v,w,C,I){return v===null||v.tag!==7?(v=zl(w,g.mode,C,I),v.return=g,v):(v=s(v,w),v.return=g,v)}function f(g,v,w){if(typeof v=="string"&&v!==""||typeof v=="number")return v=A0(""+v,g.mode,w),v.return=g,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case ph:return w=pp(v.type,v.key,v.props,null,g.mode,w),w.ref=Zu(g,null,v),w.return=g,w;case Dc:return v=R0(v,g.mode,w),v.return=g,v;case fa:var C=v._init;return f(g,C(v._payload),w)}if(ud(v)||qu(v))return v=zl(v,g.mode,w,null),v.return=g,v;Th(g,v)}return null}function h(g,v,w,C){var I=v!==null?v.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return I!==null?null:a(g,v,""+w,C);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case ph:return w.key===I?l(g,v,w,C):null;case Dc:return w.key===I?u(g,v,w,C):null;case fa:return I=w._init,h(g,v,I(w._payload),C)}if(ud(w)||qu(w))return I!==null?null:d(g,v,w,C,null);Th(g,w)}return null}function p(g,v,w,C,I){if(typeof C=="string"&&C!==""||typeof C=="number")return g=g.get(w)||null,a(v,g,""+C,I);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case ph:return g=g.get(C.key===null?w:C.key)||null,l(v,g,C,I);case Dc:return g=g.get(C.key===null?w:C.key)||null,u(v,g,C,I);case fa:var k=C._init;return p(g,v,w,k(C._payload),I)}if(ud(C)||qu(C))return g=g.get(w)||null,d(v,g,C,I,null);Th(v,C)}return null}function m(g,v,w,C){for(var I=null,k=null,D=v,S=v=0,T=null;D!==null&&S<w.length;S++){D.index>S?(T=D,D=null):T=D.sibling;var _=h(g,D,w[S],C);if(_===null){D===null&&(D=T);break}t&&D&&_.alternate===null&&e(g,D),v=i(_,v,S),k===null?I=_:k.sibling=_,k=_,D=T}if(S===w.length)return n(g,D),sr&&pl(g,S),I;if(D===null){for(;S<w.length;S++)D=f(g,w[S],C),D!==null&&(v=i(D,v,S),k===null?I=D:k.sibling=D,k=D);return sr&&pl(g,S),I}for(D=r(g,D);S<w.length;S++)T=p(D,g,S,w[S],C),T!==null&&(t&&T.alternate!==null&&D.delete(T.key===null?S:T.key),v=i(T,v,S),k===null?I=T:k.sibling=T,k=T);return t&&D.forEach(function(N){return e(g,N)}),sr&&pl(g,S),I}function y(g,v,w,C){var I=qu(w);if(typeof I!="function")throw Error(Rt(150));if(w=I.call(w),w==null)throw Error(Rt(151));for(var k=I=null,D=v,S=v=0,T=null,_=w.next();D!==null&&!_.done;S++,_=w.next()){D.index>S?(T=D,D=null):T=D.sibling;var N=h(g,D,_.value,C);if(N===null){D===null&&(D=T);break}t&&D&&N.alternate===null&&e(g,D),v=i(N,v,S),k===null?I=N:k.sibling=N,k=N,D=T}if(_.done)return n(g,D),sr&&pl(g,S),I;if(D===null){for(;!_.done;S++,_=w.next())_=f(g,_.value,C),_!==null&&(v=i(_,v,S),k===null?I=_:k.sibling=_,k=_);return sr&&pl(g,S),I}for(D=r(g,D);!_.done;S++,_=w.next())_=p(D,g,S,_.value,C),_!==null&&(t&&_.alternate!==null&&D.delete(_.key===null?S:_.key),v=i(_,v,S),k===null?I=_:k.sibling=_,k=_);return t&&D.forEach(function(A){return e(g,A)}),sr&&pl(g,S),I}function b(g,v,w,C){if(typeof w=="object"&&w!==null&&w.type===Ac&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case ph:e:{for(var I=w.key,k=v;k!==null;){if(k.key===I){if(I=w.type,I===Ac){if(k.tag===7){n(g,k.sibling),v=s(k,w.props.children),v.return=g,g=v;break e}}else if(k.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===fa&&cS(I)===k.type){n(g,k.sibling),v=s(k,w.props),v.ref=Zu(g,k,w),v.return=g,g=v;break e}n(g,k);break}else e(g,k);k=k.sibling}w.type===Ac?(v=zl(w.props.children,g.mode,C,w.key),v.return=g,g=v):(C=pp(w.type,w.key,w.props,null,g.mode,C),C.ref=Zu(g,v,w),C.return=g,g=C)}return o(g);case Dc:e:{for(k=w.key;v!==null;){if(v.key===k)if(v.tag===4&&v.stateNode.containerInfo===w.containerInfo&&v.stateNode.implementation===w.implementation){n(g,v.sibling),v=s(v,w.children||[]),v.return=g,g=v;break e}else{n(g,v);break}else e(g,v);v=v.sibling}v=R0(w,g.mode,C),v.return=g,g=v}return o(g);case fa:return k=w._init,b(g,v,k(w._payload),C)}if(ud(w))return m(g,v,w,C);if(qu(w))return y(g,v,w,C);Th(g,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,v!==null&&v.tag===6?(n(g,v.sibling),v=s(v,w),v.return=g,g=v):(n(g,v),v=A0(w,g.mode,C),v.return=g,g=v),o(g)):n(g,v)}return b}var vu=$N(!0),zN=$N(!1),Yp=Xa(null),Jp=null,Bc=null,Kb=null;function Gb(){Kb=Bc=Jp=null}function qb(t){var e=Yp.current;Qn(Yp),t._currentValue=e}function Ex(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function su(t,e){Jp=t,Kb=Bc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ls=!0),t.firstContext=null)}function Mi(t){var e=t._currentValue;if(Kb!==t)if(t={context:t,memoizedValue:e,next:null},Bc===null){if(Jp===null)throw Error(Rt(308));Bc=t,Jp.dependencies={lanes:0,firstContext:t}}else Bc=Bc.next=t;return e}var El=null;function Yb(t){El===null?El=[t]:El.push(t)}function FN(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,Yb(e)):(n.next=s.next,s.next=n),e.interleaved=n,Go(t,r)}function Go(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var ha=!1;function Jb(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function BN(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Bo(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Aa(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Mn&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Go(t,n)}return s=r.interleaved,s===null?(e.next=e,Yb(r)):(e.next=s.next,s.next=e),r.interleaved=e,Go(t,n)}function lp(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Ob(t,n)}}function uS(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Xp(t,e,n,r){var s=t.updateQueue;ha=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var d=t.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=u:a.next=u,d.lastBaseUpdate=l))}if(i!==null){var f=s.baseState;o=0,d=u=l=null,a=i;do{var h=a.lane,p=a.eventTime;if((r&h)===h){d!==null&&(d=d.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=t,y=a;switch(h=e,p=n,y.tag){case 1:if(m=y.payload,typeof m=="function"){f=m.call(p,f,h);break e}f=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=y.payload,h=typeof m=="function"?m.call(p,f,h):m,h==null)break e;f=fr({},f,h);break e;case 2:ha=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=s.effects,h===null?s.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(u=d=p,l=f):d=d.next=p,o|=h;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;h=a,a=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(1);if(d===null&&(l=f),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=d,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Ql|=o,t.lanes=o,t.memoizedState=f}}function dS(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(Rt(191,s));s.call(r)}}}var Yf={},go=Xa(Yf),cf=Xa(Yf),uf=Xa(Yf);function Nl(t){if(t===Yf)throw Error(Rt(174));return t}function Xb(t,e){switch(Kn(uf,e),Kn(cf,t),Kn(go,Yf),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ax(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ax(e,t)}Qn(go),Kn(go,e)}function wu(){Qn(go),Qn(cf),Qn(uf)}function UN(t){Nl(uf.current);var e=Nl(go.current),n=ax(e,t.type);e!==n&&(Kn(cf,t),Kn(go,n))}function Qb(t){cf.current===t&&(Qn(go),Qn(cf))}var cr=Xa(0);function Qp(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var E0=[];function Zb(){for(var t=0;t<E0.length;t++)E0[t]._workInProgressVersionPrimary=null;E0.length=0}var cp=Qo.ReactCurrentDispatcher,N0=Qo.ReactCurrentBatchConfig,Xl=0,dr=null,Rr=null,$r=null,Zp=!1,Cd=!1,df=0,QP=0;function as(){throw Error(Rt(321))}function ev(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!eo(t[n],e[n]))return!1;return!0}function tv(t,e,n,r,s,i){if(Xl=i,dr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,cp.current=t===null||t.memoizedState===null?n4:r4,t=n(r,s),Cd){i=0;do{if(Cd=!1,df=0,25<=i)throw Error(Rt(301));i+=1,$r=Rr=null,e.updateQueue=null,cp.current=s4,t=n(r,s)}while(Cd)}if(cp.current=em,e=Rr!==null&&Rr.next!==null,Xl=0,$r=Rr=dr=null,Zp=!1,e)throw Error(Rt(300));return t}function nv(){var t=df!==0;return df=0,t}function no(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return $r===null?dr.memoizedState=$r=t:$r=$r.next=t,$r}function Di(){if(Rr===null){var t=dr.alternate;t=t!==null?t.memoizedState:null}else t=Rr.next;var e=$r===null?dr.memoizedState:$r.next;if(e!==null)$r=e,Rr=t;else{if(t===null)throw Error(Rt(310));Rr=t,t={memoizedState:Rr.memoizedState,baseState:Rr.baseState,baseQueue:Rr.baseQueue,queue:Rr.queue,next:null},$r===null?dr.memoizedState=$r=t:$r=$r.next=t}return $r}function ff(t,e){return typeof e=="function"?e(t):e}function j0(t){var e=Di(),n=e.queue;if(n===null)throw Error(Rt(311));n.lastRenderedReducer=t;var r=Rr,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var d=u.lane;if((Xl&d)===d)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var f={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,dr.lanes|=d,Ql|=d}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,eo(r,e.memoizedState)||(Ls=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,dr.lanes|=i,Ql|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function I0(t){var e=Di(),n=e.queue;if(n===null)throw Error(Rt(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);eo(i,e.memoizedState)||(Ls=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function HN(){}function VN(t,e){var n=dr,r=Di(),s=e(),i=!eo(r.memoizedState,s);if(i&&(r.memoizedState=s,Ls=!0),r=r.queue,rv(GN.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||$r!==null&&$r.memoizedState.tag&1){if(n.flags|=2048,hf(9,KN.bind(null,n,r,s,e),void 0,null),Br===null)throw Error(Rt(349));Xl&30||WN(n,e,s)}return s}function WN(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=dr.updateQueue,e===null?(e={lastEffect:null,stores:null},dr.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function KN(t,e,n,r){e.value=n,e.getSnapshot=r,qN(e)&&YN(t)}function GN(t,e,n){return n(function(){qN(e)&&YN(t)})}function qN(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!eo(t,n)}catch{return!0}}function YN(t){var e=Go(t,1);e!==null&&Zi(e,t,1,-1)}function fS(t){var e=no();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ff,lastRenderedState:t},e.queue=t,t=t.dispatch=t4.bind(null,dr,t),[e.memoizedState,t]}function hf(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=dr.updateQueue,e===null?(e={lastEffect:null,stores:null},dr.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function JN(){return Di().memoizedState}function up(t,e,n,r){var s=no();dr.flags|=t,s.memoizedState=hf(1|e,n,void 0,r===void 0?null:r)}function vg(t,e,n,r){var s=Di();r=r===void 0?null:r;var i=void 0;if(Rr!==null){var o=Rr.memoizedState;if(i=o.destroy,r!==null&&ev(r,o.deps)){s.memoizedState=hf(e,n,i,r);return}}dr.flags|=t,s.memoizedState=hf(1|e,n,i,r)}function hS(t,e){return up(8390656,8,t,e)}function rv(t,e){return vg(2048,8,t,e)}function XN(t,e){return vg(4,2,t,e)}function QN(t,e){return vg(4,4,t,e)}function ZN(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function ej(t,e,n){return n=n!=null?n.concat([t]):null,vg(4,4,ZN.bind(null,e,t),n)}function sv(){}function tj(t,e){var n=Di();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&ev(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function nj(t,e){var n=Di();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&ev(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function rj(t,e,n){return Xl&21?(eo(n,e)||(n=lN(),dr.lanes|=n,Ql|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ls=!0),t.memoizedState=n)}function ZP(t,e){var n=$n;$n=n!==0&&4>n?n:4,t(!0);var r=N0.transition;N0.transition={};try{t(!1),e()}finally{$n=n,N0.transition=r}}function sj(){return Di().memoizedState}function e4(t,e,n){var r=Oa(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ij(t))oj(e,n);else if(n=FN(t,e,n,r),n!==null){var s=Ss();Zi(n,t,r,s),aj(n,e,r)}}function t4(t,e,n){var r=Oa(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ij(t))oj(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(s.hasEagerState=!0,s.eagerState=a,eo(a,o)){var l=e.interleaved;l===null?(s.next=s,Yb(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}n=FN(t,e,s,r),n!==null&&(s=Ss(),Zi(n,t,r,s),aj(n,e,r))}}function ij(t){var e=t.alternate;return t===dr||e!==null&&e===dr}function oj(t,e){Cd=Zp=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function aj(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Ob(t,n)}}var em={readContext:Mi,useCallback:as,useContext:as,useEffect:as,useImperativeHandle:as,useInsertionEffect:as,useLayoutEffect:as,useMemo:as,useReducer:as,useRef:as,useState:as,useDebugValue:as,useDeferredValue:as,useTransition:as,useMutableSource:as,useSyncExternalStore:as,useId:as,unstable_isNewReconciler:!1},n4={readContext:Mi,useCallback:function(t,e){return no().memoizedState=[t,e===void 0?null:e],t},useContext:Mi,useEffect:hS,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,up(4194308,4,ZN.bind(null,e,t),n)},useLayoutEffect:function(t,e){return up(4194308,4,t,e)},useInsertionEffect:function(t,e){return up(4,2,t,e)},useMemo:function(t,e){var n=no();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=no();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=e4.bind(null,dr,t),[r.memoizedState,t]},useRef:function(t){var e=no();return t={current:t},e.memoizedState=t},useState:fS,useDebugValue:sv,useDeferredValue:function(t){return no().memoizedState=t},useTransition:function(){var t=fS(!1),e=t[0];return t=ZP.bind(null,t[1]),no().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=dr,s=no();if(sr){if(n===void 0)throw Error(Rt(407));n=n()}else{if(n=e(),Br===null)throw Error(Rt(349));Xl&30||WN(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,hS(GN.bind(null,r,i,t),[t]),r.flags|=2048,hf(9,KN.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=no(),e=Br.identifierPrefix;if(sr){var n=zo,r=$o;n=(r&~(1<<32-Qi(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=df++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=QP++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},r4={readContext:Mi,useCallback:tj,useContext:Mi,useEffect:rv,useImperativeHandle:ej,useInsertionEffect:XN,useLayoutEffect:QN,useMemo:nj,useReducer:j0,useRef:JN,useState:function(){return j0(ff)},useDebugValue:sv,useDeferredValue:function(t){var e=Di();return rj(e,Rr.memoizedState,t)},useTransition:function(){var t=j0(ff)[0],e=Di().memoizedState;return[t,e]},useMutableSource:HN,useSyncExternalStore:VN,useId:sj,unstable_isNewReconciler:!1},s4={readContext:Mi,useCallback:tj,useContext:Mi,useEffect:rv,useImperativeHandle:ej,useInsertionEffect:XN,useLayoutEffect:QN,useMemo:nj,useReducer:I0,useRef:JN,useState:function(){return I0(ff)},useDebugValue:sv,useDeferredValue:function(t){var e=Di();return Rr===null?e.memoizedState=t:rj(e,Rr.memoizedState,t)},useTransition:function(){var t=I0(ff)[0],e=Di().memoizedState;return[t,e]},useMutableSource:HN,useSyncExternalStore:VN,useId:sj,unstable_isNewReconciler:!1};function Ki(t,e){if(t&&t.defaultProps){e=fr({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Nx(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:fr({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var wg={isMounted:function(t){return(t=t._reactInternals)?ac(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Ss(),s=Oa(t),i=Bo(r,s);i.payload=e,n!=null&&(i.callback=n),e=Aa(t,i,s),e!==null&&(Zi(e,t,s,r),lp(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Ss(),s=Oa(t),i=Bo(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Aa(t,i,s),e!==null&&(Zi(e,t,s,r),lp(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ss(),r=Oa(t),s=Bo(n,r);s.tag=2,e!=null&&(s.callback=e),e=Aa(t,s,r),e!==null&&(Zi(e,t,r,n),lp(e,t,r))}};function pS(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!sf(n,r)||!sf(s,i):!0}function lj(t,e,n){var r=!1,s=Va,i=e.contextType;return typeof i=="object"&&i!==null?i=Mi(i):(s=Bs(e)?Yl:ms.current,r=e.contextTypes,i=(r=r!=null)?xu(t,s):Va),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=wg,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function mS(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&wg.enqueueReplaceState(e,e.state,null)}function jx(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Jb(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Mi(i):(i=Bs(e)?Yl:ms.current,s.context=xu(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Nx(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&wg.enqueueReplaceState(s,s.state,null),Xp(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function ku(t,e){try{var n="",r=e;do n+=DO(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function M0(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Ix(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var i4=typeof WeakMap=="function"?WeakMap:Map;function cj(t,e,n){n=Bo(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){nm||(nm=!0,Fx=r),Ix(t,e)},n}function uj(t,e,n){n=Bo(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Ix(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Ix(t,e),typeof r!="function"&&(Ra===null?Ra=new Set([this]):Ra.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function gS(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new i4;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=b4.bind(null,t,e,n),e.then(t,t))}function yS(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function xS(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Bo(-1,1),e.tag=2,Aa(n,e,1))),n.lanes|=1),t)}var o4=Qo.ReactCurrentOwner,Ls=!1;function vs(t,e,n,r){e.child=t===null?zN(e,null,n,r):vu(e,t.child,n,r)}function bS(t,e,n,r,s){n=n.render;var i=e.ref;return su(e,s),r=tv(t,e,n,r,i,s),n=nv(),t!==null&&!Ls?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,qo(t,e,s)):(sr&&n&&Hb(e),e.flags|=1,vs(t,e,r,s),e.child)}function vS(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!fv(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,dj(t,e,i,r,s)):(t=pp(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:sf,n(o,r)&&t.ref===e.ref)return qo(t,e,s)}return e.flags|=1,t=Pa(i,r),t.ref=e.ref,t.return=e,e.child=t}function dj(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(sf(i,r)&&t.ref===e.ref)if(Ls=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Ls=!0);else return e.lanes=t.lanes,qo(t,e,s)}return Mx(t,e,n,r,s)}function fj(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Kn(Hc,Xs),Xs|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Kn(Hc,Xs),Xs|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Kn(Hc,Xs),Xs|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Kn(Hc,Xs),Xs|=r;return vs(t,e,s,n),e.child}function hj(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Mx(t,e,n,r,s){var i=Bs(n)?Yl:ms.current;return i=xu(e,i),su(e,s),n=tv(t,e,n,r,i,s),r=nv(),t!==null&&!Ls?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,qo(t,e,s)):(sr&&r&&Hb(e),e.flags|=1,vs(t,e,n,s),e.child)}function wS(t,e,n,r,s){if(Bs(n)){var i=!0;Kp(e)}else i=!1;if(su(e,s),e.stateNode===null)dp(t,e),lj(e,n,r),jx(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=Mi(u):(u=Bs(n)?Yl:ms.current,u=xu(e,u));var d=n.getDerivedStateFromProps,f=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&mS(e,o,r,u),ha=!1;var h=e.memoizedState;o.state=h,Xp(e,r,o,s),l=e.memoizedState,a!==r||h!==l||Fs.current||ha?(typeof d=="function"&&(Nx(e,n,d,r),l=e.memoizedState),(a=ha||pS(e,n,a,r,h,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,BN(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:Ki(e.type,a),o.props=u,f=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Mi(l):(l=Bs(n)?Yl:ms.current,l=xu(e,l));var p=n.getDerivedStateFromProps;(d=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||h!==l)&&mS(e,o,r,l),ha=!1,h=e.memoizedState,o.state=h,Xp(e,r,o,s);var m=e.memoizedState;a!==f||h!==m||Fs.current||ha?(typeof p=="function"&&(Nx(e,n,p,r),m=e.memoizedState),(u=ha||pS(e,n,u,r,h,m,l)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),o.props=r,o.state=m,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return Dx(t,e,n,r,i,s)}function Dx(t,e,n,r,s,i){hj(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&oS(e,n,!1),qo(t,e,i);r=e.stateNode,o4.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=vu(e,t.child,null,i),e.child=vu(e,null,a,i)):vs(t,e,a,i),e.memoizedState=r.state,s&&oS(e,n,!0),e.child}function pj(t){var e=t.stateNode;e.pendingContext?iS(t,e.pendingContext,e.pendingContext!==e.context):e.context&&iS(t,e.context,!1),Xb(t,e.containerInfo)}function kS(t,e,n,r,s){return bu(),Wb(s),e.flags|=256,vs(t,e,n,r),e.child}var Ax={dehydrated:null,treeContext:null,retryLane:0};function Rx(t){return{baseLanes:t,cachePool:null,transitions:null}}function mj(t,e,n){var r=e.pendingProps,s=cr.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Kn(cr,s&1),t===null)return Cx(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=_g(o,r,0,null),t=zl(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Rx(n),e.memoizedState=Ax,t):iv(e,o));if(s=t.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return a4(t,e,o,r,a,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Pa(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Pa(a,i):(i=zl(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?Rx(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=Ax,r}return i=t.child,t=i.sibling,r=Pa(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function iv(t,e){return e=_g({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Ch(t,e,n,r){return r!==null&&Wb(r),vu(e,t.child,null,n),t=iv(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function a4(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=M0(Error(Rt(422))),Ch(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=_g({mode:"visible",children:r.children},s,0,null),i=zl(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&vu(e,t.child,null,o),e.child.memoizedState=Rx(o),e.memoizedState=Ax,i);if(!(e.mode&1))return Ch(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(Rt(419)),r=M0(i,r,void 0),Ch(t,e,o,r)}if(a=(o&t.childLanes)!==0,Ls||a){if(r=Br,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Go(t,s),Zi(r,t,s,-1))}return dv(),r=M0(Error(Rt(421))),Ch(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=v4.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,ti=Da(s.nextSibling),si=e,sr=!0,Ji=null,t!==null&&(bi[vi++]=$o,bi[vi++]=zo,bi[vi++]=Jl,$o=t.id,zo=t.overflow,Jl=e),e=iv(e,r.children),e.flags|=4096,e)}function SS(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Ex(t.return,e,n)}function D0(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function gj(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(vs(t,e,r.children,n),r=cr.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&SS(t,n,e);else if(t.tag===19)SS(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Kn(cr,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Qp(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),D0(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Qp(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}D0(e,!0,n,null,i);break;case"together":D0(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function dp(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function qo(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ql|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Rt(153));if(e.child!==null){for(t=e.child,n=Pa(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Pa(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function l4(t,e,n){switch(e.tag){case 3:pj(e),bu();break;case 5:UN(e);break;case 1:Bs(e.type)&&Kp(e);break;case 4:Xb(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Kn(Yp,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Kn(cr,cr.current&1),e.flags|=128,null):n&e.child.childLanes?mj(t,e,n):(Kn(cr,cr.current&1),t=qo(t,e,n),t!==null?t.sibling:null);Kn(cr,cr.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return gj(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Kn(cr,cr.current),r)break;return null;case 22:case 23:return e.lanes=0,fj(t,e,n)}return qo(t,e,n)}var yj,Ox,xj,bj;yj=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Ox=function(){};xj=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Nl(go.current);var i=null;switch(n){case"input":s=rx(t,s),r=rx(t,r),i=[];break;case"select":s=fr({},s,{value:void 0}),r=fr({},r,{value:void 0}),i=[];break;case"textarea":s=ox(t,s),r=ox(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Vp)}lx(n,r);var o;n=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Xd.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(i||(i=[]),i.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Xd.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&qn("scroll",t),i||a===l||(i=[])):(i=i||[]).push(u,l))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};bj=function(t,e,n,r){n!==r&&(e.flags|=4)};function ed(t,e){if(!sr)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function ls(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function c4(t,e,n){var r=e.pendingProps;switch(Vb(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ls(e),null;case 1:return Bs(e.type)&&Wp(),ls(e),null;case 3:return r=e.stateNode,wu(),Qn(Fs),Qn(ms),Zb(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(_h(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ji!==null&&(Hx(Ji),Ji=null))),Ox(t,e),ls(e),null;case 5:Qb(e);var s=Nl(uf.current);if(n=e.type,t!==null&&e.stateNode!=null)xj(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Rt(166));return ls(e),null}if(t=Nl(go.current),_h(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[lo]=e,r[lf]=i,t=(e.mode&1)!==0,n){case"dialog":qn("cancel",r),qn("close",r);break;case"iframe":case"object":case"embed":qn("load",r);break;case"video":case"audio":for(s=0;s<fd.length;s++)qn(fd[s],r);break;case"source":qn("error",r);break;case"img":case"image":case"link":qn("error",r),qn("load",r);break;case"details":qn("toggle",r);break;case"input":Dk(r,i),qn("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},qn("invalid",r);break;case"textarea":Rk(r,i),qn("invalid",r)}lx(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&Sh(r.textContent,a,t),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&Sh(r.textContent,a,t),s=["children",""+a]):Xd.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&qn("scroll",r)}switch(n){case"input":mh(r),Ak(r,i,!0);break;case"textarea":mh(r),Ok(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Vp)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=GE(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[lo]=e,t[lf]=r,yj(t,e,!1,!1),e.stateNode=t;e:{switch(o=cx(n,r),n){case"dialog":qn("cancel",t),qn("close",t),s=r;break;case"iframe":case"object":case"embed":qn("load",t),s=r;break;case"video":case"audio":for(s=0;s<fd.length;s++)qn(fd[s],t);s=r;break;case"source":qn("error",t),s=r;break;case"img":case"image":case"link":qn("error",t),qn("load",t),s=r;break;case"details":qn("toggle",t),s=r;break;case"input":Dk(t,r),s=rx(t,r),qn("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=fr({},r,{value:void 0}),qn("invalid",t);break;case"textarea":Rk(t,r),s=ox(t,r),qn("invalid",t);break;default:s=r}lx(n,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?JE(t,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&qE(t,l)):i==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Qd(t,l):typeof l=="number"&&Qd(t,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Xd.hasOwnProperty(i)?l!=null&&i==="onScroll"&&qn("scroll",t):l!=null&&jb(t,i,l,o))}switch(n){case"input":mh(t),Ak(t,r,!1);break;case"textarea":mh(t),Ok(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ha(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?eu(t,!!r.multiple,i,!1):r.defaultValue!=null&&eu(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Vp)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ls(e),null;case 6:if(t&&e.stateNode!=null)bj(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Rt(166));if(n=Nl(uf.current),Nl(go.current),_h(e)){if(r=e.stateNode,n=e.memoizedProps,r[lo]=e,(i=r.nodeValue!==n)&&(t=si,t!==null))switch(t.tag){case 3:Sh(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Sh(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[lo]=e,e.stateNode=r}return ls(e),null;case 13:if(Qn(cr),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(sr&&ti!==null&&e.mode&1&&!(e.flags&128))LN(),bu(),e.flags|=98560,i=!1;else if(i=_h(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(Rt(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Rt(317));i[lo]=e}else bu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ls(e),i=!1}else Ji!==null&&(Hx(Ji),Ji=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||cr.current&1?Or===0&&(Or=3):dv())),e.updateQueue!==null&&(e.flags|=4),ls(e),null);case 4:return wu(),Ox(t,e),t===null&&of(e.stateNode.containerInfo),ls(e),null;case 10:return qb(e.type._context),ls(e),null;case 17:return Bs(e.type)&&Wp(),ls(e),null;case 19:if(Qn(cr),i=e.memoizedState,i===null)return ls(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)ed(i,!1);else{if(Or!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Qp(t),o!==null){for(e.flags|=128,ed(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Kn(cr,cr.current&1|2),e.child}t=t.sibling}i.tail!==null&&wr()>Su&&(e.flags|=128,r=!0,ed(i,!1),e.lanes=4194304)}else{if(!r)if(t=Qp(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ed(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!sr)return ls(e),null}else 2*wr()-i.renderingStartTime>Su&&n!==1073741824&&(e.flags|=128,r=!0,ed(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=wr(),e.sibling=null,n=cr.current,Kn(cr,r?n&1|2:n&1),e):(ls(e),null);case 22:case 23:return uv(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Xs&1073741824&&(ls(e),e.subtreeFlags&6&&(e.flags|=8192)):ls(e),null;case 24:return null;case 25:return null}throw Error(Rt(156,e.tag))}function u4(t,e){switch(Vb(e),e.tag){case 1:return Bs(e.type)&&Wp(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return wu(),Qn(Fs),Qn(ms),Zb(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Qb(e),null;case 13:if(Qn(cr),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Rt(340));bu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Qn(cr),null;case 4:return wu(),null;case 10:return qb(e.type._context),null;case 22:case 23:return uv(),null;case 24:return null;default:return null}}var Eh=!1,fs=!1,d4=typeof WeakSet=="function"?WeakSet:Set,qt=null;function Uc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){gr(t,e,r)}else n.current=null}function Px(t,e,n){try{n()}catch(r){gr(t,e,r)}}var _S=!1;function f4(t,e){if(bx=Bp,t=_N(),Ub(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,u=0,d=0,f=t,h=null;t:for(;;){for(var p;f!==n||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(p=f.firstChild)!==null;)h=f,f=p;for(;;){if(f===t)break t;if(h===n&&++u===s&&(a=o),h===i&&++d===r&&(l=o),(p=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=p}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(vx={focusedElem:t,selectionRange:n},Bp=!1,qt=e;qt!==null;)if(e=qt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,qt=t;else for(;qt!==null;){e=qt;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var y=m.memoizedProps,b=m.memoizedState,g=e.stateNode,v=g.getSnapshotBeforeUpdate(e.elementType===e.type?y:Ki(e.type,y),b);g.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Rt(163))}}catch(C){gr(e,e.return,C)}if(t=e.sibling,t!==null){t.return=e.return,qt=t;break}qt=e.return}return m=_S,_S=!1,m}function Ed(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Px(e,n,i)}s=s.next}while(s!==r)}}function kg(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Lx(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function vj(t){var e=t.alternate;e!==null&&(t.alternate=null,vj(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[lo],delete e[lf],delete e[Sx],delete e[qP],delete e[YP])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function wj(t){return t.tag===5||t.tag===3||t.tag===4}function TS(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||wj(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function $x(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Vp));else if(r!==4&&(t=t.child,t!==null))for($x(t,e,n),t=t.sibling;t!==null;)$x(t,e,n),t=t.sibling}function zx(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(zx(t,e,n),t=t.sibling;t!==null;)zx(t,e,n),t=t.sibling}var Yr=null,qi=!1;function ia(t,e,n){for(n=n.child;n!==null;)kj(t,e,n),n=n.sibling}function kj(t,e,n){if(mo&&typeof mo.onCommitFiberUnmount=="function")try{mo.onCommitFiberUnmount(pg,n)}catch{}switch(n.tag){case 5:fs||Uc(n,e);case 6:var r=Yr,s=qi;Yr=null,ia(t,e,n),Yr=r,qi=s,Yr!==null&&(qi?(t=Yr,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Yr.removeChild(n.stateNode));break;case 18:Yr!==null&&(qi?(t=Yr,n=n.stateNode,t.nodeType===8?T0(t.parentNode,n):t.nodeType===1&&T0(t,n),nf(t)):T0(Yr,n.stateNode));break;case 4:r=Yr,s=qi,Yr=n.stateNode.containerInfo,qi=!0,ia(t,e,n),Yr=r,qi=s;break;case 0:case 11:case 14:case 15:if(!fs&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Px(n,e,o),s=s.next}while(s!==r)}ia(t,e,n);break;case 1:if(!fs&&(Uc(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){gr(n,e,a)}ia(t,e,n);break;case 21:ia(t,e,n);break;case 22:n.mode&1?(fs=(r=fs)||n.memoizedState!==null,ia(t,e,n),fs=r):ia(t,e,n);break;default:ia(t,e,n)}}function CS(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new d4),e.forEach(function(r){var s=w4.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function $i(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Yr=a.stateNode,qi=!1;break e;case 3:Yr=a.stateNode.containerInfo,qi=!0;break e;case 4:Yr=a.stateNode.containerInfo,qi=!0;break e}a=a.return}if(Yr===null)throw Error(Rt(160));kj(i,o,s),Yr=null,qi=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){gr(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Sj(e,t),e=e.sibling}function Sj(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if($i(e,t),to(t),r&4){try{Ed(3,t,t.return),kg(3,t)}catch(y){gr(t,t.return,y)}try{Ed(5,t,t.return)}catch(y){gr(t,t.return,y)}}break;case 1:$i(e,t),to(t),r&512&&n!==null&&Uc(n,n.return);break;case 5:if($i(e,t),to(t),r&512&&n!==null&&Uc(n,n.return),t.flags&32){var s=t.stateNode;try{Qd(s,"")}catch(y){gr(t,t.return,y)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&WE(s,i),cx(a,o);var u=cx(a,i);for(o=0;o<l.length;o+=2){var d=l[o],f=l[o+1];d==="style"?JE(s,f):d==="dangerouslySetInnerHTML"?qE(s,f):d==="children"?Qd(s,f):jb(s,d,f,u)}switch(a){case"input":sx(s,i);break;case"textarea":KE(s,i);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?eu(s,!!i.multiple,p,!1):h!==!!i.multiple&&(i.defaultValue!=null?eu(s,!!i.multiple,i.defaultValue,!0):eu(s,!!i.multiple,i.multiple?[]:"",!1))}s[lf]=i}catch(y){gr(t,t.return,y)}}break;case 6:if($i(e,t),to(t),r&4){if(t.stateNode===null)throw Error(Rt(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(y){gr(t,t.return,y)}}break;case 3:if($i(e,t),to(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{nf(e.containerInfo)}catch(y){gr(t,t.return,y)}break;case 4:$i(e,t),to(t);break;case 13:$i(e,t),to(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(lv=wr())),r&4&&CS(t);break;case 22:if(d=n!==null&&n.memoizedState!==null,t.mode&1?(fs=(u=fs)||d,$i(e,t),fs=u):$i(e,t),to(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!d&&t.mode&1)for(qt=t,d=t.child;d!==null;){for(f=qt=d;qt!==null;){switch(h=qt,p=h.child,h.tag){case 0:case 11:case 14:case 15:Ed(4,h,h.return);break;case 1:Uc(h,h.return);var m=h.stateNode;if(typeof m.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(y){gr(r,n,y)}}break;case 5:Uc(h,h.return);break;case 22:if(h.memoizedState!==null){NS(f);continue}}p!==null?(p.return=h,qt=p):NS(f)}d=d.sibling}e:for(d=null,f=t;;){if(f.tag===5){if(d===null){d=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=YE("display",o))}catch(y){gr(t,t.return,y)}}}else if(f.tag===6){if(d===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(y){gr(t,t.return,y)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:$i(e,t),to(t),r&4&&CS(t);break;case 21:break;default:$i(e,t),to(t)}}function to(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(wj(n)){var r=n;break e}n=n.return}throw Error(Rt(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Qd(s,""),r.flags&=-33);var i=TS(t);zx(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=TS(t);$x(t,a,o);break;default:throw Error(Rt(161))}}catch(l){gr(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function h4(t,e,n){qt=t,_j(t)}function _j(t,e,n){for(var r=(t.mode&1)!==0;qt!==null;){var s=qt,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Eh;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||fs;a=Eh;var u=fs;if(Eh=o,(fs=l)&&!u)for(qt=s;qt!==null;)o=qt,l=o.child,o.tag===22&&o.memoizedState!==null?jS(s):l!==null?(l.return=o,qt=l):jS(s);for(;i!==null;)qt=i,_j(i),i=i.sibling;qt=s,Eh=a,fs=u}ES(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,qt=i):ES(t)}}function ES(t){for(;qt!==null;){var e=qt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:fs||kg(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!fs)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Ki(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&dS(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}dS(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var f=d.dehydrated;f!==null&&nf(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Rt(163))}fs||e.flags&512&&Lx(e)}catch(h){gr(e,e.return,h)}}if(e===t){qt=null;break}if(n=e.sibling,n!==null){n.return=e.return,qt=n;break}qt=e.return}}function NS(t){for(;qt!==null;){var e=qt;if(e===t){qt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,qt=n;break}qt=e.return}}function jS(t){for(;qt!==null;){var e=qt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{kg(4,e)}catch(l){gr(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){gr(e,s,l)}}var i=e.return;try{Lx(e)}catch(l){gr(e,i,l)}break;case 5:var o=e.return;try{Lx(e)}catch(l){gr(e,o,l)}}}catch(l){gr(e,e.return,l)}if(e===t){qt=null;break}var a=e.sibling;if(a!==null){a.return=e.return,qt=a;break}qt=e.return}}var p4=Math.ceil,tm=Qo.ReactCurrentDispatcher,ov=Qo.ReactCurrentOwner,Ci=Qo.ReactCurrentBatchConfig,Mn=0,Br=null,Cr=null,es=0,Xs=0,Hc=Xa(0),Or=0,pf=null,Ql=0,Sg=0,av=0,Nd=null,Rs=null,lv=0,Su=1/0,Ao=null,nm=!1,Fx=null,Ra=null,Nh=!1,Ta=null,rm=0,jd=0,Bx=null,fp=-1,hp=0;function Ss(){return Mn&6?wr():fp!==-1?fp:fp=wr()}function Oa(t){return t.mode&1?Mn&2&&es!==0?es&-es:XP.transition!==null?(hp===0&&(hp=lN()),hp):(t=$n,t!==0||(t=window.event,t=t===void 0?16:mN(t.type)),t):1}function Zi(t,e,n,r){if(50<jd)throw jd=0,Bx=null,Error(Rt(185));Kf(t,n,r),(!(Mn&2)||t!==Br)&&(t===Br&&(!(Mn&2)&&(Sg|=n),Or===4&&va(t,es)),Us(t,r),n===1&&Mn===0&&!(e.mode&1)&&(Su=wr()+500,bg&&Qa()))}function Us(t,e){var n=t.callbackNode;XO(t,e);var r=Fp(t,t===Br?es:0);if(r===0)n!==null&&$k(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&$k(n),e===1)t.tag===0?JP(IS.bind(null,t)):RN(IS.bind(null,t)),KP(function(){!(Mn&6)&&Qa()}),n=null;else{switch(cN(r)){case 1:n=Rb;break;case 4:n=oN;break;case 16:n=zp;break;case 536870912:n=aN;break;default:n=zp}n=Dj(n,Tj.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Tj(t,e){if(fp=-1,hp=0,Mn&6)throw Error(Rt(327));var n=t.callbackNode;if(iu()&&t.callbackNode!==n)return null;var r=Fp(t,t===Br?es:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=sm(t,r);else{e=r;var s=Mn;Mn|=2;var i=Ej();(Br!==t||es!==e)&&(Ao=null,Su=wr()+500,$l(t,e));do try{y4();break}catch(a){Cj(t,a)}while(1);Gb(),tm.current=i,Mn=s,Cr!==null?e=0:(Br=null,es=0,e=Or)}if(e!==0){if(e===2&&(s=px(t),s!==0&&(r=s,e=Ux(t,s))),e===1)throw n=pf,$l(t,0),va(t,r),Us(t,wr()),n;if(e===6)va(t,r);else{if(s=t.current.alternate,!(r&30)&&!m4(s)&&(e=sm(t,r),e===2&&(i=px(t),i!==0&&(r=i,e=Ux(t,i))),e===1))throw n=pf,$l(t,0),va(t,r),Us(t,wr()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(Rt(345));case 2:ml(t,Rs,Ao);break;case 3:if(va(t,r),(r&130023424)===r&&(e=lv+500-wr(),10<e)){if(Fp(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Ss(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=kx(ml.bind(null,t,Rs,Ao),e);break}ml(t,Rs,Ao);break;case 4:if(va(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-Qi(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=wr()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*p4(r/1960))-r,10<r){t.timeoutHandle=kx(ml.bind(null,t,Rs,Ao),r);break}ml(t,Rs,Ao);break;case 5:ml(t,Rs,Ao);break;default:throw Error(Rt(329))}}}return Us(t,wr()),t.callbackNode===n?Tj.bind(null,t):null}function Ux(t,e){var n=Nd;return t.current.memoizedState.isDehydrated&&($l(t,e).flags|=256),t=sm(t,e),t!==2&&(e=Rs,Rs=n,e!==null&&Hx(e)),t}function Hx(t){Rs===null?Rs=t:Rs.push.apply(Rs,t)}function m4(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!eo(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function va(t,e){for(e&=~av,e&=~Sg,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Qi(e),r=1<<n;t[n]=-1,e&=~r}}function IS(t){if(Mn&6)throw Error(Rt(327));iu();var e=Fp(t,0);if(!(e&1))return Us(t,wr()),null;var n=sm(t,e);if(t.tag!==0&&n===2){var r=px(t);r!==0&&(e=r,n=Ux(t,r))}if(n===1)throw n=pf,$l(t,0),va(t,e),Us(t,wr()),n;if(n===6)throw Error(Rt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ml(t,Rs,Ao),Us(t,wr()),null}function cv(t,e){var n=Mn;Mn|=1;try{return t(e)}finally{Mn=n,Mn===0&&(Su=wr()+500,bg&&Qa())}}function Zl(t){Ta!==null&&Ta.tag===0&&!(Mn&6)&&iu();var e=Mn;Mn|=1;var n=Ci.transition,r=$n;try{if(Ci.transition=null,$n=1,t)return t()}finally{$n=r,Ci.transition=n,Mn=e,!(Mn&6)&&Qa()}}function uv(){Xs=Hc.current,Qn(Hc)}function $l(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,WP(n)),Cr!==null)for(n=Cr.return;n!==null;){var r=n;switch(Vb(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Wp();break;case 3:wu(),Qn(Fs),Qn(ms),Zb();break;case 5:Qb(r);break;case 4:wu();break;case 13:Qn(cr);break;case 19:Qn(cr);break;case 10:qb(r.type._context);break;case 22:case 23:uv()}n=n.return}if(Br=t,Cr=t=Pa(t.current,null),es=Xs=e,Or=0,pf=null,av=Sg=Ql=0,Rs=Nd=null,El!==null){for(e=0;e<El.length;e++)if(n=El[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}El=null}return t}function Cj(t,e){do{var n=Cr;try{if(Gb(),cp.current=em,Zp){for(var r=dr.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Zp=!1}if(Xl=0,$r=Rr=dr=null,Cd=!1,df=0,ov.current=null,n===null||n.return===null){Or=1,pf=e,Cr=null;break}e:{var i=t,o=n.return,a=n,l=e;if(e=es,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,d=a,f=d.tag;if(!(d.mode&1)&&(f===0||f===11||f===15)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=yS(o);if(p!==null){p.flags&=-257,xS(p,o,a,i,e),p.mode&1&&gS(i,u,e),e=p,l=u;var m=e.updateQueue;if(m===null){var y=new Set;y.add(l),e.updateQueue=y}else m.add(l);break e}else{if(!(e&1)){gS(i,u,e),dv();break e}l=Error(Rt(426))}}else if(sr&&a.mode&1){var b=yS(o);if(b!==null){!(b.flags&65536)&&(b.flags|=256),xS(b,o,a,i,e),Wb(ku(l,a));break e}}i=l=ku(l,a),Or!==4&&(Or=2),Nd===null?Nd=[i]:Nd.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var g=cj(i,l,e);uS(i,g);break e;case 1:a=l;var v=i.type,w=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Ra===null||!Ra.has(w)))){i.flags|=65536,e&=-e,i.lanes|=e;var C=uj(i,a,e);uS(i,C);break e}}i=i.return}while(i!==null)}jj(n)}catch(I){e=I,Cr===n&&n!==null&&(Cr=n=n.return);continue}break}while(1)}function Ej(){var t=tm.current;return tm.current=em,t===null?em:t}function dv(){(Or===0||Or===3||Or===2)&&(Or=4),Br===null||!(Ql&268435455)&&!(Sg&268435455)||va(Br,es)}function sm(t,e){var n=Mn;Mn|=2;var r=Ej();(Br!==t||es!==e)&&(Ao=null,$l(t,e));do try{g4();break}catch(s){Cj(t,s)}while(1);if(Gb(),Mn=n,tm.current=r,Cr!==null)throw Error(Rt(261));return Br=null,es=0,Or}function g4(){for(;Cr!==null;)Nj(Cr)}function y4(){for(;Cr!==null&&!UO();)Nj(Cr)}function Nj(t){var e=Mj(t.alternate,t,Xs);t.memoizedProps=t.pendingProps,e===null?jj(t):Cr=e,ov.current=null}function jj(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=u4(n,e),n!==null){n.flags&=32767,Cr=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Or=6,Cr=null;return}}else if(n=c4(n,e,Xs),n!==null){Cr=n;return}if(e=e.sibling,e!==null){Cr=e;return}Cr=e=t}while(e!==null);Or===0&&(Or=5)}function ml(t,e,n){var r=$n,s=Ci.transition;try{Ci.transition=null,$n=1,x4(t,e,n,r)}finally{Ci.transition=s,$n=r}return null}function x4(t,e,n,r){do iu();while(Ta!==null);if(Mn&6)throw Error(Rt(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Rt(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(QO(t,i),t===Br&&(Cr=Br=null,es=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Nh||(Nh=!0,Dj(zp,function(){return iu(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Ci.transition,Ci.transition=null;var o=$n;$n=1;var a=Mn;Mn|=4,ov.current=null,f4(t,n),Sj(n,t),$P(vx),Bp=!!bx,vx=bx=null,t.current=n,h4(n),HO(),Mn=a,$n=o,Ci.transition=i}else t.current=n;if(Nh&&(Nh=!1,Ta=t,rm=s),i=t.pendingLanes,i===0&&(Ra=null),KO(n.stateNode),Us(t,wr()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(nm)throw nm=!1,t=Fx,Fx=null,t;return rm&1&&t.tag!==0&&iu(),i=t.pendingLanes,i&1?t===Bx?jd++:(jd=0,Bx=t):jd=0,Qa(),null}function iu(){if(Ta!==null){var t=cN(rm),e=Ci.transition,n=$n;try{if(Ci.transition=null,$n=16>t?16:t,Ta===null)var r=!1;else{if(t=Ta,Ta=null,rm=0,Mn&6)throw Error(Rt(331));var s=Mn;for(Mn|=4,qt=t.current;qt!==null;){var i=qt,o=i.child;if(qt.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(qt=u;qt!==null;){var d=qt;switch(d.tag){case 0:case 11:case 15:Ed(8,d,i)}var f=d.child;if(f!==null)f.return=d,qt=f;else for(;qt!==null;){d=qt;var h=d.sibling,p=d.return;if(vj(d),d===u){qt=null;break}if(h!==null){h.return=p,qt=h;break}qt=p}}}var m=i.alternate;if(m!==null){var y=m.child;if(y!==null){m.child=null;do{var b=y.sibling;y.sibling=null,y=b}while(y!==null)}}qt=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,qt=o;else e:for(;qt!==null;){if(i=qt,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Ed(9,i,i.return)}var g=i.sibling;if(g!==null){g.return=i.return,qt=g;break e}qt=i.return}}var v=t.current;for(qt=v;qt!==null;){o=qt;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,qt=w;else e:for(o=v;qt!==null;){if(a=qt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:kg(9,a)}}catch(I){gr(a,a.return,I)}if(a===o){qt=null;break e}var C=a.sibling;if(C!==null){C.return=a.return,qt=C;break e}qt=a.return}}if(Mn=s,Qa(),mo&&typeof mo.onPostCommitFiberRoot=="function")try{mo.onPostCommitFiberRoot(pg,t)}catch{}r=!0}return r}finally{$n=n,Ci.transition=e}}return!1}function MS(t,e,n){e=ku(n,e),e=cj(t,e,1),t=Aa(t,e,1),e=Ss(),t!==null&&(Kf(t,1,e),Us(t,e))}function gr(t,e,n){if(t.tag===3)MS(t,t,n);else for(;e!==null;){if(e.tag===3){MS(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ra===null||!Ra.has(r))){t=ku(n,t),t=uj(e,t,1),e=Aa(e,t,1),t=Ss(),e!==null&&(Kf(e,1,t),Us(e,t));break}}e=e.return}}function b4(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Ss(),t.pingedLanes|=t.suspendedLanes&n,Br===t&&(es&n)===n&&(Or===4||Or===3&&(es&130023424)===es&&500>wr()-lv?$l(t,0):av|=n),Us(t,e)}function Ij(t,e){e===0&&(t.mode&1?(e=xh,xh<<=1,!(xh&130023424)&&(xh=4194304)):e=1);var n=Ss();t=Go(t,e),t!==null&&(Kf(t,e,n),Us(t,n))}function v4(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Ij(t,n)}function w4(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Rt(314))}r!==null&&r.delete(e),Ij(t,n)}var Mj;Mj=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Fs.current)Ls=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ls=!1,l4(t,e,n);Ls=!!(t.flags&131072)}else Ls=!1,sr&&e.flags&1048576&&ON(e,qp,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;dp(t,e),t=e.pendingProps;var s=xu(e,ms.current);su(e,n),s=tv(null,e,r,t,s,n);var i=nv();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Bs(r)?(i=!0,Kp(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Jb(e),s.updater=wg,e.stateNode=s,s._reactInternals=e,jx(e,r,t,n),e=Dx(null,e,r,!0,i,n)):(e.tag=0,sr&&i&&Hb(e),vs(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(dp(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=S4(r),t=Ki(r,t),s){case 0:e=Mx(null,e,r,t,n);break e;case 1:e=wS(null,e,r,t,n);break e;case 11:e=bS(null,e,r,t,n);break e;case 14:e=vS(null,e,r,Ki(r.type,t),n);break e}throw Error(Rt(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ki(r,s),Mx(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ki(r,s),wS(t,e,r,s,n);case 3:e:{if(pj(e),t===null)throw Error(Rt(387));r=e.pendingProps,i=e.memoizedState,s=i.element,BN(t,e),Xp(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=ku(Error(Rt(423)),e),e=kS(t,e,r,n,s);break e}else if(r!==s){s=ku(Error(Rt(424)),e),e=kS(t,e,r,n,s);break e}else for(ti=Da(e.stateNode.containerInfo.firstChild),si=e,sr=!0,Ji=null,n=zN(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(bu(),r===s){e=qo(t,e,n);break e}vs(t,e,r,n)}e=e.child}return e;case 5:return UN(e),t===null&&Cx(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,wx(r,s)?o=null:i!==null&&wx(r,i)&&(e.flags|=32),hj(t,e),vs(t,e,o,n),e.child;case 6:return t===null&&Cx(e),null;case 13:return mj(t,e,n);case 4:return Xb(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=vu(e,null,r,n):vs(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ki(r,s),bS(t,e,r,s,n);case 7:return vs(t,e,e.pendingProps,n),e.child;case 8:return vs(t,e,e.pendingProps.children,n),e.child;case 12:return vs(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Kn(Yp,r._currentValue),r._currentValue=o,i!==null)if(eo(i.value,o)){if(i.children===s.children&&!Fs.current){e=qo(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=Bo(-1,n&-n),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}i.lanes|=n,l=i.alternate,l!==null&&(l.lanes|=n),Ex(i.return,n,e),a.lanes|=n;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(Rt(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Ex(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}vs(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,su(e,n),s=Mi(s),r=r(s),e.flags|=1,vs(t,e,r,n),e.child;case 14:return r=e.type,s=Ki(r,e.pendingProps),s=Ki(r.type,s),vS(t,e,r,s,n);case 15:return dj(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ki(r,s),dp(t,e),e.tag=1,Bs(r)?(t=!0,Kp(e)):t=!1,su(e,n),lj(e,r,s),jx(e,r,s,n),Dx(null,e,r,!0,t,n);case 19:return gj(t,e,n);case 22:return fj(t,e,n)}throw Error(Rt(156,e.tag))};function Dj(t,e){return iN(t,e)}function k4(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Si(t,e,n,r){return new k4(t,e,n,r)}function fv(t){return t=t.prototype,!(!t||!t.isReactComponent)}function S4(t){if(typeof t=="function")return fv(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Mb)return 11;if(t===Db)return 14}return 2}function Pa(t,e){var n=t.alternate;return n===null?(n=Si(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function pp(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")fv(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Ac:return zl(n.children,s,i,e);case Ib:o=8,s|=8;break;case Zy:return t=Si(12,n,e,s|2),t.elementType=Zy,t.lanes=i,t;case ex:return t=Si(13,n,e,s),t.elementType=ex,t.lanes=i,t;case tx:return t=Si(19,n,e,s),t.elementType=tx,t.lanes=i,t;case UE:return _g(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case FE:o=10;break e;case BE:o=9;break e;case Mb:o=11;break e;case Db:o=14;break e;case fa:o=16,r=null;break e}throw Error(Rt(130,t==null?t:typeof t,""))}return e=Si(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function zl(t,e,n,r){return t=Si(7,t,r,e),t.lanes=n,t}function _g(t,e,n,r){return t=Si(22,t,r,e),t.elementType=UE,t.lanes=n,t.stateNode={isHidden:!1},t}function A0(t,e,n){return t=Si(6,t,null,e),t.lanes=n,t}function R0(t,e,n){return e=Si(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function _4(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=p0(0),this.expirationTimes=p0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=p0(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function hv(t,e,n,r,s,i,o,a,l){return t=new _4(t,e,n,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Si(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Jb(i),t}function T4(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Dc,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Aj(t){if(!t)return Va;t=t._reactInternals;e:{if(ac(t)!==t||t.tag!==1)throw Error(Rt(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Bs(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Rt(171))}if(t.tag===1){var n=t.type;if(Bs(n))return AN(t,n,e)}return e}function Rj(t,e,n,r,s,i,o,a,l){return t=hv(n,r,!0,t,s,i,o,a,l),t.context=Aj(null),n=t.current,r=Ss(),s=Oa(n),i=Bo(r,s),i.callback=e??null,Aa(n,i,s),t.current.lanes=s,Kf(t,s,r),Us(t,r),t}function Tg(t,e,n,r){var s=e.current,i=Ss(),o=Oa(s);return n=Aj(n),e.context===null?e.context=n:e.pendingContext=n,e=Bo(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Aa(s,e,o),t!==null&&(Zi(t,s,o,i),lp(t,s,o)),o}function im(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function DS(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function pv(t,e){DS(t,e),(t=t.alternate)&&DS(t,e)}function C4(){return null}var Oj=typeof reportError=="function"?reportError:function(t){console.error(t)};function mv(t){this._internalRoot=t}Cg.prototype.render=mv.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Rt(409));Tg(t,e,null,null)};Cg.prototype.unmount=mv.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Zl(function(){Tg(null,t,null,null)}),e[Ko]=null}};function Cg(t){this._internalRoot=t}Cg.prototype.unstable_scheduleHydration=function(t){if(t){var e=fN();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ba.length&&e!==0&&e<ba[n].priority;n++);ba.splice(n,0,t),n===0&&pN(t)}};function gv(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Eg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function AS(){}function E4(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=im(o);i.call(u)}}var o=Rj(e,r,t,0,null,!1,!1,"",AS);return t._reactRootContainer=o,t[Ko]=o.current,of(t.nodeType===8?t.parentNode:t),Zl(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=im(l);a.call(u)}}var l=hv(t,0,!1,null,null,!1,!1,"",AS);return t._reactRootContainer=l,t[Ko]=l.current,of(t.nodeType===8?t.parentNode:t),Zl(function(){Tg(e,l,n,r)}),l}function Ng(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=im(o);a.call(l)}}Tg(e,o,t,s)}else o=E4(n,e,t,s,r);return im(o)}uN=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=dd(e.pendingLanes);n!==0&&(Ob(e,n|1),Us(e,wr()),!(Mn&6)&&(Su=wr()+500,Qa()))}break;case 13:Zl(function(){var r=Go(t,1);if(r!==null){var s=Ss();Zi(r,t,1,s)}}),pv(t,1)}};Pb=function(t){if(t.tag===13){var e=Go(t,134217728);if(e!==null){var n=Ss();Zi(e,t,134217728,n)}pv(t,134217728)}};dN=function(t){if(t.tag===13){var e=Oa(t),n=Go(t,e);if(n!==null){var r=Ss();Zi(n,t,e,r)}pv(t,e)}};fN=function(){return $n};hN=function(t,e){var n=$n;try{return $n=t,e()}finally{$n=n}};dx=function(t,e,n){switch(e){case"input":if(sx(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=xg(r);if(!s)throw Error(Rt(90));VE(r),sx(r,s)}}}break;case"textarea":KE(t,n);break;case"select":e=n.value,e!=null&&eu(t,!!n.multiple,e,!1)}};ZE=cv;eN=Zl;var N4={usingClientEntryPoint:!1,Events:[qf,Lc,xg,XE,QE,cv]},td={findFiberByHostInstance:Cl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},j4={bundleType:td.bundleType,version:td.version,rendererPackageName:td.rendererPackageName,rendererConfig:td.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Qo.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=rN(t),t===null?null:t.stateNode},findFiberByHostInstance:td.findFiberByHostInstance||C4,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var jh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!jh.isDisabled&&jh.supportsFiber)try{pg=jh.inject(j4),mo=jh}catch{}}ai.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=N4;ai.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!gv(e))throw Error(Rt(200));return T4(t,e,null,n)};ai.createRoot=function(t,e){if(!gv(t))throw Error(Rt(299));var n=!1,r="",s=Oj;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=hv(t,1,!1,null,null,n,!1,r,s),t[Ko]=e.current,of(t.nodeType===8?t.parentNode:t),new mv(e)};ai.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Rt(188)):(t=Object.keys(t).join(","),Error(Rt(268,t)));return t=rN(e),t=t===null?null:t.stateNode,t};ai.flushSync=function(t){return Zl(t)};ai.hydrate=function(t,e,n){if(!Eg(e))throw Error(Rt(200));return Ng(null,t,e,!0,n)};ai.hydrateRoot=function(t,e,n){if(!gv(t))throw Error(Rt(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=Oj;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Rj(e,null,t,1,n??null,s,!1,i,o),t[Ko]=e.current,of(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Cg(e)};ai.render=function(t,e,n){if(!Eg(e))throw Error(Rt(200));return Ng(null,t,e,!1,n)};ai.unmountComponentAtNode=function(t){if(!Eg(t))throw Error(Rt(40));return t._reactRootContainer?(Zl(function(){Ng(null,null,t,!1,function(){t._reactRootContainer=null,t[Ko]=null})}),!0):!1};ai.unstable_batchedUpdates=cv;ai.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Eg(n))throw Error(Rt(200));if(t==null||t._reactInternals===void 0)throw Error(Rt(38));return Ng(t,e,n,!1,r)};ai.version="18.3.1-next-f1338f8080-20240426";function Pj(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Pj)}catch(t){console.error(t)}}Pj(),PE.exports=ai;var ir=PE.exports;const I4=fg(ir);var RS=ir;Xy.createRoot=RS.createRoot,Xy.hydrateRoot=RS.hydrateRoot;const M4="modulepreload",D4=function(t){return"/"+t},OS={},yv=function(e,n,r){if(!n||n.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(n.map(i=>{if(i=D4(i),i in OS)return;OS[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":M4,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((d,f)=>{u.addEventListener("load",d),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};var PS="popstate";function A4(t={}){function e(r,s){let{pathname:i,search:o,hash:a}=r.location;return Vx("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:mf(s)}return O4(e,n,null,t)}function or(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ai(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function R4(){return Math.random().toString(36).substring(2,10)}function LS(t,e){return{usr:t.state,key:t.key,idx:e}}function Vx(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Ru(e):e,state:n,key:e&&e.key||r||R4()}}function mf({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Ru(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function O4(t,e,n,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a="POP",l=null,u=d();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function d(){return(o.state||{idx:null}).idx}function f(){a="POP";let b=d(),g=b==null?null:b-u;u=b,l&&l({action:a,location:y.location,delta:g})}function h(b,g){a="PUSH";let v=Vx(y.location,b,g);n&&n(v,b),u=d()+1;let w=LS(v,u),C=y.createHref(v);try{o.pushState(w,"",C)}catch(I){if(I instanceof DOMException&&I.name==="DataCloneError")throw I;s.location.assign(C)}i&&l&&l({action:a,location:y.location,delta:1})}function p(b,g){a="REPLACE";let v=Vx(y.location,b,g);n&&n(v,b),u=d();let w=LS(v,u),C=y.createHref(v);o.replaceState(w,"",C),i&&l&&l({action:a,location:y.location,delta:0})}function m(b){return P4(b)}let y={get action(){return a},get location(){return t(s,o)},listen(b){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(PS,f),l=b,()=>{s.removeEventListener(PS,f),l=null}},createHref(b){return e(s,b)},createURL:m,encodeLocation(b){let g=m(b);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:h,replace:p,go(b){return o.go(b)}};return y}function P4(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),or(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:mf(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function Lj(t,e,n="/"){return L4(t,e,n,!1)}function L4(t,e,n,r){let s=typeof e=="string"?Ru(e):e,i=Yo(s.pathname||"/",n);if(i==null)return null;let o=$j(t);$4(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let u=Y4(i);a=G4(o[l],u,r)}return a}function $j(t,e=[],n=[],r="",s=!1){let i=(o,a,l=s,u)=>{let d={relativePath:u===void 0?o.path||"":u,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};if(d.relativePath.startsWith("/")){if(!d.relativePath.startsWith(r)&&l)return;or(d.relativePath.startsWith(r),`Absolute route path "${d.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),d.relativePath=d.relativePath.slice(r.length)}let f=Uo([r,d.relativePath]),h=n.concat(d);o.children&&o.children.length>0&&(or(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${f}".`),$j(o.children,e,h,f,l)),!(o.path==null&&!o.index)&&e.push({path:f,score:W4(f,o.index),routesMeta:h})};return t.forEach((o,a)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))i(o,a);else for(let u of zj(o.path))i(o,a,!0,u)}),e}function zj(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=zj(r.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function $4(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:K4(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var z4=/^:[\w-]+$/,F4=3,B4=2,U4=1,H4=10,V4=-2,$S=t=>t==="*";function W4(t,e){let n=t.split("/"),r=n.length;return n.some($S)&&(r+=V4),e&&(r+=B4),n.filter(s=>!$S(s)).reduce((s,i)=>s+(z4.test(i)?F4:i===""?U4:H4),r)}function K4(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function G4(t,e,n=!1){let{routesMeta:r}=t,s={},i="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],u=a===r.length-1,d=i==="/"?e:e.slice(i.length)||"/",f=om({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},d),h=l.route;if(!f&&u&&n&&!r[r.length-1].route.index&&(f=om({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},d)),!f)return null;Object.assign(s,f.params),o.push({params:s,pathname:Uo([i,f.pathname]),pathnameBase:Z4(Uo([i,f.pathnameBase])),route:h}),f.pathnameBase!=="/"&&(i=Uo([i,f.pathnameBase]))}return o}function om(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=q4(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((u,{paramName:d,isOptional:f},h)=>{if(d==="*"){let m=a[h]||"";o=i.slice(0,i.length-m.length).replace(/(.)\/+$/,"$1")}const p=a[h];return f&&!p?u[d]=void 0:u[d]=(p||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:t}}function q4(t,e=!1,n=!0){Ai(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function Y4(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ai(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Yo(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var Fj=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,J4=t=>Fj.test(t);function X4(t,e="/"){let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?Ru(t):t,i;if(n)if(J4(n))i=n;else{if(n.includes("//")){let o=n;n=n.replace(/\/\/+/g,"/"),Ai(!1,`Pathnames cannot have embedded double slashes - normalizing ${o} -> ${n}`)}n.startsWith("/")?i=zS(n.substring(1),"/"):i=zS(n,e)}else i=e;return{pathname:i,search:e3(r),hash:t3(s)}}function zS(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function O0(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Q4(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function xv(t){let e=Q4(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function bv(t,e,n,r=!1){let s;typeof t=="string"?s=Ru(t):(s={...t},or(!s.pathname||!s.pathname.includes("?"),O0("?","pathname","search",s)),or(!s.pathname||!s.pathname.includes("#"),O0("#","pathname","hash",s)),or(!s.search||!s.search.includes("#"),O0("#","search","hash",s)));let i=t===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=n;else{let f=e.length-1;if(!r&&o.startsWith("..")){let h=o.split("/");for(;h[0]==="..";)h.shift(),f-=1;s.pathname=h.join("/")}a=f>=0?e[f]:"/"}let l=X4(s,a),u=o&&o!=="/"&&o.endsWith("/"),d=(i||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(u||d)&&(l.pathname+="/"),l}var Uo=t=>t.join("/").replace(/\/\/+/g,"/"),Z4=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),e3=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,t3=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,n3=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function r3(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function s3(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Bj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Uj(t,e){let n=t;if(typeof n!="string"||!Fj.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,s=!1;if(Bj)try{let i=new URL(window.location.href),o=n.startsWith("//")?new URL(i.protocol+n):new URL(n),a=Yo(o.pathname,e);o.origin===i.origin&&a!=null?n=a+o.search+o.hash:s=!0}catch{Ai(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:s,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Hj=["POST","PUT","PATCH","DELETE"];new Set(Hj);var i3=["GET",...Hj];new Set(i3);var Ou=x.createContext(null);Ou.displayName="DataRouter";var jg=x.createContext(null);jg.displayName="DataRouterState";var o3=x.createContext(!1),Vj=x.createContext({isTransitioning:!1});Vj.displayName="ViewTransition";var a3=x.createContext(new Map);a3.displayName="Fetchers";var l3=x.createContext(null);l3.displayName="Await";var ci=x.createContext(null);ci.displayName="Navigation";var Jf=x.createContext(null);Jf.displayName="Location";var To=x.createContext({outlet:null,matches:[],isDataRoute:!1});To.displayName="Route";var vv=x.createContext(null);vv.displayName="RouteError";var Wj="REACT_ROUTER_ERROR",c3="REDIRECT",u3="ROUTE_ERROR_RESPONSE";function d3(t){if(t.startsWith(`${Wj}:${c3}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function f3(t){if(t.startsWith(`${Wj}:${u3}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new n3(e.status,e.statusText,e.data)}catch{}}function h3(t,{relative:e}={}){or(Pu(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=x.useContext(ci),{hash:s,pathname:i,search:o}=Xf(t,{relative:e}),a=i;return n!=="/"&&(a=i==="/"?n:Uo([n,i])),r.createHref({pathname:a,search:o,hash:s})}function Pu(){return x.useContext(Jf)!=null}function Za(){return or(Pu(),"useLocation() may be used only in the context of a <Router> component."),x.useContext(Jf).location}var Kj="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Gj(t){x.useContext(ci).static||x.useLayoutEffect(t)}function qj(){let{isDataRoute:t}=x.useContext(To);return t?C3():p3()}function p3(){or(Pu(),"useNavigate() may be used only in the context of a <Router> component.");let t=x.useContext(Ou),{basename:e,navigator:n}=x.useContext(ci),{matches:r}=x.useContext(To),{pathname:s}=Za(),i=JSON.stringify(xv(r)),o=x.useRef(!1);return Gj(()=>{o.current=!0}),x.useCallback((l,u={})=>{if(Ai(o.current,Kj),!o.current)return;if(typeof l=="number"){n.go(l);return}let d=bv(l,JSON.parse(i),s,u.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Uo([e,d.pathname])),(u.replace?n.replace:n.push)(d,u.state,u)},[e,n,i,s,t])}x.createContext(null);function Xf(t,{relative:e}={}){let{matches:n}=x.useContext(To),{pathname:r}=Za(),s=JSON.stringify(xv(n));return x.useMemo(()=>bv(t,JSON.parse(s),r,e==="path"),[t,s,r,e])}function m3(t,e){return Yj(t,e)}function Yj(t,e,n,r,s){var v;or(Pu(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=x.useContext(ci),{matches:o}=x.useContext(To),a=o[o.length-1],l=a?a.params:{},u=a?a.pathname:"/",d=a?a.pathnameBase:"/",f=a&&a.route;{let w=f&&f.path||"";Xj(u,!f||w.endsWith("*")||w.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${w}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${w}"> to <Route path="${w==="/"?"*":`${w}/*`}">.`)}let h=Za(),p;if(e){let w=typeof e=="string"?Ru(e):e;or(d==="/"||((v=w.pathname)==null?void 0:v.startsWith(d)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${w.pathname}" was given in the \`location\` prop.`),p=w}else p=h;let m=p.pathname||"/",y=m;if(d!=="/"){let w=d.replace(/^\//,"").split("/");y="/"+m.replace(/^\//,"").split("/").slice(w.length).join("/")}let b=Lj(t,{pathname:y});Ai(f||b!=null,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),Ai(b==null||b[b.length-1].route.element!==void 0||b[b.length-1].route.Component!==void 0||b[b.length-1].route.lazy!==void 0,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let g=v3(b&&b.map(w=>Object.assign({},w,{params:Object.assign({},l,w.params),pathname:Uo([d,i.encodeLocation?i.encodeLocation(w.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?d:Uo([d,i.encodeLocation?i.encodeLocation(w.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathnameBase])})),o,n,r,s);return e&&g?x.createElement(Jf.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...p},navigationType:"POP"}},g):g}function g3(){let t=T3(),e=r3(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=x.createElement(x.Fragment,null,x.createElement("p",null," Hey developer "),x.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",x.createElement("code",{style:i},"ErrorBoundary")," or"," ",x.createElement("code",{style:i},"errorElement")," prop on your route.")),x.createElement(x.Fragment,null,x.createElement("h2",null,"Unexpected Application Error!"),x.createElement("h3",{style:{fontStyle:"italic"}},e),n?x.createElement("pre",{style:s},n):null,o)}var y3=x.createElement(g3,null),Jj=class extends x.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=f3(t.digest);n&&(t=n)}let e=t!==void 0?x.createElement(To.Provider,{value:this.props.routeContext},x.createElement(vv.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?x.createElement(x3,{error:t},e):e}};Jj.contextType=o3;var P0=new WeakMap;function x3({children:t,error:e}){let{basename:n}=x.useContext(ci);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=d3(e.digest);if(r){let s=P0.get(e);if(s)throw s;let i=Uj(r.location,n);if(Bj&&!P0.get(e))if(i.isExternal||r.reloadDocument)window.location.href=i.absoluteURL||i.to;else{const o=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(i.to,{replace:r.replace}));throw P0.set(e,o),o}return x.createElement("meta",{httpEquiv:"refresh",content:`0;url=${i.absoluteURL||i.to}`})}}return t}function b3({routeContext:t,match:e,children:n}){let r=x.useContext(Ou);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),x.createElement(To.Provider,{value:t},n)}function v3(t,e=[],n=null,r=null,s=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,o=n==null?void 0:n.errors;if(o!=null){let d=i.findIndex(f=>f.route.id&&(o==null?void 0:o[f.route.id])!==void 0);or(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,d+1))}let a=!1,l=-1;if(n)for(let d=0;d<i.length;d++){let f=i[d];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(l=d),f.route.id){let{loaderData:h,errors:p}=n,m=f.route.loader&&!h.hasOwnProperty(f.route.id)&&(!p||p[f.route.id]===void 0);if(f.route.lazy||m){a=!0,l>=0?i=i.slice(0,l+1):i=[i[0]];break}}}let u=n&&r?(d,f)=>{var h,p;r(d,{location:n.location,params:((p=(h=n.matches)==null?void 0:h[0])==null?void 0:p.params)??{},unstable_pattern:s3(n.matches),errorInfo:f})}:void 0;return i.reduceRight((d,f,h)=>{let p,m=!1,y=null,b=null;n&&(p=o&&f.route.id?o[f.route.id]:void 0,y=f.route.errorElement||y3,a&&(l<0&&h===0?(Xj("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),m=!0,b=null):l===h&&(m=!0,b=f.route.hydrateFallbackElement||null)));let g=e.concat(i.slice(0,h+1)),v=()=>{let w;return p?w=y:m?w=b:f.route.Component?w=x.createElement(f.route.Component,null):f.route.element?w=f.route.element:w=d,x.createElement(b3,{match:f,routeContext:{outlet:d,matches:g,isDataRoute:n!=null},children:w})};return n&&(f.route.ErrorBoundary||f.route.errorElement||h===0)?x.createElement(Jj,{location:n.location,revalidation:n.revalidation,component:y,error:p,children:v(),routeContext:{outlet:null,matches:g,isDataRoute:!0},onError:u}):v()},null)}function wv(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function w3(t){let e=x.useContext(Ou);return or(e,wv(t)),e}function k3(t){let e=x.useContext(jg);return or(e,wv(t)),e}function S3(t){let e=x.useContext(To);return or(e,wv(t)),e}function kv(t){let e=S3(t),n=e.matches[e.matches.length-1];return or(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function _3(){return kv("useRouteId")}function T3(){var r;let t=x.useContext(vv),e=k3("useRouteError"),n=kv("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function C3(){let{router:t}=w3("useNavigate"),e=kv("useNavigate"),n=x.useRef(!1);return Gj(()=>{n.current=!0}),x.useCallback(async(s,i={})=>{Ai(n.current,Kj),n.current&&(typeof s=="number"?await t.navigate(s):await t.navigate(s,{fromRouteId:e,...i}))},[t,e])}var FS={};function Xj(t,e,n){!e&&!FS[t]&&(FS[t]=!0,Ai(!1,n))}x.memo(E3);function E3({routes:t,future:e,state:n,onError:r}){return Yj(t,void 0,n,r,e)}function BS({to:t,replace:e,state:n,relative:r}){or(Pu(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=x.useContext(ci);Ai(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=x.useContext(To),{pathname:o}=Za(),a=qj(),l=bv(t,xv(i),o,r==="path"),u=JSON.stringify(l);return x.useEffect(()=>{a(JSON.parse(u),{replace:e,state:n,relative:r})},[a,u,r,e,n]),null}function hd(t){or(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function N3({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:s,static:i=!1,unstable_useTransitions:o}){or(!Pu(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=t.replace(/^\/*/,"/"),l=x.useMemo(()=>({basename:a,navigator:s,static:i,unstable_useTransitions:o,future:{}}),[a,s,i,o]);typeof n=="string"&&(n=Ru(n));let{pathname:u="/",search:d="",hash:f="",state:h=null,key:p="default"}=n,m=x.useMemo(()=>{let y=Yo(u,a);return y==null?null:{location:{pathname:y,search:d,hash:f,state:h,key:p},navigationType:r}},[a,u,d,f,h,p,r]);return Ai(m!=null,`<Router basename="${a}"> is not able to match the URL "${u}${d}${f}" because it does not start with the basename, so the <Router> won't render anything.`),m==null?null:x.createElement(ci.Provider,{value:l},x.createElement(Jf.Provider,{children:e,value:m}))}function j3({children:t,location:e}){return m3(Wx(t),e)}function Wx(t,e=[]){let n=[];return x.Children.forEach(t,(r,s)=>{if(!x.isValidElement(r))return;let i=[...e,s];if(r.type===x.Fragment){n.push.apply(n,Wx(r.props.children,i));return}or(r.type===hd,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),or(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Wx(r.props.children,i)),n.push(o)}),n}var mp="get",gp="application/x-www-form-urlencoded";function Ig(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function I3(t){return Ig(t)&&t.tagName.toLowerCase()==="button"}function M3(t){return Ig(t)&&t.tagName.toLowerCase()==="form"}function D3(t){return Ig(t)&&t.tagName.toLowerCase()==="input"}function A3(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function R3(t,e){return t.button===0&&(!e||e==="_self")&&!A3(t)}var Ih=null;function O3(){if(Ih===null)try{new FormData(document.createElement("form"),0),Ih=!1}catch{Ih=!0}return Ih}var P3=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function L0(t){return t!=null&&!P3.has(t)?(Ai(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${gp}"`),null):t}function L3(t,e){let n,r,s,i,o;if(M3(t)){let a=t.getAttribute("action");r=a?Yo(a,e):null,n=t.getAttribute("method")||mp,s=L0(t.getAttribute("enctype"))||gp,i=new FormData(t)}else if(I3(t)||D3(t)&&(t.type==="submit"||t.type==="image")){let a=t.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=t.getAttribute("formaction")||a.getAttribute("action");if(r=l?Yo(l,e):null,n=t.getAttribute("formmethod")||a.getAttribute("method")||mp,s=L0(t.getAttribute("formenctype"))||L0(a.getAttribute("enctype"))||gp,i=new FormData(a,t),!O3()){let{name:u,type:d,value:f}=t;if(d==="image"){let h=u?`${u}.`:"";i.append(`${h}x`,"0"),i.append(`${h}y`,"0")}else u&&i.append(u,f)}}else{if(Ig(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=mp,r=null,s=gp,o=t}return i&&s==="text/plain"&&(o=i,i=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Sv(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function $3(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&Yo(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function z3(t,e){if(t.id in e)return e[t.id];try{let n=await yv(()=>import(t.module),[]);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function F3(t){return t!=null&&typeof t.page=="string"}function B3(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function U3(t,e,n){let r=await Promise.all(t.map(async s=>{let i=e.routes[s.route.id];if(i){let o=await z3(i,n);return o.links?o.links():[]}return[]}));return K3(r.flat(1).filter(B3).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function US(t,e,n,r,s,i){let o=(l,u)=>n[u]?l.route.id!==n[u].route.id:!0,a=(l,u)=>{var d;return n[u].pathname!==l.pathname||((d=n[u].route.path)==null?void 0:d.endsWith("*"))&&n[u].params["*"]!==l.params["*"]};return i==="assets"?e.filter((l,u)=>o(l,u)||a(l,u)):i==="data"?e.filter((l,u)=>{var f;let d=r.routes[l.route.id];if(!d||!d.hasLoader)return!1;if(o(l,u)||a(l,u))return!0;if(l.route.shouldRevalidate){let h=l.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((f=n[0])==null?void 0:f.params)||{},nextUrl:new URL(t,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function H3(t,e,{includeHydrateFallback:n}={}){return V3(t.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function V3(t){return[...new Set(t)]}function W3(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function K3(t,e){let n=new Set,r=new Set(e);return t.reduce((s,i)=>{if(e&&!F3(i)&&i.as==="script"&&i.href&&r.has(i.href))return s;let a=JSON.stringify(W3(i));return n.has(a)||(n.add(a),s.push({key:a,link:i})),s},[])}function Qj(){let t=x.useContext(Ou);return Sv(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function G3(){let t=x.useContext(jg);return Sv(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var _v=x.createContext(void 0);_v.displayName="FrameworkContext";function Zj(){let t=x.useContext(_v);return Sv(t,"You must render this element inside a <HydratedRouter> element"),t}function q3(t,e){let n=x.useContext(_v),[r,s]=x.useState(!1),[i,o]=x.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:u,onMouseLeave:d,onTouchStart:f}=e,h=x.useRef(null);x.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let y=g=>{g.forEach(v=>{o(v.isIntersecting)})},b=new IntersectionObserver(y,{threshold:.5});return h.current&&b.observe(h.current),()=>{b.disconnect()}}},[t]),x.useEffect(()=>{if(r){let y=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(y)}}},[r]);let p=()=>{s(!0)},m=()=>{s(!1),o(!1)};return n?t!=="intent"?[i,h,{}]:[i,h,{onFocus:nd(a,p),onBlur:nd(l,m),onMouseEnter:nd(u,p),onMouseLeave:nd(d,m),onTouchStart:nd(f,p)}]:[!1,h,{}]}function nd(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function Y3({page:t,...e}){let{router:n}=Qj(),r=x.useMemo(()=>Lj(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?x.createElement(X3,{page:t,matches:r,...e}):null}function J3(t){let{manifest:e,routeModules:n}=Zj(),[r,s]=x.useState([]);return x.useEffect(()=>{let i=!1;return U3(t,e,n).then(o=>{i||s(o)}),()=>{i=!0}},[t,e,n]),r}function X3({page:t,matches:e,...n}){let r=Za(),{manifest:s,routeModules:i}=Zj(),{basename:o}=Qj(),{loaderData:a,matches:l}=G3(),u=x.useMemo(()=>US(t,e,l,s,r,"data"),[t,e,l,s,r]),d=x.useMemo(()=>US(t,e,l,s,r,"assets"),[t,e,l,s,r]),f=x.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let m=new Set,y=!1;if(e.forEach(g=>{var w;let v=s.routes[g.route.id];!v||!v.hasLoader||(!u.some(C=>C.route.id===g.route.id)&&g.route.id in a&&((w=i[g.route.id])!=null&&w.shouldRevalidate)||v.hasClientLoader?y=!0:m.add(g.route.id))}),m.size===0)return[];let b=$3(t,o,"data");return y&&m.size>0&&b.searchParams.set("_routes",e.filter(g=>m.has(g.route.id)).map(g=>g.route.id).join(",")),[b.pathname+b.search]},[o,a,r,s,u,e,t,i]),h=x.useMemo(()=>H3(d,s),[d,s]),p=J3(d);return x.createElement(x.Fragment,null,f.map(m=>x.createElement("link",{key:m,rel:"prefetch",as:"fetch",href:m,...n})),h.map(m=>x.createElement("link",{key:m,rel:"modulepreload",href:m,...n})),p.map(({key:m,link:y})=>x.createElement("link",{key:m,nonce:n.nonce,...y})))}function Q3(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var Z3=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Z3&&(window.__reactRouterVersion="7.11.0")}catch{}function eL({basename:t,children:e,unstable_useTransitions:n,window:r}){let s=x.useRef();s.current==null&&(s.current=A4({window:r,v5Compat:!0}));let i=s.current,[o,a]=x.useState({action:i.action,location:i.location}),l=x.useCallback(u=>{n===!1?a(u):x.startTransition(()=>a(u))},[n]);return x.useLayoutEffect(()=>i.listen(l),[i,l]),x.createElement(N3,{basename:t,children:e,location:o.location,navigationType:o.action,navigator:i,unstable_useTransitions:n})}var eI=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,tI=x.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:s,reloadDocument:i,replace:o,state:a,target:l,to:u,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:h,...p},m){let{basename:y,unstable_useTransitions:b}=x.useContext(ci),g=typeof u=="string"&&eI.test(u),v=Uj(u,y);u=v.to;let w=h3(u,{relative:s}),[C,I,k]=q3(r,p),D=sL(u,{replace:o,state:a,target:l,preventScrollReset:d,relative:s,viewTransition:f,unstable_defaultShouldRevalidate:h,unstable_useTransitions:b});function S(_){e&&e(_),_.defaultPrevented||D(_)}let T=x.createElement("a",{...p,...k,href:v.absoluteURL||w,onClick:v.isExternal||i?e:S,ref:Q3(m,I),target:l,"data-discover":!g&&n==="render"?"true":void 0});return C&&!g?x.createElement(x.Fragment,null,T,x.createElement(Y3,{page:w})):T});tI.displayName="Link";var tL=x.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:s=!1,style:i,to:o,viewTransition:a,children:l,...u},d){let f=Xf(o,{relative:u.relative}),h=Za(),p=x.useContext(jg),{navigator:m,basename:y}=x.useContext(ci),b=p!=null&&cL(f)&&a===!0,g=m.encodeLocation?m.encodeLocation(f).pathname:f.pathname,v=h.pathname,w=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;n||(v=v.toLowerCase(),w=w?w.toLowerCase():null,g=g.toLowerCase()),w&&y&&(w=Yo(w,y)||w);const C=g!=="/"&&g.endsWith("/")?g.length-1:g.length;let I=v===g||!s&&v.startsWith(g)&&v.charAt(C)==="/",k=w!=null&&(w===g||!s&&w.startsWith(g)&&w.charAt(g.length)==="/"),D={isActive:I,isPending:k,isTransitioning:b},S=I?e:void 0,T;typeof r=="function"?T=r(D):T=[r,I?"active":null,k?"pending":null,b?"transitioning":null].filter(Boolean).join(" ");let _=typeof i=="function"?i(D):i;return x.createElement(tI,{...u,"aria-current":S,className:T,ref:d,style:_,to:o,viewTransition:a},typeof l=="function"?l(D):l)});tL.displayName="NavLink";var nL=x.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:s,state:i,method:o=mp,action:a,onSubmit:l,relative:u,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:h,...p},m)=>{let{unstable_useTransitions:y}=x.useContext(ci),b=aL(),g=lL(a,{relative:u}),v=o.toLowerCase()==="get"?"get":"post",w=typeof a=="string"&&eI.test(a),C=I=>{if(l&&l(I),I.defaultPrevented)return;I.preventDefault();let k=I.nativeEvent.submitter,D=(k==null?void 0:k.getAttribute("formmethod"))||o,S=()=>b(k||I.currentTarget,{fetcherKey:e,method:D,navigate:n,replace:s,state:i,relative:u,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:h});y&&n!==!1?x.startTransition(()=>S()):S()};return x.createElement("form",{ref:m,method:v,action:g,onSubmit:r?l:C,...p,"data-discover":!w&&t==="render"?"true":void 0})});nL.displayName="Form";function rL(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function nI(t){let e=x.useContext(Ou);return or(e,rL(t)),e}function sL(t,{target:e,replace:n,state:r,preventScrollReset:s,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:a,unstable_useTransitions:l}={}){let u=qj(),d=Za(),f=Xf(t,{relative:i});return x.useCallback(h=>{if(R3(h,e)){h.preventDefault();let p=n!==void 0?n:mf(d)===mf(f),m=()=>u(t,{replace:p,state:r,preventScrollReset:s,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:a});l?x.startTransition(()=>m()):m()}},[d,u,f,n,r,e,t,s,i,o,a,l])}var iL=0,oL=()=>`__${String(++iL)}__`;function aL(){let{router:t}=nI("useSubmit"),{basename:e}=x.useContext(ci),n=_3(),r=t.fetch,s=t.navigate;return x.useCallback(async(i,o={})=>{let{action:a,method:l,encType:u,formData:d,body:f}=L3(i,e);if(o.navigate===!1){let h=o.fetcherKey||oL();await r(h,n,o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:d,body:f,formMethod:o.method||l,formEncType:o.encType||u,flushSync:o.flushSync})}else await s(o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:d,body:f,formMethod:o.method||l,formEncType:o.encType||u,replace:o.replace,state:o.state,fromRouteId:n,flushSync:o.flushSync,viewTransition:o.viewTransition})},[r,s,e,n])}function lL(t,{relative:e}={}){let{basename:n}=x.useContext(ci),r=x.useContext(To);or(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...Xf(t||".",{relative:e})},o=Za();if(t==null){i.search=o.search;let a=new URLSearchParams(i.search),l=a.getAll("index");if(l.some(d=>d==="")){a.delete("index"),l.filter(f=>f).forEach(f=>a.append("index",f));let d=a.toString();i.search=d?`?${d}`:""}}return(!t||t===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(i.pathname=i.pathname==="/"?n:Uo([n,i.pathname])),mf(i)}function cL(t,{relative:e}={}){let n=x.useContext(Vj);or(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=nI("useViewTransitionState"),s=Xf(t,{relative:e});if(!n.isTransitioning)return!1;let i=Yo(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=Yo(n.nextLocation.pathname,r)||n.nextLocation.pathname;return om(s.pathname,o)!=null||om(s.pathname,i)!=null}function Mg(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function uL(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(d){try{u(r.next(d))}catch(f){o(f)}}function l(d){try{u(r.throw(d))}catch(f){o(f)}}function u(d){d.done?i(d.value):s(d.value).then(a,l)}u((r=r.apply(t,e||[])).next())})}const dL=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class Tv extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class fL extends Tv{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class HS extends Tv{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class VS extends Tv{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Kx;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Kx||(Kx={}));class hL{constructor(e,{headers:n={},customFetch:r,region:s=Kx.Any}={}){this.url=e,this.headers=n,this.region=s,this.fetch=dL(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return uL(this,arguments,void 0,function*(n,r={}){var s;let i,o;try{const{headers:a,method:l,body:u,signal:d,timeout:f}=r;let h={},{region:p}=r;p||(p=this.region);const m=new URL(`${this.url}/${n}`);p&&p!=="any"&&(h["x-region"]=p,m.searchParams.set("forceFunctionRegion",p));let y;u&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",y=u):typeof u=="string"?(h["Content-Type"]="text/plain",y=u):typeof FormData<"u"&&u instanceof FormData?y=u:(h["Content-Type"]="application/json",y=JSON.stringify(u)):y=u;let b=d;f&&(o=new AbortController,i=setTimeout(()=>o.abort(),f),d?(b=o.signal,d.addEventListener("abort",()=>o.abort())):b=o.signal);const g=yield this.fetch(m.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),a),body:y,signal:b}).catch(I=>{throw new fL(I)}),v=g.headers.get("x-relay-error");if(v&&v==="true")throw new HS(g);if(!g.ok)throw new VS(g);let w=((s=g.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),C;return w==="application/json"?C=yield g.json():w==="application/octet-stream"||w==="application/pdf"?C=yield g.blob():w==="text/event-stream"?C=g:w==="multipart/form-data"?C=yield g.formData():C=yield g.text(),{data:C,error:null,response:g}}catch(a){return{data:null,error:a,response:a instanceof VS||a instanceof HS?a.context:void 0}}finally{i&&clearTimeout(i)}})}}var pL=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},mL=class{constructor(t){var e,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var n=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let o=null,a=null,l=null,u=i.status,d=i.statusText;if(i.ok){var f,h;if(n.method!=="HEAD"){var p;const g=await i.text();g===""||(n.headers.get("Accept")==="text/csv"||n.headers.get("Accept")&&(!((p=n.headers.get("Accept"))===null||p===void 0)&&p.includes("application/vnd.pgrst.plan+text"))?a=g:a=JSON.parse(g))}const y=(f=n.headers.get("Prefer"))===null||f===void 0?void 0:f.match(/count=(exact|planned|estimated)/),b=(h=i.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");y&&b&&b.length>1&&(l=parseInt(b[1])),n.isMaybeSingle&&n.method==="GET"&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,u=406,d="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var m;const y=await i.text();try{o=JSON.parse(y),Array.isArray(o)&&i.status===404&&(a=[],o=null,u=200,d="OK")}catch{i.status===404&&y===""?(u=204,d="No Content"):o={message:y}}if(o&&n.isMaybeSingle&&(!(o==null||(m=o.details)===null||m===void 0)&&m.includes("0 rows"))&&(o=null,u=200,d="OK"),o&&n.shouldThrowOnError)throw new pL(o)}return{error:o,data:a,count:l,status:u,statusText:d}});return this.shouldThrowOnError||(s=s.catch(i=>{var o;let a="";const l=i==null?void 0:i.cause;if(l){var u,d,f,h;const m=(u=l==null?void 0:l.message)!==null&&u!==void 0?u:"",y=(d=l==null?void 0:l.code)!==null&&d!==void 0?d:"";a=`${(f=i==null?void 0:i.name)!==null&&f!==void 0?f:"FetchError"}: ${i==null?void 0:i.message}`,a+=`

Caused by: ${(h=l==null?void 0:l.name)!==null&&h!==void 0?h:"Error"}: ${m}`,y&&(a+=` (${y})`),l!=null&&l.stack&&(a+=`
${l.stack}`)}else{var p;a=(p=i==null?void 0:i.stack)!==null&&p!==void 0?p:""}return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:a,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),s.then(t,e)}returns(){return this}overrideTypes(){return this}},gL=class extends mL{select(t){let e=!1;const n=(t??"*").split("").map(r=>/\s/.test(r)&&!e?"":(r==='"'&&(e=!e),r)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:n,foreignTable:r,referencedTable:s=r}={}){const i=s?`${s}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:n=e}={}){const r=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${t}`),this}range(t,e,{foreignTable:n,referencedTable:r=n}={}){const s=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${t}`),this.url.searchParams.set(i,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:n=!1,buffers:r=!1,wal:s=!1,format:i="text"}={}){var o;const a=[t?"analyze":null,e?"verbose":null,n?"settings":null,r?"buffers":null,s?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const WS=new RegExp("[,()]");var Cc=class extends gL{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&WS.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}notIn(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&WS.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`not.in.(${n})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:n,type:r}={}){let s="";r==="plain"?s="pl":r==="phrase"?s="ph":r==="websearch"&&(s="w");const i=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${s}fts${i}.${e}`),this}match(t){return Object.entries(t).forEach(([e,n])=>{this.url.searchParams.append(e,`eq.${n}`)}),this}not(t,e,n){return this.url.searchParams.append(t,`not.${e}.${n}`),this}or(t,{foreignTable:e,referencedTable:n=e}={}){const r=n?`${n}.or`:"or";return this.url.searchParams.append(r,`(${t})`),this}filter(t,e,n){return this.url.searchParams.append(t,`${e}.${n}`),this}},yL=class{constructor(t,{headers:e={},schema:n,fetch:r}){this.url=t,this.headers=new Headers(e),this.schema=n,this.fetch=r}select(t,e){const{head:n=!1,count:r}=e??{},s=n?"HEAD":"GET";let i=!1;const o=(t??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),r&&this.headers.append("Prefer",`count=${r}`),new Cc({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:n=!0}={}){var r;const s="POST";if(e&&this.headers.append("Prefer",`count=${e}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const i=t.reduce((o,a)=>o.concat(Object.keys(a)),[]);if(i.length>0){const o=[...new Set(i)].map(a=>`"${a}"`);this.url.searchParams.set("columns",o.join(","))}}return new Cc({method:s,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:n=!1,count:r,defaultToNull:s=!0}={}){var i;const o="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),e!==void 0&&this.url.searchParams.set("on_conflict",e),r&&this.headers.append("Prefer",`count=${r}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const a=t.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(a.length>0){const l=[...new Set(a)].map(u=>`"${u}"`);this.url.searchParams.set("columns",l.join(","))}}return new Cc({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(t,{count:e}={}){var n;const r="PATCH";return e&&this.headers.append("Prefer",`count=${e}`),new Cc({method:r,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:t}={}){var e;const n="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new Cc({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},xL=class rI{constructor(e,{headers:n={},schema:r,fetch:s}={}){this.url=e,this.headers=new Headers(n),this.schemaName=r,this.fetch=s}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new yL(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new rI(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,n={},{head:r=!1,get:s=!1,count:i}={}){var o;let a;const l=new URL(`${this.url}/rpc/${e}`);let u;r||s?(a=r?"HEAD":"GET",Object.entries(n).filter(([f,h])=>h!==void 0).map(([f,h])=>[f,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([f,h])=>{l.searchParams.append(f,h)})):(a="POST",u=n);const d=new Headers(this.headers);return i&&d.set("Prefer",`count=${i}`),new Cc({method:a,url:l,headers:d,schema:this.schemaName,body:u,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};class bL{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const r=n.node,s=parseInt(r.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const r=this.getWebSocketConstructor();return new r(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const vL="2.89.0",wL=`realtime-js/${vL}`,sI="1.0.0",kL="2.0.0",KS=sI,Gx=1e4,SL=1e3,_L=100;var pa;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(pa||(pa={}));var Dr;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Dr||(Dr={}));var Yi;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Yi||(Yi={}));var qx;(function(t){t.websocket="websocket"})(qx||(qx={}));var vl;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(vl||(vl={}));class TL{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,n){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,r;const s=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(e){var n,r;const s=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:{},o=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,n,r){var s,i;const o=e.topic,a=(s=e.ref)!==null&&s!==void 0?s:"",l=(i=e.join_ref)!==null&&i!==void 0?i:"",u=e.payload.event,d=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},f=Object.keys(d).length===0?"":JSON.stringify(d);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`userEvent length ${u.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`metadata length ${f.length} exceeds maximum of 255`);const h=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+u.length+f.length,p=new ArrayBuffer(this.HEADER_LENGTH+h);let m=new DataView(p),y=0;m.setUint8(y++,this.KINDS.userBroadcastPush),m.setUint8(y++,l.length),m.setUint8(y++,a.length),m.setUint8(y++,o.length),m.setUint8(y++,u.length),m.setUint8(y++,f.length),m.setUint8(y++,n),Array.from(l,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(a,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(o,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(u,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(f,g=>m.setUint8(y++,g.charCodeAt(0)));var b=new Uint8Array(p.byteLength+r.byteLength);return b.set(new Uint8Array(p),0),b.set(new Uint8Array(r),p.byteLength),b.buffer}decode(e,n){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return n(r)}if(typeof e=="string"){const r=JSON.parse(e),[s,i,o,a,l]=r;return n({join_ref:s,ref:i,topic:o,event:a,payload:l})}return n({})}_binaryDecode(e){const n=new DataView(e),r=n.getUint8(0),s=new TextDecoder;switch(r){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,n,s)}}_decodeUserBroadcast(e,n,r){const s=n.getUint8(1),i=n.getUint8(2),o=n.getUint8(3),a=n.getUint8(4);let l=this.HEADER_LENGTH+4;const u=r.decode(e.slice(l,l+s));l=l+s;const d=r.decode(e.slice(l,l+i));l=l+i;const f=r.decode(e.slice(l,l+o));l=l+o;const h=e.slice(l,e.byteLength),p=a===this.JSON_ENCODING?JSON.parse(r.decode(h)):h,m={type:this.BROADCAST_EVENT,event:d,payload:p};return o>0&&(m.meta=JSON.parse(f)),{join_ref:null,ref:null,topic:u,event:this.BROADCAST_EVENT,payload:m}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e==null?void 0:e.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}_pick(e,n){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([r])=>n.includes(r)))}}class iI{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Vn;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Vn||(Vn={}));const GS=(t,e,n={})=>{var r;const s=(r=n.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=CL(o,t,e,s),i),{}):{}},CL=(t,e,n,r)=>{const s=e.find(a=>a.name===t),i=s==null?void 0:s.type,o=n[t];return i&&!r.includes(i)?oI(i,o):Yx(o)},oI=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return IL(e,n)}switch(t){case Vn.bool:return EL(e);case Vn.float4:case Vn.float8:case Vn.int2:case Vn.int4:case Vn.int8:case Vn.numeric:case Vn.oid:return NL(e);case Vn.json:case Vn.jsonb:return jL(e);case Vn.timestamp:return ML(e);case Vn.abstime:case Vn.date:case Vn.daterange:case Vn.int4range:case Vn.int8range:case Vn.money:case Vn.reltime:case Vn.text:case Vn.time:case Vn.timestamptz:case Vn.timetz:case Vn.tsrange:case Vn.tstzrange:return Yx(e);default:return Yx(e)}},Yx=t=>t,EL=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},NL=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},jL=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},IL=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let i;const o=t.slice(1,n);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>oI(e,a))}return t},ML=t=>typeof t=="string"?t.replace(" ","T"):t,aI=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class $0{constructor(e,n,r={},s=Gx){this.channel=e,this.event=n,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var qS;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(qS||(qS={}));class Id{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Id.syncState(this.state,s,i,o),this.pendingDiffs.forEach(l=>{this.state=Id.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Id.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,s){const i=this.cloneDeep(e),o=this.transformState(n),a={},l={};return this.map(i,(u,d)=>{o[u]||(l[u]=d)}),this.map(o,(u,d)=>{const f=i[u];if(f){const h=d.map(b=>b.presence_ref),p=f.map(b=>b.presence_ref),m=d.filter(b=>p.indexOf(b.presence_ref)<0),y=f.filter(b=>h.indexOf(b.presence_ref)<0);m.length>0&&(a[u]=m),y.length>0&&(l[u]=y)}else a[u]=d}),this.syncDiff(i,{joins:a,leaves:l},r,s)}static syncDiff(e,n,r,s){const{joins:i,leaves:o}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(a,l)=>{var u;const d=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(l),d.length>0){const f=e[a].map(p=>p.presence_ref),h=d.filter(p=>f.indexOf(p.presence_ref)<0);e[a].unshift(...h)}r(a,d,l)}),this.map(o,(a,l)=>{let u=e[a];if(!u)return;const d=l.map(f=>f.presence_ref);u=u.filter(f=>d.indexOf(f.presence_ref)<0),e[a]=u,s(a,u,l),u.length===0&&delete e[a]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const s=e[r];return"metas"in s?n[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):n[r]=s,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var YS;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(YS||(YS={}));var Md;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Md||(Md={}));var Ro;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Ro||(Ro={}));class Vc{constructor(e,n={config:{}},r){var s,i;if(this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=Dr.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new $0(this,Yi.join,this.params,this.timeout),this.rejoinTimer=new iI(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Dr.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Dr.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Dr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Dr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Dr.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Yi.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new Id(this),this.broadcastEndpointURL=aI(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var r,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Dr.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,u=(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(p=>p.filter))!==null&&s!==void 0?s:[],d=!!this.bindings[Md.PRESENCE]&&this.bindings[Md.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,f={},h={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:d}),postgres_changes:u,private:l};this.socket.accessTokenValue&&(f.access_token=this.socket.accessTokenValue),this._onError(p=>e==null?void 0:e(Ro.CHANNEL_ERROR,p)),this._onClose(()=>e==null?void 0:e(Ro.CLOSED)),this.updateJoinPayload(Object.assign({config:h},f)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:p})=>{var m;if(this.socket._isManualToken()||this.socket.setAuth(),p===void 0){e==null||e(Ro.SUBSCRIBED);return}else{const y=this.bindings.postgres_changes,b=(m=y==null?void 0:y.length)!==null&&m!==void 0?m:0,g=[];for(let v=0;v<b;v++){const w=y[v],{filter:{event:C,schema:I,table:k,filter:D}}=w,S=p&&p[v];if(S&&S.event===C&&Vc.isFilterValueEqual(S.schema,I)&&Vc.isFilterValueEqual(S.table,k)&&Vc.isFilterValueEqual(S.filter,D))g.push(Object.assign(Object.assign({},w),{id:S.id}));else{this.unsubscribe(),this.state=Dr.errored,e==null||e(Ro.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(Ro.SUBSCRIBED);return}}).receive("error",p=>{this.state=Dr.errored,e==null||e(Ro.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Ro.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this.state===Dr.joined&&e===Md.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,n,r)}async httpSend(e,n,r={}){var s;if(n==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(s=r.timeout)!==null&&s!==void 0?s:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const u=await a.json();l=u.error||u.message||l}catch{}return Promise.reject(new Error(l))}async send(e,n={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=u.body)===null||s===void 0?void 0:s.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const u=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Dr.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Yi.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new $0(this,Yi.leave,{},e),r.receive("ok",()=>{n(),s("ok")}).receive("timeout",()=>{n(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Dr.closed,this.bindings={}}async _fetchWithTimeout(e,n,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:s.signal}));return clearTimeout(i),o}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new $0(this,e,n,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>_L){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:u,join:d}=Yi;if(r&&[a,l,u,d].indexOf(o)>=0&&r!==this._joinRef())return;let h=this._onMessage(o,n,r);if(n&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(p=>{var m,y,b;return((m=p.filter)===null||m===void 0?void 0:m.event)==="*"||((b=(y=p.filter)===null||y===void 0?void 0:y.event)===null||b===void 0?void 0:b.toLocaleLowerCase())===o}).map(p=>p.callback(h,r)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var m,y,b,g,v,w;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const C=p.id,I=(m=p.filter)===null||m===void 0?void 0:m.event;return C&&((y=n.ids)===null||y===void 0?void 0:y.includes(C))&&(I==="*"||(I==null?void 0:I.toLocaleLowerCase())===((b=n.data)===null||b===void 0?void 0:b.type.toLocaleLowerCase()))}else{const C=(v=(g=p==null?void 0:p.filter)===null||g===void 0?void 0:g.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return C==="*"||C===((w=n==null?void 0:n.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof h=="object"&&"ids"in h){const m=h.data,{schema:y,table:b,commit_timestamp:g,type:v,errors:w}=m;h=Object.assign(Object.assign({},{schema:y,table:b,commit_timestamp:g,eventType:v,new:{},old:{},errors:w}),this._getPayloadRecords(m))}p.callback(h,r)})}_isClosed(){return this.state===Dr.closed}_isJoined(){return this.state===Dr.joined}_isJoining(){return this.state===Dr.joining}_isLeaving(){return this.state===Dr.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const s=e.toLocaleLowerCase(),i={type:s,filter:n,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Vc.isEqual(s.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}static isFilterValueEqual(e,n){return(e??void 0)===(n??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Yi.close,{},e)}_onError(e){this._on(Yi.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Dr.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=GS(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=GS(e.columns,e.old_record)),n}}const z0=()=>{},Mh={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},DL=[1e3,2e3,5e3,1e4],AL=1e4,RL=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class OL{constructor(e,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Gx,this.transport=null,this.heartbeatIntervalMs=Mh.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=z0,this.ref=0,this.reconnectTimer=null,this.vsn=KS,this.logger=z0,this.conn=null,this.sendBuffer=[],this.serializer=new TL,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>s?(...i)=>s(...i):(...i)=>fetch(...i),!(!((r=n==null?void 0:n.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${qx.websocket}`,this.httpEndpoint=aI(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=bL.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case pa.connecting:return vl.Connecting;case pa.open:return vl.Open;case pa.closing:return vl.Closing;default:return vl.Closed}}isConnected(){return this.connectionState()===vl.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===r);if(s)return s;{const i=new Vc(`realtime:${e}`,n,this);return this.channels.push(i),i}}push(e){const{topic:n,event:r,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${n} ${r} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(SL,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},Mh.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:s,payload:i,ref:o}=n,a=o?`(${o})`:"",l=i.status||"";this.log("receive",`${l} ${r} ${s} ${a}`.trim(),i),this.channels.filter(u=>u._isMember(r)).forEach(u=>u._trigger(s,i,o)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===pa.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===pa.open||this.conn.readyState===pa.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this._terminateWorker()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Yi.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(n);return`${e}${r}${s}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([RL],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n,r=!1;if(e)n=e,r=!0;else if(this.accessToken)try{n=await this.accessToken()}catch(s){this.log("error","Error fetching access token from callback",s),n=this.accessTokenValue}else n=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(s=>{const i={access_token:n,version:wL};n&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(Yi.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(n=>{this.log("error",`Error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(n)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new iI(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Mh.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,r,s,i,o,a,l,u,d,f,h,p;switch(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:Gx,this.heartbeatIntervalMs=(s=e==null?void 0:e.heartbeatIntervalMs)!==null&&s!==void 0?s:Mh.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e==null?void 0:e.heartbeatCallback)!==null&&a!==void 0?a:z0,this.vsn=(l=e==null?void 0:e.vsn)!==null&&l!==void 0?l:KS,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(u=e==null?void 0:e.reconnectAfterMs)!==null&&u!==void 0?u:m=>DL[m-1]||AL,this.vsn){case sI:this.encode=(d=e==null?void 0:e.encode)!==null&&d!==void 0?d:(m,y)=>y(JSON.stringify(m)),this.decode=(f=e==null?void 0:e.decode)!==null&&f!==void 0?f:(m,y)=>y(JSON.parse(m));break;case kL:this.encode=(h=e==null?void 0:e.encode)!==null&&h!==void 0?h:this.serializer.encode.bind(this.serializer),this.decode=(p=e==null?void 0:e.decode)!==null&&p!==void 0?p:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var gf=class extends Error{constructor(t,e){var n;super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((n=e.icebergType)==null?void 0:n.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function PL(t,e,n){const r=new URL(e,t);if(n)for(const[s,i]of Object.entries(n))i!==void 0&&r.searchParams.set(s,i);return r.toString()}async function LL(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function $L(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:n,path:r,query:s,body:i,headers:o}){const a=PL(t.baseUrl,r,s),l=await LL(t.auth),u=await e(a,{method:n,headers:{...i?{"Content-Type":"application/json"}:{},...l,...o},body:i?JSON.stringify(i):void 0}),d=await u.text(),f=(u.headers.get("content-type")||"").includes("application/json"),h=f&&d?JSON.parse(d):d;if(!u.ok){const p=f?h:void 0,m=p==null?void 0:p.error;throw new gf((m==null?void 0:m.message)??`Request failed with status ${u.status}`,{status:u.status,icebergType:m==null?void 0:m.type,icebergCode:m==null?void 0:m.code,details:p})}return{status:u.status,headers:u.headers,data:h}}}}function Dh(t){return t.join("")}var zL=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:Dh(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(r=>({namespace:r}))}async createNamespace(t,e){const n={namespace:t.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Dh(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Dh(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Dh(t.namespace)}`}),!0}catch(e){if(e instanceof gf&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(n){if(n instanceof gf&&n.status===409)return;throw n}}};function hc(t){return t.join("")}var FL=class{constructor(t,e="",n){this.client=t,this.prefix=e,this.accessDelegation=n}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${hc(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const n={};return this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${hc(t.namespace)}/tables`,body:e,headers:n})).data.metadata}async updateTable(t,e){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${hc(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${hc(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${hc(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${hc(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(n){if(n instanceof gf&&n.status===404)return!1;throw n}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(n){if(n instanceof gf&&n.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw n}}},BL=class{constructor(t){var r;let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const n=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=$L({baseUrl:n,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(r=t.accessDelegation)==null?void 0:r.join(","),this.namespaceOps=new zL(this.client,e),this.tableOps=new FL(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},Dg=class extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}};function lr(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var UL=class extends Dg{constructor(t,e,n){super(t),this.name="StorageApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Jx=class extends Dg{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}};const Cv=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),HL=()=>Response,Xx=t=>{if(Array.isArray(t))return t.map(n=>Xx(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const s=n.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=Xx(r)}),e},VL=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},WL=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function yf(t){"@babel/helpers - typeof";return yf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yf(t)}function KL(t,e){if(yf(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(yf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function GL(t){var e=KL(t,"string");return yf(e)=="symbol"?e:e+""}function qL(t,e,n){return(e=GL(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function JS(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function on(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?JS(Object(n),!0).forEach(function(r){qL(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):JS(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const F0=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},YL=async(t,e,n)=>{t instanceof await HL()&&!(n!=null&&n.noResolveJson)?t.json().then(r=>{const s=t.status||500,i=(r==null?void 0:r.statusCode)||s+"";e(new UL(F0(r),s,i))}).catch(r=>{e(new Jx(F0(r),r))}):e(new Jx(F0(t),t))},JL=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?s:(VL(r)?(s.headers=on({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,e!=null&&e.duplex&&(s.duplex=e.duplex),on(on({},s),n))};async function Qf(t,e,n,r,s,i){return new Promise((o,a)=>{t(n,JL(e,r,s,i)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>YL(l,a,r))})}async function xf(t,e,n,r){return Qf(t,"GET",e,n,r)}async function Gi(t,e,n,r,s){return Qf(t,"POST",e,r,s,n)}async function Qx(t,e,n,r,s){return Qf(t,"PUT",e,r,s,n)}async function XL(t,e,n,r){return Qf(t,"HEAD",e,on(on({},n),{},{noResolveJson:!0}),r)}async function Ev(t,e,n,r,s){return Qf(t,"DELETE",e,r,s,n)}var QL=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(lr(e))return{data:null,error:e};throw e}}};let lI;lI=Symbol.toStringTag;var ZL=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[lI]="BlobDownloadBuilder",this.promise=null}asStream(){return new QL(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(lr(e))return{data:null,error:e};throw e}}};const e$={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},XS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var t$=class{constructor(t,e={},n,r){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.bucketId=n,this.fetch=Cv(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(t,e,n,r){var s=this;try{let i;const o=on(on({},XS),r);let a=on(on({},s.headers),t==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",s.encodeMetadata(l)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),l&&!i.has("metadata")&&i.append("metadata",s.encodeMetadata(l))):(i=n,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=s.toBase64(s.encodeMetadata(l))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),r!=null&&r.headers&&(a=on(on({},a),r.headers));const u=s._removeEmptyFolders(e),d=s._getFinalPath(u),f=await(t=="PUT"?Qx:Gi)(s.fetch,`${s.url}/object/${d}`,i,on({headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:u,id:f.Id,fullPath:f.Key},error:null}}catch(i){if(s.shouldThrowOnError)throw i;if(lr(i))return{data:null,error:i};throw i}}async upload(t,e,n){return this.uploadOrUpdate("POST",t,e,n)}async uploadToSignedUrl(t,e,n,r){var s=this;const i=s._removeEmptyFolders(t),o=s._getFinalPath(i),a=new URL(s.url+`/object/upload/sign/${o}`);a.searchParams.set("token",e);try{let l;const u=on({upsert:XS.upsert},r),d=on(on({},s.headers),{"x-upsert":String(u.upsert)});return typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",u.cacheControl)):(l=n,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType),{data:{path:i,fullPath:(await Qx(s.fetch,a.toString(),l,{headers:d})).Key},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(lr(l))return{data:null,error:l};throw l}}async createSignedUploadUrl(t,e){var n=this;try{let r=n._getFinalPath(t);const s=on({},n.headers);e!=null&&e.upsert&&(s["x-upsert"]="true");const i=await Gi(n.fetch,`${n.url}/object/upload/sign/${r}`,{},{headers:s}),o=new URL(n.url+i.url),a=o.searchParams.get("token");if(!a)throw new Dg("No token returned by API");return{data:{signedUrl:o.toString(),path:t,token:a},error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(lr(r))return{data:null,error:r};throw r}}async update(t,e,n){return this.uploadOrUpdate("PUT",t,e,n)}async move(t,e,n){var r=this;try{return{data:await Gi(r.fetch,`${r.url}/object/move`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers}),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(lr(s))return{data:null,error:s};throw s}}async copy(t,e,n){var r=this;try{return{data:{path:(await Gi(r.fetch,`${r.url}/object/copy`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers})).Key},error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(lr(s))return{data:null,error:s};throw s}}async createSignedUrl(t,e,n){var r=this;try{let s=r._getFinalPath(t),i=await Gi(r.fetch,`${r.url}/object/sign/${s}`,on({expiresIn:e},n!=null&&n.transform?{transform:n.transform}:{}),{headers:r.headers});const o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${r.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(lr(s))return{data:null,error:s};throw s}}async createSignedUrls(t,e,n){var r=this;try{const s=await Gi(r.fetch,`${r.url}/object/sign/${r.bucketId}`,{expiresIn:e,paths:t},{headers:r.headers}),i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(o=>on(on({},o),{},{signedUrl:o.signedURL?encodeURI(`${r.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(lr(s))return{data:null,error:s};throw s}}download(t,e){const n=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",r=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),s=r?`?${r}`:"",i=this._getFinalPath(t),o=()=>xf(this.fetch,`${this.url}/${n}/${i}${s}`,{headers:this.headers,noResolveJson:!0});return new ZL(o,this.shouldThrowOnError)}async info(t){var e=this;const n=e._getFinalPath(t);try{return{data:Xx(await xf(e.fetch,`${e.url}/object/info/${n}`,{headers:e.headers})),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(lr(r))return{data:null,error:r};throw r}}async exists(t){var e=this;const n=e._getFinalPath(t);try{return await XL(e.fetch,`${e.url}/object/${n}`,{headers:e.headers}),{data:!0,error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(lr(r)&&r instanceof Jx){const s=r.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:r}}throw r}}getPublicUrl(t,e){const n=this._getFinalPath(t),r=[],s=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";s!==""&&r.push(s);const i=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",o=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});o!==""&&r.push(o);let a=r.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${n}${a}`)}}}async remove(t){var e=this;try{return{data:await Ev(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}}async list(t,e,n){var r=this;try{const s=on(on(on({},e$),e),{},{prefix:t||""});return{data:await Gi(r.fetch,`${r.url}/object/list/${r.bucketId}`,s,{headers:r.headers},n),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(lr(s))return{data:null,error:s};throw s}}async listV2(t,e){var n=this;try{const r=on({},t);return{data:await Gi(n.fetch,`${n.url}/object/list-v2/${n.bucketId}`,r,{headers:n.headers},e),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(lr(r))return{data:null,error:r};throw r}}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const cI="2.89.0",uI={"X-Client-Info":`storage-js/${cI}`};var n$=class{constructor(t,e={},n,r){this.shouldThrowOnError=!1;const s=new URL(t);r!=null&&r.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href.replace(/\/$/,""),this.headers=on(on({},uI),e),this.fetch=Cv(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(t){var e=this;try{const n=e.listBucketOptionsToQueryString(t);return{data:await xf(e.fetch,`${e.url}/bucket${n}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await xf(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}}async createBucket(t,e={public:!1}){var n=this;try{return{data:await Gi(n.fetch,`${n.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(lr(r))return{data:null,error:r};throw r}}async updateBucket(t,e){var n=this;try{return{data:await Qx(n.fetch,`${n.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(lr(r))return{data:null,error:r};throw r}}async emptyBucket(t){var e=this;try{return{data:await Gi(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await Ev(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},r$=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=on(on({},uI),e),this.fetch=Cv(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await Gi(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}}async listBuckets(t){var e=this;try{const n=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&n.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&n.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&n.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&n.set("sortOrder",t.sortOrder),t!=null&&t.search&&n.set("search",t.search);const r=n.toString(),s=r?`${e.url}/bucket?${r}`:`${e.url}/bucket`;return{data:await xf(e.fetch,s,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await Ev(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}}from(t){var e=this;if(!WL(t))throw new Dg("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new BL({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(n,{get(s,i){const o=s[i];return typeof o!="function"?o:async(...a)=>{try{return{data:await o.apply(s,a),error:null}}catch(l){if(r)throw l;return{data:null,error:l}}}}})}};const Nv={"X-Client-Info":`storage-js/${cI}`,"Content-Type":"application/json"};var dI=class extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Qs(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}var B0=class extends dI{constructor(t,e,n){super(t),this.name="StorageVectorsApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},s$=class extends dI{constructor(t,e){super(t),this.name="StorageVectorsUnknownError",this.originalError=e}};const jv=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),i$=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},QS=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),o$=async(t,e,n)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const r=t.status||500,s=t;if(typeof s.json=="function")s.json().then(i=>{const o=(i==null?void 0:i.statusCode)||(i==null?void 0:i.code)||r+"";e(new B0(QS(i),r,o))}).catch(()=>{const i=r+"";e(new B0(s.statusText||`HTTP ${r} error`,r,i))});else{const i=r+"";e(new B0(s.statusText||`HTTP ${r} error`,r,i))}}else e(new s$(QS(t),t))},a$=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?s:(i$(r)?(s.headers=on({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,on(on({},s),n))};async function l$(t,e,n,r,s,i){return new Promise((o,a)=>{t(n,a$(e,r,s,i)).then(l=>{if(!l.ok)throw l;if(r!=null&&r.noResolveJson)return l;const u=l.headers.get("content-type");return!u||!u.includes("application/json")?{}:l.json()}).then(l=>o(l)).catch(l=>o$(l,a,r))})}async function Zs(t,e,n,r,s){return l$(t,"POST",e,r,s,n)}var c$=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=on(on({},Nv),e),this.fetch=jv(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(t){var e=this;try{return{data:await Zs(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async getIndex(t,e){var n=this;try{return{data:await Zs(n.fetch,`${n.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(Qs(r))return{data:null,error:r};throw r}}async listIndexes(t){var e=this;try{return{data:await Zs(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async deleteIndex(t,e){var n=this;try{return{data:await Zs(n.fetch,`${n.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers})||{},error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(Qs(r))return{data:null,error:r};throw r}}},u$=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=on(on({},Nv),e),this.fetch=jv(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(t){var e=this;try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await Zs(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async getVectors(t){var e=this;try{return{data:await Zs(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async listVectors(t){var e=this;try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:await Zs(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async queryVectors(t){var e=this;try{return{data:await Zs(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async deleteVectors(t){var e=this;try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await Zs(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}},d$=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=on(on({},Nv),e),this.fetch=jv(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await Zs(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await Zs(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async listBuckets(t={}){var e=this;try{return{data:await Zs(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await Zs(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Qs(n))return{data:null,error:n};throw n}}},f$=class extends d${constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new h$(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,n=this;return e().call(n,t)}async getBucket(t){var e=()=>super.getBucket,n=this;return e().call(n,t)}async listBuckets(t={}){var e=()=>super.listBuckets,n=this;return e().call(n,t)}async deleteBucket(t){var e=()=>super.deleteBucket,n=this;return e().call(n,t)}},h$=class extends c${constructor(t,e,n,r){super(t,e,r),this.vectorBucketName=n}async createIndex(t){var e=()=>super.createIndex,n=this;return e().call(n,on(on({},t),{},{vectorBucketName:n.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,n=this;return e().call(n,on(on({},t),{},{vectorBucketName:n.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,n=this;return e().call(n,n.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,n=this;return e().call(n,n.vectorBucketName,t)}index(t){return new p$(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},p$=class extends u${constructor(t,e,n,r,s){super(t,e,s),this.vectorBucketName=n,this.indexName=r}async putVectors(t){var e=()=>super.putVectors,n=this;return e().call(n,on(on({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async getVectors(t){var e=()=>super.getVectors,n=this;return e().call(n,on(on({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,n=this;return e().call(n,on(on({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,n=this;return e().call(n,on(on({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,n=this;return e().call(n,on(on({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}},m$=class extends n${constructor(t,e={},n,r){super(t,e,n,r)}from(t){return new t$(this.url,this.headers,t,this.fetch)}get vectors(){return new f$(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new r$(this.url+"/iceberg",this.headers,this.fetch)}};const fI="2.89.0",Ec=30*1e3,Zx=3,U0=Zx*Ec,g$="http://localhost:9999",y$="supabase.auth.token",x$={"X-Client-Info":`gotrue-js/${fI}`},e1="X-Supabase-Api-Version",hI={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},b$=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,v$=10*60*1e3;class bf extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function Qt(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class w$ extends bf{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function k$(t){return Qt(t)&&t.name==="AuthApiError"}class wl extends bf{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class Zo extends bf{constructor(e,n,r,s){super(e,r,s),this.name=n,this.status=r}}class Ys extends Zo{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function S$(t){return Qt(t)&&t.name==="AuthSessionMissingError"}class pc extends Zo{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ah extends Zo{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Rh extends Zo{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function _$(t){return Qt(t)&&t.name==="AuthImplicitGrantRedirectError"}class ZS extends Zo{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class T$ extends Zo{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class t1 extends Zo{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function H0(t){return Qt(t)&&t.name==="AuthRetryableFetchError"}class e2 extends Zo{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class n1 extends Zo{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const am="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),t2=` 	
\r=`.split(""),C$=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<t2.length;e+=1)t[t2[e].charCodeAt(0)]=-2;for(let e=0;e<am.length;e+=1)t[am[e].charCodeAt(0)]=e;return t})();function n2(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(am[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(am[r]),e.queuedBits-=6}}function pI(t,e,n){const r=C$[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function r2(t){const e=[],n=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{j$(o,r,n)};for(let o=0;o<t.length;o+=1)pI(t.charCodeAt(o),s,i);return e.join("")}function E$(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function N$(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|s)+65536,n+=1}E$(r,e)}}function j$(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if(!(t>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function ou(t){const e=[],n={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<t.length;s+=1)pI(t.charCodeAt(s),n,r);return new Uint8Array(e)}function I$(t){const e=[];return N$(t,n=>e.push(n)),new Uint8Array(e)}function jl(t){const e=[],n={queue:0,queuedBits:0},r=s=>{e.push(s)};return t.forEach(s=>n2(s,n,r)),n2(null,n,r),e.join("")}function M$(t){return Math.round(Date.now()/1e3)+t}function D$(){return Symbol("auth-callback")}const qr=()=>typeof window<"u"&&typeof document<"u",ul={tested:!1,writable:!1},mI=()=>{if(!qr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ul.tested)return ul.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),ul.tested=!0,ul.writable=!0}catch{ul.tested=!0,ul.writable=!1}return ul.writable};function A$(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return n.searchParams.forEach((r,s)=>{e[s]=r}),e}const gI=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),R$=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Nc=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},dl=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Gr=async(t,e)=>{await t.removeItem(e)};class Ag{constructor(){this.promise=new Ag.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}Ag.promiseConstructor=Promise;function V0(t){const e=t.split(".");if(e.length!==3)throw new n1("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!b$.test(e[r]))throw new n1("JWT not in base64url format");return{header:JSON.parse(r2(e[0])),payload:JSON.parse(r2(e[1])),signature:ou(e[2]),raw:{header:e[0],payload:e[1]}}}async function O$(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function P$(t,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await t(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function L$(t){return("0"+t.toString(16)).substr(-2)}function $$(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let s="";for(let i=0;i<56;i++)s+=n.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,L$).join("")}async function z$(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function F$(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await z$(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function mc(t,e,n=!1){const r=$$();let s=r;n&&(s+="/PASSWORD_RECOVERY"),await Nc(t,`${e}-code-verifier`,s);const i=await F$(r);return[i,r===i?"plain":"s256"]}const B$=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function U$(t){const e=t.headers.get(e1);if(!e||!e.match(B$))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function H$(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function V$(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const W$=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function gc(t){if(!W$.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function W0(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function K$(t,e){return new Proxy(t,{get:(n,r,s)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,s)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,r,s)}})}function s2(t){return JSON.parse(JSON.stringify(t))}const gl=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),G$=[502,503,504];async function i2(t){var e;if(!R$(t))throw new t1(gl(t),0);if(G$.includes(t.status))throw new t1(gl(t),t.status);let n;try{n=await t.json()}catch(i){throw new wl(gl(i),i)}let r;const s=U$(t);if(s&&s.getTime()>=hI["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new e2(gl(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Ys}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new e2(gl(n),t.status,n.weak_password.reasons);throw new w$(gl(n),t.status||500,r)}const q$=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),n))};async function sn(t,e,n,r){var s;const i=Object.assign({},r==null?void 0:r.headers);i[e1]||(i[e1]=hI["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await Y$(t,e,n+a,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function Y$(t,e,n,r,s,i){const o=q$(e,r,s,i);let a;try{a=await t(n,Object.assign({},o))}catch(l){throw console.error(l),new t1(gl(l),0)}if(a.ok||await i2(a),r!=null&&r.noResolveJson)return a;try{return await a.json()}catch(l){await i2(l)}}function Hi(t){var e;let n=null;Q$(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=M$(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function o2(t){const e=Hi(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function wa(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function J$(t){return{data:t,error:null}}function X$(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i}=t,o=Mg(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function a2(t){return t}function Q$(t){return t.access_token&&t.refresh_token&&t.expires_in}const K0=["global","local","others"];class Z${constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=gI(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=K0[0]){if(K0.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${K0.join(", ")}`);try{return await sn(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Qt(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await sn(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:wa})}catch(r){if(Qt(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=Mg(e,["options"]),s=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await sn(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:X$,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(Qt(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await sn(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:wa})}catch(n){if(Qt(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,s,i,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},d=await sn(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:a2});if(d.error)throw d.error;const f=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(m.split(";")[1].split("=")[1]);u[`${b}Page`]=y}),u.total=parseInt(h)),{data:Object.assign(Object.assign({},f),u),error:null}}catch(u){if(Qt(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){gc(e);try{return await sn(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:wa})}catch(n){if(Qt(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){gc(e);try{return await sn(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:wa})}catch(r){if(Qt(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){gc(e);try{return await sn(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:wa})}catch(r){if(Qt(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){gc(e.userId);try{const{data:n,error:r}=await sn(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:n,error:r}}catch(n){if(Qt(n))return{data:null,error:n};throw n}}async _deleteFactor(e){gc(e.userId),gc(e.id);try{return{data:await sn(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Qt(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,r,s,i,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},d=await sn(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:a2});if(d.error)throw d.error;const f=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(m.split(";")[1].split("=")[1]);u[`${b}Page`]=y}),u.total=parseInt(h)),{data:Object.assign(Object.assign({},f),u),error:null}}catch(u){if(Qt(u))return{data:{clients:[]},error:u};throw u}}async _createOAuthClient(e){try{return await sn(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Qt(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await sn(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Qt(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await sn(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Qt(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await sn(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Qt(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await sn(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Qt(n))return{data:null,error:n};throw n}}}function l2(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const yc={debug:!!(globalThis&&mI()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class yI extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class e6 extends yI{}async function t6(t,e,n){yc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),yc.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){yc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,s.name);try{return await n()}finally{yc.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,s.name)}}else{if(e===0)throw yc.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new e6(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(yc.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function n6(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function xI(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function r6(t){return parseInt(t,16)}function s6(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function i6(t){var e;const{chainId:n,domain:r,expirationTime:s,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:l,resources:u,scheme:d,uri:f,version:h}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!f)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const p=xI(t.address),m=d?`${d}://${r}`:r,y=t.statement?`${t.statement}
`:"",b=`${m} wants you to sign in with your Ethereum account:
${p}

${y}`;let g=`URI: ${f}
Version: ${h}
Chain ID: ${n}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(s&&(g+=`
Expiration Time: ${s.toISOString()}`),a&&(g+=`
Not Before: ${a.toISOString()}`),l&&(g+=`
Request ID: ${l}`),u){let v=`
Resources:`;for(const w of u){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);v+=`
- ${w}`}g+=v}return`${b}
${g}`}class _r extends Error{constructor({message:e,code:n,cause:r,name:s}){var i;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(i=s??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=n}}class lm extends _r{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function o6({error:t,options:e}){var n,r,s;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new _r({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new _r({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new _r({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new _r({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new _r({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new _r({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new _r({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new _r({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const o=window.location.hostname;if(bI(o)){if(i.rp.id!==o)return new _r({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new _r({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new _r({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new _r({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new _r({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function a6({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new _r({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new _r({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(bI(r)){if(n.rpId!==r)return new _r({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new _r({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new _r({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new _r({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class l6{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const c6=new l6;function u6(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:r}=t,s=Mg(t,["challenge","user","excludeCredentials"]),i=ou(e).buffer,o=Object.assign(Object.assign({},n),{id:ou(n.id).buffer}),a=Object.assign(Object.assign({},s),{challenge:i,user:o});if(r&&r.length>0){a.excludeCredentials=new Array(r.length);for(let l=0;l<r.length;l++){const u=r[l];a.excludeCredentials[l]=Object.assign(Object.assign({},u),{id:ou(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return a}function d6(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,r=Mg(t,["challenge","allowCredentials"]),s=ou(e).buffer,i=Object.assign(Object.assign({},r),{challenge:s});if(n&&n.length>0){i.allowCredentials=new Array(n.length);for(let o=0;o<n.length;o++){const a=n[o];i.allowCredentials[o]=Object.assign(Object.assign({},a),{id:ou(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return i}function f6(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:jl(new Uint8Array(t.response.attestationObject)),clientDataJSON:jl(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function h6(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,r=t.getClientExtensionResults(),s=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:jl(new Uint8Array(s.authenticatorData)),clientDataJSON:jl(new Uint8Array(s.clientDataJSON)),signature:jl(new Uint8Array(s.signature)),userHandle:s.userHandle?jl(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function bI(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function c2(){var t,e;return!!(qr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function p6(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new lm("Browser returned unexpected credential type",e)}:{data:null,error:new lm("Empty credential response",e)}}catch(e){return{data:null,error:o6({error:e,options:t})}}}async function m6(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new lm("Browser returned unexpected credential type",e)}:{data:null,error:new lm("Empty credential response",e)}}catch(e){return{data:null,error:a6({error:e,options:t})}}}const g6={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},y6={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function cm(...t){const e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),n=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),r={};for(const s of t)if(s)for(const i in s){const o=s[i];if(o!==void 0)if(Array.isArray(o))r[i]=o;else if(n(o))r[i]=o;else if(e(o)){const a=r[i];e(a)?r[i]=cm(a,o):r[i]=cm(o)}else r[i]=o}return r}function x6(t,e){return cm(g6,t,e||{})}function b6(t,e){return cm(y6,t,e||{})}class v6{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:r,signal:s},i){try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!o)return{data:null,error:a};const l=s??c6.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:u}=o.webauthn.credential_options.publicKey;u.name||(u.name=`${u.id}:${r}`),u.displayName||(u.displayName=u.name)}switch(o.webauthn.type){case"create":{const u=x6(o.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:d,error:f}=await p6({publicKey:u,signal:l});return d?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:f}}case"request":{const u=b6(o.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:d,error:f}=await m6(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:u,signal:l}));return d?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:f}}}}catch(o){return Qt(o)?{data:null,error:o}:{data:null,error:new wl("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!n)return{data:null,error:new bf("rpId is required for WebAuthn authentication")};try{if(!c2())return{data:null,error:new wl("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:r},signal:s},{request:i});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:n,rpOrigins:r,credential_response:l.credential_response}})}catch(o){return Qt(o)?{data:null,error:o}:{data:null,error:new wl("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!n)return{data:null,error:new bf("rpId is required for WebAuthn registration")};try{if(!c2())return{data:null,error:new wl("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(d=>{var f;return(f=d.data)===null||f===void 0?void 0:f.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===e&&h.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d==null?void 0:d.id}):void 0),{data:null,error:a};const{data:l,error:u}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:s},{create:i});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:n,rpOrigins:r,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:u}}catch(o){return Qt(o)?{data:null,error:o}:{data:null,error:new wl("Unexpected error in register",o)}}}}n6();const w6={url:g$,storageKey:y$,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:x$,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function u2(t,e,n){return await n()}const xc={};class vf{get jwks(){var e,n;return(n=(e=xc[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){xc[this.storageKey]=Object.assign(Object.assign({},xc[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=xc[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){xc[this.storageKey]=Object.assign(Object.assign({},xc[this.storageKey]),{cachedAt:e})}constructor(e){var n,r,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},w6),e);if(this.storageKey=i.storageKey,this.instanceID=(n=vf.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,vf.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&qr()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Z$({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=gI(i.fetch),this.lock=i.lock||u2,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:this.persistSession&&qr()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=t6:this.lock=u2,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new v6(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:mI()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=l2(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=l2(this.memoryStorage)),qr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${fI}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},r="none";if(qr()&&(n=A$(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),qr()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:i}=await this._getSessionFromURL(n,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),_$(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Qt(n)?this._returnResult({error:n}):this._returnResult({error:new wl("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,s;try{const i=await sn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:Hi}),{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(i){if(Qt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var n,r,s;try{let i;if("email"in e){const{email:d,password:f,options:h}=e;let p=null,m=null;this.flowType==="pkce"&&([p,m]=await mc(this.storage,this.storageKey)),i=await sn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:d,password:f,data:(n=h==null?void 0:h.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:p,code_challenge_method:m},xform:Hi})}else if("phone"in e){const{phone:d,password:f,options:h}=e;i=await sn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:f,data:(r=h==null?void 0:h.data)!==null&&r!==void 0?r:{},channel:(s=h==null?void 0:h.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:Hi})}else throw new Ah("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return await Gr(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(i){if(await Gr(this.storage,`${this.storageKey}-code-verifier`),Qt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let n;if("email"in e){const{email:i,password:o,options:a}=e;n=await sn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:o2})}else if("phone"in e){const{phone:i,password:o,options:a}=e;n=await sn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:o2})}else throw new Ah("You must provide either an email or phone number and a password");const{data:r,error:s}=n;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!r||!r.session||!r.user){const i=new pc;return this._returnResult({data:{user:null,session:null},error:i})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(n){if(Qt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,r,s,i,o,a,l,u,d,f,h;let p,m;if("message"in e)p=e.message,m=e.signature;else{const{chain:y,wallet:b,statement:g,options:v}=e;let w;if(qr())if(typeof b=="object")w=b;else{const T=window;if("ethereum"in T&&typeof T.ethereum=="object"&&"request"in T.ethereum&&typeof T.ethereum.request=="function")w=T.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!(v!=null&&v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=b}const C=new URL((n=v==null?void 0:v.url)!==null&&n!==void 0?n:window.location.href),I=await w.request({method:"eth_requestAccounts"}).then(T=>T).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!I||I.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const k=xI(I[0]);let D=(r=v==null?void 0:v.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!D){const T=await w.request({method:"eth_chainId"});D=r6(T)}const S={domain:C.host,address:k,statement:g,uri:C.href,version:"1",chainId:D,nonce:(s=v==null?void 0:v.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(o=(i=v==null?void 0:v.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=v==null?void 0:v.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=v==null?void 0:v.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(u=v==null?void 0:v.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(d=v==null?void 0:v.signInWithEthereum)===null||d===void 0?void 0:d.resources};p=i6(S),m=await w.request({method:"personal_sign",params:[s6(p),k]})}try{const{data:y,error:b}=await sn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:m},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:Hi});if(b)throw b;if(!y||!y.session||!y.user){const g=new pc;return this._returnResult({data:{user:null,session:null},error:g})}return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),this._returnResult({data:Object.assign({},y),error:b})}catch(y){if(Qt(y))return this._returnResult({data:{user:null,session:null},error:y});throw y}}async signInWithSolana(e){var n,r,s,i,o,a,l,u,d,f,h,p;let m,y;if("message"in e)m=e.message,y=e.signature;else{const{chain:b,wallet:g,statement:v,options:w}=e;let C;if(qr())if(typeof g=="object")C=g;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))C=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof g!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");C=g}const I=new URL((n=w==null?void 0:w.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in C&&C.signIn){const k=await C.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:I.host,uri:I.href}),v?{statement:v}:null));let D;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")D=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)D=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in D&&"signature"in D&&(typeof D.signedMessage=="string"||D.signedMessage instanceof Uint8Array)&&D.signature instanceof Uint8Array)m=typeof D.signedMessage=="string"?D.signedMessage:new TextDecoder().decode(D.signedMessage),y=D.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in C)||typeof C.signMessage!="function"||!("publicKey"in C)||typeof C!="object"||!C.publicKey||!("toBase58"in C.publicKey)||typeof C.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${I.host} wants you to sign in with your Solana account:`,C.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${I.href}`,`Issued At: ${(s=(r=w==null?void 0:w.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=w==null?void 0:w.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((a=w==null?void 0:w.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((u=w==null?void 0:w.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((f=(d=w==null?void 0:w.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||f===void 0)&&f.length?["Resources",...w.signInWithSolana.resources.map(D=>`- ${D}`)]:[]].join(`
`);const k=await C.signMessage(new TextEncoder().encode(m),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=k}}try{const{data:b,error:g}=await sn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:jl(y)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Hi});if(g)throw g;if(!b||!b.session||!b.user){const v=new pc;return this._returnResult({data:{user:null,session:null},error:v})}return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),this._returnResult({data:Object.assign({},b),error:g})}catch(b){if(Qt(b))return this._returnResult({data:{user:null,session:null},error:b});throw b}}async _exchangeCodeForSession(e){const n=await dl(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(n??"").split("/");try{if(!r&&this.flowType==="pkce")throw new T$;const{data:i,error:o}=await sn(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Hi});if(await Gr(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const a=new pc;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(await Gr(this.storage,`${this.storageKey}-code-verifier`),Qt(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:n,provider:r,token:s,access_token:i,nonce:o}=e,a=await sn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:Hi}),{data:l,error:u}=a;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!l||!l.session||!l.user){const d=new pc;return this._returnResult({data:{user:null,session:null},error:d})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:u})}catch(n){if(Qt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,r,s,i,o;try{if("email"in e){const{email:a,options:l}=e;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await mc(this.storage,this.storageKey));const{error:f}=await sn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:f})}if("phone"in e){const{phone:a,options:l}=e,{data:u,error:d}=await sn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:d})}throw new Ah("You must provide either an email or phone number.")}catch(a){if(await Gr(this.storage,`${this.storageKey}-code-verifier`),Qt(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var n,r;try{let s,i;"options"in e&&(s=(n=e.options)===null||n===void 0?void 0:n.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await sn(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Hi});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,u=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(s){if(Qt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(e){var n,r,s,i,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await mc(this.storage,this.storageKey));const u=await sn(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:J$});return!((i=u.data)===null||i===void 0)&&i.url&&qr()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(u.data.url),this._returnResult(u)}catch(a){if(await Gr(this.storage,`${this.storageKey}-code-verifier`),Qt(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Ys;const{error:s}=await sn(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(Qt(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:o}=await sn(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:o,error:a}=await sn(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a})}throw new Ah("You must provide either an email or phone number and a type")}catch(n){if(Qt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await dl(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<U0:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const o=await dl(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=W0()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=K$(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const n=await this._acquireLock(-1,async()=>await this._getUser());return n.data.user&&(this.suppressGetSessionWarning=!0),n}async _getUser(e){try{return e?await sn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:wa}):await this._useSession(async n=>{var r,s,i;const{data:o,error:a}=n;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ys}:await sn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:wa})})}catch(n){if(Qt(n))return S$(n)&&(await this._removeSession(),await Gr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new Ys;const o=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await mc(this.storage,this.storageKey));const{data:u,error:d}=await sn(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:wa});if(d)throw d;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(r){if(await Gr(this.storage,`${this.storageKey}-code-verifier`),Qt(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ys;const n=Date.now()/1e3;let r=n,s=!0,i=null;const{payload:o}=V0(e.access_token);if(o.exp&&(r=o.exp,s=r<=n),s){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(n){if(Qt(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:o,error:a}=n;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Ys;const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(Qt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!qr())throw new Rh("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Rh(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new ZS("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Rh("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new ZS("No code detected.");const{data:v,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const C=new URL(window.location.href);return C.searchParams.delete("code"),window.history.replaceState(window.history.state,"",C.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:u}=e;if(!i||!a||!o||!u)throw new Rh("No session defined in URL");const d=Math.round(Date.now()/1e3),f=parseInt(a);let h=d+f;l&&(h=parseInt(l));const p=h-d;p*1e3<=Ec&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${f}s`);const m=h-f;d-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,h,d):d-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,h,d);const{data:y,error:b}=await this._getUser(i);if(b)throw b;const g={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:f,expires_at:h,refresh_token:o,token_type:u,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:g,redirectType:e.type},error:null})}catch(r){if(Qt(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await dl(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({error:i});const o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(k$(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await Gr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=D$(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,s;try{const{data:{session:i},error:o}=n;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,n={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await mc(this.storage,this.storageKey,!0));try{return await sn(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(i){if(await Gr(this.storage,`${this.storageKey}-code-verifier`),Qt(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:r,error:s}=await this._useSession(async i=>{var o,a,l,u,d;const{data:f,error:h}=i;if(h)throw h;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await sn(this.fetch,"GET",p,{headers:this.headers,jwt:(d=(u=f.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(s)throw s;return qr()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(Qt(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var r;try{const{error:s,data:{session:i}}=n;if(s)throw s;const{options:o,provider:a,token:l,access_token:u,nonce:d}=e,f=await sn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=i==null?void 0:i.access_token)!==null&&r!==void 0?r:void 0,body:{provider:a,id_token:l,access_token:u,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Hi}),{data:h,error:p}=f;return p?this._returnResult({data:{user:null,session:null},error:p}):!h||!h.session||!h.user?this._returnResult({data:{user:null,session:null},error:new pc}):(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:p}))}catch(s){if(await Gr(this.storage,`${this.storageKey}-code-verifier`),Qt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,s;const{data:i,error:o}=n;if(o)throw o;return await sn(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await P$(async s=>(s>0&&await O$(200*Math.pow(2,s-1)),this._debug(n,"refreshing attempt",s),await sn(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Hi})),(s,i)=>{const o=200*Math.pow(2,s);return i&&H0(i)&&Date.now()+o-r<Ec})}catch(r){if(this._debug(n,"error",r),Qt(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),qr()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const s=await dl(this.storage,this.storageKey);if(s&&this.userStorage){let o=await dl(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:s.user},await Nc(this.userStorage,this.storageKey+"-user",o)),s.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:W0()}else if(s&&!s.user&&!s.user){const o=await dl(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(s.user=o.user,await Gr(this.storage,this.storageKey+"-user"),await Nc(this.storage,this.storageKey,s)):s.user=W0()}if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),s!==null&&await this._removeSession();return}const i=((n=s.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<U0;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${U0}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:o}=await this._callRefreshToken(s.refresh_token);o&&(console.error(o),H0(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(s.access_token);!a&&(o!=null&&o.user)?(s.user=o.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(r,"error",s),console.error(s);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Ys;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Ag;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Ys;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={data:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),Qt(i)){const o={data:null,error:i};return H0(i)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,n,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,n)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Gr(this.storage,`${this.storageKey}-code-verifier`);const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await Nc(this.userStorage,this.storageKey+"-user",{user:n.user});const s=Object.assign({},n);delete s.user;const i=s2(s);await Nc(this.storage,this.storageKey,i)}else{const s=s2(n);await Nc(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Gr(this.storage,this.storageKey),await Gr(this.storage,this.storageKey+"-code-verifier"),await Gr(this.storage,this.storageKey+"-user"),this.userStorage&&await Gr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&qr()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ec);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/Ec);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Ec}ms, refresh threshold is ${Zx} ticks`),s<=Zx&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof yI)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!qr()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const s=[`provider=${encodeURIComponent(n)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await mc(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;return i?this._returnResult({data:null,error:i}):await sn(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,s;const{data:i,error:o}=n;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:u}=await sn(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return u?this._returnResult({data:null,error:u}):(e.factorType==="totp"&&l.type==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?f6(e.webauthn.credential_response):h6(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await sn(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({data:null,error:i});const o=await sn(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:u6(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:d6(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const s={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])s.all.push(i),i.status==="verified"&&s[i.factor_type].push(i);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var e,n;const{data:{session:r},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=V0(r.access_token);let o=null;i.aal&&(o=i.aal);let a=o;((n=(e=r.user.factors)===null||e===void 0?void 0:e.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(a="aal2");const u=i.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:u},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;return s?this._returnResult({data:null,error:s}):r?await sn(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Ys})})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:s},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Ys});const o=await sn(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&qr()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Qt(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:s},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Ys});const o=await sn(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&qr()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Qt(r))return this._returnResult({data:null,error:r});throw r}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;return r?this._returnResult({data:null,error:r}):n?await sn(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new Ys})})}catch(e){if(Qt(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;return s?this._returnResult({data:null,error:s}):r?(await sn(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Ys})})}catch(n){if(Qt(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(a=>a.kid===e);if(r)return r;const s=Date.now();if(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+v$>s)return r;const{data:i,error:o}=await sn(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,r=i.keys.find(a=>a.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:p,error:m}=await this.getSession();if(m||!p.session)return this._returnResult({data:null,error:m});r=p.session.access_token}const{header:s,payload:i,signature:o,raw:{header:a,payload:l}}=V0(r);n!=null&&n.allowExpired||H$(i.exp);const u=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!u){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:i,header:s,signature:o},error:null}}const d=V$(s.alg),f=await crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!await crypto.subtle.verify(d,f,o,I$(`${a}.${l}`)))throw new n1("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(r){if(Qt(r))return this._returnResult({data:null,error:r});throw r}}}vf.nextInstanceID={};const k6=vf,S6="2.89.0";let pd="";typeof Deno<"u"?pd="deno":typeof document<"u"?pd="web":typeof navigator<"u"&&navigator.product==="ReactNative"?pd="react-native":pd="node";const _6={"X-Client-Info":`supabase-js-${pd}/${S6}`},T6={headers:_6},C6={schema:"public"},E6={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},N6={};function wf(t){"@babel/helpers - typeof";return wf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wf(t)}function j6(t,e){if(wf(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(wf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function I6(t){var e=j6(t,"string");return wf(e)=="symbol"?e:e+""}function M6(t,e,n){return(e=I6(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function pr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?d2(Object(n),!0).forEach(function(r){M6(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d2(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const D6=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),A6=()=>Headers,R6=(t,e,n)=>{const r=D6(n),s=A6();return async(i,o)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:t;let u=new s(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",t),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),r(i,pr(pr({},o),{},{headers:u}))}};function O6(t){return t.endsWith("/")?t:t+"/"}function P6(t,e){var n,r;const{db:s,auth:i,realtime:o,global:a}=t,{db:l,auth:u,realtime:d,global:f}=e,h={db:pr(pr({},l),s),auth:pr(pr({},u),i),realtime:pr(pr({},d),o),storage:{},global:pr(pr(pr({},f),a),{},{headers:pr(pr({},(n=f==null?void 0:f.headers)!==null&&n!==void 0?n:{}),(r=a==null?void 0:a.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return t.accessToken?h.accessToken=t.accessToken:delete h.accessToken,h}function L6(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(O6(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var $6=class extends k6{constructor(t){super(t)}},z6=class{constructor(t,e,n){var r,s;this.supabaseUrl=t,this.supabaseKey=e;const i=L6(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,a={db:C6,realtime:N6,auth:pr(pr({},E6),{},{storageKey:o}),global:T6},l=P6(n??{},a);if(this.storageKey=(r=l.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(s=l.global.headers)!==null&&s!==void 0?s:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(d,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}});else{var u;this.auth=this._initSupabaseAuthClient((u=l.auth)!==null&&u!==void 0?u:{},this.headers,l.global.fetch)}this.fetch=R6(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(pr({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(d=>this.realtime.setAuth(d)).catch(d=>console.warn("Failed to set initial Realtime auth token:",d)),this.rest=new xL(new URL("rest/v1",i).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new m$(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new hL(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,n)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,n;if(t.accessToken)return await t.accessToken();const{data:r}=await t.auth.getSession();return(e=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:s,storageKey:i,flowType:o,lock:a,debug:l,throwOnError:u},d,f){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new $6({url:this.authUrl.href,headers:pr(pr({},h),d),storageKey:i,autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:s,flowType:o,lock:a,debug:l,throwOnError:u,fetch:f,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new OL(this.realtimeUrl.href,pr(pr({},t),{},{params:pr(pr({},{apikey:this.supabaseKey}),t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(t,e,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const F6=(t,e,n)=>new z6(t,e,n);function B6(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}B6()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const vI="https://acrkclmderqewcwugsnl.supabase.co",yp="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFjcmtjbG1kZXJxZXdjd3Vnc25sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNTc0MzAsImV4cCI6MjA4MTgzMzQzMH0.UT2vJTXpPO5tR9sUD8YU0gJ_47Zpe3yJiLzllUljPDw";console.log("Supabase Config:",{url:vI,keyLength:yp==null?void 0:yp.length});let wI=null;try{wI=F6(vI,yp)}catch(t){console.error("Error creating Supabase client:",t)}const xe=wI,kI=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),U6=(t,e)=>{const n=new Date,r=t.toLowerCase().trim();if(/^\d+$/.test(r)){const i=parseInt(r,10);let o=n.getMonth(),a=n.getFullYear();i<n.getDate()&&(o++,o>11&&(o=0,a++));const l=new Date(a,o,i);if(l.getMonth()===o)return l}if(["","today","td"].includes(r))return n;if(["","tmr","tm"].includes(r))return new Date(n.setDate(n.getDate()+1));if([""].includes(r))return new Date(n.setDate(n.getDate()+2));const s=r.match(/^\+(\d+)$/);return s?new Date(n.setDate(n.getDate()+parseInt(s[1]))):null},H6=(t,e="zh")=>t?new Date(t).toLocaleDateString(e==="zh"?"zh-TW":"en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",SI=(t,e=!0,n="zh")=>{if(!t)return"";const r=new Date(t),s=new Date;s.setHours(0,0,0,0);const i=new Date(r.getTime());i.setHours(0,0,0,0);const o=Math.floor((i.getTime()-s.getTime())/(1e3*60*60*24));let a="";if(o===0?a=n==="zh"?"":"Today":o===1?a=n==="zh"?"":"Tomorrow":o===-1?a=n==="zh"?"":"Yesterday":o<0?a=n==="zh"?`${Math.abs(o)} `:`${Math.abs(o)}d ago`:a=n==="zh"?`${r.getMonth()+1}${r.getDate()}`:r.toLocaleDateString("en-US",{month:"short",day:"numeric"}),e){const l=r.getHours(),u=r.getMinutes();(l!==0||u!==0)&&(a+=` ${String(l).padStart(2,"0")}:${String(u).padStart(2,"0")}`)}return a},_i=(t,e)=>t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate(),Iv=t=>t?_i(new Date(t),new Date):!1,r1=t=>t?new Date(t).getTime()<new Date().setHours(0,0,0,0):!1,Mv=(t,e,n)=>{if(!t)return!1;const r=n.filter(s=>s.parent_id===t);for(const s of r)if(s.id===e||Mv(s.id,e,n))return!0;return!1},V6=t=>{if(!t)return[];const e=/data-type="mention"[^>]*data-id="([^"]+)"/g,n=[];let r;for(;(r=e.exec(t))!==null;)n.push(r[1]);return n},W6=(t,e)=>{var r;return(r=t.tags)!=null&&r.some(s=>e.includes(s))?!0:V6(t.description).some(s=>e.includes(s))},xp=(t,e)=>{let n=t,r=t.parent_id;const s=new Set([t.id]);for(;r&&!s.has(r);){s.add(r);const i=e.find(o=>o.id===r);if(i)n=i,r=i.parent_id;else break}return n},K6=(t,e)=>{const n=new Date(t),r=new Date(n);switch(e.type){case"daily":r.setDate(r.getDate()+e.interval);break;case"weekly":if(e.weekdays&&e.weekdays.length>0){let s=!1;for(let i=1;i<=7*e.interval;i++){const o=new Date(n);if(o.setDate(o.getDate()+i),e.weekdays.includes(o.getDay())){r.setTime(o.getTime()),s=!0;break}}s||r.setDate(r.getDate()+7*e.interval)}else r.setDate(r.getDate()+7*e.interval);break;case"monthly":if(r.setMonth(r.getMonth()+e.interval),e.monthDay){const s=Math.min(e.monthDay,f2(r));r.setDate(s)}break;case"yearly":if(r.setFullYear(r.getFullYear()+e.interval),e.yearMonth!==void 0&&e.yearDay!==void 0){r.setMonth(e.yearMonth-1);const s=Math.min(e.yearDay,f2(r));r.setDate(s)}break}if(e.endDate){const s=new Date(e.endDate);if(r>s)return null}return r.toISOString()},f2=t=>new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),G6=(t,e="zh")=>{if(t.originalText)return t.originalText;const n=t.interval;let r="";if(e==="zh")switch(t.type){case"daily":r=n===1?"":`${n}`;break;case"weekly":r=n===1?"":`${n}`;break;case"monthly":t.monthDay?r=n===1?`${t.monthDay}`:`${n}${t.monthDay}`:r=n===1?"":`${n}`;break;case"yearly":t.yearMonth&&t.yearDay?r=`${t.yearMonth}${t.yearDay}`:r=n===1?"":`${n}`;break}else switch(t.type){case"daily":r=n===1?"Every day":`Every ${n} days`;break;case"weekly":r=n===1?"Every week":`Every ${n} weeks`;break;case"monthly":t.monthDay?r=n===1?`Monthly on day ${t.monthDay}`:`Every ${n} months on day ${t.monthDay}`:r=n===1?"Every month":`Every ${n} months`;break;case"yearly":r=n===1?"Every year":`Every ${n} years`;break}if(t.endDate){const s=new Date(t.endDate).toLocaleDateString(e==="zh"?"zh-TW":"en-US");r+=e==="zh"?` (${s})`:` (until ${s})`}return r},_I=()=>new Promise((t,e)=>{var r;if((r=window.google)!=null&&r.accounts){t();return}document.querySelector('script[src="https://accounts.google.com/gsi/client"]');const n=document.createElement("script");n.src="https://accounts.google.com/gsi/client",n.async=!0,n.defer=!0,n.onload=()=>t(),n.onerror=e,document.body.appendChild(n)}),kl=async t=>{const e=await fetch("https://www.googleapis.com/calendar/v3/users/me/calendarList",{headers:{Authorization:`Bearer ${t}`}});if(!e.ok)throw new Error("Failed to fetch calendar list");return(await e.json()).items||[]},TI=async(t,e,n,r)=>{var u;const s=new Date(n).toISOString(),i=new Date(r),o=new URLSearchParams({timeMin:s,timeMax:i.toISOString(),singleEvents:"true",orderBy:"startTime",maxResults:"2500"}),a=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events?${o}`,{headers:{Authorization:`Bearer ${t}`}}),l=await a.json();if(!a.ok)throw new Error(((u=l.error)==null?void 0:u.message)||"Failed to fetch calendar events");return l.items||[]},s1=async(t,e,n,r)=>{var o,a;let i=0;for(;i<3;){i++;const l=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events/${encodeURIComponent(n)}`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(l.ok)return;if(l.status===403||l.status===429){const f=(((o=(await l.clone().json().catch(()=>({}))).error)==null?void 0:o.message)||"").toLowerCase();if((f.includes("rate limit")||f.includes("quota")||l.status===429)&&i<3){const h=i*1500;console.warn(`[Google Sync] Rate Limit Hit. Retrying update in ${h}ms... (Attempt ${i}/3)`),await new Promise(p=>setTimeout(p,h));continue}}const u=await l.json();throw new Error(((a=u.error)==null?void 0:a.message)||"Failed to update Google event")}},ca=async(t,e,n)=>{var s;const r=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events/${encodeURIComponent(n)}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!r.ok){const i=await r.json();throw new Error(((s=i.error)==null?void 0:s.message)||"Failed to delete Google event")}},Mo=async(t,e,n)=>{var i;const r=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){const o=await r.json();throw new Error(((i=o.error)==null?void 0:i.message)||"Failed to create Google event")}return(await r.json()).id},CI=async(t,e,n)=>{let r={singleEvents:"true",maxResults:"2500"};const s=new Date,i=new Date;if(i.setFullYear(s.getFullYear()+2),n)r.syncToken=n;else{const u=new Date;u.setMonth(u.getMonth()-1),r.timeMin=u.toISOString(),r.timeMax=i.toISOString()}let o=[],a,l;try{do{const u=new URLSearchParams({...r,...l?{pageToken:l}:{}}),d=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events?${u}`,{headers:{Authorization:`Bearer ${t}`}});if(d.status===410)return{events:[],fullSyncRequired:!0};if(!d.ok)throw new Error("Sync Request Failed");const f=await d.json();if(f.items){const h=i.getTime(),p=f.items.filter(m=>m.recurringEventId?!1:m.start&&(m.start.dateTime||m.start.date)?new Date(m.start.dateTime||m.start.date).getTime()<h:!0);o.push(...p)}l=f.nextPageToken,a=f.nextSyncToken}while(l);return{events:o,nextSyncToken:a}}catch(u){throw console.error(u),u}},q6=Object.freeze(Object.defineProperty({__proto__:null,createGoogleEvent:Mo,deleteGoogleEvent:ca,fetchCalendarList:kl,fetchGoogleEvents:TI,fetchUpdatedGoogleEvents:CI,loadGoogleScript:_I,updateGoogleEvent:s1},Symbol.toStringTag,{value:"Module"})),Y6="v1.6.0",bp=28,EI=new Image;EI.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";const Jn={slate:{color:"#64748b",bg:"bg-slate-50",text:"text-slate-600",accent:"text-slate-600",badge:"bg-slate-100 text-slate-600 border-slate-200",border:"border-slate-500",ring:"focus-within:ring-slate-200",buttonRing:"focus:ring-slate-200 focus:border-slate-300",dot:"bg-slate-400",breadcrumb:"bg-slate-50 text-slate-600 hover:bg-slate-100",indicator:"bg-slate-500",ringColor:"ring-slate-400"},gray:{color:"#6b7280",bg:"bg-gray-50",text:"text-gray-600",accent:"text-gray-600",badge:"bg-gray-100 text-gray-600 border-gray-200",border:"border-gray-300",ring:"focus-within:ring-gray-200",buttonRing:"focus:ring-gray-200 focus:border-gray-300",dot:"bg-gray-400",breadcrumb:"bg-gray-50 text-gray-600 hover:bg-gray-100",indicator:"bg-gray-500",ringColor:"ring-gray-400"},zinc:{color:"#71717a",bg:"bg-zinc-50",text:"text-zinc-600",accent:"text-zinc-600",badge:"bg-zinc-100 text-zinc-600 border-zinc-200",border:"border-zinc-500",ring:"focus-within:ring-zinc-200",buttonRing:"focus:ring-zinc-200 focus:border-zinc-300",dot:"bg-zinc-400",breadcrumb:"bg-zinc-50 text-zinc-600 hover:bg-zinc-100",indicator:"bg-zinc-500",ringColor:"ring-zinc-400"},neutral:{color:"#737373",bg:"bg-neutral-50",text:"text-neutral-600",accent:"text-neutral-600",badge:"bg-neutral-100 text-neutral-600 border-neutral-200",border:"border-neutral-500",ring:"focus-within:ring-neutral-200",buttonRing:"focus:ring-neutral-200 focus:border-neutral-300",dot:"bg-neutral-400",breadcrumb:"bg-neutral-50 text-neutral-600 hover:bg-neutral-100",indicator:"bg-neutral-500",ringColor:"ring-neutral-400"},stone:{color:"#78716c",bg:"bg-stone-50",text:"text-stone-600",accent:"text-stone-600",badge:"bg-stone-100 text-stone-600 border-stone-200",border:"border-stone-500",ring:"focus-within:ring-stone-200",buttonRing:"focus:ring-stone-200 focus:border-stone-300",dot:"bg-stone-400",breadcrumb:"bg-stone-50 text-stone-600 hover:bg-stone-100",indicator:"bg-stone-500",ringColor:"ring-stone-400"},red:{color:"#ef4444",bg:"bg-red-50",text:"text-red-600",accent:"text-red-600",badge:"bg-red-100 text-red-600 border-red-200",border:"border-red-500",ring:"focus-within:ring-red-200",buttonRing:"focus:ring-red-200 focus:border-red-300",dot:"bg-red-400",breadcrumb:"bg-red-50 text-red-600 hover:bg-red-100",indicator:"bg-red-500",ringColor:"ring-red-400"},orange:{color:"#f97316",bg:"bg-orange-50",text:"text-orange-600",accent:"text-orange-600",badge:"bg-orange-100 text-orange-600 border-orange-200",border:"border-orange-500",ring:"focus-within:ring-orange-200",buttonRing:"focus:ring-orange-200 focus:border-orange-300",dot:"bg-orange-400",breadcrumb:"bg-orange-50 text-orange-600 hover:bg-orange-100",indicator:"bg-orange-500",ringColor:"ring-orange-400"},amber:{color:"#f59e0b",bg:"bg-amber-50",text:"text-amber-600",accent:"text-amber-600",badge:"bg-amber-100 text-amber-600 border-amber-200",border:"border-amber-500",ring:"focus-within:ring-amber-200",buttonRing:"focus:ring-amber-200 focus:border-amber-300",dot:"bg-amber-400",breadcrumb:"bg-amber-50 text-amber-600 hover:bg-amber-100",indicator:"bg-amber-500",ringColor:"ring-amber-400"},yellow:{color:"#eab308",bg:"bg-yellow-50",text:"text-yellow-600",accent:"text-yellow-600",badge:"bg-yellow-100 text-yellow-600 border-yellow-200",border:"border-yellow-500",ring:"focus-within:ring-yellow-200",buttonRing:"focus:ring-yellow-200 focus:border-yellow-300",dot:"bg-yellow-400",breadcrumb:"bg-yellow-50 text-yellow-600 hover:bg-yellow-100",indicator:"bg-yellow-500",ringColor:"ring-yellow-400"},lime:{color:"#84cc16",bg:"bg-lime-50",text:"text-lime-600",accent:"text-lime-600",badge:"bg-lime-100 text-lime-600 border-lime-200",border:"border-lime-500",ring:"focus-within:ring-lime-200",buttonRing:"focus:ring-lime-200 focus:border-lime-300",dot:"bg-lime-400",breadcrumb:"bg-lime-50 text-lime-600 hover:bg-lime-100",indicator:"bg-lime-500",ringColor:"ring-lime-400"},green:{color:"#10b981",bg:"bg-green-50",text:"text-green-600",accent:"text-green-600",badge:"bg-green-100 text-green-600 border-green-200",border:"border-green-500",ring:"focus-within:ring-green-200",buttonRing:"focus:ring-green-200 focus:border-green-300",dot:"bg-green-400",breadcrumb:"bg-green-50 text-green-600 hover:bg-green-100",indicator:"bg-green-500",ringColor:"ring-green-400"},emerald:{color:"#10b981",bg:"bg-emerald-50",text:"text-emerald-600",accent:"text-emerald-600",badge:"bg-emerald-100 text-emerald-600 border-emerald-200",border:"border-emerald-500",ring:"focus-within:ring-emerald-200",buttonRing:"focus:ring-emerald-200 focus:border-emerald-300",dot:"bg-emerald-400",breadcrumb:"bg-emerald-50 text-emerald-600 hover:bg-emerald-100",indicator:"bg-emerald-500",ringColor:"ring-emerald-400"},teal:{color:"#14b8a6",bg:"bg-teal-50",text:"text-teal-600",accent:"text-teal-600",badge:"bg-teal-100 text-teal-600 border-teal-200",border:"border-teal-500",ring:"focus-within:ring-teal-200",buttonRing:"focus:ring-teal-200 focus:border-teal-300",dot:"bg-teal-400",breadcrumb:"bg-teal-50 text-teal-600 hover:bg-teal-100",indicator:"bg-teal-500",ringColor:"ring-teal-400"},cyan:{color:"#06b6d4",bg:"bg-cyan-50",text:"text-cyan-600",accent:"text-cyan-600",badge:"bg-cyan-100 text-cyan-600 border-cyan-200",border:"border-cyan-500",ring:"focus-within:ring-cyan-200",buttonRing:"focus:ring-cyan-200 focus:border-cyan-300",dot:"bg-cyan-400",breadcrumb:"bg-cyan-50 text-cyan-600 hover:bg-cyan-100",indicator:"bg-cyan-500",ringColor:"ring-cyan-400"},sky:{color:"#0ea5e9",bg:"bg-sky-50",text:"text-sky-600",accent:"text-sky-600",badge:"bg-sky-100 text-sky-600 border-sky-200",border:"border-sky-500",ring:"focus-within:ring-sky-200",buttonRing:"focus:ring-sky-200 focus:border-sky-300",dot:"bg-sky-400",breadcrumb:"bg-sky-50 text-sky-600 hover:bg-sky-100",indicator:"bg-sky-500",ringColor:"ring-sky-400"},blue:{color:"#3b82f6",bg:"bg-blue-50",text:"text-blue-600",accent:"text-blue-600",badge:"bg-blue-100 text-blue-600 border-blue-200",border:"border-blue-500",ring:"focus-within:ring-blue-200",buttonRing:"focus:ring-blue-200 focus:border-blue-300",dot:"bg-blue-400",breadcrumb:"bg-blue-50 text-blue-600 hover:bg-blue-100",indicator:"bg-blue-500",ringColor:"ring-blue-400"},indigo:{color:"#6366f1",bg:"bg-indigo-50",text:"text-indigo-600",accent:"text-indigo-600",badge:"bg-indigo-100 text-indigo-600 border-indigo-200",border:"border-indigo-500",ring:"focus-within:ring-indigo-200",buttonRing:"focus:ring-indigo-200 focus:border-indigo-300",dot:"bg-indigo-400",breadcrumb:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100",indicator:"bg-indigo-500",ringColor:"ring-indigo-400"},violet:{color:"#8b5cf6",bg:"bg-violet-50",text:"text-violet-600",accent:"text-violet-600",badge:"bg-violet-100 text-violet-600 border-violet-200",border:"border-violet-500",ring:"focus-within:ring-violet-200",buttonRing:"focus:ring-violet-200 focus:border-violet-300",dot:"bg-violet-400",breadcrumb:"bg-violet-50 text-violet-600 hover:bg-violet-100",indicator:"bg-violet-500",ringColor:"ring-violet-400"},purple:{color:"#a855f7",bg:"bg-purple-50",text:"text-purple-600",accent:"text-purple-600",badge:"bg-purple-100 text-purple-600 border-purple-200",border:"border-purple-500",ring:"focus-within:ring-purple-200",buttonRing:"focus:ring-purple-200 focus:border-purple-300",dot:"bg-purple-400",breadcrumb:"bg-purple-50 text-purple-600 hover:bg-purple-100",indicator:"bg-purple-500",ringColor:"ring-purple-400"},fuchsia:{color:"#d946ef",bg:"bg-fuchsia-50",text:"text-fuchsia-600",accent:"text-fuchsia-600",badge:"bg-fuchsia-100 text-fuchsia-600 border-fuchsia-200",border:"border-fuchsia-500",ring:"focus-within:ring-fuchsia-200",buttonRing:"focus:ring-fuchsia-200 focus:border-fuchsia-300",dot:"bg-fuchsia-400",breadcrumb:"bg-fuchsia-50 text-fuchsia-600 hover:bg-fuchsia-100",indicator:"bg-fuchsia-500",ringColor:"ring-fuchsia-400"},pink:{color:"#ec4899",bg:"bg-pink-50",text:"text-pink-600",accent:"text-pink-600",badge:"bg-pink-100 text-pink-600 border-pink-200",border:"border-pink-500",ring:"focus-within:ring-pink-200",buttonRing:"focus:ring-pink-200 focus:border-pink-300",dot:"bg-pink-400",breadcrumb:"bg-pink-50 text-pink-600 hover:bg-pink-100",indicator:"bg-pink-500",ringColor:"ring-pink-400"},rose:{color:"#f43f5e",bg:"bg-rose-50",text:"text-rose-600",accent:"text-rose-600",badge:"bg-rose-100 text-rose-600 border-rose-200",border:"border-rose-500",ring:"focus-within:ring-rose-200",buttonRing:"focus:ring-rose-200 focus:border-rose-300",dot:"bg-rose-400",breadcrumb:"bg-rose-50 text-rose-600 hover:bg-rose-100",indicator:"bg-rose-500",ringColor:"ring-rose-400"}},J6={zh:{inbox:"",today:"",upcoming:"",anytime:"",someday:"",logbook:"",trash:"",tags:"",focus:"",journal:"",prompt:"",newTag:"",subTagPlaceholder:"...",tagStyle:"",selectTagColor:"",addSubTag:"",rename:"",deleteTagConfirm:"",deleteTag:"",settings:"",logout:"",emptyTrash:"",emptyTrashConfirm:"",trashEmptyTitle:"",restoreTrash:"",restoreTrashConfirm:"",putBack:"",delete:"",archive:"",notesPlaceholder:"...",addTagPlaceholder:"...",attachFiles:"",aiPolishSuggestions:"AI ",suggestedTitle:" ()",suggestedContent:" ()",aiPolishApplied:" AI ",confirmReplace:"",dateInputPlaceholder:": 5, , ...",identified:"",scheduleTitle:"",noSchedule:"",confirmDate:"",addNotePlaceholder:"...",from:"",addNewTag:"",presentationMode:"",editMode:"",linkAttachments:"",linkedTo:"",noParagraphs:"",clickToLink:"",paragraph:"",noAttachmentsLinked:"",save:"",cancel:"",share:"",aiPolish:"AI ",aiAssistant:"AI ",undo:"",redo:"",dismiss:"",permanentlyDeleted:"",restored:"",appearance:"",fontSize:"",fontWeight:"",fontFamily:"",language:"",timeFormat:"",calendarSettings:"",showLunar:"",showTaiwanHolidays:"",aiSettings:"AI ",provider:"",fontNormal:"",fontThin:"",sizeSmall:"",sizeNormal:"",sizeLarge:"",fontSystem:"",fontThings:"",theme:""},en:{inbox:"Inbox",today:"Today",upcoming:"Upcoming",anytime:"Anytime",someday:"Inspiration",logbook:"Logbook",trash:"Trash",tags:"Tags",focus:"Focus",journal:"Note",prompt:"Prompt",newTag:"New Tag",subTagPlaceholder:"Subtag name...",tagStyle:"Tag Style",selectTagColor:"Select tag color",addSubTag:"Add Subtag",rename:"Rename",deleteTagConfirm:"Are you sure you want to delete this tag?",deleteTag:"Delete Tag",settings:"Settings",logout:"Logout",emptyTrash:"Empty Trash",emptyTrashConfirm:"Are you sure you want to permanently delete all items in the trash? This action is irreversible.",trashEmptyTitle:"Trash",restoreTrash:"Restore All",restoreTrashConfirm:"Are you sure you want to restore all items in the trash?",putBack:"Put Back",delete:"Delete",archive:"Archive",notesPlaceholder:"Notes...",addTagPlaceholder:"Add tag...",attachFiles:"Files",aiPolishSuggestions:"AI Polish Suggestions",suggestedTitle:"Suggested Title (Editable)",suggestedContent:"Suggested Content (Editable)",aiPolishApplied:"AI polish applied",confirmReplace:"Confirm Replace",dateInputPlaceholder:"Type: 5, tomorrow, next Fri...",identified:"Identified",scheduleTitle:"Schedule",noSchedule:"No tasks scheduled",confirmDate:"Confirm Date",addNotePlaceholder:"Add a note...",from:"From",addNewTag:"Add",presentationMode:"Presentation Mode",editMode:"Edit Mode",linkAttachments:"Link Attachments",linkedTo:"Linked to",noParagraphs:"No paragraphs yet",clickToLink:"Click to link attachments",paragraph:"Paragraph",noAttachmentsLinked:"No attachments linked",save:"Save",cancel:"Cancel",share:"Share",aiPolish:"AI Polish",aiAssistant:"AI Assistant",undo:"Undo",redo:"Redo",dismiss:"Dismiss",permanentlyDeleted:"Permanently deleted",restored:"Restored",appearance:"Appearance",fontSize:"Font Size",fontWeight:"Font Weight",fontFamily:"Font Family",language:"Language",timeFormat:"Time Format",calendarSettings:"Calendar Settings",showLunar:"Show Lunar",showTaiwanHolidays:"Show Holidays",aiSettings:"AI Settings",provider:"Provider",fontNormal:"Normal",fontThin:"Thin",sizeSmall:"Small",sizeNormal:"Normal",sizeLarge:"Large",fontSystem:"Default",fontThings:"Thin",theme:"Theme"}},Il={VIEW_TAG_FILTERS:"viewTagFilters",HEART_VIEW_STATE:"heartViewState",LAST_VIEW:"lastView"},G0={},X6=1e3;async function Dd(t,e){if(!xe){console.warn("[UserPrefs] Supabase not available, using localStorage");const n=localStorage.getItem(`pref_${e}_${t}`);return n?JSON.parse(n):null}try{const{data:n,error:r}=await xe.from("user_preferences").select("preference_value").eq("user_id",t).eq("preference_key",e).single();if(r){if(r.code==="PGRST116")return null;console.warn("[UserPrefs] Load error:",r);const s=localStorage.getItem(`pref_${e}_${t}`);return s?JSON.parse(s):null}return n==null?void 0:n.preference_value}catch(n){console.error("[UserPrefs] Load exception:",n);const r=localStorage.getItem(`pref_${e}_${t}`);return r?JSON.parse(r):null}}async function Fl(t,e,n){localStorage.setItem(`pref_${e}_${t}`,JSON.stringify(n)),G0[e]&&clearTimeout(G0[e]),G0[e]=setTimeout(async()=>{if(xe)try{const{error:r}=await xe.from("user_preferences").upsert({user_id:t,preference_key:e,preference_value:n,updated_at:new Date().toISOString()},{onConflict:"user_id,preference_key"});r&&console.warn("[UserPrefs] Save error:",r)}catch(r){console.error("[UserPrefs] Save exception:",r)}},X6)}const fl=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),En=x.createContext({}),Q6=({children:t})=>{const[e,n]=x.useState(null),[r,s]=x.useState([]),[i,o]=x.useState([]),[a,l]=x.useState([]),[u,d]=x.useState(!0),[f,h]=x.useState(null),[p,m]=x.useState("synced"),[y,b]=x.useState(null),[g,v]=x.useState([]),[w,C]=x.useState(null),[I,k]=x.useState(null),[D,S]=x.useState(null),[T,_]=x.useState([]),N=B=>{if(typeof B=="function")S(U=>{const P=B(U);if(P===null)return null;const G=ne.current.find(F=>F.id===P);return G!=null&&G.is_locked&&!T.includes(P)?(console.warn("Blocked editing locked task:",P),U):P});else{if(B===null){S(null);return}const U=ne.current.find(P=>P.id===B);if(U!=null&&U.is_locked&&!T.includes(B)){console.warn("Blocked editing locked task:",B);return}S(B)}},A=D,O=B=>{_(U=>[...U,B]),setTimeout(()=>{_(U=>U.filter(P=>P!==B))},3e4)},[L,V]=x.useState(()=>{const B=localStorage.getItem(`expanded_tasks_${e==null?void 0:e.id}`);return B?JSON.parse(B):[]}),[E,j]=x.useState({}),[H,W]=x.useState([]),[R,ae]=x.useState(!1),[re,$]=x.useState(!1),[z,le]=x.useState(()=>{const B=localStorage.getItem("locked_google_tag_ids");return B?JSON.parse(B):[]}),$e=x.useCallback(B=>{le(U=>{const G=U.includes(B)?U.filter(F=>F!==B):[...U,B];return localStorage.setItem("locked_google_tag_ids",JSON.stringify(G)),G})},[]),Be=x.useCallback(B=>{if(!B.tags||B.tags.length===0)return!1;for(const U of B.tags)if(z.includes(U)){const P=a.find(G=>G.id===U);if(P&&P.name.startsWith("Google:"))return!0}return!1},[z,a]);x.useEffect(()=>{(async()=>{if(e!=null&&e.id){const P=await Dd(e.id,Il.VIEW_TAG_FILTERS);if(P){const G={};Object.keys(P).forEach(F=>{Array.isArray(P[F])?G[F]={include:P[F],exclude:[]}:G[F]=P[F]}),j(G),localStorage.setItem("viewTagFilters",JSON.stringify(G));return}}const U=localStorage.getItem("viewTagFilters");if(U)try{const P=JSON.parse(U),G={};Object.keys(P).forEach(F=>{Array.isArray(P[F])?G[F]={include:P[F],exclude:[]}:G[F]=P[F]}),j(G),e!=null&&e.id&&Fl(e.id,Il.VIEW_TAG_FILTERS,G)}catch(P){console.error("Failed to parse viewTagFilters",P)}})()},[e==null?void 0:e.id]);const se=(B,U)=>{j(P=>{const G={...P,[B]:U};return localStorage.setItem("viewTagFilters",JSON.stringify(G)),e!=null&&e.id&&Fl(e.id,Il.VIEW_TAG_FILTERS,G),G})},Se=x.useMemo(()=>{const B={},U=P=>{if(B[P])return B[P];const G=a.find(F=>F.id===P);return G?G.parent_id?G.color==="#6366f1"||!G.color?(B[P]=U(G.parent_id),B[P]):(B[P]=G.color,B[P]):(B[P]=G.color||"#6366f1",B[P]):"#6366f1"};return a.forEach(P=>U(P.id)),B},[a]),[ce,Ee]=x.useState(()=>localStorage.getItem(`last_view_${e==null?void 0:e.id}`)||"inbox"),[He,tt]=x.useState(null),[ut,Ge]=x.useState([]),mt=x.useRef([]);mt.current=ut;const[ht,Ie]=x.useState({additionalTags:[],startDate:null,dueDate:null,color:null}),[ge,ie]=x.useState(()=>{const B=localStorage.getItem(`theme_settings_${e==null?void 0:e.id}`),U={fontWeight:"thin",fontSize:"normal",fontFamily:"system",timeFormat:"24h",showLunar:!1,showTaiwanHolidays:!1,language:"zh"};return B?{...U,...JSON.parse(B)}:U}),me=ge.language||"zh",Q=B=>{ie(U=>({...U,language:B}))};x.useEffect(()=>{ge.themeMode&&ge.themeMode!=="light"?document.documentElement.setAttribute("data-theme",ge.themeMode):document.documentElement.removeAttribute("data-theme")},[ge.themeMode]),x.useEffect(()=>{const B=ge.fontFamily||"system";document.documentElement.setAttribute("data-font",B)},[ge.fontFamily]);const X=x.useCallback(B=>J6[me][B]||B,[me]),[he,ke]=x.useState(null),[ee,pe]=x.useState(null),[Re,_t]=x.useState(()=>{const B=localStorage.getItem(`calendar_current_date_${e==null?void 0:e.id}`);return B?new Date(B):new Date}),[Nt,ot]=x.useState(()=>parseInt(localStorage.getItem(`sidebar_width_${e==null?void 0:e.id}`)||"260")),[Ot,we]=x.useState(()=>localStorage.getItem(`sidebar_collapsed_${e==null?void 0:e.id}`)==="true"),[qe,Ke]=x.useState(()=>parseInt(localStorage.getItem(`focus_split_width_${e==null?void 0:e.id}`)||"400")),[it,Me]=x.useState(!1);x.useEffect(()=>{e!=null&&e.id&&localStorage.setItem(`sidebar_collapsed_${e.id}`,Ot.toString())},[Ot]),x.useEffect(()=>{ce==="focus"&&(v([]),k(null))},[ce]),x.useEffect(()=>{const B=G=>{const F=/Mac|iPod|iPhone|iPad/.test(navigator.userAgent);(G.ctrlKey||G.metaKey&&!F)&&Me(!0)},U=G=>{const F=/Mac|iPod|iPhone|iPad/.test(navigator.userAgent);!G.ctrlKey&&!(G.metaKey&&!F)&&Me(!1)},P=()=>Me(!1);return window.addEventListener("keydown",B),window.addEventListener("keyup",U),window.addEventListener("blur",P),()=>{window.removeEventListener("keydown",B),window.removeEventListener("keyup",U),window.removeEventListener("blur",P)}},[]),x.useEffect(()=>{e!=null&&e.id&&localStorage.setItem(`calendar_current_date_${e.id}`,Re.toISOString())},[Re]),x.useEffect(()=>{(async()=>{if(e!=null&&e.id){const U=await Dd(e.id,"focusSplitWidth");if(U)Ke(U),localStorage.setItem(`focus_split_width_${e.id}`,U.toString());else{const G=localStorage.getItem(`focus_split_width_${e.id}`);G&&Ke(parseInt(G))}const P=await Dd(e.id,"sidebarWidth");P&&(ot(P),localStorage.setItem(`sidebar_width_${e.id}`,P.toString()))}})()},[e==null?void 0:e.id]),x.useEffect(()=>{e!=null&&e.id&&(localStorage.setItem(`focus_split_width_${e.id}`,qe.toString()),Fl(e.id,"focusSplitWidth",qe))},[qe,e==null?void 0:e.id]),x.useEffect(()=>{e&&console.warn("[AppContext] Current User ID:",e.id,"Email:",e.email)},[e]);const yt=x.useMemo(()=>{const B={};return r.forEach(U=>{if(U.status==="deleted"||U.status==="logged")return;const P=U.start_date||U.due_date;if(P){const G=P.split("T")[0];B[G]=(B[G]||0)+1}}),B},[r]),[fe,ye]=x.useState(()=>{const B=localStorage.getItem(`expanded_tags_${e==null?void 0:e.id}`);return B?JSON.parse(B):[]}),[_e,ft]=x.useState([]),[lt,nt]=x.useState([]),[Et,jt]=x.useState([]),ne=x.useRef([]),[Te,Ce]=x.useState({isDragging:!1,draggedId:null,originalDepth:0,dragOffsetX:0,dropIndex:null,dropDepth:0,indicatorTop:0,indicatorLeft:0,indicatorWidth:0,ghostPosition:{x:0,y:0},anchorTaskIndex:null}),rt=x.useRef({}),q=x.useRef(null),De=x.useRef(null);x.useEffect(()=>{if(!xe){h("Supabase client not initialized"),d(!1);return}(async()=>{try{let P=localStorage.getItem("gtd_user_id");(!P||!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(P))&&(console.warn("Invalid or missing User ID, resetting to default."),P="00000000-0000-0000-0000-000000000000",localStorage.setItem("gtd_user_id",P));let F;if(xe){const{data:{session:J},error:de}=await xe.auth.getSession();if(de)throw de;F=(J==null?void 0:J.user)||{id:P},n(F)}else F={id:P},n(F);if(F!=null&&F.id){const J=localStorage.getItem(`expanded_tasks_${F.id}`);J&&V(JSON.parse(J));const de=localStorage.getItem(`last_view_${F.id}`);de&&Ee(de);const Oe=localStorage.getItem(`sidebar_width_${F.id}`);Oe&&ot(parseInt(Oe));const Ye=localStorage.getItem(`expanded_tags_${F.id}`);Ye&&ye(JSON.parse(Ye));const Xe=localStorage.getItem(`theme_settings_${F.id}`);Xe&&ie(JSON.parse(Xe))}}catch(P){console.error("Initialization error:",P),h(P.message||"Failed to initialize app"),d(!1)}})();const{data:U}=(xe==null?void 0:xe.auth.onAuthStateChange(async(P,G)=>{P==="SIGNED_IN"?n(G==null?void 0:G.user):P==="SIGNED_OUT"&&n(null)}))||{data:{subscription:{unsubscribe:()=>{}}}};return()=>{U.subscription.unsubscribe()}},[]),x.useEffect(()=>{ne.current=r},[r]),x.useEffect(()=>{if(!e||!xe)return;(async()=>{try{if(xe){let G=[],F=0;const J=1e3;let de=!0;for(;de;){const{data:je,error:Ve}=await xe.from("tasks").select("*").eq("user_id",e.id).order("order_index",{ascending:!0}).order("created_at",{ascending:!0}).range(F,F+J-1);if(Ve){console.error("[Debug] Fetch Error:",Ve);break}je&&je.length>0?(G=[...G,...je],je.length<J?de=!1:F+=J):de=!1}const Oe=G,{data:Ye,error:Xe}=await xe.from("tags").select("*").eq("user_id",e.id);Xe&&console.error("Tags fetch error:",Xe);const dt=(Ye||[]).sort((je,Ve)=>(je.order_index||0)-(Ve.order_index||0));if(l(dt||[]),Oe){const je=Oe.map(Ve=>({...Ve,parent_id:Ve.parent_id||null,tags:Ve.tags||[],images:Ve.images||[],attachments:Ve.attachments||[],attachment_links:Ve.attachment_links||[],view_orders:Ve.view_orders||{}}));s(je),ne.current=je}const{data:Ct,error:pt}=await xe.from("archived_tasks").select("*").eq("user_id",e.id).order("archived_at",{ascending:!1});if(pt)console.warn("Failed to fetch archived tasks (table may not exist yet):",pt);else if(Ct){const je=Ct.map(Ve=>({...Ve,parent_id:Ve.parent_id||null,original_parent_id:Ve.original_parent_id||null,tags:Ve.tags||[],images:Ve.images||[],attachments:Ve.attachments||[],view_orders:Ve.view_orders||{},is_all_day:!0,start_time:null,end_time:null,duration:null}));o(je)}const{data:vt,error:Ze}=await xe.from("search_history").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(50);Ze?console.warn("Failed to fetch search history (table may not exist yet):",Ze):vt&&W(vt)}}catch(G){console.error("Error fetching data:",G)}finally{d(!1)}})();const U=xe.channel("tasks_changes").on("postgres_changes",{event:"*",schema:"public",table:"tasks",filter:`user_id=eq.${e.id}`},G=>{if(!(G.new&&rt.current[G.new.id]&&Date.now()-rt.current[G.new.id]<2e3))if(G.eventType==="INSERT"){const F={...G.new,parent_id:G.new.parent_id||null,tags:G.new.tags||[],images:G.new.images||[],attachments:G.new.attachments||[],attachment_links:G.new.attachment_links||[],view_orders:G.new.view_orders||{}};s(J=>{if(J.some(Oe=>Oe.id===F.id))return J;const de=[F,...J].sort((Oe,Ye)=>(Oe.order_index||0)-(Ye.order_index||0)||Oe.created_at.localeCompare(Ye.created_at));return ne.current=de,de})}else if(G.eventType==="UPDATE"){const F={...G.new,tags:G.new.tags||[],images:G.new.images||[],attachments:G.new.attachments||[],attachment_links:G.new.attachment_links||[],view_orders:G.new.view_orders||{}};s(J=>{const de=J.map(Oe=>Oe.id===F.id?F:Oe).sort((Oe,Ye)=>(Oe.order_index||0)-(Ye.order_index||0)||Oe.created_at.localeCompare(Ye.created_at));return ne.current=de,de})}else G.eventType==="DELETE"&&s(F=>{const J=F.filter(de=>de.id!==G.old.id);return ne.current=J,J})}).subscribe(),P=xe.channel("tags_changes").on("postgres_changes",{event:"*",schema:"public",table:"tags",filter:`user_id=eq.${e.id}`},G=>{G.eventType==="INSERT"?l(F=>F.some(J=>J.id===G.new.id)?F:[...F,G.new]):G.eventType==="DELETE"&&l(F=>F.filter(J=>J.id!==G.old.id))}).subscribe();return()=>{U.unsubscribe(),P.unsubscribe()}},[e]);const st=B=>{console.error(B),m("error"),b({msg:`Sync Failed: ${B.message||"Unknown error"}`,type:"error"})},Y=B=>{rt.current[B]=Date.now()};x.useEffect(()=>{if(!e||!xe)return;const B=async U=>{const P=U.detail;if(!P||!P.taskId||!P.file)return;const G=P.taskId,F=P.file,J=P.markers||[],de=P.recordingId,Oe=ne.current.find(Ye=>Ye.id===G);if(!Oe){console.warn("[AppContext] Task not found for recording:",G),b({msg:"",type:"error"});return}try{const Ye=`${Date.now()}_${fl()}.${F.name.split(".").pop()}`,dt=`${(e==null?void 0:e.id)||"anonymous"}/${Ye}`,{error:Ct}=await xe.storage.from("attachments").upload(dt,F,{contentType:F.type,upsert:!1});if(Ct){console.error("Upload voice error:",Ct),b({msg:"",type:"error"});return}const{data:pt}=xe.storage.from("attachments").getPublicUrl(dt);if(pt){const vt={name:F.name,url:pt.publicUrl,size:F.size,type:F.type,markers:J,recordingId:de},je=[...Oe.attachments||[],vt];Y(G),s(be=>{const Ae=be.map(Je=>Je.id===G?{...Je,attachments:je}:Je);return ne.current=Ae,Ae});const{error:Ve}=await xe.from("tasks").update({attachments:je}).eq("id",G);if(Ve)console.error("Failed to update task attachments:",Ve),b({msg:"",type:"error"});else{window.dispatchEvent(new CustomEvent("recording-saved",{detail:{taskId:G,attachment:vt}}));const be=G;b({msg:"",type:"info",onClick:()=>{window.dispatchEvent(new CustomEvent("navigate-to-task",{detail:{taskId:be,openForEdit:!0}}))},actionLabel:""})}}}catch(Ye){console.error("[AppContext] Error saving recording:",Ye),b({msg:"",type:"error"})}};return window.addEventListener("audio-recording-completed",B),()=>window.removeEventListener("audio-recording-completed",B)},[e]);const Fe=async B=>{const U=new Date,P=[];for(let de=1;de<=10;de++){const Oe=new Date(U);Oe.setDate(U.getDate()+de),Oe.setHours(0,0,0,0);const Ye=r.filter(Xe=>{if(!Xe.start_date)return!1;const dt=new Date(Xe.start_date);return _i(dt,Oe)&&!Xe.completed_at}).length;P.push({date:Oe,count:Ye})}const G=Math.min(...P.map(de=>de.count)),F=P.filter(de=>de.count===G),J=F[Math.floor(Math.random()*F.length)];await jn(B,{start_date:J.date.toISOString()}),b({msg:` ${J.date.getMonth()+1}/${J.date.getDate()} (: ${J.count})`,type:"info"})},Ue=B=>{const U=[B],P=G=>{r.filter(J=>J.parent_id===G).forEach(J=>{U.push(J.id),P(J.id)})};return P(B),U},ze=async(B,U)=>{if(!xe)return;const P=Ue(B);s(F=>{const J=F.map(de=>de.id===B?{...de,is_locked:!0,lock_password:U}:P.includes(de.id)?{...de,is_locked:!0,lock_password:void 0}:de);return ne.current=J,J}),await xe.from("tasks").update({is_locked:!0,lock_password:U}).eq("id",B);const G=P.filter(F=>F!==B);if(G.length>0)for(const F of G)await xe.from("tasks").update({is_locked:!0,lock_password:null}).eq("id",F);b({msg:` ${P.length-1} `,type:"info"})},Qe=async(B,U)=>{if(!xe)return!1;const P=r.find(de=>de.id===B);if(!P||!P.is_locked)return!0;let G=P,F=P;for(;F.parent_id;){const de=r.find(Oe=>Oe.id===F.parent_id);if(de&&de.is_locked&&de.lock_password&&(G=de),!de)break;F=de}if(G.lock_password!==U)return b({msg:"",type:"error"}),!1;const J=Ue(B);s(de=>{const Oe=de.map(Ye=>J.includes(Ye.id)?{...Ye,is_locked:!1,lock_password:void 0}:Ye);return ne.current=Oe,Oe});for(const de of J)await xe.from("tasks").update({is_locked:!1,lock_password:null}).eq("id",de);return b({msg:"",type:"info"}),!0},Z=(B,U)=>{const P=r.find(J=>J.id===B);if(!P||!P.is_locked)return!0;let G=P,F=P;for(;F.parent_id;){const J=r.find(de=>de.id===F.parent_id);if(J&&J.is_locked&&J.lock_password&&(G=J),!J)break;F=J}return G.lock_password===U},Ne=async()=>{const B=r.filter(G=>!!G.completed_at&&G.status!=="logged"&&G.status!=="deleted");if(B.length===0)return;const U=B.map(G=>G.id),P=B.map(G=>({...G,status:"logged",original_parent_id:G.parent_id,archived_at:new Date().toISOString()}));if(s(G=>{const F=G.filter(J=>!U.includes(J.id));return ne.current=F,F}),o(G=>[...G,...P]),xe){const{error:G}=await xe.from("archived_tasks").insert(P.map(J=>({id:J.id,user_id:J.user_id,title:J.title,description:J.description,status:J.status,original_parent_id:J.original_parent_id,parent_id:J.parent_id,is_project:J.is_project,order_index:J.order_index,view_orders:J.view_orders,tags:J.tags,color:J.color,start_date:J.start_date,due_date:J.due_date,completed_at:J.completed_at,reviewed_at:J.reviewed_at,images:J.images,attachments:J.attachments,created_at:J.created_at,archived_at:J.archived_at})));if(G){st(G);return}const{error:F}=await xe.from("tasks").delete().in("id",U);F&&st(F)}yn({type:"ARCHIVE",payload:{originalTasks:B,archivedRecords:P}}),b({msg:` ${U.length} `,type:"info",undo:_n})},Pe=async B=>{const U=i.find(F=>F.id===B);if(!U)return;let P=U.original_parent_id;P&&(r.find(J=>J.id===P)||(P=null));const G={id:U.id,user_id:U.user_id,title:U.title,description:U.description,status:"completed",parent_id:P,is_project:U.is_project,order_index:U.order_index,view_orders:U.view_orders,tags:U.tags,color:U.color,start_date:U.start_date,due_date:U.due_date,completed_at:U.completed_at,reviewed_at:U.reviewed_at,images:U.images,attachments:U.attachments,created_at:U.created_at,is_all_day:!0,start_time:null,end_time:null,duration:null};if(o(F=>F.filter(J=>J.id!==B)),s(F=>{const J=[...F,G];return ne.current=J,J}),xe){const{error:F}=await xe.from("tasks").insert({id:G.id,user_id:G.user_id,title:G.title,description:G.description,status:G.status,parent_id:G.parent_id,is_project:G.is_project,order_index:G.order_index,view_orders:G.view_orders,tags:G.tags,color:G.color,start_date:G.start_date,due_date:G.due_date,completed_at:G.completed_at,reviewed_at:G.reviewed_at,images:G.images,created_at:G.created_at});if(F){st(F);return}const{error:J}=await xe.from("archived_tasks").delete().eq("id",B);J&&st(J)}b({msg:"",type:"info"})},We=async B=>{if(i.find(P=>P.id===B)){if(o(P=>P.filter(G=>G.id!==B)),xe){const{error:P}=await xe.from("archived_tasks").delete().eq("id",B);P&&st(P)}b({msg:"",type:"info"})}},kt=async(B,U)=>{const P=i.find(F=>F.id===B);if(!P)return;const G={...P,...U};if(o(F=>F.map(J=>J.id===B?G:J)),xe){const{error:F}=await xe.from("archived_tasks").update(U).eq("id",B);F&&st(F)}},Vt=async B=>{if(B.length!==0){if(o(U=>U.filter(P=>!B.includes(P.id))),xe){const{error:U}=await xe.from("archived_tasks").delete().in("id",B);U&&st(U)}b({msg:` ${B.length} `,type:"info"})}},Ft=async(B,U,P)=>{if(!xe||!e)return;const G={id:fl(),user_id:e.id,query:B,filters:U,name:P||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};W(J=>[G,...J].slice(0,50));const{error:F}=await xe.from("search_history").insert({id:G.id,user_id:G.user_id,query:G.query,filters:G.filters,name:G.name,created_at:G.created_at,updated_at:G.updated_at});F&&console.warn("Failed to save search history:",F)},nn=async B=>{if(!xe)return;W(P=>P.filter(G=>G.id!==B));const{error:U}=await xe.from("search_history").delete().eq("id",B);U&&console.warn("Failed to delete search history:",U)},Xt=async()=>{Jt(),m("syncing");const B=[...r];if(s([]),ne.current=[],ft([]),nt([]),xe){const{error:U}=await xe.from("tasks").delete().neq("id","00000000-0000-0000-0000-000000000000");if(U){st(U),s(B);return}}m("synced"),b({msg:"",type:"info"})},Jt=()=>{const B={tasks:r,tags:a,user_id:e.id,version:1,exported_at:new Date().toISOString()},U=new Blob([JSON.stringify(B,null,2)],{type:"application/json"}),P=URL.createObjectURL(U),G=document.createElement("a");G.href=P,G.download=`things-clone-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(G),G.click(),document.body.removeChild(G),URL.revokeObjectURL(P),b({msg:"",type:"info"})},fn=async B=>{if(!xe)return;const U=new FileReader;U.onload=async P=>{var G;try{const F=(G=P.target)==null?void 0:G.result,J=JSON.parse(F);if(!J.tasks||!J.tags)throw new Error("");if(m("syncing"),J.tags.length>0){const{error:de}=await xe.from("tags").upsert(J.tags.map(Oe=>({...Oe,user_id:e.id})));if(de)throw de}if(J.tasks.length>0){const{error:de}=await xe.from("tasks").upsert(J.tasks.map(Oe=>({...Oe,user_id:e.id})));if(de)throw de}b({msg:"...",type:"info"}),setTimeout(()=>window.location.reload(),1e3)}catch(F){st(F)}},U.readAsText(B)},yn=B=>{ft(U=>[...U,B]),nt([])},_n=async()=>{if(_e.length===0)return;const B=_e[_e.length-1];if(ft(_e.slice(0,-1)),nt(U=>[...U,B]),B.type==="ADD"){const U=B.payload.data.id;Y(U),s(P=>P.filter(G=>G.id!==U)),xe&&await xe.from("tasks").delete().eq("id",U)}else if(B.type==="DELETE"){const U=B.payload.data;Y(U.id),s(P=>[...P,U].sort((G,F)=>(G.order_index||0)-(F.order_index||0)||G.created_at.localeCompare(F.created_at))),xe&&await xe.from("tasks").insert([U])}else if(B.type==="UPDATE"){const{id:U,before:P}=B.payload;await jn(U,P,[],{skipHistory:!0})}else if(B.type==="BATCH_UPDATE"){const P=B.payload.map(G=>({id:G.id,data:G.before}));await Pi(P,{skipHistory:!0})}else if(B.type==="ADD_TAG"){const U=B.payload.data.id;l(P=>P.filter(G=>G.id!==U)),xe&&await xe.from("tags").delete().eq("id",U)}else if(B.type==="DELETE_TAG"){const U=B.payload.data;l(P=>[...P,U].sort((G,F)=>(G.order_index||0)-(F.order_index||0))),xe&&await xe.from("tags").insert([U])}else if(B.type==="UPDATE_TAG"){const{id:U,before:P}=B.payload;l(G=>G.map(F=>F.id===U?{...F,...P}:F).sort((F,J)=>(F.order_index||0)-(J.order_index||0))),xe&&await xe.from("tags").update(P).eq("id",U)}else if(B.type==="ARCHIVE"){const{originalTasks:U,archivedRecords:P}=B.payload,G=P.map(F=>F.id);o(F=>F.filter(J=>!G.includes(J.id))),s(F=>{const J=[...F,...U].sort((de,Oe)=>(de.order_index||0)-(Oe.order_index||0)||de.created_at.localeCompare(Oe.created_at));return ne.current=J,J}),xe&&(await xe.from("archived_tasks").delete().in("id",G),await xe.from("tasks").insert(U))}else if(B.type==="BATCH_DELETE"){const U=B.payload.data;s(P=>[...P,...U].sort((G,F)=>(G.order_index||0)-(F.order_index||0)||G.created_at.localeCompare(F.created_at))),xe&&await xe.from("tasks").insert(U)}b({msg:"",type:"info"})},Fn=async()=>{if(lt.length===0)return;const B=lt[lt.length-1];if(nt(lt.slice(0,-1)),ft(U=>[...U,B]),B.type==="ADD"){const U=B.payload.data;Y(U.id),s(P=>[...P,U].sort((G,F)=>(G.order_index||0)-(F.order_index||0)||G.created_at.localeCompare(F.created_at))),xe&&await xe.from("tasks").insert([U])}else if(B.type==="DELETE"){const U=B.payload.data.id;Y(U),s(P=>P.filter(G=>G.id!==U)),xe&&await xe.from("tasks").delete().eq("id",U)}else if(B.type==="UPDATE"){const{id:U,after:P}=B.payload;await jn(U,P,[],{skipHistory:!0})}else if(B.type==="BATCH_UPDATE"){const P=B.payload.map(G=>({id:G.id,data:G.after}));await Pi(P,{skipHistory:!0})}else if(B.type==="ADD_TAG"){const U=B.payload.data;l(P=>[...P,U].sort((G,F)=>(G.order_index||0)-(F.order_index||0))),xe&&await xe.from("tags").insert([U])}else if(B.type==="DELETE_TAG"){const U=B.payload.data.id;l(P=>P.filter(G=>G.id!==U)),xe&&await xe.from("tags").delete().eq("id",U)}else if(B.type==="UPDATE_TAG"){const{id:U,after:P}=B.payload;l(G=>G.map(F=>F.id===U?{...F,...P}:F).sort((F,J)=>(F.order_index||0)-(J.order_index||0))),xe&&await xe.from("tags").update(P).eq("id",U)}else if(B.type==="ARCHIVE"){const{originalTasks:U,archivedRecords:P}=B.payload,G=U.map(F=>F.id);s(F=>{const J=F.filter(de=>!G.includes(de.id));return ne.current=J,J}),o(F=>[...F,...P]),xe&&(await xe.from("archived_tasks").insert(P.map(F=>({id:F.id,user_id:F.user_id,title:F.title,description:F.description,status:F.status,original_parent_id:F.original_parent_id,parent_id:F.parent_id,is_project:F.is_project,order_index:F.order_index,view_orders:F.view_orders,tags:F.tags,color:F.color,start_date:F.start_date,due_date:F.due_date,completed_at:F.completed_at,reviewed_at:F.reviewed_at,images:F.images,attachments:F.attachments,created_at:F.created_at,archived_at:F.archived_at}))),await xe.from("tasks").delete().in("id",G))}else if(B.type==="BATCH_DELETE"){const P=B.payload.data.map(G=>G.id);s(G=>G.filter(F=>!P.includes(F.id))),xe&&await xe.from("tasks").delete().in("id",P)}b({msg:"",type:"info"})},Hn=async()=>{if(!xe)return;const{error:B}=await xe.auth.signOut();B?st(B):b({msg:"",type:"info"})};x.useEffect(()=>{const B=U=>{A||(U.metaKey||U.ctrlKey)&&U.key==="z"&&(U.preventDefault(),U.shiftKey?Fn():_n())};return window.addEventListener("keydown",B),()=>window.removeEventListener("keydown",B)},[_e,lt,r,A]);const is=(B,U=!1,P)=>{const G=r.find(vt=>vt.id===B);if(!G)return;const F=vt=>a.find(Ze=>vt.some(je=>Ze.name.trim().toLowerCase()===je.toLowerCase())),J=F(["note","journal","",""]),de=F(["prompt",""]),Oe=J,Ye=F(["someday","inspiration","","/"]),Xe=F(["project",""]),dt=F(["schedule",""]);let Ct=P||"inbox";P||(J&&G.tags.includes(J.id)?Ct="journal":de&&G.tags.includes(de.id)?Ct="prompt":Oe&&G.tags.includes(Oe.id)?Ct="journal":Ye&&G.tags.includes(Ye.id)?Ct="waiting":Xe&&G.tags.includes(Xe.id)?r.some(Ze=>Ze.parent_id===B&&Ze.status!=="deleted")&&(Ct="projects"):dt&&G.tags.includes(dt.id)?Ct="focus":(G.start_date||G.due_date)&&(Ct="today")),jt(vt=>[...vt,{view:ce,focusedId:I,editingId:A,searchOpen:R}]),Ee(Ct),k(B);let pt=r.find(vt=>vt.id===B);for(;pt&&pt.parent_id;)L.includes(pt.parent_id)||rn(pt.parent_id,!0),pt=r.find(vt=>vt.id===(pt==null?void 0:pt.parent_id));U&&setTimeout(()=>N(B),100)},Gs=()=>{if(Et.length===0)return;const B=Et[Et.length-1];jt(P=>P.slice(0,-1)),Ee(B.view),k(B.focusedId);const U=B.editingId||B.focusedId;U&&setTimeout(()=>N(U),150),B.searchOpen!==void 0&&ae(B.searchOpen)};x.useEffect(()=>{const B=U=>{const P=U.detail;P!=null&&P.taskId&&is(P.taskId,P.openForEdit||!1)};return window.addEventListener("navigate-to-task",B),()=>window.removeEventListener("navigate-to-task",B)},[r,a,ce,I,L]);const ui=x.useCallback((B,U,P,G,F,J)=>{var Tt;if(ge.showImportedGoogleEvents===!1){const et=a.filter(te=>te.name.startsWith("Google:")).map(te=>te.id);et.length>0&&(B=B.filter(te=>!te.tags.some(Le=>et.includes(Le))))}const de=et=>{var te;return(te=a.find(Le=>et.some(ct=>Le.name.trim().toLowerCase()===ct.toLowerCase())))==null?void 0:te.id},Oe=de(["prompt",""]),Ye=de(["journal","note","",""]),Xe=de(["someday","inspiration","","/"]),dt=de(["project",""]),Ct=(Tt=a.find(et=>et.name==="#prompt"))==null?void 0:Tt.id,pt=de(["schedule",""]),vt=de(["annual","annualplan","",""]);if(U==="schedule")return B.filter(et=>(!!et.due_date||!!et.start_date)&&et.status!=="deleted"&&et.status!=="logged").sort((et,te)=>{const Le=new Date(et.start_date||et.due_date||0).getTime(),ct=new Date(te.start_date||te.due_date||0).getTime();return Le-ct}).map((et,te)=>({data:et,depth:0,hasChildren:!1,isExpanded:!1,path:[],index:te}));if(U==="recent")return B.filter(et=>et.status!=="deleted").sort((et,te)=>{const Le=new Date(et.updated_at||et.created_at||0).getTime();return new Date(te.updated_at||te.created_at||0).getTime()-Le}).slice(0,100).map((et,te)=>({data:et,depth:0,hasChildren:!1,isExpanded:!1,path:[],index:te}));const je=(()=>{if(P){const et=Le=>{const ct=a.filter(at=>at.parent_id===Le);return[Le,...ct.flatMap(at=>et(at.id))]},te=et(P);return Le=>{if(!W6(Le,te))return!1;const ct=J[P]||{include:[],exclude:[]},{include:at,exclude:St}=Array.isArray(ct)?{include:ct,exclude:[]}:ct;return at.length>0&&!Le.tags.some(zt=>at.includes(zt))||St.length>0&&Le.tags.some(zt=>St.includes(zt))||F.additionalTags.length>0&&!F.additionalTags.every(zt=>{var Bt;return(Bt=Le.tags)==null?void 0:Bt.includes(zt)})||F.color&&Le.color!==F.color||F.startDate&&(!Le.start_date||new Date(Le.start_date)<new Date(F.startDate))||F.dueDate&&(!Le.due_date||new Date(Le.due_date)>new Date(F.dueDate))?!1:Le.status!=="deleted"&&Le.status!=="logged"}}switch(U){case"inbox":return B.filter(te=>te.status==="inbox").forEach(te=>{te.parent_id&&console.log(`[Inbox Debug] Hidden task "${te.title}": has parent_id ${te.parent_id}`)}),te=>{if(te.parent_id||te.status==="deleted"||te.status==="logged")return!1;const Le=!!te.completed_at,ct=!te.start_date&&!te.due_date&&(!te.tags||te.tags.length===0),at=te.status==="inbox";if(ct){const Gt=J.inbox||{include:[],exclude:[]};return!((Array.isArray(Gt)?Gt:Gt.include||[]).length>0)}if(!at&&!Le||!Le&&(te.start_date||te.due_date)||!Le&&(pt&&te.tags.includes(pt)||te.tags.some(Gt=>{const an=a.find(xn=>xn.id===Gt);return an&&["schedule",""].includes(an.name.trim().toLowerCase())}))||!Le&&(dt&&te.tags.includes(dt)||vt&&te.tags.includes(vt)||Xe&&te.tags.includes(Xe)||Ye&&te.tags.includes(Ye)||Oe&&te.tags.includes(Oe)||Ct&&te.tags.includes(Ct)))return!1;const St=J.inbox||{include:[],exclude:[]},{include:zt,exclude:Bt}=Array.isArray(St)?{include:St,exclude:[]}:St;return!(zt.length>0&&!te.tags.some(Gt=>zt.includes(Gt))||Bt.length>0&&te.tags.some(Gt=>Bt.includes(Gt)))};case"allview":return te=>{if(te.parent_id||te.status==="deleted"||pt&&te.tags.includes(pt))return!1;const Le=J.allview||{include:[],exclude:[]},{include:ct,exclude:at}=Array.isArray(Le)?{include:Le,exclude:[]}:Le;return!(ct.length>0&&!te.tags.some(St=>ct.includes(St))||at.length>0&&te.tags.some(St=>at.includes(St)))};case"newtable":return te=>{if(te.parent_id||te.status==="deleted"||te.status==="logged"||Oe&&te.tags.includes(Oe)||Ye&&te.tags.includes(Ye)||Xe&&te.tags.includes(Xe)||!te.start_date&&!te.due_date)return!1;const Le=new Date;Le.setHours(23,59,59,999);const ct=te.start_date?new Date(te.start_date):te.due_date?new Date(te.due_date):null;return!(!ct||ct>Le)};case"focus":return te=>!(te.status==="deleted"||te.status==="logged"||te.start_date||te.due_date||Oe&&te.tags.includes(Oe)||Ye&&te.tags.includes(Ye)||Xe&&te.tags.includes(Xe)||te.status==="waiting"||B.some(ct=>ct.parent_id===te.id&&ct.status!=="deleted"&&ct.status!=="logged"));case"today":return te=>{if(te.status==="logged"||te.status==="deleted"||te.status==="waiting"||te.status==="someday"||pt&&te.tags.includes(pt)||te.tags.some(Bt=>{const Gt=a.find(an=>an.id===Bt);return Gt&&["schedule",""].includes(Gt.name.trim().toLowerCase())}))return!1;const Le=J.today||{include:[],exclude:[]},{include:ct,exclude:at}=Array.isArray(Le)?{include:Le,exclude:[]}:Le;if(ct.length>0&&!te.tags.some(Bt=>ct.includes(Bt))||at.length>0&&te.tags.some(Bt=>at.includes(Bt)))return!1;const St=["note","project"],zt=a.filter(Bt=>St.includes(Bt.name.trim().toLowerCase())).map(Bt=>Bt.id);return!(te.tags&&te.tags.some(Bt=>zt.includes(Bt))||!te.start_date&&!te.due_date)};case"waiting":return te=>{const Le=J.waiting||{include:[],exclude:[]},{include:ct,exclude:at}=Array.isArray(Le)?{include:Le,exclude:[]}:Le;if(ct.length>0&&!te.tags.some(Gt=>ct.includes(Gt))||at.length>0&&te.tags.some(Gt=>at.includes(Gt))||te.status==="deleted"||te.status==="logged")return!1;const St=te.status==="waiting",zt=te.status==="someday",Bt=te.tags.some(Gt=>{const an=a.find(Tn=>Tn.id===Gt);return an?an.name.trim().toLowerCase()==="someday":!1});return St||zt||Bt};case"journal":return te=>{if(!Ye)return!1;const Le=J.journal||{include:[],exclude:[]},{include:ct,exclude:at}=Array.isArray(Le)?{include:Le,exclude:[]}:Le;return ct.length>0&&!te.tags.some(St=>ct.includes(St))||at.length>0&&te.tags.some(St=>at.includes(St))?!1:te.status!=="deleted"&&te.status!=="logged"&&te.tags.includes(Ye)};case"prompt":return te=>{const Le=a.find(zt=>zt.name.trim().toLowerCase()==="prompt");if(!Le)return!1;const ct=J.prompt||{include:[],exclude:[]},{include:at,exclude:St}=Array.isArray(ct)?{include:ct,exclude:[]}:ct;return at.length>0&&!te.tags.some(zt=>at.includes(zt))||St.length>0&&te.tags.some(zt=>St.includes(zt))?!1:te.status!=="deleted"&&te.status!=="logged"&&te.tags.includes(Le.id)};case"log":case"logbook":return te=>{if(te.status!=="logged")return!1;const Le=J.logbook||J.log||{include:[],exclude:[]},{include:ct,exclude:at}=Array.isArray(Le)?{include:Le,exclude:[]}:Le;return!(ct.length>0&&!te.tags.some(St=>ct.includes(St))||at.length>0&&te.tags.some(St=>at.includes(St)))};case"recent":return te=>{if(te.status==="deleted")return!1;const Le=J.recent||{include:[],exclude:[]},{include:ct,exclude:at}=Array.isArray(Le)?{include:Le,exclude:[]}:Le;return!(ct.length>0&&!te.tags.some(St=>ct.includes(St))||at.length>0&&te.tags.some(St=>at.includes(St)))};case"trash":return te=>{if(te.status!=="deleted")return!1;const Le=J.trash||{include:[],exclude:[]},{include:ct,exclude:at}=Array.isArray(Le)?{include:Le,exclude:[]}:Le;return!(ct.length>0&&!te.tags.some(St=>ct.includes(St))||at.length>0&&te.tags.some(St=>at.includes(St)))};default:return te=>{if(te.status==="deleted"||te.status==="logged"||pt&&te.tags.includes(pt)||te.tags.some(zt=>{const Bt=a.find(Gt=>Gt.id===zt);return Bt&&["schedule",""].includes(Bt.name.trim().toLowerCase())}))return!1;const ct=J[U]||{include:[],exclude:[]},{include:at,exclude:St}=Array.isArray(ct)?{include:ct,exclude:[]}:ct;return!(at.length>0&&!te.tags.some(zt=>at.includes(zt))||St.length>0&&te.tags.some(zt=>St.includes(zt)))}}})(),Ve=U==="allview"||U==="project"?"inbox":U,be=et=>et.view_orders&&et.view_orders[Ve]!==void 0?et.view_orders[Ve]:et.order_index||0;if(U==="focus"||U==="today"){const et=ct=>{const at=ct.start_date||ct.due_date;if(at){const zt=new Date(at);return`${zt.getFullYear()}-${String(zt.getMonth()+1).padStart(2,"0")}-${String(zt.getDate()).padStart(2,"0")}`}const St=new Date;return`${St.getFullYear()}-${String(St.getMonth()+1).padStart(2,"0")}-${String(St.getDate()).padStart(2,"0")}`},te=ct=>ct.view_orders&&ct.view_orders.today!==void 0?ct.view_orders.today:9e8+new Date(ct.created_at).getTime()/1e3;return B.filter(je).sort((ct,at)=>{if(U==="today"){const St=et(ct),zt=et(at);return St!==zt?St.localeCompare(zt):te(ct)-te(at)}return be(ct)-be(at)||ct.created_at.localeCompare(at.created_at)}).map((ct,at)=>({data:ct,depth:0,hasChildren:!1,isExpanded:!1,path:[ct.id],index:at}))}const Ae=B.filter(et=>{if(!je(et))return!1;const te=et.parent_id||null;if(!te)return!0;const Le=B.find(ct=>ct.id===te);return!Le||!je(Le)}).sort((et,te)=>be(et)-be(te)||et.created_at.localeCompare(te.created_at)),Je=new Set;let It=0;const xt=(et,te=0,Le=[])=>{let ct=[];return et.forEach(at=>{if(Je.has(at.id))return;Je.add(at.id);const St=B.filter(an=>an.parent_id===at.id&&an.status!=="logged"&&an.status!=="deleted").sort((an,xn)=>be(an)-be(xn)||an.created_at.localeCompare(xn.created_at)),zt=St.length>0,Bt=G.includes(at.id),Gt=[...Le,at.id];ct.push({data:at,depth:te,hasChildren:zt,isExpanded:Bt,path:Gt,index:It++}),zt&&Bt&&(ct=[...ct,...xt(St,te+1,Gt)])}),ct};return xt(Ae)},[a,ge.showImportedGoogleEvents]),Nn=x.useMemo(()=>ui(r,ce,He,L,ht,E),[r,ce,He,L,ht,E,ui,a]);x.useEffect(()=>{if(ce!=="today"||!xe)return;let B=Nn.filter(de=>{var Ye;return((Ye=de.data.view_orders)==null?void 0:Ye.today)===void 0});const U=new Map;Nn.forEach(de=>{var Ye;const Oe=(Ye=de.data.view_orders)==null?void 0:Ye.today;if(Oe!==void 0){const Xe=U.get(Oe)||[];Xe.push(de.data.id),U.set(Oe,Xe)}});const P=new Set;if(U.forEach(de=>{if(de.length>1)for(let Oe=1;Oe<de.length;Oe++)P.add(de[Oe])}),P.size>0){const de=Nn.filter(Oe=>P.has(Oe.data.id));console.warn("[Today] Found duplicate orders, re-assigning:",de.map(Oe=>Oe.data.title)),B=[...B,...de]}if(B.length===0)return;let G=0;Nn.forEach(de=>{var Ye;const Oe=(Ye=de.data.view_orders)==null?void 0:Ye.today;Oe!==void 0&&Oe>G&&(G=Oe)});const J=[...B].sort((de,Oe)=>de.data.created_at.localeCompare(Oe.data.created_at)).map((de,Oe)=>({id:de.data.id,view_orders:{...de.data.view_orders||{},today:G+1e4*(Oe+1)}}));s(de=>{const Oe=de.map(Ye=>{const Xe=J.find(dt=>dt.id===Ye.id);return Xe?{...Ye,view_orders:Xe.view_orders}:Ye});return ne.current=Oe,Oe}),J.forEach(async({id:de,view_orders:Oe})=>{xe&&await xe.from("tasks").update({view_orders:Oe}).eq("id",de)})},[ce,Nn,xe]),x.useEffect(()=>{if(ce!=="waiting"||!xe)return;let B=Nn.filter(F=>{var de;return((de=F.data.view_orders)==null?void 0:de.waiting)===void 0});if(B.length===0)return;let U=0;Nn.forEach(F=>{var de;const J=(de=F.data.view_orders)==null?void 0:de.waiting;J!==void 0&&J>U&&(U=J)});const G=[...B].sort((F,J)=>F.data.created_at.localeCompare(J.data.created_at)).map((F,J)=>({id:F.data.id,view_orders:{...F.data.view_orders||{},waiting:U+1e4*(J+1)}}));s(F=>{const J=F.map(de=>{const Oe=G.find(Ye=>Ye.id===de.id);return Oe?{...de,view_orders:Oe.view_orders}:de});return ne.current=J,J}),G.forEach(async({id:F,view_orders:J})=>{xe&&await xe.from("tasks").update({view_orders:J}).eq("id",F)})},[ce,Nn,xe]);const Oi=(B,U)=>{k(U);const P=B.shiftKey||B.shiftKey,G=B.ctrlKey||B.metaKey;if(P){const F=w||I||U;C(F);const J=Nn.findIndex(Oe=>Oe.data.id===F),de=Nn.findIndex(Oe=>Oe.data.id===U);if(J!==-1&&de!==-1){const[Oe,Ye]=J<de?[J,de]:[de,J],Xe=Nn.slice(Oe,Ye+1).map(dt=>dt.data.id);v(Xe)}}else G?(C(U),v(F=>F.includes(U)?F.filter(J=>J!==U):[...F,U])):(C(U),v([U]))},ea=x.useCallback((B,U)=>{const P=document.getElementById("drag-ghost");P&&(P.style.left=`${B}px`,P.style.top=`${U}px`)},[]);x.useEffect(()=>{De.current=document.querySelector("main")},[]);const ta=(B,U)=>{if(ce==="schedule"){B.preventDefault();return}const P=g.includes(U.data.id)?g:[U.data.id];g.includes(U.data.id)||v([U.data.id]),B.dataTransfer.setData("text/plain",U.data.id),B.dataTransfer.setData("application/json",JSON.stringify(P)),B.dataTransfer.effectAllowed="move",B.dataTransfer.setDragImage(EI,0,0);const G=B.currentTarget.getBoundingClientRect(),F=B.clientX-G.left;Ce(J=>({...J,isDragging:!0,draggedId:U.data.id,originalDepth:U.depth,dragOffsetX:F,ghostPosition:{x:B.clientX,y:B.clientY}}))},di=B=>{Ce(U=>({...U,...B}))},il=async B=>{q.current&&(clearInterval(q.current),q.current=null);const{draggedId:U,dropIndex:P,dropDepth:G}=Te;if(Ce(be=>({...be,isDragging:!1,draggedId:null,dropIndex:null})),!U||P===null)return;const F=B||Nn,J=ce==="allview"||ce==="project"?"inbox":ce,de=g.includes(U)?g:[U],Oe=be=>J==="today"?9e8+new Date(be.created_at).getTime()/1e3:be.order_index||0,Ye=r.filter(be=>de.includes(be.id)).sort((be,Ae)=>{var xt,Tt;const Je=((xt=be.view_orders)==null?void 0:xt[J])!==void 0?be.view_orders[J]:Oe(be),It=((Tt=Ae.view_orders)==null?void 0:Tt[J])!==void 0?Ae.view_orders[J]:Oe(Ae);return Je-It});let Xe=null;if(ce!=="today"&&P>0){const be=F[P-1];if(G>be.depth)Xe=be.data.id,rn(Xe,!0);else if(G===be.depth)Xe=be.data.parent_id;else{let Ae=P-1;for(;Ae>=0;){if(F[Ae].depth===G-1){Xe=F[Ae].data.id;break}if(F[Ae].depth<G-1)break;Ae--}if(G===0){const Je=F.find(It=>It.depth===0&&!de.includes(It.data.id));Xe=Je?Je.data.parent_id:null}}}else Xe=null;for(const be of Ye){if(Xe&&Mv(be.id,Xe,r)){b({msg:"",type:"error"});return}if(Xe){const Ae=r.find(Je=>Je.id===Xe);if(Ae&&!Ae.is_project&&be.is_project){b({msg:"",type:"error"});return}}}let dt=-1e4,Ct=9999999999;const pt=be=>be.view_orders&&be.view_orders[J]!==void 0?be.view_orders[J]:J==="today"?9e8+new Date(be.created_at).getTime()/1e3:be.order_index||0;let vt=null;if(ce==="today"){const be=te=>te.start_date?new Date(te.start_date).toISOString().split("T")[0]:te.due_date?new Date(te.due_date).toISOString().split("T")[0]:null;let Ae=null;for(let te=P-1;te>=0&&!(!de.includes(F[te].data.id)&&(Ae=be(F[te].data),Ae));te--);let Je=null;for(let te=P;te<F.length&&!(!de.includes(F[te].data.id)&&(Je=be(F[te].data),Je));te++);const It=Te.anchorTaskIndex;if(It!==null&&It>=0&&It<F.length){const te=F[It].data;de.includes(te.id)||(vt=be(te))}vt||(vt=Ae||Je),vt||(vt=new Date().toISOString().split("T")[0]);const xt=F.map((te,Le)=>({...te,originalIndex:Le})).filter(te=>!de.includes(te.data.id)&&be(te.data)===vt),Tt=xt.filter(te=>te.originalIndex<P),et=xt.filter(te=>te.originalIndex>=P);if(Tt.length>0){const te=Tt[Tt.length-1];dt=pt(te.data)}if(et.length>0){const te=et[0];Ct=pt(te.data)}}else{for(let be=P-1;be>=0;be--){const Ae=F[be];if(!de.includes(Ae.data.id)){if(Ae.depth===G){dt=pt(Ae.data);break}else if(Ae.depth<G)break}}for(let be=P;be<F.length;be++){const Ae=F[be];if(!de.includes(Ae.data.id)){if(Ae.depth===G){Ct=pt(Ae.data);break}else if(Ae.depth<G)break}}}dt===-1e4&&Ct===9999999999?(dt=0,Ct=2e4):dt===-1e4?dt=Ct-2e4:Ct===9999999999&&(Ct=dt+2e4);const Ze=Ye.length,je=(Ct-dt)/(Ze+1),Ve=Ye.map((be,Ae)=>{const Je=dt+je*(Ae+1),It={...be.view_orders||{},[J]:Je},xt={id:be.id,view_orders:It};return ce!=="today"&&(xt.parent_id=Xe),ce==="today"&&vt&&(xt.start_date=vt,xt.is_all_day=!0),xt});Ir(Ve)},ol=async(B,U)=>{const P=ne.current,G=P.find(Xe=>Xe.id===B);if(!G)return;Y(B);const F=ce==="allview"||ce==="project"?"inbox":ce,J=Xe=>Xe.view_orders&&Xe.view_orders[F]!==void 0?Xe.view_orders[F]:F==="today"?9e8+new Date(Xe.created_at).getTime()/1e3:Xe.order_index||0,Oe=g.includes(B)?ce==="today"?g:g.filter(Xe=>{const dt=P.find(Ct=>Ct.id===Xe);return dt&&(dt.parent_id||null)===(G.parent_id||null)}):[B],Ye=P.filter(Xe=>Oe.includes(Xe.id)).sort((Xe,dt)=>J(Xe)-J(dt));if(U==="up"||U==="down"){const Xe=ce==="today";let dt=[];if(ce==="project")dt=P.filter(Ze=>(Ze.parent_id||null)===(G.parent_id||null)&&Ze.status!=="deleted"&&Ze.status!=="logged").sort((Ze,je)=>J(Ze)-J(je));else if(Xe){const Ze=be=>be.start_date?new Date(be.start_date).toISOString().split("T")[0]:be.due_date?new Date(be.due_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],je=Ze(G),Ve=new Set(Nn.map(be=>be.data.id));Ve.add(G.id),dt=P.filter(be=>Ve.has(be.id)&&Ze(be)===je).sort((be,Ae)=>J(be)-J(Ae))}else dt=Nn.filter(Ze=>(Ze.data.parent_id||null)===(G.parent_id||null)).map(Ze=>Ze.data);const Ct=Ye.map(Ze=>dt.findIndex(je=>je.id===Ze.id)).filter(Ze=>Ze!==-1);if(Ct.length===0)return;const pt=Math.min(...Ct),vt=Math.max(...Ct);if(U==="up"){if(pt===0){if(Xe){const Je=et=>{const te=et.start_date||et.due_date;if(te){const ct=new Date(te);return`${ct.getFullYear()}-${String(ct.getMonth()+1).padStart(2,"0")}-${String(ct.getDate()).padStart(2,"0")}`}const Le=new Date;return`${Le.getFullYear()}-${String(Le.getMonth()+1).padStart(2,"0")}-${String(Le.getDate()).padStart(2,"0")}`},It=Je(G),xt=Array.from(new Set(Nn.map(et=>Je(et.data)))).sort(),Tt=xt.indexOf(It);if(Tt>0){const et=xt[Tt-1],te=Nn.filter(at=>Je(at.data)===et).map(at=>at.data).sort((at,St)=>J(at)-J(St));let Le;te.length>0?Le=J(te[te.length-1])+1e4:Le=0;const ct=Ye.map((at,St)=>({id:at.id,start_date:et,view_orders:{...at.view_orders||{},[F]:Le+1e4*St}}));Ir(ct);return}}return}const Ze=pt-1,je=pt-2,Ve=J(dt[Ze]),be=je>=0?J(dt[je]):Ve-2e4;if(Ve-be<.1){console.log("[Task Reorder] Gap too small, rebalancing list...");const Je=new Set(Ye.map(Le=>Le.id)),It=dt.filter(Le=>!Je.has(Le.id)),xt=dt[Ze];let Tt=It.findIndex(Le=>Le.id===xt.id);Tt===-1&&(Tt=0);const et=[...It];et.splice(Tt,0,...Ye);const te=et.map((Le,ct)=>({id:Le.id,view_orders:{...Le.view_orders||{},[F]:1e4*(ct+1)}}));Ir(te)}else{const Je=(Ve-be)/(Ye.length+1),It=Ye.map((xt,Tt)=>({id:xt.id,view_orders:{...xt.view_orders||{},[F]:be+Je*(Tt+1)}}));Ir(It)}}else{if(vt===dt.length-1){if(Xe){const Je=et=>{const te=et.start_date||et.due_date;if(te){const ct=new Date(te);return`${ct.getFullYear()}-${String(ct.getMonth()+1).padStart(2,"0")}-${String(ct.getDate()).padStart(2,"0")}`}const Le=new Date;return`${Le.getFullYear()}-${String(Le.getMonth()+1).padStart(2,"0")}-${String(Le.getDate()).padStart(2,"0")}`},It=Je(G),xt=Array.from(new Set(Nn.map(et=>Je(et.data)))).sort(),Tt=xt.indexOf(It);if(Tt<xt.length-1){const et=xt[Tt+1],te=Nn.filter(at=>Je(at.data)===et).map(at=>at.data).sort((at,St)=>J(at)-J(St));let Le;te.length>0?Le=J(te[0])-1e4*Ye.length:Le=0;const ct=Ye.map((at,St)=>({id:at.id,start_date:et,view_orders:{...at.view_orders||{},[F]:Le+1e4*St}}));Ir(ct);return}}return}const Ze=vt+1,je=vt+2,Ve=J(dt[Ze]),be=je<dt.length?J(dt[je]):Ve+2e4;if(be-Ve<.1){console.log("[Task Reorder] Gap too small (down), rebalancing list...");const Je=new Set(Ye.map(Le=>Le.id)),It=dt.filter(Le=>!Je.has(Le.id)),xt=dt[Ze];let Tt=It.findIndex(Le=>Le.id===xt.id);Tt===-1&&(Tt=It.length);const et=[...It];et.splice(Tt+1,0,...Ye);const te=et.map((Le,ct)=>({id:Le.id,view_orders:{...Le.view_orders||{},[F]:1e4*(ct+1)}}));Ir(te)}else{const Je=(be-Ve)/(Ye.length+1),It=Ye.map((xt,Tt)=>({id:xt.id,view_orders:{...xt.view_orders||{},[F]:Ve+Je*(Tt+1)}}));Ir(It)}}}else if(U==="right"){if(ce==="today"){const Ze=Ye[0],je=Nn.findIndex(Je=>Je.data.id===Ze.id);if(je<=0){b({msg:"",type:"info"});return}const Ve=Nn[je-1].data.id,be=(Je,It)=>{let xt=r.find(Tt=>Tt.id===Je);for(;xt&&xt.parent_id;){if(xt.parent_id===It)return!0;xt=r.find(Tt=>Tt.id===xt.parent_id)}return!1};for(const Je of Ye)if(Ve===Je.id||be(Ve,Je.id)){b({msg:"",type:"error"});return}const Ae=Ye.map(Je=>({id:Je.id,parent_id:Ve}));Ir(Ae),b({msg:` ${Ye.length} `,type:"info"});return}let Xe=null;const dt=Ye[0];if(ce==="project"){const Ze=P.filter(Ve=>(Ve.parent_id||null)===(dt.parent_id||null)&&Ve.status!=="deleted"&&Ve.status!=="logged").sort((Ve,be)=>J(Ve)-J(be)),je=Ze.findIndex(Ve=>Ve.id===dt.id);je>0&&(Xe=Ze[je-1].id)}else{const Ze=Nn.findIndex(je=>je.data.id===dt.id);if(Ze>0){const je=Nn[Ze];for(let Ve=Ze-1;Ve>=0;Ve--){if(Nn[Ve].depth===je.depth){Xe=Nn[Ve].data.id;break}if(Nn[Ve].depth<je.depth)break}}}if(!Xe)return;const Ct=P.filter(Ze=>Ze.parent_id===Xe&&Ze.status!=="deleted"&&Ze.status!=="logged").sort((Ze,je)=>J(Ze)-J(je));let pt=(Ct[Ct.length-1]?J(Ct[Ct.length-1]):0)+1e4;L.includes(Xe)||rn(Xe,!0);const vt=Ye.map(Ze=>{const je=pt;return pt+=1e4,{id:Ze.id,parent_id:Xe,order_index:je,view_orders:{...Ze.view_orders||{},[F]:je}}});Ir(vt),b({msg:` ${Ye.length} `,type:"info"})}else if(U==="left"){if(ce==="today"){const Ct=[];let pt=0;for(const vt of Ye){if(!vt.parent_id)continue;const Ze=P.find(Ve=>Ve.id===vt.parent_id);if(!Ze)continue;const je=Ze.parent_id||null;Ct.push({id:vt.id,parent_id:je}),pt++}Ct.length>0?(Ir(Ct),b({msg:` ${pt} `,type:"info"})):b({msg:"",type:"info"});return}const Xe=[];let dt=0;for(const Ct of Ye){if(!Ct.parent_id)continue;const pt=P.find(Ae=>Ae.id===Ct.parent_id);if(!pt)continue;if(ce==="project"){const Ae=a.find(Je=>Je.name.trim().toLowerCase()==="project");if(Ae&&pt.tags.includes(Ae.id)){b({msg:" ",type:"info"});continue}}const vt=pt.parent_id,Ze=P.filter(Ae=>Ae.parent_id===vt&&Ae.status!=="deleted"&&Ae.status!=="logged").sort((Ae,Je)=>J(Ae)-J(Je)),je=Ze.findIndex(Ae=>Ae.id===pt.id),Ve=Ze[je+1];let be;Ve?be=(J(pt)+J(Ve))/2:be=J(pt)+1e4,Xe.push({id:Ct.id,parent_id:vt,order_index:be,view_orders:{...Ct.view_orders||{},[F]:be}}),dt++}Xe.length>0&&(Ir(Xe),b({msg:` ${dt} `,type:"info"}))}},Ir=async B=>{const U=B.map(J=>{const de=ne.current.find(Xe=>Xe.id===J.id),Oe={},Ye={};return de&&Object.keys(J).forEach(Xe=>{Xe!=="id"&&(Oe[Xe]=de[Xe],Ye[Xe]=J[Xe])}),{id:J.id,before:Oe,after:Ye}});yn({type:"BATCH_UPDATE",payload:U});const P=ne.current.map(J=>{const de=B.find(Oe=>Oe.id===J.id);return de?{...J,...de}:J}).sort((J,de)=>(J.order_index||0)-(de.order_index||0)||J.created_at.localeCompare(de.created_at));if(ne.current=P,s(P),xe){const J=xe;await Promise.all(B.map(de=>J.from("tasks").update(de).eq("id",de.id)))}const G=JSON.parse(localStorage.getItem("task_google_map")||"{}"),F=B.filter(J=>G[J.id]&&(J.start_date!==void 0||J.is_all_day!==void 0));F.length>0&&Promise.resolve(localStorage.getItem("google_access_token")).then(async J=>{J&&await Promise.all(F.map(async de=>{const Oe=G[de.id],Ye=P.find(Ze=>Ze.id===de.id);if(!Ye)return;const Xe={},dt=de.is_all_day!==void 0?de.is_all_day:Ye.is_all_day,Ct=de.start_date||Ye.start_date;if(!Ct)return;const pt=new Date(Ct);if(isNaN(pt.getTime()))return;const vt=pt.toLocaleDateString("en-CA");if(dt){Xe.start={date:vt};const Ze=new Date(pt);Ze.setDate(Ze.getDate()+1),Xe.end={date:Ze.toLocaleDateString("en-CA")}}else{const Ze=Ae=>Ae.length===5?Ae+":00":Ae,je=Ze(de.start_time||Ye.start_time||"09:00:00");let Ve=Ye.end_time?Ze(Ye.end_time):null;if(!Ve){const[Ae,Je]=je.split(":").map(Number);Ve=`${String((Ae+1)%24).padStart(2,"0")}:${String(Je).padStart(2,"0")}:00`}const be=Intl.DateTimeFormat().resolvedOptions().timeZone;Xe.start={dateTime:`${vt}T${je}`,timeZone:be},Xe.end={dateTime:`${vt}T${Ve}`,timeZone:be}}try{const Ze=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${Oe.calId}/events/${Oe.evtId}`,{method:"PATCH",headers:{Authorization:`Bearer ${J}`,"Content-Type":"application/json"},body:JSON.stringify(Xe)});if(!Ze.ok){const je=await Ze.text();console.error("Batch Google Sync Failed",je),Ze.status===401&&b({msg:"Google  Google",type:"error"})}}catch(Ze){console.error("Google Batch Sync Error",Ze)}}))})},Co=async(B,U=[],P)=>{if(!xe)return"";m("syncing");const G=P||fl(),F=r.length>0?Math.max(...r.map(dt=>dt.order_index||0)):0,J=B.order_index!==void 0?B.order_index:F+1e4;Y(G);const de={...B,id:G,user_id:e.id,parent_id:B.parent_id||null,created_at:new Date().toISOString(),tags:B.tags||[],images:B.images||[],order_index:J,view_orders:B.view_orders||{},is_all_day:B.is_all_day||!1,start_time:B.start_time||null,end_time:B.end_time||null,duration:B.duration||null,reviewed_at:null,dependencies:B.dependencies||[]};yn({type:"ADD",payload:{data:de}}),s(dt=>{const Ct=[...dt,de].sort((pt,vt)=>(pt.order_index||0)-(vt.order_index||0)||pt.created_at.localeCompare(vt.created_at));return ne.current=Ct,Ct});const{error:Oe}=await xe.from("tasks").insert([de]);if(Oe)return console.error("Task Insert Error:",Oe),s(dt=>dt.filter(Ct=>Ct.id!==G)),st(Oe),"";const Ye=a.find(dt=>(de.tags||[]).includes(dt.id)&&dt.name.startsWith("Google:")),Xe=de.start_date&&(de.start_time||de.is_all_day);if(Ye&&Xe){const dt=localStorage.getItem("google_access_token");if(dt){console.log("[Google Sync] New task has Google tag, creating event...");const Ct=Ye.name.replace("Google:","").trim();kl(dt).then(async pt=>{const vt=pt.find(Ae=>Ae.summary===Ct),Ze=vt?vt.id:"primary",je={summary:de.title,description:de.description||""},Ve=new Date(de.start_date).toLocaleDateString("en-CA"),be=Intl.DateTimeFormat().resolvedOptions().timeZone;if(de.is_all_day){je.start={date:Ve};const Ae=new Date(Ve),Je=new Date(Ae);Je.setDate(Je.getDate()+1),je.end={date:Je.toLocaleDateString("en-CA")}}else if(de.start_time){const Ae=de.start_time.length>5?de.start_time.substring(0,5):de.start_time,Je=`${Ve}T${Ae}:00`;let It="";if(de.end_time)It=de.end_time.length>5?de.end_time.substring(0,5):de.end_time;else{const xt=new Date(Je);xt.setHours(xt.getHours()+1),It=`${String(xt.getHours()).padStart(2,"0")}:${String(xt.getMinutes()).padStart(2,"0")}`}je.start={dateTime:Je,timeZone:be},je.end={dateTime:`${Ve}T${It}:00`,timeZone:be}}if(je.start)try{const Ae=await Mo(dt,Ze,je);if(Ae){const Je=JSON.parse(localStorage.getItem("task_google_map")||"{}");Je[G]={evtId:Ae,calId:Ze},localStorage.setItem("task_google_map",JSON.stringify(Je)),console.log("[Google Sync] Created event for new task:",G,"eventId:",Ae),b({msg:"Google ",type:"info"})}}catch(Ae){console.error("[Google Sync] Failed to create event for new task:",Ae)}}).catch(pt=>console.error("[Google Sync] Calendar list fetch failed:",pt))}}return m("synced"),G},al=async(B,U=null,P)=>{if(!xe)return;m("syncing");let G=ne.current.length>0?Math.max(...ne.current.map(dt=>dt.order_index||0)):0;const F=[],J=new Date().toISOString(),de=(dt,Ct)=>{for(const pt of dt){G+=1e4;const vt=pt.id||fl();Y(vt);const Ze={id:vt,user_id:e.id,parent_id:Ct,created_at:J,title:pt.title,description:pt.description,start_date:pt.start_date||null,due_date:pt.due_date||null,order_index:G,view_orders:{today:0},dependencies:pt.dependencies||[],is_all_day:pt.is_all_day!==void 0?pt.is_all_day:!0,start_time:pt.start_time||null,end_time:pt.end_time||null,duration:pt.duration||null,color:pt.color,tags:pt.tags||[],status:pt.status||"todo",images:pt.images||[],reviewed_at:null,reminder_minutes:pt.reminder_minutes||null,google_event_id:pt.google_event_id||null,google_calendar_id:pt.google_calendar_id||null};F.push(Ze),pt.subtasks&&pt.subtasks.length>0&&de(pt.subtasks,vt)}};if(de(B,U),F.length===0)return;s(dt=>{const Ct=[...dt,...F].sort((pt,vt)=>(pt.order_index||0)-(vt.order_index||0)||pt.created_at.localeCompare(vt.created_at));return ne.current=Ct,Ct});const Oe=500;let Ye=0;const Xe=F.length;try{const dt=JSON.parse(localStorage.getItem("task_google_map")||"{}");for(let Ct=0;Ct<Xe;Ct+=Oe){const pt=F.slice(Ct,Ct+Oe),vt=pt.map(je=>{const{google_event_id:Ve,google_calendar_id:be,...Ae}=je;return Ae}),{error:Ze}=await xe.from("tasks").insert(vt);if(Ze){console.error("Batch insert error in chunk "+Ct,Ze),st(Ze);break}pt.forEach(je=>{je.google_event_id&&je.google_calendar_id&&(dt[je.id]={evtId:je.google_event_id,calId:je.google_calendar_id})}),Ye+=pt.length,P&&P(Ye,Xe),await new Promise(je=>setTimeout(je,10))}localStorage.setItem("task_google_map",JSON.stringify(dt))}catch(dt){console.error("Batch process failed",dt)}m("synced")},dc=async B=>{if(!xe||B.length===0)return[];m("syncing");const U=[],P=new Map,G=J=>{const de=ne.current.filter(Ye=>Ye.parent_id===J);let Oe=[];return de.forEach(Ye=>{Oe.push(Ye),Oe=[...Oe,...G(Ye.id)]}),Oe};let F=ne.current.length>0?Math.max(...ne.current.map(J=>J.order_index||0)):0;try{for(const J of B){const de=ne.current.find(dt=>dt.id===J);if(!de)continue;const Oe=G(J);F+=1e4;const Ye=fl();P.set(J,Ye);const Xe={...de,id:Ye,title:de.title+" ()",created_at:new Date().toISOString(),order_index:F,view_orders:{},reviewed_at:null};delete Xe.user_id,await Co(Xe,[],Ye),U.push(Ye);for(const dt of Oe){F+=1e4;const Ct=fl();P.set(dt.id,Ct);const pt=P.get(dt.parent_id)||dt.parent_id,vt={...dt,id:Ct,parent_id:pt,created_at:new Date().toISOString(),order_index:F,view_orders:{},reviewed_at:null};delete vt.user_id,await Co(vt,[],Ct)}}}catch(J){st(J)}finally{m("synced")}return U},jn=async(B,U,P=[],G)=>{var vt,Ze;if(console.warn("[updateTask] CALLED:",B,"status:",U.status),!xe)return;const F=r.find(je=>je.id===B);if(F&&Be(F)&&!(G!=null&&G.skipGoogleLockCheck)){console.warn("[updateTask] BLOCKED: Task is locked via Google tag:",B),b({msg:" Google ",type:"error"});return}if(m("syncing"),Y(B),ce==="inbox"&&F&&!F.parent_id){const je=a.find(zt=>zt.name.trim().toLowerCase()==="project"),Ve=a.find(zt=>zt.name.includes("")),be=a.find(zt=>zt.name.trim().toLowerCase()==="note"),Ae=a.find(zt=>zt.name.trim().toLowerCase()==="prompt"),Je=a.find(zt=>zt.name==="#prompt"),It=a.find(zt=>zt.name.trim().toLowerCase()==="journal"),xt=a.find(zt=>zt.name.trim().toLowerCase()==="someday"),Tt=a.find(zt=>["annual","annualplan","",""].some(Bt=>zt.name.trim().toLowerCase().includes(Bt))),et=a.find(zt=>["schedule",""].includes(zt.name.trim().toLowerCase())),te=U.tags||F.tags||[],Le=F.tags||[],ct=U.tags&&(je&&te.includes(je.id)&&!Le.includes(je.id)||Ve&&te.includes(Ve.id)&&!Le.includes(Ve.id)||be&&te.includes(be.id)&&!Le.includes(be.id)||Ae&&te.includes(Ae.id)&&!Le.includes(Ae.id)||Je&&te.includes(Je.id)&&!Le.includes(Je.id)||It&&te.includes(It.id)&&!Le.includes(It.id)||xt&&te.includes(xt.id)&&!Le.includes(xt.id)||Tt&&te.includes(Tt.id)&&!Le.includes(Tt.id)||et&&te.includes(et.id)&&!Le.includes(et.id)),at=U.status&&(U.status==="someday"||U.status==="waiting")&&F.status!=="someday"&&F.status!=="waiting";(U.start_date&&!F.start_date||U.due_date&&!F.due_date||U.parent_id&&!F.parent_id||ct||at)&&!mt.current.includes(B)&&hn(B)}if(F&&!(G!=null&&G.skipHistory)){const je={};let Ve=!1;Object.keys(U).forEach(be=>{const Ae=F[be],Je=U[be];je[be]=Ae,Array.isArray(Ae)||Array.isArray(Je)||Ae&&typeof Ae=="object"?JSON.stringify(Ae)!==JSON.stringify(Je)&&(Ve=!0):Ae!==Je&&(Ve=!0)}),Ve&&yn({type:"UPDATE",payload:{id:B,before:je,after:U}})}if(U.start_date&&F){const je=new Date().toISOString().split("T")[0],Ve=U.start_date===je||U.start_date.startsWith(je),be=((vt=F.view_orders)==null?void 0:vt.today)!==void 0;if(Ve&&!be){const Ae=ne.current.filter(xt=>{const Tt=xt.start_date||xt.due_date;return Tt&&(Tt===je||Tt.startsWith(je))});let Je=0;Ae.forEach(xt=>{var et;const Tt=((et=xt.view_orders)==null?void 0:et.today)??xt.order_index??0;Tt>Je&&(Je=Tt)});const It=Je+1e4;U.view_orders={...F.view_orders||{},...U.view_orders||{},today:It}}}const J=U.completed_at&&(!F||!F.completed_at);let de=[];if(J){const je=Ve=>{const Ae=ne.current.filter(It=>It.parent_id===Ve&&!It.completed_at).map(It=>It.id),Je=Ae.flatMap(It=>je(It));return[...Ae,...Je]};de=je(B)}s(je=>{const Ve=new Date().toISOString();let be=je.map(Ae=>Ae.id===B?{...Ae,...U,updated_at:Ve}:Ae);return de.length>0&&(be=be.map(Ae=>de.includes(Ae.id)?{...Ae,completed_at:U.completed_at,status:"completed",updated_at:Ve}:Ae)),ne.current=be,be});const{google_event_id:Oe,google_calendar_id:Ye,...Xe}=U,{error:dt}=await xe.from("tasks").update(Xe).eq("id",B);if(dt){F&&s(je=>{const Ve=je.map(be=>be.id===B?F:be);return ne.current=Ve,Ve}),st(dt);return}else{console.log("[updateTask] Database update successful, proceeding to Google sync check");const je=JSON.parse(localStorage.getItem("task_google_map")||"{}");Oe&&Ye&&(je[B]={evtId:Oe,calId:Ye},localStorage.setItem("task_google_map",JSON.stringify(je)));const Ve=je[B];if(U.status==="deleted"&&console.log("[Google Sync Check] Task being deleted:",B,"Has Google mapping:",!!Ve),F&&Ve&&Ve.evtId!=="PENDING"){const be=localStorage.getItem("google_access_token");if(be){const Ae={...F,...U},Je={};if(U.tags!==void 0){const xt=a.find(et=>(F.tags||[]).includes(et.id)&&et.name.startsWith("Google:")),Tt=a.find(et=>(U.tags||[]).includes(et.id)&&et.name.startsWith("Google:"));if(xt&&Tt&&xt.id!==Tt.id){console.log("[Google Sync] Calendar tag changed from",xt.name,"to",Tt.name),xt.name.replace("Google:","").trim();const et=Tt.name.replace("Google:","").trim();kl(be).then(async te=>{var ct;const Le=te.find(at=>at.summary===et);if(Le)try{await ca(be,Ve.calId,Ve.evtId),console.log("[Google Sync] Deleted event from old calendar:",Ve.calId);const at={summary:Ae.title,description:Ae.description||""},St=(ct=Ae.start_date)==null?void 0:ct.split("T")[0],zt=Intl.DateTimeFormat().resolvedOptions().timeZone;if(Ae.is_all_day&&St){at.start={date:St};const Bt=new Date(St);Bt.setDate(Bt.getDate()+1),at.end={date:Bt.toISOString().split("T")[0]}}else if(Ae.start_time&&St){const Bt=(Ae.start_time||"").substring(0,5);at.start={dateTime:`${St}T${Bt}:00`,timeZone:zt};const Gt=Ae.end_time?Ae.end_time.substring(0,5):(()=>{const an=new Date(`${St}T${Bt}:00`);return an.setHours(an.getHours()+1),`${String(an.getHours()).padStart(2,"0")}:${String(an.getMinutes()).padStart(2,"0")}`})();at.end={dateTime:`${St}T${Gt}:00`,timeZone:zt}}if(at.start){const Bt=await Mo(be,Le.id,at);if(Bt){const Gt=JSON.parse(localStorage.getItem("task_google_map")||"{}");Gt[B]={evtId:Bt,calId:Le.id},localStorage.setItem("task_google_map",JSON.stringify(Gt)),console.log("[Google Sync] Moved event to new calendar:",Le.id,"new event ID:",Bt),b({msg:` ${et}`,type:"info"})}}}catch(at){console.error("[Google Sync] Calendar move failed:",at),b({msg:"",type:"error"})}}).catch(te=>console.error("[Google Sync] Failed to fetch calendars for move:",te));return}}if(!(U.title!==void 0||U.status!==void 0||U.start_date!==void 0||U.start_time!==void 0||U.end_time!==void 0||U.is_all_day!==void 0))return;if(U.title!==void 0&&U.title!==F.title&&(Je.summary=Ae.title),U.description!==void 0&&U.description!==F.description&&(Je.description=Ae.description||""),U.status==="deleted"){console.log("[Google Sync] Task moved to trash, calling DELETE API"),ca(be,Ve.calId,Ve.evtId).then(()=>{b({msg:"Google ",type:"info"});const xt=JSON.parse(localStorage.getItem("task_google_map")||"{}");delete xt[B],localStorage.setItem("task_google_map",JSON.stringify(xt))}).catch(xt=>console.error("Google Delete Error",xt));return}else U.status&&F.status==="deleted"&&(Je.status="confirmed",console.log("[Google Sync] Task restored, setting event status to confirmed"),Je.status="confirmed",console.log("[Google Sync] Task restored, setting event status to confirmed"));try{const xt=at=>{if(!at)return null;if(typeof at=="string"){const St=at.match(/^(\d{4}-\d{2}-\d{2})/);return St?St[1]:null}return null},Tt=at=>{if(!at)return null;if(typeof at=="string"){const St=at.match(/^(\d{1,2}):(\d{2})/);if(St)return`${St[1].padStart(2,"0")}:${St[2]}`}return null};if((U.start_date!==void 0&&xt(U.start_date)!==xt(F.start_date)||U.start_time!==void 0&&Tt(U.start_time)!==Tt(F.start_time)||U.end_time!==void 0&&Tt(U.end_time)!==Tt(F.end_time)||U.is_all_day!==void 0&&U.is_all_day!==F.is_all_day)&&Ae.start_date){const at=Intl.DateTimeFormat().resolvedOptions().timeZone,St=xt(Ae.start_date),zt=Bt=>{if(!Bt)return null;if(typeof Bt=="string"){const Gt=Bt.match(/^(\d{1,2}):(\d{2})(?::(\d{2}))?/);if(Gt){const an=Gt[1].padStart(2,"0"),xn=Gt[2],Tn=Gt[3]||"00";return`${an}:${xn}:${Tn}`}}return null};if(Ae.is_all_day&&St){Je.start={date:St};const Bt=new Date(St);Bt.setDate(Bt.getDate()+1);const Gt=Bt.toISOString().split("T")[0];Je.end={date:Gt}}else if(St&&Ae.start_time){const Bt=zt(Ae.start_time);if(Bt){const Gt=`${St}T${Bt}`;Je.start={dateTime:Gt,timeZone:at};let an="";const xn=zt(Ae.end_time);if(xn)an=`${St}T${xn}`;else{const Tn=new Date(Gt),bn=new Date(Tn.getTime()+60*60*1e3),br=String(bn.getHours()).padStart(2,"0"),Lr=String(bn.getMinutes()).padStart(2,"0");an=`${St}T${br}:${Lr}:00`}Je.end={dateTime:an,timeZone:at}}}}if(Je.start||Je.end){const at=Je.start&&(Je.start.date||Je.start.dateTime),St=Je.end&&(Je.end.date||Je.end.dateTime);(!at||!St)&&(delete Je.start,delete Je.end,console.log("[Google Sync] Removed invalid date objects from payload"))}const Le=Object.keys(Je).length>0&&(Je.summary||Je.status||Je.start&&Je.end);if(U.is_all_day!==void 0&&F.is_all_day!==U.is_all_day&&Je.start&&Je.end){console.log("[Google Sync] Event TYPE change detected (is_all_day:",F.is_all_day,"->",U.is_all_day,"), using delete+create"),On.current=!0;const at=Ve.evtId;nr.current.add(at),(async()=>{try{await ca(be,Ve.calId,at);const St={summary:Ae.title,description:Ae.description||"",start:Je.start,end:Je.end},zt=await Mo(be,Ve.calId,St);nr.current.add(zt);const Bt=JSON.parse(localStorage.getItem("task_google_map")||"{}");Bt[B]={evtId:zt,calId:Ve.calId},localStorage.setItem("task_google_map",JSON.stringify(Bt)),b({msg:"Google ",type:"info"}),console.log("[Google Sync] Event type change completed with new ID:",zt)}catch(St){console.error("Failed to recreate event:",St),b({msg:"Google : ",type:"error"})}finally{On.current=!1}})()}else Le&&(console.log("[Google Sync] Updating event:",Ve.evtId),console.log("[Google Sync] Full payload:",JSON.stringify(Je,null,2)),s1(be,Ve.calId,Ve.evtId,Je).then(()=>b({msg:"Google ",type:"info"})).catch(async at=>{console.error("Google Update Error",at,"Payload:",Je),(at.message||"").includes("conflict")||b({msg:`Google : ${at.message}`,type:"error"})}))}catch(xt){console.error("Date parsing error",xt)}}}}const pt=JSON.parse(localStorage.getItem("task_google_map")||"{}")[B];if(F&&!pt&&F.status==="deleted"&&U.status&&U.status!=="deleted"){const je=localStorage.getItem("google_access_token"),Ve={...F,...U},be=Ve.start_date&&(Ve.start_time||Ve.is_all_day);if(je&&be){console.log("[Google Sync] Task restored from trash. Recreating Google Event..."),b({msg:" Google ...",type:"info"});const Ae={summary:Ve.title,description:Ve.description||""},Je=Ve.start_date.split("T")[0];if(Ve.is_all_day){Ae.start={date:Je};const It=new Date(Je);It.setDate(It.getDate()+1),Ae.end={date:It.toISOString().split("T")[0]}}else if(Ve.start_time){const It=Ve.start_time.length>5?Ve.start_time.substring(0,5):Ve.start_time,xt=`${Je}T${It}:00`;let Tt="";if(Ve.end_time)Tt=Ve.end_time.length>5?Ve.end_time.substring(0,5):Ve.end_time;else{const Le=new Date(xt);Le.setHours(Le.getHours()+1);const ct=String(Le.getHours()).padStart(2,"0"),at=String(Le.getMinutes()).padStart(2,"0");Tt=`${ct}:${at}`}const et=`${Je}T${Tt}:00`,te=Intl.DateTimeFormat().resolvedOptions().timeZone;Ae.start={dateTime:xt,timeZone:te},Ae.end={dateTime:et,timeZone:te}}Ae.start&&Mo(je,"primary",Ae).then(It=>{if(It){const xt=JSON.parse(localStorage.getItem("task_google_map")||"{}");xt[B]={evtId:It,calId:"primary"},localStorage.setItem("task_google_map",JSON.stringify(xt)),b({msg:"Google ",type:"info"})}}).catch(It=>console.error("Restore Google Error:",It))}}if(F&&!pt){const je={...F,...U,completed_at:null},Ve=U.tags!==void 0?U.tags:F.tags||[],be=a.find(Je=>Ve.includes(Je.id)&&Je.name.startsWith("Google:")),Ae=je.start_date&&(je.start_time||je.is_all_day);if(be&&Ae&&je.status!=="deleted"){const Je=localStorage.getItem("google_access_token");if(Je){const It=JSON.parse(localStorage.getItem("task_google_map")||"{}");if(((Ze=It[B])==null?void 0:Ze.evtId)==="PENDING")return;It[B]={evtId:"PENDING",calId:"primary"},localStorage.setItem("task_google_map",JSON.stringify(It)),console.log("[Google Sync] Found Google Tag:",be.name,"Creating event..."),b({msg:" Google ...",type:"info"});const xt=be.name.replace("Google:","").trim();let Tt="primary";kl(Je).then(async et=>{var St;const te=et.find(zt=>zt.summary===xt);te?(Tt=te.id,console.log("[Google Sync] Resolved Calendar ID:",Tt)):console.warn("[Google Sync] Calendar not found:",xt,"Using primary.");const Le={summary:je.title,description:je.description||""},ct=new Date(je.start_date).toLocaleDateString("en-CA"),at=Intl.DateTimeFormat().resolvedOptions().timeZone;if(je.is_all_day){Le.start={date:ct};const zt=new Date(ct),Bt=new Date(zt);Bt.setDate(Bt.getDate()+1),Le.end={date:Bt.toLocaleDateString("en-CA")}}else if(je.start_time){const zt=je.start_time.length>5?je.start_time.substring(0,5):je.start_time,Bt=`${ct}T${zt}:00`;let Gt="";if(je.end_time)Gt=je.end_time.length>5?je.end_time.substring(0,5):je.end_time;else{const xn=new Date(Bt);xn.setHours(xn.getHours()+1);const Tn=String(xn.getHours()).padStart(2,"0"),bn=String(xn.getMinutes()).padStart(2,"0");Gt=`${Tn}:${bn}`}const an=`${ct}T${Gt}:00`;Le.start={dateTime:Bt,timeZone:at},Le.end={dateTime:an,timeZone:at}}if(Le.start)try{const zt=await Mo(Je,Tt,Le);if(zt){const Bt=JSON.parse(localStorage.getItem("task_google_map")||"{}");Bt[B]={evtId:zt,calId:Tt},localStorage.setItem("task_google_map",JSON.stringify(Bt)),b({msg:"Google ",type:"info"})}}catch(zt){console.error("[Google Sync] Creation failed",zt);const Bt=JSON.parse(localStorage.getItem("task_google_map")||"{}");((St=Bt[B])==null?void 0:St.evtId)==="PENDING"&&(delete Bt[B],localStorage.setItem("task_google_map",JSON.stringify(Bt))),b({msg:"Google ",type:"error"})}}).catch(et=>{var Le;console.error("Fetch calendars failed",et);const te=JSON.parse(localStorage.getItem("task_google_map")||"{}");((Le=te[B])==null?void 0:Le.evtId)==="PENDING"&&(delete te[B],localStorage.setItem("task_google_map",JSON.stringify(te)))})}}}if(de.length>0&&await xe.from("tasks").update({completed_at:U.completed_at,status:"completed"}).in("id",de),P.length>0&&await xe.from("tasks").update({parent_id:B}).in("id",P),J&&(F!=null&&F.repeat_rule)&&F.repeat_rule.triggerMode!=="on_schedule"){const je=K6(F.start_date||new Date().toISOString(),F.repeat_rule);if(je){const Ve={user_id:F.user_id,title:F.title,description:F.repeat_rule.copyDescription!==!1?F.description:null,status:"todo",parent_id:F.parent_id,start_date:je,due_date:null,is_project:F.is_project,tags:F.tags,color:F.color,order_index:F.order_index,is_all_day:F.is_all_day,start_time:F.is_all_day?null:F.start_time,end_time:F.is_all_day?null:F.end_time,duration:F.duration,reminder_minutes:F.reminder_minutes!==void 0?F.reminder_minutes:null,repeat_rule:F.repeat_rule},{data:be,error:Ae}=await xe.from("tasks").insert(Ve).select().single();if(be&&!Ae){s(It=>{const xt=[...It,be];return ne.current=xt,xt});const Je=G6(F.repeat_rule,(ge==null?void 0:ge.language)||"zh");b({msg:`  (${Je})`,type:"info"})}}}m("synced")},Pi=async(B,U)=>{if(!xe||B.length===0)return;const P=B.filter(({id:Ze})=>{const je=ne.current.find(Ve=>Ve.id===Ze);return je&&Be(je)});P.length>0&&(console.warn("[batchUpdateTasks] BLOCKED:",P.length,"tasks are locked via Google tag"),b({msg:`${P.length}  Google `,type:"error"}));const G=B.filter(({id:Ze})=>{const je=ne.current.find(Ve=>Ve.id===Ze);return!je||!Be(je)});if(G.length===0)return;const F=G;if(m("syncing"),ce==="inbox"){const Ze=a.find(xt=>xt.name.trim().toLowerCase()==="project"),je=a.find(xt=>xt.name.includes("")),Ve=a.find(xt=>xt.name.trim().toLowerCase()==="note"),be=a.find(xt=>xt.name.trim().toLowerCase()==="prompt"),Ae=a.find(xt=>xt.name==="#prompt"),Je=a.find(xt=>xt.name.trim().toLowerCase()==="journal"),It=a.find(xt=>xt.name.trim().toLowerCase()==="someday");F.forEach(({id:xt,data:Tt})=>{const et=ne.current.find(te=>te.id===xt);if(et&&!et.parent_id){const te=Tt.tags||et.tags||[],Le=et.tags||[],ct=Tt.tags&&(Ze&&te.includes(Ze.id)&&!Le.includes(Ze.id)||je&&te.includes(je.id)&&!Le.includes(je.id)||Ve&&te.includes(Ve.id)&&!Le.includes(Ve.id)||be&&te.includes(be.id)&&!Le.includes(be.id)||Ae&&te.includes(Ae.id)&&!Le.includes(Ae.id)||Je&&te.includes(Je.id)&&!Le.includes(Je.id)||It&&te.includes(It.id)&&!Le.includes(It.id)),at=Tt.status&&(Tt.status==="someday"||Tt.status==="waiting")&&et.status!=="someday"&&et.status!=="waiting";(Tt.start_date&&!et.start_date||Tt.due_date&&!et.due_date||Tt.parent_id&&!et.parent_id||ct||at)&&!mt.current.includes(xt)&&hn(xt)}})}const J=JSON.parse(localStorage.getItem("task_google_map")||"{}"),de=F.map(Ze=>{const{google_event_id:je,google_calendar_id:Ve,...be}=Ze.data;return je&&Ve&&(J[Ze.id]={evtId:je,calId:Ve}),{id:Ze.id,data:be}});localStorage.setItem("task_google_map",JSON.stringify(J));const Oe=localStorage.getItem("google_access_token"),Ye=[];let Xe=!1;Oe&&B.forEach(({id:Ze,data:je})=>{const Ve=ne.current.find(be=>be.id===Ze);if(Ve&&Ve.status==="deleted"&&je.status&&je.status!=="deleted"&&!J[Ze]){const be={...Ve,...je};be.start_date&&(be.start_time||be.is_all_day)&&(Xe=!0,Ye.push((async()=>{try{console.log("[batchUpdateTasks] Restoring Google Event for:",Ze);const Je={summary:be.title,description:be.description||""},It=be.start_date.split("T")[0];if(be.is_all_day){Je.start={date:It};const xt=new Date(It);xt.setDate(xt.getDate()+1),Je.end={date:xt.toISOString().split("T")[0]}}else if(be.start_time){const xt=be.start_time.length>5?be.start_time.substring(0,5):be.start_time,Tt=`${It}T${xt}:00`;let et="";if(be.end_time)et=be.end_time.length>5?be.end_time.substring(0,5):be.end_time;else{const ct=new Date(Tt);ct.setHours(ct.getHours()+1);const at=String(ct.getHours()).padStart(2,"0"),St=String(ct.getMinutes()).padStart(2,"0");et=`${at}:${St}`}const te=`${It}T${et}:00`,Le=Intl.DateTimeFormat().resolvedOptions().timeZone;Je.start={dateTime:Tt,timeZone:Le},Je.end={dateTime:te,timeZone:Le}}if(Je.start){const xt=await Mo(Oe,"primary",Je);xt&&(J[Ze]={evtId:xt,calId:"primary"})}}catch(Je){console.error("[batchUpdateTasks] Restore Error",Je)}})()))}}),Xe&&(b({msg:" Google ...",type:"info"}),await Promise.all(Ye),localStorage.setItem("task_google_map",JSON.stringify(J)));const dt=[];let Ct=!1;Oe&&B.forEach(({id:Ze,data:je})=>{const Ve=ne.current.find(It=>It.id===Ze);if(!Ve||je.status==="deleted"||Ve.status==="deleted"&&je.status&&je.status!=="deleted")return;const Ae={...Ve,...je},Je=J[Ze];if(Je){const It={};if(je.title&&(It.summary=je.title),je.description!==void 0&&(It.description=je.description),je.start_date||je.start_time||je.end_time||je.is_all_day!==void 0){const et=new Date(Ae.start_date).toLocaleDateString("en-CA"),te=Intl.DateTimeFormat().resolvedOptions().timeZone;if(console.log("[Batch Sync] Date change detected:",{taskId:Ze,is_all_day:Ae.is_all_day,start_time:Ae.start_time,end_time:Ae.end_time,dateStr:et}),Ae.is_all_day){It.start={date:et};const Le=new Date(et);Le.setDate(Le.getDate()+1),It.end={date:Le.toLocaleDateString("en-CA")}}else{const Le=Ae.start_time||"09:00",ct=Ae.end_time||"10:00",at=Le.length>5?Le.substring(0,5):Le,St=`${et}T${at}:00`,zt=ct.length>5?ct.substring(0,5):ct;It.end={dateTime:`${et}T${zt}:00`,timeZone:te},It.start={dateTime:St,timeZone:te}}console.log("[Batch Sync] Payload constructed:",JSON.stringify(It,null,2))}if(je.is_all_day!==void 0&&Ve.is_all_day!==je.is_all_day&&It.start&&It.end){console.log("[Batch Sync] Event TYPE change detected (is_all_day:",Ve.is_all_day,"->",je.is_all_day,"), using delete+create"),Ct=!0,On.current=!0;const et=Je.evtId;nr.current.add(et),console.log("[Batch Sync] Marked old event as replaced:",et),dt.push((async()=>{try{await ca(Oe,Je.calId,et),console.log("[Batch Sync] Old event deleted");const te={summary:Ae.title,description:Ae.description||"",start:It.start,end:It.end},Le=await Mo(Oe,Je.calId,te);console.log("[Batch Sync] New event created:",Le),nr.current.add(Le),console.log("[Batch Sync] Marked new event to skip in sync:",Le);const ct=JSON.parse(localStorage.getItem("task_google_map")||"{}");ct[Ze]={evtId:Le,calId:Je.calId},localStorage.setItem("task_google_map",JSON.stringify(ct)),J[Ze]={evtId:Le,calId:Je.calId},console.log("[Batch Sync] Event type change completed successfully")}catch(te){console.error("[Batch Sync] Failed to recreate event:",te.message)}finally{On.current=!1}})())}else Object.keys(It).length>0&&(Ct=!0,dt.push(s1(Oe,Je.calId,Je.evtId,It).then(()=>console.log("[Batch Sync] Update success for task:",Ze)).catch(async et=>{const te=et.message||"";console.error("[Batch Sync] Update failed for task:",Ze,"Error:",te)})))}else{const It=je.tags!==void 0?je.tags:Ve.tags||[],xt=a.find(et=>It.includes(et.id)&&et.name.startsWith("Google:")),Tt=Ae.start_date&&(Ae.start_time||Ae.is_all_day);xt&&Tt&&(Ct=!0,dt.push((async()=>{try{const et=xt.name.replace("Google:","").trim();let te="primary";const ct=(await kl(Oe)).find(Bt=>Bt.summary===et);ct&&(te=ct.id);const at={summary:Ae.title,description:Ae.description||""},St=new Date(Ae.start_date).toLocaleDateString("en-CA"),zt=Intl.DateTimeFormat().resolvedOptions().timeZone;if(Ae.is_all_day){at.start={date:St};const Bt=new Date(St);Bt.setDate(Bt.getDate()+1),at.end={date:Bt.toLocaleDateString("en-CA")}}else if(Ae.start_time){const Bt=Ae.start_time.length>5?Ae.start_time.substring(0,5):Ae.start_time,Gt=`${St}T${Bt}:00`;let an="";if(Ae.end_time)an=Ae.end_time.length>5?Ae.end_time.substring(0,5):Ae.end_time;else{const xn=new Date(Gt);xn.setHours(xn.getHours()+1);const Tn=String(xn.getHours()).padStart(2,"0"),bn=String(xn.getMinutes()).padStart(2,"0");an=`${Tn}:${bn}`}at.start={dateTime:Gt,timeZone:zt},at.end={dateTime:`${St}T${an}:00`,timeZone:zt}}if(at.start){const Bt=await Mo(Oe,te,at);Bt&&(J[Ze]={evtId:Bt,calId:te})}}catch(et){console.error("Batch Create Fail",et)}})()))}}),Ct&&(b({msg:" Google...",type:"info"}),await Promise.all(dt),localStorage.setItem("task_google_map",JSON.stringify(J)));const pt=[];de.forEach(({id:Ze,data:je})=>{Y(Ze);const Ve=ne.current.find(be=>be.id===Ze);if(Ve){const be={};Object.keys(je).forEach(Ae=>{be[Ae]=Ve[Ae]}),pt.push({id:Ze,before:be,after:je})}}),pt.length>0&&!(U!=null&&U.skipHistory)&&yn({type:"BATCH_UPDATE",payload:pt});const vt=new Date().toISOString();s(Ze=>{const je=Ze.map(Ve=>{const be=de.find(Ae=>Ae.id===Ve.id);return be?{...Ve,...be.data,updated_at:vt}:Ve});return ne.current=je,je}),await Promise.all(de.map(({id:Ze,data:je})=>xe.from("tasks").update(je).eq("id",Ze))),m("synced")},er=async(B,U=!1)=>{if(B.length===0)return;const P=B.filter(de=>{const Oe=ne.current.find(Ye=>Ye.id===de);return Oe&&Be(Oe)});P.length>0&&(console.warn("[batchDeleteTasks] BLOCKED:",P.length,"tasks are locked via Google tag"),b({msg:`${P.length}  Google `,type:"error"}));const G=B.filter(de=>{const Oe=ne.current.find(Ye=>Ye.id===de);return!Oe||!Be(Oe)});if(G.length===0)return;const F=G;if(m("syncing"),!U){const de=JSON.parse(localStorage.getItem("task_google_map")||"{}"),Oe=localStorage.getItem("google_access_token");let Ye=0;if(Oe){const Ct=F.map(async pt=>{const vt=de[pt];if(vt)try{console.log("[batchDeleteTasks] Deleting Google Event:",vt.evtId),await ca(Oe,vt.calId,vt.evtId),delete de[pt],Ye++}catch(Ze){console.error("[batchDeleteTasks] Google Delete Error:",Ze)}});await Promise.all(Ct),Ye>0&&localStorage.setItem("task_google_map",JSON.stringify(de))}const Xe=F.map(Ct=>({id:Ct,data:{status:"deleted"}}));await Pi(Xe);const dt=Ye>0?` ${F.length}  ( ${Ye}  Google )`:` ${F.length} `;b({msg:dt,undo:()=>_n()});return}const J=ne.current.filter(de=>F.includes(de.id));if(J.length===0){m("synced");return}if(xe)for(const de of J){if(de.attachments&&de.attachments.length>0)for(const Oe of de.attachments)try{const Xe=new URL(Oe.url).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(Xe){const dt=Xe[1];await xe.storage.from("attachments").remove([dt])}}catch(Ye){console.warn("Failed to delete attachment:",Ye)}if(de.images&&de.images.length>0)for(const Oe of de.images)try{const Xe=new URL(Oe).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(Xe){const dt=Xe[1];await xe.storage.from("attachments").remove([dt])}}catch(Ye){console.warn("Failed to delete image:",Ye)}}if(yn({type:"BATCH_DELETE",payload:{data:J}}),s(de=>{const Oe=de.filter(Ye=>!B.includes(Ye.id));return ne.current=Oe,Oe}),xe)for(let Oe=0;Oe<B.length;Oe+=100){const Ye=B.slice(Oe,Oe+100),{error:Xe}=await xe.from("tasks").delete().in("id",Ye);Xe&&console.error("Batch delete chunk error:",Xe)}m("synced"),b({msg:` ${B.length} `,type:"info"})},na=async(B,U=!1)=>{console.warn("[deleteTask] CALLED! id:",B,"permanent:",U);const P=r.find(G=>G.id===B);if(P&&Be(P)){console.warn("[deleteTask] BLOCKED: Task is locked via Google tag:",B),b({msg:" Google ",type:"error"});return}if(m("syncing"),Y(B),!U){if(P){console.log("[deleteTask] Soft deleting task:",B);const G=JSON.parse(localStorage.getItem("task_google_map")||"{}"),F=G[B];if(F){b({msg:" Google ...",type:"info"});const J=localStorage.getItem("google_access_token");J&&(console.log("[deleteTask] Found Google Event, deleting:",F.evtId),ca(J,F.calId,F.evtId).then(()=>{console.log("[deleteTask] Google Event deleted successfully"),b({msg:"Google ",type:"info"}),delete G[B],localStorage.setItem("task_google_map",JSON.stringify(G))}).catch(de=>{console.error("[deleteTask] Google Delete Error:",de),b({msg:"Google : "+de.message,type:"error"})}))}else console.warn("[deleteTask] No Google mapping found for task:",B);await jn(B,{status:"deleted"}),b({msg:" (v2)",undo:()=>_n()})}return}if(P!=null&&P.attachments&&P.attachments.length>0&&xe)for(const G of P.attachments)try{const J=new URL(G.url).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(J){const de=J[1];await xe.storage.from("attachments").remove([de])}}catch(F){console.warn("Failed to delete attachment:",F)}if(P!=null&&P.images&&P.images.length>0&&xe)for(const G of P.images)try{const J=new URL(G).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(J){const de=J[1];await xe.storage.from("attachments").remove([de])}}catch(F){console.warn("Failed to delete image:",F)}if(P&&yn({type:"DELETE",payload:{data:P}}),s(G=>{const F=G.filter(J=>J.id!==B);return ne.current=F,F}),xe){const{error:G}=await xe.from("tasks").delete().eq("id",B);if(G){st(G),P&&s(F=>{const J=[P,...F];return ne.current=J,J});return}else if(P){const J=JSON.parse(localStorage.getItem("task_google_map")||"{}")[P.id];if(J){const de=localStorage.getItem("google_access_token");de&&ca(de,J.calId,J.evtId).then(()=>b({msg:"Google ",type:"info"})).catch(Oe=>console.error("Google Delete Error",Oe))}}}m("synced"),b({msg:"",type:"info"})},ll=async B=>{const U=r.find(P=>P.id===B);U&&U.status==="deleted"&&(await jn(B,{status:"inbox"}),b({msg:" Inbox",type:"info"}))},tr=async()=>{const B=r.filter(P=>P.status==="deleted");if(B.length===0)return;const U=B.map(P=>({id:P.id,data:{status:"inbox"}}));await Pi(U),b({msg:"",type:"info",undo:()=>_n()})},ue=async()=>{const B=r.filter(U=>U.status==="deleted");B.length!==0&&await er(B.map(U=>U.id),!0)},Dt=async B=>{if(!xe)return;const U=new Date().toISOString();s(P=>P.map(G=>G.id===B?{...G,reviewed_at:U}:G)),await xe.from("tasks").update({reviewed_at:U}).eq("id",B),b({msg:"",type:"info"})},Ut=async(B,U=null)=>{if(!xe||!B.trim())return null;const P=fl(),F=a.filter(dt=>dt.parent_id===U).reduce((dt,Ct)=>Math.max(dt,Ct.order_index||0),0)+1e4,J=a.find(dt=>dt.id===U),de=(J==null?void 0:J.color)||"#6366f1",Oe={id:P,name:B,parent_id:U,user_id:e.id,color:de,order_index:F};yn({type:"ADD_TAG",payload:{data:Oe}}),l(dt=>[...dt,Oe].sort((Ct,pt)=>(Ct.order_index||0)-(pt.order_index||0)));const{data:Ye,error:Xe}=await xe.from("tags").insert([{name:B,parent_id:U,user_id:e.id,color:de,order_index:F}]).select();return Xe?(l(dt=>dt.filter(Ct=>Ct.id!==P)),null):(l(dt=>{const Ct=Ye[0];return dt.some(vt=>vt.id===Ct.id)?dt.filter(vt=>vt.id!==P):dt.map(vt=>vt.id===P?Ct:vt).sort((vt,Ze)=>(vt.order_index||0)-(Ze.order_index||0))}),Ye[0].id)},Ht=async(B,U)=>{if(!xe)return;const P=a.find(G=>G.id===B);if(P){const G={};Object.keys(U).forEach(F=>G[F]=P[F]),yn({type:"UPDATE_TAG",payload:{id:B,before:G,after:U}})}l(G=>G.map(F=>F.id===B?{...F,...U}:F).sort((F,J)=>(F.order_index||0)-(J.order_index||0))),await xe.from("tags").update(U).eq("id",B)},$t=async B=>{if(!xe)return;const U=a.find(P=>P.id===B);U&&yn({type:"DELETE_TAG",payload:{data:U}}),l(P=>P.filter(G=>G.id!==B)),await xe.from("tags").delete().eq("id",B)},rn=(B,U)=>{V(P=>{const G=P.includes(B),F=U!==void 0?U?G?P:[...P,B]:P.filter(J=>J!==B):G?P.filter(J=>J!==B):[...P,B];return e!=null&&e.id&&localStorage.setItem(`expanded_tasks_${e.id}`,JSON.stringify(F)),F})},Dn=B=>{Ee(U=>{const P=typeof B=="function"?B(U):B;return e!=null&&e.id&&localStorage.setItem(`last_view_${e.id}`,P),P!==U&&Ge([]),P})},Bn=B=>{ot(B),e!=null&&e.id&&localStorage.setItem(`sidebar_width_${e.id}`,B.toString())},zn=()=>we(B=>!B),Rn=B=>{ye(U=>{const P=typeof B=="function"?B(U):B;return e!=null&&e.id&&localStorage.setItem(`expanded_tags_${e.id}`,JSON.stringify(P)),P})},hn=B=>{Ge(U=>U.includes(B)?U:[...U,B])},xr=()=>{Ge([])},ar=B=>{ie(U=>{const P=typeof B=="function"?B(U):B;return e!=null&&e.id&&localStorage.setItem(`theme_settings_${e.id}`,JSON.stringify(P)),P})},Ns=async(B,U)=>{const P=new Date,G=P.getFullYear(),F=String(P.getMonth()+1).padStart(2,"0"),J=String(P.getDate()).padStart(2,"0"),de=`${G}-${F}-${J}`,Oe=vt=>a.find(Ze=>vt.some(je=>Ze.name.trim().toLowerCase()===je.toLowerCase())),Ye=Oe(["project",""]),Xe=Oe(["someday"]),dt=Oe(["journal","note","",""]),Ct=Oe(["prompt",""]);for(const vt of B){const Ze=ne.current.find(je=>je.id===vt);if(Ze)switch(U){case"today":case"newtable":await jn(vt,{start_date:de});break;case"project":if(Ye){const je=Ze.tags.includes(Ye.id)?Ze.tags:[...Ze.tags,Ye.id];await jn(vt,{tags:je}),ne.current.some(be=>be.parent_id===vt&&be.status!=="deleted")||await Co({title:"",parent_id:vt,status:"active",importance:null,tags:[],notes:"",start_date:null,due_date:null})}break;case"waiting":if(Xe){const je=Ze.tags.includes(Xe.id)?Ze.tags:[...Ze.tags,Xe.id];await jn(vt,{tags:je,status:"someday"})}else await jn(vt,{status:"someday"});break;case"journal":if(dt){const je=Ze.tags.includes(dt.id)?Ze.tags:[...Ze.tags,dt.id];await jn(vt,{tags:je})}break;case"prompt":if(Ct){const je=Ze.tags.includes(Ct.id)?Ze.tags:[...Ze.tags,Ct.id];await jn(vt,{tags:je})}break}}v([]),k(null);const pt={today:"",newtable:"",project:"",waiting:"/",journal:"",prompt:""};b({msg:` ${B.length} ${pt[U]||U}`,type:"info"})},qs=x.useRef(!1),On=x.useRef(!1),nr=x.useRef(new Set),Mr=async()=>{var U,P,G,F,J,de;if(console.log("[Google Sync] Attempting sync..."),qs.current){console.log("[Google Sync] Already syncing, skipping.");return}if(On.current){console.log("[Google Sync] Event recreation in progress, skipping to avoid conflicts.");return}let B=localStorage.getItem("google_access_token");if(!B){console.log("[Google Sync] No token found, skipping.");return}try{const Oe=await fetch("https://www.googleapis.com/calendar/v3/users/me/calendarList?maxResults=1",{headers:{Authorization:`Bearer ${B}`}});if(Oe.status===401){console.log("[Google Sync] Token expired, attempting silent refresh...");const Ye=localStorage.getItem("google_client_id");if(Ye&&((P=(U=window.google)==null?void 0:U.accounts)!=null&&P.oauth2))try{const Xe=await new Promise(dt=>{window.google.accounts.oauth2.initTokenClient({client_id:Ye,scope:"https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar.readonly",callback:pt=>{pt.error?(console.log("[Google Sync] Silent refresh failed:",pt.error),dt(null)):(console.log("[Google Sync] Silent refresh successful!"),dt(pt.access_token))}}).requestAccessToken({prompt:""}),setTimeout(()=>dt(null),5e3)});if(Xe)B=Xe,localStorage.setItem("google_access_token",Xe),console.log("[Google Sync] Token refreshed successfully");else{console.error("[Google Sync] Silent refresh returned no token"),b({msg:"Google  Google ",type:"error"}),localStorage.removeItem("google_access_token");return}}catch(Xe){console.error("[Google Sync] Silent refresh error:",Xe),b({msg:"Google  Google ",type:"error"}),localStorage.removeItem("google_access_token");return}else{console.log("[Google Sync] Google script not loaded, attempting to load...");try{const{loadGoogleScript:Xe}=await yv(()=>Promise.resolve().then(()=>q6),void 0);await Xe(),b({msg:"Google  Google ",type:"error"})}catch{b({msg:"Google  Google ",type:"error"})}localStorage.removeItem("google_access_token");return}}else if(!Oe.ok){console.error("[Google Sync] Token validation failed:",Oe.status),b({msg:"Google API ",type:"error"});return}}catch(Oe){console.error("[Google Sync] Token validation error:",Oe),b({msg:" Google ",type:"error"});return}console.log("[Google Sync] Starting sync..."),console.log("[Google Sync] replacedEventIdsRef has",nr.current.size,"entries:",Array.from(nr.current)),qs.current=!0;try{const Oe=JSON.parse(localStorage.getItem("task_google_map")||"{}"),Ye=new Set;Object.values(Oe).forEach(be=>{be.calId&&Ye.add(be.calId)});let Xe=[];try{window.google_calendar_list_cache?Xe=window.google_calendar_list_cache:(Xe=await kl(B),window.google_calendar_list_cache=Xe)}catch(be){console.error("[Google Sync] List Calendars Check failed",be)}const dt=a.filter(be=>be.name.startsWith("Google:"));if(console.log("[Google Sync] Found Google tags:",dt.map(be=>be.name)),Xe.length>0){const be=a.filter(Ae=>Ae.name.startsWith("Google:")).map(Ae=>Ae.name.replace("Google:","").trim());console.log("[Google Sync] Tag names to match:",be),be.forEach(Ae=>{const Je=Xe.find(It=>It.summary===Ae);console.log(`[Google Sync] Matching "${Ae}" -> ${Je?Je.id:"NOT FOUND"}`),Je&&Ye.add(Je.id)})}else console.log("[Google Sync] No calendars to match against");const Ct=JSON.parse(localStorage.getItem("google_sync_tokens")||"{}");let pt=[...ne.current];const vt={...Oe};let Ze=!1;console.log("[Google Sync] Syncing calendars:",Array.from(Ye));for(const be of Array.from(Ye)){const Ae=Ct[be];console.log(`[Google Sync] Checking calendar: ${be}, hasToken: ${!!Ae}`);try{const{events:Je,nextSyncToken:It,fullSyncRequired:xt}=await CI(B,be,Ae);if(console.log(`[Google Sync] Calendar ${be}: ${Je.length} events, fullSyncRequired: ${xt}`),xt){console.log(`[Google Sync] Full sync required for ${be}, will retry next time.`),delete Ct[be];continue}if(It&&(Ct[be]=It),Je.length>0){console.log(`[Google Sync] Got ${Je.length} updates for ${be}:`,Je.map(Tt=>({id:Tt.id,summary:Tt.summary,status:Tt.status}))),Ze=!0;for(const Tt of Je){if(nr.current.has(Tt.id)){console.log("[Google Sync] Ignoring replaced event (type change in progress):",Tt.id);continue}const et=Object.keys(vt).find(te=>vt[te].evtId===Tt.id);if(console.log(`[Google Sync] Processing event: "${Tt.summary}" (${Tt.id})`,{hasMapping:!!et,mappedTaskId:et||"none",eventStatus:Tt.status}),Tt.status==="cancelled"){if(et){const te=vt[et];if(te&&te.calId===be){const Le=pt.find(ct=>ct.id===et);Le&&Le.status!=="deleted"&&(Y(et),pt=pt.map(ct=>ct.id===et?{...ct,status:"deleted"}:ct),xe&&await xe.from("tasks").update({status:"deleted"}).eq("id",et),console.log("[Google Auto-Sync] Deleted Task",et,"from calendar",be))}else console.log(`[Google Sync] Ignored deletion of ${et} from ${be} (mapped to ${te==null?void 0:te.calId})`)}}else{const te=Tt.summary||"(No Title)",Le=Tt.description||"";let ct=null,at=null,St=null,zt=!1;if(Tt.start.date)zt=!0,ct=Tt.start.date;else if(Tt.start.dateTime){const Bt=new Date(Tt.start.dateTime);ct=Bt.toLocaleDateString("en-CA"),at=Bt.toTimeString().substring(0,5),Tt.end.dateTime&&(St=new Date(Tt.end.dateTime).toTimeString().substring(0,5))}if(ct)if(et){const Bt=pt.findIndex(Gt=>Gt.id===et);if(Bt!==-1){const Gt=pt[Bt],an=Gt.status==="deleted",xn=Gt.title!==te||Gt.description!==Le||((G=Gt.start_date)==null?void 0:G.split("T")[0])!==ct||(Gt.start_time||"").substring(0,5)!==(at||"")||(Gt.end_time||"").substring(0,5)!==(St||"")||Gt.is_all_day!==zt||an;console.log(`[Google Sync] Checking update for "${te}": changed=${xn}, isDeleted=${an}`,{oldTitle:Gt.title,newTitle:te,oldDate:(F=Gt.start_date)==null?void 0:F.split("T")[0],newDate:ct,oldIsAllDay:Gt.is_all_day,newIsAllDay:zt,oldStartTime:Gt.start_time,newStartTime:at});const Tn=(J=vt[et])==null?void 0:J.calId,bn=Tn&&Tn!==be;if(xn||bn){const br={title:te,description:Le,start_date:ct,is_all_day:zt,status:"todo"};at&&(br.start_time=at),St&&(br.end_time=St);let Lr=[...Gt.tags||[]];if(Xe.length>0){const fi=Xe.find(ra=>ra.id===be)||(be==="primary"?Xe.find(ra=>ra.primary):null);if(fi){const ra=`Google:${fi.summary}`,cl=a.find(Ku=>Ku.name===ra);if(bn){const Ku=a.filter(sa=>sa.name.startsWith("Google:")).map(sa=>sa.id);Lr=Lr.filter(sa=>!Ku.includes(sa)),console.log("[Google Sync] Calendar changed from",Tn,"to",be)}cl&&!Lr.includes(cl.id)&&(Lr.push(cl.id),console.log("[Google Sync] Switched tag to:",ra)),br.tags=Lr,vt[et]={evtId:Tt.id,calId:be}}}pt[Bt]={...Gt,...br},Y(et),xe&&await xe.from("tasks").update(br).eq("id",et),console.log("[Google Sync] Updated Task",et,"with",br),Ze=!0}}else{console.log(`[Google Sync] Stale mapping for "${te}" (taskId: ${et}), trying to find by title...`),delete vt[et];const Gt=a.filter(xn=>xn.name.startsWith("Google:")).map(xn=>xn.id),an=pt.find(xn=>{var Tn;return xn.title===te&&xn.status!=="deleted"&&((Tn=xn.tags)==null?void 0:Tn.some(bn=>Gt.includes(bn)))});if(an){console.log(`[Google Sync] Found matching task by title: "${te}" -> ${an.id}`);const xn=pt.findIndex(Tn=>Tn.id===an.id);if(xn!==-1){const Tn=pt[xn],bn=Tn.status==="deleted",br=Tn.title!==te||Tn.description!==Le||((de=Tn.start_date)==null?void 0:de.split("T")[0])!==ct||(Tn.start_time||"").substring(0,5)!==(at||"")||(Tn.end_time||"").substring(0,5)!==(St||"")||Tn.is_all_day!==zt||bn;if(console.log(`[Google Sync] (Recovered) Checking update for "${te}": changed=${br}`),br){const Lr={title:te,description:Le,start_date:ct,is_all_day:zt,status:"todo"};at&&(Lr.start_time=at),St&&(Lr.end_time=St),pt[xn]={...Tn,...Lr},Y(an.id),xe&&await xe.from("tasks").update(Lr).eq("id",an.id),console.log("[Google Sync] (Recovered) Updated Task",an.id,"with",Lr),Ze=!0}vt[an.id]={evtId:Tt.id,calId:be},console.log("[Google Sync] Updated mapping:",an.id,"->",Tt.id)}}else console.log(`[Google Sync] No matching task found for "${te}", will be created on next sync if tag exists`)}}else{const Bt=JSON.parse(localStorage.getItem("task_google_map")||"{}");if(Object.values(Bt).some(bn=>bn.evtId===Tt.id)){console.log("[Google Sync] Event already mapped (found in fresh check), skipping creation:",Tt.id);continue}let an=[],xn=!1;if(Xe.length>0){let bn=Xe.find(br=>br.id===be);if(!bn&&be==="primary"&&(bn=Xe.find(br=>br.primary===!0)),bn){const br=`Google:${bn.summary}`,Lr=a.find(fi=>fi.name===br);Lr?(an.push(Lr.id),console.log("[Google Sync] Assigned tag:",br,"to new task:",te),xn=!0):console.log("[Google Sync] Tag not found:",br,"- skipping creation")}}if(!xn)continue;const Tn={user_id:e==null?void 0:e.id,title:te,description:Le,status:"todo",start_date:ct,start_time:at,end_time:St,is_all_day:zt,tags:an,order_index:0};if(xe&&e){const{data:bn}=await xe.from("tasks").insert(Tn).select().single();bn&&(pt.push(bn),vt[bn.id]={evtId:Tt.id,calId:be},console.log("[Google Sync] Created Task",bn.id,"with mapping:",{evtId:Tt.id,calId:be},"title:",te))}}}}}}catch{}}Ze&&(pt.sort((be,Ae)=>(be.order_index||0)-(Ae.order_index||0)||be.created_at.localeCompare(Ae.created_at)),s(pt),b({msg:"Google ",type:"info"}));const Ve={...JSON.parse(localStorage.getItem("task_google_map")||"{}"),...vt};localStorage.setItem("task_google_map",JSON.stringify(Ve)),localStorage.setItem("google_sync_tokens",JSON.stringify(Ct)),console.log("[Google Sync] Saved",Object.keys(vt).length,"mappings. Total:",Object.keys(Ve).length)}finally{console.log("[Google Sync] Sync completed."),qs.current=!1,nr.current.size>0&&(console.log("[Google Sync] Cleared",nr.current.size,"replaced event IDs"),nr.current.clear())}};return x.useEffect(()=>{if(console.log("[Google Sync] useEffect running, user:",!!e),!e)return;console.log("[Google Sync] Setting up 60s interval and 3s initial timeout...");const B=setInterval(()=>{console.log("[Google Sync] 60s interval triggered"),Mr()},6e4),U=setTimeout(()=>{console.log("[Google Sync] Initial 3s timeout triggered"),Mr()},3e3);return()=>{console.log("[Google Sync] Cleaning up interval and timeout"),clearInterval(B),clearTimeout(U)}},[e,a]),c.jsx(En.Provider,{value:{user:e,tasks:r,tags:a,visibleTasks:Nn,loading:u,syncStatus:p,dragState:Te,startDrag:ta,updateDropState:di,endDrag:il,updateGhostPosition:ea,addTask:Co,batchAddTasks:al,duplicateTasks:dc,updateTask:jn,batchUpdateTasks:Pi,deleteTask:na,batchDeleteTasks:er,addTag:Ut,updateTag:Ht,deleteTag:$t,keyboardMove:ol,smartReschedule:Fe,lockTask:ze,unlockTask:Qe,verifyTaskPassword:Z,temporarilyUnlockTask:O,archiveCompletedTasks:Ne,archivedTasks:i,restoreArchivedTask:Pe,deleteArchivedTask:We,updateArchivedTask:kt,batchDeleteArchivedTasks:Vt,clearAllTasks:Xt,exportData:Jt,importData:fn,syncGoogleToApp:Mr,undo:_n,redo:Fn,canUndo:_e.length>0,canRedo:lt.length>0,logout:Hn,navigateToTask:is,navigateBack:Gs,canNavigateBack:Et.length>0,toast:y,setToast:b,selectedTaskIds:g,setSelectedTaskIds:v,handleSelection:Oi,selectionAnchor:w,setSelectionAnchor:C,focusedTaskId:I,setFocusedTaskId:k,editingTaskId:A,setEditingTaskId:N,inlineEditingTaskId:ee,setInlineEditingTaskId:pe,expandedTaskIds:L,setExpandedTaskIds:V,toggleExpansion:rn,view:ce,setView:Dn,tagFilter:He,setTagFilter:tt,advancedFilters:ht,setAdvancedFilters:Ie,themeSettings:ge,setThemeSettings:ar,calculateVisibleTasks:ui,pendingFocusTaskId:he,setPendingFocusTaskId:ke,leavingTaskIds:ut,addLeavingTask:hn,dismissLeavingTasks:xr,initError:f,sidebarWidth:Nt,setSidebarWidth:Bn,sidebarCollapsed:Ot,toggleSidebar:zn,expandedTags:fe,setExpandedTags:Rn,calendarDate:Re,setCalendarDate:_t,taskCounts:yt,focusSplitWidth:qe,setFocusSplitWidth:Ke,reviewTask:Dt,restoreTask:ll,restoreTrash:tr,emptyTrash:ue,moveTaskToView:Ns,isCmdPressed:it,tagsWithResolvedColors:Se,language:me,setLanguage:Q,t:X,viewTagFilters:E,updateViewTagFilter:se,constructionModeEnabled:re,setConstructionModeEnabled:$,searchHistory:H,addSearchHistory:Ft,deleteSearchHistory:nn,searchOpen:R,setSearchOpen:ae,lockedGoogleTagIds:z,toggleGoogleTagLock:$e,isTaskGoogleLocked:Be},children:t})},Lu=x.createContext({isRecording:!1,recordingTime:0,startRecording:async()=>{},stopRecording:()=>{},cancelRecording:()=>{},addMarker:()=>null,recordingTaskId:null,audioMarkers:[],currentRecordingId:null,analyser:null,audioContext:null}),Z6=({children:t})=>{x.useContext(En);const[e,n]=x.useState(!1),[r,s]=x.useState(0),[i,o]=x.useState(null),[a,l]=x.useState([]),[u,d]=x.useState(null),f=x.useRef(null),h=x.useRef(null),p=x.useRef(null),m=x.useRef(null),y=x.useRef(null),b=x.useRef([]),g=x.useRef(null),v=x.useRef(0),w=x.useRef(e),C=x.useRef(r),I=x.useRef(i),k=x.useRef(a);x.useEffect(()=>{w.current=e,C.current=r,I.current=i,k.current=a},[e,r,i,a]);const D=async N=>{if(e){console.warn("[RecordingContext] Cannot start recording - another recording is already in progress for task:",i);return}try{const A=await navigator.mediaDevices.getUserMedia({audio:!0});y.current=A;const O=new(window.AudioContext||window.webkitAudioContext);h.current=O;const L=O.createAnalyser();L.fftSize=2048,p.current=L;const V=O.createMediaStreamSource(A);V.connect(L),m.current=V;const E=MediaRecorder.isTypeSupported("audio/mp4")?"audio/mp4":"audio/webm",j=new MediaRecorder(A,{mimeType:E,audioBitsPerSecond:32e3});f.current=j,b.current=[];const H=`rec_${Date.now()}_${crypto.randomUUID()}`;d(H),j.ondataavailable=W=>{W.data.size>0&&b.current.push(W.data)},j.onstop=async()=>{const W=new Blob(b.current,{type:E}),R=E.split("/")[1],ae=new Date,$=`Recording ${`${ae.getFullYear()}.${String(ae.getMonth()+1).padStart(2,"0")}.${String(ae.getDate()).padStart(2,"0")} ${String(ae.getHours()).padStart(2,"0")}:${String(ae.getMinutes()).padStart(2,"0")}`}.${R}`,z=new File([W],$,{type:E});y.current&&y.current.getTracks().forEach(Be=>Be.stop()),h.current&&h.current.state!=="closed"&&h.current.close();const le=I.current,$e=k.current;le?(console.log(`[RecordingContext] Saving recording for Task ${le}`,z,$e),window.dispatchEvent(new CustomEvent("audio-recording-completed",{detail:{file:z,taskId:le,markers:$e,duration:C.current,recordingId:H}}))):console.warn("Recording stopped but no Task ID associated."),n(!1),o(null),l([]),s(0),d(null)},j.start(100),n(!0),o(N||null),s(0),l([]),v.current=Date.now(),g.current=setInterval(()=>{const W=Date.now()-v.current;s(W)},100)}catch(A){console.error("[RecordingContext] Failed to start recording",A)}},S=()=>{f.current&&f.current.state!=="inactive"&&f.current.stop(),g.current&&(clearInterval(g.current),g.current=null)},T=()=>{f.current&&f.current.state!=="inactive"&&(f.current.onstop=null,f.current.stop()),g.current&&(clearInterval(g.current),g.current=null),y.current&&y.current.getTracks().forEach(N=>N.stop()),h.current&&h.current.state!=="closed"&&h.current.close(),n(!1),o(null),l([]),s(0)},_=()=>{if(!e)return null;const N=r,O={id:`rec-marker-${Date.now()}`,time:N};return l(L=>[...L,O]),O};return c.jsx(Lu.Provider,{value:{isRecording:e,recordingTime:r,startRecording:D,stopRecording:S,cancelRecording:T,addMarker:_,recordingTaskId:i,audioMarkers:a,currentRecordingId:u,analyser:p.current,audioContext:h.current},children:t})},NI=x.createContext({reminders:[],addReminder:()=>{},markAsSeen:()=>{},snoozeReminder:()=>{},clearAllSeen:()=>{},clearAllUnseen:()=>{},clearAll:()=>{},unseenCount:0,isReminderPanelOpen:!1,setIsReminderPanelOpen:()=>{}}),h2="app_reminders",p2="app_reminder_signatures",ez=1e4,tz=({children:t})=>{const{tasks:e,setToast:n,user:r}=x.useContext(En),[s,i]=x.useState([]),[o,a]=x.useState(!1),[l,u]=x.useState({}),[d,f]=x.useState(!1),h=x.useRef(null),p=x.useRef(!1),m=x.useRef(null),y=x.useRef([]),b=x.useRef({}),g=x.useRef([]),v=x.useRef(!1);x.useEffect(()=>{y.current=s},[s]),x.useEffect(()=>{b.current=l},[l]),x.useEffect(()=>{g.current=e},[e]),x.useEffect(()=>{v.current=d},[d]),x.useEffect(()=>{(async()=>{const N=(r==null?void 0:r.id)||null;if(!(m.current===N&&p.current)){if(!N){i([]),u({}),f(!1),m.current=null,p.current=!0;return}if(m.current=N,xe)try{const{data:A,error:O}=await xe.from("reminders").select("*").eq("user_id",N).order("triggered_at",{ascending:!1});if(!O&&A){f(!0);const L=A.map(E=>({id:E.id,task_id:E.task_id,task_title:E.task_title,task_color:E.task_color||"gray",triggered_at:E.triggered_at,due_time:E.due_time,seen:E.seen||!1,snoozed_until:E.snoozed_until||null}));i(L);const{data:V}=await xe.from("reminder_signatures").select("*").eq("user_id",N);if(V){const E={};V.forEach(j=>{E[j.task_id]=j.signature}),u(E),b.current=E}console.log("[Reminder] Loaded from Supabase:",L.length),p.current=!0;return}}catch(A){console.warn("[Reminder] Supabase load failed, falling back to local:",A)}f(!1);try{const A=localStorage.getItem(h2);A&&i(JSON.parse(A));const O=localStorage.getItem(p2);if(O){const L=JSON.parse(O);u(L),b.current=L}}catch(A){console.error(A)}p.current=!0}})()},[r==null?void 0:r.id]),x.useEffect(()=>{if(!(r!=null&&r.id)||!xe)return;if(!d){console.log("[Reminder] Sync disabled, skipping subscription");return}console.log("[Reminder] Subscribing to realtime channels...");const _=xe.channel("reminders-sync",{config:{broadcast:{self:!1}}}).on("postgres_changes",{event:"*",schema:"public",table:"reminders",filter:`user_id=eq.${r.id}`},A=>{if(A.eventType==="INSERT"){const O=A.new;i(L=>L.some(V=>V.id===O.id)?L:[{id:O.id,task_id:O.task_id,task_title:O.task_title,task_color:O.task_color||"gray",triggered_at:O.triggered_at,due_time:O.due_time,seen:O.seen||!1,snoozed_until:O.snoozed_until||null},...L])}else if(A.eventType==="UPDATE"){const O=A.new;i(L=>L.map(V=>V.id===O.id?{...V,seen:O.seen||!1,snoozed_until:O.snoozed_until||null}:V))}else if(A.eventType==="DELETE"){const O=A.old;i(L=>L.filter(V=>V.id!==O.id))}}).on("broadcast",{event:"clear-action"},A=>{A.payload.type==="clearSeen"?i(O=>O.filter(L=>!L.seen)):A.payload.type==="clearUnseen"?i(O=>O.filter(L=>L.seen)):A.payload.type==="clearAll"&&i([])}).subscribe(A=>{A==="SUBSCRIBED"&&console.log("[Reminder] Reminders channel subscribed")}),N=xe.channel("signatures-sync").on("postgres_changes",{event:"INSERT",schema:"public",table:"reminder_signatures",filter:`user_id=eq.${r.id}`},A=>{const O=A.new;u(L=>L[O.task_id]===O.signature?L:{...L,[O.task_id]:O.signature})}).subscribe(A=>{A==="SUBSCRIBED"&&console.log("[Reminder] Signatures channel subscribed")});return()=>{console.log("[Reminder] Unsubscribing..."),xe.removeChannel(_),xe.removeChannel(N)}},[r==null?void 0:r.id,d]),x.useEffect(()=>{!p.current||d||localStorage.setItem(h2,JSON.stringify(s))},[s,d]),x.useEffect(()=>{!p.current||d||localStorage.setItem(p2,JSON.stringify(l))},[l,d]);const w=x.useCallback(async(_,N,A=!0)=>{const O=g.current.find(V=>V.id===_);if(!O)return;const L=O.start_date||O.due_date;if(L){if(v.current&&xe&&(r!=null&&r.id)){const{error:V}=await xe.from("reminder_signatures").insert([{user_id:r.id,task_id:_,signature:N}]);if(V){const{data:j}=await xe.from("reminder_signatures").select("signature").eq("user_id",r.id).eq("task_id",_).single();if(j&&j.signature===N){u(H=>({...H,[_]:N}));return}j&&await xe.from("reminder_signatures").update({signature:N}).eq("user_id",r.id).eq("task_id",_)}const E=(await yv(()=>import("./index-c620dda6.js"),[])).v4();await xe.from("reminders").insert([{id:E,user_id:r.id,task_id:_,task_title:O.title,task_color:O.color,triggered_at:new Date().toISOString(),due_time:L,seen:!1}]),u(j=>({...j,[_]:N}))}else{const V={id:`${_}_${Date.now()}`,task_id:_,task_title:O.title,task_color:O.color,triggered_at:new Date().toISOString(),due_time:L,seen:!1,snoozed_until:null};i(E=>[V,...E]),u(E=>({...E,[_]:N})),A&&(n({type:"info",msg:` : ${O.title}`,actionLabel:"",onClick:()=>a(!0)}),"Notification"in window&&Notification.permission==="granted"&&(new Notification("",{body:O.title,icon:"/favicon.ico"}).onclick=()=>{window.focus(),a(!0)}),a(!0))}v.current&&A&&(n({type:"info",msg:` : ${O.title}`,actionLabel:"",onClick:()=>a(!0)}),"Notification"in window&&Notification.permission==="granted"&&(new Notification("",{body:O.title,icon:"/favicon.ico"}).onclick=()=>{window.focus(),a(!0)}),a(!0))}},[n,r==null?void 0:r.id]),C=x.useCallback(async _=>{i(N=>N.map(A=>A.id===_?{...A,seen:!0}:A)),v.current&&xe&&await xe.from("reminders").update({seen:!0}).eq("id",_)},[]),I=x.useCallback(async(_,N)=>{const A=new Date(Date.now()+N*60*1e3).toISOString();i(O=>O.map(L=>L.id===_?{...L,snoozed_until:A,seen:!0}:L)),n({type:"info",msg:`  ${N} `}),v.current&&xe&&await xe.from("reminders").update({snoozed_until:A,seen:!0}).eq("id",_)},[n]),k=x.useCallback(async()=>{const N=y.current.filter(A=>A.seen).map(A=>A.id);i(A=>A.filter(O=>!O.seen)),v.current&&xe&&N.length>0&&(await xe.channel("reminders-sync").send({type:"broadcast",event:"clear-action",payload:{type:"clearSeen"}}),await xe.from("reminders").delete().in("id",N))},[]),D=x.useCallback(async()=>{const N=y.current.filter(A=>!A.seen).map(A=>A.id);i(A=>A.filter(O=>O.seen)),v.current&&xe&&N.length>0&&(await xe.channel("reminders-sync").send({type:"broadcast",event:"clear-action",payload:{type:"clearUnseen"}}),await xe.from("reminders").delete().in("id",N))},[]),S=x.useCallback(async()=>{i([]),v.current&&xe&&(r!=null&&r.id)&&(await xe.channel("reminders-sync").send({type:"broadcast",event:"clear-action",payload:{type:"clearAll"}}),await xe.from("reminders").delete().eq("user_id",r.id))},[r==null?void 0:r.id]),T=x.useCallback(()=>{if(!p.current)return;const _=new Date,N=g.current,A=b.current;N.forEach(O=>{if(["completed","deleted","canceled"].includes(O.status))return;const L=O.start_date||O.due_date;if(!L)return;let V;if(O.is_all_day||!O.start_time)V=new Date(L),L.includes("T")||V.setHours(0,0,0,0);else{const[W,R]=(O.start_time||"00:00").split(":").map(Number),ae=L.split("T")[0];V=new Date(ae),V.setHours(W,R,0,0)}let E=O.reminder_minutes;if(E===void 0)try{const W=localStorage.getItem(`task_reminder_${O.id}`);W&&(E=JSON.parse(W))}catch{}if(E===void 0&&!O.is_all_day&&O.start_time&&(E=0),E==null)return;const j=new Date(V.getTime()-E*60*1e3),H=`${V.getTime()}_${E}`;A[O.id]!==H&&_>=j&&w(O.id,H,!0)}),y.current.forEach(async O=>{if(O.snoozed_until){const L=new Date(O.snoozed_until);_>=L&&(N.find(E=>E.id===O.task_id)&&(n({type:"info",msg:` : ${O.task_title}`,actionLabel:"",onClick:()=>a(!0)}),"Notification"in window&&Notification.permission==="granted"&&(new Notification("",{body:O.task_title}).onclick=()=>{window.focus(),a(!0)}),a(!0)),i(E=>E.map(j=>j.id===O.id?{...j,snoozed_until:null,seen:!1}:j)),v.current&&xe&&await xe.from("reminders").update({snoozed_until:null,seen:!1}).eq("id",O.id))}})},[w,n]);return x.useEffect(()=>{const _=setTimeout(T,2e3);return h.current=setInterval(T,ez),()=>{clearTimeout(_),h.current&&clearInterval(h.current)}},[T]),c.jsx(NI.Provider,{value:{reminders:s,addReminder:w,markAsSeen:C,snoozeReminder:I,clearAllSeen:k,clearAllUnseen:D,clearAll:S,unseenCount:s.filter(_=>!_.seen).length,isReminderPanelOpen:o,setIsReminderPanelOpen:a},children:t})};var nz={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const rz=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),sz=(t,e)=>{const n=x.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:a,...l},u)=>x.createElement("svg",{ref:u,...nz,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:`lucide lucide-${rz(t)}`,...l},[...e.map(([d,f])=>x.createElement(d,f)),...(Array.isArray(a)?a:[a])||[]]));return n.displayName=`${t}`,n};var wt=sz;const Zf=wt("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),iz=wt("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),um=wt("Archive",[["rect",{width:"20",height:"5",x:"2",y:"4",rx:"2",key:"uhwcea"}],["path",{d:"M4 9v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9",key:"shkvi4"}],["path",{d:"M10 13h4",key:"ytezjc"}]]),jI=wt("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Dv=wt("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),oz=wt("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),az=wt("AtSign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),i1=wt("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Wa=wt("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),lz=wt("Bold",[["path",{d:"M14 12a4 4 0 0 0 0-8H6v8",key:"v2sylx"}],["path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z",key:"1ef5ya"}]]),kf=wt("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]),II=wt("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}]]),cz=wt("Bot",[["rect",{width:"18",height:"10",x:"3",y:"11",rx:"2",key:"1ofdy3"}],["circle",{cx:"12",cy:"5",r:"2",key:"f1ur92"}],["path",{d:"M12 7v4",key:"xawao1"}],["line",{x1:"8",x2:"8",y1:"16",y2:"16",key:"h6x27f"}],["line",{x1:"16",x2:"16",y1:"16",y2:"16",key:"5lty7f"}]]),md=wt("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),uz=wt("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]),MI=wt("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]),vo=wt("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),au=wt("CheckCircle2",[["path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",key:"14v8dr"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),dz=wt("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),Xn=wt("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),ts=wt("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),$u=wt("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),rs=wt("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),vp=wt("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),fz=wt("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Ri=wt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),hz=wt("CloudLightning",[["path",{d:"M6 16.326A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 .5 8.973",key:"1cez44"}],["path",{d:"m13 12-3 5h4l-3 5",key:"1t22er"}]]),pz=wt("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),mz=wt("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]),gz=wt("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]),DI=wt("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),yz=wt("CornerDownRight",[["polyline",{points:"15 10 20 15 15 20",key:"1q7qjw"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),AI=wt("CornerUpLeft",[["polyline",{points:"9 14 4 9 9 4",key:"881910"}],["path",{d:"M20 20v-7a4 4 0 0 0-4-4H4",key:"1nkjon"}]]),xz=wt("Crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]),lu=wt("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),RI=wt("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),bz=wt("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),eh=wt("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),vz=wt("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),wz=wt("FolderKanban",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]]),kz=wt("FolderOpen",[["path",{d:"m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.93a2 2 0 0 1 1.66.9l.82 1.2a2 2 0 0 0 1.66.9H18a2 2 0 0 1 2 2v2",key:"1nmvlm"}]]),Sz=wt("FolderPlus",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["line",{x1:"12",x2:"12",y1:"10",y2:"16",key:"3c25pp"}],["line",{x1:"9",x2:"15",y1:"13",y2:"13",key:"10hoct"}]]),_z=wt("FolderTree",[["path",{d:"M13 10h7a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"10jzg2"}],["path",{d:"M13 21h7a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.88a1 1 0 0 1-.9-.55l-.44-.9a1 1 0 0 0-.9-.55H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"1b9nqm"}],["path",{d:"M3 3v2c0 1.1.9 2 2 2h3",key:"1wqwis"}],["path",{d:"M3 3v13c0 1.1.9 2 2 2h3",key:"1bqeom"}]]),Tz=wt("GanttChartSquare",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 8h7",key:"kbo1nt"}],["path",{d:"M8 12h6",key:"ikassy"}],["path",{d:"M11 16h5",key:"oq65wt"}]]),OI=wt("GripHorizontal",[["circle",{cx:"12",cy:"9",r:"1",key:"124mty"}],["circle",{cx:"19",cy:"9",r:"1",key:"1ruzo2"}],["circle",{cx:"5",cy:"9",r:"1",key:"1a8b28"}],["circle",{cx:"12",cy:"15",r:"1",key:"1e56xg"}],["circle",{cx:"19",cy:"15",r:"1",key:"1a92ep"}],["circle",{cx:"5",cy:"15",r:"1",key:"5r1jwy"}]]),PI=wt("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),Cz=wt("Hammer",[["path",{d:"m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9",key:"1afvon"}],["path",{d:"M17.64 15 22 10.64",key:"zsji6s"}],["path",{d:"m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25v-.86L16.01 4.6a5.56 5.56 0 0 0-3.94-1.64H9l.92.82A6.18 6.18 0 0 1 12 8.4v1.56l2 2h2.47l2.26 1.91",key:"lehyy1"}]]),Ez=wt("Heading1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]),Nz=wt("Heading2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]),cu=wt("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),jz=wt("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),Iz=wt("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),Sf=wt("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),o1=wt("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]),LI=wt("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Mz=wt("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]),$I=wt("Layers",[["polygon",{points:"12 2 2 7 12 12 22 7 12 2",key:"1b0ttc"}],["polyline",{points:"2 17 12 22 22 17",key:"imjtdl"}],["polyline",{points:"2 12 12 17 22 12",key:"5dexcv"}]]),zI=wt("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),a1=wt("Layout",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"3",x2:"21",y1:"9",y2:"9",key:"1vqk6q"}],["line",{x1:"9",x2:"9",y1:"21",y2:"9",key:"wpwpyp"}]]),Dz=wt("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),m2=wt("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),Az=wt("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]),Rz=wt("ListTodo",[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]),FI=wt("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),yi=wt("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Oz=wt("LocateFixed",[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),La=wt("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Pz=wt("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Lz=wt("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),$z=wt("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),BI=wt("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),zz=wt("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),Fz=wt("MoveRight",[["path",{d:"M18 8L22 12L18 16",key:"1r0oui"}],["path",{d:"M2 12H22",key:"1m8cig"}]]),Av=wt("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),Bz=wt("PanelLeftClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]]),Uz=wt("PanelLeftOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]]),ho=wt("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),UI=wt("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),Rv=wt("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),Rg=wt("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),HI=wt("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),ni=wt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Ov=wt("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]),l1=wt("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),VI=wt("Repeat2",[["path",{d:"m2 9 3-3 3 3",key:"1ltn5i"}],["path",{d:"M13 18H7a2 2 0 0 1-2-2V6",key:"1r6tfw"}],["path",{d:"m22 15-3 3-3-3",key:"4rnwn2"}],["path",{d:"M11 6h6a2 2 0 0 1 2 2v10",key:"2f72bc"}]]),Hz=wt("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]),WI=wt("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Vz=wt("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),KI=wt("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Wc=wt("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Wz=wt("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Kz=wt("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),GI=wt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Gz=wt("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),qz=wt("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]),Ds=wt("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),Yz=wt("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),qI=wt("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Bl=wt("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),YI=wt("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Er=wt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Jz=wt("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),Og=wt("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]),c1=wt("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),Xz=wt("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),JI=wt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Qz=wt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),u1=wt("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),Zz=wt("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]),d1=wt("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),eF=wt("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),un=wt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function f1(t,e){x.useEffect(()=>{const n=r=>{!t.current||t.current.contains(r.target)||e(r)};return document.addEventListener("mousedown",n),document.addEventListener("touchstart",n),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)}},[t,e])}const _f=x.createContext({});function Pv(t){const e=x.useRef(null);return e.current===null&&(e.current=t()),e.current}const Lv=typeof window<"u",$v=Lv?x.useLayoutEffect:x.useEffect,Pg=x.createContext(null);function zv(t,e){t.indexOf(e)===-1&&t.push(e)}function Fv(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const Jo=(t,e,n)=>n>e?e:n<t?t:n;let Bv=()=>{};const Xo={},XI=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function QI(t){return typeof t=="object"&&t!==null}const ZI=t=>/^0[^.\s]+$/u.test(t);function Uv(t){let e;return()=>(e===void 0&&(e=t()),e)}const Ei=t=>t,tF=(t,e)=>n=>e(t(n)),th=(...t)=>t.reduce(tF),Tf=(t,e,n)=>{const r=e-t;return r===0?1:(n-t)/r};class Hv{constructor(){this.subscriptions=[]}add(e){return zv(this.subscriptions,e),()=>Fv(this.subscriptions,e)}notify(e,n,r){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](e,n,r);else for(let i=0;i<s;i++){const o=this.subscriptions[i];o&&o(e,n,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const yo=t=>t*1e3,Ti=t=>t/1e3;function eM(t,e){return e?t*(1e3/e):0}const tM=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,nF=1e-7,rF=12;function sF(t,e,n,r,s){let i,o,a=0;do o=e+(n-e)/2,i=tM(o,r,s)-t,i>0?n=o:e=o;while(Math.abs(i)>nF&&++a<rF);return o}function nh(t,e,n,r){if(t===e&&n===r)return Ei;const s=i=>sF(i,0,1,t,n);return i=>i===0||i===1?i:tM(s(i),e,r)}const nM=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,rM=t=>e=>1-t(1-e),sM=nh(.33,1.53,.69,.99),Vv=rM(sM),iM=nM(Vv),oM=t=>(t*=2)<1?.5*Vv(t):.5*(2-Math.pow(2,-10*(t-1))),Wv=t=>1-Math.sin(Math.acos(t)),aM=rM(Wv),lM=nM(Wv),iF=nh(.42,0,1,1),oF=nh(0,0,.58,1),cM=nh(.42,0,.58,1),aF=t=>Array.isArray(t)&&typeof t[0]!="number",uM=t=>Array.isArray(t)&&typeof t[0]=="number",lF={linear:Ei,easeIn:iF,easeInOut:cM,easeOut:oF,circIn:Wv,circInOut:lM,circOut:aM,backIn:Vv,backInOut:iM,backOut:sM,anticipate:oM},cF=t=>typeof t=="string",g2=t=>{if(uM(t)){Bv(t.length===4);const[e,n,r,s]=t;return nh(e,n,r,s)}else if(cF(t))return lF[t];return t},Oh=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],y2={value:null,addProjectionMetrics:null};function uF(t,e){let n=new Set,r=new Set,s=!1,i=!1;const o=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1},l=0;function u(f){o.has(f)&&(d.schedule(f),t()),l++,f(a)}const d={schedule:(f,h=!1,p=!1)=>{const y=p&&s?n:r;return h&&o.add(f),y.has(f)||y.add(f),f},cancel:f=>{r.delete(f),o.delete(f)},process:f=>{if(a=f,s){i=!0;return}s=!0,[n,r]=[r,n],n.forEach(u),e&&y2.value&&y2.value.frameloop[e].push(l),l=0,n.clear(),s=!1,i&&(i=!1,d.process(f))}};return d}const dF=40;function dM(t,e){let n=!1,r=!0;const s={delta:0,timestamp:0,isProcessing:!1},i=()=>n=!0,o=Oh.reduce((w,C)=>(w[C]=uF(i,e?C:void 0),w),{}),{setup:a,read:l,resolveKeyframes:u,preUpdate:d,update:f,preRender:h,render:p,postRender:m}=o,y=()=>{const w=Xo.useManualTiming?s.timestamp:performance.now();n=!1,Xo.useManualTiming||(s.delta=r?1e3/60:Math.max(Math.min(w-s.timestamp,dF),1)),s.timestamp=w,s.isProcessing=!0,a.process(s),l.process(s),u.process(s),d.process(s),f.process(s),h.process(s),p.process(s),m.process(s),s.isProcessing=!1,n&&e&&(r=!1,t(y))},b=()=>{n=!0,r=!0,s.isProcessing||t(y)};return{schedule:Oh.reduce((w,C)=>{const I=o[C];return w[C]=(k,D=!1,S=!1)=>(n||b(),I.schedule(k,D,S)),w},{}),cancel:w=>{for(let C=0;C<Oh.length;C++)o[Oh[C]].cancel(w)},state:s,steps:o}}const{schedule:Zn,cancel:Ka,state:Xr,steps:q0}=dM(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ei,!0);let wp;function fF(){wp=void 0}const $s={now:()=>(wp===void 0&&$s.set(Xr.isProcessing||Xo.useManualTiming?Xr.timestamp:performance.now()),wp),set:t=>{wp=t,queueMicrotask(fF)}},fM=t=>e=>typeof e=="string"&&e.startsWith(t),hM=fM("--"),hF=fM("var(--"),Kv=t=>hF(t)?pF.test(t.split("/*")[0].trim()):!1,pF=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,zu={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},Cf={...zu,transform:t=>Jo(0,1,t)},Ph={...zu,default:1},Ad=t=>Math.round(t*1e5)/1e5,Gv=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function mF(t){return t==null}const gF=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,qv=(t,e)=>n=>!!(typeof n=="string"&&gF.test(n)&&n.startsWith(t)||e&&!mF(n)&&Object.prototype.hasOwnProperty.call(n,e)),pM=(t,e,n)=>r=>{if(typeof r!="string")return r;const[s,i,o,a]=r.match(Gv);return{[t]:parseFloat(s),[e]:parseFloat(i),[n]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},yF=t=>Jo(0,255,t),Y0={...zu,transform:t=>Math.round(yF(t))},Ml={test:qv("rgb","red"),parse:pM("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:r=1})=>"rgba("+Y0.transform(t)+", "+Y0.transform(e)+", "+Y0.transform(n)+", "+Ad(Cf.transform(r))+")"};function xF(t){let e="",n="",r="",s="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),r=t.substring(5,7),s=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),r=t.substring(3,4),s=t.substring(4,5),e+=e,n+=n,r+=r,s+=s),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:s?parseInt(s,16)/255:1}}const h1={test:qv("#"),parse:xF,transform:Ml.transform},rh=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),ua=rh("deg"),xo=rh("%"),ln=rh("px"),bF=rh("vh"),vF=rh("vw"),x2=(()=>({...xo,parse:t=>xo.parse(t)/100,transform:t=>xo.transform(t*100)}))(),Kc={test:qv("hsl","hue"),parse:pM("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:r=1})=>"hsla("+Math.round(t)+", "+xo.transform(Ad(e))+", "+xo.transform(Ad(n))+", "+Ad(Cf.transform(r))+")"},Tr={test:t=>Ml.test(t)||h1.test(t)||Kc.test(t),parse:t=>Ml.test(t)?Ml.parse(t):Kc.test(t)?Kc.parse(t):h1.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?Ml.transform(t):Kc.transform(t),getAnimatableNone:t=>{const e=Tr.parse(t);return e.alpha=0,Tr.transform(e)}},wF=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function kF(t){var e,n;return isNaN(t)&&typeof t=="string"&&(((e=t.match(Gv))==null?void 0:e.length)||0)+(((n=t.match(wF))==null?void 0:n.length)||0)>0}const mM="number",gM="color",SF="var",_F="var(",b2="${}",TF=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Ef(t){const e=t.toString(),n=[],r={color:[],number:[],var:[]},s=[];let i=0;const a=e.replace(TF,l=>(Tr.test(l)?(r.color.push(i),s.push(gM),n.push(Tr.parse(l))):l.startsWith(_F)?(r.var.push(i),s.push(SF),n.push(l)):(r.number.push(i),s.push(mM),n.push(parseFloat(l))),++i,b2)).split(b2);return{values:n,split:a,indexes:r,types:s}}function yM(t){return Ef(t).values}function xM(t){const{split:e,types:n}=Ef(t),r=e.length;return s=>{let i="";for(let o=0;o<r;o++)if(i+=e[o],s[o]!==void 0){const a=n[o];a===mM?i+=Ad(s[o]):a===gM?i+=Tr.transform(s[o]):i+=s[o]}return i}}const CF=t=>typeof t=="number"?0:Tr.test(t)?Tr.getAnimatableNone(t):t;function EF(t){const e=yM(t);return xM(t)(e.map(CF))}const Ga={test:kF,parse:yM,createTransformer:xM,getAnimatableNone:EF};function J0(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function NF({hue:t,saturation:e,lightness:n,alpha:r}){t/=360,e/=100,n/=100;let s=0,i=0,o=0;if(!e)s=i=o=n;else{const a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;s=J0(l,a,t+1/3),i=J0(l,a,t),o=J0(l,a,t-1/3)}return{red:Math.round(s*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:r}}function dm(t,e){return n=>n>0?e:t}const ur=(t,e,n)=>t+(e-t)*n,X0=(t,e,n)=>{const r=t*t,s=n*(e*e-r)+r;return s<0?0:Math.sqrt(s)},jF=[h1,Ml,Kc],IF=t=>jF.find(e=>e.test(t));function v2(t){const e=IF(t);if(!e)return!1;let n=e.parse(t);return e===Kc&&(n=NF(n)),n}const w2=(t,e)=>{const n=v2(t),r=v2(e);if(!n||!r)return dm(t,e);const s={...n};return i=>(s.red=X0(n.red,r.red,i),s.green=X0(n.green,r.green,i),s.blue=X0(n.blue,r.blue,i),s.alpha=ur(n.alpha,r.alpha,i),Ml.transform(s))},p1=new Set(["none","hidden"]);function MF(t,e){return p1.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function DF(t,e){return n=>ur(t,e,n)}function Yv(t){return typeof t=="number"?DF:typeof t=="string"?Kv(t)?dm:Tr.test(t)?w2:OF:Array.isArray(t)?bM:typeof t=="object"?Tr.test(t)?w2:AF:dm}function bM(t,e){const n=[...t],r=n.length,s=t.map((i,o)=>Yv(i)(i,e[o]));return i=>{for(let o=0;o<r;o++)n[o]=s[o](i);return n}}function AF(t,e){const n={...t,...e},r={};for(const s in n)t[s]!==void 0&&e[s]!==void 0&&(r[s]=Yv(t[s])(t[s],e[s]));return s=>{for(const i in r)n[i]=r[i](s);return n}}function RF(t,e){const n=[],r={color:0,var:0,number:0};for(let s=0;s<e.values.length;s++){const i=e.types[s],o=t.indexes[i][r[i]],a=t.values[o]??0;n[s]=a,r[i]++}return n}const OF=(t,e)=>{const n=Ga.createTransformer(e),r=Ef(t),s=Ef(e);return r.indexes.var.length===s.indexes.var.length&&r.indexes.color.length===s.indexes.color.length&&r.indexes.number.length>=s.indexes.number.length?p1.has(t)&&!s.values.length||p1.has(e)&&!r.values.length?MF(t,e):th(bM(RF(r,s),s.values),n):dm(t,e)};function vM(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?ur(t,e,n):Yv(t)(t,e)}const PF=t=>{const e=({timestamp:n})=>t(n);return{start:(n=!0)=>Zn.update(e,n),stop:()=>Ka(e),now:()=>Xr.isProcessing?Xr.timestamp:$s.now()}},wM=(t,e,n=10)=>{let r="";const s=Math.max(Math.round(e/n),2);for(let i=0;i<s;i++)r+=Math.round(t(i/(s-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},fm=2e4;function Jv(t){let e=0;const n=50;let r=t.next(e);for(;!r.done&&e<fm;)e+=n,r=t.next(e);return e>=fm?1/0:e}function LF(t,e=100,n){const r=n({...t,keyframes:[0,e]}),s=Math.min(Jv(r),fm);return{type:"keyframes",ease:i=>r.next(s*i).value/e,duration:Ti(s)}}const $F=5;function kM(t,e,n){const r=Math.max(e-$F,0);return eM(n-t(r),e-r)}const mr={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Q0=.001;function zF({duration:t=mr.duration,bounce:e=mr.bounce,velocity:n=mr.velocity,mass:r=mr.mass}){let s,i,o=1-e;o=Jo(mr.minDamping,mr.maxDamping,o),t=Jo(mr.minDuration,mr.maxDuration,Ti(t)),o<1?(s=u=>{const d=u*o,f=d*t,h=d-n,p=m1(u,o),m=Math.exp(-f);return Q0-h/p*m},i=u=>{const f=u*o*t,h=f*n+n,p=Math.pow(o,2)*Math.pow(u,2)*t,m=Math.exp(-f),y=m1(Math.pow(u,2),o);return(-s(u)+Q0>0?-1:1)*((h-p)*m)/y}):(s=u=>{const d=Math.exp(-u*t),f=(u-n)*t+1;return-Q0+d*f},i=u=>{const d=Math.exp(-u*t),f=(n-u)*(t*t);return d*f});const a=5/t,l=BF(s,i,a);if(t=yo(t),isNaN(l))return{stiffness:mr.stiffness,damping:mr.damping,duration:t};{const u=Math.pow(l,2)*r;return{stiffness:u,damping:o*2*Math.sqrt(r*u),duration:t}}}const FF=12;function BF(t,e,n){let r=n;for(let s=1;s<FF;s++)r=r-t(r)/e(r);return r}function m1(t,e){return t*Math.sqrt(1-e*e)}const UF=["duration","bounce"],HF=["stiffness","damping","mass"];function k2(t,e){return e.some(n=>t[n]!==void 0)}function VF(t){let e={velocity:mr.velocity,stiffness:mr.stiffness,damping:mr.damping,mass:mr.mass,isResolvedFromDuration:!1,...t};if(!k2(t,HF)&&k2(t,UF))if(t.visualDuration){const n=t.visualDuration,r=2*Math.PI/(n*1.2),s=r*r,i=2*Jo(.05,1,1-(t.bounce||0))*Math.sqrt(s);e={...e,mass:mr.mass,stiffness:s,damping:i}}else{const n=zF(t);e={...e,...n,mass:mr.mass},e.isResolvedFromDuration=!0}return e}function hm(t=mr.visualDuration,e=mr.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:r,restDelta:s}=n;const i=n.keyframes[0],o=n.keyframes[n.keyframes.length-1],a={done:!1,value:i},{stiffness:l,damping:u,mass:d,duration:f,velocity:h,isResolvedFromDuration:p}=VF({...n,velocity:-Ti(n.velocity||0)}),m=h||0,y=u/(2*Math.sqrt(l*d)),b=o-i,g=Ti(Math.sqrt(l/d)),v=Math.abs(b)<5;r||(r=v?mr.restSpeed.granular:mr.restSpeed.default),s||(s=v?mr.restDelta.granular:mr.restDelta.default);let w;if(y<1){const I=m1(g,y);w=k=>{const D=Math.exp(-y*g*k);return o-D*((m+y*g*b)/I*Math.sin(I*k)+b*Math.cos(I*k))}}else if(y===1)w=I=>o-Math.exp(-g*I)*(b+(m+g*b)*I);else{const I=g*Math.sqrt(y*y-1);w=k=>{const D=Math.exp(-y*g*k),S=Math.min(I*k,300);return o-D*((m+y*g*b)*Math.sinh(S)+I*b*Math.cosh(S))/I}}const C={calculatedDuration:p&&f||null,next:I=>{const k=w(I);if(p)a.done=I>=f;else{let D=I===0?m:0;y<1&&(D=I===0?yo(m):kM(w,I,k));const S=Math.abs(D)<=r,T=Math.abs(o-k)<=s;a.done=S&&T}return a.value=a.done?o:k,a},toString:()=>{const I=Math.min(Jv(C),fm),k=wM(D=>C.next(I*D).value,I,30);return I+"ms "+k},toTransition:()=>{}};return C}hm.applyToOptions=t=>{const e=LF(t,100,hm);return t.ease=e.ease,t.duration=yo(e.duration),t.type="keyframes",t};function g1({keyframes:t,velocity:e=0,power:n=.8,timeConstant:r=325,bounceDamping:s=10,bounceStiffness:i=500,modifyTarget:o,min:a,max:l,restDelta:u=.5,restSpeed:d}){const f=t[0],h={done:!1,value:f},p=S=>a!==void 0&&S<a||l!==void 0&&S>l,m=S=>a===void 0?l:l===void 0||Math.abs(a-S)<Math.abs(l-S)?a:l;let y=n*e;const b=f+y,g=o===void 0?b:o(b);g!==b&&(y=g-f);const v=S=>-y*Math.exp(-S/r),w=S=>g+v(S),C=S=>{const T=v(S),_=w(S);h.done=Math.abs(T)<=u,h.value=h.done?g:_};let I,k;const D=S=>{p(h.value)&&(I=S,k=hm({keyframes:[h.value,m(h.value)],velocity:kM(w,S,h.value),damping:s,stiffness:i,restDelta:u,restSpeed:d}))};return D(0),{calculatedDuration:null,next:S=>{let T=!1;return!k&&I===void 0&&(T=!0,C(S),D(S)),I!==void 0&&S>=I?k.next(S-I):(!T&&C(S),h)}}}function WF(t,e,n){const r=[],s=n||Xo.mix||vM,i=t.length-1;for(let o=0;o<i;o++){let a=s(t[o],t[o+1]);if(e){const l=Array.isArray(e)?e[o]||Ei:e;a=th(l,a)}r.push(a)}return r}function KF(t,e,{clamp:n=!0,ease:r,mixer:s}={}){const i=t.length;if(Bv(i===e.length),i===1)return()=>e[0];if(i===2&&e[0]===e[1])return()=>e[1];const o=t[0]===t[1];t[0]>t[i-1]&&(t=[...t].reverse(),e=[...e].reverse());const a=WF(e,r,s),l=a.length,u=d=>{if(o&&d<t[0])return e[0];let f=0;if(l>1)for(;f<t.length-2&&!(d<t[f+1]);f++);const h=Tf(t[f],t[f+1],d);return a[f](h)};return n?d=>u(Jo(t[0],t[i-1],d)):u}function GF(t,e){const n=t[t.length-1];for(let r=1;r<=e;r++){const s=Tf(0,e,r);t.push(ur(n,1,s))}}function qF(t){const e=[0];return GF(e,t.length-1),e}function YF(t,e){return t.map(n=>n*e)}function JF(t,e){return t.map(()=>e||cM).splice(0,t.length-1)}function Rd({duration:t=300,keyframes:e,times:n,ease:r="easeInOut"}){const s=aF(r)?r.map(g2):g2(r),i={done:!1,value:e[0]},o=YF(n&&n.length===e.length?n:qF(e),t),a=KF(o,e,{ease:Array.isArray(s)?s:JF(e,s)});return{calculatedDuration:t,next:l=>(i.value=a(l),i.done=l>=t,i)}}const XF=t=>t!==null;function Xv(t,{repeat:e,repeatType:n="loop"},r,s=1){const i=t.filter(XF),a=s<0||e&&n!=="loop"&&e%2===1?0:i.length-1;return!a||r===void 0?i[a]:r}const QF={decay:g1,inertia:g1,tween:Rd,keyframes:Rd,spring:hm};function SM(t){typeof t.type=="string"&&(t.type=QF[t.type])}class Qv{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,n){return this.finished.then(e,n)}}const ZF=t=>t/100;class Zv extends Qv{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var r,s;const{motionValue:n}=this.options;n&&n.updatedAt!==$s.now()&&this.tick($s.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(s=(r=this.options).onStop)==null||s.call(r))},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;SM(e);const{type:n=Rd,repeat:r=0,repeatDelay:s=0,repeatType:i,velocity:o=0}=e;let{keyframes:a}=e;const l=n||Rd;l!==Rd&&typeof a[0]!="number"&&(this.mixKeyframes=th(ZF,vM(a[0],a[1])),a=[0,100]);const u=l({...e,keyframes:a});i==="mirror"&&(this.mirroredGenerator=l({...e,keyframes:[...a].reverse(),velocity:-o})),u.calculatedDuration===null&&(u.calculatedDuration=Jv(u));const{calculatedDuration:d}=u;this.calculatedDuration=d,this.resolvedDuration=d+s,this.totalDuration=this.resolvedDuration*(r+1)-s,this.generator=u}updateTime(e){const n=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(e,n=!1){const{generator:r,totalDuration:s,mixKeyframes:i,mirroredGenerator:o,resolvedDuration:a,calculatedDuration:l}=this;if(this.startTime===null)return r.next(0);const{delay:u=0,keyframes:d,repeat:f,repeatType:h,repeatDelay:p,type:m,onUpdate:y,finalKeyframe:b}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-s/this.speed,this.startTime)),n?this.currentTime=e:this.updateTime(e);const g=this.currentTime-u*(this.playbackSpeed>=0?1:-1),v=this.playbackSpeed>=0?g<0:g>s;this.currentTime=Math.max(g,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=s);let w=this.currentTime,C=r;if(f){const S=Math.min(this.currentTime,s)/a;let T=Math.floor(S),_=S%1;!_&&S>=1&&(_=1),_===1&&T--,T=Math.min(T,f+1),!!(T%2)&&(h==="reverse"?(_=1-_,p&&(_-=p/a)):h==="mirror"&&(C=o)),w=Jo(0,1,_)*a}const I=v?{done:!1,value:d[0]}:C.next(w);i&&(I.value=i(I.value));let{done:k}=I;!v&&l!==null&&(k=this.playbackSpeed>=0?this.currentTime>=s:this.currentTime<=0);const D=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&k);return D&&m!==g1&&(I.value=Xv(d,this.options,b,this.speed)),y&&y(I.value),D&&this.finish(),I}then(e,n){return this.finished.then(e,n)}get duration(){return Ti(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Ti(e)}get time(){return Ti(this.currentTime)}set time(e){var n;e=yo(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),(n=this.driver)==null||n.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime($s.now());const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=Ti(this.currentTime))}play(){var s,i;if(this.isStopped)return;const{driver:e=PF,startTime:n}=this.options;this.driver||(this.driver=e(o=>this.tick(o))),(i=(s=this.options).onPlay)==null||i.call(s);const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=n??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime($s.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,n;this.notifyFinished(),this.teardown(),this.state="finished",(n=(e=this.options).onComplete)==null||n.call(e)}cancel(){var e,n;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(n=(e=this.options).onCancel)==null||n.call(e)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var n;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(n=this.driver)==null||n.stop(),e.observe(this)}}function eB(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const Dl=t=>t*180/Math.PI,y1=t=>{const e=Dl(Math.atan2(t[1],t[0]));return x1(e)},tB={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:y1,rotateZ:y1,skewX:t=>Dl(Math.atan(t[1])),skewY:t=>Dl(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},x1=t=>(t=t%360,t<0&&(t+=360),t),S2=y1,_2=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),T2=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),nB={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:_2,scaleY:T2,scale:t=>(_2(t)+T2(t))/2,rotateX:t=>x1(Dl(Math.atan2(t[6],t[5]))),rotateY:t=>x1(Dl(Math.atan2(-t[2],t[0]))),rotateZ:S2,rotate:S2,skewX:t=>Dl(Math.atan(t[4])),skewY:t=>Dl(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function b1(t){return t.includes("scale")?1:0}function v1(t,e){if(!t||t==="none")return b1(e);const n=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,s;if(n)r=nB,s=n;else{const a=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=tB,s=a}if(!s)return b1(e);const i=r[e],o=s[1].split(",").map(sB);return typeof i=="function"?i(o):o[i]}const rB=(t,e)=>{const{transform:n="none"}=getComputedStyle(t);return v1(n,e)};function sB(t){return parseFloat(t.trim())}const Fu=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Bu=(()=>new Set(Fu))(),C2=t=>t===zu||t===ln,iB=new Set(["x","y","z"]),oB=Fu.filter(t=>!iB.has(t));function aB(t){const e=[];return oB.forEach(n=>{const r=t.getValue(n);r!==void 0&&(e.push([n,r.get()]),r.set(n.startsWith("scale")?1:0))}),e}const Ul={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>v1(e,"x"),y:(t,{transform:e})=>v1(e,"y")};Ul.translateX=Ul.x;Ul.translateY=Ul.y;const Hl=new Set;let w1=!1,k1=!1,S1=!1;function _M(){if(k1){const t=Array.from(Hl).filter(r=>r.needsMeasurement),e=new Set(t.map(r=>r.element)),n=new Map;e.forEach(r=>{const s=aB(r);s.length&&(n.set(r,s),r.render())}),t.forEach(r=>r.measureInitialState()),e.forEach(r=>{r.render();const s=n.get(r);s&&s.forEach(([i,o])=>{var a;(a=r.getValue(i))==null||a.set(o)})}),t.forEach(r=>r.measureEndState()),t.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}k1=!1,w1=!1,Hl.forEach(t=>t.complete(S1)),Hl.clear()}function TM(){Hl.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(k1=!0)})}function lB(){S1=!0,TM(),_M(),S1=!1}class ew{constructor(e,n,r,s,i,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=r,this.motionValue=s,this.element=i,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(Hl.add(this),w1||(w1=!0,Zn.read(TM),Zn.resolveKeyframes(_M))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:r,motionValue:s}=this;if(e[0]===null){const i=s==null?void 0:s.get(),o=e[e.length-1];if(i!==void 0)e[0]=i;else if(r&&n){const a=r.readValue(n,o);a!=null&&(e[0]=a)}e[0]===void 0&&(e[0]=o),s&&i===void 0&&s.set(e[0])}eB(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Hl.delete(this)}cancel(){this.state==="scheduled"&&(Hl.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const cB=t=>t.startsWith("--");function uB(t,e,n){cB(e)?t.style.setProperty(e,n):t.style[e]=n}const dB=Uv(()=>window.ScrollTimeline!==void 0),fB={};function hB(t,e){const n=Uv(t);return()=>fB[e]??n()}const CM=hB(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),gd=([t,e,n,r])=>`cubic-bezier(${t}, ${e}, ${n}, ${r})`,E2={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:gd([0,.65,.55,1]),circOut:gd([.55,0,1,.45]),backIn:gd([.31,.01,.66,-.59]),backOut:gd([.33,1.53,.69,.99])};function EM(t,e){if(t)return typeof t=="function"?CM()?wM(t,e):"ease-out":uM(t)?gd(t):Array.isArray(t)?t.map(n=>EM(n,e)||E2.easeOut):E2[t]}function pB(t,e,n,{delay:r=0,duration:s=300,repeat:i=0,repeatType:o="loop",ease:a="easeOut",times:l}={},u=void 0){const d={[e]:n};l&&(d.offset=l);const f=EM(a,s);Array.isArray(f)&&(d.easing=f);const h={delay:r,duration:s,easing:Array.isArray(f)?"linear":f,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"};return u&&(h.pseudoElement=u),t.animate(d,h)}function NM(t){return typeof t=="function"&&"applyToOptions"in t}function mB({type:t,...e}){return NM(t)&&CM()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class gB extends Qv{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:n,name:r,keyframes:s,pseudoElement:i,allowFlatten:o=!1,finalKeyframe:a,onComplete:l}=e;this.isPseudoElement=!!i,this.allowFlatten=o,this.options=e,Bv(typeof e.type!="string");const u=mB(e);this.animation=pB(n,r,s,u,i),u.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!i){const d=Xv(s,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(d):uB(n,r,d),this.animation.cancel()}l==null||l(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,n;(n=(e=this.animation).finish)==null||n.call(e)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,n;this.isPseudoElement||(n=(e=this.animation).commitStyles)==null||n.call(e)}get duration(){var n,r;const e=((r=(n=this.animation.effect)==null?void 0:n.getComputedTiming)==null?void 0:r.call(n).duration)||0;return Ti(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Ti(e)}get time(){return Ti(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=yo(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:n}){var r;return this.allowFlatten&&((r=this.animation.effect)==null||r.updateTiming({easing:"linear"})),this.animation.onfinish=null,e&&dB()?(this.animation.timeline=e,Ei):n(this)}}const jM={anticipate:oM,backInOut:iM,circInOut:lM};function yB(t){return t in jM}function xB(t){typeof t.ease=="string"&&yB(t.ease)&&(t.ease=jM[t.ease])}const N2=10;class bB extends gB{constructor(e){xB(e),SM(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:n,onUpdate:r,onComplete:s,element:i,...o}=this.options;if(!n)return;if(e!==void 0){n.set(e);return}const a=new Zv({...o,autoplay:!1}),l=yo(this.finishedTime??this.time);n.setWithVelocity(a.sample(l-N2).value,a.sample(l).value,N2),a.stop()}}const j2=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Ga.test(t)||t==="0")&&!t.startsWith("url("));function vB(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function wB(t,e,n,r){const s=t[0];if(s===null)return!1;if(e==="display"||e==="visibility")return!0;const i=t[t.length-1],o=j2(s,e),a=j2(i,e);return!o||!a?!1:vB(t)||(n==="spring"||NM(n))&&r}function _1(t){t.duration=0,t.type="keyframes"}const kB=new Set(["opacity","clipPath","filter","transform"]),SB=Uv(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function _B(t){var d;const{motionValue:e,name:n,repeatDelay:r,repeatType:s,damping:i,type:o}=t;if(!(((d=e==null?void 0:e.owner)==null?void 0:d.current)instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:u}=e.owner.getProps();return SB()&&n&&kB.has(n)&&(n!=="transform"||!u)&&!l&&!r&&s!=="mirror"&&i!==0&&o!=="inertia"}const TB=40;class CB extends Qv{constructor({autoplay:e=!0,delay:n=0,type:r="keyframes",repeat:s=0,repeatDelay:i=0,repeatType:o="loop",keyframes:a,name:l,motionValue:u,element:d,...f}){var m;super(),this.stop=()=>{var y,b;this._animation&&(this._animation.stop(),(y=this.stopTimeline)==null||y.call(this)),(b=this.keyframeResolver)==null||b.cancel()},this.createdAt=$s.now();const h={autoplay:e,delay:n,type:r,repeat:s,repeatDelay:i,repeatType:o,name:l,motionValue:u,element:d,...f},p=(d==null?void 0:d.KeyframeResolver)||ew;this.keyframeResolver=new p(a,(y,b,g)=>this.onKeyframesResolved(y,b,h,!g),l,u,d),(m=this.keyframeResolver)==null||m.scheduleResolve()}onKeyframesResolved(e,n,r,s){this.keyframeResolver=void 0;const{name:i,type:o,velocity:a,delay:l,isHandoff:u,onUpdate:d}=r;this.resolvedAt=$s.now(),wB(e,i,o,a)||((Xo.instantAnimations||!l)&&(d==null||d(Xv(e,r,n))),e[0]=e[e.length-1],_1(r),r.repeat=0);const h={startTime:s?this.resolvedAt?this.resolvedAt-this.createdAt>TB?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...r,keyframes:e},p=!u&&_B(h)?new bB({...h,element:h.motionValue.owner.current}):new Zv(h);p.finished.then(()=>this.notifyFinished()).catch(Ei),this.pendingTimeline&&(this.stopTimeline=p.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=p}get finished(){return this._animation?this.animation.finished:this._finished}then(e,n){return this.finished.finally(e).then(()=>{})}get animation(){var e;return this._animation||((e=this.keyframeResolver)==null||e.resume(),lB()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),(e=this.keyframeResolver)==null||e.cancel()}}const EB=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function NB(t){const e=EB.exec(t);if(!e)return[,];const[,n,r,s]=e;return[`--${n??r}`,s]}function IM(t,e,n=1){const[r,s]=NB(t);if(!r)return;const i=window.getComputedStyle(e).getPropertyValue(r);if(i){const o=i.trim();return XI(o)?parseFloat(o):o}return Kv(s)?IM(s,e,n+1):s}function tw(t,e){return(t==null?void 0:t[e])??(t==null?void 0:t.default)??t}const MM=new Set(["width","height","top","left","right","bottom",...Fu]),jB={test:t=>t==="auto",parse:t=>t},DM=t=>e=>e.test(t),AM=[zu,ln,xo,ua,vF,bF,jB],I2=t=>AM.find(DM(t));function IB(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||ZI(t):!0}const MB=new Set(["brightness","contrast","saturate","opacity"]);function DB(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[r]=n.match(Gv)||[];if(!r)return t;const s=n.replace(r,"");let i=MB.has(e)?1:0;return r!==n&&(i*=100),e+"("+i+s+")"}const AB=/\b([a-z-]*)\(.*?\)/gu,T1={...Ga,getAnimatableNone:t=>{const e=t.match(AB);return e?e.map(DB).join(" "):t}},M2={...zu,transform:Math.round},RB={rotate:ua,rotateX:ua,rotateY:ua,rotateZ:ua,scale:Ph,scaleX:Ph,scaleY:Ph,scaleZ:Ph,skew:ua,skewX:ua,skewY:ua,distance:ln,translateX:ln,translateY:ln,translateZ:ln,x:ln,y:ln,z:ln,perspective:ln,transformPerspective:ln,opacity:Cf,originX:x2,originY:x2,originZ:ln},nw={borderWidth:ln,borderTopWidth:ln,borderRightWidth:ln,borderBottomWidth:ln,borderLeftWidth:ln,borderRadius:ln,radius:ln,borderTopLeftRadius:ln,borderTopRightRadius:ln,borderBottomRightRadius:ln,borderBottomLeftRadius:ln,width:ln,maxWidth:ln,height:ln,maxHeight:ln,top:ln,right:ln,bottom:ln,left:ln,padding:ln,paddingTop:ln,paddingRight:ln,paddingBottom:ln,paddingLeft:ln,margin:ln,marginTop:ln,marginRight:ln,marginBottom:ln,marginLeft:ln,backgroundPositionX:ln,backgroundPositionY:ln,...RB,zIndex:M2,fillOpacity:Cf,strokeOpacity:Cf,numOctaves:M2},OB={...nw,color:Tr,backgroundColor:Tr,outlineColor:Tr,fill:Tr,stroke:Tr,borderColor:Tr,borderTopColor:Tr,borderRightColor:Tr,borderBottomColor:Tr,borderLeftColor:Tr,filter:T1,WebkitFilter:T1},RM=t=>OB[t];function OM(t,e){let n=RM(t);return n!==T1&&(n=Ga),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const PB=new Set(["auto","none","0"]);function LB(t,e,n){let r=0,s;for(;r<t.length&&!s;){const i=t[r];typeof i=="string"&&!PB.has(i)&&Ef(i).values.length&&(s=t[r]),r++}if(s&&n)for(const i of e)t[i]=OM(n,s)}class $B extends ew{constructor(e,n,r,s,i){super(e,n,r,s,i,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:r}=this;if(!n||!n.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let u=e[l];if(typeof u=="string"&&(u=u.trim(),Kv(u))){const d=IM(u,n.current);d!==void 0&&(e[l]=d),l===e.length-1&&(this.finalKeyframe=u)}}if(this.resolveNoneKeyframes(),!MM.has(r)||e.length!==2)return;const[s,i]=e,o=I2(s),a=I2(i);if(o!==a)if(C2(o)&&C2(a))for(let l=0;l<e.length;l++){const u=e[l];typeof u=="string"&&(e[l]=parseFloat(u))}else Ul[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,r=[];for(let s=0;s<e.length;s++)(e[s]===null||IB(e[s]))&&r.push(s);r.length&&LB(e,r,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:r}=this;if(!e||!e.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Ul[r](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const s=n[n.length-1];s!==void 0&&e.getValue(r,s).jump(s,!1)}measureEndState(){var a;const{element:e,name:n,unresolvedKeyframes:r}=this;if(!e||!e.current)return;const s=e.getValue(n);s&&s.jump(this.measuredOrigin,!1);const i=r.length-1,o=r[i];r[i]=Ul[n](e.measureViewportBox(),window.getComputedStyle(e.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),(a=this.removedTransforms)!=null&&a.length&&this.removedTransforms.forEach(([l,u])=>{e.getValue(l).set(u)}),this.resolveNoneKeyframes()}}function zB(t,e,n){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let r=document;e&&(r=e.current);const s=(n==null?void 0:n[t])??r.querySelectorAll(t);return s?Array.from(s):[]}return Array.from(t)}const PM=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function LM(t){return QI(t)&&"offsetHeight"in t}const D2=30,FB=t=>!isNaN(parseFloat(t));class BB{constructor(e,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{var i;const s=$s.now();if(this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&((i=this.events.change)==null||i.notify(this.current),this.dependents))for(const o of this.dependents)o.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=$s.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=FB(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new Hv);const r=this.events[e].add(n);return e==="change"?()=>{r(),Zn.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,n,r){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;(e=this.events.change)==null||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=$s.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>D2)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,D2);return eM(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,n;(e=this.dependents)==null||e.clear(),(n=this.events.destroy)==null||n.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function _u(t,e){return new BB(t,e)}const{schedule:rw,cancel:kre}=dM(queueMicrotask,!1),Wi={x:!1,y:!1};function $M(){return Wi.x||Wi.y}function UB(t){return t==="x"||t==="y"?Wi[t]?null:(Wi[t]=!0,()=>{Wi[t]=!1}):Wi.x||Wi.y?null:(Wi.x=Wi.y=!0,()=>{Wi.x=Wi.y=!1})}function zM(t,e){const n=zB(t),r=new AbortController,s={passive:!0,...e,signal:r.signal};return[n,s,()=>r.abort()]}function A2(t){return!(t.pointerType==="touch"||$M())}function HB(t,e,n={}){const[r,s,i]=zM(t,n),o=a=>{if(!A2(a))return;const{target:l}=a,u=e(l,a);if(typeof u!="function"||!l)return;const d=f=>{A2(f)&&(u(f),l.removeEventListener("pointerleave",d))};l.addEventListener("pointerleave",d,s)};return r.forEach(a=>{a.addEventListener("pointerenter",o,s)}),i}const FM=(t,e)=>e?t===e?!0:FM(t,e.parentElement):!1,sw=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,VB=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function WB(t){return VB.has(t.tagName)||t.tabIndex!==-1}const kp=new WeakSet;function R2(t){return e=>{e.key==="Enter"&&t(e)}}function Z0(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const KB=(t,e)=>{const n=t.currentTarget;if(!n)return;const r=R2(()=>{if(kp.has(n))return;Z0(n,"down");const s=R2(()=>{Z0(n,"up")}),i=()=>Z0(n,"cancel");n.addEventListener("keyup",s,e),n.addEventListener("blur",i,e)});n.addEventListener("keydown",r,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",r),e)};function O2(t){return sw(t)&&!$M()}function GB(t,e,n={}){const[r,s,i]=zM(t,n),o=a=>{const l=a.currentTarget;if(!O2(a))return;kp.add(l);const u=e(l,a),d=(p,m)=>{window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",h),kp.has(l)&&kp.delete(l),O2(p)&&typeof u=="function"&&u(p,{success:m})},f=p=>{d(p,l===window||l===document||n.useGlobalTarget||FM(l,p.target))},h=p=>{d(p,!1)};window.addEventListener("pointerup",f,s),window.addEventListener("pointercancel",h,s)};return r.forEach(a=>{(n.useGlobalTarget?window:a).addEventListener("pointerdown",o,s),LM(a)&&(a.addEventListener("focus",u=>KB(u,s)),!WB(a)&&!a.hasAttribute("tabindex")&&(a.tabIndex=0))}),i}function BM(t){return QI(t)&&"ownerSVGElement"in t}function qB(t){return BM(t)&&t.tagName==="svg"}const ps=t=>!!(t&&t.getVelocity),YB=[...AM,Tr,Ga],JB=t=>YB.find(DM(t)),iw=x.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function P2(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function XB(...t){return e=>{let n=!1;const r=t.map(s=>{const i=P2(s,e);return!n&&typeof i=="function"&&(n=!0),i});if(n)return()=>{for(let s=0;s<r.length;s++){const i=r[s];typeof i=="function"?i():P2(t[s],null)}}}}function QB(...t){return x.useCallback(XB(...t),t)}class ZB extends x.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const r=n.offsetParent,s=LM(r)&&r.offsetWidth||0,i=this.props.sizeRef.current;i.height=n.offsetHeight||0,i.width=n.offsetWidth||0,i.top=n.offsetTop,i.left=n.offsetLeft,i.right=s-i.width-i.left}return null}componentDidUpdate(){}render(){return this.props.children}}function eU({children:t,isPresent:e,anchorX:n,root:r}){const s=x.useId(),i=x.useRef(null),o=x.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=x.useContext(iw),l=QB(i,t==null?void 0:t.ref);return x.useInsertionEffect(()=>{const{width:u,height:d,top:f,left:h,right:p}=o.current;if(e||!i.current||!u||!d)return;const m=n==="left"?`left: ${h}`:`right: ${p}`;i.current.dataset.motionPopId=s;const y=document.createElement("style");a&&(y.nonce=a);const b=r??document.head;return b.appendChild(y),y.sheet&&y.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${u}px !important;
            height: ${d}px !important;
            ${m}px !important;
            top: ${f}px !important;
          }
        `),()=>{b.contains(y)&&b.removeChild(y)}},[e]),c.jsx(ZB,{isPresent:e,childRef:i,sizeRef:o,children:x.cloneElement(t,{ref:l})})}const tU=({children:t,initial:e,isPresent:n,onExitComplete:r,custom:s,presenceAffectsLayout:i,mode:o,anchorX:a,root:l})=>{const u=Pv(nU),d=x.useId();let f=!0,h=x.useMemo(()=>(f=!1,{id:d,initial:e,isPresent:n,custom:s,onExitComplete:p=>{u.set(p,!0);for(const m of u.values())if(!m)return;r&&r()},register:p=>(u.set(p,!1),()=>u.delete(p))}),[n,u,r]);return i&&f&&(h={...h}),x.useMemo(()=>{u.forEach((p,m)=>u.set(m,!1))},[n]),x.useEffect(()=>{!n&&!u.size&&r&&r()},[n]),o==="popLayout"&&(t=c.jsx(eU,{isPresent:n,anchorX:a,root:l,children:t})),c.jsx(Pg.Provider,{value:h,children:t})};function nU(){return new Map}function UM(t=!0){const e=x.useContext(Pg);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:r,register:s}=e,i=x.useId();x.useEffect(()=>{if(t)return s(i)},[t]);const o=x.useCallback(()=>t&&r&&r(i),[i,r,t]);return!n&&r?[!1,o]:[!0]}const Lh=t=>t.key||"";function L2(t){const e=[];return x.Children.forEach(t,n=>{x.isValidElement(n)&&e.push(n)}),e}const bo=({children:t,custom:e,initial:n=!0,onExitComplete:r,presenceAffectsLayout:s=!0,mode:i="sync",propagate:o=!1,anchorX:a="left",root:l})=>{const[u,d]=UM(o),f=x.useMemo(()=>L2(t),[t]),h=o&&!u?[]:f.map(Lh),p=x.useRef(!0),m=x.useRef(f),y=Pv(()=>new Map),[b,g]=x.useState(f),[v,w]=x.useState(f);$v(()=>{p.current=!1,m.current=f;for(let k=0;k<v.length;k++){const D=Lh(v[k]);h.includes(D)?y.delete(D):y.get(D)!==!0&&y.set(D,!1)}},[v,h.length,h.join("-")]);const C=[];if(f!==b){let k=[...f];for(let D=0;D<v.length;D++){const S=v[D],T=Lh(S);h.includes(T)||(k.splice(D,0,S),C.push(S))}return i==="wait"&&C.length&&(k=C),w(L2(k)),g(f),null}const{forceRender:I}=x.useContext(_f);return c.jsx(c.Fragment,{children:v.map(k=>{const D=Lh(k),S=o&&!u?!1:f===v||h.includes(D),T=()=>{if(y.has(D))y.set(D,!0);else return;let _=!0;y.forEach(N=>{N||(_=!1)}),_&&(I==null||I(),w(m.current),o&&(d==null||d()),r&&r())};return c.jsx(tU,{isPresent:S,initial:!p.current||n?void 0:!1,custom:e,presenceAffectsLayout:s,mode:i,root:l,onExitComplete:S?void 0:T,anchorX:a,children:k},D)})})},rU=x.createContext(null);function sU(){const t=x.useRef(!1);return $v(()=>(t.current=!0,()=>{t.current=!1}),[]),t}function iU(){const t=sU(),[e,n]=x.useState(0),r=x.useCallback(()=>{t.current&&n(e+1)},[e]);return[x.useCallback(()=>Zn.postRender(r),[r]),e]}const oU=t=>!t.isLayoutDirty&&t.willUpdate(!1);function $2(){const t=new Set,e=new WeakMap,n=()=>t.forEach(oU);return{add:r=>{t.add(r),e.set(r,r.addEventListener("willUpdate",n))},remove:r=>{t.delete(r);const s=e.get(r);s&&(s(),e.delete(r)),n()},dirty:n}}const HM=t=>t===!0,aU=t=>HM(t===!0)||t==="id",lU=({children:t,id:e,inherit:n=!0})=>{const r=x.useContext(_f),s=x.useContext(rU),[i,o]=iU(),a=x.useRef(null),l=r.id||s;a.current===null&&(aU(n)&&l&&(e=e?l+"-"+e:l),a.current={id:e,group:HM(n)&&r.group||$2()});const u=x.useMemo(()=>({...a.current,forceRender:i}),[o]);return c.jsx(_f.Provider,{value:u,children:t})},VM=x.createContext({strict:!1}),z2={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Tu={};for(const t in z2)Tu[t]={isEnabled:e=>z2[t].some(n=>!!e[n])};function cU(t){for(const e in t)Tu[e]={...Tu[e],...t[e]}}const uU=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function pm(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||uU.has(t)}let WM=t=>!pm(t);function dU(t){typeof t=="function"&&(WM=e=>e.startsWith("on")?!pm(e):t(e))}try{dU(require("@emotion/is-prop-valid").default)}catch{}function fU(t,e,n){const r={};for(const s in t)s==="values"&&typeof t.values=="object"||(WM(s)||n===!0&&pm(s)||!e&&!pm(s)||t.draggable&&s.startsWith("onDrag"))&&(r[s]=t[s]);return r}const Lg=x.createContext({});function $g(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function Nf(t){return typeof t=="string"||Array.isArray(t)}const ow=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],aw=["initial",...ow];function zg(t){return $g(t.animate)||aw.some(e=>Nf(t[e]))}function KM(t){return!!(zg(t)||t.variants)}function hU(t,e){if(zg(t)){const{initial:n,animate:r}=t;return{initial:n===!1||Nf(n)?n:void 0,animate:Nf(r)?r:void 0}}return t.inherit!==!1?e:{}}function pU(t){const{initial:e,animate:n}=hU(t,x.useContext(Lg));return x.useMemo(()=>({initial:e,animate:n}),[F2(e),F2(n)])}function F2(t){return Array.isArray(t)?t.join(" "):t}function B2(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const rd={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(ln.test(t))t=parseFloat(t);else return t;const n=B2(t,e.target.x),r=B2(t,e.target.y);return`${n}% ${r}%`}},mU={correct:(t,{treeScale:e,projectionDelta:n})=>{const r=t,s=Ga.parse(t);if(s.length>5)return r;const i=Ga.createTransformer(t),o=typeof s[0]!="number"?1:0,a=n.x.scale*e.x,l=n.y.scale*e.y;s[0+o]/=a,s[1+o]/=l;const u=ur(a,l,.5);return typeof s[2+o]=="number"&&(s[2+o]/=u),typeof s[3+o]=="number"&&(s[3+o]/=u),i(s)}},C1={borderRadius:{...rd,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:rd,borderTopRightRadius:rd,borderBottomLeftRadius:rd,borderBottomRightRadius:rd,boxShadow:mU};function GM(t,{layout:e,layoutId:n}){return Bu.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!C1[t]||t==="opacity")}const gU={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},yU=Fu.length;function xU(t,e,n){let r="",s=!0;for(let i=0;i<yU;i++){const o=Fu[i],a=t[o];if(a===void 0)continue;let l=!0;if(typeof a=="number"?l=a===(o.startsWith("scale")?1:0):l=parseFloat(a)===0,!l||n){const u=PM(a,nw[o]);if(!l){s=!1;const d=gU[o]||o;r+=`${d}(${u}) `}n&&(e[o]=u)}}return r=r.trim(),n?r=n(e,s?"":r):s&&(r="none"),r}function lw(t,e,n){const{style:r,vars:s,transformOrigin:i}=t;let o=!1,a=!1;for(const l in e){const u=e[l];if(Bu.has(l)){o=!0;continue}else if(hM(l)){s[l]=u;continue}else{const d=PM(u,nw[l]);l.startsWith("origin")?(a=!0,i[l]=d):r[l]=d}}if(e.transform||(o||n?r.transform=xU(e,t.transform,n):r.transform&&(r.transform="none")),a){const{originX:l="50%",originY:u="50%",originZ:d=0}=i;r.transformOrigin=`${l} ${u} ${d}`}}const cw=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function qM(t,e,n){for(const r in e)!ps(e[r])&&!GM(r,n)&&(t[r]=e[r])}function bU({transformTemplate:t},e){return x.useMemo(()=>{const n=cw();return lw(n,e,t),Object.assign({},n.vars,n.style)},[e])}function vU(t,e){const n=t.style||{},r={};return qM(r,n,t),Object.assign(r,bU(t,e)),r}function wU(t,e){const n={},r=vU(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=r,n}const kU={offset:"stroke-dashoffset",array:"stroke-dasharray"},SU={offset:"strokeDashoffset",array:"strokeDasharray"};function _U(t,e,n=1,r=0,s=!0){t.pathLength=1;const i=s?kU:SU;t[i.offset]=ln.transform(-r);const o=ln.transform(e),a=ln.transform(n);t[i.array]=`${o} ${a}`}function YM(t,{attrX:e,attrY:n,attrScale:r,pathLength:s,pathSpacing:i=1,pathOffset:o=0,...a},l,u,d){if(lw(t,a,u),l){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:f,style:h}=t;f.transform&&(h.transform=f.transform,delete f.transform),(h.transform||f.transformOrigin)&&(h.transformOrigin=f.transformOrigin??"50% 50%",delete f.transformOrigin),h.transform&&(h.transformBox=(d==null?void 0:d.transformBox)??"fill-box",delete f.transformBox),e!==void 0&&(f.x=e),n!==void 0&&(f.y=n),r!==void 0&&(f.scale=r),s!==void 0&&_U(f,s,i,o,!1)}const JM=()=>({...cw(),attrs:{}}),XM=t=>typeof t=="string"&&t.toLowerCase()==="svg";function TU(t,e,n,r){const s=x.useMemo(()=>{const i=JM();return YM(i,e,XM(r),t.transformTemplate,t.style),{...i.attrs,style:{...i.style}}},[e]);if(t.style){const i={};qM(i,t.style,t),s.style={...i,...s.style}}return s}const CU=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function uw(t){return typeof t!="string"||t.includes("-")?!1:!!(CU.indexOf(t)>-1||/[A-Z]/u.test(t))}function EU(t,e,n,{latestValues:r},s,i=!1){const a=(uw(t)?TU:wU)(e,r,s,t),l=fU(e,typeof t=="string",i),u=t!==x.Fragment?{...l,...a,ref:n}:{},{children:d}=e,f=x.useMemo(()=>ps(d)?d.get():d,[d]);return x.createElement(t,{...u,children:f})}function U2(t){const e=[{},{}];return t==null||t.values.forEach((n,r)=>{e[0][r]=n.get(),e[1][r]=n.getVelocity()}),e}function dw(t,e,n,r){if(typeof e=="function"){const[s,i]=U2(r);e=e(n!==void 0?n:t.custom,s,i)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[s,i]=U2(r);e=e(n!==void 0?n:t.custom,s,i)}return e}function Sp(t){return ps(t)?t.get():t}function NU({scrapeMotionValuesFromProps:t,createRenderState:e},n,r,s){return{latestValues:jU(n,r,s,t),renderState:e()}}function jU(t,e,n,r){const s={},i=r(t,{});for(const h in i)s[h]=Sp(i[h]);let{initial:o,animate:a}=t;const l=zg(t),u=KM(t);e&&u&&!l&&t.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let d=n?n.initial===!1:!1;d=d||o===!1;const f=d?a:o;if(f&&typeof f!="boolean"&&!$g(f)){const h=Array.isArray(f)?f:[f];for(let p=0;p<h.length;p++){const m=dw(t,h[p]);if(m){const{transitionEnd:y,transition:b,...g}=m;for(const v in g){let w=g[v];if(Array.isArray(w)){const C=d?w.length-1:0;w=w[C]}w!==null&&(s[v]=w)}for(const v in y)s[v]=y[v]}}}return s}const QM=t=>(e,n)=>{const r=x.useContext(Lg),s=x.useContext(Pg),i=()=>NU(t,e,r,s);return n?i():Pv(i)};function fw(t,e,n){var i;const{style:r}=t,s={};for(const o in r)(ps(r[o])||e.style&&ps(e.style[o])||GM(o,t)||((i=n==null?void 0:n.getValue(o))==null?void 0:i.liveStyle)!==void 0)&&(s[o]=r[o]);return s}const IU=QM({scrapeMotionValuesFromProps:fw,createRenderState:cw});function ZM(t,e,n){const r=fw(t,e,n);for(const s in t)if(ps(t[s])||ps(e[s])){const i=Fu.indexOf(s)!==-1?"attr"+s.charAt(0).toUpperCase()+s.substring(1):s;r[i]=t[s]}return r}const MU=QM({scrapeMotionValuesFromProps:ZM,createRenderState:JM}),DU=Symbol.for("motionComponentSymbol");function Gc(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function AU(t,e,n){return x.useCallback(r=>{r&&t.onMount&&t.onMount(r),e&&(r?e.mount(r):e.unmount()),n&&(typeof n=="function"?n(r):Gc(n)&&(n.current=r))},[e])}const hw=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),RU="framerAppearId",eD="data-"+hw(RU),tD=x.createContext({});function OU(t,e,n,r,s){var y,b;const{visualElement:i}=x.useContext(Lg),o=x.useContext(VM),a=x.useContext(Pg),l=x.useContext(iw).reducedMotion,u=x.useRef(null);r=r||o.renderer,!u.current&&r&&(u.current=r(t,{visualState:e,parent:i,props:n,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:l}));const d=u.current,f=x.useContext(tD);d&&!d.projection&&s&&(d.type==="html"||d.type==="svg")&&PU(u.current,n,s,f);const h=x.useRef(!1);x.useInsertionEffect(()=>{d&&h.current&&d.update(n,a)});const p=n[eD],m=x.useRef(!!p&&!((y=window.MotionHandoffIsComplete)!=null&&y.call(window,p))&&((b=window.MotionHasOptimisedAnimation)==null?void 0:b.call(window,p)));return $v(()=>{d&&(h.current=!0,window.MotionIsMounted=!0,d.updateFeatures(),d.scheduleRenderMicrotask(),m.current&&d.animationState&&d.animationState.animateChanges())}),x.useEffect(()=>{d&&(!m.current&&d.animationState&&d.animationState.animateChanges(),m.current&&(queueMicrotask(()=>{var g;(g=window.MotionHandoffMarkAsComplete)==null||g.call(window,p)}),m.current=!1),d.enteringChildren=void 0)}),d}function PU(t,e,n,r){const{layoutId:s,layout:i,drag:o,dragConstraints:a,layoutScroll:l,layoutRoot:u,layoutCrossfade:d}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:nD(t.parent)),t.projection.setOptions({layoutId:s,layout:i,alwaysMeasureLayout:!!o||a&&Gc(a),visualElement:t,animationType:typeof i=="string"?i:"both",initialPromotionConfig:r,crossfade:d,layoutScroll:l,layoutRoot:u})}function nD(t){if(t)return t.options.allowProjection!==!1?t.projection:nD(t.parent)}function ey(t,{forwardMotionProps:e=!1}={},n,r){n&&cU(n);const s=uw(t)?MU:IU;function i(a,l){let u;const d={...x.useContext(iw),...a,layoutId:LU(a)},{isStatic:f}=d,h=pU(a),p=s(a,f);if(!f&&Lv){$U();const m=zU(d);u=m.MeasureLayout,h.visualElement=OU(t,p,d,r,m.ProjectionNode)}return c.jsxs(Lg.Provider,{value:h,children:[u&&h.visualElement?c.jsx(u,{visualElement:h.visualElement,...d}):null,EU(t,a,AU(p,h.visualElement,l),p,f,e)]})}i.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const o=x.forwardRef(i);return o[DU]=t,o}function LU({layoutId:t}){const e=x.useContext(_f).id;return e&&t!==void 0?e+"-"+t:t}function $U(t,e){x.useContext(VM).strict}function zU(t){const{drag:e,layout:n}=Tu;if(!e&&!n)return{};const r={...e,...n};return{MeasureLayout:e!=null&&e.isEnabled(t)||n!=null&&n.isEnabled(t)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function FU(t,e){if(typeof Proxy>"u")return ey;const n=new Map,r=(i,o)=>ey(i,o,t,e),s=(i,o)=>r(i,o);return new Proxy(s,{get:(i,o)=>o==="create"?r:(n.has(o)||n.set(o,ey(o,void 0,t,e)),n.get(o))})}function rD({top:t,left:e,right:n,bottom:r}){return{x:{min:e,max:n},y:{min:t,max:r}}}function BU({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function UU(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),r=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:r.y,right:r.x}}function ty(t){return t===void 0||t===1}function E1({scale:t,scaleX:e,scaleY:n}){return!ty(t)||!ty(e)||!ty(n)}function yl(t){return E1(t)||sD(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function sD(t){return H2(t.x)||H2(t.y)}function H2(t){return t&&t!=="0%"}function mm(t,e,n){const r=t-n,s=e*r;return n+s}function V2(t,e,n,r,s){return s!==void 0&&(t=mm(t,s,r)),mm(t,n,r)+e}function N1(t,e=0,n=1,r,s){t.min=V2(t.min,e,n,r,s),t.max=V2(t.max,e,n,r,s)}function iD(t,{x:e,y:n}){N1(t.x,e.translate,e.scale,e.originPoint),N1(t.y,n.translate,n.scale,n.originPoint)}const W2=.999999999999,K2=1.0000000000001;function HU(t,e,n,r=!1){const s=n.length;if(!s)return;e.x=e.y=1;let i,o;for(let a=0;a<s;a++){i=n[a],o=i.projectionDelta;const{visualElement:l}=i.options;l&&l.props.style&&l.props.style.display==="contents"||(r&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Yc(t,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,iD(t,o)),r&&yl(i.latestValues)&&Yc(t,i.latestValues))}e.x<K2&&e.x>W2&&(e.x=1),e.y<K2&&e.y>W2&&(e.y=1)}function qc(t,e){t.min=t.min+e,t.max=t.max+e}function G2(t,e,n,r,s=.5){const i=ur(t.min,t.max,s);N1(t,e,n,i,r)}function Yc(t,e){G2(t.x,e.x,e.scaleX,e.scale,e.originX),G2(t.y,e.y,e.scaleY,e.scale,e.originY)}function oD(t,e){return rD(UU(t.getBoundingClientRect(),e))}function VU(t,e,n){const r=oD(t,n),{scroll:s}=e;return s&&(qc(r.x,s.offset.x),qc(r.y,s.offset.y)),r}const q2=()=>({translate:0,scale:1,origin:0,originPoint:0}),Jc=()=>({x:q2(),y:q2()}),Y2=()=>({min:0,max:0}),Ar=()=>({x:Y2(),y:Y2()}),j1={current:null},aD={current:!1};function WU(){if(aD.current=!0,!!Lv)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>j1.current=t.matches;t.addEventListener("change",e),e()}else j1.current=!1}const KU=new WeakMap;function GU(t,e,n){for(const r in e){const s=e[r],i=n[r];if(ps(s))t.addValue(r,s);else if(ps(i))t.addValue(r,_u(s,{owner:t}));else if(i!==s)if(t.hasValue(r)){const o=t.getValue(r);o.liveStyle===!0?o.jump(s):o.hasAnimated||o.set(s)}else{const o=t.getStaticValue(r);t.addValue(r,_u(o!==void 0?o:s,{owner:t}))}}for(const r in n)e[r]===void 0&&t.removeValue(r);return e}const J2=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class qU{scrapeMotionValuesFromProps(e,n,r){return{}}constructor({parent:e,props:n,presenceContext:r,reducedMotionConfig:s,blockInitialAnimation:i,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=ew,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const h=$s.now();this.renderScheduledAt<h&&(this.renderScheduledAt=h,Zn.render(this.render,!1,!0))};const{latestValues:l,renderState:u}=o;this.latestValues=l,this.baseTarget={...l},this.initialValues=n.initial?{...l}:{},this.renderState=u,this.parent=e,this.props=n,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=s,this.options=a,this.blockInitialAnimation=!!i,this.isControllingVariants=zg(n),this.isVariantNode=KM(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...f}=this.scrapeMotionValuesFromProps(n,{},this);for(const h in f){const p=f[h];l[h]!==void 0&&ps(p)&&p.set(l[h])}}mount(e){var n;this.current=e,KU.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,s)=>this.bindToMotionValue(s,r)),aD.current||WU(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:j1.current,(n=this.parent)==null||n.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var e;this.projection&&this.projection.unmount(),Ka(this.notifyUpdate),Ka(this.render),this.valueSubscriptions.forEach(n=>n()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(e=this.parent)==null||e.removeChild(this);for(const n in this.events)this.events[n].clear();for(const n in this.features){const r=this.features[n];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=Bu.has(e);r&&this.onBindTransform&&this.onBindTransform();const s=n.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&Zn.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let i;window.MotionCheckAppearSync&&(i=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{s(),i&&i(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in Tu){const n=Tu[e];if(!n)continue;const{isEnabled:r,Feature:s}=n;if(!this.features[e]&&s&&r(this.props)&&(this.features[e]=new s(this)),this.features[e]){const i=this.features[e];i.isMounted?i.update():(i.mount(),i.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ar()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let r=0;r<J2.length;r++){const s=J2[r];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const i="on"+s,o=e[i];o&&(this.propEventSubscriptions[s]=this.on(s,o))}this.prevMotionValues=GU(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const r=this.values.get(e);n!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&n!==void 0&&(r=_u(n===null?void 0:n,{owner:this}),this.addValue(e,r)),r}readValue(e,n){let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(XI(r)||ZI(r))?r=parseFloat(r):!JB(r)&&Ga.test(n)&&(r=OM(e,n)),this.setBaseTarget(e,ps(r)?r.get():r)),ps(r)?r.get():r}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var i;const{initial:n}=this.props;let r;if(typeof n=="string"||typeof n=="object"){const o=dw(this.props,n,(i=this.presenceContext)==null?void 0:i.custom);o&&(r=o[e])}if(n&&r!==void 0)return r;const s=this.getBaseTargetFromProps(this.props,e);return s!==void 0&&!ps(s)?s:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new Hv),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}scheduleRenderMicrotask(){rw.render(this.render)}}class lD extends qU{constructor(){super(...arguments),this.KeyframeResolver=$B}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:r}){delete n[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;ps(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function cD(t,{style:e,vars:n},r,s){const i=t.style;let o;for(o in e)i[o]=e[o];s==null||s.applyProjectionStyles(i,r);for(o in n)i.setProperty(o,n[o])}function YU(t){return window.getComputedStyle(t)}class JU extends lD{constructor(){super(...arguments),this.type="html",this.renderInstance=cD}readValueFromInstance(e,n){var r;if(Bu.has(n))return(r=this.projection)!=null&&r.isProjecting?b1(n):rB(e,n);{const s=YU(e),i=(hM(n)?s.getPropertyValue(n):s[n])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:n}){return oD(e,n)}build(e,n,r){lw(e,n,r.transformTemplate)}scrapeMotionValuesFromProps(e,n,r){return fw(e,n,r)}}const uD=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function XU(t,e,n,r){cD(t,e,void 0,r);for(const s in e.attrs)t.setAttribute(uD.has(s)?s:hw(s),e.attrs[s])}class QU extends lD{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ar}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(Bu.has(n)){const r=RM(n);return r&&r.default||0}return n=uD.has(n)?n:hw(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,r){return ZM(e,n,r)}build(e,n,r){YM(e,n,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(e,n,r,s){XU(e,n,r,s)}mount(e){this.isSVGTag=XM(e.tagName),super.mount(e)}}const ZU=(t,e)=>uw(t)?new QU(e):new JU(e,{allowProjection:t!==x.Fragment});function uu(t,e,n){const r=t.getProps();return dw(r,e,n!==void 0?n:r.custom,t)}const I1=t=>Array.isArray(t);function e8(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,_u(n))}function t8(t){return I1(t)?t[t.length-1]||0:t}function n8(t,e){const n=uu(t,e);let{transitionEnd:r={},transition:s={},...i}=n||{};i={...i,...r};for(const o in i){const a=t8(i[o]);e8(t,o,a)}}function r8(t){return!!(ps(t)&&t.add)}function M1(t,e){const n=t.getValue("willChange");if(r8(n))return n.add(e);if(!n&&Xo.WillChange){const r=new Xo.WillChange("auto");t.addValue("willChange",r),r.add(e)}}function dD(t){return t.props[eD]}const s8=t=>t!==null;function i8(t,{repeat:e,repeatType:n="loop"},r){const s=t.filter(s8),i=e&&n!=="loop"&&e%2===1?0:s.length-1;return!i||r===void 0?s[i]:r}const o8={type:"spring",stiffness:500,damping:25,restSpeed:10},a8=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),l8={type:"keyframes",duration:.8},c8={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},u8=(t,{keyframes:e})=>e.length>2?l8:Bu.has(t)?t.startsWith("scale")?a8(e[1]):o8:c8;function d8({when:t,delay:e,delayChildren:n,staggerChildren:r,staggerDirection:s,repeat:i,repeatType:o,repeatDelay:a,from:l,elapsed:u,...d}){return!!Object.keys(d).length}const pw=(t,e,n,r={},s,i)=>o=>{const a=tw(r,t)||{},l=a.delay||r.delay||0;let{elapsed:u=0}=r;u=u-yo(l);const d={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-u,onUpdate:h=>{e.set(h),a.onUpdate&&a.onUpdate(h)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:t,motionValue:e,element:i?void 0:s};d8(a)||Object.assign(d,u8(t,d)),d.duration&&(d.duration=yo(d.duration)),d.repeatDelay&&(d.repeatDelay=yo(d.repeatDelay)),d.from!==void 0&&(d.keyframes[0]=d.from);let f=!1;if((d.type===!1||d.duration===0&&!d.repeatDelay)&&(_1(d),d.delay===0&&(f=!0)),(Xo.instantAnimations||Xo.skipAnimations)&&(f=!0,_1(d),d.delay=0),d.allowFlatten=!a.type&&!a.ease,f&&!i&&e.get()!==void 0){const h=i8(d.keyframes,a);if(h!==void 0){Zn.update(()=>{d.onUpdate(h),d.onComplete()});return}}return a.isSync?new Zv(d):new CB(d)};function f8({protectedKeys:t,needsAnimating:e},n){const r=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,r}function fD(t,e,{delay:n=0,transitionOverride:r,type:s}={}){let{transition:i=t.getDefaultTransition(),transitionEnd:o,...a}=e;r&&(i=r);const l=[],u=s&&t.animationState&&t.animationState.getState()[s];for(const d in a){const f=t.getValue(d,t.latestValues[d]??null),h=a[d];if(h===void 0||u&&f8(u,d))continue;const p={delay:n,...tw(i||{},d)},m=f.get();if(m!==void 0&&!f.isAnimating&&!Array.isArray(h)&&h===m&&!p.velocity)continue;let y=!1;if(window.MotionHandoffAnimation){const g=dD(t);if(g){const v=window.MotionHandoffAnimation(g,d,Zn);v!==null&&(p.startTime=v,y=!0)}}M1(t,d),f.start(pw(d,f,h,t.shouldReduceMotion&&MM.has(d)?{type:!1}:p,t,y));const b=f.animation;b&&l.push(b)}return o&&Promise.all(l).then(()=>{Zn.update(()=>{o&&n8(t,o)})}),l}function hD(t,e,n,r=0,s=1){const i=Array.from(t).sort((u,d)=>u.sortNodePosition(d)).indexOf(e),o=t.size,a=(o-1)*r;return typeof n=="function"?n(i,o):s===1?i*r:a-i*r}function D1(t,e,n={}){var l;const r=uu(t,e,n.type==="exit"?(l=t.presenceContext)==null?void 0:l.custom:void 0);let{transition:s=t.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(s=n.transitionOverride);const i=r?()=>Promise.all(fD(t,r,n)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?(u=0)=>{const{delayChildren:d=0,staggerChildren:f,staggerDirection:h}=s;return h8(t,e,u,d,f,h,n)}:()=>Promise.resolve(),{when:a}=s;if(a){const[u,d]=a==="beforeChildren"?[i,o]:[o,i];return u().then(()=>d())}else return Promise.all([i(),o(n.delay)])}function h8(t,e,n=0,r=0,s=0,i=1,o){const a=[];for(const l of t.variantChildren)l.notify("AnimationStart",e),a.push(D1(l,e,{...o,delay:n+(typeof r=="function"?0:r)+hD(t.variantChildren,l,r,s,i)}).then(()=>l.notify("AnimationComplete",e)));return Promise.all(a)}function p8(t,e,n={}){t.notify("AnimationStart",e);let r;if(Array.isArray(e)){const s=e.map(i=>D1(t,i,n));r=Promise.all(s)}else if(typeof e=="string")r=D1(t,e,n);else{const s=typeof e=="function"?uu(t,e,n.custom):e;r=Promise.all(fD(t,s,n))}return r.then(()=>{t.notify("AnimationComplete",e)})}function pD(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}const m8=aw.length;function mD(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?mD(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<m8;n++){const r=aw[n],s=t.props[r];(Nf(s)||s===!1)&&(e[r]=s)}return e}const g8=[...ow].reverse(),y8=ow.length;function x8(t){return e=>Promise.all(e.map(({animation:n,options:r})=>p8(t,n,r)))}function b8(t){let e=x8(t),n=X2(),r=!0;const s=l=>(u,d)=>{var h;const f=uu(t,d,l==="exit"?(h=t.presenceContext)==null?void 0:h.custom:void 0);if(f){const{transition:p,transitionEnd:m,...y}=f;u={...u,...y,...m}}return u};function i(l){e=l(t)}function o(l){const{props:u}=t,d=mD(t.parent)||{},f=[],h=new Set;let p={},m=1/0;for(let b=0;b<y8;b++){const g=g8[b],v=n[g],w=u[g]!==void 0?u[g]:d[g],C=Nf(w),I=g===l?v.isActive:null;I===!1&&(m=b);let k=w===d[g]&&w!==u[g]&&C;if(k&&r&&t.manuallyAnimateOnMount&&(k=!1),v.protectedKeys={...p},!v.isActive&&I===null||!w&&!v.prevProp||$g(w)||typeof w=="boolean")continue;const D=v8(v.prevProp,w);let S=D||g===l&&v.isActive&&!k&&C||b>m&&C,T=!1;const _=Array.isArray(w)?w:[w];let N=_.reduce(s(g),{});I===!1&&(N={});const{prevResolvedValues:A={}}=v,O={...A,...N},L=j=>{S=!0,h.has(j)&&(T=!0,h.delete(j)),v.needsAnimating[j]=!0;const H=t.getValue(j);H&&(H.liveStyle=!1)};for(const j in O){const H=N[j],W=A[j];if(p.hasOwnProperty(j))continue;let R=!1;I1(H)&&I1(W)?R=!pD(H,W):R=H!==W,R?H!=null?L(j):h.add(j):H!==void 0&&h.has(j)?L(j):v.protectedKeys[j]=!0}v.prevProp=w,v.prevResolvedValues=N,v.isActive&&(p={...p,...N}),r&&t.blockInitialAnimation&&(S=!1);const V=k&&D;S&&(!V||T)&&f.push(..._.map(j=>{const H={type:g};if(typeof j=="string"&&r&&!V&&t.manuallyAnimateOnMount&&t.parent){const{parent:W}=t,R=uu(W,j);if(W.enteringChildren&&R){const{delayChildren:ae}=R.transition||{};H.delay=hD(W.enteringChildren,t,ae)}}return{animation:j,options:H}}))}if(h.size){const b={};if(typeof u.initial!="boolean"){const g=uu(t,Array.isArray(u.initial)?u.initial[0]:u.initial);g&&g.transition&&(b.transition=g.transition)}h.forEach(g=>{const v=t.getBaseTarget(g),w=t.getValue(g);w&&(w.liveStyle=!0),b[g]=v??null}),f.push({animation:b})}let y=!!f.length;return r&&(u.initial===!1||u.initial===u.animate)&&!t.manuallyAnimateOnMount&&(y=!1),r=!1,y?e(f):Promise.resolve()}function a(l,u){var f;if(n[l].isActive===u)return Promise.resolve();(f=t.variantChildren)==null||f.forEach(h=>{var p;return(p=h.animationState)==null?void 0:p.setActive(l,u)}),n[l].isActive=u;const d=o(l);for(const h in n)n[h].protectedKeys={};return d}return{animateChanges:o,setActive:a,setAnimateFunction:i,getState:()=>n,reset:()=>{n=X2()}}}function v8(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!pD(e,t):!1}function hl(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function X2(){return{animate:hl(!0),whileInView:hl(),whileHover:hl(),whileTap:hl(),whileDrag:hl(),whileFocus:hl(),exit:hl()}}class el{constructor(e){this.isMounted=!1,this.node=e}update(){}}class w8 extends el{constructor(e){super(e),e.animationState||(e.animationState=b8(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();$g(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)==null||e.call(this)}}let k8=0;class S8 extends el{constructor(){super(...arguments),this.id=k8++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const s=this.node.animationState.setActive("exit",!e);n&&!e&&s.then(()=>{n(this.id)})}mount(){const{register:e,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const _8={animation:{Feature:w8},exit:{Feature:S8}};function jf(t,e,n,r={passive:!0}){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n)}function sh(t){return{point:{x:t.pageX,y:t.pageY}}}const T8=t=>e=>sw(e)&&t(e,sh(e));function Od(t,e,n,r){return jf(t,e,T8(n),r)}const gD=1e-4,C8=1-gD,E8=1+gD,yD=.01,N8=0-yD,j8=0+yD;function ks(t){return t.max-t.min}function I8(t,e,n){return Math.abs(t-e)<=n}function Q2(t,e,n,r=.5){t.origin=r,t.originPoint=ur(e.min,e.max,t.origin),t.scale=ks(n)/ks(e),t.translate=ur(n.min,n.max,t.origin)-t.originPoint,(t.scale>=C8&&t.scale<=E8||isNaN(t.scale))&&(t.scale=1),(t.translate>=N8&&t.translate<=j8||isNaN(t.translate))&&(t.translate=0)}function Pd(t,e,n,r){Q2(t.x,e.x,n.x,r?r.originX:void 0),Q2(t.y,e.y,n.y,r?r.originY:void 0)}function Z2(t,e,n){t.min=n.min+e.min,t.max=t.min+ks(e)}function M8(t,e,n){Z2(t.x,e.x,n.x),Z2(t.y,e.y,n.y)}function e_(t,e,n){t.min=e.min-n.min,t.max=t.min+ks(e)}function gm(t,e,n){e_(t.x,e.x,n.x),e_(t.y,e.y,n.y)}function mi(t){return[t("x"),t("y")]}const xD=({current:t})=>t?t.ownerDocument.defaultView:null,t_=(t,e)=>Math.abs(t-e);function D8(t,e){const n=t_(t.x,e.x),r=t_(t.y,e.y);return Math.sqrt(n**2+r**2)}class bD{constructor(e,n,{transformPagePoint:r,contextWindow:s=window,dragSnapToOrigin:i=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=ry(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,m=D8(h.offset,{x:0,y:0})>=this.distanceThreshold;if(!p&&!m)return;const{point:y}=h,{timestamp:b}=Xr;this.history.push({...y,timestamp:b});const{onStart:g,onMove:v}=this.handlers;p||(g&&g(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),v&&v(this.lastMoveEvent,h)},this.handlePointerMove=(h,p)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=ny(p,this.transformPagePoint),Zn.update(this.updatePoint,!0)},this.handlePointerUp=(h,p)=>{this.end();const{onEnd:m,onSessionEnd:y,resumeAnimation:b}=this.handlers;if(this.dragSnapToOrigin&&b&&b(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=ry(h.type==="pointercancel"?this.lastMoveEventInfo:ny(p,this.transformPagePoint),this.history);this.startEvent&&m&&m(h,g),y&&y(h,g)},!sw(e))return;this.dragSnapToOrigin=i,this.handlers=n,this.transformPagePoint=r,this.distanceThreshold=o,this.contextWindow=s||window;const a=sh(e),l=ny(a,this.transformPagePoint),{point:u}=l,{timestamp:d}=Xr;this.history=[{...u,timestamp:d}];const{onSessionStart:f}=n;f&&f(e,ry(l,this.history)),this.removeListeners=th(Od(this.contextWindow,"pointermove",this.handlePointerMove),Od(this.contextWindow,"pointerup",this.handlePointerUp),Od(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Ka(this.updatePoint)}}function ny(t,e){return e?{point:e(t.point)}:t}function n_(t,e){return{x:t.x-e.x,y:t.y-e.y}}function ry({point:t},e){return{point:t,delta:n_(t,vD(e)),offset:n_(t,A8(e)),velocity:R8(e,.1)}}function A8(t){return t[0]}function vD(t){return t[t.length-1]}function R8(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,r=null;const s=vD(t);for(;n>=0&&(r=t[n],!(s.timestamp-r.timestamp>yo(e)));)n--;if(!r)return{x:0,y:0};const i=Ti(s.timestamp-r.timestamp);if(i===0)return{x:0,y:0};const o={x:(s.x-r.x)/i,y:(s.y-r.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function O8(t,{min:e,max:n},r){return e!==void 0&&t<e?t=r?ur(e,t,r.min):Math.max(t,e):n!==void 0&&t>n&&(t=r?ur(n,t,r.max):Math.min(t,n)),t}function r_(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function P8(t,{top:e,left:n,bottom:r,right:s}){return{x:r_(t.x,n,s),y:r_(t.y,e,r)}}function s_(t,e){let n=e.min-t.min,r=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,r]=[r,n]),{min:n,max:r}}function L8(t,e){return{x:s_(t.x,e.x),y:s_(t.y,e.y)}}function $8(t,e){let n=.5;const r=ks(t),s=ks(e);return s>r?n=Tf(e.min,e.max-r,t.min):r>s&&(n=Tf(t.min,t.max-s,e.min)),Jo(0,1,n)}function z8(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const A1=.35;function F8(t=A1){return t===!1?t=0:t===!0&&(t=A1),{x:i_(t,"left","right"),y:i_(t,"top","bottom")}}function i_(t,e,n){return{min:o_(t,e),max:o_(t,n)}}function o_(t,e){return typeof t=="number"?t:t[e]||0}const B8=new WeakMap;class U8{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ar(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:n=!1,distanceThreshold:r}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const i=f=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(sh(f).point)},o=(f,h)=>{const{drag:p,dragPropagation:m,onDragStart:y}=this.getProps();if(p&&!m&&(this.openDragLock&&this.openDragLock(),this.openDragLock=UB(p),!this.openDragLock))return;this.latestPointerEvent=f,this.latestPanInfo=h,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),mi(g=>{let v=this.getAxisMotionValue(g).get()||0;if(xo.test(v)){const{projection:w}=this.visualElement;if(w&&w.layout){const C=w.layout.layoutBox[g];C&&(v=ks(C)*(parseFloat(v)/100))}}this.originPoint[g]=v}),y&&Zn.postRender(()=>y(f,h)),M1(this.visualElement,"transform");const{animationState:b}=this.visualElement;b&&b.setActive("whileDrag",!0)},a=(f,h)=>{this.latestPointerEvent=f,this.latestPanInfo=h;const{dragPropagation:p,dragDirectionLock:m,onDirectionLock:y,onDrag:b}=this.getProps();if(!p&&!this.openDragLock)return;const{offset:g}=h;if(m&&this.currentDirection===null){this.currentDirection=H8(g),this.currentDirection!==null&&y&&y(this.currentDirection);return}this.updateAxis("x",h.point,g),this.updateAxis("y",h.point,g),this.visualElement.render(),b&&b(f,h)},l=(f,h)=>{this.latestPointerEvent=f,this.latestPanInfo=h,this.stop(f,h),this.latestPointerEvent=null,this.latestPanInfo=null},u=()=>mi(f=>{var h;return this.getAnimationState(f)==="paused"&&((h=this.getAxisMotionValue(f).animation)==null?void 0:h.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new bD(e,{onSessionStart:i,onStart:o,onMove:a,onSessionEnd:l,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,distanceThreshold:r,contextWindow:xD(this.visualElement)})}stop(e,n){const r=e||this.latestPointerEvent,s=n||this.latestPanInfo,i=this.isDragging;if(this.cancel(),!i||!s||!r)return;const{velocity:o}=s;this.startAnimation(o);const{onDragEnd:a}=this.getProps();a&&Zn.postRender(()=>a(r,s))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,r){const{drag:s}=this.getProps();if(!r||!$h(e,s,this.currentDirection))return;const i=this.getAxisMotionValue(e);let o=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(o=O8(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){var i;const{dragConstraints:e,dragElastic:n}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(i=this.visualElement.projection)==null?void 0:i.layout,s=this.constraints;e&&Gc(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&r?this.constraints=P8(r.layoutBox,e):this.constraints=!1,this.elastic=F8(n),s!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&mi(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=z8(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!Gc(e))return!1;const r=e.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const i=VU(r,s.root,this.visualElement.getTransformPagePoint());let o=L8(s.layout.layoutBox,i);if(n){const a=n(BU(o));this.hasMutatedConstraints=!!a,a&&(o=rD(a))}return o}startAnimation(e){const{drag:n,dragMomentum:r,dragElastic:s,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),l=this.constraints||{},u=mi(d=>{if(!$h(d,n,this.currentDirection))return;let f=l&&l[d]||{};o&&(f={min:0,max:0});const h=s?200:1e6,p=s?40:1e7,m={type:"inertia",velocity:r?e[d]:0,bounceStiffness:h,bounceDamping:p,timeConstant:750,restDelta:1,restSpeed:10,...i,...f};return this.startAxisValueAnimation(d,m)});return Promise.all(u).then(a)}startAxisValueAnimation(e,n){const r=this.getAxisMotionValue(e);return M1(this.visualElement,e),r.start(pw(e,r,0,n,this.visualElement,!1))}stopAnimation(){mi(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){mi(e=>{var n;return(n=this.getAxisMotionValue(e).animation)==null?void 0:n.pause()})}getAnimationState(e){var n;return(n=this.getAxisMotionValue(e).animation)==null?void 0:n.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps(),s=r[n];return s||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){mi(n=>{const{drag:r}=this.getProps();if(!$h(n,r,this.currentDirection))return;const{projection:s}=this.visualElement,i=this.getAxisMotionValue(n);if(s&&s.layout){const{min:o,max:a}=s.layout.layoutBox[n];i.set(e[n]-ur(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:r}=this.visualElement;if(!Gc(n)||!r||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};mi(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const l=a.get();s[o]=$8({min:l,max:l},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),mi(o=>{if(!$h(o,e,null))return;const a=this.getAxisMotionValue(o),{min:l,max:u}=this.constraints[o];a.set(ur(l,u,s[o]))})}addListeners(){if(!this.visualElement.current)return;B8.set(this.visualElement,this);const e=this.visualElement.current,n=Od(e,"pointerdown",l=>{const{drag:u,dragListener:d=!0}=this.getProps();u&&d&&this.start(l)}),r=()=>{const{dragConstraints:l}=this.getProps();Gc(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,i=s.addEventListener("measure",r);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),Zn.read(r);const o=jf(window,"resize",()=>this.scalePositionWithinConstraints()),a=s.addEventListener("didUpdate",({delta:l,hasLayoutChanged:u})=>{this.isDragging&&u&&(mi(d=>{const f=this.getAxisMotionValue(d);f&&(this.originPoint[d]+=l[d].translate,f.set(f.get()+l[d].translate))}),this.visualElement.render())});return()=>{o(),n(),i(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:r=!1,dragPropagation:s=!1,dragConstraints:i=!1,dragElastic:o=A1,dragMomentum:a=!0}=e;return{...e,drag:n,dragDirectionLock:r,dragPropagation:s,dragConstraints:i,dragElastic:o,dragMomentum:a}}}function $h(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function H8(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class V8 extends el{constructor(e){super(e),this.removeGroupControls=Ei,this.removeListeners=Ei,this.controls=new U8(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ei}unmount(){this.removeGroupControls(),this.removeListeners()}}const a_=t=>(e,n)=>{t&&Zn.postRender(()=>t(e,n))};class W8 extends el{constructor(){super(...arguments),this.removePointerDownListener=Ei}onPointerDown(e){this.session=new bD(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:xD(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:r,onPanEnd:s}=this.node.getProps();return{onSessionStart:a_(e),onStart:a_(n),onMove:r,onEnd:(i,o)=>{delete this.session,s&&Zn.postRender(()=>s(i,o))}}}mount(){this.removePointerDownListener=Od(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const _p={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let sy=!1;class K8 extends x.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r,layoutId:s}=this.props,{projection:i}=e;i&&(n.group&&n.group.add(i),r&&r.register&&s&&r.register(i),sy&&i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),_p.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:r,drag:s,isPresent:i}=this.props,{projection:o}=r;return o&&(o.isPresent=i,sy=!0,s||e.layoutDependency!==n||n===void 0||e.isPresent!==i?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||Zn.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),rw.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r}=this.props,{projection:s}=e;sy=!0,s&&(s.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(s),r&&r.deregister&&r.deregister(s))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function wD(t){const[e,n]=UM(),r=x.useContext(_f);return c.jsx(K8,{...t,layoutGroup:r,switchLayoutGroup:x.useContext(tD),isPresent:e,safeToRemove:n})}function G8(t,e,n){const r=ps(t)?t:_u(t);return r.start(pw("",r,e,n)),r.animation}const q8=(t,e)=>t.depth-e.depth;class Y8{constructor(){this.children=[],this.isDirty=!1}add(e){zv(this.children,e),this.isDirty=!0}remove(e){Fv(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(q8),this.isDirty=!1,this.children.forEach(e)}}function J8(t,e){const n=$s.now(),r=({timestamp:s})=>{const i=s-n;i>=e&&(Ka(r),t(i-e))};return Zn.setup(r,!0),()=>Ka(r)}const kD=["TopLeft","TopRight","BottomLeft","BottomRight"],X8=kD.length,l_=t=>typeof t=="string"?parseFloat(t):t,c_=t=>typeof t=="number"||ln.test(t);function Q8(t,e,n,r,s,i){s?(t.opacity=ur(0,n.opacity??1,Z8(r)),t.opacityExit=ur(e.opacity??1,0,eH(r))):i&&(t.opacity=ur(e.opacity??1,n.opacity??1,r));for(let o=0;o<X8;o++){const a=`border${kD[o]}Radius`;let l=u_(e,a),u=u_(n,a);if(l===void 0&&u===void 0)continue;l||(l=0),u||(u=0),l===0||u===0||c_(l)===c_(u)?(t[a]=Math.max(ur(l_(l),l_(u),r),0),(xo.test(u)||xo.test(l))&&(t[a]+="%")):t[a]=u}(e.rotate||n.rotate)&&(t.rotate=ur(e.rotate||0,n.rotate||0,r))}function u_(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const Z8=SD(0,.5,aM),eH=SD(.5,.95,Ei);function SD(t,e,n){return r=>r<t?0:r>e?1:n(Tf(t,e,r))}function d_(t,e){t.min=e.min,t.max=e.max}function zi(t,e){d_(t.x,e.x),d_(t.y,e.y)}function f_(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function h_(t,e,n,r,s){return t-=e,t=mm(t,1/n,r),s!==void 0&&(t=mm(t,1/s,r)),t}function tH(t,e=0,n=1,r=.5,s,i=t,o=t){if(xo.test(e)&&(e=parseFloat(e),e=ur(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=ur(i.min,i.max,r);t===i&&(a-=e),t.min=h_(t.min,e,n,a,s),t.max=h_(t.max,e,n,a,s)}function p_(t,e,[n,r,s],i,o){tH(t,e[n],e[r],e[s],e.scale,i,o)}const nH=["x","scaleX","originX"],rH=["y","scaleY","originY"];function m_(t,e,n,r){p_(t.x,e,nH,n?n.x:void 0,r?r.x:void 0),p_(t.y,e,rH,n?n.y:void 0,r?r.y:void 0)}function g_(t){return t.translate===0&&t.scale===1}function _D(t){return g_(t.x)&&g_(t.y)}function y_(t,e){return t.min===e.min&&t.max===e.max}function sH(t,e){return y_(t.x,e.x)&&y_(t.y,e.y)}function x_(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function TD(t,e){return x_(t.x,e.x)&&x_(t.y,e.y)}function b_(t){return ks(t.x)/ks(t.y)}function v_(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class iH{constructor(){this.members=[]}add(e){zv(this.members,e),e.scheduleRender()}remove(e){if(Fv(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(s=>e===s);if(n===0)return!1;let r;for(let s=n;s>=0;s--){const i=this.members[s];if(i.isPresent!==!1){r=i;break}}return r?(this.promote(r),!0):!1}promote(e,n){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,n&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:s}=e.options;s===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:r}=e;n.onExitComplete&&n.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function oH(t,e,n){let r="";const s=t.x.translate/e.x,i=t.y.translate/e.y,o=(n==null?void 0:n.z)||0;if((s||i||o)&&(r=`translate3d(${s}px, ${i}px, ${o}px) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:u,rotate:d,rotateX:f,rotateY:h,skewX:p,skewY:m}=n;u&&(r=`perspective(${u}px) ${r}`),d&&(r+=`rotate(${d}deg) `),f&&(r+=`rotateX(${f}deg) `),h&&(r+=`rotateY(${h}deg) `),p&&(r+=`skewX(${p}deg) `),m&&(r+=`skewY(${m}deg) `)}const a=t.x.scale*e.x,l=t.y.scale*e.y;return(a!==1||l!==1)&&(r+=`scale(${a}, ${l})`),r||"none"}const iy=["","X","Y","Z"],aH=1e3;let lH=0;function oy(t,e,n,r){const{latestValues:s}=e;s[t]&&(n[t]=s[t],e.setStaticValue(t,0),r&&(r[t]=0))}function CD(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=dD(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:s,layoutId:i}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",Zn,!(s||i))}const{parent:r}=t;r&&!r.hasCheckedOptimisedAppear&&CD(r)}function ED({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:r,resetTransform:s}){return class{constructor(o={},a=e==null?void 0:e()){this.id=lH++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(dH),this.nodes.forEach(mH),this.nodes.forEach(gH),this.nodes.forEach(fH)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new Y8)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new Hv),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const l=this.eventHandlers.get(o);l&&l.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=BM(o)&&!qB(o),this.instance=o;const{layoutId:a,layout:l,visualElement:u}=this.options;if(u&&!u.current&&u.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(l||a)&&(this.isLayoutDirty=!0),t){let d,f=0;const h=()=>this.root.updateBlockedByResize=!1;Zn.read(()=>{f=window.innerWidth}),t(o,()=>{const p=window.innerWidth;p!==f&&(f=p,this.root.updateBlockedByResize=!0,d&&d(),d=J8(h,250),_p.hasAnimatedSinceResize&&(_p.hasAnimatedSinceResize=!1,this.nodes.forEach(S_)))})}a&&this.root.registerSharedNode(a,this),this.options.animate!==!1&&u&&(a||l)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:f,hasRelativeLayoutChanged:h,layout:p})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const m=this.options.transition||u.getDefaultTransition()||wH,{onLayoutAnimationStart:y,onLayoutAnimationComplete:b}=u.getProps(),g=!this.targetLayout||!TD(this.targetLayout,p),v=!f&&h;if(this.options.layoutRoot||this.resumeFrom||v||f&&(g||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const w={...tw(m,"layout"),onPlay:y,onComplete:b};(u.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w),this.setAnimationOrigin(d,v)}else f||S_(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=p})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Ka(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(yH),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&CD(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let d=0;d<this.path.length;d++){const f=this.path[d];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:a,layout:l}=this.options;if(a===void 0&&!l)return;const u=this.getTransformTemplate();this.prevTransformTemplateValue=u?u(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(w_);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(k_);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(pH),this.nodes.forEach(cH),this.nodes.forEach(uH)):this.nodes.forEach(k_),this.clearAllSnapshots();const a=$s.now();Xr.delta=Jo(0,1e3/60,a-Xr.timestamp),Xr.timestamp=a,Xr.isProcessing=!0,q0.update.process(Xr),q0.preRender.process(Xr),q0.render.process(Xr),Xr.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,rw.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(hH),this.sharedNodes.forEach(xH)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Zn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Zn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ks(this.snapshot.measuredBox.x)&&!ks(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=Ar(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a&&this.instance){const l=r(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:l,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!s)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!_D(this.projectionDelta),l=this.getTransformTemplate(),u=l?l(this.latestValues,""):void 0,d=u!==this.prevTransformTemplateValue;o&&this.instance&&(a||yl(this.latestValues)||d)&&(s(this.instance,u),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let l=this.removeElementScroll(a);return o&&(l=this.removeTransform(l)),kH(l),{animationId:this.root.animationId,measuredBox:a,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var u;const{visualElement:o}=this.options;if(!o)return Ar();const a=o.measureViewportBox();if(!(((u=this.scroll)==null?void 0:u.wasRoot)||this.path.some(SH))){const{scroll:d}=this.root;d&&(qc(a.x,d.offset.x),qc(a.y,d.offset.y))}return a}removeElementScroll(o){var l;const a=Ar();if(zi(a,o),(l=this.scroll)!=null&&l.wasRoot)return a;for(let u=0;u<this.path.length;u++){const d=this.path[u],{scroll:f,options:h}=d;d!==this.root&&f&&h.layoutScroll&&(f.wasRoot&&zi(a,o),qc(a.x,f.offset.x),qc(a.y,f.offset.y))}return a}applyTransform(o,a=!1){const l=Ar();zi(l,o);for(let u=0;u<this.path.length;u++){const d=this.path[u];!a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&Yc(l,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),yl(d.latestValues)&&Yc(l,d.latestValues)}return yl(this.latestValues)&&Yc(l,this.latestValues),l}removeTransform(o){const a=Ar();zi(a,o);for(let l=0;l<this.path.length;l++){const u=this.path[l];if(!u.instance||!yl(u.latestValues))continue;E1(u.latestValues)&&u.updateSnapshot();const d=Ar(),f=u.measurePageBox();zi(d,f),m_(a,u.latestValues,u.snapshot?u.snapshot.layoutBox:void 0,d)}return yl(this.latestValues)&&m_(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Xr.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var p;const a=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=a.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=a.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=a.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==a;if(!(o||l&&this.isSharedProjectionDirty||this.isProjectionDirty||(p=this.parent)!=null&&p.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:f}=this.options;if(!this.layout||!(d||f))return;this.resolvedRelativeTargetAt=Xr.timestamp;const h=this.getClosestProjectingParent();h&&this.linkedParentVersion!==h.layoutVersion&&!h.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(h&&h.layout?this.createRelativeTarget(h,this.layout.layoutBox,h.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Ar(),this.targetWithTransforms=Ar()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),M8(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):zi(this.target,this.layout.layoutBox),iD(this.target,this.targetDelta)):zi(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,h&&!!h.resumingFrom==!!this.resumingFrom&&!h.options.layoutScroll&&h.target&&this.animationProgress!==1?this.createRelativeTarget(h,this.target,h.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||E1(this.parent.latestValues)||sD(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(o,a,l){this.relativeParent=o,this.linkedParentVersion=o.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ar(),this.relativeTargetOrigin=Ar(),gm(this.relativeTargetOrigin,a,l),zi(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var m;const o=this.getLead(),a=!!this.resumingFrom||this!==o;let l=!0;if((this.isProjectionDirty||(m=this.parent)!=null&&m.isProjectionDirty)&&(l=!1),a&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===Xr.timestamp&&(l=!1),l)return;const{layout:u,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||d))return;zi(this.layoutCorrected,this.layout.layoutBox);const f=this.treeScale.x,h=this.treeScale.y;HU(this.layoutCorrected,this.treeScale,this.path,a),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=Ar());const{target:p}=o;if(!p){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(f_(this.prevProjectionDelta.x,this.projectionDelta.x),f_(this.prevProjectionDelta.y,this.projectionDelta.y)),Pd(this.projectionDelta,this.layoutCorrected,p,this.latestValues),(this.treeScale.x!==f||this.treeScale.y!==h||!v_(this.projectionDelta.x,this.prevProjectionDelta.x)||!v_(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",p))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var a;if((a=this.options.visualElement)==null||a.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Jc(),this.projectionDelta=Jc(),this.projectionDeltaWithTransform=Jc()}setAnimationOrigin(o,a=!1){const l=this.snapshot,u=l?l.latestValues:{},d={...this.latestValues},f=Jc();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const h=Ar(),p=l?l.source:void 0,m=this.layout?this.layout.source:void 0,y=p!==m,b=this.getStack(),g=!b||b.members.length<=1,v=!!(y&&!g&&this.options.crossfade===!0&&!this.path.some(vH));this.animationProgress=0;let w;this.mixTargetDelta=C=>{const I=C/1e3;__(f.x,o.x,I),__(f.y,o.y,I),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(gm(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),bH(this.relativeTarget,this.relativeTargetOrigin,h,I),w&&sH(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=Ar()),zi(w,this.relativeTarget)),y&&(this.animationValues=d,Q8(d,u,this.latestValues,I,v,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=I},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){var a,l,u;this.notifyListeners("animationStart"),(a=this.currentAnimation)==null||a.stop(),(u=(l=this.resumingFrom)==null?void 0:l.currentAnimation)==null||u.stop(),this.pendingAnimation&&(Ka(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Zn.update(()=>{_p.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=_u(0)),this.currentAnimation=G8(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:d=>{this.mixTargetDelta(d),o.onUpdate&&o.onUpdate(d)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(aH),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:l,layout:u,latestValues:d}=o;if(!(!a||!l||!u)){if(this!==o&&this.layout&&u&&ND(this.options.animationType,this.layout.layoutBox,u.layoutBox)){l=this.target||Ar();const f=ks(this.layout.layoutBox.x);l.x.min=o.target.x.min,l.x.max=l.x.min+f;const h=ks(this.layout.layoutBox.y);l.y.min=o.target.y.min,l.y.max=l.y.min+h}zi(a,l),Yc(a,d),Pd(this.projectionDeltaWithTransform,this.layoutCorrected,a,d)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new iH),this.sharedNodes.get(o).add(a);const u=a.options.initialPromotionConfig;a.promote({transition:u?u.transition:void 0,preserveFollowOpacity:u&&u.shouldPreserveFollowOpacity?u.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var a;const{layoutId:o}=this.options;return o?((a=this.getStack())==null?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:o}=this.options;return o?(a=this.getStack())==null?void 0:a.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:l}={}){const u=this.getStack();u&&u.promote(this,l),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:l}=o;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(a=!0),!a)return;const u={};l.z&&oy("z",o,u,this.animationValues);for(let d=0;d<iy.length;d++)oy(`rotate${iy[d]}`,o,u,this.animationValues),oy(`skew${iy[d]}`,o,u,this.animationValues);o.render();for(const d in u)o.setStaticValue(d,u[d]),this.animationValues&&(this.animationValues[d]=u[d]);o.scheduleRender()}applyProjectionStyles(o,a){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const l=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=Sp(a==null?void 0:a.pointerEvents)||"",o.transform=l?l(this.latestValues,""):"none";return}const u=this.getLead();if(!this.projectionDelta||!this.layout||!u.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=Sp(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!yl(this.latestValues)&&(o.transform=l?l({},""):"none",this.hasProjected=!1);return}o.visibility="";const d=u.animationValues||u.latestValues;this.applyTransformsToTarget();let f=oH(this.projectionDeltaWithTransform,this.treeScale,d);l&&(f=l(d,f)),o.transform=f;const{x:h,y:p}=this.projectionDelta;o.transformOrigin=`${h.origin*100}% ${p.origin*100}% 0`,u.animationValues?o.opacity=u===this?d.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:o.opacity=u===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const m in C1){if(d[m]===void 0)continue;const{correct:y,applyTo:b,isCSSVariable:g}=C1[m],v=f==="none"?d[m]:y(d[m],u);if(b){const w=b.length;for(let C=0;C<w;C++)o[b[C]]=v}else g?this.options.visualElement.renderState.vars[m]=v:o[m]=v}this.options.layoutId&&(o.pointerEvents=u===this?Sp(a==null?void 0:a.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var a;return(a=o.currentAnimation)==null?void 0:a.stop()}),this.root.nodes.forEach(w_),this.root.sharedNodes.clear()}}}function cH(t){t.updateLayout()}function uH(t){var n;const e=((n=t.resumeFrom)==null?void 0:n.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:s}=t.layout,{animationType:i}=t.options,o=e.source!==t.layout.source;i==="size"?mi(f=>{const h=o?e.measuredBox[f]:e.layoutBox[f],p=ks(h);h.min=r[f].min,h.max=h.min+p}):ND(i,e.layoutBox,r)&&mi(f=>{const h=o?e.measuredBox[f]:e.layoutBox[f],p=ks(r[f]);h.max=h.min+p,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[f].max=t.relativeTarget[f].min+p)});const a=Jc();Pd(a,r,e.layoutBox);const l=Jc();o?Pd(l,t.applyTransform(s,!0),e.measuredBox):Pd(l,r,e.layoutBox);const u=!_D(a);let d=!1;if(!t.resumeFrom){const f=t.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:h,layout:p}=f;if(h&&p){const m=Ar();gm(m,e.layoutBox,h.layoutBox);const y=Ar();gm(y,r,p.layoutBox),TD(m,y)||(d=!0),f.options.layoutRoot&&(t.relativeTarget=y,t.relativeTargetOrigin=m,t.relativeParent=f)}}}t.notifyListeners("didUpdate",{layout:r,snapshot:e,delta:l,layoutDelta:a,hasLayoutChanged:u,hasRelativeLayoutChanged:d})}else if(t.isLead()){const{onExitComplete:r}=t.options;r&&r()}t.options.transition=void 0}function dH(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function fH(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function hH(t){t.clearSnapshot()}function w_(t){t.clearMeasurements()}function k_(t){t.isLayoutDirty=!1}function pH(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function S_(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function mH(t){t.resolveTargetDelta()}function gH(t){t.calcProjection()}function yH(t){t.resetSkewAndRotation()}function xH(t){t.removeLeadSnapshot()}function __(t,e,n){t.translate=ur(e.translate,0,n),t.scale=ur(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function T_(t,e,n,r){t.min=ur(e.min,n.min,r),t.max=ur(e.max,n.max,r)}function bH(t,e,n,r){T_(t.x,e.x,n.x,r),T_(t.y,e.y,n.y,r)}function vH(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const wH={duration:.45,ease:[.4,0,.1,1]},C_=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),E_=C_("applewebkit/")&&!C_("chrome/")?Math.round:Ei;function N_(t){t.min=E_(t.min),t.max=E_(t.max)}function kH(t){N_(t.x),N_(t.y)}function ND(t,e,n){return t==="position"||t==="preserve-aspect"&&!I8(b_(e),b_(n),.2)}function SH(t){var e;return t!==t.root&&((e=t.scroll)==null?void 0:e.wasRoot)}const _H=ED({attachResizeListener:(t,e)=>jf(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),ay={current:void 0},jD=ED({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!ay.current){const t=new _H({});t.mount(window),t.setOptions({layoutScroll:!0}),ay.current=t}return ay.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),TH={pan:{Feature:W8},drag:{Feature:V8,ProjectionNode:jD,MeasureLayout:wD}};function j_(t,e,n){const{props:r}=t;t.animationState&&r.whileHover&&t.animationState.setActive("whileHover",n==="Start");const s="onHover"+n,i=r[s];i&&Zn.postRender(()=>i(e,sh(e)))}class CH extends el{mount(){const{current:e}=this.node;e&&(this.unmount=HB(e,(n,r)=>(j_(this.node,r,"Start"),s=>j_(this.node,s,"End"))))}unmount(){}}class EH extends el{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=th(jf(this.node.current,"focus",()=>this.onFocus()),jf(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function I_(t,e,n){const{props:r}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&r.whileTap&&t.animationState.setActive("whileTap",n==="Start");const s="onTap"+(n==="End"?"":n),i=r[s];i&&Zn.postRender(()=>i(e,sh(e)))}class NH extends el{mount(){const{current:e}=this.node;e&&(this.unmount=GB(e,(n,r)=>(I_(this.node,r,"Start"),(s,{success:i})=>I_(this.node,s,i?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const R1=new WeakMap,ly=new WeakMap,jH=t=>{const e=R1.get(t.target);e&&e(t)},IH=t=>{t.forEach(jH)};function MH({root:t,...e}){const n=t||document;ly.has(n)||ly.set(n,{});const r=ly.get(n),s=JSON.stringify(e);return r[s]||(r[s]=new IntersectionObserver(IH,{root:t,...e})),r[s]}function DH(t,e,n){const r=MH(e);return R1.set(t,n),r.observe(t),()=>{R1.delete(t),r.unobserve(t)}}const AH={some:0,all:1};class RH extends el{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:r,amount:s="some",once:i}=e,o={root:n?n.current:void 0,rootMargin:r,threshold:typeof s=="number"?s:AH[s]},a=l=>{const{isIntersecting:u}=l;if(this.isInView===u||(this.isInView=u,i&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:d,onViewportLeave:f}=this.node.getProps(),h=u?d:f;h&&h(l)};return DH(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(OH(e,n))&&this.startObserver()}unmount(){}}function OH({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const PH={inView:{Feature:RH},tap:{Feature:NH},focus:{Feature:EH},hover:{Feature:CH}},LH={layout:{ProjectionNode:jD,MeasureLayout:wD}},$H={..._8,...PH,...TH,...LH},Pr=FU($H,ZU),zH=({url:t,fileName:e,autoPlay:n=!1,markers:r=[],onClose:s,seekToTime:i})=>{const o=x.useRef(null),[a,l]=x.useState(n),[u,d]=x.useState(0),[f,h]=x.useState(0);x.useEffect(()=>{n&&o.current&&o.current.play().catch(console.error)},[t,n]);const p=()=>{o.current&&(a?o.current.pause():o.current.play(),l(!a))},m=()=>{o.current&&h(o.current.currentTime)},y=()=>{o.current&&d(o.current.duration)},b=C=>{const I=parseFloat(C.target.value);o.current&&(o.current.currentTime=I,h(I))},g=C=>{if(o.current){const I=Math.min(Math.max(o.current.currentTime+C,0),u);o.current.currentTime=I,h(I)}},v=C=>{if(o.current){const I=C/1e3;o.current.currentTime=I,h(I),o.current.play().catch(console.error),l(!0)}};x.useEffect(()=>{i!=null&&o.current&&v(i)},[i]);const w=C=>{if(isNaN(C))return"0:00";const I=Math.floor(C/60),k=Math.floor(C%60);return`${I}:${k.toString().padStart(2,"0")}`};return c.jsxs("div",{className:"w-full bg-slate-50 border border-indigo-100 rounded-xl p-3 mb-4 animate-in fade-in slide-in-from-top-2 flex flex-col gap-2 shadow-sm sticky top-0 z-10 backdrop-blur-sm bg-slate-50/95",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 flex-shrink-0",children:c.jsx(u1,{size:16})}),c.jsx("span",{className:"text-xs font-medium text-slate-700 truncate",title:e,children:e||"Audio Recording"}),r.length>0&&c.jsxs("span",{className:"text-[10px] text-slate-400 bg-slate-200 px-1.5 py-0.5 rounded-full",children:[r.length," "]})]}),s&&c.jsx("button",{onClick:s,className:"p-1 hover:bg-slate-200 rounded-full text-slate-400 hover:text-slate-600 transition-colors",children:c.jsx(un,{size:14})})]}),c.jsx("audio",{ref:o,src:t,onTimeUpdate:m,onLoadedMetadata:y,onEnded:()=>l(!1),className:"hidden"}),c.jsxs("div",{className:"flex items-center justify-between gap-3",children:[c.jsxs("button",{onClick:()=>g(-5),className:"flex items-center gap-0.5 px-2 py-1 text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors text-xs",title:" 5 ",children:[c.jsx(WI,{size:14}),c.jsx("span",{className:"font-mono text-[10px]",children:"5s"})]}),c.jsx("button",{onClick:p,className:"w-10 h-10 flex items-center justify-center bg-indigo-600 text-white rounded-full hover:bg-indigo-700 shadow-md transition-all active:scale-95",children:a?c.jsx(UI,{size:20,fill:"currentColor"}):c.jsx(HI,{size:20,fill:"currentColor",className:"ml-1"})}),c.jsxs("button",{onClick:()=>g(5),className:"flex items-center gap-0.5 px-2 py-1 text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors text-xs",title:" 5 ",children:[c.jsx("span",{className:"font-mono text-[10px]",children:"5s"}),c.jsx(Vz,{size:14})]}),c.jsxs("div",{className:"flex-1 flex items-center gap-2 min-w-0",children:[c.jsx("span",{className:"text-[10px] font-mono tabular-nums text-slate-500 w-8 text-right",children:w(f)}),c.jsxs("div",{className:"relative flex-1 h-8 flex items-center group select-none",children:[c.jsx("div",{className:"absolute inset-0 flex items-center pointer-events-none",children:c.jsx("div",{className:"w-full h-1 bg-slate-200 rounded-full overflow-visible relative",children:c.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-100 rounded-full",style:{width:`${f/(u||1)*100}%`}})})}),c.jsx("input",{type:"range",min:0,max:u||100,value:f,onChange:b,className:"absolute inset-0 w-full opacity-0 cursor-pointer z-10"})]}),c.jsx("span",{className:"text-[10px] font-mono tabular-nums text-slate-500 w-8",children:w(u)})]})]})]})},ID=({checked:t,isCanceled:e=!1,onChange:n,size:r=18,color:s="blue",isRoot:i=!1})=>{const o={gray:{root:"bg-gray-500 border-gray-500 text-white",sub:"bg-gray-100 border-gray-200 text-gray-500",hover:"hover:border-gray-500",border:"border-gray-400"},blue:{root:"bg-blue-500 border-blue-500 text-white",sub:"bg-blue-100 border-blue-200 text-blue-500",hover:"hover:border-blue-500",border:"border-blue-400"},indigo:{root:"bg-indigo-500 border-indigo-500 text-white",sub:"bg-indigo-100 border-indigo-200 text-indigo-500",hover:"hover:border-indigo-500",border:"border-indigo-400"},red:{root:"bg-red-500 border-red-500 text-white",sub:"bg-red-100 border-red-200 text-red-500",hover:"hover:border-red-500",border:"border-red-400"},orange:{root:"bg-orange-500 border-orange-500 text-white",sub:"bg-orange-100 border-orange-200 text-orange-500",hover:"hover:border-orange-500",border:"border-orange-400"},amber:{root:"bg-amber-500 border-amber-500 text-white",sub:"bg-amber-100 border-amber-200 text-amber-500",hover:"hover:border-amber-500",border:"border-amber-400"},green:{root:"bg-emerald-500 border-emerald-500 text-white",sub:"bg-emerald-100 border-emerald-200 text-emerald-500",hover:"hover:border-emerald-500",border:"border-emerald-400"},teal:{root:"bg-teal-500 border-teal-500 text-white",sub:"bg-teal-100 border-teal-200 text-teal-500",hover:"hover:border-teal-500",border:"border-teal-400"},cyan:{root:"bg-cyan-500 border-cyan-500 text-white",sub:"bg-cyan-100 border-cyan-200 text-cyan-500",hover:"hover:border-cyan-500",border:"border-cyan-400"},sky:{root:"bg-sky-500 border-sky-500 text-white",sub:"bg-sky-100 border-sky-200 text-sky-500",hover:"hover:border-sky-500",border:"border-sky-400"},purple:{root:"bg-purple-500 border-purple-500 text-white",sub:"bg-purple-100 border-purple-200 text-purple-500",hover:"hover:border-purple-500",border:"border-purple-400"},fuchsia:{root:"bg-fuchsia-500 border-fuchsia-500 text-white",sub:"bg-fuchsia-100 border-fuchsia-200 text-fuchsia-500",hover:"hover:border-fuchsia-500",border:"border-fuchsia-400"},pink:{root:"bg-pink-500 border-pink-500 text-white",sub:"bg-pink-100 border-pink-200 text-pink-500",hover:"hover:border-pink-500",border:"border-pink-400"},rose:{root:"bg-rose-500 border-rose-500 text-white",sub:"bg-rose-100 border-rose-200 text-rose-500",hover:"hover:border-rose-500",border:"border-rose-400"}},a=o[s]||o.gray,l=i?a.root:a.sub,d=`bg-transparent ${i?"border-2":""} ${a.border} ${a.hover}`;return c.jsx("div",{onClick:n,className:`group relative cursor-pointer flex items-center justify-center transition-all duration-200 ease-out border shadow-sm ${t||e?l:d}`,style:{width:r,height:r,borderRadius:r*.25},children:e?c.jsx(un,{size:r*.7,className:"text-current scale-100 opacity-100",strokeWidth:3}):c.jsx(Xn,{size:r*.7,className:`transition-all duration-300 ease-back-out ${t?"scale-100 opacity-100":"scale-50 opacity-0"}`,strokeWidth:3})})},M_=({label:t,value:e,onChange:n,theme:r,tasks:s,innerRef:i,colorClass:o})=>{const{themeSettings:a,language:l,t:u}=x.useContext(En),[d,f]=x.useState(""),[h,p]=x.useState(!1),[m,y]=x.useState(new Date),[b,g]=x.useState(null),[v,w]=x.useState(null),[C,I]=x.useState({top:0,left:0}),k=x.useRef(null),D=x.useRef(null),S=x.useRef(!1),T=x.useRef(!1),_=x.useRef(null),N=i||_;x.useEffect(()=>{const se=Se=>{h&&k.current&&!k.current.contains(Se.target)&&D.current&&!D.current.contains(Se.target)&&(p(!1),f(""),w(null))};return document.addEventListener("mousedown",se),()=>document.removeEventListener("mousedown",se)},[h]),x.useEffect(()=>{if(e){const se=new Date(e);isNaN(se.getTime())||y(se)}},[e]);const A=se=>{const Se=se.target.value;f(Se);const ce=U6(Se);ce?(y(ce),w(ce),g(ce)):w(null)},O=()=>{var Se;const se=v||b||m;if(se){if(e){const ce=new Date(e);se.setHours(ce.getHours(),ce.getMinutes())}n(se.toISOString()),p(!1),f(""),T.current=!0,(Se=N.current)==null||Se.focus(),setTimeout(()=>T.current=!1,200)}},L=()=>{if(N.current){const se=N.current.getBoundingClientRect(),Se=window.innerWidth,ce=window.innerHeight,Ee=288,He=400;let tt=se.left,ut=se.bottom+8;ut+He>ce&&se.top-He>0&&(ut=se.top-He-8),tt+Ee>Se&&(tt=Se-Ee-10),I({top:ut,left:tt})}},V=se=>{var Se;se.key==="Enter"?(se.preventDefault(),se.metaKey||se.ctrlKey||se.stopPropagation(),h?O():(L(),p(!0))):se.key==="Escape"?(se.preventDefault(),h&&(se.stopPropagation(),p(!1),f(""),T.current=!0,(Se=N.current)==null||Se.focus(),setTimeout(()=>T.current=!1,200))):se.key===" "&&(se.preventDefault(),se.stopPropagation(),L(),p(!0))},E=se=>{},j=se=>{S.current||T.current||(L(),p(!0))},H=()=>{h||L(),p(!h)},W=se=>s.filter(Se=>{if(Se.status==="completed"||Se.status==="deleted")return!1;const ce=Se.start_date?new Date(Se.start_date):null,Ee=Se.due_date?new Date(Se.due_date):null;return ce&&_i(ce,se)||Ee&&_i(Ee,se)}),R=se=>{const Se=new Date(m.getFullYear(),m.getMonth(),se);y(Se),g(Se),w(Se)},ae=()=>{const se=new Date(m.getFullYear(),m.getMonth()+1,0).getDate(),Se=new Date(m.getFullYear(),m.getMonth(),1).getDay(),ce=[];for(let Ee=0;Ee<Se;Ee++)ce.push(c.jsx("div",{className:"h-8 w-8"},`empty-${Ee}`));for(let Ee=1;Ee<=se;Ee++){const He=new Date(m.getFullYear(),m.getMonth(),Ee),tt=e&&_i(new Date(e),He),ut=v&&_i(v,He),mt=W(He).length;let ht="bg-transparent";mt>=1&&mt<=3?ht="bg-green-400":mt>=4&&mt<=10?ht="bg-yellow-400":mt>10&&(ht="bg-red-500");const Ie=Iv(He.toISOString());let ge="h-8 w-8 rounded-full flex items-center justify-center text-xs relative transition-all ";ut?ge+="bg-indigo-600/80 text-white font-bold shadow-md":tt?ge+="bg-indigo-500 text-white font-bold":(ge+="hover:bg-theme-hover text-theme-primary",Ie&&(ge+=" text-red-500 font-bold")),Ie?ge+=" border-2 border-red-400":ge+=" border-2 border-transparent",ce.push(c.jsxs("button",{type:"button",onMouseDown:ie=>ie.preventDefault(),onClick:()=>R(Ee),onMouseEnter:()=>g(He),className:ge,children:[Ee,!tt&&!ut&&mt>0&&c.jsx("div",{className:`absolute bottom-1 w-1 h-1 rounded-full ${ht}`})]},Ee))}return ce},re=v||b||(e?new Date(e):null),$=re?W(re):[],z=(r==null?void 0:r.buttonRing)||"focus:ring-indigo-300 focus:border-indigo-300",le=o||(r==null?void 0:r.text)||"text-theme-tertiary",$e={small:"text-[11px]",normal:"text-xs",large:"text-sm"}[a.fontSize]||"text-xs",Be=a.fontWeight==="thin"?"font-light":"font-medium";return c.jsxs("div",{className:"relative",ref:k,onBlur:E,children:[c.jsxs("button",{ref:N,type:"button",onMouseDown:()=>{S.current=!0,setTimeout(()=>S.current=!1,200)},onClick:H,onKeyDown:V,onFocus:j,className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border ${$e} ${Be} ${z}
            ${e?`${le} border-theme bg-theme-hover hover:border-theme-hover hover:scale-[1.02]`:"text-theme-tertiary border-transparent hover:bg-theme-hover hover:text-theme-secondary"}
            focus:outline-none focus:bg-theme-card focus:ring-1 focus:border-theme
        `,children:[c.jsx(vo,{size:13}),c.jsx("span",{children:e?SI(e,!1,l):t}),e&&c.jsx(un,{size:12,className:"ml-1 hover:text-red-500",onClick:se=>{se.stopPropagation(),n(null)}})]}),h&&ir.createPortal(c.jsxs("div",{ref:D,className:"fixed bg-theme-card rounded-xl shadow-2xl border border-theme p-4 z-[99999] w-72 max-w-[90vw] animate-in fade-in zoom-in duration-100",style:{top:C.top,left:C.left},onClick:se=>se.stopPropagation(),onMouseDown:se=>se.stopPropagation(),children:[c.jsxs("div",{className:"mb-3 relative",children:[c.jsx("input",{autoFocus:!0,type:"text",placeholder:u("dateInputPlaceholder"),className:"w-full text-xs box-border bg-theme-main border border-theme rounded p-2 text-theme-primary focus:ring-2 focus:ring-indigo-500/50 outline-none pr-8",value:d,onChange:A,onKeyDown:V}),v&&c.jsxs("div",{className:"absolute right-2 top-2 text-[10px] text-indigo-500 font-bold bg-theme-hover px-1 rounded animate-pulse",children:[u("identified"),": ",H6(v.toISOString(),l)]})]}),c.jsxs("div",{className:"flex justify-between items-center mb-2 text-theme-primary",children:[c.jsx("button",{type:"button",onMouseDown:se=>se.preventDefault(),onClick:()=>y(new Date(m.getFullYear(),m.getMonth()-1,1)),className:"p-1 hover:bg-theme-hover rounded",children:c.jsx($u,{size:16})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"font-bold text-sm cursor-pointer hover:text-indigo-500 transition-colors",title:u("backToToday"),onClick:()=>y(new Date),children:m.toLocaleString(l==="zh"?"zh-TW":"en-US",{month:"long",year:"numeric"})}),c.jsx("button",{type:"button",onMouseDown:se=>se.preventDefault(),onClick:()=>y(new Date),className:"text-[10px] px-1.5 py-0.5 bg-indigo-50 text-indigo-600 rounded-full hover:bg-indigo-100 font-bold",children:""})]}),c.jsx("button",{type:"button",onMouseDown:se=>se.preventDefault(),onClick:()=>y(new Date(m.getFullYear(),m.getMonth()+1,1)),className:"p-1 hover:bg-theme-hover rounded",children:c.jsx(rs,{size:16})})]}),c.jsxs("div",{className:"grid grid-cols-7 gap-1 mb-2 text-center text-xs font-bold text-theme-tertiary",children:[(l==="zh"?["","","","","","",""]:["S","M","T","W","T","F","S"]).map(se=>c.jsx("span",{children:se},se)),ae()]}),c.jsxs("div",{className:"border-t border-theme pt-3 mt-3",children:[c.jsxs("div",{className:"text-[10px] font-bold text-theme-tertiary mb-2 flex justify-between items-center",children:[c.jsx("span",{children:re?`${re.getMonth()+1}/${re.getDate()} ${u("scheduleTitle")}`:u("scheduleTitle")}),c.jsx("span",{className:"bg-theme-hover px-1.5 rounded text-theme-secondary",children:$.length})]}),c.jsx("div",{className:"max-h-24 overflow-y-auto space-y-1 custom-scrollbar",children:$.length>0?$.map(se=>c.jsx("div",{className:"text-[10px] bg-theme-hover p-1 rounded truncate border-l-2 border-indigo-400 pl-2 text-theme-secondary",children:se.title},se.id)):c.jsx("div",{className:"text-[10px] text-theme-tertiary italic text-center py-2",children:u("noSchedule")})})]}),c.jsx("button",{type:"button",onMouseDown:se=>se.preventDefault(),onClick:O,className:"w-full mt-3 bg-indigo-600 text-white text-xs font-bold py-1.5 rounded hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-500/20",children:u("confirmDate")})]}),document.body)]})},O1=({icon:t,label:e,items:n,selectedIds:r,onSelect:s,onSearch:i,placeholder:o,allowAdd:a,onDeleteItem:l,innerRef:u,multiSelect:d=!1,theme:f})=>{const{themeSettings:h,t:p}=x.useContext(En),[m,y]=x.useState(!1),[b,g]=x.useState(""),[v,w]=x.useState(-1),[C,I]=x.useState({top:0,left:0}),[k,D]=x.useState(!1),[S,T]=x.useState(null),[_,N]=x.useState(null),[A,O]=x.useState(""),[L,V]=x.useState(-1),E=x.useRef(null),j=x.useRef(null),H=x.useRef(!1),W=x.useRef(!1),R=x.useRef(null),ae=x.useRef(null),re=x.useRef(null),$=u||re;x.useEffect(()=>{const X=he=>{m&&E.current&&!E.current.contains(he.target)&&j.current&&!j.current.contains(he.target)&&(y(!1),g(""),D(!1),T(null),N(null))};return document.addEventListener("mousedown",X),()=>document.removeEventListener("mousedown",X)},[m]);const z=x.useMemo(()=>!n||!Array.isArray(n)?[]:n.filter(X=>X?(X.title||X.name||"").toLowerCase().includes(b.toLowerCase()):!1),[n,b]),le=x.useMemo(()=>!n||!Array.isArray(n)?[]:n.filter(X=>X?(X.title||X.name||"").toLowerCase().includes(A.toLowerCase()):!1),[n,A]),$e=a&&b.trim()&&!z.some(X=>(X.title||X.name||"").toLowerCase()===b.trim().toLowerCase()),Be=z.length+($e?1:0),se=x.useMemo(()=>r.length===0?null:n.find(X=>r.includes(X.id)),[n,r]),Se=se&&(se.title||se.name)||e,ce=(X,he,ke)=>{var ee;s(X,he,ke),d?(g(""),w(-1),y(!0),setTimeout(()=>{var pe;return(pe=R.current)==null?void 0:pe.focus()},0)):(g(""),y(!1),H.current=!0,(ee=$.current)==null||ee.focus(),setTimeout(()=>H.current=!1,200)),D(!1),T(null),N(null),O("")},Ee=()=>{T(b.trim()),D(!0),O(""),setTimeout(()=>{var X;return(X=ae.current)==null?void 0:X.focus()},50)},He=()=>{S&&ce(null,S,_)},tt=()=>{D(!1),T(null),N(null),O(""),setTimeout(()=>{var X;return(X=R.current)==null?void 0:X.focus()},50)},ut=()=>{if($.current){const X=$.current.getBoundingClientRect(),he=window.innerWidth,ke=window.innerHeight,ee=280,pe=350;let Re=X.left,_t=X.bottom+8;_t+pe>ke&&X.top-pe>0&&(_t=X.top-pe-8),Re+ee>he&&(Re=he-ee-10),I({top:_t,left:Re})}},Ge=X=>{var he,ke,ee;if(k){const pe=le.length+1;if(X.key==="Escape")X.preventDefault(),X.stopPropagation(),tt();else if(X.key==="ArrowDown"){X.preventDefault();const Re=L+1>=pe?-1:L+1;V(Re),N(Re===-1?null:((he=le[Re])==null?void 0:he.id)||null)}else if(X.key==="ArrowUp"){X.preventDefault();const Re=L-1<-1?pe-1:L-1;V(Re),N(Re===-1?null:((ke=le[Re])==null?void 0:ke.id)||null)}else X.key==="Enter"&&(X.preventDefault(),X.stopPropagation(),He());return}X.key==="ArrowDown"?(X.preventDefault(),m||(ut(),y(!0)),w(pe=>pe===-1?0:(pe+1)%Be)):X.key==="ArrowUp"?(X.preventDefault(),m||(ut(),y(!0)),w(pe=>pe<=0?Be-1:pe-1)):X.key==="Enter"?(X.preventDefault(),X.metaKey||X.ctrlKey||X.stopPropagation(),m?v>=0&&v<z.length?ce(z[v].id):$e&&(v===z.length||v===-1)&&Ee():(ut(),y(!0))):X.key==="Escape"&&(X.preventDefault(),m&&(X.stopPropagation(),y(!1),H.current=!0,(ee=$.current)==null||ee.focus(),setTimeout(()=>H.current=!1,200)))},mt=X=>{},ht=X=>{W.current||H.current||(ut(),y(!0))},Ie=()=>{m||ut(),y(!m)},ge=(f==null?void 0:f.buttonRing)||"focus:ring-indigo-300 focus:border-indigo-300",ie={small:"text-[11px]",normal:"text-xs",large:"text-sm"}[h.fontSize]||"text-xs",me=h.fontWeight==="thin"?"font-light":"font-medium",Q=X=>{if(!X)return null;const he=n.find(ke=>ke.id===X);return he?he.title||he.name:null};return c.jsxs("div",{className:"relative",ref:E,onBlur:mt,children:[c.jsxs("button",{ref:$,type:"button",onMouseDown:()=>{W.current=!0,setTimeout(()=>W.current=!1,200)},onClick:Ie,onKeyDown:Ge,onFocus:ht,className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border ${ie} ${me}
                    ${r.length>0?"text-indigo-600 bg-theme-hover border-theme shadow-sm":"text-theme-tertiary border-transparent hover:bg-theme-hover hover:text-theme-secondary"}
                    focus:outline-none focus:bg-theme-card focus:ring-1 focus:border-theme ${ge}`,children:[c.jsx(t,{size:13})," ",c.jsx("span",{className:"truncate max-w-[80px]",children:Se})]}),m&&ir.createPortal(c.jsx("div",{ref:j,className:"fixed bg-theme-card rounded-lg shadow-xl border border-theme z-[99999] w-72 p-2 animate-in fade-in zoom-in duration-100",style:{top:C.top,left:C.left},onClick:X=>X.stopPropagation(),onMouseDown:X=>X.stopPropagation(),children:k?c.jsxs("div",{className:"animate-in slide-in-from-right-2 duration-150",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-theme",children:[c.jsx("button",{type:"button",onClick:tt,className:"text-xs text-theme-tertiary hover:text-theme-primary transition-colors",children:" "}),c.jsxs("span",{className:"text-xs font-medium text-theme-primary",children:[' "',S,'"']})]}),c.jsxs("div",{className:"mb-2",children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-theme-tertiary mb-1",children:[c.jsx(_z,{size:11}),c.jsx("span",{children:""})]}),c.jsx("input",{ref:ae,type:"text",placeholder:"...",className:"w-full text-xs box-border bg-theme-main border border-theme rounded p-2 text-theme-primary focus:ring-1 focus:ring-indigo-500/50 outline-none",value:A,onChange:X=>O(X.target.value),onKeyDown:Ge})]}),c.jsxs("div",{className:"max-h-40 overflow-y-auto space-y-0.5 custom-scrollbar mb-2",children:[c.jsxs("div",{onMouseDown:X=>{X.preventDefault(),N(null),V(-1)},onMouseEnter:()=>V(-1),className:`px-2 py-1.5 text-xs rounded cursor-pointer flex items-center justify-between ${L===-1?"bg-indigo-50 text-indigo-700 ring-1 ring-indigo-200":"text-theme-secondary hover:bg-theme-hover"}`,children:[c.jsx("span",{className:"text-theme-tertiary italic",children:""}),_===null&&c.jsx(Xn,{size:12,className:"text-indigo-600"})]}),le.map((X,he)=>c.jsxs("div",{onMouseDown:ke=>{ke.preventDefault(),N(X.id),V(he)},onMouseEnter:()=>V(he),className:`px-2 py-1.5 text-xs rounded cursor-pointer flex items-center justify-between ${L===he?"bg-indigo-50 text-indigo-700 ring-1 ring-indigo-200":"text-theme-secondary hover:bg-theme-hover"}`,style:{paddingLeft:X.depth?`${X.depth*12+8}px`:"8px"},children:[c.jsxs("div",{className:"flex items-center gap-1.5 truncate",children:[c.jsx("span",{className:"truncate",children:X.title||X.name}),X.parentName&&c.jsx("span",{className:"text-[9px] text-theme-tertiary font-normal bg-theme-hover px-1 rounded truncate",children:X.parentName})]}),_===X.id&&c.jsx(Xn,{size:12,className:"text-indigo-600"})]},X.id))]}),_&&c.jsxs("div",{className:"text-[10px] text-theme-tertiary mb-2 px-1",children:[" ",c.jsx("span",{className:"font-medium text-indigo-600",children:Q(_)})," "]}),c.jsxs("button",{type:"button",onClick:He,className:"w-full py-2 px-3 bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-medium rounded-lg transition-colors flex items-center justify-center gap-1.5",children:[c.jsx(ni,{size:14}),""]})]}):c.jsxs(c.Fragment,{children:[c.jsx("input",{ref:R,autoFocus:!0,type:"text",placeholder:o,className:"w-full text-xs box-border bg-theme-main border-none rounded p-2 mb-1 text-theme-primary focus:ring-1 focus:ring-indigo-500/50 outline-none",value:b,onChange:X=>{g(X.target.value),w(-1),i&&i(X.target.value)},onKeyDown:Ge}),c.jsxs("div",{className:"max-h-48 overflow-y-auto space-y-0.5 custom-scrollbar",children:[z.map((X,he)=>c.jsxs("div",{onMouseDown:ke=>{ke.preventDefault(),ce(X.id)},onMouseEnter:()=>w(he),className:`px-2 py-1.5 text-xs rounded cursor-pointer flex items-center justify-between group ${he===v?"bg-theme-selection text-theme-primary":"text-theme-secondary hover:bg-theme-hover"}`,style:{paddingLeft:X.depth?`${X.depth*12+8}px`:"8px"},children:[c.jsxs("div",{className:"flex items-center gap-1.5 truncate",children:[c.jsx("span",{className:"truncate",children:X.title||X.name}),X.parentName&&c.jsxs("span",{className:"text-[9px] text-theme-tertiary font-normal bg-theme-hover px-1 rounded truncate",children:[p("from"),": ",X.parentName]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[r.includes(X.id)&&c.jsx(Xn,{size:12,className:"text-indigo-600"}),l&&c.jsx(Er,{size:12,className:"text-gray-400 opacity-0 group-hover:opacity-100 hover:text-red-500",onClick:ke=>{ke.stopPropagation(),l(X.id)}})]})]},X.id)),$e&&c.jsxs("div",{onMouseEnter:()=>w(z.length),className:`px-2 py-1.5 text-xs cursor-pointer rounded flex items-center gap-1 ${v===z.length?"bg-theme-selection text-theme-primary":"text-indigo-600 hover:bg-theme-hover"}`,onMouseDown:X=>{X.preventDefault(),Ee()},children:[c.jsx(ni,{size:12})," ",p("addNewTag"),' "',b,'"',c.jsx(rs,{size:12,className:"ml-auto opacity-50"})]})]})]})}),document.body)]})},MD=({tag:t,onRemove:e,size:n="normal"})=>{const{themeSettings:r,tagsWithResolvedColors:s}=x.useContext(En),i={small:{text:{small:"text-[8px]",normal:"text-[9px]",large:"text-[10px]"},padding:"px-1.5 py-0.5"},normal:{text:{small:"text-[9px]",normal:"text-[10px]",large:"text-xs"},padding:"px-2 py-0.5"}},o=i[n].text[r.fontSize]||i[n].text.normal,a=i[n].padding,l=r.fontWeight==="thin"?"font-light":"font-normal";return c.jsxs("div",{className:`inline-flex items-center gap-1 bg-theme-hover text-theme-secondary ${a} rounded-md border border-theme ${o} ${l}`,children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:s[t.id]||t.color}}),c.jsx("span",{children:t.name}),e&&c.jsx("button",{type:"button",onClick:e,className:"hover:text-theme-primary",children:c.jsx(un,{size:10})})]})};function FH(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in t)){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(t)}function DD(t,e){return new Promise(function(n,r){let s;return BH(t).then(function(i){try{return s=i,n(new Blob([e.slice(0,2),s,e.slice(2)],{type:"image/jpeg"}))}catch(o){return r(o)}},r)})}const BH=t=>new Promise((e,n)=>{const r=new FileReader;r.addEventListener("load",({target:{result:s}})=>{const i=new DataView(s);let o=0;if(i.getUint16(o)!==65496)return n("not a valid JPEG");for(o+=2;;){const a=i.getUint16(o);if(a===65498)break;const l=i.getUint16(o+2);if(a===65505&&i.getUint32(o+4)===1165519206){const u=o+10;let d;switch(i.getUint16(u)){case 18761:d=!0;break;case 19789:d=!1;break;default:return n("TIFF header contains invalid endian")}if(i.getUint16(u+2,d)!==42)return n("TIFF header contains invalid version");const f=i.getUint32(u+4,d),h=u+f+2+12*i.getUint16(u+f,d);for(let p=u+f+2;p<h;p+=12)if(i.getUint16(p,d)==274){if(i.getUint16(p+2,d)!==3)return n("Orientation data type is invalid");if(i.getUint32(p+4,d)!==1)return n("Orientation data count is invalid");i.setUint16(p+8,1,d);break}return e(s.slice(o,o+2+l))}o+=2+l}return e(new Blob)}),r.readAsArrayBuffer(t)});var ym={},UH={get exports(){return ym},set exports(t){ym=t}};(function(t){var e,n,r={};UH.exports=r,r.parse=function(s,i){for(var o=r.bin.readUshort,a=r.bin.readUint,l=0,u={},d=new Uint8Array(s),f=d.length-4;a(d,f)!=101010256;)f--;l=f,l+=4;var h=o(d,l+=4);o(d,l+=2);var p=a(d,l+=2),m=a(d,l+=4);l+=4,l=m;for(var y=0;y<h;y++){a(d,l),l+=4,l+=4,l+=4,a(d,l+=4),p=a(d,l+=4);var b=a(d,l+=4),g=o(d,l+=4),v=o(d,l+2),w=o(d,l+4);l+=6;var C=a(d,l+=8);l+=4,l+=g+v+w,r._readLocal(d,C,u,p,b,i)}return u},r._readLocal=function(s,i,o,a,l,u){var d=r.bin.readUshort,f=r.bin.readUint;f(s,i),d(s,i+=4),d(s,i+=2);var h=d(s,i+=2);f(s,i+=2),f(s,i+=4),i+=4;var p=d(s,i+=8),m=d(s,i+=2);i+=2;var y=r.bin.readUTF8(s,i,p);if(i+=p,i+=m,u)o[y]={size:l,csize:a};else{var b=new Uint8Array(s.buffer,i);if(h==0)o[y]=new Uint8Array(b.buffer.slice(i,i+a));else{if(h!=8)throw"unknown compression method: "+h;var g=new Uint8Array(l);r.inflateRaw(b,g),o[y]=g}}},r.inflateRaw=function(s,i){return r.F.inflate(s,i)},r.inflate=function(s,i){return s[0],s[1],r.inflateRaw(new Uint8Array(s.buffer,s.byteOffset+2,s.length-6),i)},r.deflate=function(s,i){i==null&&(i={level:6});var o=0,a=new Uint8Array(50+Math.floor(1.1*s.length));a[o]=120,a[o+1]=156,o+=2,o=r.F.deflateRaw(s,a,o,i.level);var l=r.adler(s,0,s.length);return a[o+0]=l>>>24&255,a[o+1]=l>>>16&255,a[o+2]=l>>>8&255,a[o+3]=l>>>0&255,new Uint8Array(a.buffer,0,o+4)},r.deflateRaw=function(s,i){i==null&&(i={level:6});var o=new Uint8Array(50+Math.floor(1.1*s.length)),a=r.F.deflateRaw(s,o,a,i.level);return new Uint8Array(o.buffer,0,a)},r.encode=function(s,i){i==null&&(i=!1);var o=0,a=r.bin.writeUint,l=r.bin.writeUshort,u={};for(var d in s){var f=!r._noNeed(d)&&!i,h=s[d],p=r.crc.crc(h,0,h.length);u[d]={cpr:f,usize:h.length,crc:p,file:f?r.deflateRaw(h):h}}for(var d in u)o+=u[d].file.length+30+46+2*r.bin.sizeUTF8(d);o+=22;var m=new Uint8Array(o),y=0,b=[];for(var d in u){var g=u[d];b.push(y),y=r._writeHeader(m,y,d,g,0)}var v=0,w=y;for(var d in u)g=u[d],b.push(y),y=r._writeHeader(m,y,d,g,1,b[v++]);var C=y-w;return a(m,y,101010256),y+=4,l(m,y+=4,v),l(m,y+=2,v),a(m,y+=2,C),a(m,y+=4,w),y+=4,y+=2,m.buffer},r._noNeed=function(s){var i=s.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(i)!=-1},r._writeHeader=function(s,i,o,a,l,u){var d=r.bin.writeUint,f=r.bin.writeUshort,h=a.file;return d(s,i,l==0?67324752:33639248),i+=4,l==1&&(i+=2),f(s,i,20),f(s,i+=2,0),f(s,i+=2,a.cpr?8:0),d(s,i+=2,0),d(s,i+=4,a.crc),d(s,i+=4,h.length),d(s,i+=4,a.usize),f(s,i+=4,r.bin.sizeUTF8(o)),f(s,i+=2,0),i+=2,l==1&&(i+=2,i+=2,d(s,i+=6,u),i+=4),i+=r.bin.writeUTF8(s,i,o),l==0&&(s.set(h,i),i+=h.length),i},r.crc={table:function(){for(var s=new Uint32Array(256),i=0;i<256;i++){for(var o=i,a=0;a<8;a++)1&o?o=3988292384^o>>>1:o>>>=1;s[i]=o}return s}(),update:function(s,i,o,a){for(var l=0;l<a;l++)s=r.crc.table[255&(s^i[o+l])]^s>>>8;return s},crc:function(s,i,o){return 4294967295^r.crc.update(4294967295,s,i,o)}},r.adler=function(s,i,o){for(var a=1,l=0,u=i,d=i+o;u<d;){for(var f=Math.min(u+5552,d);u<f;)l+=a+=s[u++];a%=65521,l%=65521}return l<<16|a},r.bin={readUshort:function(s,i){return s[i]|s[i+1]<<8},writeUshort:function(s,i,o){s[i]=255&o,s[i+1]=o>>8&255},readUint:function(s,i){return 16777216*s[i+3]+(s[i+2]<<16|s[i+1]<<8|s[i])},writeUint:function(s,i,o){s[i]=255&o,s[i+1]=o>>8&255,s[i+2]=o>>16&255,s[i+3]=o>>24&255},readASCII:function(s,i,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(s[i+l]);return a},writeASCII:function(s,i,o){for(var a=0;a<o.length;a++)s[i+a]=o.charCodeAt(a)},pad:function(s){return s.length<2?"0"+s:s},readUTF8:function(s,i,o){for(var a,l="",u=0;u<o;u++)l+="%"+r.bin.pad(s[i+u].toString(16));try{a=decodeURIComponent(l)}catch{return r.bin.readASCII(s,i,o)}return a},writeUTF8:function(s,i,o){for(var a=o.length,l=0,u=0;u<a;u++){var d=o.charCodeAt(u);if(!(4294967168&d))s[i+l]=d,l++;else if(!(4294965248&d))s[i+l]=192|d>>6,s[i+l+1]=128|d>>0&63,l+=2;else if(!(4294901760&d))s[i+l]=224|d>>12,s[i+l+1]=128|d>>6&63,s[i+l+2]=128|d>>0&63,l+=3;else{if(4292870144&d)throw"e";s[i+l]=240|d>>18,s[i+l+1]=128|d>>12&63,s[i+l+2]=128|d>>6&63,s[i+l+3]=128|d>>0&63,l+=4}}return l},sizeUTF8:function(s){for(var i=s.length,o=0,a=0;a<i;a++){var l=s.charCodeAt(a);if(!(4294967168&l))o++;else if(!(4294965248&l))o+=2;else if(!(4294901760&l))o+=3;else{if(4292870144&l)throw"e";o+=4}}return o}},r.F={},r.F.deflateRaw=function(s,i,o,a){var l=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],u=r.F.U,d=r.F._goodIndex;r.F._hash;var f=r.F._putsE,h=0,p=o<<3,m=0,y=s.length;if(a==0){for(;h<y;)f(i,p,h+(N=Math.min(65535,y-h))==y?1:0),p=r.F._copyExact(s,h,N,i,p+8),h+=N;return p>>>3}var b=u.lits,g=u.strt,v=u.prev,w=0,C=0,I=0,k=0,D=0,S=0;for(y>2&&(g[S=r.F._hash(s,0)]=0),h=0;h<y;h++){if(D=S,h+1<y-2){S=r.F._hash(s,h+1);var T=h+1&32767;v[T]=g[S],g[S]=T}if(m<=h){(w>14e3||C>26697)&&y-h>100&&(m<h&&(b[w]=h-m,w+=2,m=h),p=r.F._writeBlock(h==y-1||m==y?1:0,b,w,k,s,I,h-I,i,p),w=C=k=0,I=h);var _=0;h<y-2&&(_=r.F._bestMatch(s,h,v,D,Math.min(l[2],y-h),l[3]));var N=_>>>16,A=65535&_;if(_!=0){A=65535&_;var O=d(N=_>>>16,u.of0);u.lhst[257+O]++;var L=d(A,u.df0);u.dhst[L]++,k+=u.exb[O]+u.dxb[L],b[w]=N<<23|h-m,b[w+1]=A<<16|O<<8|L,w+=2,m=h+N}else u.lhst[s[h]]++;C++}}for(I==h&&s.length!=0||(m<h&&(b[w]=h-m,w+=2,m=h),p=r.F._writeBlock(1,b,w,k,s,I,h-I,i,p),w=0,C=0,w=C=k=0,I=h);7&p;)p++;return p>>>3},r.F._bestMatch=function(s,i,o,a,l,u){var d=32767&i,f=o[d],h=d-f+32768&32767;if(f==d||a!=r.F._hash(s,i-h))return 0;for(var p=0,m=0,y=Math.min(32767,i);h<=y&&--u!=0&&f!=d;){if(p==0||s[i+p]==s[i+p-h]){var b=r.F._howLong(s,i,h);if(b>p){if(m=h,(p=b)>=l)break;h+2<b&&(b=h+2);for(var g=0,v=0;v<b-2;v++){var w=i-h+v+32768&32767,C=w-o[w]+32768&32767;C>g&&(g=C,f=w)}}}h+=(d=f)-(f=o[d])+32768&32767}return p<<16|m},r.F._howLong=function(s,i,o){if(s[i]!=s[i-o]||s[i+1]!=s[i+1-o]||s[i+2]!=s[i+2-o])return 0;var a=i,l=Math.min(s.length,i+258);for(i+=3;i<l&&s[i]==s[i-o];)i++;return i-a},r.F._hash=function(s,i){return(s[i]<<8|s[i+1])+(s[i+2]<<4)&65535},r.saved=0,r.F._writeBlock=function(s,i,o,a,l,u,d,f,h){var p,m,y,b,g,v,w,C,I,k=r.F.U,D=r.F._putsF,S=r.F._putsE;k.lhst[256]++,m=(p=r.F.getTrees())[0],y=p[1],b=p[2],g=p[3],v=p[4],w=p[5],C=p[6],I=p[7];var T=32+(h+3&7?8-(h+3&7):0)+(d<<3),_=a+r.F.contSize(k.fltree,k.lhst)+r.F.contSize(k.fdtree,k.dhst),N=a+r.F.contSize(k.ltree,k.lhst)+r.F.contSize(k.dtree,k.dhst);N+=14+3*w+r.F.contSize(k.itree,k.ihst)+(2*k.ihst[16]+3*k.ihst[17]+7*k.ihst[18]);for(var A=0;A<286;A++)k.lhst[A]=0;for(A=0;A<30;A++)k.dhst[A]=0;for(A=0;A<19;A++)k.ihst[A]=0;var O=T<_&&T<N?0:_<N?1:2;if(D(f,h,s),D(f,h+1,O),h+=3,O==0){for(;7&h;)h++;h=r.F._copyExact(l,u,d,f,h)}else{var L,V;if(O==1&&(L=k.fltree,V=k.fdtree),O==2){r.F.makeCodes(k.ltree,m),r.F.revCodes(k.ltree,m),r.F.makeCodes(k.dtree,y),r.F.revCodes(k.dtree,y),r.F.makeCodes(k.itree,b),r.F.revCodes(k.itree,b),L=k.ltree,V=k.dtree,S(f,h,g-257),S(f,h+=5,v-1),S(f,h+=5,w-4),h+=4;for(var E=0;E<w;E++)S(f,h+3*E,k.itree[1+(k.ordr[E]<<1)]);h+=3*w,h=r.F._codeTiny(C,k.itree,f,h),h=r.F._codeTiny(I,k.itree,f,h)}for(var j=u,H=0;H<o;H+=2){for(var W=i[H],R=W>>>23,ae=j+(8388607&W);j<ae;)h=r.F._writeLit(l[j++],L,f,h);if(R!=0){var re=i[H+1],$=re>>16,z=re>>8&255,le=255&re;S(f,h=r.F._writeLit(257+z,L,f,h),R-k.of0[z]),h+=k.exb[z],D(f,h=r.F._writeLit(le,V,f,h),$-k.df0[le]),h+=k.dxb[le],j+=R}}h=r.F._writeLit(256,L,f,h)}return h},r.F._copyExact=function(s,i,o,a,l){var u=l>>>3;return a[u]=o,a[u+1]=o>>>8,a[u+2]=255-a[u],a[u+3]=255-a[u+1],u+=4,a.set(new Uint8Array(s.buffer,i,o),u),l+(o+4<<3)},r.F.getTrees=function(){for(var s=r.F.U,i=r.F._hufTree(s.lhst,s.ltree,15),o=r.F._hufTree(s.dhst,s.dtree,15),a=[],l=r.F._lenCodes(s.ltree,a),u=[],d=r.F._lenCodes(s.dtree,u),f=0;f<a.length;f+=2)s.ihst[a[f]]++;for(f=0;f<u.length;f+=2)s.ihst[u[f]]++;for(var h=r.F._hufTree(s.ihst,s.itree,7),p=19;p>4&&s.itree[1+(s.ordr[p-1]<<1)]==0;)p--;return[i,o,h,l,d,p,a,u]},r.F.getSecond=function(s){for(var i=[],o=0;o<s.length;o+=2)i.push(s[o+1]);return i},r.F.nonZero=function(s){for(var i="",o=0;o<s.length;o+=2)s[o+1]!=0&&(i+=(o>>1)+",");return i},r.F.contSize=function(s,i){for(var o=0,a=0;a<i.length;a++)o+=i[a]*s[1+(a<<1)];return o},r.F._codeTiny=function(s,i,o,a){for(var l=0;l<s.length;l+=2){var u=s[l],d=s[l+1];a=r.F._writeLit(u,i,o,a);var f=u==16?2:u==17?3:7;u>15&&(r.F._putsE(o,a,d,f),a+=f)}return a},r.F._lenCodes=function(s,i){for(var o=s.length;o!=2&&s[o-1]==0;)o-=2;for(var a=0;a<o;a+=2){var l=s[a+1],u=a+3<o?s[a+3]:-1,d=a+5<o?s[a+5]:-1,f=a==0?-1:s[a-1];if(l==0&&u==l&&d==l){for(var h=a+5;h+2<o&&s[h+2]==l;)h+=2;(p=Math.min(h+1-a>>>1,138))<11?i.push(17,p-3):i.push(18,p-11),a+=2*p-2}else if(l==f&&u==l&&d==l){for(h=a+5;h+2<o&&s[h+2]==l;)h+=2;var p=Math.min(h+1-a>>>1,6);i.push(16,p-3),a+=2*p-2}else i.push(l,0)}return o>>>1},r.F._hufTree=function(s,i,o){var a=[],l=s.length,u=i.length,d=0;for(d=0;d<u;d+=2)i[d]=0,i[d+1]=0;for(d=0;d<l;d++)s[d]!=0&&a.push({lit:d,f:s[d]});var f=a.length,h=a.slice(0);if(f==0)return 0;if(f==1){var p=a[0].lit;return h=p==0?1:0,i[1+(p<<1)]=1,i[1+(h<<1)]=1,1}a.sort(function(C,I){return C.f-I.f});var m=a[0],y=a[1],b=0,g=1,v=2;for(a[0]={lit:-1,f:m.f+y.f,l:m,r:y,d:0};g!=f-1;)m=b!=g&&(v==f||a[b].f<a[v].f)?a[b++]:a[v++],y=b!=g&&(v==f||a[b].f<a[v].f)?a[b++]:a[v++],a[g++]={lit:-1,f:m.f+y.f,l:m,r:y};var w=r.F.setDepth(a[g-1],0);for(w>o&&(r.F.restrictDepth(h,o,w),w=o),d=0;d<f;d++)i[1+(h[d].lit<<1)]=h[d].d;return w},r.F.setDepth=function(s,i){return s.lit!=-1?(s.d=i,i):Math.max(r.F.setDepth(s.l,i+1),r.F.setDepth(s.r,i+1))},r.F.restrictDepth=function(s,i,o){var a=0,l=1<<o-i,u=0;for(s.sort(function(f,h){return h.d==f.d?f.f-h.f:h.d-f.d}),a=0;a<s.length&&s[a].d>i;a++){var d=s[a].d;s[a].d=i,u+=l-(1<<o-d)}for(u>>>=o-i;u>0;)(d=s[a].d)<i?(s[a].d++,u-=1<<i-d-1):a++;for(;a>=0;a--)s[a].d==i&&u<0&&(s[a].d--,u++);u!=0&&console.log("debt left")},r.F._goodIndex=function(s,i){var o=0;return i[16|o]<=s&&(o|=16),i[8|o]<=s&&(o|=8),i[4|o]<=s&&(o|=4),i[2|o]<=s&&(o|=2),i[1|o]<=s&&(o|=1),o},r.F._writeLit=function(s,i,o,a){return r.F._putsF(o,a,i[s<<1]),a+i[1+(s<<1)]},r.F.inflate=function(s,i){var o=Uint8Array;if(s[0]==3&&s[1]==0)return i||new o(0);var a=r.F,l=a._bitsF,u=a._bitsE,d=a._decodeTiny,f=a.makeCodes,h=a.codes2map,p=a._get17,m=a.U,y=i==null;y&&(i=new o(s.length>>>2<<3));for(var b,g,v=0,w=0,C=0,I=0,k=0,D=0,S=0,T=0,_=0;v==0;)if(v=l(s,_,1),w=l(s,_+1,2),_+=3,w!=0){if(y&&(i=r.F._check(i,T+(1<<17))),w==1&&(b=m.flmap,g=m.fdmap,D=511,S=31),w==2){C=u(s,_,5)+257,I=u(s,_+5,5)+1,k=u(s,_+10,4)+4,_+=14;for(var N=0;N<38;N+=2)m.itree[N]=0,m.itree[N+1]=0;var A=1;for(N=0;N<k;N++){var O=u(s,_+3*N,3);m.itree[1+(m.ordr[N]<<1)]=O,O>A&&(A=O)}_+=3*k,f(m.itree,A),h(m.itree,A,m.imap),b=m.lmap,g=m.dmap,_=d(m.imap,(1<<A)-1,C+I,s,_,m.ttree);var L=a._copyOut(m.ttree,0,C,m.ltree);D=(1<<L)-1;var V=a._copyOut(m.ttree,C,I,m.dtree);S=(1<<V)-1,f(m.ltree,L),h(m.ltree,L,b),f(m.dtree,V),h(m.dtree,V,g)}for(;;){var E=b[p(s,_)&D];_+=15&E;var j=E>>>4;if(!(j>>>8))i[T++]=j;else{if(j==256)break;var H=T+j-254;if(j>264){var W=m.ldef[j-257];H=T+(W>>>3)+u(s,_,7&W),_+=7&W}var R=g[p(s,_)&S];_+=15&R;var ae=R>>>4,re=m.ddef[ae],$=(re>>>4)+l(s,_,15&re);for(_+=15&re,y&&(i=r.F._check(i,T+(1<<17)));T<H;)i[T]=i[T++-$],i[T]=i[T++-$],i[T]=i[T++-$],i[T]=i[T++-$];T=H}}}else{7&_&&(_+=8-(7&_));var z=4+(_>>>3),le=s[z-4]|s[z-3]<<8;y&&(i=r.F._check(i,T+le)),i.set(new o(s.buffer,s.byteOffset+z,le),T),_=z+le<<3,T+=le}return i.length==T?i:i.slice(0,T)},r.F._check=function(s,i){var o=s.length;if(i<=o)return s;var a=new Uint8Array(Math.max(o<<1,i));return a.set(s,0),a},r.F._decodeTiny=function(s,i,o,a,l,u){for(var d=r.F._bitsE,f=r.F._get17,h=0;h<o;){var p=s[f(a,l)&i];l+=15&p;var m=p>>>4;if(m<=15)u[h]=m,h++;else{var y=0,b=0;m==16?(b=3+d(a,l,2),l+=2,y=u[h-1]):m==17?(b=3+d(a,l,3),l+=3):m==18&&(b=11+d(a,l,7),l+=7);for(var g=h+b;h<g;)u[h]=y,h++}}return l},r.F._copyOut=function(s,i,o,a){for(var l=0,u=0,d=a.length>>>1;u<o;){var f=s[u+i];a[u<<1]=0,a[1+(u<<1)]=f,f>l&&(l=f),u++}for(;u<d;)a[u<<1]=0,a[1+(u<<1)]=0,u++;return l},r.F.makeCodes=function(s,i){for(var o,a,l,u,d=r.F.U,f=s.length,h=d.bl_count,p=0;p<=i;p++)h[p]=0;for(p=1;p<f;p+=2)h[s[p]]++;var m=d.next_code;for(o=0,h[0]=0,a=1;a<=i;a++)o=o+h[a-1]<<1,m[a]=o;for(l=0;l<f;l+=2)(u=s[l+1])!=0&&(s[l]=m[u],m[u]++)},r.F.codes2map=function(s,i,o){for(var a=s.length,l=r.F.U.rev15,u=0;u<a;u+=2)if(s[u+1]!=0)for(var d=u>>1,f=s[u+1],h=d<<4|f,p=i-f,m=s[u]<<p,y=m+(1<<p);m!=y;)o[l[m]>>>15-i]=h,m++},r.F.revCodes=function(s,i){for(var o=r.F.U.rev15,a=15-i,l=0;l<s.length;l+=2){var u=s[l]<<i-s[l+1];s[l]=o[u]>>>a}},r.F._putsE=function(s,i,o){o<<=7&i;var a=i>>>3;s[a]|=o,s[a+1]|=o>>>8},r.F._putsF=function(s,i,o){o<<=7&i;var a=i>>>3;s[a]|=o,s[a+1]|=o>>>8,s[a+2]|=o>>>16},r.F._bitsE=function(s,i,o){return(s[i>>>3]|s[1+(i>>>3)]<<8)>>>(7&i)&(1<<o)-1},r.F._bitsF=function(s,i,o){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16)>>>(7&i)&(1<<o)-1},r.F._get17=function(s,i){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16)>>>(7&i)},r.F._get25=function(s,i){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16|s[3+(i>>>3)]<<24)>>>(7&i)},r.F.U=(e=Uint16Array,n=Uint32Array,{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new n(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new n(286),dhst:new n(30),ihst:new n(19),lits:new n(15e3),strt:new e(65536),prev:new e(32768)}),function(){for(var s=r.F.U,i=0;i<32768;i++){var o=i;o=(4278255360&(o=(4042322160&(o=(3435973836&(o=(2863311530&o)>>>1|(1431655765&o)<<1))>>>2|(858993459&o)<<2))>>>4|(252645135&o)<<4))>>>8|(16711935&o)<<8,s.rev15[i]=(o>>>16|o<<16)>>>17}function a(l,u,d){for(;u--!=0;)l.push(0,d)}for(i=0;i<32;i++)s.ldef[i]=s.of0[i]<<3|s.exb[i],s.ddef[i]=s.df0[i]<<4|s.dxb[i];a(s.fltree,144,8),a(s.fltree,112,9),a(s.fltree,24,7),a(s.fltree,8,8),r.F.makeCodes(s.fltree,9),r.F.codes2map(s.fltree,9,s.flmap),r.F.revCodes(s.fltree,9),a(s.fdtree,32,5),r.F.makeCodes(s.fdtree,5),r.F.codes2map(s.fdtree,5,s.fdmap),r.F.revCodes(s.fdtree,5),a(s.itree,19,0),a(s.ltree,286,0),a(s.dtree,30,0),a(s.ttree,320,0)}()})();var HH=FH({__proto__:null,default:ym},[ym]);const Vi=function(){var t={nextZero(d,f){for(;d[f]!=0;)f++;return f},readUshort:(d,f)=>d[f]<<8|d[f+1],writeUshort(d,f,h){d[f]=h>>8&255,d[f+1]=255&h},readUint:(d,f)=>16777216*d[f]+(d[f+1]<<16|d[f+2]<<8|d[f+3]),writeUint(d,f,h){d[f]=h>>24&255,d[f+1]=h>>16&255,d[f+2]=h>>8&255,d[f+3]=255&h},readASCII(d,f,h){let p="";for(let m=0;m<h;m++)p+=String.fromCharCode(d[f+m]);return p},writeASCII(d,f,h){for(let p=0;p<h.length;p++)d[f+p]=h.charCodeAt(p)},readBytes(d,f,h){const p=[];for(let m=0;m<h;m++)p.push(d[f+m]);return p},pad:d=>d.length<2?`0${d}`:d,readUTF8(d,f,h){let p,m="";for(let y=0;y<h;y++)m+=`%${t.pad(d[f+y].toString(16))}`;try{p=decodeURIComponent(m)}catch{return t.readASCII(d,f,h)}return p}};function e(d,f,h,p){const m=f*h,y=i(p),b=Math.ceil(f*y/8),g=new Uint8Array(4*m),v=new Uint32Array(g.buffer),{ctype:w}=p,{depth:C}=p,I=t.readUshort;if(w==6){const W=m<<2;if(C==8)for(var k=0;k<W;k+=4)g[k]=d[k],g[k+1]=d[k+1],g[k+2]=d[k+2],g[k+3]=d[k+3];if(C==16)for(k=0;k<W;k++)g[k]=d[k<<1]}else if(w==2){const W=p.tabs.tRNS;if(W==null){if(C==8)for(k=0;k<m;k++){var D=3*k;v[k]=255<<24|d[D+2]<<16|d[D+1]<<8|d[D]}if(C==16)for(k=0;k<m;k++)D=6*k,v[k]=255<<24|d[D+4]<<16|d[D+2]<<8|d[D]}else{var S=W[0];const R=W[1],ae=W[2];if(C==8)for(k=0;k<m;k++){var T=k<<2;D=3*k,v[k]=255<<24|d[D+2]<<16|d[D+1]<<8|d[D],d[D]==S&&d[D+1]==R&&d[D+2]==ae&&(g[T+3]=0)}if(C==16)for(k=0;k<m;k++)T=k<<2,D=6*k,v[k]=255<<24|d[D+4]<<16|d[D+2]<<8|d[D],I(d,D)==S&&I(d,D+2)==R&&I(d,D+4)==ae&&(g[T+3]=0)}}else if(w==3){const W=p.tabs.PLTE,R=p.tabs.tRNS,ae=R?R.length:0;if(C==1)for(var _=0;_<h;_++){var N=_*b,A=_*f;for(k=0;k<f;k++){T=A+k<<2;var O=3*(L=d[N+(k>>3)]>>7-((7&k)<<0)&1);g[T]=W[O],g[T+1]=W[O+1],g[T+2]=W[O+2],g[T+3]=L<ae?R[L]:255}}if(C==2)for(_=0;_<h;_++)for(N=_*b,A=_*f,k=0;k<f;k++)T=A+k<<2,O=3*(L=d[N+(k>>2)]>>6-((3&k)<<1)&3),g[T]=W[O],g[T+1]=W[O+1],g[T+2]=W[O+2],g[T+3]=L<ae?R[L]:255;if(C==4)for(_=0;_<h;_++)for(N=_*b,A=_*f,k=0;k<f;k++)T=A+k<<2,O=3*(L=d[N+(k>>1)]>>4-((1&k)<<2)&15),g[T]=W[O],g[T+1]=W[O+1],g[T+2]=W[O+2],g[T+3]=L<ae?R[L]:255;if(C==8)for(k=0;k<m;k++){var L;T=k<<2,O=3*(L=d[k]),g[T]=W[O],g[T+1]=W[O+1],g[T+2]=W[O+2],g[T+3]=L<ae?R[L]:255}}else if(w==4){if(C==8)for(k=0;k<m;k++){T=k<<2;var V=d[E=k<<1];g[T]=V,g[T+1]=V,g[T+2]=V,g[T+3]=d[E+1]}if(C==16)for(k=0;k<m;k++){var E;T=k<<2,V=d[E=k<<2],g[T]=V,g[T+1]=V,g[T+2]=V,g[T+3]=d[E+2]}}else if(w==0)for(S=p.tabs.tRNS?p.tabs.tRNS:-1,_=0;_<h;_++){const W=_*b,R=_*f;if(C==1)for(var j=0;j<f;j++){var H=(V=255*(d[W+(j>>>3)]>>>7-(7&j)&1))==255*S?0:255;v[R+j]=H<<24|V<<16|V<<8|V}else if(C==2)for(j=0;j<f;j++)H=(V=85*(d[W+(j>>>2)]>>>6-((3&j)<<1)&3))==85*S?0:255,v[R+j]=H<<24|V<<16|V<<8|V;else if(C==4)for(j=0;j<f;j++)H=(V=17*(d[W+(j>>>1)]>>>4-((1&j)<<2)&15))==17*S?0:255,v[R+j]=H<<24|V<<16|V<<8|V;else if(C==8)for(j=0;j<f;j++)H=(V=d[W+j])==S?0:255,v[R+j]=H<<24|V<<16|V<<8|V;else if(C==16)for(j=0;j<f;j++)V=d[W+(j<<1)],H=I(d,W+(j<<1))==S?0:255,v[R+j]=H<<24|V<<16|V<<8|V}return g}function n(d,f,h,p){const m=i(d),y=Math.ceil(h*m/8),b=new Uint8Array((y+1+d.interlace)*p);return f=d.tabs.CgBI?s(f,b):r(f,b),d.interlace==0?f=o(f,d,0,h,p):d.interlace==1&&(f=function(v,w){const C=w.width,I=w.height,k=i(w),D=k>>3,S=Math.ceil(C*k/8),T=new Uint8Array(I*S);let _=0;const N=[0,0,4,0,2,0,1],A=[0,4,0,2,0,1,0],O=[8,8,8,4,4,2,2],L=[8,8,4,4,2,2,1];let V=0;for(;V<7;){const j=O[V],H=L[V];let W=0,R=0,ae=N[V];for(;ae<I;)ae+=j,R++;let re=A[V];for(;re<C;)re+=H,W++;const $=Math.ceil(W*k/8);o(v,w,_,W,R);let z=0,le=N[V];for(;le<I;){let $e=A[V],Be=_+z*$<<3;for(;$e<C;){var E;if(k==1&&(E=(E=v[Be>>3])>>7-(7&Be)&1,T[le*S+($e>>3)]|=E<<7-((7&$e)<<0)),k==2&&(E=(E=v[Be>>3])>>6-(7&Be)&3,T[le*S+($e>>2)]|=E<<6-((3&$e)<<1)),k==4&&(E=(E=v[Be>>3])>>4-(7&Be)&15,T[le*S+($e>>1)]|=E<<4-((1&$e)<<2)),k>=8){const se=le*S+$e*D;for(let Se=0;Se<D;Se++)T[se+Se]=v[(Be>>3)+Se]}Be+=k,$e+=H}z++,le+=j}W*R!=0&&(_+=R*(1+$)),V+=1}return T}(f,d)),f}function r(d,f){return s(new Uint8Array(d.buffer,2,d.length-6),f)}var s=function(){const d={H:{}};return d.H.N=function(f,h){const p=Uint8Array;let m,y,b=0,g=0,v=0,w=0,C=0,I=0,k=0,D=0,S=0;if(f[0]==3&&f[1]==0)return h||new p(0);const T=d.H,_=T.b,N=T.e,A=T.R,O=T.n,L=T.A,V=T.Z,E=T.m,j=h==null;for(j&&(h=new p(f.length>>>2<<5));b==0;)if(b=_(f,S,1),g=_(f,S+1,2),S+=3,g!=0){if(j&&(h=d.H.W(h,D+(1<<17))),g==1&&(m=E.J,y=E.h,I=511,k=31),g==2){v=N(f,S,5)+257,w=N(f,S+5,5)+1,C=N(f,S+10,4)+4,S+=14;let W=1;for(var H=0;H<38;H+=2)E.Q[H]=0,E.Q[H+1]=0;for(H=0;H<C;H++){const re=N(f,S+3*H,3);E.Q[1+(E.X[H]<<1)]=re,re>W&&(W=re)}S+=3*C,O(E.Q,W),L(E.Q,W,E.u),m=E.w,y=E.d,S=A(E.u,(1<<W)-1,v+w,f,S,E.v);const R=T.V(E.v,0,v,E.C);I=(1<<R)-1;const ae=T.V(E.v,v,w,E.D);k=(1<<ae)-1,O(E.C,R),L(E.C,R,m),O(E.D,ae),L(E.D,ae,y)}for(;;){const W=m[V(f,S)&I];S+=15&W;const R=W>>>4;if(!(R>>>8))h[D++]=R;else{if(R==256)break;{let ae=D+R-254;if(R>264){const $e=E.q[R-257];ae=D+($e>>>3)+N(f,S,7&$e),S+=7&$e}const re=y[V(f,S)&k];S+=15&re;const $=re>>>4,z=E.c[$],le=(z>>>4)+_(f,S,15&z);for(S+=15&z;D<ae;)h[D]=h[D++-le],h[D]=h[D++-le],h[D]=h[D++-le],h[D]=h[D++-le];D=ae}}}}else{7&S&&(S+=8-(7&S));const W=4+(S>>>3),R=f[W-4]|f[W-3]<<8;j&&(h=d.H.W(h,D+R)),h.set(new p(f.buffer,f.byteOffset+W,R),D),S=W+R<<3,D+=R}return h.length==D?h:h.slice(0,D)},d.H.W=function(f,h){const p=f.length;if(h<=p)return f;const m=new Uint8Array(p<<1);return m.set(f,0),m},d.H.R=function(f,h,p,m,y,b){const g=d.H.e,v=d.H.Z;let w=0;for(;w<p;){const C=f[v(m,y)&h];y+=15&C;const I=C>>>4;if(I<=15)b[w]=I,w++;else{let k=0,D=0;I==16?(D=3+g(m,y,2),y+=2,k=b[w-1]):I==17?(D=3+g(m,y,3),y+=3):I==18&&(D=11+g(m,y,7),y+=7);const S=w+D;for(;w<S;)b[w]=k,w++}}return y},d.H.V=function(f,h,p,m){let y=0,b=0;const g=m.length>>>1;for(;b<p;){const v=f[b+h];m[b<<1]=0,m[1+(b<<1)]=v,v>y&&(y=v),b++}for(;b<g;)m[b<<1]=0,m[1+(b<<1)]=0,b++;return y},d.H.n=function(f,h){const p=d.H.m,m=f.length;let y,b,g,v;const w=p.j;for(var C=0;C<=h;C++)w[C]=0;for(C=1;C<m;C+=2)w[f[C]]++;const I=p.K;for(y=0,w[0]=0,b=1;b<=h;b++)y=y+w[b-1]<<1,I[b]=y;for(g=0;g<m;g+=2)v=f[g+1],v!=0&&(f[g]=I[v],I[v]++)},d.H.A=function(f,h,p){const m=f.length,y=d.H.m.r;for(let b=0;b<m;b+=2)if(f[b+1]!=0){const g=b>>1,v=f[b+1],w=g<<4|v,C=h-v;let I=f[b]<<C;const k=I+(1<<C);for(;I!=k;)p[y[I]>>>15-h]=w,I++}},d.H.l=function(f,h){const p=d.H.m.r,m=15-h;for(let y=0;y<f.length;y+=2){const b=f[y]<<h-f[y+1];f[y]=p[b]>>>m}},d.H.M=function(f,h,p){p<<=7&h;const m=h>>>3;f[m]|=p,f[m+1]|=p>>>8},d.H.I=function(f,h,p){p<<=7&h;const m=h>>>3;f[m]|=p,f[m+1]|=p>>>8,f[m+2]|=p>>>16},d.H.e=function(f,h,p){return(f[h>>>3]|f[1+(h>>>3)]<<8)>>>(7&h)&(1<<p)-1},d.H.b=function(f,h,p){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16)>>>(7&h)&(1<<p)-1},d.H.Z=function(f,h){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16)>>>(7&h)},d.H.i=function(f,h){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16|f[3+(h>>>3)]<<24)>>>(7&h)},d.H.m=function(){const f=Uint16Array,h=Uint32Array;return{K:new f(16),j:new f(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new f(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new h(32),J:new f(512),_:[],h:new f(32),$:[],w:new f(32768),C:[],v:[],d:new f(32768),D:[],u:new f(512),Q:[],r:new f(32768),s:new h(286),Y:new h(30),a:new h(19),t:new h(15e3),k:new f(65536),g:new f(32768)}}(),function(){const f=d.H.m;for(var h=0;h<32768;h++){let m=h;m=(2863311530&m)>>>1|(1431655765&m)<<1,m=(3435973836&m)>>>2|(858993459&m)<<2,m=(4042322160&m)>>>4|(252645135&m)<<4,m=(4278255360&m)>>>8|(16711935&m)<<8,f.r[h]=(m>>>16|m<<16)>>>17}function p(m,y,b){for(;y--!=0;)m.push(0,b)}for(h=0;h<32;h++)f.q[h]=f.S[h]<<3|f.T[h],f.c[h]=f.p[h]<<4|f.z[h];p(f._,144,8),p(f._,112,9),p(f._,24,7),p(f._,8,8),d.H.n(f._,9),d.H.A(f._,9,f.J),d.H.l(f._,9),p(f.$,32,5),d.H.n(f.$,5),d.H.A(f.$,5,f.h),d.H.l(f.$,5),p(f.Q,19,0),p(f.C,286,0),p(f.D,30,0),p(f.v,320,0)}(),d.H.N}();function i(d){return[1,null,3,1,2,null,4][d.ctype]*d.depth}function o(d,f,h,p,m){let y=i(f);const b=Math.ceil(p*y/8);let g,v;y=Math.ceil(y/8);let w=d[h],C=0;if(w>1&&(d[h]=[0,0,1][w-2]),w==3)for(C=y;C<b;C++)d[C+1]=d[C+1]+(d[C+1-y]>>>1)&255;for(let I=0;I<m;I++)if(g=h+I*b,v=g+I+1,w=d[v-1],C=0,w==0)for(;C<b;C++)d[g+C]=d[v+C];else if(w==1){for(;C<y;C++)d[g+C]=d[v+C];for(;C<b;C++)d[g+C]=d[v+C]+d[g+C-y]}else if(w==2)for(;C<b;C++)d[g+C]=d[v+C]+d[g+C-b];else if(w==3){for(;C<y;C++)d[g+C]=d[v+C]+(d[g+C-b]>>>1);for(;C<b;C++)d[g+C]=d[v+C]+(d[g+C-b]+d[g+C-y]>>>1)}else{for(;C<y;C++)d[g+C]=d[v+C]+a(0,d[g+C-b],0);for(;C<b;C++)d[g+C]=d[v+C]+a(d[g+C-y],d[g+C-b],d[g+C-y-b])}return d}function a(d,f,h){const p=d+f-h,m=p-d,y=p-f,b=p-h;return m*m<=y*y&&m*m<=b*b?d:y*y<=b*b?f:h}function l(d,f,h){h.width=t.readUint(d,f),f+=4,h.height=t.readUint(d,f),f+=4,h.depth=d[f],f++,h.ctype=d[f],f++,h.compress=d[f],f++,h.filter=d[f],f++,h.interlace=d[f],f++}function u(d,f,h,p,m,y,b,g,v){const w=Math.min(f,m),C=Math.min(h,y);let I=0,k=0;for(let V=0;V<C;V++)for(let E=0;E<w;E++)if(b>=0&&g>=0?(I=V*f+E<<2,k=(g+V)*m+b+E<<2):(I=(-g+V)*f-b+E<<2,k=V*m+E<<2),v==0)p[k]=d[I],p[k+1]=d[I+1],p[k+2]=d[I+2],p[k+3]=d[I+3];else if(v==1){var D=d[I+3]*.00392156862745098,S=d[I]*D,T=d[I+1]*D,_=d[I+2]*D,N=p[k+3]*(1/255),A=p[k]*N,O=p[k+1]*N,L=p[k+2]*N;const j=1-D,H=D+N*j,W=H==0?0:1/H;p[k+3]=255*H,p[k+0]=(S+A*j)*W,p[k+1]=(T+O*j)*W,p[k+2]=(_+L*j)*W}else if(v==2)D=d[I+3],S=d[I],T=d[I+1],_=d[I+2],N=p[k+3],A=p[k],O=p[k+1],L=p[k+2],D==N&&S==A&&T==O&&_==L?(p[k]=0,p[k+1]=0,p[k+2]=0,p[k+3]=0):(p[k]=S,p[k+1]=T,p[k+2]=_,p[k+3]=D);else if(v==3){if(D=d[I+3],S=d[I],T=d[I+1],_=d[I+2],N=p[k+3],A=p[k],O=p[k+1],L=p[k+2],D==N&&S==A&&T==O&&_==L)continue;if(D<220&&N>20)return!1}return!0}return{decode:function(f){const h=new Uint8Array(f);let p=8;const m=t,y=m.readUshort,b=m.readUint,g={tabs:{},frames:[]},v=new Uint8Array(h.length);let w,C=0,I=0;const k=[137,80,78,71,13,10,26,10];for(var D=0;D<8;D++)if(h[D]!=k[D])throw"The input is not a PNG file!";for(;p<h.length;){const V=m.readUint(h,p);p+=4;const E=m.readASCII(h,p,4);if(p+=4,E=="IHDR")l(h,p,g);else if(E=="iCCP"){for(var S=p;h[S]!=0;)S++;m.readASCII(h,p,S-p),h[S+1];const j=h.slice(S+2,p+V);let H=null;try{H=r(j)}catch{H=s(j)}g.tabs[E]=H}else if(E=="CgBI")g.tabs[E]=h.slice(p,p+4);else if(E=="IDAT"){for(D=0;D<V;D++)v[C+D]=h[p+D];C+=V}else if(E=="acTL")g.tabs[E]={num_frames:b(h,p),num_plays:b(h,p+4)},w=new Uint8Array(h.length);else if(E=="fcTL"){I!=0&&((L=g.frames[g.frames.length-1]).data=n(g,w.slice(0,I),L.rect.width,L.rect.height),I=0);const j={x:b(h,p+12),y:b(h,p+16),width:b(h,p+4),height:b(h,p+8)};let H=y(h,p+22);H=y(h,p+20)/(H==0?100:H);const W={rect:j,delay:Math.round(1e3*H),dispose:h[p+24],blend:h[p+25]};g.frames.push(W)}else if(E=="fdAT"){for(D=0;D<V-4;D++)w[I+D]=h[p+D+4];I+=V-4}else if(E=="pHYs")g.tabs[E]=[m.readUint(h,p),m.readUint(h,p+4),h[p+8]];else if(E=="cHRM")for(g.tabs[E]=[],D=0;D<8;D++)g.tabs[E].push(m.readUint(h,p+4*D));else if(E=="tEXt"||E=="zTXt"){g.tabs[E]==null&&(g.tabs[E]={});var T=m.nextZero(h,p),_=m.readASCII(h,p,T-p),N=p+V-T-1;if(E=="tEXt")O=m.readASCII(h,T+1,N);else{var A=r(h.slice(T+2,T+2+N));O=m.readUTF8(A,0,A.length)}g.tabs[E][_]=O}else if(E=="iTXt"){g.tabs[E]==null&&(g.tabs[E]={}),T=0,S=p,T=m.nextZero(h,S),_=m.readASCII(h,S,T-S);const j=h[S=T+1];var O;h[S+1],S+=2,T=m.nextZero(h,S),m.readASCII(h,S,T-S),S=T+1,T=m.nextZero(h,S),m.readUTF8(h,S,T-S),N=V-((S=T+1)-p),j==0?O=m.readUTF8(h,S,N):(A=r(h.slice(S,S+N)),O=m.readUTF8(A,0,A.length)),g.tabs[E][_]=O}else if(E=="PLTE")g.tabs[E]=m.readBytes(h,p,V);else if(E=="hIST"){const j=g.tabs.PLTE.length/3;for(g.tabs[E]=[],D=0;D<j;D++)g.tabs[E].push(y(h,p+2*D))}else if(E=="tRNS")g.ctype==3?g.tabs[E]=m.readBytes(h,p,V):g.ctype==0?g.tabs[E]=y(h,p):g.ctype==2&&(g.tabs[E]=[y(h,p),y(h,p+2),y(h,p+4)]);else if(E=="gAMA")g.tabs[E]=m.readUint(h,p)/1e5;else if(E=="sRGB")g.tabs[E]=h[p];else if(E=="bKGD")g.ctype==0||g.ctype==4?g.tabs[E]=[y(h,p)]:g.ctype==2||g.ctype==6?g.tabs[E]=[y(h,p),y(h,p+2),y(h,p+4)]:g.ctype==3&&(g.tabs[E]=h[p]);else if(E=="IEND")break;p+=V,m.readUint(h,p),p+=4}var L;return I!=0&&((L=g.frames[g.frames.length-1]).data=n(g,w.slice(0,I),L.rect.width,L.rect.height)),g.data=n(g,v,g.width,g.height),delete g.compress,delete g.interlace,delete g.filter,g},toRGBA8:function(f){const h=f.width,p=f.height;if(f.tabs.acTL==null)return[e(f.data,h,p,f).buffer];const m=[];f.frames[0].data==null&&(f.frames[0].data=f.data);const y=h*p*4,b=new Uint8Array(y),g=new Uint8Array(y),v=new Uint8Array(y);for(let C=0;C<f.frames.length;C++){const I=f.frames[C],k=I.rect.x,D=I.rect.y,S=I.rect.width,T=I.rect.height,_=e(I.data,S,T,f);if(C!=0)for(var w=0;w<y;w++)v[w]=b[w];if(I.blend==0?u(_,S,T,b,h,p,k,D,0):I.blend==1&&u(_,S,T,b,h,p,k,D,1),m.push(b.buffer.slice(0)),I.dispose!=0){if(I.dispose==1)u(g,S,T,b,h,p,k,D,0);else if(I.dispose==2)for(w=0;w<y;w++)b[w]=v[w]}}return m},_paeth:a,_copyTile:u,_bin:t}}();(function(){const{_copyTile:t}=Vi,{_bin:e}=Vi,n=Vi._paeth;var r={table:function(){const S=new Uint32Array(256);for(let T=0;T<256;T++){let _=T;for(let N=0;N<8;N++)1&_?_=3988292384^_>>>1:_>>>=1;S[T]=_}return S}(),update(S,T,_,N){for(let A=0;A<N;A++)S=r.table[255&(S^T[_+A])]^S>>>8;return S},crc:(S,T,_)=>4294967295^r.update(4294967295,S,T,_)};function s(S,T,_,N){T[_]+=S[0]*N>>4,T[_+1]+=S[1]*N>>4,T[_+2]+=S[2]*N>>4,T[_+3]+=S[3]*N>>4}function i(S){return Math.max(0,Math.min(255,S))}function o(S,T){const _=S[0]-T[0],N=S[1]-T[1],A=S[2]-T[2],O=S[3]-T[3];return _*_+N*N+A*A+O*O}function a(S,T,_,N,A,O,L){L==null&&(L=1);const V=N.length,E=[];for(var j=0;j<V;j++){const le=N[j];E.push([le>>>0&255,le>>>8&255,le>>>16&255,le>>>24&255])}for(j=0;j<V;j++){let le=4294967295;for(var H=0,W=0;W<V;W++){var R=o(E[j],E[W]);W!=j&&R<le&&(le=R,H=W)}}const ae=new Uint32Array(A.buffer),re=new Int16Array(T*_*4),$=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(j=0;j<$.length;j++)$[j]=255*(($[j]+.5)/16-.5);for(let le=0;le<_;le++)for(let $e=0;$e<T;$e++){var z;j=4*(le*T+$e),L!=2?z=[i(S[j]+re[j]),i(S[j+1]+re[j+1]),i(S[j+2]+re[j+2]),i(S[j+3]+re[j+3])]:(R=$[4*(3&le)+(3&$e)],z=[i(S[j]+R),i(S[j+1]+R),i(S[j+2]+R),i(S[j+3]+R)]),H=0;let Be=16777215;for(W=0;W<V;W++){const ce=o(z,E[W]);ce<Be&&(Be=ce,H=W)}const se=E[H],Se=[z[0]-se[0],z[1]-se[1],z[2]-se[2],z[3]-se[3]];L==1&&($e!=T-1&&s(Se,re,j+4,7),le!=_-1&&($e!=0&&s(Se,re,j+4*T-4,3),s(Se,re,j+4*T,5),$e!=T-1&&s(Se,re,j+4*T+4,1))),O[j>>2]=H,ae[j>>2]=N[H]}}function l(S,T,_,N,A){A==null&&(A={});const{crc:O}=r,L=e.writeUint,V=e.writeUshort,E=e.writeASCII;let j=8;const H=S.frames.length>1;let W,R=!1,ae=33+(H?20:0);if(A.sRGB!=null&&(ae+=13),A.pHYs!=null&&(ae+=21),A.iCCP!=null&&(W=pako.deflate(A.iCCP),ae+=21+W.length+4),S.ctype==3){for(var re=S.plte.length,$=0;$<re;$++)S.plte[$]>>>24!=255&&(R=!0);ae+=8+3*re+4+(R?8+1*re+4:0)}for(var z=0;z<S.frames.length;z++)H&&(ae+=38),ae+=(se=S.frames[z]).cimg.length+12,z!=0&&(ae+=4);ae+=12;const le=new Uint8Array(ae),$e=[137,80,78,71,13,10,26,10];for($=0;$<8;$++)le[$]=$e[$];if(L(le,j,13),j+=4,E(le,j,"IHDR"),j+=4,L(le,j,T),j+=4,L(le,j,_),j+=4,le[j]=S.depth,j++,le[j]=S.ctype,j++,le[j]=0,j++,le[j]=0,j++,le[j]=0,j++,L(le,j,O(le,j-17,17)),j+=4,A.sRGB!=null&&(L(le,j,1),j+=4,E(le,j,"sRGB"),j+=4,le[j]=A.sRGB,j++,L(le,j,O(le,j-5,5)),j+=4),A.iCCP!=null){const Se=13+W.length;L(le,j,Se),j+=4,E(le,j,"iCCP"),j+=4,E(le,j,"ICC profile"),j+=11,j+=2,le.set(W,j),j+=W.length,L(le,j,O(le,j-(Se+4),Se+4)),j+=4}if(A.pHYs!=null&&(L(le,j,9),j+=4,E(le,j,"pHYs"),j+=4,L(le,j,A.pHYs[0]),j+=4,L(le,j,A.pHYs[1]),j+=4,le[j]=A.pHYs[2],j++,L(le,j,O(le,j-13,13)),j+=4),H&&(L(le,j,8),j+=4,E(le,j,"acTL"),j+=4,L(le,j,S.frames.length),j+=4,L(le,j,A.loop!=null?A.loop:0),j+=4,L(le,j,O(le,j-12,12)),j+=4),S.ctype==3){for(L(le,j,3*(re=S.plte.length)),j+=4,E(le,j,"PLTE"),j+=4,$=0;$<re;$++){const Se=3*$,ce=S.plte[$],Ee=255&ce,He=ce>>>8&255,tt=ce>>>16&255;le[j+Se+0]=Ee,le[j+Se+1]=He,le[j+Se+2]=tt}if(j+=3*re,L(le,j,O(le,j-3*re-4,3*re+4)),j+=4,R){for(L(le,j,re),j+=4,E(le,j,"tRNS"),j+=4,$=0;$<re;$++)le[j+$]=S.plte[$]>>>24&255;j+=re,L(le,j,O(le,j-re-4,re+4)),j+=4}}let Be=0;for(z=0;z<S.frames.length;z++){var se=S.frames[z];H&&(L(le,j,26),j+=4,E(le,j,"fcTL"),j+=4,L(le,j,Be++),j+=4,L(le,j,se.rect.width),j+=4,L(le,j,se.rect.height),j+=4,L(le,j,se.rect.x),j+=4,L(le,j,se.rect.y),j+=4,V(le,j,N[z]),j+=2,V(le,j,1e3),j+=2,le[j]=se.dispose,j++,le[j]=se.blend,j++,L(le,j,O(le,j-30,30)),j+=4);const Se=se.cimg;L(le,j,(re=Se.length)+(z==0?0:4)),j+=4;const ce=j;E(le,j,z==0?"IDAT":"fdAT"),j+=4,z!=0&&(L(le,j,Be++),j+=4),le.set(Se,j),j+=re,L(le,j,O(le,ce,j-ce)),j+=4}return L(le,j,0),j+=4,E(le,j,"IEND"),j+=4,L(le,j,O(le,j-4,4)),j+=4,le.buffer}function u(S,T,_){for(let N=0;N<S.frames.length;N++){const A=S.frames[N];A.rect.width;const O=A.rect.height,L=new Uint8Array(O*A.bpl+O);A.cimg=p(A.img,O,A.bpp,A.bpl,L,T,_)}}function d(S,T,_,N,A){const O=A[0],L=A[1],V=A[2],E=A[3],j=A[4],H=A[5];let W=6,R=8,ae=255;for(var re=0;re<S.length;re++){const mt=new Uint8Array(S[re]);for(var $=mt.length,z=0;z<$;z+=4)ae&=mt[z+3]}const le=ae!=255,$e=function(ht,Ie,ge,ie,me,Q){const X=[];for(var he=0;he<ht.length;he++){const Nt=new Uint8Array(ht[he]),ot=new Uint32Array(Nt.buffer);var ke;let Ot=0,we=0,qe=Ie,Ke=ge,it=ie?1:0;if(he!=0){const Me=Q||ie||he==1||X[he-2].dispose!=0?1:2;let yt=0,fe=1e9;for(let ye=0;ye<Me;ye++){var ee=new Uint8Array(ht[he-1-ye]);const _e=new Uint32Array(ht[he-1-ye]);let ft=Ie,lt=ge,nt=-1,Et=-1;for(let ne=0;ne<ge;ne++)for(let Te=0;Te<Ie;Te++)ot[Re=ne*Ie+Te]!=_e[Re]&&(Te<ft&&(ft=Te),Te>nt&&(nt=Te),ne<lt&&(lt=ne),ne>Et&&(Et=ne));nt==-1&&(ft=lt=nt=Et=0),me&&((1&ft)==1&&ft--,(1&lt)==1&&lt--);const jt=(nt-ft+1)*(Et-lt+1);jt<fe&&(fe=jt,yt=ye,Ot=ft,we=lt,qe=nt-ft+1,Ke=Et-lt+1)}ee=new Uint8Array(ht[he-1-yt]),yt==1&&(X[he-1].dispose=2),ke=new Uint8Array(qe*Ke*4),t(ee,Ie,ge,ke,qe,Ke,-Ot,-we,0),it=t(Nt,Ie,ge,ke,qe,Ke,-Ot,-we,3)?1:0,it==1?h(Nt,Ie,ge,ke,{x:Ot,y:we,width:qe,height:Ke}):t(Nt,Ie,ge,ke,qe,Ke,-Ot,-we,0)}else ke=Nt.slice(0);X.push({rect:{x:Ot,y:we,width:qe,height:Ke},img:ke,blend:it,dispose:0})}if(ie)for(he=0;he<X.length;he++){if((_t=X[he]).blend==1)continue;const Nt=_t.rect,ot=X[he-1].rect,Ot=Math.min(Nt.x,ot.x),we=Math.min(Nt.y,ot.y),qe={x:Ot,y:we,width:Math.max(Nt.x+Nt.width,ot.x+ot.width)-Ot,height:Math.max(Nt.y+Nt.height,ot.y+ot.height)-we};X[he-1].dispose=1,he-1!=0&&f(ht,Ie,ge,X,he-1,qe,me),f(ht,Ie,ge,X,he,qe,me)}let pe=0;if(ht.length!=1)for(var Re=0;Re<X.length;Re++){var _t;pe+=(_t=X[Re]).rect.width*_t.rect.height}return X}(S,T,_,O,L,V),Be={},se=[],Se=[];if(N!=0){const mt=[];for(z=0;z<$e.length;z++)mt.push($e[z].img.buffer);const ht=function(me){let Q=0;for(var X=0;X<me.length;X++)Q+=me[X].byteLength;const he=new Uint8Array(Q);let ke=0;for(X=0;X<me.length;X++){const ee=new Uint8Array(me[X]),pe=ee.length;for(let Re=0;Re<pe;Re+=4){let _t=ee[Re],Nt=ee[Re+1],ot=ee[Re+2];const Ot=ee[Re+3];Ot==0&&(_t=Nt=ot=0),he[ke+Re]=_t,he[ke+Re+1]=Nt,he[ke+Re+2]=ot,he[ke+Re+3]=Ot}ke+=pe}return he.buffer}(mt),Ie=y(ht,N);for(z=0;z<Ie.plte.length;z++)se.push(Ie.plte[z].est.rgba);let ge=0;for(z=0;z<$e.length;z++){const ie=(Ee=$e[z]).img.length;var ce=new Uint8Array(Ie.inds.buffer,ge>>2,ie>>2);Se.push(ce);const me=new Uint8Array(Ie.abuf,ge,ie);H&&a(Ee.img,Ee.rect.width,Ee.rect.height,se,me,ce),Ee.img.set(me),ge+=ie}}else for(re=0;re<$e.length;re++){var Ee=$e[re];const mt=new Uint32Array(Ee.img.buffer);var He=Ee.rect.width;for($=mt.length,ce=new Uint8Array($),Se.push(ce),z=0;z<$;z++){const ht=mt[z];if(z!=0&&ht==mt[z-1])ce[z]=ce[z-1];else if(z>He&&ht==mt[z-He])ce[z]=ce[z-He];else{let Ie=Be[ht];if(Ie==null&&(Be[ht]=Ie=se.length,se.push(ht),se.length>=300))break;ce[z]=Ie}}}const tt=se.length;for(tt<=256&&j==0&&(R=tt<=2?1:tt<=4?2:tt<=16?4:8,R=Math.max(R,E)),re=0;re<$e.length;re++){(Ee=$e[re]).rect.x,Ee.rect.y,He=Ee.rect.width;const mt=Ee.rect.height;let ht=Ee.img;new Uint32Array(ht.buffer);let Ie=4*He,ge=4;if(tt<=256&&j==0){Ie=Math.ceil(R*He/8);var ut=new Uint8Array(Ie*mt);const ie=Se[re];for(let me=0;me<mt;me++){z=me*Ie;const Q=me*He;if(R==8)for(var Ge=0;Ge<He;Ge++)ut[z+Ge]=ie[Q+Ge];else if(R==4)for(Ge=0;Ge<He;Ge++)ut[z+(Ge>>1)]|=ie[Q+Ge]<<4-4*(1&Ge);else if(R==2)for(Ge=0;Ge<He;Ge++)ut[z+(Ge>>2)]|=ie[Q+Ge]<<6-2*(3&Ge);else if(R==1)for(Ge=0;Ge<He;Ge++)ut[z+(Ge>>3)]|=ie[Q+Ge]<<7-1*(7&Ge)}ht=ut,W=3,ge=1}else if(le==0&&$e.length==1){ut=new Uint8Array(He*mt*3);const ie=He*mt;for(z=0;z<ie;z++){const me=3*z,Q=4*z;ut[me]=ht[Q],ut[me+1]=ht[Q+1],ut[me+2]=ht[Q+2]}ht=ut,W=2,ge=3,Ie=3*He}Ee.img=ht,Ee.bpl=Ie,Ee.bpp=ge}return{ctype:W,depth:R,plte:se,frames:$e}}function f(S,T,_,N,A,O,L){const V=Uint8Array,E=Uint32Array,j=new V(S[A-1]),H=new E(S[A-1]),W=A+1<S.length?new V(S[A+1]):null,R=new V(S[A]),ae=new E(R.buffer);let re=T,$=_,z=-1,le=-1;for(let Be=0;Be<O.height;Be++)for(let se=0;se<O.width;se++){const Se=O.x+se,ce=O.y+Be,Ee=ce*T+Se,He=ae[Ee];He==0||N[A-1].dispose==0&&H[Ee]==He&&(W==null||W[4*Ee+3]!=0)||(Se<re&&(re=Se),Se>z&&(z=Se),ce<$&&($=ce),ce>le&&(le=ce))}z==-1&&(re=$=z=le=0),L&&((1&re)==1&&re--,(1&$)==1&&$--),O={x:re,y:$,width:z-re+1,height:le-$+1};const $e=N[A];$e.rect=O,$e.blend=1,$e.img=new Uint8Array(O.width*O.height*4),N[A-1].dispose==0?(t(j,T,_,$e.img,O.width,O.height,-O.x,-O.y,0),h(R,T,_,$e.img,O)):t(R,T,_,$e.img,O.width,O.height,-O.x,-O.y,0)}function h(S,T,_,N,A){t(S,T,_,N,A.width,A.height,-A.x,-A.y,2)}function p(S,T,_,N,A,O,L){const V=[];let E,j=[0,1,2,3,4];O!=-1?j=[O]:(T*N>5e5||_==1)&&(j=[0]),L&&(E={level:0});const H=HH;for(var W=0;W<j.length;W++){for(let re=0;re<T;re++)m(A,S,re,N,_,j[W]);V.push(H.deflate(A,E))}let R,ae=1e9;for(W=0;W<V.length;W++)V[W].length<ae&&(R=W,ae=V[W].length);return V[R]}function m(S,T,_,N,A,O){const L=_*N;let V=L+_;if(S[V]=O,V++,O==0)if(N<500)for(var E=0;E<N;E++)S[V+E]=T[L+E];else S.set(new Uint8Array(T.buffer,L,N),V);else if(O==1){for(E=0;E<A;E++)S[V+E]=T[L+E];for(E=A;E<N;E++)S[V+E]=T[L+E]-T[L+E-A]+256&255}else if(_==0){for(E=0;E<A;E++)S[V+E]=T[L+E];if(O==2)for(E=A;E<N;E++)S[V+E]=T[L+E];if(O==3)for(E=A;E<N;E++)S[V+E]=T[L+E]-(T[L+E-A]>>1)+256&255;if(O==4)for(E=A;E<N;E++)S[V+E]=T[L+E]-n(T[L+E-A],0,0)+256&255}else{if(O==2)for(E=0;E<N;E++)S[V+E]=T[L+E]+256-T[L+E-N]&255;if(O==3){for(E=0;E<A;E++)S[V+E]=T[L+E]+256-(T[L+E-N]>>1)&255;for(E=A;E<N;E++)S[V+E]=T[L+E]+256-(T[L+E-N]+T[L+E-A]>>1)&255}if(O==4){for(E=0;E<A;E++)S[V+E]=T[L+E]+256-n(0,T[L+E-N],0)&255;for(E=A;E<N;E++)S[V+E]=T[L+E]+256-n(T[L+E-A],T[L+E-N],T[L+E-A-N])&255}}}function y(S,T){const _=new Uint8Array(S),N=_.slice(0),A=new Uint32Array(N.buffer),O=b(N,T),L=O[0],V=O[1],E=_.length,j=new Uint8Array(E>>2);let H;if(_.length<2e7)for(var W=0;W<E;W+=4)H=g(L,R=_[W]*(1/255),ae=_[W+1]*(1/255),re=_[W+2]*(1/255),$=_[W+3]*(1/255)),j[W>>2]=H.ind,A[W>>2]=H.est.rgba;else for(W=0;W<E;W+=4){var R=_[W]*.00392156862745098,ae=_[W+1]*(1/255),re=_[W+2]*(1/255),$=_[W+3]*(1/255);for(H=L;H.left;)H=v(H.est,R,ae,re,$)<=0?H.left:H.right;j[W>>2]=H.ind,A[W>>2]=H.est.rgba}return{abuf:N.buffer,inds:j,plte:V}}function b(S,T,_){_==null&&(_=1e-4);const N=new Uint32Array(S.buffer),A={i0:0,i1:S.length,bst:null,est:null,tdst:0,left:null,right:null};A.bst=I(S,A.i0,A.i1),A.est=k(A.bst);const O=[A];for(;O.length<T;){let V=0,E=0;for(var L=0;L<O.length;L++)O[L].est.L>V&&(V=O[L].est.L,E=L);if(V<_)break;const j=O[E],H=w(S,N,j.i0,j.i1,j.est.e,j.est.eMq255);if(j.i0>=H||j.i1<=H){j.est.L=0;continue}const W={i0:j.i0,i1:H,bst:null,est:null,tdst:0,left:null,right:null};W.bst=I(S,W.i0,W.i1),W.est=k(W.bst);const R={i0:H,i1:j.i1,bst:null,est:null,tdst:0,left:null,right:null};for(R.bst={R:[],m:[],N:j.bst.N-W.bst.N},L=0;L<16;L++)R.bst.R[L]=j.bst.R[L]-W.bst.R[L];for(L=0;L<4;L++)R.bst.m[L]=j.bst.m[L]-W.bst.m[L];R.est=k(R.bst),j.left=W,j.right=R,O[E]=W,O.push(R)}for(O.sort((V,E)=>E.bst.N-V.bst.N),L=0;L<O.length;L++)O[L].ind=L;return[A,O]}function g(S,T,_,N,A){if(S.left==null)return S.tdst=function(W,R,ae,re,$){const z=R-W[0],le=ae-W[1],$e=re-W[2],Be=$-W[3];return z*z+le*le+$e*$e+Be*Be}(S.est.q,T,_,N,A),S;const O=v(S.est,T,_,N,A);let L=S.left,V=S.right;O>0&&(L=S.right,V=S.left);const E=g(L,T,_,N,A);if(E.tdst<=O*O)return E;const j=g(V,T,_,N,A);return j.tdst<E.tdst?j:E}function v(S,T,_,N,A){const{e:O}=S;return O[0]*T+O[1]*_+O[2]*N+O[3]*A-S.eMq}function w(S,T,_,N,A,O){for(N-=4;_<N;){for(;C(S,_,A)<=O;)_+=4;for(;C(S,N,A)>O;)N-=4;if(_>=N)break;const L=T[_>>2];T[_>>2]=T[N>>2],T[N>>2]=L,_+=4,N-=4}for(;C(S,_,A)>O;)_-=4;return _+4}function C(S,T,_){return S[T]*_[0]+S[T+1]*_[1]+S[T+2]*_[2]+S[T+3]*_[3]}function I(S,T,_){const N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],A=[0,0,0,0],O=_-T>>2;for(let L=T;L<_;L+=4){const V=S[L]*.00392156862745098,E=S[L+1]*(1/255),j=S[L+2]*(1/255),H=S[L+3]*(1/255);A[0]+=V,A[1]+=E,A[2]+=j,A[3]+=H,N[0]+=V*V,N[1]+=V*E,N[2]+=V*j,N[3]+=V*H,N[5]+=E*E,N[6]+=E*j,N[7]+=E*H,N[10]+=j*j,N[11]+=j*H,N[15]+=H*H}return N[4]=N[1],N[8]=N[2],N[9]=N[6],N[12]=N[3],N[13]=N[7],N[14]=N[11],{R:N,m:A,N:O}}function k(S){const{R:T}=S,{m:_}=S,{N}=S,A=_[0],O=_[1],L=_[2],V=_[3],E=N==0?0:1/N,j=[T[0]-A*A*E,T[1]-A*O*E,T[2]-A*L*E,T[3]-A*V*E,T[4]-O*A*E,T[5]-O*O*E,T[6]-O*L*E,T[7]-O*V*E,T[8]-L*A*E,T[9]-L*O*E,T[10]-L*L*E,T[11]-L*V*E,T[12]-V*A*E,T[13]-V*O*E,T[14]-V*L*E,T[15]-V*V*E],H=j,W=D;let R=[Math.random(),Math.random(),Math.random(),Math.random()],ae=0,re=0;if(N!=0)for(let z=0;z<16&&(R=W.multVec(H,R),re=Math.sqrt(W.dot(R,R)),R=W.sml(1/re,R),!(z!=0&&Math.abs(re-ae)<1e-9));z++)ae=re;const $=[A*E,O*E,L*E,V*E];return{Cov:j,q:$,e:R,L:ae,eMq255:W.dot(W.sml(255,$),R),eMq:W.dot(R,$),rgba:(Math.round(255*$[3])<<24|Math.round(255*$[2])<<16|Math.round(255*$[1])<<8|Math.round(255*$[0])<<0)>>>0}}var D={multVec:(S,T)=>[S[0]*T[0]+S[1]*T[1]+S[2]*T[2]+S[3]*T[3],S[4]*T[0]+S[5]*T[1]+S[6]*T[2]+S[7]*T[3],S[8]*T[0]+S[9]*T[1]+S[10]*T[2]+S[11]*T[3],S[12]*T[0]+S[13]*T[1]+S[14]*T[2]+S[15]*T[3]],dot:(S,T)=>S[0]*T[0]+S[1]*T[1]+S[2]*T[2]+S[3]*T[3],sml:(S,T)=>[S*T[0],S*T[1],S*T[2],S*T[3]]};Vi.encode=function(T,_,N,A,O,L,V){A==null&&(A=0),V==null&&(V=!1);const E=d(T,_,N,A,[!1,!1,!1,0,V,!1]);return u(E,-1),l(E,_,N,O,L)},Vi.encodeLL=function(T,_,N,A,O,L,V,E){const j={ctype:0+(A==1?0:2)+(O==0?0:4),depth:L,frames:[]},H=(A+O)*L,W=H*_;for(let R=0;R<T.length;R++)j.frames.push({rect:{x:0,y:0,width:_,height:N},img:new Uint8Array(T[R]),blend:0,dispose:1,bpp:Math.ceil(H/8),bpl:Math.ceil(W/8)});return u(j,0,!0),l(j,_,N,V,E)},Vi.encode.compress=d,Vi.encode.dither=a,Vi.quantize=y,Vi.quantize.getKDtree=b,Vi.quantize.getNearest=g})();const AD={toArrayBuffer(t,e){const n=t.width,r=t.height,s=n<<2,i=t.getContext("2d").getImageData(0,0,n,r),o=new Uint32Array(i.data.buffer),a=(32*n+31)/32<<2,l=a*r,u=122+l,d=new ArrayBuffer(u),f=new DataView(d),h=1<<20;let p,m,y,b,g=h,v=0,w=0,C=0;function I(S){f.setUint16(w,S,!0),w+=2}function k(S){f.setUint32(w,S,!0),w+=4}function D(S){w+=S}I(19778),k(u),D(4),k(122),k(108),k(n),k(-r>>>0),I(1),I(32),k(3),k(l),k(2835),k(2835),D(8),k(16711680),k(65280),k(255),k(4278190080),k(1466527264),function S(){for(;v<r&&g>0;){for(b=122+v*a,p=0;p<s;)g--,m=o[C++],y=m>>>24,f.setUint32(b+p,m<<8|y),p+=4;v++}C<o.length?(g=h,setTimeout(S,AD._dly)):e(d)}()},toBlob(t,e){this.toArrayBuffer(t,n=>{e(new Blob([n],{type:"image/bmp"}))})},_dly:9};var Os={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},VH={[Os.CHROME]:16384,[Os.FIREFOX]:11180,[Os.DESKTOP_SAFARI]:16384,[Os.IE]:8192,[Os.IOS]:4096,[Os.ETC]:8192};const mw=typeof window<"u",RD=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,xm=mw&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),WH=(mw||RD)&&(xm&&xm.getOriginalSymbol(window,"File")||typeof File<"u"&&File),OD=(mw||RD)&&(xm&&xm.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function gw(t,e,n=Date.now()){return new Promise(r=>{const s=t.split(","),i=s[0].match(/:(.*?);/)[1],o=globalThis.atob(s[1]);let a=o.length;const l=new Uint8Array(a);for(;a--;)l[a]=o.charCodeAt(a);const u=new Blob([l],{type:i});u.name=e,u.lastModified=n,r(u)})}function PD(t){return new Promise((e,n)=>{const r=new OD;r.onload=()=>e(r.result),r.onerror=s=>n(s),r.readAsDataURL(t)})}function LD(t){return new Promise((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=s=>n(s),r.src=t})}function Al(){if(Al.cachedResult!==void 0)return Al.cachedResult;let t=Os.ETC;const{userAgent:e}=navigator;return/Chrom(e|ium)/i.test(e)?t=Os.CHROME:/iP(ad|od|hone)/i.test(e)&&/WebKit/i.test(e)?t=Os.IOS:/Safari/i.test(e)?t=Os.DESKTOP_SAFARI:/Firefox/i.test(e)?t=Os.FIREFOX:(/MSIE/i.test(e)||document.documentMode)&&(t=Os.IE),Al.cachedResult=t,Al.cachedResult}function $D(t,e){const n=Al(),r=VH[n];let s=t,i=e,o=s*i;const a=s>i?i/s:s/i;for(;o>r*r;){const l=(r+s)/2,u=(r+i)/2;l<u?(i=u,s=u*a):(i=l*a,s=l),o=s*i}return{width:s,height:i}}function Fg(t,e){let n,r;try{if(n=new OffscreenCanvas(t,e),r=n.getContext("2d"),r===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{n=document.createElement("canvas"),r=n.getContext("2d")}return n.width=t,n.height=e,[n,r]}function zD(t,e){const{width:n,height:r}=$D(t.width,t.height),[s,i]=Fg(n,r);return e&&/jpe?g/.test(e)&&(i.fillStyle="white",i.fillRect(0,0,s.width,s.height)),i.drawImage(t,0,0,s.width,s.height),s}function Tp(){return Tp.cachedResult!==void 0||(Tp.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Tp.cachedResult}function bm(t,e={}){return new Promise(function(n,r){let s,i;var o=function(){try{return i=zD(s,e.fileType||t.type),n([s,i])}catch(l){return r(l)}},a=function(l){try{var u=function(d){try{throw d}catch(f){return r(f)}};try{let d;return PD(t).then(function(f){try{return d=f,LD(d).then(function(h){try{return s=h,function(){try{return o()}catch(p){return r(p)}}()}catch(p){return u(p)}},u)}catch(h){return u(h)}},u)}catch(d){u(d)}}catch(d){return r(d)}};try{if(Tp()||[Os.DESKTOP_SAFARI,Os.MOBILE_SAFARI].includes(Al()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(t).then(function(l){try{return s=l,o()}catch{return a()}},a)}catch{a()}})}function vm(t,e,n,r,s=1){return new Promise(function(i,o){let a;if(e==="image/png"){let f,h,p;return f=t.getContext("2d"),{data:h}=f.getImageData(0,0,t.width,t.height),p=Vi.encode([h.buffer],t.width,t.height,4096*s),a=new Blob([p],{type:e}),a.name=n,a.lastModified=r,l.call(this)}{let f=function(){return l.call(this)};var u=f;if(e==="image/bmp")return new Promise(h=>AD.toBlob(t,h)).then((function(h){try{return a=h,a.name=n,a.lastModified=r,f.call(this)}catch(p){return o(p)}}).bind(this),o);{let h=function(){return f.call(this)};var d=h;if(typeof OffscreenCanvas=="function"&&t instanceof OffscreenCanvas)return t.convertToBlob({type:e,quality:s}).then((function(p){try{return a=p,a.name=n,a.lastModified=r,h.call(this)}catch(m){return o(m)}}).bind(this),o);{let p;return p=t.toDataURL(e,s),gw(p,n,r).then((function(m){try{return a=m,h.call(this)}catch(y){return o(y)}}).bind(this),o)}}}function l(){return i(a)}})}function ao(t){t.width=0,t.height=0}function Xc(){return new Promise(function(t,e){let n,r,s,i;return Xc.cachedResult!==void 0?t(Xc.cachedResult):gw("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(o){try{return n=o,bm(n).then(function(a){try{return r=a[1],vm(r,n.type,n.name,n.lastModified).then(function(l){try{return s=l,ao(r),bm(s).then(function(u){try{return i=u[0],Xc.cachedResult=i.width===1&&i.height===2,t(Xc.cachedResult)}catch(d){return e(d)}},e)}catch(u){return e(u)}},e)}catch(l){return e(l)}},e)}catch(a){return e(a)}},e)})}function FD(t){return new Promise((e,n)=>{const r=new OD;r.onload=s=>{const i=new DataView(s.target.result);if(i.getUint16(0,!1)!=65496)return e(-2);const o=i.byteLength;let a=2;for(;a<o;){if(i.getUint16(a+2,!1)<=8)return e(-1);const l=i.getUint16(a,!1);if(a+=2,l==65505){if(i.getUint32(a+=2,!1)!=1165519206)return e(-1);const u=i.getUint16(a+=6,!1)==18761;a+=i.getUint32(a+4,u);const d=i.getUint16(a,u);a+=2;for(let f=0;f<d;f++)if(i.getUint16(a+12*f,u)==274)return e(i.getUint16(a+12*f+8,u))}else{if((65280&l)!=65280)break;a+=i.getUint16(a,!1)}}return e(-1)},r.onerror=s=>n(s),r.readAsArrayBuffer(t)})}function BD(t,e){const{width:n}=t,{height:r}=t,{maxWidthOrHeight:s}=e;let i,o=t;return isFinite(s)&&(n>s||r>s)&&([o,i]=Fg(n,r),n>r?(o.width=s,o.height=r/n*s):(o.width=n/r*s,o.height=s),i.drawImage(t,0,0,o.width,o.height),ao(t)),o}function UD(t,e){const{width:n}=t,{height:r}=t,[s,i]=Fg(n,r);switch(e>4&&e<9?(s.width=r,s.height=n):(s.width=n,s.height=r),e){case 2:i.transform(-1,0,0,1,n,0);break;case 3:i.transform(-1,0,0,-1,n,r);break;case 4:i.transform(1,0,0,-1,0,r);break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,r,0);break;case 7:i.transform(0,-1,-1,0,r,n);break;case 8:i.transform(0,-1,1,0,0,n)}return i.drawImage(t,0,0,n,r),ao(t),s}function D_(t,e,n=0){return new Promise(function(r,s){let i,o,a,l,u,d,f,h,p,m,y,b,g,v,w,C,I,k,D,S;function T(N=5){if(e.signal&&e.signal.aborted)throw e.signal.reason;i+=N,e.onProgress(Math.min(i,100))}function _(N){if(e.signal&&e.signal.aborted)throw e.signal.reason;i=Math.min(Math.max(N,i),100),e.onProgress(i)}return i=n,o=e.maxIteration||10,a=1024*e.maxSizeMB*1024,T(),bm(t,e).then((function(N){try{return[,l]=N,T(),u=BD(l,e),T(),new Promise(function(A,O){var L;if(!(L=e.exifOrientation))return FD(t).then((function(E){try{return L=E,V.call(this)}catch(j){return O(j)}}).bind(this),O);function V(){return A(L)}return V.call(this)}).then((function(A){try{return d=A,T(),Xc().then((function(O){try{return f=O?u:UD(u,d),T(),h=e.initialQuality||1,p=e.fileType||t.type,vm(f,p,t.name,t.lastModified,h).then((function(L){try{{let H=function(){if(o--&&(w>a||w>g)){let R,ae;return R=S?.95*D.width:D.width,ae=S?.95*D.height:D.height,[I,k]=Fg(R,ae),k.drawImage(D,0,0,R,ae),h*=p==="image/png"?.85:.95,vm(I,p,t.name,t.lastModified,h).then(function(re){try{return C=re,ao(D),D=I,w=C.size,_(Math.min(99,Math.floor((v-w)/(v-a)*100))),H}catch($){return s($)}},s)}return[1]},W=function(){return ao(D),ao(I),ao(u),ao(f),ao(l),_(100),r(C)};var E=H,j=W;if(m=L,T(),y=m.size>a,b=m.size>t.size,!y&&!b)return _(100),r(m);var V;return g=t.size,v=m.size,w=v,D=f,S=!e.alwaysKeepResolution&&y,(V=(function(R){for(;R;){if(R.then)return void R.then(V,s);try{if(R.pop){if(R.length)return R.pop()?W.call(this):R;R=H}else R=R.call(this)}catch(ae){return s(ae)}}}).bind(this))(H)}}catch(H){return s(H)}}).bind(this),s)}catch(L){return s(L)}}).bind(this),s)}catch(O){return s(O)}}).bind(this),s)}catch(A){return s(A)}}).bind(this),s)})}const KH=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let cy;function GH(t,e){return new Promise((n,r)=>{cy||(cy=function(o){const a=[];return typeof o=="function"?a.push(`(${o})()`):a.push(o),URL.createObjectURL(new Blob(a))}(KH));const s=new Worker(cy);s.addEventListener("message",function(o){if(e.signal&&e.signal.aborted)s.terminate();else if(o.data.progress===void 0){if(o.data.error)return r(new Error(o.data.error)),void s.terminate();n(o.data.file),s.terminate()}else e.onProgress(o.data.progress)}),s.addEventListener("error",r),e.signal&&e.signal.addEventListener("abort",()=>{r(e.signal.reason),s.terminate()}),s.postMessage({file:t,imageCompressionLibUrl:e.libURL,options:{...e,onProgress:void 0,signal:void 0}})})}function us(t,e){return new Promise(function(n,r){let s,i,o,a,l,u;if(s={...e},o=0,{onProgress:a}=s,s.maxSizeMB=s.maxSizeMB||Number.POSITIVE_INFINITY,l=typeof s.useWebWorker!="boolean"||s.useWebWorker,delete s.useWebWorker,s.onProgress=p=>{o=p,typeof a=="function"&&a(o)},!(t instanceof Blob||t instanceof WH))return r(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(t.type))return r(new Error("The file given is not an image"));if(u=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!l||typeof Worker!="function"||u)return D_(t,s).then((function(p){try{return i=p,h.call(this)}catch(m){return r(m)}}).bind(this),r);var d=(function(){try{return h.call(this)}catch(p){return r(p)}}).bind(this),f=function(p){try{return D_(t,s).then(function(m){try{return i=m,d()}catch(y){return r(y)}},r)}catch(m){return r(m)}};try{return s.libURL=s.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",GH(t,s).then(function(p){try{return i=p,d()}catch{return f()}},f)}catch{f()}function h(){try{i.name=t.name,i.lastModified=t.lastModified}catch{}try{s.preserveExif&&t.type==="image/jpeg"&&(!s.fileType||s.fileType&&s.fileType===t.type)&&(i=DD(t,i))}catch{}return n(i)}})}us.getDataUrlFromFile=PD,us.getFilefromDataUrl=gw,us.loadImage=LD,us.drawImageInCanvas=zD,us.drawFileInCanvas=bm,us.canvasToFile=vm,us.getExifOrientation=FD,us.handleMaxWidthOrHeight=BD,us.followExifOrientation=UD,us.cleanupCanvasMemory=ao,us.isAutoOrientationInBrowser=Xc,us.approximateBelowMaximumCanvasSizeOfBrowser=$D,us.copyExifWithoutOrientation=DD,us.getBrowserName=Al,us.version="2.0.2";function Jr(t){this.content=t}Jr.prototype={constructor:Jr,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,s=r.find(t),i=r.content.slice();return s==-1?i.push(n||t,e):(i[s+1]=e,n&&(i[s]=n)),new Jr(i)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new Jr(n)},addToStart:function(t,e){return new Jr([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new Jr(n)},addBefore:function(t,e,n){var r=this.remove(e),s=r.content.slice(),i=r.find(t);return s.splice(i==-1?s.length:i,0,e,n),new Jr(s)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=Jr.from(t),t.size?new Jr(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Jr.from(t),t.size?new Jr(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Jr.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};Jr.from=function(t){if(t instanceof Jr)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new Jr(e)};function HD(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let s=t.child(r),i=e.child(r);if(s==i){n+=s.nodeSize;continue}if(!s.sameMarkup(i))return n;if(s.isText&&s.text!=i.text){for(let o=0;s.text[o]==i.text[o];o++)n++;return n}if(s.content.size||i.content.size){let o=HD(s.content,i.content,n+1);if(o!=null)return o}n+=s.nodeSize}}function VD(t,e,n,r){for(let s=t.childCount,i=e.childCount;;){if(s==0||i==0)return s==i?null:{a:n,b:r};let o=t.child(--s),a=e.child(--i),l=o.nodeSize;if(o==a){n-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let u=0,d=Math.min(o.text.length,a.text.length);for(;u<d&&o.text[o.text.length-u-1]==a.text[a.text.length-u-1];)u++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let u=VD(o.content,a.content,n-1,r-1);if(u)return u}n-=l,r-=l}}class Mt{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,s=0,i){for(let o=0,a=0;a<n;o++){let l=this.content[o],u=a+l.nodeSize;if(u>e&&r(l,s+a,i||null,o)!==!1&&l.content.size){let d=a+1;l.nodesBetween(Math.max(0,e-d),Math.min(l.content.size,n-d),r,s+d)}a=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,s){let i="",o=!0;return this.nodesBetween(e,n,(a,l)=>{let u=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?s?typeof s=="function"?s(a):s:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&u||a.isTextblock)&&r&&(o?o=!1:i+=r),i+=u},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,s=this.content.slice(),i=0;for(n.isText&&n.sameMarkup(r)&&(s[s.length-1]=n.withText(n.text+r.text),i=1);i<e.content.length;i++)s.push(e.content[i]);return new Mt(s,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],s=0;if(n>e)for(let i=0,o=0;o<n;i++){let a=this.content[i],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),r.push(a),s+=a.nodeSize),o=l}return new Mt(r,s)}cutByIndex(e,n){return e==n?Mt.empty:e==0&&n==this.content.length?this:new Mt(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let s=this.content.slice(),i=this.size+n.nodeSize-r.nodeSize;return s[e]=n,new Mt(s,i)}addToStart(e){return new Mt([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Mt(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let s=this.content[n];e(s,r,n),r+=s.nodeSize}}findDiffStart(e,n=0){return HD(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return VD(this,e,n,r)}findIndex(e){if(e==0)return zh(0,e);if(e==this.size)return zh(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let s=this.child(n),i=r+s.nodeSize;if(i>=e)return i==e?zh(n+1,i):zh(n,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return Mt.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new Mt(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Mt.empty;let n,r=0;for(let s=0;s<e.length;s++){let i=e[s];r+=i.nodeSize,s&&i.isText&&e[s-1].sameMarkup(i)?(n||(n=e.slice(0,s)),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new Mt(n||e,r)}static from(e){if(!e)return Mt.empty;if(e instanceof Mt)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Mt([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Mt.empty=new Mt([],0);const uy={index:0,offset:0};function zh(t,e){return uy.index=t,uy.offset=e,uy}function wm(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!wm(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!wm(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let Un=class P1{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let s=0;s<e.length;s++){let i=e[s];if(this.eq(i))return e;if(this.type.excludes(i.type))n||(n=e.slice(0,s));else{if(i.type.excludes(this.type))return e;!r&&i.type.rank>this.type.rank&&(n||(n=e.slice(0,s)),n.push(this),r=!0),n&&n.push(i)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&wm(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let s=r.create(n.attrs);return r.checkAttrs(s.attrs),s}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return P1.none;if(e instanceof P1)return[e];let n=e.slice();return n.sort((r,s)=>r.type.rank-s.type.rank),n}};Un.none=[];class km extends Error{}class Kt{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=KD(this.content,e+this.openStart,n);return r&&new Kt(r,this.openStart,this.openEnd)}removeBetween(e,n){return new Kt(WD(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return Kt.empty;let r=n.openStart||0,s=n.openEnd||0;if(typeof r!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Kt(Mt.fromJSON(e,n.content),r,s)}static maxOpen(e,n=!0){let r=0,s=0;for(let i=e.firstChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.firstChild)r++;for(let i=e.lastChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.lastChild)s++;return new Kt(e,r,s)}}Kt.empty=new Kt(Mt.empty,0,0);function WD(t,e,n){let{index:r,offset:s}=t.findIndex(e),i=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(s==e||i.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,i.copy(WD(i.content,e-s-1,n-s-1)))}function KD(t,e,n,r){let{index:s,offset:i}=t.findIndex(e),o=t.maybeChild(s);if(i==e||o.isText)return r&&!r.canReplace(s,s,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=KD(o.content,e-i-1,n,o);return a&&t.replaceChild(s,o.copy(a))}function qH(t,e,n){if(n.openStart>t.depth)throw new km("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new km("Inconsistent open depths");return GD(t,e,n,0)}function GD(t,e,n,r){let s=t.index(r),i=t.node(r);if(s==e.index(r)&&r<t.depth-n.openStart){let o=GD(t,e,n,r+1);return i.copy(i.content.replaceChild(s,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,a=o.content;return Wl(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=YH(n,t);return Wl(i,YD(t,o,a,e,r))}else return Wl(i,Sm(t,e,r))}function qD(t,e){if(!e.type.compatibleContent(t.type))throw new km("Cannot join "+e.type.name+" onto "+t.type.name)}function L1(t,e,n){let r=t.node(n);return qD(r,e.node(n)),r}function Vl(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Ld(t,e,n,r){let s=(e||t).node(n),i=0,o=e?e.index(n):s.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(Vl(t.nodeAfter,r),i++));for(let a=i;a<o;a++)Vl(s.child(a),r);e&&e.depth==n&&e.textOffset&&Vl(e.nodeBefore,r)}function Wl(t,e){return t.type.checkContent(e),t.copy(e)}function YD(t,e,n,r,s){let i=t.depth>s&&L1(t,e,s+1),o=r.depth>s&&L1(n,r,s+1),a=[];return Ld(null,t,s,a),i&&o&&e.index(s)==n.index(s)?(qD(i,o),Vl(Wl(i,YD(t,e,n,r,s+1)),a)):(i&&Vl(Wl(i,Sm(t,e,s+1)),a),Ld(e,n,s,a),o&&Vl(Wl(o,Sm(n,r,s+1)),a)),Ld(r,null,s,a),new Mt(a)}function Sm(t,e,n){let r=[];if(Ld(null,t,n,r),t.depth>n){let s=L1(t,e,n+1);Vl(Wl(s,Sm(t,e,n+1)),r)}return Ld(e,null,n,r),new Mt(r)}function YH(t,e){let n=e.depth-t.openStart,s=e.node(n).copy(t.content);for(let i=n-1;i>=0;i--)s=e.node(i).copy(Mt.from(s));return{start:s.resolveNoCache(t.openStart+n),end:s.resolveNoCache(s.content.size-t.openEnd-n)}}class If{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],s=e.child(n);return r?e.child(n).cut(r):s}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],s=n==0?0:this.path[n*3-1]+1;for(let i=0;i<e;i++)s+=r.child(i).nodeSize;return s}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return Un.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),s=e.maybeChild(n);if(!r){let a=r;r=s,s=a}let i=r.marks;for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!s||!i[o].isInSet(s.marks))&&(i=i[o--].removeFromSet(i));return i}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,s=e.parent.maybeChild(e.index());for(var i=0;i<r.length;i++)r[i].type.spec.inclusive===!1&&(!s||!r[i].isInSet(s.marks))&&(r=r[i--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new _m(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],s=0,i=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(i),u=i-l;if(r.push(o,a,s+l),!u||(o=o.child(a),o.isText))break;i=u-1,s+=l+1}return new If(n,r,i)}static resolveCached(e,n){let r=A_.get(e);if(r)for(let i=0;i<r.elts.length;i++){let o=r.elts[i];if(o.pos==n)return o}else A_.set(e,r=new JH);let s=r.elts[r.i]=If.resolve(e,n);return r.i=(r.i+1)%XH,s}}class JH{constructor(){this.elts=[],this.i=0}}const XH=12,A_=new WeakMap;class _m{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const QH=Object.create(null);let Ho=class $1{constructor(e,n,r,s=Un.none){this.type=e,this.attrs=n,this.marks=s,this.content=r||Mt.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,s=0){this.content.nodesBetween(e,n,r,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,s){return this.content.textBetween(e,n,r,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&wm(this.attrs,n||e.defaultAttrs||QH)&&Un.sameSet(this.marks,r||Un.none)}copy(e=null){return e==this.content?this:new $1(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new $1(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return Kt.empty;let s=this.resolve(e),i=this.resolve(n),o=r?0:s.sharedDepth(n),a=s.start(o),u=s.node(o).content.cut(s.pos-a,i.pos-a);return new Kt(u,s.depth-o,i.depth-o)}replace(e,n,r){return qH(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:s}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(s==e||n.isText)return n;e-=s+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let s=this.content.child(n-1);return{node:s,index:n-1,offset:r-s.nodeSize}}resolve(e){return If.resolveCached(this,e)}resolveNoCache(e){return If.resolve(this,e)}rangeHasMark(e,n,r){let s=!1;return n>e&&this.nodesBetween(e,n,i=>(r.isInSet(i.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),JD(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=Mt.empty,s=0,i=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,s,i),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=s;l<i;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,s){if(s&&!this.type.allowsMarks(s))return!1;let i=this.contentMatchAt(e).matchType(r),o=i&&i.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Un.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!Un.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let s=Mt.fromJSON(e,n.content),i=e.nodeType(n.type).create(n.attrs,s,r);return i.type.checkAttrs(i.attrs),i}};Ho.prototype.text=void 0;class Tm extends Ho{constructor(e,n,r,s){if(super(e,n,null,s),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):JD(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Tm(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Tm(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function JD(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class ec{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new ZH(e,n);if(r.next==null)return ec.empty;let s=XD(r);r.next&&r.err("Unexpected trailing text");let i=o9(i9(s));return a9(i,r),i}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let s=this;for(let i=n;s&&i<r;i++)s=s.matchType(e.child(i).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let s=[this];function i(o,a){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return Mt.from(a.map(u=>u.createAndFill()));for(let u=0;u<o.next.length;u++){let{type:d,next:f}=o.next[u];if(!(d.isText||d.hasRequiredAttrs())&&s.indexOf(f)==-1){s.push(f);let h=i(f,a.concat(d));if(h)return h}}return null}return i(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let s=r.shift(),i=s.match;if(i.matchType(e)){let o=[];for(let a=s;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<i.next.length;o++){let{type:a,next:l}=i.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!s.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:s}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let s=0;s<r.next.length;s++)e.indexOf(r.next[s].next)==-1&&n(r.next[s].next)}return n(this),e.map((r,s)=>{let i=s+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)i+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return i}).join(`
`)}}ec.empty=new ec(!0);class ZH{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function XD(t){let e=[];do e.push(e9(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function e9(t){let e=[];do e.push(t9(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function t9(t){let e=s9(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=n9(t,e);else break;return e}function R_(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function n9(t,e){let n=R_(t),r=n;return t.eat(",")&&(t.next!="}"?r=R_(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function r9(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let s=[];for(let i in n){let o=n[i];o.isInGroup(e)&&s.push(o)}return s.length==0&&t.err("No node type or group '"+e+"' found"),s}function s9(t){if(t.eat("(")){let e=XD(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=r9(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function i9(t){let e=[[]];return s(i(t,0),n()),e;function n(){return e.push([])-1}function r(o,a,l){let u={term:l,to:a};return e[o].push(u),u}function s(o,a){o.forEach(l=>l.to=a)}function i(o,a){if(o.type=="choice")return o.exprs.reduce((l,u)=>l.concat(i(u,a)),[]);if(o.type=="seq")for(let l=0;;l++){let u=i(o.exprs[l],a);if(l==o.exprs.length-1)return u;s(u,a=n())}else if(o.type=="star"){let l=n();return r(a,l),s(i(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return s(i(o.expr,a),l),s(i(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(i(o.expr,a));if(o.type=="range"){let l=a;for(let u=0;u<o.min;u++){let d=n();s(i(o.expr,l),d),l=d}if(o.max==-1)s(i(o.expr,l),l);else for(let u=o.min;u<o.max;u++){let d=n();r(l,d),s(i(o.expr,l),d),l=d}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function QD(t,e){return e-t}function O_(t,e){let n=[];return r(e),n.sort(QD);function r(s){let i=t[s];if(i.length==1&&!i[0].term)return r(i[0].to);n.push(s);for(let o=0;o<i.length;o++){let{term:a,to:l}=i[o];!a&&n.indexOf(l)==-1&&r(l)}}}function o9(t){let e=Object.create(null);return n(O_(t,0));function n(r){let s=[];r.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let u;for(let d=0;d<s.length;d++)s[d][0]==a&&(u=s[d][1]);O_(t,l).forEach(d=>{u||s.push([a,u=[]]),u.indexOf(d)==-1&&u.push(d)})})});let i=e[r.join(",")]=new ec(r.indexOf(t.length-1)>-1);for(let o=0;o<s.length;o++){let a=s[o][1].sort(QD);i.next.push({type:s[o][0],next:e[a.join(",")]||n(a)})}return i}}function a9(t,e){for(let n=0,r=[t];n<r.length;n++){let s=r[n],i=!s.validEnd,o=[];for(let a=0;a<s.next.length;a++){let{type:l,next:u}=s.next[a];o.push(l.name),i&&!(l.isText||l.hasRequiredAttrs())&&(i=!1),r.indexOf(u)==-1&&r.push(u)}i&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function ZD(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function eA(t,e){let n=Object.create(null);for(let r in t){let s=e&&e[r];if(s===void 0){let i=t[r];if(i.hasDefault)s=i.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=s}return n}function tA(t,e,n,r){for(let s in e)if(!(s in t))throw new RangeError(`Unsupported attribute ${s} for ${n} of type ${s}`);for(let s in t){let i=t[s];i.validate&&i.validate(e[s])}}function nA(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new c9(t,r,e[r]);return n}let P_=class rA{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=nA(e,r.attrs),this.defaultAttrs=ZD(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ec.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:eA(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Ho(this,this.computeAttrs(e),Mt.from(n),Un.setFrom(r))}createChecked(e=null,n,r){return n=Mt.from(n),this.checkContent(n),new Ho(this,this.computeAttrs(e),n,Un.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=Mt.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let s=this.contentMatch.matchFragment(n),i=s&&s.fillBefore(Mt.empty,!0);return i?new Ho(this,e,n.append(i),Un.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){tA(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:Un.none:e}static compile(e,n){let r=Object.create(null);e.forEach((i,o)=>r[i]=new rA(i,n,o));let s=n.spec.topNode||"doc";if(!r[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function l9(t,e,n){let r=n.split("|");return s=>{let i=s===null?"null":typeof s;if(r.indexOf(i)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${i}`)}}class c9{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?l9(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class Bg{constructor(e,n,r,s){this.name=e,this.rank=n,this.schema=r,this.spec=s,this.attrs=nA(e,s.attrs),this.excluded=null;let i=ZD(this.attrs);this.instance=i?new Un(this,i):null}create(e=null){return!e&&this.instance?this.instance:new Un(this,eA(this.attrs,e))}static compile(e,n){let r=Object.create(null),s=0;return e.forEach((i,o)=>r[i]=new Bg(i,s++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){tA(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}let sA=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let s in e)n[s]=e[s];n.nodes=Jr.from(e.nodes),n.marks=Jr.from(e.marks||{}),this.nodes=P_.compile(this.spec.nodes,this),this.marks=Bg.compile(this.spec.marks,this);let r=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let i=this.nodes[s],o=i.spec.content||"",a=i.spec.marks;if(i.contentMatch=r[o]||(r[o]=ec.parse(o,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=a=="_"?null:a?L_(this,a.split(" ")):a==""||!i.inlineContent?[]:null}for(let s in this.marks){let i=this.marks[s],o=i.spec.excludes;i.excluded=o==null?[i]:o==""?[]:L_(this,o.split(" "))}this.nodeFromJSON=s=>Ho.fromJSON(this,s),this.markFromJSON=s=>Un.fromJSON(this,s),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,s){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof P_){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,s)}text(e,n){let r=this.nodes.text;return new Tm(r,r.defaultAttrs,e,Un.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}};function L_(t,e){let n=[];for(let r=0;r<e.length;r++){let s=e[r],i=t.marks[s],o=i;if(i)n.push(i);else for(let a in t.marks){let l=t.marks[a];(s=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(s)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function u9(t){return t.tag!=null}function d9(t){return t.style!=null}class $a{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(s=>{if(u9(s))this.tags.push(s);else if(d9(s)){let i=/[^=]*/.exec(s.style)[0];r.indexOf(i)<0&&r.push(i),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let i=e.nodes[s.node];return i.contentMatch.matchType(i)})}parse(e,n={}){let r=new z_(this,n,!1);return r.addAll(e,Un.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new z_(this,n,!0);return r.addAll(e,Un.none,n.from,n.to),Kt.maxOpen(r.finish())}matchTag(e,n,r){for(let s=r?this.tags.indexOf(r)+1:0;s<this.tags.length;s++){let i=this.tags[s];if(p9(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||n.matchesContext(i.context))){if(i.getAttrs){let o=i.getAttrs(e);if(o===!1)continue;i.attrs=o||void 0}return i}}}matchStyle(e,n,r,s){for(let i=s?this.styles.indexOf(s)+1:0;i<this.styles.length;i++){let o=this.styles[i],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(s){let i=s.priority==null?50:s.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<i)break}n.splice(o,0,s)}for(let s in e.marks){let i=e.marks[s].spec.parseDOM;i&&i.forEach(o=>{r(o=F_(o)),o.mark||o.ignore||o.clearMark||(o.mark=s)})}for(let s in e.nodes){let i=e.nodes[s].spec.parseDOM;i&&i.forEach(o=>{r(o=F_(o)),o.node||o.ignore||o.mark||(o.node=s)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new $a(e,$a.schemaRules(e)))}}const iA={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},f9={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},oA={ol:!0,ul:!0},Mf=1,z1=2,$d=4;function $_(t,e,n){return e!=null?(e?Mf:0)|(e==="full"?z1:0):t&&t.whitespace=="pre"?Mf|z1:n&~$d}class Fh{constructor(e,n,r,s,i,o){this.type=e,this.attrs=n,this.marks=r,this.solid=s,this.options=o,this.content=[],this.activeMarks=Un.none,this.match=i||(o&$d?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(Mt.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,s;return(s=r.findWrapping(e.type))?(this.match=r,s):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Mf)){let r=this.content[this.content.length-1],s;if(r&&r.isText&&(s=/[ \t\r\n\u000c]+$/.exec(r.text))){let i=r;r.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-s[0].length))}}let n=Mt.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(Mt.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!iA.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class z_{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let s=n.topNode,i,o=$_(null,n.preserveWhitespace,0)|(r?$d:0);s?i=new Fh(s.type,s.attrs,Un.none,!0,n.topMatch||s.type.contentMatch,o):r?i=new Fh(null,null,Un.none,!0,null,o):i=new Fh(e.schema.topNodeType,null,Un.none,!0,null,o),this.nodes=[i],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,s=this.top,i=s.options&z1?"full":this.localPreserveWS||(s.options&Mf)>0,{schema:o}=this.parser;if(i==="full"||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(i)if(i==="full")r=r.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=r.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),n,!0),a[l]&&this.insertNode(o.text(a[l]),n,!/\S/.test(a[l]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let a=s.content[s.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(o.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let s=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;oA.hasOwnProperty(o)&&this.parser.normalizeLists&&h9(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:f9.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let u,d=this.needsBlock;if(iA.hasOwnProperty(o))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),u=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let f=l&&l.skip?n:this.readStyles(e,n);f&&this.addAll(e,f),u&&this.sync(i),this.needsBlock=d}else{let u=this.readStyles(e,n);u&&this.addElementByRule(e,l,u,l.consuming===!1?a:void 0)}this.localPreserveWS=s}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let i=this.parser.matchedStyles[s],o=r.getPropertyValue(i);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(i,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(u=>!l.clearMark(u)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,s){let i,o;if(n.node)if(o=this.parser.schema.nodes[n.node],o.isLeaf)this.insertNode(o.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,n.attrs||null,r,n.preserveWhitespace);l&&(i=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(s)this.addElement(e,r,s);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}i&&this.sync(a)&&this.open--}addAll(e,n,r,s){let i=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=s==null?null:e.childNodes[s];o!=a;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o,n);this.findAtPoint(e,i)}findPlace(e,n,r){let s,i;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],u=l.findWrapping(e);if(u&&(!s||s.length>u.length+a)&&(s=u,i=l,!u.length))break;if(l.solid){if(r)break;a+=2}}if(!s)return null;this.sync(i);for(let o=0;o<s.length;o++)n=this.enterInner(s[o],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(n=this.enterInner(i,null,n))}let s=this.findPlace(e,n,r);if(s){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let o=Un.none;for(let a of s.concat(e.marks))(i.type?i.type.allowsMarkType(a.type):B_(a.type,e.type))&&(o=a.addToSet(o));return i.content.push(e.mark(o)),!0}return!1}enter(e,n,r,s){let i=this.findPlace(e.create(n),r,!1);return i&&(i=this.enterInner(e,n,r,!0,s)),i}enterInner(e,n,r,s=!1,i){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=$_(e,i,o.options);o.options&$d&&o.content.length==0&&(a|=$d);let l=Un.none;return r=r.filter(u=>(o.type?o.type.allowsMarkType(u.type):B_(u.type,e))?(l=u.addToSet(l),!1):!0),this.nodes.push(new Fh(e,n,l,s,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=Mf)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let s=r.length-1;s>=0;s--)e+=r[s].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&e.nodeType==1&&e.contains(this.find[s].node)&&n.compareDocumentPosition(this.find[s].node)&(r?2:4)&&(this.find[s].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,s=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(s?0:1),o=(a,l)=>{for(;a>=0;a--){let u=n[a];if(u==""){if(a==n.length-1||a==0)continue;for(;l>=i;l--)if(o(a-1,l))return!0;return!1}else{let d=l>0||l==0&&s?this.nodes[l].type:r&&l>=i?r.node(l-i).type:null;if(!d||d.name!=u&&!d.isInGroup(u))return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function h9(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&oA.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function p9(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function F_(t){let e={};for(let n in t)e[n]=t[n];return e}function B_(t,e){let n=e.schema.nodes;for(let r in n){let s=n[r];if(!s.allowsMarkType(t))continue;let i=[],o=a=>{i.push(a);for(let l=0;l<a.edgeCount;l++){let{type:u,next:d}=a.edge(l);if(u==e||i.indexOf(d)<0&&o(d))return!0}};if(o(s.contentMatch))return!0}}class lc{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=dy(n).createDocumentFragment());let s=r,i=[];return e.forEach(o=>{if(i.length||o.marks.length){let a=0,l=0;for(;a<i.length&&l<o.marks.length;){let u=o.marks[l];if(!this.marks[u.type.name]){l++;continue}if(!u.eq(i[a][0])||u.type.spec.spanning===!1)break;a++,l++}for(;a<i.length;)s=i.pop()[1];for(;l<o.marks.length;){let u=o.marks[l++],d=this.serializeMark(u,o.isInline,n);d&&(i.push([u,s]),s.appendChild(d.dom),s=d.contentDOM||d.dom)}}s.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:s}=Cp(dy(n),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,s)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let s=e.marks.length-1;s>=0;s--){let i=this.serializeMark(e.marks[s],e.isInline,n);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(e,n,r={}){let s=this.marks[e.type.name];return s&&Cp(dy(r),s(e,n),null,e.attrs)}static renderSpec(e,n,r=null,s){return Cp(e,n,r,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new lc(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=U_(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return U_(e.marks)}}function U_(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function dy(t){return t.document||window.document}const H_=new WeakMap;function m9(t){let e=H_.get(t);return e===void 0&&H_.set(t,e=g9(t)),e}function g9(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let s=0;s<r.length;s++)n(r[s]);else for(let s in r)n(r[s])}return n(t),e}function Cp(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let s=e[0],i;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(i=m9(r))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=s.indexOf(" ");o>0&&(n=s.slice(0,o),s=s.slice(o+1));let a,l=n?t.createElementNS(n,s):t.createElement(s),u=e[1],d=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){d=2;for(let f in u)if(u[f]!=null){let h=f.indexOf(" ");h>0?l.setAttributeNS(f.slice(0,h),f.slice(h+1),u[f]):f=="style"&&l.style?l.style.cssText=u[f]:l.setAttribute(f,u[f])}}for(let f=d;f<e.length;f++){let h=e[f];if(h===0){if(f<e.length-1||f>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:p,contentDOM:m}=Cp(t,h,n,r);if(l.appendChild(p),m){if(a)throw new RangeError("Multiple content holes");a=m}}}return{dom:l,contentDOM:a}}const aA=65535,lA=Math.pow(2,16);function y9(t,e){return t+e*lA}function V_(t){return t&aA}function x9(t){return(t-(t&aA))/lA}const cA=1,uA=2,Ep=4,dA=8;class F1{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&dA)>0}get deletedBefore(){return(this.delInfo&(cA|Ep))>0}get deletedAfter(){return(this.delInfo&(uA|Ep))>0}get deletedAcross(){return(this.delInfo&Ep)>0}}class ei{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&ei.empty)return ei.empty}recover(e){let n=0,r=V_(e);if(!this.inverted)for(let s=0;s<r;s++)n+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[r*3]+n+x9(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let s=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?s:0);if(l>e)break;let u=this.ranges[a+i],d=this.ranges[a+o],f=l+u;if(e<=f){let h=u?e==l?-1:e==f?1:n:n,p=l+s+(h<0?0:d);if(r)return p;let m=e==(n<0?l:f)?null:y9(a/3,e-l),y=e==l?uA:e==f?cA:Ep;return(n<0?e!=l:e!=f)&&(y|=dA),new F1(p,y,m)}s+=d-u}return r?e+s:new F1(e+s,0,null)}touches(e,n){let r=0,s=V_(n),i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let u=this.ranges[a+i],d=l+u;if(e<=d&&a==s*3)return!0;r+=this.ranges[a+o]-u}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let s=0,i=0;s<this.ranges.length;s+=3){let o=this.ranges[s],a=o-(this.inverted?i:0),l=o+(this.inverted?0:i),u=this.ranges[s+n],d=this.ranges[s+r];e(a,a+u,l,l+d),i+=d-u}}invert(){return new ei(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?ei.empty:new ei(e<0?[0,-e,0]:[0,0,e])}}ei.empty=new ei([]);class Df{constructor(e,n,r=0,s=e?e.length:0){this.mirror=n,this.from=r,this.to=s,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new Df(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let s=e.getMirror(n);this.appendMap(e._maps[n],s!=null&&s<n?r+s:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let s=e.getMirror(n);this.appendMap(e._maps[n].invert(),s!=null&&s>n?r-s-1:void 0)}}invert(){let e=new Df;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let s=0;for(let i=this.from;i<this.to;i++){let o=this._maps[i],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(i);if(l!=null&&l>i&&l<this.to){i=l,e=this._maps[l].recover(a.recover);continue}}s|=a.delInfo,e=a.pos}return r?e:new F1(e,s,null)}}const fy=Object.create(null);class ys{getMap(){return ei.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=fy[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in fy)throw new RangeError("Duplicate use of step JSON ID "+e);return fy[e]=n,n.prototype.jsonID=e,n}}class Nr{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new Nr(e,null)}static fail(e){return new Nr(null,e)}static fromReplace(e,n,r,s){try{return Nr.ok(e.replace(n,r,s))}catch(i){if(i instanceof km)return Nr.fail(i.message);throw i}}}function yw(t,e,n){let r=[];for(let s=0;s<t.childCount;s++){let i=t.child(s);i.content.size&&(i=i.copy(yw(i.content,e,i))),i.isInline&&(i=e(i,n,s)),r.push(i)}return Mt.fromArray(r)}class Ca extends ys{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),s=r.node(r.sharedDepth(this.to)),i=new Kt(yw(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),s),n.openStart,n.openEnd);return Nr.fromReplace(e,this.from,this.to,i)}invert(){return new po(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Ca(n.pos,r.pos,this.mark)}merge(e){return e instanceof Ca&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ca(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Ca(n.from,n.to,e.markFromJSON(n.mark))}}ys.jsonID("addMark",Ca);class po extends ys{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new Kt(yw(n.content,s=>s.mark(this.mark.removeFromSet(s.marks)),e),n.openStart,n.openEnd);return Nr.fromReplace(e,this.from,this.to,r)}invert(){return new Ca(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new po(n.pos,r.pos,this.mark)}merge(e){return e instanceof po&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new po(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new po(n.from,n.to,e.markFromJSON(n.mark))}}ys.jsonID("removeMark",po);class Ea extends ys{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return Nr.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return Nr.fromReplace(e,this.pos,this.pos+1,new Kt(Mt.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let s=0;s<n.marks.length;s++)if(!n.marks[s].isInSet(r))return new Ea(this.pos,n.marks[s]);return new Ea(this.pos,this.mark)}}return new tc(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Ea(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Ea(n.pos,e.markFromJSON(n.mark))}}ys.jsonID("addNodeMark",Ea);class tc extends ys{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return Nr.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return Nr.fromReplace(e,this.pos,this.pos+1,new Kt(Mt.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new Ea(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new tc(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new tc(n.pos,e.markFromJSON(n.mark))}}ys.jsonID("removeNodeMark",tc);class zr extends ys{constructor(e,n,r,s=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=s}apply(e){return this.structure&&B1(e,this.from,this.to)?Nr.fail("Structure replace would overwrite content"):Nr.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new ei([this.from,this.to-this.from,this.slice.size])}invert(e){return new zr(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new zr(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof zr)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?Kt.empty:new Kt(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new zr(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?Kt.empty:new Kt(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new zr(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new zr(n.from,n.to,Kt.fromJSON(e,n.slice),!!n.structure)}}ys.jsonID("replace",zr);class Ur extends ys{constructor(e,n,r,s,i,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=s,this.slice=i,this.insert=o,this.structure=a}apply(e){if(this.structure&&(B1(e,this.from,this.gapFrom)||B1(e,this.gapTo,this.to)))return Nr.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return Nr.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?Nr.fromReplace(e,this.from,this.to,r):Nr.fail("Content does not fit in gap")}getMap(){return new ei([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new Ur(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),s=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||s<n.pos||i>r.pos?null:new Ur(n.pos,r.pos,s,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Ur(n.from,n.to,n.gapFrom,n.gapTo,Kt.fromJSON(e,n.slice),n.insert,!!n.structure)}}ys.jsonID("replaceAround",Ur);function B1(t,e,n){let r=t.resolve(e),s=n-e,i=r.depth;for(;s>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,s--;if(s>0){let o=r.node(i).maybeChild(r.indexAfter(i));for(;s>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,s--}}return!1}function b9(t,e,n,r){let s=[],i=[],o,a;t.doc.nodesBetween(e,n,(l,u,d)=>{if(!l.isInline)return;let f=l.marks;if(!r.isInSet(f)&&d.type.allowsMarkType(r.type)){let h=Math.max(u,e),p=Math.min(u+l.nodeSize,n),m=r.addToSet(f);for(let y=0;y<f.length;y++)f[y].isInSet(m)||(o&&o.to==h&&o.mark.eq(f[y])?o.to=p:s.push(o=new po(h,p,f[y])));a&&a.to==h?a.to=p:i.push(a=new Ca(h,p,r))}}),s.forEach(l=>t.step(l)),i.forEach(l=>t.step(l))}function v9(t,e,n,r){let s=[],i=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;i++;let l=null;if(r instanceof Bg){let u=o.marks,d;for(;d=r.isInSet(u);)(l||(l=[])).push(d),u=d.removeFromSet(u)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let u=Math.min(a+o.nodeSize,n);for(let d=0;d<l.length;d++){let f=l[d],h;for(let p=0;p<s.length;p++){let m=s[p];m.step==i-1&&f.eq(s[p].style)&&(h=m)}h?(h.to=u,h.step=i):s.push({style:f,from:Math.max(a,e),to:u,step:i})}}}),s.forEach(o=>t.step(new po(o.from,o.to,o.style)))}function xw(t,e,n,r=n.contentMatch,s=!0){let i=t.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<i.childCount;l++){let u=i.child(l),d=a+u.nodeSize,f=r.matchType(u.type);if(!f)o.push(new zr(a,d,Kt.empty));else{r=f;for(let h=0;h<u.marks.length;h++)n.allowsMarkType(u.marks[h].type)||t.step(new po(a,d,u.marks[h]));if(s&&u.isText&&n.whitespace!="pre"){let h,p=/\r?\n|\r/g,m;for(;h=p.exec(u.text);)m||(m=new Kt(Mt.from(n.schema.text(" ",n.allowedMarks(u.marks))),0,0)),o.push(new zr(a+h.index,a+h.index+h[0].length,m))}}a=d}if(!r.validEnd){let l=r.fillBefore(Mt.empty,!0);t.replace(a,a,new Kt(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function w9(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function Uu(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth,s=0,i=0;;--r){let o=t.$from.node(r),a=t.$from.index(r)+s,l=t.$to.indexAfter(r)-i;if(r<t.depth&&o.canReplace(a,l,n))return r;if(r==0||o.type.spec.isolating||!w9(o,a,l))break;a&&(s=1),l<o.childCount&&(i=1)}return null}function k9(t,e,n){let{$from:r,$to:s,depth:i}=e,o=r.before(i+1),a=s.after(i+1),l=o,u=a,d=Mt.empty,f=0;for(let m=i,y=!1;m>n;m--)y||r.index(m)>0?(y=!0,d=Mt.from(r.node(m).copy(d)),f++):l--;let h=Mt.empty,p=0;for(let m=i,y=!1;m>n;m--)y||s.after(m+1)<s.end(m)?(y=!0,h=Mt.from(s.node(m).copy(h)),p++):u++;t.step(new Ur(l,u,o,a,new Kt(d.append(h),f,p),d.size-f,!0))}function bw(t,e,n=null,r=t){let s=S9(t,e),i=s&&_9(r,e);return i?s.map(W_).concat({type:e,attrs:n}).concat(i.map(W_)):null}function W_(t){return{type:t,attrs:null}}function S9(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.contentMatchAt(r).findWrapping(e);if(!i)return null;let o=i.length?i[0]:e;return n.canReplaceWith(r,s,o)?i:null}function _9(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.child(r),o=e.contentMatch.findWrapping(i.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let u=r;l&&u<s;u++)l=l.matchType(n.child(u).type);return!l||!l.validEnd?null:o}function T9(t,e,n){let r=Mt.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let a=n[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=Mt.from(n[o].type.create(n[o].attrs,r))}let s=e.start,i=e.end;t.step(new Ur(s,i,s,i,new Kt(r,0,0),n.length,!0))}function C9(t,e,n,r,s){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{let l=typeof s=="function"?s(o):s;if(o.isTextblock&&!o.hasMarkup(r,l)&&E9(t.doc,t.mapping.slice(i).map(a),r)){let u=null;if(r.schema.linebreakReplacement){let p=r.whitespace=="pre",m=!!r.contentMatch.matchType(r.schema.linebreakReplacement);p&&!m?u=!1:!p&&m&&(u=!0)}u===!1&&hA(t,o,a,i),xw(t,t.mapping.slice(i).map(a,1),r,void 0,u===null);let d=t.mapping.slice(i),f=d.map(a,1),h=d.map(a+o.nodeSize,1);return t.step(new Ur(f,h,f+1,h-1,new Kt(Mt.from(r.create(l,null,o.marks)),0,0),1,!0)),u===!0&&fA(t,o,a,i),!1}})}function fA(t,e,n,r){e.forEach((s,i)=>{if(s.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(s.text);){let l=t.mapping.slice(r).map(n+1+i+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function hA(t,e,n,r){e.forEach((s,i)=>{if(s.type==s.type.schema.linebreakReplacement){let o=t.mapping.slice(r).map(n+1+i);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function E9(t,e,n){let r=t.resolve(e),s=r.index();return r.parent.canReplaceWith(s,s+1,n)}function N9(t,e,n,r,s){let i=t.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let o=n.create(r,null,s||i.marks);if(i.isLeaf)return t.replaceWith(e,e+i.nodeSize,o);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new Ur(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new Kt(Mt.from(o),0,0),1,!0))}function du(t,e,n=1,r){let s=t.resolve(e),i=s.depth-n,o=r&&r[r.length-1]||s.parent;if(i<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!o.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let u=s.depth-1,d=n-2;u>i;u--,d--){let f=s.node(u),h=s.index(u);if(f.type.spec.isolating)return!1;let p=f.content.cutByIndex(h,f.childCount),m=r&&r[d+1];m&&(p=p.replaceChild(0,m.type.create(m.attrs)));let y=r&&r[d]||f;if(!f.canReplace(h+1,f.childCount)||!y.type.validContent(p))return!1}let a=s.indexAfter(i),l=r&&r[0];return s.node(i).canReplaceWith(a,a,l?l.type:s.node(i+1).type)}function j9(t,e,n=1,r){let s=t.doc.resolve(e),i=Mt.empty,o=Mt.empty;for(let a=s.depth,l=s.depth-n,u=n-1;a>l;a--,u--){i=Mt.from(s.node(a).copy(i));let d=r&&r[u];o=Mt.from(d?d.type.create(d.attrs,o):s.node(a).copy(o))}t.step(new zr(e,e,new Kt(i.append(o),n,n),!0))}function tl(t,e){let n=t.resolve(e),r=n.index();return pA(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function I9(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let s=0;s<e.childCount;s++){let i=e.child(s),o=i.type==r?t.type.schema.nodes.text:i.type;if(n=n.matchType(o),!n||!t.type.allowsMarks(i.marks))return!1}return n.validEnd}function pA(t,e){return!!(t&&e&&!t.isLeaf&&I9(t,e))}function Ug(t,e,n=-1){let r=t.resolve(e);for(let s=r.depth;;s--){let i,o,a=r.index(s);if(s==r.depth?(i=r.nodeBefore,o=r.nodeAfter):n>0?(i=r.node(s+1),a++,o=r.node(s).maybeChild(a)):(i=r.node(s).maybeChild(a-1),o=r.node(s+1)),i&&!i.isTextblock&&pA(i,o)&&r.node(s).canReplace(a,a+1))return e;if(s==0)break;e=n<0?r.before(s):r.after(s)}}function M9(t,e,n){let r=null,{linebreakReplacement:s}=t.doc.type.schema,i=t.doc.resolve(e-n),o=i.node().type;if(s&&o.inlineContent){let d=o.whitespace=="pre",f=!!o.contentMatch.matchType(s);d&&!f?r=!1:!d&&f&&(r=!0)}let a=t.steps.length;if(r===!1){let d=t.doc.resolve(e+n);hA(t,d.node(),d.before(),a)}o.inlineContent&&xw(t,e+n-1,o,i.node().contentMatchAt(i.index()),r==null);let l=t.mapping.slice(a),u=l.map(e-n);if(t.step(new zr(u,l.map(e+n,-1),Kt.empty,!0)),r===!0){let d=t.doc.resolve(u);fA(t,d.node(),d.before(),t.steps.length)}return t}function D9(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let s=r.depth-1;s>=0;s--){let i=r.index(s);if(r.node(s).canReplaceWith(i,i,n))return r.before(s+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(let s=r.depth-1;s>=0;s--){let i=r.indexAfter(s);if(r.node(s).canReplaceWith(i,i,n))return r.after(s+1);if(i<r.node(s).childCount)return null}return null}function mA(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let s=n.content;for(let i=0;i<n.openStart;i++)s=s.firstChild.content;for(let i=1;i<=(n.openStart==0&&n.size?2:1);i++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),u=r.node(o),d=!1;if(i==1)d=u.canReplace(l,l,s);else{let f=u.contentMatchAt(l).findWrapping(s.firstChild.type);d=f&&u.canReplaceWith(l,l,f[0])}if(d)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function Hg(t,e,n=e,r=Kt.empty){if(e==n&&!r.size)return null;let s=t.resolve(e),i=t.resolve(n);return gA(s,i,r)?new zr(e,n,r):new A9(s,i,r).fit()}function gA(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class A9{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=Mt.empty;for(let s=0;s<=e.depth;s++){let i=e.node(s);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=Mt.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,s=this.close(e<0?this.$to:r.doc.resolve(e));if(!s)return null;let i=this.placed,o=r.depth,a=s.depth;for(;o&&a&&i.childCount==1;)i=i.firstChild.content,o--,a--;let l=new Kt(i,o,a);return e>-1?new Ur(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new zr(r.pos,s.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,s=this.unplaced.openEnd;r<e;r++){let i=n.firstChild;if(n.childCount>1&&(s=0),i.type.spec.isolating&&s<=r){e=r;break}n=i.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let s,i=null;r?(i=hy(this.unplaced.content,r-1).firstChild,s=i.content):s=this.unplaced.content;let o=s.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:u}=this.frontier[a],d,f=null;if(n==1&&(o?u.matchType(o.type)||(f=u.fillBefore(Mt.from(o),!1)):i&&l.compatibleContent(i.type)))return{sliceDepth:r,frontierDepth:a,parent:i,inject:f};if(n==2&&o&&(d=u.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:i,wrap:d};if(i&&u.matchType(i.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=hy(e,n);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new Kt(e,n+1,Math.max(r,s.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=hy(e,n);if(s.childCount<=1&&n>0){let i=e.size-n<=n+s.size;this.unplaced=new Kt(yd(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new Kt(yd(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:s,wrap:i}){for(;this.depth>n;)this.closeFrontierNode();if(i)for(let y=0;y<i.length;y++)this.openFrontierNode(i[y]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,u=0,d=[],{match:f,type:h}=this.frontier[n];if(s){for(let y=0;y<s.childCount;y++)d.push(s.child(y));f=f.matchFragment(s)}let p=a.size+e-(o.content.size-o.openEnd);for(;u<a.childCount;){let y=a.child(u),b=f.matchType(y.type);if(!b)break;u++,(u>1||l==0||y.content.size)&&(f=b,d.push(yA(y.mark(h.allowedMarks(y.marks)),u==1?l:0,u==a.childCount?p:-1)))}let m=u==a.childCount;m||(p=-1),this.placed=xd(this.placed,n,Mt.from(d)),this.frontier[n].match=f,m&&p<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let y=0,b=a;y<p;y++){let g=b.lastChild;this.frontier.push({type:g.type,match:g.contentMatchAt(g.childCount)}),b=g.content}this.unplaced=m?e==0?Kt.empty:new Kt(yd(o.content,e-1,1),e-1,p<0?o.openEnd:e-1):new Kt(yd(o.content,e,u),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!py(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,s=this.$to.after(r);for(;r>1&&s==this.$to.end(--r);)++s;return s}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:s}=this.frontier[n],i=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=py(e,n,s,r,i);if(o){for(let a=n-1;a>=0;a--){let{match:l,type:u}=this.frontier[a],d=py(e,a,u,l,!0);if(!d||d.childCount)continue e}return{depth:n,fit:o,move:i?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=xd(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let s=e.node(r),i=s.type.contentMatch.fillBefore(s.content,!0,e.index(r));this.openFrontierNode(s.type,s.attrs,i)}return e}openFrontierNode(e,n=null,r){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=xd(this.placed,this.depth,Mt.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(Mt.empty,!0);n.childCount&&(this.placed=xd(this.placed,this.frontier.length,n))}}function yd(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(yd(t.firstChild.content,e-1,n)))}function xd(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(xd(t.lastChild.content,e-1,n)))}function hy(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function yA(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,yA(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(Mt.empty,!0)))),t.copy(r)}function py(t,e,n,r,s){let i=t.node(e),o=s?t.indexAfter(e):t.index(e);if(o==i.childCount&&!n.compatibleContent(i.type))return null;let a=r.fillBefore(i.content,!0,o);return a&&!R9(n,i.content,o)?a:null}function R9(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function O9(t){return t.spec.defining||t.spec.definingForContent}function P9(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let s=t.doc.resolve(e),i=t.doc.resolve(n);if(gA(s,i,r))return t.step(new zr(e,n,r));let o=bA(s,i);o[o.length-1]==0&&o.pop();let a=-(s.depth+1);o.unshift(a);for(let h=s.depth,p=s.pos-1;h>0;h--,p--){let m=s.node(h).type.spec;if(m.defining||m.definingAsContext||m.isolating)break;o.indexOf(h)>-1?a=h:s.before(h)==p&&o.splice(1,0,-h)}let l=o.indexOf(a),u=[],d=r.openStart;for(let h=r.content,p=0;;p++){let m=h.firstChild;if(u.push(m),p==r.openStart)break;h=m.content}for(let h=d-1;h>=0;h--){let p=u[h],m=O9(p.type);if(m&&!p.sameMarkup(s.node(Math.abs(a)-1)))d=h;else if(m||!p.type.isTextblock)break}for(let h=r.openStart;h>=0;h--){let p=(h+d+1)%(r.openStart+1),m=u[p];if(m)for(let y=0;y<o.length;y++){let b=o[(y+l)%o.length],g=!0;b<0&&(g=!1,b=-b);let v=s.node(b-1),w=s.index(b-1);if(v.canReplaceWith(w,w,m.type,m.marks))return t.replace(s.before(b),g?i.after(b):n,new Kt(xA(r.content,0,r.openStart,p),p,r.openEnd))}}let f=t.steps.length;for(let h=o.length-1;h>=0&&(t.replace(e,n,r),!(t.steps.length>f));h--){let p=o[h];p<0||(e=s.before(p),n=i.after(p))}}function xA(t,e,n,r,s){if(e<n){let i=t.firstChild;t=t.replaceChild(0,i.copy(xA(i.content,e+1,n,r,i)))}if(e>r){let i=s.contentMatchAt(0),o=i.fillBefore(t).append(t);t=o.append(i.matchFragment(o).fillBefore(Mt.empty,!0))}return t}function L9(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let s=D9(t.doc,e,r.type);s!=null&&(e=n=s)}t.replaceRange(e,n,new Kt(Mt.from(r),0,0))}function $9(t,e,n){let r=t.doc.resolve(e),s=t.doc.resolve(n),i=bA(r,s);for(let o=0;o<i.length;o++){let a=i[o],l=o==i.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),s.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),s.indexAfter(a-1))))return t.delete(r.before(a),s.after(a))}for(let o=1;o<=r.depth&&o<=s.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&s.end(o)-n!=s.depth-o&&r.start(o-1)==s.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),s.index(o-1)))return t.delete(r.before(o),n);t.delete(e,n)}function bA(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let s=r;s>=0;s--){let i=t.start(s);if(i<t.pos-(t.depth-s)||e.end(s)>e.pos+(e.depth-s)||t.node(s).type.spec.isolating||e.node(s).type.spec.isolating)break;(i==e.start(s)||s==t.depth&&s==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&s&&e.start(s-1)==i-1)&&n.push(s)}return n}class fu extends ys{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return Nr.fail("No node at attribute step's position");let r=Object.create(null);for(let i in n.attrs)r[i]=n.attrs[i];r[this.attr]=this.value;let s=n.type.create(r,null,n.marks);return Nr.fromReplace(e,this.pos,this.pos+1,new Kt(Mt.from(s),0,n.isLeaf?0:1))}getMap(){return ei.empty}invert(e){return new fu(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new fu(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new fu(n.pos,n.attr,n.value)}}ys.jsonID("attr",fu);class Af extends ys{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let s in e.attrs)n[s]=e.attrs[s];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return Nr.ok(r)}getMap(){return ei.empty}invert(e){return new Af(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Af(n.attr,n.value)}}ys.jsonID("docAttr",Af);let Cu=class extends Error{};Cu=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};Cu.prototype=Object.create(Error.prototype);Cu.prototype.constructor=Cu;Cu.prototype.name="TransformError";class vA{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Df}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new Cu(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=Kt.empty){let s=Hg(this.doc,e,n,r);return s&&this.step(s),this}replaceWith(e,n,r){return this.replace(e,n,new Kt(Mt.from(r),0,0))}delete(e,n){return this.replace(e,n,Kt.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return P9(this,e,n,r),this}replaceRangeWith(e,n,r){return L9(this,e,n,r),this}deleteRange(e,n){return $9(this,e,n),this}lift(e,n){return k9(this,e,n),this}join(e,n=1){return M9(this,e,n),this}wrap(e,n){return T9(this,e,n),this}setBlockType(e,n=e,r,s=null){return C9(this,e,n,r,s),this}setNodeMarkup(e,n,r=null,s){return N9(this,e,n,r,s),this}setNodeAttribute(e,n,r){return this.step(new fu(e,n,r)),this}setDocAttribute(e,n){return this.step(new Af(e,n)),this}addNodeMark(e,n){return this.step(new Ea(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof Un)n.isInSet(r.marks)&&this.step(new tc(e,n));else{let s=r.marks,i,o=[];for(;i=n.isInSet(s);)o.push(new tc(e,i)),s=i.removeFromSet(s);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,n=1,r){return j9(this,e,n,r),this}addMark(e,n,r){return b9(this,e,n,r),this}removeMark(e,n,r){return v9(this,e,n,r),this}clearIncompatible(e,n,r){return xw(this,e,n,r),this}}const my=Object.create(null);class mn{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new z9(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=Kt.empty){let r=n.content.lastChild,s=null;for(let a=0;a<n.openEnd;a++)s=r,r=r.lastChild;let i=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:u}=o[a],d=e.mapping.slice(i);e.replaceRange(d.map(l.pos),d.map(u.pos),a?Kt.empty:n),a==0&&q_(e,i,(r?r.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){let{$from:o,$to:a}=s[i],l=e.mapping.slice(r),u=l.map(o.pos),d=l.map(a.pos);i?e.deleteRange(u,d):(e.replaceRangeWith(u,d,n),q_(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let s=e.parent.inlineContent?new pn(e):jc(e.node(0),e.parent,e.pos,e.index(),n,r);if(s)return s;for(let i=e.depth-1;i>=0;i--){let o=n<0?jc(e.node(0),e.node(i),e.before(i+1),e.index(i),n,r):jc(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new Ni(e.node(0))}static atStart(e){return jc(e,e,0,0,1)||new Ni(e)}static atEnd(e){return jc(e,e,e.content.size,e.childCount,-1)||new Ni(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=my[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in my)throw new RangeError("Duplicate use of selection JSON ID "+e);return my[e]=n,n.prototype.jsonID=e,n}getBookmark(){return pn.between(this.$anchor,this.$head).getBookmark()}}mn.prototype.visible=!0;class z9{constructor(e,n){this.$from=e,this.$to=n}}let K_=!1;function G_(t){!K_&&!t.parent.inlineContent&&(K_=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class pn extends mn{constructor(e,n=e){G_(e),G_(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return mn.near(r);let s=e.resolve(n.map(this.anchor));return new pn(s.parent.inlineContent?s:r,r)}replace(e,n=Kt.empty){if(super.replace(e,n),n==Kt.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof pn&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Vg(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new pn(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let s=e.resolve(n);return new this(s,r==n?s:e.resolve(r))}static between(e,n,r){let s=e.pos-n.pos;if((!r||s)&&(r=s>=0?1:-1),!n.parent.inlineContent){let i=mn.findFrom(n,r,!0)||mn.findFrom(n,-r,!0);if(i)n=i.$head;else return mn.near(n,r)}return e.parent.inlineContent||(s==0?e=n:(e=(mn.findFrom(e,-r,!0)||mn.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=s<0&&(e=n))),new pn(e,n)}}mn.jsonID("text",pn);class Vg{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Vg(e.map(this.anchor),e.map(this.head))}resolve(e){return pn.between(e.resolve(this.anchor),e.resolve(this.head))}}class en extends mn{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:s}=n.mapResult(this.anchor),i=e.resolve(s);return r?mn.near(i):new en(i)}content(){return new Kt(Mt.from(this.node),0,0)}eq(e){return e instanceof en&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new vw(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new en(e.resolve(n.anchor))}static create(e,n){return new en(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}en.prototype.visible=!1;mn.jsonID("node",en);class vw{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new Vg(r,r):new vw(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&en.isSelectable(r)?new en(n):mn.near(n)}}class Ni extends mn{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=Kt.empty){if(n==Kt.empty){e.delete(0,e.doc.content.size);let r=mn.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new Ni(e)}map(e){return new Ni(e)}eq(e){return e instanceof Ni}getBookmark(){return F9}}mn.jsonID("all",Ni);const F9={map(){return this},resolve(t){return new Ni(t)}};function jc(t,e,n,r,s,i=!1){if(e.inlineContent)return pn.create(t,n);for(let o=r-(s>0?0:1);s>0?o<e.childCount:o>=0;o+=s){let a=e.child(o);if(a.isAtom){if(!i&&en.isSelectable(a))return en.create(t,n-(s<0?a.nodeSize:0))}else{let l=jc(t,a,n+s,s<0?a.childCount:0,s,i);if(l)return l}n+=a.nodeSize*s}return null}function q_(t,e,n){let r=t.steps.length-1;if(r<e)return;let s=t.steps[r];if(!(s instanceof zr||s instanceof Ur))return;let i=t.mapping.maps[r],o;i.forEach((a,l,u,d)=>{o==null&&(o=d)}),t.setSelection(mn.near(t.doc.resolve(o),n))}const Y_=1,Bh=2,J_=4;class B9 extends vA{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Y_)&~Bh,this.storedMarks=null,this}get selectionSet(){return(this.updated&Y_)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Bh,this}ensureMarks(e){return Un.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Bh)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~Bh,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||Un.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let s=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(s.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),!e)return this.deleteRange(n,r);let i=this.storedMarks;if(!i){let o=this.doc.resolve(n);i=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,s.text(e,i)),!this.selection.empty&&this.selection.to==n+e.length&&this.setSelection(mn.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=J_,this}get scrolledIntoView(){return(this.updated&J_)>0}}function X_(t,e){return!e||!t?t:t.bind(e)}class bd{constructor(e,n,r){this.name=e,this.init=X_(n.init,r),this.apply=X_(n.apply,r)}}const U9=[new bd("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new bd("selection",{init(t,e){return t.selection||mn.atStart(e.doc)},apply(t){return t.selection}}),new bd("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new bd("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class gy{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=U9.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new bd(r.key,r.spec.state,r))})}}class Qc{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let s=this.config.plugins[r];if(s.spec.filterTransaction&&!s.spec.filterTransaction.call(s,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),s=null;for(;;){let i=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=s?s[o].n:0,u=s?s[o].state:this,d=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,u,r);if(d&&r.filterTransaction(d,o)){if(d.setMeta("appendedTransaction",e),!s){s=[];for(let f=0;f<this.config.plugins.length;f++)s.push(f<o?{state:r,n:n.length}:{state:this,n:0})}n.push(d),r=r.applyInner(d),i=!0}s&&(s[o]={state:r,n:n.length})}}if(!i)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new Qc(this.config),r=this.config.fields;for(let s=0;s<r.length;s++){let i=r[s];n[i.name]=i.apply(e,this[i.name],this,n)}return n}get tr(){return new B9(this)}static create(e){let n=new gy(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new Qc(n);for(let s=0;s<n.fields.length;s++)r[n.fields[s].name]=n.fields[s].init(e,r);return r}reconfigure(e){let n=new gy(this.schema,e.plugins),r=n.fields,s=new Qc(n);for(let i=0;i<r.length;i++){let o=r[i].name;s[o]=this.hasOwnProperty(o)?this[o]:r[i].init(e,s)}return s}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[r],i=s.spec.state;i&&i.toJSON&&(n[r]=i.toJSON.call(s,this[s.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new gy(e.schema,e.plugins),i=new Qc(s);return s.fields.forEach(o=>{if(o.name=="doc")i.doc=Ho.fromJSON(e.schema,n.doc);else if(o.name=="selection")i.selection=mn.fromJSON(i.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(i.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],u=l.spec.state;if(l.key==o.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){i[o.name]=u.fromJSON.call(l,e,n[a],i);return}}i[o.name]=o.init(e,i)}}),i}}function wA(t,e,n){for(let r in t){let s=t[r];s instanceof Function?s=s.bind(e):r=="handleDOMEvents"&&(s=wA(s,e,{})),n[r]=s}return n}class jr{constructor(e){this.spec=e,this.props={},e.props&&wA(e.props,this,this.props),this.key=e.key?e.key.key:kA("plugin")}getState(e){return e[this.key]}}const yy=Object.create(null);function kA(t){return t in yy?t+"$"+ ++yy[t]:(yy[t]=0,t+"$")}class ss{constructor(e="key"){this.key=kA(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Qr=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},Eu=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let U1=null;const Oo=function(t,e,n){let r=U1||(U1=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},H9=function(){U1=null},nc=function(t,e,n,r){return n&&(Q_(t,e,n,r,-1)||Q_(t,e,n,r,1))},V9=/^(img|br|input|textarea|hr)$/i;function Q_(t,e,n,r,s){for(var i;;){if(t==n&&e==r)return!0;if(e==(s<0?0:ki(t))){let o=t.parentNode;if(!o||o.nodeType!=1||ih(t)||V9.test(t.nodeName)||t.contentEditable=="false")return!1;e=Qr(t)+(s<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(s<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((i=o.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=s;else return!1;else t=o,e=s<0?ki(t):0}else return!1}}function ki(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function W9(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=ki(t)}else if(t.parentNode&&!ih(t))e=Qr(t),t=t.parentNode;else return null}}function K9(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!ih(t))e=Qr(t)+1,t=t.parentNode;else return null}}function G9(t,e,n){for(let r=e==0,s=e==ki(t);r||s;){if(t==n)return!0;let i=Qr(t);if(t=t.parentNode,!t)return!1;r=r&&i==0,s=s&&i==ki(t)}}function ih(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Wg=function(t){return t.focusNode&&nc(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function Sl(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function q9(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function Y9(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(ki(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(ki(r.startContainer),r.startOffset)}}}const wo=typeof navigator<"u"?navigator:null,Z_=typeof document<"u"?document:null,nl=wo&&wo.userAgent||"",H1=/Edge\/(\d+)/.exec(nl),SA=/MSIE \d/.exec(nl),V1=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nl),Hs=!!(SA||V1||H1),za=SA?document.documentMode:V1?+V1[1]:H1?+H1[1]:0,ji=!Hs&&/gecko\/(\d+)/i.test(nl);ji&&+(/Firefox\/(\d+)/.exec(nl)||[0,0])[1];const W1=!Hs&&/Chrome\/(\d+)/.exec(nl),Fr=!!W1,_A=W1?+W1[1]:0,gs=!Hs&&!!wo&&/Apple Computer/.test(wo.vendor),Nu=gs&&(/Mobile\/\w+/.test(nl)||!!wo&&wo.maxTouchPoints>2),xi=Nu||(wo?/Mac/.test(wo.platform):!1),TA=wo?/Win/.test(wo.platform):!1,Fo=/Android \d/.test(nl),oh=!!Z_&&"webkitFontSmoothing"in Z_.documentElement.style,J9=oh?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function X9(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function Eo(t,e){return typeof t=="number"?t:t[e]}function Q9(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function eT(t,e,n){let r=t.someProp("scrollThreshold")||0,s=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument;for(let o=n||t.dom;o;){if(o.nodeType!=1){o=Eu(o);continue}let a=o,l=a==i.body,u=l?X9(i):Q9(a),d=0,f=0;if(e.top<u.top+Eo(r,"top")?f=-(u.top-e.top+Eo(s,"top")):e.bottom>u.bottom-Eo(r,"bottom")&&(f=e.bottom-e.top>u.bottom-u.top?e.top+Eo(s,"top")-u.top:e.bottom-u.bottom+Eo(s,"bottom")),e.left<u.left+Eo(r,"left")?d=-(u.left-e.left+Eo(s,"left")):e.right>u.right-Eo(r,"right")&&(d=e.right-u.right+Eo(s,"right")),d||f)if(l)i.defaultView.scrollBy(d,f);else{let p=a.scrollLeft,m=a.scrollTop;f&&(a.scrollTop+=f),d&&(a.scrollLeft+=d);let y=a.scrollLeft-p,b=a.scrollTop-m;e={left:e.left-y,top:e.top-b,right:e.right-y,bottom:e.bottom-b}}let h=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(h))break;o=h=="absolute"?o.offsetParent:Eu(o)}}function Z9(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,s;for(let i=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(i,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,s=l.top;break}}return{refDOM:r,refTop:s,stack:CA(t.dom)}}function CA(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=Eu(r));return e}function eV({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;EA(n,r==0?0:r-e)}function EA(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:s,left:i}=t[n];r.scrollTop!=s+e&&(r.scrollTop=s+e),r.scrollLeft!=i&&(r.scrollLeft=i)}}let bc=null;function tV(t){if(t.setActive)return t.setActive();if(bc)return t.focus(bc);let e=CA(t);t.focus(bc==null?{get preventScroll(){return bc={preventScroll:!0},!0}}:void 0),bc||(bc=!1,EA(e,0))}function NA(t,e){let n,r=2e8,s,i=0,o=e.top,a=e.top,l,u;for(let d=t.firstChild,f=0;d;d=d.nextSibling,f++){let h;if(d.nodeType==1)h=d.getClientRects();else if(d.nodeType==3)h=Oo(d).getClientRects();else continue;for(let p=0;p<h.length;p++){let m=h[p];if(m.top<=o&&m.bottom>=a){o=Math.max(m.bottom,o),a=Math.min(m.top,a);let y=m.left>e.left?m.left-e.left:m.right<e.left?e.left-m.right:0;if(y<r){n=d,r=y,s=y&&n.nodeType==3?{left:m.right<e.left?m.right:m.left,top:e.top}:e,d.nodeType==1&&y&&(i=f+(e.left>=(m.left+m.right)/2?1:0));continue}}else m.top>e.top&&!l&&m.left<=e.left&&m.right>=e.left&&(l=d,u={left:Math.max(m.left,Math.min(m.right,e.left)),top:m.top});!n&&(e.left>=m.right&&e.top>=m.top||e.left>=m.left&&e.top>=m.bottom)&&(i=f+1)}}return!n&&l&&(n=l,s=u,r=0),n&&n.nodeType==3?nV(n,s):!n||r&&n.nodeType==1?{node:t,offset:i}:NA(n,s)}function nV(t,e){let n=t.nodeValue.length,r=document.createRange(),s;for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let o=da(r,1);if(o.top!=o.bottom&&ww(e,o)){s={node:t,offset:i+(e.left>=(o.left+o.right)/2?1:0)};break}}return r.detach(),s||{node:t,offset:0}}function ww(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function rV(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function sV(t,e,n){let{node:r,offset:s}=NA(e,n),i=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();i=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,s,i)}function iV(t,e,n,r){let s=-1;for(let i=e,o=!1;i!=t.dom;){let a=t.docView.nearestDesc(i,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>r.left||l.top>r.top?s=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(s=a.posAfter),o=!0),!a.contentDOM&&s<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;i=a.dom.parentNode}return s>-1?s:t.docView.posFromDOM(e,n,-1)}function jA(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let s=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),i=s;;){let o=t.childNodes[i];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let u=a[l];if(ww(e,u))return jA(o,e,u)}}if((i=(i+1)%r)==s)break}return t}function oV(t,e){let n=t.dom.ownerDocument,r,s=0,i=Y9(n,e.left,e.top);i&&({node:r,offset:s}=i);let o=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),a;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let u=t.dom.getBoundingClientRect();if(!ww(e,u)||(o=jA(t.dom,e,u),!o))return null}if(gs)for(let u=o;r&&u;u=Eu(u))u.draggable&&(r=void 0);if(o=rV(o,e),r){if(ji&&r.nodeType==1&&(s=Math.min(s,r.childNodes.length),s<r.childNodes.length)){let d=r.childNodes[s],f;d.nodeName=="IMG"&&(f=d.getBoundingClientRect()).right<=e.left&&f.bottom>e.top&&s++}let u;oh&&s&&r.nodeType==1&&(u=r.childNodes[s-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&s--,r==t.dom&&s==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(s==0||r.nodeType!=1||r.childNodes[s-1].nodeName!="BR")&&(a=iV(t,r,s,e))}a==null&&(a=sV(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function tT(t){return t.top<t.bottom||t.left<t.right}function da(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(tT(r))return r}return Array.prototype.find.call(n,tT)||t.getBoundingClientRect()}const aV=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function IA(t,e,n){let{node:r,offset:s,atom:i}=t.docView.domFromPos(e,n<0?-1:1),o=oh||ji;if(r.nodeType==3)if(o&&(aV.test(r.nodeValue)||(n<0?!s:s==r.nodeValue.length))){let l=da(Oo(r,s,s),n);if(ji&&s&&/\s/.test(r.nodeValue[s-1])&&s<r.nodeValue.length){let u=da(Oo(r,s-1,s-1),-1);if(u.top==l.top){let d=da(Oo(r,s,s+1),-1);if(d.top!=l.top)return sd(d,d.left<u.left)}}return l}else{let l=s,u=s,d=n<0?1:-1;return n<0&&!s?(u++,d=-1):n>=0&&s==r.nodeValue.length?(l--,d=1):n<0?l--:u++,sd(da(Oo(r,l,u),d),d<0)}if(!t.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&s&&(n<0||s==ki(r))){let l=r.childNodes[s-1];if(l.nodeType==1)return xy(l.getBoundingClientRect(),!1)}if(i==null&&s<ki(r)){let l=r.childNodes[s];if(l.nodeType==1)return xy(l.getBoundingClientRect(),!0)}return xy(r.getBoundingClientRect(),n>=0)}if(i==null&&s&&(n<0||s==ki(r))){let l=r.childNodes[s-1],u=l.nodeType==3?Oo(l,ki(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(u)return sd(da(u,1),!1)}if(i==null&&s<ki(r)){let l=r.childNodes[s];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let u=l?l.nodeType==3?Oo(l,0,o?0:1):l.nodeType==1?l:null:null;if(u)return sd(da(u,-1),!0)}return sd(da(r.nodeType==3?Oo(r):r,-n),n>=0)}function sd(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function xy(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function MA(t,e,n){let r=t.state,s=t.root.activeElement;r!=e&&t.updateState(e),s!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),s!=t.dom&&s&&s.focus()}}function lV(t,e,n){let r=e.selection,s=n=="up"?r.$from:r.$to;return MA(t,e,()=>{let{node:i}=t.docView.domFromPos(s.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(i,!0);if(!a)break;if(a.node.isBlock){i=a.contentDOM||a.dom;break}i=a.dom.parentNode}let o=IA(t,s.pos,1);for(let a=i.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=Oo(a,0,a.nodeValue.length).getClientRects();else continue;for(let u=0;u<l.length;u++){let d=l[u];if(d.bottom>d.top+1&&(n=="up"?o.top-d.top>(d.bottom-o.top)*2:d.bottom-o.bottom>(o.bottom-d.top)*2))return!1}}return!0})}const cV=/[\u0590-\u08ac]/;function uV(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let s=r.parentOffset,i=!s,o=s==r.parent.content.size,a=t.domSelection();return a?!cV.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?i:o:MA(t,e,()=>{let{focusNode:l,focusOffset:u,anchorNode:d,anchorOffset:f}=t.domSelectionRange(),h=a.caretBidiLevel;a.modify("move",n,"character");let p=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:m,focusOffset:y}=t.domSelectionRange(),b=m&&!p.contains(m.nodeType==1?m:m.parentNode)||l==m&&u==y;try{a.collapse(d,f),l&&(l!=d||u!=f)&&a.extend&&a.extend(l,u)}catch{}return h!=null&&(a.caretBidiLevel=h),b}):r.pos==r.start()||r.pos==r.end()}let nT=null,rT=null,sT=!1;function dV(t,e,n){return nT==e&&rT==n?sT:(nT=e,rT=n,sT=n=="up"||n=="down"?lV(t,e,n):uV(t,e,n))}const Ii=0,iT=1,Rl=2,ko=3;class ah{constructor(e,n,r,s){this.parent=e,this.children=n,this.dom=r,this.contentDOM=s,this.dirty=Ii,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let s=this.children[n];if(s==e)return r;r+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let i,o;if(e==this.contentDOM)i=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(o)+o.size:this.posAtStart}else{let i,o;if(e==this.contentDOM)i=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(o):this.posAtEnd}let s;if(e==this.dom&&this.contentDOM)s=n>Qr(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!1;break}if(i.previousSibling)break}if(s==null&&n==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!0;break}if(i.nextSibling)break}}return s??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,s=e;s;s=s.parentNode){let i=this.getDesc(s),o;if(i&&(!n||i.node))if(r&&(o=i.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return i}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let s=e;s;s=s.parentNode){let i=this.getDesc(s);if(i)return i.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let s=this.children[n],i=r+s.size;if(r==e&&i!=r){for(;!s.border&&s.children.length;)for(let o=0;o<s.children.length;o++){let a=s.children[o];if(a.size){s=a;break}}return s}if(e<i)return s.descAt(e-r-s.border);r=i}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,s=0;for(let i=0;r<this.children.length;r++){let o=this.children[r],a=i+o.size;if(a>e||o instanceof AA){s=e-i;break}i=a}if(s)return this.children[r].domFromPos(s-this.children[r].border,n);for(let i;r&&!(i=this.children[r-1]).size&&i instanceof DA&&i.side>=0;r--);if(n<=0){let i,o=!0;for(;i=r?this.children[r-1]:null,!(!i||i.dom.parentNode==this.contentDOM);r--,o=!1);return i&&n&&o&&!i.border&&!i.domAtom?i.domFromPos(i.size,n):{node:this.contentDOM,offset:i?Qr(i.dom)+1:0}}else{let i,o=!0;for(;i=r<this.children.length?this.children[r]:null,!(!i||i.dom.parentNode==this.contentDOM);r++,o=!1);return i&&o&&!i.border&&!i.domAtom?i.domFromPos(0,n):{node:this.contentDOM,offset:i?Qr(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,i=-1;for(let o=r,a=0;;a++){let l=this.children[a],u=o+l.size;if(s==-1&&e<=u){let d=o+l.border;if(e>=d&&n<=u-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,d);e=o;for(let f=a;f>0;f--){let h=this.children[f-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){s=Qr(h.dom)+1;break}e-=h.size}s==-1&&(s=0)}if(s>-1&&(u>n||a==this.children.length-1)){n=u;for(let d=a+1;d<this.children.length;d++){let f=this.children[d];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(-1)){i=Qr(f.dom);break}n+=f.size}i==-1&&(i=this.contentDOM.childNodes.length);break}o=u}return{node:this.contentDOM,from:e,to:n,fromOffset:s,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,s=!1){let i=Math.min(e,n),o=Math.max(e,n);for(let p=0,m=0;p<this.children.length;p++){let y=this.children[p],b=m+y.size;if(i>m&&o<b)return y.setSelection(e-m-y.border,n-m-y.border,r,s);m=b}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),u=r.root.getSelection(),d=r.domSelectionRange(),f=!1;if((ji||gs)&&e==n){let{node:p,offset:m}=a;if(p.nodeType==3){if(f=!!(m&&p.nodeValue[m-1]==`
`),f&&m==p.nodeValue.length)for(let y=p,b;y;y=y.parentNode){if(b=y.nextSibling){b.nodeName=="BR"&&(a=l={node:b.parentNode,offset:Qr(b)+1});break}let g=y.pmViewDesc;if(g&&g.node&&g.node.isBlock)break}}else{let y=p.childNodes[m-1];f=y&&(y.nodeName=="BR"||y.contentEditable=="false")}}if(ji&&d.focusNode&&d.focusNode!=l.node&&d.focusNode.nodeType==1){let p=d.focusNode.childNodes[d.focusOffset];p&&p.contentEditable=="false"&&(s=!0)}if(!(s||f&&gs)&&nc(a.node,a.offset,d.anchorNode,d.anchorOffset)&&nc(l.node,l.offset,d.focusNode,d.focusOffset))return;let h=!1;if((u.extend||e==n)&&!(f&&ji)){u.collapse(a.node,a.offset);try{e!=n&&u.extend(l.node,l.offset),h=!0}catch{}}if(!h){if(e>n){let m=a;a=l,l=m}let p=document.createRange();p.setEnd(l.node,l.offset),p.setStart(a.node,a.offset),u.removeAllRanges(),u.addRange(p)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,s=0;s<this.children.length;s++){let i=this.children[s],o=r+i.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let a=r+i.border,l=o-i.border;if(e>=a&&n<=l){this.dirty=e==r||n==o?Rl:iT,e==a&&n==l&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=ko:i.markDirty(e-a,n-a);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?Rl:ko}r=o}this.dirty=Rl}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?Rl:iT;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class DA extends ah{constructor(e,n,r,s){let i,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!i)return s;if(i.parent)return i.parent.posBeforeChild(i)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,i=this}matchesWidget(e){return this.dirty==Ii&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class fV extends ah{constructor(e,n,r,s){super(e,[],n,null),this.textDOM=r,this.text=s}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class rc extends ah{constructor(e,n,r,s,i){super(e,[],r,s),this.mark=n,this.spec=i}static create(e,n,r,s){let i=s.nodeViews[n.type.name],o=i&&i(n,s,r);return(!o||!o.dom)&&(o=lc.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new rc(e,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&ko||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=ko&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=Ii){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Ii}}slice(e,n,r){let s=rc.create(this.parent,this.mark,!0,r),i=this.children,o=this.size;n<o&&(i=G1(i,n,o,r)),e>0&&(i=G1(i,0,e,r));for(let a=0;a<i.length;a++)i[a].parent=s;return s.children=i,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Fa extends ah{constructor(e,n,r,s,i,o,a,l,u){super(e,[],i,o),this.node=n,this.outerDeco=r,this.innerDeco=s,this.nodeDOM=a}static create(e,n,r,s,i,o){let a=i.nodeViews[n.type.name],l,u=a&&a(n,i,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,s),d=u&&u.dom,f=u&&u.contentDOM;if(n.isText){if(!d)d=document.createTextNode(n.text);else if(d.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else d||({dom:d,contentDOM:f}=lc.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!f&&!n.isText&&d.nodeName!="BR"&&(d.hasAttribute("contenteditable")||(d.contentEditable="false"),n.type.spec.draggable&&(d.draggable=!0));let h=d;return d=PA(d,r,n),u?l=new hV(e,n,r,s,d,f||null,h,u,i,o+1):n.isText?new Kg(e,n,r,s,d,h,i):new Fa(e,n,r,s,d,f||null,h,i,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>Mt.empty)}return e}matchesNode(e,n,r){return this.dirty==Ii&&e.eq(this.node)&&Cm(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,s=n,i=e.composing?this.localCompositionInfo(e,n):null,o=i&&i.pos>-1?i:null,a=i&&i.pos<0,l=new mV(this,o&&o.node,e);xV(this.node,this.innerDeco,(u,d,f)=>{u.spec.marks?l.syncToMarks(u.spec.marks,r,e):u.type.side>=0&&!f&&l.syncToMarks(d==this.node.childCount?Un.none:this.node.child(d).marks,r,e),l.placeWidget(u,e,s)},(u,d,f,h)=>{l.syncToMarks(u.marks,r,e);let p;l.findNodeMatch(u,d,f,h)||a&&e.state.selection.from>s&&e.state.selection.to<s+u.nodeSize&&(p=l.findIndexWithChild(i.node))>-1&&l.updateNodeAt(u,d,f,p,e)||l.updateNextNode(u,d,f,e,h,s)||l.addNode(u,d,f,e,s),s+=u.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==Rl)&&(o&&this.protectLocalComposition(e,o),RA(this.contentDOM,this.children,e),Nu&&bV(this.dom))}localCompositionInfo(e,n){let{from:r,to:s}=e.state.selection;if(!(e.state.selection instanceof pn)||r<n||s>n+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let o=i.nodeValue,a=vV(this.node.content,o,r-n,s-n);return a<0?null:{node:i,pos:a,text:o}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:s}){if(this.getDesc(n))return;let i=n;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let o=new fV(this,i,n,s);e.input.compositionNodes.push(o),this.children=G1(this.children,r,r+s.length,e,o)}update(e,n,r,s){return this.dirty==ko||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,s),!0)}updateInner(e,n,r,s){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=Ii}updateOuterDeco(e){if(Cm(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=OA(this.dom,this.nodeDOM,K1(this.outerDeco,this.node,n),K1(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function oT(t,e,n,r,s){PA(r,e,t);let i=new Fa(void 0,t,e,n,r,r,r,s,0);return i.contentDOM&&i.updateChildren(s,0),i}class Kg extends Fa{constructor(e,n,r,s,i,o,a){super(e,n,r,s,i,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,s){return this.dirty==ko||this.dirty!=Ii&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=Ii||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=Ii,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let s=this.node.cut(e,n),i=document.createTextNode(s.text);return new Kg(this.parent,s,this.outerDeco,this.innerDeco,i,i,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=ko)}get domAtom(){return!1}isText(e){return this.node.text==e}}class AA extends ah{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Ii&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class hV extends Fa{constructor(e,n,r,s,i,o,a,l,u,d){super(e,n,r,s,i,o,a,u,d),this.spec=l}update(e,n,r,s){if(this.dirty==ko)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,n,r);return i&&this.updateInner(e,n,r,s),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,s){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function RA(t,e,n){let r=t.firstChild,s=!1;for(let i=0;i<e.length;i++){let o=e[i],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=aT(r),s=!0;r=r.nextSibling}else s=!0,t.insertBefore(a,r);if(o instanceof rc){let l=r?r.previousSibling:t.lastChild;RA(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=aT(r),s=!0;s&&n.trackWrites==t&&(n.trackWrites=null)}const zd=function(t){t&&(this.nodeName=t)};zd.prototype=Object.create(null);const Ol=[new zd];function K1(t,e,n){if(t.length==0)return Ol;let r=n?Ol[0]:new zd,s=[r];for(let i=0;i<t.length;i++){let o=t[i].type.attrs;if(o){o.nodeName&&s.push(r=new zd(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&s.length==1&&s.push(r=new zd(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return s}function OA(t,e,n,r){if(n==Ol&&r==Ol)return e;let s=e;for(let i=0;i<r.length;i++){let o=r[i],a=n[i];if(i){let l;a&&a.nodeName==o.nodeName&&s!=t&&(l=s.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(s),a=Ol[0]),s=l}pV(s,a||Ol[0],o)}return s}function pV(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],s=n.class?n.class.split(" ").filter(Boolean):[];for(let i=0;i<r.length;i++)s.indexOf(r[i])==-1&&t.classList.remove(r[i]);for(let i=0;i<s.length;i++)r.indexOf(s[i])==-1&&t.classList.add(s[i]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,s;for(;s=r.exec(e.style);)t.style.removeProperty(s[1])}n.style&&(t.style.cssText+=n.style)}}function PA(t,e,n){return OA(t,t,Ol,K1(e,n,t.nodeType!=1))}function Cm(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function aT(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class mV{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=gV(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let s=0,i=this.stack.length>>1,o=Math.min(i,e.length);for(;s<o&&(s==i-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&e[s].type.spec.spanning!==!1;)s++;for(;s<i;)this.destroyRest(),this.top.dirty=Ii,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let u=this.top.children[l];if(u.matchesMark(e[i])&&!this.isLocked(u.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=rc.create(this.top,e[i],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,i++}}findNodeMatch(e,n,r,s){let i=-1,o;if(s>=this.preMatch.index&&(o=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))i=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let u=this.top.children[a];if(u.matchesNode(e,n,r)&&!this.preMatch.matched.has(u)){i=a;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,n,r,s,i){let o=this.top.children[s];return o.dirty==ko&&o.dom==o.contentDOM&&(o.dirty=Rl),o.update(e,n,r,i)?(this.destroyBetween(this.index,s),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let s=this.index;s<this.top.children.length;s++)if(this.top.children[s]==r)return s}return-1}e=n}}updateNextNode(e,n,r,s,i,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof Fa){let u=this.preMatch.matched.get(l);if(u!=null&&u!=i)return!1;let d=l.dom,f,h=this.isLocked(d)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=ko&&Cm(n,l.outerDeco));if(!h&&l.update(e,n,r,s))return this.destroyBetween(this.index,a),l.dom!=d&&(this.changed=!0),this.index++,!0;if(!h&&(f=this.recreateWrapper(l,e,n,r,s,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=f,f.contentDOM&&(f.dirty=Rl,f.updateChildren(s,o+1),f.dirty=Ii),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,s,i,o){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!Cm(r,e.outerDeco)||!s.eq(e.innerDeco))return null;let a=Fa.create(this.top,n,r,s,i,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,n,r,s,i){let o=Fa.create(this.top,e,n,r,s,i);o.contentDOM&&o.updateChildren(s,i+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,n,r){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(s&&s.matchesWidget(e)&&(e==s.widget||!s.widget.type.toDOM.parentNode))this.index++;else{let i=new DA(this.top,e,n,r);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof rc;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof Kg)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((gs||Fr)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let s=new AA(this.top,[],r,null);n!=this.top?n.children.push(s):n.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function gV(t,e){let n=e,r=n.children.length,s=t.childCount,i=new Map,o=[];e:for(;s>0;){let a;for(;;)if(r){let u=n.children[r-1];if(u instanceof rc)n=u,r=u.children.length;else{a=u,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(s-1))break;--s,i.set(a,s),o.push(a)}}return{index:s,matched:i,matches:o.reverse()}}function yV(t,e){return t.type.side-e.type.side}function xV(t,e,n,r){let s=e.locals(t),i=0;if(s.length==0){for(let u=0;u<t.childCount;u++){let d=t.child(u);r(d,s,e.forChild(i,d),u),i+=d.nodeSize}return}let o=0,a=[],l=null;for(let u=0;;){let d,f;for(;o<s.length&&s[o].to==i;){let b=s[o++];b.widget&&(d?(f||(f=[d])).push(b):d=b)}if(d)if(f){f.sort(yV);for(let b=0;b<f.length;b++)n(f[b],u,!!l)}else n(d,u,!!l);let h,p;if(l)p=-1,h=l,l=null;else if(u<t.childCount)p=u,h=t.child(u++);else break;for(let b=0;b<a.length;b++)a[b].to<=i&&a.splice(b--,1);for(;o<s.length&&s[o].from<=i&&s[o].to>i;)a.push(s[o++]);let m=i+h.nodeSize;if(h.isText){let b=m;o<s.length&&s[o].from<b&&(b=s[o].from);for(let g=0;g<a.length;g++)a[g].to<b&&(b=a[g].to);b<m&&(l=h.cut(b-i),h=h.cut(0,b-i),m=b,p=-1)}else for(;o<s.length&&s[o].to<m;)o++;let y=h.isInline&&!h.isLeaf?a.filter(b=>!b.inline):a.slice();r(h,y,e.forChild(i,h),p),i=m}}function bV(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function vV(t,e,n,r){for(let s=0,i=0;s<t.childCount&&i<=r;){let o=t.child(s++),a=i;if(i+=o.nodeSize,!o.isText)continue;let l=o.text;for(;s<t.childCount;){let u=t.child(s++);if(i+=u.nodeSize,!u.isText)break;l+=u.text}if(i>=n){if(i>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let u=a<r?l.lastIndexOf(e,r-a-1):-1;if(u>=0&&u+e.length+a>=n)return a+u;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function G1(t,e,n,r,s){let i=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],u=a,d=a+=l.size;u>=n||d<=e?i.push(l):(u<e&&i.push(l.slice(0,e-u,r)),s&&(i.push(s),s=void 0),d>n&&i.push(l.slice(n-u,l.size,r)))}return i}function kw(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let s=t.docView.nearestDesc(n.focusNode),i=s&&s.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,u;if(Wg(n)){for(l=o;s&&!s.node;)s=s.parent;let f=s.node;if(s&&f.isAtom&&en.isSelectable(f)&&s.parent&&!(f.isInline&&G9(n.focusNode,n.focusOffset,s.dom))){let h=s.posBefore;u=new en(o==h?a:r.resolve(h))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let f=o,h=o;for(let p=0;p<n.rangeCount;p++){let m=n.getRangeAt(p);f=Math.min(f,t.docView.posFromDOM(m.startContainer,m.startOffset,1)),h=Math.max(h,t.docView.posFromDOM(m.endContainer,m.endOffset,-1))}if(f<0)return null;[l,o]=h==t.state.selection.anchor?[h,f]:[f,h],a=r.resolve(o)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let d=r.resolve(l);if(!u){let f=e=="pointer"||t.state.selection.head<a.pos&&!i?1:-1;u=Sw(t,d,a,f)}return u}function LA(t){return t.editable?t.hasFocus():zA(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Vo(t,e=!1){let n=t.state.selection;if($A(t,n),!!LA(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&Fr){let r=t.domSelectionRange(),s=t.domObserver.currentSelection;if(r.anchorNode&&s.anchorNode&&nc(r.anchorNode,r.anchorOffset,s.anchorNode,s.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)kV(t);else{let{anchor:r,head:s}=n,i,o;lT&&!(n instanceof pn)&&(n.$from.parent.inlineContent||(i=cT(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=cT(t,n.to))),t.docView.setSelection(r,s,t,e),lT&&(i&&uT(i),o&&uT(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&wV(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const lT=gs||Fr&&_A<63;function cT(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),s=r<n.childNodes.length?n.childNodes[r]:null,i=r?n.childNodes[r-1]:null;if(gs&&s&&s.contentEditable=="false")return by(s);if((!s||s.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(s)return by(s);if(i)return by(i)}}function by(t){return t.contentEditable="true",gs&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function uT(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function wV(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,s=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=s)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!LA(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function kV(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,Qr(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&Hs&&za<=11&&(n.disabled=!0,n.disabled=!1)}function $A(t,e){if(e instanceof en){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(dT(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else dT(t)}function dT(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function Sw(t,e,n,r){return t.someProp("createSelectionBetween",s=>s(t,e,n))||pn.between(e,n,r)}function fT(t){return t.editable&&!t.hasFocus()?!1:zA(t)}function zA(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function SV(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return nc(e.node,e.offset,n.anchorNode,n.anchorOffset)}function q1(t,e){let{$anchor:n,$head:r}=t.selection,s=e>0?n.max(r):n.min(r),i=s.parent.inlineContent?s.depth?t.doc.resolve(e>0?s.after():s.before()):null:s;return i&&mn.findFrom(i,e)}function ma(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function hT(t,e,n){let r=t.state.selection;if(r instanceof pn)if(n.indexOf("s")>-1){let{$head:s}=r,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let o=t.state.doc.resolve(s.pos+i.nodeSize*(e<0?-1:1));return ma(t,new pn(r.$anchor,o))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let s=q1(t.state,e);return s&&s instanceof en?ma(t,s):!1}else if(!(xi&&n.indexOf("m")>-1)){let s=r.$head,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter,o;if(!i||i.isText)return!1;let a=e<0?s.pos-i.nodeSize:s.pos;return i.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?en.isSelectable(i)?ma(t,new en(e<0?t.state.doc.resolve(s.pos-i.nodeSize):s)):oh?ma(t,new pn(t.state.doc.resolve(e<0?a:a+i.nodeSize))):!1:!1}}else return!1;else{if(r instanceof en&&r.node.isInline)return ma(t,new pn(e>0?r.$to:r.$from));{let s=q1(t.state,e);return s?ma(t,s):!1}}}function Em(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Fd(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function vc(t,e){return e<0?_V(t):TV(t)}function _V(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s,i,o=!1;for(ji&&n.nodeType==1&&r<Em(n)&&Fd(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(Fd(a,-1))s=n,i=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(FA(n))break;{let a=n.previousSibling;for(;a&&Fd(a,-1);)s=n.parentNode,i=Qr(a),a=a.previousSibling;if(a)n=a,r=Em(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?Y1(t,n,r):s&&Y1(t,s,i)}function TV(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s=Em(n),i,o;for(;;)if(r<s){if(n.nodeType!=1)break;let a=n.childNodes[r];if(Fd(a,1))i=n,o=++r;else break}else{if(FA(n))break;{let a=n.nextSibling;for(;a&&Fd(a,1);)i=a.parentNode,o=Qr(a)+1,a=a.nextSibling;if(a)n=a,r=0,s=Em(n);else{if(n=n.parentNode,n==t.dom)break;r=s=0}}}i&&Y1(t,i,o)}function FA(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function CV(t,e){for(;t&&e==t.childNodes.length&&!ih(t);)e=Qr(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function EV(t,e){for(;t&&!e&&!ih(t);)e=Qr(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function Y1(t,e,n){if(e.nodeType!=3){let i,o;(o=CV(e,n))?(e=o,n=0):(i=EV(e,n))&&(e=i,n=i.nodeValue.length)}let r=t.domSelection();if(!r)return;if(Wg(r)){let i=document.createRange();i.setEnd(e,n),i.setStart(e,n),r.removeAllRanges(),r.addRange(i)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:s}=t;setTimeout(()=>{t.state==s&&Vo(t)},50)}function pT(t,e){let n=t.state.doc.resolve(e);if(!(Fr||TA)&&n.parent.inlineContent){let s=t.coordsAtPos(e);if(e>n.start()){let i=t.coordsAtPos(e-1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left<s.left?"ltr":"rtl"}if(e<n.end()){let i=t.coordsAtPos(e+1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left>s.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function mT(t,e,n){let r=t.state.selection;if(r instanceof pn&&!r.empty||n.indexOf("s")>-1||xi&&n.indexOf("m")>-1)return!1;let{$from:s,$to:i}=r;if(!s.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=q1(t.state,e);if(o&&o instanceof en)return ma(t,o)}if(!s.parent.inlineContent){let o=e<0?s:i,a=r instanceof Ni?mn.near(o,e):mn.findFrom(o,e);return a?ma(t,a):!1}return!1}function gT(t,e){if(!(t.state.selection instanceof pn))return!0;let{$head:n,$anchor:r,empty:s}=t.state.selection;if(!n.sameParent(r))return!0;if(!s)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let o=t.state.tr;return e<0?o.delete(n.pos-i.nodeSize,n.pos):o.delete(n.pos,n.pos+i.nodeSize),t.dispatch(o),!0}return!1}function yT(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function NV(t){if(!gs||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;yT(t,r,"true"),setTimeout(()=>yT(t,r,"false"),20)}return!1}function jV(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function IV(t,e){let n=e.keyCode,r=jV(e);if(n==8||xi&&n==72&&r=="c")return gT(t,-1)||vc(t,-1);if(n==46&&!e.shiftKey||xi&&n==68&&r=="c")return gT(t,1)||vc(t,1);if(n==13||n==27)return!0;if(n==37||xi&&n==66&&r=="c"){let s=n==37?pT(t,t.state.selection.from)=="ltr"?-1:1:-1;return hT(t,s,r)||vc(t,s)}else if(n==39||xi&&n==70&&r=="c"){let s=n==39?pT(t,t.state.selection.from)=="ltr"?1:-1:1;return hT(t,s,r)||vc(t,s)}else{if(n==38||xi&&n==80&&r=="c")return mT(t,-1,r)||vc(t,-1);if(n==40||xi&&n==78&&r=="c")return NV(t)||mT(t,1,r)||vc(t,1);if(r==(xi?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function _w(t,e){t.someProp("transformCopied",p=>{e=p(e,t)});let n=[],{content:r,openStart:s,openEnd:i}=e;for(;s>1&&i>1&&r.childCount==1&&r.firstChild.childCount==1;){s--,i--;let p=r.firstChild;n.push(p.type.name,p.attrs!=p.type.defaultAttrs?p.attrs:null),r=p.content}let o=t.someProp("clipboardSerializer")||lc.fromSchema(t.state.schema),a=KA(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let u=l.firstChild,d,f=0;for(;u&&u.nodeType==1&&(d=WA[u.nodeName.toLowerCase()]);){for(let p=d.length-1;p>=0;p--){let m=a.createElement(d[p]);for(;l.firstChild;)m.appendChild(l.firstChild);l.appendChild(m),f++}u=l.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${s} ${i}${f?` -${f}`:""} ${JSON.stringify(n)}`);let h=t.someProp("clipboardTextSerializer",p=>p(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:h,slice:e}}function BA(t,e,n,r,s){let i=s.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=!!e&&(r||i||!n);if(l){if(t.someProp("transformPastedText",h=>{e=h(e,i||r,t)}),i)return a=new Kt(Mt.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",h=>{a=h(a,t,!0)}),a;let f=t.someProp("clipboardTextParser",h=>h(e,s,r,t));if(f)a=f;else{let h=s.marks(),{schema:p}=t.state,m=lc.fromSchema(p);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(y=>{let b=o.appendChild(document.createElement("p"));y&&b.appendChild(m.serializeNode(p.text(y,h)))})}}else t.someProp("transformPastedHTML",f=>{n=f(n,t)}),o=RV(n),oh&&OV(o);let u=o&&o.querySelector("[data-pm-slice]"),d=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let f=+d[3];f>0;f--){let h=o.firstChild;for(;h&&h.nodeType!=1;)h=h.nextSibling;if(!h)break;o=h}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||$a.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||d),context:s,ruleFromNode(h){return h.nodeName=="BR"&&!h.nextSibling&&h.parentNode&&!MV.test(h.parentNode.nodeName)?{ignore:!0}:null}})),d)a=PV(xT(a,+d[1],+d[2]),d[4]);else if(a=Kt.maxOpen(DV(a.content,s),!0),a.openStart||a.openEnd){let f=0,h=0;for(let p=a.content.firstChild;f<a.openStart&&!p.type.spec.isolating;f++,p=p.firstChild);for(let p=a.content.lastChild;h<a.openEnd&&!p.type.spec.isolating;h++,p=p.lastChild);a=xT(a,f,h)}return t.someProp("transformPasted",f=>{a=f(a,t,l)}),a}const MV=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function DV(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let s=e.node(n).contentMatchAt(e.index(n)),i,o=[];if(t.forEach(a=>{if(!o)return;let l=s.findWrapping(a.type),u;if(!l)return o=null;if(u=o.length&&i.length&&HA(l,i,a,o[o.length-1],0))o[o.length-1]=u;else{o.length&&(o[o.length-1]=VA(o[o.length-1],i.length));let d=UA(a,l);o.push(d),s=s.matchType(d.type),i=l}}),o)return Mt.from(o)}return t}function UA(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,Mt.from(t));return t}function HA(t,e,n,r,s){if(s<t.length&&s<e.length&&t[s]==e[s]){let i=HA(t,e,n,r.lastChild,s+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(s==t.length-1?n.type:t[s+1]))return r.copy(r.content.append(Mt.from(UA(n,t,s+1))))}}function VA(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,VA(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(Mt.empty,!0);return t.copy(n.append(r))}function J1(t,e,n,r,s,i){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(i=0),s<r-1&&(a=J1(a,e,n,r,s+1,i)),s>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,i<=s).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(Mt.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function xT(t,e,n){return e<t.openStart&&(t=new Kt(J1(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new Kt(J1(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const WA={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let bT=null;function KA(){return bT||(bT=document.implementation.createHTMLDocument("title"))}let vy=null;function AV(t){let e=window.trustedTypes;return e?(vy||(vy=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),vy.createHTML(t)):t}function RV(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=KA().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),s;if((s=r&&WA[r[1].toLowerCase()])&&(t=s.map(i=>"<"+i+">").join("")+t+s.map(i=>"</"+i+">").reverse().join("")),n.innerHTML=AV(t),s)for(let i=0;i<s.length;i++)n=n.querySelector(s[i])||n;return n}function OV(t){let e=t.querySelectorAll(Fr?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==""&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function PV(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:s,openStart:i,openEnd:o}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;s=Mt.from(l.create(r[a+1],s)),i++,o++}return new Kt(s,i,o)}const _s={},Ts={},LV={touchstart:!0,touchmove:!0};class $V{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function zV(t){for(let e in _s){let n=_s[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{BV(t,r)&&!Tw(t,r)&&(t.editable||!(r.type in Ts))&&n(t,r)},LV[e]?{passive:!0}:void 0)}gs&&t.dom.addEventListener("input",()=>null),X1(t)}function Na(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function FV(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function X1(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>Tw(t,r))})}function Tw(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function BV(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function UV(t,e){!Tw(t,e)&&_s[e.type]&&(t.editable||!(e.type in Ts))&&_s[e.type](t,e)}Ts.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!qA(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(Fo&&Fr&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),Nu&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",s=>s(t,Sl(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||IV(t,n)?n.preventDefault():Na(t,"key")};Ts.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Ts.keypress=(t,e)=>{let n=e;if(qA(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||xi&&n.metaKey)return;if(t.someProp("handleKeyPress",s=>s(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof pn)||!r.$from.sameParent(r.$to)){let s=String.fromCharCode(n.charCode),i=()=>t.state.tr.insertText(s).scrollIntoView();!/[\r\n]/.test(s)&&!t.someProp("handleTextInput",o=>o(t,r.$from.pos,r.$to.pos,s,i))&&t.dispatch(i()),n.preventDefault()}};function Gg(t){return{left:t.clientX,top:t.clientY}}function HV(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function Cw(t,e,n,r,s){if(r==-1)return!1;let i=t.state.doc.resolve(r);for(let o=i.depth+1;o>0;o--)if(t.someProp(e,a=>o>i.depth?a(t,n,i.nodeAfter,i.before(o),s,!0):a(t,n,i.node(o),i.before(o),s,!1)))return!0;return!1}function hu(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);n=="pointer"&&r.setMeta("pointer",!0),t.dispatch(r)}function VV(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&en.isSelectable(r)?(hu(t,new en(n),"pointer"),!0):!1}function WV(t,e){if(e==-1)return!1;let n=t.state.selection,r,s;n instanceof en&&(r=n.node);let i=t.state.doc.resolve(e);for(let o=i.depth+1;o>0;o--){let a=o>i.depth?i.nodeAfter:i.node(o);if(en.isSelectable(a)){r&&n.$from.depth>0&&o>=n.$from.depth&&i.before(n.$from.depth+1)==n.$from.pos?s=i.before(n.$from.depth):s=i.before(o);break}}return s!=null?(hu(t,en.create(t.state.doc,s),"pointer"),!0):!1}function KV(t,e,n,r,s){return Cw(t,"handleClickOn",e,n,r)||t.someProp("handleClick",i=>i(t,e,r))||(s?WV(t,n):VV(t,n))}function GV(t,e,n,r){return Cw(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",s=>s(t,e,r))}function qV(t,e,n,r){return Cw(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",s=>s(t,e,r))||YV(t,n,r)}function YV(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(hu(t,pn.create(r,0,r.content.size),"pointer"),!0):!1;let s=r.resolve(e);for(let i=s.depth+1;i>0;i--){let o=i>s.depth?s.nodeAfter:s.node(i),a=s.before(i);if(o.inlineContent)hu(t,pn.create(r,a+1,a+1+o.content.size),"pointer");else if(en.isSelectable(o))hu(t,en.create(r,a),"pointer");else continue;return!0}}function Ew(t){return Nm(t)}const GA=xi?"metaKey":"ctrlKey";_s.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=Ew(t),s=Date.now(),i="singleClick";s-t.input.lastClick.time<500&&HV(n,t.input.lastClick)&&!n[GA]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?i="doubleClick":t.input.lastClick.type=="doubleClick"&&(i="tripleClick")),t.input.lastClick={time:s,x:n.clientX,y:n.clientY,type:i,button:n.button};let o=t.posAtCoords(Gg(n));o&&(i=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new JV(t,o,n,!!r)):(i=="doubleClick"?GV:qV)(t,o.pos,o.inside,n)?n.preventDefault():Na(t,"pointer"))};class JV{constructor(e,n,r,s){this.view=e,this.pos=n,this.event=r,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[GA],this.allowDefault=r.shiftKey;let i,o;if(n.inside>-1)i=e.state.doc.nodeAt(n.inside),o=n.inside;else{let d=e.state.doc.resolve(n.pos);i=d.parent,o=d.depth?d.before():0}const a=s?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:u}=e.state;(r.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||u instanceof en&&u.from<=o&&u.to>o)&&(this.mightDrag={node:i,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&ji&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Na(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Vo(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(Gg(e))),this.updateAllowDefault(e),this.allowDefault||!n?Na(this.view,"pointer"):KV(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||gs&&this.mightDrag&&!this.mightDrag.node.isAtom||Fr&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(hu(this.view,mn.near(this.view.state.doc.resolve(n.pos)),"pointer"),e.preventDefault()):Na(this.view,"pointer")}move(e){this.updateAllowDefault(e),Na(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}_s.touchstart=t=>{t.input.lastTouch=Date.now(),Ew(t),Na(t,"pointer")};_s.touchmove=t=>{t.input.lastTouch=Date.now(),Na(t,"pointer")};_s.contextmenu=t=>Ew(t);function qA(t,e){return t.composing?!0:gs&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const XV=Fo?5e3:-1;Ts.compositionstart=Ts.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof pn&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)||Fr&&TA&&QV(t)))t.markCursor=t.state.storedMarks||n.marks(),Nm(t,!0),t.markCursor=null;else if(Nm(t,!e.selection.empty),ji&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let s=r.focusNode,i=r.focusOffset;s&&s.nodeType==1&&i!=0;){let o=i<0?s.lastChild:s.childNodes[i-1];if(!o)break;if(o.nodeType==3){let a=t.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else s=o,i=-1}}t.input.composing=!0}YA(t,XV)};function QV(t){let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(!e||e.nodeType!=1||n>=e.childNodes.length)return!1;let r=e.childNodes[n];return r.nodeType==1&&r.contentEditable=="false"}Ts.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,YA(t,20))};function YA(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Nm(t),e))}function JA(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e7());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function ZV(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=W9(e.focusNode,e.focusOffset),r=K9(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let s=r.pmViewDesc,i=t.domObserver.lastChangedTextNode;if(n==i||r==i)return i;if(!s||!s.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let o=n.pmViewDesc;if(!(!o||!o.isText(n.nodeValue)))return r}}return n||r}function e7(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Nm(t,e=!1){if(!(Fo&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),JA(t),e||t.docView&&t.docView.dirty){let n=kw(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function t7(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),s=document.createRange();s.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(s),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const Rf=Hs&&za<15||Nu&&J9<604;_s.copy=Ts.cut=(t,e)=>{let n=e,r=t.state.selection,s=n.type=="cut";if(r.empty)return;let i=Rf?null:n.clipboardData,o=r.content(),{dom:a,text:l}=_w(t,o);i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):t7(t,a),s&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function n7(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function r7(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let s=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?Of(t,r.value,null,s,e):Of(t,r.textContent,r.innerHTML,s,e)},50)}function Of(t,e,n,r,s){let i=BA(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,s,i||Kt.empty)))return!0;if(!i)return!1;let o=n7(i),a=o?t.state.tr.replaceSelectionWith(o,r):t.state.tr.replaceSelection(i);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function XA(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Ts.paste=(t,e)=>{let n=e;if(t.composing&&!Fo)return;let r=Rf?null:n.clipboardData,s=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&Of(t,XA(r),r.getData("text/html"),s,n)?n.preventDefault():r7(t,n)};class QA{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const s7=xi?"altKey":"ctrlKey";function ZA(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[s7]}_s.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let s=t.state.selection,i=s.empty?null:t.posAtCoords(Gg(n)),o;if(!(i&&i.pos>=s.from&&i.pos<=(s instanceof en?s.to-1:s.to))){if(r&&r.mightDrag)o=en.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let f=t.docView.nearestDesc(n.target,!0);f&&f.node.type.spec.draggable&&f!=t.docView&&(o=en.create(t.state.doc,f.posBefore))}}let a=(o||t.state.selection).content(),{dom:l,text:u,slice:d}=_w(t,a);(!n.dataTransfer.files.length||!Fr||_A>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(Rf?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",Rf||n.dataTransfer.setData("text/plain",u),t.dragging=new QA(d,ZA(t,n),o)};_s.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Ts.dragover=Ts.dragenter=(t,e)=>e.preventDefault();Ts.drop=(t,e)=>{try{i7(t,e,t.dragging)}finally{t.dragging=null}};function i7(t,e,n){if(!e.dataTransfer)return;let r=t.posAtCoords(Gg(e));if(!r)return;let s=t.state.doc.resolve(r.pos),i=n&&n.slice;i?t.someProp("transformPasted",p=>{i=p(i,t,!1)}):i=BA(t,XA(e.dataTransfer),Rf?null:e.dataTransfer.getData("text/html"),!1,s);let o=!!(n&&ZA(t,e));if(t.someProp("handleDrop",p=>p(t,e,i||Kt.empty,o))){e.preventDefault();return}if(!i)return;e.preventDefault();let a=i?mA(t.state.doc,s.pos,i):s.pos;a==null&&(a=s.pos);let l=t.state.tr;if(o){let{node:p}=n;p?p.replace(l):l.deleteSelection()}let u=l.mapping.map(a),d=i.openStart==0&&i.openEnd==0&&i.content.childCount==1,f=l.doc;if(d?l.replaceRangeWith(u,u,i.content.firstChild):l.replaceRange(u,u,i),l.doc.eq(f))return;let h=l.doc.resolve(u);if(d&&en.isSelectable(i.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(i.content.firstChild))l.setSelection(new en(h));else{let p=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach((m,y,b,g)=>p=g),l.setSelection(Sw(t,h,l.doc.resolve(p)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}_s.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&Vo(t)},20))};_s.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};_s.beforeinput=(t,e)=>{if(Fr&&Fo&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",i=>i(t,Sl(8,"Backspace")))))return;let{$cursor:s}=t.state.selection;s&&s.pos>0&&t.dispatch(t.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let t in Ts)_s[t]=Ts[t];function Pf(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class jm{constructor(e,n){this.toDOM=e,this.spec=n||Kl,this.side=this.spec.side||0}map(e,n,r,s){let{pos:i,deleted:o}=e.mapResult(n.from+s,this.side<0?-1:1);return o?null:new zs(i-r,i-r,this)}valid(){return!0}eq(e){return this==e||e instanceof jm&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Pf(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Ba{constructor(e,n){this.attrs=e,this.spec=n||Kl}map(e,n,r,s){let i=e.map(n.from+s,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+s,this.spec.inclusiveEnd?1:-1)-r;return i>=o?null:new zs(i,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof Ba&&Pf(this.attrs,e.attrs)&&Pf(this.spec,e.spec)}static is(e){return e.type instanceof Ba}destroy(){}}class Nw{constructor(e,n){this.attrs=e,this.spec=n||Kl}map(e,n,r,s){let i=e.mapResult(n.from+s,1);if(i.deleted)return null;let o=e.mapResult(n.to+s,-1);return o.deleted||o.pos<=i.pos?null:new zs(i.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:s}=e.content.findIndex(n.from),i;return s==n.from&&!(i=e.child(r)).isText&&s+i.nodeSize==n.to}eq(e){return this==e||e instanceof Nw&&Pf(this.attrs,e.attrs)&&Pf(this.spec,e.spec)}destroy(){}}class zs{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new zs(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new zs(e,e,new jm(n,r))}static inline(e,n,r,s){return new zs(e,n,new Ba(r,s))}static node(e,n,r,s){return new zs(e,n,new Nw(r,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof Ba}get widget(){return this.type instanceof jm}}const Ic=[],Kl={};class vr{constructor(e,n){this.local=e.length?e:Ic,this.children=n.length?n:Ic}static create(e,n){return n.length?Im(n,e,0,Kl):ds}find(e,n,r){let s=[];return this.findInner(e??0,n??1e9,s,0,r),s}findInner(e,n,r,s,i){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!i||i(a.spec))&&r.push(a.copy(a.from+s,a.to+s))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,r,s+a,i)}}map(e,n,r){return this==ds||e.maps.length==0?this:this.mapInner(e,n,0,0,r||Kl)}mapInner(e,n,r,s,i){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,s);l&&l.type.valid(n,l)?(o||(o=[])).push(l):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?o7(this.children,o||[],e,n,r,s,i):o?new vr(o.sort(Gl),Ic):ds}add(e,n){return n.length?this==ds?vr.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let s,i=0;e.forEach((a,l)=>{let u=l+r,d;if(d=t5(n,a,u)){for(s||(s=this.children.slice());i<s.length&&s[i]<l;)i+=3;s[i]==l?s[i+2]=s[i+2].addInner(a,d,u+1):s.splice(i,0,l,l+a.nodeSize,Im(d,a,u+1,Kl)),i+=3}});let o=e5(i?n5(n):n,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new vr(o.length?this.local.concat(o).sort(Gl):this.local,s||this.children)}remove(e){return e.length==0||this==ds?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,s=this.local;for(let i=0;i<r.length;i+=3){let o,a=r[i]+n,l=r[i+1]+n;for(let d=0,f;d<e.length;d++)(f=e[d])&&f.from>a&&f.to<l&&(e[d]=null,(o||(o=[])).push(f));if(!o)continue;r==this.children&&(r=this.children.slice());let u=r[i+2].removeInner(o,a+1);u!=ds?r[i+2]=u:(r.splice(i,3),i-=3)}if(s.length){for(let i=0,o;i<e.length;i++)if(o=e[i])for(let a=0;a<s.length;a++)s[a].eq(o,n)&&(s==this.local&&(s=this.local.slice()),s.splice(a--,1))}return r==this.children&&s==this.local?this:s.length||r.length?new vr(s,r):ds}forChild(e,n){if(this==ds)return this;if(n.isLeaf)return vr.empty;let r,s;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let i=e+1,o=i+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>i&&l.type instanceof Ba){let u=Math.max(i,l.from)-i,d=Math.min(o,l.to)-i;u<d&&(s||(s=[])).push(l.copy(u,d))}}if(s){let a=new vr(s.sort(Gl),Ic);return r?new ka([a,r]):a}return r||ds}eq(e){if(this==e)return!0;if(!(e instanceof vr)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return jw(this.localsInner(e))}localsInner(e){if(this==ds)return Ic;if(e.inlineContent||!this.local.some(Ba.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Ba||n.push(this.local[r]);return n}forEachSet(e){e(this)}}vr.empty=new vr([],[]);vr.removeOverlap=jw;const ds=vr.empty;class ka{constructor(e){this.members=e}map(e,n){const r=this.members.map(s=>s.map(e,n,Kl));return ka.from(r)}forChild(e,n){if(n.isLeaf)return vr.empty;let r=[];for(let s=0;s<this.members.length;s++){let i=this.members[s].forChild(e,n);i!=ds&&(i instanceof ka?r=r.concat(i.members):r.push(i))}return ka.from(r)}eq(e){if(!(e instanceof ka)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let s=0;s<this.members.length;s++){let i=this.members[s].localsInner(e);if(i.length)if(!n)n=i;else{r&&(n=n.slice(),r=!1);for(let o=0;o<i.length;o++)n.push(i[o])}}return n?jw(r?n:n.sort(Gl)):Ic}static from(e){switch(e.length){case 0:return ds;case 1:return e[0];default:return new ka(e.every(n=>n instanceof vr)?e:e.reduce((n,r)=>n.concat(r instanceof vr?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function o7(t,e,n,r,s,i,o){let a=t.slice();for(let u=0,d=i;u<n.maps.length;u++){let f=0;n.maps[u].forEach((h,p,m,y)=>{let b=y-m-(p-h);for(let g=0;g<a.length;g+=3){let v=a[g+1];if(v<0||h>v+d-f)continue;let w=a[g]+d-f;p>=w?a[g+1]=h<=w?-2:-1:h>=d&&b&&(a[g]+=b,a[g+1]+=b)}f+=b}),d=n.maps[u].map(d,-1)}let l=!1;for(let u=0;u<a.length;u+=3)if(a[u+1]<0){if(a[u+1]==-2){l=!0,a[u+1]=-1;continue}let d=n.map(t[u]+i),f=d-s;if(f<0||f>=r.content.size){l=!0;continue}let h=n.map(t[u+1]+i,-1),p=h-s,{index:m,offset:y}=r.content.findIndex(f),b=r.maybeChild(m);if(b&&y==f&&y+b.nodeSize==p){let g=a[u+2].mapInner(n,b,d+1,t[u]+i+1,o);g!=ds?(a[u]=f,a[u+1]=p,a[u+2]=g):(a[u+1]=-2,l=!0)}else l=!0}if(l){let u=a7(a,t,e,n,s,i,o),d=Im(u,r,0,o);e=d.local;for(let f=0;f<a.length;f+=3)a[f+1]<0&&(a.splice(f,3),f-=3);for(let f=0,h=0;f<d.children.length;f+=3){let p=d.children[f];for(;h<a.length&&a[h]<p;)h+=3;a.splice(h,0,d.children[f],d.children[f+1],d.children[f+2])}}return new vr(e.sort(Gl),a)}function e5(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let s=t[r];n.push(new zs(s.from+e,s.to+e,s.type))}return n}function a7(t,e,n,r,s,i,o){function a(l,u){for(let d=0;d<l.local.length;d++){let f=l.local[d].map(r,s,u);f?n.push(f):o.onRemove&&o.onRemove(l.local[d].spec)}for(let d=0;d<l.children.length;d+=3)a(l.children[d+2],l.children[d]+u+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+i+1);return n}function t5(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,s=null;for(let i=0,o;i<t.length;i++)(o=t[i])&&o.from>n&&o.to<r&&((s||(s=[])).push(o),t[i]=null);return s}function n5(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function Im(t,e,n,r){let s=[],i=!1;e.forEach((a,l)=>{let u=t5(t,a,l+n);if(u){i=!0;let d=Im(u,a,n+l+1,r);d!=ds&&s.push(l,l+a.nodeSize,d)}});let o=e5(i?n5(t):t,-n).sort(Gl);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||s.length?new vr(o,s):ds}function Gl(t,e){return t.from-e.from||t.to-e.to}function jw(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let s=n+1;s<e.length;s++){let i=e[s];if(i.from==r.from){i.to!=r.to&&(e==t&&(e=t.slice()),e[s]=i.copy(i.from,r.to),vT(e,s+1,i.copy(r.to,i.to)));continue}else{i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),vT(e,s,r.copy(i.from,r.to)));break}}}return e}function vT(t,e,n){for(;e<t.length&&Gl(n,t[e])>0;)e++;t.splice(e,0,n)}function wy(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=ds&&e.push(r)}),t.cursorWrapper&&e.push(vr.create(t.state.doc,[t.cursorWrapper.deco])),ka.from(e)}const l7={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},c7=Hs&&za<=11;class u7{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class d7{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new u7,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let s=0;s<r.length;s++)this.queue.push(r[s]);Hs&&za<=11&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),c7&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,l7)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(fT(this.view)){if(this.suppressingSelectionUpdates)return Vo(this.view);if(Hs&&za<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&nc(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let i=e.focusNode;i;i=Eu(i))n.add(i);for(let i=e.anchorNode;i;i=Eu(i))if(n.has(i)){r=i;break}let s=r&&this.view.docView.nearestDesc(r);if(s&&s.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&fT(e)&&!this.ignoreSelectionChange(r),i=-1,o=-1,a=!1,l=[];if(e.editable)for(let d=0;d<n.length;d++){let f=this.registerMutation(n[d],l);f&&(i=i<0?f.from:Math.min(f.from,i),o=o<0?f.to:Math.max(f.to,o),f.typeOver&&(a=!0))}if(ji&&l.length){let d=l.filter(f=>f.nodeName=="BR");if(d.length==2){let[f,h]=d;f.parentNode&&f.parentNode.parentNode==h.parentNode?h.remove():f.remove()}else{let{focusNode:f}=this.currentSelection;for(let h of d){let p=h.parentNode;p&&p.nodeName=="LI"&&(!f||p7(e,f)!=p)&&h.remove()}}}else if((Fr||gs)&&l.some(d=>d.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let d of l)if(d.nodeName=="BR"&&d.parentNode){let f=d.nextSibling;f&&f.nodeType==1&&f.contentEditable=="false"&&d.parentNode.removeChild(d)}}let u=null;i<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Wg(r)&&(u=kw(e))&&u.eq(mn.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Vo(e),this.currentSelection.set(r),e.scrollToSelection()):(i>-1||s)&&(i>-1&&(e.docView.markDirty(i,o),f7(e)),this.handleDOMChange(i,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||Vo(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let d=0;d<e.addedNodes.length;d++){let f=e.addedNodes[d];n.push(f),f.nodeType==3&&(this.lastChangedTextNode=f)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let s=e.previousSibling,i=e.nextSibling;if(Hs&&za<=11&&e.addedNodes.length)for(let d=0;d<e.addedNodes.length;d++){let{previousSibling:f,nextSibling:h}=e.addedNodes[d];(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(s=f),(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(i=h)}let o=s&&s.parentNode==e.target?Qr(s)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=i&&i.parentNode==e.target?Qr(i):e.target.childNodes.length,u=r.localPosFromDOM(e.target,l,1);return{from:a,to:u}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let wT=new WeakMap,kT=!1;function f7(t){if(!wT.has(t)&&(wT.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=ji,kT)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),kT=!0}}function ST(t,e){let n=e.startContainer,r=e.startOffset,s=e.endContainer,i=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return nc(o.node,o.offset,s,i)&&([n,r,s,i]=[s,i,n,r]),{anchorNode:n,anchorOffset:r,focusNode:s,focusOffset:i}}function h7(t,e){if(e.getComposedRanges){let s=e.getComposedRanges(t.root)[0];if(s)return ST(t,s)}let n;function r(s){s.preventDefault(),s.stopImmediatePropagation(),n=s.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?ST(t,n):null}function p7(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function m7(t,e,n){let{node:r,fromOffset:s,toOffset:i,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),u,d=l.anchorNode;if(d&&t.dom.contains(d.nodeType==1?d:d.parentNode)&&(u=[{node:d,offset:l.anchorOffset}],Wg(l)||u.push({node:l.focusNode,offset:l.focusOffset})),Fr&&t.input.lastKeyCode===8)for(let b=i;b>s;b--){let g=r.childNodes[b-1],v=g.pmViewDesc;if(g.nodeName=="BR"&&!v){i=b;break}if(!v||v.size)break}let f=t.state.doc,h=t.someProp("domParser")||$a.fromSchema(t.state.schema),p=f.resolve(o),m=null,y=h.parse(r,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:s,to:i,preserveWhitespace:p.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:g7,context:p});if(u&&u[0].pos!=null){let b=u[0].pos,g=u[1]&&u[1].pos;g==null&&(g=b),m={anchor:b+o,head:g+o}}return{doc:y,sel:m,from:o,to:a}}function g7(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(gs&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||gs&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const y7=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function x7(t,e,n,r,s){let i=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let D=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,S=kw(t,D);if(S&&!t.state.selection.eq(S)){if(Fr&&Fo&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",_=>_(t,Sl(13,"Enter"))))return;let T=t.state.tr.setSelection(S);D=="pointer"?T.setMeta("pointer",!0):D=="key"&&T.scrollIntoView(),i&&T.setMeta("composition",i),t.dispatch(T)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l=t.state.selection,u=m7(t,e,n),d=t.state.doc,f=d.slice(u.from,u.to),h,p;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(h=t.state.selection.to,p="end"):(h=t.state.selection.from,p="start"),t.input.lastKeyCode=null;let m=w7(f.content,u.doc.content,u.from,h,p);if(m&&t.input.domChangeCount++,(Nu&&t.input.lastIOSEnter>Date.now()-225||Fo)&&s.some(D=>D.nodeType==1&&!y7.test(D.nodeName))&&(!m||m.endA>=m.endB)&&t.someProp("handleKeyDown",D=>D(t,Sl(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!m)if(r&&l instanceof pn&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))m={start:l.from,endA:l.to,endB:l.to};else{if(u.sel){let D=_T(t,t.state.doc,u.sel);if(D&&!D.eq(t.state.selection)){let S=t.state.tr.setSelection(D);i&&S.setMeta("composition",i),t.dispatch(S)}}return}t.state.selection.from<t.state.selection.to&&m.start==m.endB&&t.state.selection instanceof pn&&(m.start>t.state.selection.from&&m.start<=t.state.selection.from+2&&t.state.selection.from>=u.from?m.start=t.state.selection.from:m.endA<t.state.selection.to&&m.endA>=t.state.selection.to-2&&t.state.selection.to<=u.to&&(m.endB+=t.state.selection.to-m.endA,m.endA=t.state.selection.to)),Hs&&za<=11&&m.endB==m.start+1&&m.endA==m.start&&m.start>u.from&&u.doc.textBetween(m.start-u.from-1,m.start-u.from+1)==" "&&(m.start--,m.endA--,m.endB--);let y=u.doc.resolveNoCache(m.start-u.from),b=u.doc.resolveNoCache(m.endB-u.from),g=d.resolve(m.start),v=y.sameParent(b)&&y.parent.inlineContent&&g.end()>=m.endA;if((Nu&&t.input.lastIOSEnter>Date.now()-225&&(!v||s.some(D=>D.nodeName=="DIV"||D.nodeName=="P"))||!v&&y.pos<u.doc.content.size&&(!y.sameParent(b)||!y.parent.inlineContent)&&y.pos<b.pos&&!/\S/.test(u.doc.textBetween(y.pos,b.pos,"","")))&&t.someProp("handleKeyDown",D=>D(t,Sl(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>m.start&&v7(d,m.start,m.endA,y,b)&&t.someProp("handleKeyDown",D=>D(t,Sl(8,"Backspace")))){Fo&&Fr&&t.domObserver.suppressSelectionUpdates();return}Fr&&m.endB==m.start&&(t.input.lastChromeDelete=Date.now()),Fo&&!v&&y.start()!=b.start()&&b.parentOffset==0&&y.depth==b.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==m.endA&&(m.endB-=2,b=u.doc.resolveNoCache(m.endB-u.from),setTimeout(()=>{t.someProp("handleKeyDown",function(D){return D(t,Sl(13,"Enter"))})},20));let w=m.start,C=m.endA,I=D=>{let S=D||t.state.tr.replace(w,C,u.doc.slice(m.start-u.from,m.endB-u.from));if(u.sel){let T=_T(t,S.doc,u.sel);T&&!(Fr&&t.composing&&T.empty&&(m.start!=m.endB||t.input.lastChromeDelete<Date.now()-100)&&(T.head==w||T.head==S.mapping.map(C)-1)||Hs&&T.empty&&T.head==w)&&S.setSelection(T)}return i&&S.setMeta("composition",i),S.scrollIntoView()},k;if(v)if(y.pos==b.pos){Hs&&za<=11&&y.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>Vo(t),20));let D=I(t.state.tr.delete(w,C)),S=d.resolve(m.start).marksAcross(d.resolve(m.endA));S&&D.ensureMarks(S),t.dispatch(D)}else if(m.endA==m.endB&&(k=b7(y.parent.content.cut(y.parentOffset,b.parentOffset),g.parent.content.cut(g.parentOffset,m.endA-g.start())))){let D=I(t.state.tr);k.type=="add"?D.addMark(w,C,k.mark):D.removeMark(w,C,k.mark),t.dispatch(D)}else if(y.parent.child(y.index()).isText&&y.index()==b.index()-(b.textOffset?0:1)){let D=y.parent.textBetween(y.parentOffset,b.parentOffset),S=()=>I(t.state.tr.insertText(D,w,C));t.someProp("handleTextInput",T=>T(t,w,C,D,S))||t.dispatch(S())}else t.dispatch(I());else t.dispatch(I())}function _T(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:Sw(t,e.resolve(n.anchor),e.resolve(n.head))}function b7(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,s=n,i=r,o,a,l;for(let d=0;d<r.length;d++)s=r[d].removeFromSet(s);for(let d=0;d<n.length;d++)i=n[d].removeFromSet(i);if(s.length==1&&i.length==0)a=s[0],o="add",l=d=>d.mark(a.addToSet(d.marks));else if(s.length==0&&i.length==1)a=i[0],o="remove",l=d=>d.mark(a.removeFromSet(d.marks));else return null;let u=[];for(let d=0;d<e.childCount;d++)u.push(l(e.child(d)));if(Mt.from(u).eq(t))return{mark:a,type:o}}function v7(t,e,n,r,s){if(n-e<=s.pos-r.pos||ky(r,!0,!1)<s.pos)return!1;let i=t.resolve(e);if(!r.parent.isTextblock){let a=i.nodeAfter;return a!=null&&n==e+a.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=t.resolve(ky(i,!0,!0));return!o.parent.isTextblock||o.pos>n||ky(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function ky(t,e,n){let r=t.depth,s=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,s++,e=!1;if(n){let i=t.node(r).maybeChild(t.indexAfter(r));for(;i&&!i.isLeaf;)i=i.firstChild,s++}return s}function w7(t,e,n,r,s){let i=t.findDiffStart(e,n);if(i==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(s=="end"){let l=Math.max(0,i-Math.min(o,a));r-=o+l-i}if(o<i&&t.size<e.size){let l=r<=i&&r>=o?i-r:0;i-=l,i&&i<e.size&&TT(e.textBetween(i-1,i+1))&&(i+=l?1:-1),a=i+(a-o),o=i}else if(a<i){let l=r<=i&&r>=a?i-r:0;i-=l,i&&i<t.size&&TT(t.textBetween(i-1,i+1))&&(i+=l?1:-1),o=i+(o-a),a=i}return{start:i,endA:o,endB:a}}function TT(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class r5{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new $V,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(IT),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=NT(this),ET(this),this.nodeViews=jT(this),this.docView=oT(this.state.doc,CT(this),wy(this),this.dom,this),this.domObserver=new d7(this,(r,s,i,o)=>x7(this,r,s,i,o)),this.domObserver.start(),zV(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&X1(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(IT),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let s=this.state,i=!1,o=!1;e.storedMarks&&this.composing&&(JA(this),o=!0),this.state=e;let a=s.plugins!=e.plugins||this._props.plugins!=n.plugins;if(a||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let p=jT(this);S7(p,this.nodeViews)&&(this.nodeViews=p,i=!0)}(a||n.handleDOMEvents!=this._props.handleDOMEvents)&&X1(this),this.editable=NT(this),ET(this);let l=wy(this),u=CT(this),d=s.plugins!=e.plugins&&!s.doc.eq(e.doc)?"reset":e.scrollToSelection>s.scrollToSelection?"to selection":"preserve",f=i||!this.docView.matchesNode(e.doc,u,l);(f||!e.selection.eq(s.selection))&&(o=!0);let h=d=="preserve"&&o&&this.dom.style.overflowAnchor==null&&Z9(this);if(o){this.domObserver.stop();let p=f&&(Hs||Fr)&&!this.composing&&!s.selection.empty&&!e.selection.empty&&k7(s.selection,e.selection);if(f){let m=Fr?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=ZV(this)),(i||!this.docView.update(e.doc,u,l,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=oT(e.doc,u,l,this.dom,this)),m&&!this.trackWrites&&(p=!0)}p||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&SV(this))?Vo(this,p):($A(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),!((r=this.dragging)===null||r===void 0)&&r.node&&!s.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,s),d=="reset"?this.dom.scrollTop=0:d=="to selection"?this.scrollToSelection():h&&eV(h)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof en){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&eT(this,n.getBoundingClientRect(),e)}else eT(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,s=-1;if(this.state.doc.nodeAt(r.from)==r.node)s=r.from;else{let i=r.from+(this.state.doc.content.size-n.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==r.node&&(s=i)}this.dragging=new QA(e.slice,e.move,s<0?void 0:en.create(this.state.doc,s))}someProp(e,n){let r=this._props&&this._props[e],s;if(r!=null&&(s=n?n(r):r))return s;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(s=n?n(a):a))return s}let i=this.state.plugins;if(i)for(let o=0;o<i.length;o++){let a=i[o].props[e];if(a!=null&&(s=n?n(a):a))return s}}hasFocus(){if(Hs){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&tV(this.dom),Vo(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return oV(this,e)}coordsAtPos(e,n=1){return IA(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let s=this.docView.posFromDOM(e,n,r);if(s==null)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(e,n){return dV(this,n||this.state,e)}pasteHTML(e,n){return Of(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return Of(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return _w(this,e)}destroy(){this.docView&&(FV(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],wy(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,H9())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return UV(this,e)}domSelectionRange(){let e=this.domSelection();return e?gs&&this.root.nodeType===11&&q9(this.dom.ownerDocument)==this.dom&&h7(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}r5.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function CT(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[zs.node(0,t.state.doc.content.size,e)]}function ET(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:zs.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function NT(t){return!t.someProp("editable",e=>e(t.state)===!1)}function k7(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function jT(t){let e=Object.create(null);function n(r){for(let s in r)Object.prototype.hasOwnProperty.call(e,s)||(e[s]=r[s])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function S7(t,e){let n=0,r=0;for(let s in t){if(t[s]!=e[s])return!0;n++}for(let s in e)r++;return n!=r}function IT(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var qa={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Mm={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},_7=typeof navigator<"u"&&/Mac/.test(navigator.platform),T7=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Zr=0;Zr<10;Zr++)qa[48+Zr]=qa[96+Zr]=String(Zr);for(var Zr=1;Zr<=24;Zr++)qa[Zr+111]="F"+Zr;for(var Zr=65;Zr<=90;Zr++)qa[Zr]=String.fromCharCode(Zr+32),Mm[Zr]=String.fromCharCode(Zr);for(var Sy in qa)Mm.hasOwnProperty(Sy)||(Mm[Sy]=qa[Sy]);function C7(t){var e=_7&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||T7&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?Mm:qa)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const E7=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),N7=typeof navigator<"u"&&/Win/.test(navigator.platform);function j7(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,s,i,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))E7?o=!0:s=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),s&&(n="Ctrl-"+n),o&&(n="Meta-"+n),i&&(n="Shift-"+n),n}function I7(t){let e=Object.create(null);for(let n in t)e[j7(n)]=t[n];return e}function _y(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function M7(t){return new jr({props:{handleKeyDown:s5(t)}})}function s5(t){let e=I7(t);return function(n,r){let s=C7(r),i,o=e[_y(s,r)];if(o&&o(n.state,n.dispatch,n))return!0;if(s.length==1&&s!=" "){if(r.shiftKey){let a=e[_y(s,r,!1)];if(a&&a(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(N7&&r.ctrlKey&&r.altKey)&&(i=qa[r.keyCode])&&i!=s){let a=e[_y(i,r)];if(a&&a(n.state,n.dispatch,n))return!0}}return!1}}const D7=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function i5(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const A7=(t,e,n)=>{let r=i5(t,n);if(!r)return!1;let s=Iw(r);if(!s){let o=r.blockRange(),a=o&&Uu(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let i=s.nodeBefore;if(c5(t,s,e,-1))return!0;if(r.parent.content.size==0&&(ju(i,"end")||en.isSelectable(i)))for(let o=r.depth;;o--){let a=Hg(t.doc,r.before(o),r.after(o),Kt.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(ju(i,"end")?mn.findFrom(l.doc.resolve(l.mapping.map(s.pos,-1)),-1):en.create(l.doc,s.pos-i.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos-i.nodeSize,s.pos).scrollIntoView()),!0):!1},R7=(t,e,n)=>{let r=i5(t,n);if(!r)return!1;let s=Iw(r);return s?o5(t,s,e):!1},O7=(t,e,n)=>{let r=a5(t,n);if(!r)return!1;let s=Mw(r);return s?o5(t,s,e):!1};function o5(t,e,n){let r=e.nodeBefore,s=r,i=e.pos-1;for(;!s.isTextblock;i--){if(s.type.spec.isolating)return!1;let d=s.lastChild;if(!d)return!1;s=d}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let d=a.firstChild;if(!d)return!1;a=d}let u=Hg(t.doc,i,l,Kt.empty);if(!u||u.from!=i||u instanceof zr&&u.slice.size>=l-i)return!1;if(n){let d=t.tr.step(u);d.setSelection(pn.create(d.doc,i)),n(d.scrollIntoView())}return!0}function ju(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const P7=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;i=Iw(r)}let o=i&&i.nodeBefore;return!o||!en.isSelectable(o)?!1:(e&&e(t.tr.setSelection(en.create(t.doc,i.pos-o.nodeSize)).scrollIntoView()),!0)};function Iw(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function a5(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const L7=(t,e,n)=>{let r=a5(t,n);if(!r)return!1;let s=Mw(r);if(!s)return!1;let i=s.nodeAfter;if(c5(t,s,e,1))return!0;if(r.parent.content.size==0&&(ju(i,"start")||en.isSelectable(i))){let o=Hg(t.doc,r.before(),r.after(),Kt.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(ju(i,"start")?mn.findFrom(a.doc.resolve(a.mapping.map(s.pos)),1):en.create(a.doc,a.mapping.map(s.pos))),e(a.scrollIntoView())}return!0}}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos,s.pos+i.nodeSize).scrollIntoView()),!0):!1},$7=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;i=Mw(r)}let o=i&&i.nodeAfter;return!o||!en.isSelectable(o)?!1:(e&&e(t.tr.setSelection(en.create(t.doc,i.pos)).scrollIntoView()),!0)};function Mw(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const z7=(t,e)=>{let n=t.selection,r=n instanceof en,s;if(r){if(n.node.isTextblock||!tl(t.doc,n.from))return!1;s=n.from}else if(s=Ug(t.doc,n.from,-1),s==null)return!1;if(e){let i=t.tr.join(s);r&&i.setSelection(en.create(i.doc,s-t.doc.resolve(s).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},F7=(t,e)=>{let n=t.selection,r;if(n instanceof en){if(n.node.isTextblock||!tl(t.doc,n.to))return!1;r=n.to}else if(r=Ug(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},B7=(t,e)=>{let{$from:n,$to:r}=t.selection,s=n.blockRange(r),i=s&&Uu(s);return i==null?!1:(e&&e(t.tr.lift(s,i).scrollIntoView()),!0)},U7=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function l5(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const H7=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let s=n.node(-1),i=n.indexAfter(-1),o=l5(s.contentMatchAt(i));if(!o||!s.canReplaceWith(i,i,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(mn.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},V7=(t,e)=>{let n=t.selection,{$from:r,$to:s}=n;if(n instanceof Ni||r.parent.inlineContent||s.parent.inlineContent)return!1;let i=l5(s.parent.contentMatchAt(s.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let o=(!r.parentOffset&&s.index()<s.parent.childCount?r:s).pos,a=t.tr.insert(o,i.createAndFill());a.setSelection(pn.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},W7=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let i=n.before();if(du(t.doc,i))return e&&e(t.tr.split(i).scrollIntoView()),!0}let r=n.blockRange(),s=r&&Uu(r);return s==null?!1:(e&&e(t.tr.lift(r,s).scrollIntoView()),!0)},K7=(t,e)=>{let{$from:n,to:r}=t.selection,s,i=n.sharedDepth(r);return i==0?!1:(s=n.before(i),e&&e(t.tr.setSelection(en.create(t.doc,s))),!0)};function G7(t,e,n){let r=e.nodeBefore,s=e.nodeAfter,i=e.index();return!r||!s||!r.type.compatibleContent(s.type)?!1:!r.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(s.isTextblock||tl(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function c5(t,e,n,r){let s=e.nodeBefore,i=e.nodeAfter,o,a,l=s.type.spec.isolating||i.type.spec.isolating;if(!l&&G7(t,e,n))return!0;let u=!l&&e.parent.canReplace(e.index(),e.index()+1);if(u&&(o=(a=s.contentMatchAt(s.childCount)).findWrapping(i.type))&&a.matchType(o[0]||i.type).validEnd){if(n){let p=e.pos+i.nodeSize,m=Mt.empty;for(let g=o.length-1;g>=0;g--)m=Mt.from(o[g].create(null,m));m=Mt.from(s.copy(m));let y=t.tr.step(new Ur(e.pos-1,p,e.pos,p,new Kt(m,1,0),o.length,!0)),b=y.doc.resolve(p+2*o.length);b.nodeAfter&&b.nodeAfter.type==s.type&&tl(y.doc,b.pos)&&y.join(b.pos),n(y.scrollIntoView())}return!0}let d=i.type.spec.isolating||r>0&&l?null:mn.findFrom(e,1),f=d&&d.$from.blockRange(d.$to),h=f&&Uu(f);if(h!=null&&h>=e.depth)return n&&n(t.tr.lift(f,h).scrollIntoView()),!0;if(u&&ju(i,"start",!0)&&ju(s,"end")){let p=s,m=[];for(;m.push(p),!p.isTextblock;)p=p.lastChild;let y=i,b=1;for(;!y.isTextblock;y=y.firstChild)b++;if(p.canReplace(p.childCount,p.childCount,y.content)){if(n){let g=Mt.empty;for(let w=m.length-1;w>=0;w--)g=Mt.from(m[w].copy(g));let v=t.tr.step(new Ur(e.pos-m.length,e.pos+i.nodeSize,e.pos+b,e.pos+i.nodeSize-b,new Kt(g,m.length,0),0,!0));n(v.scrollIntoView())}return!0}}return!1}function u5(t){return function(e,n){let r=e.selection,s=t<0?r.$from:r.$to,i=s.depth;for(;s.node(i).isInline;){if(!i)return!1;i--}return s.node(i).isTextblock?(n&&n(e.tr.setSelection(pn.create(e.doc,t<0?s.start(i):s.end(i)))),!0):!1}}const q7=u5(-1),Y7=u5(1);function J7(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,o=s.blockRange(i),a=o&&bw(o,t,e);return a?(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function MT(t,e=null){return function(n,r){let s=!1;for(let i=0;i<n.selection.ranges.length&&!s;i++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[i];n.doc.nodesBetween(o,a,(l,u)=>{if(s)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)s=!0;else{let d=n.doc.resolve(u),f=d.index();s=d.parent.canReplaceWith(f,f+1,t)}})}if(!s)return!1;if(r){let i=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[o];i.setBlockType(a,l,t,e)}r(i.scrollIntoView())}return!0}}typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function X7(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,o=s.blockRange(i);if(!o)return!1;let a=r?n.tr:null;return Q7(a,o,t,e)?(r&&r(a.scrollIntoView()),!0):!1}}function Q7(t,e,n,r=null){let s=!1,i=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);i=new _m(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new _m(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),s=!0}let a=bw(i,n,r,e);return a?(t&&Z7(t,e,a,s,n),!0):!1}function Z7(t,e,n,r,s){let i=Mt.empty;for(let d=n.length-1;d>=0;d--)i=Mt.from(n[d].type.create(n[d].attrs,i));t.step(new Ur(e.start-(r?2:0),e.end,e.start,e.end,new Kt(i,0,0),n.length,!0));let o=0;for(let d=0;d<n.length;d++)n[d].type==s&&(o=d+1);let a=n.length-o,l=e.start+n.length-(r?2:0),u=e.parent;for(let d=e.startIndex,f=e.endIndex,h=!0;d<f;d++,h=!1)!h&&du(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=u.child(d).nodeSize;return t}function eW(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,o=>o.childCount>0&&o.firstChild.type==t);return i?n?r.node(i.depth-1).type==t?tW(e,n,t,i):nW(e,n,i):!0:!1}}function tW(t,e,n,r){let s=t.tr,i=r.end,o=r.$to.end(r.depth);i<o&&(s.step(new Ur(i-1,o,i,o,new Kt(Mt.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new _m(s.doc.resolve(r.$from.pos),s.doc.resolve(o),r.depth));const a=Uu(r);if(a==null)return!1;s.lift(r,a);let l=s.doc.resolve(s.mapping.map(i,-1)-1);return tl(s.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&s.join(l.pos),e(s.scrollIntoView()),!0}function nW(t,e,n){let r=t.tr,s=n.parent;for(let p=n.end,m=n.endIndex-1,y=n.startIndex;m>y;m--)p-=s.child(m).nodeSize,r.delete(p-1,p+1);let i=r.doc.resolve(n.start),o=i.nodeAfter;if(r.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==s.childCount,u=i.node(-1),d=i.index(-1);if(!u.canReplace(d+(a?0:1),d+1,o.content.append(l?Mt.empty:Mt.from(s))))return!1;let f=i.pos,h=f+o.nodeSize;return r.step(new Ur(f-(a?1:0),h+(l?1:0),f+1,h-1,new Kt((a?Mt.empty:Mt.from(s.copy(Mt.empty))).append(l?Mt.empty:Mt.from(s.copy(Mt.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function rW(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,u=>u.childCount>0&&u.firstChild.type==t);if(!i)return!1;let o=i.startIndex;if(o==0)return!1;let a=i.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let u=l.lastChild&&l.lastChild.type==a.type,d=Mt.from(u?t.create():null),f=new Kt(Mt.from(t.create(null,Mt.from(a.type.create(null,d)))),u?3:1,0),h=i.start,p=i.end;n(e.tr.step(new Ur(h-(u?3:1),p,h,p,f,1,!0)).scrollIntoView())}return!0}}function qg(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:s}=n,{storedMarks:i}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return r},get doc(){return s},get tr(){return r=n.selection,s=n.doc,i=n.storedMarks,n}}}class Yg{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:r}=this,{view:s}=n,{tr:i}=r,o=this.buildProps(i);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...d)=>{const f=l(...d)(o);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(i),f}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,a=[],l=!!e,u=e||i.tr,d=()=>(!l&&n&&!u.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(u),a.every(h=>h===!0)),f={...Object.fromEntries(Object.entries(r).map(([h,p])=>[h,(...y)=>{const b=this.buildProps(u,n),g=p(...y)(b);return a.push(g),f}])),run:d};return f}createCan(e){const{rawCommands:n,state:r}=this,s=!1,i=e||r.tr,o=this.buildProps(i,s);return{...Object.fromEntries(Object.entries(n).map(([l,u])=>[l,(...d)=>u(...d)({...o,dispatch:void 0})])),chain:()=>this.createChain(i,s)}}buildProps(e,n=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,a={tr:e,editor:s,view:o,state:qg({state:i,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e,n),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([l,u])=>[l,(...d)=>u(...d)(a)]))}};return a}}class sW{constructor(){this.callbacks={}}on(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),this}emit(e,...n){const r=this.callbacks[e];return r&&r.forEach(s=>s.apply(this,n)),this}off(e,n){const r=this.callbacks[e];return r&&(n?this.callbacks[e]=r.filter(s=>s!==n):delete this.callbacks[e]),this}once(e,n){const r=(...s)=>{this.off(e,r),n.apply(this,s)};return this.on(e,r)}removeAllListeners(){this.callbacks={}}}function Yt(t,e,n){return t.config[e]===void 0&&t.parent?Yt(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?Yt(t.parent,e,n):null}):t.config[e]}function Jg(t){const e=t.filter(s=>s.type==="extension"),n=t.filter(s=>s.type==="node"),r=t.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function d5(t){const e=[],{nodeExtensions:n,markExtensions:r}=Jg(t),s=[...n,...r],i={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:s},l=Yt(o,"addGlobalAttributes",a);if(!l)return;l().forEach(d=>{d.types.forEach(f=>{Object.entries(d.attributes).forEach(([h,p])=>{e.push({type:f,name:h,attribute:{...i,...p}})})})})}),s.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=Yt(o,"addAttributes",a);if(!l)return;const u=l();Object.entries(u).forEach(([d,f])=>{const h={...i,...f};typeof(h==null?void 0:h.default)=="function"&&(h.default=h.default()),h!=null&&h.isRequired&&(h==null?void 0:h.default)===void 0&&delete h.default,e.push({type:o.name,name:d,attribute:h})})}),e}function Vr(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function In(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([s,i])=>{if(!r[s]){r[s]=i;return}if(s==="class"){const a=i?String(i).split(" "):[],l=r[s]?r[s].split(" "):[],u=a.filter(d=>!l.includes(d));r[s]=[...l,...u].join(" ")}else if(s==="style"){const a=i?i.split(";").map(d=>d.trim()).filter(Boolean):[],l=r[s]?r[s].split(";").map(d=>d.trim()).filter(Boolean):[],u=new Map;l.forEach(d=>{const[f,h]=d.split(":").map(p=>p.trim());u.set(f,h)}),a.forEach(d=>{const[f,h]=d.split(":").map(p=>p.trim());u.set(f,h)}),r[s]=Array.from(u.entries()).map(([d,f])=>`${d}: ${f}`).join("; ")}else r[s]=i}),r},{})}function Q1(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>In(n,r),{})}function f5(t){return typeof t=="function"}function wn(t,e=void 0,...n){return f5(t)?e?t.bind(e)(...n):t(...n):t}function iW(t={}){return Object.keys(t).length===0&&t.constructor===Object}function oW(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function DT(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const s=e.reduce((i,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):oW(n.getAttribute(o.name));return a==null?i:{...i,[o.name]:a}},{});return{...r,...s}}}}function AT(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&iW(n)?!1:n!=null))}function aW(t,e){var n;const r=d5(t),{nodeExtensions:s,markExtensions:i}=Jg(t),o=(n=s.find(u=>Yt(u,"topNode")))===null||n===void 0?void 0:n.name,a=Object.fromEntries(s.map(u=>{const d=r.filter(g=>g.type===u.name),f={name:u.name,options:u.options,storage:u.storage,editor:e},h=t.reduce((g,v)=>{const w=Yt(v,"extendNodeSchema",f);return{...g,...w?w(u):{}}},{}),p=AT({...h,content:wn(Yt(u,"content",f)),marks:wn(Yt(u,"marks",f)),group:wn(Yt(u,"group",f)),inline:wn(Yt(u,"inline",f)),atom:wn(Yt(u,"atom",f)),selectable:wn(Yt(u,"selectable",f)),draggable:wn(Yt(u,"draggable",f)),code:wn(Yt(u,"code",f)),whitespace:wn(Yt(u,"whitespace",f)),linebreakReplacement:wn(Yt(u,"linebreakReplacement",f)),defining:wn(Yt(u,"defining",f)),isolating:wn(Yt(u,"isolating",f)),attrs:Object.fromEntries(d.map(g=>{var v;return[g.name,{default:(v=g==null?void 0:g.attribute)===null||v===void 0?void 0:v.default}]}))}),m=wn(Yt(u,"parseHTML",f));m&&(p.parseDOM=m.map(g=>DT(g,d)));const y=Yt(u,"renderHTML",f);y&&(p.toDOM=g=>y({node:g,HTMLAttributes:Q1(g,d)}));const b=Yt(u,"renderText",f);return b&&(p.toText=b),[u.name,p]})),l=Object.fromEntries(i.map(u=>{const d=r.filter(b=>b.type===u.name),f={name:u.name,options:u.options,storage:u.storage,editor:e},h=t.reduce((b,g)=>{const v=Yt(g,"extendMarkSchema",f);return{...b,...v?v(u):{}}},{}),p=AT({...h,inclusive:wn(Yt(u,"inclusive",f)),excludes:wn(Yt(u,"excludes",f)),group:wn(Yt(u,"group",f)),spanning:wn(Yt(u,"spanning",f)),code:wn(Yt(u,"code",f)),attrs:Object.fromEntries(d.map(b=>{var g;return[b.name,{default:(g=b==null?void 0:b.attribute)===null||g===void 0?void 0:g.default}]}))}),m=wn(Yt(u,"parseHTML",f));m&&(p.parseDOM=m.map(b=>DT(b,d)));const y=Yt(u,"renderHTML",f);return y&&(p.toDOM=b=>y({mark:b,HTMLAttributes:Q1(b,d)})),[u.name,p]}));return new sA({topNode:o,nodes:a,marks:l})}function Ty(t,e){return e.nodes[t]||e.marks[t]||null}function RT(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function Dw(t,e){const n=lc.fromSchema(e).serializeFragment(t),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(n),s.innerHTML}const lW=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(s,i,o,a)=>{var l,u;const d=((u=(l=s.type.spec).toText)===null||u===void 0?void 0:u.call(l,{node:s,pos:i,parent:o,index:a}))||s.textContent||"%leaf%";n+=s.isAtom&&!s.isText?d:d.slice(0,Math.max(0,r-i))}),n};function Aw(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class Xg{constructor(e){this.find=e.find,this.handler=e.handler}}const cW=(t,e)=>{if(Aw(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function Uh(t){var e;const{editor:n,from:r,to:s,text:i,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const u=l.state.doc.resolve(r);if(u.parent.type.spec.code||!((e=u.nodeBefore||u.nodeAfter)===null||e===void 0)&&e.marks.find(h=>h.type.spec.code))return!1;let d=!1;const f=lW(u)+i;return o.forEach(h=>{if(d)return;const p=cW(f,h.find);if(!p)return;const m=l.state.tr,y=qg({state:l.state,transaction:m}),b={from:r-(p[0].length-i.length),to:s},{commands:g,chain:v,can:w}=new Yg({editor:n,state:y});h.handler({state:y,range:b,match:p,commands:g,chain:v,can:w})===null||!m.steps.length||(m.setMeta(a,{transform:m,from:r,to:s,text:i}),l.dispatch(m),d=!0)}),d}function uW(t){const{editor:e,rules:n}=t,r=new jr({state:{init(){return null},apply(s,i,o){const a=s.getMeta(r);if(a)return a;const l=s.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:d}=l;typeof d=="string"?d=d:d=Dw(Mt.from(d),o.schema);const{from:f}=l,h=f+d.length;Uh({editor:e,from:f,to:h,text:d,rules:n,plugin:r})}),s.selectionSet||s.docChanged?null:i}},props:{handleTextInput(s,i,o,a){return Uh({editor:e,from:i,to:o,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:i}=s.state.selection;i&&Uh({editor:e,from:i.pos,to:i.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(s,i){if(i.key!=="Enter")return!1;const{$cursor:o}=s.state.selection;return o?Uh({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function dW(t){return Object.prototype.toString.call(t).slice(8,-1)}function Hh(t){return dW(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function Qg(t,e){const n={...t};return Hh(t)&&Hh(e)&&Object.keys(e).forEach(r=>{Hh(e[r])&&Hh(t[r])?n[r]=Qg(t[r],e[r]):n[r]=e[r]}),n}class oi{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=wn(Yt(this,"addOptions",{name:this.name}))),this.storage=wn(Yt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new oi(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>Qg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new oi(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=wn(Yt(n,"addOptions",{name:n.name})),n.storage=wn(Yt(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const o=s.marks();if(!!!o.find(u=>(u==null?void 0:u.type.name)===n.name))return!1;const l=o.find(u=>(u==null?void 0:u.type.name)===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",s.pos),e.view.dispatch(r),!0}return!1}}function fW(t){return typeof t=="number"}class hW{constructor(e){this.find=e.find,this.handler=e.handler}}const pW=(t,e,n)=>{if(Aw(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(s=>{const i=[s.text];return i.index=s.index,i.input=t,i.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(s.replaceWith)),i}):[]};function mW(t){const{editor:e,state:n,from:r,to:s,rule:i,pasteEvent:o,dropEvent:a}=t,{commands:l,chain:u,can:d}=new Yg({editor:e,state:n}),f=[];return n.doc.nodesBetween(r,s,(p,m)=>{if(!p.isTextblock||p.type.spec.code)return;const y=Math.max(r,m),b=Math.min(s,m+p.content.size),g=p.textBetween(y-m,b-m,void 0,"");pW(g,i.find,o).forEach(w=>{if(w.index===void 0)return;const C=y+w.index+1,I=C+w[0].length,k={from:n.tr.mapping.map(C),to:n.tr.mapping.map(I)},D=i.handler({state:n,range:k,match:w,commands:l,chain:u,can:d,pasteEvent:o,dropEvent:a});f.push(D)})}),f.every(p=>p!==null)}let Vh=null;const gW=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)===null||e===void 0||e.setData("text/html",t),n};function yW(t){const{editor:e,rules:n}=t;let r=null,s=!1,i=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:d,from:f,to:h,rule:p,pasteEvt:m})=>{const y=d.tr,b=qg({state:d,transaction:y});if(!(!mW({editor:e,state:b,from:Math.max(f-1,0),to:h.b-1,rule:p,pasteEvent:m,dropEvent:a})||!y.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,y}};return n.map(d=>new jr({view(f){const h=m=>{var y;r=!((y=f.dom.parentElement)===null||y===void 0)&&y.contains(m.target)?f.dom.parentElement:null,r&&(Vh=e)},p=()=>{Vh&&(Vh=null)};return window.addEventListener("dragstart",h),window.addEventListener("dragend",p),{destroy(){window.removeEventListener("dragstart",h),window.removeEventListener("dragend",p)}}},props:{handleDOMEvents:{drop:(f,h)=>{if(i=r===f.dom.parentElement,a=h,!i){const p=Vh;p!=null&&p.isEditable&&setTimeout(()=>{const m=p.state.selection;m&&p.commands.deleteRange({from:m.from,to:m.to})},10)}return!1},paste:(f,h)=>{var p;const m=(p=h.clipboardData)===null||p===void 0?void 0:p.getData("text/html");return o=h,s=!!(m!=null&&m.includes("data-pm-slice")),!1}}},appendTransaction:(f,h,p)=>{const m=f[0],y=m.getMeta("uiEvent")==="paste"&&!s,b=m.getMeta("uiEvent")==="drop"&&!i,g=m.getMeta("applyPasteRules"),v=!!g;if(!y&&!b&&!v)return;if(v){let{text:I}=g;typeof I=="string"?I=I:I=Dw(Mt.from(I),p.schema);const{from:k}=g,D=k+I.length,S=gW(I);return l({rule:d,state:p,from:k,to:{b:D},pasteEvt:S})}const w=h.doc.content.findDiffStart(p.doc.content),C=h.doc.content.findDiffEnd(p.doc.content);if(!(!fW(w)||!C||w===C.b))return l({rule:d,state:p,from:w,to:C,pasteEvt:o})}}))}function xW(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}class Zc{constructor(e,n){this.splittableMarks=[],this.editor=n,this.extensions=Zc.resolve(e),this.schema=aW(this.extensions,n),this.setupExtensions()}static resolve(e){const n=Zc.sort(Zc.flatten(e)),r=xW(n.map(s=>s.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(s=>`'${s}'`).join(", ")}]. This can lead to issues.`),n}static flatten(e){return e.map(n=>{const r={name:n.name,options:n.options,storage:n.storage},s=Yt(n,"addExtensions",r);return s?[n,...this.flatten(s())]:n}).flat(10)}static sort(e){return e.sort((r,s)=>{const i=Yt(r,"priority")||100,o=Yt(s,"priority")||100;return i>o?-1:i<o?1:0})}get commands(){return this.extensions.reduce((e,n)=>{const r={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:Ty(n.name,this.schema)},s=Yt(n,"addCommands",r);return s?{...e,...s()}:e},{})}get plugins(){const{editor:e}=this,n=Zc.sort([...this.extensions].reverse()),r=[],s=[],i=n.map(o=>{const a={name:o.name,options:o.options,storage:o.storage,editor:e,type:Ty(o.name,this.schema)},l=[],u=Yt(o,"addKeyboardShortcuts",a);let d={};if(o.type==="mark"&&Yt(o,"exitable",a)&&(d.ArrowRight=()=>oi.handleExit({editor:e,mark:o})),u){const y=Object.fromEntries(Object.entries(u()).map(([b,g])=>[b,()=>g({editor:e})]));d={...d,...y}}const f=M7(d);l.push(f);const h=Yt(o,"addInputRules",a);RT(o,e.options.enableInputRules)&&h&&r.push(...h());const p=Yt(o,"addPasteRules",a);RT(o,e.options.enablePasteRules)&&p&&s.push(...p());const m=Yt(o,"addProseMirrorPlugins",a);if(m){const y=m();l.push(...y)}return l}).flat();return[uW({editor:e,rules:r}),...yW({editor:e,rules:s}),...i]}get attributes(){return d5(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:n}=Jg(this.extensions);return Object.fromEntries(n.filter(r=>!!Yt(r,"addNodeView")).map(r=>{const s=this.attributes.filter(l=>l.type===r.name),i={name:r.name,options:r.options,storage:r.storage,editor:e,type:Vr(r.name,this.schema)},o=Yt(r,"addNodeView",i);if(!o)return[];const a=(l,u,d,f,h)=>{const p=Q1(l,s);return o()({node:l,view:u,getPos:d,decorations:f,innerDecorations:h,editor:e,extension:r,HTMLAttributes:p})};return[r.name,a]}))}setupExtensions(){this.extensions.forEach(e=>{var n;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:Ty(e.name,this.schema)};e.type==="mark"&&(!((n=wn(Yt(e,"keepOnSplit",r)))!==null&&n!==void 0)||n)&&this.splittableMarks.push(e.name);const s=Yt(e,"onBeforeCreate",r),i=Yt(e,"onCreate",r),o=Yt(e,"onUpdate",r),a=Yt(e,"onSelectionUpdate",r),l=Yt(e,"onTransaction",r),u=Yt(e,"onFocus",r),d=Yt(e,"onBlur",r),f=Yt(e,"onDestroy",r);s&&this.editor.on("beforeCreate",s),i&&this.editor.on("create",i),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),u&&this.editor.on("focus",u),d&&this.editor.on("blur",d),f&&this.editor.on("destroy",f)})}}class Wr{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=wn(Yt(this,"addOptions",{name:this.name}))),this.storage=wn(Yt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Wr(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>Qg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new Wr({...this.config,...e});return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=wn(Yt(n,"addOptions",{name:n.name})),n.storage=wn(Yt(n,"addStorage",{name:n.name,options:n.options})),n}}function h5(t,e,n){const{from:r,to:s}=e,{blockSeparator:i=`

`,textSerializers:o={}}=n||{};let a="";return t.nodesBetween(r,s,(l,u,d,f)=>{var h;l.isBlock&&u>r&&(a+=i);const p=o==null?void 0:o[l.type.name];if(p)return d&&(a+=p({node:l,pos:u,parent:d,index:f,range:e})),!1;l.isText&&(a+=(h=l==null?void 0:l.text)===null||h===void 0?void 0:h.slice(Math.max(r,u)-u,s-u))}),a}function p5(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}const bW=Wr.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new jr({key:new ss("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:s}=e,{ranges:i}=s,o=Math.min(...i.map(d=>d.$from.pos)),a=Math.max(...i.map(d=>d.$to.pos)),l=p5(n);return h5(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),vW=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window==null?void 0:window.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),wW=(t=!1)=>({commands:e})=>e.setContent("",t),kW=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:s}=r;return n&&s.forEach(({$from:i,$to:o})=>{t.doc.nodesBetween(i.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:u,mapping:d}=e,f=u.resolve(d.map(l)),h=u.resolve(d.map(l+a.nodeSize)),p=f.blockRange(h);if(!p)return;const m=Uu(p);if(a.type.isTextblock){const{defaultType:y}=f.parent.contentMatchAt(f.index());e.setNodeMarkup(p.start,y)}(m||m===0)&&e.lift(p,m)})}),!0},SW=t=>e=>t(e),_W=()=>({state:t,dispatch:e})=>V7(t,e),TW=(t,e)=>({editor:n,tr:r})=>{const{state:s}=n,i=s.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const o=r.mapping.map(e);return r.insert(o,i.content),r.setSelection(new pn(r.doc.resolve(Math.max(o-1,0)))),!0},CW=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const s=t.selection.$anchor;for(let i=s.depth;i>0;i-=1)if(s.node(i).type===r.type){if(e){const a=s.before(i),l=s.after(i);t.delete(a,l).scrollIntoView()}return!0}return!1},EW=t=>({tr:e,state:n,dispatch:r})=>{const s=Vr(t,n.schema),i=e.selection.$anchor;for(let o=i.depth;o>0;o-=1)if(i.node(o).type===s){if(r){const l=i.before(o),u=i.after(o);e.delete(l,u).scrollIntoView()}return!0}return!1},NW=t=>({tr:e,dispatch:n})=>{const{from:r,to:s}=t;return n&&e.delete(r,s),!0},jW=()=>({state:t,dispatch:e})=>D7(t,e),IW=()=>({commands:t})=>t.keyboardShortcut("Enter"),MW=()=>({state:t,dispatch:e})=>H7(t,e);function Dm(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(s=>n.strict?e[s]===t[s]:Aw(e[s])?e[s].test(t[s]):e[s]===t[s]):!0}function m5(t,e,n={}){return t.find(r=>r.type===e&&Dm(Object.fromEntries(Object.keys(n).map(s=>[s,r.attrs[s]])),n))}function OT(t,e,n={}){return!!m5(t,e,n)}function Rw(t,e,n){var r;if(!t||!e)return;let s=t.parent.childAfter(t.parentOffset);if((!s.node||!s.node.marks.some(d=>d.type===e))&&(s=t.parent.childBefore(t.parentOffset)),!s.node||!s.node.marks.some(d=>d.type===e)||(n=n||((r=s.node.marks[0])===null||r===void 0?void 0:r.attrs),!m5([...s.node.marks],e,n)))return;let o=s.index,a=t.start()+s.offset,l=o+1,u=a+s.node.nodeSize;for(;o>0&&OT([...t.parent.child(o-1).marks],e,n);)o-=1,a-=t.parent.child(o).nodeSize;for(;l<t.parent.childCount&&OT([...t.parent.child(l).marks],e,n);)u+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:u}}function rl(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const DW=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const i=rl(t,r.schema),{doc:o,selection:a}=n,{$from:l,from:u,to:d}=a;if(s){const f=Rw(l,i,e);if(f&&f.from<=u&&f.to>=d){const h=pn.create(o,f.from,f.to);n.setSelection(h)}}return!0},AW=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function g5(t){return t instanceof pn}function Pl(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function y5(t,e=null){if(!e)return null;const n=mn.atStart(t),r=mn.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const s=n.from,i=r.to;return e==="all"?pn.create(t,Pl(0,s,i),Pl(t.content.size,s,i)):pn.create(t,Pl(e,s,i),Pl(e,s,i))}function x5(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Zg(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const RW=(t=null,e={})=>({editor:n,view:r,tr:s,dispatch:i})=>{e={scrollIntoView:!0,...e};const o=()=>{(Zg()||x5())&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e!=null&&e.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(i&&t===null&&!g5(n.state.selection))return o(),!0;const a=y5(s.doc,t)||n.state.selection,l=n.state.selection.eq(a);return i&&(l||s.setSelection(a),l&&s.storedMarks&&s.setStoredMarks(s.storedMarks),o()),!0},OW=(t,e)=>n=>t.every((r,s)=>e(r,{...n,index:s})),PW=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),b5=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&b5(r)}return t};function Wh(t){const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return b5(n)}function Lf(t,e,n){if(t instanceof Ho||t instanceof Mt)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,s=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return Mt.fromArray(t.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(i){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",i),Lf("",e,n)}if(s){if(n.errorOnInvalidContent){let o=!1,a="";const l=new sA({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(o=!0,a=typeof u=="string"?u:u.outerHTML,null)}]}})});if(n.slice?$a.fromSchema(l).parseSlice(Wh(t),n.parseOptions):$a.fromSchema(l).parse(Wh(t),n.parseOptions),n.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const i=$a.fromSchema(e);return n.slice?i.parseSlice(Wh(t),n.parseOptions).content:i.parse(Wh(t),n.parseOptions)}return Lf("",e,n)}function LW(t,e,n){const r=t.steps.length-1;if(r<e)return;const s=t.steps[r];if(!(s instanceof zr||s instanceof Ur))return;const i=t.mapping.maps[r];let o=0;i.forEach((a,l,u,d)=>{o===0&&(o=d)}),t.setSelection(mn.near(t.doc.resolve(o),n))}const $W=t=>!("type"in t),zW=(t,e,n)=>({tr:r,dispatch:s,editor:i})=>{var o;if(s){n={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=b=>{i.emit("contentError",{editor:i,error:b,disableCollaboration:()=>{i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{Lf(e,i.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(b){l(b)}try{a=Lf(e,i.schema,{parseOptions:u,errorOnInvalidContent:(o=n.errorOnInvalidContent)!==null&&o!==void 0?o:i.options.enableContentCheck})}catch(b){return l(b),!1}let{from:d,to:f}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},h=!0,p=!0;if(($W(a)?a:[a]).forEach(b=>{b.check(),h=h?b.isText&&b.marks.length===0:!1,p=p?b.isBlock:!1}),d===f&&p){const{parent:b}=r.doc.resolve(d);b.isTextblock&&!b.type.spec.code&&!b.childCount&&(d-=1,f+=1)}let y;if(h){if(Array.isArray(e))y=e.map(b=>b.text||"").join("");else if(e instanceof Mt){let b="";e.forEach(g=>{g.text&&(b+=g.text)}),y=b}else typeof e=="object"&&e&&e.text?y=e.text:y=e;r.insertText(y,d,f)}else y=a,r.replaceWith(d,f,y);n.updateSelection&&LW(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:d,text:y}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:d,text:y})}return!0},FW=()=>({state:t,dispatch:e})=>z7(t,e),BW=()=>({state:t,dispatch:e})=>F7(t,e),UW=()=>({state:t,dispatch:e})=>A7(t,e),HW=()=>({state:t,dispatch:e})=>L7(t,e),VW=()=>({state:t,dispatch:e,tr:n})=>{try{const r=Ug(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},WW=()=>({state:t,dispatch:e,tr:n})=>{try{const r=Ug(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},KW=()=>({state:t,dispatch:e})=>R7(t,e),GW=()=>({state:t,dispatch:e})=>O7(t,e);function v5(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function qW(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,s,i,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))Zg()||v5()?o=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),s&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),i&&(n=`Shift-${n}`),n}const YW=t=>({editor:e,view:n,tr:r,dispatch:s})=>{const i=qW(t).split(/-(?!$)/),o=i.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",u=>u(n,a))});return l==null||l.steps.forEach(u=>{const d=u.map(r.mapping);d&&s&&r.maybeStep(d)}),!0};function $f(t,e,n={}){const{from:r,to:s,empty:i}=t.selection,o=e?Vr(e,t.schema):null,a=[];t.doc.nodesBetween(r,s,(f,h)=>{if(f.isText)return;const p=Math.max(r,h),m=Math.min(s,h+f.nodeSize);a.push({node:f,from:p,to:m})});const l=s-r,u=a.filter(f=>o?o.name===f.node.type.name:!0).filter(f=>Dm(f.node.attrs,n,{strict:!1}));return i?!!u.length:u.reduce((f,h)=>f+h.to-h.from,0)>=l}const JW=(t,e={})=>({state:n,dispatch:r})=>{const s=Vr(t,n.schema);return $f(n,s,e)?B7(n,r):!1},XW=()=>({state:t,dispatch:e})=>W7(t,e),QW=t=>({state:e,dispatch:n})=>{const r=Vr(t,e.schema);return eW(r)(e,n)},ZW=()=>({state:t,dispatch:e})=>U7(t,e);function e0(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function PT(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,s)=>(n.includes(s)||(r[s]=t[s]),r),{})}const eK=(t,e)=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=e0(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(i=Vr(t,r.schema)),a==="mark"&&(o=rl(t,r.schema)),s&&n.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(u,d)=>{i&&i===u.type&&n.setNodeMarkup(d,void 0,PT(u.attrs,e)),o&&u.marks.length&&u.marks.forEach(f=>{o===f.type&&n.addMark(d,d+u.nodeSize,o.create(PT(f.attrs,e)))})})}),!0):!1},tK=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),nK=()=>({tr:t,dispatch:e})=>{if(e){const n=new Ni(t.doc);t.setSelection(n)}return!0},rK=()=>({state:t,dispatch:e})=>P7(t,e),sK=()=>({state:t,dispatch:e})=>$7(t,e),iK=()=>({state:t,dispatch:e})=>K7(t,e),oK=()=>({state:t,dispatch:e})=>Y7(t,e),aK=()=>({state:t,dispatch:e})=>q7(t,e);function Z1(t,e,n={},r={}){return Lf(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}const lK=(t,e=!1,n={},r={})=>({editor:s,tr:i,dispatch:o,commands:a})=>{var l,u;const{doc:d}=i;if(n.preserveWhitespace!=="full"){const f=Z1(t,s.schema,n,{errorOnInvalidContent:(l=r.errorOnInvalidContent)!==null&&l!==void 0?l:s.options.enableContentCheck});return o&&i.replaceWith(0,d.content.size,f).setMeta("preventUpdate",!e),!0}return o&&i.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:d.content.size},t,{parseOptions:n,errorOnInvalidContent:(u=r.errorOnInvalidContent)!==null&&u!==void 0?u:s.options.enableContentCheck})};function w5(t,e){const n=rl(e,t.schema),{from:r,to:s,empty:i}=t.selection,o=[];i?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,s,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function cK(t,e){const n=new vA(t);return e.forEach(r=>{r.steps.forEach(s=>{n.step(s)})}),n}function Ow(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function Np(t,e){const n=[];return t.descendants((r,s)=>{e(r)&&n.push({node:r,pos:s})}),n}function uK(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(s,i)=>{n(s)&&r.push({node:s,pos:i})}),r}function dK(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function Hu(t){return e=>dK(e.$from,t)}function fK(t,e){const n={from:0,to:t.content.size};return h5(t,n,e)}function hK(t,e){const n=Vr(e,t.schema),{from:r,to:s}=t.selection,i=[];t.doc.nodesBetween(r,s,a=>{i.push(a)});const o=i.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function k5(t,e){const n=e0(typeof e=="string"?e:e.name,t.schema);return n==="node"?hK(t,e):n==="mark"?w5(t,e):{}}function pK(t,e=JSON.stringify){const n={};return t.filter(r=>{const s=e(r);return Object.prototype.hasOwnProperty.call(n,s)?!1:n[s]=!0})}function mK(t){const e=pK(t);return e.length===1?e:e.filter((n,r)=>!e.filter((i,o)=>o!==r).some(i=>n.oldRange.from>=i.oldRange.from&&n.oldRange.to<=i.oldRange.to&&n.newRange.from>=i.newRange.from&&n.newRange.to<=i.newRange.to))}function gK(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((s,i)=>{const o=[];if(s.ranges.length)s.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=n[i];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const u=e.slice(i).map(a,-1),d=e.slice(i).map(l),f=e.invert().map(u,-1),h=e.invert().map(d);r.push({oldRange:{from:f,to:h},newRange:{from:u,to:d}})})}),mK(r)}function Pw(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(s=>{const i=n.resolve(t),o=Rw(i,s.type);o&&r.push({mark:s,...o})}):n.nodesBetween(t,e,(s,i)=>{!s||(s==null?void 0:s.nodeSize)===void 0||r.push(...s.marks.map(o=>({from:i,to:i+s.nodeSize,mark:o})))}),r}function jp(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const s=t.find(i=>i.type===e&&i.name===r);return s?s.attribute.keepOnSplit:!1}))}function eb(t,e,n={}){const{empty:r,ranges:s}=t.selection,i=e?rl(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(f=>i?i.name===f.type.name:!0).find(f=>Dm(f.attrs,n,{strict:!1}));let o=0;const a=[];if(s.forEach(({$from:f,$to:h})=>{const p=f.pos,m=h.pos;t.doc.nodesBetween(p,m,(y,b)=>{if(!y.isText&&!y.marks.length)return;const g=Math.max(p,b),v=Math.min(m,b+y.nodeSize),w=v-g;o+=w,a.push(...y.marks.map(C=>({mark:C,from:g,to:v})))})}),o===0)return!1;const l=a.filter(f=>i?i.name===f.mark.type.name:!0).filter(f=>Dm(f.mark.attrs,n,{strict:!1})).reduce((f,h)=>f+h.to-h.from,0),u=a.filter(f=>i?f.mark.type!==i&&f.mark.type.excludes(i):!0).reduce((f,h)=>f+h.to-h.from,0);return(l>0?l+u:l)>=o}function S5(t,e,n={}){if(!e)return $f(t,null,n)||eb(t,null,n);const r=e0(e,t.schema);return r==="node"?$f(t,e,n):r==="mark"?eb(t,e,n):!1}function LT(t,e){const{nodeExtensions:n}=Jg(e),r=n.find(o=>o.name===t);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},i=wn(Yt(r,"group",s));return typeof i!="string"?!1:i.split(" ").includes("list")}function Lw(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!==null&&r!==void 0?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let s=!0;return t.content.forEach(i=>{s!==!1&&(Lw(i,{ignoreWhitespace:n,checkChildren:e})||(s=!1))}),s}return!1}function yK(t){return t instanceof en}function xK(t,e,n){var r;const{selection:s}=e;let i=null;if(g5(s)&&(i=s.$cursor),i){const a=(r=t.storedMarks)!==null&&r!==void 0?r:i.marks();return!!n.isInSet(a)||!a.some(l=>l.type.excludes(n))}const{ranges:o}=s;return o.some(({$from:a,$to:l})=>{let u=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(d,f,h)=>{if(u)return!1;if(d.isInline){const p=!h||h.type.allowsMarkType(n),m=!!n.isInSet(d.marks)||!d.marks.some(y=>y.type.excludes(n));u=p&&m}return!u}),u})}const bK=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const{selection:i}=n,{empty:o,ranges:a}=i,l=rl(t,r.schema);if(s)if(o){const u=w5(r,l);n.addStoredMark(l.create({...u,...e}))}else a.forEach(u=>{const d=u.$from.pos,f=u.$to.pos;r.doc.nodesBetween(d,f,(h,p)=>{const m=Math.max(p,d),y=Math.min(p+h.nodeSize,f);h.marks.find(g=>g.type===l)?h.marks.forEach(g=>{l===g.type&&n.addMark(m,y,l.create({...g.attrs,...e}))}):n.addMark(m,y,l.create(e))})});return xK(r,n,l)},vK=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),wK=(t,e={})=>({state:n,dispatch:r,chain:s})=>{const i=Vr(t,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),i.isTextblock?s().command(({commands:a})=>MT(i,{...o,...e})(n)?!0:a.clearNodes()).command(({state:a})=>MT(i,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},kK=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,s=Pl(t,0,r.content.size),i=en.create(r,s);e.setSelection(i)}return!0},SK=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:s,to:i}=typeof t=="number"?{from:t,to:t}:t,o=pn.atStart(r).from,a=pn.atEnd(r).to,l=Pl(s,o,a),u=Pl(i,o,a),d=pn.create(r,l,u);e.setSelection(d)}return!0},_K=t=>({state:e,dispatch:n})=>{const r=Vr(t,e.schema);return rW(r)(e,n)};function $T(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(s=>e==null?void 0:e.includes(s.type.name));t.tr.ensureMarks(r)}}const TK=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:s})=>{const{selection:i,doc:o}=e,{$from:a,$to:l}=i,u=s.extensionManager.attributes,d=jp(u,a.node().type.name,a.node().attrs);if(i instanceof en&&i.node.isBlock)return!a.parentOffset||!du(o,a.pos)?!1:(r&&(t&&$T(n,s.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const f=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:Ow(a.node(-1).contentMatchAt(a.indexAfter(-1)));let p=f&&h?[{type:h,attrs:d}]:void 0,m=du(e.doc,e.mapping.map(a.pos),1,p);if(!p&&!m&&du(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(m=!0,p=h?[{type:h,attrs:d}]:void 0),r){if(m&&(i instanceof pn&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,p),h&&!f&&!a.parentOffset&&a.parent.type!==h)){const y=e.mapping.map(a.before()),b=e.doc.resolve(y);a.node(-1).canReplaceWith(b.index(),b.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}t&&$T(n,s.extensionManager.splittableMarks),e.scrollIntoView()}return m},CK=(t,e={})=>({tr:n,state:r,dispatch:s,editor:i})=>{var o;const a=Vr(t,r.schema),{$from:l,$to:u}=r.selection,d=r.selection.node;if(d&&d.isBlock||l.depth<2||!l.sameParent(u))return!1;const f=l.node(-1);if(f.type!==a)return!1;const h=i.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(s){let g=Mt.empty;const v=l.index(-1)?1:l.index(-2)?2:3;for(let S=l.depth-v;S>=l.depth-3;S-=1)g=Mt.from(l.node(S).copy(g));const w=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,C={...jp(h,l.node().type.name,l.node().attrs),...e},I=((o=a.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(C))||void 0;g=g.append(Mt.from(a.createAndFill(null,I)||void 0));const k=l.before(l.depth-(v-1));n.replace(k,l.after(-w),new Kt(g,4-v,0));let D=-1;n.doc.nodesBetween(k,n.doc.content.size,(S,T)=>{if(D>-1)return!1;S.isTextblock&&S.content.size===0&&(D=T+1)}),D>-1&&n.setSelection(pn.near(n.doc.resolve(D))),n.scrollIntoView()}return!0}const p=u.pos===l.end()?f.contentMatchAt(0).defaultType:null,m={...jp(h,f.type.name,f.attrs),...e},y={...jp(h,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,u.pos);const b=p?[{type:a,attrs:m},{type:p,attrs:y}]:[{type:a,attrs:m}];if(!du(n.doc,l.pos,2))return!1;if(s){const{selection:g,storedMarks:v}=r,{splittableMarks:w}=i.extensionManager,C=v||g.$to.parentOffset&&g.$from.marks();if(n.split(l.pos,2,b).scrollIntoView(),!C||!s)return!0;const I=C.filter(k=>w.includes(k.type.name));n.ensureMarks(I)}return!0},Cy=(t,e)=>{const n=Hu(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&tl(t.doc,n.pos)&&t.join(n.pos),!0},Ey=(t,e)=>{const n=Hu(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&tl(t.doc,r)&&t.join(r),!0},EK=(t,e,n,r={})=>({editor:s,tr:i,state:o,dispatch:a,chain:l,commands:u,can:d})=>{const{extensions:f,splittableMarks:h}=s.extensionManager,p=Vr(t,o.schema),m=Vr(e,o.schema),{selection:y,storedMarks:b}=o,{$from:g,$to:v}=y,w=g.blockRange(v),C=b||y.$to.parentOffset&&y.$from.marks();if(!w)return!1;const I=Hu(k=>LT(k.type.name,f))(y);if(w.depth>=1&&I&&w.depth-I.depth<=1){if(I.node.type===p)return u.liftListItem(m);if(LT(I.node.type.name,f)&&p.validContent(I.node.content)&&a)return l().command(()=>(i.setNodeMarkup(I.pos,p),!0)).command(()=>Cy(i,p)).command(()=>Ey(i,p)).run()}return!n||!C||!a?l().command(()=>d().wrapInList(p,r)?!0:u.clearNodes()).wrapInList(p,r).command(()=>Cy(i,p)).command(()=>Ey(i,p)).run():l().command(()=>{const k=d().wrapInList(p,r),D=C.filter(S=>h.includes(S.type.name));return i.ensureMarks(D),k?!0:u.clearNodes()}).wrapInList(p,r).command(()=>Cy(i,p)).command(()=>Ey(i,p)).run()},NK=(t,e={},n={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:i=!1}=n,o=rl(t,r.schema);return eb(r,o,e)?s.unsetMark(o,{extendEmptyMarkRange:i}):s.setMark(o,e)},jK=(t,e,n={})=>({state:r,commands:s})=>{const i=Vr(t,r.schema),o=Vr(e,r.schema),a=$f(r,i,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?s.setNode(o,l):s.setNode(i,{...l,...n})},IK=(t,e={})=>({state:n,commands:r})=>{const s=Vr(t,n.schema);return $f(n,s,e)?r.lift(s):r.wrapIn(s,e)},MK=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const s=n[r];let i;if(s.spec.isInputRules&&(i=s.getState(t))){if(e){const o=t.tr,a=i.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(i.text){const l=o.doc.resolve(i.from).marks();o.replaceWith(i.from,i.to,t.schema.text(i.text,l))}else o.delete(i.from,i.to)}return!0}}return!1},DK=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:s}=n;return r||e&&s.forEach(i=>{t.removeMark(i.$from.pos,i.$to.pos)}),!0},AK=(t,e={})=>({tr:n,state:r,dispatch:s})=>{var i;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=rl(t,r.schema),{$from:u,empty:d,ranges:f}=a;if(!s)return!0;if(d&&o){let{from:h,to:p}=a;const m=(i=u.marks().find(b=>b.type===l))===null||i===void 0?void 0:i.attrs,y=Rw(u,l,m);y&&(h=y.from,p=y.to),n.removeMark(h,p,l)}else f.forEach(h=>{n.removeMark(h.$from.pos,h.$to.pos,l)});return n.removeStoredMark(l),!0},RK=(t,e={})=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=e0(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(i=Vr(t,r.schema)),a==="mark"&&(o=rl(t,r.schema)),s&&n.selection.ranges.forEach(l=>{const u=l.$from.pos,d=l.$to.pos;let f,h,p,m;n.selection.empty?r.doc.nodesBetween(u,d,(y,b)=>{i&&i===y.type&&(p=Math.max(b,u),m=Math.min(b+y.nodeSize,d),f=b,h=y)}):r.doc.nodesBetween(u,d,(y,b)=>{b<u&&i&&i===y.type&&(p=Math.max(b,u),m=Math.min(b+y.nodeSize,d),f=b,h=y),b>=u&&b<=d&&(i&&i===y.type&&n.setNodeMarkup(b,void 0,{...y.attrs,...e}),o&&y.marks.length&&y.marks.forEach(g=>{if(o===g.type){const v=Math.max(b,u),w=Math.min(b+y.nodeSize,d);n.addMark(v,w,o.create({...g.attrs,...e}))}}))}),h&&(f!==void 0&&n.setNodeMarkup(f,void 0,{...h.attrs,...e}),o&&h.marks.length&&h.marks.forEach(y=>{o===y.type&&n.addMark(p,m,o.create({...y.attrs,...e}))}))}),!0):!1},OK=(t,e={})=>({state:n,dispatch:r})=>{const s=Vr(t,n.schema);return J7(s,e)(n,r)},PK=(t,e={})=>({state:n,dispatch:r})=>{const s=Vr(t,n.schema);return X7(s,e)(n,r)};var LK=Object.freeze({__proto__:null,blur:vW,clearContent:wW,clearNodes:kW,command:SW,createParagraphNear:_W,cut:TW,deleteCurrentNode:CW,deleteNode:EW,deleteRange:NW,deleteSelection:jW,enter:IW,exitCode:MW,extendMarkRange:DW,first:AW,focus:RW,forEach:OW,insertContent:PW,insertContentAt:zW,joinBackward:UW,joinDown:BW,joinForward:HW,joinItemBackward:VW,joinItemForward:WW,joinTextblockBackward:KW,joinTextblockForward:GW,joinUp:FW,keyboardShortcut:YW,lift:JW,liftEmptyBlock:XW,liftListItem:QW,newlineInCode:ZW,resetAttributes:eK,scrollIntoView:tK,selectAll:nK,selectNodeBackward:rK,selectNodeForward:sK,selectParentNode:iK,selectTextblockEnd:oK,selectTextblockStart:aK,setContent:lK,setMark:bK,setMeta:vK,setNode:wK,setNodeSelection:kK,setTextSelection:SK,sinkListItem:_K,splitBlock:TK,splitListItem:CK,toggleList:EK,toggleMark:NK,toggleNode:jK,toggleWrap:IK,undoInputRule:MK,unsetAllMarks:DK,unsetMark:AK,updateAttributes:RK,wrapIn:OK,wrapInList:PK});const $K=Wr.create({name:"commands",addCommands(){return{...LK}}}),zK=Wr.create({name:"drop",addProseMirrorPlugins(){return[new jr({key:new ss("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),FK=Wr.create({name:"editable",addProseMirrorPlugins(){return[new jr({key:new ss("editable"),props:{editable:()=>this.editor.options.editable}})]}}),BK=new ss("focusEvents"),UK=Wr.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new jr({key:BK,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),HK=Wr.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:u}=a,{empty:d,$anchor:f}=l,{pos:h,parent:p}=f,m=f.parent.isTextblock&&h>0?a.doc.resolve(h-1):f,y=m.parent.type.spec.isolating,b=f.pos-f.parentOffset,g=y&&m.parent.childCount===1?b===f.pos:mn.atStart(u).from===h;return!d||!p.type.isTextblock||p.textContent.length||!g||g&&f.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...r},i={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Zg()||v5()?i:s},addProseMirrorPlugins(){return[new jr({key:new ss("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(y=>y.getMeta("composition")))return;const r=t.some(y=>y.docChanged)&&!e.doc.eq(n.doc),s=t.some(y=>y.getMeta("preventClearDocument"));if(!r||s)return;const{empty:i,from:o,to:a}=e.selection,l=mn.atStart(e.doc).from,u=mn.atEnd(e.doc).to;if(i||!(o===l&&a===u)||!Lw(n.doc))return;const h=n.tr,p=qg({state:n,transaction:h}),{commands:m}=new Yg({editor:this.editor,state:p});if(m.clearNodes(),!!h.steps.length)return h}})]}}),VK=Wr.create({name:"paste",addProseMirrorPlugins(){return[new jr({key:new ss("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),WK=Wr.create({name:"tabindex",addProseMirrorPlugins(){return[new jr({key:new ss("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class _l{get name(){return this.node.type.name}constructor(e,n,r=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=s}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new _l(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new _l(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new _l(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const s=n.isBlock&&!n.isTextblock,i=n.isAtom&&!n.isText,o=this.pos+r+(i?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!s&&a.depth<=this.depth)return;const l=new _l(a,this.editor,s,s?n:null);s&&(l.actualDepth=this.depth+1),e.push(new _l(a,this.editor,s,s?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,s=this.parent;for(;s&&!r;){if(s.node.type.name===e)if(Object.keys(n).length>0){const i=s.node.attrs,o=Object.keys(n);for(let a=0;a<o.length;a+=1){const l=o[a];if(i[l]!==n[l])break}}else r=s;s=s.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let s=[];if(!this.children||this.children.length===0)return s;const i=Object.keys(n);return this.children.forEach(o=>{r&&s.length>0||(o.node.type.name===e&&i.every(l=>n[l]===o.node.attrs[l])&&s.push(o),!(r&&s.length>0)&&(s=s.concat(o.querySelectorAll(e,n,r))))}),s}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}}const KK=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function GK(t,e,n){const r=document.querySelector(`style[data-tiptap-style${n?`-${n}`:""}]`);if(r!==null)return r;const s=document.createElement("style");return e&&s.setAttribute("nonce",e),s.setAttribute(`data-tiptap-style${n?`-${n}`:""}`,""),s.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(s),s}let qK=class extends sW{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:r,moved:s})=>this.options.onDrop(n,r,s)),this.on("paste",({event:n,slice:r})=>this.options.onPaste(n,r)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=GK(KK,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,n){const r=f5(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let r=n;if([].concat(e).forEach(i=>{const o=typeof i=="string"?`${i}$`:i.key;r=r.filter(a=>!a.key.startsWith(o))}),n.length===r.length)return;const s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}createExtensionManager(){var e,n;const s=[...this.options.enableCoreExtensions?[FK,bW.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||n===void 0?void 0:n.blockSeparator}),$K,UK,HK,WK,zK,VK].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i==null?void 0:i.type));this.extensionManager=new Zc(s,this)}createCommandManager(){this.commandManager=new Yg({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let n;try{n=Z1(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>a.name!=="collaboration"),this.createExtensionManager()}}),n=Z1(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const r=y5(n,this.options.autofocus);this.view=new r5(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:Qc.create({doc:n,selection:r||void 0})});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(o)});return}const n=this.state.apply(e),r=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const s=e.getMeta("focus"),i=e.getMeta("blur");s&&this.emit("focus",{editor:this,event:s.event,transaction:e}),i&&this.emit("blur",{editor:this,event:i.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return k5(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,s=typeof e=="string"?n:e;return S5(this.state,r,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Dw(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return fK(this.state.doc,{blockSeparator:n,textSerializers:{...p5(this.schema),...r}})}get isEmpty(){return Lw(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelector(e,n))||null}$nodes(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new _l(n,this)}get $doc(){return this.$pos(0)}};function sc(t){return new Xg({find:t.find,handler:({state:e,range:n,match:r})=>{const s=wn(t.getAttributes,void 0,r);if(s===!1||s===null)return null;const{tr:i}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),u=n.from+a.indexOf(o),d=u+o.length;if(Pw(n.from,n.to,e.doc).filter(p=>p.mark.type.excluded.find(y=>y===t.type&&y!==p.mark.type)).filter(p=>p.to>u).length)return null;d<n.to&&i.delete(d,n.to),u>n.from&&i.delete(n.from+l,u);const h=n.from+l+o.length;i.addMark(n.from+l,h,t.type.create(s||{})),i.removeStoredMark(t.type)}}})}function YK(t){return new Xg({find:t.find,handler:({state:e,range:n,match:r})=>{const s=wn(t.getAttributes,void 0,r)||{},{tr:i}=e,o=n.from;let a=n.to;const l=t.type.create(s);if(r[1]){const u=r[0].lastIndexOf(r[1]);let d=o+u;d>a?d=a:a=d+r[1].length;const f=r[0][r[0].length-1];i.insertText(f,o+r[0].length-1),i.replaceWith(d,a,l)}else if(r[0]){const u=t.type.isInline?o:o-1;i.insert(u,t.type.create(s)).delete(i.mapping.map(o),i.mapping.map(a))}i.scrollIntoView()}})}function tb(t){return new Xg({find:t.find,handler:({state:e,range:n,match:r})=>{const s=e.doc.resolve(n.from),i=wn(t.getAttributes,void 0,r)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,i)}})}function Iu(t){return new Xg({find:t.find,handler:({state:e,range:n,match:r,chain:s})=>{const i=wn(t.getAttributes,void 0,r)||{},o=e.tr.delete(n.from,n.to),l=o.doc.resolve(n.from).blockRange(),u=l&&bw(l,t.type,i);if(!u)return null;if(o.wrap(l,u),t.keepMarks&&t.editor){const{selection:f,storedMarks:h}=e,{splittableMarks:p}=t.editor.extensionManager,m=h||f.$to.parentOffset&&f.$from.marks();if(m){const y=m.filter(b=>p.includes(b.type.name));o.ensureMarks(y)}}if(t.keepAttributes){const f=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(f,i).run()}const d=o.doc.resolve(n.from-1).nodeBefore;d&&d.type===t.type&&tl(o.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,d))&&o.join(n.from-1)}})}class yr{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=wn(Yt(this,"addOptions",{name:this.name}))),this.storage=wn(Yt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new yr(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>Qg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new yr(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=wn(Yt(n,"addOptions",{name:n.name})),n.storage=wn(Yt(n,"addStorage",{name:n.name,options:n.options})),n}}class JK{constructor(e,n,r){this.isDragging=!1,this.component=e,this.editor=n.editor,this.options={stopEvent:null,ignoreMutation:null,...r},this.extension=n.extension,this.node=n.node,this.decorations=n.decorations,this.innerDecorations=n.innerDecorations,this.view=n.view,this.HTMLAttributes=n.HTMLAttributes,this.getPos=n.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(e){var n,r,s,i,o,a,l;const{view:u}=this.editor,d=e.target,f=d.nodeType===3?(n=d.parentElement)===null||n===void 0?void 0:n.closest("[data-drag-handle]"):d.closest("[data-drag-handle]");if(!this.dom||!((r=this.contentDOM)===null||r===void 0)&&r.contains(d)||!f)return;let h=0,p=0;if(this.dom!==f){const v=this.dom.getBoundingClientRect(),w=f.getBoundingClientRect(),C=(s=e.offsetX)!==null&&s!==void 0?s:(i=e.nativeEvent)===null||i===void 0?void 0:i.offsetX,I=(o=e.offsetY)!==null&&o!==void 0?o:(a=e.nativeEvent)===null||a===void 0?void 0:a.offsetY;h=w.x-v.x+C,p=w.y-v.y+I}const m=this.dom.cloneNode(!0);(l=e.dataTransfer)===null||l===void 0||l.setDragImage(m,h,p);const y=this.getPos();if(typeof y!="number")return;const b=en.create(u.state.doc,y),g=u.state.tr.setSelection(b);u.dispatch(g)}stopEvent(e){var n;if(!this.dom)return!1;if(typeof this.options.stopEvent=="function")return this.options.stopEvent({event:e});const r=e.target;if(!(this.dom.contains(r)&&!(!((n=this.contentDOM)===null||n===void 0)&&n.contains(r))))return!1;const i=e.type.startsWith("drag"),o=e.type==="drop";if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(r.tagName)||r.isContentEditable)&&!o&&!i)return!0;const{isEditable:l}=this.editor,{isDragging:u}=this,d=!!this.node.type.spec.draggable,f=en.isSelectable(this.node),h=e.type==="copy",p=e.type==="paste",m=e.type==="cut",y=e.type==="mousedown";if(!d&&f&&i&&e.target===this.dom&&e.preventDefault(),d&&i&&!u&&e.target===this.dom)return e.preventDefault(),!1;if(d&&l&&!u&&y){const b=r.closest("[data-drag-handle]");b&&(this.dom===b||this.dom.contains(b))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!(u||o||h||p||m||y&&f)}ignoreMutation(e){return!this.dom||!this.contentDOM?!0:typeof this.options.ignoreMutation=="function"?this.options.ignoreMutation({mutation:e}):this.node.isLeaf||this.node.isAtom?!0:e.type==="selection"||this.dom.contains(e.target)&&e.type==="childList"&&(Zg()||x5())&&this.editor.isFocused&&[...Array.from(e.addedNodes),...Array.from(e.removedNodes)].every(r=>r.isContentEditable)?!1:this.contentDOM===e.target&&e.type==="attributes"?!0:!this.contentDOM.contains(e.target)}updateAttributes(e){this.editor.commands.command(({tr:n})=>{const r=this.getPos();return typeof r!="number"?!1:(n.setNodeMarkup(r,void 0,{...this.node.attrs,...e}),!0)})}deleteNode(){const e=this.getPos();if(typeof e!="number")return;const n=e+this.node.nodeSize;this.editor.commands.deleteRange({from:e,to:n})}}function Ya(t){return new hW({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:s})=>{const i=wn(t.getAttributes,void 0,r,s);if(i===!1||i===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let u=n.to;if(a){const d=l.search(/\S/),f=n.from+l.indexOf(a),h=f+a.length;if(Pw(n.from,n.to,e.doc).filter(m=>m.mark.type.excluded.find(b=>b===t.type&&b!==m.mark.type)).filter(m=>m.to>f).length)return null;h<n.to&&o.delete(h,n.to),f>n.from&&o.delete(n.from+d,f),u=n.from+d+a.length,o.addMark(n.from+d,u,t.type.create(i||{})),o.removeStoredMark(t.type)}}})}function XK(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof en){const i=r.index();return r.parent.canReplaceWith(i,i+1,e)}let s=r.depth;for(;s>=0;){const i=r.index(s);if(r.node(s).contentMatchAt(i).matchType(e))return!0;s-=1}return!1}function QK(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}const ZK=(...t)=>e=>{t.forEach(n=>{typeof n=="function"?n(e):n&&(n.current=e)})},eG=({renderers:t})=>Ln.createElement(Ln.Fragment,null,Object.entries(t).map(([e,n])=>I4.createPortal(n.reactElement,n.element,e)));class tG extends Ln.Component{constructor(e){super(e),this.editorContentRef=Ln.createRef(),this.initialized=!1,this.state={renderers:{}}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const{editor:e}=this.props;if(e&&e.options.element){if(e.contentComponent)return;const n=this.editorContentRef.current;n.append(...e.options.element.childNodes),e.setOptions({element:n}),e.contentComponent=this,e.createNodeViews(),this.initialized=!0}}maybeFlushSync(e){this.initialized?ir.flushSync(e):e()}setRenderer(e,n){this.maybeFlushSync(()=>{this.setState(({renderers:r})=>({renderers:{...r,[e]:n}}))})}removeRenderer(e){this.maybeFlushSync(()=>{this.setState(({renderers:n})=>{const r={...n};return delete r[e],{renderers:r}})})}componentWillUnmount(){const{editor:e}=this.props;if(!e||(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),e.contentComponent=null,!e.options.element.firstChild))return;const n=document.createElement("div");n.append(...e.options.element.childNodes),e.setOptions({element:n})}render(){const{editor:e,innerRef:n,...r}=this.props;return Ln.createElement(Ln.Fragment,null,Ln.createElement("div",{ref:ZK(n,this.editorContentRef),...r}),Ln.createElement(eG,{renderers:this.state.renderers}))}}const nG=x.forwardRef((t,e)=>{const n=Ln.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return Ln.createElement(tG,{key:n,innerRef:e,...t})}),rG=Ln.memo(nG);class sG extends qK{constructor(){super(...arguments),this.contentComponent=null}}const iG=(t={},e=[])=>{const n=x.useRef(null),[,r]=x.useState({}),{onBeforeCreate:s,onBlur:i,onCreate:o,onDestroy:a,onFocus:l,onSelectionUpdate:u,onTransaction:d,onUpdate:f}=t,h=x.useRef(s),p=x.useRef(i),m=x.useRef(o),y=x.useRef(a),b=x.useRef(l),g=x.useRef(u),v=x.useRef(d),w=x.useRef(f);return x.useEffect(()=>{n.current&&(s&&(n.current.off("beforeCreate",h.current),n.current.on("beforeCreate",s),h.current=s),i&&(n.current.off("blur",p.current),n.current.on("blur",i),p.current=i),o&&(n.current.off("create",m.current),n.current.on("create",o),m.current=o),a&&(n.current.off("destroy",y.current),n.current.on("destroy",a),y.current=a),l&&(n.current.off("focus",b.current),n.current.on("focus",l),b.current=l),u&&(n.current.off("selectionUpdate",g.current),n.current.on("selectionUpdate",u),g.current=u),d&&(n.current.off("transaction",v.current),n.current.on("transaction",d),v.current=d),f&&(n.current.off("update",w.current),n.current.on("update",f),w.current=f))},[s,i,o,a,l,u,d,f,n.current]),x.useEffect(()=>{let C=!0;return n.current=new sG(t),n.current.on("transaction",()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{C&&r({})})})}),()=>{C=!1}},e),x.useEffect(()=>()=>{var C;return(C=n.current)===null||C===void 0?void 0:C.destroy()},[]),n.current},oG=x.createContext({editor:null});oG.Consumer;const _5=x.createContext({onDragStart:void 0}),aG=()=>x.useContext(_5);Ln.forwardRef((t,e)=>{const{onDragStart:n}=aG(),r=t.as||"div";return Ln.createElement(r,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:n,style:{whiteSpace:"normal",...t.style}})});function lG(t){return!!(typeof t=="function"&&t.prototype&&t.prototype.isReactComponent)}function cG(t){var e;return typeof t=="object"&&((e=t.$$typeof)===null||e===void 0?void 0:e.toString())==="Symbol(react.forward_ref)"}class uG{constructor(e,{editor:n,props:r={},as:s="div",className:i="",attrs:o}){this.ref=null,this.id=Math.floor(Math.random()*4294967295).toString(),this.component=e,this.editor=n,this.props=r,this.element=document.createElement(s),this.element.classList.add("react-renderer"),i&&this.element.classList.add(...i.split(" ")),o&&Object.keys(o).forEach(a=>{this.element.setAttribute(a,o[a])}),this.render()}render(){var e,n;const r=this.component,s=this.props;(lG(r)||cG(r))&&(s.ref=i=>{this.ref=i}),this.reactElement=Ln.createElement(r,{...s}),(n=(e=this.editor)===null||e===void 0?void 0:e.contentComponent)===null||n===void 0||n.setRenderer(this.id,this)}updateProps(e={}){this.props={...this.props,...e},this.render()}destroy(){var e,n;(n=(e=this.editor)===null||e===void 0?void 0:e.contentComponent)===null||n===void 0||n.removeRenderer(this.id)}}class dG extends JK{mount(){const e={editor:this.editor,node:this.node,decorations:this.decorations,selected:!1,extension:this.extension,getPos:()=>this.getPos(),updateAttributes:(i={})=>this.updateAttributes(i),deleteNode:()=>this.deleteNode()};if(!this.component.displayName){const i=o=>o.charAt(0).toUpperCase()+o.substring(1);this.component.displayName=i(this.extension.name)}const n=i=>{const o=this.component,a=this.onDragStart.bind(this),l=u=>{u&&this.contentDOMElement&&u.firstChild!==this.contentDOMElement&&u.appendChild(this.contentDOMElement)};return Ln.createElement(Ln.Fragment,null,Ln.createElement(_5.Provider,{value:{onDragStart:a,nodeViewContentRef:l}},Ln.createElement(o,{...i})))};n.displayName="ReactNodeView",this.node.isLeaf?this.contentDOMElement=null:this.options.contentDOMElementTag?this.contentDOMElement=document.createElement(this.options.contentDOMElementTag):this.contentDOMElement=document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.style.whiteSpace="inherit");let r=this.node.isInline?"span":"div";this.options.as&&(r=this.options.as);const{className:s=""}=this.options;this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.editor.on("selectionUpdate",this.handleSelectionUpdate),this.renderer=new uG(n,{editor:this.editor,props:e,as:r,className:`node-${this.node.type.name} ${s}`.trim(),attrs:this.options.attrs})}get dom(){var e;if(this.renderer.element.firstElementChild&&!(!((e=this.renderer.element.firstElementChild)===null||e===void 0)&&e.hasAttribute("data-node-view-wrapper")))throw Error("Please use the NodeViewWrapper component for your node view.");return this.renderer.element}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){const{from:e,to:n}=this.editor.state.selection;if(e<=this.getPos()&&n>=this.getPos()+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(e,n){const r=s=>{this.renderer.updateProps(s)};if(e.type!==this.node.type)return!1;if(typeof this.options.update=="function"){const s=this.node,i=this.decorations;return this.node=e,this.decorations=n,this.options.update({oldNode:s,oldDecorations:i,newNode:e,newDecorations:n,updateProps:()=>r({node:e,decorations:n})})}return e===this.node&&this.decorations===n||(this.node=e,this.decorations=n,r({node:e,decorations:n})),!0}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.element.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.element.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}}function fG(t,e){return n=>n.editor.contentComponent?new dG(t,n,e):{}}const hG=/^\s*>\s$/,pG=yr.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",In(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Iu({find:hG,type:this.type})]}}),mG=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,gG=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,yG=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,xG=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,bG=oi.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",In(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[sc({find:mG,type:this.type}),sc({find:yG,type:this.type})]},addPasteRules(){return[Ya({find:gG,type:this.type}),Ya({find:xG,type:this.type})]}}),vG="listItem",zT="textStyle",FT=/^\s*([-+*])\s$/,wG=yr.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",In(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(vG,this.editor.getAttributes(zT)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=Iu({find:FT,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=Iu({find:FT,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(zT),editor:this.editor})),[t]}}),kG=/(^|[^`])`([^`]+)`(?!`)/,SG=/(^|[^`])`([^`]+)`(?!`)/g,_G=oi.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",In(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[sc({find:kG,type:this.type})]},addPasteRules(){return[Ya({find:SG,type:this.type})]}}),TG=/^```([a-z]+)?[\s\n]$/,CG=/^~~~([a-z]+)?[\s\n]$/,EG=yr.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,i=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",In(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:s}=n;if(!s||r.parent.type!==this.type)return!1;const i=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!i||!o?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:s,empty:i}=n;if(!i||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const a=s.after();return a===void 0?!1:r.nodeAt(a)?t.commands.command(({tr:u})=>(u.setSelection(mn.near(r.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[tb({find:TG,type:this.type,getAttributes:t=>({language:t[1]})}),tb({find:CG,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new jr({key:new ss("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,i=s==null?void 0:s.mode;if(!n||!i)return!1;const{tr:o,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:i},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(pn.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),NG=yr.create({name:"doc",topNode:!0,content:"block+"});function jG(t={}){return new jr({view(e){return new IG(e,t)}})}class IG{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let i=o=>{this[s](o)};return e.dom.addEventListener(s,i),{name:s,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,s=this.editorView.dom,i=s.getBoundingClientRect(),o=i.width/s.offsetWidth,a=i.height/s.offsetHeight;if(n){let f=e.nodeBefore,h=e.nodeAfter;if(f||h){let p=this.editorView.nodeDOM(this.cursorPos-(f?f.nodeSize:0));if(p){let m=p.getBoundingClientRect(),y=f?m.bottom:m.top;f&&h&&(y=(y+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let b=this.width/2*a;r={left:m.left,right:m.right,top:y-b,bottom:y+b}}}}if(!r){let f=this.editorView.coordsAtPos(this.cursorPos),h=this.width/2*o;r={left:f.left-h,right:f.left+h,top:f.top,bottom:f.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let u,d;if(!l||l==document.body&&getComputedStyle(l).position=="static")u=-pageXOffset,d=-pageYOffset;else{let f=l.getBoundingClientRect(),h=f.width/l.offsetWidth,p=f.height/l.offsetHeight;u=f.left-l.scrollLeft*h,d=f.top-l.scrollTop*p}this.element.style.left=(r.left-u)/o+"px",this.element.style.top=(r.top-d)/a+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),s=r&&r.type.spec.disableDropCursor,i=typeof s=="function"?s(this.editorView,n,e):s;if(n&&!i){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=mA(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const MG=Wr.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[jG(this.options)]}});class rr extends mn{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return rr.valid(r)?new rr(r):mn.near(r)}content(){return Kt.empty}eq(e){return e instanceof rr&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new rr(e.resolve(n.pos))}getBookmark(){return new $w(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!DG(e)||!AG(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let s=n.contentMatchAt(e.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&rr.valid(e))return e;let s=e.pos,i=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){i=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;s+=n;let l=e.doc.resolve(s);if(rr.valid(l))return l}for(;;){let o=n>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!en.isSelectable(i)){e=e.doc.resolve(s+i.nodeSize*n),r=!1;continue e}break}i=o,s+=n;let a=e.doc.resolve(s);if(rr.valid(a))return a}return null}}}rr.prototype.visible=!1;rr.findFrom=rr.findGapCursorFrom;mn.jsonID("gapcursor",rr);class $w{constructor(e){this.pos=e}map(e){return new $w(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return rr.valid(n)?new rr(n):mn.near(n)}}function T5(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function DG(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n-1);;s=s.lastChild){if(s.childCount==0&&!s.inlineContent||T5(s.type))return!0;if(s.inlineContent)return!1}}return!0}function AG(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n);;s=s.firstChild){if(s.childCount==0&&!s.inlineContent||T5(s.type))return!0;if(s.inlineContent)return!1}}return!0}function RG(){return new jr({props:{decorations:$G,createSelectionBetween(t,e,n){return e.pos==n.pos&&rr.valid(n)?new rr(n):null},handleClick:PG,handleKeyDown:OG,handleDOMEvents:{beforeinput:LG}}})}const OG=s5({ArrowLeft:Kh("horiz",-1),ArrowRight:Kh("horiz",1),ArrowUp:Kh("vert",-1),ArrowDown:Kh("vert",1)});function Kh(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,s,i){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof pn){if(!i.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let u=rr.findGapCursorFrom(a,e,l);return u?(s&&s(r.tr.setSelection(new rr(u))),!0):!1}}function PG(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!rr.valid(r))return!1;let s=t.posAtCoords({left:n.clientX,top:n.clientY});return s&&s.inside>-1&&en.isSelectable(t.state.doc.nodeAt(s.inside))?!1:(t.dispatch(t.state.tr.setSelection(new rr(r))),!0)}function LG(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof rr))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let s=Mt.empty;for(let o=r.length-1;o>=0;o--)s=Mt.from(r[o].createAndFill(null,s));let i=t.state.tr.replace(n.pos,n.pos,new Kt(s,0,0));return i.setSelection(pn.near(i.doc.resolve(n.pos+1))),t.dispatch(i),!1}function $G(t){if(!(t.selection instanceof rr))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",vr.create(t.doc,[zs.widget(t.selection.head,e,{key:"gapcursor"})])}const zG=Wr.create({name:"gapCursor",addProseMirrorPlugins(){return[RG()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=wn(Yt(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),FG=yr.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",In(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:s,storedMarks:i}=n;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=i||s.$to.parentOffset&&s.$from.marks();return e().insertContent({type:this.name}).command(({tr:u,dispatch:d})=>{if(d&&l&&o){const f=l.filter(h=>a.includes(h.type.name));u.ensureMarks(f)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),BG=yr.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,In(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>tb({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var Am=200,Hr=function(){};Hr.prototype.append=function(e){return e.length?(e=Hr.from(e),!this.length&&e||e.length<Am&&this.leafAppend(e)||this.length<Am&&e.leafPrepend(this)||this.appendInner(e)):this};Hr.prototype.prepend=function(e){return e.length?Hr.from(e).append(this):this};Hr.prototype.appendInner=function(e){return new UG(this,e)};Hr.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?Hr.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};Hr.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Hr.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};Hr.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var s=[];return this.forEach(function(i,o){return s.push(e(i,o))},n,r),s};Hr.from=function(e){return e instanceof Hr?e:e&&e.length?new C5(e):Hr.empty};var C5=function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(s,i){return s==0&&i==this.length?this:new e(this.values.slice(s,i))},e.prototype.getInner=function(s){return this.values[s]},e.prototype.forEachInner=function(s,i,o,a){for(var l=i;l<o;l++)if(s(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(s,i,o,a){for(var l=i-1;l>=o;l--)if(s(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(s){if(this.length+s.length<=Am)return new e(this.values.concat(s.flatten()))},e.prototype.leafPrepend=function(s){if(this.length+s.length<=Am)return new e(s.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(Hr);Hr.empty=new C5([]);var UG=function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,s,i,o){var a=this.left.length;if(s<a&&this.left.forEachInner(r,s,Math.min(i,a),o)===!1||i>a&&this.right.forEachInner(r,Math.max(s-a,0),Math.min(this.length,i)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,s,i,o){var a=this.left.length;if(s>a&&this.right.forEachInvertedInner(r,s-a,Math.max(i,a)-a,o+a)===!1||i<a&&this.left.forEachInvertedInner(r,Math.min(s,a),i,o)===!1)return!1},e.prototype.sliceInner=function(r,s){if(r==0&&s==this.length)return this;var i=this.left.length;return s<=i?this.left.slice(r,s):r>=i?this.right.slice(r-i,s-i):this.left.slice(r,i).append(this.right.slice(0,s-i))},e.prototype.leafAppend=function(r){var s=this.right.leafAppend(r);if(s)return new e(this.left,s)},e.prototype.leafPrepend=function(r){var s=this.left.leafPrepend(r);if(s)return new e(s,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(Hr);const HG=500;class Xi{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let s,i;n&&(s=this.remapping(r,this.items.length),i=s.maps.length);let o=e.tr,a,l,u=[],d=[];return this.items.forEach((f,h)=>{if(!f.step){s||(s=this.remapping(r,h+1),i=s.maps.length),i--,d.push(f);return}if(s){d.push(new ro(f.map));let p=f.step.map(s.slice(i)),m;p&&o.maybeStep(p).doc&&(m=o.mapping.maps[o.mapping.maps.length-1],u.push(new ro(m,void 0,void 0,u.length+d.length))),i--,m&&s.appendMap(m,i)}else o.maybeStep(f.step);if(f.selection)return a=s?f.selection.map(s.slice(i)):f.selection,l=new Xi(this.items.slice(0,r).append(d.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,r,s){let i=[],o=this.eventCount,a=this.items,l=!s&&a.length?a.get(a.length-1):null;for(let d=0;d<e.steps.length;d++){let f=e.steps[d].invert(e.docs[d]),h=new ro(e.mapping.maps[d],f,n),p;(p=l&&l.merge(h))&&(h=p,d?i.pop():a=a.slice(0,a.length-1)),i.push(h),n&&(o++,n=void 0),s||(l=h)}let u=o-r.depth;return u>WG&&(a=VG(a,u),o-=u),new Xi(a.append(i),o)}remapping(e,n){let r=new Df;return this.items.forEach((s,i)=>{let o=s.mirrorOffset!=null&&i-s.mirrorOffset>=e?r.maps.length-s.mirrorOffset:void 0;r.appendMap(s.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new Xi(this.items.append(e.map(n=>new ro(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],s=Math.max(0,this.items.length-n),i=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(h=>{h.selection&&a--},s);let l=n;this.items.forEach(h=>{let p=i.getMirror(--l);if(p==null)return;o=Math.min(o,p);let m=i.maps[p];if(h.step){let y=e.steps[p].invert(e.docs[p]),b=h.selection&&h.selection.map(i.slice(l+1,p));b&&a++,r.push(new ro(m,y,b))}else r.push(new ro(m))},s);let u=[];for(let h=n;h<o;h++)u.push(new ro(i.maps[h]));let d=this.items.slice(0,s).append(u).append(r),f=new Xi(d,a);return f.emptyItemCount()>HG&&(f=f.compress(this.items.length-r.length)),f}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,s=[],i=0;return this.items.forEach((o,a)=>{if(a>=e)s.push(o),o.selection&&i++;else if(o.step){let l=o.step.map(n.slice(r)),u=l&&l.getMap();if(r--,u&&n.appendMap(u,r),l){let d=o.selection&&o.selection.map(n.slice(r));d&&i++;let f=new ro(u.invert(),l,d),h,p=s.length-1;(h=s.length&&s[p].merge(f))?s[p]=h:s.push(f)}}else o.map&&r--},this.items.length,0),new Xi(Hr.from(s.reverse()),i)}}Xi.empty=new Xi(Hr.empty,0);function VG(t,e){let n;return t.forEach((r,s)=>{if(r.selection&&e--==0)return n=s,!1}),t.slice(n)}class ro{constructor(e,n,r,s){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new ro(n.getMap().invert(),n,this.selection)}}}class ga{constructor(e,n,r,s,i){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=s,this.prevComposition=i}}const WG=20;function KG(t,e,n,r){let s=n.getMeta(ql),i;if(s)return s.historyState;n.getMeta(YG)&&(t=new ga(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(ql))return o.getMeta(ql).redo?new ga(t.done.addTransform(n,void 0,r,Ip(e)),t.undone,BT(n.mapping.maps),t.prevTime,t.prevComposition):new ga(t.done,t.undone.addTransform(n,void 0,r,Ip(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!GG(n,t.prevRanges)),u=o?Ny(t.prevRanges,n.mapping):BT(n.mapping.maps);return new ga(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,Ip(e)),Xi.empty,u,n.time,a??t.prevComposition)}else return(i=n.getMeta("rebased"))?new ga(t.done.rebased(n,i),t.undone.rebased(n,i),Ny(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new ga(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),Ny(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function GG(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,s)=>{for(let i=0;i<e.length;i+=2)r<=e[i+1]&&s>=e[i]&&(n=!0)}),n}function BT(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,s,i,o)=>e.push(i,o));return e}function Ny(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let s=e.map(t[r],1),i=e.map(t[r+1],-1);s<=i&&n.push(s,i)}return n}function qG(t,e,n){let r=Ip(e),s=ql.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,r);if(!i)return null;let o=i.selection.resolve(i.transform.doc),a=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),s,r),l=new ga(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(o).setMeta(ql,{redo:n,historyState:l})}let jy=!1,UT=null;function Ip(t){let e=t.plugins;if(UT!=e){jy=!1,UT=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){jy=!0;break}}return jy}const ql=new ss("history"),YG=new ss("closeHistory");function JG(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new jr({key:ql,state:{init(){return new ga(Xi.empty,Xi.empty,null,0,-1)},apply(e,n,r){return KG(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,s=r=="historyUndo"?N5:r=="historyRedo"?j5:null;return!s||!e.editable?!1:(n.preventDefault(),s(e.state,e.dispatch))}}}})}function E5(t,e){return(n,r)=>{let s=ql.getState(n);if(!s||(t?s.undone:s.done).eventCount==0)return!1;if(r){let i=qG(s,n,t);i&&r(e?i.scrollIntoView():i)}return!0}}const N5=E5(!1,!0),j5=E5(!0,!0),XG=Wr.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>N5(t,e),redo:()=>({state:t,dispatch:e})=>j5(t,e)}},addProseMirrorPlugins(){return[JG(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),QG=yr.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",In(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!XK(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$from:r,$to:s}=n,i=t();return r.parentOffset===0?i.insertContentAt({from:Math.max(r.pos-1,0),to:s.pos},{type:this.name}):yK(n)?i.insertContentAt(s.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({tr:o,dispatch:a})=>{var l;if(a){const{$to:u}=o.selection,d=u.end();if(u.nodeAfter)u.nodeAfter.isTextblock?o.setSelection(pn.create(o.doc,u.pos+1)):u.nodeAfter.isBlock?o.setSelection(en.create(o.doc,u.pos)):o.setSelection(pn.create(o.doc,u.pos));else{const f=(l=u.parent.type.contentMatch.defaultType)===null||l===void 0?void 0:l.create();f&&(o.insert(d,f),o.setSelection(pn.create(o.doc,d+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[YK({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),ZG=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,eq=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,tq=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,nq=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,rq=oi.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",In(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[sc({find:ZG,type:this.type}),sc({find:tq,type:this.type})]},addPasteRules(){return[Ya({find:eq,type:this.type}),Ya({find:nq,type:this.type})]}}),sq=yr.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",In(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),iq="listItem",HT="textStyle",VT=/^(\d+)\.\s$/,oq=yr.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",In(this.options.HTMLAttributes,n),0]:["ol",In(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(iq,this.editor.getAttributes(HT)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=Iu({find:VT,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=Iu({find:VT,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(HT)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),aq=yr.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",In(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),lq=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,cq=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,uq=oi.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",In(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[sc({find:lq,type:this.type})]},addPasteRules(){return[Ya({find:cq,type:this.type})]}}),dq=yr.create({name:"text",group:"inline"}),fq=Wr.create({name:"starterKit",addExtensions(){var t,e,n,r,s,i,o,a,l,u,d,f,h,p,m,y,b,g;const v=[];return this.options.blockquote!==!1&&v.push(pG.configure((t=this.options)===null||t===void 0?void 0:t.blockquote)),this.options.bold!==!1&&v.push(bG.configure((e=this.options)===null||e===void 0?void 0:e.bold)),this.options.bulletList!==!1&&v.push(wG.configure((n=this.options)===null||n===void 0?void 0:n.bulletList)),this.options.code!==!1&&v.push(_G.configure((r=this.options)===null||r===void 0?void 0:r.code)),this.options.codeBlock!==!1&&v.push(EG.configure((s=this.options)===null||s===void 0?void 0:s.codeBlock)),this.options.document!==!1&&v.push(NG.configure((i=this.options)===null||i===void 0?void 0:i.document)),this.options.dropcursor!==!1&&v.push(MG.configure((o=this.options)===null||o===void 0?void 0:o.dropcursor)),this.options.gapcursor!==!1&&v.push(zG.configure((a=this.options)===null||a===void 0?void 0:a.gapcursor)),this.options.hardBreak!==!1&&v.push(FG.configure((l=this.options)===null||l===void 0?void 0:l.hardBreak)),this.options.heading!==!1&&v.push(BG.configure((u=this.options)===null||u===void 0?void 0:u.heading)),this.options.history!==!1&&v.push(XG.configure((d=this.options)===null||d===void 0?void 0:d.history)),this.options.horizontalRule!==!1&&v.push(QG.configure((f=this.options)===null||f===void 0?void 0:f.horizontalRule)),this.options.italic!==!1&&v.push(rq.configure((h=this.options)===null||h===void 0?void 0:h.italic)),this.options.listItem!==!1&&v.push(sq.configure((p=this.options)===null||p===void 0?void 0:p.listItem)),this.options.orderedList!==!1&&v.push(oq.configure((m=this.options)===null||m===void 0?void 0:m.orderedList)),this.options.paragraph!==!1&&v.push(aq.configure((y=this.options)===null||y===void 0?void 0:y.paragraph)),this.options.strike!==!1&&v.push(uq.configure((b=this.options)===null||b===void 0?void 0:b.strike)),this.options.text!==!1&&v.push(dq.configure((g=this.options)===null||g===void 0?void 0:g.text)),v}}),hq="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",pq="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",nb="numeric",rb="ascii",sb="alpha",Bd="asciinumeric",vd="alphanumeric",ib="domain",I5="emoji",mq="scheme",gq="slashscheme",Iy="whitespace";function yq(t,e){return t in e||(e[t]=[]),e[t]}function Ll(t,e,n){e[nb]&&(e[Bd]=!0,e[vd]=!0),e[rb]&&(e[Bd]=!0,e[sb]=!0),e[Bd]&&(e[vd]=!0),e[sb]&&(e[vd]=!0),e[vd]&&(e[ib]=!0),e[I5]&&(e[ib]=!0);for(const r in e){const s=yq(r,n);s.indexOf(t)<0&&s.push(t)}}function xq(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function Ps(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Ps.groups={};Ps.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const s=e.jr[r][0],i=e.jr[r][1];if(i&&s.test(t))return i}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let s=0;s<t.length;s++)this.tt(t[s],e,n,r)},tr(t,e,n,r){r=r||Ps.groups;let s;return e&&e.j?s=e:(s=new Ps(e),n&&r&&Ll(e,n,r)),this.jr.push([t,s]),s},ts(t,e,n,r){let s=this;const i=t.length;if(!i)return s;for(let o=0;o<i-1;o++)s=s.tt(t[o]);return s.tt(t[i-1],e,n,r)},tt(t,e,n,r){r=r||Ps.groups;const s=this;if(e&&e.j)return s.j[t]=e,e;const i=e;let o,a=s.go(t);if(a?(o=new Ps,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new Ps,i){if(r)if(o.t&&typeof o.t=="string"){const l=Object.assign(xq(o.t,r),n);Ll(i,l,r)}else n&&Ll(i,n,r);o.t=i}return s.j[t]=o,o}};const vn=(t,e,n,r,s)=>t.ta(e,n,r,s),hr=(t,e,n,r,s)=>t.tr(e,n,r,s),WT=(t,e,n,r,s)=>t.ts(e,n,r,s),At=(t,e,n,r,s)=>t.tt(e,n,r,s),Do="WORD",ob="UWORD",M5="ASCIINUMERICAL",D5="ALPHANUMERICAL",zf="LOCALHOST",ab="TLD",lb="UTLD",Mp="SCHEME",Mc="SLASH_SCHEME",zw="NUM",cb="WS",Fw="NL",Ud="OPENBRACE",Hd="CLOSEBRACE",Rm="OPENBRACKET",Om="CLOSEBRACKET",Pm="OPENPAREN",Lm="CLOSEPAREN",$m="OPENANGLEBRACKET",zm="CLOSEANGLEBRACKET",Fm="FULLWIDTHLEFTPAREN",Bm="FULLWIDTHRIGHTPAREN",Um="LEFTCORNERBRACKET",Hm="RIGHTCORNERBRACKET",Vm="LEFTWHITECORNERBRACKET",Wm="RIGHTWHITECORNERBRACKET",Km="FULLWIDTHLESSTHAN",Gm="FULLWIDTHGREATERTHAN",qm="AMPERSAND",Ym="APOSTROPHE",Jm="ASTERISK",ya="AT",Xm="BACKSLASH",Qm="BACKTICK",Zm="CARET",Sa="COLON",Bw="COMMA",eg="DOLLAR",so="DOT",tg="EQUALS",Uw="EXCLAMATION",gi="HYPHEN",Vd="PERCENT",ng="PIPE",rg="PLUS",sg="POUND",Wd="QUERY",Hw="QUOTE",A5="FULLWIDTHMIDDLEDOT",Vw="SEMI",io="SLASH",Kd="TILDE",ig="UNDERSCORE",R5="EMOJI",og="SYM";var O5=Object.freeze({__proto__:null,ALPHANUMERICAL:D5,AMPERSAND:qm,APOSTROPHE:Ym,ASCIINUMERICAL:M5,ASTERISK:Jm,AT:ya,BACKSLASH:Xm,BACKTICK:Qm,CARET:Zm,CLOSEANGLEBRACKET:zm,CLOSEBRACE:Hd,CLOSEBRACKET:Om,CLOSEPAREN:Lm,COLON:Sa,COMMA:Bw,DOLLAR:eg,DOT:so,EMOJI:R5,EQUALS:tg,EXCLAMATION:Uw,FULLWIDTHGREATERTHAN:Gm,FULLWIDTHLEFTPAREN:Fm,FULLWIDTHLESSTHAN:Km,FULLWIDTHMIDDLEDOT:A5,FULLWIDTHRIGHTPAREN:Bm,HYPHEN:gi,LEFTCORNERBRACKET:Um,LEFTWHITECORNERBRACKET:Vm,LOCALHOST:zf,NL:Fw,NUM:zw,OPENANGLEBRACKET:$m,OPENBRACE:Ud,OPENBRACKET:Rm,OPENPAREN:Pm,PERCENT:Vd,PIPE:ng,PLUS:rg,POUND:sg,QUERY:Wd,QUOTE:Hw,RIGHTCORNERBRACKET:Hm,RIGHTWHITECORNERBRACKET:Wm,SCHEME:Mp,SEMI:Vw,SLASH:io,SLASH_SCHEME:Mc,SYM:og,TILDE:Kd,TLD:ab,UNDERSCORE:ig,UTLD:lb,UWORD:ob,WORD:Do,WS:cb});const No=/[a-z]/,id=/\p{L}/u,My=/\p{Emoji}/u,jo=/\d/,Dy=/\s/,KT="\r",Ay=`
`,bq="",vq="",Ry="";let Gh=null,qh=null;function wq(t=[]){const e={};Ps.groups=e;const n=new Ps;Gh==null&&(Gh=GT(hq)),qh==null&&(qh=GT(pq)),At(n,"'",Ym),At(n,"{",Ud),At(n,"}",Hd),At(n,"[",Rm),At(n,"]",Om),At(n,"(",Pm),At(n,")",Lm),At(n,"<",$m),At(n,">",zm),At(n,"",Fm),At(n,"",Bm),At(n,"",Um),At(n,"",Hm),At(n,"",Vm),At(n,"",Wm),At(n,"",Km),At(n,"",Gm),At(n,"&",qm),At(n,"*",Jm),At(n,"@",ya),At(n,"`",Qm),At(n,"^",Zm),At(n,":",Sa),At(n,",",Bw),At(n,"$",eg),At(n,".",so),At(n,"=",tg),At(n,"!",Uw),At(n,"-",gi),At(n,"%",Vd),At(n,"|",ng),At(n,"+",rg),At(n,"#",sg),At(n,"?",Wd),At(n,'"',Hw),At(n,"/",io),At(n,";",Vw),At(n,"~",Kd),At(n,"_",ig),At(n,"\\",Xm),At(n,"",A5);const r=hr(n,jo,zw,{[nb]:!0});hr(r,jo,r);const s=hr(r,No,M5,{[Bd]:!0}),i=hr(r,id,D5,{[vd]:!0}),o=hr(n,No,Do,{[rb]:!0});hr(o,jo,s),hr(o,No,o),hr(s,jo,s),hr(s,No,s);const a=hr(n,id,ob,{[sb]:!0});hr(a,No),hr(a,jo,i),hr(a,id,a),hr(i,jo,i),hr(i,No),hr(i,id,i);const l=At(n,Ay,Fw,{[Iy]:!0}),u=At(n,KT,cb,{[Iy]:!0}),d=hr(n,Dy,cb,{[Iy]:!0});At(n,Ry,d),At(u,Ay,l),At(u,Ry,d),hr(u,Dy,d),At(d,KT),At(d,Ay),hr(d,Dy,d),At(d,Ry,d);const f=hr(n,My,R5,{[I5]:!0});At(f,"#"),hr(f,My,f),At(f,bq,f);const h=At(f,vq);At(h,"#"),hr(h,My,f);const p=[[No,o],[jo,s]],m=[[No,null],[id,a],[jo,i]];for(let y=0;y<Gh.length;y++)oa(n,Gh[y],ab,Do,p);for(let y=0;y<qh.length;y++)oa(n,qh[y],lb,ob,m);Ll(ab,{tld:!0,ascii:!0},e),Ll(lb,{utld:!0,alpha:!0},e),oa(n,"file",Mp,Do,p),oa(n,"mailto",Mp,Do,p),oa(n,"http",Mc,Do,p),oa(n,"https",Mc,Do,p),oa(n,"ftp",Mc,Do,p),oa(n,"ftps",Mc,Do,p),Ll(Mp,{scheme:!0,ascii:!0},e),Ll(Mc,{slashscheme:!0,ascii:!0},e),t=t.sort((y,b)=>y[0]>b[0]?1:-1);for(let y=0;y<t.length;y++){const b=t[y][0],v=t[y][1]?{[mq]:!0}:{[gq]:!0};b.indexOf("-")>=0?v[ib]=!0:No.test(b)?jo.test(b)?v[Bd]=!0:v[rb]=!0:v[nb]=!0,WT(n,b,b,v)}return WT(n,"localhost",zf,{ascii:!0}),n.jd=new Ps(og),{start:n,tokens:Object.assign({groups:e},O5)}}function P5(t,e){const n=kq(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=n.length,s=[];let i=0,o=0;for(;o<r;){let a=t,l=null,u=0,d=null,f=-1,h=-1;for(;o<r&&(l=a.go(n[o]));)a=l,a.accepts()?(f=0,h=0,d=a):f>=0&&(f+=n[o].length,h++),u+=n[o].length,i+=n[o].length,o++;i-=f,o-=h,u-=f,s.push({t:d.t,v:e.slice(i-u,i),s:i-u,e:i})}return s}function kq(t){const e=[],n=t.length;let r=0;for(;r<n;){let s=t.charCodeAt(r),i,o=s<55296||s>56319||r+1===n||(i=t.charCodeAt(r+1))<56320||i>57343?t[r]:t.slice(r,r+2);e.push(o),r+=o.length}return e}function oa(t,e,n,r,s){let i;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];t.j[l]?i=t.j[l]:(i=new Ps(r),i.jr=s.slice(),t.j[l]=i),t=i}return i=new Ps(n),i.jr=s.slice(),t.j[e[o-1]]=i,i}function GT(t){const e=[],n=[];let r=0,s="0123456789";for(;r<t.length;){let i=0;for(;s.indexOf(t[r+i])>=0;)i++;if(i>0){e.push(n.join(""));for(let o=parseInt(t.substring(r,r+i),10);o>0;o--)n.pop();r+=i}else n.push(t[r]),r++}return e}const Ff={defaultProtocol:"http",events:null,format:qT,formatHref:qT,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Ww(t,e=null){let n=Object.assign({},Ff);t&&(n=Object.assign(n,t instanceof Ww?t.o:t));const r=n.ignoreTags,s=[];for(let i=0;i<r.length;i++)s.push(r[i].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=s}Ww.prototype={o:Ff,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let s=this.o[t];return s&&(typeof s=="object"?(s=n.t in s?s[n.t]:Ff[t],typeof s=="function"&&r&&(s=s(e,n))):typeof s=="function"&&r&&(s=s(e,n.t,n)),s)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function qT(t){return t}function L5(t,e){this.t="token",this.v=t,this.tk=e}L5.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=Ff.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),s=t.get("tagName",n,e),i=this.toFormattedString(t),o={},a=t.get("className",n,e),l=t.get("target",n,e),u=t.get("rel",n,e),d=t.getObj("attributes",n,e),f=t.getObj("events",n,e);return o.href=r,a&&(o.class=a),l&&(o.target=l),u&&(o.rel=u),d&&Object.assign(o,d),{tagName:s,attributes:o,content:i,eventListeners:f}}};function t0(t,e){class n extends L5{constructor(s,i){super(s,i),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const YT=t0("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),JT=t0("text"),Sq=t0("nl"),Yh=t0("url",{isLink:!0,toHref(t=Ff.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==zf&&t[1].t===Sa}}),pi=t=>new Ps(t);function _q({groups:t}){const e=t.domain.concat([qm,Jm,ya,Xm,Qm,Zm,eg,tg,gi,zw,Vd,ng,rg,sg,io,og,Kd,ig]),n=[Ym,Sa,Bw,so,Uw,Vd,Wd,Hw,Vw,$m,zm,Ud,Hd,Om,Rm,Pm,Lm,Fm,Bm,Um,Hm,Vm,Wm,Km,Gm],r=[qm,Ym,Jm,Xm,Qm,Zm,eg,tg,gi,Ud,Hd,Vd,ng,rg,sg,Wd,io,og,Kd,ig],s=pi(),i=At(s,Kd);vn(i,r,i),vn(i,t.domain,i);const o=pi(),a=pi(),l=pi();vn(s,t.domain,o),vn(s,t.scheme,a),vn(s,t.slashscheme,l),vn(o,r,i),vn(o,t.domain,o);const u=At(o,ya);At(i,ya,u),At(a,ya,u),At(l,ya,u);const d=At(i,so);vn(d,r,i),vn(d,t.domain,i);const f=pi();vn(u,t.domain,f),vn(f,t.domain,f);const h=At(f,so);vn(h,t.domain,f);const p=pi(YT);vn(h,t.tld,p),vn(h,t.utld,p),At(u,zf,p);const m=At(f,gi);At(m,gi,m),vn(m,t.domain,f),vn(p,t.domain,f),At(p,so,h),At(p,gi,m);const y=At(p,Sa);vn(y,t.numeric,YT);const b=At(o,gi),g=At(o,so);At(b,gi,b),vn(b,t.domain,o),vn(g,r,i),vn(g,t.domain,o);const v=pi(Yh);vn(g,t.tld,v),vn(g,t.utld,v),vn(v,t.domain,o),vn(v,r,i),At(v,so,g),At(v,gi,b),At(v,ya,u);const w=At(v,Sa),C=pi(Yh);vn(w,t.numeric,C);const I=pi(Yh),k=pi();vn(I,e,I),vn(I,n,k),vn(k,e,I),vn(k,n,k),At(v,io,I),At(C,io,I);const D=At(a,Sa),S=At(l,Sa),T=At(S,io),_=At(T,io);vn(a,t.domain,o),At(a,so,g),At(a,gi,b),vn(l,t.domain,o),At(l,so,g),At(l,gi,b),vn(D,t.domain,I),At(D,io,I),At(D,Wd,I),vn(_,t.domain,I),vn(_,e,I),At(_,io,I);const N=[[Ud,Hd],[Rm,Om],[Pm,Lm],[$m,zm],[Fm,Bm],[Um,Hm],[Vm,Wm],[Km,Gm]];for(let A=0;A<N.length;A++){const[O,L]=N[A],V=At(I,O);At(k,O,V),At(V,L,I);const E=pi(Yh);vn(V,e,E);const j=pi();vn(V,n),vn(E,e,E),vn(E,n,j),vn(j,e,E),vn(j,n,j),At(E,L,I),At(j,L,I)}return At(s,zf,v),At(s,Fw,Sq),{start:s,tokens:O5}}function Tq(t,e,n){let r=n.length,s=0,i=[],o=[];for(;s<r;){let a=t,l=null,u=null,d=0,f=null,h=-1;for(;s<r&&!(l=a.go(n[s].t));)o.push(n[s++]);for(;s<r&&(u=l||a.go(n[s].t));)l=null,a=u,a.accepts()?(h=0,f=a):h>=0&&h++,s++,d++;if(h<0)s-=d,s<r&&(o.push(n[s]),s++);else{o.length>0&&(i.push(Oy(JT,e,o)),o=[]),s-=h,d-=h;const p=f.t,m=n.slice(s-d,s);i.push(Oy(p,e,m))}}return o.length>0&&i.push(Oy(JT,e,o)),i}function Oy(t,e,n){const r=n[0].s,s=n[n.length-1].e,i=e.slice(r,s);return new t(i,n)}const Cq=typeof console<"u"&&console&&console.warn||(()=>{}),Eq="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Yn={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Nq(){return Ps.groups={},Yn.scanner=null,Yn.parser=null,Yn.tokenQueue=[],Yn.pluginQueue=[],Yn.customSchemes=[],Yn.initialized=!1,Yn}function XT(t,e=!1){if(Yn.initialized&&Cq(`linkifyjs: already initialized - will not register custom scheme "${t}" ${Eq}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Yn.customSchemes.push([t,e])}function jq(){Yn.scanner=wq(Yn.customSchemes);for(let t=0;t<Yn.tokenQueue.length;t++)Yn.tokenQueue[t][1]({scanner:Yn.scanner});Yn.parser=_q(Yn.scanner.tokens);for(let t=0;t<Yn.pluginQueue.length;t++)Yn.pluginQueue[t][1]({scanner:Yn.scanner,parser:Yn.parser});return Yn.initialized=!0,Yn}function $5(t){return Yn.initialized||jq(),Tq(Yn.parser.start,t,P5(Yn.scanner.start,t))}$5.scan=P5;function Kw(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new Ww(n),s=$5(t),i=[];for(let o=0;o<s.length;o++){const a=s[o];a.isLink&&(!e||a.t===e)&&r.check(a)&&i.push(a.toFormattedObject(r))}return i}function Iq(t){return new jr({key:new ss("autolink"),appendTransaction:(e,n,r)=>{const s=e.some(u=>u.docChanged)&&!n.doc.eq(r.doc),i=e.some(u=>u.getMeta("preventAutolink"));if(!s||i)return;const{tr:o}=r,a=cK(n.doc,[...e]);if(gK(a).forEach(({newRange:u})=>{const d=uK(r.doc,u,p=>p.isTextblock);let f,h;if(d.length>1?(f=d[0],h=r.doc.textBetween(f.pos,f.pos+f.node.nodeSize,void 0," ")):d.length&&r.doc.textBetween(u.from,u.to," "," ").endsWith(" ")&&(f=d[0],h=r.doc.textBetween(f.pos,u.to,void 0," ")),f&&h){const p=h.split(" ").filter(b=>b!=="");if(p.length<=0)return!1;const m=p[p.length-1],y=f.pos+h.lastIndexOf(m);if(!m)return!1;Kw(m).filter(b=>b.isLink).map(b=>({...b,from:y+b.start+1,to:y+b.end+1})).filter(b=>r.schema.marks.code?!r.doc.rangeHasMark(b.from,b.to,r.schema.marks.code):!0).filter(b=>t.validate?t.validate(b.value):!0).forEach(b=>{Pw(b.from,b.to,r.doc).some(g=>g.mark.type===t.type)||o.addMark(b.from,b.to,t.type.create({href:b.href}))})}}),!!o.steps.length)return o}})}function Mq(t){return new jr({key:new ss("handleClickLink"),props:{handleClick:(e,n,r)=>{var s,i;if(r.button!==0)return!1;let o=r.target;const a=[];for(;o.nodeName!=="DIV";)a.push(o),o=o.parentNode;if(!a.find(h=>h.nodeName==="A"))return!1;const l=k5(e.state,t.type.name),u=r.target,d=(s=u==null?void 0:u.href)!==null&&s!==void 0?s:l.href,f=(i=u==null?void 0:u.target)!==null&&i!==void 0?i:l.target;return u&&d?(window.open(d,f),!0):!1}}})}function Dq(t){return new jr({key:new ss("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{state:s}=e,{selection:i}=s,{empty:o}=i;if(o)return!1;let a="";r.content.forEach(u=>{a+=u.textContent});const l=Kw(a).find(u=>u.isLink&&u.value===a);return!a||!l?!1:(t.editor.commands.setMark(t.type,{href:l.href}),!0)}}})}const Aq=oi.create({name:"link",priority:1e3,keepOnSplit:!1,onCreate(){this.options.protocols.forEach(t=>{if(typeof t=="string"){XT(t);return}XT(t.scheme,t.optionalSlashes)})},onDestroy(){Nq()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},validate:void 0}},addAttributes(){return{href:{default:null},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:'a[href]:not([href *= "javascript:" i])'}]},renderHTML({HTMLAttributes:t}){var e;return!((e=t.href)===null||e===void 0)&&e.startsWith("javascript:")?["a",In(this.options.HTMLAttributes,{...t,href:""}),0]:["a",In(this.options.HTMLAttributes,t),0]},addCommands(){return{setLink:t=>({chain:e})=>e().setMark(this.name,t).setMeta("preventAutolink",!0).run(),toggleLink:t=>({chain:e})=>e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run(),unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Ya({find:t=>{const e=[];if(t){const n=Kw(t).filter(r=>r.isLink);n.length&&n.forEach(r=>e.push({text:r.value,data:{href:r.href},index:r.start}))}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[];return this.options.autolink&&t.push(Iq({type:this.type,validate:this.options.validate})),this.options.openOnClick&&t.push(Mq({type:this.type})),this.options.linkOnPaste&&t.push(Dq({editor:this.editor,type:this.type})),t}}),Rq=Wr.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,considerAnyAsEmpty:!1,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new jr({key:new ss("placeholder"),props:{decorations:({doc:t,selection:e})=>{var n;const r=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:s}=e,i=[];if(!r)return null;const{firstChild:o}=t.content,a=o&&o.type.isLeaf,l=o&&o.isAtom,u=this.options.considerAnyAsEmpty?!0:o&&o.type.name===((n=t.type.contentMatch.defaultType)===null||n===void 0?void 0:n.name),d=t.content.childCount<=1&&o&&u&&o.nodeSize<=2&&(!a||!l);return t.descendants((f,h)=>{const p=s>=h&&s<=h+f.nodeSize,m=!f.isLeaf&&!f.childCount;if((p||!this.options.showOnlyCurrent)&&m){const y=[this.options.emptyNodeClass];d&&y.push(this.options.emptyEditorClass);const b=zs.node(h,h+f.nodeSize,{class:y.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:f,pos:h,hasAnchor:p}):this.options.placeholder});i.push(b)}return this.options.includeChildren}),vr.create(t,i)}}})]}}),Oq=yr.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",In(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}}),Pq=/^\s*(\[([( |x])?\])\s$/,Lq=yr.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList"}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>t.getAttribute("data-checked")==="true",renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",In(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:n,editor:r})=>{const s=document.createElement("li"),i=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div");return i.contentEditable="false",a.type="checkbox",a.addEventListener("change",u=>{if(!r.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:d}=u.target;r.isEditable&&typeof n=="function"&&r.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:f})=>{const h=n(),p=f.doc.nodeAt(h);return f.setNodeMarkup(h,void 0,{...p==null?void 0:p.attrs,checked:d}),!0}).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,d)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([u,d])=>{s.setAttribute(u,d)}),s.dataset.checked=t.attrs.checked,t.attrs.checked&&a.setAttribute("checked","checked"),i.append(a,o),s.append(i,l),Object.entries(e).forEach(([u,d])=>{s.setAttribute(u,d)}),{dom:s,contentDOM:l,update:u=>u.type!==this.type?!1:(s.dataset.checked=u.attrs.checked,u.attrs.checked?a.setAttribute("checked","checked"):a.removeAttribute("checked"),!0)}}},addInputRules(){return[Iu({find:Pq,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),$q=t=>{if(!t.children.length)return;const e=t.querySelectorAll("span");e&&e.forEach(n=>{var r,s;const i=n.getAttribute("style"),o=(s=(r=n.parentElement)===null||r===void 0?void 0:r.closest("span"))===null||s===void 0?void 0:s.getAttribute("style");n.setAttribute("style",`${o};${i}`)})},zq=oi.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{},mergeNestedSpanStyles:!1}},parseHTML(){return[{tag:"span",getAttrs:t=>t.hasAttribute("style")?(this.options.mergeNestedSpanStyles&&$q(t),{}):!1}]},renderHTML({HTMLAttributes:t}){return["span",In(this.options.HTMLAttributes,t),0]},addCommands(){return{removeEmptyTextStyle:()=>({tr:t})=>{const{selection:e}=t;return t.doc.nodesBetween(e.from,e.to,(n,r)=>{if(n.isTextblock)return!0;n.marks.filter(s=>s.type===this.type).some(s=>Object.values(s.attrs).some(i=>!!i))||t.removeMark(r,r+n.nodeSize,this.type)}),!0}}}}),Fq=Wr.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:t=>{var e;return(e=t.style.color)===null||e===void 0?void 0:e.replace(/['"]+/g,"")},renderHTML:t=>t.color?{style:`color: ${t.color}`}:{}}}}]},addCommands(){return{setColor:t=>({chain:e})=>e().setMark("textStyle",{color:t}).run(),unsetColor:()=>({chain:t})=>t().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}),Bq=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))$/,Uq=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))/g,Hq=oi.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",In(this.options.HTMLAttributes,t),0]},addCommands(){return{setHighlight:t=>({commands:e})=>e.setMark(this.name,t),toggleHighlight:t=>({commands:e})=>e.toggleMark(this.name,t),unsetHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[sc({find:Bq,type:this.type})]},addPasteRules(){return[Ya({find:Uq,type:this.type})]}}),ag=(t,e)=>e.view.domAtPos(t).node.offsetParent!==null,Vq=(t,e,n)=>{for(let r=t.depth;r>0;r-=1){const s=t.node(r),i=e(s),o=ag(t.start(r),n);if(i&&o)return{pos:r>0?t.before(r):0,start:t.start(r),depth:r,node:s}}},QT=(t,e)=>{const{state:n,view:r,extensionManager:s}=t,{schema:i,selection:o}=n,{empty:a,$anchor:l}=o,u=!!s.extensions.find(g=>g.name==="gapCursor");if(!a||l.parent.type!==i.nodes.detailsSummary||!u||e==="right"&&l.parentOffset!==l.parent.nodeSize-2)return!1;const d=Hu(g=>g.type===i.nodes.details)(o);if(!d)return!1;const f=Np(d.node,g=>g.type===i.nodes.detailsContent);if(!f.length||ag(d.start+f[0].pos+1,t))return!1;const p=n.doc.resolve(d.pos+d.node.nodeSize),m=rr.findFrom(p,1,!1);if(!m)return!1;const{tr:y}=n,b=new rr(m);return y.setSelection(b),y.scrollIntoView(),r.dispatch(y),!0},Wq=yr.create({name:"details",content:"detailsSummary detailsContent",group:"block",defining:!0,isolating:!0,allowGapCursor:!1,addOptions(){return{persist:!1,openClassName:"is-open",HTMLAttributes:{}}},addAttributes(){return this.options.persist?{open:{default:!1,parseHTML:t=>t.hasAttribute("open"),renderHTML:({open:t})=>t?{open:""}:{}}}:[]},parseHTML(){return[{tag:"details"}]},renderHTML({HTMLAttributes:t}){return["details",In(this.options.HTMLAttributes,t),0]},addNodeView(){return({editor:t,getPos:e,node:n,HTMLAttributes:r})=>{const s=document.createElement("div"),i=In(this.options.HTMLAttributes,r,{"data-type":this.name});Object.entries(i).forEach(([u,d])=>s.setAttribute(u,d));const o=document.createElement("button");o.type="button",s.append(o);const a=document.createElement("div");s.append(a);const l=u=>{if(u!==void 0)if(u){if(s.classList.contains(this.options.openClassName))return;s.classList.add(this.options.openClassName)}else{if(!s.classList.contains(this.options.openClassName))return;s.classList.remove(this.options.openClassName)}else s.classList.toggle(this.options.openClassName);const d=new Event("toggleDetailsContent"),f=a.querySelector(':scope > div[data-type="detailsContent"]');f==null||f.dispatchEvent(d)};return n.attrs.open&&setTimeout(()=>l()),o.addEventListener("click",()=>{if(l(),!this.options.persist){t.commands.focus(void 0,{scrollIntoView:!1});return}if(t.isEditable&&typeof e=="function"){const{from:u,to:d}=t.state.selection;t.chain().command(({tr:f})=>{const h=e(),p=f.doc.nodeAt(h);return(p==null?void 0:p.type)!==this.type?!1:(f.setNodeMarkup(h,void 0,{open:!p.attrs.open}),!0)}).setTextSelection({from:u,to:d}).focus(void 0,{scrollIntoView:!1}).run()}}),{dom:s,contentDOM:a,ignoreMutation(u){return u.type==="selection"?!1:!s.contains(u.target)||s===u.target},update:u=>u.type!==this.type?!1:(u.attrs.open!==void 0&&l(u.attrs.open),!0)}}},addCommands(){return{setDetails:()=>({state:t,chain:e})=>{var n;const{schema:r,selection:s}=t,{$from:i,$to:o}=s,a=i.blockRange(o);if(!a)return!1;const l=t.doc.slice(a.start,a.end);if(!r.nodes.detailsContent.contentMatch.matchFragment(l.content))return!1;const d=((n=l.toJSON())===null||n===void 0?void 0:n.content)||[];return e().insertContentAt({from:a.start,to:a.end},{type:this.name,content:[{type:"detailsSummary"},{type:"detailsContent",content:d}]}).setTextSelection(a.start+2).run()},unsetDetails:()=>({state:t,chain:e})=>{const{selection:n,schema:r}=t,s=Hu(g=>g.type===this.type)(n);if(!s)return!1;const i=Np(s.node,g=>g.type===r.nodes.detailsSummary),o=Np(s.node,g=>g.type===r.nodes.detailsContent);if(!i.length||!o.length)return!1;const a=i[0],l=o[0],u=s.pos,d=t.doc.resolve(u),f=u+s.node.nodeSize,h={from:u,to:f},p=l.node.content.toJSON()||[],m=d.parent.type.contentMatch.defaultType,b=[m==null?void 0:m.create(null,a.node.content).toJSON(),...p];return e().insertContentAt(h,b).setTextSelection(u+1).run()}}},addKeyboardShortcuts(){return{Backspace:()=>{const{schema:t,selection:e}=this.editor.state,{empty:n,$anchor:r}=e;return!n||r.parent.type!==t.nodes.detailsSummary?!1:r.parentOffset!==0?this.editor.commands.command(({tr:s})=>{const i=r.pos-1,o=r.pos;return s.delete(i,o),!0}):this.editor.commands.unsetDetails()},Enter:({editor:t})=>{const{state:e,view:n}=t,{schema:r,selection:s}=e,{$head:i}=s;if(i.parent.type!==r.nodes.detailsSummary)return!1;const o=ag(i.after()+1,t),a=o?e.doc.nodeAt(i.after()):i.node(-2);if(!a)return!1;const l=o?0:i.indexAfter(-1),u=Ow(a.contentMatchAt(l));if(!u||!a.canReplaceWith(l,l,u))return!1;const d=u.createAndFill();if(!d)return!1;const f=o?i.after()+1:i.after(-1),h=e.tr.replaceWith(f,f,d),p=h.doc.resolve(f),m=mn.near(p,1);return h.setSelection(m),h.scrollIntoView(),n.dispatch(h),!0},ArrowRight:({editor:t})=>QT(t,"right"),ArrowDown:({editor:t})=>QT(t,"down")}},addProseMirrorPlugins(){return[new jr({key:new ss("detailsSelection"),appendTransaction:(t,e,n)=>{const{editor:r,type:s}=this;if(!t.some(b=>b.selectionSet)||!e.selection.empty||!n.selection.empty||!S5(n,s.name))return;const{$from:a}=n.selection;if(ag(a.pos,r))return;const u=Vq(a,b=>b.type===s,r);if(!u)return;const d=Np(u.node,b=>b.type===n.schema.nodes.detailsSummary);if(!d.length)return;const f=d[0],p=(e.selection.from<n.selection.from?"forward":"backward")==="forward"?u.start+f.pos:u.pos+f.pos+f.node.nodeSize,m=pn.create(n.doc,p);return n.tr.setSelection(m)}})]}}),Kq=yr.create({name:"detailsSummary",content:"text*",defining:!0,selectable:!1,isolating:!0,addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"summary"}]},renderHTML({HTMLAttributes:t}){return["summary",In(this.options.HTMLAttributes,t),0]}}),Gq=yr.create({name:"detailsContent",content:"block+",defining:!0,selectable:!1,addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:`div[data-type="${this.name}"]`}]},renderHTML({HTMLAttributes:t}){return["div",In(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},addNodeView(){return({HTMLAttributes:t})=>{const e=document.createElement("div"),n=In(this.options.HTMLAttributes,t,{"data-type":this.name,hidden:"hidden"});return Object.entries(n).forEach(([r,s])=>e.setAttribute(r,s)),e.addEventListener("toggleDetailsContent",()=>{e.toggleAttribute("hidden")}),{dom:e,contentDOM:e,ignoreMutation(r){return r.type==="selection"?!1:!e.contains(r.target)||e===r.target},update:r=>r.type===this.type}}},addKeyboardShortcuts(){return{Enter:({editor:t})=>{const{state:e,view:n}=t,{selection:r}=e,{$from:s,empty:i}=r,o=Hu(N=>N.type===this.type)(r);if(!i||!o||!o.node.childCount)return!1;const a=s.index(o.depth),{childCount:l}=o.node;if(!(l===a+1))return!1;const d=o.node.type.contentMatch.defaultType,f=d==null?void 0:d.createAndFill();if(!f)return!1;const h=e.doc.resolve(o.pos+1),p=l-1,m=o.node.child(p),y=h.posAtIndex(p,o.depth);if(!m.eq(f))return!1;const g=s.node(-3);if(!g)return!1;const v=s.indexAfter(-3),w=Ow(g.contentMatchAt(v));if(!w||!g.canReplaceWith(v,v,w))return!1;const C=w.createAndFill();if(!C)return!1;const{tr:I}=e,k=s.after(-2);I.replaceWith(k,k,C);const D=I.doc.resolve(k),S=mn.near(D,1);I.setSelection(S);const T=y,_=y+m.nodeSize;return I.delete(T,_),I.scrollIntoView(),n.dispatch(I),!0}}}});function qq(t){var e;const{char:n,allowSpaces:r,allowToIncludeChar:s,allowedPrefixes:i,startOfLine:o,$position:a}=t,l=r&&!s,u=QK(n),d=new RegExp(`\\s${u}$`),f=o?"^":"",h=s?"":u,p=l?new RegExp(`${f}${u}.*?(?=\\s${h}|$)`,"gm"):new RegExp(`${f}(?:^)?${u}[^\\s${h}]*`,"gm"),m=((e=a.nodeBefore)===null||e===void 0?void 0:e.isText)&&a.nodeBefore.text;if(!m)return null;const y=a.pos-m.length,b=Array.from(m.matchAll(p)).pop();if(!b||b.input===void 0||b.index===void 0)return null;const g=b.input.slice(Math.max(0,b.index-1),b.index),v=new RegExp(`^[${i==null?void 0:i.join("")}\0]?$`).test(g);if(i!==null&&!v)return null;const w=y+b.index;let C=w+b[0].length;return l&&d.test(m.slice(C-1,C+1))&&(b[0]+=" ",C+=1),w<a.pos&&C>=a.pos?{range:{from:w,to:C},query:b[0].slice(n.length),text:b[0]}:null}const Yq=new ss("suggestion");function Jq({pluginKey:t=Yq,editor:e,char:n="@",allowSpaces:r=!1,allowToIncludeChar:s=!1,allowedPrefixes:i=[" "],startOfLine:o=!1,decorationTag:a="span",decorationClass:l="suggestion",decorationContent:u="",decorationEmptyClass:d="is-empty",command:f=()=>null,items:h=()=>[],render:p=()=>({}),allow:m=()=>!0,findSuggestionMatch:y=qq}){let b;const g=p==null?void 0:p(),v=new jr({key:t,view(){return{update:async(w,C)=>{var I,k,D,S,T,_,N;const A=(I=this.key)===null||I===void 0?void 0:I.getState(C),O=(k=this.key)===null||k===void 0?void 0:k.getState(w.state),L=A.active&&O.active&&A.range.from!==O.range.from,V=!A.active&&O.active,E=A.active&&!O.active,j=!V&&!E&&A.query!==O.query,H=V||L&&j,W=j||L,R=E||L&&j;if(!H&&!W&&!R)return;const ae=R&&!H?A:O,re=w.dom.querySelector(`[data-decoration-id="${ae.decorationId}"]`);b={editor:e,range:ae.range,query:ae.query,text:ae.text,items:[],command:$=>f({editor:e,range:ae.range,props:$}),decorationNode:re,clientRect:re?()=>{var $;const{decorationId:z}=($=this.key)===null||$===void 0?void 0:$.getState(e.state),le=w.dom.querySelector(`[data-decoration-id="${z}"]`);return(le==null?void 0:le.getBoundingClientRect())||null}:null},H&&((D=g==null?void 0:g.onBeforeStart)===null||D===void 0||D.call(g,b)),W&&((S=g==null?void 0:g.onBeforeUpdate)===null||S===void 0||S.call(g,b)),(W||H)&&(b.items=await h({editor:e,query:ae.query})),R&&((T=g==null?void 0:g.onExit)===null||T===void 0||T.call(g,b)),W&&((_=g==null?void 0:g.onUpdate)===null||_===void 0||_.call(g,b)),H&&((N=g==null?void 0:g.onStart)===null||N===void 0||N.call(g,b))},destroy:()=>{var w;b&&((w=g==null?void 0:g.onExit)===null||w===void 0||w.call(g,b))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(w,C,I,k){const{isEditable:D}=e,{composing:S}=e.view,{selection:T}=w,{empty:_,from:N}=T,A={...C};if(A.composing=S,D&&(_||e.view.composing)){(N<C.range.from||N>C.range.to)&&!S&&!C.composing&&(A.active=!1);const O=y({char:n,allowSpaces:r,allowToIncludeChar:s,allowedPrefixes:i,startOfLine:o,$position:T.$from}),L=`id_${Math.floor(Math.random()*4294967295)}`;O&&m({editor:e,state:k,range:O.range,isActive:C.active})?(A.active=!0,A.decorationId=C.decorationId?C.decorationId:L,A.range=O.range,A.query=O.query,A.text=O.text):A.active=!1}else A.active=!1;return A.active||(A.decorationId=null,A.range={from:0,to:0},A.query=null,A.text=null),A}},props:{handleKeyDown(w,C){var I;const{active:k,range:D}=v.getState(w.state);return k&&((I=g==null?void 0:g.onKeyDown)===null||I===void 0?void 0:I.call(g,{view:w,event:C,range:D}))||!1},decorations(w){const{active:C,range:I,decorationId:k,query:D}=v.getState(w);if(!C)return null;const S=!(D!=null&&D.length),T=[l];return S&&T.push(d),vr.create(w.doc,[zs.inline(I.from,I.to,{nodeName:a,class:T.join(" "),"data-decoration-id":k,"data-decoration-content":u})])}}});return v}function Xq({editor:t,overrideSuggestionOptions:e,extensionName:n,char:r="@"}){const s=new ss;return{editor:t,char:r,pluginKey:s,command:({editor:i,range:o,props:a})=>{var l,u,d;const f=i.view.state.selection.$to.nodeAfter;((l=f==null?void 0:f.text)===null||l===void 0?void 0:l.startsWith(" "))&&(o.to+=1),i.chain().focus().insertContentAt(o,[{type:n,attrs:{...a,mentionSuggestionChar:r}},{type:"text",text:" "}]).run(),(d=(u=i.view.dom.ownerDocument.defaultView)===null||u===void 0?void 0:u.getSelection())===null||d===void 0||d.collapseToEnd()},allow:({state:i,range:o})=>{const a=i.doc.resolve(o.from),l=i.schema.nodes[n];return!!a.parent.type.contentMatch.matchType(l)},...e}}function z5(t){return(t.options.suggestions.length?t.options.suggestions:[t.options.suggestion]).map(e=>Xq({editor:t.editor,overrideSuggestionOptions:e,extensionName:t.name,char:e.char}))}function ZT(t,e){const n=z5(t),r=n.find(s=>s.char===e);return r||(n.length?n[0]:null)}const Qq=yr.create({name:"mention",priority:101,addOptions(){return{HTMLAttributes:{},renderText({node:t,suggestion:e}){var n,r;return`${(n=e==null?void 0:e.char)!==null&&n!==void 0?n:"@"}${(r=t.attrs.label)!==null&&r!==void 0?r:t.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:t,node:e,suggestion:n}){var r,s;return["span",In(this.HTMLAttributes,t.HTMLAttributes),`${(r=n==null?void 0:n.char)!==null&&r!==void 0?r:"@"}${(s=e.attrs.label)!==null&&s!==void 0?s:e.attrs.id}`]},suggestions:[],suggestion:{}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}},mentionSuggestionChar:{default:"@",parseHTML:t=>t.getAttribute("data-mention-suggestion-char"),renderHTML:t=>({"data-mention-suggestion-char":t.mentionSuggestionChar})}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:e}){const n=ZT(this,t.attrs.mentionSuggestionChar);if(this.options.renderLabel!==void 0)return console.warn("renderLabel is deprecated use renderText and renderHTML instead"),["span",In({"data-type":this.name},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:t,suggestion:n})];const r={...this.options};r.HTMLAttributes=In({"data-type":this.name},this.options.HTMLAttributes,e);const s=this.options.renderHTML({options:r,node:t,suggestion:n});return typeof s=="string"?["span",In({"data-type":this.name},this.options.HTMLAttributes,e),s]:s},renderText({node:t}){const e={options:this.options,node:t,suggestion:ZT(this,t.attrs.mentionSuggestionChar)};return this.options.renderLabel!==void 0?(console.warn("renderLabel is deprecated use renderText and renderHTML instead"),this.options.renderLabel(e)):this.options.renderText(e)},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:t,state:e})=>{let n=!1;const{selection:r}=e,{empty:s,anchor:i}=r;if(!s)return!1;e.doc.nodesBetween(i-1,i,(l,u)=>{if(l.type.name===this.name)return n=!0,t.insertText(this.options.deleteTriggerWithBackspace?"":this.options.suggestion.char||"",u,u+l.nodeSize),!1});let o=new Ho,a=0;return e.doc.nodesBetween(i-1,i,(l,u)=>{if(l.type.name===this.name)return n=!0,o=l,a=u,!1}),n&&t.insertText(this.options.deleteTriggerWithBackspace?"":o.attrs.mentionSuggestionChar,a,a+o.nodeSize),n})}},addProseMirrorPlugins(){return z5(this).map(Jq)}}),Zq=(t,e)=>Wr.create({name:"keyboardNavigation",addKeyboardShortcuts(){return{Enter:()=>(e&&e(),!1),Tab:({editor:n})=>{var a;if(n.isEmpty)return!1;const{state:r}=n,{selection:s}=r,{$from:i}=s;return((a=i.node(-1))==null?void 0:a.type.name)==="listItem"?n.commands.sinkListItem("listItem"):n.commands.insertContent("")},"Shift-Tab":({editor:n})=>{var a;if(n.isEmpty)return!1;const{state:r}=n,{selection:s}=r,{$from:i}=s;if(((a=i.node(-1))==null?void 0:a.type.name)==="listItem")return n.commands.liftListItem("listItem");{const{$anchor:l}=s,d=l.parent.textContent.substring(0,l.parentOffset).match(/[\u00A0 ]{1,4}$/);if(d){const f=l.pos-d[0].length,h=l.pos;return n.commands.deleteRange({from:f,to:h}),!0}}return!0},"Mod-Enter":()=>t?(t(),!0):!1,Escape:()=>!1,"Mod-Alt-5":({editor:n})=>n.chain().focus().toggleBulletList().run(),"Mod-Alt-6":({editor:n})=>n.chain().focus().toggleOrderedList().run(),"Mod-Alt-7":({editor:n})=>n.isActive("details")?n.chain().focus().unsetDetails().run():n.chain().focus().setDetails().run()}}}),eY=oi.create({name:"timestamp",inclusive:!1,excludes:"",addAttributes(){return{time:{default:0,parseHTML:t=>parseInt(t.getAttribute("data-time")||"0",10),renderHTML:t=>t.time?{"data-time":t.time}:{}},recordingId:{default:null,parseHTML:t=>t.getAttribute("data-recording-id"),renderHTML:t=>t.recordingId?{"data-recording-id":t.recordingId,class:"timestamp-marker cursor-pointer hover:bg-indigo-100/50 hover:text-indigo-800 transition-colors rounded-sm px-[1px]",title:`Jump to ${Math.floor(t.time/1e3)}s`}:{}}}},parseHTML(){return[{tag:"span[data-time]"}]},renderHTML({HTMLAttributes:t}){return["span",In(t),0]}}),tY=yr.create({name:"paragraph",priority:1e3,group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",In(t),0]},addAttributes(){return{"data-paragraph-id":{default:null,parseHTML:t=>t.getAttribute("data-paragraph-id"),renderHTML:t=>t["data-paragraph-id"]?{"data-paragraph-id":t["data-paragraph-id"]}:{}},"data-timestamp":{default:null,parseHTML:t=>t.getAttribute("data-timestamp"),renderHTML:t=>t["data-timestamp"]?{"data-timestamp":t["data-timestamp"],class:"cursor-pointer hover:bg-indigo-50/50 transition-colors rounded px-1 -mx-1",title:"Click to play audio"}:{}}}}}),nY=oi.create({name:"attachmentLink",addAttributes(){return{attachmentUrls:{default:[],parseHTML:t=>{const e=t.getAttribute("data-attachment-urls");return e?JSON.parse(e):[]},renderHTML:t=>!t.attachmentUrls||t.attachmentUrls.length===0?{}:{"data-attachment-urls":JSON.stringify(t.attachmentUrls)}}}},parseHTML(){return[{tag:"span[data-attachment-link]"}]},renderHTML({HTMLAttributes:t}){return["span",In(t,{"data-attachment-link":"true",class:"attachment-link-text cursor-pointer"}),0]}}),rY=({node:t})=>null,sY=yr.create({name:"audioMarker",group:"inline",inline:!0,atom:!0,addAttributes(){return{id:{default:null},time:{default:null},label:{default:"0:00"},fileName:{default:null}}},parseHTML(){return[{tag:'span[data-type="audio-marker"]'}]},renderHTML({HTMLAttributes:t}){return["span",In(t,{"data-type":"audio-marker"})]},addNodeView(){return fG(rY)}}),n0=x.forwardRef(({initialContent:t,onChange:e,onExit:n,onPolish:r,onEditorReady:s,editable:i=!0,className:o="",placeholder:a="",textSizeClass:l="text-base",descFontClass:u="font-normal",autoFocus:d=!1,onAudioMarkerClick:f,activeMarkerIds:h,onMarkersChange:p,attachments:m=[],taskColor:y="#6366f1",availableTags:b=[],onCreateTag:g},v)=>{const{t:w}=x.useContext(En),[C,I]=x.useState(!1),[k,D]=x.useState({top:0,left:0}),S=x.useRef(null),T=x.useRef(b),_=x.useRef(g),N=x.useRef(!1),A=x.useRef(e);x.useEffect(()=>{T.current=b},[b]),x.useEffect(()=>{_.current=g},[g]),x.useEffect(()=>{A.current=e},[e]);const[O,L]=x.useState(!1),[V,E]=x.useState({top:0,left:0}),[j,H]=x.useState(null),[W,R]=x.useState([]),[ae,re]=x.useState(!1),[$,z]=x.useState({top:0,left:0}),[le,$e]=x.useState([]);x.useImperativeHandle(v,()=>({toggleRecording:()=>{},chain:()=>{var ge;return(ge=Ge.current)==null?void 0:ge.chain()},focus:()=>{var ge;return(ge=Ge.current)==null?void 0:ge.commands.focus()},insertContent:ge=>{var ie;return(ie=Ge.current)==null?void 0:ie.commands.insertContent(ge)},getEditor:()=>Ge.current}));const Be=x.useContext(Lu),se=(Be==null?void 0:Be.isRecording)||!1,Se=(Be==null?void 0:Be.recordingTime)||0,ce=(Be==null?void 0:Be.addMarker)||(()=>null),Ee=(Be==null?void 0:Be.currentRecordingId)||null,He=x.useRef(Se),tt=x.useRef(Ee),ut=x.useRef(se);x.useEffect(()=>{He.current=Se,tt.current=Ee,ut.current=se},[Se,Ee,se]);const Ge=x.useRef(null);x.useEffect(()=>{window.__activeMarkerIds=h,window.dispatchEvent(new CustomEvent("active-markers-change",{detail:{ids:h}}))},[h]),x.useEffect(()=>{const ge=ie=>{var me;f&&((me=ie.detail)==null?void 0:me.time)!==void 0&&f(ie.detail.time)};return window.addEventListener("audio-marker-click",ge),()=>{window.removeEventListener("audio-marker-click",ge)}},[f]);const mt=ge=>{const ie=Math.floor(ge/1e3),me=Math.floor(ie/60),Q=ie%60;return`${me.toString().padStart(2,"0")}:${Q.toString().padStart(2,"0")}`},ht=()=>{if(se&&Ge.current){const ge=ce();if(ge){const{id:ie,time:me}=ge;console.log("Enter pressed during recording at:",me);const Q=mt(me);Ge.current.chain().insertContent({type:"audioMarker",attrs:{id:ie,time:me,label:Q}}).insertContent(" ").run()}}},Ie=iG({extensions:[fq.configure({paragraph:!1,bulletList:{keepMarks:!0,keepAttributes:!1},orderedList:{keepMarks:!0,keepAttributes:!1}}),tY,eY,sY,zq,Fq,Hq.configure({multicolor:!0}),Aq.configure({openOnClick:!1,autolink:!0}),Rq.configure({placeholder:a||w("addNotePlaceholder"),emptyEditorClass:"is-editor-empty before:content-[attr(data-placeholder)] before:text-slate-300 before:float-left before:pointer-events-none before:h-0"}),Oq,Lq.configure({nested:!0}),Wq.configure({persist:!0,HTMLAttributes:{class:"details"}}),Kq,Gq,nY,Qq.configure({HTMLAttributes:{class:"tag-mention"},renderLabel({node:ge}){return ge.attrs.label??ge.attrs.id},suggestion:{char:"@",allowSpaces:!1,items:({query:ge})=>{const ie=T.current;if(!ge)return ie.slice(0,10);const me=ge.toLowerCase();return ie.filter(X=>X.name.toLowerCase().includes(me)).slice(0,10)},render:()=>{let ge=null,ie=0,me=[],Q=null;return{onStart:X=>{var ke;N.current=!0,me=X.items,ie=0,ge=document.createElement("div"),ge.className="mention-suggestion-popup fixed z-[99999] bg-white dark:bg-gray-800 shadow-lg rounded-lg border border-gray-200 dark:border-gray-700 py-1 min-w-[200px] max-w-[300px] max-h-[300px] overflow-y-auto",document.body.appendChild(ge),Q={command:X.command,query:X.query,range:X.range,onKeyDown:({event:ee})=>{if(ee.key==="ArrowDown"){ee.preventDefault();const pe=me.length>0?me.length:0,_t=(Q==null?void 0:Q.query)&&Q.query.trim().length>0?pe+1:pe;return ie=(ie+1)%_t,Q==null||Q.updateItems(me,Q.query),!0}if(ee.key==="ArrowUp"){ee.preventDefault();const Re=(Q==null?void 0:Q.query)&&Q.query.trim().length>0?me.length+1:me.length;return ie=(ie-1+Re)%Re,Q==null||Q.updateItems(me,Q.query),!0}return ee.key==="Enter"?(ee.preventDefault(),Q==null||Q.selectItem(ie),!0):ee.key==="Escape"?(ee.preventDefault(),!0):!1},updateItems:(ee,pe)=>{if(me=ee,!ge)return;const Re=pe&&pe.trim().length>0&&!ee.some(_t=>_t.name.toLowerCase()===pe.toLowerCase());if(ge.innerHTML="",ee.length===0&&!Re){ge.innerHTML='<div class="px-3 py-2 text-sm text-gray-400"></div>';return}if(ee.forEach((_t,Nt)=>{const ot=document.createElement("div");ot.className=`px-3 py-2 cursor-pointer flex items-center gap-2 text-sm ${Nt===ie?"bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,ot.innerHTML=`
                                                <span class="w-2 h-2 rounded-full" style="background-color: ${_t.color||"#6366f1"}"></span>
                                                <span class="truncate">${_t.name}</span>
                                            `,ot.addEventListener("mouseenter",()=>{ie=Nt,Q==null||Q.updateItems(me,pe)}),ot.addEventListener("mousedown",Ot=>{Ot.preventDefault(),Q==null||Q.selectItem(Nt)}),ge.appendChild(ot)}),Re){const _t=ee.length,Nt=document.createElement("div");Nt.className=`px-3 py-2 cursor-pointer flex items-center gap-2 text-sm border-t border-gray-100 dark:border-gray-700 ${ie===_t?"bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,Nt.innerHTML=`
                                                <span class="text-green-500">+</span>
                                                <span> "<strong>${pe}</strong>"</span>
                                            `,Nt.addEventListener("mouseenter",()=>{ie=_t,Q==null||Q.updateItems(me,pe)}),Nt.addEventListener("mousedown",ot=>{ot.preventDefault(),Q==null||Q.selectItem(_t)}),ge.appendChild(Nt)}},selectItem:async ee=>{const pe=(Q==null?void 0:Q.query)&&Q.query.trim().length>0&&!me.some(ot=>ot.name.toLowerCase()===Q.query.toLowerCase()),Re=Q==null?void 0:Q.command,_t=Q==null?void 0:Q.range,Nt=Ge.current;if(ee<me.length){const ot=me[ee];Re&&Re({id:ot.id,label:ot.name})}else if(pe&&_.current&&_t&&Nt){const ot=Q.query.trim(),{from:Ot,to:we}=_t;ge&&(ge.remove(),ge=null),N.current=!1;const qe=await _.current(ot);qe&&Ge.current&&Ge.current.chain().focus().deleteRange({from:Ot,to:we}).insertContentAt(Ot,{type:"mention",attrs:{id:qe.id,label:qe.name}}).run()}}},Q.updateItems(me,X.query);const he=(ke=X.clientRect)==null?void 0:ke.call(X);he&&ge&&(ge.style.left=`${he.left}px`,ge.style.top=`${he.bottom+5}px`)},onUpdate:X=>{var ke;me=X.items,Q&&(Q.query=X.query,Q.range=X.range,ie=0,Q.updateItems(me,X.query));const he=(ke=X.clientRect)==null?void 0:ke.call(X);he&&ge&&(ge.style.left=`${he.left}px`,ge.style.top=`${he.bottom+5}px`)},onKeyDown:X=>(Q==null?void 0:Q.onKeyDown(X))??!1,onExit:()=>{N.current=!1,ge&&(ge.remove(),ge=null),Q=null}}}}}),Zq(n,ht)],content:t,editable:i,editorProps:{attributes:{class:`prose prose-sm max-w-none focus:outline-none min-h-[100px] text-theme-secondary ${l} ${u} leading-relaxed custom-scrollbar selection:bg-indigo-100`,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"}},onUpdate:({editor:ge})=>{if(!window.__imeComposing){if(e){const ie=ge.getHTML();e(ge.isEmpty?"":ie)}if(p){const ie=[];ge.state.doc.descendants(me=>{me.type.name==="audioMarker"&&me.attrs.id&&ie.push({id:me.attrs.id,time:me.attrs.time||0})}),p(ie)}}},onCreate:({editor:ge})=>{if(s&&s(ge),p){const ie=[];ge.state.doc.descendants(me=>{me.type.name==="audioMarker"&&me.attrs.id&&ie.push({id:me.attrs.id,time:me.attrs.time||0})}),p(ie)}},onSelectionUpdate:({editor:ge})=>{if(window.__imeComposing)return;S.current&&clearTimeout(S.current);const{from:ie,to:me}=ge.state.selection;ie!==me&&i?S.current=setTimeout(()=>{const Q=window.getSelection();if(Q&&Q.rangeCount>0){const he=Q.getRangeAt(0).getBoundingClientRect(),ke={top:he.bottom+5,left:he.left+he.width/2};D(ke),E(ke),I(!0)}},500):(I(!1),L(!1))}});return x.useEffect(()=>{if(!Ie)return;const ge=({transaction:he})=>{if(!window.__imeComposing&&ut.current&&He.current>=0&&he.docChanged){const ke=He.current,{selection:ee}=Ie.state;if(!ee.empty)return;const pe=ee.$from,Re=pe.parent.textContent.substring(0,pe.parentOffset),_t=Re.lastIndexOf("@");if(_t!==-1&&!Re.substring(_t+1).includes(" ")||N.current)return;const ot=pe.marks().find(we=>we.type.name==="timestamp");let Ot=!0;if(ot){const we=ot.attrs.time;ke-we<2e3&&(Ot=!1)}if(Ot){const we=tt.current;Ie.commands.setMark("timestamp",{time:ke,recordingId:we})}else ot&&Ie.commands.setMark("timestamp",ot.attrs)}};let ie=null;const me=()=>{window.__imeComposing=!0,Ie&&(ie=Ie.state.selection.from)},Q=()=>{if(window.__imeComposing=!1,ut.current&&He.current>=0&&Ie&&ie!==null){const he=He.current,ke=tt.current,ee=ie;ie=null,setTimeout(()=>{if(!Ie)return;const{selection:pe}=Ie.state,Re=pe.from;if(Re>ee){const _t=pe.$from,Nt=_t.parent.textContent.substring(0,_t.parentOffset),ot=Nt.lastIndexOf("@");if(ot!==-1&&!Nt.substring(ot+1).includes(" ")){if(A.current){const we=Ie.getHTML();A.current(Ie.isEmpty?"":we)}return}try{Ie.chain().setTextSelection({from:ee,to:Re}).setMark("timestamp",{time:he,recordingId:ke}).setTextSelection(Re).run()}catch(Ot){console.warn("Failed to apply timestamp mark:",Ot)}}if(A.current){const _t=Ie.getHTML();A.current(Ie.isEmpty?"":_t)}},50)}else ie=null,Ie&&A.current&&setTimeout(()=>{if(Ie&&A.current){const he=Ie.getHTML();A.current(Ie.isEmpty?"":he)}},50)},X=Ie.view.dom;return X.addEventListener("compositionstart",me),X.addEventListener("compositionend",Q),Ie.on("selectionUpdate",ge),Ie.on("update",ge),()=>{Ie.off("update",ge),Ie.off("selectionUpdate",ge),X.removeEventListener("compositionstart",me),X.removeEventListener("compositionend",Q),window.__imeComposing=!1}},[Ie,se]),x.useEffect(()=>{if(Ie&&t!==void 0){const ge=Ie.getHTML(),ie=me=>me==="<p></p>"||me==="";if(ie(ge)&&ie(t)||Ie.isFocused)return;ge!==t&&Ie.commands.setContent(t,!1)}},[t,Ie]),x.useEffect(()=>{Ie&&(Ge.current=Ie,Ie.toggleRecording=()=>{},Ie.isRecording=!1,Ie.scrollToParagraph=ge=>{if(!ge)return;let ie=null,me=null,Q=null;Ie.state.doc.descendants((ke,ee)=>{if(ke.type.name==="audioMarker"&&ke.attrs.id===ge)return ie=ee,!1}),ie!==null&&Ie.state.doc.descendants((ke,ee)=>{if(ke.type.name==="audioMarker"&&ee>ie&&me===null)return me=ee,Q=ke.attrs.id,!1});const X=me!==null?me:ie,he=Q!==null?Q:ge;X!==null&&(Ie.chain().setTextSelection(X).scrollIntoView().focus().run(),setTimeout(()=>{const ke=document.querySelector(`[data-id="${he}"]`);ke&&(ke.style.transition="all 0.3s ease",ke.style.backgroundColor="#fef08a",ke.style.color="#854d0e",ke.style.borderColor="#fbbf24",ke.style.transform="scale(1.2)",setTimeout(()=>{ke.style.transition="all 1s ease",ke.style.backgroundColor="",ke.style.color="",ke.style.borderColor="",ke.style.transform=""},2e3))},50))})},[Ie]),x.useEffect(()=>{Ie&&d&&Ie.commands.focus("end")},[Ie,d]),x.useEffect(()=>{Ie&&s&&s(Ie)},[Ie,s]),Ie?c.jsxs("div",{className:`note-editor-wrapper ${o} relative bg-transparent border-none`,style:{"--attachment-link-color":y},onClickCapture:ge=>{const ie=ge.target,me=ie.closest("[data-time]");if(me){const he=me.getAttribute("data-time"),ke=me.getAttribute("data-recording-id")||void 0,ee=parseInt(he||"0",10);if(!isNaN(ee)&&f){f(ee,ke);return}}const Q=ie.closest("[data-timestamp]");if(Q){const he=parseInt(Q.getAttribute("data-timestamp")||"0",10);if(!isNaN(he)&&f){f(he);return}}const X=ie.closest("[data-attachment-link]");if(X){ge.preventDefault(),ge.stopPropagation();const he=X.getAttribute("data-attachment-urls");if(he)try{const ke=JSON.parse(he);if(Array.isArray(ke)&&ke.length>0){const ee=X.getBoundingClientRect();z({top:ee.bottom+5,left:Math.min(ee.left,window.innerWidth-340)}),$e(ke),re(!0)}}catch(ke){console.error("Failed to parse attachment URLs",ke)}}else ie.closest(".attachment-popup")||re(!1)},children:[c.jsx(rG,{editor:Ie}),C&&c.jsxs("div",{className:"fixed z-50 bg-white rounded-lg shadow-2xl border border-gray-200 p-2 flex gap-1.5 animate-in fade-in zoom-in-95 duration-200 items-center",style:{top:`${k.top}px`,left:`${k.left}px`,transform:"translateX(-50%)"},children:[c.jsx("button",{type:"button",onMouseDown:ge=>{ge.preventDefault(),ge.stopPropagation();const{from:ie,to:me}=Ie.state.selection,Q=Ie.state.doc.textBetween(ie,me," ");r==null||r(Q,{from:ie,to:me},k),I(!1)},className:"w-8 h-8 rounded-lg bg-indigo-50 hover:bg-indigo-100 text-indigo-600 shadow-sm hover:scale-105 hover:ring-2 hover:ring-indigo-300 transition-all active:scale-95 flex items-center justify-center cursor-pointer",title:"AI  (Polish Selection)",children:c.jsx(Ds,{size:16})}),m.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"h-4 w-[1px] bg-gray-200 mx-1"}),c.jsx("button",{type:"button",onMouseDown:ge=>{ge.preventDefault(),ge.stopPropagation();const{from:ie,to:me}=Ie.state.selection;if(ie!==me){H({from:ie,to:me});const Q=Ie.getAttributes("attachmentLink");R((Q==null?void 0:Q.attachmentUrls)||[]),L(!0),I(!1)}},className:"w-8 h-8 rounded-lg bg-amber-50 hover:bg-amber-100 text-amber-600 shadow-sm hover:scale-105 hover:ring-2 hover:ring-amber-300 transition-all active:scale-95 flex items-center justify-center cursor-pointer",title:" (Alt+A)",children:c.jsx(ho,{size:16})})]}),c.jsx("div",{className:"h-4 w-[1px] bg-gray-200 mx-1"}),[{color:"#000000",label:""},{color:"#ef4444",label:""},{color:"#f97316",label:""},{color:"#f59e0b",label:""},{color:"#10b981",label:""},{color:"#3b82f6",label:""},{color:"#8b5cf6",label:""},{color:"#ec4899",label:""},{color:"#64748b",label:""}].map(({color:ge,label:ie})=>c.jsx("button",{type:"button",onMouseDown:me=>{me.preventDefault(),me.stopPropagation(),Ie==null||Ie.chain().focus().setColor(ge).run(),I(!1)},className:"w-7 h-7 rounded-full border-2 border-white shadow-md hover:scale-110 hover:ring-2 hover:ring-indigo-300 transition-all active:scale-95 cursor-pointer",style:{backgroundColor:ge},title:ie},ge))]}),O&&m.length>0&&c.jsxs("div",{className:"fixed z-[99999] bg-white rounded-xl shadow-2xl border border-gray-100 p-3 min-w-[220px] max-w-[300px] animate-in fade-in zoom-in-95 duration-150",style:{top:V.top,left:V.left},children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("span",{className:"text-xs font-bold text-gray-600",children:""}),c.jsx("button",{type:"button",onClick:()=>{L(!1),R([])},className:"p-0.5 text-gray-400 hover:text-gray-600",children:c.jsx(un,{size:14})})]}),c.jsx("div",{className:"space-y-1 max-h-[200px] overflow-y-auto mb-2",children:m.map((ge,ie)=>{const me=W.includes(ge.url);return c.jsxs("button",{type:"button",onClick:()=>{R(me?Q=>Q.filter(X=>X!==ge.url):Q=>[...Q,ge.url])},className:`w-full text-left px-2 py-1.5 rounded-lg flex items-center gap-2 text-xs transition-colors ${me?"bg-indigo-50 text-indigo-700 border border-indigo-200":"hover:bg-gray-50 text-gray-600"}`,children:[c.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center flex-shrink-0 ${me?"bg-indigo-500 border-indigo-500 text-white":"border-gray-300"}`,children:me&&c.jsx(Xn,{size:12})}),c.jsx(ho,{size:12,className:me?"text-indigo-400":"text-gray-400"}),c.jsx("span",{className:"truncate",children:ge.name})]},ie)})}),c.jsxs("div",{className:"flex gap-2 pt-2 border-t border-gray-100",children:[c.jsx("button",{type:"button",onClick:()=>{L(!1),R([])},className:"flex-1 px-3 py-1.5 text-xs text-gray-500 hover:bg-gray-50 rounded-lg transition-colors",children:""}),c.jsxs("button",{type:"button",onClick:()=>{j&&Ie&&(W.length>0?Ie.chain().focus().setTextSelection(j).setMark("attachmentLink",{attachmentUrls:W}).run():Ie.chain().focus().setTextSelection(j).unsetMark("attachmentLink").run(),L(!1),H(null),R([]))},className:"flex-1 px-3 py-1.5 text-xs bg-indigo-500 text-white hover:bg-indigo-600 rounded-lg transition-colors font-medium",children:[" ",W.length>0&&`(${W.length})`]})]})]}),ae&&le.length>0&&c.jsxs("div",{className:"fixed z-[99999] bg-white rounded-xl shadow-2xl border border-gray-100 p-3 min-w-[220px] max-w-[320px] animate-in fade-in zoom-in-95 duration-150",style:{top:$.top,left:$.left},children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("span",{className:"text-xs font-bold text-gray-600",children:""}),c.jsx("button",{type:"button",onClick:()=>re(!1),className:"p-0.5 text-gray-400 hover:text-gray-600",children:c.jsx(un,{size:14})})]}),c.jsx("div",{className:"space-y-1.5",children:le.map((ge,ie)=>{const me=m.find(Q=>Q.url===ge);return me?c.jsxs("div",{className:"flex items-center justify-between gap-2 px-2 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[c.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[c.jsx(ho,{size:12,className:"text-gray-400 flex-shrink-0"}),c.jsx("span",{className:"text-xs text-gray-600 truncate",children:me.name})]}),c.jsx("button",{type:"button",onClick:()=>{fetch(ge).then(Q=>Q.blob()).then(Q=>{const X=window.URL.createObjectURL(Q),he=document.createElement("a");he.href=X,he.download=me.name,document.body.appendChild(he),he.click(),document.body.removeChild(he),window.URL.revokeObjectURL(X)})},className:"p-1 text-indigo-500 hover:text-indigo-700 hover:bg-indigo-50 rounded transition-colors",title:"",children:c.jsx(lu,{size:14})})]},ie):null})})]}),c.jsx("style",{dangerouslySetInnerHTML:{__html:`
                .ProseMirror p.is-editor-empty:first-child::before {
                    content: attr(data-placeholder);
                    float: left;
                    color: #cbd5e1;
                    pointer-events: none;
                    height: 0;
                }
                .ProseMirror {
                    word-break: break-word;
                    max-height: calc(30 * 1.625em);
                    overflow-y: auto;
                }
                .note-editor-wrapper.h-full .ProseMirror {
                    height: 100%;
                    max-height: 100%;
                }
                .ProseMirror h1 { font-size: 1.25rem; font-weight: 700; margin-top: 0.5rem; margin-bottom: 0.5rem; color: #334155; }
                .ProseMirror h2 { font-size: 1.1rem; font-weight: 700; margin-top: 0.5rem; margin-bottom: 0.5rem; color: #475569; }
                .ProseMirror ul { list-style-type: disc; list-style-position: outside; padding-left: 2rem; margin-top: 0.25rem; margin-left: 0; }
                .ProseMirror ol { list-style-type: decimal; list-style-position: outside; padding-left: 2rem; margin-top: 0.25rem; margin-left: 0; }
                .ProseMirror li { padding-left: 0.25rem; }
            `}})]}):null});var eC;(function(t){t.STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object"})(eC||(eC={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tC;(function(t){t.LANGUAGE_UNSPECIFIED="language_unspecified",t.PYTHON="python"})(tC||(tC={}));var nC;(function(t){t.OUTCOME_UNSPECIFIED="outcome_unspecified",t.OUTCOME_OK="outcome_ok",t.OUTCOME_FAILED="outcome_failed",t.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(nC||(nC={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rC=["user","model","function","system"];var sC;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(sC||(sC={}));var iC;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(iC||(iC={}));var oC;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(oC||(oC={}));var aC;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER"})(aC||(aC={}));var Gd;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.OTHER="OTHER"})(Gd||(Gd={}));var lC;(function(t){t.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",t.RETRIEVAL_QUERY="RETRIEVAL_QUERY",t.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",t.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",t.CLASSIFICATION="CLASSIFICATION",t.CLUSTERING="CLUSTERING"})(lC||(lC={}));var cC;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(cC||(cC={}));var uC;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(uC||(uC={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hs extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class wc extends hs{constructor(e,n){super(e),this.response=n}}class F5 extends hs{constructor(e,n,r,s){super(e),this.status=n,this.statusText=r,this.errorDetails=s}}class Ua extends hs{}class B5 extends hs{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iY="https://generativelanguage.googleapis.com",oY="v1beta",aY="0.24.1",lY="genai-js";var ic;(function(t){t.GENERATE_CONTENT="generateContent",t.STREAM_GENERATE_CONTENT="streamGenerateContent",t.COUNT_TOKENS="countTokens",t.EMBED_CONTENT="embedContent",t.BATCH_EMBED_CONTENTS="batchEmbedContents"})(ic||(ic={}));class cY{constructor(e,n,r,s,i){this.model=e,this.task=n,this.apiKey=r,this.stream=s,this.requestOptions=i}toString(){var e,n;const r=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||oY;let i=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||iY}/${r}/${this.model}:${this.task}`;return this.stream&&(i+="?alt=sse"),i}}function uY(t){const e=[];return t!=null&&t.apiClient&&e.push(t.apiClient),e.push(`${lY}/${aY}`),e.join(" ")}async function dY(t){var e;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",uY(t.requestOptions)),n.append("x-goog-api-key",t.apiKey);let r=(e=t.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(s){throw new Ua(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${s.message}`)}for(const[s,i]of r.entries()){if(s==="x-goog-api-key")throw new Ua(`Cannot set reserved header name ${s}`);if(s==="x-goog-api-client")throw new Ua(`Header name ${s} can only be set using the apiClient field`);n.append(s,i)}}return n}async function fY(t,e,n,r,s,i){const o=new cY(t,e,n,r,i);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},gY(i)),{method:"POST",headers:await dY(o),body:s})}}async function lh(t,e,n,r,s,i={},o=fetch){const{url:a,fetchOptions:l}=await fY(t,e,n,r,s,i);return hY(a,l,o)}async function hY(t,e,n=fetch){let r;try{r=await n(t,e)}catch(s){pY(s,t)}return r.ok||await mY(r,t),r}function pY(t,e){let n=t;throw n.name==="AbortError"?(n=new B5(`Request aborted when fetching ${e.toString()}: ${t.message}`),n.stack=t.stack):t instanceof F5||t instanceof Ua||(n=new hs(`Error fetching from ${e.toString()}: ${t.message}`),n.stack=t.stack),n}async function mY(t,e){let n="",r;try{const s=await t.json();n=s.error.message,s.error.details&&(n+=` ${JSON.stringify(s.error.details)}`,r=s.error.details)}catch{}throw new F5(`Error fetching from ${e.toString()}: [${t.status} ${t.statusText}] ${n}`,t.status,t.statusText,r)}function gY(t){const e={};if((t==null?void 0:t.signal)!==void 0||(t==null?void 0:t.timeout)>=0){const n=new AbortController;(t==null?void 0:t.timeout)>=0&&setTimeout(()=>n.abort(),t.timeout),t!=null&&t.signal&&t.signal.addEventListener("abort",()=>{n.abort()}),e.signal=n.signal}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gw(t){return t.text=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Dp(t.candidates[0]))throw new wc(`${xa(t)}`,t);return yY(t)}else if(t.promptFeedback)throw new wc(`Text not available. ${xa(t)}`,t);return""},t.functionCall=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Dp(t.candidates[0]))throw new wc(`${xa(t)}`,t);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),dC(t)[0]}else if(t.promptFeedback)throw new wc(`Function call not available. ${xa(t)}`,t)},t.functionCalls=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Dp(t.candidates[0]))throw new wc(`${xa(t)}`,t);return dC(t)}else if(t.promptFeedback)throw new wc(`Function call not available. ${xa(t)}`,t)},t}function yY(t){var e,n,r,s;const i=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const o of(s=(r=t.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)o.text&&i.push(o.text),o.executableCode&&i.push("\n```"+o.executableCode.language+`
`+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&i.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}function dC(t){var e,n,r,s;const i=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const o of(s=(r=t.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)o.functionCall&&i.push(o.functionCall);if(i.length>0)return i}const xY=[Gd.RECITATION,Gd.SAFETY,Gd.LANGUAGE];function Dp(t){return!!t.finishReason&&xY.includes(t.finishReason)}function xa(t){var e,n,r;let s="";if((!t.candidates||t.candidates.length===0)&&t.promptFeedback)s+="Response was blocked",!((e=t.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${t.promptFeedback.blockReason}`),!((n=t.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(s+=`: ${t.promptFeedback.blockReasonMessage}`);else if(!((r=t.candidates)===null||r===void 0)&&r[0]){const i=t.candidates[0];Dp(i)&&(s+=`Candidate was blocked due to ${i.finishReason}`,i.finishMessage&&(s+=`: ${i.finishMessage}`))}return s}function Bf(t){return this instanceof Bf?(this.v=t,this):new Bf(t)}function bY(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),s,i=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(h){r[h]&&(s[h]=function(p){return new Promise(function(m,y){i.push([h,p,m,y])>1||a(h,p)})})}function a(h,p){try{l(r[h](p))}catch(m){f(i[0][3],m)}}function l(h){h.value instanceof Bf?Promise.resolve(h.value.v).then(u,d):f(i[0][2],h)}function u(h){a("next",h)}function d(h){a("throw",h)}function f(h,p){h(p),i.shift(),i.length&&a(i[0][0],i[0][1])}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fC=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function vY(t){const e=t.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=SY(e),[r,s]=n.tee();return{stream:kY(r),response:wY(s)}}async function wY(t){const e=[],n=t.getReader();for(;;){const{done:r,value:s}=await n.read();if(r)return Gw(_Y(e));e.push(s)}}function kY(t){return bY(this,arguments,function*(){const n=t.getReader();for(;;){const{value:r,done:s}=yield Bf(n.read());if(s)break;yield yield Bf(Gw(r))}})}function SY(t){const e=t.getReader();return new ReadableStream({start(r){let s="";return i();function i(){return e.read().then(({value:o,done:a})=>{if(a){if(s.trim()){r.error(new hs("Failed to parse stream"));return}r.close();return}s+=o;let l=s.match(fC),u;for(;l;){try{u=JSON.parse(l[1])}catch{r.error(new hs(`Error parsing JSON response: "${l[1]}"`));return}r.enqueue(u),s=s.substring(l[0].length),l=s.match(fC)}return i()}).catch(o=>{let a=o;throw a.stack=o.stack,a.name==="AbortError"?a=new B5("Request aborted when reading from the stream"):a=new hs("Error reading from the stream"),a})}}})}function _Y(t){const e=t[t.length-1],n={promptFeedback:e==null?void 0:e.promptFeedback};for(const r of t){if(r.candidates){let s=0;for(const i of r.candidates)if(n.candidates||(n.candidates=[]),n.candidates[s]||(n.candidates[s]={index:s}),n.candidates[s].citationMetadata=i.citationMetadata,n.candidates[s].groundingMetadata=i.groundingMetadata,n.candidates[s].finishReason=i.finishReason,n.candidates[s].finishMessage=i.finishMessage,n.candidates[s].safetyRatings=i.safetyRatings,i.content&&i.content.parts){n.candidates[s].content||(n.candidates[s].content={role:i.content.role||"user",parts:[]});const o={};for(const a of i.content.parts)a.text&&(o.text=a.text),a.functionCall&&(o.functionCall=a.functionCall),a.executableCode&&(o.executableCode=a.executableCode),a.codeExecutionResult&&(o.codeExecutionResult=a.codeExecutionResult),Object.keys(o).length===0&&(o.text=""),n.candidates[s].content.parts.push(o)}s++}r.usageMetadata&&(n.usageMetadata=r.usageMetadata)}return n}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function U5(t,e,n,r){const s=await lh(e,ic.STREAM_GENERATE_CONTENT,t,!0,JSON.stringify(n),r);return vY(s)}async function H5(t,e,n,r){const i=await(await lh(e,ic.GENERATE_CONTENT,t,!1,JSON.stringify(n),r)).json();return{response:Gw(i)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V5(t){if(t!=null){if(typeof t=="string")return{role:"system",parts:[{text:t}]};if(t.text)return{role:"system",parts:[t]};if(t.parts)return t.role?t:{role:"system",parts:t.parts}}}function Uf(t){let e=[];if(typeof t=="string")e=[{text:t}];else for(const n of t)typeof n=="string"?e.push({text:n}):e.push(n);return TY(e)}function TY(t){const e={role:"user",parts:[]},n={role:"function",parts:[]};let r=!1,s=!1;for(const i of t)"functionResponse"in i?(n.parts.push(i),s=!0):(e.parts.push(i),r=!0);if(r&&s)throw new hs("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!s)throw new hs("No content is provided for sending chat message.");return r?e:n}function CY(t,e){var n;let r={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(n=e==null?void 0:e.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const s=t.generateContentRequest!=null;if(t.contents){if(s)throw new Ua("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=t.contents}else if(s)r=Object.assign(Object.assign({},r),t.generateContentRequest);else{const i=Uf(t);r.contents=[i]}return{generateContentRequest:r}}function hC(t){let e;return t.contents?e=t:e={contents:[Uf(t)]},t.systemInstruction&&(e.systemInstruction=V5(t.systemInstruction)),e}function EY(t){return typeof t=="string"||Array.isArray(t)?{content:Uf(t)}:t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pC=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],NY={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function jY(t){let e=!1;for(const n of t){const{role:r,parts:s}=n;if(!e&&r!=="user")throw new hs(`First content should be with role 'user', got ${r}`);if(!rC.includes(r))throw new hs(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(rC)}`);if(!Array.isArray(s))throw new hs("Content should have 'parts' property with an array of Parts");if(s.length===0)throw new hs("Each Content should have at least one part");const i={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const a of s)for(const l of pC)l in a&&(i[l]+=1);const o=NY[r];for(const a of pC)if(!o.includes(a)&&i[a]>0)throw new hs(`Content with role '${r}' can't contain '${a}' part`);e=!0}}function mC(t){var e;if(t.candidates===void 0||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;if(n===void 0||n.parts===void 0||n.parts.length===0)return!1;for(const r of n.parts)if(r===void 0||Object.keys(r).length===0||r.text!==void 0&&r.text==="")return!1;return!0}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gC="SILENT_ERROR";class IY{constructor(e,n,r,s={}){this.model=n,this.params=r,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,r!=null&&r.history&&(jY(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,n={}){var r,s,i,o,a,l;await this._sendPromise;const u=Uf(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,u]},f=Object.assign(Object.assign({},this._requestOptions),n);let h;return this._sendPromise=this._sendPromise.then(()=>H5(this._apiKey,this.model,d,f)).then(p=>{var m;if(mC(p.response)){this._history.push(u);const y=Object.assign({parts:[],role:"model"},(m=p.response.candidates)===null||m===void 0?void 0:m[0].content);this._history.push(y)}else{const y=xa(p.response);y&&console.warn(`sendMessage() was unsuccessful. ${y}. Inspect response object for details.`)}h=p}).catch(p=>{throw this._sendPromise=Promise.resolve(),p}),await this._sendPromise,h}async sendMessageStream(e,n={}){var r,s,i,o,a,l;await this._sendPromise;const u=Uf(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,u]},f=Object.assign(Object.assign({},this._requestOptions),n),h=U5(this._apiKey,this.model,d,f);return this._sendPromise=this._sendPromise.then(()=>h).catch(p=>{throw new Error(gC)}).then(p=>p.response).then(p=>{if(mC(p)){this._history.push(u);const m=Object.assign({},p.candidates[0].content);m.role||(m.role="model"),this._history.push(m)}else{const m=xa(p);m&&console.warn(`sendMessageStream() was unsuccessful. ${m}. Inspect response object for details.`)}}).catch(p=>{p.message!==gC&&console.error(p)}),h}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MY(t,e,n,r){return(await lh(e,ic.COUNT_TOKENS,t,!1,JSON.stringify(n),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DY(t,e,n,r){return(await lh(e,ic.EMBED_CONTENT,t,!1,JSON.stringify(n),r)).json()}async function AY(t,e,n,r){const s=n.requests.map(o=>Object.assign(Object.assign({},o),{model:e}));return(await lh(e,ic.BATCH_EMBED_CONTENTS,t,!1,JSON.stringify({requests:s}),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yC{constructor(e,n,r={}){this.apiKey=e,this._requestOptions=r,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=V5(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(e,n={}){var r;const s=hC(e),i=Object.assign(Object.assign({},this._requestOptions),n);return H5(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}async generateContentStream(e,n={}){var r;const s=hC(e),i=Object.assign(Object.assign({},this._requestOptions),n);return U5(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}startChat(e){var n;return new IY(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},e),this._requestOptions)}async countTokens(e,n={}){const r=CY(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),n);return MY(this.apiKey,this.model,r,s)}async embedContent(e,n={}){const r=EY(e),s=Object.assign(Object.assign({},this._requestOptions),n);return DY(this.apiKey,this.model,r,s)}async batchEmbedContents(e,n={}){const r=Object.assign(Object.assign({},this._requestOptions),n);return AY(this.apiKey,this.model,e,r)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RY{constructor(e){this.apiKey=e}getGenerativeModel(e,n){if(!e.model)throw new hs("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new yC(this.apiKey,e,n)}getGenerativeModelFromCachedContent(e,n,r){if(!e.name)throw new Ua("Cached content must contain a `name` field.");if(!e.model)throw new Ua("Cached content must contain a `model` field.");const s=["model","systemInstruction"];for(const o of s)if(n!=null&&n[o]&&e[o]&&(n==null?void 0:n[o])!==e[o]){if(o==="model"){const a=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,l=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(a===l)continue}throw new Ua(`Different value for "${o}" specified in modelParams (${n[o]}) and cachedContent (${e[o]})`)}const i=Object.assign(Object.assign({},n),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new yC(this.apiKey,i,r)}}const OY="AIzaSyBbGFzQkwhEmNQduYxaZnnxxHR-DlQjj98",qw=()=>({provider:localStorage.getItem("ai_provider")||"gemini",googleKey:localStorage.getItem("google_ai_key")||OY,openaiKey:localStorage.getItem("openai_api_key")||"",baseUrl:localStorage.getItem("ai_base_url")||"https://api.openai.com/v1",modelName:localStorage.getItem("ai_model")||"gpt-3.5-turbo"}),PY=()=>{const{googleKey:t}=qw();if(!t)throw new Error("Google API Key is missing. Please set it in Settings.");return new RY(t)},LY=async(t,e=!0)=>{var a,l;const{openaiKey:n,baseUrl:r,modelName:s}=qw();if(!n)throw new Error("API Key is missing. Please set it in Settings.");let i=r.trim();i.endsWith("/")&&(i=i.slice(0,-1));const o=`${i}/chat/completions`;console.log(`Using OpenAI-compatible provider: ${i}, model: ${s}`);try{const u=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:s,messages:[{role:"system",content:e?"You are a helpful assistant. Output valid JSON only.":"You are a helpful assistant."},{role:"user",content:t}],temperature:.7})});if(!u.ok){const h=await u.text();throw new Error(`API Error: ${u.status} ${u.statusText} - ${h}`)}const f=((l=(a=(await u.json()).choices[0])==null?void 0:a.message)==null?void 0:l.content)||"";if(console.log("AI Raw Response:",f),!e)return f;try{let h=f;const p=f.match(/\{[\s\S]*\}/);p&&(h=p[0]);const m=h.replace(/```json/g,"").replace(/```/g,"").trim();try{return JSON.parse(m)}catch(y){if(m.includes('"fullResponse": "')){const b='"fullResponse": "',g=m.indexOf(b)+b.length,v=m.lastIndexOf('"');if(g>b.length-1&&v>g)return{fullResponse:m.substring(g,v).replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")}}throw y}}catch(h){throw console.warn("OpenAI JSON Parse failed"),h}}catch(u){throw console.error("OpenAI Provider Error:",u),u}},$Y=async t=>{const e=PY(),n=["gemini-1.5-flash","gemini-2.0-flash-001","gemini-2.0-flash-lite-preview-02-05","gemini-1.5-pro","gemini-pro"];let r;for(const s of n)try{console.log(`[SimpleAI] Attempting to use model: ${s}`);const l=(await(await e.getGenerativeModel({model:s}).generateContent(t)).response).text();if(l)return l.trim()}catch(i){console.warn(`[SimpleAI] Model ${s} failed:`,i),r=i;continue}throw r||new Error("All AI models failed to respond")},cc=async t=>{const{provider:e}=qw();if(e==="openai"){const n=await LY(t,!1);return typeof n=="string"?n:JSON.stringify(n)}return await $Y(t)},W5=async(t,e,n)=>{const r=` AI 
  
  ${e}
  ${t}
  
  `,s=n&&n.trim()?n:r,i=(n==null?void 0:n.includes(""))||(n==null?void 0:n.includes("")),o=e.trim()?`
"${e}"

`:"",a=!!(n&&n.trim()),l=["1. Traditional Chinese","2.  JSON "];i?(l.push("3. "),l.push("4. ")):a?(l.push("3. "),l.push("4. ......"),l.push("5.  Markdown ")):(l.push("3. "),l.push("4.  Markdown ****"),l.push("5. "));const u=`
${s}

${o}
"${t}"


${l.join(`
`)}`;try{if(!t.trim())throw new Error("");return{fullResponse:await cc(u)}}catch(d){throw console.error("AI Assistant Error:",d),d}},K5=async t=>{const e=` AI Prompt 10 

  
  "${t}"`;try{return(await cc(e)).trim().replace(/^"|"$/g,"")}catch(n){return console.error("Generate Prompt Title Error:",n),t.slice(0,15)+(t.length>15?"...":"")}},zY=async(t,e)=>{const n=t.length>3e3?t.slice(0,3e3)+"...":t;let r;e?r=`${e}

  
  ---
    ${n}
  ---

    `:r=`SEOSEO

  
  1. 
  2. 15 - 30
  3. 
  4. 
  5. 
  6. 
  7. 

  
  - "5"
    - "90%"
    - ""

  
  ---
    ${n}
  ---

    SEO`,console.log("Generating SEO title for content length:",t.length);try{const s=await cc(r);return console.log("SEO Title AI result:",s),s.trim().replace(/^["]/g,"").replace(/["]$/g,"").replace(/^\d+[\.\s]+/,"").replace(/^[:]\s*/i,"").trim()||s.trim()}catch(s){throw console.error("Generate SEO Title Error:",s),s}},FY=async(t,e)=>{const n=t.length>3e3?t.slice(0,3e3)+"...":t,s=`SEO


(SEO)

${e.length>0?`
${e.join(", ")}`:""}


1. ---
2. 
3.  3-7 
4.  10 
5. 
6. 
7. 


---
${n}
---

`;console.log("Generating SEO keywords for content length:",t.length),console.log("Content preview:",t.slice(0,200));try{const i=await cc(s);return console.log("SEO Keywords AI result:",i),i.split(/[,\n]/).map(a=>a.trim()).filter(a=>a.length>0&&a.length<=20).slice(0,7)}catch(i){throw console.error("Generate SEO Keywords Error:",i),i}},BY=async(t,e,n,r,s,i)=>{const o=s.existingSchedule&&s.existingSchedule.length>0?`
Existing Schedule (Potential Conflicts):
${s.existingSchedule.join(`
`)}`:"",a=s.pastExperiences&&s.pastExperiences.length>0?`
Relevant Past Experience:
${s.pastExperiences.join(`
`)}`:"",l=`
Role:  AI (Chief Administrative Officer)

Source Task:
- : "${t}"
- /: "${e||"()"}"
- : ${n||""}
- : ${r||""}
- : ${s.today}
${i?`
: "${i}"`:""}
${o}
${a}

Instructions:
1. 
2.  (Relevant Past Experience)() 
3.  (Existing Schedule)() description 
4. 
5. 
   - "title": 
   - "description": 
   - "start_date": YYYY-MM-DD 
   - "due_date": YYYY-MM-DD 
6. "subtasks": 

Output Rules:
-  JSON 
-  Markdown... JSON
- 
- description  title 

JSON Format:
[
  {
    "title": "",
    "description": "...",
    "start_date": "YYYY-MM-DD",
    "due_date": "YYYY-MM-DD",
    "subtasks": []
  }
]
`;try{const u=await cc(l);console.log("Mission 72 Raw Output:",u);let d=u;const f=u.match(/\[[\s\S]*\]/);return f&&(d=f[0]),d=d.replace(/```json/g,"").replace(/```/g,"").trim(),JSON.parse(d)}catch(u){throw console.error("Mission 72 Planning Error:",u),new Error("AI ")}},UY=async(t,e)=>{if(e.length===0)return null;const n=e.map(s=>`- ${s.name} (ID: ${s.id}, : ${s.depth})`).join(`
`),r=`${t}


${n}


1. 
2. 
3.  "NONE"
4. 

 ID "NONE"`;try{const i=(await cc(r)).trim().replace(/["""'']/g,"");if(i==="NONE"||i.toLowerCase()==="none")return null;const o=e.find(l=>l.id===i);if(o)return o.id;const a=e.find(l=>i.toLowerCase().includes(l.name.toLowerCase())||l.name.toLowerCase().includes(i.toLowerCase()));return a?a.id:null}catch(s){return console.error("Find Best Parent Keyword Error:",s),null}},HY=async(t,e,n,r=[])=>{const s=`
 GTD (Getting Things Done) **** GTD 



- ${t.title}
- ${t.description||"()"}
- ${t.status}
- ${t.created_at}
- ${t.due_date||""}
- ()${t.start_date||""}
- ${t.tags.join(", ")||""}
- ${t.project_title||" ()"}

 ()
${e.length>0?e.join(`
`):"()"}


${r.map(i=>`${i.role==="user"?"":"GTD"}: ${i.content}`).join(`
`)}


"${n}"

GTD  (current_stage)
1. capture (): 
2. clarify (): 
3. organize (): ** (start_date) start_time (HH:MM) (due_date)**
4. engage (): 


1. ******** \`actions\` JSON
2. ****
3. **** \`start_date\`
4. ************ \`actions\` JSON reminder_minutes

 (JSON Only)
{
  "reply": "...",
  "current_stage": "capture" | "clarify" | "organize" | "engage",
  "actions": [
    { "type": "update_task", "params": { "start_date": "YYYY-MM-DD", "start_time": "09:00", "reminder_minutes": 0 } },
    { "type": "add_subtasks", "params": { "tasks": [{ "title": "...", "start_date": "...", "reminder_minutes": 10 }] } }
  ]
}
* \`actions\` 

 JSON
`;try{const i=await cc(s);let o=i;const a=i.match(/\{[\s\S]*\}/);return a&&(o=a[0]),o=o.replace(/```json/g,"").replace(/```/g,"").trim(),JSON.parse(o)}catch(i){return console.error("GTD Coach Error:",i),{reply:"",current_stage:"capture",actions:[]}}};function VY(t,e){const n=e||{};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const WY=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,KY=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,GY={};function xC(t,e){return((e||GY).jsx?KY:WY).test(t)}const qY=/[ \t\n\f\r]/g;function YY(t){return typeof t=="object"?t.type==="text"?bC(t.value):!1:bC(t)}function bC(t){return t.replace(qY,"")===""}class ch{constructor(e,n,r){this.normal=n,this.property=e,r&&(this.space=r)}}ch.prototype.normal={};ch.prototype.property={};ch.prototype.space=void 0;function G5(t,e){const n={},r={};for(const s of t)Object.assign(n,s.property),Object.assign(r,s.normal);return new ch(n,r,e)}function ub(t){return t.toLowerCase()}class Ks{constructor(e,n){this.attribute=n,this.property=e}}Ks.prototype.attribute="";Ks.prototype.booleanish=!1;Ks.prototype.boolean=!1;Ks.prototype.commaOrSpaceSeparated=!1;Ks.prototype.commaSeparated=!1;Ks.prototype.defined=!1;Ks.prototype.mustUseProperty=!1;Ks.prototype.number=!1;Ks.prototype.overloadedBoolean=!1;Ks.prototype.property="";Ks.prototype.spaceSeparated=!1;Ks.prototype.space=void 0;let JY=0;const gn=uc(),Sr=uc(),db=uc(),Lt=uc(),Wn=uc(),pu=uc(),Js=uc();function uc(){return 2**++JY}const fb=Object.freeze(Object.defineProperty({__proto__:null,boolean:gn,booleanish:Sr,commaOrSpaceSeparated:Js,commaSeparated:pu,number:Lt,overloadedBoolean:db,spaceSeparated:Wn},Symbol.toStringTag,{value:"Module"})),Py=Object.keys(fb);class Yw extends Ks{constructor(e,n,r,s){let i=-1;if(super(e,n),vC(this,"space",s),typeof r=="number")for(;++i<Py.length;){const o=Py[i];vC(this,Py[i],(r&fb[o])===fb[o])}}}Yw.prototype.defined=!0;function vC(t,e,n){n&&(t[e]=n)}function Vu(t){const e={},n={};for(const[r,s]of Object.entries(t.properties)){const i=new Yw(r,t.transform(t.attributes||{},r),s,t.space);t.mustUseProperty&&t.mustUseProperty.includes(r)&&(i.mustUseProperty=!0),e[r]=i,n[ub(r)]=r,n[ub(i.attribute)]=r}return new ch(e,n,t.space)}const q5=Vu({properties:{ariaActiveDescendant:null,ariaAtomic:Sr,ariaAutoComplete:null,ariaBusy:Sr,ariaChecked:Sr,ariaColCount:Lt,ariaColIndex:Lt,ariaColSpan:Lt,ariaControls:Wn,ariaCurrent:null,ariaDescribedBy:Wn,ariaDetails:null,ariaDisabled:Sr,ariaDropEffect:Wn,ariaErrorMessage:null,ariaExpanded:Sr,ariaFlowTo:Wn,ariaGrabbed:Sr,ariaHasPopup:null,ariaHidden:Sr,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Wn,ariaLevel:Lt,ariaLive:null,ariaModal:Sr,ariaMultiLine:Sr,ariaMultiSelectable:Sr,ariaOrientation:null,ariaOwns:Wn,ariaPlaceholder:null,ariaPosInSet:Lt,ariaPressed:Sr,ariaReadOnly:Sr,ariaRelevant:null,ariaRequired:Sr,ariaRoleDescription:Wn,ariaRowCount:Lt,ariaRowIndex:Lt,ariaRowSpan:Lt,ariaSelected:Sr,ariaSetSize:Lt,ariaSort:null,ariaValueMax:Lt,ariaValueMin:Lt,ariaValueNow:Lt,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function Y5(t,e){return e in t?t[e]:e}function J5(t,e){return Y5(t,e.toLowerCase())}const XY=Vu({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:pu,acceptCharset:Wn,accessKey:Wn,action:null,allow:null,allowFullScreen:gn,allowPaymentRequest:gn,allowUserMedia:gn,alt:null,as:null,async:gn,autoCapitalize:null,autoComplete:Wn,autoFocus:gn,autoPlay:gn,blocking:Wn,capture:null,charSet:null,checked:gn,cite:null,className:Wn,cols:Lt,colSpan:null,content:null,contentEditable:Sr,controls:gn,controlsList:Wn,coords:Lt|pu,crossOrigin:null,data:null,dateTime:null,decoding:null,default:gn,defer:gn,dir:null,dirName:null,disabled:gn,download:db,draggable:Sr,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:gn,formTarget:null,headers:Wn,height:Lt,hidden:db,high:Lt,href:null,hrefLang:null,htmlFor:Wn,httpEquiv:Wn,id:null,imageSizes:null,imageSrcSet:null,inert:gn,inputMode:null,integrity:null,is:null,isMap:gn,itemId:null,itemProp:Wn,itemRef:Wn,itemScope:gn,itemType:Wn,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:gn,low:Lt,manifest:null,max:null,maxLength:Lt,media:null,method:null,min:null,minLength:Lt,multiple:gn,muted:gn,name:null,nonce:null,noModule:gn,noValidate:gn,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:gn,optimum:Lt,pattern:null,ping:Wn,placeholder:null,playsInline:gn,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:gn,referrerPolicy:null,rel:Wn,required:gn,reversed:gn,rows:Lt,rowSpan:Lt,sandbox:Wn,scope:null,scoped:gn,seamless:gn,selected:gn,shadowRootClonable:gn,shadowRootDelegatesFocus:gn,shadowRootMode:null,shape:null,size:Lt,sizes:null,slot:null,span:Lt,spellCheck:Sr,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Lt,step:null,style:null,tabIndex:Lt,target:null,title:null,translate:null,type:null,typeMustMatch:gn,useMap:null,value:Sr,width:Lt,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Wn,axis:null,background:null,bgColor:null,border:Lt,borderColor:null,bottomMargin:Lt,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:gn,declare:gn,event:null,face:null,frame:null,frameBorder:null,hSpace:Lt,leftMargin:Lt,link:null,longDesc:null,lowSrc:null,marginHeight:Lt,marginWidth:Lt,noResize:gn,noHref:gn,noShade:gn,noWrap:gn,object:null,profile:null,prompt:null,rev:null,rightMargin:Lt,rules:null,scheme:null,scrolling:Sr,standby:null,summary:null,text:null,topMargin:Lt,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Lt,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:gn,disableRemotePlayback:gn,prefix:null,property:null,results:Lt,security:null,unselectable:null},space:"html",transform:J5}),QY=Vu({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Js,accentHeight:Lt,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Lt,amplitude:Lt,arabicForm:null,ascent:Lt,attributeName:null,attributeType:null,azimuth:Lt,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Lt,by:null,calcMode:null,capHeight:Lt,className:Wn,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Lt,diffuseConstant:Lt,direction:null,display:null,dur:null,divisor:Lt,dominantBaseline:null,download:gn,dx:null,dy:null,edgeMode:null,editable:null,elevation:Lt,enableBackground:null,end:null,event:null,exponent:Lt,externalResourcesRequired:null,fill:null,fillOpacity:Lt,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:pu,g2:pu,glyphName:pu,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Lt,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Lt,horizOriginX:Lt,horizOriginY:Lt,id:null,ideographic:Lt,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Lt,k:Lt,k1:Lt,k2:Lt,k3:Lt,k4:Lt,kernelMatrix:Js,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Lt,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Lt,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Lt,overlineThickness:Lt,paintOrder:null,panose1:null,path:null,pathLength:Lt,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Wn,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Lt,pointsAtY:Lt,pointsAtZ:Lt,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Js,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Js,rev:Js,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Js,requiredFeatures:Js,requiredFonts:Js,requiredFormats:Js,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Lt,specularExponent:Lt,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Lt,strikethroughThickness:Lt,string:null,stroke:null,strokeDashArray:Js,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Lt,strokeOpacity:Lt,strokeWidth:null,style:null,surfaceScale:Lt,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Js,tabIndex:Lt,tableValues:null,target:null,targetX:Lt,targetY:Lt,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Js,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Lt,underlineThickness:Lt,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Lt,values:null,vAlphabetic:Lt,vMathematical:Lt,vectorEffect:null,vHanging:Lt,vIdeographic:Lt,version:null,vertAdvY:Lt,vertOriginX:Lt,vertOriginY:Lt,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Lt,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:Y5}),X5=Vu({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),Q5=Vu({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:J5}),Z5=Vu({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),ZY={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},eJ=/[A-Z]/g,wC=/-[a-z]/g,tJ=/^data[-\w.:]+$/i;function nJ(t,e){const n=ub(e);let r=e,s=Ks;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&tJ.test(e)){if(e.charAt(4)==="-"){const i=e.slice(5).replace(wC,sJ);r="data"+i.charAt(0).toUpperCase()+i.slice(1)}else{const i=e.slice(4);if(!wC.test(i)){let o=i.replace(eJ,rJ);o.charAt(0)!=="-"&&(o="-"+o),e="data"+o}}s=Yw}return new s(r,e)}function rJ(t){return"-"+t.toLowerCase()}function sJ(t){return t.charAt(1).toUpperCase()}const iJ=G5([q5,XY,X5,Q5,Z5],"html"),Jw=G5([q5,QY,X5,Q5,Z5],"svg");function oJ(t){return t.join(" ").trim()}var Xw={},kC=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,aJ=/\n/g,lJ=/^\s*/,cJ=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,uJ=/^:\s*/,dJ=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,fJ=/^[;\s]*/,hJ=/^\s+|\s+$/g,pJ=`
`,SC="/",_C="*",Tl="",mJ="comment",gJ="declaration";function yJ(t,e){if(typeof t!="string")throw new TypeError("First argument must be a string");if(!t)return[];e=e||{};var n=1,r=1;function s(m){var y=m.match(aJ);y&&(n+=y.length);var b=m.lastIndexOf(pJ);r=~b?m.length-b:r+m.length}function i(){var m={line:n,column:r};return function(y){return y.position=new o(m),u(),y}}function o(m){this.start=m,this.end={line:n,column:r},this.source=e.source}o.prototype.content=t;function a(m){var y=new Error(e.source+":"+n+":"+r+": "+m);if(y.reason=m,y.filename=e.source,y.line=n,y.column=r,y.source=t,!e.silent)throw y}function l(m){var y=m.exec(t);if(y){var b=y[0];return s(b),t=t.slice(b.length),y}}function u(){l(lJ)}function d(m){var y;for(m=m||[];y=f();)y!==!1&&m.push(y);return m}function f(){var m=i();if(!(SC!=t.charAt(0)||_C!=t.charAt(1))){for(var y=2;Tl!=t.charAt(y)&&(_C!=t.charAt(y)||SC!=t.charAt(y+1));)++y;if(y+=2,Tl===t.charAt(y-1))return a("End of comment missing");var b=t.slice(2,y-2);return r+=2,s(b),t=t.slice(y),r+=2,m({type:mJ,comment:b})}}function h(){var m=i(),y=l(cJ);if(y){if(f(),!l(uJ))return a("property missing ':'");var b=l(dJ),g=m({type:gJ,property:TC(y[0].replace(kC,Tl)),value:b?TC(b[0].replace(kC,Tl)):Tl});return l(fJ),g}}function p(){var m=[];d(m);for(var y;y=h();)y!==!1&&(m.push(y),d(m));return m}return u(),p()}function TC(t){return t?t.replace(hJ,Tl):Tl}var xJ=yJ,bJ=Op&&Op.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Xw,"__esModule",{value:!0});Xw.default=wJ;const vJ=bJ(xJ);function wJ(t,e){let n=null;if(!t||typeof t!="string")return n;const r=(0,vJ.default)(t),s=typeof e=="function";return r.forEach(i=>{if(i.type!=="declaration")return;const{property:o,value:a}=i;s?e(o,a,i):a&&(n=n||{},n[o]=a)}),n}var r0={};Object.defineProperty(r0,"__esModule",{value:!0});r0.camelCase=void 0;var kJ=/^--[a-zA-Z0-9_-]+$/,SJ=/-([a-z])/g,_J=/^[^-]+$/,TJ=/^-(webkit|moz|ms|o|khtml)-/,CJ=/^-(ms)-/,EJ=function(t){return!t||_J.test(t)||kJ.test(t)},NJ=function(t,e){return e.toUpperCase()},CC=function(t,e){return"".concat(e,"-")},jJ=function(t,e){return e===void 0&&(e={}),EJ(t)?t:(t=t.toLowerCase(),e.reactCompat?t=t.replace(CJ,CC):t=t.replace(TJ,CC),t.replace(SJ,NJ))};r0.camelCase=jJ;var IJ=Op&&Op.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},MJ=IJ(Xw),DJ=r0;function hb(t,e){var n={};return!t||typeof t!="string"||(0,MJ.default)(t,function(r,s){r&&s&&(n[(0,DJ.camelCase)(r,e)]=s)}),n}hb.default=hb;var AJ=hb;const RJ=fg(AJ),eR=tR("end"),Qw=tR("start");function tR(t){return e;function e(n){const r=n&&n.position&&n.position[t]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function OJ(t){const e=Qw(t),n=eR(t);if(e&&n)return{start:e,end:n}}function qd(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?EC(t.position):"start"in t||"end"in t?EC(t):"line"in t||"column"in t?pb(t):""}function pb(t){return NC(t&&t.line)+":"+NC(t&&t.column)}function EC(t){return pb(t&&t.start)+"-"+pb(t&&t.end)}function NC(t){return t&&typeof t=="number"?t:1}class xs extends Error{constructor(e,n,r){super(),typeof n=="string"&&(r=n,n=void 0);let s="",i={},o=!1;if(n&&("line"in n&&"column"in n?i={place:n}:"start"in n&&"end"in n?i={place:n}:"type"in n?i={ancestors:[n],place:n.position}:i={...n}),typeof e=="string"?s=e:!i.cause&&e&&(o=!0,s=e.message,i.cause=e),!i.ruleId&&!i.source&&typeof r=="string"){const l=r.indexOf(":");l===-1?i.ruleId=r:(i.source=r.slice(0,l),i.ruleId=r.slice(l+1))}if(!i.place&&i.ancestors&&i.ancestors){const l=i.ancestors[i.ancestors.length-1];l&&(i.place=l.position)}const a=i.place&&"start"in i.place?i.place.start:i.place;this.ancestors=i.ancestors||void 0,this.cause=i.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file="",this.message=s,this.line=a?a.line:void 0,this.name=qd(i.place)||"1:1",this.place=i.place||void 0,this.reason=this.message,this.ruleId=i.ruleId||void 0,this.source=i.source||void 0,this.stack=o&&i.cause&&typeof i.cause.stack=="string"?i.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}xs.prototype.file="";xs.prototype.name="";xs.prototype.reason="";xs.prototype.message="";xs.prototype.stack="";xs.prototype.column=void 0;xs.prototype.line=void 0;xs.prototype.ancestors=void 0;xs.prototype.cause=void 0;xs.prototype.fatal=void 0;xs.prototype.place=void 0;xs.prototype.ruleId=void 0;xs.prototype.source=void 0;const Zw={}.hasOwnProperty,PJ=new Map,LJ=/[A-Z]/g,$J=new Set(["table","tbody","thead","tfoot","tr"]),zJ=new Set(["td","th"]),nR="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function FJ(t,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=e.filePath||void 0;let r;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=qJ(n,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=GJ(n,e.jsx,e.jsxs)}const s={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:r,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?Jw:iJ,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},i=rR(s,t,void 0);return i&&typeof i!="string"?i:s.create(t,s.Fragment,{children:i||void 0},void 0)}function rR(t,e,n){if(e.type==="element")return BJ(t,e,n);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return UJ(t,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return VJ(t,e,n);if(e.type==="mdxjsEsm")return HJ(t,e);if(e.type==="root")return WJ(t,e,n);if(e.type==="text")return KJ(t,e)}function BJ(t,e,n){const r=t.schema;let s=r;e.tagName.toLowerCase()==="svg"&&r.space==="html"&&(s=Jw,t.schema=s),t.ancestors.push(e);const i=iR(t,e.tagName,!1),o=YJ(t,e);let a=tk(t,e);return $J.has(e.tagName)&&(a=a.filter(function(l){return typeof l=="string"?!YY(l):!0})),sR(t,o,i,e),ek(o,a),t.ancestors.pop(),t.schema=r,t.create(e,i,o,n)}function UJ(t,e){if(e.data&&e.data.estree&&t.evaluater){const r=e.data.estree.body[0];return r.type,t.evaluater.evaluateExpression(r.expression)}Hf(t,e.position)}function HJ(t,e){if(e.data&&e.data.estree&&t.evaluater)return t.evaluater.evaluateProgram(e.data.estree);Hf(t,e.position)}function VJ(t,e,n){const r=t.schema;let s=r;e.name==="svg"&&r.space==="html"&&(s=Jw,t.schema=s),t.ancestors.push(e);const i=e.name===null?t.Fragment:iR(t,e.name,!0),o=JJ(t,e),a=tk(t,e);return sR(t,o,i,e),ek(o,a),t.ancestors.pop(),t.schema=r,t.create(e,i,o,n)}function WJ(t,e,n){const r={};return ek(r,tk(t,e)),t.create(e,t.Fragment,r,n)}function KJ(t,e){return e.value}function sR(t,e,n,r){typeof n!="string"&&n!==t.Fragment&&t.passNode&&(e.node=r)}function ek(t,e){if(e.length>0){const n=e.length>1?e:e[0];n&&(t.children=n)}}function GJ(t,e,n){return r;function r(s,i,o,a){const u=Array.isArray(o.children)?n:e;return a?u(i,o,a):u(i,o)}}function qJ(t,e){return n;function n(r,s,i,o){const a=Array.isArray(i.children),l=Qw(r);return e(s,i,o,a,{columnNumber:l?l.column-1:void 0,fileName:t,lineNumber:l?l.line:void 0},void 0)}}function YJ(t,e){const n={};let r,s;for(s in e.properties)if(s!=="children"&&Zw.call(e.properties,s)){const i=XJ(t,s,e.properties[s]);if(i){const[o,a]=i;t.tableCellAlignToStyle&&o==="align"&&typeof a=="string"&&zJ.has(e.tagName)?r=a:n[o]=a}}if(r){const i=n.style||(n.style={});i[t.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return n}function JJ(t,e){const n={};for(const r of e.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&t.evaluater){const i=r.data.estree.body[0];i.type;const o=i.expression;o.type;const a=o.properties[0];a.type,Object.assign(n,t.evaluater.evaluateExpression(a.argument))}else Hf(t,e.position);else{const s=r.name;let i;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&t.evaluater){const a=r.value.data.estree.body[0];a.type,i=t.evaluater.evaluateExpression(a.expression)}else Hf(t,e.position);else i=r.value===null?!0:r.value;n[s]=i}return n}function tk(t,e){const n=[];let r=-1;const s=t.passKeys?new Map:PJ;for(;++r<e.children.length;){const i=e.children[r];let o;if(t.passKeys){const l=i.type==="element"?i.tagName:i.type==="mdxJsxFlowElement"||i.type==="mdxJsxTextElement"?i.name:void 0;if(l){const u=s.get(l)||0;o=l+"-"+u,s.set(l,u+1)}}const a=rR(t,i,o);a!==void 0&&n.push(a)}return n}function XJ(t,e,n){const r=nJ(t.schema,e);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?VY(n):oJ(n)),r.property==="style"){let s=typeof n=="object"?n:QJ(t,String(n));return t.stylePropertyNameCase==="css"&&(s=ZJ(s)),["style",s]}return[t.elementAttributeNameCase==="react"&&r.space?ZY[r.property]||r.property:r.attribute,n]}}function QJ(t,e){try{return RJ(e,{reactCompat:!0})}catch(n){if(t.ignoreInvalidStyle)return{};const r=n,s=new xs("Cannot parse `style` attribute",{ancestors:t.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw s.file=t.filePath||void 0,s.url=nR+"#cannot-parse-style-attribute",s}}function iR(t,e,n){let r;if(!n)r={type:"Literal",value:e};else if(e.includes(".")){const s=e.split(".");let i=-1,o;for(;++i<s.length;){const a=xC(s[i])?{type:"Identifier",name:s[i]}:{type:"Literal",value:s[i]};o=o?{type:"MemberExpression",object:o,property:a,computed:!!(i&&a.type==="Literal"),optional:!1}:a}r=o}else r=xC(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(r.type==="Literal"){const s=r.value;return Zw.call(t.components,s)?t.components[s]:s}if(t.evaluater)return t.evaluater.evaluateExpression(r);Hf(t)}function Hf(t,e){const n=new xs("Cannot handle MDX estrees without `createEvaluater`",{ancestors:t.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=t.filePath||void 0,n.url=nR+"#cannot-handle-mdx-estrees-without-createevaluater",n}function ZJ(t){const e={};let n;for(n in t)Zw.call(t,n)&&(e[eX(n)]=t[n]);return e}function eX(t){let e=t.replace(LJ,tX);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function tX(t){return"-"+t.toLowerCase()}const Ly={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},nX={};function rX(t,e){const n=e||nX,r=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,s=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return oR(t,r,s)}function oR(t,e,n){if(sX(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return jC(t.children,e,n)}return Array.isArray(t)?jC(t,e,n):""}function jC(t,e,n){const r=[];let s=-1;for(;++s<t.length;)r[s]=oR(t[s],e,n);return r.join("")}function sX(t){return!!(t&&typeof t=="object")}const IC=document.createElement("i");function nk(t){const e="&"+t+";";IC.innerHTML=e;const n=IC.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===e?!1:n}function So(t,e,n,r){const s=t.length;let i=0,o;if(e<0?e=-e>s?0:s+e:e=e>s?s:e,n=n>0?n:0,r.length<1e4)o=Array.from(r),o.unshift(e,n),t.splice(...o);else for(n&&t.splice(e,n);i<r.length;)o=r.slice(i,i+1e4),o.unshift(e,0),t.splice(...o),i+=1e4,e+=1e4}function wi(t,e){return t.length>0?(So(t,t.length,0,e),t):e}const MC={}.hasOwnProperty;function iX(t){const e={};let n=-1;for(;++n<t.length;)oX(e,t[n]);return e}function oX(t,e){let n;for(n in e){const s=(MC.call(t,n)?t[n]:void 0)||(t[n]={}),i=e[n];let o;if(i)for(o in i){MC.call(s,o)||(s[o]=[]);const a=i[o];aX(s[o],Array.isArray(a)?a:a?[a]:[])}}}function aX(t,e){let n=-1;const r=[];for(;++n<e.length;)(e[n].add==="after"?t:r).push(e[n]);So(t,0,0,r)}function aR(t,e){const n=Number.parseInt(t,e);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function mu(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const co=sl(/[A-Za-z]/),ri=sl(/[\dA-Za-z]/),lX=sl(/[#-'*+\--9=?A-Z^-~]/);function mb(t){return t!==null&&(t<32||t===127)}const gb=sl(/\d/),cX=sl(/[\dA-Fa-f]/),uX=sl(/[!-/:-@[-`{-~]/);function dn(t){return t!==null&&t<-2}function Vs(t){return t!==null&&(t<0||t===32)}function An(t){return t===-2||t===-1||t===32}const dX=sl(/\p{P}|\p{S}/u),fX=sl(/\s/);function sl(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function Wu(t){const e=[];let n=-1,r=0,s=0;for(;++n<t.length;){const i=t.charCodeAt(n);let o="";if(i===37&&ri(t.charCodeAt(n+1))&&ri(t.charCodeAt(n+2)))s=2;else if(i<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(i))||(o=String.fromCharCode(i));else if(i>55295&&i<57344){const a=t.charCodeAt(n+1);i<56320&&a>56319&&a<57344?(o=String.fromCharCode(i,a),s=1):o=""}else o=String.fromCharCode(i);o&&(e.push(t.slice(r,n),encodeURIComponent(o)),r=n+s+1,o=""),s&&(n+=s,s=0)}return e.join("")+t.slice(r)}function Gn(t,e,n,r){const s=r?r-1:Number.POSITIVE_INFINITY;let i=0;return o;function o(l){return An(l)?(t.enter(n),a(l)):e(l)}function a(l){return An(l)&&i++<s?(t.consume(l),a):(t.exit(n),e(l))}}const hX={tokenize:pX};function pX(t){const e=t.attempt(this.parser.constructs.contentInitial,r,s);let n;return e;function r(a){if(a===null){t.consume(a);return}return t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),Gn(t,e,"linePrefix")}function s(a){return t.enter("paragraph"),i(a)}function i(a){const l=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=l),n=l,o(a)}function o(a){if(a===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(a);return}return dn(a)?(t.consume(a),t.exit("chunkText"),i):(t.consume(a),o)}}const mX={tokenize:gX},DC={tokenize:yX};function gX(t){const e=this,n=[];let r=0,s,i,o;return a;function a(w){if(r<n.length){const C=n[r];return e.containerState=C[1],t.attempt(C[0].continuation,l,u)(w)}return u(w)}function l(w){if(r++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,s&&v();const C=e.events.length;let I=C,k;for(;I--;)if(e.events[I][0]==="exit"&&e.events[I][1].type==="chunkFlow"){k=e.events[I][1].end;break}g(r);let D=C;for(;D<e.events.length;)e.events[D][1].end={...k},D++;return So(e.events,I+1,0,e.events.slice(C)),e.events.length=D,u(w)}return a(w)}function u(w){if(r===n.length){if(!s)return h(w);if(s.currentConstruct&&s.currentConstruct.concrete)return m(w);e.interrupt=!!(s.currentConstruct&&!s._gfmTableDynamicInterruptHack)}return e.containerState={},t.check(DC,d,f)(w)}function d(w){return s&&v(),g(r),h(w)}function f(w){return e.parser.lazy[e.now().line]=r!==n.length,o=e.now().offset,m(w)}function h(w){return e.containerState={},t.attempt(DC,p,m)(w)}function p(w){return r++,n.push([e.currentConstruct,e.containerState]),h(w)}function m(w){if(w===null){s&&v(),g(0),t.consume(w);return}return s=s||e.parser.flow(e.now()),t.enter("chunkFlow",{_tokenizer:s,contentType:"flow",previous:i}),y(w)}function y(w){if(w===null){b(t.exit("chunkFlow"),!0),g(0),t.consume(w);return}return dn(w)?(t.consume(w),b(t.exit("chunkFlow")),r=0,e.interrupt=void 0,a):(t.consume(w),y)}function b(w,C){const I=e.sliceStream(w);if(C&&I.push(null),w.previous=i,i&&(i.next=w),i=w,s.defineSkip(w.start),s.write(I),e.parser.lazy[w.start.line]){let k=s.events.length;for(;k--;)if(s.events[k][1].start.offset<o&&(!s.events[k][1].end||s.events[k][1].end.offset>o))return;const D=e.events.length;let S=D,T,_;for(;S--;)if(e.events[S][0]==="exit"&&e.events[S][1].type==="chunkFlow"){if(T){_=e.events[S][1].end;break}T=!0}for(g(r),k=D;k<e.events.length;)e.events[k][1].end={..._},k++;So(e.events,S+1,0,e.events.slice(D)),e.events.length=k}}function g(w){let C=n.length;for(;C-- >w;){const I=n[C];e.containerState=I[1],I[0].exit.call(e,t)}n.length=w}function v(){s.write([null]),i=void 0,s=void 0,e.containerState._closeFlow=void 0}}function yX(t,e,n){return Gn(t,t.attempt(this.parser.constructs.document,e,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function AC(t){if(t===null||Vs(t)||fX(t))return 1;if(dX(t))return 2}function rk(t,e,n){const r=[];let s=-1;for(;++s<t.length;){const i=t[s].resolveAll;i&&!r.includes(i)&&(e=i(e,n),r.push(i))}return e}const yb={name:"attention",resolveAll:xX,tokenize:bX};function xX(t,e){let n=-1,r,s,i,o,a,l,u,d;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(r=n;r--;)if(t[r][0]==="exit"&&t[r][1].type==="attentionSequence"&&t[r][1]._open&&e.sliceSerialize(t[r][1]).charCodeAt(0)===e.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[r][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[r][1].end.offset-t[r][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;l=t[r][1].end.offset-t[r][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const f={...t[r][1].end},h={...t[n][1].start};RC(f,-l),RC(h,l),o={type:l>1?"strongSequence":"emphasisSequence",start:f,end:{...t[r][1].end}},a={type:l>1?"strongSequence":"emphasisSequence",start:{...t[n][1].start},end:h},i={type:l>1?"strongText":"emphasisText",start:{...t[r][1].end},end:{...t[n][1].start}},s={type:l>1?"strong":"emphasis",start:{...o.start},end:{...a.end}},t[r][1].end={...o.start},t[n][1].start={...a.end},u=[],t[r][1].end.offset-t[r][1].start.offset&&(u=wi(u,[["enter",t[r][1],e],["exit",t[r][1],e]])),u=wi(u,[["enter",s,e],["enter",o,e],["exit",o,e],["enter",i,e]]),u=wi(u,rk(e.parser.constructs.insideSpan.null,t.slice(r+1,n),e)),u=wi(u,[["exit",i,e],["enter",a,e],["exit",a,e],["exit",s,e]]),t[n][1].end.offset-t[n][1].start.offset?(d=2,u=wi(u,[["enter",t[n][1],e],["exit",t[n][1],e]])):d=0,So(t,r-1,n-r+3,u),n=r+u.length-d-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function bX(t,e){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,s=AC(r);let i;return o;function o(l){return i=l,t.enter("attentionSequence"),a(l)}function a(l){if(l===i)return t.consume(l),a;const u=t.exit("attentionSequence"),d=AC(l),f=!d||d===2&&s||n.includes(l),h=!s||s===2&&d||n.includes(r);return u._open=!!(i===42?f:f&&(s||!h)),u._close=!!(i===42?h:h&&(d||!f)),e(l)}}function RC(t,e){t.column+=e,t.offset+=e,t._bufferIndex+=e}const vX={name:"autolink",tokenize:wX};function wX(t,e,n){let r=0;return s;function s(p){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),i}function i(p){return co(p)?(t.consume(p),o):p===64?n(p):u(p)}function o(p){return p===43||p===45||p===46||ri(p)?(r=1,a(p)):u(p)}function a(p){return p===58?(t.consume(p),r=0,l):(p===43||p===45||p===46||ri(p))&&r++<32?(t.consume(p),a):(r=0,u(p))}function l(p){return p===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.exit("autolink"),e):p===null||p===32||p===60||mb(p)?n(p):(t.consume(p),l)}function u(p){return p===64?(t.consume(p),d):lX(p)?(t.consume(p),u):n(p)}function d(p){return ri(p)?f(p):n(p)}function f(p){return p===46?(t.consume(p),r=0,d):p===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.exit("autolink"),e):h(p)}function h(p){if((p===45||ri(p))&&r++<63){const m=p===45?h:f;return t.consume(p),m}return n(p)}}const s0={partial:!0,tokenize:kX};function kX(t,e,n){return r;function r(i){return An(i)?Gn(t,s,"linePrefix")(i):s(i)}function s(i){return i===null||dn(i)?e(i):n(i)}}const lR={continuation:{tokenize:_X},exit:TX,name:"blockQuote",tokenize:SX};function SX(t,e,n){const r=this;return s;function s(o){if(o===62){const a=r.containerState;return a.open||(t.enter("blockQuote",{_container:!0}),a.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(o),t.exit("blockQuoteMarker"),i}return n(o)}function i(o){return An(o)?(t.enter("blockQuotePrefixWhitespace"),t.consume(o),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),e):(t.exit("blockQuotePrefix"),e(o))}}function _X(t,e,n){const r=this;return s;function s(o){return An(o)?Gn(t,i,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o):i(o)}function i(o){return t.attempt(lR,e,n)(o)}}function TX(t){t.exit("blockQuote")}const cR={name:"characterEscape",tokenize:CX};function CX(t,e,n){return r;function r(i){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(i),t.exit("escapeMarker"),s}function s(i){return uX(i)?(t.enter("characterEscapeValue"),t.consume(i),t.exit("characterEscapeValue"),t.exit("characterEscape"),e):n(i)}}const uR={name:"characterReference",tokenize:EX};function EX(t,e,n){const r=this;let s=0,i,o;return a;function a(f){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(f),t.exit("characterReferenceMarker"),l}function l(f){return f===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(f),t.exit("characterReferenceMarkerNumeric"),u):(t.enter("characterReferenceValue"),i=31,o=ri,d(f))}function u(f){return f===88||f===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(f),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),i=6,o=cX,d):(t.enter("characterReferenceValue"),i=7,o=gb,d(f))}function d(f){if(f===59&&s){const h=t.exit("characterReferenceValue");return o===ri&&!nk(r.sliceSerialize(h))?n(f):(t.enter("characterReferenceMarker"),t.consume(f),t.exit("characterReferenceMarker"),t.exit("characterReference"),e)}return o(f)&&s++<i?(t.consume(f),d):n(f)}}const OC={partial:!0,tokenize:jX},PC={concrete:!0,name:"codeFenced",tokenize:NX};function NX(t,e,n){const r=this,s={partial:!0,tokenize:I};let i=0,o=0,a;return l;function l(k){return u(k)}function u(k){const D=r.events[r.events.length-1];return i=D&&D[1].type==="linePrefix"?D[2].sliceSerialize(D[1],!0).length:0,a=k,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),d(k)}function d(k){return k===a?(o++,t.consume(k),d):o<3?n(k):(t.exit("codeFencedFenceSequence"),An(k)?Gn(t,f,"whitespace")(k):f(k))}function f(k){return k===null||dn(k)?(t.exit("codeFencedFence"),r.interrupt?e(k):t.check(OC,y,C)(k)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),h(k))}function h(k){return k===null||dn(k)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),f(k)):An(k)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),Gn(t,p,"whitespace")(k)):k===96&&k===a?n(k):(t.consume(k),h)}function p(k){return k===null||dn(k)?f(k):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),m(k))}function m(k){return k===null||dn(k)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),f(k)):k===96&&k===a?n(k):(t.consume(k),m)}function y(k){return t.attempt(s,C,b)(k)}function b(k){return t.enter("lineEnding"),t.consume(k),t.exit("lineEnding"),g}function g(k){return i>0&&An(k)?Gn(t,v,"linePrefix",i+1)(k):v(k)}function v(k){return k===null||dn(k)?t.check(OC,y,C)(k):(t.enter("codeFlowValue"),w(k))}function w(k){return k===null||dn(k)?(t.exit("codeFlowValue"),v(k)):(t.consume(k),w)}function C(k){return t.exit("codeFenced"),e(k)}function I(k,D,S){let T=0;return _;function _(V){return k.enter("lineEnding"),k.consume(V),k.exit("lineEnding"),N}function N(V){return k.enter("codeFencedFence"),An(V)?Gn(k,A,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(V):A(V)}function A(V){return V===a?(k.enter("codeFencedFenceSequence"),O(V)):S(V)}function O(V){return V===a?(T++,k.consume(V),O):T>=o?(k.exit("codeFencedFenceSequence"),An(V)?Gn(k,L,"whitespace")(V):L(V)):S(V)}function L(V){return V===null||dn(V)?(k.exit("codeFencedFence"),D(V)):S(V)}}}function jX(t,e,n){const r=this;return s;function s(o){return o===null?n(o):(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),i)}function i(o){return r.parser.lazy[r.now().line]?n(o):e(o)}}const $y={name:"codeIndented",tokenize:MX},IX={partial:!0,tokenize:DX};function MX(t,e,n){const r=this;return s;function s(u){return t.enter("codeIndented"),Gn(t,i,"linePrefix",4+1)(u)}function i(u){const d=r.events[r.events.length-1];return d&&d[1].type==="linePrefix"&&d[2].sliceSerialize(d[1],!0).length>=4?o(u):n(u)}function o(u){return u===null?l(u):dn(u)?t.attempt(IX,o,l)(u):(t.enter("codeFlowValue"),a(u))}function a(u){return u===null||dn(u)?(t.exit("codeFlowValue"),o(u)):(t.consume(u),a)}function l(u){return t.exit("codeIndented"),e(u)}}function DX(t,e,n){const r=this;return s;function s(o){return r.parser.lazy[r.now().line]?n(o):dn(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),s):Gn(t,i,"linePrefix",4+1)(o)}function i(o){const a=r.events[r.events.length-1];return a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):dn(o)?s(o):n(o)}}const AX={name:"codeText",previous:OX,resolve:RX,tokenize:PX};function RX(t){let e=t.length-4,n=3,r,s;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[e][1].type==="lineEnding"||t[e][1].type==="space")){for(r=n;++r<e;)if(t[r][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[e][1].type="codeTextPadding",n+=2,e-=2;break}}for(r=n-1,e++;++r<=e;)s===void 0?r!==e&&t[r][1].type!=="lineEnding"&&(s=r):(r===e||t[r][1].type==="lineEnding")&&(t[s][1].type="codeTextData",r!==s+2&&(t[s][1].end=t[r-1][1].end,t.splice(s+2,r-s-2),e-=r-s-2,r=s+2),s=void 0);return t}function OX(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function PX(t,e,n){let r=0,s,i;return o;function o(f){return t.enter("codeText"),t.enter("codeTextSequence"),a(f)}function a(f){return f===96?(t.consume(f),r++,a):(t.exit("codeTextSequence"),l(f))}function l(f){return f===null?n(f):f===32?(t.enter("space"),t.consume(f),t.exit("space"),l):f===96?(i=t.enter("codeTextSequence"),s=0,d(f)):dn(f)?(t.enter("lineEnding"),t.consume(f),t.exit("lineEnding"),l):(t.enter("codeTextData"),u(f))}function u(f){return f===null||f===32||f===96||dn(f)?(t.exit("codeTextData"),l(f)):(t.consume(f),u)}function d(f){return f===96?(t.consume(f),s++,d):s===r?(t.exit("codeTextSequence"),t.exit("codeText"),e(f)):(i.type="codeTextData",u(f))}}class LX{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,n){const r=n??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(e,r):e>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(e,n,r){const s=n||0;this.setCursor(Math.trunc(e));const i=this.right.splice(this.right.length-s,Number.POSITIVE_INFINITY);return r&&od(this.left,r),i.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),od(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),od(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const n=this.left.splice(e,Number.POSITIVE_INFINITY);od(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);od(this.left,n.reverse())}}}function od(t,e){let n=0;if(e.length<1e4)t.push(...e);else for(;n<e.length;)t.push(...e.slice(n,n+1e4)),n+=1e4}function dR(t){const e={};let n=-1,r,s,i,o,a,l,u;const d=new LX(t);for(;++n<d.length;){for(;n in e;)n=e[n];if(r=d.get(n),n&&r[1].type==="chunkFlow"&&d.get(n-1)[1].type==="listItemPrefix"&&(l=r[1]._tokenizer.events,i=0,i<l.length&&l[i][1].type==="lineEndingBlank"&&(i+=2),i<l.length&&l[i][1].type==="content"))for(;++i<l.length&&l[i][1].type!=="content";)l[i][1].type==="chunkText"&&(l[i][1]._isInFirstContentOfListItem=!0,i++);if(r[0]==="enter")r[1].contentType&&(Object.assign(e,$X(d,n)),n=e[n],u=!0);else if(r[1]._container){for(i=n,s=void 0;i--;)if(o=d.get(i),o[1].type==="lineEnding"||o[1].type==="lineEndingBlank")o[0]==="enter"&&(s&&(d.get(s)[1].type="lineEndingBlank"),o[1].type="lineEnding",s=i);else if(!(o[1].type==="linePrefix"||o[1].type==="listItemIndent"))break;s&&(r[1].end={...d.get(s)[1].start},a=d.slice(s,n),a.unshift(r),d.splice(s,n-s+1,a))}}return So(t,0,Number.POSITIVE_INFINITY,d.slice(0)),!u}function $X(t,e){const n=t.get(e)[1],r=t.get(e)[2];let s=e-1;const i=[];let o=n._tokenizer;o||(o=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(o._contentTypeTextTrailing=!0));const a=o.events,l=[],u={};let d,f,h=-1,p=n,m=0,y=0;const b=[y];for(;p;){for(;t.get(++s)[1]!==p;);i.push(s),p._tokenizer||(d=r.sliceStream(p),p.next||d.push(null),f&&o.defineSkip(p.start),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(d),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),f=p,p=p.next}for(p=n;++h<a.length;)a[h][0]==="exit"&&a[h-1][0]==="enter"&&a[h][1].type===a[h-1][1].type&&a[h][1].start.line!==a[h][1].end.line&&(y=h+1,b.push(y),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(o.events=[],p?(p._tokenizer=void 0,p.previous=void 0):b.pop(),h=b.length;h--;){const g=a.slice(b[h],b[h+1]),v=i.pop();l.push([v,v+g.length-1]),t.splice(v,2,g)}for(l.reverse(),h=-1;++h<l.length;)u[m+l[h][0]]=m+l[h][1],m+=l[h][1]-l[h][0]-1;return u}const zX={resolve:BX,tokenize:UX},FX={partial:!0,tokenize:HX};function BX(t){return dR(t),t}function UX(t,e){let n;return r;function r(a){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),s(a)}function s(a){return a===null?i(a):dn(a)?t.check(FX,o,i)(a):(t.consume(a),s)}function i(a){return t.exit("chunkContent"),t.exit("content"),e(a)}function o(a){return t.consume(a),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,s}}function HX(t,e,n){const r=this;return s;function s(o){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),Gn(t,i,"linePrefix")}function i(o){if(o===null||dn(o))return n(o);const a=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):t.interrupt(r.parser.constructs.flow,n,e)(o)}}function fR(t,e,n,r,s,i,o,a,l){const u=l||Number.POSITIVE_INFINITY;let d=0;return f;function f(g){return g===60?(t.enter(r),t.enter(s),t.enter(i),t.consume(g),t.exit(i),h):g===null||g===32||g===41||mb(g)?n(g):(t.enter(r),t.enter(o),t.enter(a),t.enter("chunkString",{contentType:"string"}),y(g))}function h(g){return g===62?(t.enter(i),t.consume(g),t.exit(i),t.exit(s),t.exit(r),e):(t.enter(a),t.enter("chunkString",{contentType:"string"}),p(g))}function p(g){return g===62?(t.exit("chunkString"),t.exit(a),h(g)):g===null||g===60||dn(g)?n(g):(t.consume(g),g===92?m:p)}function m(g){return g===60||g===62||g===92?(t.consume(g),p):p(g)}function y(g){return!d&&(g===null||g===41||Vs(g))?(t.exit("chunkString"),t.exit(a),t.exit(o),t.exit(r),e(g)):d<u&&g===40?(t.consume(g),d++,y):g===41?(t.consume(g),d--,y):g===null||g===32||g===40||mb(g)?n(g):(t.consume(g),g===92?b:y)}function b(g){return g===40||g===41||g===92?(t.consume(g),y):y(g)}}function hR(t,e,n,r,s,i){const o=this;let a=0,l;return u;function u(p){return t.enter(r),t.enter(s),t.consume(p),t.exit(s),t.enter(i),d}function d(p){return a>999||p===null||p===91||p===93&&!l||p===94&&!a&&"_hiddenFootnoteSupport"in o.parser.constructs?n(p):p===93?(t.exit(i),t.enter(s),t.consume(p),t.exit(s),t.exit(r),e):dn(p)?(t.enter("lineEnding"),t.consume(p),t.exit("lineEnding"),d):(t.enter("chunkString",{contentType:"string"}),f(p))}function f(p){return p===null||p===91||p===93||dn(p)||a++>999?(t.exit("chunkString"),d(p)):(t.consume(p),l||(l=!An(p)),p===92?h:f)}function h(p){return p===91||p===92||p===93?(t.consume(p),a++,f):f(p)}}function pR(t,e,n,r,s,i){let o;return a;function a(h){return h===34||h===39||h===40?(t.enter(r),t.enter(s),t.consume(h),t.exit(s),o=h===40?41:h,l):n(h)}function l(h){return h===o?(t.enter(s),t.consume(h),t.exit(s),t.exit(r),e):(t.enter(i),u(h))}function u(h){return h===o?(t.exit(i),l(o)):h===null?n(h):dn(h)?(t.enter("lineEnding"),t.consume(h),t.exit("lineEnding"),Gn(t,u,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),d(h))}function d(h){return h===o||h===null||dn(h)?(t.exit("chunkString"),u(h)):(t.consume(h),h===92?f:d)}function f(h){return h===o||h===92?(t.consume(h),d):d(h)}}function Yd(t,e){let n;return r;function r(s){return dn(s)?(t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),n=!0,r):An(s)?Gn(t,r,n?"linePrefix":"lineSuffix")(s):e(s)}}const VX={name:"definition",tokenize:KX},WX={partial:!0,tokenize:GX};function KX(t,e,n){const r=this;let s;return i;function i(p){return t.enter("definition"),o(p)}function o(p){return hR.call(r,t,a,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(p)}function a(p){return s=mu(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),p===58?(t.enter("definitionMarker"),t.consume(p),t.exit("definitionMarker"),l):n(p)}function l(p){return Vs(p)?Yd(t,u)(p):u(p)}function u(p){return fR(t,d,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(p)}function d(p){return t.attempt(WX,f,f)(p)}function f(p){return An(p)?Gn(t,h,"whitespace")(p):h(p)}function h(p){return p===null||dn(p)?(t.exit("definition"),r.parser.defined.push(s),e(p)):n(p)}}function GX(t,e,n){return r;function r(a){return Vs(a)?Yd(t,s)(a):n(a)}function s(a){return pR(t,i,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(a)}function i(a){return An(a)?Gn(t,o,"whitespace")(a):o(a)}function o(a){return a===null||dn(a)?e(a):n(a)}}const qX={name:"hardBreakEscape",tokenize:YX};function YX(t,e,n){return r;function r(i){return t.enter("hardBreakEscape"),t.consume(i),s}function s(i){return dn(i)?(t.exit("hardBreakEscape"),e(i)):n(i)}}const JX={name:"headingAtx",resolve:XX,tokenize:QX};function XX(t,e){let n=t.length-2,r=3,s,i;return t[r][1].type==="whitespace"&&(r+=2),n-2>r&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(r===n-1||n-4>r&&t[n-2][1].type==="whitespace")&&(n-=r+1===n?2:4),n>r&&(s={type:"atxHeadingText",start:t[r][1].start,end:t[n][1].end},i={type:"chunkText",start:t[r][1].start,end:t[n][1].end,contentType:"text"},So(t,r,n-r+1,[["enter",s,e],["enter",i,e],["exit",i,e],["exit",s,e]])),t}function QX(t,e,n){let r=0;return s;function s(d){return t.enter("atxHeading"),i(d)}function i(d){return t.enter("atxHeadingSequence"),o(d)}function o(d){return d===35&&r++<6?(t.consume(d),o):d===null||Vs(d)?(t.exit("atxHeadingSequence"),a(d)):n(d)}function a(d){return d===35?(t.enter("atxHeadingSequence"),l(d)):d===null||dn(d)?(t.exit("atxHeading"),e(d)):An(d)?Gn(t,a,"whitespace")(d):(t.enter("atxHeadingText"),u(d))}function l(d){return d===35?(t.consume(d),l):(t.exit("atxHeadingSequence"),a(d))}function u(d){return d===null||d===35||Vs(d)?(t.exit("atxHeadingText"),a(d)):(t.consume(d),u)}}const ZX=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],LC=["pre","script","style","textarea"],eQ={concrete:!0,name:"htmlFlow",resolveTo:rQ,tokenize:sQ},tQ={partial:!0,tokenize:oQ},nQ={partial:!0,tokenize:iQ};function rQ(t){let e=t.length;for(;e--&&!(t[e][0]==="enter"&&t[e][1].type==="htmlFlow"););return e>1&&t[e-2][1].type==="linePrefix"&&(t[e][1].start=t[e-2][1].start,t[e+1][1].start=t[e-2][1].start,t.splice(e-2,2)),t}function sQ(t,e,n){const r=this;let s,i,o,a,l;return u;function u($){return d($)}function d($){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume($),f}function f($){return $===33?(t.consume($),h):$===47?(t.consume($),i=!0,y):$===63?(t.consume($),s=3,r.interrupt?e:R):co($)?(t.consume($),o=String.fromCharCode($),b):n($)}function h($){return $===45?(t.consume($),s=2,p):$===91?(t.consume($),s=5,a=0,m):co($)?(t.consume($),s=4,r.interrupt?e:R):n($)}function p($){return $===45?(t.consume($),r.interrupt?e:R):n($)}function m($){const z="CDATA[";return $===z.charCodeAt(a++)?(t.consume($),a===z.length?r.interrupt?e:A:m):n($)}function y($){return co($)?(t.consume($),o=String.fromCharCode($),b):n($)}function b($){if($===null||$===47||$===62||Vs($)){const z=$===47,le=o.toLowerCase();return!z&&!i&&LC.includes(le)?(s=1,r.interrupt?e($):A($)):ZX.includes(o.toLowerCase())?(s=6,z?(t.consume($),g):r.interrupt?e($):A($)):(s=7,r.interrupt&&!r.parser.lazy[r.now().line]?n($):i?v($):w($))}return $===45||ri($)?(t.consume($),o+=String.fromCharCode($),b):n($)}function g($){return $===62?(t.consume($),r.interrupt?e:A):n($)}function v($){return An($)?(t.consume($),v):_($)}function w($){return $===47?(t.consume($),_):$===58||$===95||co($)?(t.consume($),C):An($)?(t.consume($),w):_($)}function C($){return $===45||$===46||$===58||$===95||ri($)?(t.consume($),C):I($)}function I($){return $===61?(t.consume($),k):An($)?(t.consume($),I):w($)}function k($){return $===null||$===60||$===61||$===62||$===96?n($):$===34||$===39?(t.consume($),l=$,D):An($)?(t.consume($),k):S($)}function D($){return $===l?(t.consume($),l=null,T):$===null||dn($)?n($):(t.consume($),D)}function S($){return $===null||$===34||$===39||$===47||$===60||$===61||$===62||$===96||Vs($)?I($):(t.consume($),S)}function T($){return $===47||$===62||An($)?w($):n($)}function _($){return $===62?(t.consume($),N):n($)}function N($){return $===null||dn($)?A($):An($)?(t.consume($),N):n($)}function A($){return $===45&&s===2?(t.consume($),E):$===60&&s===1?(t.consume($),j):$===62&&s===4?(t.consume($),ae):$===63&&s===3?(t.consume($),R):$===93&&s===5?(t.consume($),W):dn($)&&(s===6||s===7)?(t.exit("htmlFlowData"),t.check(tQ,re,O)($)):$===null||dn($)?(t.exit("htmlFlowData"),O($)):(t.consume($),A)}function O($){return t.check(nQ,L,re)($)}function L($){return t.enter("lineEnding"),t.consume($),t.exit("lineEnding"),V}function V($){return $===null||dn($)?O($):(t.enter("htmlFlowData"),A($))}function E($){return $===45?(t.consume($),R):A($)}function j($){return $===47?(t.consume($),o="",H):A($)}function H($){if($===62){const z=o.toLowerCase();return LC.includes(z)?(t.consume($),ae):A($)}return co($)&&o.length<8?(t.consume($),o+=String.fromCharCode($),H):A($)}function W($){return $===93?(t.consume($),R):A($)}function R($){return $===62?(t.consume($),ae):$===45&&s===2?(t.consume($),R):A($)}function ae($){return $===null||dn($)?(t.exit("htmlFlowData"),re($)):(t.consume($),ae)}function re($){return t.exit("htmlFlow"),e($)}}function iQ(t,e,n){const r=this;return s;function s(o){return dn(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),i):n(o)}function i(o){return r.parser.lazy[r.now().line]?n(o):e(o)}}function oQ(t,e,n){return r;function r(s){return t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),t.attempt(s0,e,n)}}const aQ={name:"htmlText",tokenize:lQ};function lQ(t,e,n){const r=this;let s,i,o;return a;function a(R){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(R),l}function l(R){return R===33?(t.consume(R),u):R===47?(t.consume(R),I):R===63?(t.consume(R),w):co(R)?(t.consume(R),S):n(R)}function u(R){return R===45?(t.consume(R),d):R===91?(t.consume(R),i=0,m):co(R)?(t.consume(R),v):n(R)}function d(R){return R===45?(t.consume(R),p):n(R)}function f(R){return R===null?n(R):R===45?(t.consume(R),h):dn(R)?(o=f,j(R)):(t.consume(R),f)}function h(R){return R===45?(t.consume(R),p):f(R)}function p(R){return R===62?E(R):R===45?h(R):f(R)}function m(R){const ae="CDATA[";return R===ae.charCodeAt(i++)?(t.consume(R),i===ae.length?y:m):n(R)}function y(R){return R===null?n(R):R===93?(t.consume(R),b):dn(R)?(o=y,j(R)):(t.consume(R),y)}function b(R){return R===93?(t.consume(R),g):y(R)}function g(R){return R===62?E(R):R===93?(t.consume(R),g):y(R)}function v(R){return R===null||R===62?E(R):dn(R)?(o=v,j(R)):(t.consume(R),v)}function w(R){return R===null?n(R):R===63?(t.consume(R),C):dn(R)?(o=w,j(R)):(t.consume(R),w)}function C(R){return R===62?E(R):w(R)}function I(R){return co(R)?(t.consume(R),k):n(R)}function k(R){return R===45||ri(R)?(t.consume(R),k):D(R)}function D(R){return dn(R)?(o=D,j(R)):An(R)?(t.consume(R),D):E(R)}function S(R){return R===45||ri(R)?(t.consume(R),S):R===47||R===62||Vs(R)?T(R):n(R)}function T(R){return R===47?(t.consume(R),E):R===58||R===95||co(R)?(t.consume(R),_):dn(R)?(o=T,j(R)):An(R)?(t.consume(R),T):E(R)}function _(R){return R===45||R===46||R===58||R===95||ri(R)?(t.consume(R),_):N(R)}function N(R){return R===61?(t.consume(R),A):dn(R)?(o=N,j(R)):An(R)?(t.consume(R),N):T(R)}function A(R){return R===null||R===60||R===61||R===62||R===96?n(R):R===34||R===39?(t.consume(R),s=R,O):dn(R)?(o=A,j(R)):An(R)?(t.consume(R),A):(t.consume(R),L)}function O(R){return R===s?(t.consume(R),s=void 0,V):R===null?n(R):dn(R)?(o=O,j(R)):(t.consume(R),O)}function L(R){return R===null||R===34||R===39||R===60||R===61||R===96?n(R):R===47||R===62||Vs(R)?T(R):(t.consume(R),L)}function V(R){return R===47||R===62||Vs(R)?T(R):n(R)}function E(R){return R===62?(t.consume(R),t.exit("htmlTextData"),t.exit("htmlText"),e):n(R)}function j(R){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(R),t.exit("lineEnding"),H}function H(R){return An(R)?Gn(t,W,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(R):W(R)}function W(R){return t.enter("htmlTextData"),o(R)}}const sk={name:"labelEnd",resolveAll:fQ,resolveTo:hQ,tokenize:pQ},cQ={tokenize:mQ},uQ={tokenize:gQ},dQ={tokenize:yQ};function fQ(t){let e=-1;const n=[];for(;++e<t.length;){const r=t[e][1];if(n.push(t[e]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const s=r.type==="labelImage"?4:2;r.type="data",e+=s}}return t.length!==n.length&&So(t,0,t.length,n),t}function hQ(t,e){let n=t.length,r=0,s,i,o,a;for(;n--;)if(s=t[n][1],i){if(s.type==="link"||s.type==="labelLink"&&s._inactive)break;t[n][0]==="enter"&&s.type==="labelLink"&&(s._inactive=!0)}else if(o){if(t[n][0]==="enter"&&(s.type==="labelImage"||s.type==="labelLink")&&!s._balanced&&(i=n,s.type!=="labelLink")){r=2;break}}else s.type==="labelEnd"&&(o=n);const l={type:t[i][1].type==="labelLink"?"link":"image",start:{...t[i][1].start},end:{...t[t.length-1][1].end}},u={type:"label",start:{...t[i][1].start},end:{...t[o][1].end}},d={type:"labelText",start:{...t[i+r+2][1].end},end:{...t[o-2][1].start}};return a=[["enter",l,e],["enter",u,e]],a=wi(a,t.slice(i+1,i+r+3)),a=wi(a,[["enter",d,e]]),a=wi(a,rk(e.parser.constructs.insideSpan.null,t.slice(i+r+4,o-3),e)),a=wi(a,[["exit",d,e],t[o-2],t[o-1],["exit",u,e]]),a=wi(a,t.slice(o+1)),a=wi(a,[["exit",l,e]]),So(t,i,t.length,a),t}function pQ(t,e,n){const r=this;let s=r.events.length,i,o;for(;s--;)if((r.events[s][1].type==="labelImage"||r.events[s][1].type==="labelLink")&&!r.events[s][1]._balanced){i=r.events[s][1];break}return a;function a(h){return i?i._inactive?f(h):(o=r.parser.defined.includes(mu(r.sliceSerialize({start:i.end,end:r.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(h),t.exit("labelMarker"),t.exit("labelEnd"),l):n(h)}function l(h){return h===40?t.attempt(cQ,d,o?d:f)(h):h===91?t.attempt(uQ,d,o?u:f)(h):o?d(h):f(h)}function u(h){return t.attempt(dQ,d,f)(h)}function d(h){return e(h)}function f(h){return i._balanced=!0,n(h)}}function mQ(t,e,n){return r;function r(f){return t.enter("resource"),t.enter("resourceMarker"),t.consume(f),t.exit("resourceMarker"),s}function s(f){return Vs(f)?Yd(t,i)(f):i(f)}function i(f){return f===41?d(f):fR(t,o,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(f)}function o(f){return Vs(f)?Yd(t,l)(f):d(f)}function a(f){return n(f)}function l(f){return f===34||f===39||f===40?pR(t,u,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(f):d(f)}function u(f){return Vs(f)?Yd(t,d)(f):d(f)}function d(f){return f===41?(t.enter("resourceMarker"),t.consume(f),t.exit("resourceMarker"),t.exit("resource"),e):n(f)}}function gQ(t,e,n){const r=this;return s;function s(a){return hR.call(r,t,i,o,"reference","referenceMarker","referenceString")(a)}function i(a){return r.parser.defined.includes(mu(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(a):n(a)}function o(a){return n(a)}}function yQ(t,e,n){return r;function r(i){return t.enter("reference"),t.enter("referenceMarker"),t.consume(i),t.exit("referenceMarker"),s}function s(i){return i===93?(t.enter("referenceMarker"),t.consume(i),t.exit("referenceMarker"),t.exit("reference"),e):n(i)}}const xQ={name:"labelStartImage",resolveAll:sk.resolveAll,tokenize:bQ};function bQ(t,e,n){const r=this;return s;function s(a){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(a),t.exit("labelImageMarker"),i}function i(a){return a===91?(t.enter("labelMarker"),t.consume(a),t.exit("labelMarker"),t.exit("labelImage"),o):n(a)}function o(a){return a===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(a):e(a)}}const vQ={name:"labelStartLink",resolveAll:sk.resolveAll,tokenize:wQ};function wQ(t,e,n){const r=this;return s;function s(o){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(o),t.exit("labelMarker"),t.exit("labelLink"),i}function i(o){return o===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(o):e(o)}}const zy={name:"lineEnding",tokenize:kQ};function kQ(t,e){return n;function n(r){return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),Gn(t,e,"linePrefix")}}const Ap={name:"thematicBreak",tokenize:SQ};function SQ(t,e,n){let r=0,s;return i;function i(u){return t.enter("thematicBreak"),o(u)}function o(u){return s=u,a(u)}function a(u){return u===s?(t.enter("thematicBreakSequence"),l(u)):r>=3&&(u===null||dn(u))?(t.exit("thematicBreak"),e(u)):n(u)}function l(u){return u===s?(t.consume(u),r++,l):(t.exit("thematicBreakSequence"),An(u)?Gn(t,a,"whitespace")(u):a(u))}}const Ms={continuation:{tokenize:EQ},exit:jQ,name:"list",tokenize:CQ},_Q={partial:!0,tokenize:IQ},TQ={partial:!0,tokenize:NQ};function CQ(t,e,n){const r=this,s=r.events[r.events.length-1];let i=s&&s[1].type==="linePrefix"?s[2].sliceSerialize(s[1],!0).length:0,o=0;return a;function a(p){const m=r.containerState.type||(p===42||p===43||p===45?"listUnordered":"listOrdered");if(m==="listUnordered"?!r.containerState.marker||p===r.containerState.marker:gb(p)){if(r.containerState.type||(r.containerState.type=m,t.enter(m,{_container:!0})),m==="listUnordered")return t.enter("listItemPrefix"),p===42||p===45?t.check(Ap,n,u)(p):u(p);if(!r.interrupt||p===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),l(p)}return n(p)}function l(p){return gb(p)&&++o<10?(t.consume(p),l):(!r.interrupt||o<2)&&(r.containerState.marker?p===r.containerState.marker:p===41||p===46)?(t.exit("listItemValue"),u(p)):n(p)}function u(p){return t.enter("listItemMarker"),t.consume(p),t.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||p,t.check(s0,r.interrupt?n:d,t.attempt(_Q,h,f))}function d(p){return r.containerState.initialBlankLine=!0,i++,h(p)}function f(p){return An(p)?(t.enter("listItemPrefixWhitespace"),t.consume(p),t.exit("listItemPrefixWhitespace"),h):n(p)}function h(p){return r.containerState.size=i+r.sliceSerialize(t.exit("listItemPrefix"),!0).length,e(p)}}function EQ(t,e,n){const r=this;return r.containerState._closeFlow=void 0,t.check(s0,s,i);function s(a){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,Gn(t,e,"listItemIndent",r.containerState.size+1)(a)}function i(a){return r.containerState.furtherBlankLines||!An(a)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,o(a)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,t.attempt(TQ,e,o)(a))}function o(a){return r.containerState._closeFlow=!0,r.interrupt=void 0,Gn(t,t.attempt(Ms,e,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a)}}function NQ(t,e,n){const r=this;return Gn(t,s,"listItemIndent",r.containerState.size+1);function s(i){const o=r.events[r.events.length-1];return o&&o[1].type==="listItemIndent"&&o[2].sliceSerialize(o[1],!0).length===r.containerState.size?e(i):n(i)}}function jQ(t){t.exit(this.containerState.type)}function IQ(t,e,n){const r=this;return Gn(t,s,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4+1);function s(i){const o=r.events[r.events.length-1];return!An(i)&&o&&o[1].type==="listItemPrefixWhitespace"?e(i):n(i)}}const $C={name:"setextUnderline",resolveTo:MQ,tokenize:DQ};function MQ(t,e){let n=t.length,r,s,i;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){r=n;break}t[n][1].type==="paragraph"&&(s=n)}else t[n][1].type==="content"&&t.splice(n,1),!i&&t[n][1].type==="definition"&&(i=n);const o={type:"setextHeading",start:{...t[r][1].start},end:{...t[t.length-1][1].end}};return t[s][1].type="setextHeadingText",i?(t.splice(s,0,["enter",o,e]),t.splice(i+1,0,["exit",t[r][1],e]),t[r][1].end={...t[i][1].end}):t[r][1]=o,t.push(["exit",o,e]),t}function DQ(t,e,n){const r=this;let s;return i;function i(u){let d=r.events.length,f;for(;d--;)if(r.events[d][1].type!=="lineEnding"&&r.events[d][1].type!=="linePrefix"&&r.events[d][1].type!=="content"){f=r.events[d][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||f)?(t.enter("setextHeadingLine"),s=u,o(u)):n(u)}function o(u){return t.enter("setextHeadingLineSequence"),a(u)}function a(u){return u===s?(t.consume(u),a):(t.exit("setextHeadingLineSequence"),An(u)?Gn(t,l,"lineSuffix")(u):l(u))}function l(u){return u===null||dn(u)?(t.exit("setextHeadingLine"),e(u)):n(u)}}const AQ={tokenize:RQ};function RQ(t){const e=this,n=t.attempt(s0,r,t.attempt(this.parser.constructs.flowInitial,s,Gn(t,t.attempt(this.parser.constructs.flow,s,t.attempt(zX,s)),"linePrefix")));return n;function r(i){if(i===null){t.consume(i);return}return t.enter("lineEndingBlank"),t.consume(i),t.exit("lineEndingBlank"),e.currentConstruct=void 0,n}function s(i){if(i===null){t.consume(i);return}return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),e.currentConstruct=void 0,n}}const OQ={resolveAll:gR()},PQ=mR("string"),LQ=mR("text");function mR(t){return{resolveAll:gR(t==="text"?$Q:void 0),tokenize:e};function e(n){const r=this,s=this.parser.constructs[t],i=n.attempt(s,o,a);return o;function o(d){return u(d)?i(d):a(d)}function a(d){if(d===null){n.consume(d);return}return n.enter("data"),n.consume(d),l}function l(d){return u(d)?(n.exit("data"),i(d)):(n.consume(d),l)}function u(d){if(d===null)return!0;const f=s[d];let h=-1;if(f)for(;++h<f.length;){const p=f[h];if(!p.previous||p.previous.call(r,r.previous))return!0}return!1}}}function gR(t){return e;function e(n,r){let s=-1,i;for(;++s<=n.length;)i===void 0?n[s]&&n[s][1].type==="data"&&(i=s,s++):(!n[s]||n[s][1].type!=="data")&&(s!==i+2&&(n[i][1].end=n[s-1][1].end,n.splice(i+2,s-i-2),s=i+2),i=void 0);return t?t(n,r):n}}function $Q(t,e){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const r=t[n-1][1],s=e.sliceStream(r);let i=s.length,o=-1,a=0,l;for(;i--;){const u=s[i];if(typeof u=="string"){for(o=u.length;u.charCodeAt(o-1)===32;)a++,o--;if(o)break;o=-1}else if(u===-2)l=!0,a++;else if(u!==-1){i++;break}}if(e._contentTypeTextTrailing&&n===t.length&&(a=0),a){const u={type:n===t.length||l||a<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:i?o:r.start._bufferIndex+o,_index:r.start._index+i,line:r.end.line,column:r.end.column-a,offset:r.end.offset-a},end:{...r.end}};r.end={...u.start},r.start.offset===r.end.offset?Object.assign(r,u):(t.splice(n,0,["enter",u,e],["exit",u,e]),n+=2)}n++}return t}const zQ={42:Ms,43:Ms,45:Ms,48:Ms,49:Ms,50:Ms,51:Ms,52:Ms,53:Ms,54:Ms,55:Ms,56:Ms,57:Ms,62:lR},FQ={91:VX},BQ={[-2]:$y,[-1]:$y,32:$y},UQ={35:JX,42:Ap,45:[$C,Ap],60:eQ,61:$C,95:Ap,96:PC,126:PC},HQ={38:uR,92:cR},VQ={[-5]:zy,[-4]:zy,[-3]:zy,33:xQ,38:uR,42:yb,60:[vX,aQ],91:vQ,92:[qX,cR],93:sk,95:yb,96:AX},WQ={null:[yb,OQ]},KQ={null:[42,95]},GQ={null:[]},qQ=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:KQ,contentInitial:FQ,disable:GQ,document:zQ,flow:UQ,flowInitial:BQ,insideSpan:WQ,string:HQ,text:VQ},Symbol.toStringTag,{value:"Module"}));function YQ(t,e,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const s={},i=[];let o=[],a=[];const l={attempt:D(I),check:D(k),consume:v,enter:w,exit:C,interrupt:D(k,{interrupt:!0})},u={code:null,containerState:{},defineSkip:y,events:[],now:m,parser:t,previous:null,sliceSerialize:h,sliceStream:p,write:f};let d=e.tokenize.call(u,l);return e.resolveAll&&i.push(e),u;function f(N){return o=wi(o,N),b(),o[o.length-1]!==null?[]:(S(e,0),u.events=rk(i,u.events,u),u.events)}function h(N,A){return XQ(p(N),A)}function p(N){return JQ(o,N)}function m(){const{_bufferIndex:N,_index:A,line:O,column:L,offset:V}=r;return{_bufferIndex:N,_index:A,line:O,column:L,offset:V}}function y(N){s[N.line]=N.column,_()}function b(){let N;for(;r._index<o.length;){const A=o[r._index];if(typeof A=="string")for(N=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===N&&r._bufferIndex<A.length;)g(A.charCodeAt(r._bufferIndex));else g(A)}}function g(N){d=d(N)}function v(N){dn(N)?(r.line++,r.column=1,r.offset+=N===-3?2:1,_()):N!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===o[r._index].length&&(r._bufferIndex=-1,r._index++)),u.previous=N}function w(N,A){const O=A||{};return O.type=N,O.start=m(),u.events.push(["enter",O,u]),a.push(O),O}function C(N){const A=a.pop();return A.end=m(),u.events.push(["exit",A,u]),A}function I(N,A){S(N,A.from)}function k(N,A){A.restore()}function D(N,A){return O;function O(L,V,E){let j,H,W,R;return Array.isArray(L)?re(L):"tokenize"in L?re([L]):ae(L);function ae($e){return Be;function Be(se){const Se=se!==null&&$e[se],ce=se!==null&&$e.null,Ee=[...Array.isArray(Se)?Se:Se?[Se]:[],...Array.isArray(ce)?ce:ce?[ce]:[]];return re(Ee)(se)}}function re($e){return j=$e,H=0,$e.length===0?E:$($e[H])}function $($e){return Be;function Be(se){return R=T(),W=$e,$e.partial||(u.currentConstruct=$e),$e.name&&u.parser.constructs.disable.null.includes($e.name)?le():$e.tokenize.call(A?Object.assign(Object.create(u),A):u,l,z,le)(se)}}function z($e){return N(W,R),V}function le($e){return R.restore(),++H<j.length?$(j[H]):E}}}function S(N,A){N.resolveAll&&!i.includes(N)&&i.push(N),N.resolve&&So(u.events,A,u.events.length-A,N.resolve(u.events.slice(A),u)),N.resolveTo&&(u.events=N.resolveTo(u.events,u))}function T(){const N=m(),A=u.previous,O=u.currentConstruct,L=u.events.length,V=Array.from(a);return{from:L,restore:E};function E(){r=N,u.previous=A,u.currentConstruct=O,u.events.length=L,a=V,_()}}function _(){r.line in s&&r.column<2&&(r.column=s[r.line],r.offset+=s[r.line]-1)}}function JQ(t,e){const n=e.start._index,r=e.start._bufferIndex,s=e.end._index,i=e.end._bufferIndex;let o;if(n===s)o=[t[n].slice(r,i)];else{if(o=t.slice(n,s),r>-1){const a=o[0];typeof a=="string"?o[0]=a.slice(r):o.shift()}i>0&&o.push(t[s].slice(0,i))}return o}function XQ(t,e){let n=-1;const r=[];let s;for(;++n<t.length;){const i=t[n];let o;if(typeof i=="string")o=i;else switch(i){case-5:{o="\r";break}case-4:{o=`
`;break}case-3:{o=`\r
`;break}case-2:{o=e?" ":"	";break}case-1:{if(!e&&s)continue;o=" ";break}default:o=String.fromCharCode(i)}s=i===-2,r.push(o)}return r.join("")}function QQ(t){const r={constructs:iX([qQ,...(t||{}).extensions||[]]),content:s(hX),defined:[],document:s(mX),flow:s(AQ),lazy:{},string:s(PQ),text:s(LQ)};return r;function s(i){return o;function o(a){return YQ(r,i,a)}}}function ZQ(t){for(;!dR(t););return t}const zC=/[\0\t\n\r]/g;function eZ(){let t=1,e="",n=!0,r;return s;function s(i,o,a){const l=[];let u,d,f,h,p;for(i=e+(typeof i=="string"?i.toString():new TextDecoder(o||void 0).decode(i)),f=0,e="",n&&(i.charCodeAt(0)===65279&&f++,n=void 0);f<i.length;){if(zC.lastIndex=f,u=zC.exec(i),h=u&&u.index!==void 0?u.index:i.length,p=i.charCodeAt(h),!u){e=i.slice(f);break}if(p===10&&f===h&&r)l.push(-3),r=void 0;else switch(r&&(l.push(-5),r=void 0),f<h&&(l.push(i.slice(f,h)),t+=h-f),p){case 0:{l.push(65533),t++;break}case 9:{for(d=Math.ceil(t/4)*4,l.push(-2);t++<d;)l.push(-1);break}case 10:{l.push(-4),t=1;break}default:r=!0,t=1}f=h+1}return a&&(r&&l.push(-5),e&&l.push(e),l.push(null)),l}}const tZ=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function nZ(t){return t.replace(tZ,rZ)}function rZ(t,e,n){if(e)return e;if(n.charCodeAt(0)===35){const s=n.charCodeAt(1),i=s===120||s===88;return aR(n.slice(i?2:1),i?16:10)}return nk(n)||t}const yR={}.hasOwnProperty;function sZ(t,e,n){return typeof e!="string"&&(n=e,e=void 0),iZ(n)(ZQ(QQ(n).document().write(eZ()(t,e,!0))))}function iZ(t){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:i(ge),autolinkProtocol:T,autolinkEmail:T,atxHeading:i(Ge),blockQuote:i(ce),characterEscape:T,characterReference:T,codeFenced:i(Ee),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:i(Ee,o),codeText:i(He,o),codeTextData:T,data:T,codeFlowValue:T,definition:i(tt),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:i(ut),hardBreakEscape:i(mt),hardBreakTrailing:i(mt),htmlFlow:i(ht,o),htmlFlowData:T,htmlText:i(ht,o),htmlTextData:T,image:i(Ie),label:o,link:i(ge),listItem:i(me),listItemValue:h,listOrdered:i(ie,f),listUnordered:i(ie),paragraph:i(Q),reference:$,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:i(Ge),strong:i(X),thematicBreak:i(ke)},exit:{atxHeading:l(),atxHeadingSequence:I,autolink:l(),autolinkEmail:Se,autolinkProtocol:se,blockQuote:l(),characterEscapeValue:_,characterReferenceMarkerHexadecimal:le,characterReferenceMarkerNumeric:le,characterReferenceValue:$e,characterReference:Be,codeFenced:l(b),codeFencedFence:y,codeFencedFenceInfo:p,codeFencedFenceMeta:m,codeFlowValue:_,codeIndented:l(g),codeText:l(V),codeTextData:_,data:_,definition:l(),definitionDestinationString:C,definitionLabelString:v,definitionTitleString:w,emphasis:l(),hardBreakEscape:l(A),hardBreakTrailing:l(A),htmlFlow:l(O),htmlFlowData:_,htmlText:l(L),htmlTextData:_,image:l(j),label:W,labelText:H,lineEnding:N,link:l(E),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:z,resourceDestinationString:R,resourceTitleString:ae,resource:re,setextHeading:l(S),setextHeadingLineSequence:D,setextHeadingText:k,strong:l(),thematicBreak:l()}};xR(e,(t||{}).mdastExtensions||[]);const n={};return r;function r(ee){let pe={type:"root",children:[]};const Re={stack:[pe],tokenStack:[],config:e,enter:a,exit:u,buffer:o,resume:d,data:n},_t=[];let Nt=-1;for(;++Nt<ee.length;)if(ee[Nt][1].type==="listOrdered"||ee[Nt][1].type==="listUnordered")if(ee[Nt][0]==="enter")_t.push(Nt);else{const ot=_t.pop();Nt=s(ee,ot,Nt)}for(Nt=-1;++Nt<ee.length;){const ot=e[ee[Nt][0]];yR.call(ot,ee[Nt][1].type)&&ot[ee[Nt][1].type].call(Object.assign({sliceSerialize:ee[Nt][2].sliceSerialize},Re),ee[Nt][1])}if(Re.tokenStack.length>0){const ot=Re.tokenStack[Re.tokenStack.length-1];(ot[1]||FC).call(Re,void 0,ot[0])}for(pe.position={start:aa(ee.length>0?ee[0][1].start:{line:1,column:1,offset:0}),end:aa(ee.length>0?ee[ee.length-2][1].end:{line:1,column:1,offset:0})},Nt=-1;++Nt<e.transforms.length;)pe=e.transforms[Nt](pe)||pe;return pe}function s(ee,pe,Re){let _t=pe-1,Nt=-1,ot=!1,Ot,we,qe,Ke;for(;++_t<=Re;){const it=ee[_t];switch(it[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{it[0]==="enter"?Nt++:Nt--,Ke=void 0;break}case"lineEndingBlank":{it[0]==="enter"&&(Ot&&!Ke&&!Nt&&!qe&&(qe=_t),Ke=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Ke=void 0}if(!Nt&&it[0]==="enter"&&it[1].type==="listItemPrefix"||Nt===-1&&it[0]==="exit"&&(it[1].type==="listUnordered"||it[1].type==="listOrdered")){if(Ot){let Me=_t;for(we=void 0;Me--;){const yt=ee[Me];if(yt[1].type==="lineEnding"||yt[1].type==="lineEndingBlank"){if(yt[0]==="exit")continue;we&&(ee[we][1].type="lineEndingBlank",ot=!0),yt[1].type="lineEnding",we=Me}else if(!(yt[1].type==="linePrefix"||yt[1].type==="blockQuotePrefix"||yt[1].type==="blockQuotePrefixWhitespace"||yt[1].type==="blockQuoteMarker"||yt[1].type==="listItemIndent"))break}qe&&(!we||qe<we)&&(Ot._spread=!0),Ot.end=Object.assign({},we?ee[we][1].start:it[1].end),ee.splice(we||_t,0,["exit",Ot,it[2]]),_t++,Re++}if(it[1].type==="listItemPrefix"){const Me={type:"listItem",_spread:!1,start:Object.assign({},it[1].start),end:void 0};Ot=Me,ee.splice(_t,0,["enter",Me,it[2]]),_t++,Re++,qe=void 0,Ke=!0}}}return ee[pe][1]._spread=ot,Re}function i(ee,pe){return Re;function Re(_t){a.call(this,ee(_t),_t),pe&&pe.call(this,_t)}}function o(){this.stack.push({type:"fragment",children:[]})}function a(ee,pe,Re){this.stack[this.stack.length-1].children.push(ee),this.stack.push(ee),this.tokenStack.push([pe,Re||void 0]),ee.position={start:aa(pe.start),end:void 0}}function l(ee){return pe;function pe(Re){ee&&ee.call(this,Re),u.call(this,Re)}}function u(ee,pe){const Re=this.stack.pop(),_t=this.tokenStack.pop();if(_t)_t[0].type!==ee.type&&(pe?pe.call(this,ee,_t[0]):(_t[1]||FC).call(this,ee,_t[0]));else throw new Error("Cannot close `"+ee.type+"` ("+qd({start:ee.start,end:ee.end})+"): its not open");Re.position.end=aa(ee.end)}function d(){return rX(this.stack.pop())}function f(){this.data.expectingFirstListItemValue=!0}function h(ee){if(this.data.expectingFirstListItemValue){const pe=this.stack[this.stack.length-2];pe.start=Number.parseInt(this.sliceSerialize(ee),10),this.data.expectingFirstListItemValue=void 0}}function p(){const ee=this.resume(),pe=this.stack[this.stack.length-1];pe.lang=ee}function m(){const ee=this.resume(),pe=this.stack[this.stack.length-1];pe.meta=ee}function y(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function b(){const ee=this.resume(),pe=this.stack[this.stack.length-1];pe.value=ee.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function g(){const ee=this.resume(),pe=this.stack[this.stack.length-1];pe.value=ee.replace(/(\r?\n|\r)$/g,"")}function v(ee){const pe=this.resume(),Re=this.stack[this.stack.length-1];Re.label=pe,Re.identifier=mu(this.sliceSerialize(ee)).toLowerCase()}function w(){const ee=this.resume(),pe=this.stack[this.stack.length-1];pe.title=ee}function C(){const ee=this.resume(),pe=this.stack[this.stack.length-1];pe.url=ee}function I(ee){const pe=this.stack[this.stack.length-1];if(!pe.depth){const Re=this.sliceSerialize(ee).length;pe.depth=Re}}function k(){this.data.setextHeadingSlurpLineEnding=!0}function D(ee){const pe=this.stack[this.stack.length-1];pe.depth=this.sliceSerialize(ee).codePointAt(0)===61?1:2}function S(){this.data.setextHeadingSlurpLineEnding=void 0}function T(ee){const Re=this.stack[this.stack.length-1].children;let _t=Re[Re.length-1];(!_t||_t.type!=="text")&&(_t=he(),_t.position={start:aa(ee.start),end:void 0},Re.push(_t)),this.stack.push(_t)}function _(ee){const pe=this.stack.pop();pe.value+=this.sliceSerialize(ee),pe.position.end=aa(ee.end)}function N(ee){const pe=this.stack[this.stack.length-1];if(this.data.atHardBreak){const Re=pe.children[pe.children.length-1];Re.position.end=aa(ee.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(pe.type)&&(T.call(this,ee),_.call(this,ee))}function A(){this.data.atHardBreak=!0}function O(){const ee=this.resume(),pe=this.stack[this.stack.length-1];pe.value=ee}function L(){const ee=this.resume(),pe=this.stack[this.stack.length-1];pe.value=ee}function V(){const ee=this.resume(),pe=this.stack[this.stack.length-1];pe.value=ee}function E(){const ee=this.stack[this.stack.length-1];if(this.data.inReference){const pe=this.data.referenceType||"shortcut";ee.type+="Reference",ee.referenceType=pe,delete ee.url,delete ee.title}else delete ee.identifier,delete ee.label;this.data.referenceType=void 0}function j(){const ee=this.stack[this.stack.length-1];if(this.data.inReference){const pe=this.data.referenceType||"shortcut";ee.type+="Reference",ee.referenceType=pe,delete ee.url,delete ee.title}else delete ee.identifier,delete ee.label;this.data.referenceType=void 0}function H(ee){const pe=this.sliceSerialize(ee),Re=this.stack[this.stack.length-2];Re.label=nZ(pe),Re.identifier=mu(pe).toLowerCase()}function W(){const ee=this.stack[this.stack.length-1],pe=this.resume(),Re=this.stack[this.stack.length-1];if(this.data.inReference=!0,Re.type==="link"){const _t=ee.children;Re.children=_t}else Re.alt=pe}function R(){const ee=this.resume(),pe=this.stack[this.stack.length-1];pe.url=ee}function ae(){const ee=this.resume(),pe=this.stack[this.stack.length-1];pe.title=ee}function re(){this.data.inReference=void 0}function $(){this.data.referenceType="collapsed"}function z(ee){const pe=this.resume(),Re=this.stack[this.stack.length-1];Re.label=pe,Re.identifier=mu(this.sliceSerialize(ee)).toLowerCase(),this.data.referenceType="full"}function le(ee){this.data.characterReferenceType=ee.type}function $e(ee){const pe=this.sliceSerialize(ee),Re=this.data.characterReferenceType;let _t;Re?(_t=aR(pe,Re==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):_t=nk(pe);const Nt=this.stack[this.stack.length-1];Nt.value+=_t}function Be(ee){const pe=this.stack.pop();pe.position.end=aa(ee.end)}function se(ee){_.call(this,ee);const pe=this.stack[this.stack.length-1];pe.url=this.sliceSerialize(ee)}function Se(ee){_.call(this,ee);const pe=this.stack[this.stack.length-1];pe.url="mailto:"+this.sliceSerialize(ee)}function ce(){return{type:"blockquote",children:[]}}function Ee(){return{type:"code",lang:null,meta:null,value:""}}function He(){return{type:"inlineCode",value:""}}function tt(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function ut(){return{type:"emphasis",children:[]}}function Ge(){return{type:"heading",depth:0,children:[]}}function mt(){return{type:"break"}}function ht(){return{type:"html",value:""}}function Ie(){return{type:"image",title:null,url:"",alt:null}}function ge(){return{type:"link",title:null,url:"",children:[]}}function ie(ee){return{type:"list",ordered:ee.type==="listOrdered",start:null,spread:ee._spread,children:[]}}function me(ee){return{type:"listItem",spread:ee._spread,checked:null,children:[]}}function Q(){return{type:"paragraph",children:[]}}function X(){return{type:"strong",children:[]}}function he(){return{type:"text",value:""}}function ke(){return{type:"thematicBreak"}}}function aa(t){return{line:t.line,column:t.column,offset:t.offset}}function xR(t,e){let n=-1;for(;++n<e.length;){const r=e[n];Array.isArray(r)?xR(t,r):oZ(t,r)}}function oZ(t,e){let n;for(n in e)if(yR.call(e,n))switch(n){case"canContainEols":{const r=e[n];r&&t[n].push(...r);break}case"transforms":{const r=e[n];r&&t[n].push(...r);break}case"enter":case"exit":{const r=e[n];r&&Object.assign(t[n],r);break}}}function FC(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+qd({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+qd({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+qd({start:e.start,end:e.end})+") is still open")}function aZ(t){const e=this;e.parser=n;function n(r){return sZ(r,{...e.data("settings"),...t,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function lZ(t,e){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(e),!0)};return t.patch(e,n),t.applyData(e,n)}function cZ(t,e){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(e,n),[t.applyData(e,n),{type:"text",value:`
`}]}function uZ(t,e){const n=e.value?e.value+`
`:"",r={},s=e.lang?e.lang.split(/\s+/):[];s.length>0&&(r.className=["language-"+s[0]]);let i={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]};return e.meta&&(i.data={meta:e.meta}),t.patch(e,i),i=t.applyData(e,i),i={type:"element",tagName:"pre",properties:{},children:[i]},t.patch(e,i),i}function dZ(t,e){const n={type:"element",tagName:"del",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function fZ(t,e){const n={type:"element",tagName:"em",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function hZ(t,e){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",r=String(e.identifier).toUpperCase(),s=Wu(r.toLowerCase()),i=t.footnoteOrder.indexOf(r);let o,a=t.footnoteCounts.get(r);a===void 0?(a=0,t.footnoteOrder.push(r),o=t.footnoteOrder.length):o=i+1,a+=1,t.footnoteCounts.set(r,a);const l={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+s,id:n+"fnref-"+s+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};t.patch(e,l);const u={type:"element",tagName:"sup",properties:{},children:[l]};return t.patch(e,u),t.applyData(e,u)}function pZ(t,e){const n={type:"element",tagName:"h"+e.depth,properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function mZ(t,e){if(t.options.allowDangerousHtml){const n={type:"raw",value:e.value};return t.patch(e,n),t.applyData(e,n)}}function bR(t,e){const n=e.referenceType;let r="]";if(n==="collapsed"?r+="[]":n==="full"&&(r+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+r}];const s=t.all(e),i=s[0];i&&i.type==="text"?i.value="["+i.value:s.unshift({type:"text",value:"["});const o=s[s.length-1];return o&&o.type==="text"?o.value+=r:s.push({type:"text",value:r}),s}function gZ(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return bR(t,e);const s={src:Wu(r.url||""),alt:e.alt};r.title!==null&&r.title!==void 0&&(s.title=r.title);const i={type:"element",tagName:"img",properties:s,children:[]};return t.patch(e,i),t.applyData(e,i)}function yZ(t,e){const n={src:Wu(e.url)};e.alt!==null&&e.alt!==void 0&&(n.alt=e.alt),e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"img",properties:n,children:[]};return t.patch(e,r),t.applyData(e,r)}function xZ(t,e){const n={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};t.patch(e,n);const r={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(e,r),t.applyData(e,r)}function bZ(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return bR(t,e);const s={href:Wu(r.url||"")};r.title!==null&&r.title!==void 0&&(s.title=r.title);const i={type:"element",tagName:"a",properties:s,children:t.all(e)};return t.patch(e,i),t.applyData(e,i)}function vZ(t,e){const n={href:Wu(e.url)};e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"a",properties:n,children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function wZ(t,e,n){const r=t.all(e),s=n?kZ(n):vR(e),i={},o=[];if(typeof e.checked=="boolean"){const d=r[0];let f;d&&d.type==="element"&&d.tagName==="p"?f=d:(f={type:"element",tagName:"p",properties:{},children:[]},r.unshift(f)),f.children.length>0&&f.children.unshift({type:"text",value:" "}),f.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),i.className=["task-list-item"]}let a=-1;for(;++a<r.length;){const d=r[a];(s||a!==0||d.type!=="element"||d.tagName!=="p")&&o.push({type:"text",value:`
`}),d.type==="element"&&d.tagName==="p"&&!s?o.push(...d.children):o.push(d)}const l=r[r.length-1];l&&(s||l.type!=="element"||l.tagName!=="p")&&o.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:i,children:o};return t.patch(e,u),t.applyData(e,u)}function kZ(t){let e=!1;if(t.type==="list"){e=t.spread||!1;const n=t.children;let r=-1;for(;!e&&++r<n.length;)e=vR(n[r])}return e}function vR(t){const e=t.spread;return e??t.children.length>1}function SZ(t,e){const n={},r=t.all(e);let s=-1;for(typeof e.start=="number"&&e.start!==1&&(n.start=e.start);++s<r.length;){const o=r[s];if(o.type==="element"&&o.tagName==="li"&&o.properties&&Array.isArray(o.properties.className)&&o.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const i={type:"element",tagName:e.ordered?"ol":"ul",properties:n,children:t.wrap(r,!0)};return t.patch(e,i),t.applyData(e,i)}function _Z(t,e){const n={type:"element",tagName:"p",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function TZ(t,e){const n={type:"root",children:t.wrap(t.all(e))};return t.patch(e,n),t.applyData(e,n)}function CZ(t,e){const n={type:"element",tagName:"strong",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function EZ(t,e){const n=t.all(e),r=n.shift(),s=[];if(r){const o={type:"element",tagName:"thead",properties:{},children:t.wrap([r],!0)};t.patch(e.children[0],o),s.push(o)}if(n.length>0){const o={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},a=Qw(e.children[1]),l=eR(e.children[e.children.length-1]);a&&l&&(o.position={start:a,end:l}),s.push(o)}const i={type:"element",tagName:"table",properties:{},children:t.wrap(s,!0)};return t.patch(e,i),t.applyData(e,i)}function NZ(t,e,n){const r=n?n.children:void 0,i=(r?r.indexOf(e):1)===0?"th":"td",o=n&&n.type==="table"?n.align:void 0,a=o?o.length:e.children.length;let l=-1;const u=[];for(;++l<a;){const f=e.children[l],h={},p=o?o[l]:void 0;p&&(h.align=p);let m={type:"element",tagName:i,properties:h,children:[]};f&&(m.children=t.all(f),t.patch(f,m),m=t.applyData(f,m)),u.push(m)}const d={type:"element",tagName:"tr",properties:{},children:t.wrap(u,!0)};return t.patch(e,d),t.applyData(e,d)}function jZ(t,e){const n={type:"element",tagName:"td",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}const BC=9,UC=32;function IZ(t){const e=String(t),n=/\r?\n|\r/g;let r=n.exec(e),s=0;const i=[];for(;r;)i.push(HC(e.slice(s,r.index),s>0,!0),r[0]),s=r.index+r[0].length,r=n.exec(e);return i.push(HC(e.slice(s),s>0,!1)),i.join("")}function HC(t,e,n){let r=0,s=t.length;if(e){let i=t.codePointAt(r);for(;i===BC||i===UC;)r++,i=t.codePointAt(r)}if(n){let i=t.codePointAt(s-1);for(;i===BC||i===UC;)s--,i=t.codePointAt(s-1)}return s>r?t.slice(r,s):""}function MZ(t,e){const n={type:"text",value:IZ(String(e.value))};return t.patch(e,n),t.applyData(e,n)}function DZ(t,e){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(e,n),t.applyData(e,n)}const AZ={blockquote:lZ,break:cZ,code:uZ,delete:dZ,emphasis:fZ,footnoteReference:hZ,heading:pZ,html:mZ,imageReference:gZ,image:yZ,inlineCode:xZ,linkReference:bZ,link:vZ,listItem:wZ,list:SZ,paragraph:_Z,root:TZ,strong:CZ,table:EZ,tableCell:jZ,tableRow:NZ,text:MZ,thematicBreak:DZ,toml:Jh,yaml:Jh,definition:Jh,footnoteDefinition:Jh};function Jh(){}const wR=-1,i0=0,Jd=1,lg=2,ik=3,ok=4,ak=5,lk=6,kR=7,SR=8,VC=typeof self=="object"?self:globalThis,RZ=(t,e)=>{const n=(s,i)=>(t.set(i,s),s),r=s=>{if(t.has(s))return t.get(s);const[i,o]=e[s];switch(i){case i0:case wR:return n(o,s);case Jd:{const a=n([],s);for(const l of o)a.push(r(l));return a}case lg:{const a=n({},s);for(const[l,u]of o)a[r(l)]=r(u);return a}case ik:return n(new Date(o),s);case ok:{const{source:a,flags:l}=o;return n(new RegExp(a,l),s)}case ak:{const a=n(new Map,s);for(const[l,u]of o)a.set(r(l),r(u));return a}case lk:{const a=n(new Set,s);for(const l of o)a.add(r(l));return a}case kR:{const{name:a,message:l}=o;return n(new VC[a](l),s)}case SR:return n(BigInt(o),s);case"BigInt":return n(Object(BigInt(o)),s);case"ArrayBuffer":return n(new Uint8Array(o).buffer,o);case"DataView":{const{buffer:a}=new Uint8Array(o);return n(new DataView(a),o)}}return n(new VC[i](o),s)};return r},WC=t=>RZ(new Map,t)(0),kc="",{toString:OZ}={},{keys:PZ}=Object,ad=t=>{const e=typeof t;if(e!=="object"||!t)return[i0,e];const n=OZ.call(t).slice(8,-1);switch(n){case"Array":return[Jd,kc];case"Object":return[lg,kc];case"Date":return[ik,kc];case"RegExp":return[ok,kc];case"Map":return[ak,kc];case"Set":return[lk,kc];case"DataView":return[Jd,n]}return n.includes("Array")?[Jd,n]:n.includes("Error")?[kR,n]:[lg,n]},Xh=([t,e])=>t===i0&&(e==="function"||e==="symbol"),LZ=(t,e,n,r)=>{const s=(o,a)=>{const l=r.push(o)-1;return n.set(a,l),l},i=o=>{if(n.has(o))return n.get(o);let[a,l]=ad(o);switch(a){case i0:{let d=o;switch(l){case"bigint":a=SR,d=o.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+l);d=null;break;case"undefined":return s([wR],o)}return s([a,d],o)}case Jd:{if(l){let h=o;return l==="DataView"?h=new Uint8Array(o.buffer):l==="ArrayBuffer"&&(h=new Uint8Array(o)),s([l,[...h]],o)}const d=[],f=s([a,d],o);for(const h of o)d.push(i(h));return f}case lg:{if(l)switch(l){case"BigInt":return s([l,o.toString()],o);case"Boolean":case"Number":case"String":return s([l,o.valueOf()],o)}if(e&&"toJSON"in o)return i(o.toJSON());const d=[],f=s([a,d],o);for(const h of PZ(o))(t||!Xh(ad(o[h])))&&d.push([i(h),i(o[h])]);return f}case ik:return s([a,o.toISOString()],o);case ok:{const{source:d,flags:f}=o;return s([a,{source:d,flags:f}],o)}case ak:{const d=[],f=s([a,d],o);for(const[h,p]of o)(t||!(Xh(ad(h))||Xh(ad(p))))&&d.push([i(h),i(p)]);return f}case lk:{const d=[],f=s([a,d],o);for(const h of o)(t||!Xh(ad(h)))&&d.push(i(h));return f}}const{message:u}=o;return s([a,{name:l,message:u}],o)};return i},KC=(t,{json:e,lossy:n}={})=>{const r=[];return LZ(!(e||n),!!e,new Map,r)(t),r},cg=typeof structuredClone=="function"?(t,e)=>e&&("json"in e||"lossy"in e)?WC(KC(t,e)):structuredClone(t):(t,e)=>WC(KC(t,e));function $Z(t,e){const n=[{type:"text",value:""}];return e>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),n}function zZ(t,e){return"Back to reference "+(t+1)+(e>1?"-"+e:"")}function FZ(t){const e=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||$Z,r=t.options.footnoteBackLabel||zZ,s=t.options.footnoteLabel||"Footnotes",i=t.options.footnoteLabelTagName||"h2",o=t.options.footnoteLabelProperties||{className:["sr-only"]},a=[];let l=-1;for(;++l<t.footnoteOrder.length;){const u=t.footnoteById.get(t.footnoteOrder[l]);if(!u)continue;const d=t.all(u),f=String(u.identifier).toUpperCase(),h=Wu(f.toLowerCase());let p=0;const m=[],y=t.footnoteCounts.get(f);for(;y!==void 0&&++p<=y;){m.length>0&&m.push({type:"text",value:" "});let v=typeof n=="string"?n:n(l,p);typeof v=="string"&&(v={type:"text",value:v}),m.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+h+(p>1?"-"+p:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(l,p),className:["data-footnote-backref"]},children:Array.isArray(v)?v:[v]})}const b=d[d.length-1];if(b&&b.type==="element"&&b.tagName==="p"){const v=b.children[b.children.length-1];v&&v.type==="text"?v.value+=" ":b.children.push({type:"text",value:" "}),b.children.push(...m)}else d.push(...m);const g={type:"element",tagName:"li",properties:{id:e+"fn-"+h},children:t.wrap(d,!0)};t.patch(u,g),a.push(g)}if(a.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:i,properties:{...cg(o),id:"footnote-label"},children:[{type:"text",value:s}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(a,!0)},{type:"text",value:`
`}]}}const _R=function(t){if(t==null)return VZ;if(typeof t=="function")return o0(t);if(typeof t=="object")return Array.isArray(t)?BZ(t):UZ(t);if(typeof t=="string")return HZ(t);throw new Error("Expected function, string, or object as test")};function BZ(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=_R(t[n]);return o0(r);function r(...s){let i=-1;for(;++i<e.length;)if(e[i].apply(this,s))return!0;return!1}}function UZ(t){const e=t;return o0(n);function n(r){const s=r;let i;for(i in t)if(s[i]!==e[i])return!1;return!0}}function HZ(t){return o0(e);function e(n){return n&&n.type===t}}function o0(t){return e;function e(n,r,s){return!!(WZ(n)&&t.call(this,n,typeof r=="number"?r:void 0,s||void 0))}}function VZ(){return!0}function WZ(t){return t!==null&&typeof t=="object"&&"type"in t}const TR=[],KZ=!0,GC=!1,GZ="skip";function qZ(t,e,n,r){let s;typeof e=="function"&&typeof n!="function"?(r=n,n=e):s=e;const i=_R(s),o=r?-1:1;a(t,void 0,[])();function a(l,u,d){const f=l&&typeof l=="object"?l:{};if(typeof f.type=="string"){const p=typeof f.tagName=="string"?f.tagName:typeof f.name=="string"?f.name:void 0;Object.defineProperty(h,"name",{value:"node ("+(l.type+(p?"<"+p+">":""))+")"})}return h;function h(){let p=TR,m,y,b;if((!e||i(l,u,d[d.length-1]||void 0))&&(p=YZ(n(l,d)),p[0]===GC))return p;if("children"in l&&l.children){const g=l;if(g.children&&p[0]!==GZ)for(y=(r?g.children.length:-1)+o,b=d.concat(g);y>-1&&y<g.children.length;){const v=g.children[y];if(m=a(v,y,b)(),m[0]===GC)return m;y=typeof m[1]=="number"?m[1]:y+o}}return p}}}function YZ(t){return Array.isArray(t)?t:typeof t=="number"?[KZ,t]:t==null?TR:[t]}function CR(t,e,n,r){let s,i,o;typeof e=="function"&&typeof n!="function"?(i=void 0,o=e,s=n):(i=e,o=n,s=r),qZ(t,i,a,s);function a(l,u){const d=u[u.length-1],f=d?d.children.indexOf(l):void 0;return o(l,f,d)}}const xb={}.hasOwnProperty,JZ={};function XZ(t,e){const n=e||JZ,r=new Map,s=new Map,i=new Map,o={...AZ,...n.handlers},a={all:u,applyData:ZZ,definitionById:r,footnoteById:s,footnoteCounts:i,footnoteOrder:[],handlers:o,one:l,options:n,patch:QZ,wrap:tee};return CR(t,function(d){if(d.type==="definition"||d.type==="footnoteDefinition"){const f=d.type==="definition"?r:s,h=String(d.identifier).toUpperCase();f.has(h)||f.set(h,d)}}),a;function l(d,f){const h=d.type,p=a.handlers[h];if(xb.call(a.handlers,h)&&p)return p(a,d,f);if(a.options.passThrough&&a.options.passThrough.includes(h)){if("children"in d){const{children:y,...b}=d,g=cg(b);return g.children=a.all(d),g}return cg(d)}return(a.options.unknownHandler||eee)(a,d,f)}function u(d){const f=[];if("children"in d){const h=d.children;let p=-1;for(;++p<h.length;){const m=a.one(h[p],d);if(m){if(p&&h[p-1].type==="break"&&(!Array.isArray(m)&&m.type==="text"&&(m.value=qC(m.value)),!Array.isArray(m)&&m.type==="element")){const y=m.children[0];y&&y.type==="text"&&(y.value=qC(y.value))}Array.isArray(m)?f.push(...m):f.push(m)}}}return f}}function QZ(t,e){t.position&&(e.position=OJ(t))}function ZZ(t,e){let n=e;if(t&&t.data){const r=t.data.hName,s=t.data.hChildren,i=t.data.hProperties;if(typeof r=="string")if(n.type==="element")n.tagName=r;else{const o="children"in n?n.children:[n];n={type:"element",tagName:r,properties:{},children:o}}n.type==="element"&&i&&Object.assign(n.properties,cg(i)),"children"in n&&n.children&&s!==null&&s!==void 0&&(n.children=s)}return n}function eee(t,e){const n=e.data||{},r="value"in e&&!(xb.call(n,"hProperties")||xb.call(n,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function tee(t,e){const n=[];let r=-1;for(e&&n.push({type:"text",value:`
`});++r<t.length;)r&&n.push({type:"text",value:`
`}),n.push(t[r]);return e&&t.length>0&&n.push({type:"text",value:`
`}),n}function qC(t){let e=0,n=t.charCodeAt(e);for(;n===9||n===32;)e++,n=t.charCodeAt(e);return t.slice(e)}function YC(t,e){const n=XZ(t,e),r=n.one(t,void 0),s=FZ(n),i=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return s&&i.children.push({type:"text",value:`
`},s),i}function nee(t,e){return t&&"run"in t?async function(n,r){const s=YC(n,{file:r,...e});await t.run(s,r)}:function(n,r){return YC(n,{file:r,...t||e})}}function JC(t){if(t)throw t}var Rp=Object.prototype.hasOwnProperty,ER=Object.prototype.toString,XC=Object.defineProperty,QC=Object.getOwnPropertyDescriptor,ZC=function(e){return typeof Array.isArray=="function"?Array.isArray(e):ER.call(e)==="[object Array]"},eE=function(e){if(!e||ER.call(e)!=="[object Object]")return!1;var n=Rp.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&Rp.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!r)return!1;var s;for(s in e);return typeof s>"u"||Rp.call(e,s)},tE=function(e,n){XC&&n.name==="__proto__"?XC(e,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):e[n.name]=n.newValue},nE=function(e,n){if(n==="__proto__")if(Rp.call(e,n)){if(QC)return QC(e,n).value}else return;return e[n]},ree=function t(){var e,n,r,s,i,o,a=arguments[0],l=1,u=arguments.length,d=!1;for(typeof a=="boolean"&&(d=a,a=arguments[1]||{},l=2),(a==null||typeof a!="object"&&typeof a!="function")&&(a={});l<u;++l)if(e=arguments[l],e!=null)for(n in e)r=nE(a,n),s=nE(e,n),a!==s&&(d&&s&&(eE(s)||(i=ZC(s)))?(i?(i=!1,o=r&&ZC(r)?r:[]):o=r&&eE(r)?r:{},tE(a,{name:n,newValue:t(d,o,s)})):typeof s<"u"&&tE(a,{name:n,newValue:s}));return a};const Fy=fg(ree);function bb(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function see(){const t=[],e={run:n,use:r};return e;function n(...s){let i=-1;const o=s.pop();if(typeof o!="function")throw new TypeError("Expected function as last argument, not "+o);a(null,...s);function a(l,...u){const d=t[++i];let f=-1;if(l){o(l);return}for(;++f<s.length;)(u[f]===null||u[f]===void 0)&&(u[f]=s[f]);s=u,d?iee(d,a)(...u):o(null,...u)}}function r(s){if(typeof s!="function")throw new TypeError("Expected `middelware` to be a function, not "+s);return t.push(s),e}}function iee(t,e){let n;return r;function r(...o){const a=t.length>o.length;let l;a&&o.push(s);try{l=t.apply(this,o)}catch(u){const d=u;if(a&&n)throw d;return s(d)}a||(l&&l.then&&typeof l.then=="function"?l.then(i,s):l instanceof Error?s(l):i(l))}function s(o,...a){n||(n=!0,e(o,...a))}function i(o){s(null,o)}}const oo={basename:oee,dirname:aee,extname:lee,join:cee,sep:"/"};function oee(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');uh(t);let n=0,r=-1,s=t.length,i;if(e===void 0||e.length===0||e.length>t.length){for(;s--;)if(t.codePointAt(s)===47){if(i){n=s+1;break}}else r<0&&(i=!0,r=s+1);return r<0?"":t.slice(n,r)}if(e===t)return"";let o=-1,a=e.length-1;for(;s--;)if(t.codePointAt(s)===47){if(i){n=s+1;break}}else o<0&&(i=!0,o=s+1),a>-1&&(t.codePointAt(s)===e.codePointAt(a--)?a<0&&(r=s):(a=-1,r=o));return n===r?r=o:r<0&&(r=t.length),t.slice(n,r)}function aee(t){if(uh(t),t.length===0)return".";let e=-1,n=t.length,r;for(;--n;)if(t.codePointAt(n)===47){if(r){e=n;break}}else r||(r=!0);return e<0?t.codePointAt(0)===47?"/":".":e===1&&t.codePointAt(0)===47?"//":t.slice(0,e)}function lee(t){uh(t);let e=t.length,n=-1,r=0,s=-1,i=0,o;for(;e--;){const a=t.codePointAt(e);if(a===47){if(o){r=e+1;break}continue}n<0&&(o=!0,n=e+1),a===46?s<0?s=e:i!==1&&(i=1):s>-1&&(i=-1)}return s<0||n<0||i===0||i===1&&s===n-1&&s===r+1?"":t.slice(s,n)}function cee(...t){let e=-1,n;for(;++e<t.length;)uh(t[e]),t[e]&&(n=n===void 0?t[e]:n+"/"+t[e]);return n===void 0?".":uee(n)}function uee(t){uh(t);const e=t.codePointAt(0)===47;let n=dee(t,!e);return n.length===0&&!e&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),e?"/"+n:n}function dee(t,e){let n="",r=0,s=-1,i=0,o=-1,a,l;for(;++o<=t.length;){if(o<t.length)a=t.codePointAt(o);else{if(a===47)break;a=47}if(a===47){if(!(s===o-1||i===1))if(s!==o-1&&i===2){if(n.length<2||r!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(l=n.lastIndexOf("/"),l!==n.length-1){l<0?(n="",r=0):(n=n.slice(0,l),r=n.length-1-n.lastIndexOf("/")),s=o,i=0;continue}}else if(n.length>0){n="",r=0,s=o,i=0;continue}}e&&(n=n.length>0?n+"/..":"..",r=2)}else n.length>0?n+="/"+t.slice(s+1,o):n=t.slice(s+1,o),r=o-s-1;s=o,i=0}else a===46&&i>-1?i++:i=-1}return n}function uh(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const fee={cwd:hee};function hee(){return"/"}function vb(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function pee(t){if(typeof t=="string")t=new URL(t);else if(!vb(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(t.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return mee(t)}function mee(t){if(t.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=t.pathname;let n=-1;for(;++n<e.length;)if(e.codePointAt(n)===37&&e.codePointAt(n+1)===50){const r=e.codePointAt(n+2);if(r===70||r===102){const s=new TypeError("File URL path must not include encoded / characters");throw s.code="ERR_INVALID_FILE_URL_PATH",s}}return decodeURIComponent(e)}const By=["history","path","basename","stem","extname","dirname"];class NR{constructor(e){let n;e?vb(e)?n={path:e}:typeof e=="string"||gee(e)?n={value:e}:n=e:n={},this.cwd="cwd"in n?"":fee.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<By.length;){const i=By[r];i in n&&n[i]!==void 0&&n[i]!==null&&(this[i]=i==="history"?[...n[i]]:n[i])}let s;for(s in n)By.includes(s)||(this[s]=n[s])}get basename(){return typeof this.path=="string"?oo.basename(this.path):void 0}set basename(e){Hy(e,"basename"),Uy(e,"basename"),this.path=oo.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?oo.dirname(this.path):void 0}set dirname(e){rE(this.basename,"dirname"),this.path=oo.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?oo.extname(this.path):void 0}set extname(e){if(Uy(e,"extname"),rE(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=oo.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){vb(e)&&(e=pee(e)),Hy(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?oo.basename(this.path,this.extname):void 0}set stem(e){Hy(e,"stem"),Uy(e,"stem"),this.path=oo.join(this.dirname||"",e+(this.extname||""))}fail(e,n,r){const s=this.message(e,n,r);throw s.fatal=!0,s}info(e,n,r){const s=this.message(e,n,r);return s.fatal=void 0,s}message(e,n,r){const s=new xs(e,n,r);return this.path&&(s.name=this.path+":"+s.name,s.file=this.path),s.fatal=!1,this.messages.push(s),s}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function Uy(t,e){if(t&&t.includes(oo.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+oo.sep+"`")}function Hy(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function rE(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}function gee(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const yee=function(t){const r=this.constructor.prototype,s=r[t],i=function(){return s.apply(i,arguments)};return Object.setPrototypeOf(i,r),i},xee={}.hasOwnProperty;class ck extends yee{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=see()}copy(){const e=new ck;let n=-1;for(;++n<this.attachers.length;){const r=this.attachers[n];e.use(...r)}return e.data(Fy(!0,{},this.namespace)),e}data(e,n){return typeof e=="string"?arguments.length===2?(Ky("data",this.frozen),this.namespace[e]=n,this):xee.call(this.namespace,e)&&this.namespace[e]||void 0:e?(Ky("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const s=n.call(e,...r);typeof s=="function"&&this.transformers.use(s)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=Qh(e),r=this.parser||this.Parser;return Vy("parse",r),r(String(n),n)}process(e,n){const r=this;return this.freeze(),Vy("process",this.parser||this.Parser),Wy("process",this.compiler||this.Compiler),n?s(void 0,n):new Promise(s);function s(i,o){const a=Qh(e),l=r.parse(a);r.run(l,a,function(d,f,h){if(d||!f||!h)return u(d);const p=f,m=r.stringify(p,h);wee(m)?h.value=m:h.result=m,u(d,h)});function u(d,f){d||!f?o(d):i?i(f):n(void 0,f)}}}processSync(e){let n=!1,r;return this.freeze(),Vy("processSync",this.parser||this.Parser),Wy("processSync",this.compiler||this.Compiler),this.process(e,s),iE("processSync","process",n),r;function s(i,o){n=!0,JC(i),r=o}}run(e,n,r){sE(e),this.freeze();const s=this.transformers;return!r&&typeof n=="function"&&(r=n,n=void 0),r?i(void 0,r):new Promise(i);function i(o,a){const l=Qh(n);s.run(e,l,u);function u(d,f,h){const p=f||e;d?a(d):o?o(p):r(void 0,p,h)}}}runSync(e,n){let r=!1,s;return this.run(e,n,i),iE("runSync","run",r),s;function i(o,a){JC(o),s=a,r=!0}}stringify(e,n){this.freeze();const r=Qh(n),s=this.compiler||this.Compiler;return Wy("stringify",s),sE(e),s(e,r)}use(e,...n){const r=this.attachers,s=this.namespace;if(Ky("use",this.frozen),e!=null)if(typeof e=="function")l(e,n);else if(typeof e=="object")Array.isArray(e)?a(e):o(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function i(u){if(typeof u=="function")l(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[d,...f]=u;l(d,f)}else o(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function o(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(u.plugins),u.settings&&(s.settings=Fy(!0,s.settings,u.settings))}function a(u){let d=-1;if(u!=null)if(Array.isArray(u))for(;++d<u.length;){const f=u[d];i(f)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function l(u,d){let f=-1,h=-1;for(;++f<r.length;)if(r[f][0]===u){h=f;break}if(h===-1)r.push([u,...d]);else if(d.length>0){let[p,...m]=d;const y=r[h][1];bb(y)&&bb(p)&&(p=Fy(!0,y,p)),r[h]=[u,p,...m]}}}}const bee=new ck().freeze();function Vy(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function Wy(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function Ky(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function sE(t){if(!bb(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function iE(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function Qh(t){return vee(t)?t:new NR(t)}function vee(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function wee(t){return typeof t=="string"||kee(t)}function kee(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const See="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",oE=[],aE={allowDangerousHtml:!0},_ee=/^(https?|ircs?|mailto|xmpp)$/i,Tee=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function uk(t){const e=Cee(t),n=Eee(t);return Nee(e.runSync(e.parse(n),n),t)}function Cee(t){const e=t.rehypePlugins||oE,n=t.remarkPlugins||oE,r=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...aE}:aE;return bee().use(aZ).use(n).use(nee,r).use(e)}function Eee(t){const e=t.children||"",n=new NR;return typeof e=="string"&&(n.value=e),n}function Nee(t,e){const n=e.allowedElements,r=e.allowElement,s=e.components,i=e.disallowedElements,o=e.skipHtml,a=e.unwrapDisallowed,l=e.urlTransform||jee;for(const d of Tee)Object.hasOwn(e,d.from)&&(""+d.from+(d.to?"use `"+d.to+"` instead":"remove it")+See+d.id,void 0);return CR(t,u),FJ(t,{Fragment:c.Fragment,components:s,ignoreInvalidStyle:!0,jsx:c.jsx,jsxs:c.jsxs,passKeys:!0,passNode:!0});function u(d,f,h){if(d.type==="raw"&&h&&typeof f=="number")return o?h.children.splice(f,1):h.children[f]={type:"text",value:d.value},f;if(d.type==="element"){let p;for(p in Ly)if(Object.hasOwn(Ly,p)&&Object.hasOwn(d.properties,p)){const m=d.properties[p],y=Ly[p];(y===null||y.includes(d.tagName))&&(d.properties[p]=l(String(m||""),p,d))}}if(d.type==="element"){let p=n?!n.includes(d.tagName):i?i.includes(d.tagName):!1;if(!p&&r&&typeof f=="number"&&(p=!r(d,f,h)),p&&h&&typeof f=="number")return a&&d.children?h.children.splice(f,1,...d.children):h.children.splice(f,1),f}}}function jee(t){const e=t.indexOf(":"),n=t.indexOf("?"),r=t.indexOf("#"),s=t.indexOf("/");return e===-1||s!==-1&&e>s||n!==-1&&e>n||r!==-1&&e>r||_ee.test(t.slice(0,e))?t:""}const Iee=[{label:"",value:null},{label:"",value:0},{label:"5 ",value:5},{label:"15 ",value:15},{label:"30 ",value:30},{label:"1 ",value:60},{label:"2 ",value:120},{label:"1 ",value:1440}],Mee=({value:t,onChange:e})=>{const[n,r]=x.useState(!1),[s,i]=x.useState(""),[o,a]=x.useState("minutes"),l=()=>t==null?"":t===0?"":t<60?`${t} `:t<1440?`${t/60} `:`${t/1440} `,u=()=>{const f=parseInt(s);if(isNaN(f)||f<=0)return;let h=f;o==="hours"&&(h=f*60),o==="days"&&(h=f*1440),e(h),r(!1),i("")},d=t!=null;return c.jsxs("div",{className:"relative",children:[c.jsxs("button",{type:"button",onClick:()=>r(!n),className:`flex items-center gap-1.5 px-2 py-1 rounded-lg text-xs transition-colors ${d?"bg-orange-100 text-orange-600 hover:bg-orange-200":"bg-gray-100 text-gray-500 hover:bg-gray-200"}`,title:"",children:[d?c.jsx(Wa,{size:12}):c.jsx(i1,{size:12}),c.jsx("span",{children:l()}),c.jsx(ts,{size:10})]}),n&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>r(!1)}),c.jsxs("div",{className:"absolute left-0 top-full mt-1 w-48 bg-white rounded-lg shadow-xl border border-gray-200 z-50 overflow-hidden",children:[Iee.map(f=>c.jsxs("button",{type:"button",onClick:()=>{e(f.value),r(!1)},className:`w-full px-3 py-2 text-left text-sm hover:bg-orange-50 transition-colors flex items-center gap-2 ${t===f.value?"bg-orange-100 text-orange-700 font-medium":"text-gray-700"}`,children:[f.value===null?c.jsx(i1,{size:12}):c.jsx(Wa,{size:12}),f.label]},f.value??"null")),c.jsxs("div",{className:"border-t border-gray-100 p-2",children:[c.jsx("div",{className:"text-[10px] text-gray-400 mb-1.5",children:""}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("input",{type:"number",value:s,onChange:f=>i(f.target.value),placeholder:"",className:"flex-1 px-2 py-1 text-xs border rounded w-14",min:1}),c.jsxs("select",{value:o,onChange:f=>a(f.target.value),className:"px-1 py-1 text-xs border rounded",children:[c.jsx("option",{value:"minutes",children:""}),c.jsx("option",{value:"hours",children:""}),c.jsx("option",{value:"days",children:""})]}),c.jsx("button",{type:"button",onClick:u,className:"px-2 py-1 text-xs bg-orange-500 text-white rounded hover:bg-orange-600",children:""})]})]}),d&&c.jsxs("button",{type:"button",onClick:()=>{e(null),r(!1)},className:"w-full px-3 py-2 text-left text-xs text-red-500 hover:bg-red-50 border-t border-gray-100 flex items-center gap-2",children:[c.jsx(un,{size:12}),""]})]})]})]})},lE=t=>{if(!t)return"";let e=t;e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/^### (.*$)/gm,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gm,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gm,"<h1>$1</h1>");const n=e.split(`
`);let r=!1,s=[];for(let i=0;i<n.length;i++){const o=n[i];if(/^[*-] /.test(o)||/^\d+\. /.test(o)){r||(s.push("<ul>"),r=!0);const l=o.replace(/^[*-] |^\d+\. /,"");s.push(`<li>${l}</li>`)}else r&&(s.push("</ul>"),r=!1),o.trim()===""||(o.startsWith("<h")?s.push(o):s.push(`<p>${o}</p>`))}return r&&s.push("</ul>"),s.join("")},cE=t=>{if(!t)return"";if(!t.includes("<")||!t.includes(">"))return t;let e=t;return e=e.replace(/<\/p>/gi,`
`),e=e.replace(/<br\s*\/?>/gi,`
`),e=e.replace(/<\/div>/gi,`
`),e=e.replace(/<[^>]+>/g,""),e=e.replace(/&nbsp;/g," "),e=e.replace(/&amp;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e.trim()},Dee="",Lo=({initialData:t,onClose:e,isQuickAdd:n=!1,isEmbedded:r=!1,isReadOnly:s=!1})=>{var mk,gk,yk;const{addTask:i,updateTask:o,tags:a,tasks:l,addTag:u,deleteTag:d,setFocusedTaskId:f,themeSettings:h,toggleExpansion:p,setSelectedTaskIds:m,deleteTask:y,visibleTasks:b,user:g,setToast:v,t:w,navigateToTask:C}=x.useContext(En),[I,k]=x.useState((t==null?void 0:t.title)||""),[D,S]=x.useState((t==null?void 0:t.description)||""),[T,_]=x.useState((t==null?void 0:t.due_date)||null),[N,A]=x.useState((t==null?void 0:t.start_date)||null),[O,L]=x.useState((t==null?void 0:t.tags)||[]),[V,E]=x.useState((t==null?void 0:t.images)||[]),[j,H]=x.useState((t==null?void 0:t.attachments)||[]),[W,R]=x.useState(!1),[ae,re]=x.useState((t==null?void 0:t.parent_id)||null),[$,z]=x.useState([]),[le,$e]=x.useState((t==null?void 0:t.is_project)||!1),[Be,se]=x.useState((t==null?void 0:t.color)||"gray"),[Se,ce]=x.useState((t==null?void 0:t.importance)||"unplanned"),[Ee,He]=x.useState((t==null?void 0:t.is_all_day)!==void 0?t.is_all_day:!0),[tt,ut]=x.useState(()=>{if(t!=null&&t.start_time)return t.start_time;if(t!=null&&t.start_date&&!(t!=null&&t.is_all_day)){const M=new Date(t.start_date);return`${String(M.getHours()).padStart(2,"0")}:${String(M.getMinutes()).padStart(2,"0")}`}return"09:00"}),[Ge,mt]=x.useState(()=>{if(t!=null&&t.end_time)return t.end_time;if(t!=null&&t.start_date&&!(t!=null&&t.is_all_day)){const M=new Date(t.start_date),K=typeof t.duration=="number"?t.duration:60;return M.setMinutes(M.getMinutes()+K),`${String(M.getHours()).padStart(2,"0")}:${String(M.getMinutes()).padStart(2,"0")}`}return"10:00"}),[ht,Ie]=x.useState((t==null?void 0:t.duration)||""),[ge,ie]=x.useState((t==null?void 0:t.repeat_rule)||null),[me,Q]=x.useState(!1),[X,he]=x.useState(()=>{if(t!=null&&t.id)try{const M=localStorage.getItem(`task_reminder_${t.id}`);if(M!==null)return JSON.parse(M)}catch{}return(t==null?void 0:t.reminder_minutes)??null});x.useEffect(()=>{if(t!=null&&t.id)try{X!==null?localStorage.setItem(`task_reminder_${t.id}`,JSON.stringify(X)):localStorage.removeItem(`task_reminder_${t.id}`)}catch{}},[X,t==null?void 0:t.id]);const[ke,ee]=x.useState(!1),[pe,Re]=x.useState(!1),[_t,Nt]=x.useState(!1),[ot,Ot]=x.useState(null),we=x.useRef(null),qe=x.useRef(null),Ke=x.useRef(null),it=x.useRef(null),[Me,yt]=x.useState(null),fe=x.useRef(null),ye=x.useRef(null),[_e,ft]=x.useState(null),[lt,nt]=x.useState(null),[Et,jt]=x.useState(null),[ne,Te]=x.useState(null),[Ce,rt]=x.useState(null),[q,De]=x.useState(new Set),[st,Y]=x.useState(!1),[Fe,Ue]=x.useState(!1),[ze,Qe]=x.useState(""),[Z,Ne]=x.useState(!1),[Pe,We]=x.useState(!1),[kt,Vt]=x.useState(""),[Ft,nn]=x.useState(""),[Xt,Jt]=x.useState(0),[fn,yn]=x.useState(0),[_n,Fn]=x.useState(!1),[Hn,is]=x.useState({isOpen:!1,title:"",content:"",history:[],historyIndex:-1}),[Gs,ui]=x.useState(!1),[Nn,Oi]=x.useState(!1),[ea,ta]=x.useState([]),{isRecording:di,startRecording:il,stopRecording:ol,recordingTaskId:Ir,recordingTime:Co}=x.useContext(Lu),al=M=>{const K=Math.floor(M/1e3),oe=Math.floor(K/60),ve=K%60;return`${oe}:${ve.toString().padStart(2,"0")}`},dc=async(M,K,oe)=>{if(console.log("TaskInput handleSaveAudio called with:",M.name,K,oe),!xe)return;const ve=`${Date.now()}_${crypto.randomUUID()}.${M.name.split(".").pop()}`,bt=`${(g==null?void 0:g.id)||"anonymous"}/${ve}`;try{const{error:Pt}=await xe.storage.from("attachments").upload(bt,M,{contentType:M.type,upsert:!1});if(Pt){console.error("Upload voice error:",Pt),v==null||v({msg:"",type:"error"});return}const{data:Zt}=xe.storage.from("attachments").getPublicUrl(bt);if(Zt){const tn={name:M.name,url:Zt.publicUrl,size:M.size,type:M.type,markers:K,recordingId:oe},cn=[...j,tn];H(cn),t&&o(t.id,{attachments:cn},[],{skipHistory:!0}),v==null||v({msg:"",type:"info"})}}catch(Pt){console.error(Pt),v==null||v({msg:"",type:"error"})}};x.useEffect(()=>{const M=K=>{const oe=K.detail;oe&&oe.taskId===(t==null?void 0:t.id)&&oe.attachment&&(console.log("[TaskInput] Recording saved event - updating local attachments state"),H(ve=>ve.some(bt=>bt.url===oe.attachment.url)?ve:[...ve,oe.attachment]))};return window.addEventListener("recording-saved",M),()=>window.removeEventListener("recording-saved",M)},[t==null?void 0:t.id]);const[jn,Pi]=x.useState((t==null?void 0:t.ai_history)||[]),[er,na]=x.useState(t!=null&&t.ai_history?t.ai_history.length-1:-1),[ll,tr]=x.useState(""),[ue,Dt]=x.useState(!1),[Ut,Ht]=x.useState(!1),[$t,rn]=x.useState(!1),[Dn,Bn]=x.useState(0),[zn,Rn]=x.useState((t==null?void 0:t.attachment_links)||[]),[hn,xr]=x.useState(!1),ar=x.useMemo(()=>{const M=a.find(K=>K.name.trim().toLowerCase()==="prompt");return M?l.filter(K=>K.tags.includes(M.id)&&K.status!=="deleted"&&K.status!=="logged").sort((K,oe)=>oe.created_at.localeCompare(K.created_at)):[]},[l,a]),Ns=x.useMemo(()=>{if(!Ft.trim())return ar;const M=Ft.toLowerCase();return ar.filter(K=>K.title.toLowerCase().includes(M)||K.description&&K.description.toLowerCase().includes(M))},[ar,Ft]),qs=x.useMemo(()=>ar.slice(0,5),[ar]);x.useEffect(()=>{if(!Ft.trim()){yn(0),Jt(0);return}let M=0;Ns.forEach(K=>{const oe=(K.title.match(new RegExp(Ft,"gi"))||[]).length,ve=K.description?(K.description.match(new RegExp(Ft,"gi"))||[]).length:0;M+=oe+ve}),yn(M),Jt(0)},[Ft,Ns]);const On=M=>{is(K=>{const oe={title:K.title,content:M},ve=[...K.history.slice(0,K.historyIndex+1),oe];return{...K,content:M,history:ve,historyIndex:ve.length-1}})},nr=M=>{is(K=>{const oe={title:M,content:K.content},ve=[...K.history.slice(0,K.historyIndex+1),oe];return{...K,title:M,history:ve,historyIndex:ve.length-1}})},Mr=()=>{is(M=>{if(M.historyIndex<=0)return M;const K=M.historyIndex-1;return{...M,title:M.history[K].title,content:M.history[K].content,historyIndex:K}})},B=()=>{is(M=>{if(M.historyIndex>=M.history.length-1)return M;const K=M.historyIndex+1;return{...M,title:M.history[K].title,content:M.history[K].content,historyIndex:K}})},U=t?!!t.completed_at:!1,P=x.useRef(null),G=x.useRef(null),F=x.useRef(null),J=x.useRef(null),de=x.useRef(null),Oe=x.useRef(null),Ye=x.useRef(null),Xe=x.useRef(null),[dt,Ct]=x.useState([]),[pt,vt]=x.useState(!1),[Ze,je]=x.useState(-1);x.useEffect(()=>{const M=setTimeout(()=>{if(t&&!n&&!s){const K={};let oe=!1;if(I!==(t.title||"")&&(K.title=I,oe=!0),D!==(t.description||"")&&(K.description=D,oe=!0),tt&&tt!==(t.start_time||"")&&(K.start_time=tt,oe=!0),Ge&&Ge!==(t.end_time||"")&&(K.end_time=Ge,oe=!0),ht&&String(ht)!==String(t.duration||60)&&(K.duration=Number(ht),oe=!0),Ee!==(t.is_all_day??!0)&&(K.is_all_day=Ee,oe=!0),N&&N!==t.start_date&&(K.start_date=N,oe=!0),oe){if((K.start_time||K.start_date)&&!Ee){const ve=K.start_date||N||t.start_date,gt=K.start_time||tt||t.start_time||"00:00";if(ve){const bt=new Date(ve),[Pt,Zt]=gt.split(":").map(Number);!isNaN(Pt)&&!isNaN(Zt)&&(bt.setHours(Pt,Zt,0,0),K.start_date=bt.toISOString())}}o(t.id,K,[],{skipHistory:!0})}}},800);return()=>clearTimeout(M)},[I,D,tt,Ge,ht,N,Ee,t,o,n]),x.useEffect(()=>{const M=K=>{(K.metaKey||K.ctrlKey)&&K.shiftKey&&(K.key==="v"||K.key==="V")&&(K.preventDefault(),K.stopPropagation(),di?ol():il(t==null?void 0:t.id))};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[di,il,ol,t==null?void 0:t.id]),x.useEffect(()=>{G.current},[D]),x.useEffect(()=>{if(!Et||!fe.current)return;const M=()=>{const oe=fe.current;oe&&Et&&(oe.chain().setTextSelection({from:Et.from,to:Et.to}).unsetHighlight().setTextSelection(oe.state.selection.to).run(),jt(null))},K=setTimeout(()=>{document.addEventListener("click",M,{once:!0})},100);return()=>{clearTimeout(K),document.removeEventListener("click",M)}},[Et]);const Ve=x.useRef(t);x.useEffect(()=>{const M=Ve.current;if(!t||!M){Ve.current=t;return}t.id!==M.id?(k(t.title||""),S(t.description||""),A(t.start_date||""),ut(t.start_time||""),mt(t.end_time||""),Ie(t.duration||60),He(t.is_all_day??!0),L(t.tags||[]),E(t.images||[]),re(t.parent_id||null),$e(t.is_project||!1),se(t.color||"gray"),ce(t.importance||"unplanned")):(t.title!==M.title&&k(t.title||""),t.description!==M.description&&S(t.description||""),t.start_date!==M.start_date&&A(t.start_date||""),t.start_time!==M.start_time&&ut(t.start_time||""),t.end_time!==M.end_time&&mt(t.end_time||""),t.duration!==M.duration&&Ie(t.duration||60),t.is_all_day!==M.is_all_day&&He(t.is_all_day??!0),JSON.stringify(t.tags)!==JSON.stringify(M.tags)&&L(t.tags||[])),Ve.current=t},[t]);const be=async M=>{let K;if(_e&&fe.current?K=fe.current.state.doc.textBetween(_e.from,_e.to," "):fe.current?K=fe.current.getText():K=D.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),!K||!K.trim()){v==null||v({msg:"Please enter or select some content first.",type:"error"});return}Y(!0),We(!1),Ht(!0);try{if(_n&&kt.trim()){let Pt=a.find(tn=>tn.name.trim().toLowerCase()==="prompt"),Zt=Pt==null?void 0:Pt.id;if(Zt||(Zt=await u("prompt")||void 0),Zt){const tn=await K5(kt);await i({title:tn,description:kt,tags:[Zt],status:"active"})}}const ve=await W5(K,_e?"":I,M),gt={id:crypto.randomUUID(),role:"assistant",content:ve.fullResponse,created_at:new Date().toISOString(),prompt:M||"AI Analysis",model:"gemini"},bt=[...jn,gt];Pi(bt),na(bt.length-1),tr(ve.fullResponse),Dt(!1),Vt(""),t&&o(t.id,{ai_history:bt},[],{skipHistory:!0})}catch(oe){console.error(oe);let ve=oe.message||"";(ve.includes("429")||ve.includes("quota"))&&(ve="AI  1-2  API Key"),alert(`AI ${ve}`),Ht(!1)}finally{Y(!1)}},Ae=()=>{if(document.activeElement instanceof HTMLElement&&(ye.current=document.activeElement),!D||!D.trim()){v==null||v({msg:"Please enter some content first.",type:"error"});return}if(Ut){Ht(!1);return}if(jn.length>0){Ht(!0);return}Vt(""),We(!0)},Je=()=>{We(!1),ft(null)},[It,xt]=x.useState(!1),Tt=x.useMemo(()=>{const M=a.find(K=>K.name.trim().toLowerCase().includes("for"));return M?l.filter(K=>K.tags.includes(M.id)&&K.status!=="deleted"&&K.status!=="logged").sort((K,oe)=>oe.created_at.localeCompare(K.created_at)):[]},[l,a]),et=async M=>{document.activeElement instanceof HTMLElement&&(ye.current=document.activeElement);let K;if(fe.current?K=fe.current.getText():K=D.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),console.log("Note content for title generation:",K.substring(0,200)+"..."),console.log("Content length:",K.length),!K||!K.trim()){v==null||v({msg:"",type:"error"});return}Ue(!0),xt(!1);try{const oe=await zY(K,M);console.log("Generated SEO title:",oe),Qe(oe),Ne(!0)}catch(oe){console.error("Generate title error:",oe),v==null||v({msg:"",type:"error"})}finally{Ue(!1)}},te=async()=>{let M;if(fe.current?M=fe.current.getText():M=D.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),!M||!M.trim()){v==null||v({msg:"",type:"error"});return}Tt.length>0?xt(!0):(console.log("No custom title prompts found. Using default."),et())},Le=()=>{k(ze),Ne(!1),Qe(""),v==null||v({msg:" SEO ",type:"info"})},ct=()=>{Ne(!1),Qe("")},at=x.useMemo(()=>{var M;return(M=t==null?void 0:t.dependencies)!=null&&M.length?l.filter(K=>{var oe;return((oe=t.dependencies)==null?void 0:oe.includes(K.id))&&!K.completed_at}):[]},[t==null?void 0:t.dependencies,l]),St=x.useMemo(()=>a.filter(M=>M.name.startsWith("#")).map(M=>M.name.slice(1)),[a]),zt=async()=>{let M="";if(fe.current&&typeof fe.current.getText=="function"&&(M=fe.current.getText()),(!M||!M.trim())&&(M=D.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim()),!M||!M.trim()){v==null||v({msg:"",type:"error"});return}console.log("Generating keywords for current task content:",M.slice(0,100)+(M.length>100?"...":"")),ui(!0);try{const K=await FY(M,St);ta(K),Oi(!0),console.log("Generated keywords:",K)}catch(K){console.error("Generate keywords error:",K),v==null||v({msg:"",type:"error"})}finally{ui(!1)}},Bt=async M=>{const K=`#${M}`;let oe=a.find(ve=>ve.name.toLowerCase()===K.toLowerCase());try{if(oe)O.includes(oe.id)?v==null||v({msg:` ${K} `,type:"info"}):(L(ve=>[...ve,oe.id]),v==null||v({msg:`: ${K}`,type:"info"}));else{let ve=a.find(cn=>cn.name==="#"),gt;if(ve)gt=ve.id;else{const cn=await u("#");if(!cn)throw new Error("Failed to create root keyword tag");gt=cn}const bt=(cn,kn=0)=>{const Wt=a.find(Cn=>Cn.id===cn);return!Wt||!Wt.parent_id||Wt.parent_id===gt?kn:bt(Wt.parent_id,kn+1)},Pt=a.filter(cn=>{if(cn.parent_id===gt)return!0;let kn=cn;const Wt=new Set;for(;kn.parent_id&&!Wt.has(kn.id);){if(Wt.add(kn.id),kn.parent_id===gt)return!0;const Cn=a.find(kr=>kr.id===kn.parent_id);if(!Cn)break;kn=Cn}return!1}).map(cn=>({id:cn.id,name:cn.name.replace(/^#/,""),parentId:cn.parent_id,depth:bt(cn.id)}));let Zt=gt;if(Pt.length>0){v==null||v({msg:"...",type:"info"});const cn=await UY(M,Pt);if(cn){Zt=cn;const kn=a.find(Wt=>Wt.id===cn);console.log(`AI suggested parent for "${M}": ${kn==null?void 0:kn.name}`)}}const tn=await u(K,Zt);if(tn){O.includes(tn)||L(Wt=>[...Wt,tn]);const cn=a.find(Wt=>Wt.id===Zt),kn=(cn==null?void 0:cn.name)||"#";v==null||v({msg:`: ${K} ( ${kn})`,type:"info"})}else throw new Error("Failed to create tag")}ta(ve=>ve.filter(gt=>gt!==M))}catch(ve){console.error("Error adding keyword tag:",ve),v==null||v({msg:"",type:"error"})}},Gt=async()=>{const M=[...ea];let K=0,oe=a.find(gt=>gt.name==="#"),ve=null;if(oe)ve=oe.id;else{const gt=await u("#");gt&&(ve=gt)}for(const gt of M){const bt=`#${gt}`;let Pt=a.find(Zt=>Zt.name.toLowerCase()===bt.toLowerCase());try{if(Pt)O.includes(Pt.id)||(L(Zt=>[...Zt,Pt.id]),K++);else{const Zt=await u(bt,ve);Zt&&!O.includes(Zt)&&(L(tn=>[...tn,Zt]),K++)}}catch(Zt){console.error("Error adding keyword tag:",gt,Zt)}}ta([]),Oi(!1),K>0?v==null||v({msg:` ${K}  #`,type:"info"}):v==null||v({msg:"",type:"info"})},an=M=>{ta(K=>K.filter(oe=>oe!==M))},xn=M=>{if(!M)return Be;let K=l.find(ve=>ve.id===M);const oe=new Set;for(;K&&K.parent_id&&!oe.has(K.id);){oe.add(K.id);const ve=l.find(gt=>gt.id===K.parent_id);if(ve)K=ve;else break}return(K==null?void 0:K.color)||"blue"},Tn=x.useMemo(()=>xn(ae),[ae,l,Be]),bn=Jn[Tn]||Jn.blue;f1(we,M=>{if(n||Pe||Ut&&lt||Z||It||Nn||M&&di&&Ir===(t==null?void 0:t.id)&&M.target.closest("[data-recording-capsule]"))return;const K=M==null?void 0:M.target;if(!(K&&K.closest('[data-app-header="true"]')))if(t&&e)if(I.trim())fi();else{const oe=b.findIndex(gt=>gt.data.id===t.id),ve=b[oe-1];y(t.id),e(ve?ve.data.id:null)}else e&&(I.trim()||D.replace(/<[^>]*>/g,"").trim()?fi():e(null))});const br=x.useMemo(()=>{if(!(t!=null&&t.id))return l.filter(oe=>oe.status!=="deleted");const M=new Set,K=[t.id];for(;K.length>0;){const oe=K.shift();for(const ve of l)ve.parent_id===oe&&!M.has(ve.id)&&(M.add(ve.id),K.push(ve.id))}return l.filter(oe=>oe.id!==t.id&&!M.has(oe.id)&&oe.status!=="deleted")},[l,t]),Lr=x.useMemo(()=>{const M=(K=null,oe=0,ve=null)=>{const gt=a.filter(Pt=>Pt.parent_id===K);let bt=[];return gt.forEach(Pt=>{bt.push({...Pt,depth:oe,parentName:ve}),bt=[...bt,...M(Pt.id,oe+1,Pt.name)]}),bt};return M()},[a]);x.useEffect(()=>{if(t!=null&&t.id){const M=l.filter(K=>K.parent_id===t.id).map(K=>K.id);z(M)}},[t,l]),x.useEffect(()=>{const M=!t||!t.title;if(I.length>=2&&M){const K=l.filter(oe=>oe.title.toLowerCase().includes(I.toLowerCase())&&oe.id!==(t==null?void 0:t.id));Ct(K.slice(0,5)),vt(K.length>0),je(-1)}else vt(!1)},[I,l,t]),x.useEffect(()=>{!t&&P.current&&P.current.focus()},[t]);const fi=async()=>{let M=I.trim();const K=D.replace(/<[^>]*>/g,"").trim();if(!M&&K&&(M=K.split(`
`)[0].substring(0,30)||"Untitled Note"),!M)return;let oe=N;if(N&&!Ee&&tt){const gt=new Date(N),[bt,Pt]=tt.split(":").map(Number);gt.setHours(bt,Pt,0,0),oe=gt.toISOString()}else if(N&&Ee){const gt=new Date(N);gt.setHours(12,0,0,0),oe=gt.toISOString()}const ve={title:M,description:D,due_date:T,start_date:oe,parent_id:ae,is_project:le||$.length>0,tags:O,status:(t==null?void 0:t.status)||"inbox",color:Tn,importance:Se,images:V,is_all_day:Ee,duration:ht?Number(ht):null,attachments:j,attachment_links:zn,ai_history:jn,repeat_rule:ge,reminder_minutes:X};if(e?e((t==null?void 0:t.id)||null):ra(),t&&t.id&&t.id!=="new")await o(t.id,ve,$);else{const gt=await i(ve,$);f(gt),m([gt])}},ra=()=>{k(""),S(""),_(null),A(null),L([]),E([]),H([]),re(null),z([]),$e(!1),He(!0),ut("09:00"),mt("10:00"),Ie(""),ie(null),he(null)},cl=async M=>{if(!(M.length===0||!xe)){Nt(!0);try{const K=[],oe=[];for(const Pt of M){if(Pt.size>104857600){v==null||v({msg:`: ${Pt.name} ( 100MB)`,type:"error"});continue}const Zt=Pt.type.startsWith("image/");let tn=Pt;if(Zt&&Pt.size>2*1024*1024)try{tn=await us(Pt,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0})}catch(bs){console.warn("Compression failed, using original file:",bs)}const cn=Pt.name.split(".").pop()||(Zt?"jpg":"bin"),kn=`${Date.now()}_${crypto.randomUUID()}.${cn}`,Cn=`${(g==null?void 0:g.id)||"anonymous"}/${kn}`,{error:kr}=await xe.storage.from("attachments").upload(Cn,tn,{contentType:Pt.type,upsert:!1});if(kr){console.error("Upload error:",kr);continue}const{data:js}=xe.storage.from("attachments").getPublicUrl(Cn);if(js){const bs={name:Pt.name,url:js.publicUrl,size:Pt.size,type:Pt.type};oe.push(bs),Zt&&K.push(js.publicUrl)}}const gt=[...V,...K],bt=[...j,...oe];E(gt),H(bt),t&&(K.length>0||oe.length>0)&&o(t.id,{images:gt,attachments:bt},[],{skipHistory:!0})}catch(K){console.error("Error uploading files:",K)}finally{Nt(!1),qe.current&&(qe.current.value="")}}},Ku=async M=>{const K=M.target;if(K.tagName==="INPUT"||K.tagName==="TEXTAREA"||K.isContentEditable){if(M.clipboardData.files.length>0){M.preventDefault();const oe=Array.from(M.clipboardData.files);await cl(oe);return}return}if(M.clipboardData.files.length>0){M.preventDefault();const oe=Array.from(M.clipboardData.files);await cl(oe)}},sa=async M=>{let K=[];"files"in M.target&&M.target.files?K=Array.from(M.target.files):"dataTransfer"in M&&M.dataTransfer.files&&(K=Array.from(M.dataTransfer.files)),await cl(K)},GR=async M=>{const K=V.filter(ve=>ve!==M),oe=j.filter(ve=>ve.url!==M);if(E(K),H(oe),t&&o(t.id,{images:K,attachments:oe},[],{skipHistory:!0}),xe)try{const gt=new URL(M).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(gt){const bt=gt[1];await xe.storage.from("attachments").remove([bt])}}catch(ve){console.warn("Failed to delete image from storage:",ve)}},qR=async M=>{const K=M.target.files;if(!(!K||K.length===0||!xe)){Nt(!0);try{const oe=[],ve=[];for(const Pt of Array.from(K)){const Zt=Pt.name.split(".").pop()||"bin",tn=`${Date.now()}_${crypto.randomUUID()}.${Zt}`,cn=`${g.id}/${tn}`,{error:kn}=await xe.storage.from("attachments").upload(cn,Pt,{contentType:Pt.type,upsert:!1});if(kn){console.error("Upload error:",kn),v==null||v({msg:`: ${Pt.name}`,type:"error"});continue}const{data:Wt}=xe.storage.from("attachments").getPublicUrl(cn);if(Wt){const Cn=Pt.type.startsWith("image/"),kr={name:Pt.name,url:Wt.publicUrl,size:Pt.size,type:Pt.type};oe.push(kr),Cn&&ve.push(Wt.publicUrl)}}const gt=[...j,...oe],bt=[...V,...ve];H(gt),E(bt),t&&(oe.length>0||ve.length>0)&&o(t.id,{attachments:gt,images:bt},[],{skipHistory:!0}),oe.length>0&&yt(oe[oe.length-1].url),v==null||v({msg:` ${oe.length} `,type:"info"})}catch(oe){console.error("Error uploading attachments:",oe),v==null||v({msg:"",type:"error"})}finally{Nt(!1),Ke.current&&(Ke.current.value="")}}},hi=x.useRef(null),YR=async M=>{const K=j.find(Pt=>Pt.url===M);if(!K)return;hi.current&&(clearTimeout(hi.current.timeoutId),l0(hi.current.url));const oe=j.filter(Pt=>Pt.url!==M),ve=V.filter(Pt=>Pt!==M);H(oe),E(ve),t&&o(t.id,{attachments:oe,images:ve},[],{skipHistory:!0});const gt=setTimeout(()=>{l0(M),dh.current.push({type:"delete",attachment:K}),fh.current=[],hi.current=null},1e4);hi.current={url:M,attachment:K,timeoutId:gt};const bt=K.name||"";v==null||v({msg:`: ${bt.length>20?bt.slice(0,20)+"...":bt}`,type:"info",undo:()=>{var Pt,Zt;if(hi.current&&hi.current.url===M){if(clearTimeout(hi.current.timeoutId),hi.current=null,H(tn=>[...tn,K]),(Pt=K.type)!=null&&Pt.startsWith("image/")&&E(tn=>[...tn,K.url]),t){const tn=[...oe,K],cn=(Zt=K.type)!=null&&Zt.startsWith("image/")?[...ve,K.url]:ve;o(t.id,{attachments:tn,images:cn},[],{skipHistory:!0})}v==null||v({msg:"",type:"info"})}}})},l0=async M=>{if(xe)try{const oe=new URL(M).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(oe){const ve=oe[1];await xe.storage.from("attachments").remove([ve]),console.log("[TaskInput] Attachment deleted from storage:",ve)}}catch(K){console.warn("Failed to delete attachment from storage:",K)}},dh=x.useRef([]),fh=x.useRef([]),JR=()=>{var M,K;if(hi.current){const{attachment:oe,timeoutId:ve}=hi.current;if(clearTimeout(ve),hi.current=null,H(gt=>gt.some(Pt=>Pt.url===oe.url)?gt:[...gt,oe]),(M=oe.type)!=null&&M.startsWith("image/")&&E(gt=>gt.includes(oe.url)?gt:[...gt,oe.url]),t){const bt=[...j,oe];o(t.id,{attachments:bt},[],{skipHistory:!0})}return v==null||v({msg:"",type:"info"}),!0}if(dh.current.length>0){const oe=dh.current.pop();return fh.current.push(oe),oe.type==="delete"&&(H(ve=>[...ve,oe.attachment]),(K=oe.attachment.type)!=null&&K.startsWith("image/")&&E(ve=>[...ve,oe.attachment.url]),t&&o(t.id,{attachments:[...j,oe.attachment]},[],{skipHistory:!0}),v==null||v({msg:"",type:"info"})),!0}return!1},XR=()=>{if(fh.current.length>0){const M=fh.current.pop();return dh.current.push(M),M.type==="delete"&&(H(K=>K.filter(oe=>oe.url!==M.attachment.url)),E(K=>K.filter(oe=>oe!==M.attachment.url)),t&&o(t.id,{attachments:j.filter(K=>K.url!==M.attachment.url),images:V.filter(K=>K!==M.attachment.url)},[],{skipHistory:!0}),l0(M.attachment.url),v==null||v({msg:"",type:"info"})),!0}return!1};x.useEffect(()=>{const M=K=>{var oe;(oe=we.current)!=null&&oe.contains(document.activeElement)&&((K.ctrlKey||K.metaKey)&&K.key==="z"&&!K.shiftKey&&JR()&&(K.preventDefault(),K.stopPropagation()),(K.ctrlKey||K.metaKey)&&K.key==="z"&&K.shiftKey&&XR()&&(K.preventDefault(),K.stopPropagation()))};return window.addEventListener("keydown",M,!0),()=>window.removeEventListener("keydown",M,!0)},[j,V,t]);const QR=M=>M<1024?M+" B":M<1024*1024?(M/1024).toFixed(1)+" KB":(M/(1024*1024)).toFixed(1)+" MB",Gu=M=>{var gt,bt,Pt,Zt,tn,cn,kn,Wt,Cn,kr,js,bs,Li,xk,bk,vk,wk,kk,Sk,_k,Tk;M.preventDefault();const K=document.activeElement,oe=M.shiftKey,ve=(gt=we.current)==null?void 0:gt.querySelector(".ProseMirror");oe?K===P.current?(js=Xe.current)==null||js.focus():K!=null&&K.classList.contains("ProseMirror")?(bs=P.current)==null||bs.focus():Xe.current&&(K===Xe.current||(Li=Xe.current.parentElement)!=null&&Li.contains(K))?Ee&&J.current?J.current.focus():!Ee&&Ye.current?setTimeout(()=>{var Kr,Is;(Kr=Ye.current)==null||Kr.focus(),(Is=Ye.current)==null||Is.select()},0):(xk=F.current)==null||xk.focus():K===J.current?(bk=F.current)==null||bk.focus():K===Ye.current?Oe.current?setTimeout(()=>{var Kr,Is;(Kr=Oe.current)==null||Kr.focus(),(Is=Oe.current)==null||Is.select()},0):(vk=F.current)==null||vk.focus():K===Oe.current?de.current?setTimeout(()=>{var Kr,Is;(Kr=de.current)==null||Kr.focus(),(Is=de.current)==null||Is.select()},0):(wk=F.current)==null||wk.focus():K===de.current?(kk=F.current)==null||kk.focus():F.current&&(K===F.current||(Sk=F.current.parentElement)!=null&&Sk.contains(K))?ve?ve.focus():(_k=P.current)==null||_k.focus():(Tk=Xe.current)==null||Tk.focus():K===P.current?ve&&ve.focus():K!=null&&K.classList.contains("ProseMirror")?(bt=F.current)==null||bt.focus():K===F.current||F.current&&((Pt=F.current.parentElement)!=null&&Pt.contains(K))?Ee&&J.current?J.current.focus():!Ee&&de.current?(de.current.focus(),de.current.select()):(Zt=Xe.current)==null||Zt.focus():K===J.current?(tn=Xe.current)==null||tn.focus():K===de.current?Oe.current?setTimeout(()=>{var Kr,Is;(Kr=Oe.current)==null||Kr.focus(),(Is=Oe.current)==null||Is.select()},0):(cn=Xe.current)==null||cn.focus():K===Oe.current?Ye.current?setTimeout(()=>{var Kr,Is;(Kr=Ye.current)==null||Kr.focus(),(Is=Ye.current)==null||Is.select()},0):(kn=Xe.current)==null||kn.focus():K===Ye.current?setTimeout(()=>{var Kr;(Kr=Xe.current)==null||Kr.focus()},0):Xe.current&&(K===Xe.current||(Wt=Xe.current.parentElement)!=null&&Wt.contains(K))?(Cn=P.current)==null||Cn.focus():(kr=P.current)==null||kr.focus()},dk=()=>{t&&o(t.id,{completed_at:U?null:new Date().toISOString(),reminder_minutes:X})},fk=M=>{var gt,bt,Pt,Zt,tn,cn,kn;if((M.ctrlKey||M.metaKey)&&M.key==="z"){M.stopPropagation();return}if(M.shiftKey){if(M.key==="S"||M.key==="s"){M.preventDefault(),(gt=F.current)==null||gt.focus();return}if(M.key==="T"||M.key==="t"){M.preventDefault(),(bt=Xe.current)==null||bt.focus();return}}if(M.ctrlKey&&M.key==="."){M.preventDefault(),M.stopPropagation(),dk();return}if($t&&document.activeElement===P.current){if(M.key==="ArrowLeft"){M.preventDefault();const Wt=Dn-1;Bn(Wt);const Cn=new Date;Cn.setDate(Cn.getDate()+Wt);const kr=Cn.toLocaleDateString("sv-SE"),bs=["","","","","","",""][Cn.getDay()].replace("","");k(Li=>Li.replace(/\d{4}-\d{2}-\d{2}[]$/,`${kr}${bs}`));return}if(M.key==="ArrowRight"){M.preventDefault();const Wt=Dn+1;Bn(Wt);const Cn=new Date;Cn.setDate(Cn.getDate()+Wt);const kr=Cn.toLocaleDateString("sv-SE"),bs=["","","","","","",""][Cn.getDay()].replace("","");k(Li=>Li.replace(/\d{4}-\d{2}-\d{2}[]$/,`${kr}${bs}`));return}if(M.key==="Enter"){M.preventDefault(),rn(!1),Bn(0);return}if(M.key==="Escape"){M.preventDefault(),rn(!1),Bn(0),k(Wt=>Wt.replace(/\d{4}-\d{2}-\d{2}[]$/,""));return}}const K=document.activeElement,oe=(K==null?void 0:K.classList.contains("ProseMirror"))||(K==null?void 0:K.closest(".ProseMirror")),ve=D&&D.trim()&&D!=="<p></p>";if(M.key==="Tab"&&!oe){Gu(M);return}if(M.key==="Tab"&&oe&&!ve){Gu(M);return}if(pt){if(M.key==="ArrowDown"){M.preventDefault(),je(Wt=>Wt===-1?0:(Wt+1)%dt.length);return}if(M.key==="ArrowUp"){M.preventDefault(),je(Wt=>Wt<=0?dt.length-1:Wt-1);return}if((M.ctrlKey||M.metaKey)&&M.key==="Enter"&&Ze>=0&&(M.preventDefault(),k(dt[Ze].title),vt(!1)),M.key==="Escape"){M.preventDefault(),vt(!1);return}}if(!M.nativeEvent.isComposing){if((M.ctrlKey||M.metaKey)&&M.key==="Enter"&&!oe){M.preventDefault(),M.stopPropagation(),fi();return}if((M.ctrlKey||M.metaKey)&&M.key==="Enter"&&oe){M.preventDefault(),M.stopPropagation(),(Pt=P.current)==null||Pt.focus();return}if(M.key==="Enter"&&!M.shiftKey){if(M.target.tagName==="TEXTAREA"||M.target.isContentEditable)return;M.preventDefault(),M.stopPropagation(),fi()}if(M.key==="Escape"){if(Ut){M.preventDefault(),M.stopPropagation(),Ht(!1),(Zt=ye.current)==null||Zt.focus();return}if(Z){M.preventDefault(),M.stopPropagation(),Ne(!1),(tn=ye.current)==null||tn.focus();return}if(pt){M.preventDefault(),M.stopPropagation(),vt(!1);return}if(Pe){M.preventDefault(),M.stopPropagation(),We(!1),(cn=ye.current)==null||cn.focus();return}if(Hn.isOpen){M.preventDefault(),M.stopPropagation(),is(Wt=>({...Wt,isOpen:!1}));return}if($t){M.preventDefault(),M.stopPropagation(),rn(!1);return}if(oe){M.preventDefault(),M.stopPropagation(),(kn=P.current)==null||kn.focus();return}}if(M.key==="Escape"&&e)if(M.preventDefault(),t&&!I.trim()){const Wt=b.findIndex(kr=>kr.data.id===t.id),Cn=b[Wt-1];y(t.id),e(Cn?Cn.data.id:null)}else fi()}},hk=M=>{if(ut(M),M&&Ge){const[K,oe]=M.split(":").map(Number),[ve,gt]=Ge.split(":").map(Number);if(!isNaN(K)&&!isNaN(oe)&&!isNaN(ve)&&!isNaN(gt)){const bt=K*60+oe,Pt=ve*60+gt;if(bt<Pt)Ie((Pt-bt).toString());else{const Zt=Number(ht)||60,tn=bt+Zt,cn=Math.floor(tn/60)%24,kn=tn%60;mt(`${String(cn).padStart(2,"0")}:${String(kn).padStart(2,"0")}`)}}}},ZR=M=>{if(mt(M),M&&tt){const[K,oe]=tt.split(":").map(Number),[ve,gt]=M.split(":").map(Number);let bt=ve*60+gt-(K*60+oe);bt<0&&(bt+=1440),Ie(bt.toString())}},eO=M=>{if(Ie(M),M&&!isNaN(Number(M))&&tt){const K=Number(M),[oe,ve]=tt.split(":").map(Number),gt=new Date;gt.setHours(oe,ve+K),mt(`${String(gt.getHours()).padStart(2,"0")}:${String(gt.getMinutes()).padStart(2,"0")}`)}},tO=h.fontWeight==="thin"?"font-extralight":"font-medium",nO=h.fontWeight==="thin"?"font-extralight":"font-normal",pk={small:"text-sm",normal:"text-base",large:"text-lg"}[h.fontSize]||"text-base",rO=t?`border-${Tn}-200`:"border-gray-100/50",sO=()=>{const M=lt?Math.max(10,Math.min(lt.top,window.innerHeight-500)):0,K=lt?Math.max(220,Math.min(lt.left,window.innerWidth-220)):0,oe=c.jsxs(Pr.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:lt?"fixed bg-white rounded-xl shadow-2xl border border-gray-100 p-4 flex flex-col gap-4 overflow-hidden w-[400px]":"absolute top-[30px] right-0 w-[400px] bg-white rounded-xl shadow-2xl border border-gray-100 z-[100] p-4 flex flex-col gap-4 overflow-hidden",style:lt?{top:M,left:K,transform:"translateX(-50%)",zIndex:99999}:{},children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("h3",{className:"text-sm font-bold text-slate-800 flex items-center gap-2",children:[c.jsx(Ds,{className:"text-indigo-500",size:16}),"AI "]}),c.jsx("button",{onClick:Je,className:"text-slate-400 hover:text-slate-600 transition-colors p-1 hover:bg-slate-100 rounded-full",children:c.jsx(un,{size:16})})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("input",{type:"text",placeholder:"...",className:"w-full px-3 py-2 text-xs bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none transition-all",value:Ft,onChange:ve=>nn(ve.target.value)}),!Ft&&qs.length>0&&c.jsxs("div",{children:[c.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2",children:""}),c.jsx("div",{className:"flex flex-wrap gap-1.5",children:qs.map(ve=>c.jsx("button",{type:"button",onClick:()=>{Vt(ve.description||ve.title),nn("")},className:"text-[10px] px-2 py-1 rounded-full bg-indigo-50 text-indigo-600 hover:bg-indigo-100 transition-all border border-indigo-100 font-medium",title:ve.description||ve.title,children:ve.title},ve.id))})]}),c.jsx("textarea",{className:"w-full h-32 p-3 text-sm bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none resize-none transition-all placeholder:text-slate-300",placeholder:"...",value:kt,onChange:ve=>Vt(ve.target.value)}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"checkbox",id:"saveToLib",checked:_n,onChange:ve=>Fn(ve.target.checked),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-slate-300"}),c.jsx("label",{htmlFor:"saveToLib",className:"text-xs text-slate-500 cursor-pointer select-none",children:""})]}),c.jsxs("div",{className:"flex gap-2 justify-end",children:[c.jsxs("button",{onClick:()=>be(Dee),className:"flex-1 py-2.5 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 rounded-xl text-[10px] font-bold transition-all border border-indigo-200 shadow-sm active:scale-95 flex flex-col items-center justify-center gap-0.5",title:"",children:[c.jsx(Ds,{size:12}),c.jsx("span",{children:""})]}),c.jsxs("button",{onClick:()=>be(),className:"flex-1 py-2.5 bg-slate-50 hover:bg-slate-100 text-slate-600 rounded-xl text-[10px] font-bold transition-all border border-slate-200 shadow-sm active:scale-95 flex flex-col items-center justify-center gap-0.5",children:[c.jsx(md,{size:12}),c.jsx("span",{children:""})]}),c.jsx("button",{onClick:()=>be(kt),disabled:!kt.trim(),className:"flex-[2] py-2 bg-slate-800 hover:bg-slate-900 text-white rounded-xl text-xs font-bold transition-all shadow-md shadow-slate-200 disabled:opacity-50 disabled:grayscale active:scale-95",children:""})]})]}),Ns.length>0&&c.jsxs("div",{className:"border-t border-gray-50 pt-3 mt-1",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest",children:Ft?"":""}),Ft&&fn>0&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:"text-[10px] text-gray-500",children:[Xt+1," / ",fn]}),c.jsxs("div",{className:"flex gap-0.5",children:[c.jsx("button",{onClick:()=>{Jt(ve=>ve>0?ve-1:fn-1)},className:"p-1 hover:bg-gray-100 rounded text-gray-400 hover:text-gray-600",title:" (Cmd+Shift+G)",children:c.jsx(vp,{size:12})}),c.jsx("button",{onClick:()=>{Jt(ve=>ve<fn-1?ve+1:0)},className:"p-1 hover:bg-gray-100 rounded text-gray-400 hover:text-gray-600",title:" (Cmd+G)",children:c.jsx(ts,{size:12})})]})]})]}),c.jsx("div",{className:"flex flex-col gap-1.5 max-h-[160px] overflow-y-auto custom-scrollbar pr-1",onKeyDown:ve=>{(ve.metaKey||ve.ctrlKey)&&ve.key==="g"&&(ve.preventDefault(),ve.shiftKey?Jt(gt=>gt>0?gt-1:fn-1):Jt(gt=>gt<fn-1?gt+1:0))},children:Ns.map((ve,gt)=>{const bt=cE(ve.description||""),Pt=(Zt,tn,cn)=>{if(!tn.trim())return Zt;const kn=Zt.split(new RegExp(`(${tn})`,"gi"));let Wt=0;for(let Cn=0;Cn<gt;Cn++){const kr=Ns[Cn],js=cE(kr.description||""),bs=(kr.title.match(new RegExp(tn,"gi"))||[]).length,Li=js?(js.match(new RegExp(tn,"gi"))||[]).length:0;Wt+=bs+Li}if(!cn){const Cn=(ve.title.match(new RegExp(tn,"gi"))||[]).length;Wt+=Cn}return kn.map((Cn,kr)=>{if(Cn.toLowerCase()===tn.toLowerCase()){const js=Wt===Xt,bs=c.jsx("mark",{className:`${js?"bg-orange-400 text-white ring-2 ring-orange-500":"bg-yellow-200 text-slate-900"} font-bold px-0.5 rounded`,ref:js?Li=>{Li&&Li.scrollIntoView({behavior:"smooth",block:"center"})}:void 0,children:Cn},kr);return Wt++,bs}return Cn})};return c.jsxs("button",{type:"button",onClick:()=>{Vt(bt||ve.title),nn(""),Jt(0)},className:"flex-shrink-0 text-left text-[11px] p-2 rounded-xl hover:bg-indigo-50 text-slate-600 hover:text-indigo-700 transition-all border border-slate-100 hover:border-indigo-100 shadow-sm bg-white active:scale-[0.98]",title:bt||ve.title,children:[c.jsx("div",{className:"font-medium",children:Pt(ve.title,Ft,!0)}),bt&&bt!==ve.title&&c.jsx("div",{className:"text-[10px] text-gray-400 mt-0.5 whitespace-pre-wrap line-clamp-3",children:Pt(bt,Ft,!1)})]},ve.id)})})]})]},"prompt-modal");return lt?ir.createPortal(c.jsx(bo,{children:Pe&&oe}),document.body):c.jsx(bo,{children:Pe&&oe})};return c.jsxs("div",{ref:we,className:`group transition-all w-full relative ${n||r?"bg-transparent":`mb-3 bg-white rounded-xl border ${rO} shadow-[0_4px_8px_rgba(0,0,0,0.08)]`} ${W?"ring-2 ring-indigo-400 border-indigo-400 bg-indigo-50/10":""}`,onKeyDown:fk,onPaste:Ku,onDragOver:M=>{M.preventDefault(),M.stopPropagation(),R(!0)},onDragLeave:M=>{M.preventDefault(),M.stopPropagation(),R(!1)},onDrop:M=>{M.preventDefault(),M.stopPropagation(),R(!1),sa(M)},children:[W&&c.jsx("div",{className:"absolute inset-0 bg-indigo-500/10 backdrop-blur-[1px] z-[50] flex items-center justify-center rounded-xl pointer-events-none",children:c.jsxs("div",{className:"bg-white px-4 py-2 rounded-full shadow-lg border border-indigo-200 flex items-center gap-2",children:[c.jsx(Sf,{className:"text-indigo-500 animate-bounce",size:20}),c.jsx("span",{className:"text-sm font-bold text-indigo-600",children:""})]})}),t&&!r&&c.jsx("button",{onClick:M=>{M.stopPropagation(),window.open(`${window.location.origin}/share/${t.id}`,"_blank")},className:"absolute top-4 right-4 md:opacity-0 group-hover:opacity-100 transition-opacity p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg z-20",title:" (Share Task)",children:c.jsx(qz,{size:16})}),c.jsxs("div",{className:`flex gap-4 ${t?"pl-5":"pl-6"} py-6`,children:[t?c.jsxs("div",{className:"mb-0.5",children:[" ",c.jsx(ID,{checked:U,onChange:M=>{M.stopPropagation(),dk()},size:20,color:Tn,isRoot:!ae})," "]}):c.jsx("button",{type:"button",tabIndex:-1,onClick:()=>$e(!le),className:`mb-0.5 h-6 w-6 flex items-center justify-center transition-all ${le?bn.accent:"text-gray-300 hover:text-gray-400"}`,children:le?c.jsx($I,{size:18}):c.jsx(fz,{size:18})}),c.jsxs("div",{className:"flex-1 space-y-4 relative pr-6",children:[c.jsx("div",{className:"flex items-end justify-between",children:c.jsxs("div",{className:"flex-1 relative space-y-2",children:[ae&&(()=>{const M=l.find(K=>K.id===ae);return M?c.jsxs("button",{type:"button",onClick:K=>{K.stopPropagation(),t&&I.trim()&&fi(),C(ae,!0,"allview")},className:"flex items-center gap-1.5 text-xs text-theme-tertiary hover:text-indigo-600 transition-colors group/parent",children:[c.jsx(vp,{size:12,className:"opacity-50 group-hover/parent:opacity-100"}),c.jsx("span",{className:"truncate max-w-[200px] group-hover/parent:underline",children:M.title||""})]}):null})(),at.length>0&&c.jsxs("div",{className:"flex items-center gap-2 text-xs text-amber-600 bg-amber-50 p-2 rounded-lg mb-2",children:[c.jsx(Zf,{size:14,className:"shrink-0"}),c.jsxs("span",{children:["",at.map((M,K)=>c.jsxs("span",{children:[K>0&&", ",c.jsx("button",{type:"button",onClick:oe=>{oe.stopPropagation(),C(M.id,!0)},className:"hover:underline font-medium",children:M.title})]},M.id))]})]}),c.jsxs("div",{className:"flex items-center relative gap-2",children:[c.jsx("input",{ref:P,autoFocus:!0,type:"text",name:"data_task_input",autoComplete:"off",autoCorrect:"off",spellCheck:"false",value:I,onKeyDown:M=>{M.key==="Enter"&&console.log("[TaskInputDebug] Enter pressed",{isComposing:M.nativeEvent.isComposing,titleLen:I.length}),fk(M)},onFocus:()=>Q(I.length>0),onBlur:()=>setTimeout(()=>Q(!1),200),onChange:M=>{const K=M.target.value;if(Q(K.length>0),K.endsWith("@ ")&&!$t){rn(!0),Bn(0);const oe=new Date,ve=oe.toLocaleDateString("sv-SE"),bt=["","","","","","",""][oe.getDay()].replace("","");k(K.slice(0,-2)+`${ve}${bt}`)}else $t&&!K.match(/\d{4}-\d{2}-\d{2}[]$/)&&rn(!1),k(K)},readOnly:s,placeholder:s?"":"...",className:`flex-1 ${pk} ${tO} transition-all duration-300 placeholder:font-light placeholder-gray-300 border-none bg-transparent focus:ring-0 outline-none p-0 leading-tight ${U?"opacity-30":$t?"text-slate-400":"text-slate-800"} ${s?"cursor-default":""}`}),me&&I.length>0&&(()=>{const M=oe=>{const ve=l.find(Pt=>Pt.id===oe);if(!ve||!ve.parent_id)return"";const gt=l.find(Pt=>Pt.id===ve.parent_id);if(!gt)return"";const bt=M(gt.id);return bt?`${bt} > ${gt.title}`:gt.title},K=l.filter(oe=>oe.id!==(t==null?void 0:t.id)&&oe.title&&oe.title.toLowerCase().includes(I.toLowerCase())&&oe.title.toLowerCase()!==I.toLowerCase()).slice(0,5);return K.length===0?null:c.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 z-50 overflow-hidden animate-in slide-in-from-top-2 fade-in duration-200",children:K.map(oe=>{const ve=M(oe.id);return c.jsx("button",{type:"button",onMouseDown:gt=>{gt.preventDefault(),k(oe.title),Q(!1)},className:"w-full text-left px-4 py-2.5 text-sm hover:bg-slate-50 dark:hover:bg-slate-700/50 border-b border-slate-100 dark:border-slate-700/50 last:border-b-0 transition-colors group",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity",children:""}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:"text-slate-700 dark:text-slate-300 truncate",children:oe.title}),ve&&c.jsx("div",{className:"text-xs text-slate-400 dark:text-slate-500 truncate mt-0.5",children:ve})]})]})},oe.id)})})})(),I.trim()&&c.jsx("button",{type:"button",onClick:M=>{M.preventDefault(),M.stopPropagation(),console.log("[TaskInput] Manual Button Submit"),fi()},className:"p-1.5 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition-colors shadow-sm active:scale-95 flex-shrink-0 animate-in fade-in zoom-in duration-200",children:c.jsx(oz,{size:18})})]}),It&&ir.createPortal(c.jsx("div",{className:"fixed inset-0 z-[9999999] flex items-center justify-center bg-black/20 backdrop-blur-sm",onClick:()=>xt(!1),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl border border-slate-200 p-4 w-[400px] max-w-[90vw] animate-in fade-in zoom-in-95 duration-200",onClick:M=>M.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between mb-3 border-b border-slate-100 pb-2",children:[c.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[c.jsx(Ds,{size:16,className:"text-amber-500"}),c.jsx("h3",{className:"font-bold text-sm",children:" AI "})]}),c.jsx("button",{onClick:()=>xt(!1),className:"text-slate-400 hover:text-slate-600",children:c.jsx(un,{size:16})})]}),c.jsxs("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:[c.jsxs("button",{onClick:()=>et(),className:"w-full text-left p-3 rounded-lg border border-slate-100 hover:border-indigo-300 hover:bg-indigo-50 transition-all group",children:[c.jsx("div",{className:"font-medium text-sm text-slate-700 group-hover:text-indigo-700",children:" SEO "}),c.jsx("div",{className:"text-xs text-slate-500 mt-1",children:" SEO "})]}),Tt.map(M=>c.jsxs("button",{onClick:()=>et(M.description||""),className:"w-full text-left p-3 rounded-lg border border-slate-100 hover:border-amber-300 hover:bg-amber-50 transition-all group",children:[c.jsx("div",{className:"font-medium text-sm text-slate-700 group-hover:text-amber-700",children:M.title}),c.jsx("div",{className:"text-xs text-slate-500 mt-1 line-clamp-2",children:(M.description||"").replace(/<[^>]+>/g,"")})]},M.id))]})]})}),document.body),Z&&ir.createPortal(c.jsxs("div",{className:"fixed bg-theme-card rounded-xl shadow-2xl border border-theme p-4 animate-in fade-in zoom-in-95 duration-200",style:{top:P.current?P.current.getBoundingClientRect().bottom+8:100,left:P.current?P.current.getBoundingClientRect().left:100,width:P.current?P.current.getBoundingClientRect().width:300,zIndex:99999},children:[c.jsxs("div",{className:"flex items-center gap-2 text-indigo-400 mb-3",children:[c.jsx(d1,{size:14}),c.jsx("span",{className:"text-xs font-bold",children:"AI "})]}),c.jsx("input",{type:"text",autoFocus:!0,value:ze,onChange:M=>Qe(M.target.value),className:"w-full px-3 py-2 text-sm bg-theme-main border border-theme rounded-lg focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500/50 outline-none text-theme-primary",placeholder:"..."}),c.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[c.jsx("button",{type:"button",onClick:ct,className:"px-3 py-1.5 text-xs text-theme-tertiary hover:bg-theme-hover rounded-lg transition-colors",children:""}),c.jsx("button",{type:"button",onClick:Le,className:"px-3 py-1.5 text-xs bg-indigo-600 text-white hover:bg-indigo-700 rounded-lg transition-colors font-medium",children:""})]})]}),document.body),Nn&&ir.createPortal(c.jsx("div",{className:"fixed inset-0 z-[9999999] flex items-center justify-center bg-black/20 backdrop-blur-sm",onClick:M=>{M.stopPropagation(),Oi(!1)},onMouseDown:M=>M.stopPropagation(),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl border border-slate-200 p-5 w-[450px] max-w-[90vw] animate-in fade-in zoom-in-95 duration-200",onClick:M=>M.stopPropagation(),onMouseDown:M=>M.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between mb-4 border-b border-slate-100 pb-3",children:[c.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[c.jsx(Bl,{size:16,className:"text-emerald-500"}),c.jsx("h3",{className:"font-bold text-sm",children:"AI "})]}),c.jsx("button",{onClick:M=>{M.stopPropagation(),Oi(!1)},onMouseDown:M=>M.stopPropagation(),className:"text-slate-400 hover:text-slate-600",children:c.jsx(un,{size:16})})]}),ea.length>0&&c.jsxs("div",{className:"mb-4",children:[c.jsx("p",{className:"text-xs text-slate-500 mb-2",children:" SEO   "}),c.jsx("div",{className:"flex flex-wrap gap-2",children:ea.map((M,K)=>c.jsxs("div",{className:"group flex items-center gap-1 px-3 py-1.5 bg-emerald-50 text-emerald-700 rounded-full text-xs font-medium border border-emerald-200 hover:bg-emerald-100 transition-all",onClick:oe=>oe.stopPropagation(),onMouseDown:oe=>oe.stopPropagation(),children:[c.jsx("span",{className:"text-emerald-500",children:"#"}),c.jsx("span",{children:M}),c.jsx("button",{onClick:oe=>{oe.stopPropagation(),Bt(M)},onMouseDown:oe=>oe.stopPropagation(),className:"ml-1 text-emerald-600 hover:text-emerald-800 p-0.5 hover:bg-emerald-200 rounded",title:"",children:c.jsx(Xn,{size:12})}),c.jsx("button",{onClick:oe=>{oe.stopPropagation(),an(M)},onMouseDown:oe=>oe.stopPropagation(),className:"text-slate-400 hover:text-red-500 p-0.5 hover:bg-red-100 rounded",title:"",children:c.jsx(un,{size:12})})]},K))})]}),Gs&&c.jsxs("div",{className:"flex items-center justify-center py-6 text-slate-500",children:[c.jsx(yi,{size:20,className:"animate-spin mr-2"}),c.jsx("span",{className:"text-sm",children:"..."})]}),c.jsxs("div",{className:"flex gap-2 justify-end mt-4 pt-3 border-t border-slate-100",children:[c.jsx("button",{onClick:M=>{M.stopPropagation(),Oi(!1)},onMouseDown:M=>M.stopPropagation(),className:"px-4 py-2 text-xs text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:""}),c.jsxs("button",{onClick:M=>{M.stopPropagation(),zt()},onMouseDown:M=>M.stopPropagation(),disabled:Gs,className:"px-4 py-2 text-xs bg-indigo-600 text-white hover:bg-indigo-700 rounded-lg transition-colors font-medium disabled:opacity-50 flex items-center gap-1",children:[Gs?c.jsx(yi,{size:12,className:"animate-spin"}):c.jsx(Ds,{size:12}),""]}),ea.length>0&&c.jsxs("button",{onClick:M=>{M.stopPropagation(),Gt()},onMouseDown:M=>M.stopPropagation(),className:"px-4 py-2 text-xs bg-emerald-600 text-white hover:bg-emerald-700 rounded-lg transition-colors font-medium flex items-center gap-1",children:[c.jsx(Xn,{size:12}),""]})]})]})}),document.body),pt&&c.jsx("div",{className:"w-full mt-1 mb-2",children:c.jsx("div",{className:"bg-theme-hover rounded-lg overflow-hidden border border-theme",children:dt.map((M,K)=>c.jsxs("div",{className:`px-3 py-1.5 text-xs cursor-pointer transition-colors flex justify-between items-center ${K===Ze?"bg-theme-selection text-theme-primary font-medium":"text-theme-secondary hover:bg-theme-hover"}`,onClick:()=>{k(M.title),vt(!1)},children:[c.jsx("span",{children:M.title}),K===Ze&&c.jsx("span",{className:"text-[9px] text-indigo-400 font-normal",children:"Ctrl+Enter"})]},M.id))})}),c.jsx("div",{className:"flex justify-end mb-1 gap-2",children:!s&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{type:"button",onClick:()=>{Ae(),nt(null)},disabled:st,className:`flex items-center gap-1.5 text-xs transition-colors disabled:opacity-50 px-2 py-0.5 rounded-full ${Ut?"bg-indigo-500/20 text-indigo-400 font-bold shadow-sm ring-1 ring-indigo-500/30":"text-indigo-500 hover:text-indigo-400 hover:bg-indigo-500/10 font-medium"}`,title:"AI Assistant Brain",children:[st?c.jsx(yi,{size:12,className:"animate-spin"}):c.jsx(Ds,{size:12}),c.jsx("span",{children:"AI "})]}),c.jsxs("button",{type:"button",onClick:te,disabled:Fe,className:`flex items-center gap-1.5 text-xs transition-colors disabled:opacity-50 px-2 py-0.5 rounded-full ${Fe?"bg-amber-500/20 text-amber-400 font-bold shadow-sm ring-1 ring-amber-500/30":"text-amber-500 hover:text-amber-400 hover:bg-amber-500/10 font-medium"}`,title:" SEO ",children:[Fe?c.jsx(yi,{size:12,className:"animate-spin"}):c.jsx(d1,{size:12}),c.jsx("span",{children:"AI "})]}),c.jsxs("button",{type:"button",onClick:()=>{Oi(!0),zt()},disabled:Gs,className:`flex items-center gap-1.5 text-xs transition-colors disabled:opacity-50 px-2 py-0.5 rounded-full ${Gs?"bg-emerald-500/20 text-emerald-400 font-bold shadow-sm ring-1 ring-emerald-500/30":"text-emerald-500 hover:text-emerald-400 hover:bg-emerald-500/10 font-medium"}`,title:" SEO ",children:[Gs?c.jsx(yi,{size:12,className:"animate-spin"}):c.jsx(Bl,{size:12}),c.jsx("span",{children:"AI "})]}),sO()]})}),c.jsxs("div",{className:"flex flex-col md:flex-row gap-4 transition-all duration-300 items-stretch h-full",children:[c.jsxs("div",{className:"flex-1 transition-all duration-300 overflow-y-auto max-h-[55vh] flex flex-col no-scrollbar",children:[ne&&c.jsx(zH,{url:ne.url,fileName:ne.name,autoPlay:!0,markers:(mk=ne.markers)==null?void 0:mk.filter(M=>q.has(M.id)),seekToTime:Ce,onClose:()=>{Te(null),rt(null)},onMarkerClick:M=>{fe.current&&fe.current.scrollToParagraph&&fe.current.scrollToParagraph(M.id)}}),c.jsx(n0,{onEditorReady:M=>{fe.current=M},onPolish:(M,K,oe)=>{ft(K),oe&&nt(oe),We(!0),Vt("")},initialContent:D,onChange:S,onExit:()=>{var M;return(M=F.current)==null?void 0:M.focus()},textSizeClass:pk,descFontClass:nO,editable:!s,placeholder:s?"...":"...",className:"h-full",onSaveAudio:dc,onAudioMarkerClick:(M,K)=>{if(K){const ve=j.find(gt=>gt.recordingId===K);if(ve){Te({url:ve.url,name:ve.name,markers:ve.markers}),rt(Math.max(0,M-4e3));return}}if(ne){rt(Math.max(0,M-4e3));return}const oe=j.find(ve=>{var gt,bt;return ve.recordingId||((gt=ve.type)==null?void 0:gt.startsWith("audio/"))||((bt=ve.url)==null?void 0:bt.match(/\.(mp3|wav|webm|m4a|ogg)$/i))});oe&&(Te({url:oe.url,name:oe.name,markers:oe.markers}),rt(Math.max(0,M-4e3)))},activeMarkerIds:((gk=ne==null?void 0:ne.markers)==null?void 0:gk.filter(M=>q.has(M.id)).map(M=>M.id))||null,onMarkersChange:M=>{De(new Set(M.map(K=>K.id)))},attachments:j,taskColor:Tn,availableTags:a.map(M=>({id:M.id,name:M.name,color:M.color,parent_id:M.parent_id,order_index:M.order_index})),onCreateTag:async M=>{if(!u)return null;try{const K=await u(M,null);if(K)return{id:K,name:M,color:"#6366f1"}}catch(K){console.error("Failed to create tag from editor",K),v==null||v({msg:"",type:"error"})}return null}})]}),Ut&&(()=>{var ve,gt;const M=lt?Math.max(10,Math.min(lt.top,window.innerHeight-500)):0,K=lt?Math.min(lt.left+220,window.innerWidth-360):0,oe=c.jsx("div",{className:lt?"fixed w-[340px] shrink-0 animate-in slide-in-from-right-4 fade-in duration-300 flex flex-col max-h-[80vh] overflow-hidden bg-white rounded-2xl shadow-2xl":"w-full md:w-[340px] shrink-0 animate-in slide-in-from-right-4 md:slide-in-from-bottom-4 fade-in duration-500 border-l border-indigo-50 pl-0 md:pl-4 flex flex-col h-full overflow-hidden",style:lt?{top:M,left:K,zIndex:99998}:{},children:st?c.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400 gap-4 bg-slate-50/50 rounded-2xl border border-dashed border-slate-200",children:[c.jsxs("div",{className:"relative",children:[c.jsx(md,{size:32,className:"text-indigo-400 animate-pulse"}),c.jsx(Ds,{size:16,className:"absolute -top-1 -right-1 text-amber-400 animate-bounce"})]}),c.jsxs("div",{className:"flex flex-col items-center gap-1",children:[c.jsx("span",{className:"text-[11px] font-bold text-slate-500",children:"..."}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("div",{className:"w-1 h-1 bg-indigo-400 rounded-full animate-bounce [animation-delay:-0.3s]"}),c.jsx("div",{className:"w-1 h-1 bg-indigo-400 rounded-full animate-bounce [animation-delay:-0.15s]"}),c.jsx("div",{className:"w-1 h-1 bg-indigo-400 rounded-full animate-bounce"})]})]})]}):jn.length>0?c.jsxs("div",{className:"flex flex-col gap-2 h-full",children:[c.jsxs("div",{className:"flex items-center justify-between px-2 pt-2",children:[c.jsxs("span",{className:"text-xs font-bold text-slate-400 ml-1",children:[" ",er+1," / ",jn.length]}),c.jsxs("div",{className:"flex items-center gap-1 bg-slate-100 rounded-lg p-0.5",children:[c.jsx("button",{onClick:()=>{const bt=Math.max(0,er-1);na(bt),tr(jn[bt].content)},disabled:er===0,className:"p-1 hover:bg-white rounded-md disabled:opacity-30 transition-all text-slate-600",title:"",children:c.jsx($u,{size:12})}),c.jsx("button",{onClick:()=>{const bt=Math.min(jn.length-1,er+1);na(bt),tr(jn[bt].content)},disabled:er===jn.length-1,className:"p-1 hover:bg-white rounded-md disabled:opacity-30 transition-all text-slate-600",title:"",children:c.jsx(rs,{size:12})}),c.jsx("div",{className:"w-px h-3 bg-slate-300 mx-0.5"}),c.jsx("button",{onClick:()=>{const bt=jn.filter((Pt,Zt)=>Zt!==er);if(Pi(bt),bt.length!==0){const Pt=Math.min(er,bt.length-1);na(Pt),tr(bt[Pt].content)}t&&o(t.id,{ai_history:bt},[],{skipHistory:!0})},className:"p-1 hover:bg-red-50 text-slate-400 hover:text-red-500 rounded-md transition-all",title:"",children:c.jsx(Er,{size:12})})]})]}),c.jsxs("div",{className:"bg-white rounded-2xl shadow-xl shadow-indigo-100/20 border border-indigo-50 overflow-hidden flex flex-col animate-in zoom-in-95 duration-300 flex-1",children:[c.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 p-3 shrink-0",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2 text-white",children:[c.jsx(md,{size:16,className:"animate-pulse"}),c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-xs font-bold tracking-wider",children:"AI "}),c.jsx("span",{className:"text-[10px] text-indigo-100 opacity-80 truncate max-w-[200px]",children:(ve=jn[er])==null?void 0:ve.prompt})]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:()=>{Vt(""),We(!0)},className:"p-1 text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-colors",title:"",children:c.jsx(Ds,{size:14})}),c.jsx("button",{onClick:()=>{Ht(!1),ft(null)},className:"p-1 text-white/60 hover:text-white transition-colors",children:c.jsx(un,{size:14})})]})]})}),c.jsxs("div",{className:"p-4 flex flex-col gap-3 overflow-hidden flex-1",children:[ue?c.jsx("textarea",{value:ll,onChange:bt=>tr(bt.target.value),className:"w-full h-full min-h-[200px] p-3 text-[13px] text-slate-700 leading-relaxed border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none resize-none"}):c.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar pr-1",children:c.jsx("div",{className:"markdown-content text-[13px] text-slate-700 leading-relaxed prose prose-sm prose-indigo max-w-none",children:c.jsx(uk,{children:((gt=jn[er])==null?void 0:gt.content)||""})})}),c.jsx("div",{className:"flex flex-col gap-2 pt-2 border-t border-slate-50 shrink-0",children:ue?c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:()=>{const bt=[...jn];bt[er]={...bt[er],content:ll},Pi(bt),t&&o(t.id,{ai_history:bt},[],{skipHistory:!0}),Dt(!1)},className:"flex-1 flex items-center justify-center gap-2 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-indigo-200 active:scale-95",children:[c.jsx(Xn,{size:14}),""]}),c.jsx("button",{onClick:()=>{var bt;tr(((bt=jn[er])==null?void 0:bt.content)||""),Dt(!1)},className:"px-3 py-2 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-xl text-xs font-bold transition-all active:scale-95",children:""})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("button",{onClick:()=>{var bt;tr(((bt=jn[er])==null?void 0:bt.content)||""),Dt(!0)},className:"flex items-center justify-center gap-1.5 py-2 bg-slate-50 hover:bg-slate-100 text-slate-600 rounded-xl text-[11px] font-bold transition-all border border-slate-200 active:scale-95",children:[c.jsx(Rv,{size:13}),""]}),c.jsxs("button",{onClick:async()=>{var Pt,Zt;const bt=((Pt=a.find(tn=>tn.name.includes("")))==null?void 0:Pt.id)||await u("");bt&&(await i({title:` ${I||""}`,description:((Zt=jn[er])==null?void 0:Zt.content)||"",tags:[bt],status:"active",color:"purple"}),v==null||v({msg:"",type:"info"}))},className:"flex items-center justify-center gap-1.5 py-2 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-xl text-[11px] font-bold transition-all border border-purple-200 shadow-sm active:scale-95",children:[c.jsx(lu,{size:13}),""]})]}),c.jsxs("button",{onClick:()=>{var cn,kn;const bt=((cn=jn[er])==null?void 0:cn.content)||"",Pt=((kn=jn[er])==null?void 0:kn.prompt)||"",Zt=lE(bt);let tn="AI ";if(Pt){const Wt=Pt.replace(/<[^>]*>/g,"").trim();Wt.includes("")||Wt.includes("")||Wt.includes("")?tn="AI ":Wt.includes("")||Wt.includes("")||Wt.includes("")?tn="AI ":Wt.includes("")||Wt.includes("")||Wt.includes("")?tn="AI ":Wt.includes("")||Wt.includes("")?tn="AI ":Wt.includes("")||Wt.includes("")||Wt.includes("translate")?tn="AI ":Wt.includes("")||Wt.includes("")||Wt.includes("")?tn="AI ":Wt.includes("")||Wt.includes("")?tn="AI ":Wt.includes("")||Wt.includes("")?tn="AI ":Wt.includes("")||Wt.includes("")?tn="AI ":Wt.length>0&&(tn="AI "+Wt.slice(0,6).replace(/[]/g,""))}S(Wt=>Wt+`<p><br><strong>--- ${tn} ---</strong></p>`+Zt),v==null||v({msg:"",type:"info"}),Ht(!1)},className:"flex items-center justify-center gap-2 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-indigo-200 active:scale-95",children:[c.jsx(Dv,{size:14}),""]}),_e&&c.jsxs("button",{onClick:()=>{var bt;if(fe.current){const Pt=fe.current,Zt=_e.from,tn=((bt=jn[er])==null?void 0:bt.content)||"",cn=lE(tn),kn=Zt;Pt.commands.insertContentAt(_e,cn),setTimeout(()=>{Pt.chain().setTextSelection({from:Zt,to:kn}).setHighlight({color:"#fef08a"}).setTextSelection(kn).focus().run(),jt({from:Zt,to:kn})},50),ft(null),nt(null),Ht(!1),v==null||v({msg:"",type:"info"})}},className:"flex items-center justify-center gap-2 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-xl text-xs font-bold transition-all border border-green-200 shadow-sm active:scale-95",children:[c.jsx(Xn,{size:14}),""]})]})})]})]})]}):c.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400 gap-4 bg-slate-50/50 rounded-2xl border border-dashed border-slate-200",children:[c.jsx(md,{size:32,className:"text-slate-300"}),c.jsx("span",{className:"text-xs text-slate-400",children:" AI "})]})});return lt?ir.createPortal(oe,document.body):oe})()]}),V.length>0&&c.jsx("div",{className:"grid grid-cols-4 gap-2 mt-2",children:V.map((M,K)=>{var bt;const oe=j.find(Pt=>Pt.url===M),ve=M.match(/\.(jpg|jpeg|png|gif|webp|avif)/i)||((bt=oe==null?void 0:oe.type)==null?void 0:bt.startsWith("image/")),gt=(oe==null?void 0:oe.name)||"Image";return c.jsxs("div",{className:"relative group aspect-square rounded-lg overflow-hidden border border-gray-100 shadow-sm cursor-pointer bg-gray-50 flex items-center justify-center",onClick:()=>ve?Ot(M):window.open(M,"_blank"),children:[ve?c.jsx("img",{src:M,alt:gt,className:"w-full h-full object-cover transition-transform group-hover:scale-105"}):c.jsxs("div",{className:"flex flex-col items-center gap-1 p-2",children:[c.jsx("div",{className:"w-8 h-8 rounded bg-white border border-gray-200 flex items-center justify-center shadow-sm",children:c.jsx(ho,{size:16,className:"text-gray-400"})}),c.jsx("span",{className:"text-[9px] text-gray-500 truncate w-full px-1 text-center font-medium leading-tight",children:gt})]}),c.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors"}),!s&&c.jsx("button",{type:"button",onClick:Pt=>{Pt.stopPropagation(),GR(M)},className:"absolute top-1 right-1 p-1 bg-black/50 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-500 z-10",children:c.jsx(un,{size:10})})]},K)})}),j.length>0&&c.jsxs("div",{className:"mt-2",children:[c.jsxs("button",{type:"button",onClick:()=>xr(!hn),className:`w-full flex items-center justify-between gap-2 px-2.5 py-1.5 rounded-lg border transition-all ${hn?"bg-indigo-50 border-indigo-200":"bg-gray-50 border-gray-100 hover:bg-gray-100"}`,children:[c.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[c.jsx(ho,{size:12,className:hn?"text-indigo-500":"text-gray-400"}),c.jsxs("span",{className:`text-xs font-medium ${hn?"text-indigo-700":"text-gray-600"}`,children:[j.length," "]}),j.filter(M=>{var K;return((K=M.type)==null?void 0:K.startsWith("audio/"))||M.name.match(/\.(mp3|wav|ogg|m4a|webm)$/i)}).length>0&&c.jsxs("span",{className:"text-[10px] text-indigo-500 bg-indigo-50 px-1.5 py-0.5 rounded-full flex items-center gap-1",children:[c.jsx(u1,{size:9}),j.filter(M=>{var K;return((K=M.type)==null?void 0:K.startsWith("audio/"))||M.name.match(/\.(mp3|wav|ogg|m4a|webm)$/i)}).length]}),!hn&&c.jsx("span",{className:"text-[10px] text-gray-400 truncate max-w-[200px]",children:j.map(M=>M.name.split(".")[0]).join(", ")})]}),c.jsx(ts,{size:14,className:`text-gray-400 transition-transform ${hn?"rotate-180":""}`})]}),hn&&c.jsx("div",{className:"mt-1.5 space-y-1 animate-in slide-in-from-top-2 duration-200",children:j.map(M=>{var K;return c.jsxs("div",{className:`group flex items-center gap-2 px-2 py-1 rounded-md border transition-colors ${(ne==null?void 0:ne.url)===M.url?"bg-indigo-50 border-indigo-200 ring-1 ring-indigo-300/50":"bg-theme-card border-theme hover:border-theme"}`,children:[(K=M.type)!=null&&K.startsWith("audio/")||M.name.match(/\.(mp3|wav|ogg|m4a|webm|mp4)$/i)?c.jsx("button",{type:"button",onClick:oe=>{oe.preventDefault(),Te({url:M.url,name:M.name,markers:M.markers})},className:"p-0.5 text-indigo-500 bg-indigo-50 rounded-full hover:bg-indigo-100",children:c.jsx(u1,{size:10})}):c.jsx(ho,{size:10,className:"text-gray-400 flex-shrink-0"}),c.jsx("input",{ref:oe=>{oe&&Me===M.url&&(oe.focus(),yt(null))},type:"text",value:M.name,onChange:oe=>{const ve=oe.target.value;H(gt=>gt.map(bt=>bt.url===M.url?{...bt,name:ve}:bt))},onBlur:()=>{t&&o(t.id,{attachments:j},[],{skipHistory:!0})},onKeyDown:oe=>{var ve;oe.key==="Enter"&&(oe.preventDefault(),oe.stopPropagation(),oe.target.blur(),(ve=it.current)==null||ve.focus())},className:"flex-1 text-[11px] text-theme-secondary bg-transparent border-none focus:outline-none focus:bg-indigo-50/50 rounded px-1 truncate min-w-0"}),c.jsx("button",{type:"button",onClick:oe=>{oe.preventDefault(),fetch(M.url).then(ve=>ve.blob()).then(ve=>{const gt=window.URL.createObjectURL(ve),bt=document.createElement("a");bt.href=gt,bt.download=M.name,document.body.appendChild(bt),bt.click(),window.URL.revokeObjectURL(gt),document.body.removeChild(bt)}).catch(ve=>console.error("Download failed:",ve))},className:"p-0.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors opacity-0 group-hover:opacity-100",title:"",children:c.jsx(lu,{size:10})}),c.jsx("span",{className:"text-[9px] text-gray-400 flex-shrink-0",children:QR(M.size)}),!s&&c.jsx("button",{type:"button",onClick:()=>YR(M.url),className:"opacity-0 group-hover:opacity-100 p-0.5 hover:bg-red-50 rounded transition-all",children:c.jsx(un,{size:10,className:"text-gray-400 hover:text-red-500"})})]},M.url)})})]})]})}),c.jsxs("div",{className:"flex items-center justify-between pt-1 flex-col items-start gap-2",children:[O.length>0&&(()=>{const M=O.filter(oe=>{const ve=a.find(gt=>gt.id===oe);return ve&&!ve.name.startsWith("#")}),K=O.filter(oe=>{const ve=a.find(gt=>gt.id===oe);return ve&&ve.name.startsWith("#")});return c.jsxs("div",{className:"flex flex-col gap-2 px-1 w-full",children:[M.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1",children:M.map(oe=>{const ve=a.find(gt=>gt.id===oe);return ve?c.jsx(MD,{tag:ve,onRemove:()=>L(gt=>gt.filter(bt=>bt!==oe))},oe):null})}),K.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1 pt-1 border-t border-emerald-100",children:K.map(oe=>{const ve=a.find(gt=>gt.id===oe);return ve?c.jsxs("div",{className:"flex items-center gap-1 h-5 px-2 rounded-full text-[10px] font-medium bg-emerald-50 text-emerald-700 border border-emerald-200",children:[c.jsx("span",{children:ve.name}),!s&&c.jsx("button",{type:"button",onClick:()=>L(gt=>gt.filter(bt=>bt!==oe)),className:"hover:text-red-500 transition-colors",children:c.jsx(un,{size:10})})]},oe):null})})]})})(),c.jsxs("div",{className:`flex flex-col gap-3 w-full border-t border-gray-100 pt-3 mt-1 ${s?"pointer-events-none opacity-80":""}`,children:[c.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[!N&&c.jsxs("button",{type:"button",onClick:()=>A(new Date().toISOString()),className:"flex items-center gap-1 px-2 py-1.5 rounded-md bg-indigo-500/10 text-indigo-500 text-[10px] font-bold border border-indigo-500/20 hover:bg-indigo-500/20 transition-all animate-pulse hover:animate-none",title:"",children:[c.jsx(Ds,{size:11})," "]}),c.jsx(M_,{innerRef:F,label:"",value:N||void 0,onChange:A,theme:bn,tasks:l}),N&&c.jsx("div",{className:"flex items-center gap-2 bg-transparent rounded-md px-2 py-1 border border-theme",children:c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{ref:J,type:"checkbox",checked:Ee,onChange:M=>{const K=M.target.checked;He(K),K||setTimeout(()=>{var oe,ve;(oe=de.current)==null||oe.focus(),(ve=de.current)==null||ve.select()},50)},className:"w-3 h-3 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-tighter",children:""})]})}),N&&c.jsx(Mee,{value:X,onChange:he}),c.jsx(M_,{tabIndex:-1,label:"",value:T||void 0,onChange:_,colorClass:"text-red-500",tasks:l,theme:bn}),c.jsx(O1,{innerRef:Xe,icon:Bl,label:"",items:Lr,selectedIds:O,placeholder:"...",allowAdd:!0,onDeleteItem:d,multiSelect:!0,theme:bn,onSelect:async(M,K,oe)=>{if(M)L(ve=>ve.includes(M)?ve.filter(gt=>gt!==M):[...ve,M]);else if(K){const ve=await u(K,oe??null);ve&&L(gt=>[...gt,ve])}}}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{type:"button",onClick:()=>ee(!ke),className:`flex items-center gap-1 px-2 py-1.5 rounded-md text-[10px] font-bold border transition-all ${ge?"bg-purple-50 text-purple-600 border-purple-200 hover:bg-purple-100":"bg-transparent text-theme-tertiary border-theme hover:bg-theme-hover"}`,title:"",children:[c.jsx(VI,{size:12}),ge&&ge.originalText||""]}),ke&&c.jsxs("div",{className:"absolute top-full left-0 mt-1 z-50 bg-white rounded-lg shadow-xl border border-gray-200 p-4 min-w-[280px]",children:[c.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-3",children:""}),c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsx("div",{className:"grid grid-cols-4 gap-1",children:[{type:"daily",label:""},{type:"weekly",label:""},{type:"monthly",label:""},{type:"yearly",label:""}].map(M=>c.jsx("button",{type:"button",onClick:()=>{ie(K=>({...K,type:M.type,interval:(K==null?void 0:K.interval)||1,originalText:`${(K==null?void 0:K.interval)||1}${M.type==="daily"?"":M.type==="weekly"?"":M.type==="monthly"?"":""}`,triggerMode:(K==null?void 0:K.triggerMode)||"on_complete"}))},className:`px-2 py-1.5 rounded text-xs font-medium transition-colors ${(ge==null?void 0:ge.type)===M.type?"bg-purple-500 text-white":"bg-gray-100 text-gray-600 hover:bg-purple-100"}`,children:M.label},M.type))})]}),ge&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-sm text-gray-600",children:""}),c.jsx("input",{type:"number",min:1,max:365,value:ge.interval,onChange:M=>{const K=Math.max(1,parseInt(M.target.value)||1);ie(oe=>oe?{...oe,interval:K,originalText:`${K}${oe.type==="daily"?"":oe.type==="weekly"?"":oe.type==="monthly"?"":""}`}:null)},className:"w-16 px-2 py-1 border border-gray-300 rounded text-sm text-center focus:border-purple-400 focus:outline-none"}),c.jsx("span",{className:"text-sm text-gray-600",children:ge.type==="daily"?"":ge.type==="weekly"?"":ge.type==="monthly"?"":""})]})]}),(ge==null?void 0:ge.type)==="monthly"&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-sm text-gray-600",children:""}),c.jsx("input",{type:"number",min:1,max:31,value:ge.monthDay||1,onChange:M=>{const K=Math.min(31,Math.max(1,parseInt(M.target.value)||1));ie(oe=>oe?{...oe,monthDay:K,originalText:`${oe.interval}${K}`}:null)},className:"w-16 px-2 py-1 border border-gray-300 rounded text-sm text-center focus:border-purple-400 focus:outline-none"}),c.jsx("span",{className:"text-sm text-gray-600",children:""})]})]}),ge&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-gray-50",children:[c.jsx("input",{type:"radio",name:"triggerMode",checked:ge.triggerMode!=="on_schedule",onChange:()=>ie(M=>M?{...M,triggerMode:"on_complete"}:null),className:"text-purple-500"}),c.jsxs("div",{children:[c.jsx("div",{className:"text-xs font-medium text-gray-700",children:""}),c.jsx("div",{className:"text-[10px] text-gray-400",children:""})]})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-gray-50",children:[c.jsx("input",{type:"radio",name:"triggerMode",checked:ge.triggerMode==="on_schedule",onChange:()=>ie(M=>M?{...M,triggerMode:"on_schedule"}:null),className:"text-purple-500"}),c.jsxs("div",{children:[c.jsx("div",{className:"text-xs font-medium text-gray-700",children:""}),c.jsx("div",{className:"text-[10px] text-gray-400",children:""})]})]})]})]}),ge&&c.jsx("div",{className:"mb-3",children:c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-gray-50",children:[c.jsx("input",{type:"checkbox",checked:ge.copyDescription!==!1,onChange:M=>ie(K=>K?{...K,copyDescription:M.target.checked}:null),className:"w-3.5 h-3.5 text-purple-600 rounded border-gray-300 focus:ring-purple-500"}),c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-xs font-medium text-gray-700",children:""}),c.jsx("span",{className:"text-[10px] text-gray-400",children:""})]})]})}),ge&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:" ()"}),c.jsx("input",{type:"date",value:ge.endDate||"",onChange:M=>ie(K=>K?{...K,endDate:M.target.value||void 0}:null),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:border-purple-400 focus:outline-none",placeholder:""}),ge.endDate&&c.jsx("button",{type:"button",onClick:()=>ie(M=>M?{...M,endDate:void 0}:null),className:"text-[10px] text-red-500 hover:underline mt-1",children:""})]}),c.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-100",children:[c.jsx("button",{type:"button",onClick:()=>{ie(null),ee(!1)},className:"text-xs text-red-500 hover:text-red-600 font-medium",children:""}),c.jsx("button",{type:"button",onClick:()=>ee(!1),className:"px-3 py-1 bg-purple-500 text-white text-xs font-medium rounded hover:bg-purple-600 transition-colors",children:""})]})]})]})]}),c.jsx(bo,{children:!Ee&&N&&c.jsxs(Pr.div,{initial:{height:0,opacity:0,marginTop:0},animate:{height:"auto",opacity:1,marginTop:0},exit:{height:0,opacity:0,marginTop:0},className:"overflow-hidden flex items-center gap-3 px-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ri,{size:12,className:"text-theme-tertiary"}),c.jsxs("div",{className:"flex items-center bg-transparent border border-theme rounded-md px-2 py-0.5",children:[c.jsx("input",{ref:de,type:"text",value:tt,onChange:M=>hk(M.target.value),onKeyDown:M=>{M.key==="Tab"?Gu(M):M.stopPropagation()},placeholder:"09:00",className:"bg-transparent border-none text-[11px] font-medium text-theme-primary focus:ring-0 outline-none p-0 w-12 placeholder:text-theme-tertiary"}),h.timeFormat==="12h"&&c.jsx("button",{onClick:()=>{const[M,K]=tt.split(" ");K&&hk(`${M} ${K==="AM"?"PM":"AM"}`)},className:"text-[10px] font-bold text-theme-tertiary hover:text-theme-secondary ml-1",children:tt.includes("PM")?"PM":"AM"})]}),c.jsx("span",{className:"text-theme-tertiary text-xs",children:""}),c.jsxs("div",{className:"flex items-center bg-transparent border border-theme rounded-md px-2 py-0.5",children:[c.jsx("input",{ref:Oe,type:"text",value:Ge,onChange:M=>ZR(M.target.value),onKeyDown:M=>{M.key==="Tab"?Gu(M):M.stopPropagation()},placeholder:"10:00",className:"bg-transparent border-none text-[11px] font-medium text-theme-primary focus:ring-0 outline-none p-0 w-12 placeholder:text-theme-tertiary"}),h.timeFormat==="12h"&&c.jsx("span",{className:"text-[9px] font-bold text-indigo-400 ml-1",children:(()=>{const M=Ge.split(":");if(M.length!==2)return"";const K=parseInt(M[0]),oe=parseInt(M[1]);return isNaN(K)||isNaN(oe)?"":`${K%12||12}:${String(oe).padStart(2,"0")}${K<12?"AM":"PM"}`})()})]})]}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsxs("div",{className:"relative",children:[c.jsx("input",{ref:Ye,type:"text",placeholder:"",value:ht,onChange:M=>eO(M.target.value),onKeyDown:M=>{M.key==="Tab"?Gu(M):M.stopPropagation()},className:"w-14 bg-transparent border border-theme rounded-md px-2 py-0.5 text-[11px] font-medium text-theme-primary focus:ring-1 focus:ring-indigo-100 outline-none placeholder:text-theme-tertiary"}),c.jsx("span",{className:"absolute right-2 top-1.5 text-[8px] text-gray-400 font-bold pointer-events-none",children:"MIN"})]})})]})}),!s&&c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"file",ref:qe,className:"hidden",multiple:!0,accept:"image/*",onChange:sa}),c.jsxs("button",{type:"button",tabIndex:-1,onClick:()=>{var M;return(M=qe.current)==null?void 0:M.click()},className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border border-transparent hover:border-theme hover:bg-theme-hover text-theme-tertiary hover:text-theme-secondary focus:outline-none focus:bg-white focus:ring-1 ${(bn==null?void 0:bn.buttonRing)||"focus:ring-indigo-300"} focus:border-theme text-xs ${h.fontWeight==="thin"?"font-light":"font-medium"}`,children:[_t?c.jsx(yi,{size:13,className:"animate-spin"}):c.jsx(Sf,{size:13}),c.jsx("span",{children:""})]}),c.jsx("input",{ref:Ke,type:"file",multiple:!0,className:"hidden",onChange:qR}),c.jsxs("button",{ref:it,type:"button",tabIndex:-1,onClick:()=>{var M;return(M=Ke.current)==null?void 0:M.click()},className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border border-transparent hover:border-theme hover:bg-theme-hover text-theme-tertiary hover:text-theme-secondary focus:outline-none focus:bg-white focus:ring-1 ${(bn==null?void 0:bn.buttonRing)||"focus:ring-indigo-300"} focus:border-theme text-xs ${h.fontWeight==="thin"?"font-light":"font-medium"}`,children:[_t?c.jsx(yi,{size:13,className:"animate-spin"}):c.jsx(ho,{size:13}),c.jsx("span",{children:w("attachFiles")})]}),c.jsxs("button",{type:"button",tabIndex:-1,onMouseDown:M=>M.preventDefault(),onClick:()=>{di?Ir===(t==null?void 0:t.id)?ol():v==null||v({msg:"",type:"warning"}):t!=null&&t.id?il(t.id):v==null||v({msg:"",type:"warning"})},className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border border-transparent hover:border-theme hover:bg-theme-hover text-theme-tertiary hover:text-theme-secondary focus:outline-none focus:bg-theme-card focus:ring-1 ${(bn==null?void 0:bn.buttonRing)||"focus:ring-indigo-300"} focus:border-theme text-xs ${h.fontWeight==="thin"?"font-light":"font-medium"} ${di&&Ir===(t==null?void 0:t.id)?"text-red-500 animate-pulse":""}`,title:di?"":"",children:[c.jsx(BI,{size:13,strokeWidth:di&&Ir===(t==null?void 0:t.id)?3:2}),c.jsx("span",{children:di&&Ir===(t==null?void 0:t.id)?al(Co):""})]}),c.jsx(O1,{tabIndex:-1,icon:vp,label:"",items:br,allowAdd:!0,selectedIds:ae?[ae]:[],placeholder:"...",theme:bn,onSelect:async(M,K)=>{let oe=M;if(!oe&&K&&(oe=await i({title:K,is_project:!0,status:"inbox"})),!oe&&!M)return;const ve=oe===ae?null:oe;re(ve),t&&(ve&&p(ve,!0),await o(t.id,{parent_id:ve},[]))}})]}),!ae&&c.jsxs("div",{className:"relative",children:[c.jsxs("button",{type:"button",onClick:()=>Re(!pe),className:"flex items-center gap-1.5 px-2 py-1.5 rounded-md border border-transparent hover:border-theme hover:bg-theme-hover transition-all group",title:"",children:[c.jsx("div",{className:`w-3 h-3 rounded-full ${((yk=Jn[Be])==null?void 0:yk.dot)||"bg-gray-400"} group-hover:scale-110 transition-transform`}),c.jsx("span",{className:"text-xs text-theme-tertiary group-hover:text-theme-secondary",children:""})]}),pe&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>Re(!1)}),c.jsxs("div",{className:"absolute bottom-full left-0 mb-2 p-3 bg-white rounded-xl shadow-xl border border-gray-200 z-50 min-w-[200px] animate-in zoom-in-95 duration-100",children:[c.jsxs("div",{className:"text-xs font-semibold text-gray-500 mb-2 px-1 flex items-center gap-2",children:[c.jsx(Av,{size:12}),""]}),c.jsx("div",{className:"grid grid-cols-6 gap-2",children:Object.keys(Jn).map(M=>c.jsx("button",{type:"button",onClick:()=>{se(M),Re(!1)},className:`w-5 h-5 rounded-full ${Jn[M].dot} ${Be===M?"ring-2 ring-offset-2 ring-gray-400 scale-110":"hover:scale-125 opacity-80 hover:opacity-100"} transition-all shadow-sm`,title:M},M))})]})]})]}),c.jsx("div",{className:"flex gap-1 p-1 bg-theme-hover rounded-lg border border-theme",title:"",children:[{level:"urgent",color:"bg-red-500",label:"",icon:""},{level:"planned",color:"bg-yellow-400",label:"",icon:""},{level:"delegated",color:"bg-green-500",label:"",icon:""},{level:"optional",color:"bg-gray-400",label:"",icon:""}].map(({level:M,color:K,label:oe})=>c.jsx("button",{tabIndex:-1,type:"button",onClick:()=>ce(Se===M?void 0:M),title:oe,className:`w-4 h-4 rounded-full ${K} ${Se===M?"ring-2 ring-offset-1 ring-gray-500 scale-110":"opacity-50 hover:opacity-100 hover:scale-105"} transition-all`},M))})]})]})]})]})]}),ot&&c.jsx("div",{className:"fixed inset-0 z-[100] bg-black/90 flex items-center justify-center p-4",onClick:()=>Ot(null),children:c.jsxs("div",{className:"relative max-w-full max-h-full",onClick:M=>M.stopPropagation(),children:[c.jsx("img",{src:ot,alt:"Preview",className:"max-w-full max-h-[90vh] rounded-lg shadow-2xl"}),c.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[c.jsx("a",{href:ot,download:`attachment-${Date.now()}`,target:"_blank",rel:"noopener noreferrer",onClick:M=>M.stopPropagation(),className:"p-2 bg-black/50 hover:bg-black/70 text-white rounded-full backdrop-blur-sm transition-colors",title:"Download",children:c.jsx(lu,{size:20})}),c.jsx("button",{onClick:()=>Ot(null),className:"p-2 bg-black/50 hover:bg-black/70 text-white rounded-full backdrop-blur-sm transition-colors",children:c.jsx(un,{size:20})})]})]})}),Hn.isOpen&&c.jsx("div",{className:"fixed inset-0 z-[150] flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm",onClick:()=>is({...Hn,isOpen:!1}),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 max-w-lg w-full animate-in zoom-in duration-200",onClick:M=>M.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[c.jsx(Ds,{size:18,className:"text-indigo-500"}),c.jsx("span",{children:w("aiPolishSuggestions")})]}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("button",{onClick:Mr,disabled:Hn.historyIndex<=0,className:"p-1.5 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors disabled:opacity-30 disabled:hover:bg-transparent disabled:hover:text-gray-500",title:w("undo"),children:c.jsx(Og,{size:16})}),c.jsx("button",{onClick:B,disabled:Hn.historyIndex>=Hn.history.length-1,className:"p-1.5 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors disabled:opacity-30 disabled:hover:bg-transparent disabled:hover:text-gray-500",title:w("redo"),children:c.jsx(Ov,{size:16})})]})]}),c.jsxs("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2",children:w("suggestedTitle")}),c.jsx("input",{className:"w-full p-2 mb-3 bg-white border border-gray-200 rounded-lg text-sm text-gray-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none shadow-sm transition-all font-medium",value:Hn.title,onChange:M=>nr(M.target.value),onKeyDown:M=>{(M.ctrlKey||M.metaKey)&&M.key==="z"?(M.preventDefault(),M.stopPropagation(),M.shiftKey?B():Mr()):(M.ctrlKey||M.metaKey)&&M.key==="y"&&(M.preventDefault(),M.stopPropagation(),B())}}),c.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2",children:w("suggestedContent")}),c.jsx("textarea",{className:"w-full h-40 p-3 bg-white border border-gray-200 rounded-lg text-sm text-gray-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none resize-none leading-relaxed shadow-sm transition-all",value:Hn.content,onChange:M=>On(M.target.value),onKeyDown:M=>{(M.ctrlKey||M.metaKey)&&M.key==="z"?(M.preventDefault(),M.stopPropagation(),M.shiftKey?B():Mr()):(M.ctrlKey||M.metaKey)&&M.key==="y"&&(M.preventDefault(),M.stopPropagation(),B())}})]}),c.jsxs("div",{className:"flex gap-3 justify-end",children:[c.jsx("button",{onClick:()=>is({...Hn,isOpen:!1}),className:"px-4 py-1.5 text-gray-600 hover:bg-gray-100 rounded text-sm font-medium transition-colors",children:w("cancel")}),c.jsxs("button",{onClick:()=>{k(Hn.title),S(Hn.content),is({...Hn,isOpen:!1,history:[],historyIndex:-1}),v({msg:w("aiPolishApplied"),type:"info"})},className:"px-4 py-1.5 bg-[#2563EB] hover:bg-[#1d4ed8] text-white rounded text-sm font-medium shadow-sm transition-colors flex items-center gap-1.5",children:[c.jsx(Xn,{size:14,strokeWidth:3}),w("confirmReplace")]})]})]})})]})},Aee=["gray","blue","indigo","red","orange","amber","green","teal","cyan","sky","purple","fuchsia","pink","rose"],uE={gray:"bg-gray-400",blue:"bg-blue-500",indigo:"bg-indigo-500",red:"bg-red-500",orange:"bg-orange-500",amber:"bg-amber-500",green:"bg-green-500",teal:"bg-teal-500",cyan:"bg-cyan-500",sky:"bg-sky-500",purple:"bg-purple-500",fuchsia:"bg-fuchsia-500",pink:"bg-pink-500",rose:"bg-rose-500"},dE=({text:t,query:e})=>{if(!e.trim()||!t)return c.jsx(c.Fragment,{children:t});try{const n=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp(`(${n})`,"gi"),s=t.split(r);return c.jsx(c.Fragment,{children:s.map((i,o)=>i.toLowerCase()===e.toLowerCase()?c.jsx("mark",{className:"bg-yellow-200 text-yellow-900 px-0.5 rounded",children:i},o):c.jsx("span",{children:i},o))})}catch{return c.jsx(c.Fragment,{children:t})}},Ree=({isOpen:t,onClose:e})=>{const{tasks:n,tags:r,searchHistory:s,addSearchHistory:i,deleteSearchHistory:o,setEditingTaskId:a,editingTaskId:l,navigateToTask:u,verifyTaskPassword:d,temporarilyUnlockTask:f,setToast:h}=x.useContext(En),[p,m]=x.useState(""),[y,b]=x.useState({tags:[],startDate:null,endDate:null,colors:[]}),[g,v]=x.useState("or"),[w,C]=x.useState(""),[I,k]=x.useState(!1),[D,S]=x.useState(""),[T,_]=x.useState(!1),N=x.useRef(null),[A,O]=x.useState(!1),[L,V]=x.useState(""),[E,j]=x.useState(null),[H,W]=x.useState(null);x.useEffect(()=>{t&&N.current&&N.current.focus()},[t]);const R=x.useMemo(()=>!p.trim()&&y.tags.length===0&&!y.startDate&&!y.endDate&&y.colors.length===0?[]:n.filter(se=>{if(se.status==="deleted")return!1;const Se=p.toLowerCase(),ce=!p.trim()||se.title.toLowerCase().includes(Se)||se.description&&se.description.toLowerCase().includes(Se);let Ee=!0;if(y.tags.length>0){const ut=se.tags||[];g==="and"?Ee=y.tags.every(Ge=>ut.includes(Ge)):Ee=y.tags.some(Ge=>ut.includes(Ge))}let He=!0;if(y.startDate||y.endDate){const ut=se.start_date||se.due_date;if(!ut)He=!1;else{const Ge=ht=>{const Ie=new Date(ht);return isNaN(Ie.getTime())?NaN:Ie.setHours(0,0,0,0)},mt=Ge(ut);if(isNaN(mt))He=!1;else{if(y.startDate){const ht=Ge(y.startDate);!isNaN(ht)&&mt<ht&&(He=!1)}if(y.endDate){const ht=Ge(y.endDate);!isNaN(ht)&&mt>ht&&(He=!1)}}}}const tt=y.colors.length===0||y.colors.includes(se.color);return ce&&Ee&&He&&tt}),[n,p,y,g]),ae=()=>{(p.trim()||y.tags.length>0||y.startDate||y.endDate||y.colors.length>0)&&i(p,y)},re=()=>{D.trim()&&(i(p,y,D.trim()),S(""),_(!1))},$=se=>{m(se.query),b(se.filters)},z=se=>{b(Se=>({...Se,tags:Se.tags.includes(se)?Se.tags.filter(ce=>ce!==se):[...Se.tags,se]}))},le=se=>{b(Se=>({...Se,colors:Se.colors.includes(se)?Se.colors.filter(ce=>ce!==se):[...Se.colors,se]}))},$e=()=>{b({tags:[],startDate:null,endDate:null,colors:[]})},Be=y.tags.length>0||y.startDate||y.endDate||y.colors.length>0;return x.useEffect(()=>{if(!t)return;const se=Se=>{var ce,Ee,He;if(Se.key===" "&&((ce=document.activeElement)!=null&&ce.closest("[data-search-modal]"))&&((Ee=document.activeElement)==null?void 0:Ee.tagName)!=="INPUT"&&((He=document.activeElement)==null?void 0:He.tagName)!=="TEXTAREA"&&Se.stopPropagation(),Se.key==="Escape"){if(l)return;e()}};return window.addEventListener("keydown",se,!0),()=>window.removeEventListener("keydown",se,!0)},[t,e,l]),t?c.jsxs(c.Fragment,{children:[ir.createPortal(c.jsx(bo,{children:c.jsx(Pr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-start justify-center pt-20",onClick:e,"data-search-modal":!0,children:c.jsxs(Pr.div,{initial:{opacity:0,scale:.95,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20},transition:{duration:.2},className:"w-full max-w-2xl bg-theme-card rounded-2xl shadow-2xl overflow-hidden",onClick:se=>se.stopPropagation(),children:[c.jsxs("div",{className:"p-4 border-b border-theme",children:[c.jsxs("div",{className:"flex items-center gap-3 bg-theme-hover rounded-xl px-4 py-3",children:[c.jsx(Wc,{size:20,className:"text-theme-tertiary"}),c.jsx("input",{ref:N,type:"text",value:p,onChange:se=>m(se.target.value),onKeyDown:se=>{se.key==="Enter"&&ae()},placeholder:"...",className:"flex-1 bg-transparent outline-none text-theme-primary placeholder-theme-tertiary"}),p&&c.jsx("button",{onClick:()=>m(""),className:"text-theme-tertiary hover:text-theme-primary",children:c.jsx(un,{size:18})})]}),c.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[c.jsxs("button",{onClick:()=>k(!I),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors ${I||Be?"bg-indigo-100 text-indigo-700":"bg-theme-hover text-theme-secondary hover:bg-theme-hover/80"}`,children:[I?c.jsx(ts,{size:14}):c.jsx(rs,{size:14}),"",Be&&c.jsx("span",{className:"ml-1 w-5 h-5 bg-indigo-500 text-white rounded-full flex items-center justify-center text-[10px]",children:y.tags.length+(y.startDate||y.endDate?1:0)+y.colors.length})]}),c.jsxs("button",{onClick:()=>{m(""),b({tags:[],startDate:null,endDate:null,colors:[]})},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium bg-theme-hover text-theme-secondary hover:bg-theme-hover/80 transition-colors",children:[c.jsx(Ri,{size:14}),"",s.length>0&&c.jsx("span",{className:"ml-1 w-5 h-5 bg-gray-500 text-white rounded-full flex items-center justify-center text-[10px]",children:s.length})]}),Be&&c.jsx("button",{onClick:$e,className:"text-xs text-theme-tertiary hover:text-theme-primary",children:""})]}),c.jsx(bo,{children:I&&c.jsxs(Pr.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-3 space-y-4 overflow-hidden",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary",children:[c.jsx(Bl,{size:12}),"",y.tags.length>0&&c.jsx("span",{className:"px-1.5 py-0.5 bg-indigo-100 text-indigo-600 rounded-full text-[10px]",children:y.tags.length})]}),y.tags.length>1&&c.jsxs("div",{className:"flex items-center bg-theme-hover rounded-lg p-0.5",children:[c.jsx("button",{onClick:()=>v("or"),className:`px-2 py-0.5 text-[10px] font-bold rounded-md transition-all ${g==="or"?"bg-theme-card text-indigo-600 shadow-sm":"text-theme-tertiary"}`,children:" OR"}),c.jsx("button",{onClick:()=>v("and"),className:`px-2 py-0.5 text-[10px] font-bold rounded-md transition-all ${g==="and"?"bg-theme-card text-indigo-600 shadow-sm":"text-theme-tertiary"}`,children:" AND"})]})]}),c.jsxs("div",{className:"relative mb-2",children:[c.jsx("input",{type:"text",value:w,onChange:se=>C(se.target.value),placeholder:"...",className:"w-full px-3 py-1.5 bg-theme-hover rounded-lg text-xs border-0 focus:ring-2 focus:ring-indigo-500 pl-8 text-theme-primary"}),c.jsx(Wc,{size:12,className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-theme-tertiary"})]}),y.tags.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1.5 mb-2 p-2 bg-indigo-50 rounded-lg",children:y.tags.map(se=>{const Se=r.find(ce=>ce.id===se);return Se?c.jsxs("button",{onClick:()=>z(Se.id),className:"flex items-center gap-1.5 px-2 py-1 bg-indigo-500 text-white rounded-full text-xs font-medium hover:bg-indigo-600 transition-colors",children:[c.jsx("span",{children:Se.name}),c.jsx(un,{size:10})]},Se.id):null})}),c.jsxs("div",{className:"max-h-32 overflow-y-auto",children:[c.jsx("div",{className:"grid grid-cols-3 gap-1",children:r.filter(se=>!y.tags.includes(se.id)).filter(se=>!w||se.name.toLowerCase().includes(w.toLowerCase())).map(se=>c.jsxs("button",{onClick:()=>z(se.id),className:"flex items-center gap-1.5 px-2 py-1.5 bg-theme-hover hover:bg-theme-hover/80 rounded-lg text-xs text-theme-secondary transition-colors text-left",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-400 flex-shrink-0"}),c.jsx("span",{className:"truncate",children:se.name})]},se.id))}),r.filter(se=>!y.tags.includes(se.id)).filter(se=>!w||se.name.toLowerCase().includes(w.toLowerCase())).length===0&&c.jsx("div",{className:"text-center text-xs text-theme-tertiary py-2",children:""})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary",children:[c.jsx(vo,{size:12}),"",(y.startDate||y.endDate)&&c.jsx("span",{className:"px-1.5 py-0.5 bg-indigo-100 text-indigo-600 rounded-full text-[10px]",children:""})]}),(y.startDate||y.endDate)&&c.jsxs("button",{onClick:()=>b(se=>({...se,startDate:null,endDate:null})),className:"text-[10px] text-red-500 hover:text-red-600 flex items-center gap-1 z-10",children:[c.jsx(un,{size:10}),""]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"date",value:y.startDate||"",onChange:se=>b(Se=>({...Se,startDate:se.target.value||null})),className:"px-3 py-1.5 rounded-lg bg-theme-hover text-xs border-0 focus:ring-2 focus:ring-indigo-500 text-theme-primary"}),c.jsx("span",{className:"text-theme-tertiary",children:""}),c.jsx("input",{type:"date",value:y.endDate||"",onChange:se=>b(Se=>({...Se,endDate:se.target.value||null})),className:"px-3 py-1.5 rounded-lg bg-theme-hover text-xs border-0 focus:ring-2 focus:ring-indigo-500 text-theme-primary"}),(y.startDate||y.endDate)&&c.jsx("button",{onClick:()=>b(se=>({...se,startDate:null,endDate:null})),className:"p-1.5 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-colors",title:"",children:c.jsx(un,{size:14})})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary mb-2",children:[c.jsx(Av,{size:12}),""]}),c.jsx("div",{className:"flex flex-wrap gap-2",children:Aee.map(se=>c.jsx("button",{onClick:()=>le(se),className:`w-6 h-6 rounded-full ${uE[se]} transition-transform ${y.colors.includes(se)?"ring-2 ring-offset-2 ring-indigo-500 scale-110":"hover:scale-110"}`},se))})]})]})})]}),c.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:R.length>0?c.jsxs("div",{className:"p-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("span",{className:"text-xs font-medium text-theme-secondary",children:[" ",R.length," "]}),T?c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"text",value:D,onChange:se=>S(se.target.value),placeholder:"...",className:"px-2 py-1 text-xs border rounded-lg w-32 bg-theme-hover text-theme-primary border-theme",autoFocus:!0}),c.jsx("button",{onClick:re,className:"p-1 text-green-600 hover:text-green-700",children:c.jsx(Xn,{size:14})}),c.jsx("button",{onClick:()=>{_(!1),S("")},className:"p-1 text-theme-tertiary hover:text-theme-primary",children:c.jsx(un,{size:14})})]}):c.jsxs("button",{onClick:()=>_(!0),className:"flex items-center gap-1 text-xs text-indigo-600 hover:text-indigo-700",children:[c.jsx(KI,{size:12}),""]})]}),c.jsx("div",{className:"space-y-1",children:R.map(se=>{const Se=se.start_date||se.due_date,ce=Se?new Date(Se).toLocaleDateString("zh-TW",{year:"numeric",month:"short",day:"numeric"}):null,Ee=l===se.id,He=!!se.is_locked,tt=He&&!se.lock_password,ut=mt=>{mt.stopPropagation(),He?(j(se.id),W("edit"),V(""),O(!0)):a(se.id)},Ge=mt=>{mt==null||mt.stopPropagation(),He?(j(se.id),W("navigate"),V(""),O(!0)):(a(null),u(se.id,!0),e())};return c.jsx("div",{className:"rounded-xl hover:bg-theme-hover transition-colors border border-transparent hover:border-theme",children:Ee?c.jsx("div",{onClick:mt=>mt.stopPropagation(),onMouseDown:mt=>mt.stopPropagation(),children:c.jsx(Lo,{initialData:se,onClose:()=>a(null)})}):c.jsx("div",{className:"p-3",children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("div",{className:`w-3 h-3 rounded-full mt-1 flex-shrink-0 ${uE[se.color]}`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:`font-medium text-theme-primary flex items-center gap-1.5 ${tt?"blur-[4px] select-none":""}`,children:[He&&c.jsx(La,{size:12,className:"text-amber-500 flex-shrink-0"}),c.jsx(dE,{text:se.title,query:p})]}),se.description&&!tt&&c.jsx("div",{className:"text-sm text-theme-secondary mt-1 max-h-20 overflow-y-auto",children:c.jsx(dE,{text:se.description.replace(/<[^>]*>/g,""),query:p})}),se.tags.length>0&&!tt&&c.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:se.tags.map(mt=>{const ht=r.find(Ie=>Ie.id===mt);return ht?c.jsx("span",{className:"px-2 py-0.5 bg-theme-hover text-theme-secondary rounded-full text-[10px]",children:ht.name},mt):null})})]}),c.jsxs("div",{className:"flex flex-col items-end gap-1 flex-shrink-0",children:[ce&&c.jsx("span",{className:"text-xs text-theme-tertiary",children:ce}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:ut,className:"p-1 text-theme-tertiary hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors",title:He?"":"",children:c.jsx(Xn,{size:14})}),c.jsx("button",{onClick:Ge,className:"p-1 text-theme-tertiary hover:text-emerald-600 hover:bg-emerald-50 rounded transition-colors",title:He?"":"",children:c.jsx(RI,{size:14})})]})]})]})})},se.id)})})]}):p||Be?c.jsxs("div",{className:"p-8 text-center text-theme-tertiary",children:[c.jsx(Wc,{size:32,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{children:""})]}):s.length>0?c.jsxs("div",{className:"p-4",children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary mb-3",children:[c.jsx(Ri,{size:12}),""]}),c.jsx("div",{className:"space-y-1",children:s.map(se=>c.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-theme-hover group",children:[c.jsxs("button",{onClick:()=>$(se),className:"flex-1 text-left",children:[c.jsx("div",{className:"font-medium text-theme-primary text-sm",children:se.name||se.query||"()"}),c.jsxs("div",{className:"text-xs text-theme-tertiary mt-0.5",children:[new Date(se.created_at).toLocaleDateString(),se.filters.tags.length>0&&`  ${se.filters.tags.length} `,se.filters.colors.length>0&&`  ${se.filters.colors.length} `]})]}),c.jsx("button",{onClick:()=>o(se.id),className:"p-1 text-theme-tertiary hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:c.jsx(Er,{size:14})})]},se.id))})]}):c.jsxs("div",{className:"p-8 text-center text-theme-tertiary",children:[c.jsx(Wc,{size:32,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{children:""})]})}),c.jsx("div",{className:"p-3 border-t border-theme bg-theme-hover flex justify-between items-center text-xs text-theme-tertiary",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("span",{children:[c.jsx("kbd",{className:"px-1.5 py-0.5 bg-theme-card border border-theme rounded text-theme-primary",children:"Enter"})," "]}),c.jsxs("span",{children:[c.jsx("kbd",{className:"px-1.5 py-0.5 bg-theme-card border border-theme rounded text-theme-primary",children:"Esc"})," "]})]})})]})})}),document.body),A&&ir.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999]",onClick:()=>{O(!1),j(null),W(null)},children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-80 max-w-[90vw]",onClick:se=>se.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[c.jsx(La,{size:20,className:"text-amber-500"}),c.jsx("h3",{className:"text-lg font-bold",children:""})]}),c.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["",H==="edit"?"":"",""]}),c.jsx("input",{type:"password",placeholder:"",value:L,onChange:se=>V(se.target.value),onKeyDown:se=>{se.key==="Enter"&&E&&(d(E,L)?(f(E),H==="edit"?a(E):(a(null),u(E,!0),e()),O(!1),j(null),W(null)):h({msg:"",type:"error"})),se.key==="Escape"&&(O(!1),j(null),W(null))},autoFocus:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-amber-500"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:()=>{O(!1),j(null),W(null)},className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:""}),c.jsx("button",{onClick:()=>{E&&(d(E,L)?(f(E),H==="edit"?a(E):(a(null),u(E,!0),e()),O(!1),j(null),W(null)):h({msg:"",type:"error"}))},className:"flex-1 px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors",children:""})]})]})}),document.body)]}):null},Oee=({current:t,total:e})=>{const n=e>0?Math.round(t/e*100):0;return ir.createPortal(c.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm",children:c.jsxs("div",{className:"bg-[#1e1e1e] p-6 rounded-xl shadow-2xl w-80 border border-white/10 text-center",children:[c.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Importing Calendar..."}),c.jsx("div",{className:"w-full bg-gray-700 h-2 rounded-full mb-2 overflow-hidden",children:c.jsx("div",{className:"bg-indigo-500 h-full transition-all duration-200",style:{width:`${n}%`}})}),c.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-2",children:[c.jsxs("span",{children:[t," / ",e]}),c.jsxs("span",{children:[n,"%"]})]})]})}),document.body)},Pee=["#6366f1","#f43f5e","#10b981","#f59e0b","#64748b"],Lee=({id:t,label:e,active:n,overdueCount:r,normalCount:s,icon:i,color:o,acceptsDrop:a,isEditing:l,editingViewName:u,setEditingViewName:d,setEditingViewId:f,saveViewName:h,setHoveredDropTarget:p,sidebarCollapsed:m,sidebarTextClass:y,sidebarFontClass:b,setView:g,setTagFilter:v,onEditFilter:w})=>{const{dragState:C,updateGhostPosition:I,endDrag:k,selectedTaskIds:D,moveTaskToView:S}=x.useContext(En),T=o||(n?"var(--accent-color)":void 0),_=x.useRef(!1),[N,A]=x.useState(!1),O=E=>{a&&(E.preventDefault(),E.stopPropagation(),_.current||(_.current=!0,A(!0),p(t)),I(E.clientX,E.clientY))},L=E=>{E.preventDefault(),_.current=!1,A(!1),p(null)},V=async E=>{if(E.preventDefault(),E.stopPropagation(),_.current=!1,A(!1),p(null),!a){k();return}const j=D.length>0?D:C!=null&&C.draggedId?[C.draggedId]:[];j.length>0&&await S(j,t),k()};return c.jsx("div",{className:`relative group/nav-wrapper transition-all ${N?"ring-2 ring-indigo-500 ring-inset rounded-lg bg-indigo-50 dark:bg-indigo-900/40":""}`,onDragOver:O,onDragLeave:L,onDrop:V,children:c.jsxs("button",{onClick:()=>{!l&&g&&(g(t),v&&v(null))},onDoubleClick:E=>{E.stopPropagation(),w&&w(t)},style:{pointerEvents:a&&(C!=null&&C.isDragging)?"none":"auto"},className:`w-full flex items-center ${m?"justify-center px-1":"justify-between px-3"} py-3 md:py-1 rounded-lg mb-1 md:mb-0 transition-colors touch-manipulation ${y} ${b} ${n?"bg-theme-hover text-theme-primary font-bold":"text-theme-secondary font-medium hover:bg-theme-hover hover:text-theme-primary active:bg-theme-hover"}`,title:m?e:"",children:[c.jsxs("div",{className:`flex items-center gap-2 ${m?"justify-center w-full":""}`,children:[i&&c.jsx(i,{size:16,style:{color:T},className:!o&&!n?"text-theme-tertiary":""}),!m&&(l?c.jsx("input",{autoFocus:!0,value:u,onChange:E=>d(E.target.value),onKeyDown:E=>{E.stopPropagation(),E.key==="Enter"?h(t,u):E.key==="Escape"&&f(null)},onBlur:()=>h(t,u),onClick:E=>E.stopPropagation(),className:"bg-theme-card border border-indigo-300 rounded px-1 py-0.5 text-xs outline-none focus:ring-1 focus:ring-indigo-500 w-20 text-theme-primary"}):c.jsx("span",{children:e}))]}),!m&&c.jsxs("div",{className:"flex gap-2 items-center",children:[r>0&&c.jsx("span",{className:"text-[11px] font-semibold text-white bg-rose-400 rounded-full px-3.5 py-0.5 min-w-[26px] text-center shadow-sm",children:r}),s>0&&(t==="matrix"?c.jsx("span",{className:"text-[11px] font-semibold text-white bg-yellow-400 rounded-full px-3.5 py-0.5 min-w-[26px] text-center shadow-sm",children:s}):c.jsx("span",{className:"text-[11px] text-gray-400 font-medium",children:s}))]})]})})},fE=({view:t,setView:e,tagFilter:n,setTagFilter:r})=>{const[s,i]=x.useState(null),{tasks:o,tags:a,themeSettings:l,setThemeSettings:u,deleteTag:d,updateTag:f,addTag:h,clearAllTasks:p,exportData:m,importData:y,syncGoogleToApp:b,expandedTags:g,setExpandedTags:v,sidebarCollapsed:w,toggleSidebar:C,tagsWithResolvedColors:I,t:k,language:D,setLanguage:S,setAdvancedFilters:T,viewTagFilters:_,updateViewTagFilter:N,visibleTasks:A,setFocusedTaskId:O,moveTaskToView:L,selectedTaskIds:V,dragState:E,updateGhostPosition:j,endDrag:H,addTask:W,batchAddTasks:R,updateTask:ae,batchUpdateTasks:re,setToast:$,deleteTask:z,batchDeleteTasks:le,batchImportTasks:$e,user:Be,searchOpen:se,setSearchOpen:Se,lockedGoogleTagIds:ce,toggleGoogleTagLock:Ee}=x.useContext(En),[He,tt]=x.useState(!1),[ut,Ge]=x.useState(null),[mt,ht]=x.useState(null),[Ie,ge]=x.useState(""),[ie,me]=x.useState(()=>{try{return JSON.parse(localStorage.getItem("custom_view_names")||"{}")}catch{return{}}}),[Q,X]=x.useState(""),[he,ke]=x.useState(!1),[ee,pe]=x.useState(null),[Re,_t]=x.useState(""),Nt=x.useRef(null),[ot,Ot]=x.useState({provider:localStorage.getItem("ai_provider")||"gemini",googleKey:localStorage.getItem("google_ai_key")||"",openaiKey:localStorage.getItem("openai_api_key")||"",baseUrl:localStorage.getItem("ai_base_url")||"https://api.openai.com/v1",modelName:localStorage.getItem("ai_model")||"gpt-3.5-turbo"}),[we,qe]=x.useState(null),[Ke,it]=x.useState(null),[Me,yt]=x.useState(null),[fe,ye]=x.useState(""),[_e,ft]=x.useState(null),[lt,nt]=x.useState(null),[Et,jt]=x.useState(()=>{const ue=localStorage.getItem("sidebar_tags_expanded");return ue!==null?ue==="true":!0}),ne=x.useRef(null),Te=x.useRef(null),[Ce,rt]=x.useState(!1),[q,De]=x.useState(localStorage.getItem("google_client_id")||""),[st,Y]=x.useState({start:new Date().toISOString().split("T")[0],end:new Date(new Date().setMonth(new Date().getMonth()+1)).toISOString().split("T")[0]}),[Fe,Ue]=x.useState("date"),[ze,Qe]=x.useState([]),[Z,Ne]=x.useState(new Set),[Pe,We]=x.useState(null),kt=x.useRef(null),Vt=x.useRef(null),Ft=x.useRef(null);f1(kt,()=>tt(!1)),f1(Vt,()=>ft(null)),x.useEffect(()=>{const ue=Dt=>{Dt.key==="Escape"&&ut&&Ge(null)};return window.addEventListener("keydown",ue),()=>window.removeEventListener("keydown",ue)},[ut]),x.useEffect(()=>{ut&&X(ie[ut]||"")},[ut,ie]);const nn=async()=>{const ue=o.filter(Ht=>Ht.tags.some($t=>{const rn=a.find(Dn=>Dn.id===$t);return rn&&rn.name.startsWith("Google:")}));if(ue.length===0){alert(D==="zh"?" Google ":"No Google Calendar tasks found to delete");return}if(!confirm(D==="zh"?` ${ue.length}  Google 
( App  Google )`:`Delete ${ue.length} Google Calendar tasks?
(This will only delete local tasks, NOT Google Calendar events)`))return;const Dt=JSON.parse(localStorage.getItem("task_google_map")||"{}"),Ut=ue.map(Ht=>Ht.id);Ut.forEach(Ht=>{delete Dt[Ht]}),localStorage.setItem("task_google_map",JSON.stringify(Dt)),localStorage.removeItem("google_sync_tokens"),await le(Ut,!0),$({msg:` ${ue.length}  Google `,type:"success"}),tt(!1)};x.useEffect(()=>{const ue=Dt=>{(Dt.metaKey||Dt.ctrlKey)&&Dt.shiftKey&&(Dt.key==="f"||Dt.key==="F"||Dt.key==="s"||Dt.key==="S")&&(Dt.preventDefault(),Dt.stopPropagation(),Se(!0)),Dt.key==="Escape"&&(_e?ft(null):se&&Se(!1))};return window.addEventListener("keydown",ue),()=>window.removeEventListener("keydown",ue)},[se,_e]),x.useEffect(()=>{he&&Nt.current&&Nt.current.focus(),Me?Ft.current=Me:Ft.current&&setTimeout(()=>{const ue=document.querySelector(`[data-tag-id="${Ft.current}"]`);ue&&ue.focus(),Ft.current=null},50)},[he,Me]);const Xt=async()=>{if(!q.trim()){alert(D==="zh"?" Settings  Google Client ID":"Please set Google Client ID in settings"),tt(!0);return}localStorage.setItem("google_client_id",q.trim());try{await _I(),Te.current||(Te.current=window.google.accounts.oauth2.initTokenClient({client_id:q,scope:"https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar.readonly",callback:async ue=>{if(ue.error){console.error(ue);return}await fn(ue.access_token)}})),Ue("date"),rt(!0)}catch{alert("Failed to load Google Sign-In script")}},Jt=()=>{Te.current&&Te.current.requestAccessToken({prompt:""})},fn=async ue=>{We(ue),localStorage.setItem("google_access_token",ue);try{const Dt=await kl(ue);Qe(Dt);const Ut=Dt.find(Ht=>Ht.primary);Ut&&Ne(new Set([Ut.id])),Ue("select")}catch(Dt){alert("Failed to fetch calendars: "+Dt),rt(!1)}},yn=async()=>{var ue,Dt;if(Pe){rt(!1);try{i({current:0,total:0,importing:!0});let Ut=[],Ht=[];const $t=D==="zh"?"":"Schedule";let rn=(ue=a.find(Rn=>Rn.name.toLowerCase()==="schedule"||Rn.name===""))==null?void 0:ue.id;rn||(rn=await h($t,null));for(const Rn of Array.from(Z)){const hn=ze.find(On=>On.id===Rn),xr=`Google:${(hn==null?void 0:hn.summary)||"Calendar"}`;let ar=(Dt=a.find(On=>On.name===xr))==null?void 0:Dt.id;ar||(ar=await h(xr,null));const Ns=await TI(Pe,Rn,st.start,st.end),qs=JSON.parse(localStorage.getItem("task_google_map")||"{}");Ns.forEach(On=>{const nr=!On.start.dateTime;let Mr=On.start.date,B=null,U=null;if(!nr&&On.start.dateTime){const J=new Date(On.start.dateTime),de=J.getFullYear(),Oe=String(J.getMonth()+1).padStart(2,"0"),Ye=String(J.getDate()).padStart(2,"0");Mr=`${de}-${Oe}-${Ye}`;const Xe=String(J.getHours()).padStart(2,"0"),dt=String(J.getMinutes()).padStart(2,"0");if(B=`${Xe}:${dt}`,On.end.dateTime){const Ct=new Date(On.end.dateTime),pt=String(Ct.getHours()).padStart(2,"0"),vt=String(Ct.getMinutes()).padStart(2,"0");U=`${pt}:${vt}`}}else Mr=On.start.date;const P={title:On.summary||"(No Title)",description:On.description||"",status:"active",tags:[rn,ar].filter(Boolean),start_date:Mr,start_time:B,end_time:U,is_all_day:nr,color:"blue",google_event_id:On.id,google_calendar_id:Rn},G=Object.keys(qs).find(J=>qs[J].evtId===On.id);let F=G?o.find(J=>J.id===G):null;F||(F=o.find(J=>J.title===(On.summary||"(No Title)")&&J.start_date===Mr&&!Object.keys(qs).includes(J.id))),F?Ht.push({id:F.id,data:P}):Ut.push(P)})}const Dn=Ut.length+Ht.length;R&&Ut.length>0&&await R(Ut,null,(Rn,hn)=>i({current:Rn,total:Dn,importing:!0})),re&&Ht.length>0&&await re(Ht);const Bn=ze.filter(Rn=>!Z.has(Rn.id));let zn=0;for(const Rn of Bn){const hn=`Google:${Rn.summary}`,xr=a.find(ar=>ar.name===hn);xr&&(await d(xr.id),zn++,console.log(`[Import] Removed tag for unselected calendar: ${hn}`))}if($){let Rn=`Synced ${Dn} events (Added: ${Ut.length}, Updated: ${Ht.length})`;zn>0&&(Rn+=`. Stopped sync for ${zn} unselected calendars.`),$({msg:Rn,type:"info"})}Dn===0&&alert("No events found")}catch(Ut){console.error(Ut),alert("Import Error: "+Ut.message)}finally{i(null)}}},_n=async(ue,Dt=null)=>{ue==null||ue.preventDefault(),Re.trim()?(await h(Re.trim(),Dt),_t(""),ke(!1),pe(null),Dt&&!g.includes(Dt)&&v(Ut=>[...Ut,Dt])):(ke(!1),pe(null))},Fn=x.useMemo(()=>{const ue=["prompt",""],Dt=["journal","note","",""],Ut=["someday","inspiration","","/"],Ht=["note","journal","",""],$t=["project",""],rn=["schedule",""],Dn=a.find(P=>ue.some(G=>P.name.trim().toLowerCase()===G)),Bn=a.find(P=>Dt.some(G=>P.name.trim().toLowerCase()===G)),zn=a.find(P=>Ut.some(G=>P.name.trim().toLowerCase()===G)),Rn=a.find(P=>Ht.some(G=>P.name.trim().toLowerCase()===G)),hn=a.find(P=>$t.some(G=>P.name.trim().toLowerCase()===G)),xr=a.find(P=>P.name==="#prompt"),ar=a.find(P=>rn.some(G=>P.name.toLowerCase()===G)),Ns=Dn==null?void 0:Dn.id,qs=Bn==null?void 0:Bn.id,On=zn==null?void 0:zn.id,nr=Rn==null?void 0:Rn.id,Mr=hn==null?void 0:hn.id,B=xr==null?void 0:xr.id,U=ar==null?void 0:ar.id;return{inbox:o.filter(P=>{if(P.parent_id||P.status==="deleted"||P.status==="logged")return!1;if(!P.start_date&&!P.due_date&&(!P.tags||P.tags.length===0))return!0;const F=!!P.completed_at;return!(!(P.status==="inbox")&&!F||Ns&&P.tags.includes(Ns)||qs&&P.tags.includes(qs)||On&&P.tags.includes(On)||nr&&P.tags.includes(nr)||B&&P.tags.includes(B)||Mr&&P.tags.includes(Mr)&&o.some(Oe=>Oe.parent_id===P.id&&Oe.status!=="deleted")||!F&&(P.start_date||P.due_date))}).length,todayOverdue:(()=>o.filter(P=>!(P.status==="completed"||P.status==="deleted"||P.status==="logged"||P.status==="waiting"||P.status==="someday"||!r1(P.start_date||P.due_date)||U&&P.tags.includes(U)||nr&&P.tags.includes(nr)||Mr&&P.tags.includes(Mr))).length)(),todayScheduled:(()=>o.filter(P=>!(P.status==="completed"||P.status==="deleted"||P.status==="logged"||P.status==="waiting"||P.status==="someday"||r1(P.start_date||P.due_date)||!Iv(P.start_date||P.due_date)||U&&P.tags.includes(U)||nr&&P.tags.includes(nr)||Mr&&P.tags.includes(Mr))).length)(),prompt:o.filter(P=>P.status!=="deleted"&&P.status!=="logged"&&Ns&&P.tags.includes(Ns)&&!P.reviewed_at).length,logbook:o.filter(P=>P.status==="logged"&&!P.reviewed_at).length,waiting:o.filter(P=>P.status==="deleted"||P.status==="logged"?!1:(P.status==="waiting"||On&&P.tags.includes(On))&&!P.reviewed_at).length,trash:o.filter(P=>P.status==="deleted").length,note:o.filter(P=>P.status==="deleted"||P.status==="logged"?!1:nr&&P.tags.includes(nr)).length,matrixUrgent:o.filter(P=>P.parent_id||P.status==="deleted"||P.status==="logged"||P.status==="completed"||U&&P.tags.includes(U)?!1:P.importance==="urgent").length,matrixPlanned:o.filter(P=>P.parent_id||P.status==="deleted"||P.status==="logged"||P.status==="completed"||U&&P.tags.includes(U)?!1:P.importance==="important").length}},[o,a]),Hn={small:"text-xs",normal:"text-sm",large:"text-base"}[l.fontSize]||"text-sm",is={small:"text-xs",normal:"text-sm",large:"text-base"}[l.fontSize]||"text-sm",Gs=l.fontWeight==="thin"?"font-normal":"",ui=(ue,Dt)=>{const Ut={...ie,[ue]:Dt};me(Ut),localStorage.setItem("custom_view_names",JSON.stringify(Ut)),ht(null)},[Nn,Oi]=x.useState(null),ea=async ue=>{if(console.log("[Sidebar Drop] hoveredDropTarget:",Nn),!Nn||!E.isDragging)return;ue.preventDefault(),ue.stopPropagation();const Dt=V.length>0?V:E.draggedId?[E.draggedId]:[];console.log("[Sidebar Drop] Moving tasks:",Dt,"to:",Nn),Dt.length>0&&await L(Dt,Nn),Oi(null),H()},ta=x.useMemo(()=>{const ue=(Dt,Ut)=>a.filter(Ht=>Ht.parent_id===Dt).sort((Ht,$t)=>(Ht.order_index||0)-($t.order_index||0)).map(Ht=>({id:Ht.id,name:Ht.name,depth:Ut,parent_id:Ht.parent_id,data:Ht,isExpanded:g.includes(Ht.id),children:ue(Ht.id,Ut+1)}));return ue(null,0)},[a,g]),di=(ue,Dt)=>{Dt.stopPropagation(),v(Ut=>Ut.includes(ue)?Ut.filter(Ht=>Ht!==ue):[...Ut,ue])},il=(ue,Dt)=>{ue.dataTransfer.setData("tag_id",Dt),qe(Dt)},ol=(ue,Dt)=>{if(ue.preventDefault(),we===Dt)return;const Ut=ue.currentTarget.getBoundingClientRect(),Ht=ue.clientY-Ut.top,$t=Ut.height;let rn="inside";Ht<$t*.25?rn="top":Ht>$t*.75&&(rn="bottom"),it({id:Dt,position:rn})},Ir=async(ue,Dt)=>{ue.preventDefault();const Ut=ue.dataTransfer.getData("tag_id");if(!Ut||Ut===Dt){it(null),qe(null);return}const Ht=a.find(zn=>zn.id===Ut),$t=a.find(zn=>zn.id===Dt);if(!Ht||!$t)return;let rn=$t;for(;rn.parent_id;){if(rn.parent_id===Ut){it(null),qe(null);return}const zn=a.find(Rn=>Rn.id===rn.parent_id);if(!zn)break;rn=zn}let Dn=Ht.parent_id,Bn=Ht.order_index||0;if((Ke==null?void 0:Ke.position)==="inside")Dn=Dt,Bn=a.filter(hn=>hn.parent_id===Dt).reduce((hn,xr)=>Math.max(hn,xr.order_index||0),0)+1e4,g.includes(Dt)||v(hn=>[...hn,Dt]);else{Dn=$t.parent_id;const zn=a.filter(hn=>hn.parent_id===$t.parent_id).sort((hn,xr)=>(hn.order_index||0)-(xr.order_index||0)),Rn=zn.findIndex(hn=>hn.id===Dt);if((Ke==null?void 0:Ke.position)==="top"){const hn=zn[Rn-1],xr=(hn==null?void 0:hn.order_index)||0,ar=$t.order_index||0;Bn=hn?(xr+ar)/2:ar-1e4}else{const hn=zn[Rn+1],xr=(hn==null?void 0:hn.order_index)||0,ar=$t.order_index||0;Bn=hn?(ar+xr)/2:ar+1e4}}await f(Ut,{parent_id:Dn,order_index:Bn}),it(null),qe(null)},Co=async ue=>{n===ue&&r(null),await d(ue)},al=ue=>{yt(ue.id),ye(ue.name),ft(null)},dc=async()=>{Me&&fe.trim()&&(await f(Me,{name:fe}),yt(null))},jn=()=>{localStorage.setItem("ai_provider",ot.provider),localStorage.setItem("google_ai_key",ot.googleKey.trim()),localStorage.setItem("openai_api_key",ot.openaiKey.trim()),localStorage.setItem("ai_base_url",ot.baseUrl.trim()),localStorage.setItem("ai_model",ot.modelName.trim()),alert("AI Settings Saved!")},Pi=ue=>{ue.target.files&&ue.target.files[0]&&(y(ue.target.files[0]),tt(!1))},er=ue=>{Me||(r(ue),e("inbox"),T({additionalTags:[],startDate:null,dueDate:null,color:null}),O(null))},na=(ue,Dt)=>{if(Me!==Dt){if(ue.key==="ArrowRight"){ue.preventDefault();const Ut=a.find(Ht=>Ht.id===Dt);Ut&&a.some(Ht=>Ht.parent_id===Dt)&&(g.includes(Dt)||v(Ht=>[...Ht,Ut.id]))}if(ue.key==="ArrowLeft"){ue.preventDefault();const Ut=a.find(Ht=>Ht.id===Dt);if(Ut)g.includes(Dt)&&v(Ht=>Ht.filter($t=>$t!==Dt));else if(Ut.parent_id){const Ht=document.querySelector(`[data-tag-id="${Ut.parent_id}"]`);Ht&&(Ht.focus(),er(Ut.parent_id))}}if(ue.key==="ArrowDown"||ue.key==="ArrowUp"){ue.preventDefault();const Ut=Array.from(document.querySelectorAll("[data-tag-id]")),Ht=Ut.findIndex(Bn=>Bn.getAttribute("data-tag-id")===Dt);if(Ht===-1)return;const $t=ue.key==="ArrowDown"?(Ht+1)%Ut.length:(Ht-1+Ut.length)%Ut.length,rn=Ut[$t];rn.focus();const Dn=rn.getAttribute("data-tag-id");Dn&&er(Dn)}if(ue.key==="Tab"&&(ue.preventDefault(),A.length>0&&O(A[0].data.id)),ue.key==="Enter"){ue.preventDefault();const Ut=a.find(Ht=>Ht.id===Dt);Ut&&al(Ut)}if(ue.key==="Delete"||ue.key==="Backspace"){ue.preventDefault(),ue.stopPropagation();const Ut=Dt;setTimeout(()=>{confirm(k("deleteTagConfirm"))&&Co(Ut)},10)}}},ll=ue=>{const Dt=(Ke==null?void 0:Ke.id)===ue.id;let Ut="border-transparent";Dt&&((Ke==null?void 0:Ke.position)==="top"?Ut="border-t-2 border-t-indigo-500":(Ke==null?void 0:Ke.position)==="bottom"?Ut="border-b-2 border-b-indigo-500":Ut="bg-indigo-50 ring-1 ring-indigo-500");const Ht=Me===ue.id;return c.jsxs("div",{className:"relative",children:[c.jsxs("div",{"data-tag-id":ue.id,draggable:!Ht,onDragStart:$t=>il($t,ue.id),onDragOver:$t=>ol($t,ue.id),onDrop:$t=>Ir($t,ue.id),onDragLeave:()=>it(null),className:`relative group flex items-center gap-0.5 py-0.5 rounded pr-1 transition-all select-none outline-none ${is} ${Gs} ${n===ue.id?"bg-theme-hover text-indigo-600 font-bold":"text-theme-secondary font-medium hover:text-theme-primary hover:bg-theme-hover"} ${Ut} ${w?"justify-center pl-0":""}`,style:{paddingLeft:w?"0":`${ue.depth*6+6}px`},onClick:()=>{Ht||er(ue.id)},onDoubleClick:$t=>{$t.stopPropagation(),al(ue)},tabIndex:0,onKeyDown:$t=>na($t,ue.id),children:[ue.children.length>0?c.jsx("button",{onClick:$t=>di(ue.id,$t),className:"p-0 hover:bg-theme-hover rounded text-theme-tertiary",children:ue.isExpanded?c.jsx(ts,{size:10}):c.jsx(rs,{size:10})}):c.jsx("div",{className:"w-[10px]"}),Ht?c.jsxs("div",{className:"flex items-center flex-1 gap-1",children:[c.jsx("input",{autoFocus:!0,className:"flex-1 min-w-0 bg-theme-card border border-indigo-500/50 rounded px-1 py-0.5 text-xs outline-none focus:ring-1 focus:ring-indigo-500 text-theme-primary",value:fe,onChange:$t=>ye($t.target.value),onKeyDown:$t=>{$t.key==="Enter"?dc():$t.key==="Escape"&&yt(null)},onClick:$t=>$t.stopPropagation()}),c.jsx("button",{onClick:$t=>{$t.stopPropagation(),dc()},className:"text-green-600 hover:bg-green-100 p-0.5 rounded",children:c.jsx(Xn,{size:12})}),c.jsx("button",{onClick:$t=>{$t.stopPropagation(),yt(null)},className:"text-red-500 hover:bg-red-100 p-0.5 rounded",children:c.jsx(un,{size:12})})]}):c.jsxs(c.Fragment,{children:[!w&&c.jsxs("span",{className:"truncate flex-1 text-left flex items-center gap-1",style:I[ue.id]?{color:I[ue.id],opacity:.5}:void 0,children:[ue.name.startsWith("#")?ue.name.slice(1):ue.name,ue.name.startsWith("Google:")&&ce.includes(ue.id)&&c.jsx(La,{size:9,className:"text-amber-500 flex-shrink-0"})]}),!w&&c.jsxs("div",{className:"flex items-center opacity-0 group-hover:opacity-100 transition-opacity",children:[c.jsx("button",{onClick:$t=>{$t.stopPropagation(),pe(ue.id),_t(""),ue.isExpanded||v(rn=>[...rn,ue.id])},className:"p-0.5 hover:bg-gray-200 rounded text-gray-400",title:k("addSubTag"),children:c.jsx(ni,{size:10})}),c.jsx("button",{onMouseDown:$t=>{$t.stopPropagation()},onClick:$t=>{$t.stopPropagation();const rn=$t.currentTarget.getBoundingClientRect(),Dn=180,Bn=window.innerHeight,Rn=rn.bottom+4+Dn>Bn?rn.top-Dn-4:rn.bottom+4;nt({top:Math.max(8,Rn),left:Math.max(8,rn.right-208)}),ft(_e===ue.id?null:ue.id)},className:"p-0.5 hover:bg-gray-200 rounded text-gray-400",children:c.jsx(zz,{size:10})})]}),_e===ue.id&&lt&&ir.createPortal(c.jsxs("div",{ref:Vt,className:"fixed bg-theme-card rounded-xl shadow-2xl border border-theme p-3 w-52 animate-in fade-in slide-in-from-top-1 duration-200",style:{top:lt.top,left:Math.max(8,lt.left),zIndex:99999},onClick:$t=>$t.stopPropagation(),children:[c.jsxs("div",{className:"mb-3",children:[c.jsx("p",{className:"text-[9px] font-bold text-gray-400 mb-2 uppercase",children:k("tagStyle")}),c.jsx("div",{className:"grid grid-cols-5 gap-1.5 focus:outline-none",children:Pee.map($t=>c.jsx("button",{className:`w-6 h-6 rounded-full hover:scale-110 transition-transform ${ue.data.color===$t?"ring-2 ring-offset-1 ring-indigo-500 shadow-sm":""}`,style:{backgroundColor:$t},onClick:rn=>{rn.stopPropagation(),f(ue.id,{color:$t}),ft(null)},title:k("selectTagColor")},$t))})]}),c.jsxs("div",{className:"space-y-0.5",children:[c.jsxs("button",{onClick:()=>{pe(ue.id),_t(""),ft(null),ue.isExpanded||v($t=>[...$t,ue.id])},className:"w-full flex items-center gap-2 px-2 py-1 hover:bg-theme-hover rounded text-[11px] text-theme-secondary font-medium",children:[c.jsx(ni,{size:11})," ",k("addSubTag")]}),c.jsxs("button",{onClick:()=>al(ue),className:"w-full flex items-center gap-2 px-2 py-1 hover:bg-theme-hover rounded text-[11px] text-theme-secondary font-medium",children:[c.jsx(Rg,{size:11})," ",k("rename")]}),ue.name.startsWith("Google:")&&c.jsx("button",{onClick:$t=>{$t.stopPropagation(),Ee(ue.id),ft(null)},className:`w-full flex items-center gap-2 px-2 py-1 hover:bg-theme-hover rounded text-[11px] font-medium ${ce.includes(ue.id)?"text-amber-600":"text-theme-secondary"}`,children:ce.includes(ue.id)?c.jsxs(c.Fragment,{children:[c.jsx(c1,{size:11})," "]}):c.jsxs(c.Fragment,{children:[c.jsx(La,{size:11})," "]})}),c.jsxs("button",{onClick:$t=>{$t.stopPropagation();const rn=ue.id;ft(null),setTimeout(()=>{confirm(k("deleteTagConfirm"))&&Co(rn)},10)},className:"w-full flex items-center gap-2 px-2 py-1 hover:bg-red-50 rounded text-[11px] text-red-600 font-medium",children:[c.jsx(Er,{size:11})," ",k("deleteTag")]})]})]}),document.body)]})]}),ee===ue.id&&c.jsx("div",{className:"px-1 mb-0.5",style:{paddingLeft:`${(ue.depth+1)*6+6}px`},children:c.jsx("form",{onSubmit:$t=>_n($t,ue.id),className:"relative",children:c.jsx("input",{autoFocus:!0,value:Re,onChange:$t=>_t($t.target.value),onKeyDown:$t=>{$t.key==="Escape"&&pe(null),$t.stopPropagation()},onBlur:()=>{Re.trim()||pe(null)},placeholder:k("subTagPlaceholder"),className:"w-full text-[10px] py-1 px-2 bg-indigo-50/30 border border-indigo-100/50 rounded outline-none focus:ring-1 focus:ring-indigo-200 transition-all font-medium text-gray-700 placeholder:text-gray-300"})})}),ue.isExpanded&&ue.children.map($t=>ll($t))]},ue.id)},tr=ue=>{const Dt=mt===ue.id,Ut=["logbook","recent","trash","worklog"].includes(ue.id),Ht=ie[ue.id]||ue.label;return c.jsx(Lee,{...ue,label:Ht,isEditing:Dt,editingViewName:Ie,setEditingViewName:ge,setEditingViewId:ht,saveViewName:ui,setHoveredDropTarget:Oi,sidebarCollapsed:w,sidebarTextClass:Hn,sidebarFontClass:Gs,setView:e,setTagFilter:r,onEditFilter:Ut?void 0:$t=>Ge($t)})};return c.jsxs("aside",{className:"w-full bg-theme-sidebar border-r border-theme h-screen flex flex-col p-5 sticky top-0 overflow-hidden",onDragOver:ue=>{E.isDragging&&(ue.preventDefault(),j(ue.clientX,ue.clientY))},onDrop:ea,children:[c.jsxs("div",{className:`mb-8 flex items-center ${w?"justify-center flex-col gap-4":"justify-between px-1"} opacity-60`,children:[!w&&c.jsxs("div",{className:"flex items-center gap-2 text-theme-secondary",children:[c.jsx(a1,{size:18})," ",c.jsx("span",{className:"text-xs font-bold tracking-widest uppercase text-theme-tertiary",children:k("appearance")})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:()=>Se(!0),className:"hover:bg-theme-hover p-1 rounded transition-colors text-theme-secondary",title:" (K)",children:c.jsx(Wc,{size:18})}),c.jsx("button",{onClick:C,className:"hover:bg-theme-hover p-1 rounded transition-colors text-theme-secondary",children:w?c.jsx(Uz,{size:18}):c.jsx(Bz,{size:18})})]})]}),c.jsxs("nav",{className:"flex-1 overflow-y-auto no-scrollbar py-2",children:[c.jsx("div",{className:"mb-6",children:c.jsx(tr,{id:"inbox",label:k("inbox"),normalCount:Fn.inbox,active:t==="inbox"&&!n,icon:o1,color:"#1badf8"})}),c.jsxs("div",{className:"mb-6",children:[c.jsx(tr,{id:"today",label:k("today"),overdueCount:Fn.todayOverdue,normalCount:Fn.todayScheduled,active:t==="today"&&!n,icon:qI,color:"#f5c94c",acceptsDrop:!0}),c.jsx(tr,{id:"allview",label:"",active:t==="allview"&&!n,icon:$I,color:"#10b981"}),c.jsx(tr,{id:"matrix",label:"",normalCount:Fn.matrixUrgent,active:t==="matrix",icon:a1,color:"#6366f1"})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx(tr,{id:"focus",label:"",active:t==="focus",icon:YI,color:"#ef4444"}),c.jsx(tr,{id:"project",label:"",active:t==="project",icon:wz,color:"#f97316",acceptsDrop:!0}),c.jsx(tr,{id:"annualplan",label:"",active:t==="annualplan",icon:xz,color:"#eab308"})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx(tr,{id:"waiting",label:"/",active:t==="waiting"&&!n,icon:Ri,color:"#a855f7",acceptsDrop:!0}),c.jsx(tr,{id:"journal",label:"",active:t==="journal"&&!n,icon:II,color:"#34d399",acceptsDrop:!0}),c.jsx(tr,{id:"prompt",label:k("prompt"),normalCount:Fn.prompt,active:t==="prompt",icon:Dz,color:"#fbbf24",acceptsDrop:!0}),c.jsx(tr,{id:"worklog",label:"",active:t==="worklog",icon:eh,color:"#0ea5e9"})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx(tr,{id:"logbook",label:k("logbook"),normalCount:Fn.logbook,active:t==="logbook",icon:um,color:"#a16207"}),c.jsx(tr,{id:"recent",label:"",active:t==="recent",icon:jz,color:"#0891b2"}),c.jsx(tr,{id:"trash",label:k("trash"),normalCount:Fn.trash>1e3?Fn.trash:void 0,active:t==="trash",icon:Er,color:"#9ca3af"})]}),!w&&c.jsxs("div",{className:"mt-2",children:[c.jsxs("div",{className:"flex items-center justify-between px-3 mb-2 group/tagheader cursor-pointer select-none",onClick:()=>{const ue=!Et;jt(ue),localStorage.setItem("sidebar_tags_expanded",String(ue))},children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("p",{className:"text-[10px] font-bold text-gray-300 uppercase tracking-wider",children:"TAGS"}),c.jsx("span",{className:"text-gray-300 transition-transform duration-200",style:{transform:Et?"rotate(0deg)":"rotate(-90deg)"},children:c.jsx(ts,{size:10})})]}),c.jsx("button",{onClick:ue=>{ue.stopPropagation(),ke(!0),Et||jt(!0)},className:"opacity-0 group-hover/tagheader:opacity-100 p-0.5 hover:bg-gray-100 rounded text-gray-400 hover:text-gray-600 transition-all flex items-center justify-center",title:"",children:c.jsx(ni,{size:10})})]}),Et&&c.jsxs("div",{className:"overflow-hidden",children:[he&&c.jsx("div",{className:"px-3 overflow-hidden mb-2",children:c.jsxs("form",{onSubmit:_n,className:"relative",children:[c.jsx("input",{ref:Nt,value:Re,onChange:ue=>_t(ue.target.value),onKeyDown:ue=>{ue.key==="Escape"&&ke(!1),ue.stopPropagation()},onBlur:()=>{Re.trim()||ke(!1)},placeholder:"...",className:"w-full text-xs py-1.5 px-2 bg-indigo-50/50 border border-indigo-100 rounded-md outline-none focus:ring-1 focus:ring-indigo-300 transition-all font-medium text-gray-700 placeholder:text-gray-300"}),c.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1",children:Re.trim()&&c.jsx("button",{type:"submit",className:"text-indigo-500 hover:text-indigo-600",children:c.jsx(Xn,{size:12})})})]})}),c.jsxs("div",{className:"space-y-0",children:[ta.map(ue=>ll(ue)),!he&&c.jsxs("button",{onClick:()=>ke(!0),className:"w-full group flex items-center gap-1.5 px-3 py-1 text-gray-300 hover:text-gray-400 text-xs transition-colors transition-opacity opacity-0 hover:opacity-100",children:[c.jsx(ni,{size:10}),c.jsx("span",{className:"font-medium",children:k("addTagPlaceholder")})]})]})]})]})]}),c.jsxs("div",{className:"mt-auto pt-4 border-t border-gray-200 relative",children:[c.jsxs("div",{className:`flex ${w?"justify-center flex-col gap-2":"justify-between"} items-center`,children:[!w&&c.jsxs("div",{className:"text-[10px] text-gray-400 flex items-center gap-1",children:[c.jsx(LI,{size:10})," ",Y6]}),c.jsx("button",{onClick:()=>tt(!He),"aria-label":"Settings",className:"text-gray-400 hover:text-gray-600 p-1 rounded hover:bg-gray-100 transition-colors",children:c.jsx(GI,{size:14})})]}),He&&c.jsx("div",{ref:kt,className:"absolute bottom-full left-0 mb-2 w-full bg-white rounded-lg shadow-xl border border-gray-200 z-50 animate-in fade-in zoom-in duration-100 max-h-[60vh] overflow-y-auto",children:c.jsxs("div",{className:"p-3",children:[c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider",children:k("appearance")}),c.jsxs("div",{className:"space-y-3 mb-4",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:k("language")})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>S("zh"),className:`flex-1 text-[10px] py-1 rounded ${D==="zh"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:D==="zh"?"":"Chinese"}),c.jsx("button",{onClick:()=>S("en"),className:`flex-1 text-[10px] py-1 rounded ${D==="en"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:D==="zh"?"":"English"})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:D==="zh"?"":"Color Theme"})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>u(ue=>({...ue,themeMode:"light"})),className:`flex-1 text-[10px] py-1 rounded ${l.themeMode==="light"||!l.themeMode?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:D==="zh"?"":"Light"}),c.jsx("button",{onClick:()=>u(ue=>({...ue,themeMode:"dark"})),className:`flex-1 text-[10px] py-1 rounded ${l.themeMode==="dark"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:D==="zh"?"":"Dark"}),c.jsx("button",{onClick:()=>u(ue=>({...ue,themeMode:"programmer"})),className:`flex-1 text-[10px] py-1 rounded ${l.themeMode==="programmer"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:D==="zh"?"":"Dev"})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:k("fontSize")})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>u(ue=>({...ue,fontSize:"small"})),className:`flex-1 text-[10px] py-1 rounded ${l.fontSize==="small"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:k("sizeSmall")}),c.jsx("button",{onClick:()=>u(ue=>({...ue,fontSize:"normal"})),className:`flex-1 text-[10px] py-1 rounded ${l.fontSize==="normal"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:k("sizeNormal")}),c.jsx("button",{onClick:()=>u(ue=>({...ue,fontSize:"large"})),className:`flex-1 text-[10px] py-1 rounded ${l.fontSize==="large"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:k("sizeLarge")})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:k("timeFormat")})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>u(ue=>({...ue,timeFormat:"24h"})),className:`flex-1 text-[10px] py-1 rounded ${l.timeFormat==="24h"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:"24H"}),c.jsx("button",{onClick:()=>u(ue=>({...ue,timeFormat:"12h"})),className:`flex-1 text-[10px] py-1 rounded ${l.timeFormat==="12h"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:"12H"})]})]})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:k("calendarSettings")}),c.jsxs("div",{className:"mb-4 space-y-2",children:[c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showLunar,onChange:ue=>u({...l,showLunar:ue.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:k("showLunar")})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showTaiwanHolidays,onChange:ue=>u({...l,showTaiwanHolidays:ue.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:k("showTaiwanHolidays")})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showRelationshipLines!==!1,onChange:ue=>u({...l,showRelationshipLines:ue.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:""})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showImportedGoogleEvents!==!1,onChange:ue=>u({...l,showImportedGoogleEvents:ue.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:D==="zh"?" Google ":"Show Google Events"})]})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:"Google Calendar"}),c.jsxs("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"Client ID"}),c.jsx("input",{type:"text",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"your-client-id.apps.googleusercontent.com",value:q,onChange:ue=>De(ue.target.value)})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:k("aiSettings")}),c.jsxs("div",{className:"mb-4 space-y-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] font-bold text-gray-400 uppercase mb-1",children:k("provider")}),c.jsxs("select",{value:ot.provider,onChange:ue=>Ot(Dt=>({...Dt,provider:ue.target.value})),className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",children:[c.jsx("option",{value:"gemini",children:"Google Gemini"}),c.jsx("option",{value:"openai",children:"OpenAI Compatible (DeepSeek/Moonshot)"})]})]}),ot.provider==="gemini"?c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsx("span",{className:"text-xs text-gray-600",children:"Gemini API Key"}),c.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-indigo-500 hover:underline",children:"Get Key"})]}),c.jsx("input",{type:"password",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"AIza...",value:ot.googleKey,onChange:ue=>Ot(Dt=>({...Dt,googleKey:ue.target.value}))})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"Base URL"}),c.jsx("input",{type:"text",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"https://api.deepseek.com",value:ot.baseUrl,onChange:ue=>Ot(Dt=>({...Dt,baseUrl:ue.target.value}))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"API Key"}),c.jsx("input",{type:"password",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"sk-...",value:ot.openaiKey,onChange:ue=>Ot(Dt=>({...Dt,openaiKey:ue.target.value}))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"Model Name"}),c.jsx("input",{type:"text",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"e.g. deepseek-chat",value:ot.modelName,onChange:ue=>Ot(Dt=>({...Dt,modelName:ue.target.value}))})]})]}),c.jsx("button",{onClick:jn,className:"w-full bg-indigo-600 text-white px-2 py-1.5 rounded text-xs hover:bg-indigo-700 transition-colors font-medium",children:"Save Settings"})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:"Data"}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("button",{onClick:()=>{confirm(D==="zh"?"":"Are you sure you want to delete all tasks? A backup will be downloaded first.")&&p()},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(Er,{size:12})," ",D==="zh"?"":"Delete All Tasks"]}),c.jsxs("button",{onClick:m,className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(lu,{size:12})," ",D==="zh"?"":"Backup Data"]}),c.jsxs("button",{onClick:()=>{var ue;return(ue=ne.current)==null?void 0:ue.click()},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(Xz,{size:12})," ",D==="zh"?"":"Import Data"]}),c.jsxs("button",{onClick:Xt,className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(vo,{size:12})," ",D==="zh"?" Google ":"Import Google Calendar"]}),c.jsxs("button",{onClick:()=>b&&b(),className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(l1,{size:12})," ",D==="zh"?" Google ":"Sync Google Calendar"]}),c.jsxs("button",{onClick:()=>{localStorage.removeItem("google_sync_tokens"),$({msg:"Sync tokens ...",type:"info"}),b&&b()},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-amber-50 rounded text-xs text-amber-600",children:[c.jsx(l1,{size:12})," ",D==="zh"?"":"Force Full Sync"]}),c.jsxs("button",{onClick:nn,className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-red-600",children:[c.jsx(Er,{size:12})," ",D==="zh"?"":"Clear Imported Calendar"]}),c.jsxs("button",{onClick:async()=>{if(!confirm("Google:( Google )"))return;const ue=JSON.parse(localStorage.getItem("task_google_map")||"{}"),Dt=o.filter(Ht=>Ht.tags.some($t=>{const rn=a.find(Dn=>Dn.id===$t);return rn&&rn.name.includes("")&&rn.name.toLowerCase().includes("google")}));let Ut=0;Dt.forEach(Ht=>{ue[Ht.id]&&delete ue[Ht.id]}),localStorage.setItem("task_google_map",JSON.stringify(ue));for(const Ht of Dt)await z(Ht.id),Ut++;$({msg:` ${Ut} `,type:"success"})},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-orange-600",children:[c.jsx(Er,{size:12})," ",D==="zh"?" ()":"Clean CiXing Tasks (Local)"]}),c.jsx("input",{type:"file",ref:ne,className:"hidden",accept:".json",onChange:Pi})]})]})})]}),ut&&ir.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-[9999] flex items-center justify-center",onClick:()=>Ge(null),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-80 max-h-[80vh] flex flex-col overflow-hidden",onClick:ue=>ue.stopPropagation(),children:[c.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h3",{className:"font-bold text-gray-700 text-sm",children:""}),c.jsx("button",{onClick:()=>Ge(null),className:"text-gray-400 hover:text-gray-600",children:c.jsx(un,{size:16})})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-xs text-gray-500",children:""}),c.jsx("input",{type:"text",value:Q,onChange:ue=>X(ue.target.value),onBlur:()=>{const ue={...ie};Q.trim()?ue[ut]=Q:delete ue[ut],me(ue),localStorage.setItem("custom_view_names",JSON.stringify(ue))},onKeyDown:ue=>{ue.key==="Enter"&&ue.target.blur()},className:"flex-1 px-2 py-1 text-sm border border-gray-200 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:k(ut)||ut})]})]}),c.jsxs("div",{className:"p-2 overflow-y-auto flex-1 text-sm",children:[c.jsx("p",{className:"px-2 py-2 text-xs text-gray-500 mb-2 bg-yellow-50 rounded border border-yellow-100",children:" () /  () / "}),c.jsx("div",{className:"space-y-1",children:a.map(ue=>{const Dt=_[ut]||{include:[],exclude:[]},{include:Ut,exclude:Ht}=Array.isArray(Dt)?{include:Dt,exclude:[]}:Dt,$t=Ut.includes(ue.id),rn=Ht.includes(ue.id);return c.jsxs("div",{className:"flex items-center gap-2 px-2 py-2 hover:bg-gray-50 rounded cursor-pointer select-none",onClick:()=>{let Dn=[...Ut],Bn=[...Ht];$t?(Dn=Dn.filter(zn=>zn!==ue.id),Bn.push(ue.id)):rn?Bn=Bn.filter(zn=>zn!==ue.id):Dn.push(ue.id),N(ut,{include:Dn,exclude:Bn})},children:[c.jsxs("div",{className:"w-5 h-5 flex items-center justify-center",children:[$t&&c.jsx(au,{size:16,className:"text-green-500"}),rn&&c.jsx(eF,{size:16,className:"text-red-500"}),!$t&&!rn&&c.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300"})]}),c.jsx("span",{style:{color:I[ue.id]},children:ue.name.startsWith("#")?ue.name.slice(1):ue.name})]},ue.id)})})]}),c.jsx("div",{className:"p-3 border-t border-gray-100 flex justify-end",children:c.jsx("button",{onClick:()=>Ge(null),className:"px-4 py-1.5 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700",children:""})})]})}),document.body),Ce&&ir.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-[9999] flex items-center justify-center",onClick:()=>rt(!1),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-96 p-4 max-h-[80vh] flex flex-col",onClick:ue=>ue.stopPropagation(),children:[c.jsx("h3",{className:"font-bold text-gray-700 text-sm mb-4",children:Fe==="date"?D==="zh"?"":"Select Date Range":D==="zh"?"":"Select Calendars"}),Fe==="date"?c.jsxs("div",{className:"space-y-3 mb-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Start Date"}),c.jsx("input",{type:"date",className:"w-full border border-gray-200 rounded px-2 py-1 text-sm outline-none focus:ring-1 focus:ring-indigo-500",value:st.start,onChange:ue=>Y(Dt=>({...Dt,start:ue.target.value}))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"End Date"}),c.jsx("input",{type:"date",className:"w-full border border-gray-200 rounded px-2 py-1 text-sm outline-none focus:ring-1 focus:ring-indigo-500",value:st.end,onChange:ue=>Y(Dt=>({...Dt,end:ue.target.value}))})]}),c.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[c.jsx("button",{onClick:()=>rt(!1),className:"px-3 py-1.5 text-gray-500 hover:bg-gray-100 rounded text-xs",children:"Cancel"}),c.jsx("button",{onClick:Jt,className:"px-3 py-1.5 bg-indigo-600 text-white rounded text-xs font-medium hover:bg-indigo-700",children:"Next"})]})]}):c.jsxs("div",{className:"mb-4 flex flex-col flex-1 overflow-hidden",children:[c.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 mb-4 border border-gray-100 rounded p-2",children:ze.map(ue=>c.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer hover:bg-gray-50 p-1 rounded",children:[c.jsx("input",{type:"checkbox",checked:Z.has(ue.id),onChange:Dt=>{const Ut=new Set(Z);Dt.target.checked?Ut.add(ue.id):Ut.delete(ue.id),Ne(Ut)},className:"rounded text-indigo-600 focus:ring-indigo-500"}),c.jsx("span",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:ue.backgroundColor||"#ccc"}}),c.jsx("span",{className:"truncate",children:ue.summary})]},ue.id))}),c.jsxs("div",{className:"flex justify-end gap-2 mt-auto",children:[c.jsx("button",{onClick:()=>Ue("date"),className:"px-3 py-1.5 text-gray-500 hover:bg-gray-100 rounded text-xs",children:"Back"}),c.jsx("button",{onClick:yn,disabled:Z.size===0,className:"px-3 py-1.5 bg-indigo-600 text-white rounded text-xs font-medium hover:bg-indigo-700 disabled:opacity-50",children:"Import"})]})]})]})}),document.body),s&&c.jsx(Oee,{current:s.current,total:s.total}),c.jsx(Ree,{isOpen:se,onClose:()=>Se(!1)})]})},$ee=({initialTitle:t,onSave:e,onCancel:n,onSwitchToFull:r,className:s,fontClass:i})=>{const[o,a]=x.useState(t),l=x.useRef(null);x.useEffect(()=>{const d=setTimeout(()=>{if(l.current){l.current.focus();const f=l.current.value.length;l.current.setSelectionRange(f,f)}},50);return()=>clearTimeout(d)},[]);const u=d=>{d.stopPropagation(),d.key==="Enter"&&(d.preventDefault(),d.metaKey||d.ctrlKey?r(o):e(o)),d.key==="Escape"&&(d.preventDefault(),n())};return c.jsx("input",{ref:l,autoFocus:!0,value:o,onChange:d=>a(d.target.value),onBlur:()=>e(o),onKeyDown:u,onClick:d=>d.stopPropagation(),className:`bg-transparent outline-none border-none p-0 m-0 w-full text-gray-900 dark:text-gray-100 caret-gray-900 dark:caret-gray-100 font-normal ${i}`})},xl=({flatTask:t,isFocused:e,onEdit:n,onSelect:r,backgroundColor:s})=>{const{updateTask:i,setFocusedTaskId:o,editingTaskId:a,setEditingTaskId:l,inlineEditingTaskId:u,setInlineEditingTaskId:d,addTask:f,toggleExpansion:h,startDrag:p,keyboardMove:m,tasks:y,tags:b,dragState:g,navigateBack:v,view:w,canNavigateBack:C,smartReschedule:I,lockTask:k,unlockTask:D,verifyTaskPassword:S,temporarilyUnlockTask:T,selectedTaskIds:_,handleSelection:N,themeSettings:A,pendingFocusTaskId:O,setPendingFocusTaskId:L,setSelectedTaskIds:V,visibleTasks:E,t:j,language:H,batchDeleteTasks:W,batchUpdateTasks:R,setToast:ae,tagFilter:re}=x.useContext(En),{recordingTaskId:$}=x.useContext(Lu),z=t.data,le=x.useRef(null),$e=x.useRef(null),Be=x.useRef(null),[se,Se]=x.useState(!1),[ce,Ee]=x.useState(null),He=typeof window<"u"&&window.innerWidth<768,[tt,ut]=x.useState(!1),[Ge,mt]=x.useState("lock"),[ht,Ie]=x.useState(""),[ge,ie]=x.useState(null),me=t.isExpanded,Q=t.hasChildren,X=!!z.completed_at&&(z.status==="completed"||z.status==="logged"),he=z.status==="canceled",ke=X||he,ee=_.includes(z.id),pe=!!z.is_locked;pe&&z.lock_password;const Re=pe&&!z.lock_password,_t=Z=>{if(!Z)return null;switch(Z){case"urgent":return"red";case"planned":return"amber";case"delegated":return"green";case"unplanned":return"gray";default:return null}},Nt=Z=>{const Ne=_t(Z.importance);if(Ne)return Ne;let Pe=Z;const We=new Set;for(;Pe.parent_id&&!We.has(Pe.id);){We.add(Pe.id);const kt=y.find(Vt=>Vt.id===Pe.parent_id);if(!kt)break;Pe=kt}return Pe.color||"blue"},ot=!1;x.useEffect(()=>{e&&le.current&&le.current.focus({preventScroll:!0})},[e]),x.useEffect(()=>{O===z.id&&(L(null),o(z.id),setTimeout(()=>{d(z.id)},50))},[O,z.id,L,o,d]);const Ot=Z=>{Z?z.status===Z?i(z.id,{status:"active",completed_at:null}):i(z.id,{status:Z,completed_at:new Date().toISOString()}):X||he?i(z.id,{status:"active",completed_at:null}):i(z.id,{status:"completed",completed_at:new Date().toISOString()})},we=Z=>Z.start_date?new Date(Z.start_date).toISOString().split("T")[0]:Z.due_date?new Date(Z.due_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],qe=Z=>{if(w!=="today")return!1;const Pe=(_.includes(z.id)?_:[z.id]).map(We=>E.findIndex(kt=>kt.data.id===We)).filter(We=>We!==-1).sort((We,kt)=>We-kt);if(Pe.length===0)return!1;if(Z==="up"){const We=Pe[0];if(We===0)return!0;const kt=E[We].data,Vt=E[We-1].data;return we(Vt)!==we(kt)}else{const We=Pe[Pe.length-1];if(We===E.length-1)return!0;const kt=E[We].data,Vt=E[We+1].data;return we(Vt)!==we(kt)}},Ke=Z=>{const Ne=_.includes(z.id)?_:[z.id],Pe=Ne.map(Jt=>y.find(fn=>fn.id===Jt)).filter(Jt=>Jt!==void 0).sort((Jt,fn)=>{var Fn,Hn;const yn=((Fn=Jt.view_orders)==null?void 0:Fn.today)??0,_n=((Hn=fn.view_orders)==null?void 0:Hn.today)??0;return yn-_n});if(Pe.length===0)return;const We=Pe[0],kt=We.start_date?new Date(We.start_date):new Date,Vt=new Date(kt);Vt.setDate(Vt.getDate()+(Z==="up"?-1:1));const Ft=Vt.toISOString().split("T")[0],nn=y.filter(Jt=>{var yn,_n;return(((yn=Jt.start_date)==null?void 0:yn.split("T")[0])||((_n=Jt.due_date)==null?void 0:_n.split("T")[0]))===Ft&&!Ne.includes(Jt.id)}).sort((Jt,fn)=>{var Fn,Hn;const yn=((Fn=Jt.view_orders)==null?void 0:Fn.today)??0,_n=((Hn=fn.view_orders)==null?void 0:Hn.today)??0;return yn-_n});let Xt;Z==="up"?Xt=nn.reduce((fn,yn)=>{var _n;return Math.max(fn,((_n=yn.view_orders)==null?void 0:_n.today)??0)},0)+1e4:Xt=nn.reduce((fn,yn)=>{var _n;return Math.min(fn,((_n=yn.view_orders)==null?void 0:_n.today)??9e8)},9e8)-(Pe.length+1)*1e4,R(Pe.map((Jt,fn)=>({id:Jt.id,data:{start_date:Ft,is_all_day:!0,view_orders:{...Jt.view_orders||{},today:Xt+fn*1e4}}})))},it=Z=>{if(Z.altKey&&!Z.ctrlKey&&!Z.metaKey){if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(Z.key)&&(Z.preventDefault(),Z.stopPropagation()),w==="focus"||w==="recent"||ot||w==="allview"&&z.status==="logged")return;if(w==="today"){if(Z.key==="ArrowUp"){if(qe("up")){Ke("up");return}m(z.id,"up");return}if(Z.key==="ArrowDown"){if(qe("down")){Ke("down");return}m(z.id,"down");return}if(Z.key==="ArrowRight"){m(z.id,"right");return}if(Z.key==="ArrowLeft"){C?v():m(z.id,"left");return}}if(w==="upcoming"){if(Z.key==="ArrowUp"){m(z.id,"up");return}if(Z.key==="ArrowDown"){m(z.id,"down");return}return}if(Z.key==="ArrowUp"){m(z.id,"up");return}if(Z.key==="ArrowDown"){m(z.id,"down");return}if(Z.key==="ArrowRight"){m(z.id,"right");return}if(Z.key==="ArrowLeft"){C?v():m(z.id,"left");return}}if(Z.key==="Tab"){if(Z.preventDefault(),Z.stopPropagation(),w==="focus"||w==="upcoming"||ot||w==="allview"&&z.status==="logged")return;if(Z.shiftKey){if(t.depth===0&&re){const Ne=document.querySelector(`[data-tag-id="${re}"]`);if(Ne){Ne.focus(),o(null),V([]);return}}C?v():m(z.id,"left")}else m(z.id,"right");return}if(Z.key==="Delete"||Z.key==="Backspace"&&!Z.target.matches("input, textarea")){Z.preventDefault(),Z.stopPropagation();const Ne=_.includes(z.id)?_:[z.id],Pe=E.findIndex(kt=>kt.data.id===z.id);let We=null;for(let kt=Pe+1;kt<E.length;kt++)if(!Ne.includes(E[kt].data.id)){We=E[kt];break}if(!We){for(let kt=Pe-1;kt>=0;kt--)if(!Ne.includes(E[kt].data.id)){We=E[kt];break}}W(Ne,w==="trash"),We&&(o(We.data.id),V([We.data.id]));return}if((Z.ctrlKey||Z.metaKey)&&Z.key==="."){Z.preventDefault(),Z.stopPropagation(),Z.shiftKey?Ot("canceled"):Ot("completed");return}if(Z.key==="Enter"&&(Z.preventDefault(),Z.stopPropagation(),pe?(Ie(""),mt("verify"),Z.metaKey||Z.ctrlKey?ie(()=>()=>n()):ie(()=>()=>d(z.id)),ut(!0)):Z.metaKey||Z.ctrlKey?n():d(z.id)),Z.key===" "&&(w==="inbox"||w==="today"||w==="schedule"||w==="waiting"||w==="focus")){Z.preventDefault(),Z.stopPropagation();const Ne=E.findIndex(Xt=>Xt.data.id===z.id),Pe=Xt=>Xt.view_orders&&Xt.view_orders[w]!==void 0?Xt.view_orders[w]:w==="today"?9e8+new Date(Xt.created_at).getTime()/1e3:Xt.order_index||0,We=Pe(z),kt=w==="today"?null:z.parent_id;let Vt=null;for(let Xt=Ne+1;Xt<E.length;Xt++){const Jt=E[Xt];if(w==="today"){Vt=Pe(Jt.data);break}else{if(Jt.depth<=t.depth&&Jt.data.parent_id!==kt)break;if(Jt.data.parent_id===kt){Vt=Pe(Jt.data);break}}}let Ft=We+1e4;Vt!==null&&(Ft=(We+Vt)/2);const nn={title:"",status:w==="waiting"?"someday":"inbox",parent_id:kt,order_index:Ft,view_orders:{[w]:Ft}};if(w==="today"){const Xt=we(z);nn.start_date=Xt,nn.status="active",nn.is_all_day=!0}else if(w==="waiting"){const Xt=b.find(Jt=>Jt.name.toLowerCase()==="someday");Xt&&(nn.tags=[Xt.id])}f(nn,[],void 0).then(Xt=>{Xt&&(L(Xt),V([]))})}if(Z.ctrlKey){if(Z.key==="t"&&(Z.preventDefault(),Z.stopPropagation(),i(z.id,{start_date:new Date().toISOString(),is_all_day:!0})),Z.key==="]"){Z.preventDefault(),Z.stopPropagation();const Ne=z.start_date?new Date(z.start_date):new Date;Ne.setDate(Ne.getDate()+1),i(z.id,{start_date:Ne.toISOString(),is_all_day:!0})}if(Z.key==="["){Z.preventDefault(),Z.stopPropagation();const Ne=z.start_date?new Date(z.start_date):new Date;Ne.setDate(Ne.getDate()-1),i(z.id,{start_date:Ne.toISOString(),is_all_day:!0})}}Z.altKey&&(Z.metaKey||Z.ctrlKey)&&Z.key==="r"&&(Z.preventDefault(),Z.stopPropagation(),I(z.id)),!Z.altKey&&!Z.ctrlKey&&!Z.metaKey&&Z.key!==" "&&(Z.key==="ArrowRight"&&(Z.preventDefault(),Q&&!me&&h(z.id,!0)),Z.key==="ArrowLeft"&&(Z.preventDefault(),me?h(z.id,!1):z.parent_id&&o(z.parent_id)))},Me=w==="focus",yt=w!=="focus"&&(g.draggedId===z.id||g.isDragging&&ee),jt=`group relative ${Me?"mb-0":"mb-1 md:mb-0.5"} rounded-lg outline-none select-none cursor-default ${Me?"py-0.5":"py-2 md:py-1.5"} ${ee?"bg-theme-selection":""} ${!ee&&!yt&&(e&&!ee&&!yt?"bg-theme-hover":"")} ${ke&&w!=="logbook"&&w!=="trash"?"bg-emerald-50/30":ke?"opacity-60 grayscale":""} ${yt?"opacity-40 scale-[0.98] blur-[0.5px] transition-all duration-200":"opacity-100 scale-100 transition-all duration-200"} transition-all duration-200 ease-in-out hover-effect active:bg-theme-hover touch-manipulation`,ne=()=>{const Z=[];if(z.repeat_rule&&Z.push(c.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-50 text-purple-600 flex items-center gap-0.5",title:z.repeat_rule.originalText||"",children:c.jsx(VI,{size:10})},"repeat")),z.start_date){const Ne=Iv(z.start_date),Pe=r1(z.start_date)&&!ke;let We="bg-theme-hover text-theme-secondary";Ne?We="bg-yellow-50 text-yellow-600 font-medium":Pe&&(We="bg-red-50 text-red-600 font-medium"),Z.push(c.jsxs("span",{className:`text-[10px] px-1.5 py-0.5 rounded border border-transparent ${We} flex items-center gap-1`,children:[c.jsx(vo,{size:10})," ",SI(z.start_date,!z.is_all_day,H)]},"date"))}return Z.length===0?null:c.jsx(c.Fragment,{children:Z})},Te=Me||A.fontWeight==="thin"?"font-extralight":"font-semibold",Ce={small:"text-sm",normal:"text-base",large:"text-lg"}[A.fontSize]||"text-base",q=(()=>{if(w!=="focus"&&w!=="today"||!z.parent_id)return null;const Z=[];let Ne=y.find(kt=>kt.id===z.parent_id),Pe="blue";const We=new Set;for(;Ne&&!We.has(Ne.id);)We.add(Ne.id),Z.unshift({title:Ne.title||"Untitled"}),Ne.parent_id||(Pe=Ne.color||"blue"),Ne=y.find(kt=>kt.id===Ne.parent_id);return Z.length===0?null:{items:Z,rootColor:Pe}})(),De=Me?"text-[10px]":Ce,st=Me?12:14,Y=Me?12:16,Fe=Me?"text-[8px]":"text-[10px]",Ue=x.useCallback(Z=>{if(!He)return;const Ne=Z.touches[0];$e.current={x:Ne.clientX,y:Ne.clientY,time:Date.now()},Be.current=setTimeout(()=>{Se(!0),navigator.vibrate&&navigator.vibrate(50)},500)},[He]),ze=x.useCallback(Z=>{if(!$e.current)return;const Ne=Z.touches[0],Pe=Math.abs(Ne.clientX-$e.current.x),We=Math.abs(Ne.clientY-$e.current.y);(Pe>10||We>10)&&Be.current&&(clearTimeout(Be.current),Be.current=null)},[]),Qe=x.useCallback(()=>{Be.current&&(clearTimeout(Be.current),Be.current=null),Se(!1),$e.current=null},[]);return c.jsxs(Pr.div,{layout:!0,transition:{layout:{duration:.2,ease:"easeInOut"}},ref:le,"data-task-id":z.id,"data-task-index":t.index,draggable:!He&&w!=="schedule"&&w!=="focus"&&!ot&&!(w==="allview"&&z.status==="logged"),onDragStart:Z=>{if(w==="focus"||ot||w==="allview"&&z.status==="logged"){Z.preventDefault();return}p(Z,t)},className:`${jt} ${se?"scale-[1.02] shadow-lg z-50":""}`,style:{marginLeft:`${w==="today"?0:t.depth*bp}px`,backgroundColor:s||"transparent"},tabIndex:0,onKeyDown:it,onClick:Z=>{Z.stopPropagation(),Z.preventDefault(),He?a||(pe?(Ie(""),mt("verify"),ie(()=>()=>setTimeout(()=>l(z.id),50)),ut(!0)):setTimeout(()=>l(z.id),50)):(r||N)(Z,z.id)},onDoubleClick:Z=>{Z.stopPropagation(),He||(pe?(Ie(""),mt("verify"),ie(()=>()=>n()),ut(!0)):n())},onTouchStart:Ue,onTouchMove:ze,onTouchEnd:Qe,children:[c.jsx("div",{className:`flex flex-col ${Me?"px-1":"px-3"}`,children:c.jsxs("div",{className:"flex items-center gap-3",children:[w==="recent"&&c.jsx("span",{className:"text-[10px] text-gray-300 font-light w-14 flex-shrink-0 tabular-nums",children:z.updated_at?new Date(z.updated_at).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"}):""}),w==="trash"?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-[18px] flex justify-center",children:c.jsx(Er,{size:14,className:"text-gray-300"})}),c.jsx("span",{className:"flex-1 text-gray-400 line-through truncate select-text",children:z.title}),c.jsx("button",{onClick:Z=>{Z.stopPropagation();const Ne=_.includes(z.id)?_:[z.id];R(Ne.map(Pe=>({id:Pe,data:{status:"inbox"}}))),ae({msg:" Inbox",type:"info"})},className:"px-2 py-1 bg-white border border-gray-200 text-indigo-600 text-[10px] font-medium rounded hover:bg-indigo-50 hover:border-indigo-200 transition-colors shadow-sm whitespace-nowrap",children:j("putBack")})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex items-center gap-1",children:[Q&&w!=="today"?c.jsx("button",{onClick:Z=>{Z.stopPropagation(),h(z.id)},className:"text-slate-400 hover:text-slate-800 transition-transform",children:me?c.jsx(ts,{size:st}):c.jsx(rs,{size:st})}):c.jsx("div",{className:`${Me?"w-[12px]":"w-[16px]"}`}),c.jsx(ID,{checked:X,isCanceled:he,onChange:Z=>{Z.stopPropagation(),Z.altKey?Ot("canceled"):Ot()},color:Nt(z),isRoot:!z.parent_id,size:Me?14:18})]}),c.jsxs("div",{className:"flex-1 min-w-0 cursor-text flex items-center overflow-hidden relative min-h-[1.5em]",children:[pe&&c.jsx(La,{size:12,className:"text-amber-500 mr-1.5 flex-shrink-0"}),$===z.id&&c.jsx("div",{className:"mr-2 flex-shrink-0 w-2 h-2 rounded-full bg-red-500 animate-pulse shadow-[0_0_6px_rgba(239,68,68,0.6)]",title:"Recording..."}),c.jsx("span",{className:`${De} ${Te} transition-all duration-300 ${ke?"opacity-30":"text-theme-primary"} ${he?"line-through decoration-gray-400":""} mr-2 truncate block flex-shrink ${u===z.id?"opacity-0":""} ${Re?"blur-[4px] select-none":""}`,children:z.title}),u===z.id&&c.jsx("div",{className:"absolute inset-0 bg-white dark:bg-gray-800 z-50 flex items-center pr-2",children:c.jsx($ee,{initialTitle:z.title,className:`${De} ${Te}`,fontClass:"",onSave:Z=>{Z!==z.title&&i(z.id,{title:Z}),d(null),le.current&&le.current.focus()},onCancel:()=>{d(null),le.current&&le.current.focus()},onSwitchToFull:async Z=>{await i(z.id,{title:Z}),d(null),n()}})}),q&&c.jsx("div",{className:"flex items-center gap-0.5 mr-2 flex-shrink-0",children:q.items.map((Z,Ne)=>{var Pe,We;return c.jsxs(Ln.Fragment,{children:[Ne>0&&c.jsx(rs,{size:10,className:"text-gray-300 flex-shrink-0",strokeWidth:1.5}),c.jsx("span",{className:`${Me?"text-[8px]":"text-[9px]"} font-semibold px-1.5 py-[1px] rounded transition-colors duration-200 truncate max-w-[150px]`,style:{backgroundColor:(((Pe=Jn[q.rootColor])==null?void 0:Pe.color)||"#6366f1")+"15",color:((We=Jn[q.rootColor])==null?void 0:We.color)||"#6366f1"},title:Z.title,children:Z.title})]},Ne)})}),(z.tags||[]).length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"hidden md:flex items-center gap-1 mr-2 flex-shrink-0",children:(z.tags||[]).map(Z=>{var We;const Ne=(We=b.find(kt=>kt.id===Z))==null?void 0:We.name;if(!Ne)return null;const Pe=Ne.startsWith("#");return c.jsx("div",{className:"relative flex-shrink-0",children:c.jsx("span",{className:`${Fe} border rounded-md px-1.5 py-px whitespace-nowrap ${Pe?"bg-emerald-50 text-emerald-700 border-emerald-200":`border-theme ${X?"text-theme-tertiary bg-theme-hover":"text-theme-secondary bg-theme-hover"}`}`,children:Ne})},Z)})}),c.jsxs("div",{className:"md:hidden flex items-center mr-2 text-slate-400 flex-shrink-0",children:[c.jsx(Bl,{size:Y}),(z.tags||[]).length>1&&c.jsx("span",{className:`${Me?"text-[8px]":"text-[9px]"} ml-0.5`,children:(z.tags||[]).length})]})]}),z.description&&c.jsx(eh,{size:12,className:"text-slate-400 mr-2 flex-shrink-0"}),z.attachments&&z.attachments.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"mr-2 flex-shrink-0 cursor-pointer",onMouseEnter:Z=>{const Ne=Z.currentTarget.getBoundingClientRect();Ee({visible:!0,x:Ne.left+Ne.width/2,y:Ne.top-8,attachments:z.attachments||[]})},onMouseLeave:()=>Ee(null),children:c.jsx(ho,{size:12,className:"text-slate-400"})}),(ce==null?void 0:ce.visible)&&ce.attachments===z.attachments&&ir.createPortal(c.jsx("div",{className:"fixed z-[99999] pointer-events-none",style:{left:ce.x,top:ce.y,transform:"translate(-50%, -100%)"},children:c.jsxs("div",{className:"bg-gray-800 text-white text-[10px] px-2.5 py-2 rounded-lg shadow-2xl max-w-[220px]",children:[c.jsxs("div",{className:"font-semibold mb-1 text-[11px]",children:[z.attachments.length," "]}),z.attachments.slice(0,5).map((Z,Ne)=>c.jsx("div",{className:"truncate opacity-80 py-0.5",children:Z.name},Ne)),z.attachments.length>5&&c.jsxs("div",{className:"opacity-60 pt-1",children:["... ",z.attachments.length-5," "]})]})}),document.body)]}),c.jsxs("div",{className:`ml-auto ${ke?"opacity-50":"opacity-100"} flex-shrink-0`,children:[" ",ne()," "]})]}),c.jsxs("div",{className:"opacity-100 md:opacity-0 md:group-hover:opacity-100 flex items-center gap-1 pl-2",children:[c.jsx("button",{onClick:Z=>{Z.stopPropagation(),Ie(""),mt(pe?"unlock":"lock"),ut(!0)},className:`p-1 transition-colors ${pe?"text-amber-500 hover:text-amber-600":"text-slate-300 hover:text-amber-500"}`,title:pe?"":"",children:pe?c.jsx(c1,{size:Y}):c.jsx(La,{size:Y})}),c.jsx("button",{onClick:Z=>{Z.stopPropagation();const Ne=_.includes(z.id)?_:[z.id];W(Ne,w==="trash")},className:"p-1 hover:text-red-500 text-slate-300 transition-colors",children:c.jsx(Er,{size:Y})})]})]})]})}),tt&&ir.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999]",onClick:()=>{ut(!1),ie(null)},children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-80 max-w-[90vw]",onClick:Z=>Z.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[Ge==="lock"?c.jsx(La,{size:20,className:"text-amber-500"}):c.jsx(c1,{size:20,className:"text-emerald-500"}),c.jsx("h3",{className:"text-lg font-bold",children:Ge==="lock"?"":Ge==="verify"?"":""})]}),c.jsx("p",{className:"text-sm text-gray-500 mb-4",children:Ge==="lock"?"":Ge==="verify"?"":""}),c.jsx("input",{type:"password",placeholder:"",value:ht,onChange:Z=>Ie(Z.target.value),onKeyDown:Z=>{Z.key==="Enter"&&(Ge==="lock"?ht.length>=1&&(k(z.id,ht),ut(!1)):Ge==="verify"?S(z.id,ht)?(T(z.id),ut(!1),ge&&ge(),ie(null)):ae({msg:"",type:"error"}):D(z.id,ht).then(Ne=>{Ne&&ut(!1)})),Z.key==="Escape"&&(ut(!1),ie(null))},autoFocus:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-amber-500"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:()=>{ut(!1),ie(null)},className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:""}),c.jsx("button",{onClick:()=>{Ge==="lock"?ht.length>=1&&(k(z.id,ht),ut(!1)):Ge==="verify"?S(z.id,ht)?(T(z.id),ut(!1),ge&&ge(),ie(null)):ae({msg:"",type:"error"}):D(z.id,ht).then(Z=>{Z&&ut(!1)})},className:`flex-1 px-4 py-2 rounded-lg transition-colors ${Ge==="lock"?"bg-amber-500 text-white hover:bg-amber-600":"bg-emerald-500 text-white hover:bg-emerald-600"}`,children:Ge==="lock"?"":Ge==="verify"?"":""})]})]})}),document.body)]})},zee=({show:t,top:e,left:n,width:r,color:s})=>{if(!t)return null;const i=Jn[s]||Jn.blue;return c.jsx("div",{className:"absolute pointer-events-none z-10 transition-all duration-100 ease-out",style:{top:`${e}px`,left:`${n}px`,width:`${r}px`},children:c.jsx("div",{className:`h-0.5 ${i.indicator} rounded-full shadow-sm relative`,children:c.jsx("div",{className:`absolute -left-1.5 -top-[3px] w-2 h-2 ${i.indicator} rounded-full shadow-md`})})})},Fee={red:"#ef4444",orange:"#f97316",yellow:"#eab308",green:"#22c55e",blue:"#3b82f6",purple:"#a855f7",pink:"#ec4899",gray:"#9ca3af"},Bee=({containerRef:t,tasks:e})=>{const[n,r]=x.useState([]),s=x.useRef(null),i=x.useRef(null),o=x.useCallback(()=>{if(!t.current)return;const a=t.current.getBoundingClientRect(),l=t.current.querySelectorAll("[data-task-id]"),u=new Map;l.forEach(g=>{const v=g.getAttribute("data-task-id");if(v){const w=g.getBoundingClientRect();u.set(v,{top:w.top-a.top,height:w.height})}});const d=new Map(e.map(g=>[g.data.id,g.data])),f=new Set(e.map(g=>g.data.id)),h=g=>{let v=g,w=0;const C=new Set,I=[];for(;w<50&&!C.has(v);){C.add(v);const D=d.get(v);if(!D)break;if(I.push(v),!D.parent_id||!f.has(D.parent_id))return{rootId:v,color:D.color||"gray",depth:I.length-1};v=D.parent_id,w++}const k=d.get(g);return{rootId:g,color:(k==null?void 0:k.color)||"gray",depth:0}},p=new Map;e.forEach(g=>{const v=u.get(g.data.id);if(!v)return;const w=h(g.data.id);if(!p.has(w.rootId)){const I=u.get(w.rootId);p.set(w.rootId,{rootId:w.rootId,color:Fee[w.color]||w.color,rootTop:(I==null?void 0:I.top)||v.top,rootHeight:(I==null?void 0:I.height)||v.height,minTop:v.top,maxBottom:v.top+v.height,tasks:[],offsetX:0})}const C=p.get(w.rootId);C.minTop=Math.min(C.minTop,v.top),C.maxBottom=Math.max(C.maxBottom,v.top+v.height),w.depth>0&&C.tasks.push({taskId:g.data.id,rootId:w.rootId,rootColor:C.color,depth:w.depth,top:v.top,height:v.height})});const m=Array.from(p.values()).filter(g=>g.tasks.length>0);m.sort((g,v)=>g.rootTop-v.rootTop);const y=8,b=8;m.forEach((g,v)=>{g.offsetX=y+v*b}),r(m)},[t,e]);return x.useEffect(()=>{o();const a=t.current;a&&a.addEventListener("scroll",o),i.current=new ResizeObserver(o),a&&i.current.observe(a),window.addEventListener("resize",o);const l=setInterval(o,100);return()=>{a&&a.removeEventListener("scroll",o),i.current&&i.current.disconnect(),window.removeEventListener("resize",o),clearInterval(l)}},[o]),x.useEffect(()=>{const a=setTimeout(o,50);return()=>clearTimeout(a)},[e,o]),n.length===0?null:c.jsxs("svg",{ref:s,className:"absolute top-0 left-0 w-full h-full pointer-events-none z-10",style:{overflow:"visible"},children:[c.jsx("defs",{children:c.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[c.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),c.jsxs("feMerge",{children:[c.jsx("feMergeNode",{in:"coloredBlur"}),c.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),n.map((a,l)=>{const u=a.offsetX,d=a.rootTop+a.rootHeight/2,f=a.maxBottom-6;return c.jsxs("g",{children:[c.jsx("path",{d:`M ${u} ${d} L ${u} ${f}`,fill:"none",stroke:a.color,strokeWidth:"2",strokeOpacity:"0.3",strokeLinecap:"round"}),c.jsx("circle",{cx:u,cy:d,r:"4",fill:a.color,opacity:"0.9",filter:"url(#glow)"}),a.tasks.map((h,p)=>c.jsx("rect",{x:u-1.5,y:h.top+8,width:3,height:h.height-16,rx:1.5,ry:1.5,fill:h.rootColor,opacity:.6-(h.depth-1)*.1},`bar-${p}`))]},`group-${l}`)})]})},hE={"zh-TW":["","","","","","",""],en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},pE={"zh-TW":["1","2","3","4","5","6","7","8","9","10","11","12"],en:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},Uee=({date:t,isToday:e,isTomorrow:n,taskCount:r,language:s="zh-TW"})=>{var p,m;const i=new Date(t+"T12:00:00"),o=i.getDate(),a=((p=pE[s])==null?void 0:p[i.getMonth()])||pE.en[i.getMonth()],l=((m=hE[s])==null?void 0:m[i.getDay()])||hE.en[i.getDay()],u=i.getDay()===0||i.getDay()===6;let d="",f="";e?(d=s==="zh-TW"?"":"Today",f=`${a}${o}`):n?(d=s==="zh-TW"?"":"Tomorrow",f=`${a}${o}`):(d=`${a}${o}`,f=l);const h=()=>e?"text-blue-600":n?"text-orange-500":u?"text-purple-500":"text-gray-500";return c.jsxs("div",{className:"flex items-center gap-3 pt-6 pb-2 px-1 select-none","data-date-separator":t,children:[c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsx("span",{className:`text-[13px] font-semibold ${h()}`,children:d}),f&&c.jsx("span",{className:"text-[11px] text-gray-400 font-normal",children:f})]}),c.jsx("div",{className:"flex-1 h-[1px] bg-gray-200"}),r>0&&c.jsx("span",{className:"text-[10px] text-gray-400 tabular-nums",children:r})]})},Hee=(t,e)=>{const n=[];for(let r=0;r<e;r++){const s=new Date(t);s.setDate(s.getDate()+r);const i=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),a=String(s.getDate()).padStart(2,"0");n.push(`${i}-${o}-${a}`)}return n},Vee=t=>{const e=new Date,n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=`${n}-${r}-${s}`;return t===i},Wee=t=>{const e=new Date;e.setDate(e.getDate()+1);const n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=`${n}-${r}-${s}`;return t===i},jR=({rootParentId:t})=>{const{visibleTasks:e,focusedTaskId:n,setFocusedTaskId:r,editingTaskId:s,setEditingTaskId:i,expandedTaskIds:o,endDrag:a,dragState:l,updateDropState:u,updateGhostPosition:d,selectedTaskIds:f,setSelectedTaskIds:h,handleSelection:p,selectionAnchor:m,tasks:y,tags:b,pendingFocusTaskId:g,setPendingFocusTaskId:v,view:w,addTask:C,reviewTask:I,emptyTrash:k,restoreTrash:D,t:S,archivedTasks:T,restoreArchivedTask:_,deleteArchivedTask:N,updateArchivedTask:A,batchDeleteArchivedTasks:O,batchDeleteTasks:L,batchUpdateTasks:V,duplicateTasks:E,leavingTaskIds:j,dismissLeavingTasks:H,themeSettings:W}=x.useContext(En),R=x.useRef(null),ae=x.useRef(null),re=x.useRef(null),[$,z]=x.useState(new Date);x.useEffect(()=>{const fe=()=>{const _e=new Date;_e.getDate()!==$.getDate()&&z(_e)},ye=setInterval(fe,6e4);return window.addEventListener("focus",fe),()=>{clearInterval(ye),window.removeEventListener("focus",fe)}},[$]);const le=x.useRef(null),[$e,Be]=x.useState("none"),se=x.useMemo(()=>{if(!t)return e;const fe=lt=>{const nt=w==="allview"||w==="project"?"all":w;return lt.view_orders&&lt.view_orders[nt]!==void 0?lt.view_orders[nt]:lt.order_index||0},ye=y.filter(lt=>lt.parent_id===t&&lt.status!=="deleted"&&lt.status!=="logged").sort((lt,nt)=>fe(lt)-fe(nt)||(lt.created_at||"").localeCompare(nt.created_at||""));let _e=0;const ft=(lt,nt=0,Et=[])=>{let jt=[];return lt.forEach(ne=>{const Te=y.filter(De=>De.parent_id===ne.id&&De.status!=="logged"&&De.status!=="deleted").sort((De,st)=>fe(De)-fe(st)||(De.created_at||"").localeCompare(st.created_at||"")),Ce=Te.length>0,rt=o.includes(ne.id),q=[...Et,ne.id];jt.push({data:ne,depth:nt,hasChildren:Ce,isExpanded:rt,path:q,index:_e++}),Ce&&rt&&(jt=[...jt,...ft(Te,nt+1,q)])}),jt};return ft(ye)},[e,t,y,o,w]);let Se=t?se:e;const ce=x.useMemo(()=>{if($e==="none"||Se.length===0)return null;let fe=Date.now(),ye=0;return Se.forEach(_e=>{const ft=_e.data.updated_at?new Date(_e.data.updated_at).getTime():0;ft>0&&(ft<fe&&(fe=ft),ft>ye&&(ye=ft))}),ye===fe&&(ye=fe+1),{minTime:fe,maxTime:ye}},[$e,Se]),Ee=fe=>{if(!ce||$e==="none")return;const ye=fe.updated_at?new Date(fe.updated_at).getTime():0;if(ye===0)return;const _e=(ye-ce.minTime)/(ce.maxTime-ce.minTime),ft=Math.max(0,Math.min(1,_e));return $e==="recent"?`rgba(255, 0, 0, ${.02+ft*.18})`:`rgba(250, 204, 21, ${.02+ft*.18})`},He=x.useRef(null),tt=x.useCallback((fe,ye)=>{r(ye);const _e=fe.shiftKey||fe.shiftKey,ft=fe.ctrlKey||fe.metaKey;if(_e){const lt=He.current||n||ye;He.current=lt;const nt=Se.findIndex(jt=>jt.data.id===lt),Et=Se.findIndex(jt=>jt.data.id===ye);if(nt!==-1&&Et!==-1){const[jt,ne]=nt<Et?[nt,Et]:[Et,nt],Te=Se.slice(jt,ne+1).map(Ce=>Ce.data.id);h(Te)}}else ft?(He.current=ye,h(lt=>lt.includes(ye)?lt.filter(nt=>nt!==ye):[...lt,ye])):(He.current=ye,h([ye]))},[Se,n,r,h]),ut=w==="upcoming"?tt:p;x.useEffect(()=>{const fe=ye=>{var lt;if(s)return;const _e=document.activeElement;if((_e==null?void 0:_e.tagName)==="INPUT"||(_e==null?void 0:_e.tagName)==="TEXTAREA"||_e!=null&&_e.isContentEditable||_e!=null&&_e.closest("[data-tag-id]")||document.querySelector("[data-search-modal]"))return;if((ye.metaKey||ye.ctrlKey)&&(ye.key==="a"||ye.key==="A")){ye.preventDefault();const nt=Se.map(Et=>Et.data.id);h(nt);return}if((ye.metaKey||ye.ctrlKey)&&(ye.key==="t"||ye.key==="T")){ye.preventDefault();const nt=f.length>0?f:n?[n]:[];if(nt.length>0){const Et=new Date().toISOString().split("T")[0];V(nt.map(jt=>({id:jt,data:{start_date:Et,status:"active"}})))}return}if((ye.metaKey||ye.ctrlKey)&&(ye.key==="d"||ye.key==="D")){ye.preventDefault();const nt=f.length>0?f:n?[n]:[];nt.length>0&&E(nt);return}const ft=Se.findIndex(nt=>nt.data.id===n);if(ye.metaKey||ye.ctrlKey){if(ye.key==="ArrowUp"){if(ye.preventDefault(),Se.length>0){const nt=Se[0];r(nt.data.id),ut({shiftKey:!1,ctrlKey:!1},nt.data.id)}return}if(ye.key==="ArrowDown"){if(ye.preventDefault(),Se.length>0){const nt=Se[Se.length-1];r(nt.data.id),ut({shiftKey:!1,ctrlKey:!1},nt.data.id)}return}}if(ye.shiftKey&&(ye.key==="ArrowDown"||ye.key==="ArrowUp")){ye.preventDefault();let nt=ft;ye.key==="ArrowDown"&&(nt=Math.min(ft+1,Se.length-1)),ye.key==="ArrowUp"&&(nt=Math.max(ft-1,0));const Et=Se[nt];Et&&(r(Et.data.id),ut({shiftKey:!0,preventDefault:()=>{}},Et.data.id));return}if(ye.key==="ArrowDown"&&!ye.altKey){ye.preventDefault();const nt=ft+1;if(nt<Se.length){const Et=Se[nt];r(Et.data.id),ut({shiftKey:!1,ctrlKey:!1},Et.data.id)}}else if(ye.key==="ArrowUp"&&!ye.altKey){ye.preventDefault();const nt=ft-1;if(nt>=0){const Et=Se[nt];r(Et.data.id),ut({shiftKey:!1,ctrlKey:!1},Et.data.id)}}else if(ye.key==="Enter")ft!==-1&&!s&&!ye.altKey&&w!=="trash"&&(ye.preventDefault(),i(Se[ft].data.id));else if(ye.key===" "&&!s&&w!=="trash")if(ye.preventDefault(),ft!==-1){le.current=n;const nt=Se[ft],Et=nt.data.parent_id,jt=De=>De.view_orders&&De.view_orders[w]!==void 0?De.view_orders[w]:w==="today"?9e8+new Date(De.created_at).getTime()/1e3:De.order_index||0,ne=jt(nt.data);let Te=null;for(let De=ft+1;De<Se.length;De++){const st=Se[De];if(st.depth<=nt.depth&&st.data.parent_id!==Et)break;if(st.data.parent_id===Et){Te=jt(st.data);break}}let Ce;Te!==null?Ce=(ne+Te)/2:Ce=ne+1e4;const rt=b.find(De=>De.name.toLowerCase()==="prompt"),q={title:"",parent_id:Et,status:nt.data.status,tags:w==="prompt"&&rt?[rt.id]:nt.data.tags,color:nt.data.color,start_date:nt.data.start_date,order_index:Ce,view_orders:{[w]:Ce}};C(q).then(De=>{v(De),h([])})}else{const nt=new Date().toISOString().split("T")[0],Et=b.find(De=>De.name.toLowerCase()==="prompt"),jt=b.find(De=>De.name.toLowerCase()==="note"),ne=b.find(De=>De.name.toLowerCase()==="journal"),Te=b.find(De=>De.name.includes("")),Ce=De=>De.view_orders&&De.view_orders[w]!==void 0?De.view_orders[w]:w==="today"?9e8+new Date(De.created_at).getTime()/1e3:De.order_index||0;let rt=1e4;if(Se.length>0){const De=Se.filter(st=>!st.data.parent_id);if(De.length>0){const st=De[De.length-1];rt=Ce(st.data)+1e4}else{const st=Se[Se.length-1];rt=Ce(st.data)+1e4}}const q={title:"",parent_id:null,status:"inbox",tags:[],order_index:rt,view_orders:{[w]:rt}};if(w==="today")q.start_date=nt,q.status="active";else if(w==="prompt")q.status="active",Et&&(q.tags=[Et.id]);else if(w==="journal")q.status="active",jt?q.tags=[jt.id]:ne&&(q.tags=[ne.id]);else if(w==="waiting")q.status="waiting",Te&&(q.tags=[Te.id]);else if(w==="focus")q.status="active";else if(w==="upcoming"){const De=new Date;De.setDate(De.getDate()+1),q.start_date=De.toISOString().split("T")[0],q.status="active"}C(q).then(De=>{v(De),h([])})}else if((ye.key==="Delete"||ye.key==="Backspace")&&!s){if(["INPUT","TEXTAREA"].includes(((lt=document.activeElement)==null?void 0:lt.tagName)||""))return;const nt=f.length>0?f:n?[n]:[];nt.length>0&&(ye.preventDefault(),L(nt,w==="trash"),n&&nt.includes(n))}};return window.addEventListener("keydown",fe),()=>window.removeEventListener("keydown",fe)},[Se,n,o,s,m,C,i,r,ut,w,b,f,L,V,E]);const Ge=!1,mt=fe=>{var Ne;if(w==="focus"||w==="upcoming"||w==="recent"||(fe.preventDefault(),!l.isDragging||!R.current))return;if(d(fe.clientX,fe.clientY),re.current){u({dropIndex:null,indicatorTop:0});return}const ye=R.current.getBoundingClientRect(),_e=fe.clientX,ft=fe.clientY,lt=_e-ye.left,nt=100,Et=10,jt=window.innerHeight,ne=document.querySelector("main");ne&&(ft<nt?ae.current||(ae.current=setInterval(()=>{ne.scrollTop-=Et},16)):ft>jt-nt?ae.current||(ae.current=setInterval(()=>{ne.scrollTop+=Et},16)):ae.current&&(clearInterval(ae.current),ae.current=null));let Te=-1,Ce=null,rt=document.elementFromPoint(_e,ft);for(;rt&&rt!==R.current&&rt!==document.body;){if(rt.hasAttribute("data-task-index")){Te=parseInt(rt.getAttribute("data-task-index")||"-1"),Ce=rt.getBoundingClientRect();break}rt=rt.parentElement}if(Te===-1&&Se.length>0&&R.current){const Pe=R.current.querySelector("[data-task-index]:last-child");if(Pe){const We=Pe.getBoundingClientRect();ft>We.bottom&&(Te=parseInt(Pe.getAttribute("data-task-index")||"-1")+1,Ce=We)}}if(Te===-1){const Pe=(Ne=R.current)==null?void 0:Ne.querySelector("[data-task-index]:first-child");if(Pe){const We=Pe.getBoundingClientRect();ft<We.top&&(Te=0,Ce=We)}if(Te===-1)return}let q=Te,De=Te;if(Ce){const Pe=Ce.top+Ce.height/2;ft>Pe&&Te<Se.length&&(q=Te+1)}const st=lt-l.dragOffsetX+l.originalDepth*bp;let Y=Math.floor(st/bp);Y<0&&(Y=0);const Fe=Se[q-1],Ue=Fe?Fe.depth+1:0;Y>Ue&&(Y=Ue);let ze=0;Ce?q===Te?ze=Ce.top-ye.top:ze=Ce.bottom-ye.top:q===0&&(ze=0);let Qe=Y*bp+40,Z=ye.width-Qe-20;w==="today"&&(Y=0,Qe=40,Z=ye.width-60),u({dropIndex:q,dropDepth:Y,indicatorTop:ze,indicatorLeft:Qe,indicatorWidth:Z,anchorTaskIndex:De})},ht=()=>{ae.current&&(clearInterval(ae.current),ae.current=null),a(Se)},Ie=fe=>{const ye=fe||le.current||n;i(null),ye&&(r(ye),h([ye]),setTimeout(()=>{var ft;const _e=(ft=R.current)==null?void 0:ft.querySelector(`[data-task-id="${ye}"]`);_e&&(_e.focus(),_e.scrollIntoView({block:"nearest",behavior:"smooth"}))},100)),le.current=null,g&&v(null)},ge=()=>{if(l.dropIndex===null||l.dropIndex===0)return"blue";const fe=Se[l.dropIndex-1];return(fe==null?void 0:fe.data.color)||"blue"},ie=Se,me=x.useMemo(()=>w!=="inbox"||j.length===0?[]:j.map(fe=>y.find(ye=>ye.id===fe)).filter(Boolean).map((fe,ye)=>({data:fe,depth:0,hasChildren:!1,isExpanded:!1,path:[fe.id],index:ye})),[w,j,y]),[Q,X]=x.useState(!0),he=Se,ke=x.useMemo(()=>{if(w!=="allview"&&w!=="logbook")return[];const fe=new Map(T.map(lt=>[lt.id,lt])),ye=T.filter(lt=>!lt.parent_id||!fe.has(lt.parent_id)).sort((lt,nt)=>new Date(nt.archived_at||nt.completed_at||0).getTime()-new Date(lt.archived_at||lt.completed_at||0).getTime()),_e=[],ft=(lt,nt,Et)=>{const jt=T.filter(ne=>ne.parent_id===lt.id);_e.push({data:lt,depth:nt,hasChildren:jt.length>0,isExpanded:!0,path:[...Et,lt.id],index:_e.length}),jt.forEach(ne=>ft(ne,nt+1,[...Et,lt.id]))};return ye.forEach(lt=>ft(lt,0,[])),_e},[T,w]),[ee,pe]=x.useState(null),[Re,_t]=x.useState(""),[Nt,ot]=x.useState([]),Ot=x.useRef(null),we=fe=>{if(!fe)return"";const ye=new Date(fe);return`${ye.getFullYear()}-${String(ye.getMonth()+1).padStart(2,"0")}-${String(ye.getDate()).padStart(2,"0")}`},qe=fe=>{if(Re){const ye=new Date(Re);isNaN(ye.getTime())||A(fe,{completed_at:ye.toISOString()})}pe(null)},Ke=(fe,ye)=>{if(fe.stopPropagation(),fe.shiftKey&&Ot.current){const _e=ke.findIndex(lt=>lt.data.id===Ot.current),ft=ke.findIndex(lt=>lt.data.id===ye);if(_e!==-1&&ft!==-1){const[lt,nt]=_e<ft?[_e,ft]:[ft,_e],Et=ke.slice(lt,nt+1).map(jt=>jt.data.id);ot(Et)}}else fe.metaKey||fe.ctrlKey?(Ot.current=ye,ot(_e=>_e.includes(ye)?_e.filter(ft=>ft!==ye):[..._e,ye])):(Ot.current=ye,ot([ye]))};if(w==="logbook")return ke.length===0?c.jsxs("div",{className:"text-center py-20 opacity-20",children:[c.jsx(o1,{size:48,className:"mx-auto"}),c.jsx("p",{className:"text-xs mt-2",children:""})]}):c.jsxs("div",{className:"pb-20 relative min-h-[500px]",onClick:()=>ot([]),children:[c.jsxs("div",{className:"flex items-center gap-2 mb-6 px-2",children:[c.jsx(um,{size:16,className:"text-gray-400"}),c.jsx("span",{className:"text-[13px] font-bold text-gray-500",children:""}),c.jsx("span",{className:"text-[11px] font-medium px-1.5 py-0.5 rounded-full bg-gray-100 text-gray-500",children:ke.length}),c.jsx("div",{className:"flex-1 h-[2px] rounded-full bg-gradient-to-r from-gray-200 to-transparent"}),Nt.length>0&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:"text-[11px] text-indigo-600 font-medium",children:[" ",Nt.length," "]}),c.jsxs("button",{onClick:fe=>{fe.stopPropagation(),confirm(` ${Nt.length} `)&&(O(Nt),ot([]))},className:"px-2 py-1 bg-red-50 text-red-600 text-[10px] font-medium rounded hover:bg-red-100 transition-colors flex items-center gap-1",children:[c.jsx(Er,{size:12}),""]}),c.jsx("button",{onClick:fe=>{fe.stopPropagation(),ot([])},className:"px-2 py-1 bg-gray-100 text-gray-600 text-[10px] font-medium rounded hover:bg-gray-200 transition-colors",children:""})]})]}),ke.map(fe=>{const ye=Nt.includes(fe.data.id);return c.jsx("div",{className:`relative group mb-1 py-2 px-3 rounded-lg transition-colors cursor-pointer ${ye?"bg-indigo-50 border border-indigo-200":"hover:bg-theme-hover"}`,style:{marginLeft:`${fe.depth*24}px`},onClick:_e=>Ke(_e,fe.data.id),children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:`w-[18px] h-[18px] rounded-full border-2 flex items-center justify-center flex-shrink-0 ${ye?"border-indigo-500 bg-indigo-500":"border-emerald-500 bg-emerald-500"}`,children:c.jsx(Xn,{size:12,className:"text-white"})}),c.jsx("span",{className:"flex-1 text-theme-primary opacity-70 truncate",children:fe.data.title}),c.jsxs("div",{className:"flex items-center gap-1 text-[11px] text-gray-400",children:[c.jsx(vo,{size:12}),ee===fe.data.id?c.jsx("input",{type:"date",autoFocus:!0,value:Re,onChange:_e=>_t(_e.target.value),onBlur:()=>qe(fe.data.id),onKeyDown:_e=>{_e.key==="Enter"&&qe(fe.data.id),_e.key==="Escape"&&pe(null)},onClick:_e=>_e.stopPropagation(),className:"bg-white border border-gray-300 rounded px-1 py-0.5 text-[11px] w-28"}):c.jsx("span",{className:"cursor-pointer hover:text-indigo-500 transition-colors",onDoubleClick:_e=>{_e.stopPropagation(),pe(fe.data.id),_t(we(fe.data.completed_at))},title:"",children:we(fe.data.completed_at)||""})]}),c.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[c.jsx("button",{onClick:_e=>{_e.stopPropagation(),_(fe.data.id)},className:"px-2 py-1 bg-emerald-50 text-emerald-600 text-[10px] font-medium rounded hover:bg-emerald-100 transition-colors",children:""}),c.jsx("button",{onClick:_e=>{_e.stopPropagation(),confirm("")&&N(fe.data.id)},className:"p-1 text-gray-400 hover:text-red-500 transition-colors",title:"",children:c.jsx(Er,{size:14})})]})]})},fe.data.id)})]});if(Se.length===0&&(w!=="allview"||ke.length===0))return c.jsxs("div",{className:"text-center py-20 opacity-20",children:[c.jsx(o1,{size:48,className:"mx-auto"}),c.jsx("p",{className:"text-xs mt-2",children:"No tasks"})]});const it=fe=>fe.start_date?new Date(fe.start_date).toISOString().split("T")[0]:fe.due_date?new Date(fe.due_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],Me=()=>{const fe=Hee($,8),ye=new Map,_e=[],ft=[],lt=$.getFullYear(),nt=String($.getMonth()+1).padStart(2,"0"),Et=String($.getDate()).padStart(2,"0"),jt=`${lt}-${nt}-${Et}`;return Se.forEach(ne=>{const Te=it(ne.data);Te<jt?_e.push(ne):fe.includes(Te)?(ye.has(Te)||ye.set(Te,[]),ye.get(Te).push(ne)):ft.push(ne)}),c.jsxs(c.Fragment,{children:[_e.length>0&&c.jsxs("div",{"data-date-group":"overdue",children:[c.jsxs("div",{className:"flex items-center gap-3 pt-2 pb-2 px-1 select-none",children:[c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsx("span",{className:"text-[13px] font-semibold text-red-500",children:""}),c.jsxs("span",{className:"text-[11px] text-red-400 font-normal",children:[_e.length," "]})]}),c.jsx("div",{className:"flex-1 h-[1px] bg-red-200"})]}),_e.map(ne=>c.jsx(Ln.Fragment,{children:s===ne.data.id?c.jsx(Lo,{initialData:ne.data,onClose:Ie},ne.data.id):c.jsx("div",{className:"relative group",children:c.jsx(xl,{flatTask:ne,isFocused:n===ne.data.id,onEdit:()=>i(ne.data.id)},ne.data.id)})},ne.data.id))]}),fe.map(ne=>{const Te=ye.get(ne)||[];return c.jsxs("div",{"data-date-group":ne,children:[c.jsx(Uee,{date:ne,isToday:Vee(ne),isTomorrow:Wee(ne),taskCount:Te.length}),Te.length===0?c.jsx("div",{className:"h-12 mx-2 mb-2 border-2 border-dashed border-gray-200 rounded-lg flex items-center justify-center text-gray-300 text-xs transition-all hover:border-gray-300 hover:bg-gray-50","data-empty-drop-zone":ne,onDragEnter:Ce=>{Ce.preventDefault(),re.current=ne,Ce.currentTarget.classList.add("border-blue-400","bg-blue-50","text-blue-400")},onDragOver:Ce=>{Ce.preventDefault(),Ce.dataTransfer.dropEffect="move",re.current=ne,d(Ce.clientX,Ce.clientY)},onDragLeave:Ce=>{re.current=null,Ce.currentTarget.classList.remove("border-blue-400","bg-blue-50","text-blue-400")},onDrop:Ce=>{Ce.preventDefault(),Ce.stopPropagation(),Ce.currentTarget.classList.remove("border-blue-400","bg-blue-50","text-blue-400");const rt=re.current||ne;re.current=null;let q=[];try{const De=Ce.dataTransfer.getData("application/json");De&&(q=JSON.parse(De))}catch{}if(q.length===0){const De=Ce.dataTransfer.getData("text/plain");De&&(q=[De])}q.length===0&&l.draggedId&&(q=f.includes(l.draggedId)?f:[l.draggedId]),q.length>0&&V(q.map(De=>({id:De,data:{start_date:rt,is_all_day:!0}}))),a()},children:""}):Te.map(Ce=>c.jsx(Ln.Fragment,{children:s===Ce.data.id?c.jsx(Lo,{initialData:Ce.data,onClose:Ie},Ce.data.id):c.jsx("div",{className:"relative group",children:c.jsx(xl,{flatTask:Ce,isFocused:n===Ce.data.id,onEdit:()=>i(Ce.data.id)},Ce.data.id)})},Ce.data.id))]},ne)}),ft.length>0&&(()=>{const ne=new Map;return ft.forEach(Ce=>{const rt=it(Ce.data),q=new Date(rt+"T12:00:00"),De=`${q.getFullYear()}-${String(q.getMonth()+1).padStart(2,"0")}`;ne.has(De)||ne.set(De,[]),ne.get(De).push(Ce)}),Array.from(ne.keys()).sort().map(Ce=>{const[rt,q]=Ce.split("-"),De=["1","2","3","4","5","6","7","8","9","10","11","12"][parseInt(q)-1],st=ne.get(Ce),Y=new Date().getFullYear(),Fe=parseInt(rt)!==Y;return c.jsxs("div",{"data-date-group":Ce,children:[c.jsxs("div",{className:"flex items-center gap-3 pt-6 pb-2 px-1 select-none",children:[c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsx("span",{className:"text-[13px] font-semibold text-gray-400",children:De}),Fe&&c.jsx("span",{className:"text-[11px] text-gray-300 font-normal",children:rt})]}),c.jsx("div",{className:"flex-1 h-[1px] bg-gray-200"}),c.jsx("span",{className:"text-[10px] text-gray-400 tabular-nums",children:st.length})]}),st.map(Ue=>c.jsx(Ln.Fragment,{children:s===Ue.data.id?c.jsx(Lo,{initialData:Ue.data,onClose:Ie},Ue.data.id):c.jsx("div",{className:"relative group",children:c.jsx(xl,{flatTask:Ue,isFocused:n===Ue.data.id,onEdit:()=>i(Ue.data.id)},Ue.data.id)})},Ue.data.id))]},Ce)})})()]})},yt=fe=>fe.map(ye=>c.jsx(Ln.Fragment,{children:s===ye.data.id?c.jsx(Lo,{initialData:ye.data,onClose:Ie},ye.data.id):c.jsx("div",{className:"relative group",children:c.jsx(xl,{flatTask:ye,isFocused:n===ye.data.id,onEdit:()=>i(ye.data.id),backgroundColor:Ee(ye.data)},ye.data.id)})},ye.data.id));return c.jsx(c.Fragment,{children:c.jsxs("div",{ref:R,className:"pb-20 relative min-h-[500px]",onDragOver:mt,onDragLeave:fe=>{var ye;(ye=R.current)!=null&&ye.contains(fe.relatedTarget)||u({dropIndex:null})},onDrop:fe=>{fe.preventDefault(),ht()},onDragEnd:ht,children:[(w==="allview"||w==="project"||w==="inbox")&&c.jsx("div",{className:"flex justify-end px-4 py-2 border-b border-gray-100/50 mb-2 sticky top-0 bg-white/95 backdrop-blur z-20",children:c.jsxs("div",{className:"flex items-center gap-2 bg-gray-50/80 p-1 rounded-lg border border-gray-100",children:[c.jsx("span",{className:"text-[9px] text-gray-400 font-bold uppercase tracking-wider px-1",children:"Mark:"}),c.jsxs("div",{className:"flex gap-0.5",children:[c.jsx("button",{onClick:()=>Be("none"),className:`px-2 py-0.5 text-[10px] rounded transition-all ${$e==="none"?"bg-white shadow-sm text-gray-800 font-bold":"text-gray-400 hover:text-gray-600"}`,children:"Off"}),c.jsxs("button",{onClick:()=>Be("recent"),className:`px-2 py-0.5 text-[10px] rounded transition-all flex items-center gap-1 ${$e==="recent"?"bg-red-50 text-red-600 shadow-sm font-bold ring-1 ring-red-100":"text-gray-400 hover:text-red-500"}`,children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),"Recent"]}),c.jsxs("button",{onClick:()=>Be("frequent"),className:`px-2 py-0.5 text-[10px] rounded transition-all flex items-center gap-1 ${$e==="frequent"?"bg-amber-50 text-amber-600 shadow-sm font-bold ring-1 ring-amber-100":"text-gray-400 hover:text-amber-500"}`,children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-amber-500"}),"Frequent"]})]})]})}),w==="today"&&W.showRelationshipLines!==!1&&c.jsx(Bee,{containerRef:R,tasks:Se.map(fe=>({data:{id:fe.data.id,parent_id:fe.data.parent_id,color:fe.data.color}}))}),c.jsx(zee,{show:l.isDragging&&l.dropIndex!==null,top:l.indicatorTop,left:l.indicatorLeft,width:l.indicatorWidth,depth:l.dropDepth,color:ge()}),w==="trash"&&c.jsxs("div",{className:"flex items-center justify-between mb-6 px-4 py-3 bg-gray-50 rounded-lg border border-dashed border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Er,{className:"text-gray-400",size:18}),c.jsx("span",{className:"font-medium text-gray-500 text-sm",children:S("trashEmptyTitle")})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[Se.length>0&&c.jsxs("button",{onClick:()=>{confirm(S("restoreTrashConfirm")||"Are you sure?")&&D()},className:"px-3 py-1.5 bg-white border border-gray-200 text-indigo-500 text-xs font-medium rounded hover:bg-indigo-50 hover:border-indigo-200 transition-colors shadow-sm flex items-center gap-1",children:[c.jsx(Og,{size:12}),S("restoreTrash")||"Restore All"]}),Se.length>0&&c.jsx("button",{onClick:()=>{confirm(S("emptyTrashConfirm"))&&k()},className:"px-3 py-1.5 bg-white border border-gray-200 text-red-500 text-xs font-medium rounded hover:bg-red-50 hover:border-red-200 transition-colors shadow-sm",children:S("emptyTrash")})]})]}),w==="today"?Me():w==="upcoming"?Se.map((fe,ye)=>c.jsx(Ln.Fragment,{children:s===fe.data.id?c.jsx(Lo,{initialData:fe.data,onClose:Ie},fe.data.id):c.jsxs("div",{className:"relative group",children:[c.jsx("span",{className:"absolute -left-6 top-1/2 -translate-y-1/2 text-[9px] font-mono text-gray-300 select-none",children:ye+1}),c.jsx(xl,{flatTask:fe,isFocused:n===fe.data.id,onEdit:()=>i(fe.data.id),onSelect:tt},fe.data.id)]})},fe.data.id)):w==="allview"?c.jsxs(c.Fragment,{children:[yt(he),ke.length>0&&c.jsxs("div",{className:"mt-12",children:[c.jsxs("button",{onClick:()=>X(!Q),className:"flex items-center gap-2 mb-4 px-2 w-full text-left group",children:[Q?c.jsx(rs,{size:14,className:"text-gray-400"}):c.jsx(ts,{size:14,className:"text-gray-400"}),c.jsx(um,{size:14,className:"text-gray-400"}),c.jsx("span",{className:"text-[13px] font-bold text-gray-400",children:""}),c.jsx("span",{className:"text-[11px] font-medium px-1.5 py-0.5 rounded-full bg-gray-100 text-gray-500",children:ke.length}),c.jsx("div",{className:"flex-1 h-[2px] rounded-full bg-gradient-to-r from-gray-200 to-transparent"})]}),!Q&&c.jsx("div",{className:"opacity-60",children:ke.map(fe=>c.jsxs("div",{className:"relative group",style:{marginLeft:`${fe.depth*24}px`},children:[c.jsx(xl,{flatTask:fe,isFocused:!1,onEdit:()=>{}}),c.jsx("button",{onClick:ye=>{ye.stopPropagation(),_(fe.data.id)},className:"absolute right-2 top-2 z-10 opacity-0 group-hover:opacity-100 px-3 py-1 bg-emerald-600 text-white text-[10px] font-bold rounded-full shadow-lg hover:bg-emerald-700 transition-all flex items-center gap-1",children:""})]},fe.data.id))})]})]}):yt(ie),Ge,w==="inbox"&&me.length>0&&c.jsxs("div",{className:"mt-8 border-2 border-dashed border-amber-200 rounded-xl p-4 bg-amber-50/50",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Fz,{size:16,className:"text-amber-500"}),c.jsxs("span",{className:"text-[13px] font-semibold text-amber-700",children:[me.length," "]})]}),c.jsx("button",{onClick:H,className:"px-3 py-1 text-xs font-medium bg-amber-100 hover:bg-amber-200 text-amber-700 rounded-full transition-colors",children:""})]}),c.jsx("div",{className:"space-y-1 opacity-70",children:me.map(fe=>{const ye=b.find(Te=>["project",""].includes(Te.name.trim().toLowerCase())),_e=b.find(Te=>Te.name.includes("")||["someday","inspiration","/"].includes(Te.name.trim().toLowerCase())),ft=b.find(Te=>["note","journal","",""].includes(Te.name.trim().toLowerCase())),lt=b.find(Te=>["prompt",""].includes(Te.name.trim().toLowerCase())),nt=ft,Et=_e,jt=fe.data.tags||[];let ne="";return fe.data.start_date?ne="":fe.data.status==="someday"||fe.data.status==="waiting"||Et&&jt.includes(Et.id)?ne="/":fe.data.parent_id||ye&&jt.includes(ye.id)?ne="":_e&&jt.includes(_e.id)?ne="/":ft&&jt.includes(ft.id)||nt&&jt.includes(nt.id)?ne="":lt&&jt.includes(lt.id)&&(ne=""),c.jsxs("div",{className:"flex items-center justify-between p-2 bg-white/80 rounded-lg",children:[c.jsx("span",{className:"text-sm text-theme-primary truncate flex-1",children:fe.data.title||"()"}),c.jsxs("span",{className:"text-[10px] text-amber-600 bg-amber-100 px-2 py-0.5 rounded-full ml-2",children:[" ",ne]})]},fe.data.id)})})]})]})})},Kee=()=>{const{tasks:t,tags:e,addTask:n,addTag:r,user:s,t:i}=x.useContext(En),[o,a]=x.useState(null),[l,u]=x.useState(null),[d,f]=x.useState(()=>{const T=localStorage.getItem(`note_view_expanded_${s==null?void 0:s.id}`);return T?JSON.parse(T):{}});x.useEffect(()=>{s!=null&&s.id&&localStorage.setItem(`note_view_expanded_${s.id}`,JSON.stringify(d))},[d,s==null?void 0:s.id]);const h=x.useMemo(()=>{const T=e.find(_=>_.name.trim().toLowerCase()==="note");return T?T.id:null},[e]),p=x.useMemo(()=>e.filter(T=>T.name.startsWith("#")),[e]),m=x.useMemo(()=>{if(!h)return[];let T=t.filter(_=>_.status!=="deleted"&&_.tags.includes(h));return l&&(T=T.filter(_=>_.tags.includes(l))),T.sort((_,N)=>new Date(N.created_at).getTime()-new Date(_.created_at).getTime())},[t,h,l]),y=x.useMemo(()=>{const T={},_=[];return m.forEach(N=>{const A=N.tags.filter(O=>{if(O===h)return!1;const L=e.find(V=>V.id===O);return L&&!L.name.startsWith("#")});if(A.length===0)_.push(N);else{const O=A[0];if(!T[O]){const L=e.find(V=>V.id===O);T[O]={tag:L,tasks:[]}}T[O].tasks.push(N)}}),{categories:T,uncategorized:_}},[m,h,e]),b=T=>T.tags.map(_=>e.find(N=>N.id===_)).filter(_=>_&&_.name.startsWith("#")),g=T=>{f(_=>({..._,[T]:!_[T]}))},v=T=>d[T]!==!1,w=async()=>{let T=h;if(T||(T=await r("note")),T){const _=await n({title:"",tags:[T],is_project:!1,status:"active"});setTimeout(()=>{a({id:_})},100)}},C=T=>{a(T)},I=()=>{a(null)},k=T=>{u(l===T?null:T)},D=T=>{const _=b(T);return c.jsxs("div",{onClick:()=>C(T),className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden cursor-pointer group hover:shadow-md transition-all hover:-translate-y-0.5",children:[T.images&&T.images.length>0&&c.jsx("div",{className:"aspect-[16/9] bg-gray-100 relative overflow-hidden",children:c.jsx("img",{src:T.images[0],alt:T.title,className:"w-full h-full object-cover transition-transform group-hover:scale-105"})}),c.jsxs("div",{className:"p-4",children:[_.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:_.map(N=>N&&c.jsx("button",{onClick:A=>{A.stopPropagation(),k(N.id)},className:`text-[10px] px-2 py-0.5 rounded-full font-medium transition-all ${l===N.id?"bg-emerald-500 text-white":"bg-emerald-50 text-emerald-600 hover:bg-emerald-100"}`,children:N.name},N.id))}),c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(eh,{size:14,className:"text-indigo-400 mt-1 flex-shrink-0"}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h3",{className:`font-medium text-gray-800 line-clamp-2 text-sm ${T.title?"":"italic text-gray-400"}`,children:T.title||""}),T.description&&c.jsx("p",{className:"text-xs text-gray-500 line-clamp-2 mt-1",children:T.description.replace(/<[^>]*>/g,"").slice(0,100)})]})]}),c.jsxs("div",{className:"flex items-center justify-between mt-3 pt-2 border-t border-gray-50",children:[c.jsx("span",{className:"text-[10px] text-gray-400",children:new Date(T.created_at).toLocaleDateString()}),c.jsx("div",{className:"flex flex-wrap gap-1",children:T.tags.filter(N=>{if(N===h)return!1;const A=e.find(O=>O.id===N);return A&&!A.name.startsWith("#")}).slice(0,2).map(N=>{const A=e.find(O=>O.id===N);return A?c.jsx(MD,{tag:A,size:"small"},N):null})})]})]})]},T.id)},S=(T,_)=>{var A,O;const N=v(T);return c.jsxs("div",{className:"mb-6",children:[c.jsxs("button",{onClick:()=>g(T),className:"flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-gray-100 transition-colors w-full text-left group",children:[N?c.jsx(ts,{size:16,className:"text-gray-400"}):c.jsx(rs,{size:16,className:"text-gray-400"}),c.jsx("span",{className:"font-bold text-sm",style:{color:((A=_.tag)==null?void 0:A.color)||"#6366f1"},children:((O=_.tag)==null?void 0:O.name)||""}),c.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(",_.tasks.length,")"]})]}),N&&c.jsx("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pl-6",children:_.tasks.map(D)})]},T)};return c.jsxs("div",{className:"h-full flex flex-col bg-white overflow-hidden relative",children:[c.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-white z-10",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("h2",{className:"font-bold text-gray-700 flex items-center gap-2",children:[c.jsx(kf,{size:18}),i("journal")]}),p.length>0&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(vz,{size:14,className:"text-gray-400"}),c.jsxs("div",{className:"flex flex-wrap gap-1",children:[p.slice(0,5).map(T=>c.jsx("button",{onClick:()=>k(T.id),className:`text-[10px] px-2 py-0.5 rounded-full font-medium transition-all ${l===T.id?"bg-emerald-500 text-white":"bg-gray-100 text-gray-600 hover:bg-emerald-50 hover:text-emerald-600"}`,children:T.name},T.id)),l&&c.jsxs("button",{onClick:()=>u(null),className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-red-50 text-red-500 hover:bg-red-100 flex items-center gap-1",children:[c.jsx(un,{size:10}),""]})]})]})]}),c.jsxs("button",{onClick:w,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors shadow-sm",children:[c.jsx(ni,{size:16})," "]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-gray-50/50",children:m.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx(kf,{size:48,className:"mb-4 opacity-20"}),c.jsx("p",{className:"text-sm",children:l?"":""}),c.jsx("p",{className:"text-xs mt-1",children:l?"":"note"})]}):c.jsxs("div",{children:[Object.entries(y.categories).map(([T,_])=>S(T,_)),y.uncategorized.length>0&&c.jsxs("div",{className:"mb-6",children:[c.jsxs("button",{onClick:()=>g("_uncategorized"),className:"flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-gray-100 transition-colors w-full text-left group",children:[v("_uncategorized")?c.jsx(ts,{size:16,className:"text-gray-400"}):c.jsx(rs,{size:16,className:"text-gray-400"}),c.jsx("span",{className:"font-bold text-sm text-gray-500",children:""}),c.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(",y.uncategorized.length,")"]})]}),v("_uncategorized")&&c.jsx("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pl-6",children:y.uncategorized.map(D)})]})]})}),o&&c.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm",onClick:I,children:c.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-2xl shadow-2xl max-h-[90vh] overflow-y-auto",onClick:T=>T.stopPropagation(),children:[c.jsx("div",{className:"p-2 border-b border-gray-100 flex justify-end",children:c.jsx("button",{onClick:I,className:"p-2 hover:bg-gray-100 rounded-full text-gray-500",children:c.jsx(un,{size:20})})}),c.jsx("div",{className:"p-4",children:c.jsx(Lo,{initialData:t.find(T=>T.id===o.id),onClose:I})})]})})]})},Gee={"2024-01-01":"","2024-02-08":"","2024-02-09":"","2024-02-10":"","2024-02-11":"","2024-02-12":"","2024-02-13":"","2024-02-14":"","2024-02-28":"228","2024-04-04":"","2024-04-05":"","2024-06-10":"","2024-09-17":"","2024-10-10":"","2026-01-01":"","2026-02-16":"","2026-02-17":"","2026-02-18":"","2026-02-19":"","2026-02-28":"228","2026-04-04":"","2026-04-05":"","2026-06-19":"","2026-09-25":"","2026-10-10":""},IR=t=>{const e=t.toISOString().split("T")[0];return Gee[e]||null},MR=t=>{const e=t.getFullYear(),n=t.getMonth()+1,r=t.getDate();if(e===2025){if(n===12)return r===24?"":r===21?"":r===1?"":`${(r+10)%30||30}`;if(n===11)return`${(r+9)%30||30}`;if(n===1){if(r===1)return"";if(r===27)return"";if(r===28)return""}return`N${r%30||30}`}if(e===2026){if(n===1)return`${(r+12)%30||28}`;if(n===2){if(r===17)return"";if(r===16)return"";const s=r-17;return s>0?`${s+1}`:`${29+s}`}return`L${n}.${r}`}return""},qee={"2025-01-05":"","2025-01-20":"","2025-02-03":"","2025-02-18":"","2025-03-05":"","2025-03-20":"","2025-04-04":"","2025-04-20":"","2025-05-05":"","2025-05-21":"","2025-06-05":"","2025-06-21":"","2025-07-07":"","2025-07-22":"","2025-08-07":"","2025-08-23":"","2025-09-07":"","2025-09-23":"","2025-10-08":"","2025-10-23":"","2025-11-07":"","2025-11-22":"","2025-12-07":"","2025-12-21":"","2026-01-05":"","2026-01-20":"","2026-02-04":"","2026-02-19":"","2026-03-06":"","2026-03-21":"","2026-04-05":"","2026-04-20":"","2026-05-06":"","2026-05-21":"","2026-06-06":"","2026-06-21":"","2026-07-07":"","2026-07-23":"","2026-08-08":"","2026-08-23":"","2026-09-08":"","2026-09-23":"","2026-10-08":"","2026-10-23":"","2026-11-07":"","2026-11-22":"","2026-12-07":"","2026-12-22":""},DR=t=>{const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),s=`${e}-${n}-${r}`;return qee[s]||null},Fi=120,Sc=52,Yee=({onDateClick:t,filterTags:e=[],filterTagsExclude:n=[],filterColors:r=[],filterProjects:s=[]})=>{const{tasks:i,tags:o,batchUpdateTasks:a,addTask:l,setEditingTaskId:u,editingTaskId:d,selectedTaskIds:f,setSelectedTaskIds:h,constructionModeEnabled:p,setConstructionModeEnabled:m,setCalendarDate:y,view:b,viewTagFilters:g,themeSettings:v,tagsWithResolvedColors:w}=x.useContext(En),[C,I]=x.useState(null),k=x.useRef(new Map),D=x.useRef(new Map);x.useEffect(()=>{I(null)},[d]);const S=Q=>{var ke;if(Q.tags&&Q.tags.length>0){const ee=Q.tags.find(pe=>{const Re=o.find(_t=>_t.id===pe);return Re&&Re.name.toLowerCase().includes("google")});if(ee){if(w&&w[ee])return w[ee];const pe=o.find(Re=>Re.id===ee);if(pe!=null&&pe.color)return pe.color}for(const pe of Q.tags){if(w&&w[pe])return w[pe];const Re=o.find(_t=>_t.id===pe);if(Re!=null&&Re.color)return Re.color}}const X=xp(Q,i);if(X&&X.color&&X.color!=="gray"){const ee=Jn[X.color];if(ee)return ee.color}const he=Q.color||"blue";return((ke=Jn[he])==null?void 0:ke.color)||Jn.blue.color},T=x.useRef(null),_=x.useRef(null),N=x.useRef(!1),A=x.useRef(null),[O,L]=x.useState([]),[V,E]=x.useState(null),[j,H]=x.useState(null),[W,R]=x.useState(new Date),[ae,re]=x.useState(null),[$,z]=x.useState(null),[le,$e]=x.useState({start:0,end:200}),Be=Ln.useMemo(()=>{let Q=i.filter(X=>X.status!=="deleted");if(b==="focus"){const X=g.focus||{include:[],exclude:[]},{include:he,exclude:ke}=Array.isArray(X)?{include:X,exclude:[]}:X;he.length>0&&(Q=Q.filter(ee=>ee.tags.some(pe=>he.includes(pe)))),ke.length>0&&(Q=Q.filter(ee=>!ee.tags.some(pe=>ke.includes(pe))))}return e.length>0&&(Q=Q.filter(X=>X.tags.some(he=>e.includes(he)))),n.length>0&&(Q=Q.filter(X=>!X.tags.some(he=>n.includes(he)))),r.length>0&&(Q=Q.filter(X=>r.includes(X.color))),s.length>0&&(Q=Q.filter(X=>{if(s.includes(X.id)||X.parent_id&&s.includes(X.parent_id))return!0;let he=i.find(ke=>ke.id===X.parent_id);for(;he;){if(s.includes(he.id))return!0;he=i.find(ke=>ke.id===(he==null?void 0:he.parent_id))}return!1})),Q},[i,b,g,e,n,r,s]),se=Q=>{const X=Q.getDay(),he=new Date(Q);he.setDate(Q.getDate()-X),he.setHours(0,0,0,0);const ke=[];for(let ee=0;ee<7;ee++){const pe=new Date(he);pe.setDate(he.getDate()+ee),ke.push({date:pe,isCurrentMonth:!0,isToday:_i(pe,new Date)})}return{id:he.toDateString(),days:ke,firstDate:he}},Se=Ln.useMemo(()=>{const Q=new Map;return Be.forEach(X=>{if(X.status==="deleted"||X.status==="logged")return;const he=X.start_date||X.due_date;if(he){const ke=new Date(he),ee=`${ke.getFullYear()}-${ke.getMonth()}-${ke.getDate()}`;Q.has(ee)||Q.set(ee,[]),Q.get(ee).push(X)}}),Q},[Be]),ce=x.useCallback(Q=>{const X=`${Q.getFullYear()}-${Q.getMonth()}-${Q.getDate()}`;return(Se.get(X)||[]).slice().sort((ke,ee)=>ke.is_all_day&&!ee.is_all_day?-1:!ke.is_all_day&&ee.is_all_day?1:!ke.is_all_day&&!ee.is_all_day?(ke.start_time||"").localeCompare(ee.start_time||""):(ke.order_index||0)-(ee.order_index||0))},[Se]);x.useEffect(()=>{const Q=new Date,X=[],he=-Sc,ke=Sc;for(let ee=he;ee<=ke;ee++){const pe=new Date(Q);pe.setDate(Q.getDate()+ee*7),X.push(se(pe))}L(X),setTimeout(()=>{if(T.current){const pe=Sc*Fi-T.current.clientHeight/2+Fi/2;T.current.scrollTop=pe}},100)},[]),x.useLayoutEffect(()=>{if(N.current&&T.current){const Q=4*Fi;T.current.scrollTop+=Q,N.current=!1}},[O]);const Ee=x.useCallback(()=>{const Q=T.current;if(!Q)return;const{scrollTop:X,clientHeight:he,scrollHeight:ke}=Q;ke-X-he<500&&L(ot=>{const Ot=ot[ot.length-1],we=[];for(let qe=1;qe<=4;qe++){const Ke=new Date(Ot.firstDate);Ke.setDate(Ke.getDate()+qe*7),we.push(se(Ke))}return[...ot,...we]}),X<200&&!N.current&&(N.current=!0,L(ot=>{const Ot=ot[0],we=[];for(let qe=4;qe>=1;qe--){const Ke=new Date(Ot.firstDate);Ke.setDate(Ke.getDate()-qe*7),we.push(se(Ke))}return[...we,...ot]}));const ee=Math.floor((X+100)/Fi),pe=O[ee];if(pe){const ot=pe.days[3].date;R(ot)}const Re=6,_t=Math.floor(X/Fi)-Re,Nt=Math.ceil((X+he)/Fi)+Re;$e(ot=>ot.start===_t&&ot.end===Nt?ot:{start:Math.max(0,_t),end:Nt})},[O]),He=async(Q,X)=>{const he=Q.toDateString();if(p&&f.length>0){const ke=[...f];if(X.altKey)for(const ee of ke){const pe=i.find(Re=>Re.id===ee);pe&&await l({...pe,id:void 0,start_date:Q.toISOString()})}else{const ee=ke.map(pe=>({id:pe,data:{start_date:Q.toISOString()}}));await a(ee),h([]),m(!1)}E(he),setTimeout(()=>E(null),600)}else re(Q)},tt=(Q,X)=>{X.stopPropagation(),t&&t(Q)},ut=(Q,X)=>{X.stopPropagation(),X.preventDefault(),t&&t(Q)},Ge=(Q,X,he)=>{he.stopPropagation(),t&&(!X.is_all_day&&X.start_time?t(Q,X.start_time):t(Q))},mt=async()=>{if(f.length===0)return;const Q=o.find(ke=>ke.name.toLowerCase()==="schedule"||ke.name==="");if(!Q)return;const X=f.every(ke=>{var pe;const ee=i.find(Re=>Re.id===ke);return(pe=ee==null?void 0:ee.tags)==null?void 0:pe.includes(Q.id)}),he=f.map(ke=>{const ee=i.find(Re=>Re.id===ke);if(!ee)return null;let pe=[...ee.tags||[]];return X?pe=pe.filter(Re=>Re!==Q.id):pe.includes(Q.id)||pe.push(Q.id),{id:ke,data:{tags:pe}}}).filter(Boolean);he.length>0&&await a(he)},ht=(Q,X)=>{X.stopPropagation(),z({date:Q,title:""}),setTimeout(()=>{var he;return(he=A.current)==null?void 0:he.focus()},50)},Ie=async()=>{$&&($.title.trim()&&await l({title:$.title.trim(),start_date:$.date.toISOString(),is_all_day:!0,status:"inbox",color:"gray"}),z(null))},ge=["","","","","","",""],ie=`${W.getFullYear()} ${W.getMonth()+1}`,me=x.useCallback(()=>{const Q=new Date;y(Q);const X=[];for(let he=-Sc;he<=Sc;he++){const ke=new Date(Q);ke.setDate(Q.getDate()+he*7),X.push(se(ke))}if(L(X),T.current){const ke=Sc*Fi-T.current.clientHeight/2+Fi/2;T.current.scrollTop=ke}},[se,y,L]);return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main relative",children:[c.jsx("div",{className:"absolute top-12 left-1/2 -translate-x-1/2 z-40 pointer-events-none opacity-0 transition-opacity duration-300 data-[visible=true]:opacity-100","data-visible":!0,children:c.jsxs("div",{className:"bg-theme-header backdrop-blur-md shadow-lg border border-theme px-4 py-1.5 rounded-full text-sm font-bold text-theme-primary flex items-center gap-2",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-500"}),ie]})}),c.jsxs("div",{ref:T,className:"flex-1 overflow-y-auto overflow-x-hidden relative",onScroll:Ee,style:{scrollBehavior:"auto"},children:[c.jsx("div",{className:"flex border-b border-theme bg-theme-sidebar z-30 sticky top-0 shadow-sm min-h-[32px]",children:ge.map((Q,X)=>c.jsx("div",{className:`flex-1 text-center py-2 text-xs font-bold ${X===0?"text-red-500":X===6?"text-green-600":"text-theme-tertiary"}`,children:Q},Q))}),c.jsx("div",{className:"relative",style:{height:O.length*Fi},children:O.map((Q,X)=>X<le.start||X>le.end||!T.current?null:c.jsx("div",{className:"flex w-full absolute left-0 right-0 border-b border-theme",style:{height:Fi,top:X*Fi},children:Q.days.map((he,ke)=>{const ee=he.date.getDate()===1,pe=ce(he.date),Re=V===he.date.toDateString(),_t=p&&f.length>0,Nt=ae&&_i(he.date,ae),ot=IR(he.date),Ot=MR(he.date),we=DR(he.date),qe=he.date.getDay()===0||he.date.getDay()===6,Ke=he.date.getDay()===0,it=he.date.getDay()===6;return c.jsxs("div",{className:`
                                                flex-1 min-w-0 h-full border-r border-theme relative group
                                                ${Nt?"bg-indigo-500/10":""}
                                                ${he.isToday&&!Nt?"bg-indigo-500/5":qe&&!Nt?"bg-theme-sidebar":he.date.getMonth()%2===0&&!Nt?"bg-theme-main":Nt?"":"bg-theme-hover/30"}
                                                ${Re?"ring-4 ring-green-400 bg-green-50 animate-pulse z-20":""}
                                                ${j===he.date.toDateString()?"bg-indigo-500/20 ring-inset ring-2 ring-indigo-400 z-10 transition-colors duration-150":""}
                                                ${_t?"cursor-pointer hover:ring-[1.5px] hover:ring-indigo-500 hover:shadow-sm hover:z-30 z-10":""}
                                                ${!he.isToday&&!Re&&j!==he.date.toDateString()&&!Nt?"hover:bg-theme-hover":""}
                                            `,onDragEnter:()=>H(he.date.toDateString()),onDragOver:Me=>{Me.preventDefault(),Me.dataTransfer.dropEffect="move"},onDrop:Me=>{Me.preventDefault(),H(null);try{const yt=Me.dataTransfer.getData("application/json"),fe=JSON.parse(yt);if(Array.isArray(fe)&&fe.length>0){const ye=new Date(he.date);ye.setHours(9,0,0,0);const _e=Me.currentTarget.getBoundingClientRect(),lt=Me.clientY-_e.top<_e.height*.35,nt=fe.map(Et=>({id:Et,data:{start_date:ye.toISOString(),is_all_day:lt,...lt?{start_time:null,end_time:null}:{start_time:"09:00",end_time:"10:00"}}}));a(nt)}}catch(yt){console.error("Failed to parse drag data",yt)}},onClick:Me=>He(he.date,Me),onDoubleClick:Me=>ht(he.date,Me),children:[ee&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"absolute top-0 left-0 w-full border-t-2 border-indigo-500 z-10 shadow-sm"}),c.jsxs("div",{className:"absolute -top-3 left-2 bg-indigo-600 text-white text-xs font-bold px-2 py-0.5 rounded-full z-20 shadow-md",children:[he.date.getFullYear()," ",he.date.getMonth()+1,""]}),c.jsx("div",{className:"absolute top-2 left-2 text-6xl font-black text-indigo-500/5 pointer-events-none -z-10 select-none",children:he.date.getMonth()+1})]}),c.jsxs("div",{className:"p-1 h-full flex flex-col gap-0.5 overflow-hidden",onDoubleClick:Me=>tt(he.date,Me),children:[c.jsxs("div",{className:"flex items-start justify-between min-w-0",children:[c.jsxs("div",{className:"flex flex-col leading-none pt-0.5 pl-0.5 max-w-[70%] text-left pointer-events-none",children:[v.showTaiwanHolidays&&ot&&c.jsx("span",{className:"text-[9px] font-bold truncate text-red-500",children:ot}),we&&c.jsxs("span",{className:"text-[8px] font-bold truncate text-amber-600",children:[" ",we]}),v.showLunar&&c.jsx("span",{className:`text-[8px] truncate ${ot||we?"text-gray-400":"text-gray-300"}`,children:Ot})]}),c.jsx("div",{onClick:Me=>ut(he.date,Me),className:`
                                                            text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-full ml-auto flex-shrink-0
                                                            cursor-pointer hover:ring-2 hover:ring-indigo-300 transition-all
                                                            ${he.isToday?"bg-indigo-600 text-white hover:bg-indigo-700":Ke?"text-red-500 hover:bg-red-50":it?"text-green-600 hover:bg-green-50":"text-theme-tertiary group-hover:text-theme-secondary hover:bg-indigo-50"}
                                                        `,title:"",children:he.date.getDate()})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden space-y-0.5 no-scrollbar",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:[pe.map(Me=>{var ne,Te;const yt=S(Me),fe=Me.is_all_day,ye=f.includes(Me.id),_e=(ne=o.find(Ce=>Ce.name.toLowerCase()==="schedule"||Ce.name===""))==null?void 0:ne.id,ft=_e&&((Te=Me.tags)==null?void 0:Te.includes(_e)),lt=fe?{backgroundColor:yt,color:"white",boxShadow:"0 1px 1px rgba(0,0,0,0.1)",border:ye?"2px solid white":`1px solid ${yt}40`}:{backgroundColor:ye?yt+"30":yt+"1A",color:yt,borderLeft:`3px solid ${yt}`},nt=Ce=>Ce?Ce.replace(":",""):"",Et=Ce=>{Ce&&k.current.set(Me.id,Ce)},jt=Ce=>{Ce&&D.current.set(Me.id,Ce)};return c.jsxs("div",{ref:jt,id:`task-bubble-${Me.id}`,draggable:!0,onDragStart:Ce=>{let rt=[Me.id];if(f.includes(Me.id)&&(rt=f),Ce.dataTransfer.setData("application/json",JSON.stringify(rt)),Ce.dataTransfer.effectAllowed="move",I(null),_.current){const q=_.current.querySelector("#drag-ghost-count"),De=_.current.querySelector("#drag-ghost-title"),st=_.current.querySelector("#drag-ghost-stack-1"),Y=_.current.querySelector("#drag-ghost-stack-2");q&&(q.textContent=rt.length.toString()),De&&(De.textContent=rt.length>1?`${rt.length} Tasks Selected`:Me.title),st&&(st.style.opacity=rt.length>1?"1":"0"),Y&&(Y.style.opacity=rt.length>2?"1":"0"),Ce.dataTransfer.setDragImage(_.current,0,0)}},onDragEnd:()=>H(null),onClick:Ce=>{if(Ce.stopPropagation(),Ce.altKey){Ge(he.date,Me,Ce);return}Ce.metaKey||Ce.ctrlKey||Ce.shiftKey?f.includes(Me.id)?h(rt=>rt.filter(q=>q!==Me.id)):h(rt=>[...rt,Me.id]):Ge(he.date,Me,Ce)},onDoubleClick:Ce=>{Ce.stopPropagation(),u(Me.id)},onMouseEnter:()=>{const Ce=k.current.get(Me.id),rt=D.current.get(Me.id);if(Ce&&rt&&Ce.scrollWidth>Ce.clientWidth){const q=rt.getBoundingClientRect();I({taskId:Me.id,title:Me.title,x:q.left,y:q.top-8})}},onMouseLeave:()=>I(null),className:`
                                                                    relative text-[9.5px] px-1.5 rounded-md cursor-pointer hover:brightness-95 transition-all mb-0.5
                                                                    flex items-center justify-between gap-1
                                                                    ${ye&&fe?"ring-2 ring-indigo-400 z-10":""}
                                                                    ${ye&&!fe?"z-10":""}
                                                                `,style:{...lt,height:"auto",minHeight:"22px",lineHeight:"1.2",...ft?{backgroundImage:"repeating-linear-gradient(45deg, rgba(255,255,255,0.1) 0px, rgba(255,255,255,0.1) 4px, transparent 4px, transparent 8px)"}:{}},children:[c.jsx("span",{ref:Et,className:"truncate flex-1 font-medium select-none",children:Me.title||""}),!fe&&(Me.start_time||Me.end_time)&&c.jsxs("div",{className:"flex flex-col items-end leading-none shrink-0 opacity-80",style:{fontSize:"7px",transform:"scale(0.95)",transformOrigin:"right center"},children:[Me.start_time&&c.jsx("span",{children:nt(Me.start_time)}),Me.end_time&&c.jsx("span",{children:nt(Me.end_time)})]})]},Me.id)}),$&&$.date.toDateString()===he.date.toDateString()&&c.jsx("div",{className:"px-1.5 py-0.5 rounded-md border-2 border-dashed border-indigo-400 bg-indigo-50/50",children:c.jsx("input",{ref:A,type:"text",value:$.title,onChange:Me=>z({...$,title:Me.target.value}),onKeyDown:Me=>{Me.key==="Enter"&&Ie(),Me.key==="Escape"&&z(null)},onBlur:Ie,placeholder:"...",className:"w-full text-[9.5px] bg-transparent outline-none text-indigo-400 font-medium",autoFocus:!0})})]})]})]},ke)})},Q.id))})]}),f.length>0&&c.jsx("button",{onClick:mt,className:`absolute bottom-6 right-24 w-10 h-10 border rounded-full shadow-lg flex items-center justify-center transition-all z-30
                        ${f.every(Q=>{var ke;const X=i.find(ee=>ee.id===Q),he=o.find(ee=>ee.name.toLowerCase()==="schedule"||ee.name==="");return he&&((ke=X==null?void 0:X.tags)==null?void 0:ke.includes(he.id))})?"bg-indigo-100 text-indigo-700 border-indigo-200":"bg-theme-card border-theme text-theme-secondary hover:text-indigo-600 hover:border-indigo-300"}`,title:" Schedule  ()",children:c.jsx(MI,{size:20})}),c.jsx("button",{onClick:me,className:"absolute bottom-4 right-4 bg-indigo-600 text-white px-3 py-1.5 rounded-full shadow-lg text-xs font-bold hover:apply-indigo-700 transition-transform active:scale-95 flex items-center gap-1",children:"Today"}),c.jsx("div",{ref:_,className:"fixed top-[-1000px] left-[-1000px] z-50 pointer-events-none",children:c.jsxs("div",{className:"bg-theme-card backdrop-blur-xl border border-theme p-3 rounded-xl shadow-2xl flex items-center gap-3 w-48 relative overflow-hidden ring-1 ring-black/5",children:[c.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-50/50 to-purple-50/50 -z-10"}),c.jsx("div",{className:"absolute right-0 top-0 w-16 h-16 bg-indigo-500/10 rounded-full blur-2xl -mr-8 -mt-8"}),c.jsx("div",{id:"drag-ghost-count",className:"flex-shrink-0 w-8 h-8 bg-indigo-600 text-white rounded-lg flex items-center justify-center font-black text-sm shadow-indigo-200 shadow-lg transform rotate-[-6deg]",children:"1"}),c.jsxs("div",{className:"flex flex-col min-w-0",children:[c.jsx("span",{className:"text-[10px] uppercase tracking-wider text-indigo-500 font-bold",children:"Moving"}),c.jsx("span",{id:"drag-ghost-title",className:"text-sm font-bold text-gray-700 truncate leading-tight",children:"Task Title"})]}),c.jsx("div",{id:"drag-ghost-stack-1",className:"absolute top-1 left-1 w-full h-full bg-white/50 border border-gray-200/50 rounded-xl -z-20 transform rotate-2 scale-95 origin-center transition-opacity"}),c.jsx("div",{id:"drag-ghost-stack-2",className:"absolute top-2 left-2 w-full h-full bg-white/30 border border-gray-200/30 rounded-xl -z-30 transform rotate-4 scale-90 origin-center transition-opacity"})]})}),C&&ir.createPortal(c.jsxs("div",{className:"fixed z-[9999] w-max max-w-[300px] bg-white/95 backdrop-blur-xl text-slate-800 text-base px-4 py-2.5 rounded-xl shadow-2xl break-words whitespace-normal leading-relaxed font-medium tracking-normal animate-in fade-in zoom-in-95 duration-150 pointer-events-none border border-slate-200/80 ring-1 ring-black/5",style:{left:C.x,top:C.y,transform:"translateY(-100%)"},children:[C.title,c.jsx("div",{className:"absolute left-4 top-full w-0 h-0 border-[6px] border-transparent border-t-white/95"})]}),document.body)]})},mE=60,Io=40,Jee=200,Zh=15,gE=500,Xee=["","","","","","",""],Qee=({filterTags:t=[],filterTagsExclude:e=[],filterColors:n=[],filterProjects:r=[],initialScrollToTime:s,onScrollComplete:i})=>{const{tasks:o,tags:a,calendarDate:l,setCalendarDate:u,editingTaskId:d,setEditingTaskId:f,addTask:h,handleSelection:p,selectedTaskIds:m,setSelectedTaskIds:y,batchDeleteTasks:b,batchUpdateTasks:g,tagsWithResolvedColors:v}=x.useContext(En),w=(we,qe)=>{var it;if(we.tags&&we.tags.length>0){const Me=we.tags.find(ye=>{const _e=a.find(ft=>ft.id===ye);return _e&&_e.name.toLowerCase().includes("google")});if(Me){if(v&&v[Me])return v[Me];const ye=a.find(_e=>_e.id===Me);if(ye!=null&&ye.color)return ye.color}const yt=we.tags[0];if(v&&v[yt])return v[yt];const fe=a.find(ye=>ye.id===yt);if(fe!=null&&fe.color)return fe.color}const Ke=qe.color||we.color||"blue";return((it=Jn[Ke])==null?void 0:it.color)||Jn.blue.color},C=x.useRef(null),I=x.useRef(null),[k,D]=x.useState([]),[S,T]=x.useState(new Date),_=x.useRef(!1),N=x.useRef(0),A=x.useRef(0),O=x.useRef(null),[L,V]=x.useState(Jee),[E,j]=x.useState(null),[H,W]=x.useState(72),[R,ae]=x.useState(null),[re,$]=x.useState(null),z=x.useRef(null),[le,$e]=x.useState(null),[Be,se]=x.useState(null),Se=x.useRef(null),ce=x.useMemo(()=>{const we=new Map;let qe=o.filter(Ke=>Ke.status!=="deleted"&&Ke.status!=="logged");return t.length>0&&(qe=qe.filter(Ke=>Ke.tags.some(it=>t.includes(it)))),e.length>0&&(qe=qe.filter(Ke=>!Ke.tags.some(it=>e.includes(it)))),n.length>0&&(qe=qe.filter(Ke=>n.includes(Ke.color))),r.length>0&&(qe=qe.filter(Ke=>{if(r.includes(Ke.id)||Ke.parent_id&&r.includes(Ke.parent_id))return!0;let it=o.find(Me=>Me.id===Ke.parent_id);for(;it;){if(r.includes(it.id))return!0;it=o.find(Me=>Me.id===(it==null?void 0:it.parent_id))}return!1})),qe.forEach(Ke=>{const it=Ke.start_date||Ke.due_date;if(it){const Me=new Date(it),yt=`${Me.getFullYear()}-${Me.getMonth()}-${Me.getDate()}`;we.has(yt)||we.set(yt,[]),we.get(yt).push(Ke)}}),we},[o,t,e,n,r]),[Ee,He]=x.useState(!1),tt=9,ut=18,Ge=20,mt=we=>Ee?we>=tt&&we<ut?mE:Ge:mE,ht=we=>{let qe=0;const Ke=Math.floor(we/60);for(let Me=0;Me<Ke;Me++)qe+=mt(Me);const it=we%60;return qe+=it/60*mt(Ke),qe},Ie=we=>{let qe=0;for(let Ke=0;Ke<24;Ke++){const it=mt(Ke);if(we<=qe+it){const Me=(we-qe)/it;return Ke*60+Me*60}qe+=it}return 24*60},ge=()=>{let we=0;for(let qe=0;qe<24;qe++)we+=mt(qe);return we},ie=we=>{if(!we)return 0;const[qe,Ke]=we.split(":").map(Number);return qe*60+Ke},me=we=>{const qe=Math.floor(we/60),Ke=Math.floor(we%60);return`${String(qe).padStart(2,"0")}:${String(Ke).padStart(2,"0")}`};x.useEffect(()=>{const we=new Date(l);we.setHours(0,0,0,0);const qe=[];for(let Ke=-Zh;Ke<=Zh;Ke++){const it=new Date(we);it.setDate(we.getDate()+Ke),qe.push(it)}D(qe),setTimeout(()=>{if(I.current){const Ke=qe.length*L/2-I.current.clientWidth/2;I.current.scrollLeft=Ke}},0)},[l,L]),x.useEffect(()=>{const we=setInterval(()=>T(new Date),6e4);return()=>clearInterval(we)},[]),x.useEffect(()=>{const we=qe=>{var Ke;if((qe.key==="Delete"||qe.key==="Backspace")&&m.length>0&&!d){if(["INPUT","TEXTAREA"].includes(((Ke=document.activeElement)==null?void 0:Ke.tagName)||""))return;qe.preventDefault(),b(m,!1)}};return window.addEventListener("keydown",we),()=>window.removeEventListener("keydown",we)},[m,b,d]);const Q=()=>{const we=new Date;we.setHours(0,0,0,0);const qe=k.findIndex(Ke=>_i(Ke,we));if(qe!==-1&&I.current){const Ke=qe*L-I.current.clientWidth/2+L/2;I.current.scrollTo({left:Ke,behavior:"smooth"});const it=ht(S.getHours()*60+S.getMinutes()),Me=Io+H+4,yt=Math.max(0,it+Me-I.current.clientHeight/3);setTimeout(()=>{var fe;(fe=I.current)==null||fe.scrollTo({top:yt,behavior:"smooth"})},300)}else{u(we);const Ke=[];for(let it=-Zh;it<=Zh;it++){const Me=new Date(we);Me.setDate(we.getDate()+it),Ke.push(Me)}D(Ke),setTimeout(()=>{if(I.current){const it=Ke.length*L/2-I.current.clientWidth/2;I.current.scrollLeft=it}},0)}},X=async()=>{if(m.length===0)return;const we=a.find(it=>it.name.toLowerCase()==="schedule"||it.name==="");if(!we){console.warn("Schedule tag not found");return}const qe=m.every(it=>{var yt;const Me=o.find(fe=>fe.id===it);return(yt=Me==null?void 0:Me.tags)==null?void 0:yt.includes(we.id)}),Ke=m.map(it=>{const Me=o.find(fe=>fe.id===it);if(!Me)return null;let yt=[...Me.tags||[]];return qe?yt=yt.filter(fe=>fe!==we.id):yt.includes(we.id)||yt.push(we.id),{id:it,data:{tags:yt}}}).filter(Boolean);Ke.length>0&&await g(Ke)};x.useEffect(()=>{setTimeout(()=>Q(),100)},[]),x.useEffect(()=>{if(s&&I.current){const[we,qe]=s.split(":").map(Number);if(!isNaN(we)&&!isNaN(qe)){const Ke=we*60+qe,it=ht(Ke),Me=Io+H+4,yt=Math.max(0,it+Me-I.current.clientHeight/4);setTimeout(()=>{var fe;(fe=I.current)==null||fe.scrollTo({top:yt,behavior:"smooth"}),setTimeout(()=>{i==null||i()},500)},200)}}},[s,i,H]);const he=()=>{const we=I.current;if(!we)return;const{scrollLeft:qe,scrollWidth:Ke,clientWidth:it}=we,Me=qe<N.current;N.current=qe,qe<gE&&!_.current&&Me&&(_.current=!0,D(yt=>{const fe=yt[0],ye=[];for(let _e=1;_e<=7;_e++){const ft=new Date(fe);ft.setDate(fe.getDate()-_e),ye.unshift(ft)}return[...ye,...yt]})),Ke-(qe+it)<gE&&D(yt=>{const fe=yt[yt.length-1],ye=[];for(let _e=1;_e<=7;_e++){const ft=new Date(fe);ft.setDate(fe.getDate()+_e),ye.push(ft)}return[...yt,...ye]})};x.useLayoutEffect(()=>{if(_.current&&I.current){const we=7*L;I.current.scrollLeft+=we,_.current=!1}},[k,L]),x.useEffect(()=>{if(!E)return;const we=Ke=>{const it=Ke.clientX-E.initialMouseX,Me=Math.max(120,Math.min(400,E.initialWidth+it)),yt=Me-E.initialWidth,ye=E.columnIndex*yt;I.current&&(I.current.scrollLeft=E.initialScrollLeft+ye),V(Me)},qe=()=>{j(null)};return window.addEventListener("mousemove",we),window.addEventListener("mouseup",qe),()=>{window.removeEventListener("mousemove",we),window.removeEventListener("mouseup",qe)}},[E]);const ke=(we,qe)=>{var Ke;we.preventDefault(),we.stopPropagation(),j({initialWidth:L,initialMouseX:we.clientX,columnIndex:qe,initialScrollLeft:((Ke=I.current)==null?void 0:Ke.scrollLeft)||0})};x.useEffect(()=>{if(!R)return;const we=Ke=>{const it=Ke.clientY-R.initialMouseY,Me=Math.max(30,Math.min(200,R.initialHeight+it));W(Me)},qe=()=>{ae(null)};return window.addEventListener("mousemove",we),window.addEventListener("mouseup",qe),()=>{window.removeEventListener("mousemove",we),window.removeEventListener("mouseup",qe)}},[R]);const ee=we=>{we.preventDefault(),we.stopPropagation(),ae({initialHeight:H,initialMouseY:we.clientY})};x.useEffect(()=>{const we=()=>{A.current!==0&&I.current?(I.current.scrollLeft+=A.current,O.current=requestAnimationFrame(we)):O.current=null},qe=it=>{if(Se.current&&!Be){const{initialMouseX:Me,initialMouseY:yt}=Se.current;if(Math.abs(it.clientX-Me)>3||Math.abs(it.clientY-yt)>3){const fe=Se.current.task;se({...Se.current,originalStartMin:ie(fe.start_time),originalDuration:fe.duration||60,currentDate:Se.current.originalDate,currentStartMin:ie(fe.start_time)||540,currentDuration:fe.duration||60,currentSection:Se.current.originalType,startOffsetMin:Se.current.startOffsetMin})}}if(Be){if(it.preventDefault(),I.current){const{left:jt,width:ne}=I.current.getBoundingClientRect(),Te=jt+ne,Ce=120;let rt=0;const q=25;if(it.clientX<jt+Ce){const st=1-Math.max(0,it.clientX-jt)/Ce;rt=-Math.max(2,Math.round(q*st))}else if(it.clientX>Te-Ce){const st=1-Math.max(0,Te-it.clientX)/Ce;rt=Math.max(2,Math.round(q*st))}rt!==A.current&&(A.current=rt,rt!==0&&!O.current&&we())}const Me=document.elementsFromPoint(it.clientX,it.clientY);let yt=Be.currentSection,fe=Be.currentDate,ye=Be.currentStartMin,_e=Be.currentDuration;const ft=Me.find(jt=>jt.getAttribute("data-drop-zone")==="allday"),lt=Me.find(jt=>jt.getAttribute("data-drop-zone")==="grid"),nt=Me.find(jt=>jt.getAttribute("data-date")),Et=nt==null?void 0:nt.getAttribute("data-date");if(Et&&(fe=new Date(Et)),ft?yt="allday":lt&&(yt="grid"),yt==="grid"&&lt){const jt=lt.getBoundingClientRect();let ne=it.clientY-jt.top,Te=Ie(ne);if(Be.type==="move")Te=Te-Be.startOffsetMin,ye=Math.round(Te/15)*15,ye=Math.max(0,Math.min(1425,ye));else if(Be.type==="resize-bottom"){const Ce=Math.round(Te/15)*15,rt=Math.max(15,Ce-Be.originalStartMin);Be.currentDuration=rt,_e=rt,ye=Be.originalStartMin}else if(Be.type==="resize-top"){let Ce=Math.round(Te/15)*15;const rt=Be.originalStartMin+Be.originalDuration;let q=rt-Ce;q<15&&(q=15,Ce=rt-15),_e=q,ye=Ce}}se(jt=>jt?{...jt,currentDate:fe,currentSection:yt,currentStartMin:ye,currentDuration:_e}:null)}},Ke=async()=>{if(A.current=0,O.current&&(cancelAnimationFrame(O.current),O.current=null),Be){const{task:it,currentDate:Me,currentSection:yt,currentStartMin:fe,currentDuration:ye,originalType:_e,type:ft}=Be,lt=m.includes(it.id)?m:[it.id],nt=[],Et=Me.getTime()-Be.originalDate.getTime(),jt=Math.round(Et/864e5),ne=fe-Be.originalStartMin;for(const Te of lt){const Ce=o.find(q=>q.id===Te);if(!Ce)continue;const rt={};if(Ce.start_date){const q=new Date(Ce.start_date);q.setDate(q.getDate()+jt),rt.start_date=q.toISOString()}else rt.start_date=Me.toISOString();if(yt==="allday")rt.is_all_day=!0;else if(rt.is_all_day=!1,_e==="grid"){let De=ie(Ce.start_time)+ne;if(De<0&&(De=0),rt.start_time=me(De),rt.start_date){const st=new Date(rt.start_date);st.setHours(Math.floor(De/60)),st.setMinutes(De%60),rt.start_date=st.toISOString()}ft==="resize-bottom"||ft==="resize-top"?rt.duration=ye:rt.duration=Ce.duration||60,rt.end_time=me((ie(rt.start_time)||0)+(rt.duration||60))}else rt.start_time=me(fe),rt.duration=60,rt.end_time=me(fe+60);nt.push({id:Te,data:rt})}nt.length>0&&await g(nt)}se(null),Se.current=null};return window.addEventListener("mousemove",qe),window.addEventListener("mouseup",Ke),()=>{window.removeEventListener("mousemove",qe),window.removeEventListener("mouseup",Ke)}},[Be,o,m,g]);const pe=(we,qe,Ke,it,Me)=>{if(we.button!==0)return;we.preventDefault(),we.stopPropagation(),p(we,qe.id);let yt=0,fe=200;const ye=we.currentTarget;if(fe=ye.getBoundingClientRect().width,!Me){const ft=ye.closest(".schedule-body");if(ft){const lt=ft.getBoundingClientRect(),nt=we.clientY-lt.top;yt=Ie(nt)-ie(qe.start_time)}else yt=0}Se.current={task:qe,initialMouseX:we.clientX,initialMouseY:we.clientY,originalDate:Ke,type:it,originalType:Me?"allday":"grid",startOffsetMin:yt,colWidth:fe}},Re=async(we,qe)=>{we.stopPropagation(),y([]);const Ke=await h({title:"",start_date:qe.toISOString(),is_all_day:!0,status:"inbox"});f(Ke)},_t=(we,qe)=>{if(we.button!==0)return;y([]);const Ke=we.currentTarget.getBoundingClientRect(),it=we.clientY-Ke.top,Me=Math.floor(Ie(it)/15)*15;$({date:qe,startMin:Me,duration:60,title:""}),setTimeout(()=>{var yt;return(yt=z.current)==null?void 0:yt.focus()},50)},Nt=async()=>{re&&re.title.trim()&&await h({title:re.title,start_date:re.date.toISOString(),start_time:me(re.startMin),duration:re.duration,status:"inbox",is_all_day:!1}),$(null)},ot=(we,qe)=>{if(we.button!==0||we.target.closest("[data-task-id]"))return;y([]);const it=we.currentTarget.getBoundingClientRect(),Me=we.clientY-it.top,yt=Math.floor(Ie(Me)/15)*15;$e({date:qe,startMin:yt,endMin:yt,initialY:we.clientY})};x.useEffect(()=>{if(!le)return;const we=Ke=>{if(!I.current)return;const Me=document.querySelector(`div[data-date="${le.date.toISOString()}"]`);if(!Me)return;const yt=Me.querySelector(".schedule-body");if(!yt)return;const fe=yt.getBoundingClientRect(),ye=Ke.clientY-fe.top,_e=Math.floor(Ie(ye)/15)*15,ft=Math.max(0,Math.min(24*60-15,_e));$e(lt=>lt?{...lt,endMin:ft}:null)},qe=()=>{if(le){const{date:Ke,startMin:it,endMin:Me}=le,yt=Math.min(it,Me),ye=Math.max(it,Me)-yt;ye>=15&&($({date:Ke,startMin:yt,duration:Math.max(15,ye),title:""}),setTimeout(()=>{var _e;return(_e=z.current)==null?void 0:_e.focus()},50))}$e(null)};return window.addEventListener("mousemove",we),window.addEventListener("mouseup",qe),()=>{window.removeEventListener("mousemove",we),window.removeEventListener("mouseup",qe)}},[le]);const Ot=we=>{if(we.length===0)return{};const qe=we.map(fe=>({id:fe.id,start:ie(fe.start_time),end:ie(fe.start_time)+(fe.duration||60)})).sort((fe,ye)=>fe.start-ye.start),Ke=[];let it=[],Me=-1;qe.forEach(fe=>{it.length===0?(it.push(fe),Me=fe.end):fe.start<Me?(it.push(fe),Me=Math.max(Me,fe.end)):(Ke.push(it),it=[fe],Me=fe.end)}),it.length>0&&Ke.push(it);const yt={};return Ke.forEach(fe=>{const ye=[];fe.forEach(Et=>{let jt=!1;for(let ne=0;ne<ye.length;ne++){const Te=ye[ne],Ce=Te[Te.length-1];if(Et.start>=Ce.end){Te.push(Et),jt=!0;break}}jt||ye.push([Et])});const ft=90/ye.length,lt={},nt=[];fe.forEach(Et=>{let jt=!1;for(let ne=0;ne<nt.length;ne++){const Te=nt[ne],Ce=Te[Te.length-1];if(Et.start>=Ce.end){Te.push(Et),lt[Et.id]=ne,jt=!0;break}}jt||(nt.push([Et]),lt[Et.id]=nt.length-1)}),fe.forEach(Et=>{const jt=lt[Et.id];yt[Et.id]={left:`${jt*ft+2}%`,width:`${ft}%`}})}),yt};return c.jsxs("div",{ref:C,className:"h-full flex flex-col bg-theme-main overflow-hidden",children:[c.jsxs("div",{className:"flex bg-theme-header border-b border-theme p-2 items-center flex-shrink-0 z-40 shadow-sm justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ri,{size:16,className:"text-theme-primary"}),c.jsx("span",{className:"font-bold text-theme-primary text-sm",children:"Schedule"})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-[10px] text-theme-tertiary font-medium",children:"WIDTH"}),c.jsx("input",{type:"range",min:"120",max:"400",value:L,onChange:we=>V(Number(we.target.value)),className:"w-20 h-1 bg-theme-hover rounded-lg appearance-none cursor-pointer accent-indigo-500"})]}),m.length>0&&c.jsxs("button",{onClick:X,className:`px-3 py-1 border rounded-md text-xs font-bold shadow-sm flex items-center gap-1 transition-all
                                ${m.every(we=>{var it;const qe=o.find(Me=>Me.id===we),Ke=a.find(Me=>Me.name.toLowerCase()==="schedule"||Me.name==="");return Ke&&((it=qe==null?void 0:qe.tags)==null?void 0:it.includes(Ke.id))})?"bg-indigo-100 text-indigo-700 border-indigo-200":"bg-theme-card border-theme text-theme-secondary hover:bg-theme-hover"}`,title:" Schedule ",children:[c.jsx(MI,{size:14}),m.length>1?`(${m.length})`:""]}),c.jsx("button",{onClick:Q,className:"px-3 py-1 bg-theme-card border border-theme rounded-md text-xs font-bold shadow-sm hover:bg-theme-hover text-theme-primary",children:"Today"}),c.jsx("button",{onClick:()=>He(!Ee),className:`px-3 py-1 border rounded-md text-xs font-bold shadow-sm transition-colors
                            ${Ee?"bg-indigo-600 text-white border-indigo-600":"bg-theme-card border-theme text-theme-tertiary hover:bg-theme-hover"}`,children:Ee?"Work Hours":"Full Day"})]})]}),c.jsxs("div",{ref:I,className:"flex-1 overflow-auto flex relative",onScroll:he,children:[c.jsxs("div",{className:"sticky left-0 z-30 bg-theme-sidebar border-r border-theme flex-shrink-0 w-14 flex flex-col pointer-events-none select-none h-min relative",children:[c.jsx("div",{className:"sticky top-0 bg-theme-sidebar z-40 border-b border-theme flex-shrink-0",style:{height:Io+H+4}}),Array.from({length:24}).map((we,qe)=>c.jsx("div",{className:"text-[10px] text-theme-tertiary font-extralight text-center relative box-border",style:{height:mt(qe)},children:c.jsxs("span",{className:"absolute -top-1.5 left-0 right-0",children:[qe,":00"]})},qe)),c.jsx("div",{className:"absolute right-0 flex items-center z-50",style:{top:Io+H+4+ht(S.getHours()*60+S.getMinutes())-8},children:c.jsx("div",{className:"bg-red-500 text-white text-[9px] font-bold px-1 py-0.5 rounded-sm shadow-sm",children:S.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})})}),c.jsx("div",{className:"h-20"})]}),k.map((we,qe)=>{const Ke=_i(we,S),it=`${we.getFullYear()}-${we.getMonth()}-${we.getDate()}`,Me=ce.get(it)||[],yt=Me.filter(_e=>!_e.is_all_day&&_e.start_time&&_e.start_date),fe=Me.filter(_e=>_e.is_all_day||!_e.start_time),ye=Ot(yt);return c.jsxs("div",{"data-date":we.toISOString(),className:"flex-shrink-0 flex flex-col border-r border-theme bg-theme-main relative group h-min",style:{minWidth:L,width:L},children:[c.jsxs("div",{className:`sticky top-0 z-20 border-b border-theme px-1 py-0.5 text-center flex flex-col justify-start select-none shadow-sm relative
                                ${Ke?"bg-indigo-500/10 backdrop-blur-sm":"bg-theme-header backdrop-blur-sm"}
                            `,style:{height:Io+H+4},children:[c.jsx("div",{className:"absolute top-0 right-0 w-2 h-full cursor-col-resize z-30 hover:bg-indigo-400/30 transition-colors group-hover:opacity-100 opacity-0",onMouseDown:_e=>ke(_e,qe)}),c.jsxs("div",{className:"flex items-center justify-center gap-1 flex-shrink-0",style:{height:Io-4},children:[c.jsxs("span",{className:`text-[10px] font-extralight ${Ke?"text-indigo-500":"text-theme-tertiary"}`,children:["",Xee[we.getDay()]]}),c.jsx("span",{className:`text-lg font-extralight ${Ke?"text-indigo-500":"text-theme-primary"}`,children:we.getDate()})]}),c.jsx("div",{"data-drop-zone":"allday",className:"overflow-y-auto space-y-1 py-1 border-t border-dashed border-theme custom-scrollbar px-1 cursor-cell transition-colors relative",style:{height:H},onDoubleClick:_e=>Re(_e,we),children:fe.map(_e=>{var Te,Ce;const ft=xp(_e,o),lt=w(_e,ft),nt=m.includes(_e.id),Et=(Be==null?void 0:Be.task.id)===_e.id,jt=(Te=a.find(rt=>rt.name.toLowerCase()==="schedule"||rt.name===""))==null?void 0:Te.id,ne=jt&&((Ce=_e.tags)==null?void 0:Ce.includes(jt));return c.jsxs("div",{onMouseDown:rt=>pe(rt,_e,we,"move",!0),onDoubleClick:rt=>{rt.stopPropagation(),y([]),f(_e.id)},className:`group/allday text-[10px] px-2 py-1 rounded-lg border text-center font-extralight transition-all w-full relative overflow-hidden cursor-grab active:cursor-grabbing
                                                    ${nt?"ring-2 ring-offset-1":""}
                                                    ${Et?"opacity-30":""}
                                                `,style:{backgroundColor:ne?`${lt}10`:nt?lt+"40":lt+"18",backgroundImage:ne?`repeating-linear-gradient(45deg, ${lt}20 0px, ${lt}20 4px, transparent 4px, transparent 8px)`:void 0,color:lt,borderColor:nt?lt+"80":lt+"60",boxShadow:nt?"2px 2px 4px rgba(0,0,0,0.12)":"2px 2px 3px rgba(0,0,0,0.08)","--tw-ring-color":nt?lt+"60":void 0,...ne?{fontWeight:"bold"}:{}},children:[c.jsx("div",{className:"absolute inset-0 opacity-0 group-hover/allday:opacity-100 transition-opacity pointer-events-none",style:{backgroundColor:lt+"15"}}),c.jsx("div",{className:"truncate pointer-events-none relative z-10",children:_e.title||"Untitled"})]},_e.id)})}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-2 cursor-ns-resize hover:bg-indigo-400/30 transition-colors z-30",onMouseDown:ee})]}),c.jsxs("div",{"data-drop-zone":"grid",className:"flex-1 relative overflow-hidden schedule-body",style:{height:ge()},onDoubleClick:_e=>_t(_e,we),onMouseDown:_e=>ot(_e,we),children:[Array.from({length:24}).map((_e,ft)=>c.jsx("div",{className:"border-t border-theme box-border w-full pointer-events-none opacity-20",style:{height:mt(ft)}},ft)),le&&_i(le.date,we)&&(()=>{const _e=Math.min(le.startMin,le.endMin),ft=Math.max(le.startMin,le.endMin);if(ft-_e<15)return null;const nt=ht(_e),Et=ht(ft);return c.jsx("div",{className:"absolute left-1 right-1 rounded-xl border-2 border-dashed border-indigo-400 bg-indigo-50/50 pointer-events-none z-40 flex items-center justify-center",style:{top:nt,height:Et-nt},children:c.jsxs("span",{className:"text-xs font-extralight text-indigo-600",children:[me(_e)," - ",me(ft)]})})})(),Ke&&c.jsxs("div",{className:"absolute w-full flex items-center z-10 pointer-events-none",style:{top:ht(S.getHours()*60+S.getMinutes())},children:[c.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 -ml-1"}),c.jsx("div",{className:"flex-1 border-t-2 border-red-500"})]}),yt.map(_e=>{var rt,q;const ft=ye[_e.id];if(!ft||Be&&Be.task.id===_e.id)return null;const lt=ie(_e.start_time),nt=_e.duration||60,Et=xp(_e,o),jt=w(_e,Et),ne=m.includes(_e.id),Te=(rt=a.find(De=>De.name.toLowerCase()==="schedule"||De.name===""))==null?void 0:rt.id,Ce=Te&&((q=_e.tags)==null?void 0:q.includes(Te));return c.jsxs("div",{"data-task-id":_e.id,onMouseDown:De=>pe(De,_e,we,"move",!1),onDoubleClick:De=>{De.stopPropagation(),y([]),f(_e.id)},className:`absolute rounded-xl border px-2 py-1.5 overflow-hidden select-none cursor-pointer hover:brightness-98 transition-all flex flex-col
                                                ${ne?"ring-2 ring-offset-1":""}
                                            `,style:{top:ht(lt),height:ht(lt+nt)-ht(lt),left:ft.left,width:ft.width,backgroundColor:Ce?`${jt}10`:ne?jt+"40":jt+"15",backgroundImage:Ce?`repeating-linear-gradient(45deg, ${jt}20 0px, ${jt}20 4px, transparent 4px, transparent 8px)`:void 0,borderColor:jt+"50",color:jt,zIndex:10,boxShadow:"2px 2px 3px rgba(0,0,0,0.06)","--tw-ring-color":ne?jt+"60":void 0,...Ce?{fontWeight:"bold"}:{}},children:[c.jsx("div",{className:"font-extralight text-[11px] truncate leading-normal pointer-events-none",children:_e.title||""}),nt>30&&c.jsxs("div",{className:"text-[9px] opacity-80 font-extralight mt-0.5 leading-normal pointer-events-none",children:[_e.start_time," - ",_e.end_time]}),c.jsx("div",{className:"absolute top-0 left-0 w-full h-3 cursor-ns-resize z-50 hover:bg-black/5 transition-colors",onMouseDown:De=>pe(De,_e,we,"resize-top",!1)}),c.jsx("div",{className:"absolute bottom-0 left-0 w-full h-3 cursor-ns-resize z-50 hover:bg-black/5 transition-colors",onMouseDown:De=>pe(De,_e,we,"resize-bottom",!1)})]},_e.id)}),re&&_i(re.date,we)&&c.jsx("div",{className:"absolute z-50 rounded-xl border border-indigo-500 bg-theme-card shadow-xl overflow-hidden px-3 flex items-center",style:{top:ht(re.startMin),height:Math.max(44,ht(re.startMin+re.duration)-ht(re.startMin)),left:"5%",width:"90%"},children:c.jsx("input",{ref:z,value:re.title,onChange:_e=>$({...re,title:_e.target.value}),onKeyDown:_e=>{_e.key==="Enter"&&Nt(),_e.key==="Escape"&&$(null)},onBlur:Nt,className:"w-full text-[12px] font-extralight bg-transparent outline-none text-indigo-400 leading-normal",placeholder:"New Task...",autoFocus:!0})})]})]},we.toISOString())}),Be&&(()=>{var Me,yt,fe;const we=xp(Be.task,o),qe=w(Be.task,we);let Ke=0;const it=Array.from(document.querySelectorAll("div[data-date]")).find(ye=>ye.getAttribute("data-date")===Be.currentDate.toISOString());if(it?Ke=it.getBoundingClientRect().left:Ke=Be.initialMouseX,Be.currentSection==="allday"){const _e=(((Me=I.current)==null?void 0:Me.getBoundingClientRect().top)||0)+Io+2;return c.jsx("div",{className:"fixed z-[100] pointer-events-none rounded-lg border px-2 py-1 text-[10px] font-extralight text-center shadow-xl cursor-grabbing flex items-center justify-center bg-white",style:{left:Ke+4,top:_e,width:(Be.colWidth||200)-8,height:H-4,backgroundColor:qe+"40",borderColor:qe,color:qe},children:Be.task.title||"Untitled"})}else{const ye=((yt=I.current)==null?void 0:yt.getBoundingClientRect())||{top:0,left:0},_e=((fe=I.current)==null?void 0:fe.scrollTop)||0,ft=ht(Be.currentStartMin),lt=ht(Be.currentStartMin+Be.currentDuration)-ft,nt=ye.top+Io+H+4+ft-_e;return c.jsxs("div",{className:`fixed rounded-xl border px-2 py-1.5 shadow-2xl overflow-hidden select-none flex flex-col z-[100] bg-white ring-2 ring-indigo-400/50 ${Be.type.startsWith("resize")?"cursor-ns-resize":"cursor-grabbing"}`,style:{top:Math.max(ye.top+Io+H+4,nt),height:lt,left:Ke+4,width:(Be.colWidth||190)-8,backgroundColor:"var(--bg-card)",borderColor:qe,color:qe,opacity:.95},children:[c.jsx("div",{className:"font-extralight text-[11px] truncate leading-normal",children:Be.task.title||""}),c.jsxs("div",{className:"text-[9px] font-extralight mt-0.5 opacity-80 leading-normal",children:[me(Be.currentStartMin)," - ",me(Be.currentStartMin+Be.currentDuration)]})]})}})()]})]})},Zee=Object.keys(Jn),ete=()=>{const{tasks:t,updateTask:e,selectedTaskIds:n,viewTagFilters:r,setEditingTaskId:s,focusSplitWidth:i,setFocusSplitWidth:o,themeSettings:a,setSelectedTaskIds:l,constructionModeEnabled:u,setConstructionModeEnabled:d,deleteTask:f,editingTaskId:h,batchDeleteTasks:p,setCalendarDate:m,tags:y,tagsWithResolvedColors:b}=x.useContext(En),g=x.useRef(null),[v,w]=x.useState(!1),[C,I]=x.useState(()=>localStorage.getItem("focus_calendar_mode")||"calendar"),[k,D]=x.useState(null),[S,T]=x.useState(null),[_,N]=x.useState(()=>{try{const ie=localStorage.getItem("focus_filter_tags_include");return ie?JSON.parse(ie):[]}catch{return[]}}),[A,O]=x.useState(()=>{try{const ie=localStorage.getItem("focus_filter_tags_exclude");return ie?JSON.parse(ie):[]}catch{return[]}}),[L,V]=x.useState(()=>{try{const ie=localStorage.getItem("focus_filter_colors");return ie?JSON.parse(ie):[]}catch{return[]}}),[E,j]=x.useState(()=>{try{const ie=localStorage.getItem("focus_filter_projects");return ie?JSON.parse(ie):[]}catch{return[]}}),[H,W]=x.useState(!1),[R,ae]=x.useState(!1),[re,$]=x.useState(!1),z=x.useRef(null),le=x.useRef(null),$e=x.useRef(null);x.useEffect(()=>{localStorage.setItem("focus_filter_tags_include",JSON.stringify(_))},[_]),x.useEffect(()=>{localStorage.setItem("focus_filter_tags_exclude",JSON.stringify(A))},[A]),x.useEffect(()=>{localStorage.setItem("focus_filter_colors",JSON.stringify(L))},[L]),x.useEffect(()=>{localStorage.setItem("focus_filter_projects",JSON.stringify(E))},[E]);const Be=x.useMemo(()=>t.filter(ie=>ie.is_project&&ie.status!=="deleted"),[t]),se=_.length>0||A.length>0||L.length>0||E.length>0,Se=()=>{N([]),O([]),V([]),j([])},ce=ie=>{_.includes(ie)?(N(me=>me.filter(Q=>Q!==ie)),O(me=>[...me,ie])):A.includes(ie)?O(me=>me.filter(Q=>Q!==ie)):N(me=>[...me,ie])};x.useEffect(()=>{const ie=me=>{z.current&&!z.current.contains(me.target)&&W(!1),le.current&&!le.current.contains(me.target)&&ae(!1),$e.current&&!$e.current.contains(me.target)&&$(!1)};return document.addEventListener("mousedown",ie),()=>document.removeEventListener("mousedown",ie)},[]),x.useEffect(()=>{localStorage.setItem("focus_calendar_mode",C)},[C]);const Ee=n.length>0&&n.some(ie=>{const me=t.find(Q=>Q.id===ie);return me&&!me.start_date}),He=u&&Ee,tt=n.length>0&&n.some(ie=>{const me=t.find(Q=>Q.id===ie);return me&&me.start_date}),ut=u&&tt&&!Ee,Ge=x.useMemo(()=>{const ie=r.focus||{include:[],exclude:[]},{include:me,exclude:Q}=Array.isArray(ie)?{include:ie,exclude:[]}:ie,X=new Set(t.filter(ke=>ke.status==="deleted").map(ke=>ke.id));let he=t.filter(ke=>ke.status==="inbox"&&!ke.start_date&&!ke.completed_at&&(!ke.parent_id||!X.has(ke.parent_id)));return me.length>0&&(he=he.filter(ke=>ke.tags.some(ee=>me.includes(ee)))),Q.length>0&&(he=he.filter(ke=>!ke.tags.some(ee=>Q.includes(ee)))),he.sort((ke,ee)=>(ke.order_index||0)-(ee.order_index||0))},[t,r]);x.useEffect(()=>{const ie=me=>{var Q,X,he;if(me.key==="Escape"&&(He||ut)&&(d(!1),l([])),(me.key==="Delete"||me.key==="Backspace")&&!h){if(["INPUT","TEXTAREA"].includes(((Q=document.activeElement)==null?void 0:Q.tagName)||""))return;n.length>0&&(me.preventDefault(),p(n,!1),l([]))}if(me.key==="Enter"&&!h&&n.length>0){if(["INPUT","TEXTAREA"].includes(((X=document.activeElement)==null?void 0:X.tagName)||""))return;me.preventDefault(),s(n[0])}if((me.key==="ArrowUp"||me.key==="ArrowDown")&&!h){if(["INPUT","TEXTAREA"].includes(((he=document.activeElement)==null?void 0:he.tagName)||"")||(me.preventDefault(),Ge.length===0))return;let ke=-1;n.length>0&&(ke=Ge.findIndex(Re=>n.includes(Re.id)));let ee=0;me.key==="ArrowDown"?ke===-1?ee=0:ee=Math.min(Ge.length-1,ke+1):ke===-1?ee=Ge.length-1:ee=Math.max(0,ke-1);const pe=Ge[ee];pe&&(l([pe.id]),ht(ee),setTimeout(()=>{const Re=document.getElementById(`focus-task-${pe.id}`);Re==null||Re.scrollIntoView({block:"nearest"})},0))}};return window.addEventListener("keydown",ie),()=>window.removeEventListener("keydown",ie)},[He,ut,l,d,n,f,h,Ge]),x.useEffect(()=>{n.length===0&&d(!1)},[n]),x.useEffect(()=>{const ie=Q=>{if(!v||!g.current)return;const X=g.current.getBoundingClientRect();let he=Q.clientX-X.left;const ke=X.width*.9;he<100&&(he=100),he>ke&&(he=ke),o(he)},me=()=>{w(!1),document.body.style.cursor="default"};return v&&(window.addEventListener("mousemove",ie),window.addEventListener("mouseup",me),document.body.style.cursor="col-resize"),()=>{window.removeEventListener("mousemove",ie),window.removeEventListener("mouseup",me)}},[v]);const[mt,ht]=x.useState(null),Ie=(ie,me,Q)=>{if(Q.shiftKey&&mt!==null){const X=Math.min(mt,me),he=Math.max(mt,me),ke=Ge.slice(X,he+1).map(ee=>ee.id);l(ke)}else Q.metaKey||Q.ctrlKey?n.includes(ie)?l(n.filter(X=>X!==ie)):l([...n,ie]):l([ie]);ht(me)},ge=(ie,me)=>{const Q=n.includes(ie.id),X={small:"text-xs",normal:"text-sm",large:"text-base"}[a.fontSize]||"text-sm",he=a.fontFamily==="things"?"font-things":"font-sans",ke=ie.color||"blue",ee=Jn[ke]||Jn.blue;return c.jsxs("div",{id:`focus-task-${ie.id}`,onClick:pe=>Ie(ie.id,me,pe),onDoubleClick:pe=>{pe.stopPropagation(),s(ie.id)},className:`
                    group relative flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer
                    transition-all duration-150 ease-out
                    ${Q?`bg-indigo-50 ring-2 shadow-sm ${He||ut?"construction-glow ring-transparent":"ring-indigo-400"}`:"hover:bg-theme-hover active:bg-theme-hover"}
                `,style:Q&&(He||ut)?{"--glow-color":ee.color,"--tw-ring-color":ee.color}:{},children:[c.jsx("div",{className:`flex-shrink-0 w-4 h-4 rounded-full border-2 transition-colors ${Q?`${ee.border} ${ee.bg}`:"border-gray-300 group-hover:border-gray-400"}`,onClick:pe=>{pe.stopPropagation(),e(ie.id,{status:"completed"})}}),c.jsxs("div",{className:"flex-1 min-w-0",children:[ie.parent_id&&(()=>{const pe=t.find(Re=>Re.id===ie.parent_id);return pe?c.jsxs("div",{className:"text-[9px] text-gray-400 truncate mb-0.5 flex items-center gap-1",children:[c.jsx("span",{className:"w-1 h-1 rounded-full bg-gray-300"}),pe.title]}):null})(),c.jsx("div",{className:`${X} ${he} font-extralight text-theme-secondary truncate leading-tight`,children:ie.title||c.jsx("span",{className:"text-theme-tertiary italic",children:""})})]})]},ie.id)};return c.jsxs("div",{ref:g,className:"flex h-full w-full overflow-hidden bg-theme-main",children:[c.jsx("div",{style:{width:i},className:"flex flex-col h-full border-r border-theme flex-shrink-0 bg-theme-sidebar",children:c.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar px-2 py-3 space-y-4",children:[Ge.length>0&&c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between px-2 mb-1",children:[c.jsxs("span",{className:`text-[9px] text-gray-400 ${a.fontFamily==="things"?"font-things":"font-sans"}`,children:[" (",Ge.length,")"]}),n.length>0&&c.jsxs("button",{onClick:()=>d(!u),className:`flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] font-medium transition-all ${u?"bg-amber-100 text-amber-700 ring-1 ring-amber-300":"bg-gray-100 text-gray-500 hover:bg-gray-200"}`,title:u?"":"",children:[c.jsx(Cz,{size:10}),u?"":""]})]}),c.jsx("div",{className:"space-y-1",children:Ge.slice(0,50).map((ie,me)=>ge(ie,me))})]}),Ge.length===0&&c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx(au,{size:32,className:"mb-2 opacity-30"}),c.jsx("p",{className:"text-sm",children:""})]})]})}),c.jsxs("div",{onMouseDown:()=>w(!0),onTouchStart:()=>w(!0),className:`
                    w-1 hover:w-2 active:w-2 cursor-col-resize hover:bg-indigo-400 
                    group relative z-30 transition-all duration-150 flex items-center justify-center 
                    touch-none highlight-none select-none
                    ${v?"bg-indigo-400 w-2":"bg-transparent"}
                `,children:[c.jsx("div",{className:"absolute inset-y-0 -left-2 -right-2 z-30 bg-transparent active:bg-indigo-400/20"}),c.jsx("div",{className:`
                    absolute opacity-0 group-hover:opacity-100 transition-opacity 
                    p-0.5 bg-white border border-gray-200 rounded-md shadow-sm text-gray-400 
                    ${v?"opacity-100":""}
                    pointer-events-none transform scale-90
                `,children:c.jsx(PI,{size:10})})]}),c.jsxs("div",{className:"flex-1 h-full min-w-0 relative overflow-hidden flex flex-col",children:[c.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-theme bg-theme-header flex-shrink-0",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[k&&c.jsxs("button",{onClick:()=>{D(null),I("calendar")},className:"flex items-center gap-1 px-2 py-1.5 rounded-md text-xs font-medium text-theme-secondary hover:text-theme-primary hover:bg-theme-hover transition-all",title:"",children:[c.jsx(jI,{size:14}),""]}),c.jsxs("div",{className:"flex items-center gap-1 bg-theme-hover p-0.5 rounded-lg",children:[c.jsxs("button",{onClick:()=>{I("calendar"),D(null)},className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${C==="calendar"&&!k?"bg-theme-card text-indigo-500 shadow-sm":"text-theme-tertiary hover:text-theme-secondary"}`,children:[c.jsx(vo,{size:14}),""]}),c.jsxs("button",{onClick:()=>{I("schedule"),D(null)},className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${C==="schedule"||k?"bg-theme-card text-indigo-500 shadow-sm":"text-theme-tertiary hover:text-theme-secondary"}`,children:[c.jsx(Ri,{size:14}),""]})]}),k&&c.jsxs("span",{className:"text-sm font-medium text-indigo-600",children:[k.getMonth()+1,"",k.getDate()," (",["","","","","","",""][k.getDay()],")"]})]}),c.jsx("div",{className:"text-[10px] text-gray-400",children:k?"":C==="schedule"?" 1-9 ":""})]}),c.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 border-b border-theme bg-theme-card/50 flex-shrink-0",children:[c.jsx("span",{className:"text-[9px] font-bold text-gray-400 uppercase tracking-wider",children:":"}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>W(!H),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-medium transition-all border ${_.length>0||A.length>0?"bg-indigo-50 text-indigo-600 border-indigo-200":"bg-theme-hover text-theme-tertiary border-transparent hover:text-theme-secondary"}`,children:[c.jsx(Bl,{size:11}),"",_.length+A.length>0&&c.jsx("span",{className:"ml-0.5 px-1 bg-indigo-500 text-white rounded-full text-[9px]",children:_.length+A.length}),c.jsx(ts,{size:10})]}),H&&c.jsxs("div",{ref:z,className:"absolute top-full left-0 mt-1 w-56 bg-theme-card rounded-lg shadow-xl border border-theme z-50 p-1 max-h-64 overflow-y-auto",children:[c.jsxs("div",{className:"text-[9px] text-theme-tertiary px-2 py-1 border-b border-theme mb-1",children:[":   ",c.jsx("span",{className:"text-green-600",children:""}),"  ",c.jsx("span",{className:"text-red-500",children:""}),"  "]}),y.map(ie=>{const me=_.includes(ie.id),Q=A.includes(ie.id);return c.jsxs("button",{onClick:()=>ce(ie.id),className:`w-full flex items-center justify-between px-2 py-1.5 text-xs rounded hover:bg-theme-hover transition-colors ${me?"bg-green-50":Q?"bg-red-50":""}`,children:[c.jsxs("div",{className:"flex items-center gap-1.5",children:[c.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:b[ie.id]||"#6366f1"}}),c.jsx("span",{className:"text-theme-secondary",children:ie.name})]}),me&&c.jsx(Xn,{size:12,className:"text-green-600"}),Q&&c.jsx(un,{size:12,className:"text-red-500"})]},ie.id)}),y.length===0&&c.jsx("div",{className:"text-xs text-theme-tertiary p-2",children:""})]})]}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>ae(!R),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-medium transition-all border ${L.length>0?"bg-indigo-50 text-indigo-600 border-indigo-200":"bg-theme-hover text-theme-tertiary border-transparent hover:text-theme-secondary"}`,children:[c.jsx(Av,{size:11}),"",L.length>0&&c.jsx("span",{className:"ml-0.5 px-1 bg-indigo-500 text-white rounded-full text-[9px]",children:L.length}),c.jsx(ts,{size:10})]}),R&&c.jsx("div",{ref:le,className:"absolute top-full left-0 mt-1 w-48 bg-theme-card rounded-lg shadow-xl border border-theme z-50 p-2",children:c.jsx("div",{className:"grid grid-cols-7 gap-1",children:Zee.map(ie=>{var me;return c.jsx("button",{onClick:()=>{V(Q=>Q.includes(ie)?Q.filter(X=>X!==ie):[...Q,ie])},className:`w-5 h-5 rounded-full transition-transform ${L.includes(ie)?"ring-2 ring-offset-1 ring-indigo-500 scale-110":"hover:scale-110"}`,style:{backgroundColor:((me=Jn[ie])==null?void 0:me.color)||"#6366f1"},title:ie},ie)})})})]}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>$(!re),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-medium transition-all border ${E.length>0?"bg-indigo-50 text-indigo-600 border-indigo-200":"bg-theme-hover text-theme-tertiary border-transparent hover:text-theme-secondary"}`,children:[c.jsx(kz,{size:11}),"",E.length>0&&c.jsx("span",{className:"ml-0.5 px-1 bg-indigo-500 text-white rounded-full text-[9px]",children:E.length}),c.jsx(ts,{size:10})]}),re&&c.jsxs("div",{ref:$e,className:"absolute top-full left-0 mt-1 w-56 bg-theme-card rounded-lg shadow-xl border border-theme z-50 p-1 max-h-64 overflow-y-auto",children:[Be.map(ie=>{var me;return c.jsxs("button",{onClick:()=>{j(Q=>Q.includes(ie.id)?Q.filter(X=>X!==ie.id):[...Q,ie.id])},className:`w-full flex items-center justify-between px-2 py-1.5 text-xs rounded hover:bg-theme-hover transition-colors ${E.includes(ie.id)?"bg-indigo-50":""}`,children:[c.jsxs("div",{className:"flex items-center gap-1.5",children:[c.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:((me=Jn[ie.color])==null?void 0:me.color)||"#6366f1"}}),c.jsx("span",{className:"text-theme-secondary truncate",children:ie.title})]}),E.includes(ie.id)&&c.jsx(Xn,{size:12,className:"text-indigo-600"})]},ie.id)}),Be.length===0&&c.jsx("div",{className:"text-xs text-theme-tertiary p-2",children:""})]})]}),se&&c.jsxs("button",{onClick:Se,className:"flex items-center gap-1 text-[10px] text-red-500 hover:text-red-600 ml-auto",children:[c.jsx(un,{size:11})," "]})]}),c.jsx("div",{className:"flex-1 relative z-10 h-full overflow-hidden",children:C==="calendar"&&!k?c.jsx(Yee,{onDateClick:(ie,me)=>{D(ie),m(ie),T(me||null)},filterTags:_,filterTagsExclude:A,filterColors:L,filterProjects:E}):c.jsx(Qee,{filterTags:_,filterTagsExclude:A,filterColors:L,filterProjects:E,initialScrollToTime:S,onScrollComplete:()=>T(null)})}),(He||ut)&&c.jsxs("div",{className:"absolute bottom-0 left-0 right-0 z-20",children:[c.jsx("div",{className:`h-12 opacity-45 transition-colors ${ut?"opacity-30":"opacity-45"}`,style:{backgroundImage:He?`repeating-linear-gradient(
                                    45deg,
                                    #fbbf24 0px,
                                    #fbbf24 10px,
                                    #1f2937 10px,
                                    #1f2937 20px
                                )`:`repeating-linear-gradient(
                                    45deg,
                                    #818cf8 0px,
                                    #818cf8 10px,
                                    #312e81 10px,
                                    #312e81 20px
                                )`,backgroundSize:"28px 28px"}}),c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:c.jsx("div",{className:`bg-white/95 backdrop-blur-sm px-4 py-2 rounded-lg shadow-lg border ${He?"border-amber-200":"border-indigo-200"}`,children:c.jsxs("span",{className:`text-sm font-bold ${He?"text-amber-700":"text-indigo-700"}`,children:[He?" ":" "," ",n.length,"    ESC "]})})})]})]})]})},Bi=40,Gy=50,Ui=40,qy=250,AR=({plan:t,onUpdatePlan:e,onEditTask:n})=>{const[r,s]=x.useState(null),[i,o]=x.useState(null),[a,l]=x.useState(null),[u,d]=x.useState(null),[f,h]=x.useState(0),[p,m]=x.useState(0),[y,b]=x.useState(0),[g,v]=x.useState({x:0,y:0}),[w,C]=x.useState(null),I=x.useRef(null),k=x.useRef(null),D=x.useRef(null);D.current=w,x.useEffect(()=>{C(null)},[t]);const S=(ce,Ee=0,He=[],tt=null)=>{let ut=[];return ce.forEach((Ge,mt)=>{const ht=[...He,mt];ut.push({...Ge,depth:Ee,path:ht,parentId:tt}),Ge.subtasks&&Ge.subtasks.length>0&&(ut=[...ut,...S(Ge.subtasks,Ee+1,ht,Ge.id||null)])}),ut},T=w||t,_=x.useMemo(()=>S(T),[T]),N=ce=>_.find(Ee=>Ee.id===ce),A=ce=>{if(!ce)return null;const Ee=new Date(ce);return isNaN(Ee.getTime())?null:Ee},{minDate:O,totalDays:L}=x.useMemo(()=>{let ce=new Date,Ee=new Date;Ee.setDate(ce.getDate()+14);let He=!1;S(t).forEach(mt=>{const ht=A(mt.start_date),Ie=A(mt.due_date);ht&&((!He||ht<ce)&&(ce=ht),He=!0),Ie&&((!He||Ie>Ee||Ie>Ee)&&(Ee=Ie),He=!0)}),ce.setDate(ce.getDate()-2),Ee.setDate(Ee.getDate()+5);const ut=Math.abs(Ee.getTime()-ce.getTime()),Ge=Math.ceil(ut/(1e3*60*60*24));return{minDate:ce,maxDate:Ee,totalDays:Ge}},[t,w]),V=(ce,Ee)=>{const He=ce.getTime()-Ee.getTime();return Math.ceil(He/(1e3*60*60*24))},E=(ce,Ee)=>{const He=new Date(Ee);return He.setDate(He.getDate()+ce),He.toISOString().split("T")[0]},j=(ce,Ee,He)=>ce.map(tt=>tt.id===Ee?{...tt,...He}:tt.subtasks?{...tt,subtasks:j(tt.subtasks,Ee,He)}:tt),H=(ce,Ee)=>{let He=JSON.parse(JSON.stringify(ce));if(!Ee)return He;const tt=[Ee],ut=new Set;for(;tt.length>0;){const Ge=tt.shift();if(ut.has(Ge))continue;ut.add(Ge);const mt=(ie,me)=>{for(const Q of ie){if(Q.id===me)return Q;if(Q.subtasks){const X=mt(Q.subtasks,me);if(X)return X}}return null},ht=mt(He,Ge);if(!ht||!ht.due_date)continue;const Ie=new Date(ht.due_date),ge=ie=>{for(let me=0;me<ie.length;me++){const Q=ie[me];if(Q.dependencies&&Q.dependencies.includes(Ge)){const X=Q.start_date?new Date(Q.start_date):null,he=new Date(Ie);if(he.setDate(he.getDate()+1),!X||X<he){const ke=Q.start_date&&Q.due_date?new Date(Q.due_date).getTime()-new Date(Q.start_date).getTime():864e5,ee=he.toISOString().split("T")[0],Re=new Date(he.getTime()+ke).toISOString().split("T")[0];ie[me]={...Q,start_date:ee,due_date:Re},Q.id&&tt.push(Q.id)}}Q.subtasks&&ge(Q.subtasks)}};ge(He)}return He},W=(ce,Ee)=>{if(ce.preventDefault(),ce.stopPropagation(),!Ee.id)return;s(Ee.id),o(Ee.id);const He=Ee.start_date?V(new Date(Ee.start_date),O):0,tt=Ee.due_date?V(new Date(Ee.due_date),O):He+1;m(He),b(tt-He),h(ce.clientX),C(t)},R=(ce,Ee,He)=>{if(ce.preventDefault(),ce.stopPropagation(),!Ee.id)return;l({id:Ee.id,dir:He}),h(ce.clientX);const tt=Ee.start_date?V(new Date(Ee.start_date),O):0,ut=Ee.due_date?V(new Date(Ee.due_date),O):tt+1;m(tt),b(ut-tt),C(t)},ae=(ce,Ee)=>{var tt;if(ce.preventDefault(),ce.stopPropagation(),!Ee.id)return;d(Ee.id);const He=(tt=I.current)==null?void 0:tt.getBoundingClientRect();He&&v({x:ce.clientX-He.left,y:ce.clientY-He.top})},re=ce=>{if(u&&I.current){const tt=I.current.getBoundingClientRect();v({x:ce.clientX-tt.left,y:ce.clientY-tt.top});return}if(!i&&!a||!I.current||!w)return;const Ee=ce.clientX-f,He=Math.round(Ee/Bi);if(i){if(!N(i))return;const ut=p+He;if(ut<0)return;const Ge=E(ut,O),mt=E(ut+y,O),ht=j(w,i,{start_date:Ge,due_date:mt});C(ht)}if(a){let tt=p,ut=y;if(a.dir==="end")ut=Math.max(1,y+He);else{const Ie=y-1,ge=Math.min(He,Ie);tt=p+ge,ut=y-ge}if(tt<0)return;const Ge=E(tt,O),mt=E(tt+ut,O),ht=j(w,a.id,{start_date:Ge,due_date:mt});C(ht)}},$=()=>{const ce=D.current;if(i&&ce){const Ee=H(ce,i);e(Ee)}else if(a&&ce){const Ee=H(ce,a.id);e(Ee)}o(null),l(null),d(null),C(null)},z=(ce,Ee)=>{var He;if(ce.stopPropagation(),u&&Ee.id&&u!==Ee.id){if((He=Ee.dependencies)!=null&&He.includes(u))return;const tt=[...Ee.dependencies||[],u],ut=j(t,Ee.id,{dependencies:tt}),Ge=H(ut,u);e(Ge)}d(null)};x.useEffect(()=>{const ce=()=>{(i||a||u)&&$()},Ee=He=>{if(u&&I.current){const tt=I.current.getBoundingClientRect();v({x:He.clientX-tt.left,y:He.clientY-tt.top})}};return window.addEventListener("mouseup",ce),window.addEventListener("mousemove",Ee),()=>{window.removeEventListener("mouseup",ce),window.removeEventListener("mousemove",Ee)}},[i,a,u,t]);const le=()=>{const ce=[],Ee=[];for(let He=0;He<L;He++){const tt=new Date(O);tt.setDate(tt.getDate()+He);const ut=tt.getDay()===0||tt.getDay()===6;ce.push(c.jsx("line",{x1:He*Bi,y1:0,x2:He*Bi,y2:_.length*Ui,stroke:ut?"#f3f4f6":"#e5e7eb",strokeWidth:1},`line - ${He} `)),He%1===0&&Ee.push(c.jsxs("div",{className:"absolute top-0 flex flex-col items-center justify-end pb-2 text-xs text-gray-500 border-r border-gray-100",style:{left:He*Bi,width:Bi,height:Gy},children:[c.jsx("span",{className:"font-bold",children:tt.getDate()}),c.jsx("span",{className:"text-[10px]",children:["","","","","","",""][tt.getDay()]})]},`head - ${He} `))}return{lines:ce,days:Ee}},$e=()=>{var Ee,He;const ce=[];if(_.forEach(tt=>{tt.dependencies&&tt.dependencies.forEach(ut=>{const Ge=N(ut);if(Ge){const mt=Ge.due_date?V(new Date(Ge.due_date),O):0,ht=tt.start_date?V(new Date(tt.start_date),O):0,Ie=_.findIndex(ke=>ke.id===Ge.id),ge=_.findIndex(ke=>ke.id===tt.id),ie=(mt+1)*Bi,me=Ie*Ui+Ui/2,Q=ht*Bi,X=ge*Ui+Ui/2,he=`M ${ie} ${me} C ${ie+20} ${me}, ${Q-20} ${X}, ${Q} ${X} `;ce.push(c.jsx("g",{className:"group cursor-pointer pointer-events-auto",onClick:ke=>{var pe;if(ke.stopPropagation(),window.confirm(`Remove dependency: ${Ge.title} -> ${tt.title}?`)&&tt.id){const Re=(pe=tt.dependencies)==null?void 0:pe.filter(Nt=>Nt!==Ge.id),_t=j(t,tt.id,{dependencies:Re});e(_t)}},children:c.jsx("path",{d:he,fill:"none",stroke:"#94a3b8",strokeWidth:"2",markerEnd:"url(#arrowhead)",className:"group-hover:stroke-red-500"})},`${Ge.id} -${tt.id} `))}})}),u){const tt=N(u);if(tt&&I.current){const ut=tt.due_date?V(new Date(tt.due_date),O):0,Ge=_.findIndex(X=>X.id===tt.id),mt=((Ee=k.current)==null?void 0:Ee.scrollLeft)||0,ht=((He=k.current)==null?void 0:He.scrollTop)||0,Ie=(ut+1)*Bi,ge=Ge*Ui+Ui/2,ie=g.x+mt-qy,me=g.y+ht-Gy,Q=`M ${Ie} ${ge} L ${ie} ${me} `;ce.push(c.jsx("path",{d:Q,stroke:"#6366f1",strokeWidth:"2",strokeDasharray:"5,5"},"drawing"))}}return ce},{lines:Be,days:se}=le(),Se=$e();return c.jsxs("div",{className:"flex flex-col h-full border rounded-lg overflow-hidden bg-white select-none",ref:I,onMouseMove:re,children:[c.jsxs("div",{className:"flex border-b",children:[c.jsx("div",{style:{width:qy},className:"flex-shrink-0 border-r bg-gray-50 flex items-center px-4 font-bold text-gray-700",children:""}),c.jsx("div",{className:"flex-1 overflow-hidden relative",style:{height:Gy},children:c.jsx("div",{className:"absolute inset-0",ref:ce=>{ce&&k.current&&(ce.scrollLeft=k.current.scrollLeft)},children:se})})]}),c.jsxs("div",{className:"flex flex-1 overflow-auto",ref:k,children:[c.jsx("div",{style:{width:qy},className:"flex-shrink-0 border-r bg-white sticky left-0 z-10",children:_.map((ce,Ee)=>c.jsxs("div",{style:{height:Ui,paddingLeft:ce.depth*20},className:`flex flex-col justify-center px-4 border-b border-gray-50 bg-white cursor-pointer hover:bg-gray-50 transition-colors ${r===ce.id?"!bg-indigo-50 border-l-4 border-l-indigo-500":""}`,onClick:()=>ce.id&&s(ce.id),onDoubleClick:()=>ce.id&&(n==null?void 0:n(ce.id)),children:[c.jsx("span",{className:"truncate text-sm text-gray-700 font-medium",children:ce.title}),c.jsxs("span",{className:"text-[10px] text-gray-400",children:[ce.start_date?ce.start_date.split("T")[0].slice(5).replace("-","/"):"",ce.start_date&&ce.due_date&&ce.start_date.split("T")[0]!==ce.due_date.split("T")[0]?` - ${ce.due_date.split("T")[0].slice(5).replace("-","/")}`:""]})]},Ee))}),c.jsxs("div",{className:"relative",style:{width:L*Bi,height:_.length*Ui},children:[c.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",children:[c.jsx("defs",{children:c.jsx("marker",{id:"arrowhead",markerWidth:"5",markerHeight:"3.5",refX:"4",refY:"1.75",orient:"auto",children:c.jsx("polygon",{points:"0 0, 5 1.75, 0 3.5",fill:"#94a3b8"})})}),Be,Se]}),_.map((ce,Ee)=>{const He=ce.start_date?V(new Date(ce.start_date),O):-1;if(He<0)return null;const tt=ce.due_date?Math.max(1,V(new Date(ce.due_date),O)-He+1):1,ut=He*Bi,Ge=tt*Bi;return c.jsxs("div",{className:`absolute rounded-md shadow-sm border border-indigo-600 bg-indigo-500 hover:bg-indigo-600 group flex items-center justify-between px-2 transition-colors ${u&&u!==ce.id?"ring-2 ring-indigo-300 ring-offset-1 z-20 cursor-crosshair":""} ${r===ce.id?"ring-2 ring-white ring-offset-2 ring-offset-indigo-500":""}`,style:{left:ut,top:Ee*Ui+6,width:Ge,height:Ui-12,cursor:u?"crosshair":"grab"},onMouseDown:mt=>W(mt,ce),onMouseUp:mt=>{u&&(mt.stopPropagation(),z(mt,ce))},onDoubleClick:mt=>{mt.stopPropagation(),n&&ce.id&&n(ce.id)},children:[c.jsx("div",{className:`w-4 h-4 bg-white border-2 border-indigo-500 rounded-full cursor-cell absolute -left-2 top-1/2 -translate-y-1/2 hover:scale-125 transition-transform z-30 shadow-sm flex items-center justify-center ${u&&u!==ce.id?"opacity-100 animate-pulse scale-110":"opacity-0"}`,onMouseUp:mt=>z(mt,ce),children:c.jsx("div",{className:"w-1.5 h-1.5 bg-indigo-500 rounded-full"})}),c.jsx("span",{className:"text-xs text-white font-medium truncate pointer-events-none select-none drop-shadow-sm",children:Ge>30&&ce.title}),c.jsx("div",{className:`w-4 h-4 bg-indigo-500 border-2 border-white rounded-full cursor-crosshair absolute -right-2 top-1/2 -translate-y-1/2 hover:scale-125 transition-transform z-30 shadow-sm ${u?"opacity-0":"opacity-0 group-hover:opacity-100"}`,onMouseDown:mt=>ae(mt,ce)}),c.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-3 cursor-ew-resize hover:bg-black/10 z-40 rounded-l-md",onMouseDown:mt=>R(mt,ce,"start")}),c.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-3 cursor-ew-resize hover:bg-black/10 z-40 rounded-r-md",onMouseDown:mt=>R(mt,ce,"end")})]},ce.id)})]})]}),c.jsxs("div",{className:"h-6 bg-gray-50 border-t flex items-center px-4 text-xs text-gray-400 gap-4",children:[c.jsx("span",{children:""}),c.jsx("span",{children:""}),c.jsx("span",{children:""}),c.jsx("span",{children:""})]})]})},tte="",nte=({isOpen:t,onClose:e,position:n,customPrompt:r,setCustomPrompt:s,onRun:i,prompts:o,saveToLibrary:a,setSaveToLibrary:l,isLoading:u,history:d,historyIndex:f,setHistoryIndex:h,onDeleteHistory:p,onUpdateHistory:m,onReplace:y,onInsert:b})=>{const[g,v]=x.useState(""),[w,C]=x.useState("prompt"),[I,k]=x.useState(!1),[D,S]=x.useState("");x.useEffect(()=>{u?C("result"):d.length>0&&f>=0?(C("result"),S(d[f].content)):C("prompt")},[u,d.length,f]);const T=o.filter(O=>O.title.toLowerCase().includes(g.toLowerCase())||O.description&&O.description.toLowerCase().includes(g.toLowerCase()));if(!t)return null;const _=n?Math.max(10,Math.min(n.top,window.innerHeight-500)):100,N=n?Math.min(n.left,window.innerWidth-420):window.innerWidth/2-200,A=d[f];return ir.createPortal(c.jsx(bo,{children:c.jsxs(Pr.div,{initial:{opacity:0,y:10,left:N,top:_},animate:{opacity:1,y:0,left:N,top:_},exit:{opacity:0,scale:.95},drag:!0,dragMomentum:!1,className:"fixed w-[400px] bg-white rounded-xl shadow-2xl border border-gray-100 flex flex-col overflow-hidden z-[99999]",style:{position:"fixed"},children:[c.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-100 bg-white cursor-move",children:[c.jsxs("h3",{className:"text-sm font-bold text-slate-800 flex items-center gap-2 pointer-events-none",children:[c.jsx(Ds,{className:"text-indigo-500",size:16}),"AI "]}),c.jsxs("div",{className:"flex items-center gap-1",children:[w==="result"&&!u&&c.jsx("button",{onClick:()=>C("prompt"),className:"p-1 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"",children:c.jsx(Ds,{size:14})}),c.jsx("button",{onClick:O=>{O.stopPropagation(),e()},className:"text-slate-400 hover:text-slate-600 transition-colors p-1 hover:bg-slate-100 rounded-full",children:c.jsx(un,{size:16})})]})]}),c.jsx("div",{className:"flex-1 overflow-hidden flex flex-col bg-slate-50/50",children:w==="prompt"?c.jsxs("div",{className:"p-4 space-y-4",children:[c.jsx("input",{type:"text",placeholder:"...",className:"w-full px-3 py-2 text-xs bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-100 outline-none",value:g,onChange:O=>v(O.target.value),onKeyDown:O=>O.stopPropagation(),autoFocus:!0}),!g&&T.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1.5",children:T.slice(0,5).map(O=>c.jsx("button",{onClick:()=>{s(O.description||O.title),v("")},className:"text-[10px] px-2 py-1 rounded-full bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-100 font-medium",children:O.title},O.id))}),c.jsx("textarea",{className:"w-full h-32 p-3 text-sm bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-100 outline-none resize-none",placeholder:"...",value:r,onChange:O=>s(O.target.value),onKeyDown:O=>O.stopPropagation()}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"checkbox",id:"saveToLib",checked:a,onChange:O=>l(O.target.checked),className:"w-3.5 h-3.5 rounded text-indigo-600"}),c.jsx("label",{htmlFor:"saveToLib",className:"text-xs text-slate-500 select-none",children:""})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:()=>i(tte),className:"flex-1 py-2 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 rounded-xl text-xs font-bold border border-indigo-200 flex items-center justify-center gap-1",children:[c.jsx(Ds,{size:14})," "]}),c.jsx("button",{onClick:()=>i(r),disabled:!r.trim(),className:"flex-[2] py-2 bg-slate-800 hover:bg-slate-900 text-white rounded-xl text-xs font-bold disabled:opacity-50",children:""})]})]}):c.jsx("div",{className:"flex flex-col h-auto max-h-[60vh]",children:u?c.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-4 text-slate-400",children:[c.jsx(md,{size:32,className:"text-indigo-400 animate-pulse"}),c.jsx("span",{className:"text-xs font-bold",children:"..."})]}):A?c.jsxs(c.Fragment,{children:[d.length>1&&c.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-white border-b border-gray-50",children:[c.jsxs("span",{className:"text-[10px] font-bold text-gray-400",children:[f+1," / ",d.length]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:()=>h(Math.max(0,f-1)),disabled:f===0,className:"p-1 hover:bg-gray-100 rounded disabled:opacity-30",children:c.jsx($u,{size:14})}),c.jsx("button",{onClick:()=>h(Math.min(d.length-1,f+1)),disabled:f===d.length-1,className:"p-1 hover:bg-gray-100 rounded disabled:opacity-30",children:c.jsx(rs,{size:14})}),c.jsx("div",{className:"w-px h-3 bg-gray-200 mx-1"}),c.jsx("button",{onClick:()=>p(f),className:"p-1 hover:bg-red-50 text-gray-400 hover:text-red-500 rounded",children:c.jsx(Er,{size:14})})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar bg-white",children:I?c.jsx("textarea",{className:"w-full h-full min-h-[150px] p-2 text-sm border border-indigo-200 rounded-lg focus:ring-2 focus:ring-indigo-100 outline-none resize-none",value:D,onChange:O=>S(O.target.value),onKeyDown:O=>O.stopPropagation()}):c.jsx("div",{className:"prose prose-sm max-w-none prose-indigo",children:c.jsx(uk,{children:A.content})})}),c.jsx("div",{className:"p-3 bg-gray-50 border-t border-gray-100 space-y-2",children:I?c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:()=>{m(f,D),k(!1)},className:"flex-1 py-1.5 bg-indigo-600 text-white rounded-lg text-xs font-bold flex items-center justify-center gap-1",children:[c.jsx(Xn,{size:12})," "]}),c.jsx("button",{onClick:()=>k(!1),className:"px-3 py-1.5 bg-gray-200 text-gray-600 rounded-lg text-xs font-bold",children:""})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("button",{onClick:()=>y(A.content),className:"py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-xs font-bold shadow-sm active:scale-95 flex items-center justify-center gap-1.5",children:[c.jsx(l1,{size:12})," "]}),c.jsxs("button",{onClick:()=>b(A.content),className:"py-2 bg-white hover:bg-gray-50 text-gray-700 border border-gray-200 rounded-lg text-xs font-bold shadow-sm active:scale-95 flex items-center justify-center gap-1.5",children:[c.jsx(eh,{size:12})," "]})]}),c.jsxs("div",{className:"flex gap-2 justify-end",children:[c.jsxs("button",{onClick:()=>{S(A.content),k(!0)},className:"px-2 py-1 text-[10px] text-gray-500 hover:text-indigo-600 flex items-center gap-1",children:[c.jsx(Rv,{size:10})," "]}),c.jsxs("button",{onClick:()=>navigator.clipboard.writeText(A.content),className:"px-2 py-1 text-[10px] text-gray-500 hover:text-indigo-600 flex items-center gap-1",children:[c.jsx(DI,{size:10})," "]})]})]})})]}):null})})]},"ai-assistant-modal")}),document.body)},rte=()=>{const{tasks:t,tags:e,themeSettings:n,updateTask:r,setEditingTaskId:s,editingTaskId:i,addTask:o,addTag:a,setView:l,batchUpdateTasks:u,batchDeleteTasks:d}=x.useContext(En),[f,h]=x.useState(null),[p,m]=x.useState(null),[y,b]=x.useState(null),[g,v]=x.useState("list"),[w,C]=x.useState(()=>{const ne=localStorage.getItem("projectCardSize");return ne?parseInt(ne):280}),[I,k]=x.useState(()=>{const ne=localStorage.getItem("projectOrder");return ne?JSON.parse(ne):[]});x.useEffect(()=>{const ne=localStorage.getItem("openProjectId"),Te=localStorage.getItem("previousView");ne&&(h(ne),localStorage.removeItem("openProjectId")),Te&&(b(Te),localStorage.removeItem("previousView"))},[]);const D=x.useMemo(()=>e.find(ne=>ne.name.toLowerCase()==="project"),[e]),S=x.useMemo(()=>D?t.filter(Te=>!Te.tags.includes(D.id)||Te.status==="deleted"||Te.status==="logged"?!1:t.some(rt=>rt.parent_id===Te.id&&rt.status!=="deleted")).map(Te=>{const Ce=t.filter(q=>q.parent_id===Te.id&&q.status!=="deleted").length,rt=t.filter(q=>q.parent_id===Te.id&&q.status==="completed").length;return{id:Te.id,title:Te.title,description:Te.description,color:Te.color||"blue",tags:Te.tags,start_date:Te.start_date,due_date:Te.due_date,childCount:Ce,completedCount:rt,coverImage:Te.images&&Te.images.length>0?Te.images[0]:Te.cover_image,order:Te.project_order||0}}):[],[t,D]),T=x.useMemo(()=>e.filter(ne=>ne.name.includes("")).map(ne=>ne.id),[e]),_=x.useMemo(()=>I.length===0?[...S].sort((ne,Te)=>{const Ce=ne.tags.some(q=>T.includes(q)),rt=Te.tags.some(q=>T.includes(q));return Ce&&!rt?-1:!Ce&&rt?1:0}):[...S].sort((ne,Te)=>{const Ce=I.indexOf(ne.id),rt=I.indexOf(Te.id);return Ce===-1&&rt===-1?0:Ce===-1?1:rt===-1?-1:Ce-rt}),[S,I,T]);x.useEffect(()=>{localStorage.setItem("projectCardSize",w.toString())},[w]);const N=x.useCallback(ne=>{const Te=ne.map(Ce=>Ce.id);k(Te),localStorage.setItem("projectOrder",JSON.stringify(Te))},[]),[A,O]=x.useState(null),[L,V]=x.useState(null),E=x.useRef(new Map),j=x.useCallback((ne,Te)=>{Te?E.current.set(ne,Te):E.current.delete(ne)},[]),H=x.useCallback((ne,Te,Ce)=>{let rt=null,q=1/0;return E.current.forEach((De,st)=>{if(st===Ce)return;const Y=De.getBoundingClientRect(),Fe=Y.left+Y.width/2,Ue=Y.top+Y.height/2,ze=Math.sqrt(Math.pow(ne-Fe,2)+Math.pow(Te-Ue,2));ze<q&&(q=ze,rt=st)}),rt},[]),W=x.useCallback(ne=>{if(ne.preventDefault(),!A)return;const Te=H(ne.clientX,ne.clientY,A);V(Te)},[A,H]),R=x.useCallback(ne=>{if(ne.preventDefault(),!A||!L||A===L){O(null),V(null);return}const Te=_.findIndex(st=>st.id===A),Ce=_.findIndex(st=>st.id===L);if(Te===-1||Ce===-1){O(null),V(null);return}const rt=[..._],[q]=rt.splice(Te,1),De=rt.findIndex(st=>st.id===L);rt.splice(De+1,0,q),N(rt),O(null),V(null)},[A,L,_,N]),ae=x.useCallback(()=>{O(null),V(null)},[]),re=async ne=>{window.confirm(`
`)&&(await r(ne,{status:"deleted"}),p===ne&&m(null))},$=async()=>{let ne=D==null?void 0:D.id;if(ne||(ne=await a("project")||void 0),!ne){console.error("Failed to create project tag");return}const Te=await o({title:"",tags:[ne],status:"todo"});Te&&(await o({title:"",parent_id:Te,status:"todo"}),h(Te))},z=f?t.find(ne=>ne.id===f):null,le=n.fontFamily==="things"?"font-things":"font-sans",$e=x.useRef(null),[Be,se]=x.useState(null),[Se,ce]=x.useState(null),[Ee,He]=x.useState(!1),[tt,ut]=x.useState(""),[Ge,mt]=x.useState(!1),[ht,Ie]=x.useState(!1),[ge,ie]=x.useState([]),[me,Q]=x.useState(-1);x.useEffect(()=>{z!=null&&z.ai_history?(ie(z.ai_history),Q(z.ai_history.length-1)):(ie([]),Q(-1))},[z==null?void 0:z.id,z==null?void 0:z.ai_history]);const X=x.useMemo(()=>{if(!f)return[];t.filter(rt=>rt.parent_id===f&&rt.status!=="deleted").sort((rt,q)=>(rt.order_index||0)-(q.order_index||0));const Te=rt=>t.filter(De=>De.parent_id===rt&&De.status!=="deleted").sort((De,st)=>(De.order_index||0)-(st.order_index||0)).map(De=>({id:De.id,title:De.title,description:De.description||void 0,start_date:De.start_date,due_date:De.due_date,dependencies:De.dependencies||[],subtasks:Te(De.id)}));return[{id:f,title:(z==null?void 0:z.title)||"Project",start_date:z==null?void 0:z.start_date,due_date:z==null?void 0:z.due_date,description:(z==null?void 0:z.description)||void 0,dependencies:[],subtasks:Te(f)}]},[f,t,z]),he=async ne=>{const Te=Ue=>{let ze=[];return Ue.forEach(Qe=>{ze.push(Qe),Qe.subtasks&&(ze=ze.concat(Te(Qe.subtasks)))}),ze},Ce=Te(ne),rt=new Set(Ce.map(Ue=>Ue.id).filter(Boolean)),q=Ue=>{const ze=t.filter(Z=>Z.parent_id===Ue&&Z.status!=="deleted");let Qe=[...ze];return ze.forEach(Z=>{Qe=Qe.concat(q(Z.id))}),Qe},st=q(f).filter(Ue=>!rt.has(Ue.id)).map(Ue=>Ue.id);st.length>0&&await d(st);const Y=[];for(const Ue of Ce){if(!Ue.id||Ue.id===f)continue;const ze=t.find(Vt=>Vt.id===Ue.id);if(!ze)continue;const Qe={};let Z=!1;Ue.start_date!==ze.start_date&&(Qe.start_date=Ue.start_date,Z=!0),Ue.due_date!==ze.due_date&&(Qe.due_date=Ue.due_date,Z=!0);const Ne=Ue.dependencies||[],Pe=ze.dependencies||[],We=[...Ne].sort(),kt=[...Pe].sort();(We.length!==kt.length||!We.every((Vt,Ft)=>Vt===kt[Ft]))&&(Qe.dependencies=Ue.dependencies,Z=!0),Z&&Y.push({id:Ue.id,data:Qe})}Y.length>0&&await u(Y);const Fe=Ce.filter(Ue=>!Ue.id);for(const Ue of Fe)await o({title:Ue.title||"New Task",parent_id:f,start_date:Ue.start_date,due_date:Ue.due_date,status:"todo"})},ke=x.useMemo(()=>{const ne=e.find(Te=>Te.name.toLowerCase()==="prompt");return ne?t.filter(Te=>Te.tags.includes(ne.id)&&Te.status!=="deleted"):[]},[t,e]),ee=async ne=>{let Te="";if(Be&&$e.current?Te=$e.current.state.doc.textBetween(Be.from,Be.to," "):$e.current?Te=$e.current.getText():Te=((z==null?void 0:z.description)||"").replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),!Te.trim()){alert("");return}Ie(!0),He(!0);try{if(Ge&&tt.trim()){const De=e.find(Y=>Y.name.trim().toLowerCase()==="prompt");let st=De==null?void 0:De.id;if(st||(st=await a("prompt")||void 0),st){const Y=await K5(tt);await o({title:Y,description:tt,tags:[st],status:"active"})}}const Ce=await W5(Te,(z==null?void 0:z.title)||"",ne),rt={id:crypto.randomUUID(),role:"assistant",content:Ce.fullResponse,created_at:new Date().toISOString(),prompt:ne||"AI Analysis",model:"gemini"},q=[...ge,rt];ie(q),Q(q.length-1),f&&r(f,{ai_history:q},[],{skipHistory:!0}),ut("")}catch(Ce){console.error(Ce),alert("AI Error: "+(Ce.message||"Unknown error"))}finally{Ie(!1)}},pe=ne=>{if($e.current&&Be){$e.current.chain().setTextSelection({from:Be.from,to:Be.to}).unsetHighlight().insertContent(ne).run();const Te=$e.current.getHTML();yt(Te),se(null),He(!1)}else $e.current&&alert("")},Re=ne=>{if($e.current){$e.current.commands.insertContent(ne);const Te=$e.current.getHTML();yt(Te),He(!1)}},_t=ne=>{const Te=ge.filter((Ce,rt)=>rt!==ne);ie(Te),Te.length===0?Q(-1):Q(Math.min(me,Te.length-1)),f&&r(f,{ai_history:Te},[],{skipHistory:!0})},Nt=(ne,Te)=>{const Ce=[...ge];Ce[ne]={...Ce[ne],content:Te},ie(Ce),f&&r(f,{ai_history:Ce},[],{skipHistory:!0})},[ot,Ot]=x.useState(!1),[we,qe]=x.useState(350),[Ke,it]=x.useState(!1),[Me,yt]=x.useState(""),[fe,ye]=x.useState(!1),[_e,ft]=x.useState(""),lt=x.useRef(null),nt=x.useRef(z==null?void 0:z.description);x.useEffect(()=>{if(f){const ne=localStorage.getItem(`projectNotesHeight_${f}`);qe(ne?parseInt(ne):350)}},[f]),x.useEffect(()=>{(z==null?void 0:z.description)!==void 0&&z.description!==nt.current&&(yt(z.description||""),nt.current=z.description)},[z==null?void 0:z.description]),x.useEffect(()=>{yt((z==null?void 0:z.description)||""),nt.current=z==null?void 0:z.description,z!=null&&z.description&&Ot(!0)},[f]),x.useEffect(()=>{const ne=setTimeout(()=>{f&&z&&Me!==z.description&&r(f,{description:Me})},500);return()=>clearTimeout(ne)},[Me,f]),x.useEffect(()=>{if(!Ke)return;const ne=Ce=>{const rt=Math.max(100,Math.min(800,Ce.clientY-200));qe(rt)},Te=()=>{it(!1),f&&localStorage.setItem(`projectNotesHeight_${f}`,we.toString())};return window.addEventListener("mousemove",ne),window.addEventListener("mouseup",Te),()=>{window.removeEventListener("mousemove",ne),window.removeEventListener("mouseup",Te)}},[Ke,we,f]);const[Et,jt]=x.useState(null);if(x.useEffect(()=>{if(!z){jt(null);return}const ne=z.images&&z.images.length>0?z.images[0]:z.cover_image;if(!ne){jt(null);return}const Te=new window.Image;Te.crossOrigin="Anonymous",Te.src=ne,Te.onload=()=>{try{const Ce=document.createElement("canvas"),rt=Ce.getContext("2d");if(!rt)return;Ce.width=50,Ce.height=50,rt.drawImage(Te,0,0,50,50);const q=rt.getImageData(0,0,50,50).data,De={};for(let Y=0;Y<q.length;Y+=4){const Fe=q[Y],Ue=q[Y+1],ze=q[Y+2];if(q[Y+3]<200||Fe>240&&Ue>240&&ze>240)continue;const Z=20,Ne=Math.floor(Fe/Z)*Z,Pe=Math.floor(Ue/Z)*Z,We=Math.floor(ze/Z)*Z,kt=`${Ne},${Pe},${We}`;De[kt]=(De[kt]||0)+1}const st=Object.entries(De).sort(([,Y],[,Fe])=>Fe-Y).map(([Y])=>Y);if(st.length>0){const Y=Z=>{const[Ne,Pe,We]=Z.split(",").map(Number);return Math.max(Ne,Pe,We)-Math.min(Ne,Pe,We)},Ue=st.slice(0,15).sort((Z,Ne)=>Y(Ne)-Y(Z)),ze=Ue[0],Qe=Ue[1]||ze;jt(`linear-gradient(135deg, rgba(${ze}, 0.25) 0%, rgba(${Qe}, 0.2) 100%)`)}else jt(null)}catch(Ce){console.warn("Gradient extraction failed:",Ce),jt(null)}},Te.onerror=()=>jt(null)},[z]),f&&z){const ne=Jn[z.color]||Jn.blue,Te=S.find(Ce=>Ce.id===f);return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main",children:[c.jsxs("div",{className:"flex items-center gap-4 px-6 py-4 border-b relative transition-[background] duration-500 bg-theme-header",style:{borderBottomColor:ne.color+"30",backgroundImage:Et||"none"},children:[c.jsx("button",{onClick:()=>{y?(l(y),b(null)):h(null)},className:"p-2 rounded-lg bg-transparent hover:bg-theme-hover text-theme-secondary hover:text-theme-primary transition-colors",title:y?"":"",children:c.jsx(jI,{size:20})}),c.jsx("div",{className:"flex-1 min-w-0",children:fe?c.jsx("input",{ref:lt,type:"text",value:_e,onChange:Ce=>ft(Ce.target.value),onKeyDown:Ce=>{Ce.key==="Enter"?(Ce.preventDefault(),_e.trim()&&f&&r(f,{title:_e.trim()}),ye(!1)):Ce.key==="Escape"&&(ye(!1),ft(z.title))},onBlur:()=>{_e.trim()&&_e!==z.title&&f&&r(f,{title:_e.trim()}),ye(!1)},className:`text-xl font-bold text-theme-primary ${le} w-full bg-transparent border-b-2 border-indigo-400 outline-none`,autoFocus:!0}):c.jsx("h1",{className:`text-xl font-bold text-theme-primary ${le} truncate cursor-pointer hover:text-indigo-600 transition-colors`,onClick:()=>{ft(z.title),ye(!0),setTimeout(()=>{var Ce;return(Ce=lt.current)==null?void 0:Ce.select()},0)},title:"",children:z.title})}),c.jsxs("div",{className:"px-3 py-1 rounded-full text-xs font-bold flex-shrink-0",style:{backgroundColor:ne.color+"20",color:ne.color},children:[(Te==null?void 0:Te.childCount)||0," "]}),c.jsxs("button",{onClick:()=>s(f),className:"flex items-center gap-1.5 px-3 py-1.5 bg-theme-hover hover:bg-theme-card rounded-lg text-sm text-theme-secondary hover:text-theme-primary transition-colors",title:"",children:[c.jsx(Rv,{size:14}),""]}),c.jsxs("div",{className:"flex items-center gap-1 bg-theme-hover p-0.5 rounded-lg ml-2",children:[c.jsx("button",{onClick:()=>v("list"),className:`p-1.5 rounded-md transition-all ${g==="list"?"bg-white shadow-sm text-indigo-500":"text-gray-400 hover:text-gray-600"}`,title:"",children:c.jsx(FI,{size:16})}),c.jsx("button",{onClick:()=>v("gantt"),className:`p-1.5 rounded-md transition-all ${g==="gantt"?"bg-white shadow-sm text-indigo-500":"text-gray-400 hover:text-gray-600"}`,title:"",children:c.jsx(Tz,{size:16})})]})]}),z.description&&c.jsxs("div",{className:"border-b bg-theme-hover",style:{borderBottomColor:ne.color+"30"},children:[c.jsx("div",{className:"flex items-center gap-2 px-6 py-1 cursor-pointer hover:bg-theme-card transition-colors",onClick:()=>Ot(!ot),children:c.jsx(Pr.div,{animate:{rotate:ot?90:0},transition:{duration:.15},children:c.jsx(rs,{size:16,className:"text-gray-400"})})}),ot&&c.jsxs("div",{className:"relative",children:[c.jsxs("div",{className:"px-6 pb-3 overflow-y-auto custom-scrollbar transition-all duration-200 relative group",style:{height:we},onKeyDown:Ce=>Ce.stopPropagation(),children:[c.jsx(n0,{onEditorReady:Ce=>{$e.current=Ce},onPolish:(Ce,rt,q)=>{se(rt),q&&ce(q),He(!0),ut("")},initialContent:Me,onChange:yt,editable:!0,descFontClass:"font-extralight",textSizeClass:"text-sm",className:"min-h-full pb-8 text-theme-secondary"}),c.jsx("button",{onClick:Ce=>{Ce.stopPropagation(),Ot(!1)},className:"absolute bottom-2 right-6 p-1.5 rounded-full bg-theme-main/80 hover:bg-theme-hover text-gray-400 hover:text-theme-secondary transition-all opacity-0 group-hover:opacity-100 flex items-center gap-1 text-xs font-medium backdrop-blur-sm z-10 border border-theme shadow-sm",title:"",children:c.jsx(rs,{size:14,className:"-rotate-90"})})]}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1.5 cursor-ns-resize hover:bg-indigo-200 transition-colors group",onMouseDown:()=>it(!0),children:c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-0 w-8 h-1 rounded-full bg-gray-300 group-hover:bg-indigo-400 transition-colors"})})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden relative",children:g==="list"?c.jsx(jR,{rootParentId:f}):c.jsx("div",{className:"h-full w-full",children:c.jsx(AR,{plan:X,onUpdatePlan:he,onEditTask:Ce=>s(Ce)})})}),i===f&&z&&c.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center bg-theme-main/95 backdrop-blur-sm overflow-y-auto pt-20",children:[c.jsx("div",{className:"w-full max-w-3xl px-4 pb-20",children:c.jsx(Lo,{initialData:z,onClose:()=>s(null)})}),c.jsx("button",{onClick:()=>s(null),className:"absolute top-6 right-6 p-2 text-gray-400 hover:text-theme-secondary rounded-full hover:bg-theme-hover transition-colors",children:c.jsx(un,{size:24})})]}),c.jsx(nte,{isOpen:Ee,onClose:()=>He(!1),position:Se||void 0,customPrompt:tt,setCustomPrompt:ut,onRun:ee,prompts:ke,saveToLibrary:Ge,setSaveToLibrary:mt,isLoading:ht,history:ge,historyIndex:me,setHistoryIndex:Q,onDeleteHistory:_t,onUpdateHistory:Nt,onReplace:pe,onInsert:Re})]})}return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main",children:[c.jsxs("div",{className:"flex items-center justify-between px-6 py-4 bg-theme-header backdrop-blur-sm border-b border-gray-200/50",children:[c.jsxs("div",{children:[c.jsx("h1",{className:`text-xl font-bold text-theme-primary ${le}`,children:""}),c.jsxs("p",{className:"text-xs text-theme-secondary mt-0.5",children:[S.length," "]})]}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("button",{onClick:$,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg text-sm font-medium transition-colors shadow-sm",children:[c.jsx(Sz,{size:16}),""]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(Kz,{size:14,className:"text-gray-400"}),c.jsx("input",{type:"range",min:180,max:400,value:w,onChange:ne=>C(parseInt(ne.target.value)),className:"w-24 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"}),c.jsxs("span",{className:"text-xs text-theme-secondary w-12",children:[w,"px"]})]})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6",onClick:()=>m(null),children:S.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx("div",{className:"w-24 h-24 bg-theme-hover rounded-2xl flex items-center justify-center mb-4",children:c.jsx(Sf,{size:40,className:"opacity-30"})}),c.jsx("p",{className:"text-lg font-medium",children:""}),c.jsx("p",{className:"text-sm mt-1",children:"project"})]}):c.jsx(lU,{children:c.jsx("div",{className:"flex flex-wrap gap-5",style:{display:"flex",flexWrap:"wrap",gap:"20px"},onDragOver:W,onDrop:R,children:_.map(ne=>c.jsx(ste,{project:ne,size:w,tags:e,isSelected:p===ne.id,isDragging:A===ne.id,isDropTarget:L===ne.id,onSelect:()=>m(ne.id),onDoubleClick:()=>h(ne.id),onDelete:()=>re(ne.id),onDragStart:()=>O(ne.id),onDragEnd:ae,registerRef:j,fontFamilyClass:le},ne.id))})})})]})},ste=({project:t,size:e,tags:n,isSelected:r,isDragging:s,isDropTarget:i,onSelect:o,onDoubleClick:a,onDragStart:l,onDragEnd:u,registerRef:d,fontFamilyClass:f})=>{const h=Jn[t.color]||Jn.blue,p=x.useMemo(()=>t.tags.some(w=>{const C=n.find(I=>I.id===w);return C&&C.name.includes("")}),[t.tags,n]),m=t.childCount>0?t.completedCount/t.childCount:0,y=10,b=2*Math.PI*y,g=b-m*b,v=w=>{w.dataTransfer.effectAllowed="move",w.dataTransfer.setData("text/plain",t.id),l()};return c.jsx(Pr.div,{layout:!0,layoutId:t.id,transition:{layout:{type:"spring",stiffness:350,damping:25,mass:.8}},ref:w=>d(t.id,w),draggable:!0,onDragStart:v,onDragEnd:u,className:`relative transition-opacity duration-200 ${s?"opacity-50 scale-95":""}`,style:{width:e,...i&&{marginRight:"8px",borderRight:"4px solid #6366f1"}},onDoubleClick:w=>{w.stopPropagation(),a()},children:c.jsx(Pr.div,{onClick:w=>{w.stopPropagation(),s||o()},className:`
                    relative rounded-[20px] overflow-hidden cursor-pointer group flex flex-col
                    bg-white dark:bg-gray-800 
                    shadow-[0_2px_8px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)]
                    border border-gray-100 dark:border-gray-700
                    transition-all duration-300 ease-out
                    ${r?"ring-2 ring-indigo-500 shadow-md":""}
                    ${s?"ring-2 ring-indigo-400":""}
                    ${p?"ring-1 ring-yellow-400/50":""}
                `,style:{height:e*.75},whileHover:s?{}:{y:-4,scale:1.01},children:c.jsxs("div",{className:"p-5 flex flex-col h-full bg-gradient-to-br from-white to-gray-50/50 dark:from-gray-800 dark:to-gray-800/50",children:[c.jsxs("div",{className:"flex justify-between items-start mb-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-lg font-bold shadow-sm",style:{backgroundColor:p?"#fefce8":h.color+"15",color:p?"#ca8a04":h.color},children:p?c.jsx(Jz,{size:18}):t.title.charAt(0).toUpperCase()}),c.jsx("div",{className:"relative w-8 h-8 flex items-center justify-center",children:c.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[c.jsx("circle",{cx:"16",cy:"16",r:y,stroke:"currentColor",strokeWidth:"2.5",fill:"none",className:"text-gray-100 dark:text-gray-700"}),c.jsx("circle",{cx:"16",cy:"16",r:y,stroke:h.color,strokeWidth:"2.5",fill:"none",strokeDasharray:b,strokeDashoffset:g,strokeLinecap:"round",className:"transition-all duration-1000 ease-out"})]})})]}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:`font-bold text-[17px] text-gray-800 dark:text-gray-100 leading-tight mb-1 truncate ${f}`,children:t.title}),c.jsxs("p",{className:"text-[11px] font-medium text-gray-400 dark:text-gray-500 uppercase tracking-wide",children:[t.completedCount," / ",t.childCount," Completed"]})]}),c.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:c.jsx("div",{className:"p-1 rounded text-gray-300 hover:text-gray-500",children:c.jsx(PI,{size:14})})})]})})})},Yy=[{id:"learning",label:"",icon:kf,row:0,col:0,color:"from-blue-500 to-cyan-400"},{id:"experience",label:"",icon:gz,row:0,col:1,color:"from-purple-500 to-pink-400"},{id:"leisure",label:"",icon:mz,row:0,col:2,color:"from-green-500 to-emerald-400"},{id:"work",label:"",icon:uz,row:1,col:0,color:"from-orange-500 to-amber-400"},{id:"core",label:"",icon:qI,row:1,col:1,color:"from-yellow-500 to-orange-400",isCenter:!0},{id:"family",label:"",icon:Iz,row:1,col:2,color:"from-rose-500 to-pink-400"},{id:"social",label:"",icon:Qz,row:2,col:0,color:"from-indigo-500 to-blue-400"},{id:"finance",label:"",icon:Zz,row:2,col:1,color:"from-emerald-500 to-teal-400"},{id:"health",label:"",icon:cu,row:2,col:2,color:"from-red-500 to-rose-400"}],ite=()=>{const{tasks:t,tags:e,themeSettings:n,setView:r}=x.useContext(En),[s,i]=x.useState(null),o=x.useMemo(()=>e.filter(h=>h.name.includes("")).map(h=>h.id),[e]),a=x.useMemo(()=>{const h={};return Yy.forEach(p=>{h[p.id]=e.filter(m=>m.name.includes(p.label)).map(m=>m.id)}),h},[e]),l=x.useMemo(()=>{const h=e.find(p=>p.name.toLowerCase()==="project");return h?t.filter(p=>{var m,y;return p.status!=="deleted"&&((m=p.tags)==null?void 0:m.includes(h.id))&&((y=p.tags)==null?void 0:y.some(b=>o.includes(b)))}).map(p=>({id:p.id,title:p.title,color:p.color||"blue",tags:p.tags||[]})):[]},[t,e,o]),u=x.useMemo(()=>{const h={};return Yy.forEach(p=>{h[p.id]=l.filter(m=>m.tags.some(y=>{var b;return(b=a[p.id])==null?void 0:b.includes(y)}))}),h},[l,a]),d=n.fontFamily==="things"?"font-things":"font-sans",f=h=>{localStorage.setItem("openProjectId",h),localStorage.setItem("previousView","annualplan"),r("project")};return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main",children:[c.jsx("div",{className:"flex items-center justify-between px-6 py-4 bg-theme-header backdrop-blur-sm border-b border-gray-200/50",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-xl shadow-lg",children:c.jsx(YI,{size:24,className:"text-white"})}),c.jsxs("div",{children:[c.jsx("h1",{className:`text-xl font-bold text-theme-primary ${d}`,children:""}),c.jsxs("p",{className:"text-xs text-theme-tertiary",children:[l.length," "]})]})]})}),c.jsx("div",{className:"flex-1 p-6 overflow-auto",onClick:()=>i(null),children:c.jsx("div",{className:"grid grid-cols-3 gap-4 h-full max-w-5xl mx-auto",children:Yy.map(h=>{const p=h.icon,m=u[h.id]||[];return c.jsxs(Pr.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:h.row*.1+h.col*.05},className:`
                                    relative rounded-2xl overflow-hidden
                                    bg-theme-card shadow-lg
                                    border border-gray-200/50 dark:border-gray-700/50
                                    ${h.isCenter?"ring-2 ring-yellow-400/50 shadow-yellow-100/30":""}
                                `,children:[c.jsxs("div",{className:`
                                    px-3 py-2 bg-gradient-to-r ${h.color}
                                    flex items-center gap-2
                                `,children:[c.jsx(p,{size:16,className:"text-white/90"}),c.jsx("span",{className:"text-sm font-bold text-white/95 drop-shadow-sm",children:h.label})]}),c.jsx("div",{className:"p-2 space-y-1 max-h-[calc(100%-40px)] overflow-y-auto",children:m.length===0?c.jsx("div",{className:"text-center py-4 text-theme-tertiary text-xs",children:""}):m.map(y=>{const b=Jn[y.color]||Jn.blue,g=s===y.id;return c.jsx(Pr.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:v=>{v.stopPropagation(),i(y.id)},onDoubleClick:v=>{v.stopPropagation(),f(y.id)},className:`
                                                        px-3 py-2 rounded-lg cursor-pointer
                                                        transition-all duration-150
                                                        ${g?"bg-indigo-100 dark:bg-indigo-900/30 ring-2 ring-indigo-500":"hover:bg-theme-hover"}
                                                    `,style:{borderLeft:`3px solid ${b.color}`},children:c.jsx("p",{className:`text-sm font-medium text-theme-primary line-clamp-2 ${d}`,children:y.title})},y.id)})}),m.length>0&&c.jsx("div",{className:"absolute top-2 right-2 px-2 py-0.5 bg-white/90 dark:bg-gray-800/90 rounded-full text-[10px] font-bold text-gray-600 dark:text-gray-300 shadow-sm",children:m.length})]},h.id)})})})]})},ote=()=>{const{advancedFilters:t,setAdvancedFilters:e,tags:n,tagFilter:r}=x.useContext(En);if(!r)return null;const s=n.filter(l=>{let u=l;for(;u.parent_id;){if(u.parent_id===r)return!0;u=n.find(d=>d.id===u.parent_id)||{parent_id:null}}return!1}),i=l=>{l&&e(u=>({...u,additionalTags:u.additionalTags.includes(l)?u.additionalTags.filter(d=>d!==l):[...u.additionalTags,l]}))},o=()=>{e({additionalTags:[],startDate:null,dueDate:null,color:null})},a=t.additionalTags.length>0;return c.jsxs("div",{className:"px-8 py-3 border-b border-gray-50 bg-gray-50/30 flex items-center gap-4 relative z-20",children:[c.jsx("div",{className:"flex items-center gap-2",children:c.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Filters:"})}),c.jsx(O1,{icon:Bl,label:"Sub-tags",items:s,selectedIds:t.additionalTags,onSelect:i,multiSelect:!0,placeholder:"Filter by sub-tags..."}),a&&c.jsxs("button",{onClick:o,className:"ml-auto flex items-center gap-1 text-[10px] text-gray-400 hover:text-red-500 transition-colors",children:[c.jsx(un,{size:12})," Clear"]})]})},ate=({toast:t,onClose:e})=>{const[n,r]=x.useState(!1);x.useEffect(()=>{requestAnimationFrame(()=>r(!0));const a=setTimeout(()=>{r(!1),setTimeout(e,300)},1e4);return()=>clearTimeout(a)},[t,e]);const s=()=>t.type==="error"?c.jsx(Zf,{size:16}):t.undo?c.jsx(dz,{size:16}):c.jsx(LI,{size:16}),i=()=>{t.onClick&&(t.onClick(),e())},o=a=>{a.stopPropagation(),r(!1),setTimeout(e,300)};return c.jsx("div",{className:`
                fixed top-4 left-1/2 -translate-x-1/2 z-[9999]
                transition-all duration-300 ease-out
                ${n?"opacity-100 translate-y-0":"opacity-0 -translate-y-4"}
            `,children:c.jsxs("div",{className:`
                    px-4 py-2.5 rounded-full shadow-lg flex items-center gap-3 backdrop-blur-md
                    ${t.type==="error"?"bg-red-500/90 text-white":"bg-gray-900/90 text-white"}
                    ${t.onClick?"cursor-pointer hover:bg-gray-800/95 transition-colors":""}
                `,onClick:t.onClick?i:void 0,children:[c.jsxs("div",{className:"flex items-center gap-2",children:[s(),c.jsx("span",{className:"text-sm font-medium",children:t.msg})]}),t.onClick&&!t.undo&&c.jsxs("div",{className:"flex items-center gap-1 text-xs text-white/70",children:[c.jsx(RI,{size:12}),c.jsx("span",{children:t.actionLabel||""})]}),t.undo&&c.jsxs("button",{onClick:a=>{var l;a.stopPropagation(),(l=t.undo)==null||l.call(t),e()},className:"flex items-center gap-1 px-2.5 py-1 bg-white/20 hover:bg-white/30 rounded-full text-xs font-bold transition-colors",children:[c.jsx(WI,{size:12}),"Undo"]}),c.jsx("button",{onClick:o,className:"p-1 -mr-1.5 rounded-full hover:bg-white/20 transition-colors",title:"",children:c.jsx(un,{size:14})})]})})},RR=t=>t.map(e=>({...e,id:e.id||crypto.randomUUID(),subtasks:e.subtasks?RR(e.subtasks):[]})),lte=({taskId:t,onClose:e})=>{const{tasks:n,tags:r,batchAddTasks:s,setToast:i}=x.useContext(En),[o,a]=x.useState("prompt"),[l,u]=x.useState(null),[d,f]=x.useState(null),[h,p]=x.useState(!1),[m,y]=x.useState(""),[b,g]=x.useState(""),[v,w]=x.useState("list"),[C,I]=x.useState([]),[k,D]=x.useState(-1);x.useEffect(()=>{l&&C.length===0&&(I([l]),D(0))},[l]);const S=j=>{const H=C.slice(0,k+1);H.push(j),I(H),D(H.length-1),u(j)},T=()=>{if(k>0){const j=k-1;D(j),u(C[j])}},_=()=>{if(k<C.length-1){const j=k+1;D(j),u(C[j])}};x.useEffect(()=>{const j=H=>{(H.metaKey||H.ctrlKey)&&H.key==="z"&&(H.preventDefault(),H.stopPropagation(),H.shiftKey?_():T())};return window.addEventListener("keydown",j,{capture:!0}),()=>window.removeEventListener("keydown",j,{capture:!0})},[k,C]);const N=n.find(j=>j.id===t),A=x.useMemo(()=>{const j=r.find(H=>H.name.trim().toLowerCase()==="prompt");return j?n.filter(H=>H.tags.includes(j.id)&&H.status!=="deleted"&&H.status!=="logged").sort((H,W)=>W.created_at.localeCompare(H.created_at)):[]},[n,r]),O=x.useMemo(()=>{if(!b.trim())return A.slice(0,10);const j=b.toLowerCase();return A.filter(H=>H.title.toLowerCase().includes(j)||(H.description||"").toLowerCase().includes(j)).slice(0,10)},[A,b]),L=async()=>{if(!N){f("Task not found"),a("error");return}a("loading");try{const j=new Date().toISOString().split("T")[0],H=new Date,W=new Date;W.setDate(W.getDate()+14);const R=n.filter(le=>le.status!=="deleted"&&le.status!=="completed"&&le.status!=="logged").filter(le=>{const $e=le.start_date||le.due_date;if(!$e)return!1;const Be=new Date($e);return Be>=H&&Be<=W}).map(le=>{var $e,Be;return`- ${(($e=le.start_date)==null?void 0:$e.split("T")[0])||((Be=le.due_date)==null?void 0:Be.split("T")[0])}: ${le.title}`}).slice(0,20),ae=N.title.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g,"").match(/.{1,2}/g)||[],re=n.filter(le=>le.status==="completed"||le.status==="logged").map(le=>{let $e=0;return ae.forEach(Be=>{le.title.includes(Be)&&$e++}),{task:le,score:$e}}).filter(le=>le.score>0).sort((le,$e)=>$e.score-le.score).slice(0,5).map(le=>`- [] ${le.task.title}: ${le.task.description||"()"}`),$=await BY(N.title,N.description||"",N.start_date||null,N.due_date||null,{today:j,existingSchedule:R,pastExperiences:re},m||void 0),z=RR($);u(z),I([z]),D(0),a("preview")}catch(j){console.error(j),f(j.message||"Failed to generate plan"),a("error")}},V=async()=>{if(l){p(!0);try{await s(l,t),i({msg:"72",type:"info"}),e()}catch(j){i({msg:""+j.message,type:"error"}),p(!1)}}},E=(j,H,W)=>{if(!l)return;const R=JSON.parse(JSON.stringify(l));let ae=R;for(let re=0;re<j.length-1;re++)ae=ae[j[re]].subtasks;ae[j[j.length-1]][H]=W,S(R)};return o==="prompt"?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-xl max-h-[80vh] flex flex-col animate-in slide-in-from-bottom-10 duration-200",children:[c.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-2xl",children:""}),c.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"72"})]}),c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 rounded-full p-1 hover:bg-gray-100",children:c.jsx(un,{size:20})})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-6 flex flex-col gap-4",children:[c.jsx("div",{className:"bg-indigo-50 p-3 rounded-lg border border-indigo-100",children:c.jsxs("p",{className:"text-sm text-indigo-700",children:["",c.jsx("strong",{children:N==null?void 0:N.title})]})}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),c.jsx("textarea",{value:m,onChange:j=>y(j.target.value),placeholder:"...",className:"w-full border border-gray-200 rounded-lg p-3 text-sm focus:ring-2 focus:ring-indigo-200 focus:border-indigo-400 resize-none",rows:3})]}),A.length>0&&c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),c.jsx("input",{type:"text",value:b,onChange:j=>g(j.target.value),placeholder:"...",className:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm mb-2 focus:ring-2 focus:ring-indigo-200 focus:border-indigo-400"}),c.jsx("div",{className:"flex flex-col gap-1 max-h-40 overflow-y-auto",children:O.map(j=>c.jsxs("button",{onClick:()=>y(j.description||j.title),className:"text-left p-2 rounded-lg hover:bg-gray-50 border border-gray-100 text-sm transition-colors",children:[c.jsx("span",{className:"font-medium text-gray-800",children:j.title}),j.description&&c.jsxs("p",{className:"text-xs text-gray-500 line-clamp-1 mt-0.5",children:[j.description.slice(0,80),"..."]})]},j.id))})]})]}),c.jsxs("div",{className:"px-6 py-4 border-t bg-white flex justify-end gap-3",children:[c.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:""}),c.jsxs("button",{onClick:L,className:"px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg flex items-center gap-2",children:[c.jsx(d1,{size:18}),""]})]})]})}):o==="loading"?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/30 backdrop-blur-sm",children:c.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 flex flex-col items-center gap-4 animate-in zoom-in duration-200",children:[c.jsx(yi,{className:"w-12 h-12 text-indigo-600 animate-spin"}),c.jsx("p",{className:"text-lg font-medium text-gray-700",children:"72..."}),c.jsx("p",{className:"text-sm text-gray-500",children:""})]})}):o==="error"?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/30 backdrop-blur-sm",children:c.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 w-[400px] flex flex-col gap-4",children:[c.jsxs("div",{className:"flex items-center gap-3 text-red-600",children:[c.jsx(Zf,{size:24}),c.jsx("h3",{className:"text-lg font-bold",children:""})]}),c.jsx("p",{className:"text-gray-600",children:d}),c.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[c.jsx("button",{onClick:()=>a("prompt"),className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700",children:""}),c.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700",children:""})]})]})}):c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col animate-in slide-in-from-bottom-10 duration-200",children:[c.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between sticky top-0 bg-white rounded-t-xl z-10",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-2xl",children:""}),c.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"72"})]}),c.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg",children:[c.jsx("button",{onClick:()=>w("list"),className:`px-3 py-1.5 text-sm rounded-md transition-all ${v==="list"?"bg-white shadow-sm text-indigo-600 font-medium":"text-gray-500 hover:text-gray-700"}`,children:""}),c.jsx("button",{onClick:()=>w("gantt"),className:`px-3 py-1.5 text-sm rounded-md transition-all ${v==="gantt"?"bg-white shadow-sm text-indigo-600 font-medium":"text-gray-500 hover:text-gray-700"}`,children:""})]})]}),c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 rounded-full p-1 hover:bg-gray-100",children:c.jsx(un,{size:20})})]}),c.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50/50 flex flex-col",children:v==="list"?c.jsxs("div",{className:"p-6",children:[c.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg border border-indigo-100 mb-4",children:[c.jsx("h3",{className:"font-bold text-indigo-900 mb-1",children:N==null?void 0:N.title}),c.jsx("p",{className:"text-sm text-indigo-700",children:"AI"})]}),c.jsx("div",{className:"flex flex-col gap-3",children:l==null?void 0:l.map((j,H)=>c.jsx(OR,{item:j,path:[H],onUpdate:E},H))})]}):c.jsx("div",{className:"flex-1 min-h-[500px] flex flex-col",children:l&&c.jsx(AR,{plan:l,onUpdatePlan:S})})}),c.jsxs("div",{className:"px-6 py-4 border-t bg-white rounded-b-xl flex justify-between sticky bottom-0 z-10",children:[c.jsxs("button",{onClick:()=>a("prompt"),className:"px-4 py-2 text-gray-500 hover:bg-gray-100 rounded-lg flex items-center gap-1",children:[c.jsx(Rg,{size:16})," "]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:e,className:"px-5 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",disabled:h,children:""}),c.jsxs("button",{onClick:V,disabled:h,className:"px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg shadow-sm flex items-center gap-2 disabled:opacity-70",children:[h?c.jsx(yi,{className:"animate-spin",size:18}):c.jsx(Xn,{size:18}),h?"...":""]})]})]})]})})},OR=({item:t,path:e,depth:n=0,onUpdate:r})=>{const[s,i]=x.useState(!0),o=t.subtasks&&t.subtasks.length>0;return c.jsxs("div",{className:"flex flex-col",children:[c.jsx("div",{className:`p-3 bg-white rounded-lg border border-gray-100 shadow-sm ${n>0?"ml-6":""}`,children:c.jsxs("div",{className:"flex items-start gap-2",children:[o?c.jsx("button",{onClick:()=>i(!s),className:"mt-1 text-gray-400 hover:text-gray-600",children:s?c.jsx(ts,{size:14}):c.jsx(rs,{size:14})}):c.jsx("div",{className:"w-[14px] mt-1"}),c.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[c.jsx("input",{type:"text",value:t.title,onChange:a=>r(e,"title",a.target.value),className:"font-medium text-gray-800 bg-transparent border-b border-transparent hover:border-gray-200 focus:border-indigo-400 focus:outline-none px-1 py-0.5 w-full",placeholder:""}),c.jsxs("div",{className:"flex items-start gap-1",children:[c.jsx(eh,{size:12,className:"text-gray-400 mt-1 flex-shrink-0"}),c.jsx("textarea",{value:t.description||"",onChange:a=>r(e,"description",a.target.value),placeholder:"...",className:"text-sm text-gray-600 bg-gray-50 border border-gray-100 rounded px-2 py-1 w-full resize-none focus:border-indigo-300 focus:outline-none",rows:2})]}),c.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(vo,{size:12,className:"text-gray-400"}),c.jsx("span",{className:"text-gray-500",children:":"}),c.jsx("input",{type:"date",value:t.start_date||"",onChange:a=>r(e,"start_date",a.target.value),className:"border border-gray-200 rounded px-1 py-0.5 text-xs focus:border-indigo-400 focus:outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("span",{className:"text-gray-500",children:":"}),c.jsx("input",{type:"date",value:t.due_date||"",onChange:a=>r(e,"due_date",a.target.value),className:"border border-gray-200 rounded px-1 py-0.5 text-xs focus:border-indigo-400 focus:outline-none"})]})]})]})]})}),o&&s&&c.jsx("div",{className:"flex flex-col gap-2 mt-2 pl-6 relative",children:t.subtasks.map((a,l)=>c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"absolute left-[-12px] top-[-14px] bottom-[20px] w-px bg-gray-200 -z-10"}),c.jsx("div",{className:"absolute left-[-12px] top-[26px] w-[12px] h-px bg-gray-200 -z-10"}),c.jsx(OR,{item:a,path:[...e,l],depth:n+1,onUpdate:r})]},l))})]})},wb=({taskId:t,initialData:e,onClose:n,isReadOnly:r=!1})=>{const{tasks:s,tags:i,updateTask:o,addTask:a,addTag:l,deleteTask:u,toggleExpansion:d,setToast:f,user:h}=x.useContext(En),{isRecording:p,startRecording:m,stopRecording:y,recordingTaskId:b}=x.useContext(Lu),g=t?s.find(q=>q.id===t):null,v=g||e||{},[w,C]=x.useState(v.title||""),[I,k]=x.useState(v.description||""),[D,S]=x.useState(v.start_date||""),[T,_]=x.useState(v.due_date||""),[N,A]=x.useState(v.tags||[]),[O,L]=x.useState(v.parent_id||null),[V,E]=x.useState(v.color||"blue"),[j,H]=x.useState(v.importance||"unplanned"),[W,R]=x.useState(v.repeat_rule||null),[ae,re]=x.useState(v.images||[]),[$,z]=x.useState(v.attachments||[]),[le,$e]=x.useState(v.is_all_day!==!1),[Be,se]=x.useState(()=>{if(v.start_time)return v.start_time;if(v.start_date&&!v.is_all_day){const q=new Date(v.start_date);return`${String(q.getHours()).padStart(2,"0")}:${String(q.getMinutes()).padStart(2,"0")}`}return""}),[Se,ce]=x.useState(()=>v.end_time?v.end_time:(v.start_date&&!v.is_all_day&&v.duration,"")),[Ee,He]=x.useState(()=>{if(t)try{const q=localStorage.getItem(`task_reminder_${t}`);if(q!==null)return JSON.parse(q)}catch{}return(g==null?void 0:g.reminder_minutes)??null}),[tt,ut]=x.useState(null),[Ge,mt]=x.useState(!1),[ht,Ie]=x.useState(!1),[ge,ie]=x.useState(!1),[me,Q]=x.useState(!1),[X,he]=x.useState(""),[ke,ee]=x.useState(!1),pe=x.useRef(null),[Re,_t]=x.useState(!1),[Nt,ot]=x.useState(null),[Ot,we]=x.useState(()=>{if(D){const q=new Date(D);return new Date(q.getFullYear(),q.getMonth(),1)}return new Date(new Date().getFullYear(),new Date().getMonth(),1)}),[qe,Ke]=x.useState(null),it=x.useRef(null),Me=x.useRef(null),yt=x.useRef(null),fe=x.useRef(null),ye=x.useRef(null);if(x.useEffect(()=>{const q=setTimeout(()=>Ie(!0),100);return()=>clearTimeout(q)},[]),x.useEffect(()=>{g?(C(g.title||""),k((g==null?void 0:g.description)||""),S(()=>{const q=g.start_date;return q?q.includes("T")?nt(new Date(q)):q:""}),_(g.due_date||""),A(g.tags||[]),L(g.parent_id||null),E(g.color||"blue"),H(g.importance||"unplanned"),R(g.repeat_rule||null),re(g.images||[]),z(g.attachments||[])):!t&&e?(C(e.title||""),k(e.description||""),S(e.start_date||""),_(e.due_date||""),A(e.tags||[]),L(e.parent_id||null),E(e.color||"blue"),H(e.importance||"unplanned"),R(e.repeat_rule||null),re(e.images||[]),z(e.attachments||[])):t||(C(""),k(""),S(""),_(""),A([]),L(null),E("blue"),H("unplanned"),R(null),re([]),z([]))},[g,t,e]),x.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]),x.useEffect(()=>{if(!t&&ht&&Me.current){const q=()=>{if(Me.current){window.scrollTo(0,0);const De=document.querySelector(".mobile-task-editor-content");De&&(De.scrollTop=0),Me.current.focus({preventScroll:!0}),Me.current.click()}};q(),setTimeout(q,100),setTimeout(q,300)}},[t,ht]),t&&!g)return null;const _e=async()=>{if(console.log("[MobileTaskEditor] handleSave called, title:",w),!w.trim()){f==null||f({msg:"",type:"error"});return}try{let q=D||null;D&&!le&&Be&&(q=`${D.split("T")[0]}T${Be}:00`);let De=null;if(!le&&Be&&Se){const[Y,Fe]=Be.split(":").map(Number),[Ue,ze]=Se.split(":").map(Number),Qe=Y*60+Fe;De=Ue*60+ze-Qe,De<0&&(De+=24*60)}const st={title:w.trim(),description:I,start_date:q,due_date:T||null,tags:N,parent_id:O,color:O?void 0:V,importance:j,repeat_rule:W,images:ae,attachments:$,is_all_day:le,start_time:le?null:Be,end_time:le?null:Se,duration:De,reminder_minutes:Ee};if(console.log("[MobileTaskEditor] taskData:",st),console.log("[MobileTaskEditor] taskId:",t),console.log("[MobileTaskEditor] addTask function:",typeof a),t)await o(t,st),O&&d(O,!0);else{const Y=await a({...st,status:"inbox"},[]);if(console.log("[MobileTaskEditor] addTask returned:",Y),!Y){console.error("[MobileTaskEditor] addTask returned empty - check supabaseClient"),f==null||f({msg:"",type:"error"});return}}f==null||f({msg:"",type:"info"}),n()}catch(q){console.error("[MobileTaskEditor] Save failed:",q),console.error("[MobileTaskEditor] Error details:",q==null?void 0:q.message,q==null?void 0:q.stack),f==null||f({msg:`: ${(q==null?void 0:q.message)||""}`,type:"error"})}},ft=()=>{t&&(u(t),f==null||f({msg:"",type:"info"})),n()},lt=q=>{if(!q)return"";const De=new Date(q),st=new Date,Y=new Date(st);return Y.setDate(Y.getDate()+1),De.toDateString()===st.toDateString()?"":De.toDateString()===Y.toDateString()?"":De.toLocaleDateString("zh-TW",{month:"short",day:"numeric",weekday:"short"})},nt=q=>{const De=q.getFullYear(),st=String(q.getMonth()+1).padStart(2,"0"),Y=String(q.getDate()).padStart(2,"0");return`${De}-${st}-${Y}`},Et={urgent:{label:"",color:"bg-red-500",text:"text-red-600",bg:"bg-red-50"},planned:{label:"",color:"bg-amber-500",text:"text-amber-600",bg:"bg-amber-50"},delegated:{label:"",color:"bg-green-500",text:"text-green-600",bg:"bg-green-50"},unplanned:{label:"",color:"bg-gray-400",text:"text-gray-500",bg:"bg-gray-50"}},jt=q=>{ht&&yt.current&&!yt.current.contains(q.target)&&n()},ne=async(q,De)=>{const st=q.target.files;if(!st||st.length===0||!h||!xe)return;ie(!0);const Y=st[0];try{const Fe=`${Date.now()}_${kI()}.${Y.name.split(".").pop()}`,ze=`${h.id}/${Fe}`,{error:Qe}=await xe.storage.from("attachments").upload(ze,Y,{contentType:Y.type,upsert:!1});if(Qe)throw Qe;const{data:Z}=xe.storage.from("attachments").getPublicUrl(ze);if(Z){const Ne={name:Y.name,url:Z.publicUrl,size:Y.size,type:Y.type};if(De){if(re(Pe=>[...Pe,Z.publicUrl]),t){const Pe=(g==null?void 0:g.images)||[];await o(t,{images:[...Pe,Z.publicUrl]},[],{skipHistory:!0})}f==null||f({msg:"",type:"info"})}else{if(z(Pe=>[...Pe,Ne]),t){const Pe=(g==null?void 0:g.attachments)||[];await o(t,{attachments:[...Pe,Ne]},[],{skipHistory:!0})}f==null||f({msg:"",type:"info"})}}}catch(Fe){console.error(Fe),f==null||f({msg:"",type:"error"})}finally{ie(!1),q.target&&(q.target.value="")}},Te=async(q,De)=>{if(confirm("")){if(De){if(re(st=>st.filter(Y=>Y!==q)),t){const st=(g==null?void 0:g.images)||[];await o(t,{images:st.filter(Y=>Y!==q)},[],{skipHistory:!0})}}else if(z(st=>st.filter(Y=>Y.url!==q)),t){const st=(g==null?void 0:g.attachments)||[];await o(t,{attachments:st.filter(Y=>Y.url!==q)},[],{skipHistory:!0})}}},Ce=q=>{if(qe===q&&it.current)it.current.paused?it.current.play():(it.current.pause(),Ke(null));else{it.current&&it.current.pause();const De=new Audio(q);De.onended=()=>Ke(null),it.current=De,De.play(),Ke(q)}},rt=c.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-end justify-center",onMouseDown:jt,style:{touchAction:"none"},children:[c.jsx("div",{className:"absolute inset-0 bg-black/40"}),c.jsxs(Pr.div,{ref:yt,initial:{y:"100%"},animate:{y:0},transition:{type:"spring",damping:25,stiffness:300},onMouseDown:q=>q.stopPropagation(),onTouchStart:q=>q.stopPropagation(),className:"relative w-full bg-white rounded-t-3xl max-h-[80dvh] flex flex-col overflow-hidden shadow-2xl",children:[c.jsx("div",{className:"flex justify-center pt-3 pb-2 flex-shrink-0",children:c.jsx("div",{className:"w-10 h-1.5 bg-gray-300 rounded-full"})}),c.jsxs("div",{className:"flex items-center justify-between px-5 pb-3 border-b border-gray-100 flex-shrink-0",children:[c.jsx("button",{type:"button",onClick:n,className:"text-gray-500 p-2 -ml-2 active:bg-gray-100 rounded-full",children:c.jsx(un,{size:24})}),p&&b===t?c.jsxs("div",{className:"flex items-center gap-2 text-red-500 animate-pulse font-medium",children:[c.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),"..."]}):c.jsx("h2",{className:"text-lg font-bold text-gray-800",children:r?"":t?"":""}),!r&&c.jsx("button",{type:"button",onClick:_e,className:"px-4 py-2 bg-indigo-600 text-white rounded-full font-bold text-sm active:bg-indigo-700",children:""})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-5 scroll-smooth mobile-task-editor-content pb-24",children:[c.jsxs("div",{className:"mb-6 relative",children:[c.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 block",children:""}),c.jsx("textarea",{ref:Me,readOnly:r,autoFocus:!t&&!r,rows:1,name:`task_title_no_autofill_${Math.random()}`,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",value:w,onChange:q=>{C(q.target.value),ee(q.target.value.length>0),q.target.style.height="auto",q.target.style.height=q.target.scrollHeight+"px"},onKeyDown:q=>{var De;q.key==="Enter"&&(q.preventDefault(),(De=Me.current)==null||De.blur())},onFocus:()=>ee(w.length>0),onBlur:()=>setTimeout(()=>ee(!1),200),placeholder:"...",className:"w-full text-xl font-medium text-gray-800 border-none outline-none bg-transparent placeholder-gray-300 p-0 resize-none overflow-hidden",style:{minHeight:"28px"}}),ke&&w.length>0&&(()=>{const q=s.filter(De=>De.id!==t&&De.title&&De.title.toLowerCase().includes(w.toLowerCase())&&De.title.toLowerCase()!==w.toLowerCase()).map(De=>De.title).filter((De,st,Y)=>Y.indexOf(De)===st).slice(0,5);return q.length===0?null:c.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white rounded-xl shadow-lg border border-gray-200 z-50 overflow-hidden",children:q.map((De,st)=>c.jsx("button",{type:"button",onMouseDown:Y=>{Y.preventDefault(),C(De),ee(!1)},className:"w-full text-left px-4 py-3 text-gray-700 hover:bg-indigo-50 border-b border-gray-100 last:border-b-0 transition-colors",children:De},st))})})()]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-6",children:[c.jsxs("button",{type:"button",onClick:()=>!r&&ut(tt==="date"?null:"date"),className:`flex flex-col items-center justify-center p-3 rounded-2xl border transition-all ${tt==="date"||D?"border-indigo-500 bg-indigo-50":"border-gray-200 bg-white"} ${r?"opacity-80":""}`,children:[c.jsx(vo,{size:20,className:D?"text-indigo-600":"text-gray-400"}),c.jsx("span",{className:`text-[10px] mt-1.5 font-bold truncate w-full ${D?"text-indigo-600":"text-gray-500"}`,children:D?lt(D):""})]}),c.jsxs("button",{type:"button",onClick:()=>!r&&Q(!0),className:`flex flex-col items-center justify-center p-3 rounded-2xl border transition-all ${me||N.length>0?"border-purple-500 bg-purple-50":"border-gray-200 bg-white"} ${r?"opacity-80":""}`,children:[c.jsx(az,{size:20,className:N.length>0?"text-purple-600":"text-gray-400"}),c.jsx("span",{className:`text-[10px] mt-1.5 font-bold truncate w-full ${N.length>0?"text-purple-600":"text-gray-500"}`,children:N.length>0?`${N.length} `:""})]})]}),tt==="date"&&c.jsxs("div",{className:"bg-gray-50 rounded-2xl p-4 space-y-4 mb-6 animate-in slide-in-from-top-2",children:[c.jsxs("div",{className:"flex gap-2 flex-wrap",children:[c.jsx("button",{type:"button",onClick:()=>S(nt(new Date)),className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${D===nt(new Date)?"bg-indigo-600 text-white":"bg-white border border-gray-200 text-gray-700"}`,children:""}),c.jsx("button",{type:"button",onClick:()=>{const q=new Date;q.setDate(q.getDate()+1),S(nt(q))},className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${(()=>{const q=new Date;return q.setDate(q.getDate()+1),D===nt(q)})()?"bg-indigo-600 text-white":"bg-white border border-gray-200 text-gray-700"}`,children:""}),c.jsx("button",{type:"button",onClick:()=>S(""),className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${D?"bg-white border border-gray-200 text-gray-700":"bg-gray-600 text-white"}`,children:""})]}),c.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[c.jsxs("div",{className:"flex items-center justify-between p-2 border-b border-gray-100",children:[c.jsx("button",{type:"button",onClick:()=>we(new Date(Ot.getFullYear(),Ot.getMonth()-1,1)),className:"p-2 hover:bg-gray-100 rounded-lg",children:c.jsx($u,{size:18,className:"text-gray-600"})}),c.jsxs("span",{className:"text-sm font-bold text-gray-700",children:[Ot.getFullYear()," ",Ot.getMonth()+1,""]}),c.jsx("button",{type:"button",onClick:()=>we(new Date(Ot.getFullYear(),Ot.getMonth()+1,1)),className:"p-2 hover:bg-gray-100 rounded-lg",children:c.jsx(rs,{size:18,className:"text-gray-600"})})]}),c.jsx("div",{className:"grid grid-cols-7 text-center text-[10px] font-bold text-gray-400 py-1 border-b border-gray-50",children:"".split("").map(q=>c.jsx("div",{children:q},q))}),c.jsx("div",{className:"grid grid-cols-7 gap-px bg-gray-100 p-px",children:(()=>{const q=new Date(Ot.getFullYear(),Ot.getMonth(),1),De=new Date(Ot.getFullYear(),Ot.getMonth()+1,0),st=q.getDay(),Y=[];for(let ze=0;ze<st;ze++)Y.push(null);for(let ze=1;ze<=De.getDate();ze++)Y.push(new Date(Ot.getFullYear(),Ot.getMonth(),ze));const Fe=nt(new Date),Ue=D?D.split("T")[0]:"";return Y.map((ze,Qe)=>{if(!ze)return c.jsx("div",{className:"bg-white"},`pad-${Qe}`);const Z=nt(ze),Ne=Z===Fe,Pe=Z===Ue,We=IR(ze),kt=MR(ze),Vt=ze.getDay()===0||ze.getDay()===6,Ft=s.filter(nn=>nn.id===t||!nn.start_date?!1:nn.start_date.split("T")[0]===Z).length;return c.jsxs("button",{type:"button",onClick:()=>S(Z),className:`relative bg-white p-1 min-h-[52px] flex flex-col items-center transition-all ${Pe?"ring-2 ring-indigo-500 ring-inset":""} ${Ne?"bg-indigo-50":""}`,children:[c.jsx("span",{className:`text-sm font-bold ${Pe?"text-indigo-600":We?"text-red-500":Vt?"text-red-400":"text-gray-700"}`,children:ze.getDate()}),We?c.jsx("span",{className:"text-[8px] text-red-400 font-medium leading-tight truncate w-full text-center",children:We}):kt?c.jsx("span",{className:"text-[8px] text-gray-400 leading-tight truncate w-full text-center",children:kt.slice(-2)}):null,Ft>0&&c.jsx("span",{className:"absolute bottom-0.5 right-0.5 w-4 h-4 bg-amber-500 text-white text-[9px] font-bold rounded-full flex items-center justify-center",children:Ft>9?"9+":Ft})]},Z)})})()})]}),c.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-xl border border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ri,{size:18,className:"text-gray-500"}),c.jsx("span",{className:"text-sm font-medium text-gray-700",children:""})]}),c.jsx("button",{type:"button",onClick:()=>$e(!le),className:`w-12 h-7 rounded-full transition-all ${le?"bg-indigo-600":"bg-gray-300"}`,children:c.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transition-transform ${le?"translate-x-6":"translate-x-1"}`})})]}),!le&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ri,{size:18,className:"text-gray-500"}),c.jsx("input",{type:"time",value:Be,onChange:q=>se(q.target.value),className:"flex-1 p-3 bg-white rounded-xl border border-gray-200 text-center"}),c.jsx(Dv,{size:16,className:"text-gray-400"}),c.jsx("input",{type:"time",value:Se,onChange:q=>ce(q.target.value),className:"flex-1 p-3 bg-white rounded-xl border border-gray-200 text-center"})]}),c.jsxs("div",{className:"p-3 bg-white rounded-xl border border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(Wa,{size:18,className:"text-gray-500"}),c.jsx("span",{className:"text-sm font-medium text-gray-700",children:""})]}),c.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"",value:null},{label:"",value:0},{label:"5",value:5},{label:"15",value:15},{label:"30",value:30},{label:"1",value:60}].map(q=>c.jsx("button",{type:"button",onClick:()=>{He(q.value),t&&(q.value!==null?localStorage.setItem(`task_reminder_${t}`,JSON.stringify(q.value)):localStorage.removeItem(`task_reminder_${t}`))},className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${Ee===q.value?"bg-indigo-600 text-white":"bg-gray-100 text-gray-600"}`,children:q.label},q.label))})]}),D&&(()=>{const q=D.split("T")[0],De=s.filter(st=>st.id===t||!st.start_date?!1:st.start_date.split("T")[0]===q).sort((st,Y)=>{const Fe=st.start_time||(st.is_all_day===!1&&st.start_date?new Date(st.start_date).toTimeString().slice(0,5):"99:99"),Ue=Y.start_time||(Y.is_all_day===!1&&Y.start_date?new Date(Y.start_date).toTimeString().slice(0,5):"99:99");return Fe.localeCompare(Ue)});return De.length===0?null:c.jsxs("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-xl",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(vo,{size:14,className:"text-amber-600"}),c.jsxs("span",{className:"text-xs font-bold text-amber-700",children:[" ",De.length," "]})]}),c.jsx("div",{className:"space-y-1.5 max-h-32 overflow-y-auto",children:De.map(st=>c.jsxs("div",{className:"flex items-center gap-2 text-xs text-amber-800 bg-white/60 rounded-lg px-2 py-1.5",children:[c.jsx("span",{className:"font-medium text-amber-600 w-12 flex-shrink-0",children:st.is_all_day!==!1?"":st.start_time||(st.start_date?new Date(st.start_date).toTimeString().slice(0,5):"--:--")}),c.jsx("span",{className:"truncate",children:st.title})]},st.id))})]})})()]}),tt==="importance"&&c.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 mb-6 grid grid-cols-2 gap-3 animate-in slide-in-from-top-2",children:Object.keys(Et).map(q=>c.jsxs("button",{onClick:()=>H(q),className:`flex items-center gap-2 p-3 rounded-xl border transition-all ${j===q?"border-gray-400 bg-white shadow-sm":"border-transparent hover:bg-white/50"}`,children:[c.jsx("div",{className:`w-3 h-3 rounded-full ${Et[q].color}`}),c.jsx("span",{className:"text-sm font-bold text-gray-700",children:Et[q].label}),j===q&&c.jsx(Xn,{size:16,className:"ml-auto text-gray-400"})]},q))}),tt==="repeat"&&c.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 mb-6 space-y-2 animate-in slide-in-from-top-2",children:[null,"daily","weekly","monthly"].map(q=>c.jsxs("button",{onClick:()=>R(q?{type:q,interval:1}:null),className:`w-full flex items-center justify-between p-3 rounded-xl ${(W==null?void 0:W.type)===q||!W&&!q?"bg-white shadow-sm border border-gray-200":"hover:bg-white/50"}`,children:[c.jsx("span",{className:"text-sm font-medium text-gray-700",children:{null:"",daily:"",weekly:"",monthly:""}[q]}),((W==null?void 0:W.type)===q||!W&&!q)&&c.jsx(Xn,{size:16,className:"text-blue-500"})]},q||"none"))}),tt==="tags"&&c.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 space-y-3 max-h-[40vh] overflow-y-auto mb-6 animate-in slide-in-from-top-2",children:i.map(q=>{const De=N.includes(q.id);return c.jsxs("button",{onClick:()=>A(st=>De?st.filter(Y=>Y!==q.id):[...st,q.id]),className:`w-full flex items-center justify-between p-3 rounded-xl transition-all ${De?"bg-white shadow-sm border border-purple-200":"bg-white border border-gray-200"}`,children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:q.color||"#6366f1"}}),c.jsx("span",{className:"text-sm font-medium",children:q.name})]}),De&&c.jsx(Xn,{size:18,className:"text-purple-600"})]},q.id)})}),($&&$.length>0||ae&&ae.length>0)&&c.jsxs("div",{className:"mb-6",children:[c.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 block",children:""}),c.jsxs("div",{className:"space-y-2",children:[ae.map((q,De)=>c.jsxs("div",{className:"relative group rounded-xl overflow-hidden border border-gray-200",children:[c.jsx("img",{src:q,alt:"Attachment",className:"w-full h-32 object-cover"}),!r&&c.jsx("button",{onClick:()=>Te(q,!0),className:"absolute top-2 right-2 p-1.5 bg-black/50 text-white rounded-full",children:c.jsx(un,{size:14})})]},q+De)),$.map((q,De)=>{var st;return c.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl border border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[(st=q.type)!=null&&st.startsWith("audio/")?c.jsx("button",{onClick:()=>Ce(q.url),className:`p-2 rounded-full ${qe===q.url?"bg-indigo-100 text-indigo-600":"bg-gray-200 text-gray-600"}`,children:qe===q.url?c.jsx(UI,{size:16}):c.jsx(HI,{size:16})}):c.jsx("div",{className:"p-2 bg-gray-200 rounded-lg text-gray-500",children:c.jsx(ho,{size:16})}),c.jsxs("div",{className:"flex flex-col overflow-hidden",children:[c.jsx("span",{className:"text-sm font-medium text-gray-700 truncate",children:q.name}),c.jsxs("span",{className:"text-[10px] text-gray-400",children:[Math.round((q.size||0)/1024)," KB"]})]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("a",{href:q.url,download:!0,target:"_blank",rel:"noreferrer",className:"p-2 text-gray-400 hover:text-indigo-600",children:c.jsx(lu,{size:16})}),!r&&c.jsx("button",{onClick:()=>Te(q.url,!1),className:"p-2 text-gray-400 hover:text-red-500",children:c.jsx(Er,{size:16})})]})]},q.url+De)})]})]}),c.jsxs("div",{className:"mb-6 min-h-[150px]",children:[c.jsx("div",{className:"flex items-center justify-between mb-2",children:c.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:""})}),c.jsx("div",{className:"bg-gray-50 rounded-xl px-1 py-1 focus-within:ring-2 focus-within:ring-indigo-100 border border-transparent",children:c.jsx(n0,{ref:pe,initialContent:I||"",onChange:k,placeholder:r?"...":"...",className:"min-h-[120px]",availableTags:i.map(q=>({...q,parent_id:q.parent_id||void 0})),onTagClick:()=>{},editable:!r})})]}),me&&c.jsxs("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center",onClick:()=>Q(!1),children:[c.jsx("div",{className:"absolute inset-0 bg-black/40"}),c.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-[90%] max-w-sm max-h-[60vh] flex flex-col overflow-hidden",onClick:q=>q.stopPropagation(),children:[c.jsxs("div",{className:"p-4 border-b border-gray-100",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h3",{className:"font-bold text-gray-800",children:""}),c.jsx("button",{onClick:()=>Q(!1),className:"p-1 text-gray-400 hover:text-gray-600",children:c.jsx(un,{size:20})})]}),c.jsxs("div",{className:"relative",children:[c.jsx(Wc,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),c.jsx("input",{type:"text",inputMode:"text",name:`tag_search_no_autofill_${Math.random()}`,autoComplete:"one-time-code",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",value:X,onChange:q=>he(q.target.value),placeholder:"...",className:"w-full pl-9 pr-4 py-2.5 bg-gray-100 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200 appearance-none",autoFocus:!0})]}),N.length>0&&c.jsxs("div",{className:"px-4 pb-3",children:[c.jsxs("div",{className:"text-xs text-gray-500 mb-2 font-medium",children:[" (",N.length,")"]}),c.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(q=>{const De=i.find(st=>st.id===q);return De?c.jsxs("button",{type:"button",onClick:()=>A(st=>st.filter(Y=>Y!==q)),className:"flex items-center gap-1.5 px-2.5 py-1.5 bg-purple-100 text-purple-700 rounded-lg text-xs font-medium hover:bg-purple-200 transition-colors",children:[c.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:De.color||"#6366f1"}}),c.jsx("span",{children:De.name}),c.jsx(un,{size:12,className:"ml-0.5"})]},q):null})})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[X.trim()&&!i.some(q=>q.name.toLowerCase()===X.toLowerCase())&&c.jsx("div",{className:"mb-2 border-b border-gray-100 pb-2",children:Re?c.jsxs("div",{className:"p-3 bg-indigo-50 rounded-xl space-y-3",children:[c.jsxs("div",{className:"text-sm font-bold text-indigo-700",children:[": ",X]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:" ()"}),c.jsxs("select",{value:Nt||"",onChange:q=>ot(q.target.value||null),className:"w-full p-2 bg-white border border-gray-200 rounded-lg text-sm",children:[c.jsx("option",{value:"",children:" ()"}),i.filter(q=>!q.parent_id).map(q=>c.jsx("option",{value:q.id,children:q.name},q.id))]})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{type:"button",onClick:()=>{_t(!1),ot(null)},className:"flex-1 py-2 text-sm font-medium text-gray-600 bg-gray-200 rounded-lg",children:""}),c.jsx("button",{type:"button",onClick:async()=>{if(!X.trim())return;const q=X.trim();try{const De=await l(q,Nt);De&&A(st=>[...st,De]),f==null||f({msg:` "${q}"`,type:"info"}),he(""),_t(!1),ot(null)}catch(De){console.error("Failed to create tag:",De),f==null||f({msg:"",type:"error"})}},className:"flex-1 py-2 text-sm font-medium text-white bg-indigo-600 rounded-lg",children:""})]})]}):c.jsxs("button",{type:"button",onClick:()=>_t(!0),className:"w-full flex items-center gap-3 p-3 bg-indigo-50 hover:bg-indigo-100 rounded-xl transition-colors text-left",children:[c.jsx("div",{className:"w-5 h-5 rounded-full bg-indigo-500 flex items-center justify-center text-white text-xs font-bold",children:"+"}),c.jsxs("span",{className:"text-sm font-medium text-indigo-700",children:[' "',X,'"']})]})}),i.filter(q=>q.name.toLowerCase().includes(X.toLowerCase())).map(q=>{var De;return c.jsxs("button",{type:"button",onClick:()=>{const st=N.includes(q.id);A(st?Y=>Y.filter(Fe=>Fe!==q.id):Y=>[...Y,q.id])},className:`w-full flex items-center gap-3 p-3 rounded-xl transition-colors text-left ${N.includes(q.id)?"bg-purple-50 border-2 border-purple-300":"hover:bg-gray-50 border-2 border-transparent"}`,children:[c.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:q.color||"#6366f1"}}),c.jsxs("div",{className:"flex flex-col flex-1",children:[c.jsx("span",{className:"text-sm font-medium text-gray-700",children:q.name}),q.parent_id&&c.jsx("span",{className:"text-[10px] text-gray-400",children:((De=i.find(st=>st.id===q.parent_id))==null?void 0:De.name)||""})]}),N.includes(q.id)&&c.jsx(Xn,{size:18,className:"text-purple-600 flex-shrink-0"})]},q.id)}),i.filter(q=>q.name.toLowerCase().includes(X.toLowerCase())).length===0&&!X.trim()&&c.jsx("div",{className:"p-4 text-center text-gray-400 text-sm",children:""})]})]})]}),c.jsx("div",{className:"pt-4 border-t border-gray-100 pb-4",children:!r&&(Ge?c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:()=>mt(!1),className:"flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-bold",children:""}),c.jsx("button",{onClick:ft,className:"flex-1 py-3 rounded-xl bg-red-500 text-white font-bold",children:""})]}):c.jsx("button",{onClick:()=>mt(!0),className:"w-full py-3 text-red-500 font-bold bg-red-50 rounded-xl",children:""}))})]}),!r&&c.jsxs("div",{className:"flex-shrink-0 border-t border-gray-100 p-3 bg-white/80 backdrop-blur-md pb-6 flex items-center justify-around",children:[c.jsx("input",{type:"file",ref:ye,accept:"image/*",className:"hidden",onChange:q=>ne(q,!0)}),c.jsx("input",{type:"file",ref:fe,className:"hidden",onChange:q=>ne(q,!1)}),c.jsxs("button",{onClick:()=>{var q;return(q=ye.current)==null?void 0:q.click()},disabled:ge,className:"p-3 text-gray-500 active:bg-gray-100 rounded-full flex flex-col items-center gap-1",children:[c.jsx(Sf,{size:24}),c.jsx("span",{className:"text-[10px]",children:""})]}),c.jsxs("button",{onClick:()=>{var q;return(q=fe.current)==null?void 0:q.click()},disabled:ge,className:"p-3 text-gray-500 active:bg-gray-100 rounded-full flex flex-col items-center gap-1",children:[c.jsx(ho,{size:24}),c.jsx("span",{className:"text-[10px]",children:""})]}),c.jsx("button",{onClick:async()=>{if(p)b===t||!t&&!b?y():f==null||f({msg:"",type:"error"});else{if(!t){f==null||f({msg:"",type:"error"});return}try{await m(t),f==null||f({msg:"",type:"info"})}catch(q){console.error("[MobileTaskEditor] Recording error:",q),f==null||f({msg:"",type:"error"})}}},className:`p-4 rounded-full transition-all flex items-center justify-center -mt-8 shadow-lg ${p&&b===t?"bg-red-500 text-white scale-110":"bg-indigo-600 text-white active:scale-95"}`,children:p&&b===t?c.jsx("div",{className:"w-6 h-6 bg-white rounded-sm"}):c.jsx(BI,{size:24})}),c.jsxs("button",{onClick:()=>ut(tt==="importance"?null:"importance"),className:`p-3 rounded-full flex flex-col items-center gap-1 ${j!=="unplanned"?"text-rose-600":"text-gray-500 active:bg-gray-100"}`,children:[c.jsx(Zf,{size:24}),c.jsx("span",{className:"text-[10px]",children:Et[j].label})]}),c.jsxs("button",{onClick:()=>ut(tt==="repeat"?null:"repeat"),className:`p-3 rounded-full flex flex-col items-center gap-1 ${W?"text-blue-600":"text-gray-500 active:bg-gray-100"}`,children:[c.jsx(Hz,{size:24}),c.jsx("span",{className:"text-[10px]",children:""})]})]})]})]});return ir.createPortal(rt,document.body)},kb=({onClose:t,initialData:e,isReadOnly:n=!1})=>{const r=!!e,[s,i]=Ln.useState(window.innerWidth<768),[o,a]=Ln.useState({});return Ln.useEffect(()=>{const l=()=>{const u=window.innerWidth<768;i(u),window.visualViewport&&a(u?{height:`${window.visualViewport.height}px`,top:`${window.visualViewport.offsetTop}px`,position:"fixed",bottom:"auto"}:{})};return window.addEventListener("resize",l),window.visualViewport&&(window.visualViewport.addEventListener("resize",l),window.visualViewport.addEventListener("scroll",l)),l(),()=>{window.removeEventListener("resize",l),window.visualViewport&&(window.visualViewport.removeEventListener("resize",l),window.visualViewport.removeEventListener("scroll",l))}},[]),s?c.jsx(wb,{taskId:(e==null?void 0:e.id)==="new"||e==null?void 0:e.id,initialData:e,onClose:t,isReadOnly:n}):c.jsx("div",{className:"fixed inset-0 z-[60] flex items-end md:items-center justify-center pointer-events-auto bg-black/20 md:bg-transparent",onClick:t,style:o,children:c.jsxs(Pr.div,{onClick:l=>l.stopPropagation(),drag:window.innerWidth>=768,dragMomentum:!1,dragElastic:.1,initial:{opacity:0,scale:.95,y:50},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:50},transition:{type:"spring",stiffness:300,damping:30},className:"bg-theme-card backdrop-blur-xl rounded-t-2xl md:rounded-2xl shadow-2xl w-full md:max-w-[600px] overflow-visible border border-theme ring-1 ring-black/5 flex flex-col max-h-[90vh] md:max-h-none",children:[c.jsx("div",{className:"md:hidden flex justify-center pt-2 pb-1",children:c.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full"})}),c.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-theme-header border-b border-theme cursor-grab active:cursor-grabbing backdrop-blur-sm select-none md:rounded-t-2xl",onPointerDown:l=>l.preventDefault(),children:[c.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[c.jsx(OI,{size:14,className:"text-gray-300 hidden md:block"}),c.jsx("span",{className:"text-xs md:text-[10px] font-bold uppercase tracking-widest text-theme-tertiary",children:n?"View Task":r?"Edit Task":"New Task"})]}),c.jsxs("button",{onClick:t,className:"w-8 h-8 md:w-7 md:h-7 flex items-center justify-center hover:bg-gray-200/80 rounded-full text-gray-400 hover:text-gray-600 transition-colors bg-gray-100/50",onPointerDown:l=>l.stopPropagation(),children:[c.jsx(un,{size:16,className:"md:hidden"}),c.jsx(un,{size:14,className:"hidden md:block"})]})]}),c.jsx("div",{className:"p-0 overflow-auto",children:c.jsx(Lo,{initialData:e,onClose:t,isQuickAdd:!r,autoFocus:!r&&!n,isEmbedded:!0,isReadOnly:n})})]})})},ep=({title:t,importance:e,tasks:n,onDrop:r,onAddTask:s,setEditingTaskId:i,bgColor:o,borderColor:a,titleColor:l,infoText:u})=>{const{updateGhostPosition:d,endDrag:f}=x.useContext(En),[h,p]=x.useState(!1),m=v=>{v.preventDefault(),p(!0),d(v.clientX,v.clientY)},y=()=>{p(!1)},b=v=>{v.preventDefault(),p(!1);const w=v.clientY,C=Array.from(v.currentTarget.querySelectorAll("[data-task-id]"));let I=null,k=Number.POSITIVE_INFINITY;C.forEach((S,T)=>{const _=S.getBoundingClientRect(),N=w-(_.top+_.height/2);Math.abs(N)<Math.abs(k)&&(k=N,I={element:S,offset:N,index:T})});let D;if(I){const S=I.index,T=n[S];if(T)if(I.offset<0){const _=n[S-1];_?D=((_.order_index||0)+(T.order_index||0))/2:D=(T.order_index||0)-1e4}else{const _=n[S+1];_?D=((T.order_index||0)+(_.order_index||0))/2:D=(T.order_index||0)+1e4}}else n.length>0?D=(n[n.length-1].order_index||0)+1e4:D=void 0;r(v,e,D)},g=()=>{p(!1),f()};return c.jsxs("div",{className:`flex flex-col h-full rounded-xl border-2 transition-all p-3 overflow-hidden ${h?"bg-indigo-50 border-indigo-400 scale-[1.01]":`${o} ${a}`}`,onDragOver:m,onDragLeave:y,onDrop:b,onDragEnd:g,children:[c.jsxs("div",{className:"flex justify-between items-center mb-3 flex-shrink-0",children:[c.jsxs("div",{className:"flex flex-col",children:[c.jsx("h3",{className:`font-bold text-lg ${l}`,children:t}),u&&c.jsx("span",{className:"text-[10px] text-gray-400 font-medium",children:u})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-xs font-medium text-gray-400 bg-white/50 px-2 py-0.5 rounded-full",children:n.length}),c.jsx("button",{onClick:()=>s(e),className:`p-1 rounded-full hover:bg-black/5 transition-colors ${l}`,children:c.jsx(ni,{size:16})})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar space-y-2 pr-1 pb-10",children:[n.map((v,w)=>c.jsx("div",{children:c.jsx(xl,{flatTask:{data:v,depth:0,hasChildren:!1,isExpanded:!1,path:[v.id],index:w},isFocused:!1,onEdit:()=>i(v.id)})},v.id)),n.length===0&&c.jsxs("div",{className:"h-full flex flex-col items-center justify-center opacity-30 text-center",children:[c.jsx("div",{className:`p-4 rounded-full bg-current mb-2 opacity-10 ${l}`,children:c.jsx(zI,{size:24})}),c.jsx("span",{className:`text-sm font-medium ${l}`,children:""})]})]})]})},cte=()=>{const{tasks:t,tags:e,viewTagFilters:n,updateTask:r,addTask:s,setEditingTaskId:i,setPendingFocusTaskId:o,endDrag:a}=x.useContext(En),l=x.useMemo(()=>{var b;const h=(b=e.find(g=>["schedule",""].includes(g.name.trim().toLowerCase())))==null?void 0:b.id,p=n.matrix||{include:[],exclude:[]},{include:m,exclude:y}=Array.isArray(p)?{include:p,exclude:[]}:p;return t.filter(g=>!(g.status==="deleted"||g.status==="logged"||g.status==="completed"||g.parent_id||h&&g.tags.includes(h)||g.tags.some(w=>{const C=e.find(I=>I.id===w);return C&&["schedule",""].includes(C.name.trim().toLowerCase())})||m.length>0&&!g.tags.some(w=>m.includes(w))||y.length>0&&g.tags.some(w=>y.includes(w))))},[t,e,n]),u={urgent:l.filter(h=>h.importance==="urgent"),planned:l.filter(h=>h.importance==="planned"),delegated:l.filter(h=>h.importance==="delegated"),unplanned:l.filter(h=>!h.importance||h.importance==="unplanned"||h.importance==="optional")},d=async(h,p,m)=>{const y=h.dataTransfer.getData("text/plain");if(y){const b={importance:p};m!==void 0&&(b.order_index=m),await r(y,b),await a()}},f=async h=>{const p=await s({title:"",importance:h,status:"inbox"});p&&o(p)};return c.jsxs("div",{className:"h-full p-6 flex flex-col overflow-hidden bg-white",children:[c.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[c.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[c.jsx(zI,{className:"text-indigo-600"}),"Eisenhower Matrix"]}),c.jsx("div",{className:"text-xs text-gray-400 font-medium bg-gray-100 px-3 py-1 rounded-full",children:"Shift+Alt inside tasks to move"})]}),c.jsxs("div",{className:"flex-1 grid grid-cols-2 grid-rows-2 gap-4 min-h-0",children:[c.jsx(ep,{title:" (Do Now)",infoText:"Urgent & Important",importance:"urgent",tasks:u.urgent,onDrop:d,onAddTask:f,setEditingTaskId:i,bgColor:"bg-red-50/50",borderColor:"border-red-100",titleColor:"text-red-600"}),c.jsx(ep,{title:" (Plan)",infoText:"Not Urgent but Important",importance:"planned",tasks:u.planned,onDrop:d,onAddTask:f,setEditingTaskId:i,bgColor:"bg-amber-50/50",borderColor:"border-amber-100",titleColor:"text-amber-600"}),c.jsx(ep,{title:" (Delegate)",infoText:"Urgent but Not Important",importance:"delegated",tasks:u.delegated,onDrop:d,onAddTask:f,setEditingTaskId:i,bgColor:"bg-green-50/50",borderColor:"border-green-100",titleColor:"text-green-600"}),c.jsx(ep,{title:" (Unplanned)",infoText:"Neither Urgent nor Important",importance:"unplanned",tasks:u.unplanned,onDrop:d,onAddTask:f,setEditingTaskId:i,bgColor:"bg-gray-50/50",borderColor:"border-gray-200",titleColor:"text-gray-500"})]})]})},ute=()=>{const{user:t,setToast:e}=x.useContext(En),[n,r]=x.useState(()=>{const _=localStorage.getItem(`work_logs_${t==null?void 0:t.id}`);return _?JSON.parse(_):[]}),[s,i]=x.useState(()=>new Date().toISOString().split("T")[0]),[o,a]=x.useState(!1),[l,u]=x.useState(""),[d,f]=x.useState(!1),h=_=>{localStorage.setItem(`work_logs_${t==null?void 0:t.id}`,JSON.stringify(_)),r(_)},p=x.useMemo(()=>n.find(_=>_.date===s),[n,s]),m=()=>{const _=new Date(s);_.setDate(_.getDate()-1),i(_.toISOString().split("T")[0])},y=()=>{const _=new Date(s);_.setDate(_.getDate()+1),i(_.toISOString().split("T")[0])},b=()=>{i(new Date().toISOString().split("T")[0])},g=_=>{const N=new Date(_),A=["","","","","","",""],O=N.getFullYear(),L=N.getMonth()+1,V=N.getDate(),E=A[N.getDay()];return`${O}${L}${V}${E}`},v=()=>`## ${g(s)}

### 

#### [/]
1. []
2. []

#### [/]
1. []
2. []

### 

|  |  |  |  |
|-------|------|------|------|
| 1 | [] | [] |  |
| 2 | [] | [] |  |

### 
- []
`,w=()=>{const _=v(),N={id:crypto.randomUUID(),date:s,content:_,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};h([...n,N]),u(_),a(!0)},C=()=>{u((p==null?void 0:p.content)||""),a(!0)},I=()=>{if(p){const _=n.map(N=>N.id===p.id?{...N,content:l,updated_at:new Date().toISOString()}:N);h(_)}a(!1),e==null||e({msg:"",type:"info"})},k=()=>{if(p&&confirm("")){const _=n.filter(N=>N.id!==p.id);h(_),a(!1),e==null||e({msg:"",type:"info"})}},D=async()=>{const N=((p==null?void 0:p.content)||"").replace(/^## /gm,"").replace(/^### /gm,"").replace(/^#### /gm,"").replace(/\*\*/g,"").replace(/\|/g,"	").replace(/-{3,}/g,"");try{await navigator.clipboard.writeText(N),f(!0),setTimeout(()=>f(!1),2e3),e==null||e({msg:"",type:"info"})}catch{e==null||e({msg:"",type:"error"})}},S=_=>_.split(`
`).map((N,A)=>{if(N.startsWith("## "))return c.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4 mt-6 first:mt-0",children:N.slice(3)},A);if(N.startsWith("### "))return c.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-3 mt-5",children:N.slice(4)},A);if(N.startsWith("#### "))return c.jsx("h4",{className:"text-base font-semibold text-gray-600 mb-2 mt-4",children:N.slice(5)},A);if(N.startsWith("| ")){const O=N.split("|").filter(V=>V.trim());return N.includes("---")?null:c.jsx("div",{className:"grid grid-cols-4 gap-2 px-2 py-1 text-sm border-b border-gray-100",children:O.map((V,E)=>c.jsx("span",{className:E===0?"font-medium":"text-gray-600",children:V.trim()},E))},A)}return N.match(/^\d+\. /)?c.jsx("p",{className:"text-sm text-gray-700 ml-6 mb-1",children:N},A):N.startsWith("- ")?c.jsxs("p",{className:"text-sm text-gray-700 ml-4 mb-1",children:[" ",N.slice(2)]},A):N.trim()===""?c.jsx("div",{className:"h-2"},A):c.jsx("p",{className:"text-sm text-gray-700 mb-1",children:N},A)}),T=s===new Date().toISOString().split("T")[0];return c.jsxs("div",{className:"h-full flex flex-col bg-white overflow-hidden",children:[c.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-white z-10",children:[c.jsx("div",{className:"flex items-center gap-4",children:c.jsxs("h2",{className:"font-bold text-gray-700 flex items-center gap-2",children:[c.jsx(kf,{size:18}),""]})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:m,className:"p-1.5 rounded hover:bg-gray-100 text-gray-500",children:c.jsx($u,{size:18})}),c.jsx("span",{className:"font-medium text-gray-700 min-w-[180px] text-center",children:g(s)}),c.jsx("button",{onClick:y,className:"p-1.5 rounded hover:bg-gray-100 text-gray-500",children:c.jsx(rs,{size:18})}),!T&&c.jsx("button",{onClick:b,className:"ml-2 px-2 py-1 text-xs bg-indigo-50 text-indigo-600 rounded hover:bg-indigo-100",children:""})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[p&&!o&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:D,className:"flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[d?c.jsx(Xn,{size:14}):c.jsx(DI,{size:14}),d?"":""]}),c.jsxs("button",{onClick:C,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 text-sm font-medium transition-colors",children:[c.jsx(Rg,{size:14}),""]}),c.jsx("button",{onClick:k,className:"flex items-center gap-1 px-3 py-1.5 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 text-sm font-medium transition-colors",children:c.jsx(Er,{size:14})})]}),o&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:()=>a(!1),className:"flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[c.jsx(un,{size:14}),""]}),c.jsxs("button",{onClick:I,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors",children:[c.jsx(KI,{size:14}),""]})]}),!p&&!o&&c.jsxs("button",{onClick:w,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors shadow-sm",children:[c.jsx(ni,{size:16}),""]})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-gray-50/50",children:o?c.jsx("div",{className:"max-w-3xl mx-auto",children:c.jsx("textarea",{value:l,onChange:_=>u(_.target.value),className:"w-full h-[calc(100vh-200px)] p-4 bg-white rounded-xl border border-gray-200 focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none font-mono text-sm resize-none",placeholder:"..."})}):p?c.jsx("div",{className:"max-w-3xl mx-auto bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:S(p.content)}):c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx(kf,{size:48,className:"mb-4 opacity-20"}),c.jsx("p",{className:"text-sm",children:""}),c.jsxs("button",{onClick:w,className:"mt-4 flex items-center gap-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors",children:[c.jsx(ni,{size:16}),""]})]})})]})},dte=({task:t,position:e,count:n})=>{const r=x.useRef(null);if(x.useLayoutEffect(()=>{e&&r.current&&(r.current.style.left=`${e.x}px`,r.current.style.top=`${e.y}px`)},[]),!e)return null;const s=c.jsxs("div",{ref:r,id:"drag-ghost",className:"fixed pointer-events-none rounded-lg border-2 border-indigo-500/50 p-3 w-64 flex items-center gap-3",style:{transform:"translate(16px, 16px) rotate(2deg)",zIndex:99999,backgroundColor:"#ffffff",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",opacity:1,isolation:"isolate"},children:[c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h4",{className:"font-medium text-sm text-gray-900 dark:text-gray-100 truncate",children:t.title||"()"}),n>1&&c.jsxs("p",{className:"text-xs text-indigo-500 font-medium",children:["+ ",n-1," "]})]}),c.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-pulse"})]});return ir.createPortal(s,document.body)},fte=t=>{switch(t){case"inbox":return"";case"waiting":return"";case"active":return"";case"someday":return"/";case"reference":return"";case"completed":return"";case"archived":return"";case"logged":return"";default:return t}},hte=({onClose:t})=>{const{tasks:e,selectedTaskIds:n,updateTask:r,setToast:s,tags:i}=x.useContext(En),[o,a]=x.useState(""),[l,u]=x.useState(0),d=x.useRef(null);x.useEffect(()=>{d.current&&d.current.focus()},[]),x.useEffect(()=>{u(0)},[o]);const f=y=>{y.key==="Escape"&&t()};x.useEffect(()=>(window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)),[]);const h=x.useMemo(()=>{if(!o.trim())return[];const y=o.toLowerCase();return e.filter(b=>{if(b.status==="deleted"||b.status==="archived"||b.status==="logged"||!b.title.toLowerCase().includes(y)||n.includes(b.id))return!1;for(const g of n)if(Mv(g,b.id,e))return!1;return!0}).slice(0,10)},[e,o,n]),p=async y=>{const b=e.find(g=>g.id===y);if(b)try{await Promise.all(n.map(g=>r(g,{parent_id:y}))),s({type:"success",msg:` ${n.length}  "${b.title}" `}),t()}catch(g){console.error(g),s({type:"error",msg:""})}},m=y=>{y.key==="ArrowDown"?(y.preventDefault(),u(b=>(b+1)%h.length)):y.key==="ArrowUp"?(y.preventDefault(),u(b=>(b-1+h.length)%h.length)):y.key==="Enter"&&(y.preventDefault(),h.length>0&&p(h[l].id))};return ir.createPortal(c.jsx(bo,{children:c.jsx(Pr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-[99999] flex items-start justify-center pt-[20vh]",onClick:t,children:c.jsxs(Pr.div,{initial:{opacity:0,scale:.95,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20},transition:{duration:.15},className:"w-full max-w-xl bg-white rounded-xl shadow-2xl overflow-hidden border border-gray-200",onClick:y=>y.stopPropagation(),children:[c.jsxs("div",{className:"p-3 border-b border-gray-100 flex items-center gap-3",children:[c.jsx(yz,{className:"text-gray-400",size:20}),c.jsx("input",{ref:d,type:"text",value:o,onChange:y=>a(y.target.value),onKeyDown:m,placeholder:` ${n.length} ...`,className:"flex-1 bg-transparent border-none outline-none text-base text-gray-800 placeholder:text-gray-400"}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-500 px-1.5 py-0.5 rounded border border-gray-200",children:"ESC"})})]}),c.jsxs("div",{className:"max-h-[300px] overflow-y-auto",children:[h.length===0&&o.trim()!==""&&c.jsx("div",{className:"p-8 text-center text-gray-400 text-sm",children:""}),h.length===0&&o.trim()===""&&c.jsx("div",{className:"p-8 text-center text-gray-400 text-sm",children:"..."}),h.map((y,b)=>{var v;const g=b===l;return c.jsxs("button",{onClick:()=>p(y.id),onMouseEnter:()=>u(b),className:`w-full text-left p-3 flex items-center gap-3 transition-colors ${g?"bg-indigo-50":"hover:bg-gray-50"}`,children:[c.jsx("div",{className:`w-1 h-8 rounded-full ${g?"bg-indigo-500":"bg-transparent"}`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:`font-medium truncate ${g?"text-indigo-900":"text-gray-700"}`,children:y.title}),c.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1.5 text-xs",children:[c.jsx("span",{className:"px-1.5 py-0.5 rounded-md bg-gray-100 border border-gray-200 text-gray-500 font-medium",children:fte(y.status)}),y.parent_id?c.jsxs("span",{className:"flex items-center gap-1 text-indigo-600 bg-indigo-50 border border-indigo-100 px-1.5 py-0.5 rounded-md",children:[c.jsx(AI,{size:10}),c.jsx("span",{className:"max-w-[100px] truncate",children:((v=e.find(w=>w.id===y.parent_id))==null?void 0:v.title)||""})]}):c.jsx("span",{className:"text-gray-400 border border-gray-200 px-1.5 py-0.5 rounded-md",children:""}),y.tags&&y.tags.length>0&&c.jsx("div",{className:"flex gap-1 items-center",children:y.tags.map(w=>{const C=i.find(I=>I.id===w);return C?c.jsxs("span",{className:"px-1.5 py-0.5 rounded-md border text-[10px]",style:{backgroundColor:`${C.color}15`,borderColor:`${C.color}30`,color:C.color},children:["#",C.name]},w):null})})]})]}),g&&c.jsx("span",{className:"text-[10px] text-indigo-400 font-medium px-2 flex-shrink-0",children:"Enter "})]},y.id)})]})]})})}),document.body)},pte={gray:"bg-gray-400",blue:"bg-blue-500",indigo:"bg-indigo-500",red:"bg-red-500",orange:"bg-orange-500",amber:"bg-amber-500",green:"bg-green-500",teal:"bg-teal-500",cyan:"bg-cyan-500",sky:"bg-sky-500",purple:"bg-purple-500",fuchsia:"bg-fuchsia-500",pink:"bg-pink-500",rose:"bg-rose-500"},mte=[{label:"5 ",minutes:5},{label:"30 ",minutes:30},{label:"1 ",minutes:60},{label:"2 ",minutes:120}],gte=({reminder:t,onSnooze:e,onMarkSeen:n,onSelect:r,onEdit:s})=>{const[i,o]=x.useState(!1),[a,l]=x.useState(""),[u,d]=x.useState({top:0,left:0}),[f,h]=x.useState(null),p=x.useRef(null),m=x.useRef(null);x.useEffect(()=>{if(!t.snoozed_until){h(null);return}const w=()=>{const I=Date.now(),D=new Date(t.snoozed_until).getTime()-I;if(D<=0){h(null);return}const S=Math.floor(D/1e3),T=Math.floor(S/60),_=Math.floor(T/60);_>0?h(`${_}${T%60}`):T>0?h(`${T}${S%60}`):h(`${S}`)};w();const C=setInterval(w,1e3);return()=>clearInterval(C)},[t.snoozed_until]);const y=()=>{p.current?(clearTimeout(p.current),p.current=null,s()):p.current=setTimeout(()=>{p.current=null,r()},250)},b=w=>{const C=new Date(w),k=new Date().getTime()-C.getTime(),D=Math.floor(k/6e4),S=Math.floor(k/36e5),T=Math.floor(k/864e5);return D<1?"":D<60?`${D} `:S<24?`${S} `:`${T} `},g=w=>new Date(w).toLocaleString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),v=()=>{const w=parseInt(a);w>0&&(e(w),o(!1),l(""))};return c.jsx("div",{className:`p-3 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer ${t.seen?"opacity-60":""}`,onClick:y,children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("div",{className:`w-2 h-2 mt-2 rounded-full ${pte[t.task_color]} flex-shrink-0`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:"font-medium text-gray-800 truncate",children:t.task_title}),c.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500 flex-wrap",children:[c.jsx(Ri,{size:10}),c.jsxs("span",{children:["",g(t.due_time)]}),c.jsx("span",{className:"text-gray-300",children:""}),c.jsx("span",{children:b(t.triggered_at)}),f&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"text-gray-300",children:""}),c.jsxs("span",{className:"text-orange-500 font-medium",children:[" ",f]})]})]})]}),c.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",onClick:w=>w.stopPropagation(),children:[c.jsx("button",{onClick:n,className:`p-1.5 rounded-lg transition-colors ${t.seen?"bg-green-100 text-green-600":"hover:bg-gray-100 text-gray-400 hover:text-green-600"}`,title:t.seen?"":"",children:t.seen?c.jsx(Xn,{size:14}):c.jsx(bz,{size:14})}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{ref:m,onClick:()=>{if(!i&&m.current){const w=m.current.getBoundingClientRect();d({top:w.bottom+4,left:w.right-160})}o(!i)},className:"p-1.5 rounded-lg hover:bg-gray-100 text-gray-400 hover:text-orange-500 transition-colors flex items-center gap-0.5",title:"",children:[c.jsx(Wa,{size:14}),c.jsx(ts,{size:10})]}),i&&ir.createPortal(c.jsxs("div",{className:"fixed w-40 bg-white rounded-lg shadow-xl border border-gray-200 z-[10001] overflow-hidden",style:{top:u.top,left:u.left},"data-snooze-menu":"true",children:[mte.map(w=>c.jsxs("button",{onClick:()=>{e(w.minutes),o(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-orange-50 text-gray-700 hover:text-orange-600 transition-colors",children:[w.label,""]},w.minutes)),c.jsx("div",{className:"border-t border-gray-100 p-2",children:c.jsxs("div",{className:"flex gap-1",children:[c.jsx("input",{type:"number",value:a,onChange:w=>l(w.target.value),placeholder:"",className:"flex-1 px-2 py-1 text-xs border rounded w-16",min:1}),c.jsx("span",{className:"text-xs text-gray-500 self-center",children:""}),c.jsx("button",{onClick:v,className:"px-2 py-1 text-xs bg-orange-500 text-white rounded hover:bg-orange-600",children:""})]})})]}),document.body)]})]})]})})},yte=()=>{const{reminders:t,markAsSeen:e,snoozeReminder:n,clearAllSeen:r,clearAllUnseen:s,clearAll:i,unseenCount:o,isReminderPanelOpen:a,setIsReminderPanelOpen:l}=x.useContext(NI),{setFocusedTaskId:u,setSelectedTaskIds:d,navigateToTask:f}=x.useContext(En),h=x.useRef(null);x.useEffect(()=>{const b=g=>{const v=g.target;if(h.current&&h.current.contains(v))return;const w=document.querySelector('[data-snooze-menu="true"]');w&&w.contains(v)||l(!1)};return a&&document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[a,l]);const p=b=>{u(b),d([b]),f(b,!1,"allview"),l(!1),setTimeout(()=>{const g=document.querySelector(`[data-task-id="${b}"]`);g&&g.scrollIntoView({behavior:"smooth",block:"center"})},300)},m=b=>{f(b,!0,"allview"),l(!1)},y=[...t].sort((b,g)=>b.seen!==g.seen?b.seen?1:-1:new Date(g.triggered_at).getTime()-new Date(b.triggered_at).getTime());return c.jsxs("div",{className:"relative",ref:h,children:[c.jsx("button",{onClick:()=>l(!a),className:`p-1.5 rounded-lg transition-colors ${a?"bg-orange-100 text-orange-600":"hover:bg-gray-100 text-gray-500 hover:text-orange-500"}`,title:"",children:c.jsxs("div",{className:"relative",children:[c.jsx(Wa,{size:18}),o>0&&c.jsx("span",{className:"absolute -top-1.5 -right-1.5 w-3.5 h-3.5 bg-red-500 text-white text-[9px] font-bold rounded-full flex items-center justify-center animate-pulse ring-2 ring-white",children:o>9?"9+":o})]})}),c.jsx(bo,{children:a&&c.jsxs(Pr.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15},className:"absolute right-0 top-full mt-2 w-80 md:w-96 bg-white rounded-xl shadow-2xl border border-gray-200 z-[9999] overflow-hidden",children:[c.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 flex items-center justify-between bg-gradient-to-r from-orange-50 to-amber-50",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Wa,{size:16,className:"text-orange-500"}),c.jsx("span",{className:"font-bold text-gray-800",children:""}),o>0&&c.jsxs("span",{className:"px-1.5 py-0.5 bg-red-500 text-white text-[10px] font-bold rounded-full",children:[o," "]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[o>0&&c.jsx("button",{onClick:s,className:"px-2 py-1 rounded-lg text-[10px] font-bold bg-red-100 text-red-600 hover:bg-red-200 transition-colors",title:"",children:""}),t.some(b=>b.seen)&&c.jsx("button",{onClick:r,className:"p-1.5 rounded-lg hover:bg-white/50 text-gray-400 hover:text-red-500 transition-colors",title:"",children:c.jsx(Er,{size:14})}),t.length>0&&c.jsx("button",{onClick:i,className:"p-1.5 rounded-lg hover:bg-white/50 text-gray-400 hover:text-red-500 transition-colors",title:"",children:c.jsx(un,{size:14})})]})]}),c.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:y.length===0?c.jsxs("div",{className:"py-12 text-center text-gray-400",children:[c.jsx(i1,{size:32,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{className:"text-sm",children:""})]}):y.map(b=>c.jsx(gte,{reminder:b,onSnooze:g=>n(b.id,g),onMarkSeen:()=>e(b.id),onSelect:()=>p(b.task_id),onEdit:()=>m(b.task_id)},b.id))}),c.jsx("div",{className:"px-4 py-2 border-t border-gray-100 bg-gray-50 text-[10px] text-gray-400",children:c.jsx("span",{children:"  "})})]})})]})},xte={capture:{label:"",icon:"",color:"bg-gray-100 text-gray-600"},clarify:{label:"",icon:"",color:"bg-yellow-100 text-yellow-600"},organize:{label:"",icon:"",color:"bg-blue-100 text-blue-600"},engage:{label:"",icon:"",color:"bg-green-100 text-green-600"}},bte=({taskId:t,onClose:e})=>{const{tasks:n,tags:r,updateTask:s,batchAddTasks:i}=x.useContext(En),[o,a]=x.useState(""),[l,u]=x.useState([]),[d,f]=x.useState(!1),h=x.useRef(null),p=x.useRef(!1),[m,y]=x.useState("capture"),[b,g]=x.useState([]),v=n.find(_=>_.id===t),w=()=>{setTimeout(()=>{var _;(_=h.current)==null||_.scrollIntoView({behavior:"smooth"})},100)};x.useEffect(()=>{w()},[l,b]),x.useEffect(()=>{if(v&&!p.current)if(p.current=!0,v.ai_history&&v.ai_history.length>0){const _=v.ai_history.map(N=>({id:N.id,role:N.role,content:N.content,timestamp:new Date(N.created_at).getTime()}));_.sort((N,A)=>N.timestamp-A.timestamp),u(_)}else I("",!0)},[v]);const C=async _=>{if(!v)return;const N={id:_.id,role:_.role,content:_.content,created_at:new Date(_.timestamp).toISOString()},A=v.ai_history||[];A.some(O=>O.id===_.id)||await s(v.id,{ai_history:[...A,N]},void 0,{skipHistory:!0})},I=async(_,N=!1)=>{if(!v||!_.trim()&&!N)return;g([]);let A=null;N||(A={id:crypto.randomUUID(),role:"user",content:_,timestamp:Date.now()},u(O=>[...O,A]),C(A),a("")),f(!0);try{const O=v.parent_id?n.find(re=>re.id===v.parent_id):null,L=v.tags.map(re=>{var $;return(($=r.find(z=>z.id===re))==null?void 0:$.name)||re}),V={title:v.title,description:v.description||"",status:v.status,created_at:v.created_at,due_date:v.due_date,start_date:v.start_date,tags:L,project_title:O==null?void 0:O.title},E=new Date,j=new Date;j.setDate(E.getDate()+14);const H=n.filter(re=>{if(re.status==="completed"||re.status==="deleted")return!1;const $=re.start_date||re.due_date;if(!$)return!1;const z=new Date($);return z>=E&&z<=j}).sort((re,$)=>(re.start_date||re.due_date||"").localeCompare($.start_date||$.due_date||"")).map(re=>{var $,z;return`[${(($=re.start_date)==null?void 0:$.split("T")[0])||((z=re.due_date)==null?void 0:z.split("T")[0])}] ${re.title}`}).slice(0,30),W=l.filter(re=>re.role!=="system").map(re=>({role:re.role,content:re.content}));A&&W.push({role:"user",content:A.content});const R=await HY(V,H,N?" GTD ":_,W);R.current_stage&&y(R.current_stage),R.actions&&R.actions.length>0&&g(R.actions);const ae={id:crypto.randomUUID(),role:"assistant",content:R.reply,timestamp:Date.now()};u(re=>[...re,ae]),C(ae)}catch(O){console.error(O);const L={id:crypto.randomUUID(),role:"assistant",content:"",timestamp:Date.now()};u(V=>[...V,L])}finally{f(!1)}},k=async()=>{if(!v)return;const _=[];try{for(const N of b)if(N.type==="update_task"){const A={};if(N.params.title&&(A.title=N.params.title),N.params.description&&(A.description=N.params.description),N.params.due_date&&(A.due_date=N.params.due_date),N.params.start_date&&(A.start_date=N.params.start_date),N.params.start_time&&(A.start_time=N.params.start_time),N.params.reminder_minutes!==void 0&&(A.reminder_minutes=N.params.reminder_minutes),N.params.tags&&N.params.tags.length>0){const O=N.params.tags.map(L=>{const V=r.find(E=>E.name.toLowerCase()===L.toLowerCase());return V?V.id:null}).filter(Boolean);O.length>0&&(A.tags=O)}Object.keys(A).length>0&&(await s(v.id,A),_.push(""))}else N.type==="add_subtasks"&&N.params.tasks&&N.params.tasks.length>0&&(await i(N.params.tasks.map(A=>({...A,status:"todo",start_date:A.start_date,start_time:A.start_time,reminder_minutes:A.reminder_minutes,due_date:A.due_date})),v.id),_.push(` ${N.params.tasks.length} `));if(_.length>0){const N={id:crypto.randomUUID(),role:"system",content:_.map(A=>` ${A}`).join(`
`),timestamp:Date.now()};u(A=>[...A,N]),C(N)}g([])}catch(N){console.error("Action execution failed:",N),alert("")}},D=(_,N,A,O)=>{g(L=>{const V=[...L],E={...V[_]};if(E.type==="update_task")E.params={...E.params,[N]:A};else if(E.type==="add_subtasks"&&typeof O=="number"){const j=[...E.params.tasks];j[O]={...j[O],[N]:A},E.params={...E.params,tasks:j}}return V[_]=E,V})},S=_=>{g(N=>N.filter((A,O)=>O!==_))},T=(_,N)=>{g(A=>{const O=[...A],L=O[_];if(L.type==="add_subtasks"){const V=[...L.params.tasks];if(V.splice(N,1),V.length===0)return A.filter((E,j)=>j!==_);O[_]={...L,params:{...L.params,tasks:V}}}return O})};return v?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md h-[700px] flex flex-col animate-in slide-in-from-bottom-5 duration-200 overflow-hidden border border-indigo-100 font-sans",children:[c.jsxs("div",{className:"px-4 py-3 border-b bg-gradient-to-r from-indigo-50 to-white",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600",children:c.jsx(Ds,{size:16})}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-sm font-bold text-gray-900",children:"GTD "}),c.jsx("p",{className:"text-xs text-indigo-600 flex items-center gap-1",children:v.title.length>10?v.title.slice(0,10)+"...":v.title})]})]}),c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 p-1.5 rounded-full transition-colors",children:c.jsx(un,{size:18})})]}),c.jsxs("div",{className:"flex justify-between items-center px-2 py-1 bg-gray-50 rounded-lg relative overflow-hidden",children:[Object.entries(xte).map(([_,N],A)=>{const O=m===_;return c.jsxs("div",{className:`flex flex-col items-center z-10 transition-all duration-300 ${O?"scale-110 opacity-100":"opacity-40 scale-90"}`,children:[c.jsx("span",{className:"text-base mb-0.5",children:N.icon}),c.jsx("span",{className:`text-[10px] font-bold ${O?"text-indigo-600":"text-gray-500"}`,children:N.label})]},_)}),c.jsx("div",{className:"absolute top-1/2 left-0 w-full h-0.5 bg-gray-200 -z-0 transform -translate-y-1/2"})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50/50 space-y-4",children:[l.map(_=>c.jsxs("div",{className:`flex gap-3 ${_.role==="user"?"flex-row-reverse":""}`,children:[c.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${_.role==="user"?"bg-gray-200":_.role==="system"?"bg-green-100 text-green-600":"bg-indigo-600 text-white"}`,children:_.role==="user"?c.jsx(JI,{size:14,className:"text-gray-600"}):_.role==="system"?c.jsx(au,{size:14}):c.jsx(cz,{size:14})}),c.jsxs("div",{className:`max-w-[90%] rounded-2xl px-4 py-2.5 text-sm shadow-sm ${_.role==="user"?"bg-white text-gray-800 border border-gray-100 rounded-tr-none":_.role==="system"?"bg-green-50 text-green-800 border border-green-100":"bg-white text-gray-800 border border-indigo-100 rounded-tl-none"}`,children:[c.jsx("div",{className:"prose prose-sm prose-indigo max-w-none",children:c.jsx(uk,{children:_.content})}),c.jsx("span",{className:"text-[10px] text-gray-400 mt-1 block text-right",children:new Date(_.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},_.id)),b.length>0&&c.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-0 overflow-hidden shadow-sm animate-in fade-in slide-in-from-bottom-2",children:[c.jsx("div",{className:"px-3 py-2 bg-amber-100/50 border-b border-amber-200 flex items-center justify-between",children:c.jsxs("div",{className:"flex items-center gap-1.5 text-amber-800",children:[c.jsx(iz,{size:14}),c.jsx("span",{className:"text-xs font-bold",children:" ()"})]})}),c.jsx("div",{className:"p-3 space-y-3",children:b.map((_,N)=>c.jsxs("div",{className:"bg-white rounded-lg border border-amber-100 p-2 shadow-sm relative group",children:[c.jsx("button",{onClick:()=>S(N),className:"absolute right-2 top-2 text-gray-300 hover:text-red-500 hover:bg-gray-100 p-1 rounded transition-all z-10",title:"",children:c.jsx(un,{size:14})}),_.type==="update_task"&&c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500 font-bold uppercase tracking-wider mb-1",children:[c.jsx(Rg,{size:12})," "]}),c.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[_.params.title!==void 0&&c.jsx("input",{type:"text",value:_.params.title||"",onChange:A=>D(N,"title",A.target.value),className:"w-full text-xs font-bold border border-gray-200 rounded px-1.5 py-1 focus:ring-1 focus:ring-amber-300 outline-none",placeholder:""}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded border border-gray-100 flex-1",children:[c.jsx("span",{className:"text-[10px] text-gray-400",children:""}),c.jsx("input",{type:"date",value:_.params.start_date||"",onChange:A=>D(N,"start_date",A.target.value),className:"flex-1 text-xs bg-transparent outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded border border-gray-100 w-24",children:[c.jsx(Ri,{size:10,className:"text-gray-400"}),c.jsx("input",{type:"time",value:_.params.start_time||"",onChange:A=>D(N,"start_time",A.target.value),className:"flex-1 text-xs bg-transparent outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded border border-gray-100 w-28",children:[c.jsx(Wa,{size:10,className:"text-gray-400"}),c.jsxs("select",{value:_.params.reminder_minutes??-1,onChange:A=>{const O=parseInt(A.target.value);D(N,"reminder_minutes",O===-1?null:O)},className:"flex-1 text-xs bg-transparent outline-none",children:[c.jsx("option",{value:-1,children:""}),c.jsx("option",{value:0,children:""}),c.jsx("option",{value:10,children:"10"}),c.jsx("option",{value:30,children:"30"}),c.jsx("option",{value:60,children:"1"})]})]})]}),_.params.description!==void 0&&c.jsx("textarea",{value:_.params.description||"",onChange:A=>D(N,"description",A.target.value),className:"w-full text-xs border border-gray-200 rounded px-1.5 py-1 focus:ring-1 focus:ring-amber-300 outline-none resize-none h-16",placeholder:""})]})]}),_.type==="add_subtasks"&&c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500 mb-2 font-bold uppercase tracking-wider",children:[c.jsx(Rz,{size:12})," "]}),c.jsx("ul",{className:"space-y-2",children:_.params.tasks.map((A,O)=>c.jsxs("li",{className:"flex flex-col gap-1.5 bg-gray-50 p-2 rounded relative group/item border border-transparent hover:border-gray-200 transition-colors",children:[c.jsxs("div",{className:"flex gap-2 w-full pr-5",children:[c.jsx("input",{type:"text",value:A.title,onChange:L=>D(N,"title",L.target.value,O),className:"flex-1 bg-white text-xs border border-gray-200 rounded px-1.5 py-1 focus:ring-1 focus:ring-amber-300 outline-none",placeholder:""}),c.jsx("button",{onClick:()=>T(N,O),className:"absolute right-1 top-1 text-gray-300 hover:text-red-500 p-1 opacity-0 group-hover/item:opacity-100 transition-opacity",title:"",children:c.jsx(Er,{size:12})})]}),c.jsxs("div",{className:"flex flex-wrap gap-2 text-[10px]",children:[c.jsxs("div",{className:"flex items-center gap-1 bg-white rounded border border-gray-200 px-1 py-0.5 min-w-[100px]",children:[c.jsx("span",{className:"text-gray-400",children:""}),c.jsx("input",{type:"date",value:A.start_date||"",onChange:L=>D(N,"start_date",L.target.value,O),className:"flex-1 outline-none min-w-0 bg-transparent"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-white rounded border border-gray-200 px-1 py-0.5 w-[80px]",children:[c.jsx(Ri,{size:10,className:"text-gray-400"}),c.jsx("input",{type:"time",value:A.start_time||"",onChange:L=>D(N,"start_time",L.target.value,O),className:"flex-1 outline-none min-w-0 bg-transparent"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-white rounded border border-gray-200 px-1 py-0.5 w-[85px]",children:[c.jsx(Wa,{size:10,className:"text-gray-400"}),c.jsxs("select",{value:A.reminder_minutes??-1,onChange:L=>{const V=parseInt(L.target.value);D(N,"reminder_minutes",V===-1?null:V,O)},className:"flex-1 outline-none bg-transparent",children:[c.jsx("option",{value:-1,children:""}),c.jsx("option",{value:0,children:""}),c.jsx("option",{value:10,children:"10"}),c.jsx("option",{value:60,children:"1hr"})]})]})]})]},O))})]})]},N))}),c.jsxs("div",{className:"p-2 border-t border-amber-200/50 flex gap-2",children:[c.jsx("button",{onClick:()=>g([]),className:"flex-1 py-1.5 text-xs text-gray-500 hover:bg-gray-100 rounded-lg transition-colors",children:""}),c.jsxs("button",{onClick:k,className:"flex-1 py-1.5 bg-amber-500 hover:bg-amber-600 text-white rounded-lg text-sm font-bold shadow-sm transition-colors flex items-center justify-center gap-1.5",children:[" (",b.length,")"]})]})]}),d&&c.jsxs("div",{className:"flex gap-3",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-600 text-white flex items-center justify-center flex-shrink-0",children:c.jsx(yi,{size:14,className:"animate-spin"})}),c.jsxs("div",{className:"bg-white px-4 py-3 rounded-2xl rounded-tl-none shadow-sm border border-indigo-100 flex items-center gap-2",children:[c.jsx("span",{className:"w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),c.jsx("span",{className:"w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),c.jsx("span",{className:"w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]}),c.jsx("div",{ref:h})]}),c.jsxs("div",{className:"p-3 bg-white border-t border-gray-100",children:[c.jsxs("form",{onSubmit:_=>{_.preventDefault(),I(o)},className:"relative",children:[c.jsxs("div",{className:"relative flex items-end gap-2 bg-gray-50 border border-gray-200 rounded-2xl p-2 focus-within:ring-2 focus-within:ring-indigo-100 focus-within:border-indigo-300 transition-all",children:[c.jsx("textarea",{value:o,onChange:_=>{a(_.target.value),_.target.style.height="auto",_.target.style.height=_.target.scrollHeight+"px"},onKeyDown:_=>{_.key==="Enter"&&(_.metaKey||_.ctrlKey)&&(_.preventDefault(),I(o))},placeholder:" GTD ... (Cmd + Enter )",className:"flex-1 bg-transparent border-none focus:ring-0 text-sm resize-none max-h-32 min-h-[24px] py-1 px-1 custom-scrollbar leading-relaxed outline-none",disabled:d,rows:1,style:{height:"auto",minHeight:"24px"}}),c.jsx("button",{type:"submit",disabled:!o.trim()||d,className:"p-1.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors self-end mb-0.5",title:"Cmd + Enter ",children:c.jsx(Wz,{size:16})})]}),c.jsx("div",{className:"text-[10px] text-gray-400 text-right mt-1 pr-1",children:"Cmd + Enter  / Enter "})]}),c.jsx("div",{className:"mt-2 flex gap-2 overflow-x-auto pb-1 no-scrollbar",children:["","","",""].map(_=>c.jsx("button",{onClick:()=>I(_),disabled:d,className:"px-2.5 py-1 bg-gray-50 hover:bg-indigo-50 text-gray-600 hover:text-indigo-600 border border-gray-100 hover:border-indigo-100 rounded-full text-xs whitespace-nowrap transition-colors",children:_},_))})]})]})}):null},PR=6048e5,vte=864e5,LR=6e4,$R=36e5,yE=Symbol.for("constructDateFrom");function _o(t,e){return typeof t=="function"?t(e):t&&typeof t=="object"&&yE in t?t[yE](e):t instanceof Date?new t.constructor(e):new Date(e)}function Ws(t,e){return _o(e||t,t)}function zR(t,e,n){const r=Ws(t,n==null?void 0:n.in);return isNaN(e)?_o((n==null?void 0:n.in)||t,NaN):(e&&r.setDate(r.getDate()+e),r)}let wte={};function a0(){return wte}function Vf(t,e){var a,l,u,d;const n=a0(),r=(e==null?void 0:e.weekStartsOn)??((l=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:l.weekStartsOn)??n.weekStartsOn??((d=(u=n.locale)==null?void 0:u.options)==null?void 0:d.weekStartsOn)??0,s=Ws(t,e==null?void 0:e.in),i=s.getDay(),o=(i<r?7:0)+i-r;return s.setDate(s.getDate()-o),s.setHours(0,0,0,0),s}function ug(t,e){return Vf(t,{...e,weekStartsOn:1})}function FR(t,e){const n=Ws(t,e==null?void 0:e.in),r=n.getFullYear(),s=_o(n,0);s.setFullYear(r+1,0,4),s.setHours(0,0,0,0);const i=ug(s),o=_o(n,0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);const a=ug(o);return n.getTime()>=i.getTime()?r+1:n.getTime()>=a.getTime()?r:r-1}function xE(t){const e=Ws(t),n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),+t-+n}function BR(t,...e){const n=_o.bind(null,t||e.find(r=>typeof r=="object"));return e.map(n)}function dg(t,e){const n=Ws(t,e==null?void 0:e.in);return n.setHours(0,0,0,0),n}function kte(t,e,n){const[r,s]=BR(n==null?void 0:n.in,t,e),i=dg(r),o=dg(s),a=+i-xE(i),l=+o-xE(o);return Math.round((a-l)/vte)}function Ste(t,e){const n=FR(t,e),r=_o((e==null?void 0:e.in)||t,0);return r.setFullYear(n,0,4),r.setHours(0,0,0,0),ug(r)}function tp(t,e,n){const[r,s]=BR(n==null?void 0:n.in,t,e);return+dg(r)==+dg(s)}function _te(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function Tte(t){return!(!_te(t)&&typeof t!="number"||isNaN(+Ws(t)))}function Cte(t,e){const n=Ws(t,e==null?void 0:e.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}const Ete={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Nte=(t,e,n)=>{let r;const s=Ete[t];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",e.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function gu(t){return(e={})=>{const n=e.width?String(e.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const jte={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Ite={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Mte={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Dte={date:gu({formats:jte,defaultWidth:"full"}),time:gu({formats:Ite,defaultWidth:"full"}),dateTime:gu({formats:Mte,defaultWidth:"full"})},Ate={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Rte=(t,e,n,r)=>Ate[t];function uo(t){return(e,n)=>{const r=n!=null&&n.context?String(n.context):"standalone";let s;if(r==="formatting"&&t.formattingValues){const o=t.defaultFormattingWidth||t.defaultWidth,a=n!=null&&n.width?String(n.width):o;s=t.formattingValues[a]||t.formattingValues[o]}else{const o=t.defaultWidth,a=n!=null&&n.width?String(n.width):t.defaultWidth;s=t.values[a]||t.values[o]}const i=t.argumentCallback?t.argumentCallback(e):e;return s[i]}}const Ote={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Pte={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Lte={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},$te={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},zte={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Fte={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Bte=(t,e)=>{const n=Number(t),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},Ute={ordinalNumber:Bte,era:uo({values:Ote,defaultWidth:"wide"}),quarter:uo({values:Pte,defaultWidth:"wide",argumentCallback:t=>t-1}),month:uo({values:Lte,defaultWidth:"wide"}),day:uo({values:$te,defaultWidth:"wide"}),dayPeriod:uo({values:zte,defaultWidth:"wide",formattingValues:Fte,defaultFormattingWidth:"wide"})};function fo(t){return(e,n={})=>{const r=n.width,s=r&&t.matchPatterns[r]||t.matchPatterns[t.defaultMatchWidth],i=e.match(s);if(!i)return null;const o=i[0],a=r&&t.parsePatterns[r]||t.parsePatterns[t.defaultParseWidth],l=Array.isArray(a)?Vte(a,f=>f.test(o)):Hte(a,f=>f.test(o));let u;u=t.valueCallback?t.valueCallback(l):l,u=n.valueCallback?n.valueCallback(u):u;const d=e.slice(o.length);return{value:u,rest:d}}}function Hte(t,e){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return n}function Vte(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return n}function UR(t){return(e,n={})=>{const r=e.match(t.matchPattern);if(!r)return null;const s=r[0],i=e.match(t.parsePattern);if(!i)return null;let o=t.valueCallback?t.valueCallback(i[0]):i[0];o=n.valueCallback?n.valueCallback(o):o;const a=e.slice(s.length);return{value:o,rest:a}}}const Wte=/^(\d+)(th|st|nd|rd)?/i,Kte=/\d+/i,Gte={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},qte={any:[/^b/i,/^(a|c)/i]},Yte={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Jte={any:[/1/i,/2/i,/3/i,/4/i]},Xte={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Qte={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Zte={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},ene={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},tne={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},nne={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},rne={ordinalNumber:UR({matchPattern:Wte,parsePattern:Kte,valueCallback:t=>parseInt(t,10)}),era:fo({matchPatterns:Gte,defaultMatchWidth:"wide",parsePatterns:qte,defaultParseWidth:"any"}),quarter:fo({matchPatterns:Yte,defaultMatchWidth:"wide",parsePatterns:Jte,defaultParseWidth:"any",valueCallback:t=>t+1}),month:fo({matchPatterns:Xte,defaultMatchWidth:"wide",parsePatterns:Qte,defaultParseWidth:"any"}),day:fo({matchPatterns:Zte,defaultMatchWidth:"wide",parsePatterns:ene,defaultParseWidth:"any"}),dayPeriod:fo({matchPatterns:tne,defaultMatchWidth:"any",parsePatterns:nne,defaultParseWidth:"any"})},sne={code:"en-US",formatDistance:Nte,formatLong:Dte,formatRelative:Rte,localize:Ute,match:rne,options:{weekStartsOn:0,firstWeekContainsDate:1}};function ine(t,e){const n=Ws(t,e==null?void 0:e.in);return kte(n,Cte(n))+1}function one(t,e){const n=Ws(t,e==null?void 0:e.in),r=+ug(n)-+Ste(n);return Math.round(r/PR)+1}function HR(t,e){var d,f,h,p;const n=Ws(t,e==null?void 0:e.in),r=n.getFullYear(),s=a0(),i=(e==null?void 0:e.firstWeekContainsDate)??((f=(d=e==null?void 0:e.locale)==null?void 0:d.options)==null?void 0:f.firstWeekContainsDate)??s.firstWeekContainsDate??((p=(h=s.locale)==null?void 0:h.options)==null?void 0:p.firstWeekContainsDate)??1,o=_o((e==null?void 0:e.in)||t,0);o.setFullYear(r+1,0,i),o.setHours(0,0,0,0);const a=Vf(o,e),l=_o((e==null?void 0:e.in)||t,0);l.setFullYear(r,0,i),l.setHours(0,0,0,0);const u=Vf(l,e);return+n>=+a?r+1:+n>=+u?r:r-1}function ane(t,e){var a,l,u,d;const n=a0(),r=(e==null?void 0:e.firstWeekContainsDate)??((l=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:l.firstWeekContainsDate)??n.firstWeekContainsDate??((d=(u=n.locale)==null?void 0:u.options)==null?void 0:d.firstWeekContainsDate)??1,s=HR(t,e),i=_o((e==null?void 0:e.in)||t,0);return i.setFullYear(s,0,r),i.setHours(0,0,0,0),Vf(i,e)}function lne(t,e){const n=Ws(t,e==null?void 0:e.in),r=+Vf(n,e)-+ane(n,e);return Math.round(r/PR)+1}function Pn(t,e){const n=t<0?"-":"",r=Math.abs(t).toString().padStart(e,"0");return n+r}const la={y(t,e){const n=t.getFullYear(),r=n>0?n:1-n;return Pn(e==="yy"?r%100:r,e.length)},M(t,e){const n=t.getMonth();return e==="M"?String(n+1):Pn(n+1,2)},d(t,e){return Pn(t.getDate(),e.length)},a(t,e){const n=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(t,e){return Pn(t.getHours()%12||12,e.length)},H(t,e){return Pn(t.getHours(),e.length)},m(t,e){return Pn(t.getMinutes(),e.length)},s(t,e){return Pn(t.getSeconds(),e.length)},S(t,e){const n=e.length,r=t.getMilliseconds(),s=Math.trunc(r*Math.pow(10,n-3));return Pn(s,e.length)}},_c={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},bE={G:function(t,e,n){const r=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(t,e,n){if(e==="yo"){const r=t.getFullYear(),s=r>0?r:1-r;return n.ordinalNumber(s,{unit:"year"})}return la.y(t,e)},Y:function(t,e,n,r){const s=HR(t,r),i=s>0?s:1-s;if(e==="YY"){const o=i%100;return Pn(o,2)}return e==="Yo"?n.ordinalNumber(i,{unit:"year"}):Pn(i,e.length)},R:function(t,e){const n=FR(t);return Pn(n,e.length)},u:function(t,e){const n=t.getFullYear();return Pn(n,e.length)},Q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return Pn(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return Pn(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(t,e,n){const r=t.getMonth();switch(e){case"M":case"MM":return la.M(t,e);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(t,e,n){const r=t.getMonth();switch(e){case"L":return String(r+1);case"LL":return Pn(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(t,e,n,r){const s=lne(t,r);return e==="wo"?n.ordinalNumber(s,{unit:"week"}):Pn(s,e.length)},I:function(t,e,n){const r=one(t);return e==="Io"?n.ordinalNumber(r,{unit:"week"}):Pn(r,e.length)},d:function(t,e,n){return e==="do"?n.ordinalNumber(t.getDate(),{unit:"date"}):la.d(t,e)},D:function(t,e,n){const r=ine(t);return e==="Do"?n.ordinalNumber(r,{unit:"dayOfYear"}):Pn(r,e.length)},E:function(t,e,n){const r=t.getDay();switch(e){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(t,e,n,r){const s=t.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return Pn(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(s,{width:"short",context:"formatting"});case"eeee":default:return n.day(s,{width:"wide",context:"formatting"})}},c:function(t,e,n,r){const s=t.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return Pn(i,e.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(s,{width:"narrow",context:"standalone"});case"cccccc":return n.day(s,{width:"short",context:"standalone"});case"cccc":default:return n.day(s,{width:"wide",context:"standalone"})}},i:function(t,e,n){const r=t.getDay(),s=r===0?7:r;switch(e){case"i":return String(s);case"ii":return Pn(s,e.length);case"io":return n.ordinalNumber(s,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(t,e,n){const s=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(t,e,n){const r=t.getHours();let s;switch(r===12?s=_c.noon:r===0?s=_c.midnight:s=r/12>=1?"pm":"am",e){case"b":case"bb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(t,e,n){const r=t.getHours();let s;switch(r>=17?s=_c.evening:r>=12?s=_c.afternoon:r>=4?s=_c.morning:s=_c.night,e){case"B":case"BB":case"BBB":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(t,e,n){if(e==="ho"){let r=t.getHours()%12;return r===0&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return la.h(t,e)},H:function(t,e,n){return e==="Ho"?n.ordinalNumber(t.getHours(),{unit:"hour"}):la.H(t,e)},K:function(t,e,n){const r=t.getHours()%12;return e==="Ko"?n.ordinalNumber(r,{unit:"hour"}):Pn(r,e.length)},k:function(t,e,n){let r=t.getHours();return r===0&&(r=24),e==="ko"?n.ordinalNumber(r,{unit:"hour"}):Pn(r,e.length)},m:function(t,e,n){return e==="mo"?n.ordinalNumber(t.getMinutes(),{unit:"minute"}):la.m(t,e)},s:function(t,e,n){return e==="so"?n.ordinalNumber(t.getSeconds(),{unit:"second"}):la.s(t,e)},S:function(t,e){return la.S(t,e)},X:function(t,e,n){const r=t.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return wE(r);case"XXXX":case"XX":return bl(r);case"XXXXX":case"XXX":default:return bl(r,":")}},x:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"x":return wE(r);case"xxxx":case"xx":return bl(r);case"xxxxx":case"xxx":default:return bl(r,":")}},O:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+vE(r,":");case"OOOO":default:return"GMT"+bl(r,":")}},z:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+vE(r,":");case"zzzz":default:return"GMT"+bl(r,":")}},t:function(t,e,n){const r=Math.trunc(+t/1e3);return Pn(r,e.length)},T:function(t,e,n){return Pn(+t,e.length)}};function vE(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),s=Math.trunc(r/60),i=r%60;return i===0?n+String(s):n+String(s)+e+Pn(i,2)}function wE(t,e){return t%60===0?(t>0?"-":"+")+Pn(Math.abs(t)/60,2):bl(t,e)}function bl(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),s=Pn(Math.trunc(r/60),2),i=Pn(r%60,2);return n+s+e+i}const kE=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},VR=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},cne=(t,e)=>{const n=t.match(/(P+)(p+)?/)||[],r=n[1],s=n[2];if(!s)return kE(t,e);let i;switch(r){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",kE(r,e)).replace("{{time}}",VR(s,e))},une={p:VR,P:cne},dne=/^D+$/,fne=/^Y+$/,hne=["D","DD","YY","YYYY"];function pne(t){return dne.test(t)}function mne(t){return fne.test(t)}function gne(t,e,n){const r=yne(t,e,n);if(console.warn(r),hne.includes(t))throw new RangeError(r)}function yne(t,e,n){const r=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${r} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const xne=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,bne=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,vne=/^'([^]*?)'?$/,wne=/''/g,kne=/[a-zA-Z]/;function ws(t,e,n){var d,f,h,p,m,y,b,g;const r=a0(),s=(n==null?void 0:n.locale)??r.locale??sne,i=(n==null?void 0:n.firstWeekContainsDate)??((f=(d=n==null?void 0:n.locale)==null?void 0:d.options)==null?void 0:f.firstWeekContainsDate)??r.firstWeekContainsDate??((p=(h=r.locale)==null?void 0:h.options)==null?void 0:p.firstWeekContainsDate)??1,o=(n==null?void 0:n.weekStartsOn)??((y=(m=n==null?void 0:n.locale)==null?void 0:m.options)==null?void 0:y.weekStartsOn)??r.weekStartsOn??((g=(b=r.locale)==null?void 0:b.options)==null?void 0:g.weekStartsOn)??0,a=Ws(t,n==null?void 0:n.in);if(!Tte(a))throw new RangeError("Invalid time value");let l=e.match(bne).map(v=>{const w=v[0];if(w==="p"||w==="P"){const C=une[w];return C(v,s.formatLong)}return v}).join("").match(xne).map(v=>{if(v==="''")return{isToken:!1,value:"'"};const w=v[0];if(w==="'")return{isToken:!1,value:Sne(v)};if(bE[w])return{isToken:!0,value:v};if(w.match(kne))throw new RangeError("Format string contains an unescaped latin alphabet character `"+w+"`");return{isToken:!1,value:v}});s.localize.preprocessor&&(l=s.localize.preprocessor(a,l));const u={firstWeekContainsDate:i,weekStartsOn:o,locale:s};return l.map(v=>{if(!v.isToken)return v.value;const w=v.value;(!(n!=null&&n.useAdditionalWeekYearTokens)&&mne(w)||!(n!=null&&n.useAdditionalDayOfYearTokens)&&pne(w))&&gne(w,e,String(t));const C=bE[w[0]];return C(a,w,s.localize,u)}).join("")}function Sne(t){const e=t.match(vne);return e?e[1].replace(wne,"'"):t}function _ne(t,e,n){return zR(t,-e,n)}function As(t,e){const n=()=>_o(e==null?void 0:e.in,NaN),r=(e==null?void 0:e.additionalDigits)??2,s=Nne(t);let i;if(s.date){const u=jne(s.date,r);i=Ine(u.restDateString,u.year)}if(!i||isNaN(+i))return n();const o=+i;let a=0,l;if(s.time&&(a=Mne(s.time),isNaN(a)))return n();if(s.timezone){if(l=Dne(s.timezone),isNaN(l))return n()}else{const u=new Date(o+a),d=Ws(0,e==null?void 0:e.in);return d.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),d.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),d}return Ws(o+a+l,e==null?void 0:e.in)}const np={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Tne=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Cne=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Ene=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Nne(t){const e={},n=t.split(np.dateTimeDelimiter);let r;if(n.length>2)return e;if(/:/.test(n[0])?r=n[0]:(e.date=n[0],r=n[1],np.timeZoneDelimiter.test(e.date)&&(e.date=t.split(np.timeZoneDelimiter)[0],r=t.substr(e.date.length,t.length))),r){const s=np.timezone.exec(r);s?(e.time=r.replace(s[1],""),e.timezone=s[1]):e.time=r}return e}function jne(t,e){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),r=t.match(n);if(!r)return{year:NaN,restDateString:""};const s=r[1]?parseInt(r[1]):null,i=r[2]?parseInt(r[2]):null;return{year:i===null?s:i*100,restDateString:t.slice((r[1]||r[2]).length)}}function Ine(t,e){if(e===null)return new Date(NaN);const n=t.match(Tne);if(!n)return new Date(NaN);const r=!!n[4],s=ld(n[1]),i=ld(n[2])-1,o=ld(n[3]),a=ld(n[4]),l=ld(n[5])-1;if(r)return Lne(e,a,l)?Ane(e,a,l):new Date(NaN);{const u=new Date(0);return!One(e,i,o)||!Pne(e,s)?new Date(NaN):(u.setUTCFullYear(e,i,Math.max(s,o)),u)}}function ld(t){return t?parseInt(t):1}function Mne(t){const e=t.match(Cne);if(!e)return NaN;const n=Jy(e[1]),r=Jy(e[2]),s=Jy(e[3]);return $ne(n,r,s)?n*$R+r*LR+s*1e3:NaN}function Jy(t){return t&&parseFloat(t.replace(",","."))||0}function Dne(t){if(t==="Z")return 0;const e=t.match(Ene);if(!e)return 0;const n=e[1]==="+"?-1:1,r=parseInt(e[2]),s=e[3]&&parseInt(e[3])||0;return zne(r,s)?n*(r*$R+s*LR):NaN}function Ane(t,e,n){const r=new Date(0);r.setUTCFullYear(t,0,4);const s=r.getUTCDay()||7,i=(e-1)*7+n+1-s;return r.setUTCDate(r.getUTCDate()+i),r}const Rne=[31,null,31,30,31,30,31,31,30,31,30,31];function WR(t){return t%400===0||t%4===0&&t%100!==0}function One(t,e,n){return e>=0&&e<=11&&n>=1&&n<=(Rne[e]||(WR(t)?29:28))}function Pne(t,e){return e>=1&&e<=(WR(t)?366:365)}function Lne(t,e,n){return e>=1&&e<=53&&n>=0&&n<=6}function $ne(t,e,n){return t===24?e===0&&n===0:n>=0&&n<60&&e>=0&&e<60&&t>=0&&t<25}function zne(t,e){return e>=0&&e<=59}const Fne=({onSave:t,onCancel:e,initialData:n,isReadOnly:r=!1})=>{const{user:s,setToast:i}=x.useContext(En),[o,a]=x.useState((n==null?void 0:n.description)||""),[l,u]=x.useState(((n==null?void 0:n.images)||[]).map(T=>({url:T}))),[d,f]=x.useState(!1),[h,p]=x.useState(!1),m=x.useRef(null),b=(()=>n!=null&&n.date&&!isNaN(n.date.getTime())?n.date:new Date)(),[g,v]=x.useState(ws(b,"yyyy-MM-dd")),[w,C]=x.useState(ws(b,"HH:mm")),I=async T=>new Promise(_=>{const N=new FileReader;N.readAsDataURL(T),N.onload=A=>{var L;const O=new Image;O.src=(L=A.target)==null?void 0:L.result,O.onload=()=>{const V=document.createElement("canvas");let E=O.width,j=O.height;const H=1920;E>j&&E>H?(j*=H/E,E=H):j>H&&(E*=H/j,j=H),V.width=E,V.height=j;const W=V.getContext("2d");W==null||W.drawImage(O,0,0,E,j);let R=.9;const ae=()=>{V.toBlob(re=>{if(!re){_(null);return}if(re.size>300*1024&&R>.1)R-=.1,ae();else{const $=(re.size/1024).toFixed(1);_({blob:re,sizeText:`${$} KB`})}},"image/jpeg",R)};ae()}},N.onerror=()=>_(null)}),k=async T=>{if(r)return;const _=T.target.files;if(!(!_||_.length===0)&&!(!s||!xe)){f(!0);try{const N=[];for(let A=0;A<_.length;A++){const O=_[A],L=await I(O);if(!L)continue;const{blob:V,sizeText:E}=L,j="jpg",H=`${Date.now()}_${kI()}.${j}`,W=`${s.id}/${H}`,{error:R}=await xe.storage.from("attachments").upload(W,V,{contentType:"image/jpeg"});if(R)throw R;const{data:ae}=xe.storage.from("attachments").getPublicUrl(W);ae&&N.push({url:ae.publicUrl,sizeText:E,isNew:!0})}u(A=>[...A,...N])}catch(N){console.error("Upload error:",N),i==null||i({msg:"",type:"error"})}finally{f(!1),T.target&&(T.target.value="")}}},D=async()=>{if(r)return;const T=document.createElement("div");if(T.innerHTML=o,!(T.textContent||T.innerText||"").trim()&&l.length===0){i==null||i({msg:"",type:"warning"});return}p(!0);try{const N=new Date(`${g}T${w}`),A=l.map(O=>O.url);await t({description:o,images:A,date:N}),e()}catch(N){console.error("Save error:",N),i==null||i({msg:"",type:"error"})}finally{p(!1)}},S=T=>{var N;const _=(N=m.current)==null?void 0:N.getEditor();if(_)switch(T){case"bold":_.chain().focus().toggleBold().run();break;case"italic":_.chain().focus().toggleItalic().run();break;case"bulletList":_.chain().focus().toggleBulletList().run();break;case"orderedList":_.chain().focus().toggleOrderedList().run();break;case"h1":_.chain().focus().toggleHeading({level:1}).run();break;case"h2":_.chain().focus().toggleHeading({level:2}).run();break}};return c.jsxs("div",{className:"fixed inset-0 z-[1200] flex flex-col bg-white",children:[c.jsxs("div",{className:"flex flex-col border-b border-gray-100 bg-white/80 backdrop-blur-md sticky top-0 z-20",children:[c.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[c.jsx("button",{onClick:e,className:"p-2 -ml-2 text-gray-500 hover:bg-gray-100 rounded-full",children:c.jsx(un,{size:24})}),c.jsx("div",{className:"font-bold text-lg text-gray-800",children:r?"":n?"":""}),!r&&c.jsx("button",{onClick:D,disabled:h||d,className:`px-4 py-1.5 rounded-full font-bold text-sm text-white transition-all ${h||d?"bg-gray-300":"bg-pink-500 hover:bg-pink-600 active:scale-95"}`,children:h?c.jsx(yi,{size:16,className:"animate-spin"}):""}),r&&c.jsx("div",{className:"w-8"})," "]}),c.jsxs("div",{className:"px-4 pb-2 flex gap-2",children:[c.jsx("input",{type:"date",value:g,onChange:T=>!r&&v(T.target.value),disabled:r,className:`bg-gray-50 border border-gray-200 rounded-lg px-2 py-1 text-sm font-medium text-gray-700 outline-none ${r?"opacity-80 cursor-default":"focus:ring-2 focus:ring-pink-200"}`}),c.jsx("input",{type:"time",value:w,onChange:T=>!r&&C(T.target.value),disabled:r,className:`bg-gray-50 border border-gray-200 rounded-lg px-2 py-1 text-sm font-medium text-gray-700 outline-none ${r?"opacity-80 cursor-default":"focus:ring-2 focus:ring-pink-200"}`})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-32",children:[l.length>0&&c.jsx("div",{className:"grid grid-cols-2 gap-2 mb-4",children:l.map((T,_)=>c.jsxs("div",{className:"relative group aspect-square rounded-xl overflow-hidden bg-gray-100 border border-gray-200",children:[c.jsx("img",{src:T.url,alt:"Moment",className:"w-full h-full object-cover"}),T.sizeText&&c.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[10px] py-0.5 px-2 text-center pointer-events-none",children:T.sizeText}),!r&&c.jsx("button",{onClick:()=>u(N=>N.filter((A,O)=>O!==_)),className:"absolute top-2 right-2 p-1.5 bg-black/50 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:c.jsx(un,{size:14})})]},_))}),c.jsx("div",{className:"min-h-[200px]",onClick:()=>{var T;return!r&&((T=m.current)==null?void 0:T.focus())},children:c.jsx(n0,{ref:m,initialContent:o,onChange:a,placeholder:r?"...":"...",textSizeClass:"text-lg",descFontClass:"font-newsreader",className:"moments-editor",editable:!r})})]}),!r&&c.jsxs("div",{className:"sticky bottom-0 left-0 right-0 bg-white border-t border-gray-100 pb-safe pt-2 px-2 z-20 shadow-[0_-4px_12px_rgba(0,0,0,0.05)]",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2 px-2",children:[c.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 bg-pink-50 text-pink-600 rounded-full cursor-pointer active:scale-95 transition-transform select-none",children:[c.jsx(Sf,{size:20}),c.jsx("span",{className:"text-sm font-bold",children:""}),c.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:k})]}),d&&c.jsx("span",{className:"text-xs text-gray-400 animate-pulse",children:"..."})]}),c.jsxs("div",{className:"flex items-center justify-between px-2 py-2 overflow-x-auto no-scrollbar",children:[c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 p-1 rounded-xl",children:[c.jsx(Tc,{icon:c.jsx(lz,{size:18}),onClick:()=>S("bold")}),c.jsx(Tc,{icon:c.jsx(Mz,{size:18}),onClick:()=>S("italic")})]}),c.jsx("div",{className:"w-px h-6 bg-gray-200 mx-2 shrink-0"}),c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 p-1 rounded-xl",children:[c.jsx(Tc,{icon:c.jsx(Ez,{size:18}),onClick:()=>S("h1")}),c.jsx(Tc,{icon:c.jsx(Nz,{size:18}),onClick:()=>S("h2")})]}),c.jsx("div",{className:"w-px h-6 bg-gray-200 mx-2 shrink-0"}),c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 p-1 rounded-xl",children:[c.jsx(Tc,{icon:c.jsx(FI,{size:18}),onClick:()=>S("bulletList")}),c.jsx(Tc,{icon:c.jsx(Az,{size:18}),onClick:()=>S("orderedList")})]})]})]})]})},Tc=({icon:t,onClick:e})=>c.jsx("button",{type:"button",onMouseDown:n=>{n.preventDefault(),e()},className:"p-2 text-gray-600 hover:text-pink-500 hover:bg-white rounded-lg transition-all active:scale-90",children:t}),Bne=({tasks:t,tags:e,isGuest:n,onAddTask:r,onUpdateTask:s,onDeleteTask:i,scrollRef:o})=>{const{setToast:a,user:l}=x.useContext(En),[u,d]=x.useState(!1),[f,h]=x.useState(null),[p,m]=x.useState(null),[y,b]=x.useState(20),g=x.useRef(null),v=x.useRef(null);x.useEffect(()=>{if(o!=null&&o.current&&v.current){const E=document.getElementById(`moment-${o.current}`);E&&E.scrollIntoView({behavior:"auto",block:"center"})}},[t]),x.useEffect(()=>{const E=v.current;if(!E)return;const j=()=>{const R=E.scrollTop+E.clientHeight/2;let ae=null,re=1/0;E.querySelectorAll("[data-moment-id]").forEach(z=>{const $e=z.offsetTop+z.offsetHeight/2,Be=Math.abs($e-R);Be<re&&(re=Be,ae=z.getAttribute("data-moment-id"))}),ae&&o&&(o.current=ae,localStorage.setItem("heart_last_moment_id",ae))};let H;const W=()=>{clearTimeout(H),H=setTimeout(j,100)};return E.addEventListener("scroll",W),()=>E.removeEventListener("scroll",W)},[y,t]);const w=x.useMemo(()=>e.find(E=>E.name==="OurTimeMoment"),[e]),C=x.useMemo(()=>e.find(E=>E.name.includes("Google:")||E.name==="Google:"),[e]),I=x.useMemo(()=>e.find(E=>E.name.includes("-Wei")||E.name==="-Wei"),[e]),k=E=>{try{let j=0;if(E.start_date){const H=E.start_date.substring(0,10),W=E.start_time||"00:00",R=W.length>5?W.substring(0,5):W;let ae=As(`${H}T${R}`);isNaN(ae.getTime())&&(ae=new Date(`${H.replace(/-/g,"/")} ${R}`)),isNaN(ae.getTime())||(j=ae.getTime())}if(j===0&&E.created_at){const H=new Date(E.created_at);isNaN(H.getTime())||(j=H.getTime())}return j}catch{return 0}},D=x.useMemo(()=>!w||!C&&!I?[]:t.filter(E=>{if(E.status==="trash"||E.status==="deleted"||E.is_deleted||E.deleted_at)return!1;const j=E.tags||[];if(!j.includes(w.id))return!1;const H=C&&j.includes(C.id),W=I&&j.includes(I.id);return H||W}).sort((E,j)=>{const H=k(E);return k(j)-H}),[t,w,C,I]),S=x.useMemo(()=>D.slice(0,y),[D,y]),T=x.useMemo(()=>{var H,W;const E=[];let j=0;for(;j<S.length;){const R=S[j],ae=I&&((H=R.tags)==null?void 0:H.includes(I.id)),re=S[j+1];if(re){const $=I&&((W=re.tags)==null?void 0:W.includes(I.id));if(ae!==$){E.push({type:"pair",items:[R,re]}),j+=2;continue}}E.push({type:"single",items:[R]}),j++}return E},[S,I]);x.useEffect(()=>{const E=new IntersectionObserver(j=>{j[0].isIntersecting&&b(H=>Math.min(H+20,D.length))},{threshold:.1});return g.current&&E.observe(g.current),()=>E.disconnect()},[D.length]);const _=async E=>{try{const j=E.date||new Date,H=ws(j,"yyyy-MM-dd"),W=ws(j,"HH:mm");if(f){const R={description:E.description,images:E.images,start_date:H,start_time:W};await s(f.id,R),a==null||a({msg:"",type:"info"})}else{const R=[];w&&R.push(w.id);let ae=null;if(n?ae=I==null?void 0:I.id:ae=C==null?void 0:C.id,!ae){const re=e.find(z=>z.name.includes("-Wei")),$=e.find(z=>z.name.includes("Google:"));n&&re?ae=re.id:!n&&$&&(ae=$.id)}if(ae)R.push(ae);else{a==null||a({msg:"",type:"error"});return}await r({title:ws(j,"yyyy-MM-dd HH:mm"),description:E.description,images:E.images,tags:R,start_date:H,start_time:W,is_all_day:!1,status:"inbox"}),a==null||a({msg:"",type:"success"})}d(!1),h(null)}catch(j){console.error(j),a==null||a({msg:"",type:"error"})}},N=(E,j,H)=>{const W=E.start_date?As(E.start_date):As(E.created_at),R=ws(W,"yyyy/MM/dd"),ae=E.start_time?E.start_time.substring(0,5):ws(W,"HH:mm");return c.jsxs("div",{"data-moment-id":E.id,className:`
                    relative w-full flex ${j?"justify-end":"justify-start"}
                    ${H?"mt-16":""} 
                    group transition-all duration-500 animate-in fade-in slide-in-from-bottom-4
                `,children:[c.jsx("div",{className:`
                    absolute top-6 w-4 h-4 rounded-full z-10 shadow-sm border-4 border-white
                    ${j?"left-[-8px] bg-pink-400 ring-2 ring-pink-100":"right-[-8px] bg-indigo-400 ring-2 ring-indigo-100"}
                `}),c.jsxs("div",{className:`w-[90%] ${j?"pl-6 text-right":"pr-6 text-left"}`,children:[c.jsxs("div",{className:`
                        mb-1 flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-gray-400
                        ${j?"justify-end flex-row-reverse":"mt-8"}
                    `,children:[c.jsx(vo,{size:12}),c.jsx("span",{children:R}),c.jsx("span",{className:"w-1 h-1 rounded-full bg-gray-300 mx-1"}),c.jsx(Ri,{size:12}),c.jsx("span",{children:ae})]}),c.jsxs("div",{className:`
                            relative bg-white p-4 rounded-2xl shadow-sm border transition-all hover:shadow-md cursor-pointer
                            ${j?"border-pink-50 hover:border-pink-200 rounded-tl-none":"border-indigo-50 hover:border-indigo-200 rounded-tr-none"}
                        `,onDoubleClick:()=>{h(E),d(!0)},children:[E.images&&E.images.length>0&&c.jsx("div",{className:`grid gap-1 mb-3 rounded-lg overflow-hidden ${E.images.length>1?"grid-cols-2":"grid-cols-1"}`,children:E.images.map((re,$)=>c.jsx("img",{src:re,className:"w-full h-auto rounded-lg hover:scale-105 transition-transform duration-500 cursor-zoom-in",loading:"lazy",onClick:z=>{z.stopPropagation(),m(re)}},$))}),c.jsx("div",{className:`prose prose-sm max-w-none font-newsreader text-gray-600 leading-snug ${j?"prose-pink text-right":"prose-indigo text-left"}`,dangerouslySetInnerHTML:{__html:(()=>{const re=E.description||"";if(!re)return"";const $=document.createElement("div");$.innerHTML=re;const z=$.textContent||$.innerText||"";return z.length>100?z.substring(0,100)+"...":re})()}}),c.jsx("div",{className:`absolute top-2 ${j?"left-2":"right-2"} opacity-0 group-hover:opacity-100 transition-opacity`,children:c.jsx("button",{onClick:re=>{re.stopPropagation(),window.confirm("")&&i(E.id)},className:"p-1 text-gray-300 hover:text-red-400 hover:bg-gray-50 rounded-full",children:c.jsx(Er,{size:14})})})]})]})]},E.id)},[A,O]=x.useState(()=>localStorage.getItem("moments_layout_mode")||"vertical");x.useEffect(()=>{(async()=>{if(l!=null&&l.id&&!n){const j=await Dd(l.id,"momentsLayoutMode");j&&(O(j),localStorage.setItem("moments_layout_mode",j))}})()},[l==null?void 0:l.id,n]);const L=E=>{O(E),localStorage.setItem("moments_layout_mode",E),l!=null&&l.id&&!n&&Fl(l.id,"momentsLayoutMode",E)},V=()=>c.jsx("div",{className:"relative w-full overflow-x-auto overflow-y-hidden h-[calc(100vh-140px)] flex flex-col justify-center custom-scrollbar bg-slate-50",children:c.jsxs("div",{className:"flex gap-4 md:gap-12 relative z-10 px-4 md:px-20 items-center h-full min-w-max",children:[c.jsxs("div",{className:"absolute top-1/2 left-0 right-0 h-12 z-0 pointer-events-none transform -translate-y-1/2 overflow-hidden",children:[c.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-100/30 via-purple-100/30 to-pink-100/30 blur-xl"}),c.jsxs("svg",{className:"absolute top-0 left-0 w-full h-full",preserveAspectRatio:"none",children:[c.jsx("defs",{children:c.jsxs("linearGradient",{id:"lineGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[c.jsx("stop",{offset:"0%",stopColor:"#818cf8",stopOpacity:"0.4"}),c.jsx("stop",{offset:"50%",stopColor:"#c084fc",stopOpacity:"0.6"}),c.jsx("stop",{offset:"100%",stopColor:"#f472b6",stopOpacity:"0.4"})]})}),c.jsx("line",{x1:"0",y1:"50%",x2:"100%",y2:"50%",stroke:"url(#lineGradient)",strokeWidth:"2",strokeDasharray:"6 6"})]}),c.jsx("div",{className:"absolute inset-0 w-full h-full opacity-30",style:{backgroundImage:`
                                    radial-gradient(circle at 10px 24px, #818cf8 2px, transparent 2.5px),
                                    radial-gradient(circle at 30px 24px, #f472b6 2px, transparent 2.5px)
                                `,backgroundSize:"40px 100%"}}),c.jsx("div",{className:"absolute top-[calc(50%-1px)] left-0 w-full h-0.5 bg-gradient-to-r from-indigo-300 via-purple-300 to-pink-300 opacity-60"})]}),T.map((E,j)=>{var W,R;const H=(ae,re)=>{var le;const $=ae.start_date?As(ae.start_date):As(ae.created_at),z=ws($,"MM/dd");return c.jsxs("div",{"data-moment-id":ae.id,className:`
                                        relative w-[220px] md:w-[300px] flex-shrink-0 group transition-all duration-500 hover:scale-[1.02]
                                        flex flex-col h-1/2
                                        ${re?"justify-start pt-8 md:pt-12":"justify-end pb-8 md:pb-12"}
                                    `,children:[c.jsx("div",{className:`
                                        absolute left-1/2 -translate-x-1/2 w-0.5 bg-gray-300/50 group-hover:bg-pink-300 transition-colors
                                        ${re?"top-0 h-8 md:h-12":"bottom-0 h-8 md:h-12"}
                                    `}),c.jsx("div",{className:`
                                        absolute left-1/2 -translate-x-1/2 w-3 h-3 md:w-5 md:h-5 rounded-full z-20 shadow-lg border-[2px] md:border-[3px] border-white transition-transform duration-300 group-hover:scale-125
                                        ${re?"top-0 -translate-y-1/2 bg-gradient-to-br from-pink-400 to-rose-500":"bottom-0 translate-y-1/2 bg-gradient-to-br from-indigo-400 to-blue-500"}
                                    `,children:c.jsx("div",{className:"absolute inset-0 rounded-full bg-white opacity-30 animate-ping"})}),c.jsxs("div",{className:`
                                            flex flex-col flex-1 min-h-0
                                            bg-white p-3 md:p-4 rounded-xl md:rounded-2xl shadow-[0_4px_12px_rgba(0,0,0,0.04)] 
                                            border border-white hover:border-pink-200 transition-all cursor-pointer overflow-hidden
                                            ${re?"rounded-tl-none":"rounded-bl-none"}
                                        `,onDoubleClick:()=>{h(ae),d(!0)},children:[c.jsxs("div",{className:"text-[10px] md:text-xs font-bold text-gray-400 mb-2 flex justify-between items-center shrink-0",children:[c.jsx("span",{className:"bg-gray-100 px-2 py-0.5 rounded-full",children:z}),((le=ae.images)==null?void 0:le.length)>0&&c.jsxs("span",{className:"text-pink-400 text-[9px] bg-pink-50 px-1.5 py-0.5 rounded-full",children:[" ",ae.images.length]})]}),ae.images&&ae.images.length>0?c.jsxs("div",{className:"flex-1 min-h-0 mb-2 overflow-hidden rounded-lg bg-gray-50 relative group/img",children:[c.jsx("img",{src:ae.images[0],className:"w-full h-full object-cover transition-transform duration-700 group-hover/img:scale-110"}),ae.images.length>1&&c.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/50 text-white text-[10px] px-2 py-1 rounded-full backdrop-blur-sm",children:["+",ae.images.length-1]})]}):c.jsx("div",{className:"flex-1 min-h-[10%]"}),c.jsx("div",{className:"text-xs md:text-sm text-gray-600 font-newsreader line-clamp-3 md:line-clamp-4 shrink-0 leading-relaxed overflow-hidden",dangerouslySetInnerHTML:{__html:ae.description||""}})]})]},ae.id)};if(E.type==="pair"){const ae=E.items[0],re=E.items[1],$=I&&((W=ae.tags)==null?void 0:W.includes(I.id)),z=$?re:ae,le=$?ae:re;return c.jsxs("div",{className:"flex flex-col h-full",children:[H(z,!1),H(le,!0)]},`pair-${j}`)}else{const ae=E.items[0],re=I&&((R=ae.tags)==null?void 0:R.includes(I.id)),$=c.jsx("div",{className:"h-1/2 w-[220px] md:w-[300px] flex-shrink-0"});return c.jsx("div",{className:"flex flex-col h-full",children:re?c.jsxs(c.Fragment,{children:[$,H(ae,!0)]}):c.jsxs(c.Fragment,{children:[H(ae,!1),$]})},`single-${j}`)}}),c.jsx("div",{className:"w-20 shrink-0"})]})});return c.jsxs("div",{className:"relative min-h-full bg-slate-50 pb-20 flex flex-col",children:[c.jsxs("div",{className:"flex justify-end px-4 py-2 gap-2",children:[c.jsx("button",{onClick:()=>L("vertical"),className:`text-xs px-3 py-1 rounded-full border ${A==="vertical"?"bg-indigo-500 text-white border-indigo-500":"bg-white text-gray-500 border-gray-200"}`,children:""}),c.jsx("button",{onClick:()=>L("horizontal"),className:`text-xs px-3 py-1 rounded-full border ${A==="horizontal"?"bg-indigo-500 text-white border-indigo-500":"bg-white text-gray-500 border-gray-200"}`,children:""})]}),A==="horizontal"?V():c.jsxs("div",{className:"max-w-4xl mx-auto px-2 md:px-4 py-8 flex-1 w-full",children:[D.length===0&&c.jsxs("div",{className:"text-center py-20 opacity-50",children:[c.jsx(cu,{size:48,className:"mx-auto text-pink-300 mb-4 animate-pulse"}),c.jsx("p",{className:"text-gray-500 text-lg font-newsreader",children:"..."})]}),c.jsxs("div",{className:"relative space-y-0",children:[D.length>0&&c.jsx("div",{className:"absolute left-1/2 top-4 bottom-4 w-0.5 bg-gradient-to-b from-indigo-200 via-pink-200 to-transparent -translate-x-1/2 z-0"}),T.map((E,j)=>{var H,W,R;if(E.type==="pair"){const ae=E.items[0],re=E.items[1],$=I&&((H=ae.tags)==null?void 0:H.includes(I.id)),z=I&&((W=re.tags)==null?void 0:W.includes(I.id));return c.jsxs("div",{className:"grid grid-cols-2 w-full relative z-10",children:[c.jsx("div",{className:"w-full",children:$?z?null:N(re,!1,!0):N(ae,!1,!1)}),c.jsx("div",{className:"w-full",children:$?N(ae,!0,!1):z?N(re,!0,!0):null})]},`pair-${j}`)}else{const ae=E.items[0],re=I&&((R=ae.tags)==null?void 0:R.includes(I.id));return c.jsxs("div",{className:"grid grid-cols-2 w-full relative z-10",children:[c.jsx("div",{className:"w-full",children:!re&&N(ae,!1,!1)}),c.jsx("div",{className:"w-full",children:re&&N(ae,!0,!1)})]},`single-${j}`)}}),D.length>y&&c.jsx("div",{ref:g,className:"py-8 flex justify-center",children:c.jsx("div",{className:"w-8 h-8 border-4 border-pink-200 rounded-full animate-spin border-t-transparent"})})]})]}),c.jsx("button",{onClick:()=>{h(null),d(!0)},className:`
                    fixed bottom-6 right-6 w-14 h-14 text-white rounded-full shadow-lg flex items-center justify-center hover:scale-110 active:scale-95 transition-all z-50
                    bg-gradient-to-tr ${n?"from-pink-500 to-rose-500":"from-indigo-500 to-blue-600"}
                `,children:c.jsx(ni,{size:28})}),u&&c.jsx(Fne,{initialData:f?{description:f.description,images:f.images,date:(()=>{try{if(f.start_date){const j=f.start_date.substring(0,10),H=f.start_time?f.start_time.substring(0,5):"00:00";let W=As(`${j}T${H}`);if(isNaN(W.getTime())&&(W=new Date(`${j.replace(/-/g,"/")} ${H}`)),!isNaN(W.getTime()))return W}const E=new Date(f.created_at);return isNaN(E.getTime())?new Date:E}catch{return new Date}})()}:void 0,onSave:_,onCancel:()=>{d(!1),h(null)},isReadOnly:(()=>{var j;if(!f)return!1;const E=I&&((j=f.tags)==null?void 0:j.includes(I.id));return n?!E:!!E})()}),p&&c.jsx("div",{className:"fixed inset-0 z-[1300] bg-black/95 flex items-center justify-center p-4 animate-in fade-in duration-200",onClick:()=>m(null),children:c.jsx("img",{src:p,className:"max-w-full max-h-full object-contain cursor-zoom-out",onClick:E=>{E.stopPropagation(),m(null)}})})]})},Une={lessThanXSeconds:{one:" 1 ",other:" {{count}} "},xSeconds:{one:"1 ",other:"{{count}} "},halfAMinute:"",lessThanXMinutes:{one:" 1 ",other:" {{count}} "},xMinutes:{one:"1 ",other:"{{count}} "},xHours:{one:"1 ",other:"{{count}} "},aboutXHours:{one:" 1 ",other:" {{count}} "},xDays:{one:"1 ",other:"{{count}} "},aboutXWeeks:{one:" 1 ",other:" {{count}} "},xWeeks:{one:"1 ",other:"{{count}} "},aboutXMonths:{one:" 1 ",other:" {{count}} "},xMonths:{one:"1 ",other:"{{count}} "},aboutXYears:{one:" 1 ",other:" {{count}} "},xYears:{one:"1 ",other:"{{count}} "},overXYears:{one:" 1 ",other:" {{count}} "},almostXYears:{one:" 1 ",other:" {{count}} "}},Hne=(t,e,n)=>{let r;const s=Une[t];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",String(e)),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?r+"":r+"":r},Vne={full:"y''M''d'' EEEE",long:"y''M''d''",medium:"yyyy-MM-dd",short:"yy-MM-dd"},Wne={full:"zzzz a h:mm:ss",long:"z a h:mm:ss",medium:"a h:mm:ss",short:"a h:mm"},Kne={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},Gne={date:gu({formats:Vne,defaultWidth:"full"}),time:gu({formats:Wne,defaultWidth:"full"}),dateTime:gu({formats:Kne,defaultWidth:"full"})},qne={lastWeek:"''eeee p",yesterday:"'' p",today:"'' p",tomorrow:"'' p",nextWeek:"''eeee p",other:"P"},Yne=(t,e,n,r)=>qne[t],Jne={narrow:["",""],abbreviated:["",""],wide:["",""]},Xne={narrow:["1","2","3","4"],abbreviated:["","","",""],wide:["","","",""]},Qne={narrow:["","","","","","","","","","","",""],abbreviated:["1","2","3","4","5","6","7","8","9","10","11","12"],wide:["","","","","","","","","","","",""]},Zne={narrow:["","","","","","",""],short:["","","","","","",""],abbreviated:["","","","","","",""],wide:["","","","","","",""]},ere={narrow:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},abbreviated:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},wide:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""}},tre={narrow:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},abbreviated:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},wide:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""}},nre=(t,e)=>{const n=Number(t);switch(e==null?void 0:e.unit){case"date":return n+"";case"hour":return n+"";case"minute":return n+"";case"second":return n+"";default:return" "+n}},rre={ordinalNumber:nre,era:uo({values:Jne,defaultWidth:"wide"}),quarter:uo({values:Xne,defaultWidth:"wide",argumentCallback:t=>t-1}),month:uo({values:Qne,defaultWidth:"wide"}),day:uo({values:Zne,defaultWidth:"wide"}),dayPeriod:uo({values:ere,defaultWidth:"wide",formattingValues:tre,defaultFormattingWidth:"wide"})},sre=/^(\s*)?\d+(|||)?/i,ire=/\d+/i,ore={narrow:/^()/i,abbreviated:/^()/i,wide:/^(|)/i},are={any:[/^()/i,/^()/i]},lre={narrow:/^[1234]/i,abbreviated:/^[]/i,wide:/^[]/i},cre={any:[/(1|)/i,/(2|)/i,/(3|)/i,/(4|)/i]},ure={narrow:/^(|||||||||[])/i,abbreviated:/^(|||||||||[]|\d|1[12])/i,wide:/^(|||||||||[])/i},dre={narrow:[/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^(?!(|))/i,/^/i,/^/i],any:[/^|1/i,/^|2/i,/^|3/i,/^|4/i,/^|5/i,/^|6/i,/^|7/i,/^|8/i,/^|9/i,/^(?!(|))|10/i,/^|11/i,/^|12/i]},fre={narrow:/^[]/i,short:/^[]/i,abbreviated:/^[]/i,wide:/^[]/i},hre={any:[//i,//i,//i,//i,//i,//i,//i]},pre={any:/^(?|?||[]|?||?|)/i},mre={any:{am:/^?/i,pm:/^?/i,midnight:/^/i,noon:/^[]/i,morning:/^/i,afternoon:/^/i,evening:/^?/i,night:/^/i}},gre={ordinalNumber:UR({matchPattern:sre,parsePattern:ire,valueCallback:t=>parseInt(t,10)}),era:fo({matchPatterns:ore,defaultMatchWidth:"wide",parsePatterns:are,defaultParseWidth:"any"}),quarter:fo({matchPatterns:lre,defaultMatchWidth:"wide",parsePatterns:cre,defaultParseWidth:"any",valueCallback:t=>t+1}),month:fo({matchPatterns:ure,defaultMatchWidth:"wide",parsePatterns:dre,defaultParseWidth:"any"}),day:fo({matchPatterns:fre,defaultMatchWidth:"wide",parsePatterns:hre,defaultParseWidth:"any"}),dayPeriod:fo({matchPatterns:pre,defaultMatchWidth:"any",parsePatterns:mre,defaultParseWidth:"any"})},SE={code:"zh-TW",formatDistance:Hne,formatLong:Gne,formatRelative:Yne,localize:rre,match:gre,options:{weekStartsOn:1,firstWeekContainsDate:4}},cs=64,KR=({onClose:t,isStandalone:e=!1})=>{const n=x.useContext(En),{tasks:r,tags:s,updateTask:i,addTask:o,user:a,setEditingTaskId:l,editingTaskId:u,setToast:d}=n,[f,h]=x.useState(()=>localStorage.getItem("heart_view_mode")||"schedule"),[p,m]=x.useState(()=>new Date),y=x.useRef(localStorage.getItem("heart_last_moment_id"));x.useEffect(()=>{(async()=>{if(a!=null&&a.id&&!S){const Fe=await Dd(a.id,Il.HEART_VIEW_STATE);Fe&&(Fe.viewMode&&(h(Fe.viewMode),localStorage.setItem("heart_view_mode",Fe.viewMode)),Fe.selectedTagIds&&(g(Fe.selectedTagIds),localStorage.setItem("heart_schedule_tags",JSON.stringify(Fe.selectedTagIds))))}})()},[a==null?void 0:a.id]),x.useEffect(()=>{if(localStorage.setItem("heart_view_mode",f),a!=null&&a.id&&!S){const Y={viewMode:f,selectedTagIds:b};Fl(a.id,Il.HEART_VIEW_STATE,Y)}},[f,a==null?void 0:a.id]),x.useEffect(()=>{if(f==="schedule"&&a!=null&&a.id&&!S){const Y={viewMode:f,selectedTagIds:b};Fl(a.id,Il.HEART_VIEW_STATE,Y)}},[p,f,a==null?void 0:a.id]);const[b,g]=x.useState(()=>{const Y=localStorage.getItem("heart_schedule_tags");return Y?JSON.parse(Y):[]}),[v,w]=x.useState(!1),[C,I]=x.useState(!1),[k,D]=x.useState([]),[S,T]=x.useState(!1),[_,N]=x.useState(null),[A,O]=x.useState(null),[L,V]=x.useState(null),[E,j]=x.useState(!1),[H,W]=x.useState(null),[R,ae]=x.useState(!1),[re,$]=x.useState([]),[z,le]=x.useState(null),$e=S?re:s,Be=()=>S?$e.find(Y=>Y.name.includes("-Wei")):$e.find(Y=>Y.name==="Google:")||$e.find(Y=>Y.name.includes("Google:"))||$e.find(Y=>Y.name.includes("")&&Y.name.toLowerCase().includes("google"))||$e.find(Y=>Y.name.includes("")),se=Y=>{const Ue=(Y.tags||[]).some(ze=>{const Qe=$e.find(Z=>Z.id===ze);return Qe&&Qe.name.includes("-Wei")});return S?Ue?{canEdit:!0}:{canEdit:!1,reason:"Guest -Wei"}:Ue?{canEdit:!1,reason:"-Wei Guest "}:{canEdit:!0}},Se=x.useRef(null);x.useEffect(()=>{Se.current&&(Se.current.scrollTop=8*cs-20)},[e]),x.useEffect(()=>{var Z;const Y=window.location.pathname,Fe=new URLSearchParams(window.location.search);if(Y.includes("/share/heart/s/")){const Pe=(Z=Y.split("/s/")[1])==null?void 0:Z.split("/")[0];if(Pe&&xe){xe.from("schedule_snapshots").select("data, created_by").eq("id",Pe).single().then(({data:We,error:kt})=>{if(We){if(We.created_by&&le(We.created_by),We.data){const{tasks:Vt,tags:Ft,date:nn}=We.data;Vt&&D(Vt),Ft&&$(Ft),nn&&m(As(nn)),T(!0)}}else kt&&console.error("Error loading snapshot:",kt)});return}}const Ue=Fe.get("date"),ze=Fe.get("tags"),Qe=Fe.get("d");if(Ue&&m(As(Ue)),ze)try{const Ne=JSON.parse(decodeURIComponent(ze));Array.isArray(Ne)&&$(Ne)}catch(Ne){console.error("Failed to parse tags",Ne)}if(Qe)try{const Ne=decodeURIComponent(Qe);let Pe;try{Pe=JSON.parse(Ne)}catch{console.warn("Direct JSON parse failed")}Pe&&Array.isArray(Pe)&&(D(Pe),T(!0))}catch(Ne){console.error("Failed to parse snapshot data",Ne)}},[]),x.useEffect(()=>{let Y=z;if(!Y&&S){const Qe=window.location.pathname.split("/"),Z=Qe.indexOf("heart"),Ne=Z!==-1&&Qe[Z+1]?Qe[Z+1]:null;Ne&&Ne!=="share"&&Ne!=="s"&&(Y=Ne)}if(!S||!xe||!Y)return;console.log("[GuestRealtime] Initializing sync for Owner:",Y);const Fe=async()=>{try{const{data:Qe,error:Z}=await xe.from("tasks").select("*").eq("user_id",Y).neq("status","deleted");Qe&&(console.log("[GuestRealtime] Loaded tasks:",Qe.length),D(Qe));const{data:Ne,error:Pe}=await xe.from("tags").select("*").eq("user_id",Y);Ne&&$(Ne)}catch(Qe){console.error("[GuestRealtime] Error loading initial data:",Qe)}},Ue=xe.channel(`guest-tasks-${Y}`).on("postgres_changes",{event:"*",schema:"public",table:"tasks",filter:`user_id=eq.${Y}`},Qe=>{const{eventType:Z,new:Ne,old:Pe}=Qe;D(We=>Z==="INSERT"?We.some(kt=>kt.id===Ne.id)?We:[...We,Ne]:Z==="UPDATE"?We.map(kt=>kt.id===Ne.id?{...kt,...Ne}:kt):Z==="DELETE"?We.filter(kt=>kt.id!==Pe.id):We)}).subscribe(Qe=>{Qe==="SUBSCRIBED"&&Fe()}),ze=xe.channel(`guest-tags-${Y}`).on("postgres_changes",{event:"*",schema:"public",table:"tags",filter:`user_id=eq.${Y}`},Qe=>{const{eventType:Z,new:Ne,old:Pe}=Qe;$(We=>Z==="INSERT"?We.some(kt=>kt.id===Ne.id)?We:[...We,Ne]:Z==="UPDATE"?We.map(kt=>kt.id===Ne.id?{...kt,...Ne}:kt):Z==="DELETE"?We.filter(kt=>kt.id!==Pe.id):We)}).subscribe();return()=>{xe.removeChannel(Ue),xe.removeChannel(ze)}},[S,z]),x.useEffect(()=>{S&&k.length>0&&r.length>0&&D(Y=>Y.map(Fe=>{const Ue=r.find(ze=>ze.id===Fe.id);return Ue?{...Fe,...Ue}:Fe}))},[r]);const ce=x.useMemo(()=>{if(!S)return null;if(z)return z;const Y=window.location.pathname.split("/"),Fe=Y.indexOf("heart");if(Fe!==-1&&Y[Fe+1]){const Ue=Y[Fe+1];return Ue==="share"||Ue==="s"?null:Ue}return null},[S,z]),Ee=x.useRef({past:[],future:[]}),He=x.useRef(!1),tt=Y=>{if(He.current)return;const Fe=[...Ee.current.past,JSON.parse(JSON.stringify(Y))];Fe.length>20&&Fe.shift(),Ee.current.past=Fe,Ee.current.future=[]},ut=async(Y,Fe)=>{if(!xe)return;const Ue=new Map(Y.map(Qe=>[Qe.id,Qe])),ze=new Map(Fe.map(Qe=>[Qe.id,Qe]));for(const Qe of Fe){const Z=Ue.get(Qe.id);if(!Z)console.log("[GuestUndo] Restoring task:",Qe.id),await xe.from("tasks").update({status:"inbox"}).eq("id",Qe.id);else if(Qe.title!==Z.title||Qe.start_date!==Z.start_date||Qe.start_time!==Z.start_time||Qe.end_time!==Z.end_time||Qe.duration!==Z.duration||Qe.status!==Z.status){console.log("[GuestUndo] Reverting update for:",Qe.id);const{id:Pe,user_id:We,created_at:kt,...Vt}=Qe;await xe.from("tasks").update(Vt).eq("id",Pe)}}for(const Qe of Y)ze.has(Qe.id)||(console.log("[GuestUndo] Deleting added task:",Qe.id),await xe.from("tasks").delete().eq("id",Qe.id))},Ge=x.useMemo(()=>{const Y=Ue=>{if(Ue.start_date&&!Ue.is_all_day&&(!Ue.start_time||!Ue.end_time)){const ze={...Ue},Qe=new Date(Ue.start_date),Z=Qe.getHours()*60+Qe.getMinutes();if(ze.start_time||(ze.start_time=Re(Z)),!ze.end_time&&(ze.duration||Ue.duration)){const Ne=Number(ze.duration||Ue.duration);ze.end_time=Re(Z+Ne)}return ze}return Ue},Fe={...n};return{...Fe,tasks:S?k:r,tags:$e,undo:async()=>{if(!S)return Fe.undo();if(Ee.current.past.length===0)return;He.current=!0;const Ue=Ee.current.past.pop();Ue&&(Ee.current.future.push(JSON.parse(JSON.stringify(k))),await ut(k,Ue),D(Ue)),He.current=!1},redo:async()=>{if(!S)return Fe.redo();if(Ee.current.future.length===0)return;He.current=!0;const Ue=Ee.current.future.pop();Ue&&(Ee.current.past.push(JSON.parse(JSON.stringify(k))),await ut(k,Ue),D(Ue)),He.current=!1},canUndo:S?Ee.current.past.length>0:Fe.canUndo,canRedo:S?Ee.current.future.length>0:Fe.canRedo,updateTask:async(Ue,ze,Qe)=>{var Ne;if(Ue==="new"){O(Pe=>({...Pe,...ze}));return}if(tt(k),S){const Pe=k.find(We=>We.id===Ue);if(Pe&&!((Ne=Pe.tags)==null?void 0:Ne.some(kt=>{var Ft;const Vt=$e.find(nn=>nn.id===kt);return(Ft=Vt==null?void 0:Vt.name)==null?void 0:Ft.includes("-Wei")}))){alert(" Wei");return}}const Z=Y(ze);if(S&&ce&&xe){console.log("[Guest] Updating task:",Ue,Z);const{error:Pe}=await xe.from("tasks").update(Z).eq("id",Ue);if(Pe){alert(`: ${Pe.message}
`),console.error("Guest Update Error:",Pe);return}}else await i(Ue,Z,Qe);S&&D(Pe=>Pe.map(We=>We.id===Ue?{...We,...Z}:We))},addTask:async(Ue,ze)=>{tt(k);const Qe=Y(Ue);let Z=Ue.id||`guest-${Date.now()}`;Ue.id||(Z=crypto.randomUUID?crypto.randomUUID():`guest-${Date.now()}`);try{if(S&&ce&&xe){if(!ce)return alert(` ID (URL ID: ${ce})`),"";let Ne=Qe.tags||[];if(Ne.length===0){const kt=$e.find(Vt=>Vt.name.includes("-Wei"))||$e.find(Vt=>Vt.name.toLowerCase().includes("wei")&&!Vt.name.toLowerCase().includes("google"));if(kt)Ne=[kt.id];else if(b.length>0)Ne=b;else if($e.length>0){const Vt=$e.find(Ft=>!Ft.name.toLowerCase().includes("google"));Ne=[Vt?Vt.id:$e[0].id]}}const Pe={...Qe,id:Z,user_id:ce,created_at:new Date().toISOString(),status:"todo",tags:Ne};console.log("[Guest] Inserting task for owner:",ce,Pe);const{error:We}=await xe.from("tasks").insert([Pe]).select();if(We)throw We;d==null||d({msg:"",type:"info"})}else Z=await o(Qe,ze)}catch(Ne){if(console.warn("Guest addTask failed",Ne),alert(`: ${(Ne==null?void 0:Ne.message)||""}`),!S)return""}if(S){const Ne={id:Z,...Qe,user_id:ce};D(Pe=>[...Pe,Ne])}return Z},deleteTask:async Ue=>{var ze;if(tt(k),S){const Qe=k.find(Z=>Z.id===Ue);if(Qe&&!((ze=Qe.tags)==null?void 0:ze.some(Ne=>{var We;const Pe=$e.find(kt=>kt.id===Ne);return(We=Pe==null?void 0:Pe.name)==null?void 0:We.includes("-Wei")}))){d==null||d({msg:" Wei",type:"error"});return}}if(S&&ce&&xe){console.log("[Guest] Deleting task (soft):",Ue);const{error:Qe}=await xe.from("tasks").update({status:"deleted"}).eq("id",Ue);Qe?(alert(`: ${Qe.message}`),console.error("Guest Delete Error:",Qe)):d==null||d({msg:"",type:"info"})}else await n.deleteTask(Ue);S&&(D(Qe=>Qe.filter(Z=>Z.id!==Ue)),L===Ue&&V(null))}}},[n,S,k,$e,ce,xe,L,d]),mt=Ge.undo,ht=Ge.redo,Ie=Ge.canUndo,ge=Ge.canRedo,ie=Ge.addTask,me=Ge.updateTask,Q=Ge.deleteTask;x.useEffect(()=>{if(!S)return;const Y=Fe=>{(Fe.metaKey||Fe.ctrlKey)&&Fe.key==="z"&&!Fe.shiftKey&&(Fe.preventDefault(),mt()),((Fe.metaKey||Fe.ctrlKey)&&Fe.key==="z"&&Fe.shiftKey||(Fe.metaKey||Fe.ctrlKey)&&Fe.key==="y")&&(Fe.preventDefault(),ht())};return window.addEventListener("keydown",Y),()=>window.removeEventListener("keydown",Y)},[S,mt,ht]);const X=Y=>{g(Fe=>{const Ue=Fe.includes(Y)?Fe.filter(ze=>ze!==Y):[...Fe,Y];if(localStorage.setItem("heart_schedule_tags",JSON.stringify(Ue)),a!=null&&a.id&&!S){const ze={viewMode:f,selectedDate:p.toISOString(),selectedTagIds:Ue};Fl(a.id,Il.HEART_VIEW_STATE,ze)}return Ue})};x.useEffect(()=>{const Y=async Fe=>{var ze;if(!L||u)return;const Ue=(ze=document.activeElement)==null?void 0:ze.tagName;if(!(Ue==="INPUT"||Ue==="TEXTAREA"||document.activeElement.isContentEditable)&&(Fe.key==="Delete"||Fe.key==="Backspace")){if(Fe.preventDefault(),S){const Z=k.find(Ne=>Ne.id===L);if(Z){const Ne=se(Z);if(!Ne.canEdit){d==null||d({msg:Ne.reason||"",type:"error"});return}}}const Qe=L;await Ge.deleteTask(Qe),V(null)}};return window.addEventListener("keydown",Y),()=>window.removeEventListener("keydown",Y)},[L,u,Ge]);const he=x.useMemo(()=>S?k.filter(ze=>{if(ze.status==="deleted")return!1;let Qe=null;return ze.start_date?Qe=As(ze.start_date):ze.due_date&&(Qe=As(ze.due_date)),!Qe||!tp(Qe,p)?!1:b.length===0?!0:!ze.tags||ze.tags.length===0?!1:ze.tags.some(Z=>b.includes(Z))}):(!r.some(ze=>{const Qe=ze.start_date?As(ze.start_date):ze.due_date?As(ze.due_date):null;return Qe&&tp(Qe,p)&&ze.status!=="deleted"})&&k.length>0?k:r).filter(ze=>{if(ze.status==="deleted")return!1;let Qe=null;return ze.start_date?Qe=As(ze.start_date):ze.due_date&&(Qe=As(ze.due_date)),!Qe||!tp(Qe,p)?!1:b.length===0?!0:!ze.tags||ze.tags.length===0?!1:ze.tags.some(Z=>b.includes(Z))}),[r,p,b,k,S]),ke=x.useMemo(()=>he.filter(Y=>Y.is_all_day||!Y.start_time),[he]),ee=x.useMemo(()=>he.filter(Y=>!Y.is_all_day&&Y.start_time),[he]),pe=Y=>{if(!Y)return 0;const[Fe,Ue]=Y.split(":").map(Number);return Fe*60+Ue},Re=Y=>{const Fe=Math.floor(Y/60),Ue=Math.floor(Y%60);return`${String(Fe).padStart(2,"0")}:${String(Ue).padStart(2,"0")}`},_t=Y=>{const Fe=pe(Y.start_time);let Ue=Y.duration||60;const ze=Fe/60*cs,Qe=Ue/60*cs;return{top:`${ze}px`,height:`${Math.max(28,Qe)}px`}},Nt=Y=>{if(Y.length===0)return{};const Fe=Y.map(Ne=>({id:Ne.id,start:pe(Ne.start_time),end:pe(Ne.start_time)+(Ne.duration||60)})).sort((Ne,Pe)=>Ne.start-Pe.start),Ue=[];let ze=[],Qe=-1;Fe.forEach(Ne=>{ze.length===0?(ze.push(Ne),Qe=Ne.end):Ne.start<Qe?(ze.push(Ne),Qe=Math.max(Qe,Ne.end)):(Ue.push(ze),ze=[Ne],Qe=Ne.end)}),ze.length>0&&Ue.push(ze);const Z={};return Ue.forEach(Ne=>{const Pe=[];Ne.forEach(nn=>{let Xt=!1;for(let Jt=0;Jt<Pe.length;Jt++){const fn=Pe[Jt],yn=fn[fn.length-1];if(nn.start>=yn.end){fn.push(nn),Xt=!0;break}}Xt||Pe.push([nn])});const kt=100/Pe.length,Vt={},Ft=[];Ne.forEach(nn=>{let Xt=!1;for(let Jt=0;Jt<Ft.length;Jt++){const fn=Ft[Jt],yn=fn[fn.length-1];if(nn.start>=yn.end){fn.push(nn),Vt[nn.id]=Jt,Xt=!0;break}}Xt||(Ft.push([nn]),Vt[nn.id]=Ft.length-1)}),Ne.forEach(nn=>{const Xt=Vt[nn.id];Z[nn.id]={left:`${Xt*kt}%`,width:`${kt}%`}})}),Z},[ot,Ot]=x.useState(null),we=x.useRef(ot);x.useEffect(()=>{we.current=ot},[ot]);const qe=x.useRef(null),Ke=x.useRef(null),it=()=>{Ke.current&&(window.removeEventListener("touchmove",Ke.current.move),window.removeEventListener("touchend",Ke.current.end),window.removeEventListener("touchcancel",Ke.current.end),Ke.current=null)},Me=(Y,Fe,Ue)=>{var Vt;if(S&&(Ue==="move"||Ue==="resize")&&!((Vt=Fe.tags)==null?void 0:Vt.some(nn=>{var Jt;const Xt=$e.find(fn=>fn.id===nn);return(Jt=Xt==null?void 0:Xt.name)==null?void 0:Jt.includes("-Wei")})))return;const ze=Y.touches[0],Qe=ze.clientX,Z=ze.clientY,Ne=pe(Fe.start_time),Pe=Fe.duration||60;qe.current&&clearTimeout(qe.current);const We=()=>{qe.current&&(clearTimeout(qe.current),qe.current=null),window.removeEventListener("touchmove",kt),window.removeEventListener("touchend",We),window.removeEventListener("touchcancel",We)},kt=Ft=>{const nn=Ft.touches[0].clientX,Xt=Ft.touches[0].clientY;(Math.abs(nn-Qe)>10||Math.abs(Xt-Z)>10)&&We()};qe.current=setTimeout(()=>{navigator.vibrate&&navigator.vibrate(50),We(),it(),Ot({taskId:Fe.id,initialY:Z,originalStartMin:Ne,originalDuration:Pe,type:Ue,currentStartMin:Ne,currentDuration:Pe,isTouch:!0});const Ft=Xt=>{Xt.cancelable&&Xt.preventDefault();const fn=(Xt.touches?Xt.touches[0].clientY:0)-Z,yn=Math.round(fn/cs*60/15)*15;if(Ue==="move"){let _n=Ne+yn;_n=Math.max(0,Math.min(1440-Pe,_n)),Ot(Fn=>Fn?{...Fn,currentStartMin:_n}:null)}else{let _n=Pe+yn;_n=Math.max(15,_n),Ot(Fn=>Fn?{...Fn,currentDuration:_n}:null)}},nn=()=>{try{const Xt=we.current;if(Xt&&Xt.taskId===Fe.id){const{currentStartMin:Jt,currentDuration:fn}=Xt,yn=se(Fe);if(!yn.canEdit){d==null||d({msg:yn.reason||"",type:"error"});return}const _n=Re(Jt),Fn=Re(Jt+fn),Hn=new Date(p);Hn.setHours(Math.floor(Jt/60)),Hn.setMinutes(Jt%60);const is={start_time:_n,duration:fn,end_time:Fn,start_date:Hn.toISOString()};i(Fe.id,is),S&&D(Gs=>Gs.map(ui=>ui.id===Fe.id?{...ui,...is}:ui))}}finally{Ot(null),it()}};Ke.current={move:Ft,end:nn},window.addEventListener("touchmove",Ft,{passive:!1}),window.addEventListener("touchend",nn),window.addEventListener("touchcancel",nn)},1e3),window.addEventListener("touchmove",kt),window.addEventListener("touchend",We),window.addEventListener("touchcancel",We)},yt=(Y,Fe,Ue)=>{var Qe;if(Y.stopPropagation(),Y.preventDefault(),S&&(Ue==="move"||Ue==="resize")&&!((Qe=Fe.tags)==null?void 0:Qe.some(Ne=>{var We;const Pe=$e.find(kt=>kt.id===Ne);return(We=Pe==null?void 0:Pe.name)==null?void 0:We.includes("-Wei")}))){d==null||d({msg:" Wei",type:"error"});return}const ze=pe(Fe.start_time);Ot({taskId:Fe.id,initialY:Y.clientY,originalStartMin:ze,originalDuration:Fe.duration||60,type:Ue,currentStartMin:ze,currentDuration:Fe.duration||60})},fe=(Y,Fe)=>{Y.dataTransfer.setData("text/plain",Fe.id),Y.dataTransfer.setData("from-allday","true")},ye=async Y=>{Y.preventDefault();const Fe=Y.dataTransfer.getData("text/plain");if(Y.dataTransfer.getData("from-allday"),!Fe)return;const Ue=Y.currentTarget.getBoundingClientRect(),ze=Y.currentTarget.scrollTop||0,Qe=Y.clientY-Ue.top+ze,Z=Math.floor(Qe/cs*60/15)*15,Ne=(S?k:r).find(kt=>kt.id===Fe),Pe=(Ne==null?void 0:Ne.duration)||60,We=new Date(p);We.setHours(Math.floor(Z/60)),We.setMinutes(Z%60),await Ge.updateTask(Fe,{start_date:We.toISOString(),start_time:Re(Z),end_time:Re(Z+Pe),duration:Pe,is_all_day:!1})},_e=async Y=>{Y.preventDefault();const Fe=Y.dataTransfer.getData("text/plain");Fe&&await Ge.updateTask(Fe,{start_date:p.toISOString(),is_all_day:!0,start_time:null,end_time:null,duration:null})},ft=Y=>{Y.preventDefault(),Y.dataTransfer.dropEffect="move"},lt=Y=>{V(null);const Fe=Y.currentTarget.getBoundingClientRect(),Ue=Y.clientY-Fe.top,ze=Math.floor(Ue/cs*60/15)*15;if(window.innerWidth<768){const Qe=new Date(p);Qe.setHours(Math.floor(ze/60)),Qe.setMinutes(ze%60);const Z=Be(),Ne=Z?[Z.id]:[],Pe={id:"new",title:"",start_time:Re(ze),duration:60,end_time:Re(ze+60),start_date:ws(p,"yyyy-MM-dd"),is_all_day:!1,tags:Ne};O(Pe),l("new");return}N({startY:Y.clientY,startMin:ze,currentDuration:60})};x.useEffect(()=>{if((!ot||ot.isTouch)&&!_)return;const Y=Pe=>{if(ot){const We=Pe-ot.initialY,kt=Math.round(We/cs*60/15)*15;if(ot.type==="move"){let Vt=ot.originalStartMin+kt;Vt=Math.max(0,Math.min(1440-ot.currentDuration,Vt)),Ot(Ft=>Ft?{...Ft,currentStartMin:Vt}:null)}else{let Vt=ot.originalDuration+kt;Vt=Math.max(15,Vt),Ot(Ft=>Ft?{...Ft,currentDuration:Vt}:null)}}else if(_){const We=Pe-_.startY;let Vt=60+Math.round(We/cs*60/15)*15;Vt<15&&(Vt=15),N(Ft=>Ft?{...Ft,currentDuration:Vt}:null)}},Fe=()=>{if(ot){const{taskId:Pe,currentStartMin:We,currentDuration:kt}=ot,Vt=(S?k:r).find(fn=>fn.id===Pe);if(Vt){const fn=se(Vt);if(!fn.canEdit){d==null||d({msg:fn.reason||"",type:"error"}),Ot(null);return}}const Ft=Re(We),nn=Re(We+kt),Xt=new Date(p);Xt.setHours(Math.floor(We/60)),Xt.setMinutes(We%60);const Jt={start_time:Ft,duration:kt,end_time:nn,start_date:Xt.toISOString()};i(Pe,Jt),S&&D(fn=>fn.map(yn=>yn.id===Pe?{...yn,...Jt}:yn)),Ot(null)}else if(_){const Pe=new Date(p);Pe.setHours(Math.floor(_.startMin/60)),Pe.setMinutes(_.startMin%60);const We=Be(),kt=We?[We.id]:[],Vt={id:"new",title:"",start_time:Re(_.startMin),duration:_.currentDuration,end_time:Re(_.startMin+_.currentDuration),start_date:Pe.toISOString(),is_all_day:!1,tags:kt};O(Vt),l("new"),N(null)}},Ue=Pe=>Y(Pe.clientY),ze=()=>Fe(),Qe=Pe=>{Pe.cancelable&&Pe.preventDefault(),Y(Pe.touches[0].clientY)},Z=()=>Fe(),Ne=()=>Fe();return window.addEventListener("mousemove",Ue),window.addEventListener("mouseup",ze),window.addEventListener("touchmove",Qe,{passive:!1}),window.addEventListener("touchend",Z),window.addEventListener("touchcancel",Ne),()=>{window.removeEventListener("mousemove",Ue),window.removeEventListener("mouseup",ze),window.removeEventListener("touchmove",Qe),window.removeEventListener("touchend",Z),window.removeEventListener("touchcancel",Ne)}},[ot,_,p,i,S,s]);const nt=x.useRef(null),Et=x.useRef({x:0,y:0}),jt=x.useRef(!1),ne=x.useRef(0),Te=x.useRef(60),Ce=Y=>{it(),ot&&Ot(null),V(null)},rt=Y=>{const Fe=Y.touches[0];if(jt.current&&Se.current){const Qe=Se.current.getBoundingClientRect(),Z=Se.current.scrollTop;let We=(Fe.clientY-Qe.top+Z)/cs*60-ne.current;We<15&&(We=15),We=Math.round(We/15)*15,Te.current=We,N(kt=>kt&&{...kt,currentDuration:We});return}const Ue=Math.abs(Fe.clientX-Et.current.x),ze=Math.abs(Fe.clientY-Et.current.y);(Ue>10||ze>10)&&nt.current&&(clearTimeout(nt.current),nt.current=null)},q=()=>{if(nt.current&&(clearTimeout(nt.current),nt.current=null),jt.current){jt.current=!1;const Y=ne.current,Fe=Te.current,Ue=Re(Y),ze=Re(Y+Fe),Qe=$e.find(Ne=>Ne.name.includes("-Wei"))||$e.find(Ne=>Ne.name.toLowerCase().includes("wei")&&!Ne.name.toLowerCase().includes("google")),Z=Qe?[Qe.id]:[];O({title:"",start_time:Ue,end_time:ze,start_date:ws(p,"yyyy-MM-dd"),duration:Fe,is_all_day:!1,tags:Z}),l("new"),N(null)}},De=async()=>{ae(!0);const Y=he;if(Y.length===0&&!confirm("")){ae(!1);return}const Fe=Y.map(Ft=>({id:Ft.id,title:Ft.title,start_time:Ft.start_time,end_time:Ft.end_time,status:Ft.status,tags:Ft.tags,duration:Ft.duration,start_date:Ft.start_date})),Ue=new Set(Fe.flatMap(Ft=>Ft.tags||[])),ze=s.find(Ft=>Ft.name.includes("-Wei"));ze&&Ue.add(ze.id);const Qe=s.filter(Ft=>Ue.has(Ft.id)).map(Ft=>({id:Ft.id,name:Ft.name,color:Ft.color}));if(a&&xe)try{const Ft=ws(p,"yyyy-MM-dd"),{data:nn,error:Xt}=await xe.from("schedule_snapshots").insert({data:{tasks:Fe,tags:Qe,date:Ft},created_by:a.id,title:`Heart Schedule - ${Ft}`}).select("id").single();if(nn&&!Xt){const Jt=`${window.location.origin}/share/heart/s/${nn.id}`;W(Jt),navigator.clipboard.writeText(Jt).catch(()=>console.warn("Auto-copy failed")),ae(!1);return}else console.error("Snapshot Creation Error:",Xt)}catch(Ft){console.error("Snapshot Exception:",Ft)}const Z=JSON.stringify(Qe),Ne=encodeURIComponent(Z),Pe=JSON.stringify(Fe),We=encodeURIComponent(Pe),kt=ws(p,"yyyy-MM-dd"),Vt=`${window.location.origin}/share/heart/${(a==null?void 0:a.id)||"share"}?date=${kt}&d=${We}&tags=${Ne}`;W(Vt),navigator.clipboard.writeText(Vt).catch(()=>{}),ae(!1)},st=x.useMemo(()=>{const Y=ee.map(Fe=>ot&&ot.taskId===Fe.id?{...Fe,start_time:Re(ot.currentStartMin),duration:ot.currentDuration}:Fe);return Nt(Y)},[ee,ot]);return c.jsxs("div",{className:"fixed inset-0 z-[1000] bg-white/95 backdrop-blur-xl flex flex-col overflow-hidden font-sans text-gray-800",children:[c.jsx("div",{className:"absolute top-0 right-0 w-[50vh] h-[50vh] bg-pink-200/20 rounded-full blur-[100px] pointer-events-none"}),c.jsx("div",{className:"absolute bottom-0 left-0 w-[50vh] h-[50vh] bg-purple-200/20 rounded-full blur-[100px] pointer-events-none"}),c.jsxs("header",{className:"flex-shrink-0 px-3 py-2 md:px-6 md:py-4 flex items-center justify-between relative z-10 bg-white/50 backdrop-blur-sm border-b border-pink-100",children:[!e&&t&&c.jsx("button",{onClick:t,className:"p-1 md:p-2 rounded-full hover:bg-gray-100 text-gray-500",children:c.jsx(un,{size:18,className:"md:w-5 md:h-5"})}),e&&c.jsx("div",{className:"w-8 md:w-10"}),c.jsxs("div",{className:"flex bg-gray-100/50 p-1 rounded-full items-center",children:[c.jsxs("button",{onClick:()=>h("schedule"),className:`
                            flex items-center gap-1 md:gap-2 px-3 py-1.5 rounded-full transition-all text-sm font-bold
                            ${f==="schedule"?"bg-white shadow-sm text-pink-500":"text-gray-400 hover:text-gray-600"}
                        `,children:[c.jsx(cu,{size:16,className:f==="schedule"?"fill-pink-500":""}),c.jsx("span",{className:f==="schedule"?"":"hidden md:inline",children:""})]}),c.jsxs("button",{onClick:()=>h("moments"),className:`
                            flex items-center gap-1 md:gap-2 px-3 py-1.5 rounded-full transition-all text-sm font-bold
                            ${f==="moments"?"bg-white shadow-sm text-purple-600":"text-gray-400 hover:text-gray-600"}
                        `,children:[c.jsx(II,{size:16,className:f==="moments"?"fill-purple-200 text-purple-600":""}),c.jsx("span",{className:f==="moments"?"":"hidden md:inline",children:""})]})]}),c.jsxs("div",{className:"flex items-center gap-1 md:gap-2 hidden",children:[c.jsx(cu,{className:"text-pink-500 fill-pink-500 animate-pulse md:w-6 md:h-6",size:20}),c.jsx("span",{className:"hidden md:inline text-lg font-bold tracking-wide bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent",children:"Our Time"}),c.jsx("span",{className:"md:hidden text-base font-bold text-pink-500",children:"Our Time"})]}),c.jsxs("div",{className:"flex gap-1 md:gap-2 items-center",children:[c.jsx("button",{onClick:()=>mt(),disabled:!Ie,className:`p-1 md:p-2 rounded-full transition-colors ${Ie?"hover:bg-gray-100 text-gray-700":"text-gray-300 cursor-not-allowed"}`,title:" (Ctrl+Z)",children:c.jsx(Og,{size:16,className:"md:w-[18px] md:h-[18px]"})}),c.jsx("button",{onClick:()=>ht(),disabled:!ge,className:`p-1 md:p-2 rounded-full transition-colors ${ge?"hover:bg-gray-100 text-gray-700":"text-gray-300 cursor-not-allowed"}`,title:" (Ctrl+Shift+Z)",children:c.jsx(Ov,{size:16,className:"md:w-[18px] md:h-[18px]"})}),c.jsx("button",{onClick:()=>w(!v),className:`p-1 md:p-2 rounded-full transition-colors ${v?"bg-pink-100 text-pink-600":"hover:bg-gray-100 text-gray-500"}`,children:c.jsx(GI,{size:18,className:"md:w-5 md:h-5"})}),c.jsx("button",{onClick:()=>I(!0),className:"p-1 md:p-2 rounded-full bg-pink-50 text-pink-500 hover:bg-pink-100",children:c.jsx(Gz,{size:18,className:"md:w-5 md:h-5"})})]})]}),f==="schedule"?c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex items-center justify-between px-6 py-2 relative z-10 bg-white/30 backdrop-blur-sm border-b border-gray-100",children:[c.jsx("button",{onClick:()=>m(_ne(p,1)),className:"p-1 text-gray-400 hover:text-pink-500",children:c.jsx($u,{size:18})}),c.jsxs("div",{className:"text-center cursor-pointer",onClick:()=>m(new Date),children:[c.jsx("div",{className:"text-lg font-bold text-gray-800",children:ws(p,"M d",{locale:SE})}),c.jsx("div",{className:"text-[10px] text-pink-500 font-medium tracking-widest uppercase",children:ws(p,"EEEE",{locale:SE})}),(()=>{const Y=DR(p);return Y?c.jsxs("div",{className:"text-[10px] text-amber-600 font-bold mt-0.5 tracking-wide",children:[" ",Y]}):null})()]}),c.jsx("button",{onClick:()=>m(zR(p,1)),className:"p-1 text-gray-400 hover:text-pink-500",children:c.jsx(rs,{size:18})})]}),c.jsx(bo,{children:v&&c.jsx(Pr.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"overflow-hidden border-b border-gray-100 bg-gray-50/80 backdrop-blur",children:c.jsxs("div",{className:"p-4",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-2 font-medium",children:""}),c.jsx("div",{className:"flex flex-wrap gap-2",children:$e.map(Y=>c.jsx("button",{onClick:()=>X(Y.id),className:`px-3 py-1 rounded-full text-xs transition-all border ${b.includes(Y.id)?"bg-pink-500 text-white border-pink-500 shadow-md transform scale-105":"bg-white text-gray-600 border-gray-200"}`,children:Y.name},Y.id))})]})})}),c.jsxs("div",{ref:Se,className:"flex-1 overflow-y-auto relative z-0 hide-scrollbar scroll-smooth",children:[ke.length>0&&c.jsxs("div",{className:"sticky top-0 z-30 bg-gradient-to-b from-pink-50/90 to-purple-50/90 backdrop-blur-md border-b-2 border-pink-200/50 px-6 py-2",onDragOver:ft,onDrop:_e,onDoubleClick:async()=>{const Y=await Ge.addTask({title:"",start_date:p.toISOString(),is_all_day:!0,status:"inbox"});l(Y)},children:[c.jsxs("div",{className:"text-[10px] font-bold text-pink-600 uppercase tracking-wider flex items-center gap-1.5 cursor-pointer select-none",onClick:()=>j(!E),children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-pink-500"}),"",c.jsx("span",{className:"text-pink-400 ml-auto",children:E?c.jsx(vp,{size:14}):c.jsx(ts,{size:14})})]}),E&&c.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:ke.map(Y=>{var Ue;const Fe=((Ue=s.find(ze=>{var Qe;return(Qe=Y.tags)==null?void 0:Qe.includes(ze.id)}))==null?void 0:Ue.color)||"#ec4899";return c.jsx("div",{draggable:!0,onDragStart:ze=>fe(ze,Y),onClick:()=>{const ze=se(Y);if(!ze.canEdit){d==null||d({msg:ze.reason||"",type:"error"});return}l(Y.id)},className:"group relative px-3 py-1.5 rounded-full text-xs font-medium cursor-pointer transition-all hover:shadow-md hover:scale-105 border-2",style:{backgroundColor:Fe+"20",borderColor:Fe+"60",color:Fe},children:c.jsxs("div",{className:"flex items-center gap-1.5",children:[Y.status==="completed"&&c.jsx(au,{size:12,className:"flex-shrink-0"}),c.jsx("span",{className:"truncate max-w-[200px]",children:Y.title||"()"})]})},Y.id)})})]}),c.jsxs("div",{className:"relative min-h-[1536px] w-full bg-white/40 cursor-crosshair",onMouseDown:lt,onTouchStart:Ce,onTouchMove:rt,onTouchEnd:q,onDragOver:ft,onDrop:ye,children:[Array.from({length:24}).map((Y,Fe)=>c.jsxs("div",{className:"absolute w-full border-t border-gray-100 flex pointer-events-none",style:{top:Fe*cs,height:cs},children:[c.jsxs("div",{className:"w-14 text-[10px] text-gray-400 font-mono text-right pr-2 -mt-2 select-none",children:[Fe.toString().padStart(2,"0"),":00"]}),c.jsx("div",{className:"flex-1 border-l border-gray-50 h-full relative",children:c.jsx("div",{className:"absolute top-1/2 w-full border-t border-gray-50 border-dashed"})})]},Fe)),tp(new Date,p)&&c.jsx("div",{className:"absolute left-14 right-0 border-t-2 border-red-400 z-20 pointer-events-none flex items-center",style:{top:(new Date().getHours()*60+new Date().getMinutes())/60*cs},children:c.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full -ml-1"})}),_&&c.jsx("div",{className:"absolute left-16 right-2 bg-pink-100/50 border-2 border-pink-400 border-dashed rounded-xl z-30 pointer-events-none",style:{top:`${_.startMin/60*cs}px`,height:`${_.currentDuration/60*cs}px`},children:c.jsxs("div",{className:"p-2 text-xs font-bold text-pink-600",children:[Re(_.startMin)," - ",Re(_.startMin+_.currentDuration)," ..."]})}),c.jsx("div",{className:"absolute top-0 right-2 left-16 bottom-0 pointer-events-none",children:ee.map(Y=>{const Fe=(ot==null?void 0:ot.taskId)===Y.id,Ue=(Y.duration||60)<45,ze=st[Y.id],Qe=Fe?{top:`${ot.currentStartMin/60*cs}px`,height:`${ot.currentDuration/60*cs}px`,left:(ze==null?void 0:ze.left)||"0%",width:(ze==null?void 0:ze.width)||"100%",zIndex:50}:{..._t(Y),left:(ze==null?void 0:ze.left)||"0%",width:(ze==null?void 0:ze.width)||"100%"};let Z="#ec4899";if(Y.tags&&Y.tags.length>0){const Pe=$e.filter(kt=>Y.tags.includes(kt.id)),We=Pe.find(kt=>kt.name.toLowerCase().includes("google"))||Pe[0];We&&We.color&&(Z=We.color)}const Ne=Y.status==="completed"?{}:{borderColor:Z,backgroundColor:`${Z}1A`,borderLeftWidth:"4px",borderLeftColor:Z};return c.jsxs("div",{style:{...Qe,...Ne},className:`absolute w-full rounded-r-xl rounded-l-md border ${Ue?"p-1":"p-2"} text-xs flex flex-col overflow-hidden transition-all shadow-sm group pointer-events-auto
                                        ${Y.status==="completed"?"bg-gray-50 border-gray-200 opacity-60":"hover:shadow-md"}
                                        ${Fe?"shadow-xl ring-2 ring-pink-400 opacity-90 cursor-grabbing":"cursor-grab"}
                                        ${L===Y.id?"ring-2 ring-pink-500 z-10 shadow-md":""}
                                    `,onClick:Pe=>{Pe.stopPropagation(),Fe||V(Y.id)},onDoubleClick:Pe=>{if(Pe.stopPropagation(),!Fe){const We=se(Y);if(!We.canEdit){d==null||d({msg:We.reason||"",type:"error"});return}l(Y.id),O(null)}},onMouseDown:Pe=>{const We=se(Y);if(!We.canEdit){Pe.stopPropagation(),Pe.preventDefault(),d==null||d({msg:We.reason||"",type:"error"});return}yt(Pe,Y,"move")},onTouchStart:Pe=>Me(Pe,Y,"move"),children:[L===Y.id&&c.jsx("div",{className:"absolute top-1 right-1 p-1.5 bg-red-500 text-white rounded-full shadow-lg z-50 cursor-pointer transform hover:scale-110 active:scale-95 transition-all",onClick:Pe=>{Pe.stopPropagation();const We=se(Y);if(!We.canEdit){d==null||d({msg:We.reason||"",type:"error"});return}Ge.deleteTask(Y.id),V(null)},children:c.jsx(Er,{size:14})}),Ue?c.jsxs("div",{className:"flex items-center gap-1 w-full overflow-hidden h-full",children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full shrink-0",style:{backgroundColor:Y.status==="completed"?"#9ca3af":Z}}),c.jsx("span",{className:"font-bold text-gray-800 truncate flex-1 min-w-0",children:Y.title}),c.jsx("span",{className:"text-[9px] text-gray-500 font-mono shrink-0",children:Fe&&ot?Re(ot.currentStartMin):Y.start_time}),Y.status==="completed"&&c.jsx(au,{size:10,className:"text-gray-400 shrink-0"})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex items-start gap-1 font-bold text-gray-800 w-full",children:[c.jsx("div",{className:"w-2 h-2 rounded-full mt-1 shrink-0",style:{backgroundColor:Y.status==="completed"?"#9ca3af":Z}}),c.jsx("span",{className:"whitespace-normal break-words leading-tight w-full",children:Y.title}),Y.status==="completed"&&c.jsx(au,{size:12,className:"text-gray-400 shrink-0 mt-0.5"})]}),c.jsx("div",{className:"text-[10px] text-gray-500 truncate shrink-0 font-mono mt-0.5",children:Fe&&ot?`${Re(ot.currentStartMin)} - ${Re(ot.currentStartMin+ot.currentDuration)}`:`${Y.start_time} - ${Y.end_time||Re(pe(Y.start_time)+(Y.duration||60))}`})]}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-3 cursor-ns-resize flex items-center justify-center opacity-0 group-hover:opacity-100 hover:bg-black/5",onMouseDown:Pe=>{const We=se(Y);if(!We.canEdit){Pe.stopPropagation(),Pe.preventDefault(),d==null||d({msg:We.reason||"",type:"error"});return}yt(Pe,Y,"resize")},onTouchStart:Pe=>{const We=se(Y);if(!We.canEdit){Pe.stopPropagation(),Pe.preventDefault(),d==null||d({msg:We.reason||"",type:"error"});return}Pe.stopPropagation(),Me(Pe,Y,"resize")},children:c.jsx(OI,{size:12,className:"text-gray-400"})})]},Y.id)})}),ke.length===0&&ee.length===0&&!_&&c.jsxs("div",{className:"absolute top-1/3 left-0 right-0 text-center text-gray-400 pointer-events-none",children:[c.jsx(cu,{size:48,className:"mx-auto mb-2 opacity-20"}),c.jsxs("p",{children:["",c.jsx("br",{}),c.jsx("span",{className:"text-xs opacity-50",children:""})]})]})]})]}),c.jsx("div",{className:"md:hidden fixed bottom-6 right-6 z-[900]",children:c.jsx("button",{onClick:()=>{const Y="08:00",Fe="09:00",Ue=Be(),ze=Ue?[Ue.id]:[];O({title:"",start_time:Y,end_time:Fe,start_date:ws(p,"yyyy-MM-dd"),duration:60,is_all_day:!1,tags:ze}),l("new")},className:"w-14 h-14 bg-pink-500 rounded-full shadow-lg flex items-center justify-center text-white active:scale-95 transition-transform",children:c.jsx(ni,{size:28})})})]}):c.jsx("div",{className:"flex-1 overflow-y-auto relative custom-scrollbar",children:c.jsx(Bne,{tasks:Ge.tasks,tags:Ge.tags,isGuest:S,onAddTask:ie,onUpdateTask:me,onDeleteTask:Q,scrollRef:y})}),c.jsx(bo,{children:C&&c.jsx("div",{className:"fixed inset-0 z-[1100] bg-black/40 backdrop-blur-sm flex items-center justify-center p-4",children:c.jsxs(Pr.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl",children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsx("h3",{className:"text-xl font-bold",children:""}),c.jsx("button",{onClick:()=>{I(!1),W(null)},children:c.jsx(un,{size:20})})]}),H?c.jsxs("div",{className:"space-y-4",children:[c.jsx("div",{className:"bg-green-50 text-green-700 p-3 rounded-lg text-sm text-center",children:""}),c.jsxs("div",{className:"relative",children:[c.jsx("input",{type:"text",value:H,readOnly:!0,className:"w-full bg-gray-50 border border-gray-200 rounded-lg py-2 px-3 text-sm text-gray-600 pr-10",onClick:Y=>Y.currentTarget.select()}),c.jsx("button",{onClick:()=>{navigator.clipboard.writeText(H),d==null||d({msg:"",type:"success"})},className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-900",children:c.jsx(m2,{size:16})})]}),c.jsx("button",{onClick:()=>{navigator.clipboard.writeText(H),d==null||d({msg:"",type:"success"})},className:"w-full py-3 bg-gray-900 text-white rounded-xl font-medium",children:""})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"bg-pink-50 rounded-xl p-4 flex flex-col items-center mb-6",children:c.jsxs("p",{className:"text-center text-sm text-gray-600",children:["",c.jsx("br",{}),""]})}),c.jsx("button",{onClick:De,disabled:R,className:"w-full py-3 bg-gray-900 text-white rounded-xl font-medium flex items-center justify-center gap-2 disabled:opacity-50",children:R?c.jsx(c.Fragment,{children:"..."}):c.jsxs(c.Fragment,{children:[c.jsx(m2,{size:18})," "]})})]})]})})}),u&&c.jsx(En.Provider,{value:Ge,children:c.jsx("div",{className:"absolute inset-0 z-[1200]",children:c.jsx(kb,{initialData:u==="new"?A:S?k.find(Y=>Y.id===u):r.find(Y=>Y.id===u),isReadOnly:(()=>{if(u==="new")return!1;const Y=S?k.find(Fe=>Fe.id===u):r.find(Fe=>Fe.id===u);return Y?!se(Y).canEdit:!1})(),onClose:()=>{l(null),O(null)}})})})]})},yre=()=>{const{user:t,logout:e,syncStatus:n,view:r,setView:s,tagFilter:i,setTagFilter:o,tasks:a,tags:l,toast:u,setToast:d,undo:f,redo:h,canUndo:p,canRedo:m,canNavigateBack:y,navigateBack:b,archiveCompletedTasks:g,editingTaskId:v,setEditingTaskId:w,themeSettings:C,sidebarWidth:I,setSidebarWidth:k,sidebarCollapsed:D,selectedTaskIds:S,dragState:T}=x.useContext(En),[_,N]=x.useState(!1),[A,O]=x.useState(!1),[L,V]=x.useState(!1),[E,j]=x.useState(!1),[H,W]=x.useState(!1),[R,ae]=x.useState(!1),[re,$]=x.useState(!1),[z,le]=x.useState(typeof window<"u"&&window.innerWidth<768);x.useEffect(()=>{const Ie=()=>le(window.innerWidth<768);return window.addEventListener("resize",Ie),()=>window.removeEventListener("resize",Ie)},[]);const[$e,Be]=x.useState(()=>{const Ie=localStorage.getItem("fabPosition");return Ie?JSON.parse(Ie):{x:window.innerWidth-80,y:window.innerHeight-80}}),[se,Se]=x.useState(!1),ce=x.useRef({x:0,y:0});x.useEffect(()=>{const Ie=ie=>{if(se){const me=Math.max(20,Math.min(window.innerWidth-70,ie.clientX-ce.current.x)),Q=Math.max(20,Math.min(window.innerHeight-70,ie.clientY-ce.current.y));Be({x:me,y:Q})}},ge=()=>{se&&(Se(!1),localStorage.setItem("fabPosition",JSON.stringify($e)))};return window.addEventListener("mousemove",Ie),window.addEventListener("mouseup",ge),()=>{window.removeEventListener("mousemove",Ie),window.removeEventListener("mouseup",ge)}},[se,$e]);const Ee={small:"text-sm",normal:"text-base",large:"text-lg"}[C.fontSize]||"text-base",He=C.fontWeight==="thin"?"font-light":"font-bold",tt=C.fontFamily==="things"?"font-things":"font-sans",ut=v?a.find(Ie=>Ie.id===v):null;x.useEffect(()=>{const Ie=ge=>{ge.key==="k"&&(ge.metaKey||ge.ctrlKey)&&(ge.preventDefault(),N(ie=>!ie)),ge.key==="Escape"&&(v?w(null):R?ae(!1):N(!1)),(ge.metaKey||ge.ctrlKey)&&ge.shiftKey&&ge.code==="KeyM"&&S.length>0&&(ge.preventDefault(),ae(!0))};return window.addEventListener("keydown",Ie),()=>window.removeEventListener("keydown",Ie)},[v,w,S,R]),x.useEffect(()=>{const Ie=ie=>{if(!A)return;let me=ie.clientX;me<150&&(me=150),me>400&&(me=400),k(me)},ge=()=>{O(!1),document.body.style.cursor="default"};return A&&(window.addEventListener("mousemove",Ie),window.addEventListener("mouseup",ge),document.body.style.cursor="col-resize"),()=>{window.removeEventListener("mousemove",Ie),window.removeEventListener("mouseup",ge)}},[A]);const Ge=()=>{var Ie;return i?((Ie=l.find(ge=>ge.id===i))==null?void 0:Ie.name)||"Tags":r==="focus"?"Focus":r.charAt(0).toUpperCase()+r.slice(1)},mt=T!=null&&T.draggedId?a.find(Ie=>Ie.id===T.draggedId):null,ht=S.includes((T==null?void 0:T.draggedId)||"")?S.length:1;return c.jsxs("div",{"data-theme":C.themeMode&&C.themeMode!=="light"?C.themeMode:void 0,className:`flex h-screen bg-theme-main text-theme-primary ${tt} selection:bg-indigo-50 selection:text-indigo-900`,children:[(T==null?void 0:T.isDragging)&&mt&&c.jsx(dte,{task:mt,position:T.ghostPosition,count:ht}),c.jsxs("div",{style:{width:D?64:I},className:`relative flex-shrink-0 hidden md:block transition-all duration-300 ease-in-out ${T!=null&&T.isDragging,"z-10"}`,children:[c.jsx(fE,{view:r,setView:s,tagFilter:i,setTagFilter:o}),!D&&!(T!=null&&T.isDragging)&&c.jsx("div",{className:"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-theme-main/10 transition-colors z-50",onMouseDown:()=>O(!0)})]}),L&&c.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 md:hidden",onClick:()=>V(!1),children:c.jsx("div",{className:"absolute left-0 top-0 h-full w-[280px] bg-theme-sidebar shadow-2xl animate-in slide-in-from-left duration-200",onClick:Ie=>Ie.stopPropagation(),children:c.jsx(fE,{view:r,setView:Ie=>{s(Ie),V(!1)},tagFilter:i,setTagFilter:Ie=>{o(Ie),V(!1)}})})}),c.jsxs("main",{className:"flex-1 flex flex-col relative overflow-hidden bg-theme-main",children:[c.jsxs("header",{"data-app-header":"true",className:"h-14 flex items-center justify-between px-4 md:px-8 border-b border-theme z-30 sticky top-0 bg-theme-header backdrop-blur-sm",children:[c.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[c.jsx("button",{className:"md:hidden p-1 -ml-2 text-theme-secondary hover:bg-theme-hover rounded",onClick:()=>V(!0),children:c.jsx($z,{size:20})}),y&&c.jsxs("button",{onClick:b,className:"p-1 hover:bg-theme-hover rounded text-theme-secondary flex items-center gap-1 text-sm font-medium transition-colors",title:" (Alt + Left)",children:[c.jsx(AI,{size:16}),c.jsx("span",{className:"hidden md:inline",children:""})]}),y&&c.jsx("span",{className:"text-theme-secondary",children:"|"}),c.jsx("h2",{className:`${Ee} ${He} tracking-tight text-theme-primary`,children:Ge()})]}),c.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[S.length===1&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:()=>j(!0),className:"p-1.5 rounded hover:bg-indigo-500/10 text-indigo-400 transition-colors animate-in zoom-in duration-200 flex items-center gap-1",title:"72 (Mission 72 Transformations)",children:[c.jsx("span",{className:"text-xl leading-none filter drop-shadow-sm",children:""}),c.jsx("span",{className:"hidden lg:inline text-xs font-bold text-indigo-400",children:"72"})]}),c.jsxs("button",{onClick:()=>W(!0),className:"p-1.5 rounded hover:bg-amber-500/10 text-amber-500 transition-colors animate-in zoom-in duration-200 flex items-center gap-1",title:"GTD ",children:[c.jsx("span",{className:"text-xl leading-none filter drop-shadow-sm",children:""}),c.jsx("span",{className:"hidden lg:inline text-xs font-bold text-amber-600",children:""})]})]}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1"}),c.jsxs("button",{onClick:g,className:"p-1.5 rounded hover:bg-theme-hover text-theme-tertiary hover:text-emerald-500 transition-colors",title:" (Archive Completed)",children:[" ",c.jsx(um,{size:16})," "]}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1"}),c.jsx("button",{disabled:!p,onClick:f,className:`p-1 rounded hover:bg-theme-hover ${p?"opacity-100":"opacity-30"}`,title:" (Ctrl+Z)",children:c.jsx(Og,{size:14})}),c.jsx("button",{disabled:!m,onClick:h,className:`p-1 rounded hover:bg-theme-hover ${m?"opacity-100":"opacity-30"}`,title:" (Ctrl+Shift+Z)",children:c.jsx(Ov,{size:14})}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1"}),c.jsxs("div",{className:`flex items-center ${(t==null?void 0:t.email)==="bibo1243@gmail.com"?"":"hidden"}`,children:[c.jsx("button",{onClick:()=>$(!0),className:"p-1.5 rounded-full hover:bg-pink-50 text-pink-400 hover:text-pink-600 transition-colors",title:" (Shared Schedule)",children:c.jsx(cu,{size:18,className:re?"fill-pink-500 text-pink-500":""})}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1 inline-block"})]}),c.jsx(yte,{})]}),c.jsxs("div",{className:"flex items-center gap-1.5 pl-2 border-l border-theme ml-1",children:[c.jsxs("div",{className:"hidden md:flex flex-col items-end group relative",children:[c.jsx("span",{className:"text-[9px] text-theme-tertiary uppercase tracking-wider font-bold leading-none mb-0.5",children:"User"}),c.jsx("span",{className:"text-[10px] font-mono text-theme-secondary leading-none cursor-help",title:(t==null?void 0:t.id)||"Loading...",children:(t==null?void 0:t.email)||((t==null?void 0:t.id)==="00000000-0000-0000-0000-000000000000"?"Demo":t!=null&&t.id?`ID: ${t.id.slice(0,6)}...`:"Loading...")})]}),c.jsxs("div",{className:"w-6 h-6 rounded-full bg-indigo-500/20 text-indigo-400 flex items-center justify-center border border-indigo-500/30 relative group cursor-pointer",title:" (Logout)",onClick:e,children:[c.jsx(JI,{size:12,className:"group-hover:hidden"}),c.jsx(Pz,{size:12,className:"hidden group-hover:block text-red-500"})]})]}),c.jsxs("div",{className:`flex items-center gap-1 text-[10px] ml-1 ${n==="synced"?"text-green-500":n==="error"?"text-red-500":"text-orange-400"}`,children:[n==="synced"?c.jsx(pz,{size:12}):c.jsx(hz,{size:12,className:"animate-pulse"}),c.jsx("span",{className:"uppercase tracking-wider hidden lg:inline",children:n==="synced"?"Synced":n==="error"?"Error":"Syncing..."})]}),n==="error"&&c.jsx("div",{className:"text-[10px] text-red-500 flex items-center gap-1",children:c.jsx(Zf,{size:12})})]})]}),c.jsx(ote,{}),c.jsx("div",{className:`flex-1 overflow-y-auto scroll-smooth no-scrollbar prevent-pull-refresh ${r!=="focus"&&r!=="project"&&r!=="annualplan"?"p-2 md:p-4":""}`,children:r==="journal"?c.jsx(Kee,{}):r==="focus"?c.jsx(ete,{}):r==="project"?c.jsx(rte,{}):r==="annualplan"?c.jsx(ite,{}):r==="matrix"?c.jsx(cte,{}):r==="worklog"?c.jsx(ute,{}):c.jsx("div",{className:"w-full md:w-[calc(100%-100px)] mx-auto mt-2 md:mt-8",children:c.jsx(jR,{})})}),v&&(r==="calendar"||r==="journal"||r==="focus"||r==="matrix")&&ut&&c.jsx(kb,{initialData:ut,onClose:()=>w(null)}),c.jsx("button",{onMouseDown:Ie=>{ce.current={x:Ie.clientX-$e.x,y:Ie.clientY-$e.y};const ge=Ie.clientX,ie=Ie.clientY,me=Q=>{(Math.abs(Q.clientX-ge)>5||Math.abs(Q.clientY-ie)>5)&&(Se(!0),window.removeEventListener("mousemove",me))};window.addEventListener("mousemove",me),window.addEventListener("mouseup",()=>window.removeEventListener("mousemove",me),{once:!0})},onClick:()=>{se||N(!0)},style:{left:$e.x,top:$e.y},className:`fixed z-40 h-14 w-14 rounded-full bg-indigo-600 text-white shadow-xl hover:bg-indigo-700 transition-all flex items-center justify-center group fab-mobile md:hidden ${se?"cursor-grabbing scale-110":"cursor-grab hover:scale-105 active:scale-95"}`,title:"Create New Task (Drag to move)",children:c.jsx(ni,{size:28,className:"group-hover:rotate-90 transition-transform duration-200"})}),_&&!z&&c.jsx(kb,{onClose:()=>N(!1)}),_&&z&&c.jsx(wb,{taskId:void 0,onClose:()=>N(!1)}),E&&S.length===1&&c.jsx(lte,{taskId:S[0],onClose:()=>j(!1)}),H&&S.length===1&&c.jsx(bte,{taskId:S[0],onClose:()=>W(!1)}),u&&c.jsx(ate,{toast:u,onClose:()=>d(null)}),v&&z&&c.jsx(wb,{taskId:v,onClose:()=>w(null)}),R&&c.jsx(hte,{onClose:()=>ae(!1)}),re&&c.jsx(KR,{onClose:()=>$(!1)})]})]})},xre=()=>{const[t,e]=x.useState(!1),[n,r]=x.useState(""),[s,i]=x.useState(""),[o,a]=x.useState("signin"),[l,u]=x.useState(null),[d,f]=x.useState(null),h=async p=>{p.preventDefault(),e(!0),u(null),f(null);let m=n,y=s;n.toLowerCase()==="demo"&&s.toLowerCase()==="demo"&&(m="demo@demo.com",y="demodemo");try{if(!xe)throw new Error("Supabase client not initialized");if(o==="signup"){const{data:b,error:g}=await xe.auth.signUp({email:m,password:y});if(g)throw g;b.session?(f("..."),setTimeout(()=>{window.location.reload()},500)):b.user&&!b.session&&f("")}else{const{error:b}=await xe.auth.signInWithPassword({email:m,password:y});if(b)throw b;window.location.reload()}}catch(b){u(b.message)}finally{e(!1)}};return c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:c.jsxs("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[c.jsxs("div",{className:"flex flex-col items-center mb-8",children:[c.jsx("div",{className:"w-12 h-12 bg-indigo-600 rounded-xl flex items-center justify-center text-white mb-4 shadow-lg shadow-indigo-200",children:c.jsx(a1,{size:24})}),c.jsx("h1",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:"Things Clone"}),c.jsx("p",{className:"text-sm text-gray-500 mt-2",children:""})]}),l&&c.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-600 text-sm rounded-lg border border-red-100",children:l}),d&&c.jsx("div",{className:"mb-4 p-3 bg-green-50 text-green-600 text-sm rounded-lg border border-green-100",children:d}),c.jsxs("form",{onSubmit:h,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1 ml-1",children:"Email"}),c.jsxs("div",{className:"relative",children:[c.jsx(Lz,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),c.jsx("input",{type:"text",required:!0,value:n,onChange:p=>r(p.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-100 focus:border-indigo-400 outline-none transition-all text-sm",placeholder:"name@example.com  demo"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1 ml-1",children:"Password"}),c.jsxs("div",{className:"relative",children:[c.jsx(La,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),c.jsx("input",{type:"password",required:!0,value:s,onChange:p=>i(p.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-100 focus:border-indigo-400 outline-none transition-all text-sm",placeholder:"",minLength:6})]})]}),c.jsx("button",{type:"submit",disabled:t,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2.5 rounded-lg transition-all flex items-center justify-center gap-2 shadow-lg shadow-indigo-100 disabled:opacity-70 disabled:cursor-not-allowed",children:t?c.jsx(yi,{className:"animate-spin",size:18}):c.jsxs(c.Fragment,{children:[o==="signin"?"":"",c.jsx(Dv,{size:16})]})})]}),c.jsx("div",{className:"mt-6 text-center",children:c.jsx("button",{type:"button",onClick:()=>a(o==="signin"?"signup":"signin"),className:"text-sm text-indigo-600 hover:text-indigo-500 font-medium",children:o==="signin"?"":""})}),c.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-100",children:[c.jsx("p",{className:"text-xs text-gray-400 text-center mb-3",children:" Demo "}),c.jsx("button",{type:"button",onClick:async()=>{e(!0),u(null);try{if(!xe)throw new Error("Supabase client not initialized");const{error:p}=await xe.auth.signInWithPassword({email:"demo@demo.com",password:"demodemo"});if(p)throw p;window.location.reload()}catch(p){u("Demo : "+p.message)}finally{e(!1)}},disabled:t,className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 rounded-lg transition-all flex items-center justify-center gap-2 text-sm disabled:opacity-70",children:" Demo "}),c.jsxs("p",{className:"text-[10px] text-gray-400 text-center mt-2",children:[" ",c.jsx("span",{className:"font-mono font-bold",children:"demo"})," "]})]})]})})},bre=()=>{const{isRecording:t,recordingTime:e,stopRecording:n,analyser:r,recordingTaskId:s}=x.useContext(Lu),{setFocusedTaskId:i,tasks:o,setView:a,setExpandedTaskIds:l,setEditingTaskId:u}=x.useContext(En),[d,f]=x.useState(!1),h=x.useRef(null),p=x.useRef(),m=()=>{if(!s)return;a("allview");const b=o.find(g=>g.id===s);if(b){let g=b;const v=[];for(;g.parent_id;){v.push(g.parent_id);const w=o.find(C=>C.id===g.parent_id);if(!w)break;g=w}v.length>0&&l(w=>[...new Set([...w,...v])])}i(s),u(s),f(!1)};if(x.useEffect(()=>{if(!t||!r||!h.current)return;const b=h.current,g=b.getContext("2d");if(!g)return;const v=r.frequencyBinCount,w=new Uint8Array(v),C=()=>{if(!r)return;p.current=requestAnimationFrame(C),r.getByteTimeDomainData(w),g.clearRect(0,0,b.width,b.height),g.lineWidth=2,g.strokeStyle="rgba(255, 255, 255, 0.8)",g.beginPath();const I=b.width/v;let k=0;for(let D=0;D<v;D++){const T=w[D]/128*b.height/2;D===0?g.moveTo(k,T):g.lineTo(k,T),k+=I}g.lineTo(b.width,b.height/2),g.stroke()};return C(),()=>{p.current&&cancelAnimationFrame(p.current)}},[t,r]),!t)return null;const y=b=>{const g=Math.floor(b/1e3),v=Math.floor(g/60),w=g%60;return`${v.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`};return d?c.jsx("div",{className:"fixed bottom-6 left-6 z-[99999] animate-in fade-in zoom-in duration-300 cursor-pointer group",onClick:m,title:"Recording in progress. Click to locate task.",children:c.jsxs("div",{className:"bg-black/80 backdrop-blur-md border border-emerald-500/30 rounded-full p-2.5 shadow-2xl flex items-center justify-center relative hover:bg-black/90 transition-all hover:scale-110",children:[c.jsx("div",{className:"w-2.5 h-2.5 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_10px_rgba(16,185,129,0.8)]"}),c.jsx("div",{className:"absolute left-full ml-3 bg-black/90 text-white text-[10px] px-2 py-1 rounded-md whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none border border-white/10 shadow-xl font-mono",children:y(e)})]})}):c.jsx("div",{className:"fixed bottom-6 left-1/2 transform -translate-x-1/2 z-[99999] animate-in fade-in slide-in-from-bottom-4 duration-300","data-recording-capsule":!0,children:c.jsxs("div",{className:"bg-black/90 backdrop-blur-xl text-white rounded-full flex items-center p-2 pl-4 pr-3 shadow-2xl border border-white/10 gap-3 min-w-[200px] hover:scale-[1.01] transition-transform",children:[c.jsx("button",{onClick:b=>{b.stopPropagation(),b.preventDefault(),n()},className:"w-8 h-8 rounded-full bg-red-500/20 text-red-400 flex items-center justify-center hover:bg-red-500 hover:text-white transition-all cursor-pointer",title:"Stop Recording",children:c.jsx(Yz,{size:12,fill:"currentColor"})}),c.jsx("div",{className:"flex flex-col items-center min-w-[50px] cursor-pointer hover:opacity-80 transition-opacity",onClick:m,title:"Click to locate task",children:c.jsx("span",{className:"font-mono text-sm font-medium tabular-nums tracking-wider text-white",children:y(e)})}),c.jsx("div",{className:"w-20 h-8 relative opacity-80 flex items-center cursor-pointer",onClick:m,title:"Click to locate task",children:c.jsx("canvas",{ref:h,width:80,height:32,className:"w-full h-full"})}),c.jsx("div",{className:"h-6 w-[1px] bg-white/10 mx-1"}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:m,className:"p-1.5 text-gray-400 hover:text-white hover:bg-white/10 rounded-full transition-colors",title:"Locate Recording Task",children:c.jsx(Oz,{size:14})}),c.jsx("button",{onClick:()=>f(!0),className:"p-1.5 text-gray-400 hover:text-white hover:bg-white/10 rounded-full transition-colors",title:"Minimize",children:c.jsx(ts,{size:16})})]})]})})},_E=()=>c.jsx("div",{className:"w-full h-screen bg-gray-100 flex items-center justify-center",children:c.jsx("div",{className:"w-full h-full md:max-w-[430px] md:h-[90vh] md:rounded-[3rem] md:border-8 md:border-gray-900 bg-white relative shadow-2xl overflow-hidden",children:c.jsx(KR,{isStandalone:!0})})}),vre=()=>{const{user:t,loading:e}=x.useContext(En);if(e)return c.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:c.jsxs("div",{className:"flex flex-col items-center gap-3",children:[c.jsx("div",{className:"w-8 h-8 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"}),c.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"Loading workspace..."})]})});const n=t&&t.aud==="authenticated";return c.jsxs(j3,{children:[c.jsx(hd,{path:"/share/heart/s/:snapshotId",element:c.jsx(_E,{})}),c.jsx(hd,{path:"/share/heart/:userId",element:c.jsx(_E,{})}),c.jsx(hd,{path:"/login",element:n?c.jsx(BS,{to:"/",replace:!0}):c.jsx(xre,{})}),c.jsx(hd,{path:"/*",element:n?c.jsx(yre,{}):c.jsx(BS,{to:"/login",replace:!0})})]})};function wre(){return c.jsx(eL,{children:c.jsx(Q6,{children:c.jsx(Z6,{children:c.jsxs(tz,{children:[c.jsx(vre,{}),c.jsx(bre,{})]})})})})}Xy.createRoot(document.getElementById("root")).render(c.jsx(wre,{}));
