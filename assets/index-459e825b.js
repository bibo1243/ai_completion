(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var Tp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sg(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var gE={exports:{}},ig={},yE={exports:{}},xn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pf=Symbol.for("react.element"),GR=Symbol.for("react.portal"),qR=Symbol.for("react.fragment"),JR=Symbol.for("react.strict_mode"),YR=Symbol.for("react.profiler"),XR=Symbol.for("react.provider"),QR=Symbol.for("react.context"),ZR=Symbol.for("react.forward_ref"),eO=Symbol.for("react.suspense"),tO=Symbol.for("react.memo"),nO=Symbol.for("react.lazy"),xk=Symbol.iterator;function rO(t){return t===null||typeof t!="object"?null:(t=xk&&t[xk]||t["@@iterator"],typeof t=="function"?t:null)}var xE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},bE=Object.assign,wE={};function _u(t,e,n){this.props=t,this.context=e,this.refs=wE,this.updater=n||xE}_u.prototype.isReactComponent={};_u.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};_u.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function vE(){}vE.prototype=_u.prototype;function mb(t,e,n){this.props=t,this.context=e,this.refs=wE,this.updater=n||xE}var gb=mb.prototype=new vE;gb.constructor=mb;bE(gb,_u.prototype);gb.isPureReactComponent=!0;var bk=Array.isArray,kE=Object.prototype.hasOwnProperty,yb={current:null},SE={key:!0,ref:!0,__self:!0,__source:!0};function _E(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)kE.call(e,r)&&!SE.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:Pf,type:t,key:i,ref:o,props:s,_owner:yb.current}}function sO(t,e){return{$$typeof:Pf,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function xb(t){return typeof t=="object"&&t!==null&&t.$$typeof===Pf}function iO(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var wk=/\/+/g;function e0(t,e){return typeof t=="object"&&t!==null&&t.key!=null?iO(""+t.key):e.toString(36)}function Gh(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Pf:case GR:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+e0(o,0):r,bk(s)?(n="",t!=null&&(n=t.replace(wk,"$&/")+"/"),Gh(s,e,n,"",function(u){return u})):s!=null&&(xb(s)&&(s=sO(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(wk,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",bk(t))for(var a=0;a<t.length;a++){i=t[a];var l=r+e0(i,a);o+=Gh(i,e,n,l,s)}else if(l=rO(t),typeof l=="function")for(t=l.call(t),a=0;!(i=t.next()).done;)i=i.value,l=r+e0(i,a++),o+=Gh(i,e,n,l,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function sh(t,e,n){if(t==null)return t;var r=[],s=0;return Gh(t,r,"","",function(i){return e.call(n,i,s++)}),r}function oO(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var _s={current:null},qh={transition:null},aO={ReactCurrentDispatcher:_s,ReactCurrentBatchConfig:qh,ReactCurrentOwner:yb};function TE(){throw Error("act(...) is not supported in production builds of React.")}xn.Children={map:sh,forEach:function(t,e,n){sh(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return sh(t,function(){e++}),e},toArray:function(t){return sh(t,function(e){return e})||[]},only:function(t){if(!xb(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};xn.Component=_u;xn.Fragment=qR;xn.Profiler=YR;xn.PureComponent=mb;xn.StrictMode=JR;xn.Suspense=eO;xn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=aO;xn.act=TE;xn.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=bE({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=yb.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)kE.call(e,l)&&!SE.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Pf,type:t.type,key:s,ref:i,props:r,_owner:o}};xn.createContext=function(t){return t={$$typeof:QR,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:XR,_context:t},t.Consumer=t};xn.createElement=_E;xn.createFactory=function(t){var e=_E.bind(null,t);return e.type=t,e};xn.createRef=function(){return{current:null}};xn.forwardRef=function(t){return{$$typeof:ZR,render:t}};xn.isValidElement=xb;xn.lazy=function(t){return{$$typeof:nO,_payload:{_status:-1,_result:t},_init:oO}};xn.memo=function(t,e){return{$$typeof:tO,type:t,compare:e===void 0?null:e}};xn.startTransition=function(t){var e=qh.transition;qh.transition={};try{t()}finally{qh.transition=e}};xn.unstable_act=TE;xn.useCallback=function(t,e){return _s.current.useCallback(t,e)};xn.useContext=function(t){return _s.current.useContext(t)};xn.useDebugValue=function(){};xn.useDeferredValue=function(t){return _s.current.useDeferredValue(t)};xn.useEffect=function(t,e){return _s.current.useEffect(t,e)};xn.useId=function(){return _s.current.useId()};xn.useImperativeHandle=function(t,e,n){return _s.current.useImperativeHandle(t,e,n)};xn.useInsertionEffect=function(t,e){return _s.current.useInsertionEffect(t,e)};xn.useLayoutEffect=function(t,e){return _s.current.useLayoutEffect(t,e)};xn.useMemo=function(t,e){return _s.current.useMemo(t,e)};xn.useReducer=function(t,e,n){return _s.current.useReducer(t,e,n)};xn.useRef=function(t){return _s.current.useRef(t)};xn.useState=function(t){return _s.current.useState(t)};xn.useSyncExternalStore=function(t,e,n){return _s.current.useSyncExternalStore(t,e,n)};xn.useTransition=function(){return _s.current.useTransition()};xn.version="18.3.1";yE.exports=xn;var b=yE.exports;const An=sg(b);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lO=b,cO=Symbol.for("react.element"),uO=Symbol.for("react.fragment"),dO=Object.prototype.hasOwnProperty,fO=lO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,hO={key:!0,ref:!0,__self:!0,__source:!0};function CE(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)dO.call(e,r)&&!hO.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:cO,type:t,key:i,ref:o,props:s,_owner:fO.current}}ig.Fragment=uO;ig.jsx=CE;ig.jsxs=CE;gE.exports=ig;var c=gE.exports,Vy={},EE={exports:{}},ti={},NE={exports:{}},jE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(Q,X){var D=Q.length;Q.push(X);e:for(;0<D;){var Te=D-1>>>1,xe=Q[Te];if(0<s(xe,X))Q[Te]=X,Q[D]=xe,D=Te;else break e}}function n(Q){return Q.length===0?null:Q[0]}function r(Q){if(Q.length===0)return null;var X=Q[0],D=Q.pop();if(D!==X){Q[0]=D;e:for(var Te=0,xe=Q.length,U=xe>>>1;Te<U;){var z=2*(Te+1)-1,ie=Q[z],Be=z+1,st=Q[Be];if(0>s(ie,D))Be<xe&&0>s(st,ie)?(Q[Te]=st,Q[Be]=D,Te=Be):(Q[Te]=ie,Q[z]=D,Te=z);else if(Be<xe&&0>s(st,D))Q[Te]=st,Q[Be]=D,Te=Be;else break e}}return X}function s(Q,X){var D=Q.sortIndex-X.sortIndex;return D!==0?D:Q.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],u=[],d=1,f=null,h=3,p=!1,m=!1,y=!1,x=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(Q){for(var X=n(u);X!==null;){if(X.callback===null)r(u);else if(X.startTime<=Q)r(u),X.sortIndex=X.expirationTime,e(l,X);else break;X=n(u)}}function S(Q){if(y=!1,w(Q),!m)if(n(l)!==null)m=!0,A(I);else{var X=n(u);X!==null&&M(S,X.startTime-Q)}}function I(Q,X){m=!1,y&&(y=!1,g(C),C=-1),p=!0;var D=h;try{for(w(X),f=n(l);f!==null&&(!(f.expirationTime>X)||Q&&!N());){var Te=f.callback;if(typeof Te=="function"){f.callback=null,h=f.priorityLevel;var xe=Te(f.expirationTime<=X);X=t.unstable_now(),typeof xe=="function"?f.callback=xe:f===n(l)&&r(l),w(X)}else r(l);f=n(l)}if(f!==null)var U=!0;else{var z=n(u);z!==null&&M(S,z.startTime-X),U=!1}return U}finally{f=null,h=D,p=!1}}var k=!1,R=null,C=-1,T=5,_=-1;function N(){return!(t.unstable_now()-_<T)}function j(){if(R!==null){var Q=t.unstable_now();_=Q;var X=!0;try{X=R(!0,Q)}finally{X?O():(k=!1,R=null)}}else k=!1}var O;if(typeof v=="function")O=function(){v(j)};else if(typeof MessageChannel<"u"){var P=new MessageChannel,G=P.port2;P.port1.onmessage=j,O=function(){G.postMessage(null)}}else O=function(){x(j,0)};function A(Q){R=Q,k||(k=!0,O())}function M(Q,X){C=x(function(){Q(t.unstable_now())},X)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Q){Q.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,A(I))},t.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<Q?Math.floor(1e3/Q):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(Q){switch(h){case 1:case 2:case 3:var X=3;break;default:X=h}var D=h;h=X;try{return Q()}finally{h=D}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Q,X){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var D=h;h=Q;try{return X()}finally{h=D}},t.unstable_scheduleCallback=function(Q,X,D){var Te=t.unstable_now();switch(typeof D=="object"&&D!==null?(D=D.delay,D=typeof D=="number"&&0<D?Te+D:Te):D=Te,Q){case 1:var xe=-1;break;case 2:xe=250;break;case 5:xe=1073741823;break;case 4:xe=1e4;break;default:xe=5e3}return xe=D+xe,Q={id:d++,callback:X,priorityLevel:Q,startTime:D,expirationTime:xe,sortIndex:-1},D>Te?(Q.sortIndex=D,e(u,Q),n(l)===null&&Q===n(u)&&(y?(g(C),C=-1):y=!0,M(S,D-Te))):(Q.sortIndex=xe,e(l,Q),m||p||(m=!0,A(I))),Q},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(Q){var X=h;return function(){var D=h;h=X;try{return Q.apply(this,arguments)}finally{h=D}}}})(jE);NE.exports=jE;var pO=NE.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mO=b,Zs=pO;function _t(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var IE=new Set,Hd={};function ec(t,e){uu(t,e),uu(t+"Capture",e)}function uu(t,e){for(Hd[t]=e,t=0;t<e.length;t++)IE.add(e[t])}var Uo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Wy=Object.prototype.hasOwnProperty,gO=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,vk={},kk={};function yO(t){return Wy.call(kk,t)?!0:Wy.call(vk,t)?!1:gO.test(t)?kk[t]=!0:(vk[t]=!0,!1)}function xO(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function bO(t,e,n,r){if(e===null||typeof e>"u"||xO(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ts(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var es={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){es[t]=new Ts(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];es[e]=new Ts(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){es[t]=new Ts(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){es[t]=new Ts(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){es[t]=new Ts(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){es[t]=new Ts(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){es[t]=new Ts(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){es[t]=new Ts(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){es[t]=new Ts(t,5,!1,t.toLowerCase(),null,!1,!1)});var bb=/[\-:]([a-z])/g;function wb(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(bb,wb);es[e]=new Ts(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(bb,wb);es[e]=new Ts(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(bb,wb);es[e]=new Ts(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){es[t]=new Ts(t,1,!1,t.toLowerCase(),null,!1,!1)});es.xlinkHref=new Ts("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){es[t]=new Ts(t,1,!1,t.toLowerCase(),null,!0,!0)});function vb(t,e,n,r){var s=es.hasOwnProperty(e)?es[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(bO(e,n,s,r)&&(n=null),r||s===null?yO(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Yo=mO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ih=Symbol.for("react.element"),Ec=Symbol.for("react.portal"),Nc=Symbol.for("react.fragment"),kb=Symbol.for("react.strict_mode"),Ky=Symbol.for("react.profiler"),DE=Symbol.for("react.provider"),AE=Symbol.for("react.context"),Sb=Symbol.for("react.forward_ref"),Gy=Symbol.for("react.suspense"),qy=Symbol.for("react.suspense_list"),_b=Symbol.for("react.memo"),la=Symbol.for("react.lazy"),ME=Symbol.for("react.offscreen"),Sk=Symbol.iterator;function Bu(t){return t===null||typeof t!="object"?null:(t=Sk&&t[Sk]||t["@@iterator"],typeof t=="function"?t:null)}var cr=Object.assign,t0;function rd(t){if(t0===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);t0=e&&e[1]||""}return`
`+t0+t}var n0=!1;function r0(t,e){if(!t||n0)return"";n0=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{n0=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?rd(t):""}function wO(t){switch(t.tag){case 5:return rd(t.type);case 16:return rd("Lazy");case 13:return rd("Suspense");case 19:return rd("SuspenseList");case 0:case 2:case 15:return t=r0(t.type,!1),t;case 11:return t=r0(t.type.render,!1),t;case 1:return t=r0(t.type,!0),t;default:return""}}function Jy(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Nc:return"Fragment";case Ec:return"Portal";case Ky:return"Profiler";case kb:return"StrictMode";case Gy:return"Suspense";case qy:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case AE:return(t.displayName||"Context")+".Consumer";case DE:return(t._context.displayName||"Context")+".Provider";case Sb:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case _b:return e=t.displayName||null,e!==null?e:Jy(t.type)||"Memo";case la:e=t._payload,t=t._init;try{return Jy(t(e))}catch{}}return null}function vO(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Jy(e);case 8:return e===kb?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function za(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function RE(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function kO(t){var e=RE(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function oh(t){t._valueTracker||(t._valueTracker=kO(t))}function OE(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=RE(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Cp(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Yy(t,e){var n=e.checked;return cr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function _k(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=za(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function PE(t,e){e=e.checked,e!=null&&vb(t,"checked",e,!1)}function Xy(t,e){PE(t,e);var n=za(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Qy(t,e.type,n):e.hasOwnProperty("defaultValue")&&Qy(t,e.type,za(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Tk(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Qy(t,e,n){(e!=="number"||Cp(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var sd=Array.isArray;function Jc(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+za(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Zy(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(_t(91));return cr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Ck(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(_t(92));if(sd(n)){if(1<n.length)throw Error(_t(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:za(n)}}function LE(t,e){var n=za(e.value),r=za(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Ek(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function $E(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ex(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?$E(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ah,zE=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ah=ah||document.createElement("div"),ah.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ah.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Vd(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var pd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},SO=["Webkit","ms","Moz","O"];Object.keys(pd).forEach(function(t){SO.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),pd[e]=pd[t]})});function FE(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||pd.hasOwnProperty(t)&&pd[t]?(""+e).trim():e+"px"}function BE(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=FE(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var _O=cr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function tx(t,e){if(e){if(_O[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(_t(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(_t(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(_t(61))}if(e.style!=null&&typeof e.style!="object")throw Error(_t(62))}}function nx(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rx=null;function Tb(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var sx=null,Yc=null,Xc=null;function Nk(t){if(t=zf(t)){if(typeof sx!="function")throw Error(_t(280));var e=t.stateNode;e&&(e=ug(e),sx(t.stateNode,t.type,e))}}function UE(t){Yc?Xc?Xc.push(t):Xc=[t]:Yc=t}function HE(){if(Yc){var t=Yc,e=Xc;if(Xc=Yc=null,Nk(t),e)for(t=0;t<e.length;t++)Nk(e[t])}}function VE(t,e){return t(e)}function WE(){}var s0=!1;function KE(t,e,n){if(s0)return t(e,n);s0=!0;try{return VE(t,e,n)}finally{s0=!1,(Yc!==null||Xc!==null)&&(WE(),HE())}}function Wd(t,e){var n=t.stateNode;if(n===null)return null;var r=ug(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(_t(231,e,typeof n));return n}var ix=!1;if(Uo)try{var Uu={};Object.defineProperty(Uu,"passive",{get:function(){ix=!0}}),window.addEventListener("test",Uu,Uu),window.removeEventListener("test",Uu,Uu)}catch{ix=!1}function TO(t,e,n,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(d){this.onError(d)}}var md=!1,Ep=null,Np=!1,ox=null,CO={onError:function(t){md=!0,Ep=t}};function EO(t,e,n,r,s,i,o,a,l){md=!1,Ep=null,TO.apply(CO,arguments)}function NO(t,e,n,r,s,i,o,a,l){if(EO.apply(this,arguments),md){if(md){var u=Ep;md=!1,Ep=null}else throw Error(_t(198));Np||(Np=!0,ox=u)}}function tc(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function GE(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function jk(t){if(tc(t)!==t)throw Error(_t(188))}function jO(t){var e=t.alternate;if(!e){if(e=tc(t),e===null)throw Error(_t(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return jk(s),t;if(i===r)return jk(s),e;i=i.sibling}throw Error(_t(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o)throw Error(_t(189))}}if(n.alternate!==r)throw Error(_t(190))}if(n.tag!==3)throw Error(_t(188));return n.stateNode.current===n?t:e}function qE(t){return t=jO(t),t!==null?JE(t):null}function JE(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=JE(t);if(e!==null)return e;t=t.sibling}return null}var YE=Zs.unstable_scheduleCallback,Ik=Zs.unstable_cancelCallback,IO=Zs.unstable_shouldYield,DO=Zs.unstable_requestPaint,xr=Zs.unstable_now,AO=Zs.unstable_getCurrentPriorityLevel,Cb=Zs.unstable_ImmediatePriority,XE=Zs.unstable_UserBlockingPriority,jp=Zs.unstable_NormalPriority,MO=Zs.unstable_LowPriority,QE=Zs.unstable_IdlePriority,og=null,fo=null;function RO(t){if(fo&&typeof fo.onCommitFiberRoot=="function")try{fo.onCommitFiberRoot(og,t,void 0,(t.current.flags&128)===128)}catch{}}var Gi=Math.clz32?Math.clz32:LO,OO=Math.log,PO=Math.LN2;function LO(t){return t>>>=0,t===0?32:31-(OO(t)/PO|0)|0}var lh=64,ch=4194304;function id(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ip(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~s;a!==0?r=id(a):(i&=o,i!==0&&(r=id(i)))}else o=n&~s,o!==0?r=id(o):i!==0&&(r=id(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Gi(e),s=1<<n,r|=t[n],e&=~s;return r}function $O(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zO(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-Gi(i),a=1<<o,l=s[o];l===-1?(!(a&n)||a&r)&&(s[o]=$O(a,e)):l<=e&&(t.expiredLanes|=a),i&=~a}}function ax(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function ZE(){var t=lh;return lh<<=1,!(lh&4194240)&&(lh=64),t}function i0(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Lf(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Gi(e),t[e]=n}function FO(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Gi(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Eb(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Gi(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var Dn=0;function eN(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var tN,Nb,nN,rN,sN,lx=!1,uh=[],Ta=null,Ca=null,Ea=null,Kd=new Map,Gd=new Map,ma=[],BO="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Dk(t,e){switch(t){case"focusin":case"focusout":Ta=null;break;case"dragenter":case"dragleave":Ca=null;break;case"mouseover":case"mouseout":Ea=null;break;case"pointerover":case"pointerout":Kd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Gd.delete(e.pointerId)}}function Hu(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=zf(e),e!==null&&Nb(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function UO(t,e,n,r,s){switch(e){case"focusin":return Ta=Hu(Ta,t,e,n,r,s),!0;case"dragenter":return Ca=Hu(Ca,t,e,n,r,s),!0;case"mouseover":return Ea=Hu(Ea,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Kd.set(i,Hu(Kd.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Gd.set(i,Hu(Gd.get(i)||null,t,e,n,r,s)),!0}return!1}function iN(t){var e=kl(t.target);if(e!==null){var n=tc(e);if(n!==null){if(e=n.tag,e===13){if(e=GE(n),e!==null){t.blockedOn=e,sN(t.priority,function(){nN(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Jh(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=cx(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);rx=r,n.target.dispatchEvent(r),rx=null}else return e=zf(n),e!==null&&Nb(e),t.blockedOn=n,!1;e.shift()}return!0}function Ak(t,e,n){Jh(t)&&n.delete(e)}function HO(){lx=!1,Ta!==null&&Jh(Ta)&&(Ta=null),Ca!==null&&Jh(Ca)&&(Ca=null),Ea!==null&&Jh(Ea)&&(Ea=null),Kd.forEach(Ak),Gd.forEach(Ak)}function Vu(t,e){t.blockedOn===e&&(t.blockedOn=null,lx||(lx=!0,Zs.unstable_scheduleCallback(Zs.unstable_NormalPriority,HO)))}function qd(t){function e(s){return Vu(s,t)}if(0<uh.length){Vu(uh[0],t);for(var n=1;n<uh.length;n++){var r=uh[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Ta!==null&&Vu(Ta,t),Ca!==null&&Vu(Ca,t),Ea!==null&&Vu(Ea,t),Kd.forEach(e),Gd.forEach(e),n=0;n<ma.length;n++)r=ma[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<ma.length&&(n=ma[0],n.blockedOn===null);)iN(n),n.blockedOn===null&&ma.shift()}var Qc=Yo.ReactCurrentBatchConfig,Dp=!0;function VO(t,e,n,r){var s=Dn,i=Qc.transition;Qc.transition=null;try{Dn=1,jb(t,e,n,r)}finally{Dn=s,Qc.transition=i}}function WO(t,e,n,r){var s=Dn,i=Qc.transition;Qc.transition=null;try{Dn=4,jb(t,e,n,r)}finally{Dn=s,Qc.transition=i}}function jb(t,e,n,r){if(Dp){var s=cx(t,e,n,r);if(s===null)m0(t,e,r,Ap,n),Dk(t,r);else if(UO(s,t,e,n,r))r.stopPropagation();else if(Dk(t,r),e&4&&-1<BO.indexOf(t)){for(;s!==null;){var i=zf(s);if(i!==null&&tN(i),i=cx(t,e,n,r),i===null&&m0(t,e,r,Ap,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else m0(t,e,r,null,n)}}var Ap=null;function cx(t,e,n,r){if(Ap=null,t=Tb(r),t=kl(t),t!==null)if(e=tc(t),e===null)t=null;else if(n=e.tag,n===13){if(t=GE(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ap=t,null}function oN(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(AO()){case Cb:return 1;case XE:return 4;case jp:case MO:return 16;case QE:return 536870912;default:return 16}default:return 16}}var wa=null,Ib=null,Yh=null;function aN(){if(Yh)return Yh;var t,e=Ib,n=e.length,r,s="value"in wa?wa.value:wa.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return Yh=s.slice(t,1<r?1-r:void 0)}function Xh(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function dh(){return!0}function Mk(){return!1}function ni(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?dh:Mk,this.isPropagationStopped=Mk,this}return cr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=dh)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=dh)},persist:function(){},isPersistent:dh}),e}var Tu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Db=ni(Tu),$f=cr({},Tu,{view:0,detail:0}),KO=ni($f),o0,a0,Wu,ag=cr({},$f,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ab,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Wu&&(Wu&&t.type==="mousemove"?(o0=t.screenX-Wu.screenX,a0=t.screenY-Wu.screenY):a0=o0=0,Wu=t),o0)},movementY:function(t){return"movementY"in t?t.movementY:a0}}),Rk=ni(ag),GO=cr({},ag,{dataTransfer:0}),qO=ni(GO),JO=cr({},$f,{relatedTarget:0}),l0=ni(JO),YO=cr({},Tu,{animationName:0,elapsedTime:0,pseudoElement:0}),XO=ni(YO),QO=cr({},Tu,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),ZO=ni(QO),eP=cr({},Tu,{data:0}),Ok=ni(eP),tP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},nP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function sP(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=rP[t])?!!e[t]:!1}function Ab(){return sP}var iP=cr({},$f,{key:function(t){if(t.key){var e=tP[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Xh(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?nP[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ab,charCode:function(t){return t.type==="keypress"?Xh(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Xh(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),oP=ni(iP),aP=cr({},ag,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Pk=ni(aP),lP=cr({},$f,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ab}),cP=ni(lP),uP=cr({},Tu,{propertyName:0,elapsedTime:0,pseudoElement:0}),dP=ni(uP),fP=cr({},ag,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),hP=ni(fP),pP=[9,13,27,32],Mb=Uo&&"CompositionEvent"in window,gd=null;Uo&&"documentMode"in document&&(gd=document.documentMode);var mP=Uo&&"TextEvent"in window&&!gd,lN=Uo&&(!Mb||gd&&8<gd&&11>=gd),Lk=String.fromCharCode(32),$k=!1;function cN(t,e){switch(t){case"keyup":return pP.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function uN(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var jc=!1;function gP(t,e){switch(t){case"compositionend":return uN(e);case"keypress":return e.which!==32?null:($k=!0,Lk);case"textInput":return t=e.data,t===Lk&&$k?null:t;default:return null}}function yP(t,e){if(jc)return t==="compositionend"||!Mb&&cN(t,e)?(t=aN(),Yh=Ib=wa=null,jc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return lN&&e.locale!=="ko"?null:e.data;default:return null}}var xP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zk(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!xP[t.type]:e==="textarea"}function dN(t,e,n,r){UE(r),e=Mp(e,"onChange"),0<e.length&&(n=new Db("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var yd=null,Jd=null;function bP(t){kN(t,0)}function lg(t){var e=Ac(t);if(OE(e))return t}function wP(t,e){if(t==="change")return e}var fN=!1;if(Uo){var c0;if(Uo){var u0="oninput"in document;if(!u0){var Fk=document.createElement("div");Fk.setAttribute("oninput","return;"),u0=typeof Fk.oninput=="function"}c0=u0}else c0=!1;fN=c0&&(!document.documentMode||9<document.documentMode)}function Bk(){yd&&(yd.detachEvent("onpropertychange",hN),Jd=yd=null)}function hN(t){if(t.propertyName==="value"&&lg(Jd)){var e=[];dN(e,Jd,t,Tb(t)),KE(bP,e)}}function vP(t,e,n){t==="focusin"?(Bk(),yd=e,Jd=n,yd.attachEvent("onpropertychange",hN)):t==="focusout"&&Bk()}function kP(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return lg(Jd)}function SP(t,e){if(t==="click")return lg(e)}function _P(t,e){if(t==="input"||t==="change")return lg(e)}function TP(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ji=typeof Object.is=="function"?Object.is:TP;function Yd(t,e){if(Ji(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Wy.call(e,s)||!Ji(t[s],e[s]))return!1}return!0}function Uk(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Hk(t,e){var n=Uk(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Uk(n)}}function pN(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?pN(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function mN(){for(var t=window,e=Cp();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Cp(t.document)}return e}function Rb(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function CP(t){var e=mN(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&pN(n.ownerDocument.documentElement,n)){if(r!==null&&Rb(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=Hk(n,i);var o=Hk(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var EP=Uo&&"documentMode"in document&&11>=document.documentMode,Ic=null,ux=null,xd=null,dx=!1;function Vk(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;dx||Ic==null||Ic!==Cp(r)||(r=Ic,"selectionStart"in r&&Rb(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),xd&&Yd(xd,r)||(xd=r,r=Mp(ux,"onSelect"),0<r.length&&(e=new Db("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Ic)))}function fh(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Dc={animationend:fh("Animation","AnimationEnd"),animationiteration:fh("Animation","AnimationIteration"),animationstart:fh("Animation","AnimationStart"),transitionend:fh("Transition","TransitionEnd")},d0={},gN={};Uo&&(gN=document.createElement("div").style,"AnimationEvent"in window||(delete Dc.animationend.animation,delete Dc.animationiteration.animation,delete Dc.animationstart.animation),"TransitionEvent"in window||delete Dc.transitionend.transition);function cg(t){if(d0[t])return d0[t];if(!Dc[t])return t;var e=Dc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in gN)return d0[t]=e[n];return t}var yN=cg("animationend"),xN=cg("animationiteration"),bN=cg("animationstart"),wN=cg("transitionend"),vN=new Map,Wk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ka(t,e){vN.set(t,e),ec(e,[t])}for(var f0=0;f0<Wk.length;f0++){var h0=Wk[f0],NP=h0.toLowerCase(),jP=h0[0].toUpperCase()+h0.slice(1);Ka(NP,"on"+jP)}Ka(yN,"onAnimationEnd");Ka(xN,"onAnimationIteration");Ka(bN,"onAnimationStart");Ka("dblclick","onDoubleClick");Ka("focusin","onFocus");Ka("focusout","onBlur");Ka(wN,"onTransitionEnd");uu("onMouseEnter",["mouseout","mouseover"]);uu("onMouseLeave",["mouseout","mouseover"]);uu("onPointerEnter",["pointerout","pointerover"]);uu("onPointerLeave",["pointerout","pointerover"]);ec("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ec("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ec("onBeforeInput",["compositionend","keypress","textInput","paste"]);ec("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ec("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ec("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var od="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),IP=new Set("cancel close invalid load scroll toggle".split(" ").concat(od));function Kk(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,NO(r,e,void 0,t),t.currentTarget=null}function kN(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;Kk(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;Kk(s,a,u),i=l}}}if(Np)throw t=ox,Np=!1,ox=null,t}function Vn(t,e){var n=e[gx];n===void 0&&(n=e[gx]=new Set);var r=t+"__bubble";n.has(r)||(SN(e,t,2,!1),n.add(r))}function p0(t,e,n){var r=0;e&&(r|=4),SN(n,t,r,e)}var hh="_reactListening"+Math.random().toString(36).slice(2);function Xd(t){if(!t[hh]){t[hh]=!0,IE.forEach(function(n){n!=="selectionchange"&&(IP.has(n)||p0(n,!1,t),p0(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[hh]||(e[hh]=!0,p0("selectionchange",!1,e))}}function SN(t,e,n,r){switch(oN(e)){case 1:var s=VO;break;case 4:s=WO;break;default:s=jb}n=s.bind(null,e,n,t),s=void 0,!ix||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function m0(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=kl(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}KE(function(){var u=i,d=Tb(n),f=[];e:{var h=vN.get(t);if(h!==void 0){var p=Db,m=t;switch(t){case"keypress":if(Xh(n)===0)break e;case"keydown":case"keyup":p=oP;break;case"focusin":m="focus",p=l0;break;case"focusout":m="blur",p=l0;break;case"beforeblur":case"afterblur":p=l0;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Rk;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=qO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=cP;break;case yN:case xN:case bN:p=XO;break;case wN:p=dP;break;case"scroll":p=KO;break;case"wheel":p=hP;break;case"copy":case"cut":case"paste":p=ZO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Pk}var y=(e&4)!==0,x=!y&&t==="scroll",g=y?h!==null?h+"Capture":null:h;y=[];for(var v=u,w;v!==null;){w=v;var S=w.stateNode;if(w.tag===5&&S!==null&&(w=S,g!==null&&(S=Wd(v,g),S!=null&&y.push(Qd(v,S,w)))),x)break;v=v.return}0<y.length&&(h=new p(h,m,null,n,d),f.push({event:h,listeners:y}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",h&&n!==rx&&(m=n.relatedTarget||n.fromElement)&&(kl(m)||m[Ho]))break e;if((p||h)&&(h=d.window===d?d:(h=d.ownerDocument)?h.defaultView||h.parentWindow:window,p?(m=n.relatedTarget||n.toElement,p=u,m=m?kl(m):null,m!==null&&(x=tc(m),m!==x||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=u),p!==m)){if(y=Rk,S="onMouseLeave",g="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(y=Pk,S="onPointerLeave",g="onPointerEnter",v="pointer"),x=p==null?h:Ac(p),w=m==null?h:Ac(m),h=new y(S,v+"leave",p,n,d),h.target=x,h.relatedTarget=w,S=null,kl(d)===u&&(y=new y(g,v+"enter",m,n,d),y.target=w,y.relatedTarget=x,S=y),x=S,p&&m)t:{for(y=p,g=m,v=0,w=y;w;w=lc(w))v++;for(w=0,S=g;S;S=lc(S))w++;for(;0<v-w;)y=lc(y),v--;for(;0<w-v;)g=lc(g),w--;for(;v--;){if(y===g||g!==null&&y===g.alternate)break t;y=lc(y),g=lc(g)}y=null}else y=null;p!==null&&Gk(f,h,p,y,!1),m!==null&&x!==null&&Gk(f,x,m,y,!0)}}e:{if(h=u?Ac(u):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var I=wP;else if(zk(h))if(fN)I=_P;else{I=kP;var k=vP}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(I=SP);if(I&&(I=I(t,u))){dN(f,I,n,d);break e}k&&k(t,h,u),t==="focusout"&&(k=h._wrapperState)&&k.controlled&&h.type==="number"&&Qy(h,"number",h.value)}switch(k=u?Ac(u):window,t){case"focusin":(zk(k)||k.contentEditable==="true")&&(Ic=k,ux=u,xd=null);break;case"focusout":xd=ux=Ic=null;break;case"mousedown":dx=!0;break;case"contextmenu":case"mouseup":case"dragend":dx=!1,Vk(f,n,d);break;case"selectionchange":if(EP)break;case"keydown":case"keyup":Vk(f,n,d)}var R;if(Mb)e:{switch(t){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else jc?cN(t,n)&&(C="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(C="onCompositionStart");C&&(lN&&n.locale!=="ko"&&(jc||C!=="onCompositionStart"?C==="onCompositionEnd"&&jc&&(R=aN()):(wa=d,Ib="value"in wa?wa.value:wa.textContent,jc=!0)),k=Mp(u,C),0<k.length&&(C=new Ok(C,t,null,n,d),f.push({event:C,listeners:k}),R?C.data=R:(R=uN(n),R!==null&&(C.data=R)))),(R=mP?gP(t,n):yP(t,n))&&(u=Mp(u,"onBeforeInput"),0<u.length&&(d=new Ok("onBeforeInput","beforeinput",null,n,d),f.push({event:d,listeners:u}),d.data=R))}kN(f,e)})}function Qd(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Mp(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Wd(t,n),i!=null&&r.unshift(Qd(t,i,s)),i=Wd(t,e),i!=null&&r.push(Qd(t,i,s))),t=t.return}return r}function lc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Gk(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=Wd(n,i),l!=null&&o.unshift(Qd(n,l,a))):s||(l=Wd(n,i),l!=null&&o.push(Qd(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var DP=/\r\n?/g,AP=/\u0000|\uFFFD/g;function qk(t){return(typeof t=="string"?t:""+t).replace(DP,`
`).replace(AP,"")}function ph(t,e,n){if(e=qk(e),qk(t)!==e&&n)throw Error(_t(425))}function Rp(){}var fx=null,hx=null;function px(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var mx=typeof setTimeout=="function"?setTimeout:void 0,MP=typeof clearTimeout=="function"?clearTimeout:void 0,Jk=typeof Promise=="function"?Promise:void 0,RP=typeof queueMicrotask=="function"?queueMicrotask:typeof Jk<"u"?function(t){return Jk.resolve(null).then(t).catch(OP)}:mx;function OP(t){setTimeout(function(){throw t})}function g0(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),qd(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);qd(e)}function Na(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Yk(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Cu=Math.random().toString(36).slice(2),io="__reactFiber$"+Cu,Zd="__reactProps$"+Cu,Ho="__reactContainer$"+Cu,gx="__reactEvents$"+Cu,PP="__reactListeners$"+Cu,LP="__reactHandles$"+Cu;function kl(t){var e=t[io];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Ho]||n[io]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Yk(t);t!==null;){if(n=t[io])return n;t=Yk(t)}return e}t=n,n=t.parentNode}return null}function zf(t){return t=t[io]||t[Ho],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ac(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(_t(33))}function ug(t){return t[Zd]||null}var yx=[],Mc=-1;function Ga(t){return{current:t}}function Gn(t){0>Mc||(t.current=yx[Mc],yx[Mc]=null,Mc--)}function Fn(t,e){Mc++,yx[Mc]=t.current,t.current=e}var Fa={},fs=Ga(Fa),Ps=Ga(!1),Hl=Fa;function du(t,e){var n=t.type.contextTypes;if(!n)return Fa;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Ls(t){return t=t.childContextTypes,t!=null}function Op(){Gn(Ps),Gn(fs)}function Xk(t,e,n){if(fs.current!==Fa)throw Error(_t(168));Fn(fs,e),Fn(Ps,n)}function _N(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(_t(108,vO(t)||"Unknown",s));return cr({},n,r)}function Pp(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Fa,Hl=fs.current,Fn(fs,t),Fn(Ps,Ps.current),!0}function Qk(t,e,n){var r=t.stateNode;if(!r)throw Error(_t(169));n?(t=_N(t,e,Hl),r.__reactInternalMemoizedMergedChildContext=t,Gn(Ps),Gn(fs),Fn(fs,t)):Gn(Ps),Fn(Ps,n)}var Mo=null,dg=!1,y0=!1;function TN(t){Mo===null?Mo=[t]:Mo.push(t)}function $P(t){dg=!0,TN(t)}function qa(){if(!y0&&Mo!==null){y0=!0;var t=0,e=Dn;try{var n=Mo;for(Dn=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Mo=null,dg=!1}catch(s){throw Mo!==null&&(Mo=Mo.slice(t+1)),YE(Cb,qa),s}finally{Dn=e,y0=!1}}return null}var Rc=[],Oc=0,Lp=null,$p=0,fi=[],hi=0,Vl=null,Oo=1,Po="";function ul(t,e){Rc[Oc++]=$p,Rc[Oc++]=Lp,Lp=t,$p=e}function CN(t,e,n){fi[hi++]=Oo,fi[hi++]=Po,fi[hi++]=Vl,Vl=t;var r=Oo;t=Po;var s=32-Gi(r)-1;r&=~(1<<s),n+=1;var i=32-Gi(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Oo=1<<32-Gi(e)+s|n<<s|r,Po=i+t}else Oo=1<<i|n<<s|r,Po=t}function Ob(t){t.return!==null&&(ul(t,1),CN(t,1,0))}function Pb(t){for(;t===Lp;)Lp=Rc[--Oc],Rc[Oc]=null,$p=Rc[--Oc],Rc[Oc]=null;for(;t===Vl;)Vl=fi[--hi],fi[hi]=null,Po=fi[--hi],fi[hi]=null,Oo=fi[--hi],fi[hi]=null}var Qs=null,Ys=null,Zn=!1,Vi=null;function EN(t,e){var n=gi(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Zk(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Qs=t,Ys=Na(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Qs=t,Ys=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Vl!==null?{id:Oo,overflow:Po}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=gi(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Qs=t,Ys=null,!0):!1;default:return!1}}function xx(t){return(t.mode&1)!==0&&(t.flags&128)===0}function bx(t){if(Zn){var e=Ys;if(e){var n=e;if(!Zk(t,e)){if(xx(t))throw Error(_t(418));e=Na(n.nextSibling);var r=Qs;e&&Zk(t,e)?EN(r,n):(t.flags=t.flags&-4097|2,Zn=!1,Qs=t)}}else{if(xx(t))throw Error(_t(418));t.flags=t.flags&-4097|2,Zn=!1,Qs=t}}}function eS(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Qs=t}function mh(t){if(t!==Qs)return!1;if(!Zn)return eS(t),Zn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!px(t.type,t.memoizedProps)),e&&(e=Ys)){if(xx(t))throw NN(),Error(_t(418));for(;e;)EN(t,e),e=Na(e.nextSibling)}if(eS(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(_t(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Ys=Na(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Ys=null}}else Ys=Qs?Na(t.stateNode.nextSibling):null;return!0}function NN(){for(var t=Ys;t;)t=Na(t.nextSibling)}function fu(){Ys=Qs=null,Zn=!1}function Lb(t){Vi===null?Vi=[t]:Vi.push(t)}var zP=Yo.ReactCurrentBatchConfig;function Ku(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(_t(309));var r=n.stateNode}if(!r)throw Error(_t(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(_t(284));if(!n._owner)throw Error(_t(290,t))}return t}function gh(t,e){throw t=Object.prototype.toString.call(e),Error(_t(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function tS(t){var e=t._init;return e(t._payload)}function jN(t){function e(g,v){if(t){var w=g.deletions;w===null?(g.deletions=[v],g.flags|=16):w.push(v)}}function n(g,v){if(!t)return null;for(;v!==null;)e(g,v),v=v.sibling;return null}function r(g,v){for(g=new Map;v!==null;)v.key!==null?g.set(v.key,v):g.set(v.index,v),v=v.sibling;return g}function s(g,v){return g=Aa(g,v),g.index=0,g.sibling=null,g}function i(g,v,w){return g.index=w,t?(w=g.alternate,w!==null?(w=w.index,w<v?(g.flags|=2,v):w):(g.flags|=2,v)):(g.flags|=1048576,v)}function o(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,v,w,S){return v===null||v.tag!==6?(v=_0(w,g.mode,S),v.return=g,v):(v=s(v,w),v.return=g,v)}function l(g,v,w,S){var I=w.type;return I===Nc?d(g,v,w.props.children,S,w.key):v!==null&&(v.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===la&&tS(I)===v.type)?(S=s(v,w.props),S.ref=Ku(g,v,w),S.return=g,S):(S=sp(w.type,w.key,w.props,null,g.mode,S),S.ref=Ku(g,v,w),S.return=g,S)}function u(g,v,w,S){return v===null||v.tag!==4||v.stateNode.containerInfo!==w.containerInfo||v.stateNode.implementation!==w.implementation?(v=T0(w,g.mode,S),v.return=g,v):(v=s(v,w.children||[]),v.return=g,v)}function d(g,v,w,S,I){return v===null||v.tag!==7?(v=Rl(w,g.mode,S,I),v.return=g,v):(v=s(v,w),v.return=g,v)}function f(g,v,w){if(typeof v=="string"&&v!==""||typeof v=="number")return v=_0(""+v,g.mode,w),v.return=g,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case ih:return w=sp(v.type,v.key,v.props,null,g.mode,w),w.ref=Ku(g,null,v),w.return=g,w;case Ec:return v=T0(v,g.mode,w),v.return=g,v;case la:var S=v._init;return f(g,S(v._payload),w)}if(sd(v)||Bu(v))return v=Rl(v,g.mode,w,null),v.return=g,v;gh(g,v)}return null}function h(g,v,w,S){var I=v!==null?v.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return I!==null?null:a(g,v,""+w,S);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case ih:return w.key===I?l(g,v,w,S):null;case Ec:return w.key===I?u(g,v,w,S):null;case la:return I=w._init,h(g,v,I(w._payload),S)}if(sd(w)||Bu(w))return I!==null?null:d(g,v,w,S,null);gh(g,w)}return null}function p(g,v,w,S,I){if(typeof S=="string"&&S!==""||typeof S=="number")return g=g.get(w)||null,a(v,g,""+S,I);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case ih:return g=g.get(S.key===null?w:S.key)||null,l(v,g,S,I);case Ec:return g=g.get(S.key===null?w:S.key)||null,u(v,g,S,I);case la:var k=S._init;return p(g,v,w,k(S._payload),I)}if(sd(S)||Bu(S))return g=g.get(w)||null,d(v,g,S,I,null);gh(v,S)}return null}function m(g,v,w,S){for(var I=null,k=null,R=v,C=v=0,T=null;R!==null&&C<w.length;C++){R.index>C?(T=R,R=null):T=R.sibling;var _=h(g,R,w[C],S);if(_===null){R===null&&(R=T);break}t&&R&&_.alternate===null&&e(g,R),v=i(_,v,C),k===null?I=_:k.sibling=_,k=_,R=T}if(C===w.length)return n(g,R),Zn&&ul(g,C),I;if(R===null){for(;C<w.length;C++)R=f(g,w[C],S),R!==null&&(v=i(R,v,C),k===null?I=R:k.sibling=R,k=R);return Zn&&ul(g,C),I}for(R=r(g,R);C<w.length;C++)T=p(R,g,C,w[C],S),T!==null&&(t&&T.alternate!==null&&R.delete(T.key===null?C:T.key),v=i(T,v,C),k===null?I=T:k.sibling=T,k=T);return t&&R.forEach(function(N){return e(g,N)}),Zn&&ul(g,C),I}function y(g,v,w,S){var I=Bu(w);if(typeof I!="function")throw Error(_t(150));if(w=I.call(w),w==null)throw Error(_t(151));for(var k=I=null,R=v,C=v=0,T=null,_=w.next();R!==null&&!_.done;C++,_=w.next()){R.index>C?(T=R,R=null):T=R.sibling;var N=h(g,R,_.value,S);if(N===null){R===null&&(R=T);break}t&&R&&N.alternate===null&&e(g,R),v=i(N,v,C),k===null?I=N:k.sibling=N,k=N,R=T}if(_.done)return n(g,R),Zn&&ul(g,C),I;if(R===null){for(;!_.done;C++,_=w.next())_=f(g,_.value,S),_!==null&&(v=i(_,v,C),k===null?I=_:k.sibling=_,k=_);return Zn&&ul(g,C),I}for(R=r(g,R);!_.done;C++,_=w.next())_=p(R,g,C,_.value,S),_!==null&&(t&&_.alternate!==null&&R.delete(_.key===null?C:_.key),v=i(_,v,C),k===null?I=_:k.sibling=_,k=_);return t&&R.forEach(function(j){return e(g,j)}),Zn&&ul(g,C),I}function x(g,v,w,S){if(typeof w=="object"&&w!==null&&w.type===Nc&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case ih:e:{for(var I=w.key,k=v;k!==null;){if(k.key===I){if(I=w.type,I===Nc){if(k.tag===7){n(g,k.sibling),v=s(k,w.props.children),v.return=g,g=v;break e}}else if(k.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===la&&tS(I)===k.type){n(g,k.sibling),v=s(k,w.props),v.ref=Ku(g,k,w),v.return=g,g=v;break e}n(g,k);break}else e(g,k);k=k.sibling}w.type===Nc?(v=Rl(w.props.children,g.mode,S,w.key),v.return=g,g=v):(S=sp(w.type,w.key,w.props,null,g.mode,S),S.ref=Ku(g,v,w),S.return=g,g=S)}return o(g);case Ec:e:{for(k=w.key;v!==null;){if(v.key===k)if(v.tag===4&&v.stateNode.containerInfo===w.containerInfo&&v.stateNode.implementation===w.implementation){n(g,v.sibling),v=s(v,w.children||[]),v.return=g,g=v;break e}else{n(g,v);break}else e(g,v);v=v.sibling}v=T0(w,g.mode,S),v.return=g,g=v}return o(g);case la:return k=w._init,x(g,v,k(w._payload),S)}if(sd(w))return m(g,v,w,S);if(Bu(w))return y(g,v,w,S);gh(g,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,v!==null&&v.tag===6?(n(g,v.sibling),v=s(v,w),v.return=g,g=v):(n(g,v),v=_0(w,g.mode,S),v.return=g,g=v),o(g)):n(g,v)}return x}var hu=jN(!0),IN=jN(!1),zp=Ga(null),Fp=null,Pc=null,$b=null;function zb(){$b=Pc=Fp=null}function Fb(t){var e=zp.current;Gn(zp),t._currentValue=e}function wx(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Zc(t,e){Fp=t,$b=Pc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ms=!0),t.firstContext=null)}function _i(t){var e=t._currentValue;if($b!==t)if(t={context:t,memoizedValue:e,next:null},Pc===null){if(Fp===null)throw Error(_t(308));Pc=t,Fp.dependencies={lanes:0,firstContext:t}}else Pc=Pc.next=t;return e}var Sl=null;function Bb(t){Sl===null?Sl=[t]:Sl.push(t)}function DN(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,Bb(e)):(n.next=s.next,s.next=n),e.interleaved=n,Vo(t,r)}function Vo(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var ca=!1;function Ub(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function AN(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function $o(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ja(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Sn&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Vo(t,n)}return s=r.interleaved,s===null?(e.next=e,Bb(r)):(e.next=s.next,s.next=e),r.interleaved=e,Vo(t,n)}function Qh(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Eb(t,n)}}function nS(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Bp(t,e,n,r){var s=t.updateQueue;ca=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var d=t.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=u:a.next=u,d.lastBaseUpdate=l))}if(i!==null){var f=s.baseState;o=0,d=u=l=null,a=i;do{var h=a.lane,p=a.eventTime;if((r&h)===h){d!==null&&(d=d.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=t,y=a;switch(h=e,p=n,y.tag){case 1:if(m=y.payload,typeof m=="function"){f=m.call(p,f,h);break e}f=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=y.payload,h=typeof m=="function"?m.call(p,f,h):m,h==null)break e;f=cr({},f,h);break e;case 2:ca=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=s.effects,h===null?s.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(u=d=p,l=f):d=d.next=p,o|=h;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;h=a,a=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(1);if(d===null&&(l=f),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=d,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Kl|=o,t.lanes=o,t.memoizedState=f}}function rS(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(_t(191,s));s.call(r)}}}var Ff={},ho=Ga(Ff),ef=Ga(Ff),tf=Ga(Ff);function _l(t){if(t===Ff)throw Error(_t(174));return t}function Hb(t,e){switch(Fn(tf,e),Fn(ef,t),Fn(ho,Ff),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ex(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ex(e,t)}Gn(ho),Fn(ho,e)}function pu(){Gn(ho),Gn(ef),Gn(tf)}function MN(t){_l(tf.current);var e=_l(ho.current),n=ex(e,t.type);e!==n&&(Fn(ef,t),Fn(ho,n))}function Vb(t){ef.current===t&&(Gn(ho),Gn(ef))}var or=Ga(0);function Up(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var x0=[];function Wb(){for(var t=0;t<x0.length;t++)x0[t]._workInProgressVersionPrimary=null;x0.length=0}var Zh=Yo.ReactCurrentDispatcher,b0=Yo.ReactCurrentBatchConfig,Wl=0,lr=null,Dr=null,Lr=null,Hp=!1,bd=!1,nf=0,FP=0;function rs(){throw Error(_t(321))}function Kb(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ji(t[n],e[n]))return!1;return!0}function Gb(t,e,n,r,s,i){if(Wl=i,lr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Zh.current=t===null||t.memoizedState===null?VP:WP,t=n(r,s),bd){i=0;do{if(bd=!1,nf=0,25<=i)throw Error(_t(301));i+=1,Lr=Dr=null,e.updateQueue=null,Zh.current=KP,t=n(r,s)}while(bd)}if(Zh.current=Vp,e=Dr!==null&&Dr.next!==null,Wl=0,Lr=Dr=lr=null,Hp=!1,e)throw Error(_t(300));return t}function qb(){var t=nf!==0;return nf=0,t}function Zi(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Lr===null?lr.memoizedState=Lr=t:Lr=Lr.next=t,Lr}function Ti(){if(Dr===null){var t=lr.alternate;t=t!==null?t.memoizedState:null}else t=Dr.next;var e=Lr===null?lr.memoizedState:Lr.next;if(e!==null)Lr=e,Dr=t;else{if(t===null)throw Error(_t(310));Dr=t,t={memoizedState:Dr.memoizedState,baseState:Dr.baseState,baseQueue:Dr.baseQueue,queue:Dr.queue,next:null},Lr===null?lr.memoizedState=Lr=t:Lr=Lr.next=t}return Lr}function rf(t,e){return typeof e=="function"?e(t):e}function w0(t){var e=Ti(),n=e.queue;if(n===null)throw Error(_t(311));n.lastRenderedReducer=t;var r=Dr,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var d=u.lane;if((Wl&d)===d)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var f={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,lr.lanes|=d,Kl|=d}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,Ji(r,e.memoizedState)||(Ms=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,lr.lanes|=i,Kl|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function v0(t){var e=Ti(),n=e.queue;if(n===null)throw Error(_t(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);Ji(i,e.memoizedState)||(Ms=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function RN(){}function ON(t,e){var n=lr,r=Ti(),s=e(),i=!Ji(r.memoizedState,s);if(i&&(r.memoizedState=s,Ms=!0),r=r.queue,Jb($N.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Lr!==null&&Lr.memoizedState.tag&1){if(n.flags|=2048,sf(9,LN.bind(null,n,r,s,e),void 0,null),Fr===null)throw Error(_t(349));Wl&30||PN(n,e,s)}return s}function PN(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=lr.updateQueue,e===null?(e={lastEffect:null,stores:null},lr.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function LN(t,e,n,r){e.value=n,e.getSnapshot=r,zN(e)&&FN(t)}function $N(t,e,n){return n(function(){zN(e)&&FN(t)})}function zN(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ji(t,n)}catch{return!0}}function FN(t){var e=Vo(t,1);e!==null&&qi(e,t,1,-1)}function sS(t){var e=Zi();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:rf,lastRenderedState:t},e.queue=t,t=t.dispatch=HP.bind(null,lr,t),[e.memoizedState,t]}function sf(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=lr.updateQueue,e===null?(e={lastEffect:null,stores:null},lr.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function BN(){return Ti().memoizedState}function ep(t,e,n,r){var s=Zi();lr.flags|=t,s.memoizedState=sf(1|e,n,void 0,r===void 0?null:r)}function fg(t,e,n,r){var s=Ti();r=r===void 0?null:r;var i=void 0;if(Dr!==null){var o=Dr.memoizedState;if(i=o.destroy,r!==null&&Kb(r,o.deps)){s.memoizedState=sf(e,n,i,r);return}}lr.flags|=t,s.memoizedState=sf(1|e,n,i,r)}function iS(t,e){return ep(8390656,8,t,e)}function Jb(t,e){return fg(2048,8,t,e)}function UN(t,e){return fg(4,2,t,e)}function HN(t,e){return fg(4,4,t,e)}function VN(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function WN(t,e,n){return n=n!=null?n.concat([t]):null,fg(4,4,VN.bind(null,e,t),n)}function Yb(){}function KN(t,e){var n=Ti();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Kb(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function GN(t,e){var n=Ti();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Kb(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function qN(t,e,n){return Wl&21?(Ji(n,e)||(n=ZE(),lr.lanes|=n,Kl|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ms=!0),t.memoizedState=n)}function BP(t,e){var n=Dn;Dn=n!==0&&4>n?n:4,t(!0);var r=b0.transition;b0.transition={};try{t(!1),e()}finally{Dn=n,b0.transition=r}}function JN(){return Ti().memoizedState}function UP(t,e,n){var r=Da(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},YN(t))XN(e,n);else if(n=DN(t,e,n,r),n!==null){var s=vs();qi(n,t,r,s),QN(n,e,r)}}function HP(t,e,n){var r=Da(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(YN(t))XN(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(s.hasEagerState=!0,s.eagerState=a,Ji(a,o)){var l=e.interleaved;l===null?(s.next=s,Bb(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}n=DN(t,e,s,r),n!==null&&(s=vs(),qi(n,t,r,s),QN(n,e,r))}}function YN(t){var e=t.alternate;return t===lr||e!==null&&e===lr}function XN(t,e){bd=Hp=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function QN(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Eb(t,n)}}var Vp={readContext:_i,useCallback:rs,useContext:rs,useEffect:rs,useImperativeHandle:rs,useInsertionEffect:rs,useLayoutEffect:rs,useMemo:rs,useReducer:rs,useRef:rs,useState:rs,useDebugValue:rs,useDeferredValue:rs,useTransition:rs,useMutableSource:rs,useSyncExternalStore:rs,useId:rs,unstable_isNewReconciler:!1},VP={readContext:_i,useCallback:function(t,e){return Zi().memoizedState=[t,e===void 0?null:e],t},useContext:_i,useEffect:iS,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ep(4194308,4,VN.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ep(4194308,4,t,e)},useInsertionEffect:function(t,e){return ep(4,2,t,e)},useMemo:function(t,e){var n=Zi();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Zi();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=UP.bind(null,lr,t),[r.memoizedState,t]},useRef:function(t){var e=Zi();return t={current:t},e.memoizedState=t},useState:sS,useDebugValue:Yb,useDeferredValue:function(t){return Zi().memoizedState=t},useTransition:function(){var t=sS(!1),e=t[0];return t=BP.bind(null,t[1]),Zi().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=lr,s=Zi();if(Zn){if(n===void 0)throw Error(_t(407));n=n()}else{if(n=e(),Fr===null)throw Error(_t(349));Wl&30||PN(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,iS($N.bind(null,r,i,t),[t]),r.flags|=2048,sf(9,LN.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Zi(),e=Fr.identifierPrefix;if(Zn){var n=Po,r=Oo;n=(r&~(1<<32-Gi(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=nf++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=FP++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},WP={readContext:_i,useCallback:KN,useContext:_i,useEffect:Jb,useImperativeHandle:WN,useInsertionEffect:UN,useLayoutEffect:HN,useMemo:GN,useReducer:w0,useRef:BN,useState:function(){return w0(rf)},useDebugValue:Yb,useDeferredValue:function(t){var e=Ti();return qN(e,Dr.memoizedState,t)},useTransition:function(){var t=w0(rf)[0],e=Ti().memoizedState;return[t,e]},useMutableSource:RN,useSyncExternalStore:ON,useId:JN,unstable_isNewReconciler:!1},KP={readContext:_i,useCallback:KN,useContext:_i,useEffect:Jb,useImperativeHandle:WN,useInsertionEffect:UN,useLayoutEffect:HN,useMemo:GN,useReducer:v0,useRef:BN,useState:function(){return v0(rf)},useDebugValue:Yb,useDeferredValue:function(t){var e=Ti();return Dr===null?e.memoizedState=t:qN(e,Dr.memoizedState,t)},useTransition:function(){var t=v0(rf)[0],e=Ti().memoizedState;return[t,e]},useMutableSource:RN,useSyncExternalStore:ON,useId:JN,unstable_isNewReconciler:!1};function zi(t,e){if(t&&t.defaultProps){e=cr({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function vx(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:cr({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var hg={isMounted:function(t){return(t=t._reactInternals)?tc(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=vs(),s=Da(t),i=$o(r,s);i.payload=e,n!=null&&(i.callback=n),e=ja(t,i,s),e!==null&&(qi(e,t,s,r),Qh(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=vs(),s=Da(t),i=$o(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=ja(t,i,s),e!==null&&(qi(e,t,s,r),Qh(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=vs(),r=Da(t),s=$o(n,r);s.tag=2,e!=null&&(s.callback=e),e=ja(t,s,r),e!==null&&(qi(e,t,r,n),Qh(e,t,r))}};function oS(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!Yd(n,r)||!Yd(s,i):!0}function ZN(t,e,n){var r=!1,s=Fa,i=e.contextType;return typeof i=="object"&&i!==null?i=_i(i):(s=Ls(e)?Hl:fs.current,r=e.contextTypes,i=(r=r!=null)?du(t,s):Fa),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=hg,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function aS(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&hg.enqueueReplaceState(e,e.state,null)}function kx(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Ub(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=_i(i):(i=Ls(e)?Hl:fs.current,s.context=du(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(vx(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&hg.enqueueReplaceState(s,s.state,null),Bp(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function mu(t,e){try{var n="",r=e;do n+=wO(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function k0(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Sx(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var GP=typeof WeakMap=="function"?WeakMap:Map;function ej(t,e,n){n=$o(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Kp||(Kp=!0,Mx=r),Sx(t,e)},n}function tj(t,e,n){n=$o(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Sx(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Sx(t,e),typeof r!="function"&&(Ia===null?Ia=new Set([this]):Ia.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function lS(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new GP;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=a4.bind(null,t,e,n),e.then(t,t))}function cS(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function uS(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=$o(-1,1),e.tag=2,ja(n,e,1))),n.lanes|=1),t)}var qP=Yo.ReactCurrentOwner,Ms=!1;function bs(t,e,n,r){e.child=t===null?IN(e,null,n,r):hu(e,t.child,n,r)}function dS(t,e,n,r,s){n=n.render;var i=e.ref;return Zc(e,s),r=Gb(t,e,n,r,i,s),n=qb(),t!==null&&!Ms?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Wo(t,e,s)):(Zn&&n&&Ob(e),e.flags|=1,bs(t,e,r,s),e.child)}function fS(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!sw(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,nj(t,e,i,r,s)):(t=sp(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:Yd,n(o,r)&&t.ref===e.ref)return Wo(t,e,s)}return e.flags|=1,t=Aa(i,r),t.ref=e.ref,t.return=e,e.child=t}function nj(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(Yd(i,r)&&t.ref===e.ref)if(Ms=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Ms=!0);else return e.lanes=t.lanes,Wo(t,e,s)}return _x(t,e,n,r,s)}function rj(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Fn($c,Ks),Ks|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Fn($c,Ks),Ks|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Fn($c,Ks),Ks|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Fn($c,Ks),Ks|=r;return bs(t,e,s,n),e.child}function sj(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function _x(t,e,n,r,s){var i=Ls(n)?Hl:fs.current;return i=du(e,i),Zc(e,s),n=Gb(t,e,n,r,i,s),r=qb(),t!==null&&!Ms?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Wo(t,e,s)):(Zn&&r&&Ob(e),e.flags|=1,bs(t,e,n,s),e.child)}function hS(t,e,n,r,s){if(Ls(n)){var i=!0;Pp(e)}else i=!1;if(Zc(e,s),e.stateNode===null)tp(t,e),ZN(e,n,r),kx(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=_i(u):(u=Ls(n)?Hl:fs.current,u=du(e,u));var d=n.getDerivedStateFromProps,f=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&aS(e,o,r,u),ca=!1;var h=e.memoizedState;o.state=h,Bp(e,r,o,s),l=e.memoizedState,a!==r||h!==l||Ps.current||ca?(typeof d=="function"&&(vx(e,n,d,r),l=e.memoizedState),(a=ca||oS(e,n,a,r,h,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,AN(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:zi(e.type,a),o.props=u,f=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=_i(l):(l=Ls(n)?Hl:fs.current,l=du(e,l));var p=n.getDerivedStateFromProps;(d=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||h!==l)&&aS(e,o,r,l),ca=!1,h=e.memoizedState,o.state=h,Bp(e,r,o,s);var m=e.memoizedState;a!==f||h!==m||Ps.current||ca?(typeof p=="function"&&(vx(e,n,p,r),m=e.memoizedState),(u=ca||oS(e,n,u,r,h,m,l)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),o.props=r,o.state=m,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return Tx(t,e,n,r,i,s)}function Tx(t,e,n,r,s,i){sj(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&Qk(e,n,!1),Wo(t,e,i);r=e.stateNode,qP.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=hu(e,t.child,null,i),e.child=hu(e,null,a,i)):bs(t,e,a,i),e.memoizedState=r.state,s&&Qk(e,n,!0),e.child}function ij(t){var e=t.stateNode;e.pendingContext?Xk(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Xk(t,e.context,!1),Hb(t,e.containerInfo)}function pS(t,e,n,r,s){return fu(),Lb(s),e.flags|=256,bs(t,e,n,r),e.child}var Cx={dehydrated:null,treeContext:null,retryLane:0};function Ex(t){return{baseLanes:t,cachePool:null,transitions:null}}function oj(t,e,n){var r=e.pendingProps,s=or.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Fn(or,s&1),t===null)return bx(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=gg(o,r,0,null),t=Rl(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Ex(n),e.memoizedState=Cx,t):Xb(e,o));if(s=t.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return JP(t,e,o,r,a,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Aa(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Aa(a,i):(i=Rl(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?Ex(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=Cx,r}return i=t.child,t=i.sibling,r=Aa(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Xb(t,e){return e=gg({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function yh(t,e,n,r){return r!==null&&Lb(r),hu(e,t.child,null,n),t=Xb(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function JP(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=k0(Error(_t(422))),yh(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=gg({mode:"visible",children:r.children},s,0,null),i=Rl(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&hu(e,t.child,null,o),e.child.memoizedState=Ex(o),e.memoizedState=Cx,i);if(!(e.mode&1))return yh(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(_t(419)),r=k0(i,r,void 0),yh(t,e,o,r)}if(a=(o&t.childLanes)!==0,Ms||a){if(r=Fr,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Vo(t,s),qi(r,t,s,-1))}return rw(),r=k0(Error(_t(421))),yh(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=l4.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Ys=Na(s.nextSibling),Qs=e,Zn=!0,Vi=null,t!==null&&(fi[hi++]=Oo,fi[hi++]=Po,fi[hi++]=Vl,Oo=t.id,Po=t.overflow,Vl=e),e=Xb(e,r.children),e.flags|=4096,e)}function mS(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),wx(t.return,e,n)}function S0(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function aj(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(bs(t,e,r.children,n),r=or.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&mS(t,n,e);else if(t.tag===19)mS(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Fn(or,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Up(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),S0(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Up(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}S0(e,!0,n,null,i);break;case"together":S0(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function tp(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Wo(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Kl|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(_t(153));if(e.child!==null){for(t=e.child,n=Aa(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Aa(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function YP(t,e,n){switch(e.tag){case 3:ij(e),fu();break;case 5:MN(e);break;case 1:Ls(e.type)&&Pp(e);break;case 4:Hb(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Fn(zp,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Fn(or,or.current&1),e.flags|=128,null):n&e.child.childLanes?oj(t,e,n):(Fn(or,or.current&1),t=Wo(t,e,n),t!==null?t.sibling:null);Fn(or,or.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return aj(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Fn(or,or.current),r)break;return null;case 22:case 23:return e.lanes=0,rj(t,e,n)}return Wo(t,e,n)}var lj,Nx,cj,uj;lj=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Nx=function(){};cj=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,_l(ho.current);var i=null;switch(n){case"input":s=Yy(t,s),r=Yy(t,r),i=[];break;case"select":s=cr({},s,{value:void 0}),r=cr({},r,{value:void 0}),i=[];break;case"textarea":s=Zy(t,s),r=Zy(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Rp)}tx(n,r);var o;n=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Hd.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(i||(i=[]),i.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Hd.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Vn("scroll",t),i||a===l||(i=[])):(i=i||[]).push(u,l))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};uj=function(t,e,n,r){n!==r&&(e.flags|=4)};function Gu(t,e){if(!Zn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function ss(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function XP(t,e,n){var r=e.pendingProps;switch(Pb(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ss(e),null;case 1:return Ls(e.type)&&Op(),ss(e),null;case 3:return r=e.stateNode,pu(),Gn(Ps),Gn(fs),Wb(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(mh(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Vi!==null&&(Px(Vi),Vi=null))),Nx(t,e),ss(e),null;case 5:Vb(e);var s=_l(tf.current);if(n=e.type,t!==null&&e.stateNode!=null)cj(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(_t(166));return ss(e),null}if(t=_l(ho.current),mh(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[io]=e,r[Zd]=i,t=(e.mode&1)!==0,n){case"dialog":Vn("cancel",r),Vn("close",r);break;case"iframe":case"object":case"embed":Vn("load",r);break;case"video":case"audio":for(s=0;s<od.length;s++)Vn(od[s],r);break;case"source":Vn("error",r);break;case"img":case"image":case"link":Vn("error",r),Vn("load",r);break;case"details":Vn("toggle",r);break;case"input":_k(r,i),Vn("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Vn("invalid",r);break;case"textarea":Ck(r,i),Vn("invalid",r)}tx(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&ph(r.textContent,a,t),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&ph(r.textContent,a,t),s=["children",""+a]):Hd.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Vn("scroll",r)}switch(n){case"input":oh(r),Tk(r,i,!0);break;case"textarea":oh(r),Ek(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Rp)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=$E(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[io]=e,t[Zd]=r,lj(t,e,!1,!1),e.stateNode=t;e:{switch(o=nx(n,r),n){case"dialog":Vn("cancel",t),Vn("close",t),s=r;break;case"iframe":case"object":case"embed":Vn("load",t),s=r;break;case"video":case"audio":for(s=0;s<od.length;s++)Vn(od[s],t);s=r;break;case"source":Vn("error",t),s=r;break;case"img":case"image":case"link":Vn("error",t),Vn("load",t),s=r;break;case"details":Vn("toggle",t),s=r;break;case"input":_k(t,r),s=Yy(t,r),Vn("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=cr({},r,{value:void 0}),Vn("invalid",t);break;case"textarea":Ck(t,r),s=Zy(t,r),Vn("invalid",t);break;default:s=r}tx(n,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?BE(t,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&zE(t,l)):i==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Vd(t,l):typeof l=="number"&&Vd(t,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Hd.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Vn("scroll",t):l!=null&&vb(t,i,l,o))}switch(n){case"input":oh(t),Tk(t,r,!1);break;case"textarea":oh(t),Ek(t);break;case"option":r.value!=null&&t.setAttribute("value",""+za(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?Jc(t,!!r.multiple,i,!1):r.defaultValue!=null&&Jc(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Rp)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ss(e),null;case 6:if(t&&e.stateNode!=null)uj(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(_t(166));if(n=_l(tf.current),_l(ho.current),mh(e)){if(r=e.stateNode,n=e.memoizedProps,r[io]=e,(i=r.nodeValue!==n)&&(t=Qs,t!==null))switch(t.tag){case 3:ph(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&ph(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[io]=e,e.stateNode=r}return ss(e),null;case 13:if(Gn(or),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Zn&&Ys!==null&&e.mode&1&&!(e.flags&128))NN(),fu(),e.flags|=98560,i=!1;else if(i=mh(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(_t(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(_t(317));i[io]=e}else fu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ss(e),i=!1}else Vi!==null&&(Px(Vi),Vi=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||or.current&1?Mr===0&&(Mr=3):rw())),e.updateQueue!==null&&(e.flags|=4),ss(e),null);case 4:return pu(),Nx(t,e),t===null&&Xd(e.stateNode.containerInfo),ss(e),null;case 10:return Fb(e.type._context),ss(e),null;case 17:return Ls(e.type)&&Op(),ss(e),null;case 19:if(Gn(or),i=e.memoizedState,i===null)return ss(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)Gu(i,!1);else{if(Mr!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Up(t),o!==null){for(e.flags|=128,Gu(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Fn(or,or.current&1|2),e.child}t=t.sibling}i.tail!==null&&xr()>gu&&(e.flags|=128,r=!0,Gu(i,!1),e.lanes=4194304)}else{if(!r)if(t=Up(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Gu(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Zn)return ss(e),null}else 2*xr()-i.renderingStartTime>gu&&n!==1073741824&&(e.flags|=128,r=!0,Gu(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=xr(),e.sibling=null,n=or.current,Fn(or,r?n&1|2:n&1),e):(ss(e),null);case 22:case 23:return nw(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Ks&1073741824&&(ss(e),e.subtreeFlags&6&&(e.flags|=8192)):ss(e),null;case 24:return null;case 25:return null}throw Error(_t(156,e.tag))}function QP(t,e){switch(Pb(e),e.tag){case 1:return Ls(e.type)&&Op(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return pu(),Gn(Ps),Gn(fs),Wb(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Vb(e),null;case 13:if(Gn(or),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(_t(340));fu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Gn(or),null;case 4:return pu(),null;case 10:return Fb(e.type._context),null;case 22:case 23:return nw(),null;case 24:return null;default:return null}}var xh=!1,ls=!1,ZP=typeof WeakSet=="function"?WeakSet:Set,Ut=null;function Lc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){hr(t,e,r)}else n.current=null}function jx(t,e,n){try{n()}catch(r){hr(t,e,r)}}var gS=!1;function e4(t,e){if(fx=Dp,t=mN(),Rb(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,u=0,d=0,f=t,h=null;t:for(;;){for(var p;f!==n||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(p=f.firstChild)!==null;)h=f,f=p;for(;;){if(f===t)break t;if(h===n&&++u===s&&(a=o),h===i&&++d===r&&(l=o),(p=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=p}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(hx={focusedElem:t,selectionRange:n},Dp=!1,Ut=e;Ut!==null;)if(e=Ut,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ut=t;else for(;Ut!==null;){e=Ut;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var y=m.memoizedProps,x=m.memoizedState,g=e.stateNode,v=g.getSnapshotBeforeUpdate(e.elementType===e.type?y:zi(e.type,y),x);g.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(_t(163))}}catch(S){hr(e,e.return,S)}if(t=e.sibling,t!==null){t.return=e.return,Ut=t;break}Ut=e.return}return m=gS,gS=!1,m}function wd(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&jx(e,n,i)}s=s.next}while(s!==r)}}function pg(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Ix(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function dj(t){var e=t.alternate;e!==null&&(t.alternate=null,dj(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[io],delete e[Zd],delete e[gx],delete e[PP],delete e[LP])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function fj(t){return t.tag===5||t.tag===3||t.tag===4}function yS(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||fj(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Dx(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Rp));else if(r!==4&&(t=t.child,t!==null))for(Dx(t,e,n),t=t.sibling;t!==null;)Dx(t,e,n),t=t.sibling}function Ax(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Ax(t,e,n),t=t.sibling;t!==null;)Ax(t,e,n),t=t.sibling}var qr=null,Bi=!1;function ea(t,e,n){for(n=n.child;n!==null;)hj(t,e,n),n=n.sibling}function hj(t,e,n){if(fo&&typeof fo.onCommitFiberUnmount=="function")try{fo.onCommitFiberUnmount(og,n)}catch{}switch(n.tag){case 5:ls||Lc(n,e);case 6:var r=qr,s=Bi;qr=null,ea(t,e,n),qr=r,Bi=s,qr!==null&&(Bi?(t=qr,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):qr.removeChild(n.stateNode));break;case 18:qr!==null&&(Bi?(t=qr,n=n.stateNode,t.nodeType===8?g0(t.parentNode,n):t.nodeType===1&&g0(t,n),qd(t)):g0(qr,n.stateNode));break;case 4:r=qr,s=Bi,qr=n.stateNode.containerInfo,Bi=!0,ea(t,e,n),qr=r,Bi=s;break;case 0:case 11:case 14:case 15:if(!ls&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&jx(n,e,o),s=s.next}while(s!==r)}ea(t,e,n);break;case 1:if(!ls&&(Lc(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){hr(n,e,a)}ea(t,e,n);break;case 21:ea(t,e,n);break;case 22:n.mode&1?(ls=(r=ls)||n.memoizedState!==null,ea(t,e,n),ls=r):ea(t,e,n);break;default:ea(t,e,n)}}function xS(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new ZP),e.forEach(function(r){var s=c4.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Di(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:qr=a.stateNode,Bi=!1;break e;case 3:qr=a.stateNode.containerInfo,Bi=!0;break e;case 4:qr=a.stateNode.containerInfo,Bi=!0;break e}a=a.return}if(qr===null)throw Error(_t(160));hj(i,o,s),qr=null,Bi=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){hr(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)pj(e,t),e=e.sibling}function pj(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Di(e,t),Qi(t),r&4){try{wd(3,t,t.return),pg(3,t)}catch(y){hr(t,t.return,y)}try{wd(5,t,t.return)}catch(y){hr(t,t.return,y)}}break;case 1:Di(e,t),Qi(t),r&512&&n!==null&&Lc(n,n.return);break;case 5:if(Di(e,t),Qi(t),r&512&&n!==null&&Lc(n,n.return),t.flags&32){var s=t.stateNode;try{Vd(s,"")}catch(y){hr(t,t.return,y)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&PE(s,i),nx(a,o);var u=nx(a,i);for(o=0;o<l.length;o+=2){var d=l[o],f=l[o+1];d==="style"?BE(s,f):d==="dangerouslySetInnerHTML"?zE(s,f):d==="children"?Vd(s,f):vb(s,d,f,u)}switch(a){case"input":Xy(s,i);break;case"textarea":LE(s,i);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?Jc(s,!!i.multiple,p,!1):h!==!!i.multiple&&(i.defaultValue!=null?Jc(s,!!i.multiple,i.defaultValue,!0):Jc(s,!!i.multiple,i.multiple?[]:"",!1))}s[Zd]=i}catch(y){hr(t,t.return,y)}}break;case 6:if(Di(e,t),Qi(t),r&4){if(t.stateNode===null)throw Error(_t(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(y){hr(t,t.return,y)}}break;case 3:if(Di(e,t),Qi(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{qd(e.containerInfo)}catch(y){hr(t,t.return,y)}break;case 4:Di(e,t),Qi(t);break;case 13:Di(e,t),Qi(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(ew=xr())),r&4&&xS(t);break;case 22:if(d=n!==null&&n.memoizedState!==null,t.mode&1?(ls=(u=ls)||d,Di(e,t),ls=u):Di(e,t),Qi(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!d&&t.mode&1)for(Ut=t,d=t.child;d!==null;){for(f=Ut=d;Ut!==null;){switch(h=Ut,p=h.child,h.tag){case 0:case 11:case 14:case 15:wd(4,h,h.return);break;case 1:Lc(h,h.return);var m=h.stateNode;if(typeof m.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(y){hr(r,n,y)}}break;case 5:Lc(h,h.return);break;case 22:if(h.memoizedState!==null){wS(f);continue}}p!==null?(p.return=h,Ut=p):wS(f)}d=d.sibling}e:for(d=null,f=t;;){if(f.tag===5){if(d===null){d=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=FE("display",o))}catch(y){hr(t,t.return,y)}}}else if(f.tag===6){if(d===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(y){hr(t,t.return,y)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Di(e,t),Qi(t),r&4&&xS(t);break;case 21:break;default:Di(e,t),Qi(t)}}function Qi(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(fj(n)){var r=n;break e}n=n.return}throw Error(_t(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Vd(s,""),r.flags&=-33);var i=yS(t);Ax(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=yS(t);Dx(t,a,o);break;default:throw Error(_t(161))}}catch(l){hr(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function t4(t,e,n){Ut=t,mj(t)}function mj(t,e,n){for(var r=(t.mode&1)!==0;Ut!==null;){var s=Ut,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||xh;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||ls;a=xh;var u=ls;if(xh=o,(ls=l)&&!u)for(Ut=s;Ut!==null;)o=Ut,l=o.child,o.tag===22&&o.memoizedState!==null?vS(s):l!==null?(l.return=o,Ut=l):vS(s);for(;i!==null;)Ut=i,mj(i),i=i.sibling;Ut=s,xh=a,ls=u}bS(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,Ut=i):bS(t)}}function bS(t){for(;Ut!==null;){var e=Ut;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ls||pg(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ls)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:zi(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&rS(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}rS(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var f=d.dehydrated;f!==null&&qd(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(_t(163))}ls||e.flags&512&&Ix(e)}catch(h){hr(e,e.return,h)}}if(e===t){Ut=null;break}if(n=e.sibling,n!==null){n.return=e.return,Ut=n;break}Ut=e.return}}function wS(t){for(;Ut!==null;){var e=Ut;if(e===t){Ut=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Ut=n;break}Ut=e.return}}function vS(t){for(;Ut!==null;){var e=Ut;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{pg(4,e)}catch(l){hr(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){hr(e,s,l)}}var i=e.return;try{Ix(e)}catch(l){hr(e,i,l)}break;case 5:var o=e.return;try{Ix(e)}catch(l){hr(e,o,l)}}}catch(l){hr(e,e.return,l)}if(e===t){Ut=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ut=a;break}Ut=e.return}}var n4=Math.ceil,Wp=Yo.ReactCurrentDispatcher,Qb=Yo.ReactCurrentOwner,bi=Yo.ReactCurrentBatchConfig,Sn=0,Fr=null,Sr=null,Zr=0,Ks=0,$c=Ga(0),Mr=0,of=null,Kl=0,mg=0,Zb=0,vd=null,Is=null,ew=0,gu=1/0,Io=null,Kp=!1,Mx=null,Ia=null,bh=!1,va=null,Gp=0,kd=0,Rx=null,np=-1,rp=0;function vs(){return Sn&6?xr():np!==-1?np:np=xr()}function Da(t){return t.mode&1?Sn&2&&Zr!==0?Zr&-Zr:zP.transition!==null?(rp===0&&(rp=ZE()),rp):(t=Dn,t!==0||(t=window.event,t=t===void 0?16:oN(t.type)),t):1}function qi(t,e,n,r){if(50<kd)throw kd=0,Rx=null,Error(_t(185));Lf(t,n,r),(!(Sn&2)||t!==Fr)&&(t===Fr&&(!(Sn&2)&&(mg|=n),Mr===4&&ga(t,Zr)),$s(t,r),n===1&&Sn===0&&!(e.mode&1)&&(gu=xr()+500,dg&&qa()))}function $s(t,e){var n=t.callbackNode;zO(t,e);var r=Ip(t,t===Fr?Zr:0);if(r===0)n!==null&&Ik(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Ik(n),e===1)t.tag===0?$P(kS.bind(null,t)):TN(kS.bind(null,t)),RP(function(){!(Sn&6)&&qa()}),n=null;else{switch(eN(r)){case 1:n=Cb;break;case 4:n=XE;break;case 16:n=jp;break;case 536870912:n=QE;break;default:n=jp}n=Sj(n,gj.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function gj(t,e){if(np=-1,rp=0,Sn&6)throw Error(_t(327));var n=t.callbackNode;if(eu()&&t.callbackNode!==n)return null;var r=Ip(t,t===Fr?Zr:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=qp(t,r);else{e=r;var s=Sn;Sn|=2;var i=xj();(Fr!==t||Zr!==e)&&(Io=null,gu=xr()+500,Ml(t,e));do try{i4();break}catch(a){yj(t,a)}while(1);zb(),Wp.current=i,Sn=s,Sr!==null?e=0:(Fr=null,Zr=0,e=Mr)}if(e!==0){if(e===2&&(s=ax(t),s!==0&&(r=s,e=Ox(t,s))),e===1)throw n=of,Ml(t,0),ga(t,r),$s(t,xr()),n;if(e===6)ga(t,r);else{if(s=t.current.alternate,!(r&30)&&!r4(s)&&(e=qp(t,r),e===2&&(i=ax(t),i!==0&&(r=i,e=Ox(t,i))),e===1))throw n=of,Ml(t,0),ga(t,r),$s(t,xr()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(_t(345));case 2:dl(t,Is,Io);break;case 3:if(ga(t,r),(r&130023424)===r&&(e=ew+500-xr(),10<e)){if(Ip(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){vs(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=mx(dl.bind(null,t,Is,Io),e);break}dl(t,Is,Io);break;case 4:if(ga(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-Gi(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=xr()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*n4(r/1960))-r,10<r){t.timeoutHandle=mx(dl.bind(null,t,Is,Io),r);break}dl(t,Is,Io);break;case 5:dl(t,Is,Io);break;default:throw Error(_t(329))}}}return $s(t,xr()),t.callbackNode===n?gj.bind(null,t):null}function Ox(t,e){var n=vd;return t.current.memoizedState.isDehydrated&&(Ml(t,e).flags|=256),t=qp(t,e),t!==2&&(e=Is,Is=n,e!==null&&Px(e)),t}function Px(t){Is===null?Is=t:Is.push.apply(Is,t)}function r4(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!Ji(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ga(t,e){for(e&=~Zb,e&=~mg,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Gi(e),r=1<<n;t[n]=-1,e&=~r}}function kS(t){if(Sn&6)throw Error(_t(327));eu();var e=Ip(t,0);if(!(e&1))return $s(t,xr()),null;var n=qp(t,e);if(t.tag!==0&&n===2){var r=ax(t);r!==0&&(e=r,n=Ox(t,r))}if(n===1)throw n=of,Ml(t,0),ga(t,e),$s(t,xr()),n;if(n===6)throw Error(_t(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,dl(t,Is,Io),$s(t,xr()),null}function tw(t,e){var n=Sn;Sn|=1;try{return t(e)}finally{Sn=n,Sn===0&&(gu=xr()+500,dg&&qa())}}function Gl(t){va!==null&&va.tag===0&&!(Sn&6)&&eu();var e=Sn;Sn|=1;var n=bi.transition,r=Dn;try{if(bi.transition=null,Dn=1,t)return t()}finally{Dn=r,bi.transition=n,Sn=e,!(Sn&6)&&qa()}}function nw(){Ks=$c.current,Gn($c)}function Ml(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,MP(n)),Sr!==null)for(n=Sr.return;n!==null;){var r=n;switch(Pb(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Op();break;case 3:pu(),Gn(Ps),Gn(fs),Wb();break;case 5:Vb(r);break;case 4:pu();break;case 13:Gn(or);break;case 19:Gn(or);break;case 10:Fb(r.type._context);break;case 22:case 23:nw()}n=n.return}if(Fr=t,Sr=t=Aa(t.current,null),Zr=Ks=e,Mr=0,of=null,Zb=mg=Kl=0,Is=vd=null,Sl!==null){for(e=0;e<Sl.length;e++)if(n=Sl[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}Sl=null}return t}function yj(t,e){do{var n=Sr;try{if(zb(),Zh.current=Vp,Hp){for(var r=lr.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Hp=!1}if(Wl=0,Lr=Dr=lr=null,bd=!1,nf=0,Qb.current=null,n===null||n.return===null){Mr=1,of=e,Sr=null;break}e:{var i=t,o=n.return,a=n,l=e;if(e=Zr,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,d=a,f=d.tag;if(!(d.mode&1)&&(f===0||f===11||f===15)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=cS(o);if(p!==null){p.flags&=-257,uS(p,o,a,i,e),p.mode&1&&lS(i,u,e),e=p,l=u;var m=e.updateQueue;if(m===null){var y=new Set;y.add(l),e.updateQueue=y}else m.add(l);break e}else{if(!(e&1)){lS(i,u,e),rw();break e}l=Error(_t(426))}}else if(Zn&&a.mode&1){var x=cS(o);if(x!==null){!(x.flags&65536)&&(x.flags|=256),uS(x,o,a,i,e),Lb(mu(l,a));break e}}i=l=mu(l,a),Mr!==4&&(Mr=2),vd===null?vd=[i]:vd.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var g=ej(i,l,e);nS(i,g);break e;case 1:a=l;var v=i.type,w=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Ia===null||!Ia.has(w)))){i.flags|=65536,e&=-e,i.lanes|=e;var S=tj(i,a,e);nS(i,S);break e}}i=i.return}while(i!==null)}wj(n)}catch(I){e=I,Sr===n&&n!==null&&(Sr=n=n.return);continue}break}while(1)}function xj(){var t=Wp.current;return Wp.current=Vp,t===null?Vp:t}function rw(){(Mr===0||Mr===3||Mr===2)&&(Mr=4),Fr===null||!(Kl&268435455)&&!(mg&268435455)||ga(Fr,Zr)}function qp(t,e){var n=Sn;Sn|=2;var r=xj();(Fr!==t||Zr!==e)&&(Io=null,Ml(t,e));do try{s4();break}catch(s){yj(t,s)}while(1);if(zb(),Sn=n,Wp.current=r,Sr!==null)throw Error(_t(261));return Fr=null,Zr=0,Mr}function s4(){for(;Sr!==null;)bj(Sr)}function i4(){for(;Sr!==null&&!IO();)bj(Sr)}function bj(t){var e=kj(t.alternate,t,Ks);t.memoizedProps=t.pendingProps,e===null?wj(t):Sr=e,Qb.current=null}function wj(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=QP(n,e),n!==null){n.flags&=32767,Sr=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Mr=6,Sr=null;return}}else if(n=XP(n,e,Ks),n!==null){Sr=n;return}if(e=e.sibling,e!==null){Sr=e;return}Sr=e=t}while(e!==null);Mr===0&&(Mr=5)}function dl(t,e,n){var r=Dn,s=bi.transition;try{bi.transition=null,Dn=1,o4(t,e,n,r)}finally{bi.transition=s,Dn=r}return null}function o4(t,e,n,r){do eu();while(va!==null);if(Sn&6)throw Error(_t(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(_t(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(FO(t,i),t===Fr&&(Sr=Fr=null,Zr=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||bh||(bh=!0,Sj(jp,function(){return eu(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=bi.transition,bi.transition=null;var o=Dn;Dn=1;var a=Sn;Sn|=4,Qb.current=null,e4(t,n),pj(n,t),CP(hx),Dp=!!fx,hx=fx=null,t.current=n,t4(n),DO(),Sn=a,Dn=o,bi.transition=i}else t.current=n;if(bh&&(bh=!1,va=t,Gp=s),i=t.pendingLanes,i===0&&(Ia=null),RO(n.stateNode),$s(t,xr()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Kp)throw Kp=!1,t=Mx,Mx=null,t;return Gp&1&&t.tag!==0&&eu(),i=t.pendingLanes,i&1?t===Rx?kd++:(kd=0,Rx=t):kd=0,qa(),null}function eu(){if(va!==null){var t=eN(Gp),e=bi.transition,n=Dn;try{if(bi.transition=null,Dn=16>t?16:t,va===null)var r=!1;else{if(t=va,va=null,Gp=0,Sn&6)throw Error(_t(331));var s=Sn;for(Sn|=4,Ut=t.current;Ut!==null;){var i=Ut,o=i.child;if(Ut.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(Ut=u;Ut!==null;){var d=Ut;switch(d.tag){case 0:case 11:case 15:wd(8,d,i)}var f=d.child;if(f!==null)f.return=d,Ut=f;else for(;Ut!==null;){d=Ut;var h=d.sibling,p=d.return;if(dj(d),d===u){Ut=null;break}if(h!==null){h.return=p,Ut=h;break}Ut=p}}}var m=i.alternate;if(m!==null){var y=m.child;if(y!==null){m.child=null;do{var x=y.sibling;y.sibling=null,y=x}while(y!==null)}}Ut=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,Ut=o;else e:for(;Ut!==null;){if(i=Ut,i.flags&2048)switch(i.tag){case 0:case 11:case 15:wd(9,i,i.return)}var g=i.sibling;if(g!==null){g.return=i.return,Ut=g;break e}Ut=i.return}}var v=t.current;for(Ut=v;Ut!==null;){o=Ut;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,Ut=w;else e:for(o=v;Ut!==null;){if(a=Ut,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:pg(9,a)}}catch(I){hr(a,a.return,I)}if(a===o){Ut=null;break e}var S=a.sibling;if(S!==null){S.return=a.return,Ut=S;break e}Ut=a.return}}if(Sn=s,qa(),fo&&typeof fo.onPostCommitFiberRoot=="function")try{fo.onPostCommitFiberRoot(og,t)}catch{}r=!0}return r}finally{Dn=n,bi.transition=e}}return!1}function SS(t,e,n){e=mu(n,e),e=ej(t,e,1),t=ja(t,e,1),e=vs(),t!==null&&(Lf(t,1,e),$s(t,e))}function hr(t,e,n){if(t.tag===3)SS(t,t,n);else for(;e!==null;){if(e.tag===3){SS(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ia===null||!Ia.has(r))){t=mu(n,t),t=tj(e,t,1),e=ja(e,t,1),t=vs(),e!==null&&(Lf(e,1,t),$s(e,t));break}}e=e.return}}function a4(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=vs(),t.pingedLanes|=t.suspendedLanes&n,Fr===t&&(Zr&n)===n&&(Mr===4||Mr===3&&(Zr&130023424)===Zr&&500>xr()-ew?Ml(t,0):Zb|=n),$s(t,e)}function vj(t,e){e===0&&(t.mode&1?(e=ch,ch<<=1,!(ch&130023424)&&(ch=4194304)):e=1);var n=vs();t=Vo(t,e),t!==null&&(Lf(t,e,n),$s(t,n))}function l4(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),vj(t,n)}function c4(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(_t(314))}r!==null&&r.delete(e),vj(t,n)}var kj;kj=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ps.current)Ms=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ms=!1,YP(t,e,n);Ms=!!(t.flags&131072)}else Ms=!1,Zn&&e.flags&1048576&&CN(e,$p,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;tp(t,e),t=e.pendingProps;var s=du(e,fs.current);Zc(e,n),s=Gb(null,e,r,t,s,n);var i=qb();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ls(r)?(i=!0,Pp(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Ub(e),s.updater=hg,e.stateNode=s,s._reactInternals=e,kx(e,r,t,n),e=Tx(null,e,r,!0,i,n)):(e.tag=0,Zn&&i&&Ob(e),bs(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(tp(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=d4(r),t=zi(r,t),s){case 0:e=_x(null,e,r,t,n);break e;case 1:e=hS(null,e,r,t,n);break e;case 11:e=dS(null,e,r,t,n);break e;case 14:e=fS(null,e,r,zi(r.type,t),n);break e}throw Error(_t(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:zi(r,s),_x(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:zi(r,s),hS(t,e,r,s,n);case 3:e:{if(ij(e),t===null)throw Error(_t(387));r=e.pendingProps,i=e.memoizedState,s=i.element,AN(t,e),Bp(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=mu(Error(_t(423)),e),e=pS(t,e,r,n,s);break e}else if(r!==s){s=mu(Error(_t(424)),e),e=pS(t,e,r,n,s);break e}else for(Ys=Na(e.stateNode.containerInfo.firstChild),Qs=e,Zn=!0,Vi=null,n=IN(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(fu(),r===s){e=Wo(t,e,n);break e}bs(t,e,r,n)}e=e.child}return e;case 5:return MN(e),t===null&&bx(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,px(r,s)?o=null:i!==null&&px(r,i)&&(e.flags|=32),sj(t,e),bs(t,e,o,n),e.child;case 6:return t===null&&bx(e),null;case 13:return oj(t,e,n);case 4:return Hb(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=hu(e,null,r,n):bs(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:zi(r,s),dS(t,e,r,s,n);case 7:return bs(t,e,e.pendingProps,n),e.child;case 8:return bs(t,e,e.pendingProps.children,n),e.child;case 12:return bs(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Fn(zp,r._currentValue),r._currentValue=o,i!==null)if(Ji(i.value,o)){if(i.children===s.children&&!Ps.current){e=Wo(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=$o(-1,n&-n),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}i.lanes|=n,l=i.alternate,l!==null&&(l.lanes|=n),wx(i.return,n,e),a.lanes|=n;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(_t(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),wx(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}bs(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Zc(e,n),s=_i(s),r=r(s),e.flags|=1,bs(t,e,r,n),e.child;case 14:return r=e.type,s=zi(r,e.pendingProps),s=zi(r.type,s),fS(t,e,r,s,n);case 15:return nj(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:zi(r,s),tp(t,e),e.tag=1,Ls(r)?(t=!0,Pp(e)):t=!1,Zc(e,n),ZN(e,r,s),kx(e,r,s,n),Tx(null,e,r,!0,t,n);case 19:return aj(t,e,n);case 22:return rj(t,e,n)}throw Error(_t(156,e.tag))};function Sj(t,e){return YE(t,e)}function u4(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gi(t,e,n,r){return new u4(t,e,n,r)}function sw(t){return t=t.prototype,!(!t||!t.isReactComponent)}function d4(t){if(typeof t=="function")return sw(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Sb)return 11;if(t===_b)return 14}return 2}function Aa(t,e){var n=t.alternate;return n===null?(n=gi(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function sp(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")sw(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Nc:return Rl(n.children,s,i,e);case kb:o=8,s|=8;break;case Ky:return t=gi(12,n,e,s|2),t.elementType=Ky,t.lanes=i,t;case Gy:return t=gi(13,n,e,s),t.elementType=Gy,t.lanes=i,t;case qy:return t=gi(19,n,e,s),t.elementType=qy,t.lanes=i,t;case ME:return gg(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case DE:o=10;break e;case AE:o=9;break e;case Sb:o=11;break e;case _b:o=14;break e;case la:o=16,r=null;break e}throw Error(_t(130,t==null?t:typeof t,""))}return e=gi(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Rl(t,e,n,r){return t=gi(7,t,r,e),t.lanes=n,t}function gg(t,e,n,r){return t=gi(22,t,r,e),t.elementType=ME,t.lanes=n,t.stateNode={isHidden:!1},t}function _0(t,e,n){return t=gi(6,t,null,e),t.lanes=n,t}function T0(t,e,n){return e=gi(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function f4(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=i0(0),this.expirationTimes=i0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=i0(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function iw(t,e,n,r,s,i,o,a,l){return t=new f4(t,e,n,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=gi(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ub(i),t}function h4(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ec,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function _j(t){if(!t)return Fa;t=t._reactInternals;e:{if(tc(t)!==t||t.tag!==1)throw Error(_t(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ls(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(_t(171))}if(t.tag===1){var n=t.type;if(Ls(n))return _N(t,n,e)}return e}function Tj(t,e,n,r,s,i,o,a,l){return t=iw(n,r,!0,t,s,i,o,a,l),t.context=_j(null),n=t.current,r=vs(),s=Da(n),i=$o(r,s),i.callback=e??null,ja(n,i,s),t.current.lanes=s,Lf(t,s,r),$s(t,r),t}function yg(t,e,n,r){var s=e.current,i=vs(),o=Da(s);return n=_j(n),e.context===null?e.context=n:e.pendingContext=n,e=$o(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=ja(s,e,o),t!==null&&(qi(t,s,o,i),Qh(t,s,o)),o}function Jp(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function _S(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function ow(t,e){_S(t,e),(t=t.alternate)&&_S(t,e)}function p4(){return null}var Cj=typeof reportError=="function"?reportError:function(t){console.error(t)};function aw(t){this._internalRoot=t}xg.prototype.render=aw.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(_t(409));yg(t,e,null,null)};xg.prototype.unmount=aw.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Gl(function(){yg(null,t,null,null)}),e[Ho]=null}};function xg(t){this._internalRoot=t}xg.prototype.unstable_scheduleHydration=function(t){if(t){var e=rN();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ma.length&&e!==0&&e<ma[n].priority;n++);ma.splice(n,0,t),n===0&&iN(t)}};function lw(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function bg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function TS(){}function m4(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Jp(o);i.call(u)}}var o=Tj(e,r,t,0,null,!1,!1,"",TS);return t._reactRootContainer=o,t[Ho]=o.current,Xd(t.nodeType===8?t.parentNode:t),Gl(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=Jp(l);a.call(u)}}var l=iw(t,0,!1,null,null,!1,!1,"",TS);return t._reactRootContainer=l,t[Ho]=l.current,Xd(t.nodeType===8?t.parentNode:t),Gl(function(){yg(e,l,n,r)}),l}function wg(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=Jp(o);a.call(l)}}yg(e,o,t,s)}else o=m4(n,e,t,s,r);return Jp(o)}tN=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=id(e.pendingLanes);n!==0&&(Eb(e,n|1),$s(e,xr()),!(Sn&6)&&(gu=xr()+500,qa()))}break;case 13:Gl(function(){var r=Vo(t,1);if(r!==null){var s=vs();qi(r,t,1,s)}}),ow(t,1)}};Nb=function(t){if(t.tag===13){var e=Vo(t,134217728);if(e!==null){var n=vs();qi(e,t,134217728,n)}ow(t,134217728)}};nN=function(t){if(t.tag===13){var e=Da(t),n=Vo(t,e);if(n!==null){var r=vs();qi(n,t,e,r)}ow(t,e)}};rN=function(){return Dn};sN=function(t,e){var n=Dn;try{return Dn=t,e()}finally{Dn=n}};sx=function(t,e,n){switch(e){case"input":if(Xy(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=ug(r);if(!s)throw Error(_t(90));OE(r),Xy(r,s)}}}break;case"textarea":LE(t,n);break;case"select":e=n.value,e!=null&&Jc(t,!!n.multiple,e,!1)}};VE=tw;WE=Gl;var g4={usingClientEntryPoint:!1,Events:[zf,Ac,ug,UE,HE,tw]},qu={findFiberByHostInstance:kl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},y4={bundleType:qu.bundleType,version:qu.version,rendererPackageName:qu.rendererPackageName,rendererConfig:qu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Yo.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=qE(t),t===null?null:t.stateNode},findFiberByHostInstance:qu.findFiberByHostInstance||p4,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wh.isDisabled&&wh.supportsFiber)try{og=wh.inject(y4),fo=wh}catch{}}ti.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=g4;ti.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!lw(e))throw Error(_t(200));return h4(t,e,null,n)};ti.createRoot=function(t,e){if(!lw(t))throw Error(_t(299));var n=!1,r="",s=Cj;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=iw(t,1,!1,null,null,n,!1,r,s),t[Ho]=e.current,Xd(t.nodeType===8?t.parentNode:t),new aw(e)};ti.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(_t(188)):(t=Object.keys(t).join(","),Error(_t(268,t)));return t=qE(e),t=t===null?null:t.stateNode,t};ti.flushSync=function(t){return Gl(t)};ti.hydrate=function(t,e,n){if(!bg(e))throw Error(_t(200));return wg(null,t,e,!0,n)};ti.hydrateRoot=function(t,e,n){if(!lw(t))throw Error(_t(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=Cj;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Tj(e,null,t,1,n??null,s,!1,i,o),t[Ho]=e.current,Xd(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new xg(e)};ti.render=function(t,e,n){if(!bg(e))throw Error(_t(200));return wg(null,t,e,!1,n)};ti.unmountComponentAtNode=function(t){if(!bg(t))throw Error(_t(40));return t._reactRootContainer?(Gl(function(){wg(null,null,t,!1,function(){t._reactRootContainer=null,t[Ho]=null})}),!0):!1};ti.unstable_batchedUpdates=tw;ti.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!bg(n))throw Error(_t(200));if(t==null||t._reactInternals===void 0)throw Error(_t(38));return wg(t,e,n,!1,r)};ti.version="18.3.1-next-f1338f8080-20240426";function Ej(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Ej)}catch(t){console.error(t)}}Ej(),EE.exports=ti;var er=EE.exports;const x4=sg(er);var CS=er;Vy.createRoot=CS.createRoot,Vy.hydrateRoot=CS.hydrateRoot;const b4="modulepreload",w4=function(t){return"/ai_completion/"+t},ES={},cw=function(e,n,r){if(!n||n.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(n.map(i=>{if(i=w4(i),i in ES)return;ES[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":b4,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((d,f)=>{u.addEventListener("load",d),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};var NS="popstate";function v4(t={}){function e(r,s){let{pathname:i,search:o,hash:a}=r.location;return Lx("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:af(s)}return S4(e,n,null,t)}function nr(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ci(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function k4(){return Math.random().toString(36).substring(2,10)}function jS(t,e){return{usr:t.state,key:t.key,idx:e}}function Lx(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Eu(e):e,state:n,key:e&&e.key||r||k4()}}function af({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Eu(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function S4(t,e,n,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a="POP",l=null,u=d();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function d(){return(o.state||{idx:null}).idx}function f(){a="POP";let x=d(),g=x==null?null:x-u;u=x,l&&l({action:a,location:y.location,delta:g})}function h(x,g){a="PUSH";let v=Lx(y.location,x,g);n&&n(v,x),u=d()+1;let w=jS(v,u),S=y.createHref(v);try{o.pushState(w,"",S)}catch(I){if(I instanceof DOMException&&I.name==="DataCloneError")throw I;s.location.assign(S)}i&&l&&l({action:a,location:y.location,delta:1})}function p(x,g){a="REPLACE";let v=Lx(y.location,x,g);n&&n(v,x),u=d();let w=jS(v,u),S=y.createHref(v);o.replaceState(w,"",S),i&&l&&l({action:a,location:y.location,delta:0})}function m(x){return _4(x)}let y={get action(){return a},get location(){return t(s,o)},listen(x){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(NS,f),l=x,()=>{s.removeEventListener(NS,f),l=null}},createHref(x){return e(s,x)},createURL:m,encodeLocation(x){let g=m(x);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:h,replace:p,go(x){return o.go(x)}};return y}function _4(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),nr(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:af(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function Nj(t,e,n="/"){return T4(t,e,n,!1)}function T4(t,e,n,r){let s=typeof e=="string"?Eu(e):e,i=Ko(s.pathname||"/",n);if(i==null)return null;let o=jj(t);C4(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let u=L4(i);a=O4(o[l],u,r)}return a}function jj(t,e=[],n=[],r="",s=!1){let i=(o,a,l=s,u)=>{let d={relativePath:u===void 0?o.path||"":u,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};if(d.relativePath.startsWith("/")){if(!d.relativePath.startsWith(r)&&l)return;nr(d.relativePath.startsWith(r),`Absolute route path "${d.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),d.relativePath=d.relativePath.slice(r.length)}let f=zo([r,d.relativePath]),h=n.concat(d);o.children&&o.children.length>0&&(nr(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${f}".`),jj(o.children,e,h,f,l)),!(o.path==null&&!o.index)&&e.push({path:f,score:M4(f,o.index),routesMeta:h})};return t.forEach((o,a)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))i(o,a);else for(let u of Ij(o.path))i(o,a,!0,u)}),e}function Ij(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=Ij(r.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function C4(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:R4(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var E4=/^:[\w-]+$/,N4=3,j4=2,I4=1,D4=10,A4=-2,IS=t=>t==="*";function M4(t,e){let n=t.split("/"),r=n.length;return n.some(IS)&&(r+=A4),e&&(r+=j4),n.filter(s=>!IS(s)).reduce((s,i)=>s+(E4.test(i)?N4:i===""?I4:D4),r)}function R4(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function O4(t,e,n=!1){let{routesMeta:r}=t,s={},i="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],u=a===r.length-1,d=i==="/"?e:e.slice(i.length)||"/",f=Yp({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},d),h=l.route;if(!f&&u&&n&&!r[r.length-1].route.index&&(f=Yp({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},d)),!f)return null;Object.assign(s,f.params),o.push({params:s,pathname:zo([i,f.pathname]),pathnameBase:B4(zo([i,f.pathnameBase])),route:h}),f.pathnameBase!=="/"&&(i=zo([i,f.pathnameBase]))}return o}function Yp(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=P4(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((u,{paramName:d,isOptional:f},h)=>{if(d==="*"){let m=a[h]||"";o=i.slice(0,i.length-m.length).replace(/(.)\/+$/,"$1")}const p=a[h];return f&&!p?u[d]=void 0:u[d]=(p||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:t}}function P4(t,e=!1,n=!0){Ci(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function L4(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ci(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Ko(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var Dj=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,$4=t=>Dj.test(t);function z4(t,e="/"){let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?Eu(t):t,i;if(n)if($4(n))i=n;else{if(n.includes("//")){let o=n;n=n.replace(/\/\/+/g,"/"),Ci(!1,`Pathnames cannot have embedded double slashes - normalizing ${o} -> ${n}`)}n.startsWith("/")?i=DS(n.substring(1),"/"):i=DS(n,e)}else i=e;return{pathname:i,search:U4(r),hash:H4(s)}}function DS(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function C0(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function F4(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function uw(t){let e=F4(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function dw(t,e,n,r=!1){let s;typeof t=="string"?s=Eu(t):(s={...t},nr(!s.pathname||!s.pathname.includes("?"),C0("?","pathname","search",s)),nr(!s.pathname||!s.pathname.includes("#"),C0("#","pathname","hash",s)),nr(!s.search||!s.search.includes("#"),C0("#","search","hash",s)));let i=t===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=n;else{let f=e.length-1;if(!r&&o.startsWith("..")){let h=o.split("/");for(;h[0]==="..";)h.shift(),f-=1;s.pathname=h.join("/")}a=f>=0?e[f]:"/"}let l=z4(s,a),u=o&&o!=="/"&&o.endsWith("/"),d=(i||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(u||d)&&(l.pathname+="/"),l}var zo=t=>t.join("/").replace(/\/\/+/g,"/"),B4=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),U4=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,H4=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,V4=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function W4(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function K4(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Aj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Mj(t,e){let n=t;if(typeof n!="string"||!Dj.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,s=!1;if(Aj)try{let i=new URL(window.location.href),o=n.startsWith("//")?new URL(i.protocol+n):new URL(n),a=Ko(o.pathname,e);o.origin===i.origin&&a!=null?n=a+o.search+o.hash:s=!0}catch{Ci(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:s,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Rj=["POST","PUT","PATCH","DELETE"];new Set(Rj);var G4=["GET",...Rj];new Set(G4);var Nu=b.createContext(null);Nu.displayName="DataRouter";var vg=b.createContext(null);vg.displayName="DataRouterState";var q4=b.createContext(!1),Oj=b.createContext({isTransitioning:!1});Oj.displayName="ViewTransition";var J4=b.createContext(new Map);J4.displayName="Fetchers";var Y4=b.createContext(null);Y4.displayName="Await";var ri=b.createContext(null);ri.displayName="Navigation";var Bf=b.createContext(null);Bf.displayName="Location";var vo=b.createContext({outlet:null,matches:[],isDataRoute:!1});vo.displayName="Route";var fw=b.createContext(null);fw.displayName="RouteError";var Pj="REACT_ROUTER_ERROR",X4="REDIRECT",Q4="ROUTE_ERROR_RESPONSE";function Z4(t){if(t.startsWith(`${Pj}:${X4}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function e3(t){if(t.startsWith(`${Pj}:${Q4}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new V4(e.status,e.statusText,e.data)}catch{}}function t3(t,{relative:e}={}){nr(ju(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=b.useContext(ri),{hash:s,pathname:i,search:o}=Uf(t,{relative:e}),a=i;return n!=="/"&&(a=i==="/"?n:zo([n,i])),r.createHref({pathname:a,search:o,hash:s})}function ju(){return b.useContext(Bf)!=null}function Ja(){return nr(ju(),"useLocation() may be used only in the context of a <Router> component."),b.useContext(Bf).location}var Lj="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function $j(t){b.useContext(ri).static||b.useLayoutEffect(t)}function zj(){let{isDataRoute:t}=b.useContext(vo);return t?p3():n3()}function n3(){nr(ju(),"useNavigate() may be used only in the context of a <Router> component.");let t=b.useContext(Nu),{basename:e,navigator:n}=b.useContext(ri),{matches:r}=b.useContext(vo),{pathname:s}=Ja(),i=JSON.stringify(uw(r)),o=b.useRef(!1);return $j(()=>{o.current=!0}),b.useCallback((l,u={})=>{if(Ci(o.current,Lj),!o.current)return;if(typeof l=="number"){n.go(l);return}let d=dw(l,JSON.parse(i),s,u.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:zo([e,d.pathname])),(u.replace?n.replace:n.push)(d,u.state,u)},[e,n,i,s,t])}b.createContext(null);function Uf(t,{relative:e}={}){let{matches:n}=b.useContext(vo),{pathname:r}=Ja(),s=JSON.stringify(uw(n));return b.useMemo(()=>dw(t,JSON.parse(s),r,e==="path"),[t,s,r,e])}function r3(t,e){return Fj(t,e)}function Fj(t,e,n,r,s){var v;nr(ju(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=b.useContext(ri),{matches:o}=b.useContext(vo),a=o[o.length-1],l=a?a.params:{},u=a?a.pathname:"/",d=a?a.pathnameBase:"/",f=a&&a.route;{let w=f&&f.path||"";Uj(u,!f||w.endsWith("*")||w.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${w}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${w}"> to <Route path="${w==="/"?"*":`${w}/*`}">.`)}let h=Ja(),p;if(e){let w=typeof e=="string"?Eu(e):e;nr(d==="/"||((v=w.pathname)==null?void 0:v.startsWith(d)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${w.pathname}" was given in the \`location\` prop.`),p=w}else p=h;let m=p.pathname||"/",y=m;if(d!=="/"){let w=d.replace(/^\//,"").split("/");y="/"+m.replace(/^\//,"").split("/").slice(w.length).join("/")}let x=Nj(t,{pathname:y});Ci(f||x!=null,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),Ci(x==null||x[x.length-1].route.element!==void 0||x[x.length-1].route.Component!==void 0||x[x.length-1].route.lazy!==void 0,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let g=l3(x&&x.map(w=>Object.assign({},w,{params:Object.assign({},l,w.params),pathname:zo([d,i.encodeLocation?i.encodeLocation(w.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?d:zo([d,i.encodeLocation?i.encodeLocation(w.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathnameBase])})),o,n,r,s);return e&&g?b.createElement(Bf.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...p},navigationType:"POP"}},g):g}function s3(){let t=h3(),e=W4(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=b.createElement(b.Fragment,null,b.createElement("p",null," Hey developer "),b.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",b.createElement("code",{style:i},"ErrorBoundary")," or"," ",b.createElement("code",{style:i},"errorElement")," prop on your route.")),b.createElement(b.Fragment,null,b.createElement("h2",null,"Unexpected Application Error!"),b.createElement("h3",{style:{fontStyle:"italic"}},e),n?b.createElement("pre",{style:s},n):null,o)}var i3=b.createElement(s3,null),Bj=class extends b.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=e3(t.digest);n&&(t=n)}let e=t!==void 0?b.createElement(vo.Provider,{value:this.props.routeContext},b.createElement(fw.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?b.createElement(o3,{error:t},e):e}};Bj.contextType=q4;var E0=new WeakMap;function o3({children:t,error:e}){let{basename:n}=b.useContext(ri);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=Z4(e.digest);if(r){let s=E0.get(e);if(s)throw s;let i=Mj(r.location,n);if(Aj&&!E0.get(e))if(i.isExternal||r.reloadDocument)window.location.href=i.absoluteURL||i.to;else{const o=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(i.to,{replace:r.replace}));throw E0.set(e,o),o}return b.createElement("meta",{httpEquiv:"refresh",content:`0;url=${i.absoluteURL||i.to}`})}}return t}function a3({routeContext:t,match:e,children:n}){let r=b.useContext(Nu);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),b.createElement(vo.Provider,{value:t},n)}function l3(t,e=[],n=null,r=null,s=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,o=n==null?void 0:n.errors;if(o!=null){let d=i.findIndex(f=>f.route.id&&(o==null?void 0:o[f.route.id])!==void 0);nr(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,d+1))}let a=!1,l=-1;if(n)for(let d=0;d<i.length;d++){let f=i[d];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(l=d),f.route.id){let{loaderData:h,errors:p}=n,m=f.route.loader&&!h.hasOwnProperty(f.route.id)&&(!p||p[f.route.id]===void 0);if(f.route.lazy||m){a=!0,l>=0?i=i.slice(0,l+1):i=[i[0]];break}}}let u=n&&r?(d,f)=>{var h,p;r(d,{location:n.location,params:((p=(h=n.matches)==null?void 0:h[0])==null?void 0:p.params)??{},unstable_pattern:K4(n.matches),errorInfo:f})}:void 0;return i.reduceRight((d,f,h)=>{let p,m=!1,y=null,x=null;n&&(p=o&&f.route.id?o[f.route.id]:void 0,y=f.route.errorElement||i3,a&&(l<0&&h===0?(Uj("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),m=!0,x=null):l===h&&(m=!0,x=f.route.hydrateFallbackElement||null)));let g=e.concat(i.slice(0,h+1)),v=()=>{let w;return p?w=y:m?w=x:f.route.Component?w=b.createElement(f.route.Component,null):f.route.element?w=f.route.element:w=d,b.createElement(a3,{match:f,routeContext:{outlet:d,matches:g,isDataRoute:n!=null},children:w})};return n&&(f.route.ErrorBoundary||f.route.errorElement||h===0)?b.createElement(Bj,{location:n.location,revalidation:n.revalidation,component:y,error:p,children:v(),routeContext:{outlet:null,matches:g,isDataRoute:!0},onError:u}):v()},null)}function hw(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function c3(t){let e=b.useContext(Nu);return nr(e,hw(t)),e}function u3(t){let e=b.useContext(vg);return nr(e,hw(t)),e}function d3(t){let e=b.useContext(vo);return nr(e,hw(t)),e}function pw(t){let e=d3(t),n=e.matches[e.matches.length-1];return nr(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function f3(){return pw("useRouteId")}function h3(){var r;let t=b.useContext(fw),e=u3("useRouteError"),n=pw("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function p3(){let{router:t}=c3("useNavigate"),e=pw("useNavigate"),n=b.useRef(!1);return $j(()=>{n.current=!0}),b.useCallback(async(s,i={})=>{Ci(n.current,Lj),n.current&&(typeof s=="number"?await t.navigate(s):await t.navigate(s,{fromRouteId:e,...i}))},[t,e])}var AS={};function Uj(t,e,n){!e&&!AS[t]&&(AS[t]=!0,Ci(!1,n))}b.memo(m3);function m3({routes:t,future:e,state:n,onError:r}){return Fj(t,void 0,n,r,e)}function MS({to:t,replace:e,state:n,relative:r}){nr(ju(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=b.useContext(ri);Ci(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=b.useContext(vo),{pathname:o}=Ja(),a=zj(),l=dw(t,uw(i),o,r==="path"),u=JSON.stringify(l);return b.useEffect(()=>{a(JSON.parse(u),{replace:e,state:n,relative:r})},[a,u,r,e,n]),null}function ip(t){nr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function g3({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:s,static:i=!1,unstable_useTransitions:o}){nr(!ju(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=t.replace(/^\/*/,"/"),l=b.useMemo(()=>({basename:a,navigator:s,static:i,unstable_useTransitions:o,future:{}}),[a,s,i,o]);typeof n=="string"&&(n=Eu(n));let{pathname:u="/",search:d="",hash:f="",state:h=null,key:p="default"}=n,m=b.useMemo(()=>{let y=Ko(u,a);return y==null?null:{location:{pathname:y,search:d,hash:f,state:h,key:p},navigationType:r}},[a,u,d,f,h,p,r]);return Ci(m!=null,`<Router basename="${a}"> is not able to match the URL "${u}${d}${f}" because it does not start with the basename, so the <Router> won't render anything.`),m==null?null:b.createElement(ri.Provider,{value:l},b.createElement(Bf.Provider,{children:e,value:m}))}function y3({children:t,location:e}){return r3($x(t),e)}function $x(t,e=[]){let n=[];return b.Children.forEach(t,(r,s)=>{if(!b.isValidElement(r))return;let i=[...e,s];if(r.type===b.Fragment){n.push.apply(n,$x(r.props.children,i));return}nr(r.type===ip,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),nr(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=$x(r.props.children,i)),n.push(o)}),n}var op="get",ap="application/x-www-form-urlencoded";function kg(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function x3(t){return kg(t)&&t.tagName.toLowerCase()==="button"}function b3(t){return kg(t)&&t.tagName.toLowerCase()==="form"}function w3(t){return kg(t)&&t.tagName.toLowerCase()==="input"}function v3(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function k3(t,e){return t.button===0&&(!e||e==="_self")&&!v3(t)}var vh=null;function S3(){if(vh===null)try{new FormData(document.createElement("form"),0),vh=!1}catch{vh=!0}return vh}var _3=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function N0(t){return t!=null&&!_3.has(t)?(Ci(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${ap}"`),null):t}function T3(t,e){let n,r,s,i,o;if(b3(t)){let a=t.getAttribute("action");r=a?Ko(a,e):null,n=t.getAttribute("method")||op,s=N0(t.getAttribute("enctype"))||ap,i=new FormData(t)}else if(x3(t)||w3(t)&&(t.type==="submit"||t.type==="image")){let a=t.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=t.getAttribute("formaction")||a.getAttribute("action");if(r=l?Ko(l,e):null,n=t.getAttribute("formmethod")||a.getAttribute("method")||op,s=N0(t.getAttribute("formenctype"))||N0(a.getAttribute("enctype"))||ap,i=new FormData(a,t),!S3()){let{name:u,type:d,value:f}=t;if(d==="image"){let h=u?`${u}.`:"";i.append(`${h}x`,"0"),i.append(`${h}y`,"0")}else u&&i.append(u,f)}}else{if(kg(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=op,r=null,s=ap,o=t}return i&&s==="text/plain"&&(o=i,i=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function mw(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function C3(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&Ko(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function E3(t,e){if(t.id in e)return e[t.id];try{let n=await cw(()=>import(t.module),[]);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function N3(t){return t!=null&&typeof t.page=="string"}function j3(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function I3(t,e,n){let r=await Promise.all(t.map(async s=>{let i=e.routes[s.route.id];if(i){let o=await E3(i,n);return o.links?o.links():[]}return[]}));return R3(r.flat(1).filter(j3).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function RS(t,e,n,r,s,i){let o=(l,u)=>n[u]?l.route.id!==n[u].route.id:!0,a=(l,u)=>{var d;return n[u].pathname!==l.pathname||((d=n[u].route.path)==null?void 0:d.endsWith("*"))&&n[u].params["*"]!==l.params["*"]};return i==="assets"?e.filter((l,u)=>o(l,u)||a(l,u)):i==="data"?e.filter((l,u)=>{var f;let d=r.routes[l.route.id];if(!d||!d.hasLoader)return!1;if(o(l,u)||a(l,u))return!0;if(l.route.shouldRevalidate){let h=l.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((f=n[0])==null?void 0:f.params)||{},nextUrl:new URL(t,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function D3(t,e,{includeHydrateFallback:n}={}){return A3(t.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function A3(t){return[...new Set(t)]}function M3(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function R3(t,e){let n=new Set,r=new Set(e);return t.reduce((s,i)=>{if(e&&!N3(i)&&i.as==="script"&&i.href&&r.has(i.href))return s;let a=JSON.stringify(M3(i));return n.has(a)||(n.add(a),s.push({key:a,link:i})),s},[])}function Hj(){let t=b.useContext(Nu);return mw(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function O3(){let t=b.useContext(vg);return mw(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var gw=b.createContext(void 0);gw.displayName="FrameworkContext";function Vj(){let t=b.useContext(gw);return mw(t,"You must render this element inside a <HydratedRouter> element"),t}function P3(t,e){let n=b.useContext(gw),[r,s]=b.useState(!1),[i,o]=b.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:u,onMouseLeave:d,onTouchStart:f}=e,h=b.useRef(null);b.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let y=g=>{g.forEach(v=>{o(v.isIntersecting)})},x=new IntersectionObserver(y,{threshold:.5});return h.current&&x.observe(h.current),()=>{x.disconnect()}}},[t]),b.useEffect(()=>{if(r){let y=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(y)}}},[r]);let p=()=>{s(!0)},m=()=>{s(!1),o(!1)};return n?t!=="intent"?[i,h,{}]:[i,h,{onFocus:Ju(a,p),onBlur:Ju(l,m),onMouseEnter:Ju(u,p),onMouseLeave:Ju(d,m),onTouchStart:Ju(f,p)}]:[!1,h,{}]}function Ju(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function L3({page:t,...e}){let{router:n}=Hj(),r=b.useMemo(()=>Nj(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?b.createElement(z3,{page:t,matches:r,...e}):null}function $3(t){let{manifest:e,routeModules:n}=Vj(),[r,s]=b.useState([]);return b.useEffect(()=>{let i=!1;return I3(t,e,n).then(o=>{i||s(o)}),()=>{i=!0}},[t,e,n]),r}function z3({page:t,matches:e,...n}){let r=Ja(),{manifest:s,routeModules:i}=Vj(),{basename:o}=Hj(),{loaderData:a,matches:l}=O3(),u=b.useMemo(()=>RS(t,e,l,s,r,"data"),[t,e,l,s,r]),d=b.useMemo(()=>RS(t,e,l,s,r,"assets"),[t,e,l,s,r]),f=b.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let m=new Set,y=!1;if(e.forEach(g=>{var w;let v=s.routes[g.route.id];!v||!v.hasLoader||(!u.some(S=>S.route.id===g.route.id)&&g.route.id in a&&((w=i[g.route.id])!=null&&w.shouldRevalidate)||v.hasClientLoader?y=!0:m.add(g.route.id))}),m.size===0)return[];let x=C3(t,o,"data");return y&&m.size>0&&x.searchParams.set("_routes",e.filter(g=>m.has(g.route.id)).map(g=>g.route.id).join(",")),[x.pathname+x.search]},[o,a,r,s,u,e,t,i]),h=b.useMemo(()=>D3(d,s),[d,s]),p=$3(d);return b.createElement(b.Fragment,null,f.map(m=>b.createElement("link",{key:m,rel:"prefetch",as:"fetch",href:m,...n})),h.map(m=>b.createElement("link",{key:m,rel:"modulepreload",href:m,...n})),p.map(({key:m,link:y})=>b.createElement("link",{key:m,nonce:n.nonce,...y})))}function F3(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var B3=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{B3&&(window.__reactRouterVersion="7.11.0")}catch{}function U3({basename:t,children:e,unstable_useTransitions:n,window:r}){let s=b.useRef();s.current==null&&(s.current=v4({window:r,v5Compat:!0}));let i=s.current,[o,a]=b.useState({action:i.action,location:i.location}),l=b.useCallback(u=>{n===!1?a(u):b.startTransition(()=>a(u))},[n]);return b.useLayoutEffect(()=>i.listen(l),[i,l]),b.createElement(g3,{basename:t,children:e,location:o.location,navigationType:o.action,navigator:i,unstable_useTransitions:n})}var Wj=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Kj=b.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:s,reloadDocument:i,replace:o,state:a,target:l,to:u,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:h,...p},m){let{basename:y,unstable_useTransitions:x}=b.useContext(ri),g=typeof u=="string"&&Wj.test(u),v=Mj(u,y);u=v.to;let w=t3(u,{relative:s}),[S,I,k]=P3(r,p),R=K3(u,{replace:o,state:a,target:l,preventScrollReset:d,relative:s,viewTransition:f,unstable_defaultShouldRevalidate:h,unstable_useTransitions:x});function C(_){e&&e(_),_.defaultPrevented||R(_)}let T=b.createElement("a",{...p,...k,href:v.absoluteURL||w,onClick:v.isExternal||i?e:C,ref:F3(m,I),target:l,"data-discover":!g&&n==="render"?"true":void 0});return S&&!g?b.createElement(b.Fragment,null,T,b.createElement(L3,{page:w})):T});Kj.displayName="Link";var H3=b.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:s=!1,style:i,to:o,viewTransition:a,children:l,...u},d){let f=Uf(o,{relative:u.relative}),h=Ja(),p=b.useContext(vg),{navigator:m,basename:y}=b.useContext(ri),x=p!=null&&X3(f)&&a===!0,g=m.encodeLocation?m.encodeLocation(f).pathname:f.pathname,v=h.pathname,w=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;n||(v=v.toLowerCase(),w=w?w.toLowerCase():null,g=g.toLowerCase()),w&&y&&(w=Ko(w,y)||w);const S=g!=="/"&&g.endsWith("/")?g.length-1:g.length;let I=v===g||!s&&v.startsWith(g)&&v.charAt(S)==="/",k=w!=null&&(w===g||!s&&w.startsWith(g)&&w.charAt(g.length)==="/"),R={isActive:I,isPending:k,isTransitioning:x},C=I?e:void 0,T;typeof r=="function"?T=r(R):T=[r,I?"active":null,k?"pending":null,x?"transitioning":null].filter(Boolean).join(" ");let _=typeof i=="function"?i(R):i;return b.createElement(Kj,{...u,"aria-current":C,className:T,ref:d,style:_,to:o,viewTransition:a},typeof l=="function"?l(R):l)});H3.displayName="NavLink";var V3=b.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:s,state:i,method:o=op,action:a,onSubmit:l,relative:u,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:h,...p},m)=>{let{unstable_useTransitions:y}=b.useContext(ri),x=J3(),g=Y3(a,{relative:u}),v=o.toLowerCase()==="get"?"get":"post",w=typeof a=="string"&&Wj.test(a),S=I=>{if(l&&l(I),I.defaultPrevented)return;I.preventDefault();let k=I.nativeEvent.submitter,R=(k==null?void 0:k.getAttribute("formmethod"))||o,C=()=>x(k||I.currentTarget,{fetcherKey:e,method:R,navigate:n,replace:s,state:i,relative:u,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:h});y&&n!==!1?b.startTransition(()=>C()):C()};return b.createElement("form",{ref:m,method:v,action:g,onSubmit:r?l:S,...p,"data-discover":!w&&t==="render"?"true":void 0})});V3.displayName="Form";function W3(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Gj(t){let e=b.useContext(Nu);return nr(e,W3(t)),e}function K3(t,{target:e,replace:n,state:r,preventScrollReset:s,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:a,unstable_useTransitions:l}={}){let u=zj(),d=Ja(),f=Uf(t,{relative:i});return b.useCallback(h=>{if(k3(h,e)){h.preventDefault();let p=n!==void 0?n:af(d)===af(f),m=()=>u(t,{replace:p,state:r,preventScrollReset:s,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:a});l?b.startTransition(()=>m()):m()}},[d,u,f,n,r,e,t,s,i,o,a,l])}var G3=0,q3=()=>`__${String(++G3)}__`;function J3(){let{router:t}=Gj("useSubmit"),{basename:e}=b.useContext(ri),n=f3(),r=t.fetch,s=t.navigate;return b.useCallback(async(i,o={})=>{let{action:a,method:l,encType:u,formData:d,body:f}=T3(i,e);if(o.navigate===!1){let h=o.fetcherKey||q3();await r(h,n,o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:d,body:f,formMethod:o.method||l,formEncType:o.encType||u,flushSync:o.flushSync})}else await s(o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:d,body:f,formMethod:o.method||l,formEncType:o.encType||u,replace:o.replace,state:o.state,fromRouteId:n,flushSync:o.flushSync,viewTransition:o.viewTransition})},[r,s,e,n])}function Y3(t,{relative:e}={}){let{basename:n}=b.useContext(ri),r=b.useContext(vo);nr(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...Uf(t||".",{relative:e})},o=Ja();if(t==null){i.search=o.search;let a=new URLSearchParams(i.search),l=a.getAll("index");if(l.some(d=>d==="")){a.delete("index"),l.filter(f=>f).forEach(f=>a.append("index",f));let d=a.toString();i.search=d?`?${d}`:""}}return(!t||t===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(i.pathname=i.pathname==="/"?n:zo([n,i.pathname])),af(i)}function X3(t,{relative:e}={}){let n=b.useContext(Oj);nr(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=Gj("useViewTransitionState"),s=Uf(t,{relative:e});if(!n.isTransitioning)return!1;let i=Ko(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=Ko(n.nextLocation.pathname,r)||n.nextLocation.pathname;return Yp(s.pathname,o)!=null||Yp(s.pathname,i)!=null}function Sg(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function Q3(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(d){try{u(r.next(d))}catch(f){o(f)}}function l(d){try{u(r.throw(d))}catch(f){o(f)}}function u(d){d.done?i(d.value):s(d.value).then(a,l)}u((r=r.apply(t,e||[])).next())})}const Z3=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class yw extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class eL extends yw{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class OS extends yw{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class PS extends yw{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var zx;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(zx||(zx={}));class tL{constructor(e,{headers:n={},customFetch:r,region:s=zx.Any}={}){this.url=e,this.headers=n,this.region=s,this.fetch=Z3(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return Q3(this,arguments,void 0,function*(n,r={}){var s;let i,o;try{const{headers:a,method:l,body:u,signal:d,timeout:f}=r;let h={},{region:p}=r;p||(p=this.region);const m=new URL(`${this.url}/${n}`);p&&p!=="any"&&(h["x-region"]=p,m.searchParams.set("forceFunctionRegion",p));let y;u&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",y=u):typeof u=="string"?(h["Content-Type"]="text/plain",y=u):typeof FormData<"u"&&u instanceof FormData?y=u:(h["Content-Type"]="application/json",y=JSON.stringify(u)):y=u;let x=d;f&&(o=new AbortController,i=setTimeout(()=>o.abort(),f),d?(x=o.signal,d.addEventListener("abort",()=>o.abort())):x=o.signal);const g=yield this.fetch(m.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),a),body:y,signal:x}).catch(I=>{throw new eL(I)}),v=g.headers.get("x-relay-error");if(v&&v==="true")throw new OS(g);if(!g.ok)throw new PS(g);let w=((s=g.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),S;return w==="application/json"?S=yield g.json():w==="application/octet-stream"||w==="application/pdf"?S=yield g.blob():w==="text/event-stream"?S=g:w==="multipart/form-data"?S=yield g.formData():S=yield g.text(),{data:S,error:null,response:g}}catch(a){return{data:null,error:a,response:a instanceof PS||a instanceof OS?a.context:void 0}}finally{i&&clearTimeout(i)}})}}var nL=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},rL=class{constructor(t){var e,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var n=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let o=null,a=null,l=null,u=i.status,d=i.statusText;if(i.ok){var f,h;if(n.method!=="HEAD"){var p;const g=await i.text();g===""||(n.headers.get("Accept")==="text/csv"||n.headers.get("Accept")&&(!((p=n.headers.get("Accept"))===null||p===void 0)&&p.includes("application/vnd.pgrst.plan+text"))?a=g:a=JSON.parse(g))}const y=(f=n.headers.get("Prefer"))===null||f===void 0?void 0:f.match(/count=(exact|planned|estimated)/),x=(h=i.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");y&&x&&x.length>1&&(l=parseInt(x[1])),n.isMaybeSingle&&n.method==="GET"&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,u=406,d="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var m;const y=await i.text();try{o=JSON.parse(y),Array.isArray(o)&&i.status===404&&(a=[],o=null,u=200,d="OK")}catch{i.status===404&&y===""?(u=204,d="No Content"):o={message:y}}if(o&&n.isMaybeSingle&&(!(o==null||(m=o.details)===null||m===void 0)&&m.includes("0 rows"))&&(o=null,u=200,d="OK"),o&&n.shouldThrowOnError)throw new nL(o)}return{error:o,data:a,count:l,status:u,statusText:d}});return this.shouldThrowOnError||(s=s.catch(i=>{var o;let a="";const l=i==null?void 0:i.cause;if(l){var u,d,f,h;const m=(u=l==null?void 0:l.message)!==null&&u!==void 0?u:"",y=(d=l==null?void 0:l.code)!==null&&d!==void 0?d:"";a=`${(f=i==null?void 0:i.name)!==null&&f!==void 0?f:"FetchError"}: ${i==null?void 0:i.message}`,a+=`

Caused by: ${(h=l==null?void 0:l.name)!==null&&h!==void 0?h:"Error"}: ${m}`,y&&(a+=` (${y})`),l!=null&&l.stack&&(a+=`
${l.stack}`)}else{var p;a=(p=i==null?void 0:i.stack)!==null&&p!==void 0?p:""}return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:a,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),s.then(t,e)}returns(){return this}overrideTypes(){return this}},sL=class extends rL{select(t){let e=!1;const n=(t??"*").split("").map(r=>/\s/.test(r)&&!e?"":(r==='"'&&(e=!e),r)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:n,foreignTable:r,referencedTable:s=r}={}){const i=s?`${s}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:n=e}={}){const r=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${t}`),this}range(t,e,{foreignTable:n,referencedTable:r=n}={}){const s=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${t}`),this.url.searchParams.set(i,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:n=!1,buffers:r=!1,wal:s=!1,format:i="text"}={}){var o;const a=[t?"analyze":null,e?"verbose":null,n?"settings":null,r?"buffers":null,s?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const LS=new RegExp("[,()]");var vc=class extends sL{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&LS.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}notIn(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&LS.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`not.in.(${n})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:n,type:r}={}){let s="";r==="plain"?s="pl":r==="phrase"?s="ph":r==="websearch"&&(s="w");const i=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${s}fts${i}.${e}`),this}match(t){return Object.entries(t).forEach(([e,n])=>{this.url.searchParams.append(e,`eq.${n}`)}),this}not(t,e,n){return this.url.searchParams.append(t,`not.${e}.${n}`),this}or(t,{foreignTable:e,referencedTable:n=e}={}){const r=n?`${n}.or`:"or";return this.url.searchParams.append(r,`(${t})`),this}filter(t,e,n){return this.url.searchParams.append(t,`${e}.${n}`),this}},iL=class{constructor(t,{headers:e={},schema:n,fetch:r}){this.url=t,this.headers=new Headers(e),this.schema=n,this.fetch=r}select(t,e){const{head:n=!1,count:r}=e??{},s=n?"HEAD":"GET";let i=!1;const o=(t??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),r&&this.headers.append("Prefer",`count=${r}`),new vc({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:n=!0}={}){var r;const s="POST";if(e&&this.headers.append("Prefer",`count=${e}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const i=t.reduce((o,a)=>o.concat(Object.keys(a)),[]);if(i.length>0){const o=[...new Set(i)].map(a=>`"${a}"`);this.url.searchParams.set("columns",o.join(","))}}return new vc({method:s,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:n=!1,count:r,defaultToNull:s=!0}={}){var i;const o="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),e!==void 0&&this.url.searchParams.set("on_conflict",e),r&&this.headers.append("Prefer",`count=${r}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const a=t.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(a.length>0){const l=[...new Set(a)].map(u=>`"${u}"`);this.url.searchParams.set("columns",l.join(","))}}return new vc({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(t,{count:e}={}){var n;const r="PATCH";return e&&this.headers.append("Prefer",`count=${e}`),new vc({method:r,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:t}={}){var e;const n="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new vc({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},oL=class qj{constructor(e,{headers:n={},schema:r,fetch:s}={}){this.url=e,this.headers=new Headers(n),this.schemaName=r,this.fetch=s}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new iL(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new qj(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,n={},{head:r=!1,get:s=!1,count:i}={}){var o;let a;const l=new URL(`${this.url}/rpc/${e}`);let u;r||s?(a=r?"HEAD":"GET",Object.entries(n).filter(([f,h])=>h!==void 0).map(([f,h])=>[f,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([f,h])=>{l.searchParams.append(f,h)})):(a="POST",u=n);const d=new Headers(this.headers);return i&&d.set("Prefer",`count=${i}`),new vc({method:a,url:l,headers:d,schema:this.schemaName,body:u,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};class aL{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const r=n.node,s=parseInt(r.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const r=this.getWebSocketConstructor();return new r(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const lL="2.89.0",cL=`realtime-js/${lL}`,Jj="1.0.0",uL="2.0.0",$S=Jj,Fx=1e4,dL=1e3,fL=100;var ua;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(ua||(ua={}));var jr;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(jr||(jr={}));var Ui;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Ui||(Ui={}));var Bx;(function(t){t.websocket="websocket"})(Bx||(Bx={}));var gl;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(gl||(gl={}));class hL{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,n){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,r;const s=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(e){var n,r;const s=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:{},o=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,n,r){var s,i;const o=e.topic,a=(s=e.ref)!==null&&s!==void 0?s:"",l=(i=e.join_ref)!==null&&i!==void 0?i:"",u=e.payload.event,d=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},f=Object.keys(d).length===0?"":JSON.stringify(d);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`userEvent length ${u.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`metadata length ${f.length} exceeds maximum of 255`);const h=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+u.length+f.length,p=new ArrayBuffer(this.HEADER_LENGTH+h);let m=new DataView(p),y=0;m.setUint8(y++,this.KINDS.userBroadcastPush),m.setUint8(y++,l.length),m.setUint8(y++,a.length),m.setUint8(y++,o.length),m.setUint8(y++,u.length),m.setUint8(y++,f.length),m.setUint8(y++,n),Array.from(l,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(a,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(o,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(u,g=>m.setUint8(y++,g.charCodeAt(0))),Array.from(f,g=>m.setUint8(y++,g.charCodeAt(0)));var x=new Uint8Array(p.byteLength+r.byteLength);return x.set(new Uint8Array(p),0),x.set(new Uint8Array(r),p.byteLength),x.buffer}decode(e,n){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return n(r)}if(typeof e=="string"){const r=JSON.parse(e),[s,i,o,a,l]=r;return n({join_ref:s,ref:i,topic:o,event:a,payload:l})}return n({})}_binaryDecode(e){const n=new DataView(e),r=n.getUint8(0),s=new TextDecoder;switch(r){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,n,s)}}_decodeUserBroadcast(e,n,r){const s=n.getUint8(1),i=n.getUint8(2),o=n.getUint8(3),a=n.getUint8(4);let l=this.HEADER_LENGTH+4;const u=r.decode(e.slice(l,l+s));l=l+s;const d=r.decode(e.slice(l,l+i));l=l+i;const f=r.decode(e.slice(l,l+o));l=l+o;const h=e.slice(l,e.byteLength),p=a===this.JSON_ENCODING?JSON.parse(r.decode(h)):h,m={type:this.BROADCAST_EVENT,event:d,payload:p};return o>0&&(m.meta=JSON.parse(f)),{join_ref:null,ref:null,topic:u,event:this.BROADCAST_EVENT,payload:m}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e==null?void 0:e.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}_pick(e,n){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([r])=>n.includes(r)))}}class Yj{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var $n;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})($n||($n={}));const zS=(t,e,n={})=>{var r;const s=(r=n.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=pL(o,t,e,s),i),{}):{}},pL=(t,e,n,r)=>{const s=e.find(a=>a.name===t),i=s==null?void 0:s.type,o=n[t];return i&&!r.includes(i)?Xj(i,o):Ux(o)},Xj=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return xL(e,n)}switch(t){case $n.bool:return mL(e);case $n.float4:case $n.float8:case $n.int2:case $n.int4:case $n.int8:case $n.numeric:case $n.oid:return gL(e);case $n.json:case $n.jsonb:return yL(e);case $n.timestamp:return bL(e);case $n.abstime:case $n.date:case $n.daterange:case $n.int4range:case $n.int8range:case $n.money:case $n.reltime:case $n.text:case $n.time:case $n.timestamptz:case $n.timetz:case $n.tsrange:case $n.tstzrange:return Ux(e);default:return Ux(e)}},Ux=t=>t,mL=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},gL=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},yL=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},xL=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let i;const o=t.slice(1,n);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>Xj(e,a))}return t},bL=t=>typeof t=="string"?t.replace(" ","T"):t,Qj=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class j0{constructor(e,n,r={},s=Fx){this.channel=e,this.event=n,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var FS;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(FS||(FS={}));class Sd{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Sd.syncState(this.state,s,i,o),this.pendingDiffs.forEach(l=>{this.state=Sd.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Sd.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,s){const i=this.cloneDeep(e),o=this.transformState(n),a={},l={};return this.map(i,(u,d)=>{o[u]||(l[u]=d)}),this.map(o,(u,d)=>{const f=i[u];if(f){const h=d.map(x=>x.presence_ref),p=f.map(x=>x.presence_ref),m=d.filter(x=>p.indexOf(x.presence_ref)<0),y=f.filter(x=>h.indexOf(x.presence_ref)<0);m.length>0&&(a[u]=m),y.length>0&&(l[u]=y)}else a[u]=d}),this.syncDiff(i,{joins:a,leaves:l},r,s)}static syncDiff(e,n,r,s){const{joins:i,leaves:o}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(a,l)=>{var u;const d=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(l),d.length>0){const f=e[a].map(p=>p.presence_ref),h=d.filter(p=>f.indexOf(p.presence_ref)<0);e[a].unshift(...h)}r(a,d,l)}),this.map(o,(a,l)=>{let u=e[a];if(!u)return;const d=l.map(f=>f.presence_ref);u=u.filter(f=>d.indexOf(f.presence_ref)<0),e[a]=u,s(a,u,l),u.length===0&&delete e[a]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const s=e[r];return"metas"in s?n[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):n[r]=s,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var BS;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(BS||(BS={}));var _d;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(_d||(_d={}));var Do;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Do||(Do={}));class zc{constructor(e,n={config:{}},r){var s,i;if(this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=jr.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new j0(this,Ui.join,this.params,this.timeout),this.rejoinTimer=new Yj(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=jr.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=jr.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=jr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=jr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=jr.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ui.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new Sd(this),this.broadcastEndpointURL=Qj(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var r,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==jr.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,u=(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(p=>p.filter))!==null&&s!==void 0?s:[],d=!!this.bindings[_d.PRESENCE]&&this.bindings[_d.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,f={},h={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:d}),postgres_changes:u,private:l};this.socket.accessTokenValue&&(f.access_token=this.socket.accessTokenValue),this._onError(p=>e==null?void 0:e(Do.CHANNEL_ERROR,p)),this._onClose(()=>e==null?void 0:e(Do.CLOSED)),this.updateJoinPayload(Object.assign({config:h},f)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:p})=>{var m;if(this.socket._isManualToken()||this.socket.setAuth(),p===void 0){e==null||e(Do.SUBSCRIBED);return}else{const y=this.bindings.postgres_changes,x=(m=y==null?void 0:y.length)!==null&&m!==void 0?m:0,g=[];for(let v=0;v<x;v++){const w=y[v],{filter:{event:S,schema:I,table:k,filter:R}}=w,C=p&&p[v];if(C&&C.event===S&&zc.isFilterValueEqual(C.schema,I)&&zc.isFilterValueEqual(C.table,k)&&zc.isFilterValueEqual(C.filter,R))g.push(Object.assign(Object.assign({},w),{id:C.id}));else{this.unsubscribe(),this.state=jr.errored,e==null||e(Do.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(Do.SUBSCRIBED);return}}).receive("error",p=>{this.state=jr.errored,e==null||e(Do.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Do.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this.state===jr.joined&&e===_d.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,n,r)}async httpSend(e,n,r={}){var s;if(n==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(s=r.timeout)!==null&&s!==void 0?s:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const u=await a.json();l=u.error||u.message||l}catch{}return Promise.reject(new Error(l))}async send(e,n={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=u.body)===null||s===void 0?void 0:s.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const u=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=jr.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ui.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new j0(this,Ui.leave,{},e),r.receive("ok",()=>{n(),s("ok")}).receive("timeout",()=>{n(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=jr.closed,this.bindings={}}async _fetchWithTimeout(e,n,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:s.signal}));return clearTimeout(i),o}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new j0(this,e,n,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>fL){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:u,join:d}=Ui;if(r&&[a,l,u,d].indexOf(o)>=0&&r!==this._joinRef())return;let h=this._onMessage(o,n,r);if(n&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(p=>{var m,y,x;return((m=p.filter)===null||m===void 0?void 0:m.event)==="*"||((x=(y=p.filter)===null||y===void 0?void 0:y.event)===null||x===void 0?void 0:x.toLocaleLowerCase())===o}).map(p=>p.callback(h,r)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var m,y,x,g,v,w;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const S=p.id,I=(m=p.filter)===null||m===void 0?void 0:m.event;return S&&((y=n.ids)===null||y===void 0?void 0:y.includes(S))&&(I==="*"||(I==null?void 0:I.toLocaleLowerCase())===((x=n.data)===null||x===void 0?void 0:x.type.toLocaleLowerCase()))}else{const S=(v=(g=p==null?void 0:p.filter)===null||g===void 0?void 0:g.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return S==="*"||S===((w=n==null?void 0:n.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof h=="object"&&"ids"in h){const m=h.data,{schema:y,table:x,commit_timestamp:g,type:v,errors:w}=m;h=Object.assign(Object.assign({},{schema:y,table:x,commit_timestamp:g,eventType:v,new:{},old:{},errors:w}),this._getPayloadRecords(m))}p.callback(h,r)})}_isClosed(){return this.state===jr.closed}_isJoined(){return this.state===jr.joined}_isJoining(){return this.state===jr.joining}_isLeaving(){return this.state===jr.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const s=e.toLocaleLowerCase(),i={type:s,filter:n,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&zc.isEqual(s.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}static isFilterValueEqual(e,n){return(e??void 0)===(n??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ui.close,{},e)}_onError(e){this._on(Ui.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=jr.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=zS(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=zS(e.columns,e.old_record)),n}}const I0=()=>{},kh={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},wL=[1e3,2e3,5e3,1e4],vL=1e4,kL=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class SL{constructor(e,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Fx,this.transport=null,this.heartbeatIntervalMs=kh.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=I0,this.ref=0,this.reconnectTimer=null,this.vsn=$S,this.logger=I0,this.conn=null,this.sendBuffer=[],this.serializer=new hL,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>s?(...i)=>s(...i):(...i)=>fetch(...i),!(!((r=n==null?void 0:n.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${Bx.websocket}`,this.httpEndpoint=Qj(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=aL.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case ua.connecting:return gl.Connecting;case ua.open:return gl.Open;case ua.closing:return gl.Closing;default:return gl.Closed}}isConnected(){return this.connectionState()===gl.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===r);if(s)return s;{const i=new zc(`realtime:${e}`,n,this);return this.channels.push(i),i}}push(e){const{topic:n,event:r,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${n} ${r} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(dL,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},kh.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:s,payload:i,ref:o}=n,a=o?`(${o})`:"",l=i.status||"";this.log("receive",`${l} ${r} ${s} ${a}`.trim(),i),this.channels.filter(u=>u._isMember(r)).forEach(u=>u._trigger(s,i,o)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===ua.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===ua.open||this.conn.readyState===ua.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this._terminateWorker()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ui.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(n);return`${e}${r}${s}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([kL],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n,r=!1;if(e)n=e,r=!0;else if(this.accessToken)try{n=await this.accessToken()}catch(s){this.log("error","Error fetching access token from callback",s),n=this.accessTokenValue}else n=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(s=>{const i={access_token:n,version:cL};n&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(Ui.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(n=>{this.log("error",`Error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(n)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new Yj(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},kh.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,r,s,i,o,a,l,u,d,f,h,p;switch(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:Fx,this.heartbeatIntervalMs=(s=e==null?void 0:e.heartbeatIntervalMs)!==null&&s!==void 0?s:kh.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e==null?void 0:e.heartbeatCallback)!==null&&a!==void 0?a:I0,this.vsn=(l=e==null?void 0:e.vsn)!==null&&l!==void 0?l:$S,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(u=e==null?void 0:e.reconnectAfterMs)!==null&&u!==void 0?u:m=>wL[m-1]||vL,this.vsn){case Jj:this.encode=(d=e==null?void 0:e.encode)!==null&&d!==void 0?d:(m,y)=>y(JSON.stringify(m)),this.decode=(f=e==null?void 0:e.decode)!==null&&f!==void 0?f:(m,y)=>y(JSON.parse(m));break;case uL:this.encode=(h=e==null?void 0:e.encode)!==null&&h!==void 0?h:this.serializer.encode.bind(this.serializer),this.decode=(p=e==null?void 0:e.decode)!==null&&p!==void 0?p:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var lf=class extends Error{constructor(t,e){var n;super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((n=e.icebergType)==null?void 0:n.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function _L(t,e,n){const r=new URL(e,t);if(n)for(const[s,i]of Object.entries(n))i!==void 0&&r.searchParams.set(s,i);return r.toString()}async function TL(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function CL(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:n,path:r,query:s,body:i,headers:o}){const a=_L(t.baseUrl,r,s),l=await TL(t.auth),u=await e(a,{method:n,headers:{...i?{"Content-Type":"application/json"}:{},...l,...o},body:i?JSON.stringify(i):void 0}),d=await u.text(),f=(u.headers.get("content-type")||"").includes("application/json"),h=f&&d?JSON.parse(d):d;if(!u.ok){const p=f?h:void 0,m=p==null?void 0:p.error;throw new lf((m==null?void 0:m.message)??`Request failed with status ${u.status}`,{status:u.status,icebergType:m==null?void 0:m.type,icebergCode:m==null?void 0:m.code,details:p})}return{status:u.status,headers:u.headers,data:h}}}}function Sh(t){return t.join("")}var EL=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:Sh(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(r=>({namespace:r}))}async createNamespace(t,e){const n={namespace:t.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Sh(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Sh(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Sh(t.namespace)}`}),!0}catch(e){if(e instanceof lf&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(n){if(n instanceof lf&&n.status===409)return;throw n}}};function cc(t){return t.join("")}var NL=class{constructor(t,e="",n){this.client=t,this.prefix=e,this.accessDelegation=n}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${cc(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const n={};return this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${cc(t.namespace)}/tables`,body:e,headers:n})).data.metadata}async updateTable(t,e){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${cc(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${cc(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${cc(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${cc(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(n){if(n instanceof lf&&n.status===404)return!1;throw n}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(n){if(n instanceof lf&&n.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw n}}},jL=class{constructor(t){var r;let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const n=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=CL({baseUrl:n,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(r=t.accessDelegation)==null?void 0:r.join(","),this.namespaceOps=new EL(this.client,e),this.tableOps=new NL(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},_g=class extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}};function ir(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var IL=class extends _g{constructor(t,e,n){super(t),this.name="StorageApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Hx=class extends _g{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}};const xw=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),DL=()=>Response,Vx=t=>{if(Array.isArray(t))return t.map(n=>Vx(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const s=n.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=Vx(r)}),e},AL=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},ML=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function cf(t){"@babel/helpers - typeof";return cf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cf(t)}function RL(t,e){if(cf(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(cf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function OL(t){var e=RL(t,"string");return cf(e)=="symbol"?e:e+""}function PL(t,e,n){return(e=OL(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function US(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Yt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?US(Object(n),!0).forEach(function(r){PL(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):US(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const D0=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},LL=async(t,e,n)=>{t instanceof await DL()&&!(n!=null&&n.noResolveJson)?t.json().then(r=>{const s=t.status||500,i=(r==null?void 0:r.statusCode)||s+"";e(new IL(D0(r),s,i))}).catch(r=>{e(new Hx(D0(r),r))}):e(new Hx(D0(t),t))},$L=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?s:(AL(r)?(s.headers=Yt({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,e!=null&&e.duplex&&(s.duplex=e.duplex),Yt(Yt({},s),n))};async function Hf(t,e,n,r,s,i){return new Promise((o,a)=>{t(n,$L(e,r,s,i)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>LL(l,a,r))})}async function uf(t,e,n,r){return Hf(t,"GET",e,n,r)}async function Fi(t,e,n,r,s){return Hf(t,"POST",e,r,s,n)}async function Wx(t,e,n,r,s){return Hf(t,"PUT",e,r,s,n)}async function zL(t,e,n,r){return Hf(t,"HEAD",e,Yt(Yt({},n),{},{noResolveJson:!0}),r)}async function bw(t,e,n,r,s){return Hf(t,"DELETE",e,r,s,n)}var FL=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(ir(e))return{data:null,error:e};throw e}}};let Zj;Zj=Symbol.toStringTag;var BL=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[Zj]="BlobDownloadBuilder",this.promise=null}asStream(){return new FL(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(ir(e))return{data:null,error:e};throw e}}};const UL={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},HS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var HL=class{constructor(t,e={},n,r){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.bucketId=n,this.fetch=xw(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(t,e,n,r){var s=this;try{let i;const o=Yt(Yt({},HS),r);let a=Yt(Yt({},s.headers),t==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",s.encodeMetadata(l)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),l&&!i.has("metadata")&&i.append("metadata",s.encodeMetadata(l))):(i=n,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=s.toBase64(s.encodeMetadata(l))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),r!=null&&r.headers&&(a=Yt(Yt({},a),r.headers));const u=s._removeEmptyFolders(e),d=s._getFinalPath(u),f=await(t=="PUT"?Wx:Fi)(s.fetch,`${s.url}/object/${d}`,i,Yt({headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:u,id:f.Id,fullPath:f.Key},error:null}}catch(i){if(s.shouldThrowOnError)throw i;if(ir(i))return{data:null,error:i};throw i}}async upload(t,e,n){return this.uploadOrUpdate("POST",t,e,n)}async uploadToSignedUrl(t,e,n,r){var s=this;const i=s._removeEmptyFolders(t),o=s._getFinalPath(i),a=new URL(s.url+`/object/upload/sign/${o}`);a.searchParams.set("token",e);try{let l;const u=Yt({upsert:HS.upsert},r),d=Yt(Yt({},s.headers),{"x-upsert":String(u.upsert)});return typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",u.cacheControl)):(l=n,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType),{data:{path:i,fullPath:(await Wx(s.fetch,a.toString(),l,{headers:d})).Key},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(ir(l))return{data:null,error:l};throw l}}async createSignedUploadUrl(t,e){var n=this;try{let r=n._getFinalPath(t);const s=Yt({},n.headers);e!=null&&e.upsert&&(s["x-upsert"]="true");const i=await Fi(n.fetch,`${n.url}/object/upload/sign/${r}`,{},{headers:s}),o=new URL(n.url+i.url),a=o.searchParams.get("token");if(!a)throw new _g("No token returned by API");return{data:{signedUrl:o.toString(),path:t,token:a},error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(ir(r))return{data:null,error:r};throw r}}async update(t,e,n){return this.uploadOrUpdate("PUT",t,e,n)}async move(t,e,n){var r=this;try{return{data:await Fi(r.fetch,`${r.url}/object/move`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers}),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(ir(s))return{data:null,error:s};throw s}}async copy(t,e,n){var r=this;try{return{data:{path:(await Fi(r.fetch,`${r.url}/object/copy`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers})).Key},error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(ir(s))return{data:null,error:s};throw s}}async createSignedUrl(t,e,n){var r=this;try{let s=r._getFinalPath(t),i=await Fi(r.fetch,`${r.url}/object/sign/${s}`,Yt({expiresIn:e},n!=null&&n.transform?{transform:n.transform}:{}),{headers:r.headers});const o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${r.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(ir(s))return{data:null,error:s};throw s}}async createSignedUrls(t,e,n){var r=this;try{const s=await Fi(r.fetch,`${r.url}/object/sign/${r.bucketId}`,{expiresIn:e,paths:t},{headers:r.headers}),i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(o=>Yt(Yt({},o),{},{signedUrl:o.signedURL?encodeURI(`${r.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(ir(s))return{data:null,error:s};throw s}}download(t,e){const n=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",r=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),s=r?`?${r}`:"",i=this._getFinalPath(t),o=()=>uf(this.fetch,`${this.url}/${n}/${i}${s}`,{headers:this.headers,noResolveJson:!0});return new BL(o,this.shouldThrowOnError)}async info(t){var e=this;const n=e._getFinalPath(t);try{return{data:Vx(await uf(e.fetch,`${e.url}/object/info/${n}`,{headers:e.headers})),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(ir(r))return{data:null,error:r};throw r}}async exists(t){var e=this;const n=e._getFinalPath(t);try{return await zL(e.fetch,`${e.url}/object/${n}`,{headers:e.headers}),{data:!0,error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(ir(r)&&r instanceof Hx){const s=r.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:r}}throw r}}getPublicUrl(t,e){const n=this._getFinalPath(t),r=[],s=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";s!==""&&r.push(s);const i=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",o=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});o!==""&&r.push(o);let a=r.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${n}${a}`)}}}async remove(t){var e=this;try{return{data:await bw(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ir(n))return{data:null,error:n};throw n}}async list(t,e,n){var r=this;try{const s=Yt(Yt(Yt({},UL),e),{},{prefix:t||""});return{data:await Fi(r.fetch,`${r.url}/object/list/${r.bucketId}`,s,{headers:r.headers},n),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(ir(s))return{data:null,error:s};throw s}}async listV2(t,e){var n=this;try{const r=Yt({},t);return{data:await Fi(n.fetch,`${n.url}/object/list-v2/${n.bucketId}`,r,{headers:n.headers},e),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(ir(r))return{data:null,error:r};throw r}}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const eI="2.89.0",tI={"X-Client-Info":`storage-js/${eI}`};var VL=class{constructor(t,e={},n,r){this.shouldThrowOnError=!1;const s=new URL(t);r!=null&&r.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href.replace(/\/$/,""),this.headers=Yt(Yt({},tI),e),this.fetch=xw(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(t){var e=this;try{const n=e.listBucketOptionsToQueryString(t);return{data:await uf(e.fetch,`${e.url}/bucket${n}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ir(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await uf(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ir(n))return{data:null,error:n};throw n}}async createBucket(t,e={public:!1}){var n=this;try{return{data:await Fi(n.fetch,`${n.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(ir(r))return{data:null,error:r};throw r}}async updateBucket(t,e){var n=this;try{return{data:await Wx(n.fetch,`${n.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(ir(r))return{data:null,error:r};throw r}}async emptyBucket(t){var e=this;try{return{data:await Fi(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ir(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await bw(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ir(n))return{data:null,error:n};throw n}}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},WL=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Yt(Yt({},tI),e),this.fetch=xw(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await Fi(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ir(n))return{data:null,error:n};throw n}}async listBuckets(t){var e=this;try{const n=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&n.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&n.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&n.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&n.set("sortOrder",t.sortOrder),t!=null&&t.search&&n.set("search",t.search);const r=n.toString(),s=r?`${e.url}/bucket?${r}`:`${e.url}/bucket`;return{data:await uf(e.fetch,s,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ir(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await bw(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ir(n))return{data:null,error:n};throw n}}from(t){var e=this;if(!ML(t))throw new _g("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new jL({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(n,{get(s,i){const o=s[i];return typeof o!="function"?o:async(...a)=>{try{return{data:await o.apply(s,a),error:null}}catch(l){if(r)throw l;return{data:null,error:l}}}}})}};const ww={"X-Client-Info":`storage-js/${eI}`,"Content-Type":"application/json"};var nI=class extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Gs(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}var A0=class extends nI{constructor(t,e,n){super(t),this.name="StorageVectorsApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},KL=class extends nI{constructor(t,e){super(t),this.name="StorageVectorsUnknownError",this.originalError=e}};const vw=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),GL=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},VS=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),qL=async(t,e,n)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const r=t.status||500,s=t;if(typeof s.json=="function")s.json().then(i=>{const o=(i==null?void 0:i.statusCode)||(i==null?void 0:i.code)||r+"";e(new A0(VS(i),r,o))}).catch(()=>{const i=r+"";e(new A0(s.statusText||`HTTP ${r} error`,r,i))});else{const i=r+"";e(new A0(s.statusText||`HTTP ${r} error`,r,i))}}else e(new KL(VS(t),t))},JL=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?s:(GL(r)?(s.headers=Yt({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,Yt(Yt({},s),n))};async function YL(t,e,n,r,s,i){return new Promise((o,a)=>{t(n,JL(e,r,s,i)).then(l=>{if(!l.ok)throw l;if(r!=null&&r.noResolveJson)return l;const u=l.headers.get("content-type");return!u||!u.includes("application/json")?{}:l.json()}).then(l=>o(l)).catch(l=>qL(l,a,r))})}async function qs(t,e,n,r,s){return YL(t,"POST",e,r,s,n)}var XL=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Yt(Yt({},ww),e),this.fetch=vw(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(t){var e=this;try{return{data:await qs(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async getIndex(t,e){var n=this;try{return{data:await qs(n.fetch,`${n.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(Gs(r))return{data:null,error:r};throw r}}async listIndexes(t){var e=this;try{return{data:await qs(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async deleteIndex(t,e){var n=this;try{return{data:await qs(n.fetch,`${n.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers})||{},error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(Gs(r))return{data:null,error:r};throw r}}},QL=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Yt(Yt({},ww),e),this.fetch=vw(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(t){var e=this;try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await qs(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async getVectors(t){var e=this;try{return{data:await qs(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async listVectors(t){var e=this;try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:await qs(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async queryVectors(t){var e=this;try{return{data:await qs(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async deleteVectors(t){var e=this;try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await qs(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}},ZL=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Yt(Yt({},ww),e),this.fetch=vw(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await qs(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await qs(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async listBuckets(t={}){var e=this;try{return{data:await qs(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await qs(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Gs(n))return{data:null,error:n};throw n}}},e$=class extends ZL{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new t$(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,n=this;return e().call(n,t)}async getBucket(t){var e=()=>super.getBucket,n=this;return e().call(n,t)}async listBuckets(t={}){var e=()=>super.listBuckets,n=this;return e().call(n,t)}async deleteBucket(t){var e=()=>super.deleteBucket,n=this;return e().call(n,t)}},t$=class extends XL{constructor(t,e,n,r){super(t,e,r),this.vectorBucketName=n}async createIndex(t){var e=()=>super.createIndex,n=this;return e().call(n,Yt(Yt({},t),{},{vectorBucketName:n.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,n=this;return e().call(n,Yt(Yt({},t),{},{vectorBucketName:n.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,n=this;return e().call(n,n.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,n=this;return e().call(n,n.vectorBucketName,t)}index(t){return new n$(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},n$=class extends QL{constructor(t,e,n,r,s){super(t,e,s),this.vectorBucketName=n,this.indexName=r}async putVectors(t){var e=()=>super.putVectors,n=this;return e().call(n,Yt(Yt({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async getVectors(t){var e=()=>super.getVectors,n=this;return e().call(n,Yt(Yt({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,n=this;return e().call(n,Yt(Yt({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,n=this;return e().call(n,Yt(Yt({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,n=this;return e().call(n,Yt(Yt({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}},r$=class extends VL{constructor(t,e={},n,r){super(t,e,n,r)}from(t){return new HL(this.url,this.headers,t,this.fetch)}get vectors(){return new e$(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new WL(this.url+"/iceberg",this.headers,this.fetch)}};const rI="2.89.0",kc=30*1e3,Kx=3,M0=Kx*kc,s$="http://localhost:9999",i$="supabase.auth.token",o$={"X-Client-Info":`gotrue-js/${rI}`},Gx="X-Supabase-Api-Version",sI={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},a$=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,l$=10*60*1e3;class df extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function Vt(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class c$ extends df{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function u$(t){return Vt(t)&&t.name==="AuthApiError"}class yl extends df{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class Xo extends df{constructor(e,n,r,s){super(e,r,s),this.name=n,this.status=r}}class Vs extends Xo{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function d$(t){return Vt(t)&&t.name==="AuthSessionMissingError"}class uc extends Xo{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class _h extends Xo{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Th extends Xo{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function f$(t){return Vt(t)&&t.name==="AuthImplicitGrantRedirectError"}class WS extends Xo{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class h$ extends Xo{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class qx extends Xo{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function R0(t){return Vt(t)&&t.name==="AuthRetryableFetchError"}class KS extends Xo{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class Jx extends Xo{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Xp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),GS=` 	
\r=`.split(""),p$=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<GS.length;e+=1)t[GS[e].charCodeAt(0)]=-2;for(let e=0;e<Xp.length;e+=1)t[Xp[e].charCodeAt(0)]=e;return t})();function qS(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(Xp[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(Xp[r]),e.queuedBits-=6}}function iI(t,e,n){const r=p$[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function JS(t){const e=[],n=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{y$(o,r,n)};for(let o=0;o<t.length;o+=1)iI(t.charCodeAt(o),s,i);return e.join("")}function m$(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function g$(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|s)+65536,n+=1}m$(r,e)}}function y$(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if(!(t>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function tu(t){const e=[],n={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<t.length;s+=1)iI(t.charCodeAt(s),n,r);return new Uint8Array(e)}function x$(t){const e=[];return g$(t,n=>e.push(n)),new Uint8Array(e)}function Tl(t){const e=[],n={queue:0,queuedBits:0},r=s=>{e.push(s)};return t.forEach(s=>qS(s,n,r)),qS(null,n,r),e.join("")}function b$(t){return Math.round(Date.now()/1e3)+t}function w$(){return Symbol("auth-callback")}const Gr=()=>typeof window<"u"&&typeof document<"u",ol={tested:!1,writable:!1},oI=()=>{if(!Gr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ol.tested)return ol.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),ol.tested=!0,ol.writable=!0}catch{ol.tested=!0,ol.writable=!1}return ol.writable};function v$(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return n.searchParams.forEach((r,s)=>{e[s]=r}),e}const aI=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),k$=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Sc=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},al=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Kr=async(t,e)=>{await t.removeItem(e)};class Tg{constructor(){this.promise=new Tg.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}Tg.promiseConstructor=Promise;function O0(t){const e=t.split(".");if(e.length!==3)throw new Jx("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!a$.test(e[r]))throw new Jx("JWT not in base64url format");return{header:JSON.parse(JS(e[0])),payload:JSON.parse(JS(e[1])),signature:tu(e[2]),raw:{header:e[0],payload:e[1]}}}async function S$(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function _$(t,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await t(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function T$(t){return("0"+t.toString(16)).substr(-2)}function C$(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let s="";for(let i=0;i<56;i++)s+=n.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,T$).join("")}async function E$(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function N$(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await E$(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function dc(t,e,n=!1){const r=C$();let s=r;n&&(s+="/PASSWORD_RECOVERY"),await Sc(t,`${e}-code-verifier`,s);const i=await N$(r);return[i,r===i?"plain":"s256"]}const j$=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function I$(t){const e=t.headers.get(Gx);if(!e||!e.match(j$))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function D$(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function A$(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const M$=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function fc(t){if(!M$.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function P0(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function R$(t,e){return new Proxy(t,{get:(n,r,s)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,s)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,r,s)}})}function YS(t){return JSON.parse(JSON.stringify(t))}const fl=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),O$=[502,503,504];async function XS(t){var e;if(!k$(t))throw new qx(fl(t),0);if(O$.includes(t.status))throw new qx(fl(t),t.status);let n;try{n=await t.json()}catch(i){throw new yl(fl(i),i)}let r;const s=I$(t);if(s&&s.getTime()>=sI["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new KS(fl(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Vs}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new KS(fl(n),t.status,n.weak_password.reasons);throw new c$(fl(n),t.status||500,r)}const P$=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),n))};async function Jt(t,e,n,r){var s;const i=Object.assign({},r==null?void 0:r.headers);i[Gx]||(i[Gx]=sI["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await L$(t,e,n+a,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function L$(t,e,n,r,s,i){const o=P$(e,r,s,i);let a;try{a=await t(n,Object.assign({},o))}catch(l){throw console.error(l),new qx(fl(l),0)}if(a.ok||await XS(a),r!=null&&r.noResolveJson)return a;try{return await a.json()}catch(l){await XS(l)}}function Pi(t){var e;let n=null;F$(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=b$(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function QS(t){const e=Pi(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function ya(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function $$(t){return{data:t,error:null}}function z$(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i}=t,o=Sg(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function ZS(t){return t}function F$(t){return t.access_token&&t.refresh_token&&t.expires_in}const L0=["global","local","others"];class B${constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=aI(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=L0[0]){if(L0.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${L0.join(", ")}`);try{return await Jt(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Vt(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await Jt(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:ya})}catch(r){if(Vt(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=Sg(e,["options"]),s=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await Jt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:z$,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(Vt(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await Jt(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ya})}catch(n){if(Vt(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,s,i,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},d=await Jt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:ZS});if(d.error)throw d.error;const f=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),x=JSON.parse(m.split(";")[1].split("=")[1]);u[`${x}Page`]=y}),u.total=parseInt(h)),{data:Object.assign(Object.assign({},f),u),error:null}}catch(u){if(Vt(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){fc(e);try{return await Jt(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ya})}catch(n){if(Vt(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){fc(e);try{return await Jt(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:ya})}catch(r){if(Vt(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){fc(e);try{return await Jt(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:ya})}catch(r){if(Vt(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){fc(e.userId);try{const{data:n,error:r}=await Jt(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:n,error:r}}catch(n){if(Vt(n))return{data:null,error:n};throw n}}async _deleteFactor(e){fc(e.userId),fc(e.id);try{return{data:await Jt(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Vt(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,r,s,i,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},d=await Jt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:ZS});if(d.error)throw d.error;const f=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),x=JSON.parse(m.split(";")[1].split("=")[1]);u[`${x}Page`]=y}),u.total=parseInt(h)),{data:Object.assign(Object.assign({},f),u),error:null}}catch(u){if(Vt(u))return{data:{clients:[]},error:u};throw u}}async _createOAuthClient(e){try{return await Jt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Vt(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await Jt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Vt(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await Jt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Vt(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await Jt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Vt(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await Jt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Vt(n))return{data:null,error:n};throw n}}}function e2(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const hc={debug:!!(globalThis&&oI()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class lI extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class U$ extends lI{}async function H$(t,e,n){hc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),hc.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){hc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,s.name);try{return await n()}finally{hc.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,s.name)}}else{if(e===0)throw hc.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new U$(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(hc.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function V$(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function cI(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function W$(t){return parseInt(t,16)}function K$(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function G$(t){var e;const{chainId:n,domain:r,expirationTime:s,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:l,resources:u,scheme:d,uri:f,version:h}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!f)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const p=cI(t.address),m=d?`${d}://${r}`:r,y=t.statement?`${t.statement}
`:"",x=`${m} wants you to sign in with your Ethereum account:
${p}

${y}`;let g=`URI: ${f}
Version: ${h}
Chain ID: ${n}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(s&&(g+=`
Expiration Time: ${s.toISOString()}`),a&&(g+=`
Not Before: ${a.toISOString()}`),l&&(g+=`
Request ID: ${l}`),u){let v=`
Resources:`;for(const w of u){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);v+=`
- ${w}`}g+=v}return`${x}
${g}`}class vr extends Error{constructor({message:e,code:n,cause:r,name:s}){var i;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(i=s??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=n}}class Qp extends vr{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function q$({error:t,options:e}){var n,r,s;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new vr({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new vr({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new vr({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new vr({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new vr({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new vr({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new vr({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new vr({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const o=window.location.hostname;if(uI(o)){if(i.rp.id!==o)return new vr({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new vr({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new vr({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new vr({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new vr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function J$({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new vr({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new vr({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(uI(r)){if(n.rpId!==r)return new vr({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new vr({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new vr({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new vr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class Y${createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const X$=new Y$;function Q$(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:r}=t,s=Sg(t,["challenge","user","excludeCredentials"]),i=tu(e).buffer,o=Object.assign(Object.assign({},n),{id:tu(n.id).buffer}),a=Object.assign(Object.assign({},s),{challenge:i,user:o});if(r&&r.length>0){a.excludeCredentials=new Array(r.length);for(let l=0;l<r.length;l++){const u=r[l];a.excludeCredentials[l]=Object.assign(Object.assign({},u),{id:tu(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return a}function Z$(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,r=Sg(t,["challenge","allowCredentials"]),s=tu(e).buffer,i=Object.assign(Object.assign({},r),{challenge:s});if(n&&n.length>0){i.allowCredentials=new Array(n.length);for(let o=0;o<n.length;o++){const a=n[o];i.allowCredentials[o]=Object.assign(Object.assign({},a),{id:tu(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return i}function ez(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:Tl(new Uint8Array(t.response.attestationObject)),clientDataJSON:Tl(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function tz(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,r=t.getClientExtensionResults(),s=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Tl(new Uint8Array(s.authenticatorData)),clientDataJSON:Tl(new Uint8Array(s.clientDataJSON)),signature:Tl(new Uint8Array(s.signature)),userHandle:s.userHandle?Tl(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function uI(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function t2(){var t,e;return!!(Gr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function nz(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Qp("Browser returned unexpected credential type",e)}:{data:null,error:new Qp("Empty credential response",e)}}catch(e){return{data:null,error:q$({error:e,options:t})}}}async function rz(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Qp("Browser returned unexpected credential type",e)}:{data:null,error:new Qp("Empty credential response",e)}}catch(e){return{data:null,error:J$({error:e,options:t})}}}const sz={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},iz={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Zp(...t){const e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),n=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),r={};for(const s of t)if(s)for(const i in s){const o=s[i];if(o!==void 0)if(Array.isArray(o))r[i]=o;else if(n(o))r[i]=o;else if(e(o)){const a=r[i];e(a)?r[i]=Zp(a,o):r[i]=Zp(o)}else r[i]=o}return r}function oz(t,e){return Zp(sz,t,e||{})}function az(t,e){return Zp(iz,t,e||{})}class lz{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:r,signal:s},i){try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!o)return{data:null,error:a};const l=s??X$.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:u}=o.webauthn.credential_options.publicKey;u.name||(u.name=`${u.id}:${r}`),u.displayName||(u.displayName=u.name)}switch(o.webauthn.type){case"create":{const u=oz(o.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:d,error:f}=await nz({publicKey:u,signal:l});return d?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:f}}case"request":{const u=az(o.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:d,error:f}=await rz(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:u,signal:l}));return d?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:f}}}}catch(o){return Vt(o)?{data:null,error:o}:{data:null,error:new yl("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!n)return{data:null,error:new df("rpId is required for WebAuthn authentication")};try{if(!t2())return{data:null,error:new yl("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:r},signal:s},{request:i});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:n,rpOrigins:r,credential_response:l.credential_response}})}catch(o){return Vt(o)?{data:null,error:o}:{data:null,error:new yl("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!n)return{data:null,error:new df("rpId is required for WebAuthn registration")};try{if(!t2())return{data:null,error:new yl("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(d=>{var f;return(f=d.data)===null||f===void 0?void 0:f.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===e&&h.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d==null?void 0:d.id}):void 0),{data:null,error:a};const{data:l,error:u}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:s},{create:i});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:n,rpOrigins:r,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:u}}catch(o){return Vt(o)?{data:null,error:o}:{data:null,error:new yl("Unexpected error in register",o)}}}}V$();const cz={url:s$,storageKey:i$,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:o$,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function n2(t,e,n){return await n()}const pc={};class ff{get jwks(){var e,n;return(n=(e=pc[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){pc[this.storageKey]=Object.assign(Object.assign({},pc[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=pc[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){pc[this.storageKey]=Object.assign(Object.assign({},pc[this.storageKey]),{cachedAt:e})}constructor(e){var n,r,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},cz),e);if(this.storageKey=i.storageKey,this.instanceID=(n=ff.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,ff.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&Gr()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new B$({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=aI(i.fetch),this.lock=i.lock||n2,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:this.persistSession&&Gr()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=H$:this.lock=n2,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new lz(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:oI()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=e2(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=e2(this.memoryStorage)),Gr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${rI}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},r="none";if(Gr()&&(n=v$(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),Gr()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:i}=await this._getSessionFromURL(n,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),f$(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Vt(n)?this._returnResult({error:n}):this._returnResult({error:new yl("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,s;try{const i=await Jt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:Pi}),{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(i){if(Vt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var n,r,s;try{let i;if("email"in e){const{email:d,password:f,options:h}=e;let p=null,m=null;this.flowType==="pkce"&&([p,m]=await dc(this.storage,this.storageKey)),i=await Jt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:d,password:f,data:(n=h==null?void 0:h.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:p,code_challenge_method:m},xform:Pi})}else if("phone"in e){const{phone:d,password:f,options:h}=e;i=await Jt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:f,data:(r=h==null?void 0:h.data)!==null&&r!==void 0?r:{},channel:(s=h==null?void 0:h.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:Pi})}else throw new _h("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return await Kr(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(i){if(await Kr(this.storage,`${this.storageKey}-code-verifier`),Vt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let n;if("email"in e){const{email:i,password:o,options:a}=e;n=await Jt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:QS})}else if("phone"in e){const{phone:i,password:o,options:a}=e;n=await Jt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:QS})}else throw new _h("You must provide either an email or phone number and a password");const{data:r,error:s}=n;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!r||!r.session||!r.user){const i=new uc;return this._returnResult({data:{user:null,session:null},error:i})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(n){if(Vt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,r,s,i,o,a,l,u,d,f,h;let p,m;if("message"in e)p=e.message,m=e.signature;else{const{chain:y,wallet:x,statement:g,options:v}=e;let w;if(Gr())if(typeof x=="object")w=x;else{const T=window;if("ethereum"in T&&typeof T.ethereum=="object"&&"request"in T.ethereum&&typeof T.ethereum.request=="function")w=T.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof x!="object"||!(v!=null&&v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=x}const S=new URL((n=v==null?void 0:v.url)!==null&&n!==void 0?n:window.location.href),I=await w.request({method:"eth_requestAccounts"}).then(T=>T).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!I||I.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const k=cI(I[0]);let R=(r=v==null?void 0:v.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!R){const T=await w.request({method:"eth_chainId"});R=W$(T)}const C={domain:S.host,address:k,statement:g,uri:S.href,version:"1",chainId:R,nonce:(s=v==null?void 0:v.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(o=(i=v==null?void 0:v.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=v==null?void 0:v.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=v==null?void 0:v.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(u=v==null?void 0:v.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(d=v==null?void 0:v.signInWithEthereum)===null||d===void 0?void 0:d.resources};p=G$(C),m=await w.request({method:"personal_sign",params:[K$(p),k]})}try{const{data:y,error:x}=await Jt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:m},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:Pi});if(x)throw x;if(!y||!y.session||!y.user){const g=new uc;return this._returnResult({data:{user:null,session:null},error:g})}return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),this._returnResult({data:Object.assign({},y),error:x})}catch(y){if(Vt(y))return this._returnResult({data:{user:null,session:null},error:y});throw y}}async signInWithSolana(e){var n,r,s,i,o,a,l,u,d,f,h,p;let m,y;if("message"in e)m=e.message,y=e.signature;else{const{chain:x,wallet:g,statement:v,options:w}=e;let S;if(Gr())if(typeof g=="object")S=g;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))S=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof g!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");S=g}const I=new URL((n=w==null?void 0:w.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in S&&S.signIn){const k=await S.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:I.host,uri:I.href}),v?{statement:v}:null));let R;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")R=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)R=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in R&&"signature"in R&&(typeof R.signedMessage=="string"||R.signedMessage instanceof Uint8Array)&&R.signature instanceof Uint8Array)m=typeof R.signedMessage=="string"?R.signedMessage:new TextDecoder().decode(R.signedMessage),y=R.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in S)||typeof S.signMessage!="function"||!("publicKey"in S)||typeof S!="object"||!S.publicKey||!("toBase58"in S.publicKey)||typeof S.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${I.host} wants you to sign in with your Solana account:`,S.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${I.href}`,`Issued At: ${(s=(r=w==null?void 0:w.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=w==null?void 0:w.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((a=w==null?void 0:w.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((u=w==null?void 0:w.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((f=(d=w==null?void 0:w.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||f===void 0)&&f.length?["Resources",...w.signInWithSolana.resources.map(R=>`- ${R}`)]:[]].join(`
`);const k=await S.signMessage(new TextEncoder().encode(m),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=k}}try{const{data:x,error:g}=await Jt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:Tl(y)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Pi});if(g)throw g;if(!x||!x.session||!x.user){const v=new uc;return this._returnResult({data:{user:null,session:null},error:v})}return x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("SIGNED_IN",x.session)),this._returnResult({data:Object.assign({},x),error:g})}catch(x){if(Vt(x))return this._returnResult({data:{user:null,session:null},error:x});throw x}}async _exchangeCodeForSession(e){const n=await al(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(n??"").split("/");try{if(!r&&this.flowType==="pkce")throw new h$;const{data:i,error:o}=await Jt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Pi});if(await Kr(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const a=new uc;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(await Kr(this.storage,`${this.storageKey}-code-verifier`),Vt(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:n,provider:r,token:s,access_token:i,nonce:o}=e,a=await Jt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:Pi}),{data:l,error:u}=a;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!l||!l.session||!l.user){const d=new uc;return this._returnResult({data:{user:null,session:null},error:d})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:u})}catch(n){if(Vt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,r,s,i,o;try{if("email"in e){const{email:a,options:l}=e;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await dc(this.storage,this.storageKey));const{error:f}=await Jt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:f})}if("phone"in e){const{phone:a,options:l}=e,{data:u,error:d}=await Jt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:d})}throw new _h("You must provide either an email or phone number.")}catch(a){if(await Kr(this.storage,`${this.storageKey}-code-verifier`),Vt(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var n,r;try{let s,i;"options"in e&&(s=(n=e.options)===null||n===void 0?void 0:n.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await Jt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Pi});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,u=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(s){if(Vt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(e){var n,r,s,i,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await dc(this.storage,this.storageKey));const u=await Jt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:$$});return!((i=u.data)===null||i===void 0)&&i.url&&Gr()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(u.data.url),this._returnResult(u)}catch(a){if(await Kr(this.storage,`${this.storageKey}-code-verifier`),Vt(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Vs;const{error:s}=await Jt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(Vt(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:o}=await Jt(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:o,error:a}=await Jt(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a})}throw new _h("You must provide either an email or phone number and a type")}catch(n){if(Vt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await al(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<M0:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const o=await al(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=P0()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=R$(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const n=await this._acquireLock(-1,async()=>await this._getUser());return n.data.user&&(this.suppressGetSessionWarning=!0),n}async _getUser(e){try{return e?await Jt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ya}):await this._useSession(async n=>{var r,s,i;const{data:o,error:a}=n;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Vs}:await Jt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:ya})})}catch(n){if(Vt(n))return d$(n)&&(await this._removeSession(),await Kr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new Vs;const o=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await dc(this.storage,this.storageKey));const{data:u,error:d}=await Jt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:ya});if(d)throw d;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(r){if(await Kr(this.storage,`${this.storageKey}-code-verifier`),Vt(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Vs;const n=Date.now()/1e3;let r=n,s=!0,i=null;const{payload:o}=O0(e.access_token);if(o.exp&&(r=o.exp,s=r<=n),s){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(n){if(Vt(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:o,error:a}=n;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Vs;const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(Vt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!Gr())throw new Th("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Th(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new WS("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Th("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new WS("No code detected.");const{data:v,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const S=new URL(window.location.href);return S.searchParams.delete("code"),window.history.replaceState(window.history.state,"",S.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:u}=e;if(!i||!a||!o||!u)throw new Th("No session defined in URL");const d=Math.round(Date.now()/1e3),f=parseInt(a);let h=d+f;l&&(h=parseInt(l));const p=h-d;p*1e3<=kc&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${f}s`);const m=h-f;d-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,h,d):d-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,h,d);const{data:y,error:x}=await this._getUser(i);if(x)throw x;const g={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:f,expires_at:h,refresh_token:o,token_type:u,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:g,redirectType:e.type},error:null})}catch(r){if(Vt(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await al(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({error:i});const o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(u$(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await Kr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=w$(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,s;try{const{data:{session:i},error:o}=n;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,n={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await dc(this.storage,this.storageKey,!0));try{return await Jt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(i){if(await Kr(this.storage,`${this.storageKey}-code-verifier`),Vt(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:r,error:s}=await this._useSession(async i=>{var o,a,l,u,d;const{data:f,error:h}=i;if(h)throw h;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await Jt(this.fetch,"GET",p,{headers:this.headers,jwt:(d=(u=f.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(s)throw s;return Gr()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(Vt(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var r;try{const{error:s,data:{session:i}}=n;if(s)throw s;const{options:o,provider:a,token:l,access_token:u,nonce:d}=e,f=await Jt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=i==null?void 0:i.access_token)!==null&&r!==void 0?r:void 0,body:{provider:a,id_token:l,access_token:u,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Pi}),{data:h,error:p}=f;return p?this._returnResult({data:{user:null,session:null},error:p}):!h||!h.session||!h.user?this._returnResult({data:{user:null,session:null},error:new uc}):(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:p}))}catch(s){if(await Kr(this.storage,`${this.storageKey}-code-verifier`),Vt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,s;const{data:i,error:o}=n;if(o)throw o;return await Jt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await _$(async s=>(s>0&&await S$(200*Math.pow(2,s-1)),this._debug(n,"refreshing attempt",s),await Jt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Pi})),(s,i)=>{const o=200*Math.pow(2,s);return i&&R0(i)&&Date.now()+o-r<kc})}catch(r){if(this._debug(n,"error",r),Vt(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),Gr()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const s=await al(this.storage,this.storageKey);if(s&&this.userStorage){let o=await al(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:s.user},await Sc(this.userStorage,this.storageKey+"-user",o)),s.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:P0()}else if(s&&!s.user&&!s.user){const o=await al(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(s.user=o.user,await Kr(this.storage,this.storageKey+"-user"),await Sc(this.storage,this.storageKey,s)):s.user=P0()}if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),s!==null&&await this._removeSession();return}const i=((n=s.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<M0;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${M0}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:o}=await this._callRefreshToken(s.refresh_token);o&&(console.error(o),R0(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(s.access_token);!a&&(o!=null&&o.user)?(s.user=o.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(r,"error",s),console.error(s);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Vs;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Tg;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Vs;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={data:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),Vt(i)){const o={data:null,error:i};return R0(i)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,n,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,n)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Kr(this.storage,`${this.storageKey}-code-verifier`);const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await Sc(this.userStorage,this.storageKey+"-user",{user:n.user});const s=Object.assign({},n);delete s.user;const i=YS(s);await Sc(this.storage,this.storageKey,i)}else{const s=YS(n);await Sc(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Kr(this.storage,this.storageKey),await Kr(this.storage,this.storageKey+"-code-verifier"),await Kr(this.storage,this.storageKey+"-user"),this.userStorage&&await Kr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Gr()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),kc);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/kc);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${kc}ms, refresh threshold is ${Kx} ticks`),s<=Kx&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof lI)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Gr()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const s=[`provider=${encodeURIComponent(n)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await dc(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;return i?this._returnResult({data:null,error:i}):await Jt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,s;const{data:i,error:o}=n;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:u}=await Jt(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return u?this._returnResult({data:null,error:u}):(e.factorType==="totp"&&l.type==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?ez(e.webauthn.credential_response):tz(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await Jt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({data:null,error:i});const o=await Jt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Q$(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Z$(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const s={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])s.all.push(i),i.status==="verified"&&s[i.factor_type].push(i);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var e,n;const{data:{session:r},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=O0(r.access_token);let o=null;i.aal&&(o=i.aal);let a=o;((n=(e=r.user.factors)===null||e===void 0?void 0:e.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(a="aal2");const u=i.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:u},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;return s?this._returnResult({data:null,error:s}):r?await Jt(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Vs})})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:s},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Vs});const o=await Jt(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&Gr()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Vt(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:s},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Vs});const o=await Jt(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&Gr()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Vt(r))return this._returnResult({data:null,error:r});throw r}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;return r?this._returnResult({data:null,error:r}):n?await Jt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new Vs})})}catch(e){if(Vt(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;return s?this._returnResult({data:null,error:s}):r?(await Jt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Vs})})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(a=>a.kid===e);if(r)return r;const s=Date.now();if(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+l$>s)return r;const{data:i,error:o}=await Jt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,r=i.keys.find(a=>a.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:p,error:m}=await this.getSession();if(m||!p.session)return this._returnResult({data:null,error:m});r=p.session.access_token}const{header:s,payload:i,signature:o,raw:{header:a,payload:l}}=O0(r);n!=null&&n.allowExpired||D$(i.exp);const u=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!u){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:i,header:s,signature:o},error:null}}const d=A$(s.alg),f=await crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!await crypto.subtle.verify(d,f,o,x$(`${a}.${l}`)))throw new Jx("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(r){if(Vt(r))return this._returnResult({data:null,error:r});throw r}}}ff.nextInstanceID={};const uz=ff,dz="2.89.0";let ad="";typeof Deno<"u"?ad="deno":typeof document<"u"?ad="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ad="react-native":ad="node";const fz={"X-Client-Info":`supabase-js-${ad}/${dz}`},hz={headers:fz},pz={schema:"public"},mz={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},gz={};function hf(t){"@babel/helpers - typeof";return hf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hf(t)}function yz(t,e){if(hf(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(hf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function xz(t){var e=yz(t,"string");return hf(e)=="symbol"?e:e+""}function bz(t,e,n){return(e=xz(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function dr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?r2(Object(n),!0).forEach(function(r){bz(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r2(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const wz=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),vz=()=>Headers,kz=(t,e,n)=>{const r=wz(n),s=vz();return async(i,o)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:t;let u=new s(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",t),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),r(i,dr(dr({},o),{},{headers:u}))}};function Sz(t){return t.endsWith("/")?t:t+"/"}function _z(t,e){var n,r;const{db:s,auth:i,realtime:o,global:a}=t,{db:l,auth:u,realtime:d,global:f}=e,h={db:dr(dr({},l),s),auth:dr(dr({},u),i),realtime:dr(dr({},d),o),storage:{},global:dr(dr(dr({},f),a),{},{headers:dr(dr({},(n=f==null?void 0:f.headers)!==null&&n!==void 0?n:{}),(r=a==null?void 0:a.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return t.accessToken?h.accessToken=t.accessToken:delete h.accessToken,h}function Tz(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Sz(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var Cz=class extends uz{constructor(t){super(t)}},Ez=class{constructor(t,e,n){var r,s;this.supabaseUrl=t,this.supabaseKey=e;const i=Tz(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,a={db:pz,realtime:gz,auth:dr(dr({},mz),{},{storageKey:o}),global:hz},l=_z(n??{},a);if(this.storageKey=(r=l.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(s=l.global.headers)!==null&&s!==void 0?s:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(d,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}});else{var u;this.auth=this._initSupabaseAuthClient((u=l.auth)!==null&&u!==void 0?u:{},this.headers,l.global.fetch)}this.fetch=kz(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(dr({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(d=>this.realtime.setAuth(d)).catch(d=>console.warn("Failed to set initial Realtime auth token:",d)),this.rest=new oL(new URL("rest/v1",i).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new r$(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new tL(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,n)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,n;if(t.accessToken)return await t.accessToken();const{data:r}=await t.auth.getSession();return(e=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:s,storageKey:i,flowType:o,lock:a,debug:l,throwOnError:u},d,f){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Cz({url:this.authUrl.href,headers:dr(dr({},h),d),storageKey:i,autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:s,flowType:o,lock:a,debug:l,throwOnError:u,fetch:f,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new SL(this.realtimeUrl.href,dr(dr({},t),{},{params:dr(dr({},{apikey:this.supabaseKey}),t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(t,e,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const Nz=(t,e,n)=>new Ez(t,e,n);function jz(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}jz()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const dI="https://acrkclmderqewcwugsnl.supabase.co",lp="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFjcmtjbG1kZXJxZXdjd3Vnc25sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNTc0MzAsImV4cCI6MjA4MTgzMzQzMH0.UT2vJTXpPO5tR9sUD8YU0gJ_47Zpe3yJiLzllUljPDw";console.log("Supabase Config:",{url:dI,keyLength:lp==null?void 0:lp.length});let fI=null;try{fI=Nz(dI,lp)}catch(t){console.error("Error creating Supabase client:",t)}const Ne=fI,Iz=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),Dz=(t,e)=>{const n=new Date,r=t.toLowerCase().trim();if(/^\d+$/.test(r)){const i=parseInt(r,10);let o=n.getMonth(),a=n.getFullYear();i<n.getDate()&&(o++,o>11&&(o=0,a++));const l=new Date(a,o,i);if(l.getMonth()===o)return l}if(["","today","td"].includes(r))return n;if(["","tmr","tm"].includes(r))return new Date(n.setDate(n.getDate()+1));if([""].includes(r))return new Date(n.setDate(n.getDate()+2));const s=r.match(/^\+(\d+)$/);return s?new Date(n.setDate(n.getDate()+parseInt(s[1]))):null},Az=(t,e="zh")=>t?new Date(t).toLocaleDateString(e==="zh"?"zh-TW":"en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",hI=(t,e=!0,n="zh")=>{if(!t)return"";const r=new Date(t),s=new Date;s.setHours(0,0,0,0);const i=new Date(r.getTime());i.setHours(0,0,0,0);const o=Math.floor((i.getTime()-s.getTime())/(1e3*60*60*24));let a="";if(o===0?a=n==="zh"?"":"Today":o===1?a=n==="zh"?"":"Tomorrow":o===-1?a=n==="zh"?"":"Yesterday":o<0?a=n==="zh"?`${Math.abs(o)} `:`${Math.abs(o)}d ago`:a=n==="zh"?`${r.getMonth()+1}${r.getDate()}`:r.toLocaleDateString("en-US",{month:"short",day:"numeric"}),e){const l=r.getHours(),u=r.getMinutes();(l!==0||u!==0)&&(a+=` ${String(l).padStart(2,"0")}:${String(u).padStart(2,"0")}`)}return a},yi=(t,e)=>t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate(),kw=t=>t?yi(new Date(t),new Date):!1,Yx=t=>t?new Date(t).getTime()<new Date().setHours(0,0,0,0):!1,Sw=(t,e,n)=>{if(!t)return!1;const r=n.filter(s=>s.parent_id===t);for(const s of r)if(s.id===e||Sw(s.id,e,n))return!0;return!1},Mz=t=>{if(!t)return[];const e=/data-type="mention"[^>]*data-id="([^"]+)"/g,n=[];let r;for(;(r=e.exec(t))!==null;)n.push(r[1]);return n},Rz=(t,e)=>{var r;return(r=t.tags)!=null&&r.some(s=>e.includes(s))?!0:Mz(t.description).some(s=>e.includes(s))},cp=(t,e)=>{let n=t,r=t.parent_id;const s=new Set([t.id]);for(;r&&!s.has(r);){s.add(r);const i=e.find(o=>o.id===r);if(i)n=i,r=i.parent_id;else break}return n},Oz=(t,e)=>{const n=new Date(t),r=new Date(n);switch(e.type){case"daily":r.setDate(r.getDate()+e.interval);break;case"weekly":if(e.weekdays&&e.weekdays.length>0){let s=!1;for(let i=1;i<=7*e.interval;i++){const o=new Date(n);if(o.setDate(o.getDate()+i),e.weekdays.includes(o.getDay())){r.setTime(o.getTime()),s=!0;break}}s||r.setDate(r.getDate()+7*e.interval)}else r.setDate(r.getDate()+7*e.interval);break;case"monthly":if(r.setMonth(r.getMonth()+e.interval),e.monthDay){const s=Math.min(e.monthDay,s2(r));r.setDate(s)}break;case"yearly":if(r.setFullYear(r.getFullYear()+e.interval),e.yearMonth!==void 0&&e.yearDay!==void 0){r.setMonth(e.yearMonth-1);const s=Math.min(e.yearDay,s2(r));r.setDate(s)}break}if(e.endDate){const s=new Date(e.endDate);if(r>s)return null}return r.toISOString()},s2=t=>new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),Pz=(t,e="zh")=>{if(t.originalText)return t.originalText;const n=t.interval;let r="";if(e==="zh")switch(t.type){case"daily":r=n===1?"":`${n}`;break;case"weekly":r=n===1?"":`${n}`;break;case"monthly":t.monthDay?r=n===1?`${t.monthDay}`:`${n}${t.monthDay}`:r=n===1?"":`${n}`;break;case"yearly":t.yearMonth&&t.yearDay?r=`${t.yearMonth}${t.yearDay}`:r=n===1?"":`${n}`;break}else switch(t.type){case"daily":r=n===1?"Every day":`Every ${n} days`;break;case"weekly":r=n===1?"Every week":`Every ${n} weeks`;break;case"monthly":t.monthDay?r=n===1?`Monthly on day ${t.monthDay}`:`Every ${n} months on day ${t.monthDay}`:r=n===1?"Every month":`Every ${n} months`;break;case"yearly":r=n===1?"Every year":`Every ${n} years`;break}if(t.endDate){const s=new Date(t.endDate).toLocaleDateString(e==="zh"?"zh-TW":"en-US");r+=e==="zh"?` (${s})`:` (until ${s})`}return r},pI=()=>new Promise((t,e)=>{var r;if((r=window.google)!=null&&r.accounts){t();return}document.querySelector('script[src="https://accounts.google.com/gsi/client"]');const n=document.createElement("script");n.src="https://accounts.google.com/gsi/client",n.async=!0,n.defer=!0,n.onload=()=>t(),n.onerror=e,document.body.appendChild(n)}),xl=async t=>{const e=await fetch("https://www.googleapis.com/calendar/v3/users/me/calendarList",{headers:{Authorization:`Bearer ${t}`}});if(!e.ok)throw new Error("Failed to fetch calendar list");return(await e.json()).items||[]},mI=async(t,e,n,r)=>{var u;const s=new Date(n).toISOString(),i=new Date(r),o=new URLSearchParams({timeMin:s,timeMax:i.toISOString(),singleEvents:"true",orderBy:"startTime",maxResults:"2500"}),a=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events?${o}`,{headers:{Authorization:`Bearer ${t}`}}),l=await a.json();if(!a.ok)throw new Error(((u=l.error)==null?void 0:u.message)||"Failed to fetch calendar events");return l.items||[]},Xx=async(t,e,n,r)=>{var o,a;let i=0;for(;i<3;){i++;const l=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events/${encodeURIComponent(n)}`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(l.ok)return;if(l.status===403||l.status===429){const f=(((o=(await l.clone().json().catch(()=>({}))).error)==null?void 0:o.message)||"").toLowerCase();if((f.includes("rate limit")||f.includes("quota")||l.status===429)&&i<3){const h=i*1500;console.warn(`[Google Sync] Rate Limit Hit. Retrying update in ${h}ms... (Attempt ${i}/3)`),await new Promise(p=>setTimeout(p,h));continue}}const u=await l.json();throw new Error(((a=u.error)==null?void 0:a.message)||"Failed to update Google event")}},ia=async(t,e,n)=>{var s;const r=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events/${encodeURIComponent(n)}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!r.ok){const i=await r.json();throw new Error(((s=i.error)==null?void 0:s.message)||"Failed to delete Google event")}},No=async(t,e,n)=>{var i;const r=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){const o=await r.json();throw new Error(((i=o.error)==null?void 0:i.message)||"Failed to create Google event")}return(await r.json()).id},gI=async(t,e,n)=>{let r={singleEvents:"true",maxResults:"2500"};const s=new Date,i=new Date;if(i.setFullYear(s.getFullYear()+2),n)r.syncToken=n;else{const u=new Date;u.setMonth(u.getMonth()-1),r.timeMin=u.toISOString(),r.timeMax=i.toISOString()}let o=[],a,l;try{do{const u=new URLSearchParams({...r,...l?{pageToken:l}:{}}),d=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(e)}/events?${u}`,{headers:{Authorization:`Bearer ${t}`}});if(d.status===410)return{events:[],fullSyncRequired:!0};if(!d.ok)throw new Error("Sync Request Failed");const f=await d.json();if(f.items){const h=i.getTime(),p=f.items.filter(m=>m.recurringEventId?!1:m.start&&(m.start.dateTime||m.start.date)?new Date(m.start.dateTime||m.start.date).getTime()<h:!0);o.push(...p)}l=f.nextPageToken,a=f.nextSyncToken}while(l);return{events:o,nextSyncToken:a}}catch(u){throw console.error(u),u}},Lz=Object.freeze(Object.defineProperty({__proto__:null,createGoogleEvent:No,deleteGoogleEvent:ia,fetchCalendarList:xl,fetchGoogleEvents:mI,fetchUpdatedGoogleEvents:gI,loadGoogleScript:pI,updateGoogleEvent:Xx},Symbol.toStringTag,{value:"Module"})),$z="v1.6.0",up=28,yI=new Image;yI.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";const Kn={slate:{color:"#64748b",bg:"bg-slate-50",text:"text-slate-600",accent:"text-slate-600",badge:"bg-slate-100 text-slate-600 border-slate-200",border:"border-slate-500",ring:"focus-within:ring-slate-200",buttonRing:"focus:ring-slate-200 focus:border-slate-300",dot:"bg-slate-400",breadcrumb:"bg-slate-50 text-slate-600 hover:bg-slate-100",indicator:"bg-slate-500",ringColor:"ring-slate-400"},gray:{color:"#6b7280",bg:"bg-gray-50",text:"text-gray-600",accent:"text-gray-600",badge:"bg-gray-100 text-gray-600 border-gray-200",border:"border-gray-300",ring:"focus-within:ring-gray-200",buttonRing:"focus:ring-gray-200 focus:border-gray-300",dot:"bg-gray-400",breadcrumb:"bg-gray-50 text-gray-600 hover:bg-gray-100",indicator:"bg-gray-500",ringColor:"ring-gray-400"},zinc:{color:"#71717a",bg:"bg-zinc-50",text:"text-zinc-600",accent:"text-zinc-600",badge:"bg-zinc-100 text-zinc-600 border-zinc-200",border:"border-zinc-500",ring:"focus-within:ring-zinc-200",buttonRing:"focus:ring-zinc-200 focus:border-zinc-300",dot:"bg-zinc-400",breadcrumb:"bg-zinc-50 text-zinc-600 hover:bg-zinc-100",indicator:"bg-zinc-500",ringColor:"ring-zinc-400"},neutral:{color:"#737373",bg:"bg-neutral-50",text:"text-neutral-600",accent:"text-neutral-600",badge:"bg-neutral-100 text-neutral-600 border-neutral-200",border:"border-neutral-500",ring:"focus-within:ring-neutral-200",buttonRing:"focus:ring-neutral-200 focus:border-neutral-300",dot:"bg-neutral-400",breadcrumb:"bg-neutral-50 text-neutral-600 hover:bg-neutral-100",indicator:"bg-neutral-500",ringColor:"ring-neutral-400"},stone:{color:"#78716c",bg:"bg-stone-50",text:"text-stone-600",accent:"text-stone-600",badge:"bg-stone-100 text-stone-600 border-stone-200",border:"border-stone-500",ring:"focus-within:ring-stone-200",buttonRing:"focus:ring-stone-200 focus:border-stone-300",dot:"bg-stone-400",breadcrumb:"bg-stone-50 text-stone-600 hover:bg-stone-100",indicator:"bg-stone-500",ringColor:"ring-stone-400"},red:{color:"#ef4444",bg:"bg-red-50",text:"text-red-600",accent:"text-red-600",badge:"bg-red-100 text-red-600 border-red-200",border:"border-red-500",ring:"focus-within:ring-red-200",buttonRing:"focus:ring-red-200 focus:border-red-300",dot:"bg-red-400",breadcrumb:"bg-red-50 text-red-600 hover:bg-red-100",indicator:"bg-red-500",ringColor:"ring-red-400"},orange:{color:"#f97316",bg:"bg-orange-50",text:"text-orange-600",accent:"text-orange-600",badge:"bg-orange-100 text-orange-600 border-orange-200",border:"border-orange-500",ring:"focus-within:ring-orange-200",buttonRing:"focus:ring-orange-200 focus:border-orange-300",dot:"bg-orange-400",breadcrumb:"bg-orange-50 text-orange-600 hover:bg-orange-100",indicator:"bg-orange-500",ringColor:"ring-orange-400"},amber:{color:"#f59e0b",bg:"bg-amber-50",text:"text-amber-600",accent:"text-amber-600",badge:"bg-amber-100 text-amber-600 border-amber-200",border:"border-amber-500",ring:"focus-within:ring-amber-200",buttonRing:"focus:ring-amber-200 focus:border-amber-300",dot:"bg-amber-400",breadcrumb:"bg-amber-50 text-amber-600 hover:bg-amber-100",indicator:"bg-amber-500",ringColor:"ring-amber-400"},yellow:{color:"#eab308",bg:"bg-yellow-50",text:"text-yellow-600",accent:"text-yellow-600",badge:"bg-yellow-100 text-yellow-600 border-yellow-200",border:"border-yellow-500",ring:"focus-within:ring-yellow-200",buttonRing:"focus:ring-yellow-200 focus:border-yellow-300",dot:"bg-yellow-400",breadcrumb:"bg-yellow-50 text-yellow-600 hover:bg-yellow-100",indicator:"bg-yellow-500",ringColor:"ring-yellow-400"},lime:{color:"#84cc16",bg:"bg-lime-50",text:"text-lime-600",accent:"text-lime-600",badge:"bg-lime-100 text-lime-600 border-lime-200",border:"border-lime-500",ring:"focus-within:ring-lime-200",buttonRing:"focus:ring-lime-200 focus:border-lime-300",dot:"bg-lime-400",breadcrumb:"bg-lime-50 text-lime-600 hover:bg-lime-100",indicator:"bg-lime-500",ringColor:"ring-lime-400"},green:{color:"#10b981",bg:"bg-green-50",text:"text-green-600",accent:"text-green-600",badge:"bg-green-100 text-green-600 border-green-200",border:"border-green-500",ring:"focus-within:ring-green-200",buttonRing:"focus:ring-green-200 focus:border-green-300",dot:"bg-green-400",breadcrumb:"bg-green-50 text-green-600 hover:bg-green-100",indicator:"bg-green-500",ringColor:"ring-green-400"},emerald:{color:"#10b981",bg:"bg-emerald-50",text:"text-emerald-600",accent:"text-emerald-600",badge:"bg-emerald-100 text-emerald-600 border-emerald-200",border:"border-emerald-500",ring:"focus-within:ring-emerald-200",buttonRing:"focus:ring-emerald-200 focus:border-emerald-300",dot:"bg-emerald-400",breadcrumb:"bg-emerald-50 text-emerald-600 hover:bg-emerald-100",indicator:"bg-emerald-500",ringColor:"ring-emerald-400"},teal:{color:"#14b8a6",bg:"bg-teal-50",text:"text-teal-600",accent:"text-teal-600",badge:"bg-teal-100 text-teal-600 border-teal-200",border:"border-teal-500",ring:"focus-within:ring-teal-200",buttonRing:"focus:ring-teal-200 focus:border-teal-300",dot:"bg-teal-400",breadcrumb:"bg-teal-50 text-teal-600 hover:bg-teal-100",indicator:"bg-teal-500",ringColor:"ring-teal-400"},cyan:{color:"#06b6d4",bg:"bg-cyan-50",text:"text-cyan-600",accent:"text-cyan-600",badge:"bg-cyan-100 text-cyan-600 border-cyan-200",border:"border-cyan-500",ring:"focus-within:ring-cyan-200",buttonRing:"focus:ring-cyan-200 focus:border-cyan-300",dot:"bg-cyan-400",breadcrumb:"bg-cyan-50 text-cyan-600 hover:bg-cyan-100",indicator:"bg-cyan-500",ringColor:"ring-cyan-400"},sky:{color:"#0ea5e9",bg:"bg-sky-50",text:"text-sky-600",accent:"text-sky-600",badge:"bg-sky-100 text-sky-600 border-sky-200",border:"border-sky-500",ring:"focus-within:ring-sky-200",buttonRing:"focus:ring-sky-200 focus:border-sky-300",dot:"bg-sky-400",breadcrumb:"bg-sky-50 text-sky-600 hover:bg-sky-100",indicator:"bg-sky-500",ringColor:"ring-sky-400"},blue:{color:"#3b82f6",bg:"bg-blue-50",text:"text-blue-600",accent:"text-blue-600",badge:"bg-blue-100 text-blue-600 border-blue-200",border:"border-blue-500",ring:"focus-within:ring-blue-200",buttonRing:"focus:ring-blue-200 focus:border-blue-300",dot:"bg-blue-400",breadcrumb:"bg-blue-50 text-blue-600 hover:bg-blue-100",indicator:"bg-blue-500",ringColor:"ring-blue-400"},indigo:{color:"#6366f1",bg:"bg-indigo-50",text:"text-indigo-600",accent:"text-indigo-600",badge:"bg-indigo-100 text-indigo-600 border-indigo-200",border:"border-indigo-500",ring:"focus-within:ring-indigo-200",buttonRing:"focus:ring-indigo-200 focus:border-indigo-300",dot:"bg-indigo-400",breadcrumb:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100",indicator:"bg-indigo-500",ringColor:"ring-indigo-400"},violet:{color:"#8b5cf6",bg:"bg-violet-50",text:"text-violet-600",accent:"text-violet-600",badge:"bg-violet-100 text-violet-600 border-violet-200",border:"border-violet-500",ring:"focus-within:ring-violet-200",buttonRing:"focus:ring-violet-200 focus:border-violet-300",dot:"bg-violet-400",breadcrumb:"bg-violet-50 text-violet-600 hover:bg-violet-100",indicator:"bg-violet-500",ringColor:"ring-violet-400"},purple:{color:"#a855f7",bg:"bg-purple-50",text:"text-purple-600",accent:"text-purple-600",badge:"bg-purple-100 text-purple-600 border-purple-200",border:"border-purple-500",ring:"focus-within:ring-purple-200",buttonRing:"focus:ring-purple-200 focus:border-purple-300",dot:"bg-purple-400",breadcrumb:"bg-purple-50 text-purple-600 hover:bg-purple-100",indicator:"bg-purple-500",ringColor:"ring-purple-400"},fuchsia:{color:"#d946ef",bg:"bg-fuchsia-50",text:"text-fuchsia-600",accent:"text-fuchsia-600",badge:"bg-fuchsia-100 text-fuchsia-600 border-fuchsia-200",border:"border-fuchsia-500",ring:"focus-within:ring-fuchsia-200",buttonRing:"focus:ring-fuchsia-200 focus:border-fuchsia-300",dot:"bg-fuchsia-400",breadcrumb:"bg-fuchsia-50 text-fuchsia-600 hover:bg-fuchsia-100",indicator:"bg-fuchsia-500",ringColor:"ring-fuchsia-400"},pink:{color:"#ec4899",bg:"bg-pink-50",text:"text-pink-600",accent:"text-pink-600",badge:"bg-pink-100 text-pink-600 border-pink-200",border:"border-pink-500",ring:"focus-within:ring-pink-200",buttonRing:"focus:ring-pink-200 focus:border-pink-300",dot:"bg-pink-400",breadcrumb:"bg-pink-50 text-pink-600 hover:bg-pink-100",indicator:"bg-pink-500",ringColor:"ring-pink-400"},rose:{color:"#f43f5e",bg:"bg-rose-50",text:"text-rose-600",accent:"text-rose-600",badge:"bg-rose-100 text-rose-600 border-rose-200",border:"border-rose-500",ring:"focus-within:ring-rose-200",buttonRing:"focus:ring-rose-200 focus:border-rose-300",dot:"bg-rose-400",breadcrumb:"bg-rose-50 text-rose-600 hover:bg-rose-100",indicator:"bg-rose-500",ringColor:"ring-rose-400"}},zz={zh:{inbox:"",today:"",upcoming:"",anytime:"",someday:"",logbook:"",trash:"",tags:"",focus:"",journal:"",prompt:"",newTag:"",subTagPlaceholder:"...",tagStyle:"",selectTagColor:"",addSubTag:"",rename:"",deleteTagConfirm:"",deleteTag:"",settings:"",logout:"",emptyTrash:"",emptyTrashConfirm:"",trashEmptyTitle:"",restoreTrash:"",restoreTrashConfirm:"",putBack:"",delete:"",archive:"",notesPlaceholder:"...",addTagPlaceholder:"...",attachFiles:"",aiPolishSuggestions:"AI ",suggestedTitle:" ()",suggestedContent:" ()",aiPolishApplied:" AI ",confirmReplace:"",dateInputPlaceholder:": 5, , ...",identified:"",scheduleTitle:"",noSchedule:"",confirmDate:"",addNotePlaceholder:"...",from:"",addNewTag:"",presentationMode:"",editMode:"",linkAttachments:"",linkedTo:"",noParagraphs:"",clickToLink:"",paragraph:"",noAttachmentsLinked:"",save:"",cancel:"",share:"",aiPolish:"AI ",aiAssistant:"AI ",undo:"",redo:"",dismiss:"",permanentlyDeleted:"",restored:"",appearance:"",fontSize:"",fontWeight:"",fontFamily:"",language:"",timeFormat:"",calendarSettings:"",showLunar:"",showTaiwanHolidays:"",aiSettings:"AI ",provider:"",fontNormal:"",fontThin:"",sizeSmall:"",sizeNormal:"",sizeLarge:"",fontSystem:"",fontThings:"",theme:""},en:{inbox:"Inbox",today:"Today",upcoming:"Upcoming",anytime:"Anytime",someday:"Inspiration",logbook:"Logbook",trash:"Trash",tags:"Tags",focus:"Focus",journal:"Note",prompt:"Prompt",newTag:"New Tag",subTagPlaceholder:"Subtag name...",tagStyle:"Tag Style",selectTagColor:"Select tag color",addSubTag:"Add Subtag",rename:"Rename",deleteTagConfirm:"Are you sure you want to delete this tag?",deleteTag:"Delete Tag",settings:"Settings",logout:"Logout",emptyTrash:"Empty Trash",emptyTrashConfirm:"Are you sure you want to permanently delete all items in the trash? This action is irreversible.",trashEmptyTitle:"Trash",restoreTrash:"Restore All",restoreTrashConfirm:"Are you sure you want to restore all items in the trash?",putBack:"Put Back",delete:"Delete",archive:"Archive",notesPlaceholder:"Notes...",addTagPlaceholder:"Add tag...",attachFiles:"Files",aiPolishSuggestions:"AI Polish Suggestions",suggestedTitle:"Suggested Title (Editable)",suggestedContent:"Suggested Content (Editable)",aiPolishApplied:"AI polish applied",confirmReplace:"Confirm Replace",dateInputPlaceholder:"Type: 5, tomorrow, next Fri...",identified:"Identified",scheduleTitle:"Schedule",noSchedule:"No tasks scheduled",confirmDate:"Confirm Date",addNotePlaceholder:"Add a note...",from:"From",addNewTag:"Add",presentationMode:"Presentation Mode",editMode:"Edit Mode",linkAttachments:"Link Attachments",linkedTo:"Linked to",noParagraphs:"No paragraphs yet",clickToLink:"Click to link attachments",paragraph:"Paragraph",noAttachmentsLinked:"No attachments linked",save:"Save",cancel:"Cancel",share:"Share",aiPolish:"AI Polish",aiAssistant:"AI Assistant",undo:"Undo",redo:"Redo",dismiss:"Dismiss",permanentlyDeleted:"Permanently deleted",restored:"Restored",appearance:"Appearance",fontSize:"Font Size",fontWeight:"Font Weight",fontFamily:"Font Family",language:"Language",timeFormat:"Time Format",calendarSettings:"Calendar Settings",showLunar:"Show Lunar",showTaiwanHolidays:"Show Holidays",aiSettings:"AI Settings",provider:"Provider",fontNormal:"Normal",fontThin:"Thin",sizeSmall:"Small",sizeNormal:"Normal",sizeLarge:"Large",fontSystem:"Default",fontThings:"Thin",theme:"Theme"}},ll=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),_n=b.createContext({}),Fz=({children:t})=>{const[e,n]=b.useState(null),[r,s]=b.useState([]),[i,o]=b.useState([]),[a,l]=b.useState([]),[u,d]=b.useState(!0),[f,h]=b.useState(null),[p,m]=b.useState("synced"),[y,x]=b.useState(null),[g,v]=b.useState([]),[w,S]=b.useState(null),[I,k]=b.useState(null),[R,C]=b.useState(null),[T,_]=b.useState([]),N=$=>{if(typeof $=="function")C(F=>{const L=$(F);if(L===null)return null;const W=q.current.find(B=>B.id===L);return W!=null&&W.is_locked&&!T.includes(L)?(console.warn("Blocked editing locked task:",L),F):L});else{if($===null){C(null);return}const F=q.current.find(L=>L.id===$);if(F!=null&&F.is_locked&&!T.includes($)){console.warn("Blocked editing locked task:",$);return}C($)}},j=R,O=$=>{_(F=>[...F,$]),setTimeout(()=>{_(F=>F.filter(L=>L!==$))},3e4)},[P,G]=b.useState(()=>{const $=localStorage.getItem(`expanded_tasks_${e==null?void 0:e.id}`);return $?JSON.parse($):[]}),[A,M]=b.useState({}),[Q,X]=b.useState([]),[D,Te]=b.useState(!1),[xe,U]=b.useState(!1),[z,ie]=b.useState(()=>{const $=localStorage.getItem("locked_google_tag_ids");return $?JSON.parse($):[]}),Be=b.useCallback($=>{ie(F=>{const W=F.includes($)?F.filter(B=>B!==$):[...F,$];return localStorage.setItem("locked_google_tag_ids",JSON.stringify(W)),W})},[]),st=b.useCallback($=>{if(!$.tags||$.tags.length===0)return!1;for(const F of $.tags)if(z.includes(F)){const L=a.find(W=>W.id===F);if(L&&L.name.startsWith("Google:"))return!0}return!1},[z,a]);b.useEffect(()=>{const $=localStorage.getItem("viewTagFilters");if($)try{const F=JSON.parse($),L={};Object.keys(F).forEach(W=>{Array.isArray(F[W])?L[W]={include:F[W],exclude:[]}:L[W]=F[W]}),M(L)}catch(F){console.error("Failed to parse viewTagFilters",F)}},[]);const ae=($,F)=>{M(L=>{const W={...L,[$]:F};return localStorage.setItem("viewTagFilters",JSON.stringify(W)),W})},Z=b.useMemo(()=>{const $={},F=L=>{if($[L])return $[L];const W=a.find(B=>B.id===L);return W?W.parent_id?W.color==="#6366f1"||!W.color?($[L]=F(W.parent_id),$[L]):($[L]=W.color,$[L]):($[L]=W.color||"#6366f1",$[L]):"#6366f1"};return a.forEach(L=>F(L.id)),$},[a]),[K,de]=b.useState(()=>localStorage.getItem(`last_view_${e==null?void 0:e.id}`)||"inbox"),[ce,ke]=b.useState(null),[_e,ve]=b.useState([]),Ke=b.useRef([]);Ke.current=_e;const[je,V]=b.useState({additionalTags:[],startDate:null,dueDate:null,color:null}),[re,se]=b.useState(()=>{const $=localStorage.getItem(`theme_settings_${e==null?void 0:e.id}`),F={fontWeight:"thin",fontSize:"normal",fontFamily:"system",timeFormat:"24h",showLunar:!1,showTaiwanHolidays:!1,language:"zh"};return $?{...F,...JSON.parse($)}:F}),ne=re.language||"zh",pe=$=>{se(F=>({...F,language:$}))};b.useEffect(()=>{re.themeMode&&re.themeMode!=="light"?document.documentElement.setAttribute("data-theme",re.themeMode):document.documentElement.removeAttribute("data-theme")},[re.themeMode]),b.useEffect(()=>{const $=re.fontFamily||"system";document.documentElement.setAttribute("data-font",$)},[re.fontFamily]);const ee=b.useCallback($=>zz[ne][$]||$,[ne]),[ye,Pe]=b.useState(null),[me,Me]=b.useState(null),[qe,ht]=b.useState(()=>{const $=localStorage.getItem(`calendar_current_date_${e==null?void 0:e.id}`);return $?new Date($):new Date}),[wt,ge]=b.useState(()=>parseInt(localStorage.getItem(`sidebar_width_${e==null?void 0:e.id}`)||"260")),[Le,Ue]=b.useState(()=>localStorage.getItem(`sidebar_collapsed_${e==null?void 0:e.id}`)==="true"),[De,Qe]=b.useState(()=>parseInt(localStorage.getItem(`focus_split_width_${e==null?void 0:e.id}`)||"400")),[pt,nt]=b.useState(!1);b.useEffect(()=>{e!=null&&e.id&&localStorage.setItem(`sidebar_collapsed_${e.id}`,Le.toString())},[Le]),b.useEffect(()=>{K==="focus"&&(v([]),k(null))},[K]),b.useEffect(()=>{const $=W=>{const B=/Mac|iPod|iPhone|iPad/.test(navigator.userAgent);(W.ctrlKey||W.metaKey&&!B)&&nt(!0)},F=W=>{const B=/Mac|iPod|iPhone|iPad/.test(navigator.userAgent);!W.ctrlKey&&!(W.metaKey&&!B)&&nt(!1)},L=()=>nt(!1);return window.addEventListener("keydown",$),window.addEventListener("keyup",F),window.addEventListener("blur",L),()=>{window.removeEventListener("keydown",$),window.removeEventListener("keyup",F),window.removeEventListener("blur",L)}},[]),b.useEffect(()=>{e!=null&&e.id&&localStorage.setItem(`calendar_current_date_${e.id}`,qe.toISOString())},[qe]),b.useEffect(()=>{if(e!=null&&e.id){const $=localStorage.getItem(`focus_split_width_${e.id}`);$&&Qe(parseInt($))}},[e==null?void 0:e.id]),b.useEffect(()=>{e!=null&&e.id&&localStorage.setItem(`focus_split_width_${e.id}`,De.toString())},[De,e==null?void 0:e.id]),b.useEffect(()=>{e&&console.warn("[AppContext] Current User ID:",e.id,"Email:",e.email)},[e]);const ut=b.useMemo(()=>{const $={};return r.forEach(F=>{if(F.status==="deleted"||F.status==="logged")return;const L=F.start_date||F.due_date;if(L){const W=L.split("T")[0];$[W]=($[W]||0)+1}}),$},[r]),[he,we]=b.useState(()=>{const $=localStorage.getItem(`expanded_tags_${e==null?void 0:e.id}`);return $?JSON.parse($):[]}),[Xe,Ze]=b.useState([]),[lt,Ge]=b.useState([]),[Ct,Y]=b.useState([]),q=b.useRef([]),[oe,Ce]=b.useState({isDragging:!1,draggedId:null,originalDepth:0,dragOffsetX:0,dropIndex:null,dropDepth:0,indicatorTop:0,indicatorLeft:0,indicatorWidth:0,ghostPosition:{x:0,y:0},anchorTaskIndex:null}),dt=b.useRef({}),xt=b.useRef(null),it=b.useRef(null);b.useEffect(()=>{if(!Ne){h("Supabase client not initialized"),d(!1);return}(async()=>{try{let L=localStorage.getItem("gtd_user_id");(!L||!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(L))&&(console.warn("Invalid or missing User ID, resetting to default."),L="00000000-0000-0000-0000-000000000000",localStorage.setItem("gtd_user_id",L));let B;if(Ne){const{data:{session:J},error:fe}=await Ne.auth.getSession();if(fe)throw fe;B=(J==null?void 0:J.user)||{id:L},n(B)}else B={id:L},n(B);if(B!=null&&B.id){const J=localStorage.getItem(`expanded_tasks_${B.id}`);J&&G(JSON.parse(J));const fe=localStorage.getItem(`last_view_${B.id}`);fe&&de(fe);const Re=localStorage.getItem(`sidebar_width_${B.id}`);Re&&ge(parseInt(Re));const ze=localStorage.getItem(`expanded_tags_${B.id}`);ze&&we(JSON.parse(ze));const We=localStorage.getItem(`theme_settings_${B.id}`);We&&se(JSON.parse(We))}}catch(L){console.error("Initialization error:",L),h(L.message||"Failed to initialize app"),d(!1)}})();const{data:F}=(Ne==null?void 0:Ne.auth.onAuthStateChange(async(L,W)=>{L==="SIGNED_IN"?n(W==null?void 0:W.user):L==="SIGNED_OUT"&&n(null)}))||{data:{subscription:{unsubscribe:()=>{}}}};return()=>{F.subscription.unsubscribe()}},[]),b.useEffect(()=>{q.current=r},[r]),b.useEffect(()=>{if(!e||!Ne)return;(async()=>{try{if(Ne){let W=[],B=0;const J=1e3;let fe=!0;for(;fe;){const{data:Ee,error:$e}=await Ne.from("tasks").select("*").eq("user_id",e.id).order("order_index",{ascending:!0}).order("created_at",{ascending:!0}).range(B,B+J-1);if($e){console.error("[Debug] Fetch Error:",$e);break}Ee&&Ee.length>0?(W=[...W,...Ee],Ee.length<J?fe=!1:B+=J):fe=!1}const Re=W,{data:ze,error:We}=await Ne.from("tags").select("*").eq("user_id",e.id);We&&console.error("Tags fetch error:",We);const et=(ze||[]).sort((Ee,$e)=>(Ee.order_index||0)-($e.order_index||0));if(l(et||[]),Re){const Ee=Re.map($e=>({...$e,parent_id:$e.parent_id||null,tags:$e.tags||[],images:$e.images||[],attachments:$e.attachments||[],attachment_links:$e.attachment_links||[],view_orders:$e.view_orders||{}}));s(Ee),q.current=Ee}const{data:mt,error:tt}=await Ne.from("archived_tasks").select("*").eq("user_id",e.id).order("archived_at",{ascending:!1});if(tt)console.warn("Failed to fetch archived tasks (table may not exist yet):",tt);else if(mt){const Ee=mt.map($e=>({...$e,parent_id:$e.parent_id||null,original_parent_id:$e.original_parent_id||null,tags:$e.tags||[],images:$e.images||[],attachments:$e.attachments||[],view_orders:$e.view_orders||{},is_all_day:!0,start_time:null,end_time:null,duration:null}));o(Ee)}const{data:ct,error:He}=await Ne.from("search_history").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(50);He?console.warn("Failed to fetch search history (table may not exist yet):",He):ct&&X(ct)}}catch(W){console.error("Error fetching data:",W)}finally{d(!1)}})();const F=Ne.channel("tasks_changes").on("postgres_changes",{event:"*",schema:"public",table:"tasks",filter:`user_id=eq.${e.id}`},W=>{if(!(W.new&&dt.current[W.new.id]&&Date.now()-dt.current[W.new.id]<2e3))if(W.eventType==="INSERT"){const B={...W.new,parent_id:W.new.parent_id||null,tags:W.new.tags||[],images:W.new.images||[],attachments:W.new.attachments||[],attachment_links:W.new.attachment_links||[],view_orders:W.new.view_orders||{}};s(J=>{if(J.some(Re=>Re.id===B.id))return J;const fe=[B,...J].sort((Re,ze)=>(Re.order_index||0)-(ze.order_index||0)||Re.created_at.localeCompare(ze.created_at));return q.current=fe,fe})}else if(W.eventType==="UPDATE"){const B={...W.new,tags:W.new.tags||[],images:W.new.images||[],attachments:W.new.attachments||[],attachment_links:W.new.attachment_links||[],view_orders:W.new.view_orders||{}};s(J=>{const fe=J.map(Re=>Re.id===B.id?B:Re).sort((Re,ze)=>(Re.order_index||0)-(ze.order_index||0)||Re.created_at.localeCompare(ze.created_at));return q.current=fe,fe})}else W.eventType==="DELETE"&&s(B=>{const J=B.filter(fe=>fe.id!==W.old.id);return q.current=J,J})}).subscribe(),L=Ne.channel("tags_changes").on("postgres_changes",{event:"*",schema:"public",table:"tags",filter:`user_id=eq.${e.id}`},W=>{W.eventType==="INSERT"?l(B=>B.some(J=>J.id===W.new.id)?B:[...B,W.new]):W.eventType==="DELETE"&&l(B=>B.filter(J=>J.id!==W.old.id))}).subscribe();return()=>{F.unsubscribe(),L.unsubscribe()}},[e]);const Rt=$=>{console.error($),m("error"),x({msg:`Sync Failed: ${$.message||"Unknown error"}`,type:"error"})},Ot=$=>{dt.current[$]=Date.now()};b.useEffect(()=>{if(!e||!Ne)return;const $=async F=>{const L=F.detail;if(!L||!L.taskId||!L.file)return;const W=L.taskId,B=L.file,J=L.markers||[],fe=L.recordingId,Re=q.current.find(ze=>ze.id===W);if(!Re){console.warn("[AppContext] Task not found for recording:",W),x({msg:"",type:"error"});return}try{const ze=`${Date.now()}_${ll()}.${B.name.split(".").pop()}`,et=`${(e==null?void 0:e.id)||"anonymous"}/${ze}`,{error:mt}=await Ne.storage.from("attachments").upload(et,B,{contentType:B.type,upsert:!1});if(mt){console.error("Upload voice error:",mt),x({msg:"",type:"error"});return}const{data:tt}=Ne.storage.from("attachments").getPublicUrl(et);if(tt){const ct={name:B.name,url:tt.publicUrl,size:B.size,type:B.type,markers:J,recordingId:fe},Ee=[...Re.attachments||[],ct];Ot(W),s(be=>{const Ae=be.map(Fe=>Fe.id===W?{...Fe,attachments:Ee}:Fe);return q.current=Ae,Ae});const{error:$e}=await Ne.from("tasks").update({attachments:Ee}).eq("id",W);if($e)console.error("Failed to update task attachments:",$e),x({msg:"",type:"error"});else{window.dispatchEvent(new CustomEvent("recording-saved",{detail:{taskId:W,attachment:ct}}));const be=W;x({msg:"",type:"info",onClick:()=>{window.dispatchEvent(new CustomEvent("navigate-to-task",{detail:{taskId:be,openForEdit:!0}}))},actionLabel:""})}}}catch(ze){console.error("[AppContext] Error saving recording:",ze),x({msg:"",type:"error"})}};return window.addEventListener("audio-recording-completed",$),()=>window.removeEventListener("audio-recording-completed",$)},[e]);const Nn=async $=>{const F=new Date,L=[];for(let fe=1;fe<=10;fe++){const Re=new Date(F);Re.setDate(F.getDate()+fe),Re.setHours(0,0,0,0);const ze=r.filter(We=>{if(!We.start_date)return!1;const et=new Date(We.start_date);return yi(et,Re)&&!We.completed_at}).length;L.push({date:Re,count:ze})}const W=Math.min(...L.map(fe=>fe.count)),B=L.filter(fe=>fe.count===W),J=B[Math.floor(Math.random()*B.length)];await Pr($,{start_date:J.date.toISOString()}),x({msg:` ${J.date.getMonth()+1}/${J.date.getDate()} (: ${J.count})`,type:"info"})},$t=$=>{const F=[$],L=W=>{r.filter(J=>J.parent_id===W).forEach(J=>{F.push(J.id),L(J.id)})};return L($),F},an=async($,F)=>{if(!Ne)return;const L=$t($);s(B=>{const J=B.map(fe=>fe.id===$?{...fe,is_locked:!0,lock_password:F}:L.includes(fe.id)?{...fe,is_locked:!0,lock_password:void 0}:fe);return q.current=J,J}),await Ne.from("tasks").update({is_locked:!0,lock_password:F}).eq("id",$);const W=L.filter(B=>B!==$);if(W.length>0)for(const B of W)await Ne.from("tasks").update({is_locked:!0,lock_password:null}).eq("id",B);x({msg:` ${L.length-1} `,type:"info"})},Tn=async($,F)=>{if(!Ne)return!1;const L=r.find(fe=>fe.id===$);if(!L||!L.is_locked)return!0;let W=L,B=L;for(;B.parent_id;){const fe=r.find(Re=>Re.id===B.parent_id);if(fe&&fe.is_locked&&fe.lock_password&&(W=fe),!fe)break;B=fe}if(W.lock_password!==F)return x({msg:"",type:"error"}),!1;const J=$t($);s(fe=>{const Re=fe.map(ze=>J.includes(ze.id)?{...ze,is_locked:!1,lock_password:void 0}:ze);return q.current=Re,Re});for(const fe of J)await Ne.from("tasks").update({is_locked:!1,lock_password:null}).eq("id",fe);return x({msg:"",type:"info"}),!0},Ie=($,F)=>{const L=r.find(J=>J.id===$);if(!L||!L.is_locked)return!0;let W=L,B=L;for(;B.parent_id;){const J=r.find(fe=>fe.id===B.parent_id);if(J&&J.is_locked&&J.lock_password&&(W=J),!J)break;B=J}return W.lock_password===F},Dt=async()=>{const $=r.filter(W=>!!W.completed_at&&W.status!=="logged"&&W.status!=="deleted");if($.length===0)return;const F=$.map(W=>W.id),L=$.map(W=>({...W,status:"logged",original_parent_id:W.parent_id,archived_at:new Date().toISOString()}));if(s(W=>{const B=W.filter(J=>!F.includes(J.id));return q.current=B,B}),o(W=>[...W,...L]),Ne){const{error:W}=await Ne.from("archived_tasks").insert(L.map(J=>({id:J.id,user_id:J.user_id,title:J.title,description:J.description,status:J.status,original_parent_id:J.original_parent_id,parent_id:J.parent_id,is_project:J.is_project,order_index:J.order_index,view_orders:J.view_orders,tags:J.tags,color:J.color,start_date:J.start_date,due_date:J.due_date,completed_at:J.completed_at,reviewed_at:J.reviewed_at,images:J.images,attachments:J.attachments,created_at:J.created_at,archived_at:J.archived_at})));if(W){Rt(W);return}const{error:B}=await Ne.from("tasks").delete().in("id",F);B&&Rt(B)}Pn({type:"ARCHIVE",payload:{originalTasks:$,archivedRecords:L}}),x({msg:` ${F.length} `,type:"info",undo:Jn})},zt=async $=>{const F=i.find(B=>B.id===$);if(!F)return;let L=F.original_parent_id;L&&(r.find(J=>J.id===L)||(L=null));const W={id:F.id,user_id:F.user_id,title:F.title,description:F.description,status:"completed",parent_id:L,is_project:F.is_project,order_index:F.order_index,view_orders:F.view_orders,tags:F.tags,color:F.color,start_date:F.start_date,due_date:F.due_date,completed_at:F.completed_at,reviewed_at:F.reviewed_at,images:F.images,attachments:F.attachments,created_at:F.created_at,is_all_day:!0,start_time:null,end_time:null,duration:null};if(o(B=>B.filter(J=>J.id!==$)),s(B=>{const J=[...B,W];return q.current=J,J}),Ne){const{error:B}=await Ne.from("tasks").insert({id:W.id,user_id:W.user_id,title:W.title,description:W.description,status:W.status,parent_id:W.parent_id,is_project:W.is_project,order_index:W.order_index,view_orders:W.view_orders,tags:W.tags,color:W.color,start_date:W.start_date,due_date:W.due_date,completed_at:W.completed_at,reviewed_at:W.reviewed_at,images:W.images,created_at:W.created_at});if(B){Rt(B);return}const{error:J}=await Ne.from("archived_tasks").delete().eq("id",$);J&&Rt(J)}x({msg:"",type:"info"})},Ft=async $=>{if(i.find(L=>L.id===$)){if(o(L=>L.filter(W=>W.id!==$)),Ne){const{error:L}=await Ne.from("archived_tasks").delete().eq("id",$);L&&Rt(L)}x({msg:"",type:"info"})}},qt=async($,F)=>{const L=i.find(B=>B.id===$);if(!L)return;const W={...L,...F};if(o(B=>B.map(J=>J.id===$?W:J)),Ne){const{error:B}=await Ne.from("archived_tasks").update(F).eq("id",$);B&&Rt(B)}},mn=async $=>{if($.length!==0){if(o(F=>F.filter(L=>!$.includes(L.id))),Ne){const{error:F}=await Ne.from("archived_tasks").delete().in("id",$);F&&Rt(F)}x({msg:` ${$.length} `,type:"info"})}},Cr=async($,F,L)=>{if(!Ne||!e)return;const W={id:ll(),user_id:e.id,query:$,filters:F,name:L||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};X(J=>[W,...J].slice(0,50));const{error:B}=await Ne.from("search_history").insert({id:W.id,user_id:W.user_id,query:W.query,filters:W.filters,name:W.name,created_at:W.created_at,updated_at:W.updated_at});B&&console.warn("Failed to save search history:",B)},gs=async $=>{if(!Ne)return;X(L=>L.filter(W=>W.id!==$));const{error:F}=await Ne.from("search_history").delete().eq("id",$);F&&console.warn("Failed to delete search history:",F)},bn=async()=>{gn(),m("syncing");const $=[...r];if(s([]),q.current=[],Ze([]),Ge([]),Ne){const{error:F}=await Ne.from("tasks").delete().neq("id","00000000-0000-0000-0000-000000000000");if(F){Rt(F),s($);return}}m("synced"),x({msg:"",type:"info"})},gn=()=>{const $={tasks:r,tags:a,user_id:e.id,version:1,exported_at:new Date().toISOString()},F=new Blob([JSON.stringify($,null,2)],{type:"application/json"}),L=URL.createObjectURL(F),W=document.createElement("a");W.href=L,W.download=`things-clone-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(W),W.click(),document.body.removeChild(W),URL.revokeObjectURL(L),x({msg:"",type:"info"})},Er=async $=>{if(!Ne)return;const F=new FileReader;F.onload=async L=>{var W;try{const B=(W=L.target)==null?void 0:W.result,J=JSON.parse(B);if(!J.tasks||!J.tags)throw new Error("");if(m("syncing"),J.tags.length>0){const{error:fe}=await Ne.from("tags").upsert(J.tags.map(Re=>({...Re,user_id:e.id})));if(fe)throw fe}if(J.tasks.length>0){const{error:fe}=await Ne.from("tasks").upsert(J.tasks.map(Re=>({...Re,user_id:e.id})));if(fe)throw fe}x({msg:"...",type:"info"}),setTimeout(()=>window.location.reload(),1e3)}catch(B){Rt(B)}},F.readAsText($)},Pn=$=>{Ze(F=>[...F,$]),Ge([])},Jn=async()=>{if(Xe.length===0)return;const $=Xe[Xe.length-1];if(Ze(Xe.slice(0,-1)),Ge(F=>[...F,$]),$.type==="ADD"){const F=$.payload.data.id;Ot(F),s(L=>L.filter(W=>W.id!==F)),Ne&&await Ne.from("tasks").delete().eq("id",F)}else if($.type==="DELETE"){const F=$.payload.data;Ot(F.id),s(L=>[...L,F].sort((W,B)=>(W.order_index||0)-(B.order_index||0)||W.created_at.localeCompare(B.created_at))),Ne&&await Ne.from("tasks").insert([F])}else if($.type==="UPDATE"){const{id:F,before:L}=$.payload;await Pr(F,L,[],{skipHistory:!0})}else if($.type==="BATCH_UPDATE"){const L=$.payload.map(W=>({id:W.id,data:W.before}));await Un(L,{skipHistory:!0})}else if($.type==="ADD_TAG"){const F=$.payload.data.id;l(L=>L.filter(W=>W.id!==F)),Ne&&await Ne.from("tags").delete().eq("id",F)}else if($.type==="DELETE_TAG"){const F=$.payload.data;l(L=>[...L,F].sort((W,B)=>(W.order_index||0)-(B.order_index||0))),Ne&&await Ne.from("tags").insert([F])}else if($.type==="UPDATE_TAG"){const{id:F,before:L}=$.payload;l(W=>W.map(B=>B.id===F?{...B,...L}:B).sort((B,J)=>(B.order_index||0)-(J.order_index||0))),Ne&&await Ne.from("tags").update(L).eq("id",F)}else if($.type==="ARCHIVE"){const{originalTasks:F,archivedRecords:L}=$.payload,W=L.map(B=>B.id);o(B=>B.filter(J=>!W.includes(J.id))),s(B=>{const J=[...B,...F].sort((fe,Re)=>(fe.order_index||0)-(Re.order_index||0)||fe.created_at.localeCompare(Re.created_at));return q.current=J,J}),Ne&&(await Ne.from("archived_tasks").delete().in("id",W),await Ne.from("tasks").insert(F))}else if($.type==="BATCH_DELETE"){const F=$.payload.data;s(L=>[...L,...F].sort((W,B)=>(W.order_index||0)-(B.order_index||0)||W.created_at.localeCompare(B.created_at))),Ne&&await Ne.from("tasks").insert(F)}x({msg:"",type:"info"})},En=async()=>{if(lt.length===0)return;const $=lt[lt.length-1];if(Ge(lt.slice(0,-1)),Ze(F=>[...F,$]),$.type==="ADD"){const F=$.payload.data;Ot(F.id),s(L=>[...L,F].sort((W,B)=>(W.order_index||0)-(B.order_index||0)||W.created_at.localeCompare(B.created_at))),Ne&&await Ne.from("tasks").insert([F])}else if($.type==="DELETE"){const F=$.payload.data.id;Ot(F),s(L=>L.filter(W=>W.id!==F)),Ne&&await Ne.from("tasks").delete().eq("id",F)}else if($.type==="UPDATE"){const{id:F,after:L}=$.payload;await Pr(F,L,[],{skipHistory:!0})}else if($.type==="BATCH_UPDATE"){const L=$.payload.map(W=>({id:W.id,data:W.after}));await Un(L,{skipHistory:!0})}else if($.type==="ADD_TAG"){const F=$.payload.data;l(L=>[...L,F].sort((W,B)=>(W.order_index||0)-(B.order_index||0))),Ne&&await Ne.from("tags").insert([F])}else if($.type==="DELETE_TAG"){const F=$.payload.data.id;l(L=>L.filter(W=>W.id!==F)),Ne&&await Ne.from("tags").delete().eq("id",F)}else if($.type==="UPDATE_TAG"){const{id:F,after:L}=$.payload;l(W=>W.map(B=>B.id===F?{...B,...L}:B).sort((B,J)=>(B.order_index||0)-(J.order_index||0))),Ne&&await Ne.from("tags").update(L).eq("id",F)}else if($.type==="ARCHIVE"){const{originalTasks:F,archivedRecords:L}=$.payload,W=F.map(B=>B.id);s(B=>{const J=B.filter(fe=>!W.includes(fe.id));return q.current=J,J}),o(B=>[...B,...L]),Ne&&(await Ne.from("archived_tasks").insert(L.map(B=>({id:B.id,user_id:B.user_id,title:B.title,description:B.description,status:B.status,original_parent_id:B.original_parent_id,parent_id:B.parent_id,is_project:B.is_project,order_index:B.order_index,view_orders:B.view_orders,tags:B.tags,color:B.color,start_date:B.start_date,due_date:B.due_date,completed_at:B.completed_at,reviewed_at:B.reviewed_at,images:B.images,attachments:B.attachments,created_at:B.created_at,archived_at:B.archived_at}))),await Ne.from("tasks").delete().in("id",W))}else if($.type==="BATCH_DELETE"){const L=$.payload.data.map(W=>W.id);s(W=>W.filter(B=>!L.includes(B.id))),Ne&&await Ne.from("tasks").delete().in("id",L)}x({msg:"",type:"info"})},Or=async()=>{if(!Ne)return;const{error:$}=await Ne.auth.signOut();$?Rt($):x({msg:"",type:"info"})};b.useEffect(()=>{const $=F=>{j||(F.metaKey||F.ctrlKey)&&F.key==="z"&&(F.preventDefault(),F.shiftKey?En():Jn())};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)},[Xe,lt,r,j]);const Ei=($,F=!1,L)=>{const W=r.find(ct=>ct.id===$);if(!W)return;const B=ct=>a.find(He=>ct.some(Ee=>He.name.trim().toLowerCase()===Ee.toLowerCase())),J=B(["note","journal","",""]),fe=B(["prompt",""]),Re=J,ze=B(["someday","inspiration","","/"]),We=B(["project",""]),et=B(["schedule",""]);let mt=L||"inbox";L||(J&&W.tags.includes(J.id)?mt="journal":fe&&W.tags.includes(fe.id)?mt="prompt":Re&&W.tags.includes(Re.id)?mt="journal":ze&&W.tags.includes(ze.id)?mt="waiting":We&&W.tags.includes(We.id)?r.some(He=>He.parent_id===$&&He.status!=="deleted")&&(mt="projects"):et&&W.tags.includes(et.id)?mt="focus":(W.start_date||W.due_date)&&(mt="today")),Y(ct=>[...ct,{view:K,focusedId:I,editingId:j,searchOpen:D}]),de(mt),k($);let tt=r.find(ct=>ct.id===$);for(;tt&&tt.parent_id;)P.includes(tt.parent_id)||Zt(tt.parent_id,!0),tt=r.find(ct=>ct.id===(tt==null?void 0:tt.parent_id));F&&setTimeout(()=>N($),100)},tl=()=>{if(Ct.length===0)return;const $=Ct[Ct.length-1];Y(L=>L.slice(0,-1)),de($.view),k($.focusedId);const F=$.editingId||$.focusedId;F&&setTimeout(()=>N(F),150),$.searchOpen!==void 0&&Te($.searchOpen)};b.useEffect(()=>{const $=F=>{const L=F.detail;L!=null&&L.taskId&&Ei(L.taskId,L.openForEdit||!1)};return window.addEventListener("navigate-to-task",$),()=>window.removeEventListener("navigate-to-task",$)},[r,a,K,I,P]);const Qo=b.useCallback(($,F,L,W,B,J)=>{var gt;if(re.showImportedGoogleEvents===!1){const Ve=a.filter(te=>te.name.startsWith("Google:")).map(te=>te.id);Ve.length>0&&($=$.filter(te=>!te.tags.some(Oe=>Ve.includes(Oe))))}const fe=Ve=>{var te;return(te=a.find(Oe=>Ve.some(Je=>Oe.name.trim().toLowerCase()===Je.toLowerCase())))==null?void 0:te.id},Re=fe(["prompt",""]),ze=fe(["journal","note","",""]),We=fe(["someday","inspiration","","/"]),et=fe(["project",""]),mt=(gt=a.find(Ve=>Ve.name==="#prompt"))==null?void 0:gt.id,tt=fe(["schedule",""]),ct=fe(["annual","annualplan","",""]);if(F==="schedule")return $.filter(Ve=>(!!Ve.due_date||!!Ve.start_date)&&Ve.status!=="deleted"&&Ve.status!=="logged").sort((Ve,te)=>{const Oe=new Date(Ve.start_date||Ve.due_date||0).getTime(),Je=new Date(te.start_date||te.due_date||0).getTime();return Oe-Je}).map((Ve,te)=>({data:Ve,depth:0,hasChildren:!1,isExpanded:!1,path:[],index:te}));if(F==="recent")return $.filter(Ve=>Ve.status!=="deleted").sort((Ve,te)=>{const Oe=new Date(Ve.updated_at||Ve.created_at||0).getTime();return new Date(te.updated_at||te.created_at||0).getTime()-Oe}).slice(0,100).map((Ve,te)=>({data:Ve,depth:0,hasChildren:!1,isExpanded:!1,path:[],index:te}));const Ee=(()=>{if(L){const Ve=Oe=>{const Je=a.filter(Ye=>Ye.parent_id===Oe);return[Oe,...Je.flatMap(Ye=>Ve(Ye.id))]},te=Ve(L);return Oe=>{if(!Rz(Oe,te))return!1;const Je=J[L]||{include:[],exclude:[]},{include:Ye,exclude:ft}=Array.isArray(Je)?{include:Je,exclude:[]}:Je;return Ye.length>0&&!Oe.tags.some(Nt=>Ye.includes(Nt))||ft.length>0&&Oe.tags.some(Nt=>ft.includes(Nt))||B.additionalTags.length>0&&!B.additionalTags.every(Nt=>{var jt;return(jt=Oe.tags)==null?void 0:jt.includes(Nt)})||B.color&&Oe.color!==B.color||B.startDate&&(!Oe.start_date||new Date(Oe.start_date)<new Date(B.startDate))||B.dueDate&&(!Oe.due_date||new Date(Oe.due_date)>new Date(B.dueDate))?!1:Oe.status!=="deleted"&&Oe.status!=="logged"}}switch(F){case"inbox":return $.filter(te=>te.status==="inbox").forEach(te=>{te.parent_id&&console.log(`[Inbox Debug] Hidden task "${te.title}": has parent_id ${te.parent_id}`)}),te=>{if(te.parent_id||te.status==="deleted"||te.status==="logged")return!1;const Oe=!!te.completed_at,Je=!te.start_date&&!te.due_date&&(!te.tags||te.tags.length===0),Ye=te.status==="inbox";if(Je){const Bt=J.inbox||{include:[],exclude:[]};return!((Array.isArray(Bt)?Bt:Bt.include||[]).length>0)}if(!Ye&&!Oe||!Oe&&(te.start_date||te.due_date)||!Oe&&(tt&&te.tags.includes(tt)||te.tags.some(Bt=>{const Xt=a.find(rn=>rn.id===Bt);return Xt&&["schedule",""].includes(Xt.name.trim().toLowerCase())}))||!Oe&&(et&&te.tags.includes(et)||ct&&te.tags.includes(ct)||We&&te.tags.includes(We)||ze&&te.tags.includes(ze)||Re&&te.tags.includes(Re)||mt&&te.tags.includes(mt)))return!1;const ft=J.inbox||{include:[],exclude:[]},{include:Nt,exclude:jt}=Array.isArray(ft)?{include:ft,exclude:[]}:ft;return!(Nt.length>0&&!te.tags.some(Bt=>Nt.includes(Bt))||jt.length>0&&te.tags.some(Bt=>jt.includes(Bt)))};case"allview":return te=>{if(te.parent_id||te.status==="deleted"||tt&&te.tags.includes(tt))return!1;const Oe=J.allview||{include:[],exclude:[]},{include:Je,exclude:Ye}=Array.isArray(Oe)?{include:Oe,exclude:[]}:Oe;return!(Je.length>0&&!te.tags.some(ft=>Je.includes(ft))||Ye.length>0&&te.tags.some(ft=>Ye.includes(ft)))};case"newtable":return te=>{if(te.parent_id||te.status==="deleted"||te.status==="logged"||Re&&te.tags.includes(Re)||ze&&te.tags.includes(ze)||We&&te.tags.includes(We)||!te.start_date&&!te.due_date)return!1;const Oe=new Date;Oe.setHours(23,59,59,999);const Je=te.start_date?new Date(te.start_date):te.due_date?new Date(te.due_date):null;return!(!Je||Je>Oe)};case"focus":return te=>!(te.status==="deleted"||te.status==="logged"||te.start_date||te.due_date||Re&&te.tags.includes(Re)||ze&&te.tags.includes(ze)||We&&te.tags.includes(We)||te.status==="waiting"||$.some(Je=>Je.parent_id===te.id&&Je.status!=="deleted"&&Je.status!=="logged"));case"today":return te=>{if(te.status==="logged"||te.status==="deleted"||te.status==="waiting"||te.status==="someday"||tt&&te.tags.includes(tt)||te.tags.some(jt=>{const Bt=a.find(Xt=>Xt.id===jt);return Bt&&["schedule",""].includes(Bt.name.trim().toLowerCase())}))return!1;const Oe=J.today||{include:[],exclude:[]},{include:Je,exclude:Ye}=Array.isArray(Oe)?{include:Oe,exclude:[]}:Oe;if(Je.length>0&&!te.tags.some(jt=>Je.includes(jt))||Ye.length>0&&te.tags.some(jt=>Ye.includes(jt)))return!1;const ft=["note","project"],Nt=a.filter(jt=>ft.includes(jt.name.trim().toLowerCase())).map(jt=>jt.id);return!(te.tags&&te.tags.some(jt=>Nt.includes(jt))||!te.start_date&&!te.due_date)};case"waiting":return te=>{const Oe=J.waiting||{include:[],exclude:[]},{include:Je,exclude:Ye}=Array.isArray(Oe)?{include:Oe,exclude:[]}:Oe;if(Je.length>0&&!te.tags.some(Bt=>Je.includes(Bt))||Ye.length>0&&te.tags.some(Bt=>Ye.includes(Bt))||te.status==="deleted"||te.status==="logged")return!1;const ft=te.status==="waiting",Nt=te.status==="someday",jt=te.tags.some(Bt=>{const Xt=a.find(sn=>sn.id===Bt);return Xt?Xt.name.trim().toLowerCase()==="someday":!1});return ft||Nt||jt};case"journal":return te=>{if(!ze)return!1;const Oe=J.journal||{include:[],exclude:[]},{include:Je,exclude:Ye}=Array.isArray(Oe)?{include:Oe,exclude:[]}:Oe;return Je.length>0&&!te.tags.some(ft=>Je.includes(ft))||Ye.length>0&&te.tags.some(ft=>Ye.includes(ft))?!1:te.status!=="deleted"&&te.status!=="logged"&&te.tags.includes(ze)};case"prompt":return te=>{const Oe=a.find(Nt=>Nt.name.trim().toLowerCase()==="prompt");if(!Oe)return!1;const Je=J.prompt||{include:[],exclude:[]},{include:Ye,exclude:ft}=Array.isArray(Je)?{include:Je,exclude:[]}:Je;return Ye.length>0&&!te.tags.some(Nt=>Ye.includes(Nt))||ft.length>0&&te.tags.some(Nt=>ft.includes(Nt))?!1:te.status!=="deleted"&&te.status!=="logged"&&te.tags.includes(Oe.id)};case"log":case"logbook":return te=>{if(te.status!=="logged")return!1;const Oe=J.logbook||J.log||{include:[],exclude:[]},{include:Je,exclude:Ye}=Array.isArray(Oe)?{include:Oe,exclude:[]}:Oe;return!(Je.length>0&&!te.tags.some(ft=>Je.includes(ft))||Ye.length>0&&te.tags.some(ft=>Ye.includes(ft)))};case"recent":return te=>{if(te.status==="deleted")return!1;const Oe=J.recent||{include:[],exclude:[]},{include:Je,exclude:Ye}=Array.isArray(Oe)?{include:Oe,exclude:[]}:Oe;return!(Je.length>0&&!te.tags.some(ft=>Je.includes(ft))||Ye.length>0&&te.tags.some(ft=>Ye.includes(ft)))};case"trash":return te=>{if(te.status!=="deleted")return!1;const Oe=J.trash||{include:[],exclude:[]},{include:Je,exclude:Ye}=Array.isArray(Oe)?{include:Oe,exclude:[]}:Oe;return!(Je.length>0&&!te.tags.some(ft=>Je.includes(ft))||Ye.length>0&&te.tags.some(ft=>Ye.includes(ft)))};default:return te=>{if(te.status==="deleted"||te.status==="logged"||tt&&te.tags.includes(tt)||te.tags.some(Nt=>{const jt=a.find(Bt=>Bt.id===Nt);return jt&&["schedule",""].includes(jt.name.trim().toLowerCase())}))return!1;const Je=J[F]||{include:[],exclude:[]},{include:Ye,exclude:ft}=Array.isArray(Je)?{include:Je,exclude:[]}:Je;return!(Ye.length>0&&!te.tags.some(Nt=>Ye.includes(Nt))||ft.length>0&&te.tags.some(Nt=>ft.includes(Nt)))}}})(),$e=F==="allview"||F==="project"?"inbox":F,be=Ve=>Ve.view_orders&&Ve.view_orders[$e]!==void 0?Ve.view_orders[$e]:Ve.order_index||0;if(F==="focus"||F==="today"){const Ve=Je=>{const Ye=Je.start_date||Je.due_date;if(Ye){const Nt=new Date(Ye);return`${Nt.getFullYear()}-${String(Nt.getMonth()+1).padStart(2,"0")}-${String(Nt.getDate()).padStart(2,"0")}`}const ft=new Date;return`${ft.getFullYear()}-${String(ft.getMonth()+1).padStart(2,"0")}-${String(ft.getDate()).padStart(2,"0")}`},te=Je=>Je.view_orders&&Je.view_orders.today!==void 0?Je.view_orders.today:9e8+new Date(Je.created_at).getTime()/1e3;return $.filter(Ee).sort((Je,Ye)=>{if(F==="today"){const ft=Ve(Je),Nt=Ve(Ye);return ft!==Nt?ft.localeCompare(Nt):te(Je)-te(Ye)}return be(Je)-be(Ye)||Je.created_at.localeCompare(Ye.created_at)}).map((Je,Ye)=>({data:Je,depth:0,hasChildren:!1,isExpanded:!1,path:[Je.id],index:Ye}))}const Ae=$.filter(Ve=>{if(!Ee(Ve))return!1;const te=Ve.parent_id||null;if(!te)return!0;const Oe=$.find(Je=>Je.id===te);return!Oe||!Ee(Oe)}).sort((Ve,te)=>be(Ve)-be(te)||Ve.created_at.localeCompare(te.created_at)),Fe=new Set;let bt=0;const rt=(Ve,te=0,Oe=[])=>{let Je=[];return Ve.forEach(Ye=>{if(Fe.has(Ye.id))return;Fe.add(Ye.id);const ft=$.filter(Xt=>Xt.parent_id===Ye.id&&Xt.status!=="logged"&&Xt.status!=="deleted").sort((Xt,rn)=>be(Xt)-be(rn)||Xt.created_at.localeCompare(rn.created_at)),Nt=ft.length>0,jt=W.includes(Ye.id),Bt=[...Oe,Ye.id];Je.push({data:Ye,depth:te,hasChildren:Nt,isExpanded:jt,path:Bt,index:bt++}),Nt&&jt&&(Je=[...Je,...rt(ft,te+1,Bt)])}),Je};return rt(Ae)},[a,re.showImportedGoogleEvents]),hn=b.useMemo(()=>Qo(r,K,ce,P,je,A),[r,K,ce,P,je,A,Qo,a]);b.useEffect(()=>{if(K!=="today"||!Ne)return;let $=hn.filter(fe=>{var ze;return((ze=fe.data.view_orders)==null?void 0:ze.today)===void 0});const F=new Map;hn.forEach(fe=>{var ze;const Re=(ze=fe.data.view_orders)==null?void 0:ze.today;if(Re!==void 0){const We=F.get(Re)||[];We.push(fe.data.id),F.set(Re,We)}});const L=new Set;if(F.forEach(fe=>{if(fe.length>1)for(let Re=1;Re<fe.length;Re++)L.add(fe[Re])}),L.size>0){const fe=hn.filter(Re=>L.has(Re.data.id));console.warn("[Today] Found duplicate orders, re-assigning:",fe.map(Re=>Re.data.title)),$=[...$,...fe]}if($.length===0)return;let W=0;hn.forEach(fe=>{var ze;const Re=(ze=fe.data.view_orders)==null?void 0:ze.today;Re!==void 0&&Re>W&&(W=Re)});const J=[...$].sort((fe,Re)=>fe.data.created_at.localeCompare(Re.data.created_at)).map((fe,Re)=>({id:fe.data.id,view_orders:{...fe.data.view_orders||{},today:W+1e4*(Re+1)}}));s(fe=>{const Re=fe.map(ze=>{const We=J.find(et=>et.id===ze.id);return We?{...ze,view_orders:We.view_orders}:ze});return q.current=Re,Re}),J.forEach(async({id:fe,view_orders:Re})=>{Ne&&await Ne.from("tasks").update({view_orders:Re}).eq("id",fe)})},[K,hn,Ne]),b.useEffect(()=>{if(K!=="waiting"||!Ne)return;let $=hn.filter(B=>{var fe;return((fe=B.data.view_orders)==null?void 0:fe.waiting)===void 0});if($.length===0)return;let F=0;hn.forEach(B=>{var fe;const J=(fe=B.data.view_orders)==null?void 0:fe.waiting;J!==void 0&&J>F&&(F=J)});const W=[...$].sort((B,J)=>B.data.created_at.localeCompare(J.data.created_at)).map((B,J)=>({id:B.data.id,view_orders:{...B.data.view_orders||{},waiting:F+1e4*(J+1)}}));s(B=>{const J=B.map(fe=>{const Re=W.find(ze=>ze.id===fe.id);return Re?{...fe,view_orders:Re.view_orders}:fe});return q.current=J,J}),W.forEach(async({id:B,view_orders:J})=>{Ne&&await Ne.from("tasks").update({view_orders:J}).eq("id",B)})},[K,hn,Ne]);const ko=($,F)=>{k(F);const L=$.shiftKey||$.shiftKey,W=$.ctrlKey||$.metaKey;if(L){const B=w||I||F;S(B);const J=hn.findIndex(Re=>Re.data.id===B),fe=hn.findIndex(Re=>Re.data.id===F);if(J!==-1&&fe!==-1){const[Re,ze]=J<fe?[J,fe]:[fe,J],We=hn.slice(Re,ze+1).map(et=>et.data.id);v(We)}}else W?(S(F),v(B=>B.includes(F)?B.filter(J=>J!==F):[...B,F])):(S(F),v([F]))},Zo=b.useCallback(($,F)=>{const L=document.getElementById("drag-ghost");L&&(L.style.left=`${$}px`,L.style.top=`${F}px`)},[]);b.useEffect(()=>{it.current=document.querySelector("main")},[]);const si=($,F)=>{if(K==="schedule"){$.preventDefault();return}const L=g.includes(F.data.id)?g:[F.data.id];g.includes(F.data.id)||v([F.data.id]),$.dataTransfer.setData("text/plain",F.data.id),$.dataTransfer.setData("application/json",JSON.stringify(L)),$.dataTransfer.effectAllowed="move",$.dataTransfer.setDragImage(yI,0,0);const W=$.currentTarget.getBoundingClientRect(),B=$.clientX-W.left;Ce(J=>({...J,isDragging:!0,draggedId:F.data.id,originalDepth:F.depth,dragOffsetX:B,ghostPosition:{x:$.clientX,y:$.clientY}}))},nl=$=>{Ce(F=>({...F,...$}))},rl=async $=>{xt.current&&(clearInterval(xt.current),xt.current=null);const{draggedId:F,dropIndex:L,dropDepth:W}=oe;if(Ce(be=>({...be,isDragging:!1,draggedId:null,dropIndex:null})),!F||L===null)return;const B=$||hn,J=K==="allview"||K==="project"?"inbox":K,fe=g.includes(F)?g:[F],Re=be=>J==="today"?9e8+new Date(be.created_at).getTime()/1e3:be.order_index||0,ze=r.filter(be=>fe.includes(be.id)).sort((be,Ae)=>{var rt,gt;const Fe=((rt=be.view_orders)==null?void 0:rt[J])!==void 0?be.view_orders[J]:Re(be),bt=((gt=Ae.view_orders)==null?void 0:gt[J])!==void 0?Ae.view_orders[J]:Re(Ae);return Fe-bt});let We=null;if(K!=="today"&&L>0){const be=B[L-1];if(W>be.depth)We=be.data.id,Zt(We,!0);else if(W===be.depth)We=be.data.parent_id;else{let Ae=L-1;for(;Ae>=0;){if(B[Ae].depth===W-1){We=B[Ae].data.id;break}if(B[Ae].depth<W-1)break;Ae--}if(W===0){const Fe=B.find(bt=>bt.depth===0&&!fe.includes(bt.data.id));We=Fe?Fe.data.parent_id:null}}}else We=null;for(const be of ze){if(We&&Sw(be.id,We,r)){x({msg:"",type:"error"});return}if(We){const Ae=r.find(Fe=>Fe.id===We);if(Ae&&!Ae.is_project&&be.is_project){x({msg:"",type:"error"});return}}}let et=-1e4,mt=9999999999;const tt=be=>be.view_orders&&be.view_orders[J]!==void 0?be.view_orders[J]:J==="today"?9e8+new Date(be.created_at).getTime()/1e3:be.order_index||0;let ct=null;if(K==="today"){const be=te=>te.start_date?new Date(te.start_date).toISOString().split("T")[0]:te.due_date?new Date(te.due_date).toISOString().split("T")[0]:null;let Ae=null;for(let te=L-1;te>=0&&!(!fe.includes(B[te].data.id)&&(Ae=be(B[te].data),Ae));te--);let Fe=null;for(let te=L;te<B.length&&!(!fe.includes(B[te].data.id)&&(Fe=be(B[te].data),Fe));te++);const bt=oe.anchorTaskIndex;if(bt!==null&&bt>=0&&bt<B.length){const te=B[bt].data;fe.includes(te.id)||(ct=be(te))}ct||(ct=Ae||Fe),ct||(ct=new Date().toISOString().split("T")[0]);const rt=B.map((te,Oe)=>({...te,originalIndex:Oe})).filter(te=>!fe.includes(te.data.id)&&be(te.data)===ct),gt=rt.filter(te=>te.originalIndex<L),Ve=rt.filter(te=>te.originalIndex>=L);if(gt.length>0){const te=gt[gt.length-1];et=tt(te.data)}if(Ve.length>0){const te=Ve[0];mt=tt(te.data)}}else{for(let be=L-1;be>=0;be--){const Ae=B[be];if(!fe.includes(Ae.data.id)){if(Ae.depth===W){et=tt(Ae.data);break}else if(Ae.depth<W)break}}for(let be=L;be<B.length;be++){const Ae=B[be];if(!fe.includes(Ae.data.id)){if(Ae.depth===W){mt=tt(Ae.data);break}else if(Ae.depth<W)break}}}et===-1e4&&mt===9999999999?(et=0,mt=2e4):et===-1e4?et=mt-2e4:mt===9999999999&&(mt=et+2e4);const He=ze.length,Ee=(mt-et)/(He+1),$e=ze.map((be,Ae)=>{const Fe=et+Ee*(Ae+1),bt={...be.view_orders||{},[J]:Fe},rt={id:be.id,view_orders:bt};return K!=="today"&&(rt.parent_id=We),K==="today"&&ct&&(rt.start_date=ct,rt.is_all_day=!0),rt});ys($e)},So=async($,F)=>{const L=q.current,W=L.find(We=>We.id===$);if(!W)return;Ot($);const B=K==="allview"||K==="project"?"inbox":K,J=We=>We.view_orders&&We.view_orders[B]!==void 0?We.view_orders[B]:B==="today"?9e8+new Date(We.created_at).getTime()/1e3:We.order_index||0,Re=g.includes($)?K==="today"?g:g.filter(We=>{const et=L.find(mt=>mt.id===We);return et&&(et.parent_id||null)===(W.parent_id||null)}):[$],ze=L.filter(We=>Re.includes(We.id)).sort((We,et)=>J(We)-J(et));if(F==="up"||F==="down"){const We=K==="today";let et=[];if(K==="project")et=L.filter(He=>(He.parent_id||null)===(W.parent_id||null)&&He.status!=="deleted"&&He.status!=="logged").sort((He,Ee)=>J(He)-J(Ee));else if(We){const He=be=>be.start_date?new Date(be.start_date).toISOString().split("T")[0]:be.due_date?new Date(be.due_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],Ee=He(W),$e=new Set(hn.map(be=>be.data.id));$e.add(W.id),et=L.filter(be=>$e.has(be.id)&&He(be)===Ee).sort((be,Ae)=>J(be)-J(Ae))}else et=hn.filter(He=>(He.data.parent_id||null)===(W.parent_id||null)).map(He=>He.data);const mt=ze.map(He=>et.findIndex(Ee=>Ee.id===He.id)).filter(He=>He!==-1);if(mt.length===0)return;const tt=Math.min(...mt),ct=Math.max(...mt);if(F==="up"){if(tt===0){if(We){const Fe=Ve=>{const te=Ve.start_date||Ve.due_date;if(te){const Je=new Date(te);return`${Je.getFullYear()}-${String(Je.getMonth()+1).padStart(2,"0")}-${String(Je.getDate()).padStart(2,"0")}`}const Oe=new Date;return`${Oe.getFullYear()}-${String(Oe.getMonth()+1).padStart(2,"0")}-${String(Oe.getDate()).padStart(2,"0")}`},bt=Fe(W),rt=Array.from(new Set(hn.map(Ve=>Fe(Ve.data)))).sort(),gt=rt.indexOf(bt);if(gt>0){const Ve=rt[gt-1],te=hn.filter(Ye=>Fe(Ye.data)===Ve).map(Ye=>Ye.data).sort((Ye,ft)=>J(Ye)-J(ft));let Oe;te.length>0?Oe=J(te[te.length-1])+1e4:Oe=0;const Je=ze.map((Ye,ft)=>({id:Ye.id,start_date:Ve,view_orders:{...Ye.view_orders||{},[B]:Oe+1e4*ft}}));ys(Je);return}}return}const He=tt-1,Ee=tt-2,$e=J(et[He]),be=Ee>=0?J(et[Ee]):$e-2e4;if($e-be<.1){console.log("[Task Reorder] Gap too small, rebalancing list...");const Fe=new Set(ze.map(Oe=>Oe.id)),bt=et.filter(Oe=>!Fe.has(Oe.id)),rt=et[He];let gt=bt.findIndex(Oe=>Oe.id===rt.id);gt===-1&&(gt=0);const Ve=[...bt];Ve.splice(gt,0,...ze);const te=Ve.map((Oe,Je)=>({id:Oe.id,view_orders:{...Oe.view_orders||{},[B]:1e4*(Je+1)}}));ys(te)}else{const Fe=($e-be)/(ze.length+1),bt=ze.map((rt,gt)=>({id:rt.id,view_orders:{...rt.view_orders||{},[B]:be+Fe*(gt+1)}}));ys(bt)}}else{if(ct===et.length-1){if(We){const Fe=Ve=>{const te=Ve.start_date||Ve.due_date;if(te){const Je=new Date(te);return`${Je.getFullYear()}-${String(Je.getMonth()+1).padStart(2,"0")}-${String(Je.getDate()).padStart(2,"0")}`}const Oe=new Date;return`${Oe.getFullYear()}-${String(Oe.getMonth()+1).padStart(2,"0")}-${String(Oe.getDate()).padStart(2,"0")}`},bt=Fe(W),rt=Array.from(new Set(hn.map(Ve=>Fe(Ve.data)))).sort(),gt=rt.indexOf(bt);if(gt<rt.length-1){const Ve=rt[gt+1],te=hn.filter(Ye=>Fe(Ye.data)===Ve).map(Ye=>Ye.data).sort((Ye,ft)=>J(Ye)-J(ft));let Oe;te.length>0?Oe=J(te[0])-1e4*ze.length:Oe=0;const Je=ze.map((Ye,ft)=>({id:Ye.id,start_date:Ve,view_orders:{...Ye.view_orders||{},[B]:Oe+1e4*ft}}));ys(Je);return}}return}const He=ct+1,Ee=ct+2,$e=J(et[He]),be=Ee<et.length?J(et[Ee]):$e+2e4;if(be-$e<.1){console.log("[Task Reorder] Gap too small (down), rebalancing list...");const Fe=new Set(ze.map(Oe=>Oe.id)),bt=et.filter(Oe=>!Fe.has(Oe.id)),rt=et[He];let gt=bt.findIndex(Oe=>Oe.id===rt.id);gt===-1&&(gt=bt.length);const Ve=[...bt];Ve.splice(gt+1,0,...ze);const te=Ve.map((Oe,Je)=>({id:Oe.id,view_orders:{...Oe.view_orders||{},[B]:1e4*(Je+1)}}));ys(te)}else{const Fe=(be-$e)/(ze.length+1),bt=ze.map((rt,gt)=>({id:rt.id,view_orders:{...rt.view_orders||{},[B]:$e+Fe*(gt+1)}}));ys(bt)}}}else if(F==="right"){if(K==="today"){const He=ze[0],Ee=hn.findIndex(Fe=>Fe.data.id===He.id);if(Ee<=0){x({msg:"",type:"info"});return}const $e=hn[Ee-1].data.id,be=(Fe,bt)=>{let rt=r.find(gt=>gt.id===Fe);for(;rt&&rt.parent_id;){if(rt.parent_id===bt)return!0;rt=r.find(gt=>gt.id===rt.parent_id)}return!1};for(const Fe of ze)if($e===Fe.id||be($e,Fe.id)){x({msg:"",type:"error"});return}const Ae=ze.map(Fe=>({id:Fe.id,parent_id:$e}));ys(Ae),x({msg:` ${ze.length} `,type:"info"});return}let We=null;const et=ze[0];if(K==="project"){const He=L.filter($e=>($e.parent_id||null)===(et.parent_id||null)&&$e.status!=="deleted"&&$e.status!=="logged").sort(($e,be)=>J($e)-J(be)),Ee=He.findIndex($e=>$e.id===et.id);Ee>0&&(We=He[Ee-1].id)}else{const He=hn.findIndex(Ee=>Ee.data.id===et.id);if(He>0){const Ee=hn[He];for(let $e=He-1;$e>=0;$e--){if(hn[$e].depth===Ee.depth){We=hn[$e].data.id;break}if(hn[$e].depth<Ee.depth)break}}}if(!We)return;const mt=L.filter(He=>He.parent_id===We&&He.status!=="deleted"&&He.status!=="logged").sort((He,Ee)=>J(He)-J(Ee));let tt=(mt[mt.length-1]?J(mt[mt.length-1]):0)+1e4;P.includes(We)||Zt(We,!0);const ct=ze.map(He=>{const Ee=tt;return tt+=1e4,{id:He.id,parent_id:We,order_index:Ee,view_orders:{...He.view_orders||{},[B]:Ee}}});ys(ct),x({msg:` ${ze.length} `,type:"info"})}else if(F==="left"){if(K==="today"){const mt=[];let tt=0;for(const ct of ze){if(!ct.parent_id)continue;const He=L.find($e=>$e.id===ct.parent_id);if(!He)continue;const Ee=He.parent_id||null;mt.push({id:ct.id,parent_id:Ee}),tt++}mt.length>0?(ys(mt),x({msg:` ${tt} `,type:"info"})):x({msg:"",type:"info"});return}const We=[];let et=0;for(const mt of ze){if(!mt.parent_id)continue;const tt=L.find(Ae=>Ae.id===mt.parent_id);if(!tt)continue;if(K==="project"){const Ae=a.find(Fe=>Fe.name.trim().toLowerCase()==="project");if(Ae&&tt.tags.includes(Ae.id)){x({msg:" ",type:"info"});continue}}const ct=tt.parent_id,He=L.filter(Ae=>Ae.parent_id===ct&&Ae.status!=="deleted"&&Ae.status!=="logged").sort((Ae,Fe)=>J(Ae)-J(Fe)),Ee=He.findIndex(Ae=>Ae.id===tt.id),$e=He[Ee+1];let be;$e?be=(J(tt)+J($e))/2:be=J(tt)+1e4,We.push({id:mt.id,parent_id:ct,order_index:be,view_orders:{...mt.view_orders||{},[B]:be}}),et++}We.length>0&&(ys(We),x({msg:` ${et} `,type:"info"}))}},ys=async $=>{const F=$.map(J=>{const fe=q.current.find(We=>We.id===J.id),Re={},ze={};return fe&&Object.keys(J).forEach(We=>{We!=="id"&&(Re[We]=fe[We],ze[We]=J[We])}),{id:J.id,before:Re,after:ze}});Pn({type:"BATCH_UPDATE",payload:F});const L=q.current.map(J=>{const fe=$.find(Re=>Re.id===J.id);return fe?{...J,...fe}:J}).sort((J,fe)=>(J.order_index||0)-(fe.order_index||0)||J.created_at.localeCompare(fe.created_at));if(q.current=L,s(L),Ne){const J=Ne;await Promise.all($.map(fe=>J.from("tasks").update(fe).eq("id",fe.id)))}const W=JSON.parse(localStorage.getItem("task_google_map")||"{}"),B=$.filter(J=>W[J.id]&&(J.start_date!==void 0||J.is_all_day!==void 0));B.length>0&&Promise.resolve(localStorage.getItem("google_access_token")).then(async J=>{J&&await Promise.all(B.map(async fe=>{const Re=W[fe.id],ze=L.find(He=>He.id===fe.id);if(!ze)return;const We={},et=fe.is_all_day!==void 0?fe.is_all_day:ze.is_all_day,mt=fe.start_date||ze.start_date;if(!mt)return;const tt=new Date(mt);if(isNaN(tt.getTime()))return;const ct=tt.toLocaleDateString("en-CA");if(et){We.start={date:ct};const He=new Date(tt);He.setDate(He.getDate()+1),We.end={date:He.toLocaleDateString("en-CA")}}else{const He=Ae=>Ae.length===5?Ae+":00":Ae,Ee=He(fe.start_time||ze.start_time||"09:00:00");let $e=ze.end_time?He(ze.end_time):null;if(!$e){const[Ae,Fe]=Ee.split(":").map(Number);$e=`${String((Ae+1)%24).padStart(2,"0")}:${String(Fe).padStart(2,"0")}:00`}const be=Intl.DateTimeFormat().resolvedOptions().timeZone;We.start={dateTime:`${ct}T${Ee}`,timeZone:be},We.end={dateTime:`${ct}T${$e}`,timeZone:be}}try{const He=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${Re.calId}/events/${Re.evtId}`,{method:"PATCH",headers:{Authorization:`Bearer ${J}`,"Content-Type":"application/json"},body:JSON.stringify(We)});if(!He.ok){const Ee=await He.text();console.error("Batch Google Sync Failed",Ee),He.status===401&&x({msg:"Google  Google",type:"error"})}}catch(He){console.error("Google Batch Sync Error",He)}}))})},_o=async($,F=[],L)=>{if(!Ne)return"";m("syncing");const W=L||ll(),B=r.length>0?Math.max(...r.map(et=>et.order_index||0)):0,J=$.order_index!==void 0?$.order_index:B+1e4;Ot(W);const fe={...$,id:W,user_id:e.id,parent_id:$.parent_id||null,created_at:new Date().toISOString(),tags:$.tags||[],images:$.images||[],order_index:J,view_orders:$.view_orders||{},is_all_day:$.is_all_day||!1,start_time:$.start_time||null,end_time:$.end_time||null,duration:$.duration||null,reviewed_at:null,dependencies:$.dependencies||[]};Pn({type:"ADD",payload:{data:fe}}),s(et=>{const mt=[...et,fe].sort((tt,ct)=>(tt.order_index||0)-(ct.order_index||0)||tt.created_at.localeCompare(ct.created_at));return q.current=mt,mt});const{error:Re}=await Ne.from("tasks").insert([fe]);if(Re)return console.error("Task Insert Error:",Re),s(et=>et.filter(mt=>mt.id!==W)),Rt(Re),"";const ze=a.find(et=>(fe.tags||[]).includes(et.id)&&et.name.startsWith("Google:")),We=fe.start_date&&(fe.start_time||fe.is_all_day);if(ze&&We){const et=localStorage.getItem("google_access_token");if(et){console.log("[Google Sync] New task has Google tag, creating event...");const mt=ze.name.replace("Google:","").trim();xl(et).then(async tt=>{const ct=tt.find(Ae=>Ae.summary===mt),He=ct?ct.id:"primary",Ee={summary:fe.title,description:fe.description||""},$e=new Date(fe.start_date).toLocaleDateString("en-CA"),be=Intl.DateTimeFormat().resolvedOptions().timeZone;if(fe.is_all_day){Ee.start={date:$e};const Ae=new Date($e),Fe=new Date(Ae);Fe.setDate(Fe.getDate()+1),Ee.end={date:Fe.toLocaleDateString("en-CA")}}else if(fe.start_time){const Ae=fe.start_time.length>5?fe.start_time.substring(0,5):fe.start_time,Fe=`${$e}T${Ae}:00`;let bt="";if(fe.end_time)bt=fe.end_time.length>5?fe.end_time.substring(0,5):fe.end_time;else{const rt=new Date(Fe);rt.setHours(rt.getHours()+1),bt=`${String(rt.getHours()).padStart(2,"0")}:${String(rt.getMinutes()).padStart(2,"0")}`}Ee.start={dateTime:Fe,timeZone:be},Ee.end={dateTime:`${$e}T${bt}:00`,timeZone:be}}if(Ee.start)try{const Ae=await No(et,He,Ee);if(Ae){const Fe=JSON.parse(localStorage.getItem("task_google_map")||"{}");Fe[W]={evtId:Ae,calId:He},localStorage.setItem("task_google_map",JSON.stringify(Fe)),console.log("[Google Sync] Created event for new task:",W,"eventId:",Ae),x({msg:"Google ",type:"info"})}}catch(Ae){console.error("[Google Sync] Failed to create event for new task:",Ae)}}).catch(tt=>console.error("[Google Sync] Calendar list fetch failed:",tt))}}return m("synced"),W},sl=async($,F=null,L)=>{if(!Ne)return;m("syncing");let W=q.current.length>0?Math.max(...q.current.map(et=>et.order_index||0)):0;const B=[],J=new Date().toISOString(),fe=(et,mt)=>{for(const tt of et){W+=1e4;const ct=tt.id||ll();Ot(ct);const He={id:ct,user_id:e.id,parent_id:mt,created_at:J,title:tt.title,description:tt.description,start_date:tt.start_date||null,due_date:tt.due_date||null,order_index:W,view_orders:{today:0},dependencies:tt.dependencies||[],is_all_day:tt.is_all_day!==void 0?tt.is_all_day:!0,start_time:tt.start_time||null,end_time:tt.end_time||null,duration:tt.duration||null,color:tt.color,tags:tt.tags||[],status:tt.status||"todo",images:tt.images||[],reviewed_at:null,reminder_minutes:tt.reminder_minutes||null,google_event_id:tt.google_event_id||null,google_calendar_id:tt.google_calendar_id||null};B.push(He),tt.subtasks&&tt.subtasks.length>0&&fe(tt.subtasks,ct)}};if(fe($,F),B.length===0)return;s(et=>{const mt=[...et,...B].sort((tt,ct)=>(tt.order_index||0)-(ct.order_index||0)||tt.created_at.localeCompare(ct.created_at));return q.current=mt,mt});const Re=500;let ze=0;const We=B.length;try{const et=JSON.parse(localStorage.getItem("task_google_map")||"{}");for(let mt=0;mt<We;mt+=Re){const tt=B.slice(mt,mt+Re),ct=tt.map(Ee=>{const{google_event_id:$e,google_calendar_id:be,...Ae}=Ee;return Ae}),{error:He}=await Ne.from("tasks").insert(ct);if(He){console.error("Batch insert error in chunk "+mt,He),Rt(He);break}tt.forEach(Ee=>{Ee.google_event_id&&Ee.google_calendar_id&&(et[Ee.id]={evtId:Ee.google_event_id,calId:Ee.google_calendar_id})}),ze+=tt.length,L&&L(ze,We),await new Promise(Ee=>setTimeout(Ee,10))}localStorage.setItem("task_google_map",JSON.stringify(et))}catch(et){console.error("Batch process failed",et)}m("synced")},Yn=async $=>{if(!Ne||$.length===0)return[];m("syncing");const F=[],L=new Map,W=J=>{const fe=q.current.filter(ze=>ze.parent_id===J);let Re=[];return fe.forEach(ze=>{Re.push(ze),Re=[...Re,...W(ze.id)]}),Re};let B=q.current.length>0?Math.max(...q.current.map(J=>J.order_index||0)):0;try{for(const J of $){const fe=q.current.find(et=>et.id===J);if(!fe)continue;const Re=W(J);B+=1e4;const ze=ll();L.set(J,ze);const We={...fe,id:ze,title:fe.title+" ()",created_at:new Date().toISOString(),order_index:B,view_orders:{},reviewed_at:null};delete We.user_id,await _o(We,[],ze),F.push(ze);for(const et of Re){B+=1e4;const mt=ll();L.set(et.id,mt);const tt=L.get(et.parent_id)||et.parent_id,ct={...et,id:mt,parent_id:tt,created_at:new Date().toISOString(),order_index:B,view_orders:{},reviewed_at:null};delete ct.user_id,await _o(ct,[],mt)}}}catch(J){Rt(J)}finally{m("synced")}return F},Pr=async($,F,L=[],W)=>{var ct,He;if(console.warn("[updateTask] CALLED:",$,"status:",F.status),!Ne)return;const B=r.find(Ee=>Ee.id===$);if(B&&st(B)&&!(W!=null&&W.skipGoogleLockCheck)){console.warn("[updateTask] BLOCKED: Task is locked via Google tag:",$),x({msg:" Google ",type:"error"});return}if(m("syncing"),Ot($),K==="inbox"&&B&&!B.parent_id){const Ee=a.find(Nt=>Nt.name.trim().toLowerCase()==="project"),$e=a.find(Nt=>Nt.name.includes("")),be=a.find(Nt=>Nt.name.trim().toLowerCase()==="note"),Ae=a.find(Nt=>Nt.name.trim().toLowerCase()==="prompt"),Fe=a.find(Nt=>Nt.name==="#prompt"),bt=a.find(Nt=>Nt.name.trim().toLowerCase()==="journal"),rt=a.find(Nt=>Nt.name.trim().toLowerCase()==="someday"),gt=a.find(Nt=>["annual","annualplan","",""].some(jt=>Nt.name.trim().toLowerCase().includes(jt))),Ve=a.find(Nt=>["schedule",""].includes(Nt.name.trim().toLowerCase())),te=F.tags||B.tags||[],Oe=B.tags||[],Je=F.tags&&(Ee&&te.includes(Ee.id)&&!Oe.includes(Ee.id)||$e&&te.includes($e.id)&&!Oe.includes($e.id)||be&&te.includes(be.id)&&!Oe.includes(be.id)||Ae&&te.includes(Ae.id)&&!Oe.includes(Ae.id)||Fe&&te.includes(Fe.id)&&!Oe.includes(Fe.id)||bt&&te.includes(bt.id)&&!Oe.includes(bt.id)||rt&&te.includes(rt.id)&&!Oe.includes(rt.id)||gt&&te.includes(gt.id)&&!Oe.includes(gt.id)||Ve&&te.includes(Ve.id)&&!Oe.includes(Ve.id)),Ye=F.status&&(F.status==="someday"||F.status==="waiting")&&B.status!=="someday"&&B.status!=="waiting";(F.start_date&&!B.start_date||F.due_date&&!B.due_date||F.parent_id&&!B.parent_id||Je||Ye)&&!Ke.current.includes($)&&dn($)}if(B&&!(W!=null&&W.skipHistory)){const Ee={};let $e=!1;Object.keys(F).forEach(be=>{const Ae=B[be],Fe=F[be];Ee[be]=Ae,Array.isArray(Ae)||Array.isArray(Fe)||Ae&&typeof Ae=="object"?JSON.stringify(Ae)!==JSON.stringify(Fe)&&($e=!0):Ae!==Fe&&($e=!0)}),$e&&Pn({type:"UPDATE",payload:{id:$,before:Ee,after:F}})}if(F.start_date&&B){const Ee=new Date().toISOString().split("T")[0],$e=F.start_date===Ee||F.start_date.startsWith(Ee),be=((ct=B.view_orders)==null?void 0:ct.today)!==void 0;if($e&&!be){const Ae=q.current.filter(rt=>{const gt=rt.start_date||rt.due_date;return gt&&(gt===Ee||gt.startsWith(Ee))});let Fe=0;Ae.forEach(rt=>{var Ve;const gt=((Ve=rt.view_orders)==null?void 0:Ve.today)??rt.order_index??0;gt>Fe&&(Fe=gt)});const bt=Fe+1e4;F.view_orders={...B.view_orders||{},...F.view_orders||{},today:bt}}}const J=F.completed_at&&(!B||!B.completed_at);let fe=[];if(J){const Ee=$e=>{const Ae=q.current.filter(bt=>bt.parent_id===$e&&!bt.completed_at).map(bt=>bt.id),Fe=Ae.flatMap(bt=>Ee(bt));return[...Ae,...Fe]};fe=Ee($)}s(Ee=>{const $e=new Date().toISOString();let be=Ee.map(Ae=>Ae.id===$?{...Ae,...F,updated_at:$e}:Ae);return fe.length>0&&(be=be.map(Ae=>fe.includes(Ae.id)?{...Ae,completed_at:F.completed_at,status:"completed",updated_at:$e}:Ae)),q.current=be,be});const{google_event_id:Re,google_calendar_id:ze,...We}=F,{error:et}=await Ne.from("tasks").update(We).eq("id",$);if(et){B&&s(Ee=>{const $e=Ee.map(be=>be.id===$?B:be);return q.current=$e,$e}),Rt(et);return}else{console.log("[updateTask] Database update successful, proceeding to Google sync check");const Ee=JSON.parse(localStorage.getItem("task_google_map")||"{}");Re&&ze&&(Ee[$]={evtId:Re,calId:ze},localStorage.setItem("task_google_map",JSON.stringify(Ee)));const $e=Ee[$];if(F.status==="deleted"&&console.log("[Google Sync Check] Task being deleted:",$,"Has Google mapping:",!!$e),B&&$e&&$e.evtId!=="PENDING"){const be=localStorage.getItem("google_access_token");if(be){const Ae={...B,...F},Fe={};if(F.tags!==void 0){const rt=a.find(Ve=>(B.tags||[]).includes(Ve.id)&&Ve.name.startsWith("Google:")),gt=a.find(Ve=>(F.tags||[]).includes(Ve.id)&&Ve.name.startsWith("Google:"));if(rt&&gt&&rt.id!==gt.id){console.log("[Google Sync] Calendar tag changed from",rt.name,"to",gt.name),rt.name.replace("Google:","").trim();const Ve=gt.name.replace("Google:","").trim();xl(be).then(async te=>{var Je;const Oe=te.find(Ye=>Ye.summary===Ve);if(Oe)try{await ia(be,$e.calId,$e.evtId),console.log("[Google Sync] Deleted event from old calendar:",$e.calId);const Ye={summary:Ae.title,description:Ae.description||""},ft=(Je=Ae.start_date)==null?void 0:Je.split("T")[0],Nt=Intl.DateTimeFormat().resolvedOptions().timeZone;if(Ae.is_all_day&&ft){Ye.start={date:ft};const jt=new Date(ft);jt.setDate(jt.getDate()+1),Ye.end={date:jt.toISOString().split("T")[0]}}else if(Ae.start_time&&ft){const jt=(Ae.start_time||"").substring(0,5);Ye.start={dateTime:`${ft}T${jt}:00`,timeZone:Nt};const Bt=Ae.end_time?Ae.end_time.substring(0,5):(()=>{const Xt=new Date(`${ft}T${jt}:00`);return Xt.setHours(Xt.getHours()+1),`${String(Xt.getHours()).padStart(2,"0")}:${String(Xt.getMinutes()).padStart(2,"0")}`})();Ye.end={dateTime:`${ft}T${Bt}:00`,timeZone:Nt}}if(Ye.start){const jt=await No(be,Oe.id,Ye);if(jt){const Bt=JSON.parse(localStorage.getItem("task_google_map")||"{}");Bt[$]={evtId:jt,calId:Oe.id},localStorage.setItem("task_google_map",JSON.stringify(Bt)),console.log("[Google Sync] Moved event to new calendar:",Oe.id,"new event ID:",jt),x({msg:` ${Ve}`,type:"info"})}}}catch(Ye){console.error("[Google Sync] Calendar move failed:",Ye),x({msg:"",type:"error"})}}).catch(te=>console.error("[Google Sync] Failed to fetch calendars for move:",te));return}}if(!(F.title!==void 0||F.status!==void 0||F.start_date!==void 0||F.start_time!==void 0||F.end_time!==void 0||F.is_all_day!==void 0))return;if(F.title!==void 0&&F.title!==B.title&&(Fe.summary=Ae.title),F.description!==void 0&&F.description!==B.description&&(Fe.description=Ae.description||""),F.status==="deleted"){console.log("[Google Sync] Task moved to trash, calling DELETE API"),ia(be,$e.calId,$e.evtId).then(()=>{x({msg:"Google ",type:"info"});const rt=JSON.parse(localStorage.getItem("task_google_map")||"{}");delete rt[$],localStorage.setItem("task_google_map",JSON.stringify(rt))}).catch(rt=>console.error("Google Delete Error",rt));return}else F.status&&B.status==="deleted"&&(Fe.status="confirmed",console.log("[Google Sync] Task restored, setting event status to confirmed"),Fe.status="confirmed",console.log("[Google Sync] Task restored, setting event status to confirmed"));try{const rt=Ye=>{if(!Ye)return null;if(typeof Ye=="string"){const ft=Ye.match(/^(\d{4}-\d{2}-\d{2})/);return ft?ft[1]:null}return null},gt=Ye=>{if(!Ye)return null;if(typeof Ye=="string"){const ft=Ye.match(/^(\d{1,2}):(\d{2})/);if(ft)return`${ft[1].padStart(2,"0")}:${ft[2]}`}return null};if((F.start_date!==void 0&&rt(F.start_date)!==rt(B.start_date)||F.start_time!==void 0&&gt(F.start_time)!==gt(B.start_time)||F.end_time!==void 0&&gt(F.end_time)!==gt(B.end_time)||F.is_all_day!==void 0&&F.is_all_day!==B.is_all_day)&&Ae.start_date){const Ye=Intl.DateTimeFormat().resolvedOptions().timeZone,ft=rt(Ae.start_date),Nt=jt=>{if(!jt)return null;if(typeof jt=="string"){const Bt=jt.match(/^(\d{1,2}):(\d{2})(?::(\d{2}))?/);if(Bt){const Xt=Bt[1].padStart(2,"0"),rn=Bt[2],sn=Bt[3]||"00";return`${Xt}:${rn}:${sn}`}}return null};if(Ae.is_all_day&&ft){Fe.start={date:ft};const jt=new Date(ft);jt.setDate(jt.getDate()+1);const Bt=jt.toISOString().split("T")[0];Fe.end={date:Bt}}else if(ft&&Ae.start_time){const jt=Nt(Ae.start_time);if(jt){const Bt=`${ft}T${jt}`;Fe.start={dateTime:Bt,timeZone:Ye};let Xt="";const rn=Nt(Ae.end_time);if(rn)Xt=`${ft}T${rn}`;else{const sn=new Date(Bt),Rn=new Date(sn.getTime()+60*60*1e3),gr=String(Rn.getHours()).padStart(2,"0"),Xn=String(Rn.getMinutes()).padStart(2,"0");Xt=`${ft}T${gr}:${Xn}:00`}Fe.end={dateTime:Xt,timeZone:Ye}}}}if(Fe.start||Fe.end){const Ye=Fe.start&&(Fe.start.date||Fe.start.dateTime),ft=Fe.end&&(Fe.end.date||Fe.end.dateTime);(!Ye||!ft)&&(delete Fe.start,delete Fe.end,console.log("[Google Sync] Removed invalid date objects from payload"))}const Oe=Object.keys(Fe).length>0&&(Fe.summary||Fe.status||Fe.start&&Fe.end);if(F.is_all_day!==void 0&&B.is_all_day!==F.is_all_day&&Fe.start&&Fe.end){console.log("[Google Sync] Event TYPE change detected (is_all_day:",B.is_all_day,"->",F.is_all_day,"), using delete+create"),jn.current=!0;const Ye=$e.evtId;Ln.current.add(Ye),(async()=>{try{await ia(be,$e.calId,Ye);const ft={summary:Ae.title,description:Ae.description||"",start:Fe.start,end:Fe.end},Nt=await No(be,$e.calId,ft);Ln.current.add(Nt);const jt=JSON.parse(localStorage.getItem("task_google_map")||"{}");jt[$]={evtId:Nt,calId:$e.calId},localStorage.setItem("task_google_map",JSON.stringify(jt)),x({msg:"Google ",type:"info"}),console.log("[Google Sync] Event type change completed with new ID:",Nt)}catch(ft){console.error("Failed to recreate event:",ft),x({msg:"Google : ",type:"error"})}finally{jn.current=!1}})()}else Oe&&(console.log("[Google Sync] Updating event:",$e.evtId),console.log("[Google Sync] Full payload:",JSON.stringify(Fe,null,2)),Xx(be,$e.calId,$e.evtId,Fe).then(()=>x({msg:"Google ",type:"info"})).catch(async Ye=>{console.error("Google Update Error",Ye,"Payload:",Fe),(Ye.message||"").includes("conflict")||x({msg:`Google : ${Ye.message}`,type:"error"})}))}catch(rt){console.error("Date parsing error",rt)}}}}const tt=JSON.parse(localStorage.getItem("task_google_map")||"{}")[$];if(B&&!tt&&B.status==="deleted"&&F.status&&F.status!=="deleted"){const Ee=localStorage.getItem("google_access_token"),$e={...B,...F},be=$e.start_date&&($e.start_time||$e.is_all_day);if(Ee&&be){console.log("[Google Sync] Task restored from trash. Recreating Google Event..."),x({msg:" Google ...",type:"info"});const Ae={summary:$e.title,description:$e.description||""},Fe=$e.start_date.split("T")[0];if($e.is_all_day){Ae.start={date:Fe};const bt=new Date(Fe);bt.setDate(bt.getDate()+1),Ae.end={date:bt.toISOString().split("T")[0]}}else if($e.start_time){const bt=$e.start_time.length>5?$e.start_time.substring(0,5):$e.start_time,rt=`${Fe}T${bt}:00`;let gt="";if($e.end_time)gt=$e.end_time.length>5?$e.end_time.substring(0,5):$e.end_time;else{const Oe=new Date(rt);Oe.setHours(Oe.getHours()+1);const Je=String(Oe.getHours()).padStart(2,"0"),Ye=String(Oe.getMinutes()).padStart(2,"0");gt=`${Je}:${Ye}`}const Ve=`${Fe}T${gt}:00`,te=Intl.DateTimeFormat().resolvedOptions().timeZone;Ae.start={dateTime:rt,timeZone:te},Ae.end={dateTime:Ve,timeZone:te}}Ae.start&&No(Ee,"primary",Ae).then(bt=>{if(bt){const rt=JSON.parse(localStorage.getItem("task_google_map")||"{}");rt[$]={evtId:bt,calId:"primary"},localStorage.setItem("task_google_map",JSON.stringify(rt)),x({msg:"Google ",type:"info"})}}).catch(bt=>console.error("Restore Google Error:",bt))}}if(B&&!tt){const Ee={...B,...F,completed_at:null},$e=F.tags!==void 0?F.tags:B.tags||[],be=a.find(Fe=>$e.includes(Fe.id)&&Fe.name.startsWith("Google:")),Ae=Ee.start_date&&(Ee.start_time||Ee.is_all_day);if(be&&Ae&&Ee.status!=="deleted"){const Fe=localStorage.getItem("google_access_token");if(Fe){const bt=JSON.parse(localStorage.getItem("task_google_map")||"{}");if(((He=bt[$])==null?void 0:He.evtId)==="PENDING")return;bt[$]={evtId:"PENDING",calId:"primary"},localStorage.setItem("task_google_map",JSON.stringify(bt)),console.log("[Google Sync] Found Google Tag:",be.name,"Creating event..."),x({msg:" Google ...",type:"info"});const rt=be.name.replace("Google:","").trim();let gt="primary";xl(Fe).then(async Ve=>{var ft;const te=Ve.find(Nt=>Nt.summary===rt);te?(gt=te.id,console.log("[Google Sync] Resolved Calendar ID:",gt)):console.warn("[Google Sync] Calendar not found:",rt,"Using primary.");const Oe={summary:Ee.title,description:Ee.description||""},Je=new Date(Ee.start_date).toLocaleDateString("en-CA"),Ye=Intl.DateTimeFormat().resolvedOptions().timeZone;if(Ee.is_all_day){Oe.start={date:Je};const Nt=new Date(Je),jt=new Date(Nt);jt.setDate(jt.getDate()+1),Oe.end={date:jt.toLocaleDateString("en-CA")}}else if(Ee.start_time){const Nt=Ee.start_time.length>5?Ee.start_time.substring(0,5):Ee.start_time,jt=`${Je}T${Nt}:00`;let Bt="";if(Ee.end_time)Bt=Ee.end_time.length>5?Ee.end_time.substring(0,5):Ee.end_time;else{const rn=new Date(jt);rn.setHours(rn.getHours()+1);const sn=String(rn.getHours()).padStart(2,"0"),Rn=String(rn.getMinutes()).padStart(2,"0");Bt=`${sn}:${Rn}`}const Xt=`${Je}T${Bt}:00`;Oe.start={dateTime:jt,timeZone:Ye},Oe.end={dateTime:Xt,timeZone:Ye}}if(Oe.start)try{const Nt=await No(Fe,gt,Oe);if(Nt){const jt=JSON.parse(localStorage.getItem("task_google_map")||"{}");jt[$]={evtId:Nt,calId:gt},localStorage.setItem("task_google_map",JSON.stringify(jt)),x({msg:"Google ",type:"info"})}}catch(Nt){console.error("[Google Sync] Creation failed",Nt);const jt=JSON.parse(localStorage.getItem("task_google_map")||"{}");((ft=jt[$])==null?void 0:ft.evtId)==="PENDING"&&(delete jt[$],localStorage.setItem("task_google_map",JSON.stringify(jt))),x({msg:"Google ",type:"error"})}}).catch(Ve=>{var Oe;console.error("Fetch calendars failed",Ve);const te=JSON.parse(localStorage.getItem("task_google_map")||"{}");((Oe=te[$])==null?void 0:Oe.evtId)==="PENDING"&&(delete te[$],localStorage.setItem("task_google_map",JSON.stringify(te)))})}}}if(fe.length>0&&await Ne.from("tasks").update({completed_at:F.completed_at,status:"completed"}).in("id",fe),L.length>0&&await Ne.from("tasks").update({parent_id:$}).in("id",L),J&&(B!=null&&B.repeat_rule)&&B.repeat_rule.triggerMode!=="on_schedule"){const Ee=Oz(B.start_date||new Date().toISOString(),B.repeat_rule);if(Ee){const $e={user_id:B.user_id,title:B.title,description:B.repeat_rule.copyDescription!==!1?B.description:null,status:"todo",parent_id:B.parent_id,start_date:Ee,due_date:null,is_project:B.is_project,tags:B.tags,color:B.color,order_index:B.order_index,is_all_day:B.is_all_day,start_time:B.is_all_day?null:B.start_time,end_time:B.is_all_day?null:B.end_time,duration:B.duration,reminder_minutes:B.reminder_minutes!==void 0?B.reminder_minutes:null,repeat_rule:B.repeat_rule},{data:be,error:Ae}=await Ne.from("tasks").insert($e).select().single();if(be&&!Ae){s(bt=>{const rt=[...bt,be];return q.current=rt,rt});const Fe=Pz(B.repeat_rule,(re==null?void 0:re.language)||"zh");x({msg:`  (${Fe})`,type:"info"})}}}m("synced")},Un=async($,F)=>{if(!Ne||$.length===0)return;const L=$.filter(({id:He})=>{const Ee=q.current.find($e=>$e.id===He);return Ee&&st(Ee)});L.length>0&&(console.warn("[batchUpdateTasks] BLOCKED:",L.length,"tasks are locked via Google tag"),x({msg:`${L.length}  Google `,type:"error"}));const W=$.filter(({id:He})=>{const Ee=q.current.find($e=>$e.id===He);return!Ee||!st(Ee)});if(W.length===0)return;const B=W;if(m("syncing"),K==="inbox"){const He=a.find(rt=>rt.name.trim().toLowerCase()==="project"),Ee=a.find(rt=>rt.name.includes("")),$e=a.find(rt=>rt.name.trim().toLowerCase()==="note"),be=a.find(rt=>rt.name.trim().toLowerCase()==="prompt"),Ae=a.find(rt=>rt.name==="#prompt"),Fe=a.find(rt=>rt.name.trim().toLowerCase()==="journal"),bt=a.find(rt=>rt.name.trim().toLowerCase()==="someday");B.forEach(({id:rt,data:gt})=>{const Ve=q.current.find(te=>te.id===rt);if(Ve&&!Ve.parent_id){const te=gt.tags||Ve.tags||[],Oe=Ve.tags||[],Je=gt.tags&&(He&&te.includes(He.id)&&!Oe.includes(He.id)||Ee&&te.includes(Ee.id)&&!Oe.includes(Ee.id)||$e&&te.includes($e.id)&&!Oe.includes($e.id)||be&&te.includes(be.id)&&!Oe.includes(be.id)||Ae&&te.includes(Ae.id)&&!Oe.includes(Ae.id)||Fe&&te.includes(Fe.id)&&!Oe.includes(Fe.id)||bt&&te.includes(bt.id)&&!Oe.includes(bt.id)),Ye=gt.status&&(gt.status==="someday"||gt.status==="waiting")&&Ve.status!=="someday"&&Ve.status!=="waiting";(gt.start_date&&!Ve.start_date||gt.due_date&&!Ve.due_date||gt.parent_id&&!Ve.parent_id||Je||Ye)&&!Ke.current.includes(rt)&&dn(rt)}})}const J=JSON.parse(localStorage.getItem("task_google_map")||"{}"),fe=B.map(He=>{const{google_event_id:Ee,google_calendar_id:$e,...be}=He.data;return Ee&&$e&&(J[He.id]={evtId:Ee,calId:$e}),{id:He.id,data:be}});localStorage.setItem("task_google_map",JSON.stringify(J));const Re=localStorage.getItem("google_access_token"),ze=[];let We=!1;Re&&$.forEach(({id:He,data:Ee})=>{const $e=q.current.find(be=>be.id===He);if($e&&$e.status==="deleted"&&Ee.status&&Ee.status!=="deleted"&&!J[He]){const be={...$e,...Ee};be.start_date&&(be.start_time||be.is_all_day)&&(We=!0,ze.push((async()=>{try{console.log("[batchUpdateTasks] Restoring Google Event for:",He);const Fe={summary:be.title,description:be.description||""},bt=be.start_date.split("T")[0];if(be.is_all_day){Fe.start={date:bt};const rt=new Date(bt);rt.setDate(rt.getDate()+1),Fe.end={date:rt.toISOString().split("T")[0]}}else if(be.start_time){const rt=be.start_time.length>5?be.start_time.substring(0,5):be.start_time,gt=`${bt}T${rt}:00`;let Ve="";if(be.end_time)Ve=be.end_time.length>5?be.end_time.substring(0,5):be.end_time;else{const Je=new Date(gt);Je.setHours(Je.getHours()+1);const Ye=String(Je.getHours()).padStart(2,"0"),ft=String(Je.getMinutes()).padStart(2,"0");Ve=`${Ye}:${ft}`}const te=`${bt}T${Ve}:00`,Oe=Intl.DateTimeFormat().resolvedOptions().timeZone;Fe.start={dateTime:gt,timeZone:Oe},Fe.end={dateTime:te,timeZone:Oe}}if(Fe.start){const rt=await No(Re,"primary",Fe);rt&&(J[He]={evtId:rt,calId:"primary"})}}catch(Fe){console.error("[batchUpdateTasks] Restore Error",Fe)}})()))}}),We&&(x({msg:" Google ...",type:"info"}),await Promise.all(ze),localStorage.setItem("task_google_map",JSON.stringify(J)));const et=[];let mt=!1;Re&&$.forEach(({id:He,data:Ee})=>{const $e=q.current.find(bt=>bt.id===He);if(!$e||Ee.status==="deleted"||$e.status==="deleted"&&Ee.status&&Ee.status!=="deleted")return;const Ae={...$e,...Ee},Fe=J[He];if(Fe){const bt={};if(Ee.title&&(bt.summary=Ee.title),Ee.description!==void 0&&(bt.description=Ee.description),Ee.start_date||Ee.start_time||Ee.end_time||Ee.is_all_day!==void 0){const Ve=new Date(Ae.start_date).toLocaleDateString("en-CA"),te=Intl.DateTimeFormat().resolvedOptions().timeZone;if(console.log("[Batch Sync] Date change detected:",{taskId:He,is_all_day:Ae.is_all_day,start_time:Ae.start_time,end_time:Ae.end_time,dateStr:Ve}),Ae.is_all_day){bt.start={date:Ve};const Oe=new Date(Ve);Oe.setDate(Oe.getDate()+1),bt.end={date:Oe.toLocaleDateString("en-CA")}}else{const Oe=Ae.start_time||"09:00",Je=Ae.end_time||"10:00",Ye=Oe.length>5?Oe.substring(0,5):Oe,ft=`${Ve}T${Ye}:00`,Nt=Je.length>5?Je.substring(0,5):Je;bt.end={dateTime:`${Ve}T${Nt}:00`,timeZone:te},bt.start={dateTime:ft,timeZone:te}}console.log("[Batch Sync] Payload constructed:",JSON.stringify(bt,null,2))}if(Ee.is_all_day!==void 0&&$e.is_all_day!==Ee.is_all_day&&bt.start&&bt.end){console.log("[Batch Sync] Event TYPE change detected (is_all_day:",$e.is_all_day,"->",Ee.is_all_day,"), using delete+create"),mt=!0,jn.current=!0;const Ve=Fe.evtId;Ln.current.add(Ve),console.log("[Batch Sync] Marked old event as replaced:",Ve),et.push((async()=>{try{await ia(Re,Fe.calId,Ve),console.log("[Batch Sync] Old event deleted");const te={summary:Ae.title,description:Ae.description||"",start:bt.start,end:bt.end},Oe=await No(Re,Fe.calId,te);console.log("[Batch Sync] New event created:",Oe),Ln.current.add(Oe),console.log("[Batch Sync] Marked new event to skip in sync:",Oe);const Je=JSON.parse(localStorage.getItem("task_google_map")||"{}");Je[He]={evtId:Oe,calId:Fe.calId},localStorage.setItem("task_google_map",JSON.stringify(Je)),J[He]={evtId:Oe,calId:Fe.calId},console.log("[Batch Sync] Event type change completed successfully")}catch(te){console.error("[Batch Sync] Failed to recreate event:",te.message)}finally{jn.current=!1}})())}else Object.keys(bt).length>0&&(mt=!0,et.push(Xx(Re,Fe.calId,Fe.evtId,bt).then(()=>console.log("[Batch Sync] Update success for task:",He)).catch(async Ve=>{const te=Ve.message||"";console.error("[Batch Sync] Update failed for task:",He,"Error:",te)})))}else{const bt=Ee.tags!==void 0?Ee.tags:$e.tags||[],rt=a.find(Ve=>bt.includes(Ve.id)&&Ve.name.startsWith("Google:")),gt=Ae.start_date&&(Ae.start_time||Ae.is_all_day);rt&&gt&&(mt=!0,et.push((async()=>{try{const Ve=rt.name.replace("Google:","").trim();let te="primary";const Je=(await xl(Re)).find(jt=>jt.summary===Ve);Je&&(te=Je.id);const Ye={summary:Ae.title,description:Ae.description||""},ft=new Date(Ae.start_date).toLocaleDateString("en-CA"),Nt=Intl.DateTimeFormat().resolvedOptions().timeZone;if(Ae.is_all_day){Ye.start={date:ft};const jt=new Date(ft);jt.setDate(jt.getDate()+1),Ye.end={date:jt.toLocaleDateString("en-CA")}}else if(Ae.start_time){const jt=Ae.start_time.length>5?Ae.start_time.substring(0,5):Ae.start_time,Bt=`${ft}T${jt}:00`;let Xt="";if(Ae.end_time)Xt=Ae.end_time.length>5?Ae.end_time.substring(0,5):Ae.end_time;else{const rn=new Date(Bt);rn.setHours(rn.getHours()+1);const sn=String(rn.getHours()).padStart(2,"0"),Rn=String(rn.getMinutes()).padStart(2,"0");Xt=`${sn}:${Rn}`}Ye.start={dateTime:Bt,timeZone:Nt},Ye.end={dateTime:`${ft}T${Xt}:00`,timeZone:Nt}}if(Ye.start){const jt=await No(Re,te,Ye);jt&&(J[He]={evtId:jt,calId:te})}}catch(Ve){console.error("Batch Create Fail",Ve)}})()))}}),mt&&(x({msg:" Google...",type:"info"}),await Promise.all(et),localStorage.setItem("task_google_map",JSON.stringify(J)));const tt=[];fe.forEach(({id:He,data:Ee})=>{Ot(He);const $e=q.current.find(be=>be.id===He);if($e){const be={};Object.keys(Ee).forEach(Ae=>{be[Ae]=$e[Ae]}),tt.push({id:He,before:be,after:Ee})}}),tt.length>0&&!(F!=null&&F.skipHistory)&&Pn({type:"BATCH_UPDATE",payload:tt});const ct=new Date().toISOString();s(He=>{const Ee=He.map($e=>{const be=fe.find(Ae=>Ae.id===$e.id);return be?{...$e,...be.data,updated_at:ct}:$e});return q.current=Ee,Ee}),await Promise.all(fe.map(({id:He,data:Ee})=>Ne.from("tasks").update(Ee).eq("id",He))),m("synced")},Ni=async($,F=!1)=>{if($.length===0)return;const L=$.filter(fe=>{const Re=q.current.find(ze=>ze.id===fe);return Re&&st(Re)});L.length>0&&(console.warn("[batchDeleteTasks] BLOCKED:",L.length,"tasks are locked via Google tag"),x({msg:`${L.length}  Google `,type:"error"}));const W=$.filter(fe=>{const Re=q.current.find(ze=>ze.id===fe);return!Re||!st(Re)});if(W.length===0)return;const B=W;if(m("syncing"),!F){const fe=JSON.parse(localStorage.getItem("task_google_map")||"{}"),Re=localStorage.getItem("google_access_token");let ze=0;if(Re){const mt=B.map(async tt=>{const ct=fe[tt];if(ct)try{console.log("[batchDeleteTasks] Deleting Google Event:",ct.evtId),await ia(Re,ct.calId,ct.evtId),delete fe[tt],ze++}catch(He){console.error("[batchDeleteTasks] Google Delete Error:",He)}});await Promise.all(mt),ze>0&&localStorage.setItem("task_google_map",JSON.stringify(fe))}const We=B.map(mt=>({id:mt,data:{status:"deleted"}}));await Un(We);const et=ze>0?` ${B.length}  ( ${ze}  Google )`:` ${B.length} `;x({msg:et,undo:()=>Jn()});return}const J=q.current.filter(fe=>B.includes(fe.id));if(J.length===0){m("synced");return}if(Ne)for(const fe of J){if(fe.attachments&&fe.attachments.length>0)for(const Re of fe.attachments)try{const We=new URL(Re.url).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(We){const et=We[1];await Ne.storage.from("attachments").remove([et])}}catch(ze){console.warn("Failed to delete attachment:",ze)}if(fe.images&&fe.images.length>0)for(const Re of fe.images)try{const We=new URL(Re).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(We){const et=We[1];await Ne.storage.from("attachments").remove([et])}}catch(ze){console.warn("Failed to delete image:",ze)}}if(Pn({type:"BATCH_DELETE",payload:{data:J}}),s(fe=>{const Re=fe.filter(ze=>!$.includes(ze.id));return q.current=Re,Re}),Ne)for(let Re=0;Re<$.length;Re+=100){const ze=$.slice(Re,Re+100),{error:We}=await Ne.from("tasks").delete().in("id",ze);We&&console.error("Batch delete chunk error:",We)}m("synced"),x({msg:` ${$.length} `,type:"info"})},ic=async($,F=!1)=>{console.warn("[deleteTask] CALLED! id:",$,"permanent:",F);const L=r.find(W=>W.id===$);if(L&&st(L)){console.warn("[deleteTask] BLOCKED: Task is locked via Google tag:",$),x({msg:" Google ",type:"error"});return}if(m("syncing"),Ot($),!F){if(L){console.log("[deleteTask] Soft deleting task:",$);const W=JSON.parse(localStorage.getItem("task_google_map")||"{}"),B=W[$];if(B){x({msg:" Google ...",type:"info"});const J=localStorage.getItem("google_access_token");J&&(console.log("[deleteTask] Found Google Event, deleting:",B.evtId),ia(J,B.calId,B.evtId).then(()=>{console.log("[deleteTask] Google Event deleted successfully"),x({msg:"Google ",type:"info"}),delete W[$],localStorage.setItem("task_google_map",JSON.stringify(W))}).catch(fe=>{console.error("[deleteTask] Google Delete Error:",fe),x({msg:"Google : "+fe.message,type:"error"})}))}else console.warn("[deleteTask] No Google mapping found for task:",$);await Pr($,{status:"deleted"}),x({msg:" (v2)",undo:()=>Jn()})}return}if(L!=null&&L.attachments&&L.attachments.length>0&&Ne)for(const W of L.attachments)try{const J=new URL(W.url).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(J){const fe=J[1];await Ne.storage.from("attachments").remove([fe])}}catch(B){console.warn("Failed to delete attachment:",B)}if(L!=null&&L.images&&L.images.length>0&&Ne)for(const W of L.images)try{const J=new URL(W).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(J){const fe=J[1];await Ne.storage.from("attachments").remove([fe])}}catch(B){console.warn("Failed to delete image:",B)}if(L&&Pn({type:"DELETE",payload:{data:L}}),s(W=>{const B=W.filter(J=>J.id!==$);return q.current=B,B}),Ne){const{error:W}=await Ne.from("tasks").delete().eq("id",$);if(W){Rt(W),L&&s(B=>{const J=[L,...B];return q.current=J,J});return}else if(L){const J=JSON.parse(localStorage.getItem("task_google_map")||"{}")[L.id];if(J){const fe=localStorage.getItem("google_access_token");fe&&ia(fe,J.calId,J.evtId).then(()=>x({msg:"Google ",type:"info"})).catch(Re=>console.error("Google Delete Error",Re))}}}m("synced"),x({msg:"",type:"info"})},ii=async $=>{const F=r.find(L=>L.id===$);F&&F.status==="deleted"&&(await Pr($,{status:"inbox"}),x({msg:" Inbox",type:"info"}))},Nr=async()=>{const $=r.filter(L=>L.status==="deleted");if($.length===0)return;const F=$.map(L=>({id:L.id,data:{status:"inbox"}}));await Un(F),x({msg:"",type:"info",undo:()=>Jn()})},le=async()=>{const $=r.filter(F=>F.status==="deleted");$.length!==0&&await Ni($.map(F=>F.id),!0)},vt=async $=>{if(!Ne)return;const F=new Date().toISOString();s(L=>L.map(W=>W.id===$?{...W,reviewed_at:F}:W)),await Ne.from("tasks").update({reviewed_at:F}).eq("id",$),x({msg:"",type:"info"})},At=async($,F=null)=>{if(!Ne||!$.trim())return null;const L=ll(),B=a.filter(et=>et.parent_id===F).reduce((et,mt)=>Math.max(et,mt.order_index||0),0)+1e4,J=a.find(et=>et.id===F),fe=(J==null?void 0:J.color)||"#6366f1",Re={id:L,name:$,parent_id:F,user_id:e.id,color:fe,order_index:B};Pn({type:"ADD_TAG",payload:{data:Re}}),l(et=>[...et,Re].sort((mt,tt)=>(mt.order_index||0)-(tt.order_index||0)));const{data:ze,error:We}=await Ne.from("tags").insert([{name:$,parent_id:F,user_id:e.id,color:fe,order_index:B}]).select();return We?(l(et=>et.filter(mt=>mt.id!==L)),null):(l(et=>{const mt=ze[0];return et.some(ct=>ct.id===mt.id)?et.filter(ct=>ct.id!==L):et.map(ct=>ct.id===L?mt:ct).sort((ct,He)=>(ct.order_index||0)-(He.order_index||0))}),ze[0].id)},Mt=async($,F)=>{if(!Ne)return;const L=a.find(W=>W.id===$);if(L){const W={};Object.keys(F).forEach(B=>W[B]=L[B]),Pn({type:"UPDATE_TAG",payload:{id:$,before:W,after:F}})}l(W=>W.map(B=>B.id===$?{...B,...F}:B).sort((B,J)=>(B.order_index||0)-(J.order_index||0))),await Ne.from("tags").update(F).eq("id",$)},Et=async $=>{if(!Ne)return;const F=a.find(L=>L.id===$);F&&Pn({type:"DELETE_TAG",payload:{data:F}}),l(L=>L.filter(W=>W.id!==$)),await Ne.from("tags").delete().eq("id",$)},Zt=($,F)=>{G(L=>{const W=L.includes($),B=F!==void 0?F?W?L:[...L,$]:L.filter(J=>J!==$):W?L.filter(J=>J!==$):[...L,$];return e!=null&&e.id&&localStorage.setItem(`expanded_tasks_${e.id}`,JSON.stringify(B)),B})},vn=$=>{de(F=>{const L=typeof $=="function"?$(F):$;return e!=null&&e.id&&localStorage.setItem(`last_view_${e.id}`,L),L!==F&&ve([]),L})},rr=$=>{ge($),e!=null&&e.id&&localStorage.setItem(`sidebar_width_${e.id}`,$.toString())},Mn=()=>Ue($=>!$),yn=$=>{we(F=>{const L=typeof $=="function"?$(F):$;return e!=null&&e.id&&localStorage.setItem(`expanded_tags_${e.id}`,JSON.stringify(L)),L})},dn=$=>{ve(F=>F.includes($)?F:[...F,$])},Hn=()=>{ve([])},sr=$=>{se(F=>{const L=typeof $=="function"?$(F):$;return e!=null&&e.id&&localStorage.setItem(`theme_settings_${e.id}`,JSON.stringify(L)),L})},ji=async($,F)=>{const L=new Date,W=L.getFullYear(),B=String(L.getMonth()+1).padStart(2,"0"),J=String(L.getDate()).padStart(2,"0"),fe=`${W}-${B}-${J}`,Re=ct=>a.find(He=>ct.some(Ee=>He.name.trim().toLowerCase()===Ee.toLowerCase())),ze=Re(["project",""]),We=Re(["someday"]),et=Re(["journal","note","",""]),mt=Re(["prompt",""]);for(const ct of $){const He=q.current.find(Ee=>Ee.id===ct);if(He)switch(F){case"today":case"newtable":await Pr(ct,{start_date:fe});break;case"project":if(ze){const Ee=He.tags.includes(ze.id)?He.tags:[...He.tags,ze.id];await Pr(ct,{tags:Ee}),q.current.some(be=>be.parent_id===ct&&be.status!=="deleted")||await _o({title:"",parent_id:ct,status:"active",importance:null,tags:[],notes:"",start_date:null,due_date:null})}break;case"waiting":if(We){const Ee=He.tags.includes(We.id)?He.tags:[...He.tags,We.id];await Pr(ct,{tags:Ee,status:"someday"})}else await Pr(ct,{status:"someday"});break;case"journal":if(et){const Ee=He.tags.includes(et.id)?He.tags:[...He.tags,et.id];await Pr(ct,{tags:Ee})}break;case"prompt":if(mt){const Ee=He.tags.includes(mt.id)?He.tags:[...He.tags,mt.id];await Pr(ct,{tags:Ee})}break}}v([]),k(null);const tt={today:"",newtable:"",project:"",waiting:"/",journal:"",prompt:""};x({msg:` ${$.length} ${tt[F]||F}`,type:"info"})},oi=b.useRef(!1),jn=b.useRef(!1),Ln=b.useRef(new Set),mr=async()=>{var F,L,W,B,J,fe;if(console.log("[Google Sync] Attempting sync..."),oi.current){console.log("[Google Sync] Already syncing, skipping.");return}if(jn.current){console.log("[Google Sync] Event recreation in progress, skipping to avoid conflicts.");return}let $=localStorage.getItem("google_access_token");if(!$){console.log("[Google Sync] No token found, skipping.");return}try{const Re=await fetch("https://www.googleapis.com/calendar/v3/users/me/calendarList?maxResults=1",{headers:{Authorization:`Bearer ${$}`}});if(Re.status===401){console.log("[Google Sync] Token expired, attempting silent refresh...");const ze=localStorage.getItem("google_client_id");if(ze&&((L=(F=window.google)==null?void 0:F.accounts)!=null&&L.oauth2))try{const We=await new Promise(et=>{window.google.accounts.oauth2.initTokenClient({client_id:ze,scope:"https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar.readonly",callback:tt=>{tt.error?(console.log("[Google Sync] Silent refresh failed:",tt.error),et(null)):(console.log("[Google Sync] Silent refresh successful!"),et(tt.access_token))}}).requestAccessToken({prompt:""}),setTimeout(()=>et(null),5e3)});if(We)$=We,localStorage.setItem("google_access_token",We),console.log("[Google Sync] Token refreshed successfully");else{console.error("[Google Sync] Silent refresh returned no token"),x({msg:"Google  Google ",type:"error"}),localStorage.removeItem("google_access_token");return}}catch(We){console.error("[Google Sync] Silent refresh error:",We),x({msg:"Google  Google ",type:"error"}),localStorage.removeItem("google_access_token");return}else{console.log("[Google Sync] Google script not loaded, attempting to load...");try{const{loadGoogleScript:We}=await cw(()=>Promise.resolve().then(()=>Lz),void 0);await We(),x({msg:"Google  Google ",type:"error"})}catch{x({msg:"Google  Google ",type:"error"})}localStorage.removeItem("google_access_token");return}}else if(!Re.ok){console.error("[Google Sync] Token validation failed:",Re.status),x({msg:"Google API ",type:"error"});return}}catch(Re){console.error("[Google Sync] Token validation error:",Re),x({msg:" Google ",type:"error"});return}console.log("[Google Sync] Starting sync..."),console.log("[Google Sync] replacedEventIdsRef has",Ln.current.size,"entries:",Array.from(Ln.current)),oi.current=!0;try{const Re=JSON.parse(localStorage.getItem("task_google_map")||"{}"),ze=new Set;Object.values(Re).forEach(be=>{be.calId&&ze.add(be.calId)});let We=[];try{window.google_calendar_list_cache?We=window.google_calendar_list_cache:(We=await xl($),window.google_calendar_list_cache=We)}catch(be){console.error("[Google Sync] List Calendars Check failed",be)}const et=a.filter(be=>be.name.startsWith("Google:"));if(console.log("[Google Sync] Found Google tags:",et.map(be=>be.name)),We.length>0){const be=a.filter(Ae=>Ae.name.startsWith("Google:")).map(Ae=>Ae.name.replace("Google:","").trim());console.log("[Google Sync] Tag names to match:",be),be.forEach(Ae=>{const Fe=We.find(bt=>bt.summary===Ae);console.log(`[Google Sync] Matching "${Ae}" -> ${Fe?Fe.id:"NOT FOUND"}`),Fe&&ze.add(Fe.id)})}else console.log("[Google Sync] No calendars to match against");const mt=JSON.parse(localStorage.getItem("google_sync_tokens")||"{}");let tt=[...q.current];const ct={...Re};let He=!1;console.log("[Google Sync] Syncing calendars:",Array.from(ze));for(const be of Array.from(ze)){const Ae=mt[be];console.log(`[Google Sync] Checking calendar: ${be}, hasToken: ${!!Ae}`);try{const{events:Fe,nextSyncToken:bt,fullSyncRequired:rt}=await gI($,be,Ae);if(console.log(`[Google Sync] Calendar ${be}: ${Fe.length} events, fullSyncRequired: ${rt}`),rt){console.log(`[Google Sync] Full sync required for ${be}, will retry next time.`),delete mt[be];continue}if(bt&&(mt[be]=bt),Fe.length>0){console.log(`[Google Sync] Got ${Fe.length} updates for ${be}:`,Fe.map(gt=>({id:gt.id,summary:gt.summary,status:gt.status}))),He=!0;for(const gt of Fe){if(Ln.current.has(gt.id)){console.log("[Google Sync] Ignoring replaced event (type change in progress):",gt.id);continue}const Ve=Object.keys(ct).find(te=>ct[te].evtId===gt.id);if(console.log(`[Google Sync] Processing event: "${gt.summary}" (${gt.id})`,{hasMapping:!!Ve,mappedTaskId:Ve||"none",eventStatus:gt.status}),gt.status==="cancelled"){if(Ve){const te=ct[Ve];if(te&&te.calId===be){const Oe=tt.find(Je=>Je.id===Ve);Oe&&Oe.status!=="deleted"&&(Ot(Ve),tt=tt.map(Je=>Je.id===Ve?{...Je,status:"deleted"}:Je),Ne&&await Ne.from("tasks").update({status:"deleted"}).eq("id",Ve),console.log("[Google Auto-Sync] Deleted Task",Ve,"from calendar",be))}else console.log(`[Google Sync] Ignored deletion of ${Ve} from ${be} (mapped to ${te==null?void 0:te.calId})`)}}else{const te=gt.summary||"(No Title)",Oe=gt.description||"";let Je=null,Ye=null,ft=null,Nt=!1;if(gt.start.date)Nt=!0,Je=gt.start.date;else if(gt.start.dateTime){const jt=new Date(gt.start.dateTime);Je=jt.toLocaleDateString("en-CA"),Ye=jt.toTimeString().substring(0,5),gt.end.dateTime&&(ft=new Date(gt.end.dateTime).toTimeString().substring(0,5))}if(Je)if(Ve){const jt=tt.findIndex(Bt=>Bt.id===Ve);if(jt!==-1){const Bt=tt[jt],Xt=Bt.status==="deleted",rn=Bt.title!==te||Bt.description!==Oe||((W=Bt.start_date)==null?void 0:W.split("T")[0])!==Je||(Bt.start_time||"").substring(0,5)!==(Ye||"")||(Bt.end_time||"").substring(0,5)!==(ft||"")||Bt.is_all_day!==Nt||Xt;console.log(`[Google Sync] Checking update for "${te}": changed=${rn}, isDeleted=${Xt}`,{oldTitle:Bt.title,newTitle:te,oldDate:(B=Bt.start_date)==null?void 0:B.split("T")[0],newDate:Je,oldIsAllDay:Bt.is_all_day,newIsAllDay:Nt,oldStartTime:Bt.start_time,newStartTime:Ye});const sn=(J=ct[Ve])==null?void 0:J.calId,Rn=sn&&sn!==be;if(rn||Rn){const gr={title:te,description:Oe,start_date:Je,is_all_day:Nt,status:"todo"};Ye&&(gr.start_time=Ye),ft&&(gr.end_time=ft);let Xn=[...Bt.tags||[]];if(We.length>0){const oc=We.find(Xi=>Xi.id===be)||(be==="primary"?We.find(Xi=>Xi.primary):null);if(oc){const Xi=`Google:${oc.summary}`,zu=a.find(ac=>ac.name===Xi);if(Rn){const ac=a.filter(il=>il.name.startsWith("Google:")).map(il=>il.id);Xn=Xn.filter(il=>!ac.includes(il)),console.log("[Google Sync] Calendar changed from",sn,"to",be)}zu&&!Xn.includes(zu.id)&&(Xn.push(zu.id),console.log("[Google Sync] Switched tag to:",Xi)),gr.tags=Xn,ct[Ve]={evtId:gt.id,calId:be}}}tt[jt]={...Bt,...gr},Ot(Ve),Ne&&await Ne.from("tasks").update(gr).eq("id",Ve),console.log("[Google Sync] Updated Task",Ve,"with",gr),He=!0}}else{console.log(`[Google Sync] Stale mapping for "${te}" (taskId: ${Ve}), trying to find by title...`),delete ct[Ve];const Bt=a.filter(rn=>rn.name.startsWith("Google:")).map(rn=>rn.id),Xt=tt.find(rn=>{var sn;return rn.title===te&&rn.status!=="deleted"&&((sn=rn.tags)==null?void 0:sn.some(Rn=>Bt.includes(Rn)))});if(Xt){console.log(`[Google Sync] Found matching task by title: "${te}" -> ${Xt.id}`);const rn=tt.findIndex(sn=>sn.id===Xt.id);if(rn!==-1){const sn=tt[rn],Rn=sn.status==="deleted",gr=sn.title!==te||sn.description!==Oe||((fe=sn.start_date)==null?void 0:fe.split("T")[0])!==Je||(sn.start_time||"").substring(0,5)!==(Ye||"")||(sn.end_time||"").substring(0,5)!==(ft||"")||sn.is_all_day!==Nt||Rn;if(console.log(`[Google Sync] (Recovered) Checking update for "${te}": changed=${gr}`),gr){const Xn={title:te,description:Oe,start_date:Je,is_all_day:Nt,status:"todo"};Ye&&(Xn.start_time=Ye),ft&&(Xn.end_time=ft),tt[rn]={...sn,...Xn},Ot(Xt.id),Ne&&await Ne.from("tasks").update(Xn).eq("id",Xt.id),console.log("[Google Sync] (Recovered) Updated Task",Xt.id,"with",Xn),He=!0}ct[Xt.id]={evtId:gt.id,calId:be},console.log("[Google Sync] Updated mapping:",Xt.id,"->",gt.id)}}else console.log(`[Google Sync] No matching task found for "${te}", will be created on next sync if tag exists`)}}else{const jt=JSON.parse(localStorage.getItem("task_google_map")||"{}");if(Object.values(jt).some(Rn=>Rn.evtId===gt.id)){console.log("[Google Sync] Event already mapped (found in fresh check), skipping creation:",gt.id);continue}let Xt=[],rn=!1;if(We.length>0){let Rn=We.find(gr=>gr.id===be);if(!Rn&&be==="primary"&&(Rn=We.find(gr=>gr.primary===!0)),Rn){const gr=`Google:${Rn.summary}`,Xn=a.find(oc=>oc.name===gr);Xn?(Xt.push(Xn.id),console.log("[Google Sync] Assigned tag:",gr,"to new task:",te),rn=!0):console.log("[Google Sync] Tag not found:",gr,"- skipping creation")}}if(!rn)continue;const sn={user_id:e==null?void 0:e.id,title:te,description:Oe,status:"todo",start_date:Je,start_time:Ye,end_time:ft,is_all_day:Nt,tags:Xt,order_index:0};if(Ne&&e){const{data:Rn}=await Ne.from("tasks").insert(sn).select().single();Rn&&(tt.push(Rn),ct[Rn.id]={evtId:gt.id,calId:be},console.log("[Google Sync] Created Task",Rn.id,"with mapping:",{evtId:gt.id,calId:be},"title:",te))}}}}}}catch{}}He&&(tt.sort((be,Ae)=>(be.order_index||0)-(Ae.order_index||0)||be.created_at.localeCompare(Ae.created_at)),s(tt),x({msg:"Google ",type:"info"}));const $e={...JSON.parse(localStorage.getItem("task_google_map")||"{}"),...ct};localStorage.setItem("task_google_map",JSON.stringify($e)),localStorage.setItem("google_sync_tokens",JSON.stringify(mt)),console.log("[Google Sync] Saved",Object.keys(ct).length,"mappings. Total:",Object.keys($e).length)}finally{console.log("[Google Sync] Sync completed."),oi.current=!1,Ln.current.size>0&&(console.log("[Google Sync] Cleared",Ln.current.size,"replaced event IDs"),Ln.current.clear())}};return b.useEffect(()=>{if(console.log("[Google Sync] useEffect running, user:",!!e),!e)return;console.log("[Google Sync] Setting up 60s interval and 3s initial timeout...");const $=setInterval(()=>{console.log("[Google Sync] 60s interval triggered"),mr()},6e4),F=setTimeout(()=>{console.log("[Google Sync] Initial 3s timeout triggered"),mr()},3e3);return()=>{console.log("[Google Sync] Cleaning up interval and timeout"),clearInterval($),clearTimeout(F)}},[e,a]),c.jsx(_n.Provider,{value:{user:e,tasks:r,tags:a,visibleTasks:hn,loading:u,syncStatus:p,dragState:oe,startDrag:si,updateDropState:nl,endDrag:rl,updateGhostPosition:Zo,addTask:_o,batchAddTasks:sl,duplicateTasks:Yn,updateTask:Pr,batchUpdateTasks:Un,deleteTask:ic,batchDeleteTasks:Ni,addTag:At,updateTag:Mt,deleteTag:Et,keyboardMove:So,smartReschedule:Nn,lockTask:an,unlockTask:Tn,verifyTaskPassword:Ie,temporarilyUnlockTask:O,archiveCompletedTasks:Dt,archivedTasks:i,restoreArchivedTask:zt,deleteArchivedTask:Ft,updateArchivedTask:qt,batchDeleteArchivedTasks:mn,clearAllTasks:bn,exportData:gn,importData:Er,syncGoogleToApp:mr,undo:Jn,redo:En,canUndo:Xe.length>0,canRedo:lt.length>0,logout:Or,navigateToTask:Ei,navigateBack:tl,canNavigateBack:Ct.length>0,toast:y,setToast:x,selectedTaskIds:g,setSelectedTaskIds:v,handleSelection:ko,selectionAnchor:w,setSelectionAnchor:S,focusedTaskId:I,setFocusedTaskId:k,editingTaskId:j,setEditingTaskId:N,inlineEditingTaskId:me,setInlineEditingTaskId:Me,expandedTaskIds:P,setExpandedTaskIds:G,toggleExpansion:Zt,view:K,setView:vn,tagFilter:ce,setTagFilter:ke,advancedFilters:je,setAdvancedFilters:V,themeSettings:re,setThemeSettings:sr,calculateVisibleTasks:Qo,pendingFocusTaskId:ye,setPendingFocusTaskId:Pe,leavingTaskIds:_e,addLeavingTask:dn,dismissLeavingTasks:Hn,initError:f,sidebarWidth:wt,setSidebarWidth:rr,sidebarCollapsed:Le,toggleSidebar:Mn,expandedTags:he,setExpandedTags:yn,calendarDate:qe,setCalendarDate:ht,taskCounts:ut,focusSplitWidth:De,setFocusSplitWidth:Qe,reviewTask:vt,restoreTask:ii,restoreTrash:Nr,emptyTrash:le,moveTaskToView:ji,isCmdPressed:pt,tagsWithResolvedColors:Z,language:ne,setLanguage:pe,t:ee,viewTagFilters:A,updateViewTagFilter:ae,constructionModeEnabled:xe,setConstructionModeEnabled:U,searchHistory:Q,addSearchHistory:Cr,deleteSearchHistory:gs,searchOpen:D,setSearchOpen:Te,lockedGoogleTagIds:z,toggleGoogleTagLock:Be,isTaskGoogleLocked:st},children:t})},Iu=b.createContext({isRecording:!1,recordingTime:0,startRecording:async()=>{},stopRecording:()=>{},cancelRecording:()=>{},addMarker:()=>null,recordingTaskId:null,audioMarkers:[],currentRecordingId:null,analyser:null,audioContext:null}),Bz=({children:t})=>{b.useContext(_n);const[e,n]=b.useState(!1),[r,s]=b.useState(0),[i,o]=b.useState(null),[a,l]=b.useState([]),[u,d]=b.useState(null),f=b.useRef(null),h=b.useRef(null),p=b.useRef(null),m=b.useRef(null),y=b.useRef(null),x=b.useRef([]),g=b.useRef(null),v=b.useRef(0),w=b.useRef(e),S=b.useRef(r),I=b.useRef(i),k=b.useRef(a);b.useEffect(()=>{w.current=e,S.current=r,I.current=i,k.current=a},[e,r,i,a]);const R=async N=>{if(e){console.warn("[RecordingContext] Cannot start recording - another recording is already in progress for task:",i);return}try{const j=await navigator.mediaDevices.getUserMedia({audio:!0});y.current=j;const O=new(window.AudioContext||window.webkitAudioContext);h.current=O;const P=O.createAnalyser();P.fftSize=2048,p.current=P;const G=O.createMediaStreamSource(j);G.connect(P),m.current=G;const A=MediaRecorder.isTypeSupported("audio/mp4")?"audio/mp4":"audio/webm",M=new MediaRecorder(j,{mimeType:A,audioBitsPerSecond:32e3});f.current=M,x.current=[];const Q=`rec_${Date.now()}_${crypto.randomUUID()}`;d(Q),M.ondataavailable=X=>{X.data.size>0&&x.current.push(X.data)},M.onstop=async()=>{const X=new Blob(x.current,{type:A}),D=A.split("/")[1],Te=new Date,U=`Recording ${`${Te.getFullYear()}.${String(Te.getMonth()+1).padStart(2,"0")}.${String(Te.getDate()).padStart(2,"0")} ${String(Te.getHours()).padStart(2,"0")}:${String(Te.getMinutes()).padStart(2,"0")}`}.${D}`,z=new File([X],U,{type:A});y.current&&y.current.getTracks().forEach(st=>st.stop()),h.current&&h.current.state!=="closed"&&h.current.close();const ie=I.current,Be=k.current;ie?(console.log(`[RecordingContext] Saving recording for Task ${ie}`,z,Be),window.dispatchEvent(new CustomEvent("audio-recording-completed",{detail:{file:z,taskId:ie,markers:Be,duration:S.current,recordingId:Q}}))):console.warn("Recording stopped but no Task ID associated."),n(!1),o(null),l([]),s(0),d(null)},M.start(100),n(!0),o(N||null),s(0),l([]),v.current=Date.now(),g.current=setInterval(()=>{const X=Date.now()-v.current;s(X)},100)}catch(j){console.error("[RecordingContext] Failed to start recording",j)}},C=()=>{f.current&&f.current.state!=="inactive"&&f.current.stop(),g.current&&(clearInterval(g.current),g.current=null)},T=()=>{f.current&&f.current.state!=="inactive"&&(f.current.onstop=null,f.current.stop()),g.current&&(clearInterval(g.current),g.current=null),y.current&&y.current.getTracks().forEach(N=>N.stop()),h.current&&h.current.state!=="closed"&&h.current.close(),n(!1),o(null),l([]),s(0)},_=()=>{if(!e)return null;const N=r,O={id:`rec-marker-${Date.now()}`,time:N};return l(P=>[...P,O]),O};return c.jsx(Iu.Provider,{value:{isRecording:e,recordingTime:r,startRecording:R,stopRecording:C,cancelRecording:T,addMarker:_,recordingTaskId:i,audioMarkers:a,currentRecordingId:u,analyser:p.current,audioContext:h.current},children:t})},xI=b.createContext({reminders:[],addReminder:()=>{},markAsSeen:()=>{},snoozeReminder:()=>{},clearAllSeen:()=>{},clearAllUnseen:()=>{},clearAll:()=>{},unseenCount:0,isReminderPanelOpen:!1,setIsReminderPanelOpen:()=>{}}),i2="app_reminders",o2="app_reminder_signatures",Uz=1e4,Hz=({children:t})=>{const{tasks:e,setToast:n,user:r}=b.useContext(_n),[s,i]=b.useState([]),[o,a]=b.useState(!1),[l,u]=b.useState({}),[d,f]=b.useState(!1),h=b.useRef(null),p=b.useRef(!1),m=b.useRef(null),y=b.useRef([]),x=b.useRef({}),g=b.useRef([]),v=b.useRef(!1);b.useEffect(()=>{y.current=s},[s]),b.useEffect(()=>{x.current=l},[l]),b.useEffect(()=>{g.current=e},[e]),b.useEffect(()=>{v.current=d},[d]),b.useEffect(()=>{(async()=>{const N=(r==null?void 0:r.id)||null;if(!(m.current===N&&p.current)){if(!N){i([]),u({}),f(!1),m.current=null,p.current=!0;return}if(m.current=N,Ne)try{const{data:j,error:O}=await Ne.from("reminders").select("*").eq("user_id",N).order("triggered_at",{ascending:!1});if(!O&&j){f(!0);const P=j.map(A=>({id:A.id,task_id:A.task_id,task_title:A.task_title,task_color:A.task_color||"gray",triggered_at:A.triggered_at,due_time:A.due_time,seen:A.seen||!1,snoozed_until:A.snoozed_until||null}));i(P);const{data:G}=await Ne.from("reminder_signatures").select("*").eq("user_id",N);if(G){const A={};G.forEach(M=>{A[M.task_id]=M.signature}),u(A),x.current=A}console.log("[Reminder] Loaded from Supabase:",P.length),p.current=!0;return}}catch(j){console.warn("[Reminder] Supabase load failed, falling back to local:",j)}f(!1);try{const j=localStorage.getItem(i2);j&&i(JSON.parse(j));const O=localStorage.getItem(o2);if(O){const P=JSON.parse(O);u(P),x.current=P}}catch(j){console.error(j)}p.current=!0}})()},[r==null?void 0:r.id]),b.useEffect(()=>{if(!(r!=null&&r.id)||!Ne)return;if(!d){console.log("[Reminder] Sync disabled, skipping subscription");return}console.log("[Reminder] Subscribing to realtime channels...");const _=Ne.channel("reminders-sync",{config:{broadcast:{self:!1}}}).on("postgres_changes",{event:"*",schema:"public",table:"reminders",filter:`user_id=eq.${r.id}`},j=>{if(j.eventType==="INSERT"){const O=j.new;i(P=>P.some(G=>G.id===O.id)?P:[{id:O.id,task_id:O.task_id,task_title:O.task_title,task_color:O.task_color||"gray",triggered_at:O.triggered_at,due_time:O.due_time,seen:O.seen||!1,snoozed_until:O.snoozed_until||null},...P])}else if(j.eventType==="UPDATE"){const O=j.new;i(P=>P.map(G=>G.id===O.id?{...G,seen:O.seen||!1,snoozed_until:O.snoozed_until||null}:G))}else if(j.eventType==="DELETE"){const O=j.old;i(P=>P.filter(G=>G.id!==O.id))}}).on("broadcast",{event:"clear-action"},j=>{j.payload.type==="clearSeen"?i(O=>O.filter(P=>!P.seen)):j.payload.type==="clearUnseen"?i(O=>O.filter(P=>P.seen)):j.payload.type==="clearAll"&&i([])}).subscribe(j=>{j==="SUBSCRIBED"&&console.log("[Reminder] Reminders channel subscribed")}),N=Ne.channel("signatures-sync").on("postgres_changes",{event:"INSERT",schema:"public",table:"reminder_signatures",filter:`user_id=eq.${r.id}`},j=>{const O=j.new;u(P=>P[O.task_id]===O.signature?P:{...P,[O.task_id]:O.signature})}).subscribe(j=>{j==="SUBSCRIBED"&&console.log("[Reminder] Signatures channel subscribed")});return()=>{console.log("[Reminder] Unsubscribing..."),Ne.removeChannel(_),Ne.removeChannel(N)}},[r==null?void 0:r.id,d]),b.useEffect(()=>{!p.current||d||localStorage.setItem(i2,JSON.stringify(s))},[s,d]),b.useEffect(()=>{!p.current||d||localStorage.setItem(o2,JSON.stringify(l))},[l,d]);const w=b.useCallback(async(_,N,j=!0)=>{const O=g.current.find(G=>G.id===_);if(!O)return;const P=O.start_date||O.due_date;if(P){if(v.current&&Ne&&(r!=null&&r.id)){const{error:G}=await Ne.from("reminder_signatures").insert([{user_id:r.id,task_id:_,signature:N}]);if(G){const{data:M}=await Ne.from("reminder_signatures").select("signature").eq("user_id",r.id).eq("task_id",_).single();if(M&&M.signature===N){u(Q=>({...Q,[_]:N}));return}M&&await Ne.from("reminder_signatures").update({signature:N}).eq("user_id",r.id).eq("task_id",_)}const A=(await cw(()=>import("./index-c620dda6.js"),[])).v4();await Ne.from("reminders").insert([{id:A,user_id:r.id,task_id:_,task_title:O.title,task_color:O.color,triggered_at:new Date().toISOString(),due_time:P,seen:!1}]),u(M=>({...M,[_]:N}))}else{const G={id:`${_}_${Date.now()}`,task_id:_,task_title:O.title,task_color:O.color,triggered_at:new Date().toISOString(),due_time:P,seen:!1,snoozed_until:null};i(A=>[G,...A]),u(A=>({...A,[_]:N})),j&&(n({type:"info",msg:` : ${O.title}`,actionLabel:"",onClick:()=>a(!0)}),"Notification"in window&&Notification.permission==="granted"&&(new Notification("",{body:O.title,icon:"/favicon.ico"}).onclick=()=>{window.focus(),a(!0)}),a(!0))}v.current&&j&&(n({type:"info",msg:` : ${O.title}`,actionLabel:"",onClick:()=>a(!0)}),"Notification"in window&&Notification.permission==="granted"&&(new Notification("",{body:O.title,icon:"/favicon.ico"}).onclick=()=>{window.focus(),a(!0)}),a(!0))}},[n,r==null?void 0:r.id]),S=b.useCallback(async _=>{i(N=>N.map(j=>j.id===_?{...j,seen:!0}:j)),v.current&&Ne&&await Ne.from("reminders").update({seen:!0}).eq("id",_)},[]),I=b.useCallback(async(_,N)=>{const j=new Date(Date.now()+N*60*1e3).toISOString();i(O=>O.map(P=>P.id===_?{...P,snoozed_until:j,seen:!0}:P)),n({type:"info",msg:`  ${N} `}),v.current&&Ne&&await Ne.from("reminders").update({snoozed_until:j,seen:!0}).eq("id",_)},[n]),k=b.useCallback(async()=>{const N=y.current.filter(j=>j.seen).map(j=>j.id);i(j=>j.filter(O=>!O.seen)),v.current&&Ne&&N.length>0&&(await Ne.channel("reminders-sync").send({type:"broadcast",event:"clear-action",payload:{type:"clearSeen"}}),await Ne.from("reminders").delete().in("id",N))},[]),R=b.useCallback(async()=>{const N=y.current.filter(j=>!j.seen).map(j=>j.id);i(j=>j.filter(O=>O.seen)),v.current&&Ne&&N.length>0&&(await Ne.channel("reminders-sync").send({type:"broadcast",event:"clear-action",payload:{type:"clearUnseen"}}),await Ne.from("reminders").delete().in("id",N))},[]),C=b.useCallback(async()=>{i([]),v.current&&Ne&&(r!=null&&r.id)&&(await Ne.channel("reminders-sync").send({type:"broadcast",event:"clear-action",payload:{type:"clearAll"}}),await Ne.from("reminders").delete().eq("user_id",r.id))},[r==null?void 0:r.id]),T=b.useCallback(()=>{if(!p.current)return;const _=new Date,N=g.current,j=x.current;N.forEach(O=>{if(["completed","deleted","canceled"].includes(O.status))return;const P=O.start_date||O.due_date;if(!P)return;let G;if(O.is_all_day||!O.start_time)G=new Date(P),P.includes("T")||G.setHours(0,0,0,0);else{const[X,D]=(O.start_time||"00:00").split(":").map(Number),Te=P.split("T")[0];G=new Date(Te),G.setHours(X,D,0,0)}let A=O.reminder_minutes;if(A===void 0)try{const X=localStorage.getItem(`task_reminder_${O.id}`);X&&(A=JSON.parse(X))}catch{}if(A===void 0&&!O.is_all_day&&O.start_time&&(A=0),A==null)return;const M=new Date(G.getTime()-A*60*1e3),Q=`${G.getTime()}_${A}`;j[O.id]!==Q&&_>=M&&w(O.id,Q,!0)}),y.current.forEach(async O=>{if(O.snoozed_until){const P=new Date(O.snoozed_until);_>=P&&(N.find(A=>A.id===O.task_id)&&(n({type:"info",msg:` : ${O.task_title}`,actionLabel:"",onClick:()=>a(!0)}),"Notification"in window&&Notification.permission==="granted"&&(new Notification("",{body:O.task_title}).onclick=()=>{window.focus(),a(!0)}),a(!0)),i(A=>A.map(M=>M.id===O.id?{...M,snoozed_until:null,seen:!1}:M)),v.current&&Ne&&await Ne.from("reminders").update({snoozed_until:null,seen:!1}).eq("id",O.id))}})},[w,n]);return b.useEffect(()=>{const _=setTimeout(T,2e3);return h.current=setInterval(T,Uz),()=>{clearTimeout(_),h.current&&clearInterval(h.current)}},[T]),c.jsx(xI.Provider,{value:{reminders:s,addReminder:w,markAsSeen:S,snoozeReminder:I,clearAllSeen:k,clearAllUnseen:R,clearAll:C,unseenCount:s.filter(_=>!_.seen).length,isReminderPanelOpen:o,setIsReminderPanelOpen:a},children:t})};var Vz={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Wz=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Kz=(t,e)=>{const n=b.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:a,...l},u)=>b.createElement("svg",{ref:u,...Vz,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:`lucide lucide-${Wz(t)}`,...l},[...e.map(([d,f])=>b.createElement(d,f)),...(Array.isArray(a)?a:[a])||[]]));return n.displayName=`${t}`,n};var yt=Kz;const Vf=yt("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Gz=yt("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),em=yt("Archive",[["rect",{width:"20",height:"5",x:"2",y:"4",rx:"2",key:"uhwcea"}],["path",{d:"M4 9v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9",key:"shkvi4"}],["path",{d:"M10 13h4",key:"ytezjc"}]]),bI=yt("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),wI=yt("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),qz=yt("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),Jz=yt("AtSign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),Qx=yt("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Ba=yt("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),pf=yt("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]),Yz=yt("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}]]),Xz=yt("Bot",[["rect",{width:"18",height:"10",x:"3",y:"11",rx:"2",key:"1ofdy3"}],["circle",{cx:"12",cy:"5",r:"2",key:"f1ur92"}],["path",{d:"M12 7v4",key:"xawao1"}],["line",{x1:"8",x2:"8",y1:"16",y2:"16",key:"h6x27f"}],["line",{x1:"16",x2:"16",y1:"16",y2:"16",key:"5lty7f"}]]),ld=yt("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),Qz=yt("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]),vI=yt("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]),Go=yt("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),Cg=yt("CheckCircle2",[["path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",key:"14v8dr"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Zz=yt("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),tr=yt("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),ds=yt("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Du=yt("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),ts=yt("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),$0=yt("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),e6=yt("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Yi=yt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),t6=yt("CloudLightning",[["path",{d:"M6 16.326A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 .5 8.973",key:"1cez44"}],["path",{d:"m13 12-3 5h4l-3 5",key:"1t22er"}]]),n6=yt("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),r6=yt("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]),s6=yt("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]),kI=yt("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),i6=yt("CornerDownRight",[["polyline",{points:"15 10 20 15 15 20",key:"1q7qjw"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),SI=yt("CornerUpLeft",[["polyline",{points:"9 14 4 9 9 4",key:"881910"}],["path",{d:"M20 20v-7a4 4 0 0 0-4-4H4",key:"1nkjon"}]]),o6=yt("Crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]),nu=yt("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),_I=yt("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),a6=yt("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Wf=yt("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),l6=yt("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),c6=yt("FolderKanban",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]]),u6=yt("FolderOpen",[["path",{d:"m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.93a2 2 0 0 1 1.66.9l.82 1.2a2 2 0 0 0 1.66.9H18a2 2 0 0 1 2 2v2",key:"1nmvlm"}]]),d6=yt("FolderPlus",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["line",{x1:"12",x2:"12",y1:"10",y2:"16",key:"3c25pp"}],["line",{x1:"9",x2:"15",y1:"13",y2:"13",key:"10hoct"}]]),f6=yt("FolderTree",[["path",{d:"M13 10h7a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"10jzg2"}],["path",{d:"M13 21h7a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.88a1 1 0 0 1-.9-.55l-.44-.9a1 1 0 0 0-.9-.55H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"1b9nqm"}],["path",{d:"M3 3v2c0 1.1.9 2 2 2h3",key:"1wqwis"}],["path",{d:"M3 3v13c0 1.1.9 2 2 2h3",key:"1bqeom"}]]),h6=yt("GanttChartSquare",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 8h7",key:"kbo1nt"}],["path",{d:"M8 12h6",key:"ikassy"}],["path",{d:"M11 16h5",key:"oq65wt"}]]),TI=yt("GripHorizontal",[["circle",{cx:"12",cy:"9",r:"1",key:"124mty"}],["circle",{cx:"19",cy:"9",r:"1",key:"1ruzo2"}],["circle",{cx:"5",cy:"9",r:"1",key:"1a8b28"}],["circle",{cx:"12",cy:"15",r:"1",key:"1e56xg"}],["circle",{cx:"19",cy:"15",r:"1",key:"1a92ep"}],["circle",{cx:"5",cy:"15",r:"1",key:"5r1jwy"}]]),CI=yt("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),p6=yt("Hammer",[["path",{d:"m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9",key:"1afvon"}],["path",{d:"M17.64 15 22 10.64",key:"zsji6s"}],["path",{d:"m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25v-.86L16.01 4.6a5.56 5.56 0 0 0-3.94-1.64H9l.92.82A6.18 6.18 0 0 1 12 8.4v1.56l2 2h2.47l2.26 1.91",key:"lehyy1"}]]),tm=yt("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),m6=yt("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),g6=yt("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),nm=yt("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Zx=yt("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]),EI=yt("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),NI=yt("Layers",[["polygon",{points:"12 2 2 7 12 12 22 7 12 2",key:"1b0ttc"}],["polyline",{points:"2 17 12 22 22 17",key:"imjtdl"}],["polyline",{points:"2 12 12 17 22 12",key:"5dexcv"}]]),jI=yt("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),e1=yt("Layout",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"3",x2:"21",y1:"9",y2:"9",key:"1vqk6q"}],["line",{x1:"9",x2:"9",y1:"21",y2:"9",key:"wpwpyp"}]]),y6=yt("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),x6=yt("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),b6=yt("ListTodo",[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]),w6=yt("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),Hi=yt("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),v6=yt("LocateFixed",[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ma=yt("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),k6=yt("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),S6=yt("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),_6=yt("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),II=yt("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),T6=yt("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),C6=yt("MoveRight",[["path",{d:"M18 8L22 12L18 16",key:"1r0oui"}],["path",{d:"M2 12H22",key:"1m8cig"}]]),_w=yt("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),E6=yt("PanelLeftClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]]),N6=yt("PanelLeftOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]]),co=yt("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),DI=yt("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),Tw=yt("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),Eg=yt("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),AI=yt("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),Ki=yt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),MI=yt("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]),t1=yt("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),RI=yt("Repeat2",[["path",{d:"m2 9 3-3 3 3",key:"1ltn5i"}],["path",{d:"M13 18H7a2 2 0 0 1-2-2V6",key:"1r6tfw"}],["path",{d:"m22 15-3 3-3-3",key:"4rnwn2"}],["path",{d:"M11 6h6a2 2 0 0 1 2 2v10",key:"2f72bc"}]]),j6=yt("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]),OI=yt("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),I6=yt("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),PI=yt("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Fc=yt("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),D6=yt("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),A6=yt("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),LI=yt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),M6=yt("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),R6=yt("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]),js=yt("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),O6=yt("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),$I=yt("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Ol=yt("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),zI=yt("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Ar=yt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),P6=yt("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),Cw=yt("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]),n1=yt("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),L6=yt("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),FI=yt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),$6=yt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),r1=yt("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),z6=yt("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]),s1=yt("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),F6=yt("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),on=yt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function i1(t,e){b.useEffect(()=>{const n=r=>{!t.current||t.current.contains(r.target)||e(r)};return document.addEventListener("mousedown",n),document.addEventListener("touchstart",n),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)}},[t,e])}const mf=b.createContext({});function Ew(t){const e=b.useRef(null);return e.current===null&&(e.current=t()),e.current}const Nw=typeof window<"u",jw=Nw?b.useLayoutEffect:b.useEffect,Ng=b.createContext(null);function Iw(t,e){t.indexOf(e)===-1&&t.push(e)}function Dw(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const qo=(t,e,n)=>n>e?e:n<t?t:n;let Aw=()=>{};const Jo={},BI=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function UI(t){return typeof t=="object"&&t!==null}const HI=t=>/^0[^.\s]+$/u.test(t);function Mw(t){let e;return()=>(e===void 0&&(e=t()),e)}const wi=t=>t,B6=(t,e)=>n=>e(t(n)),Kf=(...t)=>t.reduce(B6),gf=(t,e,n)=>{const r=e-t;return r===0?1:(n-t)/r};class Rw{constructor(){this.subscriptions=[]}add(e){return Iw(this.subscriptions,e),()=>Dw(this.subscriptions,e)}notify(e,n,r){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](e,n,r);else for(let i=0;i<s;i++){const o=this.subscriptions[i];o&&o(e,n,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const po=t=>t*1e3,xi=t=>t/1e3;function VI(t,e){return e?t*(1e3/e):0}const WI=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,U6=1e-7,H6=12;function V6(t,e,n,r,s){let i,o,a=0;do o=e+(n-e)/2,i=WI(o,r,s)-t,i>0?n=o:e=o;while(Math.abs(i)>U6&&++a<H6);return o}function Gf(t,e,n,r){if(t===e&&n===r)return wi;const s=i=>V6(i,0,1,t,n);return i=>i===0||i===1?i:WI(s(i),e,r)}const KI=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,GI=t=>e=>1-t(1-e),qI=Gf(.33,1.53,.69,.99),Ow=GI(qI),JI=KI(Ow),YI=t=>(t*=2)<1?.5*Ow(t):.5*(2-Math.pow(2,-10*(t-1))),Pw=t=>1-Math.sin(Math.acos(t)),XI=GI(Pw),QI=KI(Pw),W6=Gf(.42,0,1,1),K6=Gf(0,0,.58,1),ZI=Gf(.42,0,.58,1),G6=t=>Array.isArray(t)&&typeof t[0]!="number",eD=t=>Array.isArray(t)&&typeof t[0]=="number",q6={linear:wi,easeIn:W6,easeInOut:ZI,easeOut:K6,circIn:Pw,circInOut:QI,circOut:XI,backIn:Ow,backInOut:JI,backOut:qI,anticipate:YI},J6=t=>typeof t=="string",a2=t=>{if(eD(t)){Aw(t.length===4);const[e,n,r,s]=t;return Gf(e,n,r,s)}else if(J6(t))return q6[t];return t},Ch=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],l2={value:null,addProjectionMetrics:null};function Y6(t,e){let n=new Set,r=new Set,s=!1,i=!1;const o=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1},l=0;function u(f){o.has(f)&&(d.schedule(f),t()),l++,f(a)}const d={schedule:(f,h=!1,p=!1)=>{const y=p&&s?n:r;return h&&o.add(f),y.has(f)||y.add(f),f},cancel:f=>{r.delete(f),o.delete(f)},process:f=>{if(a=f,s){i=!0;return}s=!0,[n,r]=[r,n],n.forEach(u),e&&l2.value&&l2.value.frameloop[e].push(l),l=0,n.clear(),s=!1,i&&(i=!1,d.process(f))}};return d}const X6=40;function tD(t,e){let n=!1,r=!0;const s={delta:0,timestamp:0,isProcessing:!1},i=()=>n=!0,o=Ch.reduce((w,S)=>(w[S]=Y6(i,e?S:void 0),w),{}),{setup:a,read:l,resolveKeyframes:u,preUpdate:d,update:f,preRender:h,render:p,postRender:m}=o,y=()=>{const w=Jo.useManualTiming?s.timestamp:performance.now();n=!1,Jo.useManualTiming||(s.delta=r?1e3/60:Math.max(Math.min(w-s.timestamp,X6),1)),s.timestamp=w,s.isProcessing=!0,a.process(s),l.process(s),u.process(s),d.process(s),f.process(s),h.process(s),p.process(s),m.process(s),s.isProcessing=!1,n&&e&&(r=!1,t(y))},x=()=>{n=!0,r=!0,s.isProcessing||t(y)};return{schedule:Ch.reduce((w,S)=>{const I=o[S];return w[S]=(k,R=!1,C=!1)=>(n||x(),I.schedule(k,R,C)),w},{}),cancel:w=>{for(let S=0;S<Ch.length;S++)o[Ch[S]].cancel(w)},state:s,steps:o}}const{schedule:qn,cancel:Ua,state:Yr,steps:z0}=tD(typeof requestAnimationFrame<"u"?requestAnimationFrame:wi,!0);let dp;function Q6(){dp=void 0}const Rs={now:()=>(dp===void 0&&Rs.set(Yr.isProcessing||Jo.useManualTiming?Yr.timestamp:performance.now()),dp),set:t=>{dp=t,queueMicrotask(Q6)}},nD=t=>e=>typeof e=="string"&&e.startsWith(t),rD=nD("--"),Z6=nD("var(--"),Lw=t=>Z6(t)?eF.test(t.split("/*")[0].trim()):!1,eF=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Au={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},yf={...Au,transform:t=>qo(0,1,t)},Eh={...Au,default:1},Td=t=>Math.round(t*1e5)/1e5,$w=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function tF(t){return t==null}const nF=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,zw=(t,e)=>n=>!!(typeof n=="string"&&nF.test(n)&&n.startsWith(t)||e&&!tF(n)&&Object.prototype.hasOwnProperty.call(n,e)),sD=(t,e,n)=>r=>{if(typeof r!="string")return r;const[s,i,o,a]=r.match($w);return{[t]:parseFloat(s),[e]:parseFloat(i),[n]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},rF=t=>qo(0,255,t),F0={...Au,transform:t=>Math.round(rF(t))},Cl={test:zw("rgb","red"),parse:sD("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:r=1})=>"rgba("+F0.transform(t)+", "+F0.transform(e)+", "+F0.transform(n)+", "+Td(yf.transform(r))+")"};function sF(t){let e="",n="",r="",s="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),r=t.substring(5,7),s=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),r=t.substring(3,4),s=t.substring(4,5),e+=e,n+=n,r+=r,s+=s),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:s?parseInt(s,16)/255:1}}const o1={test:zw("#"),parse:sF,transform:Cl.transform},qf=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),oa=qf("deg"),mo=qf("%"),Qt=qf("px"),iF=qf("vh"),oF=qf("vw"),c2=(()=>({...mo,parse:t=>mo.parse(t)/100,transform:t=>mo.transform(t*100)}))(),Bc={test:zw("hsl","hue"),parse:sD("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:r=1})=>"hsla("+Math.round(t)+", "+mo.transform(Td(e))+", "+mo.transform(Td(n))+", "+Td(yf.transform(r))+")"},kr={test:t=>Cl.test(t)||o1.test(t)||Bc.test(t),parse:t=>Cl.test(t)?Cl.parse(t):Bc.test(t)?Bc.parse(t):o1.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?Cl.transform(t):Bc.transform(t),getAnimatableNone:t=>{const e=kr.parse(t);return e.alpha=0,kr.transform(e)}},aF=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function lF(t){var e,n;return isNaN(t)&&typeof t=="string"&&(((e=t.match($w))==null?void 0:e.length)||0)+(((n=t.match(aF))==null?void 0:n.length)||0)>0}const iD="number",oD="color",cF="var",uF="var(",u2="${}",dF=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function xf(t){const e=t.toString(),n=[],r={color:[],number:[],var:[]},s=[];let i=0;const a=e.replace(dF,l=>(kr.test(l)?(r.color.push(i),s.push(oD),n.push(kr.parse(l))):l.startsWith(uF)?(r.var.push(i),s.push(cF),n.push(l)):(r.number.push(i),s.push(iD),n.push(parseFloat(l))),++i,u2)).split(u2);return{values:n,split:a,indexes:r,types:s}}function aD(t){return xf(t).values}function lD(t){const{split:e,types:n}=xf(t),r=e.length;return s=>{let i="";for(let o=0;o<r;o++)if(i+=e[o],s[o]!==void 0){const a=n[o];a===iD?i+=Td(s[o]):a===oD?i+=kr.transform(s[o]):i+=s[o]}return i}}const fF=t=>typeof t=="number"?0:kr.test(t)?kr.getAnimatableNone(t):t;function hF(t){const e=aD(t);return lD(t)(e.map(fF))}const Ha={test:lF,parse:aD,createTransformer:lD,getAnimatableNone:hF};function B0(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function pF({hue:t,saturation:e,lightness:n,alpha:r}){t/=360,e/=100,n/=100;let s=0,i=0,o=0;if(!e)s=i=o=n;else{const a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;s=B0(l,a,t+1/3),i=B0(l,a,t),o=B0(l,a,t-1/3)}return{red:Math.round(s*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:r}}function rm(t,e){return n=>n>0?e:t}const ar=(t,e,n)=>t+(e-t)*n,U0=(t,e,n)=>{const r=t*t,s=n*(e*e-r)+r;return s<0?0:Math.sqrt(s)},mF=[o1,Cl,Bc],gF=t=>mF.find(e=>e.test(t));function d2(t){const e=gF(t);if(!e)return!1;let n=e.parse(t);return e===Bc&&(n=pF(n)),n}const f2=(t,e)=>{const n=d2(t),r=d2(e);if(!n||!r)return rm(t,e);const s={...n};return i=>(s.red=U0(n.red,r.red,i),s.green=U0(n.green,r.green,i),s.blue=U0(n.blue,r.blue,i),s.alpha=ar(n.alpha,r.alpha,i),Cl.transform(s))},a1=new Set(["none","hidden"]);function yF(t,e){return a1.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function xF(t,e){return n=>ar(t,e,n)}function Fw(t){return typeof t=="number"?xF:typeof t=="string"?Lw(t)?rm:kr.test(t)?f2:vF:Array.isArray(t)?cD:typeof t=="object"?kr.test(t)?f2:bF:rm}function cD(t,e){const n=[...t],r=n.length,s=t.map((i,o)=>Fw(i)(i,e[o]));return i=>{for(let o=0;o<r;o++)n[o]=s[o](i);return n}}function bF(t,e){const n={...t,...e},r={};for(const s in n)t[s]!==void 0&&e[s]!==void 0&&(r[s]=Fw(t[s])(t[s],e[s]));return s=>{for(const i in r)n[i]=r[i](s);return n}}function wF(t,e){const n=[],r={color:0,var:0,number:0};for(let s=0;s<e.values.length;s++){const i=e.types[s],o=t.indexes[i][r[i]],a=t.values[o]??0;n[s]=a,r[i]++}return n}const vF=(t,e)=>{const n=Ha.createTransformer(e),r=xf(t),s=xf(e);return r.indexes.var.length===s.indexes.var.length&&r.indexes.color.length===s.indexes.color.length&&r.indexes.number.length>=s.indexes.number.length?a1.has(t)&&!s.values.length||a1.has(e)&&!r.values.length?yF(t,e):Kf(cD(wF(r,s),s.values),n):rm(t,e)};function uD(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?ar(t,e,n):Fw(t)(t,e)}const kF=t=>{const e=({timestamp:n})=>t(n);return{start:(n=!0)=>qn.update(e,n),stop:()=>Ua(e),now:()=>Yr.isProcessing?Yr.timestamp:Rs.now()}},dD=(t,e,n=10)=>{let r="";const s=Math.max(Math.round(e/n),2);for(let i=0;i<s;i++)r+=Math.round(t(i/(s-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},sm=2e4;function Bw(t){let e=0;const n=50;let r=t.next(e);for(;!r.done&&e<sm;)e+=n,r=t.next(e);return e>=sm?1/0:e}function SF(t,e=100,n){const r=n({...t,keyframes:[0,e]}),s=Math.min(Bw(r),sm);return{type:"keyframes",ease:i=>r.next(s*i).value/e,duration:xi(s)}}const _F=5;function fD(t,e,n){const r=Math.max(e-_F,0);return VI(n-t(r),e-r)}const fr={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},H0=.001;function TF({duration:t=fr.duration,bounce:e=fr.bounce,velocity:n=fr.velocity,mass:r=fr.mass}){let s,i,o=1-e;o=qo(fr.minDamping,fr.maxDamping,o),t=qo(fr.minDuration,fr.maxDuration,xi(t)),o<1?(s=u=>{const d=u*o,f=d*t,h=d-n,p=l1(u,o),m=Math.exp(-f);return H0-h/p*m},i=u=>{const f=u*o*t,h=f*n+n,p=Math.pow(o,2)*Math.pow(u,2)*t,m=Math.exp(-f),y=l1(Math.pow(u,2),o);return(-s(u)+H0>0?-1:1)*((h-p)*m)/y}):(s=u=>{const d=Math.exp(-u*t),f=(u-n)*t+1;return-H0+d*f},i=u=>{const d=Math.exp(-u*t),f=(n-u)*(t*t);return d*f});const a=5/t,l=EF(s,i,a);if(t=po(t),isNaN(l))return{stiffness:fr.stiffness,damping:fr.damping,duration:t};{const u=Math.pow(l,2)*r;return{stiffness:u,damping:o*2*Math.sqrt(r*u),duration:t}}}const CF=12;function EF(t,e,n){let r=n;for(let s=1;s<CF;s++)r=r-t(r)/e(r);return r}function l1(t,e){return t*Math.sqrt(1-e*e)}const NF=["duration","bounce"],jF=["stiffness","damping","mass"];function h2(t,e){return e.some(n=>t[n]!==void 0)}function IF(t){let e={velocity:fr.velocity,stiffness:fr.stiffness,damping:fr.damping,mass:fr.mass,isResolvedFromDuration:!1,...t};if(!h2(t,jF)&&h2(t,NF))if(t.visualDuration){const n=t.visualDuration,r=2*Math.PI/(n*1.2),s=r*r,i=2*qo(.05,1,1-(t.bounce||0))*Math.sqrt(s);e={...e,mass:fr.mass,stiffness:s,damping:i}}else{const n=TF(t);e={...e,...n,mass:fr.mass},e.isResolvedFromDuration=!0}return e}function im(t=fr.visualDuration,e=fr.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:r,restDelta:s}=n;const i=n.keyframes[0],o=n.keyframes[n.keyframes.length-1],a={done:!1,value:i},{stiffness:l,damping:u,mass:d,duration:f,velocity:h,isResolvedFromDuration:p}=IF({...n,velocity:-xi(n.velocity||0)}),m=h||0,y=u/(2*Math.sqrt(l*d)),x=o-i,g=xi(Math.sqrt(l/d)),v=Math.abs(x)<5;r||(r=v?fr.restSpeed.granular:fr.restSpeed.default),s||(s=v?fr.restDelta.granular:fr.restDelta.default);let w;if(y<1){const I=l1(g,y);w=k=>{const R=Math.exp(-y*g*k);return o-R*((m+y*g*x)/I*Math.sin(I*k)+x*Math.cos(I*k))}}else if(y===1)w=I=>o-Math.exp(-g*I)*(x+(m+g*x)*I);else{const I=g*Math.sqrt(y*y-1);w=k=>{const R=Math.exp(-y*g*k),C=Math.min(I*k,300);return o-R*((m+y*g*x)*Math.sinh(C)+I*x*Math.cosh(C))/I}}const S={calculatedDuration:p&&f||null,next:I=>{const k=w(I);if(p)a.done=I>=f;else{let R=I===0?m:0;y<1&&(R=I===0?po(m):fD(w,I,k));const C=Math.abs(R)<=r,T=Math.abs(o-k)<=s;a.done=C&&T}return a.value=a.done?o:k,a},toString:()=>{const I=Math.min(Bw(S),sm),k=dD(R=>S.next(I*R).value,I,30);return I+"ms "+k},toTransition:()=>{}};return S}im.applyToOptions=t=>{const e=SF(t,100,im);return t.ease=e.ease,t.duration=po(e.duration),t.type="keyframes",t};function c1({keyframes:t,velocity:e=0,power:n=.8,timeConstant:r=325,bounceDamping:s=10,bounceStiffness:i=500,modifyTarget:o,min:a,max:l,restDelta:u=.5,restSpeed:d}){const f=t[0],h={done:!1,value:f},p=C=>a!==void 0&&C<a||l!==void 0&&C>l,m=C=>a===void 0?l:l===void 0||Math.abs(a-C)<Math.abs(l-C)?a:l;let y=n*e;const x=f+y,g=o===void 0?x:o(x);g!==x&&(y=g-f);const v=C=>-y*Math.exp(-C/r),w=C=>g+v(C),S=C=>{const T=v(C),_=w(C);h.done=Math.abs(T)<=u,h.value=h.done?g:_};let I,k;const R=C=>{p(h.value)&&(I=C,k=im({keyframes:[h.value,m(h.value)],velocity:fD(w,C,h.value),damping:s,stiffness:i,restDelta:u,restSpeed:d}))};return R(0),{calculatedDuration:null,next:C=>{let T=!1;return!k&&I===void 0&&(T=!0,S(C),R(C)),I!==void 0&&C>=I?k.next(C-I):(!T&&S(C),h)}}}function DF(t,e,n){const r=[],s=n||Jo.mix||uD,i=t.length-1;for(let o=0;o<i;o++){let a=s(t[o],t[o+1]);if(e){const l=Array.isArray(e)?e[o]||wi:e;a=Kf(l,a)}r.push(a)}return r}function AF(t,e,{clamp:n=!0,ease:r,mixer:s}={}){const i=t.length;if(Aw(i===e.length),i===1)return()=>e[0];if(i===2&&e[0]===e[1])return()=>e[1];const o=t[0]===t[1];t[0]>t[i-1]&&(t=[...t].reverse(),e=[...e].reverse());const a=DF(e,r,s),l=a.length,u=d=>{if(o&&d<t[0])return e[0];let f=0;if(l>1)for(;f<t.length-2&&!(d<t[f+1]);f++);const h=gf(t[f],t[f+1],d);return a[f](h)};return n?d=>u(qo(t[0],t[i-1],d)):u}function MF(t,e){const n=t[t.length-1];for(let r=1;r<=e;r++){const s=gf(0,e,r);t.push(ar(n,1,s))}}function RF(t){const e=[0];return MF(e,t.length-1),e}function OF(t,e){return t.map(n=>n*e)}function PF(t,e){return t.map(()=>e||ZI).splice(0,t.length-1)}function Cd({duration:t=300,keyframes:e,times:n,ease:r="easeInOut"}){const s=G6(r)?r.map(a2):a2(r),i={done:!1,value:e[0]},o=OF(n&&n.length===e.length?n:RF(e),t),a=AF(o,e,{ease:Array.isArray(s)?s:PF(e,s)});return{calculatedDuration:t,next:l=>(i.value=a(l),i.done=l>=t,i)}}const LF=t=>t!==null;function Uw(t,{repeat:e,repeatType:n="loop"},r,s=1){const i=t.filter(LF),a=s<0||e&&n!=="loop"&&e%2===1?0:i.length-1;return!a||r===void 0?i[a]:r}const $F={decay:c1,inertia:c1,tween:Cd,keyframes:Cd,spring:im};function hD(t){typeof t.type=="string"&&(t.type=$F[t.type])}class Hw{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,n){return this.finished.then(e,n)}}const zF=t=>t/100;class Vw extends Hw{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var r,s;const{motionValue:n}=this.options;n&&n.updatedAt!==Rs.now()&&this.tick(Rs.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(s=(r=this.options).onStop)==null||s.call(r))},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;hD(e);const{type:n=Cd,repeat:r=0,repeatDelay:s=0,repeatType:i,velocity:o=0}=e;let{keyframes:a}=e;const l=n||Cd;l!==Cd&&typeof a[0]!="number"&&(this.mixKeyframes=Kf(zF,uD(a[0],a[1])),a=[0,100]);const u=l({...e,keyframes:a});i==="mirror"&&(this.mirroredGenerator=l({...e,keyframes:[...a].reverse(),velocity:-o})),u.calculatedDuration===null&&(u.calculatedDuration=Bw(u));const{calculatedDuration:d}=u;this.calculatedDuration=d,this.resolvedDuration=d+s,this.totalDuration=this.resolvedDuration*(r+1)-s,this.generator=u}updateTime(e){const n=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(e,n=!1){const{generator:r,totalDuration:s,mixKeyframes:i,mirroredGenerator:o,resolvedDuration:a,calculatedDuration:l}=this;if(this.startTime===null)return r.next(0);const{delay:u=0,keyframes:d,repeat:f,repeatType:h,repeatDelay:p,type:m,onUpdate:y,finalKeyframe:x}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-s/this.speed,this.startTime)),n?this.currentTime=e:this.updateTime(e);const g=this.currentTime-u*(this.playbackSpeed>=0?1:-1),v=this.playbackSpeed>=0?g<0:g>s;this.currentTime=Math.max(g,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=s);let w=this.currentTime,S=r;if(f){const C=Math.min(this.currentTime,s)/a;let T=Math.floor(C),_=C%1;!_&&C>=1&&(_=1),_===1&&T--,T=Math.min(T,f+1),!!(T%2)&&(h==="reverse"?(_=1-_,p&&(_-=p/a)):h==="mirror"&&(S=o)),w=qo(0,1,_)*a}const I=v?{done:!1,value:d[0]}:S.next(w);i&&(I.value=i(I.value));let{done:k}=I;!v&&l!==null&&(k=this.playbackSpeed>=0?this.currentTime>=s:this.currentTime<=0);const R=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&k);return R&&m!==c1&&(I.value=Uw(d,this.options,x,this.speed)),y&&y(I.value),R&&this.finish(),I}then(e,n){return this.finished.then(e,n)}get duration(){return xi(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+xi(e)}get time(){return xi(this.currentTime)}set time(e){var n;e=po(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),(n=this.driver)==null||n.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Rs.now());const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=xi(this.currentTime))}play(){var s,i;if(this.isStopped)return;const{driver:e=kF,startTime:n}=this.options;this.driver||(this.driver=e(o=>this.tick(o))),(i=(s=this.options).onPlay)==null||i.call(s);const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=n??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Rs.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,n;this.notifyFinished(),this.teardown(),this.state="finished",(n=(e=this.options).onComplete)==null||n.call(e)}cancel(){var e,n;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(n=(e=this.options).onCancel)==null||n.call(e)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var n;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(n=this.driver)==null||n.stop(),e.observe(this)}}function FF(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const El=t=>t*180/Math.PI,u1=t=>{const e=El(Math.atan2(t[1],t[0]));return d1(e)},BF={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:u1,rotateZ:u1,skewX:t=>El(Math.atan(t[1])),skewY:t=>El(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},d1=t=>(t=t%360,t<0&&(t+=360),t),p2=u1,m2=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),g2=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),UF={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:m2,scaleY:g2,scale:t=>(m2(t)+g2(t))/2,rotateX:t=>d1(El(Math.atan2(t[6],t[5]))),rotateY:t=>d1(El(Math.atan2(-t[2],t[0]))),rotateZ:p2,rotate:p2,skewX:t=>El(Math.atan(t[4])),skewY:t=>El(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function f1(t){return t.includes("scale")?1:0}function h1(t,e){if(!t||t==="none")return f1(e);const n=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,s;if(n)r=UF,s=n;else{const a=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=BF,s=a}if(!s)return f1(e);const i=r[e],o=s[1].split(",").map(VF);return typeof i=="function"?i(o):o[i]}const HF=(t,e)=>{const{transform:n="none"}=getComputedStyle(t);return h1(n,e)};function VF(t){return parseFloat(t.trim())}const Mu=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Ru=(()=>new Set(Mu))(),y2=t=>t===Au||t===Qt,WF=new Set(["x","y","z"]),KF=Mu.filter(t=>!WF.has(t));function GF(t){const e=[];return KF.forEach(n=>{const r=t.getValue(n);r!==void 0&&(e.push([n,r.get()]),r.set(n.startsWith("scale")?1:0))}),e}const Pl={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>h1(e,"x"),y:(t,{transform:e})=>h1(e,"y")};Pl.translateX=Pl.x;Pl.translateY=Pl.y;const Ll=new Set;let p1=!1,m1=!1,g1=!1;function pD(){if(m1){const t=Array.from(Ll).filter(r=>r.needsMeasurement),e=new Set(t.map(r=>r.element)),n=new Map;e.forEach(r=>{const s=GF(r);s.length&&(n.set(r,s),r.render())}),t.forEach(r=>r.measureInitialState()),e.forEach(r=>{r.render();const s=n.get(r);s&&s.forEach(([i,o])=>{var a;(a=r.getValue(i))==null||a.set(o)})}),t.forEach(r=>r.measureEndState()),t.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}m1=!1,p1=!1,Ll.forEach(t=>t.complete(g1)),Ll.clear()}function mD(){Ll.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(m1=!0)})}function qF(){g1=!0,mD(),pD(),g1=!1}class Ww{constructor(e,n,r,s,i,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=r,this.motionValue=s,this.element=i,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(Ll.add(this),p1||(p1=!0,qn.read(mD),qn.resolveKeyframes(pD))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:r,motionValue:s}=this;if(e[0]===null){const i=s==null?void 0:s.get(),o=e[e.length-1];if(i!==void 0)e[0]=i;else if(r&&n){const a=r.readValue(n,o);a!=null&&(e[0]=a)}e[0]===void 0&&(e[0]=o),s&&i===void 0&&s.set(e[0])}FF(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Ll.delete(this)}cancel(){this.state==="scheduled"&&(Ll.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const JF=t=>t.startsWith("--");function YF(t,e,n){JF(e)?t.style.setProperty(e,n):t.style[e]=n}const XF=Mw(()=>window.ScrollTimeline!==void 0),QF={};function ZF(t,e){const n=Mw(t);return()=>QF[e]??n()}const gD=ZF(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),cd=([t,e,n,r])=>`cubic-bezier(${t}, ${e}, ${n}, ${r})`,x2={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:cd([0,.65,.55,1]),circOut:cd([.55,0,1,.45]),backIn:cd([.31,.01,.66,-.59]),backOut:cd([.33,1.53,.69,.99])};function yD(t,e){if(t)return typeof t=="function"?gD()?dD(t,e):"ease-out":eD(t)?cd(t):Array.isArray(t)?t.map(n=>yD(n,e)||x2.easeOut):x2[t]}function eB(t,e,n,{delay:r=0,duration:s=300,repeat:i=0,repeatType:o="loop",ease:a="easeOut",times:l}={},u=void 0){const d={[e]:n};l&&(d.offset=l);const f=yD(a,s);Array.isArray(f)&&(d.easing=f);const h={delay:r,duration:s,easing:Array.isArray(f)?"linear":f,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"};return u&&(h.pseudoElement=u),t.animate(d,h)}function xD(t){return typeof t=="function"&&"applyToOptions"in t}function tB({type:t,...e}){return xD(t)&&gD()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class nB extends Hw{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:n,name:r,keyframes:s,pseudoElement:i,allowFlatten:o=!1,finalKeyframe:a,onComplete:l}=e;this.isPseudoElement=!!i,this.allowFlatten=o,this.options=e,Aw(typeof e.type!="string");const u=tB(e);this.animation=eB(n,r,s,u,i),u.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!i){const d=Uw(s,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(d):YF(n,r,d),this.animation.cancel()}l==null||l(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,n;(n=(e=this.animation).finish)==null||n.call(e)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,n;this.isPseudoElement||(n=(e=this.animation).commitStyles)==null||n.call(e)}get duration(){var n,r;const e=((r=(n=this.animation.effect)==null?void 0:n.getComputedTiming)==null?void 0:r.call(n).duration)||0;return xi(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+xi(e)}get time(){return xi(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=po(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:n}){var r;return this.allowFlatten&&((r=this.animation.effect)==null||r.updateTiming({easing:"linear"})),this.animation.onfinish=null,e&&XF()?(this.animation.timeline=e,wi):n(this)}}const bD={anticipate:YI,backInOut:JI,circInOut:QI};function rB(t){return t in bD}function sB(t){typeof t.ease=="string"&&rB(t.ease)&&(t.ease=bD[t.ease])}const b2=10;class iB extends nB{constructor(e){sB(e),hD(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:n,onUpdate:r,onComplete:s,element:i,...o}=this.options;if(!n)return;if(e!==void 0){n.set(e);return}const a=new Vw({...o,autoplay:!1}),l=po(this.finishedTime??this.time);n.setWithVelocity(a.sample(l-b2).value,a.sample(l).value,b2),a.stop()}}const w2=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Ha.test(t)||t==="0")&&!t.startsWith("url("));function oB(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function aB(t,e,n,r){const s=t[0];if(s===null)return!1;if(e==="display"||e==="visibility")return!0;const i=t[t.length-1],o=w2(s,e),a=w2(i,e);return!o||!a?!1:oB(t)||(n==="spring"||xD(n))&&r}function y1(t){t.duration=0,t.type="keyframes"}const lB=new Set(["opacity","clipPath","filter","transform"]),cB=Mw(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function uB(t){var d;const{motionValue:e,name:n,repeatDelay:r,repeatType:s,damping:i,type:o}=t;if(!(((d=e==null?void 0:e.owner)==null?void 0:d.current)instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:u}=e.owner.getProps();return cB()&&n&&lB.has(n)&&(n!=="transform"||!u)&&!l&&!r&&s!=="mirror"&&i!==0&&o!=="inertia"}const dB=40;class fB extends Hw{constructor({autoplay:e=!0,delay:n=0,type:r="keyframes",repeat:s=0,repeatDelay:i=0,repeatType:o="loop",keyframes:a,name:l,motionValue:u,element:d,...f}){var m;super(),this.stop=()=>{var y,x;this._animation&&(this._animation.stop(),(y=this.stopTimeline)==null||y.call(this)),(x=this.keyframeResolver)==null||x.cancel()},this.createdAt=Rs.now();const h={autoplay:e,delay:n,type:r,repeat:s,repeatDelay:i,repeatType:o,name:l,motionValue:u,element:d,...f},p=(d==null?void 0:d.KeyframeResolver)||Ww;this.keyframeResolver=new p(a,(y,x,g)=>this.onKeyframesResolved(y,x,h,!g),l,u,d),(m=this.keyframeResolver)==null||m.scheduleResolve()}onKeyframesResolved(e,n,r,s){this.keyframeResolver=void 0;const{name:i,type:o,velocity:a,delay:l,isHandoff:u,onUpdate:d}=r;this.resolvedAt=Rs.now(),aB(e,i,o,a)||((Jo.instantAnimations||!l)&&(d==null||d(Uw(e,r,n))),e[0]=e[e.length-1],y1(r),r.repeat=0);const h={startTime:s?this.resolvedAt?this.resolvedAt-this.createdAt>dB?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...r,keyframes:e},p=!u&&uB(h)?new iB({...h,element:h.motionValue.owner.current}):new Vw(h);p.finished.then(()=>this.notifyFinished()).catch(wi),this.pendingTimeline&&(this.stopTimeline=p.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=p}get finished(){return this._animation?this.animation.finished:this._finished}then(e,n){return this.finished.finally(e).then(()=>{})}get animation(){var e;return this._animation||((e=this.keyframeResolver)==null||e.resume(),qF()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),(e=this.keyframeResolver)==null||e.cancel()}}const hB=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function pB(t){const e=hB.exec(t);if(!e)return[,];const[,n,r,s]=e;return[`--${n??r}`,s]}function wD(t,e,n=1){const[r,s]=pB(t);if(!r)return;const i=window.getComputedStyle(e).getPropertyValue(r);if(i){const o=i.trim();return BI(o)?parseFloat(o):o}return Lw(s)?wD(s,e,n+1):s}function Kw(t,e){return(t==null?void 0:t[e])??(t==null?void 0:t.default)??t}const vD=new Set(["width","height","top","left","right","bottom",...Mu]),mB={test:t=>t==="auto",parse:t=>t},kD=t=>e=>e.test(t),SD=[Au,Qt,mo,oa,oF,iF,mB],v2=t=>SD.find(kD(t));function gB(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||HI(t):!0}const yB=new Set(["brightness","contrast","saturate","opacity"]);function xB(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[r]=n.match($w)||[];if(!r)return t;const s=n.replace(r,"");let i=yB.has(e)?1:0;return r!==n&&(i*=100),e+"("+i+s+")"}const bB=/\b([a-z-]*)\(.*?\)/gu,x1={...Ha,getAnimatableNone:t=>{const e=t.match(bB);return e?e.map(xB).join(" "):t}},k2={...Au,transform:Math.round},wB={rotate:oa,rotateX:oa,rotateY:oa,rotateZ:oa,scale:Eh,scaleX:Eh,scaleY:Eh,scaleZ:Eh,skew:oa,skewX:oa,skewY:oa,distance:Qt,translateX:Qt,translateY:Qt,translateZ:Qt,x:Qt,y:Qt,z:Qt,perspective:Qt,transformPerspective:Qt,opacity:yf,originX:c2,originY:c2,originZ:Qt},Gw={borderWidth:Qt,borderTopWidth:Qt,borderRightWidth:Qt,borderBottomWidth:Qt,borderLeftWidth:Qt,borderRadius:Qt,radius:Qt,borderTopLeftRadius:Qt,borderTopRightRadius:Qt,borderBottomRightRadius:Qt,borderBottomLeftRadius:Qt,width:Qt,maxWidth:Qt,height:Qt,maxHeight:Qt,top:Qt,right:Qt,bottom:Qt,left:Qt,padding:Qt,paddingTop:Qt,paddingRight:Qt,paddingBottom:Qt,paddingLeft:Qt,margin:Qt,marginTop:Qt,marginRight:Qt,marginBottom:Qt,marginLeft:Qt,backgroundPositionX:Qt,backgroundPositionY:Qt,...wB,zIndex:k2,fillOpacity:yf,strokeOpacity:yf,numOctaves:k2},vB={...Gw,color:kr,backgroundColor:kr,outlineColor:kr,fill:kr,stroke:kr,borderColor:kr,borderTopColor:kr,borderRightColor:kr,borderBottomColor:kr,borderLeftColor:kr,filter:x1,WebkitFilter:x1},_D=t=>vB[t];function TD(t,e){let n=_D(t);return n!==x1&&(n=Ha),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const kB=new Set(["auto","none","0"]);function SB(t,e,n){let r=0,s;for(;r<t.length&&!s;){const i=t[r];typeof i=="string"&&!kB.has(i)&&xf(i).values.length&&(s=t[r]),r++}if(s&&n)for(const i of e)t[i]=TD(n,s)}class _B extends Ww{constructor(e,n,r,s,i){super(e,n,r,s,i,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:r}=this;if(!n||!n.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let u=e[l];if(typeof u=="string"&&(u=u.trim(),Lw(u))){const d=wD(u,n.current);d!==void 0&&(e[l]=d),l===e.length-1&&(this.finalKeyframe=u)}}if(this.resolveNoneKeyframes(),!vD.has(r)||e.length!==2)return;const[s,i]=e,o=v2(s),a=v2(i);if(o!==a)if(y2(o)&&y2(a))for(let l=0;l<e.length;l++){const u=e[l];typeof u=="string"&&(e[l]=parseFloat(u))}else Pl[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,r=[];for(let s=0;s<e.length;s++)(e[s]===null||gB(e[s]))&&r.push(s);r.length&&SB(e,r,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:r}=this;if(!e||!e.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Pl[r](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const s=n[n.length-1];s!==void 0&&e.getValue(r,s).jump(s,!1)}measureEndState(){var a;const{element:e,name:n,unresolvedKeyframes:r}=this;if(!e||!e.current)return;const s=e.getValue(n);s&&s.jump(this.measuredOrigin,!1);const i=r.length-1,o=r[i];r[i]=Pl[n](e.measureViewportBox(),window.getComputedStyle(e.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),(a=this.removedTransforms)!=null&&a.length&&this.removedTransforms.forEach(([l,u])=>{e.getValue(l).set(u)}),this.resolveNoneKeyframes()}}function TB(t,e,n){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let r=document;e&&(r=e.current);const s=(n==null?void 0:n[t])??r.querySelectorAll(t);return s?Array.from(s):[]}return Array.from(t)}const CD=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function ED(t){return UI(t)&&"offsetHeight"in t}const S2=30,CB=t=>!isNaN(parseFloat(t));class EB{constructor(e,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{var i;const s=Rs.now();if(this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&((i=this.events.change)==null||i.notify(this.current),this.dependents))for(const o of this.dependents)o.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=Rs.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=CB(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new Rw);const r=this.events[e].add(n);return e==="change"?()=>{r(),qn.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,n,r){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;(e=this.events.change)==null||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Rs.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>S2)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,S2);return VI(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,n;(e=this.dependents)==null||e.clear(),(n=this.events.destroy)==null||n.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function yu(t,e){return new EB(t,e)}const{schedule:qw,cancel:ore}=tD(queueMicrotask,!1),$i={x:!1,y:!1};function ND(){return $i.x||$i.y}function NB(t){return t==="x"||t==="y"?$i[t]?null:($i[t]=!0,()=>{$i[t]=!1}):$i.x||$i.y?null:($i.x=$i.y=!0,()=>{$i.x=$i.y=!1})}function jD(t,e){const n=TB(t),r=new AbortController,s={passive:!0,...e,signal:r.signal};return[n,s,()=>r.abort()]}function _2(t){return!(t.pointerType==="touch"||ND())}function jB(t,e,n={}){const[r,s,i]=jD(t,n),o=a=>{if(!_2(a))return;const{target:l}=a,u=e(l,a);if(typeof u!="function"||!l)return;const d=f=>{_2(f)&&(u(f),l.removeEventListener("pointerleave",d))};l.addEventListener("pointerleave",d,s)};return r.forEach(a=>{a.addEventListener("pointerenter",o,s)}),i}const ID=(t,e)=>e?t===e?!0:ID(t,e.parentElement):!1,Jw=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,IB=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function DB(t){return IB.has(t.tagName)||t.tabIndex!==-1}const fp=new WeakSet;function T2(t){return e=>{e.key==="Enter"&&t(e)}}function V0(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const AB=(t,e)=>{const n=t.currentTarget;if(!n)return;const r=T2(()=>{if(fp.has(n))return;V0(n,"down");const s=T2(()=>{V0(n,"up")}),i=()=>V0(n,"cancel");n.addEventListener("keyup",s,e),n.addEventListener("blur",i,e)});n.addEventListener("keydown",r,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",r),e)};function C2(t){return Jw(t)&&!ND()}function MB(t,e,n={}){const[r,s,i]=jD(t,n),o=a=>{const l=a.currentTarget;if(!C2(a))return;fp.add(l);const u=e(l,a),d=(p,m)=>{window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",h),fp.has(l)&&fp.delete(l),C2(p)&&typeof u=="function"&&u(p,{success:m})},f=p=>{d(p,l===window||l===document||n.useGlobalTarget||ID(l,p.target))},h=p=>{d(p,!1)};window.addEventListener("pointerup",f,s),window.addEventListener("pointercancel",h,s)};return r.forEach(a=>{(n.useGlobalTarget?window:a).addEventListener("pointerdown",o,s),ED(a)&&(a.addEventListener("focus",u=>AB(u,s)),!DB(a)&&!a.hasAttribute("tabindex")&&(a.tabIndex=0))}),i}function DD(t){return UI(t)&&"ownerSVGElement"in t}function RB(t){return DD(t)&&t.tagName==="svg"}const us=t=>!!(t&&t.getVelocity),OB=[...SD,kr,Ha],PB=t=>OB.find(kD(t)),Yw=b.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function E2(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function LB(...t){return e=>{let n=!1;const r=t.map(s=>{const i=E2(s,e);return!n&&typeof i=="function"&&(n=!0),i});if(n)return()=>{for(let s=0;s<r.length;s++){const i=r[s];typeof i=="function"?i():E2(t[s],null)}}}}function $B(...t){return b.useCallback(LB(...t),t)}class zB extends b.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const r=n.offsetParent,s=ED(r)&&r.offsetWidth||0,i=this.props.sizeRef.current;i.height=n.offsetHeight||0,i.width=n.offsetWidth||0,i.top=n.offsetTop,i.left=n.offsetLeft,i.right=s-i.width-i.left}return null}componentDidUpdate(){}render(){return this.props.children}}function FB({children:t,isPresent:e,anchorX:n,root:r}){const s=b.useId(),i=b.useRef(null),o=b.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=b.useContext(Yw),l=$B(i,t==null?void 0:t.ref);return b.useInsertionEffect(()=>{const{width:u,height:d,top:f,left:h,right:p}=o.current;if(e||!i.current||!u||!d)return;const m=n==="left"?`left: ${h}`:`right: ${p}`;i.current.dataset.motionPopId=s;const y=document.createElement("style");a&&(y.nonce=a);const x=r??document.head;return x.appendChild(y),y.sheet&&y.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${u}px !important;
            height: ${d}px !important;
            ${m}px !important;
            top: ${f}px !important;
          }
        `),()=>{x.contains(y)&&x.removeChild(y)}},[e]),c.jsx(zB,{isPresent:e,childRef:i,sizeRef:o,children:b.cloneElement(t,{ref:l})})}const BB=({children:t,initial:e,isPresent:n,onExitComplete:r,custom:s,presenceAffectsLayout:i,mode:o,anchorX:a,root:l})=>{const u=Ew(UB),d=b.useId();let f=!0,h=b.useMemo(()=>(f=!1,{id:d,initial:e,isPresent:n,custom:s,onExitComplete:p=>{u.set(p,!0);for(const m of u.values())if(!m)return;r&&r()},register:p=>(u.set(p,!1),()=>u.delete(p))}),[n,u,r]);return i&&f&&(h={...h}),b.useMemo(()=>{u.forEach((p,m)=>u.set(m,!1))},[n]),b.useEffect(()=>{!n&&!u.size&&r&&r()},[n]),o==="popLayout"&&(t=c.jsx(FB,{isPresent:n,anchorX:a,root:l,children:t})),c.jsx(Ng.Provider,{value:h,children:t})};function UB(){return new Map}function AD(t=!0){const e=b.useContext(Ng);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:r,register:s}=e,i=b.useId();b.useEffect(()=>{if(t)return s(i)},[t]);const o=b.useCallback(()=>t&&r&&r(i),[i,r,t]);return!n&&r?[!1,o]:[!0]}const Nh=t=>t.key||"";function N2(t){const e=[];return b.Children.forEach(t,n=>{b.isValidElement(n)&&e.push(n)}),e}const go=({children:t,custom:e,initial:n=!0,onExitComplete:r,presenceAffectsLayout:s=!0,mode:i="sync",propagate:o=!1,anchorX:a="left",root:l})=>{const[u,d]=AD(o),f=b.useMemo(()=>N2(t),[t]),h=o&&!u?[]:f.map(Nh),p=b.useRef(!0),m=b.useRef(f),y=Ew(()=>new Map),[x,g]=b.useState(f),[v,w]=b.useState(f);jw(()=>{p.current=!1,m.current=f;for(let k=0;k<v.length;k++){const R=Nh(v[k]);h.includes(R)?y.delete(R):y.get(R)!==!0&&y.set(R,!1)}},[v,h.length,h.join("-")]);const S=[];if(f!==x){let k=[...f];for(let R=0;R<v.length;R++){const C=v[R],T=Nh(C);h.includes(T)||(k.splice(R,0,C),S.push(C))}return i==="wait"&&S.length&&(k=S),w(N2(k)),g(f),null}const{forceRender:I}=b.useContext(mf);return c.jsx(c.Fragment,{children:v.map(k=>{const R=Nh(k),C=o&&!u?!1:f===v||h.includes(R),T=()=>{if(y.has(R))y.set(R,!0);else return;let _=!0;y.forEach(N=>{N||(_=!1)}),_&&(I==null||I(),w(m.current),o&&(d==null||d()),r&&r())};return c.jsx(BB,{isPresent:C,initial:!p.current||n?void 0:!1,custom:e,presenceAffectsLayout:s,mode:i,root:l,onExitComplete:C?void 0:T,anchorX:a,children:k},R)})})},HB=b.createContext(null);function VB(){const t=b.useRef(!1);return jw(()=>(t.current=!0,()=>{t.current=!1}),[]),t}function WB(){const t=VB(),[e,n]=b.useState(0),r=b.useCallback(()=>{t.current&&n(e+1)},[e]);return[b.useCallback(()=>qn.postRender(r),[r]),e]}const KB=t=>!t.isLayoutDirty&&t.willUpdate(!1);function j2(){const t=new Set,e=new WeakMap,n=()=>t.forEach(KB);return{add:r=>{t.add(r),e.set(r,r.addEventListener("willUpdate",n))},remove:r=>{t.delete(r);const s=e.get(r);s&&(s(),e.delete(r)),n()},dirty:n}}const MD=t=>t===!0,GB=t=>MD(t===!0)||t==="id",qB=({children:t,id:e,inherit:n=!0})=>{const r=b.useContext(mf),s=b.useContext(HB),[i,o]=WB(),a=b.useRef(null),l=r.id||s;a.current===null&&(GB(n)&&l&&(e=e?l+"-"+e:l),a.current={id:e,group:MD(n)&&r.group||j2()});const u=b.useMemo(()=>({...a.current,forceRender:i}),[o]);return c.jsx(mf.Provider,{value:u,children:t})},RD=b.createContext({strict:!1}),I2={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},xu={};for(const t in I2)xu[t]={isEnabled:e=>I2[t].some(n=>!!e[n])};function JB(t){for(const e in t)xu[e]={...xu[e],...t[e]}}const YB=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function om(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||YB.has(t)}let OD=t=>!om(t);function XB(t){typeof t=="function"&&(OD=e=>e.startsWith("on")?!om(e):t(e))}try{XB(require("@emotion/is-prop-valid").default)}catch{}function QB(t,e,n){const r={};for(const s in t)s==="values"&&typeof t.values=="object"||(OD(s)||n===!0&&om(s)||!e&&!om(s)||t.draggable&&s.startsWith("onDrag"))&&(r[s]=t[s]);return r}const jg=b.createContext({});function Ig(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function bf(t){return typeof t=="string"||Array.isArray(t)}const Xw=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Qw=["initial",...Xw];function Dg(t){return Ig(t.animate)||Qw.some(e=>bf(t[e]))}function PD(t){return!!(Dg(t)||t.variants)}function ZB(t,e){if(Dg(t)){const{initial:n,animate:r}=t;return{initial:n===!1||bf(n)?n:void 0,animate:bf(r)?r:void 0}}return t.inherit!==!1?e:{}}function eU(t){const{initial:e,animate:n}=ZB(t,b.useContext(jg));return b.useMemo(()=>({initial:e,animate:n}),[D2(e),D2(n)])}function D2(t){return Array.isArray(t)?t.join(" "):t}function A2(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Yu={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(Qt.test(t))t=parseFloat(t);else return t;const n=A2(t,e.target.x),r=A2(t,e.target.y);return`${n}% ${r}%`}},tU={correct:(t,{treeScale:e,projectionDelta:n})=>{const r=t,s=Ha.parse(t);if(s.length>5)return r;const i=Ha.createTransformer(t),o=typeof s[0]!="number"?1:0,a=n.x.scale*e.x,l=n.y.scale*e.y;s[0+o]/=a,s[1+o]/=l;const u=ar(a,l,.5);return typeof s[2+o]=="number"&&(s[2+o]/=u),typeof s[3+o]=="number"&&(s[3+o]/=u),i(s)}},b1={borderRadius:{...Yu,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Yu,borderTopRightRadius:Yu,borderBottomLeftRadius:Yu,borderBottomRightRadius:Yu,boxShadow:tU};function LD(t,{layout:e,layoutId:n}){return Ru.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!b1[t]||t==="opacity")}const nU={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},rU=Mu.length;function sU(t,e,n){let r="",s=!0;for(let i=0;i<rU;i++){const o=Mu[i],a=t[o];if(a===void 0)continue;let l=!0;if(typeof a=="number"?l=a===(o.startsWith("scale")?1:0):l=parseFloat(a)===0,!l||n){const u=CD(a,Gw[o]);if(!l){s=!1;const d=nU[o]||o;r+=`${d}(${u}) `}n&&(e[o]=u)}}return r=r.trim(),n?r=n(e,s?"":r):s&&(r="none"),r}function Zw(t,e,n){const{style:r,vars:s,transformOrigin:i}=t;let o=!1,a=!1;for(const l in e){const u=e[l];if(Ru.has(l)){o=!0;continue}else if(rD(l)){s[l]=u;continue}else{const d=CD(u,Gw[l]);l.startsWith("origin")?(a=!0,i[l]=d):r[l]=d}}if(e.transform||(o||n?r.transform=sU(e,t.transform,n):r.transform&&(r.transform="none")),a){const{originX:l="50%",originY:u="50%",originZ:d=0}=i;r.transformOrigin=`${l} ${u} ${d}`}}const ev=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function $D(t,e,n){for(const r in e)!us(e[r])&&!LD(r,n)&&(t[r]=e[r])}function iU({transformTemplate:t},e){return b.useMemo(()=>{const n=ev();return Zw(n,e,t),Object.assign({},n.vars,n.style)},[e])}function oU(t,e){const n=t.style||{},r={};return $D(r,n,t),Object.assign(r,iU(t,e)),r}function aU(t,e){const n={},r=oU(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=r,n}const lU={offset:"stroke-dashoffset",array:"stroke-dasharray"},cU={offset:"strokeDashoffset",array:"strokeDasharray"};function uU(t,e,n=1,r=0,s=!0){t.pathLength=1;const i=s?lU:cU;t[i.offset]=Qt.transform(-r);const o=Qt.transform(e),a=Qt.transform(n);t[i.array]=`${o} ${a}`}function zD(t,{attrX:e,attrY:n,attrScale:r,pathLength:s,pathSpacing:i=1,pathOffset:o=0,...a},l,u,d){if(Zw(t,a,u),l){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:f,style:h}=t;f.transform&&(h.transform=f.transform,delete f.transform),(h.transform||f.transformOrigin)&&(h.transformOrigin=f.transformOrigin??"50% 50%",delete f.transformOrigin),h.transform&&(h.transformBox=(d==null?void 0:d.transformBox)??"fill-box",delete f.transformBox),e!==void 0&&(f.x=e),n!==void 0&&(f.y=n),r!==void 0&&(f.scale=r),s!==void 0&&uU(f,s,i,o,!1)}const FD=()=>({...ev(),attrs:{}}),BD=t=>typeof t=="string"&&t.toLowerCase()==="svg";function dU(t,e,n,r){const s=b.useMemo(()=>{const i=FD();return zD(i,e,BD(r),t.transformTemplate,t.style),{...i.attrs,style:{...i.style}}},[e]);if(t.style){const i={};$D(i,t.style,t),s.style={...i,...s.style}}return s}const fU=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function tv(t){return typeof t!="string"||t.includes("-")?!1:!!(fU.indexOf(t)>-1||/[A-Z]/u.test(t))}function hU(t,e,n,{latestValues:r},s,i=!1){const a=(tv(t)?dU:aU)(e,r,s,t),l=QB(e,typeof t=="string",i),u=t!==b.Fragment?{...l,...a,ref:n}:{},{children:d}=e,f=b.useMemo(()=>us(d)?d.get():d,[d]);return b.createElement(t,{...u,children:f})}function M2(t){const e=[{},{}];return t==null||t.values.forEach((n,r)=>{e[0][r]=n.get(),e[1][r]=n.getVelocity()}),e}function nv(t,e,n,r){if(typeof e=="function"){const[s,i]=M2(r);e=e(n!==void 0?n:t.custom,s,i)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[s,i]=M2(r);e=e(n!==void 0?n:t.custom,s,i)}return e}function hp(t){return us(t)?t.get():t}function pU({scrapeMotionValuesFromProps:t,createRenderState:e},n,r,s){return{latestValues:mU(n,r,s,t),renderState:e()}}function mU(t,e,n,r){const s={},i=r(t,{});for(const h in i)s[h]=hp(i[h]);let{initial:o,animate:a}=t;const l=Dg(t),u=PD(t);e&&u&&!l&&t.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let d=n?n.initial===!1:!1;d=d||o===!1;const f=d?a:o;if(f&&typeof f!="boolean"&&!Ig(f)){const h=Array.isArray(f)?f:[f];for(let p=0;p<h.length;p++){const m=nv(t,h[p]);if(m){const{transitionEnd:y,transition:x,...g}=m;for(const v in g){let w=g[v];if(Array.isArray(w)){const S=d?w.length-1:0;w=w[S]}w!==null&&(s[v]=w)}for(const v in y)s[v]=y[v]}}}return s}const UD=t=>(e,n)=>{const r=b.useContext(jg),s=b.useContext(Ng),i=()=>pU(t,e,r,s);return n?i():Ew(i)};function rv(t,e,n){var i;const{style:r}=t,s={};for(const o in r)(us(r[o])||e.style&&us(e.style[o])||LD(o,t)||((i=n==null?void 0:n.getValue(o))==null?void 0:i.liveStyle)!==void 0)&&(s[o]=r[o]);return s}const gU=UD({scrapeMotionValuesFromProps:rv,createRenderState:ev});function HD(t,e,n){const r=rv(t,e,n);for(const s in t)if(us(t[s])||us(e[s])){const i=Mu.indexOf(s)!==-1?"attr"+s.charAt(0).toUpperCase()+s.substring(1):s;r[i]=t[s]}return r}const yU=UD({scrapeMotionValuesFromProps:HD,createRenderState:FD}),xU=Symbol.for("motionComponentSymbol");function Uc(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function bU(t,e,n){return b.useCallback(r=>{r&&t.onMount&&t.onMount(r),e&&(r?e.mount(r):e.unmount()),n&&(typeof n=="function"?n(r):Uc(n)&&(n.current=r))},[e])}const sv=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),wU="framerAppearId",VD="data-"+sv(wU),WD=b.createContext({});function vU(t,e,n,r,s){var y,x;const{visualElement:i}=b.useContext(jg),o=b.useContext(RD),a=b.useContext(Ng),l=b.useContext(Yw).reducedMotion,u=b.useRef(null);r=r||o.renderer,!u.current&&r&&(u.current=r(t,{visualState:e,parent:i,props:n,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:l}));const d=u.current,f=b.useContext(WD);d&&!d.projection&&s&&(d.type==="html"||d.type==="svg")&&kU(u.current,n,s,f);const h=b.useRef(!1);b.useInsertionEffect(()=>{d&&h.current&&d.update(n,a)});const p=n[VD],m=b.useRef(!!p&&!((y=window.MotionHandoffIsComplete)!=null&&y.call(window,p))&&((x=window.MotionHasOptimisedAnimation)==null?void 0:x.call(window,p)));return jw(()=>{d&&(h.current=!0,window.MotionIsMounted=!0,d.updateFeatures(),d.scheduleRenderMicrotask(),m.current&&d.animationState&&d.animationState.animateChanges())}),b.useEffect(()=>{d&&(!m.current&&d.animationState&&d.animationState.animateChanges(),m.current&&(queueMicrotask(()=>{var g;(g=window.MotionHandoffMarkAsComplete)==null||g.call(window,p)}),m.current=!1),d.enteringChildren=void 0)}),d}function kU(t,e,n,r){const{layoutId:s,layout:i,drag:o,dragConstraints:a,layoutScroll:l,layoutRoot:u,layoutCrossfade:d}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:KD(t.parent)),t.projection.setOptions({layoutId:s,layout:i,alwaysMeasureLayout:!!o||a&&Uc(a),visualElement:t,animationType:typeof i=="string"?i:"both",initialPromotionConfig:r,crossfade:d,layoutScroll:l,layoutRoot:u})}function KD(t){if(t)return t.options.allowProjection!==!1?t.projection:KD(t.parent)}function W0(t,{forwardMotionProps:e=!1}={},n,r){n&&JB(n);const s=tv(t)?yU:gU;function i(a,l){let u;const d={...b.useContext(Yw),...a,layoutId:SU(a)},{isStatic:f}=d,h=eU(a),p=s(a,f);if(!f&&Nw){_U();const m=TU(d);u=m.MeasureLayout,h.visualElement=vU(t,p,d,r,m.ProjectionNode)}return c.jsxs(jg.Provider,{value:h,children:[u&&h.visualElement?c.jsx(u,{visualElement:h.visualElement,...d}):null,hU(t,a,bU(p,h.visualElement,l),p,f,e)]})}i.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const o=b.forwardRef(i);return o[xU]=t,o}function SU({layoutId:t}){const e=b.useContext(mf).id;return e&&t!==void 0?e+"-"+t:t}function _U(t,e){b.useContext(RD).strict}function TU(t){const{drag:e,layout:n}=xu;if(!e&&!n)return{};const r={...e,...n};return{MeasureLayout:e!=null&&e.isEnabled(t)||n!=null&&n.isEnabled(t)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function CU(t,e){if(typeof Proxy>"u")return W0;const n=new Map,r=(i,o)=>W0(i,o,t,e),s=(i,o)=>r(i,o);return new Proxy(s,{get:(i,o)=>o==="create"?r:(n.has(o)||n.set(o,W0(o,void 0,t,e)),n.get(o))})}function GD({top:t,left:e,right:n,bottom:r}){return{x:{min:e,max:n},y:{min:t,max:r}}}function EU({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function NU(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),r=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:r.y,right:r.x}}function K0(t){return t===void 0||t===1}function w1({scale:t,scaleX:e,scaleY:n}){return!K0(t)||!K0(e)||!K0(n)}function hl(t){return w1(t)||qD(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function qD(t){return R2(t.x)||R2(t.y)}function R2(t){return t&&t!=="0%"}function am(t,e,n){const r=t-n,s=e*r;return n+s}function O2(t,e,n,r,s){return s!==void 0&&(t=am(t,s,r)),am(t,n,r)+e}function v1(t,e=0,n=1,r,s){t.min=O2(t.min,e,n,r,s),t.max=O2(t.max,e,n,r,s)}function JD(t,{x:e,y:n}){v1(t.x,e.translate,e.scale,e.originPoint),v1(t.y,n.translate,n.scale,n.originPoint)}const P2=.999999999999,L2=1.0000000000001;function jU(t,e,n,r=!1){const s=n.length;if(!s)return;e.x=e.y=1;let i,o;for(let a=0;a<s;a++){i=n[a],o=i.projectionDelta;const{visualElement:l}=i.options;l&&l.props.style&&l.props.style.display==="contents"||(r&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Vc(t,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,JD(t,o)),r&&hl(i.latestValues)&&Vc(t,i.latestValues))}e.x<L2&&e.x>P2&&(e.x=1),e.y<L2&&e.y>P2&&(e.y=1)}function Hc(t,e){t.min=t.min+e,t.max=t.max+e}function $2(t,e,n,r,s=.5){const i=ar(t.min,t.max,s);v1(t,e,n,i,r)}function Vc(t,e){$2(t.x,e.x,e.scaleX,e.scale,e.originX),$2(t.y,e.y,e.scaleY,e.scale,e.originY)}function YD(t,e){return GD(NU(t.getBoundingClientRect(),e))}function IU(t,e,n){const r=YD(t,n),{scroll:s}=e;return s&&(Hc(r.x,s.offset.x),Hc(r.y,s.offset.y)),r}const z2=()=>({translate:0,scale:1,origin:0,originPoint:0}),Wc=()=>({x:z2(),y:z2()}),F2=()=>({min:0,max:0}),Ir=()=>({x:F2(),y:F2()}),k1={current:null},XD={current:!1};function DU(){if(XD.current=!0,!!Nw)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>k1.current=t.matches;t.addEventListener("change",e),e()}else k1.current=!1}const AU=new WeakMap;function MU(t,e,n){for(const r in e){const s=e[r],i=n[r];if(us(s))t.addValue(r,s);else if(us(i))t.addValue(r,yu(s,{owner:t}));else if(i!==s)if(t.hasValue(r)){const o=t.getValue(r);o.liveStyle===!0?o.jump(s):o.hasAnimated||o.set(s)}else{const o=t.getStaticValue(r);t.addValue(r,yu(o!==void 0?o:s,{owner:t}))}}for(const r in n)e[r]===void 0&&t.removeValue(r);return e}const B2=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class RU{scrapeMotionValuesFromProps(e,n,r){return{}}constructor({parent:e,props:n,presenceContext:r,reducedMotionConfig:s,blockInitialAnimation:i,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Ww,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const h=Rs.now();this.renderScheduledAt<h&&(this.renderScheduledAt=h,qn.render(this.render,!1,!0))};const{latestValues:l,renderState:u}=o;this.latestValues=l,this.baseTarget={...l},this.initialValues=n.initial?{...l}:{},this.renderState=u,this.parent=e,this.props=n,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=s,this.options=a,this.blockInitialAnimation=!!i,this.isControllingVariants=Dg(n),this.isVariantNode=PD(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...f}=this.scrapeMotionValuesFromProps(n,{},this);for(const h in f){const p=f[h];l[h]!==void 0&&us(p)&&p.set(l[h])}}mount(e){var n;this.current=e,AU.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,s)=>this.bindToMotionValue(s,r)),XD.current||DU(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:k1.current,(n=this.parent)==null||n.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var e;this.projection&&this.projection.unmount(),Ua(this.notifyUpdate),Ua(this.render),this.valueSubscriptions.forEach(n=>n()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(e=this.parent)==null||e.removeChild(this);for(const n in this.events)this.events[n].clear();for(const n in this.features){const r=this.features[n];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=Ru.has(e);r&&this.onBindTransform&&this.onBindTransform();const s=n.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&qn.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let i;window.MotionCheckAppearSync&&(i=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{s(),i&&i(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in xu){const n=xu[e];if(!n)continue;const{isEnabled:r,Feature:s}=n;if(!this.features[e]&&s&&r(this.props)&&(this.features[e]=new s(this)),this.features[e]){const i=this.features[e];i.isMounted?i.update():(i.mount(),i.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ir()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let r=0;r<B2.length;r++){const s=B2[r];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const i="on"+s,o=e[i];o&&(this.propEventSubscriptions[s]=this.on(s,o))}this.prevMotionValues=MU(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const r=this.values.get(e);n!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&n!==void 0&&(r=yu(n===null?void 0:n,{owner:this}),this.addValue(e,r)),r}readValue(e,n){let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(BI(r)||HI(r))?r=parseFloat(r):!PB(r)&&Ha.test(n)&&(r=TD(e,n)),this.setBaseTarget(e,us(r)?r.get():r)),us(r)?r.get():r}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var i;const{initial:n}=this.props;let r;if(typeof n=="string"||typeof n=="object"){const o=nv(this.props,n,(i=this.presenceContext)==null?void 0:i.custom);o&&(r=o[e])}if(n&&r!==void 0)return r;const s=this.getBaseTargetFromProps(this.props,e);return s!==void 0&&!us(s)?s:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new Rw),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}scheduleRenderMicrotask(){qw.render(this.render)}}class QD extends RU{constructor(){super(...arguments),this.KeyframeResolver=_B}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:r}){delete n[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;us(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function ZD(t,{style:e,vars:n},r,s){const i=t.style;let o;for(o in e)i[o]=e[o];s==null||s.applyProjectionStyles(i,r);for(o in n)i.setProperty(o,n[o])}function OU(t){return window.getComputedStyle(t)}class PU extends QD{constructor(){super(...arguments),this.type="html",this.renderInstance=ZD}readValueFromInstance(e,n){var r;if(Ru.has(n))return(r=this.projection)!=null&&r.isProjecting?f1(n):HF(e,n);{const s=OU(e),i=(rD(n)?s.getPropertyValue(n):s[n])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:n}){return YD(e,n)}build(e,n,r){Zw(e,n,r.transformTemplate)}scrapeMotionValuesFromProps(e,n,r){return rv(e,n,r)}}const eA=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function LU(t,e,n,r){ZD(t,e,void 0,r);for(const s in e.attrs)t.setAttribute(eA.has(s)?s:sv(s),e.attrs[s])}class $U extends QD{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ir}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(Ru.has(n)){const r=_D(n);return r&&r.default||0}return n=eA.has(n)?n:sv(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,r){return HD(e,n,r)}build(e,n,r){zD(e,n,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(e,n,r,s){LU(e,n,r,s)}mount(e){this.isSVGTag=BD(e.tagName),super.mount(e)}}const zU=(t,e)=>tv(t)?new $U(e):new PU(e,{allowProjection:t!==b.Fragment});function ru(t,e,n){const r=t.getProps();return nv(r,e,n!==void 0?n:r.custom,t)}const S1=t=>Array.isArray(t);function FU(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,yu(n))}function BU(t){return S1(t)?t[t.length-1]||0:t}function UU(t,e){const n=ru(t,e);let{transitionEnd:r={},transition:s={},...i}=n||{};i={...i,...r};for(const o in i){const a=BU(i[o]);FU(t,o,a)}}function HU(t){return!!(us(t)&&t.add)}function _1(t,e){const n=t.getValue("willChange");if(HU(n))return n.add(e);if(!n&&Jo.WillChange){const r=new Jo.WillChange("auto");t.addValue("willChange",r),r.add(e)}}function tA(t){return t.props[VD]}const VU=t=>t!==null;function WU(t,{repeat:e,repeatType:n="loop"},r){const s=t.filter(VU),i=e&&n!=="loop"&&e%2===1?0:s.length-1;return!i||r===void 0?s[i]:r}const KU={type:"spring",stiffness:500,damping:25,restSpeed:10},GU=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),qU={type:"keyframes",duration:.8},JU={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},YU=(t,{keyframes:e})=>e.length>2?qU:Ru.has(t)?t.startsWith("scale")?GU(e[1]):KU:JU;function XU({when:t,delay:e,delayChildren:n,staggerChildren:r,staggerDirection:s,repeat:i,repeatType:o,repeatDelay:a,from:l,elapsed:u,...d}){return!!Object.keys(d).length}const iv=(t,e,n,r={},s,i)=>o=>{const a=Kw(r,t)||{},l=a.delay||r.delay||0;let{elapsed:u=0}=r;u=u-po(l);const d={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-u,onUpdate:h=>{e.set(h),a.onUpdate&&a.onUpdate(h)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:t,motionValue:e,element:i?void 0:s};XU(a)||Object.assign(d,YU(t,d)),d.duration&&(d.duration=po(d.duration)),d.repeatDelay&&(d.repeatDelay=po(d.repeatDelay)),d.from!==void 0&&(d.keyframes[0]=d.from);let f=!1;if((d.type===!1||d.duration===0&&!d.repeatDelay)&&(y1(d),d.delay===0&&(f=!0)),(Jo.instantAnimations||Jo.skipAnimations)&&(f=!0,y1(d),d.delay=0),d.allowFlatten=!a.type&&!a.ease,f&&!i&&e.get()!==void 0){const h=WU(d.keyframes,a);if(h!==void 0){qn.update(()=>{d.onUpdate(h),d.onComplete()});return}}return a.isSync?new Vw(d):new fB(d)};function QU({protectedKeys:t,needsAnimating:e},n){const r=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,r}function nA(t,e,{delay:n=0,transitionOverride:r,type:s}={}){let{transition:i=t.getDefaultTransition(),transitionEnd:o,...a}=e;r&&(i=r);const l=[],u=s&&t.animationState&&t.animationState.getState()[s];for(const d in a){const f=t.getValue(d,t.latestValues[d]??null),h=a[d];if(h===void 0||u&&QU(u,d))continue;const p={delay:n,...Kw(i||{},d)},m=f.get();if(m!==void 0&&!f.isAnimating&&!Array.isArray(h)&&h===m&&!p.velocity)continue;let y=!1;if(window.MotionHandoffAnimation){const g=tA(t);if(g){const v=window.MotionHandoffAnimation(g,d,qn);v!==null&&(p.startTime=v,y=!0)}}_1(t,d),f.start(iv(d,f,h,t.shouldReduceMotion&&vD.has(d)?{type:!1}:p,t,y));const x=f.animation;x&&l.push(x)}return o&&Promise.all(l).then(()=>{qn.update(()=>{o&&UU(t,o)})}),l}function rA(t,e,n,r=0,s=1){const i=Array.from(t).sort((u,d)=>u.sortNodePosition(d)).indexOf(e),o=t.size,a=(o-1)*r;return typeof n=="function"?n(i,o):s===1?i*r:a-i*r}function T1(t,e,n={}){var l;const r=ru(t,e,n.type==="exit"?(l=t.presenceContext)==null?void 0:l.custom:void 0);let{transition:s=t.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(s=n.transitionOverride);const i=r?()=>Promise.all(nA(t,r,n)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?(u=0)=>{const{delayChildren:d=0,staggerChildren:f,staggerDirection:h}=s;return ZU(t,e,u,d,f,h,n)}:()=>Promise.resolve(),{when:a}=s;if(a){const[u,d]=a==="beforeChildren"?[i,o]:[o,i];return u().then(()=>d())}else return Promise.all([i(),o(n.delay)])}function ZU(t,e,n=0,r=0,s=0,i=1,o){const a=[];for(const l of t.variantChildren)l.notify("AnimationStart",e),a.push(T1(l,e,{...o,delay:n+(typeof r=="function"?0:r)+rA(t.variantChildren,l,r,s,i)}).then(()=>l.notify("AnimationComplete",e)));return Promise.all(a)}function e8(t,e,n={}){t.notify("AnimationStart",e);let r;if(Array.isArray(e)){const s=e.map(i=>T1(t,i,n));r=Promise.all(s)}else if(typeof e=="string")r=T1(t,e,n);else{const s=typeof e=="function"?ru(t,e,n.custom):e;r=Promise.all(nA(t,s,n))}return r.then(()=>{t.notify("AnimationComplete",e)})}function sA(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}const t8=Qw.length;function iA(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?iA(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<t8;n++){const r=Qw[n],s=t.props[r];(bf(s)||s===!1)&&(e[r]=s)}return e}const n8=[...Xw].reverse(),r8=Xw.length;function s8(t){return e=>Promise.all(e.map(({animation:n,options:r})=>e8(t,n,r)))}function i8(t){let e=s8(t),n=U2(),r=!0;const s=l=>(u,d)=>{var h;const f=ru(t,d,l==="exit"?(h=t.presenceContext)==null?void 0:h.custom:void 0);if(f){const{transition:p,transitionEnd:m,...y}=f;u={...u,...y,...m}}return u};function i(l){e=l(t)}function o(l){const{props:u}=t,d=iA(t.parent)||{},f=[],h=new Set;let p={},m=1/0;for(let x=0;x<r8;x++){const g=n8[x],v=n[g],w=u[g]!==void 0?u[g]:d[g],S=bf(w),I=g===l?v.isActive:null;I===!1&&(m=x);let k=w===d[g]&&w!==u[g]&&S;if(k&&r&&t.manuallyAnimateOnMount&&(k=!1),v.protectedKeys={...p},!v.isActive&&I===null||!w&&!v.prevProp||Ig(w)||typeof w=="boolean")continue;const R=o8(v.prevProp,w);let C=R||g===l&&v.isActive&&!k&&S||x>m&&S,T=!1;const _=Array.isArray(w)?w:[w];let N=_.reduce(s(g),{});I===!1&&(N={});const{prevResolvedValues:j={}}=v,O={...j,...N},P=M=>{C=!0,h.has(M)&&(T=!0,h.delete(M)),v.needsAnimating[M]=!0;const Q=t.getValue(M);Q&&(Q.liveStyle=!1)};for(const M in O){const Q=N[M],X=j[M];if(p.hasOwnProperty(M))continue;let D=!1;S1(Q)&&S1(X)?D=!sA(Q,X):D=Q!==X,D?Q!=null?P(M):h.add(M):Q!==void 0&&h.has(M)?P(M):v.protectedKeys[M]=!0}v.prevProp=w,v.prevResolvedValues=N,v.isActive&&(p={...p,...N}),r&&t.blockInitialAnimation&&(C=!1);const G=k&&R;C&&(!G||T)&&f.push(..._.map(M=>{const Q={type:g};if(typeof M=="string"&&r&&!G&&t.manuallyAnimateOnMount&&t.parent){const{parent:X}=t,D=ru(X,M);if(X.enteringChildren&&D){const{delayChildren:Te}=D.transition||{};Q.delay=rA(X.enteringChildren,t,Te)}}return{animation:M,options:Q}}))}if(h.size){const x={};if(typeof u.initial!="boolean"){const g=ru(t,Array.isArray(u.initial)?u.initial[0]:u.initial);g&&g.transition&&(x.transition=g.transition)}h.forEach(g=>{const v=t.getBaseTarget(g),w=t.getValue(g);w&&(w.liveStyle=!0),x[g]=v??null}),f.push({animation:x})}let y=!!f.length;return r&&(u.initial===!1||u.initial===u.animate)&&!t.manuallyAnimateOnMount&&(y=!1),r=!1,y?e(f):Promise.resolve()}function a(l,u){var f;if(n[l].isActive===u)return Promise.resolve();(f=t.variantChildren)==null||f.forEach(h=>{var p;return(p=h.animationState)==null?void 0:p.setActive(l,u)}),n[l].isActive=u;const d=o(l);for(const h in n)n[h].protectedKeys={};return d}return{animateChanges:o,setActive:a,setAnimateFunction:i,getState:()=>n,reset:()=>{n=U2()}}}function o8(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!sA(e,t):!1}function cl(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function U2(){return{animate:cl(!0),whileInView:cl(),whileHover:cl(),whileTap:cl(),whileDrag:cl(),whileFocus:cl(),exit:cl()}}class Ya{constructor(e){this.isMounted=!1,this.node=e}update(){}}class a8 extends Ya{constructor(e){super(e),e.animationState||(e.animationState=i8(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Ig(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)==null||e.call(this)}}let l8=0;class c8 extends Ya{constructor(){super(...arguments),this.id=l8++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const s=this.node.animationState.setActive("exit",!e);n&&!e&&s.then(()=>{n(this.id)})}mount(){const{register:e,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const u8={animation:{Feature:a8},exit:{Feature:c8}};function wf(t,e,n,r={passive:!0}){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n)}function Jf(t){return{point:{x:t.pageX,y:t.pageY}}}const d8=t=>e=>Jw(e)&&t(e,Jf(e));function Ed(t,e,n,r){return wf(t,e,d8(n),r)}const oA=1e-4,f8=1-oA,h8=1+oA,aA=.01,p8=0-aA,m8=0+aA;function ws(t){return t.max-t.min}function g8(t,e,n){return Math.abs(t-e)<=n}function H2(t,e,n,r=.5){t.origin=r,t.originPoint=ar(e.min,e.max,t.origin),t.scale=ws(n)/ws(e),t.translate=ar(n.min,n.max,t.origin)-t.originPoint,(t.scale>=f8&&t.scale<=h8||isNaN(t.scale))&&(t.scale=1),(t.translate>=p8&&t.translate<=m8||isNaN(t.translate))&&(t.translate=0)}function Nd(t,e,n,r){H2(t.x,e.x,n.x,r?r.originX:void 0),H2(t.y,e.y,n.y,r?r.originY:void 0)}function V2(t,e,n){t.min=n.min+e.min,t.max=t.min+ws(e)}function y8(t,e,n){V2(t.x,e.x,n.x),V2(t.y,e.y,n.y)}function W2(t,e,n){t.min=e.min-n.min,t.max=t.min+ws(e)}function lm(t,e,n){W2(t.x,e.x,n.x),W2(t.y,e.y,n.y)}function ci(t){return[t("x"),t("y")]}const lA=({current:t})=>t?t.ownerDocument.defaultView:null,K2=(t,e)=>Math.abs(t-e);function x8(t,e){const n=K2(t.x,e.x),r=K2(t.y,e.y);return Math.sqrt(n**2+r**2)}class cA{constructor(e,n,{transformPagePoint:r,contextWindow:s=window,dragSnapToOrigin:i=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=q0(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,m=x8(h.offset,{x:0,y:0})>=this.distanceThreshold;if(!p&&!m)return;const{point:y}=h,{timestamp:x}=Yr;this.history.push({...y,timestamp:x});const{onStart:g,onMove:v}=this.handlers;p||(g&&g(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),v&&v(this.lastMoveEvent,h)},this.handlePointerMove=(h,p)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=G0(p,this.transformPagePoint),qn.update(this.updatePoint,!0)},this.handlePointerUp=(h,p)=>{this.end();const{onEnd:m,onSessionEnd:y,resumeAnimation:x}=this.handlers;if(this.dragSnapToOrigin&&x&&x(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=q0(h.type==="pointercancel"?this.lastMoveEventInfo:G0(p,this.transformPagePoint),this.history);this.startEvent&&m&&m(h,g),y&&y(h,g)},!Jw(e))return;this.dragSnapToOrigin=i,this.handlers=n,this.transformPagePoint=r,this.distanceThreshold=o,this.contextWindow=s||window;const a=Jf(e),l=G0(a,this.transformPagePoint),{point:u}=l,{timestamp:d}=Yr;this.history=[{...u,timestamp:d}];const{onSessionStart:f}=n;f&&f(e,q0(l,this.history)),this.removeListeners=Kf(Ed(this.contextWindow,"pointermove",this.handlePointerMove),Ed(this.contextWindow,"pointerup",this.handlePointerUp),Ed(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Ua(this.updatePoint)}}function G0(t,e){return e?{point:e(t.point)}:t}function G2(t,e){return{x:t.x-e.x,y:t.y-e.y}}function q0({point:t},e){return{point:t,delta:G2(t,uA(e)),offset:G2(t,b8(e)),velocity:w8(e,.1)}}function b8(t){return t[0]}function uA(t){return t[t.length-1]}function w8(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,r=null;const s=uA(t);for(;n>=0&&(r=t[n],!(s.timestamp-r.timestamp>po(e)));)n--;if(!r)return{x:0,y:0};const i=xi(s.timestamp-r.timestamp);if(i===0)return{x:0,y:0};const o={x:(s.x-r.x)/i,y:(s.y-r.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function v8(t,{min:e,max:n},r){return e!==void 0&&t<e?t=r?ar(e,t,r.min):Math.max(t,e):n!==void 0&&t>n&&(t=r?ar(n,t,r.max):Math.min(t,n)),t}function q2(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function k8(t,{top:e,left:n,bottom:r,right:s}){return{x:q2(t.x,n,s),y:q2(t.y,e,r)}}function J2(t,e){let n=e.min-t.min,r=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,r]=[r,n]),{min:n,max:r}}function S8(t,e){return{x:J2(t.x,e.x),y:J2(t.y,e.y)}}function _8(t,e){let n=.5;const r=ws(t),s=ws(e);return s>r?n=gf(e.min,e.max-r,t.min):r>s&&(n=gf(t.min,t.max-s,e.min)),qo(0,1,n)}function T8(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const C1=.35;function C8(t=C1){return t===!1?t=0:t===!0&&(t=C1),{x:Y2(t,"left","right"),y:Y2(t,"top","bottom")}}function Y2(t,e,n){return{min:X2(t,e),max:X2(t,n)}}function X2(t,e){return typeof t=="number"?t:t[e]||0}const E8=new WeakMap;class N8{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ir(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:n=!1,distanceThreshold:r}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const i=f=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(Jf(f).point)},o=(f,h)=>{const{drag:p,dragPropagation:m,onDragStart:y}=this.getProps();if(p&&!m&&(this.openDragLock&&this.openDragLock(),this.openDragLock=NB(p),!this.openDragLock))return;this.latestPointerEvent=f,this.latestPanInfo=h,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),ci(g=>{let v=this.getAxisMotionValue(g).get()||0;if(mo.test(v)){const{projection:w}=this.visualElement;if(w&&w.layout){const S=w.layout.layoutBox[g];S&&(v=ws(S)*(parseFloat(v)/100))}}this.originPoint[g]=v}),y&&qn.postRender(()=>y(f,h)),_1(this.visualElement,"transform");const{animationState:x}=this.visualElement;x&&x.setActive("whileDrag",!0)},a=(f,h)=>{this.latestPointerEvent=f,this.latestPanInfo=h;const{dragPropagation:p,dragDirectionLock:m,onDirectionLock:y,onDrag:x}=this.getProps();if(!p&&!this.openDragLock)return;const{offset:g}=h;if(m&&this.currentDirection===null){this.currentDirection=j8(g),this.currentDirection!==null&&y&&y(this.currentDirection);return}this.updateAxis("x",h.point,g),this.updateAxis("y",h.point,g),this.visualElement.render(),x&&x(f,h)},l=(f,h)=>{this.latestPointerEvent=f,this.latestPanInfo=h,this.stop(f,h),this.latestPointerEvent=null,this.latestPanInfo=null},u=()=>ci(f=>{var h;return this.getAnimationState(f)==="paused"&&((h=this.getAxisMotionValue(f).animation)==null?void 0:h.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new cA(e,{onSessionStart:i,onStart:o,onMove:a,onSessionEnd:l,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,distanceThreshold:r,contextWindow:lA(this.visualElement)})}stop(e,n){const r=e||this.latestPointerEvent,s=n||this.latestPanInfo,i=this.isDragging;if(this.cancel(),!i||!s||!r)return;const{velocity:o}=s;this.startAnimation(o);const{onDragEnd:a}=this.getProps();a&&qn.postRender(()=>a(r,s))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,r){const{drag:s}=this.getProps();if(!r||!jh(e,s,this.currentDirection))return;const i=this.getAxisMotionValue(e);let o=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(o=v8(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){var i;const{dragConstraints:e,dragElastic:n}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(i=this.visualElement.projection)==null?void 0:i.layout,s=this.constraints;e&&Uc(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&r?this.constraints=k8(r.layoutBox,e):this.constraints=!1,this.elastic=C8(n),s!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&ci(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=T8(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!Uc(e))return!1;const r=e.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const i=IU(r,s.root,this.visualElement.getTransformPagePoint());let o=S8(s.layout.layoutBox,i);if(n){const a=n(EU(o));this.hasMutatedConstraints=!!a,a&&(o=GD(a))}return o}startAnimation(e){const{drag:n,dragMomentum:r,dragElastic:s,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),l=this.constraints||{},u=ci(d=>{if(!jh(d,n,this.currentDirection))return;let f=l&&l[d]||{};o&&(f={min:0,max:0});const h=s?200:1e6,p=s?40:1e7,m={type:"inertia",velocity:r?e[d]:0,bounceStiffness:h,bounceDamping:p,timeConstant:750,restDelta:1,restSpeed:10,...i,...f};return this.startAxisValueAnimation(d,m)});return Promise.all(u).then(a)}startAxisValueAnimation(e,n){const r=this.getAxisMotionValue(e);return _1(this.visualElement,e),r.start(iv(e,r,0,n,this.visualElement,!1))}stopAnimation(){ci(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){ci(e=>{var n;return(n=this.getAxisMotionValue(e).animation)==null?void 0:n.pause()})}getAnimationState(e){var n;return(n=this.getAxisMotionValue(e).animation)==null?void 0:n.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps(),s=r[n];return s||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){ci(n=>{const{drag:r}=this.getProps();if(!jh(n,r,this.currentDirection))return;const{projection:s}=this.visualElement,i=this.getAxisMotionValue(n);if(s&&s.layout){const{min:o,max:a}=s.layout.layoutBox[n];i.set(e[n]-ar(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:r}=this.visualElement;if(!Uc(n)||!r||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};ci(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const l=a.get();s[o]=_8({min:l,max:l},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),ci(o=>{if(!jh(o,e,null))return;const a=this.getAxisMotionValue(o),{min:l,max:u}=this.constraints[o];a.set(ar(l,u,s[o]))})}addListeners(){if(!this.visualElement.current)return;E8.set(this.visualElement,this);const e=this.visualElement.current,n=Ed(e,"pointerdown",l=>{const{drag:u,dragListener:d=!0}=this.getProps();u&&d&&this.start(l)}),r=()=>{const{dragConstraints:l}=this.getProps();Uc(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,i=s.addEventListener("measure",r);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),qn.read(r);const o=wf(window,"resize",()=>this.scalePositionWithinConstraints()),a=s.addEventListener("didUpdate",({delta:l,hasLayoutChanged:u})=>{this.isDragging&&u&&(ci(d=>{const f=this.getAxisMotionValue(d);f&&(this.originPoint[d]+=l[d].translate,f.set(f.get()+l[d].translate))}),this.visualElement.render())});return()=>{o(),n(),i(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:r=!1,dragPropagation:s=!1,dragConstraints:i=!1,dragElastic:o=C1,dragMomentum:a=!0}=e;return{...e,drag:n,dragDirectionLock:r,dragPropagation:s,dragConstraints:i,dragElastic:o,dragMomentum:a}}}function jh(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function j8(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class I8 extends Ya{constructor(e){super(e),this.removeGroupControls=wi,this.removeListeners=wi,this.controls=new N8(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||wi}unmount(){this.removeGroupControls(),this.removeListeners()}}const Q2=t=>(e,n)=>{t&&qn.postRender(()=>t(e,n))};class D8 extends Ya{constructor(){super(...arguments),this.removePointerDownListener=wi}onPointerDown(e){this.session=new cA(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:lA(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:r,onPanEnd:s}=this.node.getProps();return{onSessionStart:Q2(e),onStart:Q2(n),onMove:r,onEnd:(i,o)=>{delete this.session,s&&qn.postRender(()=>s(i,o))}}}mount(){this.removePointerDownListener=Ed(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const pp={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let J0=!1;class A8 extends b.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r,layoutId:s}=this.props,{projection:i}=e;i&&(n.group&&n.group.add(i),r&&r.register&&s&&r.register(i),J0&&i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),pp.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:r,drag:s,isPresent:i}=this.props,{projection:o}=r;return o&&(o.isPresent=i,J0=!0,s||e.layoutDependency!==n||n===void 0||e.isPresent!==i?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||qn.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),qw.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r}=this.props,{projection:s}=e;J0=!0,s&&(s.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(s),r&&r.deregister&&r.deregister(s))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function dA(t){const[e,n]=AD(),r=b.useContext(mf);return c.jsx(A8,{...t,layoutGroup:r,switchLayoutGroup:b.useContext(WD),isPresent:e,safeToRemove:n})}function M8(t,e,n){const r=us(t)?t:yu(t);return r.start(iv("",r,e,n)),r.animation}const R8=(t,e)=>t.depth-e.depth;class O8{constructor(){this.children=[],this.isDirty=!1}add(e){Iw(this.children,e),this.isDirty=!0}remove(e){Dw(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(R8),this.isDirty=!1,this.children.forEach(e)}}function P8(t,e){const n=Rs.now(),r=({timestamp:s})=>{const i=s-n;i>=e&&(Ua(r),t(i-e))};return qn.setup(r,!0),()=>Ua(r)}const fA=["TopLeft","TopRight","BottomLeft","BottomRight"],L8=fA.length,Z2=t=>typeof t=="string"?parseFloat(t):t,e_=t=>typeof t=="number"||Qt.test(t);function $8(t,e,n,r,s,i){s?(t.opacity=ar(0,n.opacity??1,z8(r)),t.opacityExit=ar(e.opacity??1,0,F8(r))):i&&(t.opacity=ar(e.opacity??1,n.opacity??1,r));for(let o=0;o<L8;o++){const a=`border${fA[o]}Radius`;let l=t_(e,a),u=t_(n,a);if(l===void 0&&u===void 0)continue;l||(l=0),u||(u=0),l===0||u===0||e_(l)===e_(u)?(t[a]=Math.max(ar(Z2(l),Z2(u),r),0),(mo.test(u)||mo.test(l))&&(t[a]+="%")):t[a]=u}(e.rotate||n.rotate)&&(t.rotate=ar(e.rotate||0,n.rotate||0,r))}function t_(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const z8=hA(0,.5,XI),F8=hA(.5,.95,wi);function hA(t,e,n){return r=>r<t?0:r>e?1:n(gf(t,e,r))}function n_(t,e){t.min=e.min,t.max=e.max}function Ai(t,e){n_(t.x,e.x),n_(t.y,e.y)}function r_(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function s_(t,e,n,r,s){return t-=e,t=am(t,1/n,r),s!==void 0&&(t=am(t,1/s,r)),t}function B8(t,e=0,n=1,r=.5,s,i=t,o=t){if(mo.test(e)&&(e=parseFloat(e),e=ar(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=ar(i.min,i.max,r);t===i&&(a-=e),t.min=s_(t.min,e,n,a,s),t.max=s_(t.max,e,n,a,s)}function i_(t,e,[n,r,s],i,o){B8(t,e[n],e[r],e[s],e.scale,i,o)}const U8=["x","scaleX","originX"],H8=["y","scaleY","originY"];function o_(t,e,n,r){i_(t.x,e,U8,n?n.x:void 0,r?r.x:void 0),i_(t.y,e,H8,n?n.y:void 0,r?r.y:void 0)}function a_(t){return t.translate===0&&t.scale===1}function pA(t){return a_(t.x)&&a_(t.y)}function l_(t,e){return t.min===e.min&&t.max===e.max}function V8(t,e){return l_(t.x,e.x)&&l_(t.y,e.y)}function c_(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function mA(t,e){return c_(t.x,e.x)&&c_(t.y,e.y)}function u_(t){return ws(t.x)/ws(t.y)}function d_(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class W8{constructor(){this.members=[]}add(e){Iw(this.members,e),e.scheduleRender()}remove(e){if(Dw(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(s=>e===s);if(n===0)return!1;let r;for(let s=n;s>=0;s--){const i=this.members[s];if(i.isPresent!==!1){r=i;break}}return r?(this.promote(r),!0):!1}promote(e,n){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,n&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:s}=e.options;s===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:r}=e;n.onExitComplete&&n.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function K8(t,e,n){let r="";const s=t.x.translate/e.x,i=t.y.translate/e.y,o=(n==null?void 0:n.z)||0;if((s||i||o)&&(r=`translate3d(${s}px, ${i}px, ${o}px) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:u,rotate:d,rotateX:f,rotateY:h,skewX:p,skewY:m}=n;u&&(r=`perspective(${u}px) ${r}`),d&&(r+=`rotate(${d}deg) `),f&&(r+=`rotateX(${f}deg) `),h&&(r+=`rotateY(${h}deg) `),p&&(r+=`skewX(${p}deg) `),m&&(r+=`skewY(${m}deg) `)}const a=t.x.scale*e.x,l=t.y.scale*e.y;return(a!==1||l!==1)&&(r+=`scale(${a}, ${l})`),r||"none"}const Y0=["","X","Y","Z"],G8=1e3;let q8=0;function X0(t,e,n,r){const{latestValues:s}=e;s[t]&&(n[t]=s[t],e.setStaticValue(t,0),r&&(r[t]=0))}function gA(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=tA(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:s,layoutId:i}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",qn,!(s||i))}const{parent:r}=t;r&&!r.hasCheckedOptimisedAppear&&gA(r)}function yA({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:r,resetTransform:s}){return class{constructor(o={},a=e==null?void 0:e()){this.id=q8++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(X8),this.nodes.forEach(t9),this.nodes.forEach(n9),this.nodes.forEach(Q8)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new O8)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new Rw),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const l=this.eventHandlers.get(o);l&&l.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=DD(o)&&!RB(o),this.instance=o;const{layoutId:a,layout:l,visualElement:u}=this.options;if(u&&!u.current&&u.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(l||a)&&(this.isLayoutDirty=!0),t){let d,f=0;const h=()=>this.root.updateBlockedByResize=!1;qn.read(()=>{f=window.innerWidth}),t(o,()=>{const p=window.innerWidth;p!==f&&(f=p,this.root.updateBlockedByResize=!0,d&&d(),d=P8(h,250),pp.hasAnimatedSinceResize&&(pp.hasAnimatedSinceResize=!1,this.nodes.forEach(p_)))})}a&&this.root.registerSharedNode(a,this),this.options.animate!==!1&&u&&(a||l)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:f,hasRelativeLayoutChanged:h,layout:p})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const m=this.options.transition||u.getDefaultTransition()||a9,{onLayoutAnimationStart:y,onLayoutAnimationComplete:x}=u.getProps(),g=!this.targetLayout||!mA(this.targetLayout,p),v=!f&&h;if(this.options.layoutRoot||this.resumeFrom||v||f&&(g||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const w={...Kw(m,"layout"),onPlay:y,onComplete:x};(u.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w),this.setAnimationOrigin(d,v)}else f||p_(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=p})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Ua(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(r9),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&gA(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let d=0;d<this.path.length;d++){const f=this.path[d];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:a,layout:l}=this.options;if(a===void 0&&!l)return;const u=this.getTransformTemplate();this.prevTransformTemplateValue=u?u(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(f_);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(h_);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(e9),this.nodes.forEach(J8),this.nodes.forEach(Y8)):this.nodes.forEach(h_),this.clearAllSnapshots();const a=Rs.now();Yr.delta=qo(0,1e3/60,a-Yr.timestamp),Yr.timestamp=a,Yr.isProcessing=!0,z0.update.process(Yr),z0.preRender.process(Yr),z0.render.process(Yr),Yr.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,qw.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Z8),this.sharedNodes.forEach(s9)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,qn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){qn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ws(this.snapshot.measuredBox.x)&&!ws(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=Ir(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a&&this.instance){const l=r(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:l,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!s)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!pA(this.projectionDelta),l=this.getTransformTemplate(),u=l?l(this.latestValues,""):void 0,d=u!==this.prevTransformTemplateValue;o&&this.instance&&(a||hl(this.latestValues)||d)&&(s(this.instance,u),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let l=this.removeElementScroll(a);return o&&(l=this.removeTransform(l)),l9(l),{animationId:this.root.animationId,measuredBox:a,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var u;const{visualElement:o}=this.options;if(!o)return Ir();const a=o.measureViewportBox();if(!(((u=this.scroll)==null?void 0:u.wasRoot)||this.path.some(c9))){const{scroll:d}=this.root;d&&(Hc(a.x,d.offset.x),Hc(a.y,d.offset.y))}return a}removeElementScroll(o){var l;const a=Ir();if(Ai(a,o),(l=this.scroll)!=null&&l.wasRoot)return a;for(let u=0;u<this.path.length;u++){const d=this.path[u],{scroll:f,options:h}=d;d!==this.root&&f&&h.layoutScroll&&(f.wasRoot&&Ai(a,o),Hc(a.x,f.offset.x),Hc(a.y,f.offset.y))}return a}applyTransform(o,a=!1){const l=Ir();Ai(l,o);for(let u=0;u<this.path.length;u++){const d=this.path[u];!a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&Vc(l,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),hl(d.latestValues)&&Vc(l,d.latestValues)}return hl(this.latestValues)&&Vc(l,this.latestValues),l}removeTransform(o){const a=Ir();Ai(a,o);for(let l=0;l<this.path.length;l++){const u=this.path[l];if(!u.instance||!hl(u.latestValues))continue;w1(u.latestValues)&&u.updateSnapshot();const d=Ir(),f=u.measurePageBox();Ai(d,f),o_(a,u.latestValues,u.snapshot?u.snapshot.layoutBox:void 0,d)}return hl(this.latestValues)&&o_(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Yr.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var p;const a=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=a.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=a.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=a.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==a;if(!(o||l&&this.isSharedProjectionDirty||this.isProjectionDirty||(p=this.parent)!=null&&p.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:f}=this.options;if(!this.layout||!(d||f))return;this.resolvedRelativeTargetAt=Yr.timestamp;const h=this.getClosestProjectingParent();h&&this.linkedParentVersion!==h.layoutVersion&&!h.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(h&&h.layout?this.createRelativeTarget(h,this.layout.layoutBox,h.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Ir(),this.targetWithTransforms=Ir()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),y8(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ai(this.target,this.layout.layoutBox),JD(this.target,this.targetDelta)):Ai(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,h&&!!h.resumingFrom==!!this.resumingFrom&&!h.options.layoutScroll&&h.target&&this.animationProgress!==1?this.createRelativeTarget(h,this.target,h.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||w1(this.parent.latestValues)||qD(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(o,a,l){this.relativeParent=o,this.linkedParentVersion=o.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ir(),this.relativeTargetOrigin=Ir(),lm(this.relativeTargetOrigin,a,l),Ai(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var m;const o=this.getLead(),a=!!this.resumingFrom||this!==o;let l=!0;if((this.isProjectionDirty||(m=this.parent)!=null&&m.isProjectionDirty)&&(l=!1),a&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===Yr.timestamp&&(l=!1),l)return;const{layout:u,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||d))return;Ai(this.layoutCorrected,this.layout.layoutBox);const f=this.treeScale.x,h=this.treeScale.y;jU(this.layoutCorrected,this.treeScale,this.path,a),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=Ir());const{target:p}=o;if(!p){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(r_(this.prevProjectionDelta.x,this.projectionDelta.x),r_(this.prevProjectionDelta.y,this.projectionDelta.y)),Nd(this.projectionDelta,this.layoutCorrected,p,this.latestValues),(this.treeScale.x!==f||this.treeScale.y!==h||!d_(this.projectionDelta.x,this.prevProjectionDelta.x)||!d_(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",p))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var a;if((a=this.options.visualElement)==null||a.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Wc(),this.projectionDelta=Wc(),this.projectionDeltaWithTransform=Wc()}setAnimationOrigin(o,a=!1){const l=this.snapshot,u=l?l.latestValues:{},d={...this.latestValues},f=Wc();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const h=Ir(),p=l?l.source:void 0,m=this.layout?this.layout.source:void 0,y=p!==m,x=this.getStack(),g=!x||x.members.length<=1,v=!!(y&&!g&&this.options.crossfade===!0&&!this.path.some(o9));this.animationProgress=0;let w;this.mixTargetDelta=S=>{const I=S/1e3;m_(f.x,o.x,I),m_(f.y,o.y,I),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(lm(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),i9(this.relativeTarget,this.relativeTargetOrigin,h,I),w&&V8(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=Ir()),Ai(w,this.relativeTarget)),y&&(this.animationValues=d,$8(d,u,this.latestValues,I,v,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=I},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){var a,l,u;this.notifyListeners("animationStart"),(a=this.currentAnimation)==null||a.stop(),(u=(l=this.resumingFrom)==null?void 0:l.currentAnimation)==null||u.stop(),this.pendingAnimation&&(Ua(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=qn.update(()=>{pp.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=yu(0)),this.currentAnimation=M8(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:d=>{this.mixTargetDelta(d),o.onUpdate&&o.onUpdate(d)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(G8),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:l,layout:u,latestValues:d}=o;if(!(!a||!l||!u)){if(this!==o&&this.layout&&u&&xA(this.options.animationType,this.layout.layoutBox,u.layoutBox)){l=this.target||Ir();const f=ws(this.layout.layoutBox.x);l.x.min=o.target.x.min,l.x.max=l.x.min+f;const h=ws(this.layout.layoutBox.y);l.y.min=o.target.y.min,l.y.max=l.y.min+h}Ai(a,l),Vc(a,d),Nd(this.projectionDeltaWithTransform,this.layoutCorrected,a,d)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new W8),this.sharedNodes.get(o).add(a);const u=a.options.initialPromotionConfig;a.promote({transition:u?u.transition:void 0,preserveFollowOpacity:u&&u.shouldPreserveFollowOpacity?u.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var a;const{layoutId:o}=this.options;return o?((a=this.getStack())==null?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:o}=this.options;return o?(a=this.getStack())==null?void 0:a.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:l}={}){const u=this.getStack();u&&u.promote(this,l),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:l}=o;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(a=!0),!a)return;const u={};l.z&&X0("z",o,u,this.animationValues);for(let d=0;d<Y0.length;d++)X0(`rotate${Y0[d]}`,o,u,this.animationValues),X0(`skew${Y0[d]}`,o,u,this.animationValues);o.render();for(const d in u)o.setStaticValue(d,u[d]),this.animationValues&&(this.animationValues[d]=u[d]);o.scheduleRender()}applyProjectionStyles(o,a){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const l=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=hp(a==null?void 0:a.pointerEvents)||"",o.transform=l?l(this.latestValues,""):"none";return}const u=this.getLead();if(!this.projectionDelta||!this.layout||!u.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=hp(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!hl(this.latestValues)&&(o.transform=l?l({},""):"none",this.hasProjected=!1);return}o.visibility="";const d=u.animationValues||u.latestValues;this.applyTransformsToTarget();let f=K8(this.projectionDeltaWithTransform,this.treeScale,d);l&&(f=l(d,f)),o.transform=f;const{x:h,y:p}=this.projectionDelta;o.transformOrigin=`${h.origin*100}% ${p.origin*100}% 0`,u.animationValues?o.opacity=u===this?d.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:o.opacity=u===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const m in b1){if(d[m]===void 0)continue;const{correct:y,applyTo:x,isCSSVariable:g}=b1[m],v=f==="none"?d[m]:y(d[m],u);if(x){const w=x.length;for(let S=0;S<w;S++)o[x[S]]=v}else g?this.options.visualElement.renderState.vars[m]=v:o[m]=v}this.options.layoutId&&(o.pointerEvents=u===this?hp(a==null?void 0:a.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var a;return(a=o.currentAnimation)==null?void 0:a.stop()}),this.root.nodes.forEach(f_),this.root.sharedNodes.clear()}}}function J8(t){t.updateLayout()}function Y8(t){var n;const e=((n=t.resumeFrom)==null?void 0:n.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:s}=t.layout,{animationType:i}=t.options,o=e.source!==t.layout.source;i==="size"?ci(f=>{const h=o?e.measuredBox[f]:e.layoutBox[f],p=ws(h);h.min=r[f].min,h.max=h.min+p}):xA(i,e.layoutBox,r)&&ci(f=>{const h=o?e.measuredBox[f]:e.layoutBox[f],p=ws(r[f]);h.max=h.min+p,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[f].max=t.relativeTarget[f].min+p)});const a=Wc();Nd(a,r,e.layoutBox);const l=Wc();o?Nd(l,t.applyTransform(s,!0),e.measuredBox):Nd(l,r,e.layoutBox);const u=!pA(a);let d=!1;if(!t.resumeFrom){const f=t.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:h,layout:p}=f;if(h&&p){const m=Ir();lm(m,e.layoutBox,h.layoutBox);const y=Ir();lm(y,r,p.layoutBox),mA(m,y)||(d=!0),f.options.layoutRoot&&(t.relativeTarget=y,t.relativeTargetOrigin=m,t.relativeParent=f)}}}t.notifyListeners("didUpdate",{layout:r,snapshot:e,delta:l,layoutDelta:a,hasLayoutChanged:u,hasRelativeLayoutChanged:d})}else if(t.isLead()){const{onExitComplete:r}=t.options;r&&r()}t.options.transition=void 0}function X8(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function Q8(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function Z8(t){t.clearSnapshot()}function f_(t){t.clearMeasurements()}function h_(t){t.isLayoutDirty=!1}function e9(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function p_(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function t9(t){t.resolveTargetDelta()}function n9(t){t.calcProjection()}function r9(t){t.resetSkewAndRotation()}function s9(t){t.removeLeadSnapshot()}function m_(t,e,n){t.translate=ar(e.translate,0,n),t.scale=ar(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function g_(t,e,n,r){t.min=ar(e.min,n.min,r),t.max=ar(e.max,n.max,r)}function i9(t,e,n,r){g_(t.x,e.x,n.x,r),g_(t.y,e.y,n.y,r)}function o9(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const a9={duration:.45,ease:[.4,0,.1,1]},y_=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),x_=y_("applewebkit/")&&!y_("chrome/")?Math.round:wi;function b_(t){t.min=x_(t.min),t.max=x_(t.max)}function l9(t){b_(t.x),b_(t.y)}function xA(t,e,n){return t==="position"||t==="preserve-aspect"&&!g8(u_(e),u_(n),.2)}function c9(t){var e;return t!==t.root&&((e=t.scroll)==null?void 0:e.wasRoot)}const u9=yA({attachResizeListener:(t,e)=>wf(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Q0={current:void 0},bA=yA({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!Q0.current){const t=new u9({});t.mount(window),t.setOptions({layoutScroll:!0}),Q0.current=t}return Q0.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),d9={pan:{Feature:D8},drag:{Feature:I8,ProjectionNode:bA,MeasureLayout:dA}};function w_(t,e,n){const{props:r}=t;t.animationState&&r.whileHover&&t.animationState.setActive("whileHover",n==="Start");const s="onHover"+n,i=r[s];i&&qn.postRender(()=>i(e,Jf(e)))}class f9 extends Ya{mount(){const{current:e}=this.node;e&&(this.unmount=jB(e,(n,r)=>(w_(this.node,r,"Start"),s=>w_(this.node,s,"End"))))}unmount(){}}class h9 extends Ya{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Kf(wf(this.node.current,"focus",()=>this.onFocus()),wf(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function v_(t,e,n){const{props:r}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&r.whileTap&&t.animationState.setActive("whileTap",n==="Start");const s="onTap"+(n==="End"?"":n),i=r[s];i&&qn.postRender(()=>i(e,Jf(e)))}class p9 extends Ya{mount(){const{current:e}=this.node;e&&(this.unmount=MB(e,(n,r)=>(v_(this.node,r,"Start"),(s,{success:i})=>v_(this.node,s,i?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const E1=new WeakMap,Z0=new WeakMap,m9=t=>{const e=E1.get(t.target);e&&e(t)},g9=t=>{t.forEach(m9)};function y9({root:t,...e}){const n=t||document;Z0.has(n)||Z0.set(n,{});const r=Z0.get(n),s=JSON.stringify(e);return r[s]||(r[s]=new IntersectionObserver(g9,{root:t,...e})),r[s]}function x9(t,e,n){const r=y9(e);return E1.set(t,n),r.observe(t),()=>{E1.delete(t),r.unobserve(t)}}const b9={some:0,all:1};class w9 extends Ya{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:r,amount:s="some",once:i}=e,o={root:n?n.current:void 0,rootMargin:r,threshold:typeof s=="number"?s:b9[s]},a=l=>{const{isIntersecting:u}=l;if(this.isInView===u||(this.isInView=u,i&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:d,onViewportLeave:f}=this.node.getProps(),h=u?d:f;h&&h(l)};return x9(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(v9(e,n))&&this.startObserver()}unmount(){}}function v9({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const k9={inView:{Feature:w9},tap:{Feature:p9},focus:{Feature:h9},hover:{Feature:f9}},S9={layout:{ProjectionNode:bA,MeasureLayout:dA}},_9={...u8,...k9,...d9,...S9},Rr=CU(_9,zU),T9=({url:t,fileName:e,autoPlay:n=!1,markers:r=[],onClose:s,seekToTime:i})=>{const o=b.useRef(null),[a,l]=b.useState(n),[u,d]=b.useState(0),[f,h]=b.useState(0);b.useEffect(()=>{n&&o.current&&o.current.play().catch(console.error)},[t,n]);const p=()=>{o.current&&(a?o.current.pause():o.current.play(),l(!a))},m=()=>{o.current&&h(o.current.currentTime)},y=()=>{o.current&&d(o.current.duration)},x=S=>{const I=parseFloat(S.target.value);o.current&&(o.current.currentTime=I,h(I))},g=S=>{if(o.current){const I=Math.min(Math.max(o.current.currentTime+S,0),u);o.current.currentTime=I,h(I)}},v=S=>{if(o.current){const I=S/1e3;o.current.currentTime=I,h(I),o.current.play().catch(console.error),l(!0)}};b.useEffect(()=>{i!=null&&o.current&&v(i)},[i]);const w=S=>{if(isNaN(S))return"0:00";const I=Math.floor(S/60),k=Math.floor(S%60);return`${I}:${k.toString().padStart(2,"0")}`};return c.jsxs("div",{className:"w-full bg-slate-50 border border-indigo-100 rounded-xl p-3 mb-4 animate-in fade-in slide-in-from-top-2 flex flex-col gap-2 shadow-sm sticky top-0 z-10 backdrop-blur-sm bg-slate-50/95",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 flex-shrink-0",children:c.jsx(r1,{size:16})}),c.jsx("span",{className:"text-xs font-medium text-slate-700 truncate",title:e,children:e||"Audio Recording"}),r.length>0&&c.jsxs("span",{className:"text-[10px] text-slate-400 bg-slate-200 px-1.5 py-0.5 rounded-full",children:[r.length," "]})]}),s&&c.jsx("button",{onClick:s,className:"p-1 hover:bg-slate-200 rounded-full text-slate-400 hover:text-slate-600 transition-colors",children:c.jsx(on,{size:14})})]}),c.jsx("audio",{ref:o,src:t,onTimeUpdate:m,onLoadedMetadata:y,onEnded:()=>l(!1),className:"hidden"}),c.jsxs("div",{className:"flex items-center justify-between gap-3",children:[c.jsxs("button",{onClick:()=>g(-5),className:"flex items-center gap-0.5 px-2 py-1 text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors text-xs",title:" 5 ",children:[c.jsx(OI,{size:14}),c.jsx("span",{className:"font-mono text-[10px]",children:"5s"})]}),c.jsx("button",{onClick:p,className:"w-10 h-10 flex items-center justify-center bg-indigo-600 text-white rounded-full hover:bg-indigo-700 shadow-md transition-all active:scale-95",children:a?c.jsx(DI,{size:20,fill:"currentColor"}):c.jsx(AI,{size:20,fill:"currentColor",className:"ml-1"})}),c.jsxs("button",{onClick:()=>g(5),className:"flex items-center gap-0.5 px-2 py-1 text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors text-xs",title:" 5 ",children:[c.jsx("span",{className:"font-mono text-[10px]",children:"5s"}),c.jsx(I6,{size:14})]}),c.jsxs("div",{className:"flex-1 flex items-center gap-2 min-w-0",children:[c.jsx("span",{className:"text-[10px] font-mono tabular-nums text-slate-500 w-8 text-right",children:w(f)}),c.jsxs("div",{className:"relative flex-1 h-8 flex items-center group select-none",children:[c.jsx("div",{className:"absolute inset-0 flex items-center pointer-events-none",children:c.jsx("div",{className:"w-full h-1 bg-slate-200 rounded-full overflow-visible relative",children:c.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-100 rounded-full",style:{width:`${f/(u||1)*100}%`}})})}),c.jsx("input",{type:"range",min:0,max:u||100,value:f,onChange:x,className:"absolute inset-0 w-full opacity-0 cursor-pointer z-10"})]}),c.jsx("span",{className:"text-[10px] font-mono tabular-nums text-slate-500 w-8",children:w(u)})]})]})]})},wA=({checked:t,isCanceled:e=!1,onChange:n,size:r=18,color:s="blue",isRoot:i=!1})=>{const o={gray:{root:"bg-gray-500 border-gray-500 text-white",sub:"bg-gray-100 border-gray-200 text-gray-500",hover:"hover:border-gray-500",border:"border-gray-400"},blue:{root:"bg-blue-500 border-blue-500 text-white",sub:"bg-blue-100 border-blue-200 text-blue-500",hover:"hover:border-blue-500",border:"border-blue-400"},indigo:{root:"bg-indigo-500 border-indigo-500 text-white",sub:"bg-indigo-100 border-indigo-200 text-indigo-500",hover:"hover:border-indigo-500",border:"border-indigo-400"},red:{root:"bg-red-500 border-red-500 text-white",sub:"bg-red-100 border-red-200 text-red-500",hover:"hover:border-red-500",border:"border-red-400"},orange:{root:"bg-orange-500 border-orange-500 text-white",sub:"bg-orange-100 border-orange-200 text-orange-500",hover:"hover:border-orange-500",border:"border-orange-400"},amber:{root:"bg-amber-500 border-amber-500 text-white",sub:"bg-amber-100 border-amber-200 text-amber-500",hover:"hover:border-amber-500",border:"border-amber-400"},green:{root:"bg-emerald-500 border-emerald-500 text-white",sub:"bg-emerald-100 border-emerald-200 text-emerald-500",hover:"hover:border-emerald-500",border:"border-emerald-400"},teal:{root:"bg-teal-500 border-teal-500 text-white",sub:"bg-teal-100 border-teal-200 text-teal-500",hover:"hover:border-teal-500",border:"border-teal-400"},cyan:{root:"bg-cyan-500 border-cyan-500 text-white",sub:"bg-cyan-100 border-cyan-200 text-cyan-500",hover:"hover:border-cyan-500",border:"border-cyan-400"},sky:{root:"bg-sky-500 border-sky-500 text-white",sub:"bg-sky-100 border-sky-200 text-sky-500",hover:"hover:border-sky-500",border:"border-sky-400"},purple:{root:"bg-purple-500 border-purple-500 text-white",sub:"bg-purple-100 border-purple-200 text-purple-500",hover:"hover:border-purple-500",border:"border-purple-400"},fuchsia:{root:"bg-fuchsia-500 border-fuchsia-500 text-white",sub:"bg-fuchsia-100 border-fuchsia-200 text-fuchsia-500",hover:"hover:border-fuchsia-500",border:"border-fuchsia-400"},pink:{root:"bg-pink-500 border-pink-500 text-white",sub:"bg-pink-100 border-pink-200 text-pink-500",hover:"hover:border-pink-500",border:"border-pink-400"},rose:{root:"bg-rose-500 border-rose-500 text-white",sub:"bg-rose-100 border-rose-200 text-rose-500",hover:"hover:border-rose-500",border:"border-rose-400"}},a=o[s]||o.gray,l=i?a.root:a.sub,d=`bg-transparent ${i?"border-2":""} ${a.border} ${a.hover}`;return c.jsx("div",{onClick:n,className:`group relative cursor-pointer flex items-center justify-center transition-all duration-200 ease-out border shadow-sm ${t||e?l:d}`,style:{width:r,height:r,borderRadius:r*.25},children:e?c.jsx(on,{size:r*.7,className:"text-current scale-100 opacity-100",strokeWidth:3}):c.jsx(tr,{size:r*.7,className:`transition-all duration-300 ease-back-out ${t?"scale-100 opacity-100":"scale-50 opacity-0"}`,strokeWidth:3})})},k_=({label:t,value:e,onChange:n,theme:r,tasks:s,innerRef:i,colorClass:o})=>{const{themeSettings:a,language:l,t:u}=b.useContext(_n),[d,f]=b.useState(""),[h,p]=b.useState(!1),[m,y]=b.useState(new Date),[x,g]=b.useState(null),[v,w]=b.useState(null),[S,I]=b.useState({top:0,left:0}),k=b.useRef(null),R=b.useRef(null),C=b.useRef(!1),T=b.useRef(!1),_=b.useRef(null),N=i||_;b.useEffect(()=>{const ae=Z=>{h&&k.current&&!k.current.contains(Z.target)&&R.current&&!R.current.contains(Z.target)&&(p(!1),f(""),w(null))};return document.addEventListener("mousedown",ae),()=>document.removeEventListener("mousedown",ae)},[h]),b.useEffect(()=>{if(e){const ae=new Date(e);isNaN(ae.getTime())||y(ae)}},[e]);const j=ae=>{const Z=ae.target.value;f(Z);const K=Dz(Z);K?(y(K),w(K),g(K)):w(null)},O=()=>{var Z;const ae=v||x||m;if(ae){if(e){const K=new Date(e);ae.setHours(K.getHours(),K.getMinutes())}n(ae.toISOString()),p(!1),f(""),T.current=!0,(Z=N.current)==null||Z.focus(),setTimeout(()=>T.current=!1,200)}},P=()=>{if(N.current){const ae=N.current.getBoundingClientRect(),Z=window.innerWidth,K=window.innerHeight,de=288,ce=400;let ke=ae.left,_e=ae.bottom+8;_e+ce>K&&ae.top-ce>0&&(_e=ae.top-ce-8),ke+de>Z&&(ke=Z-de-10),I({top:_e,left:ke})}},G=ae=>{var Z;ae.key==="Enter"?(ae.preventDefault(),ae.metaKey||ae.ctrlKey||ae.stopPropagation(),h?O():(P(),p(!0))):ae.key==="Escape"?(ae.preventDefault(),h&&(ae.stopPropagation(),p(!1),f(""),T.current=!0,(Z=N.current)==null||Z.focus(),setTimeout(()=>T.current=!1,200))):ae.key===" "&&(ae.preventDefault(),ae.stopPropagation(),P(),p(!0))},A=ae=>{},M=ae=>{C.current||T.current||(P(),p(!0))},Q=()=>{h||P(),p(!h)},X=ae=>s.filter(Z=>{if(Z.status==="completed"||Z.status==="deleted")return!1;const K=Z.start_date?new Date(Z.start_date):null,de=Z.due_date?new Date(Z.due_date):null;return K&&yi(K,ae)||de&&yi(de,ae)}),D=ae=>{const Z=new Date(m.getFullYear(),m.getMonth(),ae);y(Z),g(Z),w(Z)},Te=()=>{const ae=new Date(m.getFullYear(),m.getMonth()+1,0).getDate(),Z=new Date(m.getFullYear(),m.getMonth(),1).getDay(),K=[];for(let de=0;de<Z;de++)K.push(c.jsx("div",{className:"h-8 w-8"},`empty-${de}`));for(let de=1;de<=ae;de++){const ce=new Date(m.getFullYear(),m.getMonth(),de),ke=e&&yi(new Date(e),ce),_e=v&&yi(v,ce),Ke=X(ce).length;let je="bg-transparent";Ke>=1&&Ke<=3?je="bg-green-400":Ke>=4&&Ke<=10?je="bg-yellow-400":Ke>10&&(je="bg-red-500");const V=kw(ce.toISOString());let re="h-8 w-8 rounded-full flex items-center justify-center text-xs relative transition-all ";_e?re+="bg-indigo-600/80 text-white font-bold shadow-md":ke?re+="bg-indigo-500 text-white font-bold":(re+="hover:bg-theme-hover text-theme-primary",V&&(re+=" text-red-500 font-bold")),V?re+=" border-2 border-red-400":re+=" border-2 border-transparent",K.push(c.jsxs("button",{type:"button",onMouseDown:se=>se.preventDefault(),onClick:()=>D(de),onMouseEnter:()=>g(ce),className:re,children:[de,!ke&&!_e&&Ke>0&&c.jsx("div",{className:`absolute bottom-1 w-1 h-1 rounded-full ${je}`})]},de))}return K},xe=v||x||(e?new Date(e):null),U=xe?X(xe):[],z=(r==null?void 0:r.buttonRing)||"focus:ring-indigo-300 focus:border-indigo-300",ie=o||(r==null?void 0:r.text)||"text-theme-tertiary",Be={small:"text-[11px]",normal:"text-xs",large:"text-sm"}[a.fontSize]||"text-xs",st=a.fontWeight==="thin"?"font-light":"font-medium";return c.jsxs("div",{className:"relative",ref:k,onBlur:A,children:[c.jsxs("button",{ref:N,type:"button",onMouseDown:()=>{C.current=!0,setTimeout(()=>C.current=!1,200)},onClick:Q,onKeyDown:G,onFocus:M,className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border ${Be} ${st} ${z}
            ${e?`${ie} border-theme bg-theme-hover hover:border-theme-hover hover:scale-[1.02]`:"text-theme-tertiary border-transparent hover:bg-theme-hover hover:text-theme-secondary"}
            focus:outline-none focus:bg-theme-card focus:ring-1 focus:border-theme
        `,children:[c.jsx(Go,{size:13}),c.jsx("span",{children:e?hI(e,!1,l):t}),e&&c.jsx(on,{size:12,className:"ml-1 hover:text-red-500",onClick:ae=>{ae.stopPropagation(),n(null)}})]}),h&&er.createPortal(c.jsxs("div",{ref:R,className:"fixed bg-theme-card rounded-xl shadow-2xl border border-theme p-4 z-[99999] w-72 max-w-[90vw] animate-in fade-in zoom-in duration-100",style:{top:S.top,left:S.left},onClick:ae=>ae.stopPropagation(),onMouseDown:ae=>ae.stopPropagation(),children:[c.jsxs("div",{className:"mb-3 relative",children:[c.jsx("input",{autoFocus:!0,type:"text",placeholder:u("dateInputPlaceholder"),className:"w-full text-xs box-border bg-theme-main border border-theme rounded p-2 text-theme-primary focus:ring-2 focus:ring-indigo-500/50 outline-none pr-8",value:d,onChange:j,onKeyDown:G}),v&&c.jsxs("div",{className:"absolute right-2 top-2 text-[10px] text-indigo-500 font-bold bg-theme-hover px-1 rounded animate-pulse",children:[u("identified"),": ",Az(v.toISOString(),l)]})]}),c.jsxs("div",{className:"flex justify-between items-center mb-2 text-theme-primary",children:[c.jsx("button",{type:"button",onMouseDown:ae=>ae.preventDefault(),onClick:()=>y(new Date(m.getFullYear(),m.getMonth()-1,1)),className:"p-1 hover:bg-theme-hover rounded",children:c.jsx(Du,{size:16})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"font-bold text-sm cursor-pointer hover:text-indigo-500 transition-colors",title:u("backToToday"),onClick:()=>y(new Date),children:m.toLocaleString(l==="zh"?"zh-TW":"en-US",{month:"long",year:"numeric"})}),c.jsx("button",{type:"button",onMouseDown:ae=>ae.preventDefault(),onClick:()=>y(new Date),className:"text-[10px] px-1.5 py-0.5 bg-indigo-50 text-indigo-600 rounded-full hover:bg-indigo-100 font-bold",children:""})]}),c.jsx("button",{type:"button",onMouseDown:ae=>ae.preventDefault(),onClick:()=>y(new Date(m.getFullYear(),m.getMonth()+1,1)),className:"p-1 hover:bg-theme-hover rounded",children:c.jsx(ts,{size:16})})]}),c.jsxs("div",{className:"grid grid-cols-7 gap-1 mb-2 text-center text-xs font-bold text-theme-tertiary",children:[(l==="zh"?["","","","","","",""]:["S","M","T","W","T","F","S"]).map(ae=>c.jsx("span",{children:ae},ae)),Te()]}),c.jsxs("div",{className:"border-t border-theme pt-3 mt-3",children:[c.jsxs("div",{className:"text-[10px] font-bold text-theme-tertiary mb-2 flex justify-between items-center",children:[c.jsx("span",{children:xe?`${xe.getMonth()+1}/${xe.getDate()} ${u("scheduleTitle")}`:u("scheduleTitle")}),c.jsx("span",{className:"bg-theme-hover px-1.5 rounded text-theme-secondary",children:U.length})]}),c.jsx("div",{className:"max-h-24 overflow-y-auto space-y-1 custom-scrollbar",children:U.length>0?U.map(ae=>c.jsx("div",{className:"text-[10px] bg-theme-hover p-1 rounded truncate border-l-2 border-indigo-400 pl-2 text-theme-secondary",children:ae.title},ae.id)):c.jsx("div",{className:"text-[10px] text-theme-tertiary italic text-center py-2",children:u("noSchedule")})})]}),c.jsx("button",{type:"button",onMouseDown:ae=>ae.preventDefault(),onClick:O,className:"w-full mt-3 bg-indigo-600 text-white text-xs font-bold py-1.5 rounded hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-500/20",children:u("confirmDate")})]}),document.body)]})},N1=({icon:t,label:e,items:n,selectedIds:r,onSelect:s,onSearch:i,placeholder:o,allowAdd:a,onDeleteItem:l,innerRef:u,multiSelect:d=!1,theme:f})=>{const{themeSettings:h,t:p}=b.useContext(_n),[m,y]=b.useState(!1),[x,g]=b.useState(""),[v,w]=b.useState(-1),[S,I]=b.useState({top:0,left:0}),[k,R]=b.useState(!1),[C,T]=b.useState(null),[_,N]=b.useState(null),[j,O]=b.useState(""),[P,G]=b.useState(-1),A=b.useRef(null),M=b.useRef(null),Q=b.useRef(!1),X=b.useRef(!1),D=b.useRef(null),Te=b.useRef(null),xe=b.useRef(null),U=u||xe;b.useEffect(()=>{const ee=ye=>{m&&A.current&&!A.current.contains(ye.target)&&M.current&&!M.current.contains(ye.target)&&(y(!1),g(""),R(!1),T(null),N(null))};return document.addEventListener("mousedown",ee),()=>document.removeEventListener("mousedown",ee)},[m]);const z=b.useMemo(()=>!n||!Array.isArray(n)?[]:n.filter(ee=>ee?(ee.title||ee.name||"").toLowerCase().includes(x.toLowerCase()):!1),[n,x]),ie=b.useMemo(()=>!n||!Array.isArray(n)?[]:n.filter(ee=>ee?(ee.title||ee.name||"").toLowerCase().includes(j.toLowerCase()):!1),[n,j]),Be=a&&x.trim()&&!z.some(ee=>(ee.title||ee.name||"").toLowerCase()===x.trim().toLowerCase()),st=z.length+(Be?1:0),ae=b.useMemo(()=>r.length===0?null:n.find(ee=>r.includes(ee.id)),[n,r]),Z=ae&&(ae.title||ae.name)||e,K=(ee,ye,Pe)=>{var me;s(ee,ye,Pe),d?(g(""),w(-1),y(!0),setTimeout(()=>{var Me;return(Me=D.current)==null?void 0:Me.focus()},0)):(g(""),y(!1),Q.current=!0,(me=U.current)==null||me.focus(),setTimeout(()=>Q.current=!1,200)),R(!1),T(null),N(null),O("")},de=()=>{T(x.trim()),R(!0),O(""),setTimeout(()=>{var ee;return(ee=Te.current)==null?void 0:ee.focus()},50)},ce=()=>{C&&K(null,C,_)},ke=()=>{R(!1),T(null),N(null),O(""),setTimeout(()=>{var ee;return(ee=D.current)==null?void 0:ee.focus()},50)},_e=()=>{if(U.current){const ee=U.current.getBoundingClientRect(),ye=window.innerWidth,Pe=window.innerHeight,me=280,Me=350;let qe=ee.left,ht=ee.bottom+8;ht+Me>Pe&&ee.top-Me>0&&(ht=ee.top-Me-8),qe+me>ye&&(qe=ye-me-10),I({top:ht,left:qe})}},ve=ee=>{var ye,Pe,me;if(k){const Me=ie.length+1;if(ee.key==="Escape")ee.preventDefault(),ee.stopPropagation(),ke();else if(ee.key==="ArrowDown"){ee.preventDefault();const qe=P+1>=Me?-1:P+1;G(qe),N(qe===-1?null:((ye=ie[qe])==null?void 0:ye.id)||null)}else if(ee.key==="ArrowUp"){ee.preventDefault();const qe=P-1<-1?Me-1:P-1;G(qe),N(qe===-1?null:((Pe=ie[qe])==null?void 0:Pe.id)||null)}else ee.key==="Enter"&&(ee.preventDefault(),ee.stopPropagation(),ce());return}ee.key==="ArrowDown"?(ee.preventDefault(),m||(_e(),y(!0)),w(Me=>Me===-1?0:(Me+1)%st)):ee.key==="ArrowUp"?(ee.preventDefault(),m||(_e(),y(!0)),w(Me=>Me<=0?st-1:Me-1)):ee.key==="Enter"?(ee.preventDefault(),ee.metaKey||ee.ctrlKey||ee.stopPropagation(),m?v>=0&&v<z.length?K(z[v].id):Be&&(v===z.length||v===-1)&&de():(_e(),y(!0))):ee.key==="Escape"&&(ee.preventDefault(),m&&(ee.stopPropagation(),y(!1),Q.current=!0,(me=U.current)==null||me.focus(),setTimeout(()=>Q.current=!1,200)))},Ke=ee=>{},je=ee=>{X.current||Q.current||(_e(),y(!0))},V=()=>{m||_e(),y(!m)},re=(f==null?void 0:f.buttonRing)||"focus:ring-indigo-300 focus:border-indigo-300",se={small:"text-[11px]",normal:"text-xs",large:"text-sm"}[h.fontSize]||"text-xs",ne=h.fontWeight==="thin"?"font-light":"font-medium",pe=ee=>{if(!ee)return null;const ye=n.find(Pe=>Pe.id===ee);return ye?ye.title||ye.name:null};return c.jsxs("div",{className:"relative",ref:A,onBlur:Ke,children:[c.jsxs("button",{ref:U,type:"button",onMouseDown:()=>{X.current=!0,setTimeout(()=>X.current=!1,200)},onClick:V,onKeyDown:ve,onFocus:je,className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border ${se} ${ne}
                    ${r.length>0?"text-indigo-600 bg-theme-hover border-theme shadow-sm":"text-theme-tertiary border-transparent hover:bg-theme-hover hover:text-theme-secondary"}
                    focus:outline-none focus:bg-theme-card focus:ring-1 focus:border-theme ${re}`,children:[c.jsx(t,{size:13})," ",c.jsx("span",{className:"truncate max-w-[80px]",children:Z})]}),m&&er.createPortal(c.jsx("div",{ref:M,className:"fixed bg-theme-card rounded-lg shadow-xl border border-theme z-[99999] w-72 p-2 animate-in fade-in zoom-in duration-100",style:{top:S.top,left:S.left},onClick:ee=>ee.stopPropagation(),onMouseDown:ee=>ee.stopPropagation(),children:k?c.jsxs("div",{className:"animate-in slide-in-from-right-2 duration-150",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-theme",children:[c.jsx("button",{type:"button",onClick:ke,className:"text-xs text-theme-tertiary hover:text-theme-primary transition-colors",children:" "}),c.jsxs("span",{className:"text-xs font-medium text-theme-primary",children:[' "',C,'"']})]}),c.jsxs("div",{className:"mb-2",children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-theme-tertiary mb-1",children:[c.jsx(f6,{size:11}),c.jsx("span",{children:""})]}),c.jsx("input",{ref:Te,type:"text",placeholder:"...",className:"w-full text-xs box-border bg-theme-main border border-theme rounded p-2 text-theme-primary focus:ring-1 focus:ring-indigo-500/50 outline-none",value:j,onChange:ee=>O(ee.target.value),onKeyDown:ve})]}),c.jsxs("div",{className:"max-h-40 overflow-y-auto space-y-0.5 custom-scrollbar mb-2",children:[c.jsxs("div",{onMouseDown:ee=>{ee.preventDefault(),N(null),G(-1)},onMouseEnter:()=>G(-1),className:`px-2 py-1.5 text-xs rounded cursor-pointer flex items-center justify-between ${P===-1?"bg-indigo-50 text-indigo-700 ring-1 ring-indigo-200":"text-theme-secondary hover:bg-theme-hover"}`,children:[c.jsx("span",{className:"text-theme-tertiary italic",children:""}),_===null&&c.jsx(tr,{size:12,className:"text-indigo-600"})]}),ie.map((ee,ye)=>c.jsxs("div",{onMouseDown:Pe=>{Pe.preventDefault(),N(ee.id),G(ye)},onMouseEnter:()=>G(ye),className:`px-2 py-1.5 text-xs rounded cursor-pointer flex items-center justify-between ${P===ye?"bg-indigo-50 text-indigo-700 ring-1 ring-indigo-200":"text-theme-secondary hover:bg-theme-hover"}`,style:{paddingLeft:ee.depth?`${ee.depth*12+8}px`:"8px"},children:[c.jsxs("div",{className:"flex items-center gap-1.5 truncate",children:[c.jsx("span",{className:"truncate",children:ee.title||ee.name}),ee.parentName&&c.jsx("span",{className:"text-[9px] text-theme-tertiary font-normal bg-theme-hover px-1 rounded truncate",children:ee.parentName})]}),_===ee.id&&c.jsx(tr,{size:12,className:"text-indigo-600"})]},ee.id))]}),_&&c.jsxs("div",{className:"text-[10px] text-theme-tertiary mb-2 px-1",children:[" ",c.jsx("span",{className:"font-medium text-indigo-600",children:pe(_)})," "]}),c.jsxs("button",{type:"button",onClick:ce,className:"w-full py-2 px-3 bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-medium rounded-lg transition-colors flex items-center justify-center gap-1.5",children:[c.jsx(Ki,{size:14}),""]})]}):c.jsxs(c.Fragment,{children:[c.jsx("input",{ref:D,autoFocus:!0,type:"text",placeholder:o,className:"w-full text-xs box-border bg-theme-main border-none rounded p-2 mb-1 text-theme-primary focus:ring-1 focus:ring-indigo-500/50 outline-none",value:x,onChange:ee=>{g(ee.target.value),w(-1),i&&i(ee.target.value)},onKeyDown:ve}),c.jsxs("div",{className:"max-h-48 overflow-y-auto space-y-0.5 custom-scrollbar",children:[z.map((ee,ye)=>c.jsxs("div",{onMouseDown:Pe=>{Pe.preventDefault(),K(ee.id)},onMouseEnter:()=>w(ye),className:`px-2 py-1.5 text-xs rounded cursor-pointer flex items-center justify-between group ${ye===v?"bg-theme-selection text-theme-primary":"text-theme-secondary hover:bg-theme-hover"}`,style:{paddingLeft:ee.depth?`${ee.depth*12+8}px`:"8px"},children:[c.jsxs("div",{className:"flex items-center gap-1.5 truncate",children:[c.jsx("span",{className:"truncate",children:ee.title||ee.name}),ee.parentName&&c.jsxs("span",{className:"text-[9px] text-theme-tertiary font-normal bg-theme-hover px-1 rounded truncate",children:[p("from"),": ",ee.parentName]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[r.includes(ee.id)&&c.jsx(tr,{size:12,className:"text-indigo-600"}),l&&c.jsx(Ar,{size:12,className:"text-gray-400 opacity-0 group-hover:opacity-100 hover:text-red-500",onClick:Pe=>{Pe.stopPropagation(),l(ee.id)}})]})]},ee.id)),Be&&c.jsxs("div",{onMouseEnter:()=>w(z.length),className:`px-2 py-1.5 text-xs cursor-pointer rounded flex items-center gap-1 ${v===z.length?"bg-theme-selection text-theme-primary":"text-indigo-600 hover:bg-theme-hover"}`,onMouseDown:ee=>{ee.preventDefault(),de()},children:[c.jsx(Ki,{size:12})," ",p("addNewTag"),' "',x,'"',c.jsx(ts,{size:12,className:"ml-auto opacity-50"})]})]})]})}),document.body)]})},vA=({tag:t,onRemove:e,size:n="normal"})=>{const{themeSettings:r,tagsWithResolvedColors:s}=b.useContext(_n),i={small:{text:{small:"text-[8px]",normal:"text-[9px]",large:"text-[10px]"},padding:"px-1.5 py-0.5"},normal:{text:{small:"text-[9px]",normal:"text-[10px]",large:"text-xs"},padding:"px-2 py-0.5"}},o=i[n].text[r.fontSize]||i[n].text.normal,a=i[n].padding,l=r.fontWeight==="thin"?"font-light":"font-normal";return c.jsxs("div",{className:`inline-flex items-center gap-1 bg-theme-hover text-theme-secondary ${a} rounded-md border border-theme ${o} ${l}`,children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:s[t.id]||t.color}}),c.jsx("span",{children:t.name}),e&&c.jsx("button",{type:"button",onClick:e,className:"hover:text-theme-primary",children:c.jsx(on,{size:10})})]})};function C9(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in t)){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(t)}function kA(t,e){return new Promise(function(n,r){let s;return E9(t).then(function(i){try{return s=i,n(new Blob([e.slice(0,2),s,e.slice(2)],{type:"image/jpeg"}))}catch(o){return r(o)}},r)})}const E9=t=>new Promise((e,n)=>{const r=new FileReader;r.addEventListener("load",({target:{result:s}})=>{const i=new DataView(s);let o=0;if(i.getUint16(o)!==65496)return n("not a valid JPEG");for(o+=2;;){const a=i.getUint16(o);if(a===65498)break;const l=i.getUint16(o+2);if(a===65505&&i.getUint32(o+4)===1165519206){const u=o+10;let d;switch(i.getUint16(u)){case 18761:d=!0;break;case 19789:d=!1;break;default:return n("TIFF header contains invalid endian")}if(i.getUint16(u+2,d)!==42)return n("TIFF header contains invalid version");const f=i.getUint32(u+4,d),h=u+f+2+12*i.getUint16(u+f,d);for(let p=u+f+2;p<h;p+=12)if(i.getUint16(p,d)==274){if(i.getUint16(p+2,d)!==3)return n("Orientation data type is invalid");if(i.getUint32(p+4,d)!==1)return n("Orientation data count is invalid");i.setUint16(p+8,1,d);break}return e(s.slice(o,o+2+l))}o+=2+l}return e(new Blob)}),r.readAsArrayBuffer(t)});var cm={},N9={get exports(){return cm},set exports(t){cm=t}};(function(t){var e,n,r={};N9.exports=r,r.parse=function(s,i){for(var o=r.bin.readUshort,a=r.bin.readUint,l=0,u={},d=new Uint8Array(s),f=d.length-4;a(d,f)!=101010256;)f--;l=f,l+=4;var h=o(d,l+=4);o(d,l+=2);var p=a(d,l+=2),m=a(d,l+=4);l+=4,l=m;for(var y=0;y<h;y++){a(d,l),l+=4,l+=4,l+=4,a(d,l+=4),p=a(d,l+=4);var x=a(d,l+=4),g=o(d,l+=4),v=o(d,l+2),w=o(d,l+4);l+=6;var S=a(d,l+=8);l+=4,l+=g+v+w,r._readLocal(d,S,u,p,x,i)}return u},r._readLocal=function(s,i,o,a,l,u){var d=r.bin.readUshort,f=r.bin.readUint;f(s,i),d(s,i+=4),d(s,i+=2);var h=d(s,i+=2);f(s,i+=2),f(s,i+=4),i+=4;var p=d(s,i+=8),m=d(s,i+=2);i+=2;var y=r.bin.readUTF8(s,i,p);if(i+=p,i+=m,u)o[y]={size:l,csize:a};else{var x=new Uint8Array(s.buffer,i);if(h==0)o[y]=new Uint8Array(x.buffer.slice(i,i+a));else{if(h!=8)throw"unknown compression method: "+h;var g=new Uint8Array(l);r.inflateRaw(x,g),o[y]=g}}},r.inflateRaw=function(s,i){return r.F.inflate(s,i)},r.inflate=function(s,i){return s[0],s[1],r.inflateRaw(new Uint8Array(s.buffer,s.byteOffset+2,s.length-6),i)},r.deflate=function(s,i){i==null&&(i={level:6});var o=0,a=new Uint8Array(50+Math.floor(1.1*s.length));a[o]=120,a[o+1]=156,o+=2,o=r.F.deflateRaw(s,a,o,i.level);var l=r.adler(s,0,s.length);return a[o+0]=l>>>24&255,a[o+1]=l>>>16&255,a[o+2]=l>>>8&255,a[o+3]=l>>>0&255,new Uint8Array(a.buffer,0,o+4)},r.deflateRaw=function(s,i){i==null&&(i={level:6});var o=new Uint8Array(50+Math.floor(1.1*s.length)),a=r.F.deflateRaw(s,o,a,i.level);return new Uint8Array(o.buffer,0,a)},r.encode=function(s,i){i==null&&(i=!1);var o=0,a=r.bin.writeUint,l=r.bin.writeUshort,u={};for(var d in s){var f=!r._noNeed(d)&&!i,h=s[d],p=r.crc.crc(h,0,h.length);u[d]={cpr:f,usize:h.length,crc:p,file:f?r.deflateRaw(h):h}}for(var d in u)o+=u[d].file.length+30+46+2*r.bin.sizeUTF8(d);o+=22;var m=new Uint8Array(o),y=0,x=[];for(var d in u){var g=u[d];x.push(y),y=r._writeHeader(m,y,d,g,0)}var v=0,w=y;for(var d in u)g=u[d],x.push(y),y=r._writeHeader(m,y,d,g,1,x[v++]);var S=y-w;return a(m,y,101010256),y+=4,l(m,y+=4,v),l(m,y+=2,v),a(m,y+=2,S),a(m,y+=4,w),y+=4,y+=2,m.buffer},r._noNeed=function(s){var i=s.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(i)!=-1},r._writeHeader=function(s,i,o,a,l,u){var d=r.bin.writeUint,f=r.bin.writeUshort,h=a.file;return d(s,i,l==0?67324752:33639248),i+=4,l==1&&(i+=2),f(s,i,20),f(s,i+=2,0),f(s,i+=2,a.cpr?8:0),d(s,i+=2,0),d(s,i+=4,a.crc),d(s,i+=4,h.length),d(s,i+=4,a.usize),f(s,i+=4,r.bin.sizeUTF8(o)),f(s,i+=2,0),i+=2,l==1&&(i+=2,i+=2,d(s,i+=6,u),i+=4),i+=r.bin.writeUTF8(s,i,o),l==0&&(s.set(h,i),i+=h.length),i},r.crc={table:function(){for(var s=new Uint32Array(256),i=0;i<256;i++){for(var o=i,a=0;a<8;a++)1&o?o=3988292384^o>>>1:o>>>=1;s[i]=o}return s}(),update:function(s,i,o,a){for(var l=0;l<a;l++)s=r.crc.table[255&(s^i[o+l])]^s>>>8;return s},crc:function(s,i,o){return 4294967295^r.crc.update(4294967295,s,i,o)}},r.adler=function(s,i,o){for(var a=1,l=0,u=i,d=i+o;u<d;){for(var f=Math.min(u+5552,d);u<f;)l+=a+=s[u++];a%=65521,l%=65521}return l<<16|a},r.bin={readUshort:function(s,i){return s[i]|s[i+1]<<8},writeUshort:function(s,i,o){s[i]=255&o,s[i+1]=o>>8&255},readUint:function(s,i){return 16777216*s[i+3]+(s[i+2]<<16|s[i+1]<<8|s[i])},writeUint:function(s,i,o){s[i]=255&o,s[i+1]=o>>8&255,s[i+2]=o>>16&255,s[i+3]=o>>24&255},readASCII:function(s,i,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(s[i+l]);return a},writeASCII:function(s,i,o){for(var a=0;a<o.length;a++)s[i+a]=o.charCodeAt(a)},pad:function(s){return s.length<2?"0"+s:s},readUTF8:function(s,i,o){for(var a,l="",u=0;u<o;u++)l+="%"+r.bin.pad(s[i+u].toString(16));try{a=decodeURIComponent(l)}catch{return r.bin.readASCII(s,i,o)}return a},writeUTF8:function(s,i,o){for(var a=o.length,l=0,u=0;u<a;u++){var d=o.charCodeAt(u);if(!(4294967168&d))s[i+l]=d,l++;else if(!(4294965248&d))s[i+l]=192|d>>6,s[i+l+1]=128|d>>0&63,l+=2;else if(!(4294901760&d))s[i+l]=224|d>>12,s[i+l+1]=128|d>>6&63,s[i+l+2]=128|d>>0&63,l+=3;else{if(4292870144&d)throw"e";s[i+l]=240|d>>18,s[i+l+1]=128|d>>12&63,s[i+l+2]=128|d>>6&63,s[i+l+3]=128|d>>0&63,l+=4}}return l},sizeUTF8:function(s){for(var i=s.length,o=0,a=0;a<i;a++){var l=s.charCodeAt(a);if(!(4294967168&l))o++;else if(!(4294965248&l))o+=2;else if(!(4294901760&l))o+=3;else{if(4292870144&l)throw"e";o+=4}}return o}},r.F={},r.F.deflateRaw=function(s,i,o,a){var l=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],u=r.F.U,d=r.F._goodIndex;r.F._hash;var f=r.F._putsE,h=0,p=o<<3,m=0,y=s.length;if(a==0){for(;h<y;)f(i,p,h+(N=Math.min(65535,y-h))==y?1:0),p=r.F._copyExact(s,h,N,i,p+8),h+=N;return p>>>3}var x=u.lits,g=u.strt,v=u.prev,w=0,S=0,I=0,k=0,R=0,C=0;for(y>2&&(g[C=r.F._hash(s,0)]=0),h=0;h<y;h++){if(R=C,h+1<y-2){C=r.F._hash(s,h+1);var T=h+1&32767;v[T]=g[C],g[C]=T}if(m<=h){(w>14e3||S>26697)&&y-h>100&&(m<h&&(x[w]=h-m,w+=2,m=h),p=r.F._writeBlock(h==y-1||m==y?1:0,x,w,k,s,I,h-I,i,p),w=S=k=0,I=h);var _=0;h<y-2&&(_=r.F._bestMatch(s,h,v,R,Math.min(l[2],y-h),l[3]));var N=_>>>16,j=65535&_;if(_!=0){j=65535&_;var O=d(N=_>>>16,u.of0);u.lhst[257+O]++;var P=d(j,u.df0);u.dhst[P]++,k+=u.exb[O]+u.dxb[P],x[w]=N<<23|h-m,x[w+1]=j<<16|O<<8|P,w+=2,m=h+N}else u.lhst[s[h]]++;S++}}for(I==h&&s.length!=0||(m<h&&(x[w]=h-m,w+=2,m=h),p=r.F._writeBlock(1,x,w,k,s,I,h-I,i,p),w=0,S=0,w=S=k=0,I=h);7&p;)p++;return p>>>3},r.F._bestMatch=function(s,i,o,a,l,u){var d=32767&i,f=o[d],h=d-f+32768&32767;if(f==d||a!=r.F._hash(s,i-h))return 0;for(var p=0,m=0,y=Math.min(32767,i);h<=y&&--u!=0&&f!=d;){if(p==0||s[i+p]==s[i+p-h]){var x=r.F._howLong(s,i,h);if(x>p){if(m=h,(p=x)>=l)break;h+2<x&&(x=h+2);for(var g=0,v=0;v<x-2;v++){var w=i-h+v+32768&32767,S=w-o[w]+32768&32767;S>g&&(g=S,f=w)}}}h+=(d=f)-(f=o[d])+32768&32767}return p<<16|m},r.F._howLong=function(s,i,o){if(s[i]!=s[i-o]||s[i+1]!=s[i+1-o]||s[i+2]!=s[i+2-o])return 0;var a=i,l=Math.min(s.length,i+258);for(i+=3;i<l&&s[i]==s[i-o];)i++;return i-a},r.F._hash=function(s,i){return(s[i]<<8|s[i+1])+(s[i+2]<<4)&65535},r.saved=0,r.F._writeBlock=function(s,i,o,a,l,u,d,f,h){var p,m,y,x,g,v,w,S,I,k=r.F.U,R=r.F._putsF,C=r.F._putsE;k.lhst[256]++,m=(p=r.F.getTrees())[0],y=p[1],x=p[2],g=p[3],v=p[4],w=p[5],S=p[6],I=p[7];var T=32+(h+3&7?8-(h+3&7):0)+(d<<3),_=a+r.F.contSize(k.fltree,k.lhst)+r.F.contSize(k.fdtree,k.dhst),N=a+r.F.contSize(k.ltree,k.lhst)+r.F.contSize(k.dtree,k.dhst);N+=14+3*w+r.F.contSize(k.itree,k.ihst)+(2*k.ihst[16]+3*k.ihst[17]+7*k.ihst[18]);for(var j=0;j<286;j++)k.lhst[j]=0;for(j=0;j<30;j++)k.dhst[j]=0;for(j=0;j<19;j++)k.ihst[j]=0;var O=T<_&&T<N?0:_<N?1:2;if(R(f,h,s),R(f,h+1,O),h+=3,O==0){for(;7&h;)h++;h=r.F._copyExact(l,u,d,f,h)}else{var P,G;if(O==1&&(P=k.fltree,G=k.fdtree),O==2){r.F.makeCodes(k.ltree,m),r.F.revCodes(k.ltree,m),r.F.makeCodes(k.dtree,y),r.F.revCodes(k.dtree,y),r.F.makeCodes(k.itree,x),r.F.revCodes(k.itree,x),P=k.ltree,G=k.dtree,C(f,h,g-257),C(f,h+=5,v-1),C(f,h+=5,w-4),h+=4;for(var A=0;A<w;A++)C(f,h+3*A,k.itree[1+(k.ordr[A]<<1)]);h+=3*w,h=r.F._codeTiny(S,k.itree,f,h),h=r.F._codeTiny(I,k.itree,f,h)}for(var M=u,Q=0;Q<o;Q+=2){for(var X=i[Q],D=X>>>23,Te=M+(8388607&X);M<Te;)h=r.F._writeLit(l[M++],P,f,h);if(D!=0){var xe=i[Q+1],U=xe>>16,z=xe>>8&255,ie=255&xe;C(f,h=r.F._writeLit(257+z,P,f,h),D-k.of0[z]),h+=k.exb[z],R(f,h=r.F._writeLit(ie,G,f,h),U-k.df0[ie]),h+=k.dxb[ie],M+=D}}h=r.F._writeLit(256,P,f,h)}return h},r.F._copyExact=function(s,i,o,a,l){var u=l>>>3;return a[u]=o,a[u+1]=o>>>8,a[u+2]=255-a[u],a[u+3]=255-a[u+1],u+=4,a.set(new Uint8Array(s.buffer,i,o),u),l+(o+4<<3)},r.F.getTrees=function(){for(var s=r.F.U,i=r.F._hufTree(s.lhst,s.ltree,15),o=r.F._hufTree(s.dhst,s.dtree,15),a=[],l=r.F._lenCodes(s.ltree,a),u=[],d=r.F._lenCodes(s.dtree,u),f=0;f<a.length;f+=2)s.ihst[a[f]]++;for(f=0;f<u.length;f+=2)s.ihst[u[f]]++;for(var h=r.F._hufTree(s.ihst,s.itree,7),p=19;p>4&&s.itree[1+(s.ordr[p-1]<<1)]==0;)p--;return[i,o,h,l,d,p,a,u]},r.F.getSecond=function(s){for(var i=[],o=0;o<s.length;o+=2)i.push(s[o+1]);return i},r.F.nonZero=function(s){for(var i="",o=0;o<s.length;o+=2)s[o+1]!=0&&(i+=(o>>1)+",");return i},r.F.contSize=function(s,i){for(var o=0,a=0;a<i.length;a++)o+=i[a]*s[1+(a<<1)];return o},r.F._codeTiny=function(s,i,o,a){for(var l=0;l<s.length;l+=2){var u=s[l],d=s[l+1];a=r.F._writeLit(u,i,o,a);var f=u==16?2:u==17?3:7;u>15&&(r.F._putsE(o,a,d,f),a+=f)}return a},r.F._lenCodes=function(s,i){for(var o=s.length;o!=2&&s[o-1]==0;)o-=2;for(var a=0;a<o;a+=2){var l=s[a+1],u=a+3<o?s[a+3]:-1,d=a+5<o?s[a+5]:-1,f=a==0?-1:s[a-1];if(l==0&&u==l&&d==l){for(var h=a+5;h+2<o&&s[h+2]==l;)h+=2;(p=Math.min(h+1-a>>>1,138))<11?i.push(17,p-3):i.push(18,p-11),a+=2*p-2}else if(l==f&&u==l&&d==l){for(h=a+5;h+2<o&&s[h+2]==l;)h+=2;var p=Math.min(h+1-a>>>1,6);i.push(16,p-3),a+=2*p-2}else i.push(l,0)}return o>>>1},r.F._hufTree=function(s,i,o){var a=[],l=s.length,u=i.length,d=0;for(d=0;d<u;d+=2)i[d]=0,i[d+1]=0;for(d=0;d<l;d++)s[d]!=0&&a.push({lit:d,f:s[d]});var f=a.length,h=a.slice(0);if(f==0)return 0;if(f==1){var p=a[0].lit;return h=p==0?1:0,i[1+(p<<1)]=1,i[1+(h<<1)]=1,1}a.sort(function(S,I){return S.f-I.f});var m=a[0],y=a[1],x=0,g=1,v=2;for(a[0]={lit:-1,f:m.f+y.f,l:m,r:y,d:0};g!=f-1;)m=x!=g&&(v==f||a[x].f<a[v].f)?a[x++]:a[v++],y=x!=g&&(v==f||a[x].f<a[v].f)?a[x++]:a[v++],a[g++]={lit:-1,f:m.f+y.f,l:m,r:y};var w=r.F.setDepth(a[g-1],0);for(w>o&&(r.F.restrictDepth(h,o,w),w=o),d=0;d<f;d++)i[1+(h[d].lit<<1)]=h[d].d;return w},r.F.setDepth=function(s,i){return s.lit!=-1?(s.d=i,i):Math.max(r.F.setDepth(s.l,i+1),r.F.setDepth(s.r,i+1))},r.F.restrictDepth=function(s,i,o){var a=0,l=1<<o-i,u=0;for(s.sort(function(f,h){return h.d==f.d?f.f-h.f:h.d-f.d}),a=0;a<s.length&&s[a].d>i;a++){var d=s[a].d;s[a].d=i,u+=l-(1<<o-d)}for(u>>>=o-i;u>0;)(d=s[a].d)<i?(s[a].d++,u-=1<<i-d-1):a++;for(;a>=0;a--)s[a].d==i&&u<0&&(s[a].d--,u++);u!=0&&console.log("debt left")},r.F._goodIndex=function(s,i){var o=0;return i[16|o]<=s&&(o|=16),i[8|o]<=s&&(o|=8),i[4|o]<=s&&(o|=4),i[2|o]<=s&&(o|=2),i[1|o]<=s&&(o|=1),o},r.F._writeLit=function(s,i,o,a){return r.F._putsF(o,a,i[s<<1]),a+i[1+(s<<1)]},r.F.inflate=function(s,i){var o=Uint8Array;if(s[0]==3&&s[1]==0)return i||new o(0);var a=r.F,l=a._bitsF,u=a._bitsE,d=a._decodeTiny,f=a.makeCodes,h=a.codes2map,p=a._get17,m=a.U,y=i==null;y&&(i=new o(s.length>>>2<<3));for(var x,g,v=0,w=0,S=0,I=0,k=0,R=0,C=0,T=0,_=0;v==0;)if(v=l(s,_,1),w=l(s,_+1,2),_+=3,w!=0){if(y&&(i=r.F._check(i,T+(1<<17))),w==1&&(x=m.flmap,g=m.fdmap,R=511,C=31),w==2){S=u(s,_,5)+257,I=u(s,_+5,5)+1,k=u(s,_+10,4)+4,_+=14;for(var N=0;N<38;N+=2)m.itree[N]=0,m.itree[N+1]=0;var j=1;for(N=0;N<k;N++){var O=u(s,_+3*N,3);m.itree[1+(m.ordr[N]<<1)]=O,O>j&&(j=O)}_+=3*k,f(m.itree,j),h(m.itree,j,m.imap),x=m.lmap,g=m.dmap,_=d(m.imap,(1<<j)-1,S+I,s,_,m.ttree);var P=a._copyOut(m.ttree,0,S,m.ltree);R=(1<<P)-1;var G=a._copyOut(m.ttree,S,I,m.dtree);C=(1<<G)-1,f(m.ltree,P),h(m.ltree,P,x),f(m.dtree,G),h(m.dtree,G,g)}for(;;){var A=x[p(s,_)&R];_+=15&A;var M=A>>>4;if(!(M>>>8))i[T++]=M;else{if(M==256)break;var Q=T+M-254;if(M>264){var X=m.ldef[M-257];Q=T+(X>>>3)+u(s,_,7&X),_+=7&X}var D=g[p(s,_)&C];_+=15&D;var Te=D>>>4,xe=m.ddef[Te],U=(xe>>>4)+l(s,_,15&xe);for(_+=15&xe,y&&(i=r.F._check(i,T+(1<<17)));T<Q;)i[T]=i[T++-U],i[T]=i[T++-U],i[T]=i[T++-U],i[T]=i[T++-U];T=Q}}}else{7&_&&(_+=8-(7&_));var z=4+(_>>>3),ie=s[z-4]|s[z-3]<<8;y&&(i=r.F._check(i,T+ie)),i.set(new o(s.buffer,s.byteOffset+z,ie),T),_=z+ie<<3,T+=ie}return i.length==T?i:i.slice(0,T)},r.F._check=function(s,i){var o=s.length;if(i<=o)return s;var a=new Uint8Array(Math.max(o<<1,i));return a.set(s,0),a},r.F._decodeTiny=function(s,i,o,a,l,u){for(var d=r.F._bitsE,f=r.F._get17,h=0;h<o;){var p=s[f(a,l)&i];l+=15&p;var m=p>>>4;if(m<=15)u[h]=m,h++;else{var y=0,x=0;m==16?(x=3+d(a,l,2),l+=2,y=u[h-1]):m==17?(x=3+d(a,l,3),l+=3):m==18&&(x=11+d(a,l,7),l+=7);for(var g=h+x;h<g;)u[h]=y,h++}}return l},r.F._copyOut=function(s,i,o,a){for(var l=0,u=0,d=a.length>>>1;u<o;){var f=s[u+i];a[u<<1]=0,a[1+(u<<1)]=f,f>l&&(l=f),u++}for(;u<d;)a[u<<1]=0,a[1+(u<<1)]=0,u++;return l},r.F.makeCodes=function(s,i){for(var o,a,l,u,d=r.F.U,f=s.length,h=d.bl_count,p=0;p<=i;p++)h[p]=0;for(p=1;p<f;p+=2)h[s[p]]++;var m=d.next_code;for(o=0,h[0]=0,a=1;a<=i;a++)o=o+h[a-1]<<1,m[a]=o;for(l=0;l<f;l+=2)(u=s[l+1])!=0&&(s[l]=m[u],m[u]++)},r.F.codes2map=function(s,i,o){for(var a=s.length,l=r.F.U.rev15,u=0;u<a;u+=2)if(s[u+1]!=0)for(var d=u>>1,f=s[u+1],h=d<<4|f,p=i-f,m=s[u]<<p,y=m+(1<<p);m!=y;)o[l[m]>>>15-i]=h,m++},r.F.revCodes=function(s,i){for(var o=r.F.U.rev15,a=15-i,l=0;l<s.length;l+=2){var u=s[l]<<i-s[l+1];s[l]=o[u]>>>a}},r.F._putsE=function(s,i,o){o<<=7&i;var a=i>>>3;s[a]|=o,s[a+1]|=o>>>8},r.F._putsF=function(s,i,o){o<<=7&i;var a=i>>>3;s[a]|=o,s[a+1]|=o>>>8,s[a+2]|=o>>>16},r.F._bitsE=function(s,i,o){return(s[i>>>3]|s[1+(i>>>3)]<<8)>>>(7&i)&(1<<o)-1},r.F._bitsF=function(s,i,o){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16)>>>(7&i)&(1<<o)-1},r.F._get17=function(s,i){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16)>>>(7&i)},r.F._get25=function(s,i){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16|s[3+(i>>>3)]<<24)>>>(7&i)},r.F.U=(e=Uint16Array,n=Uint32Array,{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new n(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new n(286),dhst:new n(30),ihst:new n(19),lits:new n(15e3),strt:new e(65536),prev:new e(32768)}),function(){for(var s=r.F.U,i=0;i<32768;i++){var o=i;o=(4278255360&(o=(4042322160&(o=(3435973836&(o=(2863311530&o)>>>1|(1431655765&o)<<1))>>>2|(858993459&o)<<2))>>>4|(252645135&o)<<4))>>>8|(16711935&o)<<8,s.rev15[i]=(o>>>16|o<<16)>>>17}function a(l,u,d){for(;u--!=0;)l.push(0,d)}for(i=0;i<32;i++)s.ldef[i]=s.of0[i]<<3|s.exb[i],s.ddef[i]=s.df0[i]<<4|s.dxb[i];a(s.fltree,144,8),a(s.fltree,112,9),a(s.fltree,24,7),a(s.fltree,8,8),r.F.makeCodes(s.fltree,9),r.F.codes2map(s.fltree,9,s.flmap),r.F.revCodes(s.fltree,9),a(s.fdtree,32,5),r.F.makeCodes(s.fdtree,5),r.F.codes2map(s.fdtree,5,s.fdmap),r.F.revCodes(s.fdtree,5),a(s.itree,19,0),a(s.ltree,286,0),a(s.dtree,30,0),a(s.ttree,320,0)}()})();var j9=C9({__proto__:null,default:cm},[cm]);const Li=function(){var t={nextZero(d,f){for(;d[f]!=0;)f++;return f},readUshort:(d,f)=>d[f]<<8|d[f+1],writeUshort(d,f,h){d[f]=h>>8&255,d[f+1]=255&h},readUint:(d,f)=>16777216*d[f]+(d[f+1]<<16|d[f+2]<<8|d[f+3]),writeUint(d,f,h){d[f]=h>>24&255,d[f+1]=h>>16&255,d[f+2]=h>>8&255,d[f+3]=255&h},readASCII(d,f,h){let p="";for(let m=0;m<h;m++)p+=String.fromCharCode(d[f+m]);return p},writeASCII(d,f,h){for(let p=0;p<h.length;p++)d[f+p]=h.charCodeAt(p)},readBytes(d,f,h){const p=[];for(let m=0;m<h;m++)p.push(d[f+m]);return p},pad:d=>d.length<2?`0${d}`:d,readUTF8(d,f,h){let p,m="";for(let y=0;y<h;y++)m+=`%${t.pad(d[f+y].toString(16))}`;try{p=decodeURIComponent(m)}catch{return t.readASCII(d,f,h)}return p}};function e(d,f,h,p){const m=f*h,y=i(p),x=Math.ceil(f*y/8),g=new Uint8Array(4*m),v=new Uint32Array(g.buffer),{ctype:w}=p,{depth:S}=p,I=t.readUshort;if(w==6){const X=m<<2;if(S==8)for(var k=0;k<X;k+=4)g[k]=d[k],g[k+1]=d[k+1],g[k+2]=d[k+2],g[k+3]=d[k+3];if(S==16)for(k=0;k<X;k++)g[k]=d[k<<1]}else if(w==2){const X=p.tabs.tRNS;if(X==null){if(S==8)for(k=0;k<m;k++){var R=3*k;v[k]=255<<24|d[R+2]<<16|d[R+1]<<8|d[R]}if(S==16)for(k=0;k<m;k++)R=6*k,v[k]=255<<24|d[R+4]<<16|d[R+2]<<8|d[R]}else{var C=X[0];const D=X[1],Te=X[2];if(S==8)for(k=0;k<m;k++){var T=k<<2;R=3*k,v[k]=255<<24|d[R+2]<<16|d[R+1]<<8|d[R],d[R]==C&&d[R+1]==D&&d[R+2]==Te&&(g[T+3]=0)}if(S==16)for(k=0;k<m;k++)T=k<<2,R=6*k,v[k]=255<<24|d[R+4]<<16|d[R+2]<<8|d[R],I(d,R)==C&&I(d,R+2)==D&&I(d,R+4)==Te&&(g[T+3]=0)}}else if(w==3){const X=p.tabs.PLTE,D=p.tabs.tRNS,Te=D?D.length:0;if(S==1)for(var _=0;_<h;_++){var N=_*x,j=_*f;for(k=0;k<f;k++){T=j+k<<2;var O=3*(P=d[N+(k>>3)]>>7-((7&k)<<0)&1);g[T]=X[O],g[T+1]=X[O+1],g[T+2]=X[O+2],g[T+3]=P<Te?D[P]:255}}if(S==2)for(_=0;_<h;_++)for(N=_*x,j=_*f,k=0;k<f;k++)T=j+k<<2,O=3*(P=d[N+(k>>2)]>>6-((3&k)<<1)&3),g[T]=X[O],g[T+1]=X[O+1],g[T+2]=X[O+2],g[T+3]=P<Te?D[P]:255;if(S==4)for(_=0;_<h;_++)for(N=_*x,j=_*f,k=0;k<f;k++)T=j+k<<2,O=3*(P=d[N+(k>>1)]>>4-((1&k)<<2)&15),g[T]=X[O],g[T+1]=X[O+1],g[T+2]=X[O+2],g[T+3]=P<Te?D[P]:255;if(S==8)for(k=0;k<m;k++){var P;T=k<<2,O=3*(P=d[k]),g[T]=X[O],g[T+1]=X[O+1],g[T+2]=X[O+2],g[T+3]=P<Te?D[P]:255}}else if(w==4){if(S==8)for(k=0;k<m;k++){T=k<<2;var G=d[A=k<<1];g[T]=G,g[T+1]=G,g[T+2]=G,g[T+3]=d[A+1]}if(S==16)for(k=0;k<m;k++){var A;T=k<<2,G=d[A=k<<2],g[T]=G,g[T+1]=G,g[T+2]=G,g[T+3]=d[A+2]}}else if(w==0)for(C=p.tabs.tRNS?p.tabs.tRNS:-1,_=0;_<h;_++){const X=_*x,D=_*f;if(S==1)for(var M=0;M<f;M++){var Q=(G=255*(d[X+(M>>>3)]>>>7-(7&M)&1))==255*C?0:255;v[D+M]=Q<<24|G<<16|G<<8|G}else if(S==2)for(M=0;M<f;M++)Q=(G=85*(d[X+(M>>>2)]>>>6-((3&M)<<1)&3))==85*C?0:255,v[D+M]=Q<<24|G<<16|G<<8|G;else if(S==4)for(M=0;M<f;M++)Q=(G=17*(d[X+(M>>>1)]>>>4-((1&M)<<2)&15))==17*C?0:255,v[D+M]=Q<<24|G<<16|G<<8|G;else if(S==8)for(M=0;M<f;M++)Q=(G=d[X+M])==C?0:255,v[D+M]=Q<<24|G<<16|G<<8|G;else if(S==16)for(M=0;M<f;M++)G=d[X+(M<<1)],Q=I(d,X+(M<<1))==C?0:255,v[D+M]=Q<<24|G<<16|G<<8|G}return g}function n(d,f,h,p){const m=i(d),y=Math.ceil(h*m/8),x=new Uint8Array((y+1+d.interlace)*p);return f=d.tabs.CgBI?s(f,x):r(f,x),d.interlace==0?f=o(f,d,0,h,p):d.interlace==1&&(f=function(v,w){const S=w.width,I=w.height,k=i(w),R=k>>3,C=Math.ceil(S*k/8),T=new Uint8Array(I*C);let _=0;const N=[0,0,4,0,2,0,1],j=[0,4,0,2,0,1,0],O=[8,8,8,4,4,2,2],P=[8,8,4,4,2,2,1];let G=0;for(;G<7;){const M=O[G],Q=P[G];let X=0,D=0,Te=N[G];for(;Te<I;)Te+=M,D++;let xe=j[G];for(;xe<S;)xe+=Q,X++;const U=Math.ceil(X*k/8);o(v,w,_,X,D);let z=0,ie=N[G];for(;ie<I;){let Be=j[G],st=_+z*U<<3;for(;Be<S;){var A;if(k==1&&(A=(A=v[st>>3])>>7-(7&st)&1,T[ie*C+(Be>>3)]|=A<<7-((7&Be)<<0)),k==2&&(A=(A=v[st>>3])>>6-(7&st)&3,T[ie*C+(Be>>2)]|=A<<6-((3&Be)<<1)),k==4&&(A=(A=v[st>>3])>>4-(7&st)&15,T[ie*C+(Be>>1)]|=A<<4-((1&Be)<<2)),k>=8){const ae=ie*C+Be*R;for(let Z=0;Z<R;Z++)T[ae+Z]=v[(st>>3)+Z]}st+=k,Be+=Q}z++,ie+=M}X*D!=0&&(_+=D*(1+U)),G+=1}return T}(f,d)),f}function r(d,f){return s(new Uint8Array(d.buffer,2,d.length-6),f)}var s=function(){const d={H:{}};return d.H.N=function(f,h){const p=Uint8Array;let m,y,x=0,g=0,v=0,w=0,S=0,I=0,k=0,R=0,C=0;if(f[0]==3&&f[1]==0)return h||new p(0);const T=d.H,_=T.b,N=T.e,j=T.R,O=T.n,P=T.A,G=T.Z,A=T.m,M=h==null;for(M&&(h=new p(f.length>>>2<<5));x==0;)if(x=_(f,C,1),g=_(f,C+1,2),C+=3,g!=0){if(M&&(h=d.H.W(h,R+(1<<17))),g==1&&(m=A.J,y=A.h,I=511,k=31),g==2){v=N(f,C,5)+257,w=N(f,C+5,5)+1,S=N(f,C+10,4)+4,C+=14;let X=1;for(var Q=0;Q<38;Q+=2)A.Q[Q]=0,A.Q[Q+1]=0;for(Q=0;Q<S;Q++){const xe=N(f,C+3*Q,3);A.Q[1+(A.X[Q]<<1)]=xe,xe>X&&(X=xe)}C+=3*S,O(A.Q,X),P(A.Q,X,A.u),m=A.w,y=A.d,C=j(A.u,(1<<X)-1,v+w,f,C,A.v);const D=T.V(A.v,0,v,A.C);I=(1<<D)-1;const Te=T.V(A.v,v,w,A.D);k=(1<<Te)-1,O(A.C,D),P(A.C,D,m),O(A.D,Te),P(A.D,Te,y)}for(;;){const X=m[G(f,C)&I];C+=15&X;const D=X>>>4;if(!(D>>>8))h[R++]=D;else{if(D==256)break;{let Te=R+D-254;if(D>264){const Be=A.q[D-257];Te=R+(Be>>>3)+N(f,C,7&Be),C+=7&Be}const xe=y[G(f,C)&k];C+=15&xe;const U=xe>>>4,z=A.c[U],ie=(z>>>4)+_(f,C,15&z);for(C+=15&z;R<Te;)h[R]=h[R++-ie],h[R]=h[R++-ie],h[R]=h[R++-ie],h[R]=h[R++-ie];R=Te}}}}else{7&C&&(C+=8-(7&C));const X=4+(C>>>3),D=f[X-4]|f[X-3]<<8;M&&(h=d.H.W(h,R+D)),h.set(new p(f.buffer,f.byteOffset+X,D),R),C=X+D<<3,R+=D}return h.length==R?h:h.slice(0,R)},d.H.W=function(f,h){const p=f.length;if(h<=p)return f;const m=new Uint8Array(p<<1);return m.set(f,0),m},d.H.R=function(f,h,p,m,y,x){const g=d.H.e,v=d.H.Z;let w=0;for(;w<p;){const S=f[v(m,y)&h];y+=15&S;const I=S>>>4;if(I<=15)x[w]=I,w++;else{let k=0,R=0;I==16?(R=3+g(m,y,2),y+=2,k=x[w-1]):I==17?(R=3+g(m,y,3),y+=3):I==18&&(R=11+g(m,y,7),y+=7);const C=w+R;for(;w<C;)x[w]=k,w++}}return y},d.H.V=function(f,h,p,m){let y=0,x=0;const g=m.length>>>1;for(;x<p;){const v=f[x+h];m[x<<1]=0,m[1+(x<<1)]=v,v>y&&(y=v),x++}for(;x<g;)m[x<<1]=0,m[1+(x<<1)]=0,x++;return y},d.H.n=function(f,h){const p=d.H.m,m=f.length;let y,x,g,v;const w=p.j;for(var S=0;S<=h;S++)w[S]=0;for(S=1;S<m;S+=2)w[f[S]]++;const I=p.K;for(y=0,w[0]=0,x=1;x<=h;x++)y=y+w[x-1]<<1,I[x]=y;for(g=0;g<m;g+=2)v=f[g+1],v!=0&&(f[g]=I[v],I[v]++)},d.H.A=function(f,h,p){const m=f.length,y=d.H.m.r;for(let x=0;x<m;x+=2)if(f[x+1]!=0){const g=x>>1,v=f[x+1],w=g<<4|v,S=h-v;let I=f[x]<<S;const k=I+(1<<S);for(;I!=k;)p[y[I]>>>15-h]=w,I++}},d.H.l=function(f,h){const p=d.H.m.r,m=15-h;for(let y=0;y<f.length;y+=2){const x=f[y]<<h-f[y+1];f[y]=p[x]>>>m}},d.H.M=function(f,h,p){p<<=7&h;const m=h>>>3;f[m]|=p,f[m+1]|=p>>>8},d.H.I=function(f,h,p){p<<=7&h;const m=h>>>3;f[m]|=p,f[m+1]|=p>>>8,f[m+2]|=p>>>16},d.H.e=function(f,h,p){return(f[h>>>3]|f[1+(h>>>3)]<<8)>>>(7&h)&(1<<p)-1},d.H.b=function(f,h,p){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16)>>>(7&h)&(1<<p)-1},d.H.Z=function(f,h){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16)>>>(7&h)},d.H.i=function(f,h){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16|f[3+(h>>>3)]<<24)>>>(7&h)},d.H.m=function(){const f=Uint16Array,h=Uint32Array;return{K:new f(16),j:new f(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new f(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new h(32),J:new f(512),_:[],h:new f(32),$:[],w:new f(32768),C:[],v:[],d:new f(32768),D:[],u:new f(512),Q:[],r:new f(32768),s:new h(286),Y:new h(30),a:new h(19),t:new h(15e3),k:new f(65536),g:new f(32768)}}(),function(){const f=d.H.m;for(var h=0;h<32768;h++){let m=h;m=(2863311530&m)>>>1|(1431655765&m)<<1,m=(3435973836&m)>>>2|(858993459&m)<<2,m=(4042322160&m)>>>4|(252645135&m)<<4,m=(4278255360&m)>>>8|(16711935&m)<<8,f.r[h]=(m>>>16|m<<16)>>>17}function p(m,y,x){for(;y--!=0;)m.push(0,x)}for(h=0;h<32;h++)f.q[h]=f.S[h]<<3|f.T[h],f.c[h]=f.p[h]<<4|f.z[h];p(f._,144,8),p(f._,112,9),p(f._,24,7),p(f._,8,8),d.H.n(f._,9),d.H.A(f._,9,f.J),d.H.l(f._,9),p(f.$,32,5),d.H.n(f.$,5),d.H.A(f.$,5,f.h),d.H.l(f.$,5),p(f.Q,19,0),p(f.C,286,0),p(f.D,30,0),p(f.v,320,0)}(),d.H.N}();function i(d){return[1,null,3,1,2,null,4][d.ctype]*d.depth}function o(d,f,h,p,m){let y=i(f);const x=Math.ceil(p*y/8);let g,v;y=Math.ceil(y/8);let w=d[h],S=0;if(w>1&&(d[h]=[0,0,1][w-2]),w==3)for(S=y;S<x;S++)d[S+1]=d[S+1]+(d[S+1-y]>>>1)&255;for(let I=0;I<m;I++)if(g=h+I*x,v=g+I+1,w=d[v-1],S=0,w==0)for(;S<x;S++)d[g+S]=d[v+S];else if(w==1){for(;S<y;S++)d[g+S]=d[v+S];for(;S<x;S++)d[g+S]=d[v+S]+d[g+S-y]}else if(w==2)for(;S<x;S++)d[g+S]=d[v+S]+d[g+S-x];else if(w==3){for(;S<y;S++)d[g+S]=d[v+S]+(d[g+S-x]>>>1);for(;S<x;S++)d[g+S]=d[v+S]+(d[g+S-x]+d[g+S-y]>>>1)}else{for(;S<y;S++)d[g+S]=d[v+S]+a(0,d[g+S-x],0);for(;S<x;S++)d[g+S]=d[v+S]+a(d[g+S-y],d[g+S-x],d[g+S-y-x])}return d}function a(d,f,h){const p=d+f-h,m=p-d,y=p-f,x=p-h;return m*m<=y*y&&m*m<=x*x?d:y*y<=x*x?f:h}function l(d,f,h){h.width=t.readUint(d,f),f+=4,h.height=t.readUint(d,f),f+=4,h.depth=d[f],f++,h.ctype=d[f],f++,h.compress=d[f],f++,h.filter=d[f],f++,h.interlace=d[f],f++}function u(d,f,h,p,m,y,x,g,v){const w=Math.min(f,m),S=Math.min(h,y);let I=0,k=0;for(let G=0;G<S;G++)for(let A=0;A<w;A++)if(x>=0&&g>=0?(I=G*f+A<<2,k=(g+G)*m+x+A<<2):(I=(-g+G)*f-x+A<<2,k=G*m+A<<2),v==0)p[k]=d[I],p[k+1]=d[I+1],p[k+2]=d[I+2],p[k+3]=d[I+3];else if(v==1){var R=d[I+3]*.00392156862745098,C=d[I]*R,T=d[I+1]*R,_=d[I+2]*R,N=p[k+3]*(1/255),j=p[k]*N,O=p[k+1]*N,P=p[k+2]*N;const M=1-R,Q=R+N*M,X=Q==0?0:1/Q;p[k+3]=255*Q,p[k+0]=(C+j*M)*X,p[k+1]=(T+O*M)*X,p[k+2]=(_+P*M)*X}else if(v==2)R=d[I+3],C=d[I],T=d[I+1],_=d[I+2],N=p[k+3],j=p[k],O=p[k+1],P=p[k+2],R==N&&C==j&&T==O&&_==P?(p[k]=0,p[k+1]=0,p[k+2]=0,p[k+3]=0):(p[k]=C,p[k+1]=T,p[k+2]=_,p[k+3]=R);else if(v==3){if(R=d[I+3],C=d[I],T=d[I+1],_=d[I+2],N=p[k+3],j=p[k],O=p[k+1],P=p[k+2],R==N&&C==j&&T==O&&_==P)continue;if(R<220&&N>20)return!1}return!0}return{decode:function(f){const h=new Uint8Array(f);let p=8;const m=t,y=m.readUshort,x=m.readUint,g={tabs:{},frames:[]},v=new Uint8Array(h.length);let w,S=0,I=0;const k=[137,80,78,71,13,10,26,10];for(var R=0;R<8;R++)if(h[R]!=k[R])throw"The input is not a PNG file!";for(;p<h.length;){const G=m.readUint(h,p);p+=4;const A=m.readASCII(h,p,4);if(p+=4,A=="IHDR")l(h,p,g);else if(A=="iCCP"){for(var C=p;h[C]!=0;)C++;m.readASCII(h,p,C-p),h[C+1];const M=h.slice(C+2,p+G);let Q=null;try{Q=r(M)}catch{Q=s(M)}g.tabs[A]=Q}else if(A=="CgBI")g.tabs[A]=h.slice(p,p+4);else if(A=="IDAT"){for(R=0;R<G;R++)v[S+R]=h[p+R];S+=G}else if(A=="acTL")g.tabs[A]={num_frames:x(h,p),num_plays:x(h,p+4)},w=new Uint8Array(h.length);else if(A=="fcTL"){I!=0&&((P=g.frames[g.frames.length-1]).data=n(g,w.slice(0,I),P.rect.width,P.rect.height),I=0);const M={x:x(h,p+12),y:x(h,p+16),width:x(h,p+4),height:x(h,p+8)};let Q=y(h,p+22);Q=y(h,p+20)/(Q==0?100:Q);const X={rect:M,delay:Math.round(1e3*Q),dispose:h[p+24],blend:h[p+25]};g.frames.push(X)}else if(A=="fdAT"){for(R=0;R<G-4;R++)w[I+R]=h[p+R+4];I+=G-4}else if(A=="pHYs")g.tabs[A]=[m.readUint(h,p),m.readUint(h,p+4),h[p+8]];else if(A=="cHRM")for(g.tabs[A]=[],R=0;R<8;R++)g.tabs[A].push(m.readUint(h,p+4*R));else if(A=="tEXt"||A=="zTXt"){g.tabs[A]==null&&(g.tabs[A]={});var T=m.nextZero(h,p),_=m.readASCII(h,p,T-p),N=p+G-T-1;if(A=="tEXt")O=m.readASCII(h,T+1,N);else{var j=r(h.slice(T+2,T+2+N));O=m.readUTF8(j,0,j.length)}g.tabs[A][_]=O}else if(A=="iTXt"){g.tabs[A]==null&&(g.tabs[A]={}),T=0,C=p,T=m.nextZero(h,C),_=m.readASCII(h,C,T-C);const M=h[C=T+1];var O;h[C+1],C+=2,T=m.nextZero(h,C),m.readASCII(h,C,T-C),C=T+1,T=m.nextZero(h,C),m.readUTF8(h,C,T-C),N=G-((C=T+1)-p),M==0?O=m.readUTF8(h,C,N):(j=r(h.slice(C,C+N)),O=m.readUTF8(j,0,j.length)),g.tabs[A][_]=O}else if(A=="PLTE")g.tabs[A]=m.readBytes(h,p,G);else if(A=="hIST"){const M=g.tabs.PLTE.length/3;for(g.tabs[A]=[],R=0;R<M;R++)g.tabs[A].push(y(h,p+2*R))}else if(A=="tRNS")g.ctype==3?g.tabs[A]=m.readBytes(h,p,G):g.ctype==0?g.tabs[A]=y(h,p):g.ctype==2&&(g.tabs[A]=[y(h,p),y(h,p+2),y(h,p+4)]);else if(A=="gAMA")g.tabs[A]=m.readUint(h,p)/1e5;else if(A=="sRGB")g.tabs[A]=h[p];else if(A=="bKGD")g.ctype==0||g.ctype==4?g.tabs[A]=[y(h,p)]:g.ctype==2||g.ctype==6?g.tabs[A]=[y(h,p),y(h,p+2),y(h,p+4)]:g.ctype==3&&(g.tabs[A]=h[p]);else if(A=="IEND")break;p+=G,m.readUint(h,p),p+=4}var P;return I!=0&&((P=g.frames[g.frames.length-1]).data=n(g,w.slice(0,I),P.rect.width,P.rect.height)),g.data=n(g,v,g.width,g.height),delete g.compress,delete g.interlace,delete g.filter,g},toRGBA8:function(f){const h=f.width,p=f.height;if(f.tabs.acTL==null)return[e(f.data,h,p,f).buffer];const m=[];f.frames[0].data==null&&(f.frames[0].data=f.data);const y=h*p*4,x=new Uint8Array(y),g=new Uint8Array(y),v=new Uint8Array(y);for(let S=0;S<f.frames.length;S++){const I=f.frames[S],k=I.rect.x,R=I.rect.y,C=I.rect.width,T=I.rect.height,_=e(I.data,C,T,f);if(S!=0)for(var w=0;w<y;w++)v[w]=x[w];if(I.blend==0?u(_,C,T,x,h,p,k,R,0):I.blend==1&&u(_,C,T,x,h,p,k,R,1),m.push(x.buffer.slice(0)),I.dispose!=0){if(I.dispose==1)u(g,C,T,x,h,p,k,R,0);else if(I.dispose==2)for(w=0;w<y;w++)x[w]=v[w]}}return m},_paeth:a,_copyTile:u,_bin:t}}();(function(){const{_copyTile:t}=Li,{_bin:e}=Li,n=Li._paeth;var r={table:function(){const C=new Uint32Array(256);for(let T=0;T<256;T++){let _=T;for(let N=0;N<8;N++)1&_?_=3988292384^_>>>1:_>>>=1;C[T]=_}return C}(),update(C,T,_,N){for(let j=0;j<N;j++)C=r.table[255&(C^T[_+j])]^C>>>8;return C},crc:(C,T,_)=>4294967295^r.update(4294967295,C,T,_)};function s(C,T,_,N){T[_]+=C[0]*N>>4,T[_+1]+=C[1]*N>>4,T[_+2]+=C[2]*N>>4,T[_+3]+=C[3]*N>>4}function i(C){return Math.max(0,Math.min(255,C))}function o(C,T){const _=C[0]-T[0],N=C[1]-T[1],j=C[2]-T[2],O=C[3]-T[3];return _*_+N*N+j*j+O*O}function a(C,T,_,N,j,O,P){P==null&&(P=1);const G=N.length,A=[];for(var M=0;M<G;M++){const ie=N[M];A.push([ie>>>0&255,ie>>>8&255,ie>>>16&255,ie>>>24&255])}for(M=0;M<G;M++){let ie=4294967295;for(var Q=0,X=0;X<G;X++){var D=o(A[M],A[X]);X!=M&&D<ie&&(ie=D,Q=X)}}const Te=new Uint32Array(j.buffer),xe=new Int16Array(T*_*4),U=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(M=0;M<U.length;M++)U[M]=255*((U[M]+.5)/16-.5);for(let ie=0;ie<_;ie++)for(let Be=0;Be<T;Be++){var z;M=4*(ie*T+Be),P!=2?z=[i(C[M]+xe[M]),i(C[M+1]+xe[M+1]),i(C[M+2]+xe[M+2]),i(C[M+3]+xe[M+3])]:(D=U[4*(3&ie)+(3&Be)],z=[i(C[M]+D),i(C[M+1]+D),i(C[M+2]+D),i(C[M+3]+D)]),Q=0;let st=16777215;for(X=0;X<G;X++){const K=o(z,A[X]);K<st&&(st=K,Q=X)}const ae=A[Q],Z=[z[0]-ae[0],z[1]-ae[1],z[2]-ae[2],z[3]-ae[3]];P==1&&(Be!=T-1&&s(Z,xe,M+4,7),ie!=_-1&&(Be!=0&&s(Z,xe,M+4*T-4,3),s(Z,xe,M+4*T,5),Be!=T-1&&s(Z,xe,M+4*T+4,1))),O[M>>2]=Q,Te[M>>2]=N[Q]}}function l(C,T,_,N,j){j==null&&(j={});const{crc:O}=r,P=e.writeUint,G=e.writeUshort,A=e.writeASCII;let M=8;const Q=C.frames.length>1;let X,D=!1,Te=33+(Q?20:0);if(j.sRGB!=null&&(Te+=13),j.pHYs!=null&&(Te+=21),j.iCCP!=null&&(X=pako.deflate(j.iCCP),Te+=21+X.length+4),C.ctype==3){for(var xe=C.plte.length,U=0;U<xe;U++)C.plte[U]>>>24!=255&&(D=!0);Te+=8+3*xe+4+(D?8+1*xe+4:0)}for(var z=0;z<C.frames.length;z++)Q&&(Te+=38),Te+=(ae=C.frames[z]).cimg.length+12,z!=0&&(Te+=4);Te+=12;const ie=new Uint8Array(Te),Be=[137,80,78,71,13,10,26,10];for(U=0;U<8;U++)ie[U]=Be[U];if(P(ie,M,13),M+=4,A(ie,M,"IHDR"),M+=4,P(ie,M,T),M+=4,P(ie,M,_),M+=4,ie[M]=C.depth,M++,ie[M]=C.ctype,M++,ie[M]=0,M++,ie[M]=0,M++,ie[M]=0,M++,P(ie,M,O(ie,M-17,17)),M+=4,j.sRGB!=null&&(P(ie,M,1),M+=4,A(ie,M,"sRGB"),M+=4,ie[M]=j.sRGB,M++,P(ie,M,O(ie,M-5,5)),M+=4),j.iCCP!=null){const Z=13+X.length;P(ie,M,Z),M+=4,A(ie,M,"iCCP"),M+=4,A(ie,M,"ICC profile"),M+=11,M+=2,ie.set(X,M),M+=X.length,P(ie,M,O(ie,M-(Z+4),Z+4)),M+=4}if(j.pHYs!=null&&(P(ie,M,9),M+=4,A(ie,M,"pHYs"),M+=4,P(ie,M,j.pHYs[0]),M+=4,P(ie,M,j.pHYs[1]),M+=4,ie[M]=j.pHYs[2],M++,P(ie,M,O(ie,M-13,13)),M+=4),Q&&(P(ie,M,8),M+=4,A(ie,M,"acTL"),M+=4,P(ie,M,C.frames.length),M+=4,P(ie,M,j.loop!=null?j.loop:0),M+=4,P(ie,M,O(ie,M-12,12)),M+=4),C.ctype==3){for(P(ie,M,3*(xe=C.plte.length)),M+=4,A(ie,M,"PLTE"),M+=4,U=0;U<xe;U++){const Z=3*U,K=C.plte[U],de=255&K,ce=K>>>8&255,ke=K>>>16&255;ie[M+Z+0]=de,ie[M+Z+1]=ce,ie[M+Z+2]=ke}if(M+=3*xe,P(ie,M,O(ie,M-3*xe-4,3*xe+4)),M+=4,D){for(P(ie,M,xe),M+=4,A(ie,M,"tRNS"),M+=4,U=0;U<xe;U++)ie[M+U]=C.plte[U]>>>24&255;M+=xe,P(ie,M,O(ie,M-xe-4,xe+4)),M+=4}}let st=0;for(z=0;z<C.frames.length;z++){var ae=C.frames[z];Q&&(P(ie,M,26),M+=4,A(ie,M,"fcTL"),M+=4,P(ie,M,st++),M+=4,P(ie,M,ae.rect.width),M+=4,P(ie,M,ae.rect.height),M+=4,P(ie,M,ae.rect.x),M+=4,P(ie,M,ae.rect.y),M+=4,G(ie,M,N[z]),M+=2,G(ie,M,1e3),M+=2,ie[M]=ae.dispose,M++,ie[M]=ae.blend,M++,P(ie,M,O(ie,M-30,30)),M+=4);const Z=ae.cimg;P(ie,M,(xe=Z.length)+(z==0?0:4)),M+=4;const K=M;A(ie,M,z==0?"IDAT":"fdAT"),M+=4,z!=0&&(P(ie,M,st++),M+=4),ie.set(Z,M),M+=xe,P(ie,M,O(ie,K,M-K)),M+=4}return P(ie,M,0),M+=4,A(ie,M,"IEND"),M+=4,P(ie,M,O(ie,M-4,4)),M+=4,ie.buffer}function u(C,T,_){for(let N=0;N<C.frames.length;N++){const j=C.frames[N];j.rect.width;const O=j.rect.height,P=new Uint8Array(O*j.bpl+O);j.cimg=p(j.img,O,j.bpp,j.bpl,P,T,_)}}function d(C,T,_,N,j){const O=j[0],P=j[1],G=j[2],A=j[3],M=j[4],Q=j[5];let X=6,D=8,Te=255;for(var xe=0;xe<C.length;xe++){const Ke=new Uint8Array(C[xe]);for(var U=Ke.length,z=0;z<U;z+=4)Te&=Ke[z+3]}const ie=Te!=255,Be=function(je,V,re,se,ne,pe){const ee=[];for(var ye=0;ye<je.length;ye++){const wt=new Uint8Array(je[ye]),ge=new Uint32Array(wt.buffer);var Pe;let Le=0,Ue=0,De=V,Qe=re,pt=se?1:0;if(ye!=0){const nt=pe||se||ye==1||ee[ye-2].dispose!=0?1:2;let ut=0,he=1e9;for(let we=0;we<nt;we++){var me=new Uint8Array(je[ye-1-we]);const Xe=new Uint32Array(je[ye-1-we]);let Ze=V,lt=re,Ge=-1,Ct=-1;for(let q=0;q<re;q++)for(let oe=0;oe<V;oe++)ge[qe=q*V+oe]!=Xe[qe]&&(oe<Ze&&(Ze=oe),oe>Ge&&(Ge=oe),q<lt&&(lt=q),q>Ct&&(Ct=q));Ge==-1&&(Ze=lt=Ge=Ct=0),ne&&((1&Ze)==1&&Ze--,(1&lt)==1&&lt--);const Y=(Ge-Ze+1)*(Ct-lt+1);Y<he&&(he=Y,ut=we,Le=Ze,Ue=lt,De=Ge-Ze+1,Qe=Ct-lt+1)}me=new Uint8Array(je[ye-1-ut]),ut==1&&(ee[ye-1].dispose=2),Pe=new Uint8Array(De*Qe*4),t(me,V,re,Pe,De,Qe,-Le,-Ue,0),pt=t(wt,V,re,Pe,De,Qe,-Le,-Ue,3)?1:0,pt==1?h(wt,V,re,Pe,{x:Le,y:Ue,width:De,height:Qe}):t(wt,V,re,Pe,De,Qe,-Le,-Ue,0)}else Pe=wt.slice(0);ee.push({rect:{x:Le,y:Ue,width:De,height:Qe},img:Pe,blend:pt,dispose:0})}if(se)for(ye=0;ye<ee.length;ye++){if((ht=ee[ye]).blend==1)continue;const wt=ht.rect,ge=ee[ye-1].rect,Le=Math.min(wt.x,ge.x),Ue=Math.min(wt.y,ge.y),De={x:Le,y:Ue,width:Math.max(wt.x+wt.width,ge.x+ge.width)-Le,height:Math.max(wt.y+wt.height,ge.y+ge.height)-Ue};ee[ye-1].dispose=1,ye-1!=0&&f(je,V,re,ee,ye-1,De,ne),f(je,V,re,ee,ye,De,ne)}let Me=0;if(je.length!=1)for(var qe=0;qe<ee.length;qe++){var ht;Me+=(ht=ee[qe]).rect.width*ht.rect.height}return ee}(C,T,_,O,P,G),st={},ae=[],Z=[];if(N!=0){const Ke=[];for(z=0;z<Be.length;z++)Ke.push(Be[z].img.buffer);const je=function(ne){let pe=0;for(var ee=0;ee<ne.length;ee++)pe+=ne[ee].byteLength;const ye=new Uint8Array(pe);let Pe=0;for(ee=0;ee<ne.length;ee++){const me=new Uint8Array(ne[ee]),Me=me.length;for(let qe=0;qe<Me;qe+=4){let ht=me[qe],wt=me[qe+1],ge=me[qe+2];const Le=me[qe+3];Le==0&&(ht=wt=ge=0),ye[Pe+qe]=ht,ye[Pe+qe+1]=wt,ye[Pe+qe+2]=ge,ye[Pe+qe+3]=Le}Pe+=Me}return ye.buffer}(Ke),V=y(je,N);for(z=0;z<V.plte.length;z++)ae.push(V.plte[z].est.rgba);let re=0;for(z=0;z<Be.length;z++){const se=(de=Be[z]).img.length;var K=new Uint8Array(V.inds.buffer,re>>2,se>>2);Z.push(K);const ne=new Uint8Array(V.abuf,re,se);Q&&a(de.img,de.rect.width,de.rect.height,ae,ne,K),de.img.set(ne),re+=se}}else for(xe=0;xe<Be.length;xe++){var de=Be[xe];const Ke=new Uint32Array(de.img.buffer);var ce=de.rect.width;for(U=Ke.length,K=new Uint8Array(U),Z.push(K),z=0;z<U;z++){const je=Ke[z];if(z!=0&&je==Ke[z-1])K[z]=K[z-1];else if(z>ce&&je==Ke[z-ce])K[z]=K[z-ce];else{let V=st[je];if(V==null&&(st[je]=V=ae.length,ae.push(je),ae.length>=300))break;K[z]=V}}}const ke=ae.length;for(ke<=256&&M==0&&(D=ke<=2?1:ke<=4?2:ke<=16?4:8,D=Math.max(D,A)),xe=0;xe<Be.length;xe++){(de=Be[xe]).rect.x,de.rect.y,ce=de.rect.width;const Ke=de.rect.height;let je=de.img;new Uint32Array(je.buffer);let V=4*ce,re=4;if(ke<=256&&M==0){V=Math.ceil(D*ce/8);var _e=new Uint8Array(V*Ke);const se=Z[xe];for(let ne=0;ne<Ke;ne++){z=ne*V;const pe=ne*ce;if(D==8)for(var ve=0;ve<ce;ve++)_e[z+ve]=se[pe+ve];else if(D==4)for(ve=0;ve<ce;ve++)_e[z+(ve>>1)]|=se[pe+ve]<<4-4*(1&ve);else if(D==2)for(ve=0;ve<ce;ve++)_e[z+(ve>>2)]|=se[pe+ve]<<6-2*(3&ve);else if(D==1)for(ve=0;ve<ce;ve++)_e[z+(ve>>3)]|=se[pe+ve]<<7-1*(7&ve)}je=_e,X=3,re=1}else if(ie==0&&Be.length==1){_e=new Uint8Array(ce*Ke*3);const se=ce*Ke;for(z=0;z<se;z++){const ne=3*z,pe=4*z;_e[ne]=je[pe],_e[ne+1]=je[pe+1],_e[ne+2]=je[pe+2]}je=_e,X=2,re=3,V=3*ce}de.img=je,de.bpl=V,de.bpp=re}return{ctype:X,depth:D,plte:ae,frames:Be}}function f(C,T,_,N,j,O,P){const G=Uint8Array,A=Uint32Array,M=new G(C[j-1]),Q=new A(C[j-1]),X=j+1<C.length?new G(C[j+1]):null,D=new G(C[j]),Te=new A(D.buffer);let xe=T,U=_,z=-1,ie=-1;for(let st=0;st<O.height;st++)for(let ae=0;ae<O.width;ae++){const Z=O.x+ae,K=O.y+st,de=K*T+Z,ce=Te[de];ce==0||N[j-1].dispose==0&&Q[de]==ce&&(X==null||X[4*de+3]!=0)||(Z<xe&&(xe=Z),Z>z&&(z=Z),K<U&&(U=K),K>ie&&(ie=K))}z==-1&&(xe=U=z=ie=0),P&&((1&xe)==1&&xe--,(1&U)==1&&U--),O={x:xe,y:U,width:z-xe+1,height:ie-U+1};const Be=N[j];Be.rect=O,Be.blend=1,Be.img=new Uint8Array(O.width*O.height*4),N[j-1].dispose==0?(t(M,T,_,Be.img,O.width,O.height,-O.x,-O.y,0),h(D,T,_,Be.img,O)):t(D,T,_,Be.img,O.width,O.height,-O.x,-O.y,0)}function h(C,T,_,N,j){t(C,T,_,N,j.width,j.height,-j.x,-j.y,2)}function p(C,T,_,N,j,O,P){const G=[];let A,M=[0,1,2,3,4];O!=-1?M=[O]:(T*N>5e5||_==1)&&(M=[0]),P&&(A={level:0});const Q=j9;for(var X=0;X<M.length;X++){for(let xe=0;xe<T;xe++)m(j,C,xe,N,_,M[X]);G.push(Q.deflate(j,A))}let D,Te=1e9;for(X=0;X<G.length;X++)G[X].length<Te&&(D=X,Te=G[X].length);return G[D]}function m(C,T,_,N,j,O){const P=_*N;let G=P+_;if(C[G]=O,G++,O==0)if(N<500)for(var A=0;A<N;A++)C[G+A]=T[P+A];else C.set(new Uint8Array(T.buffer,P,N),G);else if(O==1){for(A=0;A<j;A++)C[G+A]=T[P+A];for(A=j;A<N;A++)C[G+A]=T[P+A]-T[P+A-j]+256&255}else if(_==0){for(A=0;A<j;A++)C[G+A]=T[P+A];if(O==2)for(A=j;A<N;A++)C[G+A]=T[P+A];if(O==3)for(A=j;A<N;A++)C[G+A]=T[P+A]-(T[P+A-j]>>1)+256&255;if(O==4)for(A=j;A<N;A++)C[G+A]=T[P+A]-n(T[P+A-j],0,0)+256&255}else{if(O==2)for(A=0;A<N;A++)C[G+A]=T[P+A]+256-T[P+A-N]&255;if(O==3){for(A=0;A<j;A++)C[G+A]=T[P+A]+256-(T[P+A-N]>>1)&255;for(A=j;A<N;A++)C[G+A]=T[P+A]+256-(T[P+A-N]+T[P+A-j]>>1)&255}if(O==4){for(A=0;A<j;A++)C[G+A]=T[P+A]+256-n(0,T[P+A-N],0)&255;for(A=j;A<N;A++)C[G+A]=T[P+A]+256-n(T[P+A-j],T[P+A-N],T[P+A-j-N])&255}}}function y(C,T){const _=new Uint8Array(C),N=_.slice(0),j=new Uint32Array(N.buffer),O=x(N,T),P=O[0],G=O[1],A=_.length,M=new Uint8Array(A>>2);let Q;if(_.length<2e7)for(var X=0;X<A;X+=4)Q=g(P,D=_[X]*(1/255),Te=_[X+1]*(1/255),xe=_[X+2]*(1/255),U=_[X+3]*(1/255)),M[X>>2]=Q.ind,j[X>>2]=Q.est.rgba;else for(X=0;X<A;X+=4){var D=_[X]*.00392156862745098,Te=_[X+1]*(1/255),xe=_[X+2]*(1/255),U=_[X+3]*(1/255);for(Q=P;Q.left;)Q=v(Q.est,D,Te,xe,U)<=0?Q.left:Q.right;M[X>>2]=Q.ind,j[X>>2]=Q.est.rgba}return{abuf:N.buffer,inds:M,plte:G}}function x(C,T,_){_==null&&(_=1e-4);const N=new Uint32Array(C.buffer),j={i0:0,i1:C.length,bst:null,est:null,tdst:0,left:null,right:null};j.bst=I(C,j.i0,j.i1),j.est=k(j.bst);const O=[j];for(;O.length<T;){let G=0,A=0;for(var P=0;P<O.length;P++)O[P].est.L>G&&(G=O[P].est.L,A=P);if(G<_)break;const M=O[A],Q=w(C,N,M.i0,M.i1,M.est.e,M.est.eMq255);if(M.i0>=Q||M.i1<=Q){M.est.L=0;continue}const X={i0:M.i0,i1:Q,bst:null,est:null,tdst:0,left:null,right:null};X.bst=I(C,X.i0,X.i1),X.est=k(X.bst);const D={i0:Q,i1:M.i1,bst:null,est:null,tdst:0,left:null,right:null};for(D.bst={R:[],m:[],N:M.bst.N-X.bst.N},P=0;P<16;P++)D.bst.R[P]=M.bst.R[P]-X.bst.R[P];for(P=0;P<4;P++)D.bst.m[P]=M.bst.m[P]-X.bst.m[P];D.est=k(D.bst),M.left=X,M.right=D,O[A]=X,O.push(D)}for(O.sort((G,A)=>A.bst.N-G.bst.N),P=0;P<O.length;P++)O[P].ind=P;return[j,O]}function g(C,T,_,N,j){if(C.left==null)return C.tdst=function(X,D,Te,xe,U){const z=D-X[0],ie=Te-X[1],Be=xe-X[2],st=U-X[3];return z*z+ie*ie+Be*Be+st*st}(C.est.q,T,_,N,j),C;const O=v(C.est,T,_,N,j);let P=C.left,G=C.right;O>0&&(P=C.right,G=C.left);const A=g(P,T,_,N,j);if(A.tdst<=O*O)return A;const M=g(G,T,_,N,j);return M.tdst<A.tdst?M:A}function v(C,T,_,N,j){const{e:O}=C;return O[0]*T+O[1]*_+O[2]*N+O[3]*j-C.eMq}function w(C,T,_,N,j,O){for(N-=4;_<N;){for(;S(C,_,j)<=O;)_+=4;for(;S(C,N,j)>O;)N-=4;if(_>=N)break;const P=T[_>>2];T[_>>2]=T[N>>2],T[N>>2]=P,_+=4,N-=4}for(;S(C,_,j)>O;)_-=4;return _+4}function S(C,T,_){return C[T]*_[0]+C[T+1]*_[1]+C[T+2]*_[2]+C[T+3]*_[3]}function I(C,T,_){const N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],j=[0,0,0,0],O=_-T>>2;for(let P=T;P<_;P+=4){const G=C[P]*.00392156862745098,A=C[P+1]*(1/255),M=C[P+2]*(1/255),Q=C[P+3]*(1/255);j[0]+=G,j[1]+=A,j[2]+=M,j[3]+=Q,N[0]+=G*G,N[1]+=G*A,N[2]+=G*M,N[3]+=G*Q,N[5]+=A*A,N[6]+=A*M,N[7]+=A*Q,N[10]+=M*M,N[11]+=M*Q,N[15]+=Q*Q}return N[4]=N[1],N[8]=N[2],N[9]=N[6],N[12]=N[3],N[13]=N[7],N[14]=N[11],{R:N,m:j,N:O}}function k(C){const{R:T}=C,{m:_}=C,{N}=C,j=_[0],O=_[1],P=_[2],G=_[3],A=N==0?0:1/N,M=[T[0]-j*j*A,T[1]-j*O*A,T[2]-j*P*A,T[3]-j*G*A,T[4]-O*j*A,T[5]-O*O*A,T[6]-O*P*A,T[7]-O*G*A,T[8]-P*j*A,T[9]-P*O*A,T[10]-P*P*A,T[11]-P*G*A,T[12]-G*j*A,T[13]-G*O*A,T[14]-G*P*A,T[15]-G*G*A],Q=M,X=R;let D=[Math.random(),Math.random(),Math.random(),Math.random()],Te=0,xe=0;if(N!=0)for(let z=0;z<16&&(D=X.multVec(Q,D),xe=Math.sqrt(X.dot(D,D)),D=X.sml(1/xe,D),!(z!=0&&Math.abs(xe-Te)<1e-9));z++)Te=xe;const U=[j*A,O*A,P*A,G*A];return{Cov:M,q:U,e:D,L:Te,eMq255:X.dot(X.sml(255,U),D),eMq:X.dot(D,U),rgba:(Math.round(255*U[3])<<24|Math.round(255*U[2])<<16|Math.round(255*U[1])<<8|Math.round(255*U[0])<<0)>>>0}}var R={multVec:(C,T)=>[C[0]*T[0]+C[1]*T[1]+C[2]*T[2]+C[3]*T[3],C[4]*T[0]+C[5]*T[1]+C[6]*T[2]+C[7]*T[3],C[8]*T[0]+C[9]*T[1]+C[10]*T[2]+C[11]*T[3],C[12]*T[0]+C[13]*T[1]+C[14]*T[2]+C[15]*T[3]],dot:(C,T)=>C[0]*T[0]+C[1]*T[1]+C[2]*T[2]+C[3]*T[3],sml:(C,T)=>[C*T[0],C*T[1],C*T[2],C*T[3]]};Li.encode=function(T,_,N,j,O,P,G){j==null&&(j=0),G==null&&(G=!1);const A=d(T,_,N,j,[!1,!1,!1,0,G,!1]);return u(A,-1),l(A,_,N,O,P)},Li.encodeLL=function(T,_,N,j,O,P,G,A){const M={ctype:0+(j==1?0:2)+(O==0?0:4),depth:P,frames:[]},Q=(j+O)*P,X=Q*_;for(let D=0;D<T.length;D++)M.frames.push({rect:{x:0,y:0,width:_,height:N},img:new Uint8Array(T[D]),blend:0,dispose:1,bpp:Math.ceil(Q/8),bpl:Math.ceil(X/8)});return u(M,0,!0),l(M,_,N,G,A)},Li.encode.compress=d,Li.encode.dither=a,Li.quantize=y,Li.quantize.getKDtree=x,Li.quantize.getNearest=g})();const SA={toArrayBuffer(t,e){const n=t.width,r=t.height,s=n<<2,i=t.getContext("2d").getImageData(0,0,n,r),o=new Uint32Array(i.data.buffer),a=(32*n+31)/32<<2,l=a*r,u=122+l,d=new ArrayBuffer(u),f=new DataView(d),h=1<<20;let p,m,y,x,g=h,v=0,w=0,S=0;function I(C){f.setUint16(w,C,!0),w+=2}function k(C){f.setUint32(w,C,!0),w+=4}function R(C){w+=C}I(19778),k(u),R(4),k(122),k(108),k(n),k(-r>>>0),I(1),I(32),k(3),k(l),k(2835),k(2835),R(8),k(16711680),k(65280),k(255),k(4278190080),k(1466527264),function C(){for(;v<r&&g>0;){for(x=122+v*a,p=0;p<s;)g--,m=o[S++],y=m>>>24,f.setUint32(x+p,m<<8|y),p+=4;v++}S<o.length?(g=h,setTimeout(C,SA._dly)):e(d)}()},toBlob(t,e){this.toArrayBuffer(t,n=>{e(new Blob([n],{type:"image/bmp"}))})},_dly:9};var Ds={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},I9={[Ds.CHROME]:16384,[Ds.FIREFOX]:11180,[Ds.DESKTOP_SAFARI]:16384,[Ds.IE]:8192,[Ds.IOS]:4096,[Ds.ETC]:8192};const ov=typeof window<"u",_A=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,um=ov&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),D9=(ov||_A)&&(um&&um.getOriginalSymbol(window,"File")||typeof File<"u"&&File),TA=(ov||_A)&&(um&&um.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function av(t,e,n=Date.now()){return new Promise(r=>{const s=t.split(","),i=s[0].match(/:(.*?);/)[1],o=globalThis.atob(s[1]);let a=o.length;const l=new Uint8Array(a);for(;a--;)l[a]=o.charCodeAt(a);const u=new Blob([l],{type:i});u.name=e,u.lastModified=n,r(u)})}function CA(t){return new Promise((e,n)=>{const r=new TA;r.onload=()=>e(r.result),r.onerror=s=>n(s),r.readAsDataURL(t)})}function EA(t){return new Promise((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=s=>n(s),r.src=t})}function Nl(){if(Nl.cachedResult!==void 0)return Nl.cachedResult;let t=Ds.ETC;const{userAgent:e}=navigator;return/Chrom(e|ium)/i.test(e)?t=Ds.CHROME:/iP(ad|od|hone)/i.test(e)&&/WebKit/i.test(e)?t=Ds.IOS:/Safari/i.test(e)?t=Ds.DESKTOP_SAFARI:/Firefox/i.test(e)?t=Ds.FIREFOX:(/MSIE/i.test(e)||document.documentMode)&&(t=Ds.IE),Nl.cachedResult=t,Nl.cachedResult}function NA(t,e){const n=Nl(),r=I9[n];let s=t,i=e,o=s*i;const a=s>i?i/s:s/i;for(;o>r*r;){const l=(r+s)/2,u=(r+i)/2;l<u?(i=u,s=u*a):(i=l*a,s=l),o=s*i}return{width:s,height:i}}function Ag(t,e){let n,r;try{if(n=new OffscreenCanvas(t,e),r=n.getContext("2d"),r===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{n=document.createElement("canvas"),r=n.getContext("2d")}return n.width=t,n.height=e,[n,r]}function jA(t,e){const{width:n,height:r}=NA(t.width,t.height),[s,i]=Ag(n,r);return e&&/jpe?g/.test(e)&&(i.fillStyle="white",i.fillRect(0,0,s.width,s.height)),i.drawImage(t,0,0,s.width,s.height),s}function mp(){return mp.cachedResult!==void 0||(mp.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),mp.cachedResult}function dm(t,e={}){return new Promise(function(n,r){let s,i;var o=function(){try{return i=jA(s,e.fileType||t.type),n([s,i])}catch(l){return r(l)}},a=function(l){try{var u=function(d){try{throw d}catch(f){return r(f)}};try{let d;return CA(t).then(function(f){try{return d=f,EA(d).then(function(h){try{return s=h,function(){try{return o()}catch(p){return r(p)}}()}catch(p){return u(p)}},u)}catch(h){return u(h)}},u)}catch(d){u(d)}}catch(d){return r(d)}};try{if(mp()||[Ds.DESKTOP_SAFARI,Ds.MOBILE_SAFARI].includes(Nl()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(t).then(function(l){try{return s=l,o()}catch{return a()}},a)}catch{a()}})}function fm(t,e,n,r,s=1){return new Promise(function(i,o){let a;if(e==="image/png"){let f,h,p;return f=t.getContext("2d"),{data:h}=f.getImageData(0,0,t.width,t.height),p=Li.encode([h.buffer],t.width,t.height,4096*s),a=new Blob([p],{type:e}),a.name=n,a.lastModified=r,l.call(this)}{let f=function(){return l.call(this)};var u=f;if(e==="image/bmp")return new Promise(h=>SA.toBlob(t,h)).then((function(h){try{return a=h,a.name=n,a.lastModified=r,f.call(this)}catch(p){return o(p)}}).bind(this),o);{let h=function(){return f.call(this)};var d=h;if(typeof OffscreenCanvas=="function"&&t instanceof OffscreenCanvas)return t.convertToBlob({type:e,quality:s}).then((function(p){try{return a=p,a.name=n,a.lastModified=r,h.call(this)}catch(m){return o(m)}}).bind(this),o);{let p;return p=t.toDataURL(e,s),av(p,n,r).then((function(m){try{return a=m,h.call(this)}catch(y){return o(y)}}).bind(this),o)}}}function l(){return i(a)}})}function so(t){t.width=0,t.height=0}function Kc(){return new Promise(function(t,e){let n,r,s,i;return Kc.cachedResult!==void 0?t(Kc.cachedResult):av("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(o){try{return n=o,dm(n).then(function(a){try{return r=a[1],fm(r,n.type,n.name,n.lastModified).then(function(l){try{return s=l,so(r),dm(s).then(function(u){try{return i=u[0],Kc.cachedResult=i.width===1&&i.height===2,t(Kc.cachedResult)}catch(d){return e(d)}},e)}catch(u){return e(u)}},e)}catch(l){return e(l)}},e)}catch(a){return e(a)}},e)})}function IA(t){return new Promise((e,n)=>{const r=new TA;r.onload=s=>{const i=new DataView(s.target.result);if(i.getUint16(0,!1)!=65496)return e(-2);const o=i.byteLength;let a=2;for(;a<o;){if(i.getUint16(a+2,!1)<=8)return e(-1);const l=i.getUint16(a,!1);if(a+=2,l==65505){if(i.getUint32(a+=2,!1)!=1165519206)return e(-1);const u=i.getUint16(a+=6,!1)==18761;a+=i.getUint32(a+4,u);const d=i.getUint16(a,u);a+=2;for(let f=0;f<d;f++)if(i.getUint16(a+12*f,u)==274)return e(i.getUint16(a+12*f+8,u))}else{if((65280&l)!=65280)break;a+=i.getUint16(a,!1)}}return e(-1)},r.onerror=s=>n(s),r.readAsArrayBuffer(t)})}function DA(t,e){const{width:n}=t,{height:r}=t,{maxWidthOrHeight:s}=e;let i,o=t;return isFinite(s)&&(n>s||r>s)&&([o,i]=Ag(n,r),n>r?(o.width=s,o.height=r/n*s):(o.width=n/r*s,o.height=s),i.drawImage(t,0,0,o.width,o.height),so(t)),o}function AA(t,e){const{width:n}=t,{height:r}=t,[s,i]=Ag(n,r);switch(e>4&&e<9?(s.width=r,s.height=n):(s.width=n,s.height=r),e){case 2:i.transform(-1,0,0,1,n,0);break;case 3:i.transform(-1,0,0,-1,n,r);break;case 4:i.transform(1,0,0,-1,0,r);break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,r,0);break;case 7:i.transform(0,-1,-1,0,r,n);break;case 8:i.transform(0,-1,1,0,0,n)}return i.drawImage(t,0,0,n,r),so(t),s}function S_(t,e,n=0){return new Promise(function(r,s){let i,o,a,l,u,d,f,h,p,m,y,x,g,v,w,S,I,k,R,C;function T(N=5){if(e.signal&&e.signal.aborted)throw e.signal.reason;i+=N,e.onProgress(Math.min(i,100))}function _(N){if(e.signal&&e.signal.aborted)throw e.signal.reason;i=Math.min(Math.max(N,i),100),e.onProgress(i)}return i=n,o=e.maxIteration||10,a=1024*e.maxSizeMB*1024,T(),dm(t,e).then((function(N){try{return[,l]=N,T(),u=DA(l,e),T(),new Promise(function(j,O){var P;if(!(P=e.exifOrientation))return IA(t).then((function(A){try{return P=A,G.call(this)}catch(M){return O(M)}}).bind(this),O);function G(){return j(P)}return G.call(this)}).then((function(j){try{return d=j,T(),Kc().then((function(O){try{return f=O?u:AA(u,d),T(),h=e.initialQuality||1,p=e.fileType||t.type,fm(f,p,t.name,t.lastModified,h).then((function(P){try{{let Q=function(){if(o--&&(w>a||w>g)){let D,Te;return D=C?.95*R.width:R.width,Te=C?.95*R.height:R.height,[I,k]=Ag(D,Te),k.drawImage(R,0,0,D,Te),h*=p==="image/png"?.85:.95,fm(I,p,t.name,t.lastModified,h).then(function(xe){try{return S=xe,so(R),R=I,w=S.size,_(Math.min(99,Math.floor((v-w)/(v-a)*100))),Q}catch(U){return s(U)}},s)}return[1]},X=function(){return so(R),so(I),so(u),so(f),so(l),_(100),r(S)};var A=Q,M=X;if(m=P,T(),y=m.size>a,x=m.size>t.size,!y&&!x)return _(100),r(m);var G;return g=t.size,v=m.size,w=v,R=f,C=!e.alwaysKeepResolution&&y,(G=(function(D){for(;D;){if(D.then)return void D.then(G,s);try{if(D.pop){if(D.length)return D.pop()?X.call(this):D;D=Q}else D=D.call(this)}catch(Te){return s(Te)}}}).bind(this))(Q)}}catch(Q){return s(Q)}}).bind(this),s)}catch(P){return s(P)}}).bind(this),s)}catch(O){return s(O)}}).bind(this),s)}catch(j){return s(j)}}).bind(this),s)})}const A9=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let ey;function M9(t,e){return new Promise((n,r)=>{ey||(ey=function(o){const a=[];return typeof o=="function"?a.push(`(${o})()`):a.push(o),URL.createObjectURL(new Blob(a))}(A9));const s=new Worker(ey);s.addEventListener("message",function(o){if(e.signal&&e.signal.aborted)s.terminate();else if(o.data.progress===void 0){if(o.data.error)return r(new Error(o.data.error)),void s.terminate();n(o.data.file),s.terminate()}else e.onProgress(o.data.progress)}),s.addEventListener("error",r),e.signal&&e.signal.addEventListener("abort",()=>{r(e.signal.reason),s.terminate()}),s.postMessage({file:t,imageCompressionLibUrl:e.libURL,options:{...e,onProgress:void 0,signal:void 0}})})}function is(t,e){return new Promise(function(n,r){let s,i,o,a,l,u;if(s={...e},o=0,{onProgress:a}=s,s.maxSizeMB=s.maxSizeMB||Number.POSITIVE_INFINITY,l=typeof s.useWebWorker!="boolean"||s.useWebWorker,delete s.useWebWorker,s.onProgress=p=>{o=p,typeof a=="function"&&a(o)},!(t instanceof Blob||t instanceof D9))return r(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(t.type))return r(new Error("The file given is not an image"));if(u=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!l||typeof Worker!="function"||u)return S_(t,s).then((function(p){try{return i=p,h.call(this)}catch(m){return r(m)}}).bind(this),r);var d=(function(){try{return h.call(this)}catch(p){return r(p)}}).bind(this),f=function(p){try{return S_(t,s).then(function(m){try{return i=m,d()}catch(y){return r(y)}},r)}catch(m){return r(m)}};try{return s.libURL=s.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",M9(t,s).then(function(p){try{return i=p,d()}catch{return f()}},f)}catch{f()}function h(){try{i.name=t.name,i.lastModified=t.lastModified}catch{}try{s.preserveExif&&t.type==="image/jpeg"&&(!s.fileType||s.fileType&&s.fileType===t.type)&&(i=kA(t,i))}catch{}return n(i)}})}is.getDataUrlFromFile=CA,is.getFilefromDataUrl=av,is.loadImage=EA,is.drawImageInCanvas=jA,is.drawFileInCanvas=dm,is.canvasToFile=fm,is.getExifOrientation=IA,is.handleMaxWidthOrHeight=DA,is.followExifOrientation=AA,is.cleanupCanvasMemory=so,is.isAutoOrientationInBrowser=Kc,is.approximateBelowMaximumCanvasSizeOfBrowser=NA,is.copyExifWithoutOrientation=kA,is.getBrowserName=Nl,is.version="2.0.2";function Jr(t){this.content=t}Jr.prototype={constructor:Jr,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,s=r.find(t),i=r.content.slice();return s==-1?i.push(n||t,e):(i[s+1]=e,n&&(i[s]=n)),new Jr(i)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new Jr(n)},addToStart:function(t,e){return new Jr([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new Jr(n)},addBefore:function(t,e,n){var r=this.remove(e),s=r.content.slice(),i=r.find(t);return s.splice(i==-1?s.length:i,0,e,n),new Jr(s)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=Jr.from(t),t.size?new Jr(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Jr.from(t),t.size?new Jr(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Jr.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};Jr.from=function(t){if(t instanceof Jr)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new Jr(e)};function MA(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let s=t.child(r),i=e.child(r);if(s==i){n+=s.nodeSize;continue}if(!s.sameMarkup(i))return n;if(s.isText&&s.text!=i.text){for(let o=0;s.text[o]==i.text[o];o++)n++;return n}if(s.content.size||i.content.size){let o=MA(s.content,i.content,n+1);if(o!=null)return o}n+=s.nodeSize}}function RA(t,e,n,r){for(let s=t.childCount,i=e.childCount;;){if(s==0||i==0)return s==i?null:{a:n,b:r};let o=t.child(--s),a=e.child(--i),l=o.nodeSize;if(o==a){n-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let u=0,d=Math.min(o.text.length,a.text.length);for(;u<d&&o.text[o.text.length-u-1]==a.text[a.text.length-u-1];)u++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let u=RA(o.content,a.content,n-1,r-1);if(u)return u}n-=l,r-=l}}class kt{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,s=0,i){for(let o=0,a=0;a<n;o++){let l=this.content[o],u=a+l.nodeSize;if(u>e&&r(l,s+a,i||null,o)!==!1&&l.content.size){let d=a+1;l.nodesBetween(Math.max(0,e-d),Math.min(l.content.size,n-d),r,s+d)}a=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,s){let i="",o=!0;return this.nodesBetween(e,n,(a,l)=>{let u=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?s?typeof s=="function"?s(a):s:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&u||a.isTextblock)&&r&&(o?o=!1:i+=r),i+=u},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,s=this.content.slice(),i=0;for(n.isText&&n.sameMarkup(r)&&(s[s.length-1]=n.withText(n.text+r.text),i=1);i<e.content.length;i++)s.push(e.content[i]);return new kt(s,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],s=0;if(n>e)for(let i=0,o=0;o<n;i++){let a=this.content[i],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),r.push(a),s+=a.nodeSize),o=l}return new kt(r,s)}cutByIndex(e,n){return e==n?kt.empty:e==0&&n==this.content.length?this:new kt(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let s=this.content.slice(),i=this.size+n.nodeSize-r.nodeSize;return s[e]=n,new kt(s,i)}addToStart(e){return new kt([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new kt(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let s=this.content[n];e(s,r,n),r+=s.nodeSize}}findDiffStart(e,n=0){return MA(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return RA(this,e,n,r)}findIndex(e){if(e==0)return Ih(0,e);if(e==this.size)return Ih(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let s=this.child(n),i=r+s.nodeSize;if(i>=e)return i==e?Ih(n+1,i):Ih(n,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return kt.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new kt(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return kt.empty;let n,r=0;for(let s=0;s<e.length;s++){let i=e[s];r+=i.nodeSize,s&&i.isText&&e[s-1].sameMarkup(i)?(n||(n=e.slice(0,s)),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new kt(n||e,r)}static from(e){if(!e)return kt.empty;if(e instanceof kt)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new kt([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}kt.empty=new kt([],0);const ty={index:0,offset:0};function Ih(t,e){return ty.index=t,ty.offset=e,ty}function hm(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!hm(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!hm(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let On=class j1{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let s=0;s<e.length;s++){let i=e[s];if(this.eq(i))return e;if(this.type.excludes(i.type))n||(n=e.slice(0,s));else{if(i.type.excludes(this.type))return e;!r&&i.type.rank>this.type.rank&&(n||(n=e.slice(0,s)),n.push(this),r=!0),n&&n.push(i)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&hm(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let s=r.create(n.attrs);return r.checkAttrs(s.attrs),s}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return j1.none;if(e instanceof j1)return[e];let n=e.slice();return n.sort((r,s)=>r.type.rank-s.type.rank),n}};On.none=[];class pm extends Error{}class Lt{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=PA(this.content,e+this.openStart,n);return r&&new Lt(r,this.openStart,this.openEnd)}removeBetween(e,n){return new Lt(OA(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return Lt.empty;let r=n.openStart||0,s=n.openEnd||0;if(typeof r!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Lt(kt.fromJSON(e,n.content),r,s)}static maxOpen(e,n=!0){let r=0,s=0;for(let i=e.firstChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.firstChild)r++;for(let i=e.lastChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.lastChild)s++;return new Lt(e,r,s)}}Lt.empty=new Lt(kt.empty,0,0);function OA(t,e,n){let{index:r,offset:s}=t.findIndex(e),i=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(s==e||i.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,i.copy(OA(i.content,e-s-1,n-s-1)))}function PA(t,e,n,r){let{index:s,offset:i}=t.findIndex(e),o=t.maybeChild(s);if(i==e||o.isText)return r&&!r.canReplace(s,s,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=PA(o.content,e-i-1,n,o);return a&&t.replaceChild(s,o.copy(a))}function R9(t,e,n){if(n.openStart>t.depth)throw new pm("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new pm("Inconsistent open depths");return LA(t,e,n,0)}function LA(t,e,n,r){let s=t.index(r),i=t.node(r);if(s==e.index(r)&&r<t.depth-n.openStart){let o=LA(t,e,n,r+1);return i.copy(i.content.replaceChild(s,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,a=o.content;return zl(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=O9(n,t);return zl(i,zA(t,o,a,e,r))}else return zl(i,mm(t,e,r))}function $A(t,e){if(!e.type.compatibleContent(t.type))throw new pm("Cannot join "+e.type.name+" onto "+t.type.name)}function I1(t,e,n){let r=t.node(n);return $A(r,e.node(n)),r}function $l(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function jd(t,e,n,r){let s=(e||t).node(n),i=0,o=e?e.index(n):s.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&($l(t.nodeAfter,r),i++));for(let a=i;a<o;a++)$l(s.child(a),r);e&&e.depth==n&&e.textOffset&&$l(e.nodeBefore,r)}function zl(t,e){return t.type.checkContent(e),t.copy(e)}function zA(t,e,n,r,s){let i=t.depth>s&&I1(t,e,s+1),o=r.depth>s&&I1(n,r,s+1),a=[];return jd(null,t,s,a),i&&o&&e.index(s)==n.index(s)?($A(i,o),$l(zl(i,zA(t,e,n,r,s+1)),a)):(i&&$l(zl(i,mm(t,e,s+1)),a),jd(e,n,s,a),o&&$l(zl(o,mm(n,r,s+1)),a)),jd(r,null,s,a),new kt(a)}function mm(t,e,n){let r=[];if(jd(null,t,n,r),t.depth>n){let s=I1(t,e,n+1);$l(zl(s,mm(t,e,n+1)),r)}return jd(e,null,n,r),new kt(r)}function O9(t,e){let n=e.depth-t.openStart,s=e.node(n).copy(t.content);for(let i=n-1;i>=0;i--)s=e.node(i).copy(kt.from(s));return{start:s.resolveNoCache(t.openStart+n),end:s.resolveNoCache(s.content.size-t.openEnd-n)}}class vf{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],s=e.child(n);return r?e.child(n).cut(r):s}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],s=n==0?0:this.path[n*3-1]+1;for(let i=0;i<e;i++)s+=r.child(i).nodeSize;return s}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return On.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),s=e.maybeChild(n);if(!r){let a=r;r=s,s=a}let i=r.marks;for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!s||!i[o].isInSet(s.marks))&&(i=i[o--].removeFromSet(i));return i}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,s=e.parent.maybeChild(e.index());for(var i=0;i<r.length;i++)r[i].type.spec.inclusive===!1&&(!s||!r[i].isInSet(s.marks))&&(r=r[i--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new gm(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],s=0,i=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(i),u=i-l;if(r.push(o,a,s+l),!u||(o=o.child(a),o.isText))break;i=u-1,s+=l+1}return new vf(n,r,i)}static resolveCached(e,n){let r=__.get(e);if(r)for(let i=0;i<r.elts.length;i++){let o=r.elts[i];if(o.pos==n)return o}else __.set(e,r=new P9);let s=r.elts[r.i]=vf.resolve(e,n);return r.i=(r.i+1)%L9,s}}class P9{constructor(){this.elts=[],this.i=0}}const L9=12,__=new WeakMap;class gm{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const $9=Object.create(null);let Fo=class D1{constructor(e,n,r,s=On.none){this.type=e,this.attrs=n,this.marks=s,this.content=r||kt.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,s=0){this.content.nodesBetween(e,n,r,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,s){return this.content.textBetween(e,n,r,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&hm(this.attrs,n||e.defaultAttrs||$9)&&On.sameSet(this.marks,r||On.none)}copy(e=null){return e==this.content?this:new D1(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new D1(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return Lt.empty;let s=this.resolve(e),i=this.resolve(n),o=r?0:s.sharedDepth(n),a=s.start(o),u=s.node(o).content.cut(s.pos-a,i.pos-a);return new Lt(u,s.depth-o,i.depth-o)}replace(e,n,r){return R9(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:s}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(s==e||n.isText)return n;e-=s+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let s=this.content.child(n-1);return{node:s,index:n-1,offset:r-s.nodeSize}}resolve(e){return vf.resolveCached(this,e)}resolveNoCache(e){return vf.resolve(this,e)}rangeHasMark(e,n,r){let s=!1;return n>e&&this.nodesBetween(e,n,i=>(r.isInSet(i.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),FA(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=kt.empty,s=0,i=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,s,i),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=s;l<i;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,s){if(s&&!this.type.allowsMarks(s))return!1;let i=this.contentMatchAt(e).matchType(r),o=i&&i.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=On.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!On.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let s=kt.fromJSON(e,n.content),i=e.nodeType(n.type).create(n.attrs,s,r);return i.type.checkAttrs(i.attrs),i}};Fo.prototype.text=void 0;class ym extends Fo{constructor(e,n,r,s){if(super(e,n,null,s),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):FA(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new ym(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new ym(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function FA(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class ql{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new z9(e,n);if(r.next==null)return ql.empty;let s=BA(r);r.next&&r.err("Unexpected trailing text");let i=K9(W9(s));return G9(i,r),i}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let s=this;for(let i=n;s&&i<r;i++)s=s.matchType(e.child(i).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let s=[this];function i(o,a){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return kt.from(a.map(u=>u.createAndFill()));for(let u=0;u<o.next.length;u++){let{type:d,next:f}=o.next[u];if(!(d.isText||d.hasRequiredAttrs())&&s.indexOf(f)==-1){s.push(f);let h=i(f,a.concat(d));if(h)return h}}return null}return i(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let s=r.shift(),i=s.match;if(i.matchType(e)){let o=[];for(let a=s;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<i.next.length;o++){let{type:a,next:l}=i.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!s.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:s}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let s=0;s<r.next.length;s++)e.indexOf(r.next[s].next)==-1&&n(r.next[s].next)}return n(this),e.map((r,s)=>{let i=s+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)i+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return i}).join(`
`)}}ql.empty=new ql(!0);class z9{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function BA(t){let e=[];do e.push(F9(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function F9(t){let e=[];do e.push(B9(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function B9(t){let e=V9(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=U9(t,e);else break;return e}function T_(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function U9(t,e){let n=T_(t),r=n;return t.eat(",")&&(t.next!="}"?r=T_(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function H9(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let s=[];for(let i in n){let o=n[i];o.isInGroup(e)&&s.push(o)}return s.length==0&&t.err("No node type or group '"+e+"' found"),s}function V9(t){if(t.eat("(")){let e=BA(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=H9(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function W9(t){let e=[[]];return s(i(t,0),n()),e;function n(){return e.push([])-1}function r(o,a,l){let u={term:l,to:a};return e[o].push(u),u}function s(o,a){o.forEach(l=>l.to=a)}function i(o,a){if(o.type=="choice")return o.exprs.reduce((l,u)=>l.concat(i(u,a)),[]);if(o.type=="seq")for(let l=0;;l++){let u=i(o.exprs[l],a);if(l==o.exprs.length-1)return u;s(u,a=n())}else if(o.type=="star"){let l=n();return r(a,l),s(i(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return s(i(o.expr,a),l),s(i(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(i(o.expr,a));if(o.type=="range"){let l=a;for(let u=0;u<o.min;u++){let d=n();s(i(o.expr,l),d),l=d}if(o.max==-1)s(i(o.expr,l),l);else for(let u=o.min;u<o.max;u++){let d=n();r(l,d),s(i(o.expr,l),d),l=d}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function UA(t,e){return e-t}function C_(t,e){let n=[];return r(e),n.sort(UA);function r(s){let i=t[s];if(i.length==1&&!i[0].term)return r(i[0].to);n.push(s);for(let o=0;o<i.length;o++){let{term:a,to:l}=i[o];!a&&n.indexOf(l)==-1&&r(l)}}}function K9(t){let e=Object.create(null);return n(C_(t,0));function n(r){let s=[];r.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let u;for(let d=0;d<s.length;d++)s[d][0]==a&&(u=s[d][1]);C_(t,l).forEach(d=>{u||s.push([a,u=[]]),u.indexOf(d)==-1&&u.push(d)})})});let i=e[r.join(",")]=new ql(r.indexOf(t.length-1)>-1);for(let o=0;o<s.length;o++){let a=s[o][1].sort(UA);i.next.push({type:s[o][0],next:e[a.join(",")]||n(a)})}return i}}function G9(t,e){for(let n=0,r=[t];n<r.length;n++){let s=r[n],i=!s.validEnd,o=[];for(let a=0;a<s.next.length;a++){let{type:l,next:u}=s.next[a];o.push(l.name),i&&!(l.isText||l.hasRequiredAttrs())&&(i=!1),r.indexOf(u)==-1&&r.push(u)}i&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function HA(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function VA(t,e){let n=Object.create(null);for(let r in t){let s=e&&e[r];if(s===void 0){let i=t[r];if(i.hasDefault)s=i.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=s}return n}function WA(t,e,n,r){for(let s in e)if(!(s in t))throw new RangeError(`Unsupported attribute ${s} for ${n} of type ${s}`);for(let s in t){let i=t[s];i.validate&&i.validate(e[s])}}function KA(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new J9(t,r,e[r]);return n}let E_=class GA{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=KA(e,r.attrs),this.defaultAttrs=HA(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ql.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:VA(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Fo(this,this.computeAttrs(e),kt.from(n),On.setFrom(r))}createChecked(e=null,n,r){return n=kt.from(n),this.checkContent(n),new Fo(this,this.computeAttrs(e),n,On.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=kt.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let s=this.contentMatch.matchFragment(n),i=s&&s.fillBefore(kt.empty,!0);return i?new Fo(this,e,n.append(i),On.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){WA(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:On.none:e}static compile(e,n){let r=Object.create(null);e.forEach((i,o)=>r[i]=new GA(i,n,o));let s=n.spec.topNode||"doc";if(!r[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function q9(t,e,n){let r=n.split("|");return s=>{let i=s===null?"null":typeof s;if(r.indexOf(i)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${i}`)}}class J9{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?q9(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class Mg{constructor(e,n,r,s){this.name=e,this.rank=n,this.schema=r,this.spec=s,this.attrs=KA(e,s.attrs),this.excluded=null;let i=HA(this.attrs);this.instance=i?new On(this,i):null}create(e=null){return!e&&this.instance?this.instance:new On(this,VA(this.attrs,e))}static compile(e,n){let r=Object.create(null),s=0;return e.forEach((i,o)=>r[i]=new Mg(i,s++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){WA(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}let qA=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let s in e)n[s]=e[s];n.nodes=Jr.from(e.nodes),n.marks=Jr.from(e.marks||{}),this.nodes=E_.compile(this.spec.nodes,this),this.marks=Mg.compile(this.spec.marks,this);let r=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let i=this.nodes[s],o=i.spec.content||"",a=i.spec.marks;if(i.contentMatch=r[o]||(r[o]=ql.parse(o,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=a=="_"?null:a?N_(this,a.split(" ")):a==""||!i.inlineContent?[]:null}for(let s in this.marks){let i=this.marks[s],o=i.spec.excludes;i.excluded=o==null?[i]:o==""?[]:N_(this,o.split(" "))}this.nodeFromJSON=s=>Fo.fromJSON(this,s),this.markFromJSON=s=>On.fromJSON(this,s),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,s){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof E_){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,s)}text(e,n){let r=this.nodes.text;return new ym(r,r.defaultAttrs,e,On.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}};function N_(t,e){let n=[];for(let r=0;r<e.length;r++){let s=e[r],i=t.marks[s],o=i;if(i)n.push(i);else for(let a in t.marks){let l=t.marks[a];(s=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(s)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function Y9(t){return t.tag!=null}function X9(t){return t.style!=null}class Ra{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(s=>{if(Y9(s))this.tags.push(s);else if(X9(s)){let i=/[^=]*/.exec(s.style)[0];r.indexOf(i)<0&&r.push(i),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let i=e.nodes[s.node];return i.contentMatch.matchType(i)})}parse(e,n={}){let r=new I_(this,n,!1);return r.addAll(e,On.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new I_(this,n,!0);return r.addAll(e,On.none,n.from,n.to),Lt.maxOpen(r.finish())}matchTag(e,n,r){for(let s=r?this.tags.indexOf(r)+1:0;s<this.tags.length;s++){let i=this.tags[s];if(eH(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||n.matchesContext(i.context))){if(i.getAttrs){let o=i.getAttrs(e);if(o===!1)continue;i.attrs=o||void 0}return i}}}matchStyle(e,n,r,s){for(let i=s?this.styles.indexOf(s)+1:0;i<this.styles.length;i++){let o=this.styles[i],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(s){let i=s.priority==null?50:s.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<i)break}n.splice(o,0,s)}for(let s in e.marks){let i=e.marks[s].spec.parseDOM;i&&i.forEach(o=>{r(o=D_(o)),o.mark||o.ignore||o.clearMark||(o.mark=s)})}for(let s in e.nodes){let i=e.nodes[s].spec.parseDOM;i&&i.forEach(o=>{r(o=D_(o)),o.node||o.ignore||o.mark||(o.node=s)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Ra(e,Ra.schemaRules(e)))}}const JA={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Q9={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},YA={ol:!0,ul:!0},kf=1,A1=2,Id=4;function j_(t,e,n){return e!=null?(e?kf:0)|(e==="full"?A1:0):t&&t.whitespace=="pre"?kf|A1:n&~Id}class Dh{constructor(e,n,r,s,i,o){this.type=e,this.attrs=n,this.marks=r,this.solid=s,this.options=o,this.content=[],this.activeMarks=On.none,this.match=i||(o&Id?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(kt.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,s;return(s=r.findWrapping(e.type))?(this.match=r,s):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&kf)){let r=this.content[this.content.length-1],s;if(r&&r.isText&&(s=/[ \t\r\n\u000c]+$/.exec(r.text))){let i=r;r.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-s[0].length))}}let n=kt.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(kt.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!JA.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class I_{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let s=n.topNode,i,o=j_(null,n.preserveWhitespace,0)|(r?Id:0);s?i=new Dh(s.type,s.attrs,On.none,!0,n.topMatch||s.type.contentMatch,o):r?i=new Dh(null,null,On.none,!0,null,o):i=new Dh(e.schema.topNodeType,null,On.none,!0,null,o),this.nodes=[i],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,s=this.top,i=s.options&A1?"full":this.localPreserveWS||(s.options&kf)>0,{schema:o}=this.parser;if(i==="full"||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(i)if(i==="full")r=r.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=r.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),n,!0),a[l]&&this.insertNode(o.text(a[l]),n,!/\S/.test(a[l]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let a=s.content[s.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(o.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let s=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;YA.hasOwnProperty(o)&&this.parser.normalizeLists&&Z9(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:Q9.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let u,d=this.needsBlock;if(JA.hasOwnProperty(o))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),u=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let f=l&&l.skip?n:this.readStyles(e,n);f&&this.addAll(e,f),u&&this.sync(i),this.needsBlock=d}else{let u=this.readStyles(e,n);u&&this.addElementByRule(e,l,u,l.consuming===!1?a:void 0)}this.localPreserveWS=s}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let i=this.parser.matchedStyles[s],o=r.getPropertyValue(i);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(i,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(u=>!l.clearMark(u)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,s){let i,o;if(n.node)if(o=this.parser.schema.nodes[n.node],o.isLeaf)this.insertNode(o.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,n.attrs||null,r,n.preserveWhitespace);l&&(i=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(s)this.addElement(e,r,s);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}i&&this.sync(a)&&this.open--}addAll(e,n,r,s){let i=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=s==null?null:e.childNodes[s];o!=a;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o,n);this.findAtPoint(e,i)}findPlace(e,n,r){let s,i;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],u=l.findWrapping(e);if(u&&(!s||s.length>u.length+a)&&(s=u,i=l,!u.length))break;if(l.solid){if(r)break;a+=2}}if(!s)return null;this.sync(i);for(let o=0;o<s.length;o++)n=this.enterInner(s[o],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(n=this.enterInner(i,null,n))}let s=this.findPlace(e,n,r);if(s){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let o=On.none;for(let a of s.concat(e.marks))(i.type?i.type.allowsMarkType(a.type):A_(a.type,e.type))&&(o=a.addToSet(o));return i.content.push(e.mark(o)),!0}return!1}enter(e,n,r,s){let i=this.findPlace(e.create(n),r,!1);return i&&(i=this.enterInner(e,n,r,!0,s)),i}enterInner(e,n,r,s=!1,i){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=j_(e,i,o.options);o.options&Id&&o.content.length==0&&(a|=Id);let l=On.none;return r=r.filter(u=>(o.type?o.type.allowsMarkType(u.type):A_(u.type,e))?(l=u.addToSet(l),!1):!0),this.nodes.push(new Dh(e,n,l,s,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=kf)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let s=r.length-1;s>=0;s--)e+=r[s].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&e.nodeType==1&&e.contains(this.find[s].node)&&n.compareDocumentPosition(this.find[s].node)&(r?2:4)&&(this.find[s].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,s=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(s?0:1),o=(a,l)=>{for(;a>=0;a--){let u=n[a];if(u==""){if(a==n.length-1||a==0)continue;for(;l>=i;l--)if(o(a-1,l))return!0;return!1}else{let d=l>0||l==0&&s?this.nodes[l].type:r&&l>=i?r.node(l-i).type:null;if(!d||d.name!=u&&!d.isInGroup(u))return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function Z9(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&YA.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function eH(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function D_(t){let e={};for(let n in t)e[n]=t[n];return e}function A_(t,e){let n=e.schema.nodes;for(let r in n){let s=n[r];if(!s.allowsMarkType(t))continue;let i=[],o=a=>{i.push(a);for(let l=0;l<a.edgeCount;l++){let{type:u,next:d}=a.edge(l);if(u==e||i.indexOf(d)<0&&o(d))return!0}};if(o(s.contentMatch))return!0}}class nc{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=ny(n).createDocumentFragment());let s=r,i=[];return e.forEach(o=>{if(i.length||o.marks.length){let a=0,l=0;for(;a<i.length&&l<o.marks.length;){let u=o.marks[l];if(!this.marks[u.type.name]){l++;continue}if(!u.eq(i[a][0])||u.type.spec.spanning===!1)break;a++,l++}for(;a<i.length;)s=i.pop()[1];for(;l<o.marks.length;){let u=o.marks[l++],d=this.serializeMark(u,o.isInline,n);d&&(i.push([u,s]),s.appendChild(d.dom),s=d.contentDOM||d.dom)}}s.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:s}=gp(ny(n),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,s)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let s=e.marks.length-1;s>=0;s--){let i=this.serializeMark(e.marks[s],e.isInline,n);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(e,n,r={}){let s=this.marks[e.type.name];return s&&gp(ny(r),s(e,n),null,e.attrs)}static renderSpec(e,n,r=null,s){return gp(e,n,r,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new nc(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=M_(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return M_(e.marks)}}function M_(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function ny(t){return t.document||window.document}const R_=new WeakMap;function tH(t){let e=R_.get(t);return e===void 0&&R_.set(t,e=nH(t)),e}function nH(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let s=0;s<r.length;s++)n(r[s]);else for(let s in r)n(r[s])}return n(t),e}function gp(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let s=e[0],i;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(i=tH(r))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=s.indexOf(" ");o>0&&(n=s.slice(0,o),s=s.slice(o+1));let a,l=n?t.createElementNS(n,s):t.createElement(s),u=e[1],d=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){d=2;for(let f in u)if(u[f]!=null){let h=f.indexOf(" ");h>0?l.setAttributeNS(f.slice(0,h),f.slice(h+1),u[f]):f=="style"&&l.style?l.style.cssText=u[f]:l.setAttribute(f,u[f])}}for(let f=d;f<e.length;f++){let h=e[f];if(h===0){if(f<e.length-1||f>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:p,contentDOM:m}=gp(t,h,n,r);if(l.appendChild(p),m){if(a)throw new RangeError("Multiple content holes");a=m}}}return{dom:l,contentDOM:a}}const XA=65535,QA=Math.pow(2,16);function rH(t,e){return t+e*QA}function O_(t){return t&XA}function sH(t){return(t-(t&XA))/QA}const ZA=1,eM=2,yp=4,tM=8;class M1{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&tM)>0}get deletedBefore(){return(this.delInfo&(ZA|yp))>0}get deletedAfter(){return(this.delInfo&(eM|yp))>0}get deletedAcross(){return(this.delInfo&yp)>0}}class Js{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&Js.empty)return Js.empty}recover(e){let n=0,r=O_(e);if(!this.inverted)for(let s=0;s<r;s++)n+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[r*3]+n+sH(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let s=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?s:0);if(l>e)break;let u=this.ranges[a+i],d=this.ranges[a+o],f=l+u;if(e<=f){let h=u?e==l?-1:e==f?1:n:n,p=l+s+(h<0?0:d);if(r)return p;let m=e==(n<0?l:f)?null:rH(a/3,e-l),y=e==l?eM:e==f?ZA:yp;return(n<0?e!=l:e!=f)&&(y|=tM),new M1(p,y,m)}s+=d-u}return r?e+s:new M1(e+s,0,null)}touches(e,n){let r=0,s=O_(n),i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let u=this.ranges[a+i],d=l+u;if(e<=d&&a==s*3)return!0;r+=this.ranges[a+o]-u}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let s=0,i=0;s<this.ranges.length;s+=3){let o=this.ranges[s],a=o-(this.inverted?i:0),l=o+(this.inverted?0:i),u=this.ranges[s+n],d=this.ranges[s+r];e(a,a+u,l,l+d),i+=d-u}}invert(){return new Js(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Js.empty:new Js(e<0?[0,-e,0]:[0,0,e])}}Js.empty=new Js([]);class Sf{constructor(e,n,r=0,s=e?e.length:0){this.mirror=n,this.from=r,this.to=s,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new Sf(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let s=e.getMirror(n);this.appendMap(e._maps[n],s!=null&&s<n?r+s:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let s=e.getMirror(n);this.appendMap(e._maps[n].invert(),s!=null&&s>n?r-s-1:void 0)}}invert(){let e=new Sf;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let s=0;for(let i=this.from;i<this.to;i++){let o=this._maps[i],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(i);if(l!=null&&l>i&&l<this.to){i=l,e=this._maps[l].recover(a.recover);continue}}s|=a.delInfo,e=a.pos}return r?e:new M1(e,s,null)}}const ry=Object.create(null);class ps{getMap(){return Js.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=ry[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in ry)throw new RangeError("Duplicate use of step JSON ID "+e);return ry[e]=n,n.prototype.jsonID=e,n}}class _r{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new _r(e,null)}static fail(e){return new _r(null,e)}static fromReplace(e,n,r,s){try{return _r.ok(e.replace(n,r,s))}catch(i){if(i instanceof pm)return _r.fail(i.message);throw i}}}function lv(t,e,n){let r=[];for(let s=0;s<t.childCount;s++){let i=t.child(s);i.content.size&&(i=i.copy(lv(i.content,e,i))),i.isInline&&(i=e(i,n,s)),r.push(i)}return kt.fromArray(r)}class ka extends ps{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),s=r.node(r.sharedDepth(this.to)),i=new Lt(lv(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),s),n.openStart,n.openEnd);return _r.fromReplace(e,this.from,this.to,i)}invert(){return new uo(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new ka(n.pos,r.pos,this.mark)}merge(e){return e instanceof ka&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new ka(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new ka(n.from,n.to,e.markFromJSON(n.mark))}}ps.jsonID("addMark",ka);class uo extends ps{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new Lt(lv(n.content,s=>s.mark(this.mark.removeFromSet(s.marks)),e),n.openStart,n.openEnd);return _r.fromReplace(e,this.from,this.to,r)}invert(){return new ka(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new uo(n.pos,r.pos,this.mark)}merge(e){return e instanceof uo&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new uo(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new uo(n.from,n.to,e.markFromJSON(n.mark))}}ps.jsonID("removeMark",uo);class Sa extends ps{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return _r.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return _r.fromReplace(e,this.pos,this.pos+1,new Lt(kt.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let s=0;s<n.marks.length;s++)if(!n.marks[s].isInSet(r))return new Sa(this.pos,n.marks[s]);return new Sa(this.pos,this.mark)}}return new Jl(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Sa(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Sa(n.pos,e.markFromJSON(n.mark))}}ps.jsonID("addNodeMark",Sa);class Jl extends ps{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return _r.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return _r.fromReplace(e,this.pos,this.pos+1,new Lt(kt.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new Sa(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Jl(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Jl(n.pos,e.markFromJSON(n.mark))}}ps.jsonID("removeNodeMark",Jl);class $r extends ps{constructor(e,n,r,s=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=s}apply(e){return this.structure&&R1(e,this.from,this.to)?_r.fail("Structure replace would overwrite content"):_r.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Js([this.from,this.to-this.from,this.slice.size])}invert(e){return new $r(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new $r(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof $r)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?Lt.empty:new Lt(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new $r(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?Lt.empty:new Lt(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new $r(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new $r(n.from,n.to,Lt.fromJSON(e,n.slice),!!n.structure)}}ps.jsonID("replace",$r);class Br extends ps{constructor(e,n,r,s,i,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=s,this.slice=i,this.insert=o,this.structure=a}apply(e){if(this.structure&&(R1(e,this.from,this.gapFrom)||R1(e,this.gapTo,this.to)))return _r.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return _r.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?_r.fromReplace(e,this.from,this.to,r):_r.fail("Content does not fit in gap")}getMap(){return new Js([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new Br(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),s=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||s<n.pos||i>r.pos?null:new Br(n.pos,r.pos,s,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Br(n.from,n.to,n.gapFrom,n.gapTo,Lt.fromJSON(e,n.slice),n.insert,!!n.structure)}}ps.jsonID("replaceAround",Br);function R1(t,e,n){let r=t.resolve(e),s=n-e,i=r.depth;for(;s>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,s--;if(s>0){let o=r.node(i).maybeChild(r.indexAfter(i));for(;s>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,s--}}return!1}function iH(t,e,n,r){let s=[],i=[],o,a;t.doc.nodesBetween(e,n,(l,u,d)=>{if(!l.isInline)return;let f=l.marks;if(!r.isInSet(f)&&d.type.allowsMarkType(r.type)){let h=Math.max(u,e),p=Math.min(u+l.nodeSize,n),m=r.addToSet(f);for(let y=0;y<f.length;y++)f[y].isInSet(m)||(o&&o.to==h&&o.mark.eq(f[y])?o.to=p:s.push(o=new uo(h,p,f[y])));a&&a.to==h?a.to=p:i.push(a=new ka(h,p,r))}}),s.forEach(l=>t.step(l)),i.forEach(l=>t.step(l))}function oH(t,e,n,r){let s=[],i=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;i++;let l=null;if(r instanceof Mg){let u=o.marks,d;for(;d=r.isInSet(u);)(l||(l=[])).push(d),u=d.removeFromSet(u)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let u=Math.min(a+o.nodeSize,n);for(let d=0;d<l.length;d++){let f=l[d],h;for(let p=0;p<s.length;p++){let m=s[p];m.step==i-1&&f.eq(s[p].style)&&(h=m)}h?(h.to=u,h.step=i):s.push({style:f,from:Math.max(a,e),to:u,step:i})}}}),s.forEach(o=>t.step(new uo(o.from,o.to,o.style)))}function cv(t,e,n,r=n.contentMatch,s=!0){let i=t.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<i.childCount;l++){let u=i.child(l),d=a+u.nodeSize,f=r.matchType(u.type);if(!f)o.push(new $r(a,d,Lt.empty));else{r=f;for(let h=0;h<u.marks.length;h++)n.allowsMarkType(u.marks[h].type)||t.step(new uo(a,d,u.marks[h]));if(s&&u.isText&&n.whitespace!="pre"){let h,p=/\r?\n|\r/g,m;for(;h=p.exec(u.text);)m||(m=new Lt(kt.from(n.schema.text(" ",n.allowedMarks(u.marks))),0,0)),o.push(new $r(a+h.index,a+h.index+h[0].length,m))}}a=d}if(!r.validEnd){let l=r.fillBefore(kt.empty,!0);t.replace(a,a,new Lt(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function aH(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function Ou(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth,s=0,i=0;;--r){let o=t.$from.node(r),a=t.$from.index(r)+s,l=t.$to.indexAfter(r)-i;if(r<t.depth&&o.canReplace(a,l,n))return r;if(r==0||o.type.spec.isolating||!aH(o,a,l))break;a&&(s=1),l<o.childCount&&(i=1)}return null}function lH(t,e,n){let{$from:r,$to:s,depth:i}=e,o=r.before(i+1),a=s.after(i+1),l=o,u=a,d=kt.empty,f=0;for(let m=i,y=!1;m>n;m--)y||r.index(m)>0?(y=!0,d=kt.from(r.node(m).copy(d)),f++):l--;let h=kt.empty,p=0;for(let m=i,y=!1;m>n;m--)y||s.after(m+1)<s.end(m)?(y=!0,h=kt.from(s.node(m).copy(h)),p++):u++;t.step(new Br(l,u,o,a,new Lt(d.append(h),f,p),d.size-f,!0))}function uv(t,e,n=null,r=t){let s=cH(t,e),i=s&&uH(r,e);return i?s.map(P_).concat({type:e,attrs:n}).concat(i.map(P_)):null}function P_(t){return{type:t,attrs:null}}function cH(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.contentMatchAt(r).findWrapping(e);if(!i)return null;let o=i.length?i[0]:e;return n.canReplaceWith(r,s,o)?i:null}function uH(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.child(r),o=e.contentMatch.findWrapping(i.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let u=r;l&&u<s;u++)l=l.matchType(n.child(u).type);return!l||!l.validEnd?null:o}function dH(t,e,n){let r=kt.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let a=n[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=kt.from(n[o].type.create(n[o].attrs,r))}let s=e.start,i=e.end;t.step(new Br(s,i,s,i,new Lt(r,0,0),n.length,!0))}function fH(t,e,n,r,s){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{let l=typeof s=="function"?s(o):s;if(o.isTextblock&&!o.hasMarkup(r,l)&&hH(t.doc,t.mapping.slice(i).map(a),r)){let u=null;if(r.schema.linebreakReplacement){let p=r.whitespace=="pre",m=!!r.contentMatch.matchType(r.schema.linebreakReplacement);p&&!m?u=!1:!p&&m&&(u=!0)}u===!1&&rM(t,o,a,i),cv(t,t.mapping.slice(i).map(a,1),r,void 0,u===null);let d=t.mapping.slice(i),f=d.map(a,1),h=d.map(a+o.nodeSize,1);return t.step(new Br(f,h,f+1,h-1,new Lt(kt.from(r.create(l,null,o.marks)),0,0),1,!0)),u===!0&&nM(t,o,a,i),!1}})}function nM(t,e,n,r){e.forEach((s,i)=>{if(s.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(s.text);){let l=t.mapping.slice(r).map(n+1+i+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function rM(t,e,n,r){e.forEach((s,i)=>{if(s.type==s.type.schema.linebreakReplacement){let o=t.mapping.slice(r).map(n+1+i);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function hH(t,e,n){let r=t.resolve(e),s=r.index();return r.parent.canReplaceWith(s,s+1,n)}function pH(t,e,n,r,s){let i=t.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let o=n.create(r,null,s||i.marks);if(i.isLeaf)return t.replaceWith(e,e+i.nodeSize,o);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new Br(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new Lt(kt.from(o),0,0),1,!0))}function su(t,e,n=1,r){let s=t.resolve(e),i=s.depth-n,o=r&&r[r.length-1]||s.parent;if(i<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!o.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let u=s.depth-1,d=n-2;u>i;u--,d--){let f=s.node(u),h=s.index(u);if(f.type.spec.isolating)return!1;let p=f.content.cutByIndex(h,f.childCount),m=r&&r[d+1];m&&(p=p.replaceChild(0,m.type.create(m.attrs)));let y=r&&r[d]||f;if(!f.canReplace(h+1,f.childCount)||!y.type.validContent(p))return!1}let a=s.indexAfter(i),l=r&&r[0];return s.node(i).canReplaceWith(a,a,l?l.type:s.node(i+1).type)}function mH(t,e,n=1,r){let s=t.doc.resolve(e),i=kt.empty,o=kt.empty;for(let a=s.depth,l=s.depth-n,u=n-1;a>l;a--,u--){i=kt.from(s.node(a).copy(i));let d=r&&r[u];o=kt.from(d?d.type.create(d.attrs,o):s.node(a).copy(o))}t.step(new $r(e,e,new Lt(i.append(o),n,n),!0))}function Xa(t,e){let n=t.resolve(e),r=n.index();return sM(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function gH(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let s=0;s<e.childCount;s++){let i=e.child(s),o=i.type==r?t.type.schema.nodes.text:i.type;if(n=n.matchType(o),!n||!t.type.allowsMarks(i.marks))return!1}return n.validEnd}function sM(t,e){return!!(t&&e&&!t.isLeaf&&gH(t,e))}function Rg(t,e,n=-1){let r=t.resolve(e);for(let s=r.depth;;s--){let i,o,a=r.index(s);if(s==r.depth?(i=r.nodeBefore,o=r.nodeAfter):n>0?(i=r.node(s+1),a++,o=r.node(s).maybeChild(a)):(i=r.node(s).maybeChild(a-1),o=r.node(s+1)),i&&!i.isTextblock&&sM(i,o)&&r.node(s).canReplace(a,a+1))return e;if(s==0)break;e=n<0?r.before(s):r.after(s)}}function yH(t,e,n){let r=null,{linebreakReplacement:s}=t.doc.type.schema,i=t.doc.resolve(e-n),o=i.node().type;if(s&&o.inlineContent){let d=o.whitespace=="pre",f=!!o.contentMatch.matchType(s);d&&!f?r=!1:!d&&f&&(r=!0)}let a=t.steps.length;if(r===!1){let d=t.doc.resolve(e+n);rM(t,d.node(),d.before(),a)}o.inlineContent&&cv(t,e+n-1,o,i.node().contentMatchAt(i.index()),r==null);let l=t.mapping.slice(a),u=l.map(e-n);if(t.step(new $r(u,l.map(e+n,-1),Lt.empty,!0)),r===!0){let d=t.doc.resolve(u);nM(t,d.node(),d.before(),t.steps.length)}return t}function xH(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let s=r.depth-1;s>=0;s--){let i=r.index(s);if(r.node(s).canReplaceWith(i,i,n))return r.before(s+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(let s=r.depth-1;s>=0;s--){let i=r.indexAfter(s);if(r.node(s).canReplaceWith(i,i,n))return r.after(s+1);if(i<r.node(s).childCount)return null}return null}function iM(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let s=n.content;for(let i=0;i<n.openStart;i++)s=s.firstChild.content;for(let i=1;i<=(n.openStart==0&&n.size?2:1);i++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),u=r.node(o),d=!1;if(i==1)d=u.canReplace(l,l,s);else{let f=u.contentMatchAt(l).findWrapping(s.firstChild.type);d=f&&u.canReplaceWith(l,l,f[0])}if(d)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function Og(t,e,n=e,r=Lt.empty){if(e==n&&!r.size)return null;let s=t.resolve(e),i=t.resolve(n);return oM(s,i,r)?new $r(e,n,r):new bH(s,i,r).fit()}function oM(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class bH{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=kt.empty;for(let s=0;s<=e.depth;s++){let i=e.node(s);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=kt.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,s=this.close(e<0?this.$to:r.doc.resolve(e));if(!s)return null;let i=this.placed,o=r.depth,a=s.depth;for(;o&&a&&i.childCount==1;)i=i.firstChild.content,o--,a--;let l=new Lt(i,o,a);return e>-1?new Br(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new $r(r.pos,s.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,s=this.unplaced.openEnd;r<e;r++){let i=n.firstChild;if(n.childCount>1&&(s=0),i.type.spec.isolating&&s<=r){e=r;break}n=i.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let s,i=null;r?(i=sy(this.unplaced.content,r-1).firstChild,s=i.content):s=this.unplaced.content;let o=s.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:u}=this.frontier[a],d,f=null;if(n==1&&(o?u.matchType(o.type)||(f=u.fillBefore(kt.from(o),!1)):i&&l.compatibleContent(i.type)))return{sliceDepth:r,frontierDepth:a,parent:i,inject:f};if(n==2&&o&&(d=u.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:i,wrap:d};if(i&&u.matchType(i.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=sy(e,n);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new Lt(e,n+1,Math.max(r,s.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=sy(e,n);if(s.childCount<=1&&n>0){let i=e.size-n<=n+s.size;this.unplaced=new Lt(ud(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new Lt(ud(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:s,wrap:i}){for(;this.depth>n;)this.closeFrontierNode();if(i)for(let y=0;y<i.length;y++)this.openFrontierNode(i[y]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,u=0,d=[],{match:f,type:h}=this.frontier[n];if(s){for(let y=0;y<s.childCount;y++)d.push(s.child(y));f=f.matchFragment(s)}let p=a.size+e-(o.content.size-o.openEnd);for(;u<a.childCount;){let y=a.child(u),x=f.matchType(y.type);if(!x)break;u++,(u>1||l==0||y.content.size)&&(f=x,d.push(aM(y.mark(h.allowedMarks(y.marks)),u==1?l:0,u==a.childCount?p:-1)))}let m=u==a.childCount;m||(p=-1),this.placed=dd(this.placed,n,kt.from(d)),this.frontier[n].match=f,m&&p<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let y=0,x=a;y<p;y++){let g=x.lastChild;this.frontier.push({type:g.type,match:g.contentMatchAt(g.childCount)}),x=g.content}this.unplaced=m?e==0?Lt.empty:new Lt(ud(o.content,e-1,1),e-1,p<0?o.openEnd:e-1):new Lt(ud(o.content,e,u),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!iy(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,s=this.$to.after(r);for(;r>1&&s==this.$to.end(--r);)++s;return s}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:s}=this.frontier[n],i=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=iy(e,n,s,r,i);if(o){for(let a=n-1;a>=0;a--){let{match:l,type:u}=this.frontier[a],d=iy(e,a,u,l,!0);if(!d||d.childCount)continue e}return{depth:n,fit:o,move:i?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=dd(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let s=e.node(r),i=s.type.contentMatch.fillBefore(s.content,!0,e.index(r));this.openFrontierNode(s.type,s.attrs,i)}return e}openFrontierNode(e,n=null,r){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=dd(this.placed,this.depth,kt.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(kt.empty,!0);n.childCount&&(this.placed=dd(this.placed,this.frontier.length,n))}}function ud(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(ud(t.firstChild.content,e-1,n)))}function dd(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(dd(t.lastChild.content,e-1,n)))}function sy(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function aM(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,aM(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(kt.empty,!0)))),t.copy(r)}function iy(t,e,n,r,s){let i=t.node(e),o=s?t.indexAfter(e):t.index(e);if(o==i.childCount&&!n.compatibleContent(i.type))return null;let a=r.fillBefore(i.content,!0,o);return a&&!wH(n,i.content,o)?a:null}function wH(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function vH(t){return t.spec.defining||t.spec.definingForContent}function kH(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let s=t.doc.resolve(e),i=t.doc.resolve(n);if(oM(s,i,r))return t.step(new $r(e,n,r));let o=cM(s,i);o[o.length-1]==0&&o.pop();let a=-(s.depth+1);o.unshift(a);for(let h=s.depth,p=s.pos-1;h>0;h--,p--){let m=s.node(h).type.spec;if(m.defining||m.definingAsContext||m.isolating)break;o.indexOf(h)>-1?a=h:s.before(h)==p&&o.splice(1,0,-h)}let l=o.indexOf(a),u=[],d=r.openStart;for(let h=r.content,p=0;;p++){let m=h.firstChild;if(u.push(m),p==r.openStart)break;h=m.content}for(let h=d-1;h>=0;h--){let p=u[h],m=vH(p.type);if(m&&!p.sameMarkup(s.node(Math.abs(a)-1)))d=h;else if(m||!p.type.isTextblock)break}for(let h=r.openStart;h>=0;h--){let p=(h+d+1)%(r.openStart+1),m=u[p];if(m)for(let y=0;y<o.length;y++){let x=o[(y+l)%o.length],g=!0;x<0&&(g=!1,x=-x);let v=s.node(x-1),w=s.index(x-1);if(v.canReplaceWith(w,w,m.type,m.marks))return t.replace(s.before(x),g?i.after(x):n,new Lt(lM(r.content,0,r.openStart,p),p,r.openEnd))}}let f=t.steps.length;for(let h=o.length-1;h>=0&&(t.replace(e,n,r),!(t.steps.length>f));h--){let p=o[h];p<0||(e=s.before(p),n=i.after(p))}}function lM(t,e,n,r,s){if(e<n){let i=t.firstChild;t=t.replaceChild(0,i.copy(lM(i.content,e+1,n,r,i)))}if(e>r){let i=s.contentMatchAt(0),o=i.fillBefore(t).append(t);t=o.append(i.matchFragment(o).fillBefore(kt.empty,!0))}return t}function SH(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let s=xH(t.doc,e,r.type);s!=null&&(e=n=s)}t.replaceRange(e,n,new Lt(kt.from(r),0,0))}function _H(t,e,n){let r=t.doc.resolve(e),s=t.doc.resolve(n),i=cM(r,s);for(let o=0;o<i.length;o++){let a=i[o],l=o==i.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),s.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),s.indexAfter(a-1))))return t.delete(r.before(a),s.after(a))}for(let o=1;o<=r.depth&&o<=s.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&s.end(o)-n!=s.depth-o&&r.start(o-1)==s.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),s.index(o-1)))return t.delete(r.before(o),n);t.delete(e,n)}function cM(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let s=r;s>=0;s--){let i=t.start(s);if(i<t.pos-(t.depth-s)||e.end(s)>e.pos+(e.depth-s)||t.node(s).type.spec.isolating||e.node(s).type.spec.isolating)break;(i==e.start(s)||s==t.depth&&s==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&s&&e.start(s-1)==i-1)&&n.push(s)}return n}class iu extends ps{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return _r.fail("No node at attribute step's position");let r=Object.create(null);for(let i in n.attrs)r[i]=n.attrs[i];r[this.attr]=this.value;let s=n.type.create(r,null,n.marks);return _r.fromReplace(e,this.pos,this.pos+1,new Lt(kt.from(s),0,n.isLeaf?0:1))}getMap(){return Js.empty}invert(e){return new iu(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new iu(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new iu(n.pos,n.attr,n.value)}}ps.jsonID("attr",iu);class _f extends ps{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let s in e.attrs)n[s]=e.attrs[s];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return _r.ok(r)}getMap(){return Js.empty}invert(e){return new _f(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new _f(n.attr,n.value)}}ps.jsonID("docAttr",_f);let bu=class extends Error{};bu=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};bu.prototype=Object.create(Error.prototype);bu.prototype.constructor=bu;bu.prototype.name="TransformError";class uM{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Sf}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new bu(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=Lt.empty){let s=Og(this.doc,e,n,r);return s&&this.step(s),this}replaceWith(e,n,r){return this.replace(e,n,new Lt(kt.from(r),0,0))}delete(e,n){return this.replace(e,n,Lt.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return kH(this,e,n,r),this}replaceRangeWith(e,n,r){return SH(this,e,n,r),this}deleteRange(e,n){return _H(this,e,n),this}lift(e,n){return lH(this,e,n),this}join(e,n=1){return yH(this,e,n),this}wrap(e,n){return dH(this,e,n),this}setBlockType(e,n=e,r,s=null){return fH(this,e,n,r,s),this}setNodeMarkup(e,n,r=null,s){return pH(this,e,n,r,s),this}setNodeAttribute(e,n,r){return this.step(new iu(e,n,r)),this}setDocAttribute(e,n){return this.step(new _f(e,n)),this}addNodeMark(e,n){return this.step(new Sa(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof On)n.isInSet(r.marks)&&this.step(new Jl(e,n));else{let s=r.marks,i,o=[];for(;i=n.isInSet(s);)o.push(new Jl(e,i)),s=i.removeFromSet(s);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,n=1,r){return mH(this,e,n,r),this}addMark(e,n,r){return iH(this,e,n,r),this}removeMark(e,n,r){return oH(this,e,n,r),this}clearIncompatible(e,n,r){return cv(this,e,n,r),this}}const oy=Object.create(null);class ln{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new TH(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=Lt.empty){let r=n.content.lastChild,s=null;for(let a=0;a<n.openEnd;a++)s=r,r=r.lastChild;let i=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:u}=o[a],d=e.mapping.slice(i);e.replaceRange(d.map(l.pos),d.map(u.pos),a?Lt.empty:n),a==0&&z_(e,i,(r?r.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){let{$from:o,$to:a}=s[i],l=e.mapping.slice(r),u=l.map(o.pos),d=l.map(a.pos);i?e.deleteRange(u,d):(e.replaceRangeWith(u,d,n),z_(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let s=e.parent.inlineContent?new nn(e):_c(e.node(0),e.parent,e.pos,e.index(),n,r);if(s)return s;for(let i=e.depth-1;i>=0;i--){let o=n<0?_c(e.node(0),e.node(i),e.before(i+1),e.index(i),n,r):_c(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new vi(e.node(0))}static atStart(e){return _c(e,e,0,0,1)||new vi(e)}static atEnd(e){return _c(e,e,e.content.size,e.childCount,-1)||new vi(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=oy[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in oy)throw new RangeError("Duplicate use of selection JSON ID "+e);return oy[e]=n,n.prototype.jsonID=e,n}getBookmark(){return nn.between(this.$anchor,this.$head).getBookmark()}}ln.prototype.visible=!0;class TH{constructor(e,n){this.$from=e,this.$to=n}}let L_=!1;function $_(t){!L_&&!t.parent.inlineContent&&(L_=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class nn extends ln{constructor(e,n=e){$_(e),$_(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return ln.near(r);let s=e.resolve(n.map(this.anchor));return new nn(s.parent.inlineContent?s:r,r)}replace(e,n=Lt.empty){if(super.replace(e,n),n==Lt.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof nn&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Pg(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new nn(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let s=e.resolve(n);return new this(s,r==n?s:e.resolve(r))}static between(e,n,r){let s=e.pos-n.pos;if((!r||s)&&(r=s>=0?1:-1),!n.parent.inlineContent){let i=ln.findFrom(n,r,!0)||ln.findFrom(n,-r,!0);if(i)n=i.$head;else return ln.near(n,r)}return e.parent.inlineContent||(s==0?e=n:(e=(ln.findFrom(e,-r,!0)||ln.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=s<0&&(e=n))),new nn(e,n)}}ln.jsonID("text",nn);class Pg{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Pg(e.map(this.anchor),e.map(this.head))}resolve(e){return nn.between(e.resolve(this.anchor),e.resolve(this.head))}}class Kt extends ln{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:s}=n.mapResult(this.anchor),i=e.resolve(s);return r?ln.near(i):new Kt(i)}content(){return new Lt(kt.from(this.node),0,0)}eq(e){return e instanceof Kt&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new dv(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Kt(e.resolve(n.anchor))}static create(e,n){return new Kt(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}Kt.prototype.visible=!1;ln.jsonID("node",Kt);class dv{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new Pg(r,r):new dv(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&Kt.isSelectable(r)?new Kt(n):ln.near(n)}}class vi extends ln{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=Lt.empty){if(n==Lt.empty){e.delete(0,e.doc.content.size);let r=ln.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new vi(e)}map(e){return new vi(e)}eq(e){return e instanceof vi}getBookmark(){return CH}}ln.jsonID("all",vi);const CH={map(){return this},resolve(t){return new vi(t)}};function _c(t,e,n,r,s,i=!1){if(e.inlineContent)return nn.create(t,n);for(let o=r-(s>0?0:1);s>0?o<e.childCount:o>=0;o+=s){let a=e.child(o);if(a.isAtom){if(!i&&Kt.isSelectable(a))return Kt.create(t,n-(s<0?a.nodeSize:0))}else{let l=_c(t,a,n+s,s<0?a.childCount:0,s,i);if(l)return l}n+=a.nodeSize*s}return null}function z_(t,e,n){let r=t.steps.length-1;if(r<e)return;let s=t.steps[r];if(!(s instanceof $r||s instanceof Br))return;let i=t.mapping.maps[r],o;i.forEach((a,l,u,d)=>{o==null&&(o=d)}),t.setSelection(ln.near(t.doc.resolve(o),n))}const F_=1,Ah=2,B_=4;class EH extends uM{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|F_)&~Ah,this.storedMarks=null,this}get selectionSet(){return(this.updated&F_)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Ah,this}ensureMarks(e){return On.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Ah)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~Ah,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||On.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let s=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(s.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),!e)return this.deleteRange(n,r);let i=this.storedMarks;if(!i){let o=this.doc.resolve(n);i=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,s.text(e,i)),!this.selection.empty&&this.selection.to==n+e.length&&this.setSelection(ln.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=B_,this}get scrolledIntoView(){return(this.updated&B_)>0}}function U_(t,e){return!e||!t?t:t.bind(e)}class fd{constructor(e,n,r){this.name=e,this.init=U_(n.init,r),this.apply=U_(n.apply,r)}}const NH=[new fd("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new fd("selection",{init(t,e){return t.selection||ln.atStart(e.doc)},apply(t){return t.selection}}),new fd("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new fd("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class ay{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=NH.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new fd(r.key,r.spec.state,r))})}}class Gc{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let s=this.config.plugins[r];if(s.spec.filterTransaction&&!s.spec.filterTransaction.call(s,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),s=null;for(;;){let i=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=s?s[o].n:0,u=s?s[o].state:this,d=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,u,r);if(d&&r.filterTransaction(d,o)){if(d.setMeta("appendedTransaction",e),!s){s=[];for(let f=0;f<this.config.plugins.length;f++)s.push(f<o?{state:r,n:n.length}:{state:this,n:0})}n.push(d),r=r.applyInner(d),i=!0}s&&(s[o]={state:r,n:n.length})}}if(!i)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new Gc(this.config),r=this.config.fields;for(let s=0;s<r.length;s++){let i=r[s];n[i.name]=i.apply(e,this[i.name],this,n)}return n}get tr(){return new EH(this)}static create(e){let n=new ay(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new Gc(n);for(let s=0;s<n.fields.length;s++)r[n.fields[s].name]=n.fields[s].init(e,r);return r}reconfigure(e){let n=new ay(this.schema,e.plugins),r=n.fields,s=new Gc(n);for(let i=0;i<r.length;i++){let o=r[i].name;s[o]=this.hasOwnProperty(o)?this[o]:r[i].init(e,s)}return s}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[r],i=s.spec.state;i&&i.toJSON&&(n[r]=i.toJSON.call(s,this[s.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new ay(e.schema,e.plugins),i=new Gc(s);return s.fields.forEach(o=>{if(o.name=="doc")i.doc=Fo.fromJSON(e.schema,n.doc);else if(o.name=="selection")i.selection=ln.fromJSON(i.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(i.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],u=l.spec.state;if(l.key==o.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){i[o.name]=u.fromJSON.call(l,e,n[a],i);return}}i[o.name]=o.init(e,i)}}),i}}function dM(t,e,n){for(let r in t){let s=t[r];s instanceof Function?s=s.bind(e):r=="handleDOMEvents"&&(s=dM(s,e,{})),n[r]=s}return n}class Tr{constructor(e){this.spec=e,this.props={},e.props&&dM(e.props,this,this.props),this.key=e.key?e.key.key:fM("plugin")}getState(e){return e[this.key]}}const ly=Object.create(null);function fM(t){return t in ly?t+"$"+ ++ly[t]:(ly[t]=0,t+"$")}class ns{constructor(e="key"){this.key=fM(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Xr=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},wu=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let O1=null;const Ao=function(t,e,n){let r=O1||(O1=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},jH=function(){O1=null},Yl=function(t,e,n,r){return n&&(H_(t,e,n,r,-1)||H_(t,e,n,r,1))},IH=/^(img|br|input|textarea|hr)$/i;function H_(t,e,n,r,s){for(var i;;){if(t==n&&e==r)return!0;if(e==(s<0?0:mi(t))){let o=t.parentNode;if(!o||o.nodeType!=1||Yf(t)||IH.test(t.nodeName)||t.contentEditable=="false")return!1;e=Xr(t)+(s<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(s<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((i=o.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=s;else return!1;else t=o,e=s<0?mi(t):0}else return!1}}function mi(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function DH(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=mi(t)}else if(t.parentNode&&!Yf(t))e=Xr(t),t=t.parentNode;else return null}}function AH(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!Yf(t))e=Xr(t)+1,t=t.parentNode;else return null}}function MH(t,e,n){for(let r=e==0,s=e==mi(t);r||s;){if(t==n)return!0;let i=Xr(t);if(t=t.parentNode,!t)return!1;r=r&&i==0,s=s&&i==mi(t)}}function Yf(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Lg=function(t){return t.focusNode&&Yl(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function bl(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function RH(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function OH(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(mi(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(mi(r.startContainer),r.startOffset)}}}const yo=typeof navigator<"u"?navigator:null,V_=typeof document<"u"?document:null,Qa=yo&&yo.userAgent||"",P1=/Edge\/(\d+)/.exec(Qa),hM=/MSIE \d/.exec(Qa),L1=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Qa),zs=!!(hM||L1||P1),Oa=hM?document.documentMode:L1?+L1[1]:P1?+P1[1]:0,ki=!zs&&/gecko\/(\d+)/i.test(Qa);ki&&+(/Firefox\/(\d+)/.exec(Qa)||[0,0])[1];const $1=!zs&&/Chrome\/(\d+)/.exec(Qa),zr=!!$1,pM=$1?+$1[1]:0,hs=!zs&&!!yo&&/Apple Computer/.test(yo.vendor),vu=hs&&(/Mobile\/\w+/.test(Qa)||!!yo&&yo.maxTouchPoints>2),di=vu||(yo?/Mac/.test(yo.platform):!1),mM=yo?/Win/.test(yo.platform):!1,Lo=/Android \d/.test(Qa),Xf=!!V_&&"webkitFontSmoothing"in V_.documentElement.style,PH=Xf?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function LH(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function To(t,e){return typeof t=="number"?t:t[e]}function $H(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function W_(t,e,n){let r=t.someProp("scrollThreshold")||0,s=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument;for(let o=n||t.dom;o;){if(o.nodeType!=1){o=wu(o);continue}let a=o,l=a==i.body,u=l?LH(i):$H(a),d=0,f=0;if(e.top<u.top+To(r,"top")?f=-(u.top-e.top+To(s,"top")):e.bottom>u.bottom-To(r,"bottom")&&(f=e.bottom-e.top>u.bottom-u.top?e.top+To(s,"top")-u.top:e.bottom-u.bottom+To(s,"bottom")),e.left<u.left+To(r,"left")?d=-(u.left-e.left+To(s,"left")):e.right>u.right-To(r,"right")&&(d=e.right-u.right+To(s,"right")),d||f)if(l)i.defaultView.scrollBy(d,f);else{let p=a.scrollLeft,m=a.scrollTop;f&&(a.scrollTop+=f),d&&(a.scrollLeft+=d);let y=a.scrollLeft-p,x=a.scrollTop-m;e={left:e.left-y,top:e.top-x,right:e.right-y,bottom:e.bottom-x}}let h=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(h))break;o=h=="absolute"?o.offsetParent:wu(o)}}function zH(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,s;for(let i=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(i,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,s=l.top;break}}return{refDOM:r,refTop:s,stack:gM(t.dom)}}function gM(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=wu(r));return e}function FH({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;yM(n,r==0?0:r-e)}function yM(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:s,left:i}=t[n];r.scrollTop!=s+e&&(r.scrollTop=s+e),r.scrollLeft!=i&&(r.scrollLeft=i)}}let mc=null;function BH(t){if(t.setActive)return t.setActive();if(mc)return t.focus(mc);let e=gM(t);t.focus(mc==null?{get preventScroll(){return mc={preventScroll:!0},!0}}:void 0),mc||(mc=!1,yM(e,0))}function xM(t,e){let n,r=2e8,s,i=0,o=e.top,a=e.top,l,u;for(let d=t.firstChild,f=0;d;d=d.nextSibling,f++){let h;if(d.nodeType==1)h=d.getClientRects();else if(d.nodeType==3)h=Ao(d).getClientRects();else continue;for(let p=0;p<h.length;p++){let m=h[p];if(m.top<=o&&m.bottom>=a){o=Math.max(m.bottom,o),a=Math.min(m.top,a);let y=m.left>e.left?m.left-e.left:m.right<e.left?e.left-m.right:0;if(y<r){n=d,r=y,s=y&&n.nodeType==3?{left:m.right<e.left?m.right:m.left,top:e.top}:e,d.nodeType==1&&y&&(i=f+(e.left>=(m.left+m.right)/2?1:0));continue}}else m.top>e.top&&!l&&m.left<=e.left&&m.right>=e.left&&(l=d,u={left:Math.max(m.left,Math.min(m.right,e.left)),top:m.top});!n&&(e.left>=m.right&&e.top>=m.top||e.left>=m.left&&e.top>=m.bottom)&&(i=f+1)}}return!n&&l&&(n=l,s=u,r=0),n&&n.nodeType==3?UH(n,s):!n||r&&n.nodeType==1?{node:t,offset:i}:xM(n,s)}function UH(t,e){let n=t.nodeValue.length,r=document.createRange(),s;for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let o=aa(r,1);if(o.top!=o.bottom&&fv(e,o)){s={node:t,offset:i+(e.left>=(o.left+o.right)/2?1:0)};break}}return r.detach(),s||{node:t,offset:0}}function fv(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function HH(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function VH(t,e,n){let{node:r,offset:s}=xM(e,n),i=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();i=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,s,i)}function WH(t,e,n,r){let s=-1;for(let i=e,o=!1;i!=t.dom;){let a=t.docView.nearestDesc(i,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>r.left||l.top>r.top?s=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(s=a.posAfter),o=!0),!a.contentDOM&&s<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;i=a.dom.parentNode}return s>-1?s:t.docView.posFromDOM(e,n,-1)}function bM(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let s=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),i=s;;){let o=t.childNodes[i];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let u=a[l];if(fv(e,u))return bM(o,e,u)}}if((i=(i+1)%r)==s)break}return t}function KH(t,e){let n=t.dom.ownerDocument,r,s=0,i=OH(n,e.left,e.top);i&&({node:r,offset:s}=i);let o=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),a;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let u=t.dom.getBoundingClientRect();if(!fv(e,u)||(o=bM(t.dom,e,u),!o))return null}if(hs)for(let u=o;r&&u;u=wu(u))u.draggable&&(r=void 0);if(o=HH(o,e),r){if(ki&&r.nodeType==1&&(s=Math.min(s,r.childNodes.length),s<r.childNodes.length)){let d=r.childNodes[s],f;d.nodeName=="IMG"&&(f=d.getBoundingClientRect()).right<=e.left&&f.bottom>e.top&&s++}let u;Xf&&s&&r.nodeType==1&&(u=r.childNodes[s-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&s--,r==t.dom&&s==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(s==0||r.nodeType!=1||r.childNodes[s-1].nodeName!="BR")&&(a=WH(t,r,s,e))}a==null&&(a=VH(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function K_(t){return t.top<t.bottom||t.left<t.right}function aa(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(K_(r))return r}return Array.prototype.find.call(n,K_)||t.getBoundingClientRect()}const GH=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function wM(t,e,n){let{node:r,offset:s,atom:i}=t.docView.domFromPos(e,n<0?-1:1),o=Xf||ki;if(r.nodeType==3)if(o&&(GH.test(r.nodeValue)||(n<0?!s:s==r.nodeValue.length))){let l=aa(Ao(r,s,s),n);if(ki&&s&&/\s/.test(r.nodeValue[s-1])&&s<r.nodeValue.length){let u=aa(Ao(r,s-1,s-1),-1);if(u.top==l.top){let d=aa(Ao(r,s,s+1),-1);if(d.top!=l.top)return Xu(d,d.left<u.left)}}return l}else{let l=s,u=s,d=n<0?1:-1;return n<0&&!s?(u++,d=-1):n>=0&&s==r.nodeValue.length?(l--,d=1):n<0?l--:u++,Xu(aa(Ao(r,l,u),d),d<0)}if(!t.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&s&&(n<0||s==mi(r))){let l=r.childNodes[s-1];if(l.nodeType==1)return cy(l.getBoundingClientRect(),!1)}if(i==null&&s<mi(r)){let l=r.childNodes[s];if(l.nodeType==1)return cy(l.getBoundingClientRect(),!0)}return cy(r.getBoundingClientRect(),n>=0)}if(i==null&&s&&(n<0||s==mi(r))){let l=r.childNodes[s-1],u=l.nodeType==3?Ao(l,mi(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(u)return Xu(aa(u,1),!1)}if(i==null&&s<mi(r)){let l=r.childNodes[s];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let u=l?l.nodeType==3?Ao(l,0,o?0:1):l.nodeType==1?l:null:null;if(u)return Xu(aa(u,-1),!0)}return Xu(aa(r.nodeType==3?Ao(r):r,-n),n>=0)}function Xu(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function cy(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function vM(t,e,n){let r=t.state,s=t.root.activeElement;r!=e&&t.updateState(e),s!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),s!=t.dom&&s&&s.focus()}}function qH(t,e,n){let r=e.selection,s=n=="up"?r.$from:r.$to;return vM(t,e,()=>{let{node:i}=t.docView.domFromPos(s.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(i,!0);if(!a)break;if(a.node.isBlock){i=a.contentDOM||a.dom;break}i=a.dom.parentNode}let o=wM(t,s.pos,1);for(let a=i.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=Ao(a,0,a.nodeValue.length).getClientRects();else continue;for(let u=0;u<l.length;u++){let d=l[u];if(d.bottom>d.top+1&&(n=="up"?o.top-d.top>(d.bottom-o.top)*2:d.bottom-o.bottom>(o.bottom-d.top)*2))return!1}}return!0})}const JH=/[\u0590-\u08ac]/;function YH(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let s=r.parentOffset,i=!s,o=s==r.parent.content.size,a=t.domSelection();return a?!JH.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?i:o:vM(t,e,()=>{let{focusNode:l,focusOffset:u,anchorNode:d,anchorOffset:f}=t.domSelectionRange(),h=a.caretBidiLevel;a.modify("move",n,"character");let p=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:m,focusOffset:y}=t.domSelectionRange(),x=m&&!p.contains(m.nodeType==1?m:m.parentNode)||l==m&&u==y;try{a.collapse(d,f),l&&(l!=d||u!=f)&&a.extend&&a.extend(l,u)}catch{}return h!=null&&(a.caretBidiLevel=h),x}):r.pos==r.start()||r.pos==r.end()}let G_=null,q_=null,J_=!1;function XH(t,e,n){return G_==e&&q_==n?J_:(G_=e,q_=n,J_=n=="up"||n=="down"?qH(t,e,n):YH(t,e,n))}const Si=0,Y_=1,jl=2,xo=3;class Qf{constructor(e,n,r,s){this.parent=e,this.children=n,this.dom=r,this.contentDOM=s,this.dirty=Si,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let s=this.children[n];if(s==e)return r;r+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let i,o;if(e==this.contentDOM)i=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(o)+o.size:this.posAtStart}else{let i,o;if(e==this.contentDOM)i=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(o):this.posAtEnd}let s;if(e==this.dom&&this.contentDOM)s=n>Xr(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!1;break}if(i.previousSibling)break}if(s==null&&n==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!0;break}if(i.nextSibling)break}}return s??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,s=e;s;s=s.parentNode){let i=this.getDesc(s),o;if(i&&(!n||i.node))if(r&&(o=i.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return i}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let s=e;s;s=s.parentNode){let i=this.getDesc(s);if(i)return i.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let s=this.children[n],i=r+s.size;if(r==e&&i!=r){for(;!s.border&&s.children.length;)for(let o=0;o<s.children.length;o++){let a=s.children[o];if(a.size){s=a;break}}return s}if(e<i)return s.descAt(e-r-s.border);r=i}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,s=0;for(let i=0;r<this.children.length;r++){let o=this.children[r],a=i+o.size;if(a>e||o instanceof SM){s=e-i;break}i=a}if(s)return this.children[r].domFromPos(s-this.children[r].border,n);for(let i;r&&!(i=this.children[r-1]).size&&i instanceof kM&&i.side>=0;r--);if(n<=0){let i,o=!0;for(;i=r?this.children[r-1]:null,!(!i||i.dom.parentNode==this.contentDOM);r--,o=!1);return i&&n&&o&&!i.border&&!i.domAtom?i.domFromPos(i.size,n):{node:this.contentDOM,offset:i?Xr(i.dom)+1:0}}else{let i,o=!0;for(;i=r<this.children.length?this.children[r]:null,!(!i||i.dom.parentNode==this.contentDOM);r++,o=!1);return i&&o&&!i.border&&!i.domAtom?i.domFromPos(0,n):{node:this.contentDOM,offset:i?Xr(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,i=-1;for(let o=r,a=0;;a++){let l=this.children[a],u=o+l.size;if(s==-1&&e<=u){let d=o+l.border;if(e>=d&&n<=u-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,d);e=o;for(let f=a;f>0;f--){let h=this.children[f-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){s=Xr(h.dom)+1;break}e-=h.size}s==-1&&(s=0)}if(s>-1&&(u>n||a==this.children.length-1)){n=u;for(let d=a+1;d<this.children.length;d++){let f=this.children[d];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(-1)){i=Xr(f.dom);break}n+=f.size}i==-1&&(i=this.contentDOM.childNodes.length);break}o=u}return{node:this.contentDOM,from:e,to:n,fromOffset:s,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,s=!1){let i=Math.min(e,n),o=Math.max(e,n);for(let p=0,m=0;p<this.children.length;p++){let y=this.children[p],x=m+y.size;if(i>m&&o<x)return y.setSelection(e-m-y.border,n-m-y.border,r,s);m=x}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),u=r.root.getSelection(),d=r.domSelectionRange(),f=!1;if((ki||hs)&&e==n){let{node:p,offset:m}=a;if(p.nodeType==3){if(f=!!(m&&p.nodeValue[m-1]==`
`),f&&m==p.nodeValue.length)for(let y=p,x;y;y=y.parentNode){if(x=y.nextSibling){x.nodeName=="BR"&&(a=l={node:x.parentNode,offset:Xr(x)+1});break}let g=y.pmViewDesc;if(g&&g.node&&g.node.isBlock)break}}else{let y=p.childNodes[m-1];f=y&&(y.nodeName=="BR"||y.contentEditable=="false")}}if(ki&&d.focusNode&&d.focusNode!=l.node&&d.focusNode.nodeType==1){let p=d.focusNode.childNodes[d.focusOffset];p&&p.contentEditable=="false"&&(s=!0)}if(!(s||f&&hs)&&Yl(a.node,a.offset,d.anchorNode,d.anchorOffset)&&Yl(l.node,l.offset,d.focusNode,d.focusOffset))return;let h=!1;if((u.extend||e==n)&&!(f&&ki)){u.collapse(a.node,a.offset);try{e!=n&&u.extend(l.node,l.offset),h=!0}catch{}}if(!h){if(e>n){let m=a;a=l,l=m}let p=document.createRange();p.setEnd(l.node,l.offset),p.setStart(a.node,a.offset),u.removeAllRanges(),u.addRange(p)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,s=0;s<this.children.length;s++){let i=this.children[s],o=r+i.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let a=r+i.border,l=o-i.border;if(e>=a&&n<=l){this.dirty=e==r||n==o?jl:Y_,e==a&&n==l&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=xo:i.markDirty(e-a,n-a);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?jl:xo}r=o}this.dirty=jl}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?jl:Y_;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class kM extends Qf{constructor(e,n,r,s){let i,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!i)return s;if(i.parent)return i.parent.posBeforeChild(i)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,i=this}matchesWidget(e){return this.dirty==Si&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class QH extends Qf{constructor(e,n,r,s){super(e,[],n,null),this.textDOM=r,this.text=s}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class Xl extends Qf{constructor(e,n,r,s,i){super(e,[],r,s),this.mark=n,this.spec=i}static create(e,n,r,s){let i=s.nodeViews[n.type.name],o=i&&i(n,s,r);return(!o||!o.dom)&&(o=nc.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new Xl(e,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&xo||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=xo&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=Si){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Si}}slice(e,n,r){let s=Xl.create(this.parent,this.mark,!0,r),i=this.children,o=this.size;n<o&&(i=F1(i,n,o,r)),e>0&&(i=F1(i,0,e,r));for(let a=0;a<i.length;a++)i[a].parent=s;return s.children=i,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Pa extends Qf{constructor(e,n,r,s,i,o,a,l,u){super(e,[],i,o),this.node=n,this.outerDeco=r,this.innerDeco=s,this.nodeDOM=a}static create(e,n,r,s,i,o){let a=i.nodeViews[n.type.name],l,u=a&&a(n,i,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,s),d=u&&u.dom,f=u&&u.contentDOM;if(n.isText){if(!d)d=document.createTextNode(n.text);else if(d.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else d||({dom:d,contentDOM:f}=nc.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!f&&!n.isText&&d.nodeName!="BR"&&(d.hasAttribute("contenteditable")||(d.contentEditable="false"),n.type.spec.draggable&&(d.draggable=!0));let h=d;return d=CM(d,r,n),u?l=new ZH(e,n,r,s,d,f||null,h,u,i,o+1):n.isText?new $g(e,n,r,s,d,h,i):new Pa(e,n,r,s,d,f||null,h,i,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>kt.empty)}return e}matchesNode(e,n,r){return this.dirty==Si&&e.eq(this.node)&&xm(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,s=n,i=e.composing?this.localCompositionInfo(e,n):null,o=i&&i.pos>-1?i:null,a=i&&i.pos<0,l=new tV(this,o&&o.node,e);sV(this.node,this.innerDeco,(u,d,f)=>{u.spec.marks?l.syncToMarks(u.spec.marks,r,e):u.type.side>=0&&!f&&l.syncToMarks(d==this.node.childCount?On.none:this.node.child(d).marks,r,e),l.placeWidget(u,e,s)},(u,d,f,h)=>{l.syncToMarks(u.marks,r,e);let p;l.findNodeMatch(u,d,f,h)||a&&e.state.selection.from>s&&e.state.selection.to<s+u.nodeSize&&(p=l.findIndexWithChild(i.node))>-1&&l.updateNodeAt(u,d,f,p,e)||l.updateNextNode(u,d,f,e,h,s)||l.addNode(u,d,f,e,s),s+=u.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==jl)&&(o&&this.protectLocalComposition(e,o),_M(this.contentDOM,this.children,e),vu&&iV(this.dom))}localCompositionInfo(e,n){let{from:r,to:s}=e.state.selection;if(!(e.state.selection instanceof nn)||r<n||s>n+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let o=i.nodeValue,a=oV(this.node.content,o,r-n,s-n);return a<0?null:{node:i,pos:a,text:o}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:s}){if(this.getDesc(n))return;let i=n;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let o=new QH(this,i,n,s);e.input.compositionNodes.push(o),this.children=F1(this.children,r,r+s.length,e,o)}update(e,n,r,s){return this.dirty==xo||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,s),!0)}updateInner(e,n,r,s){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=Si}updateOuterDeco(e){if(xm(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=TM(this.dom,this.nodeDOM,z1(this.outerDeco,this.node,n),z1(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function X_(t,e,n,r,s){CM(r,e,t);let i=new Pa(void 0,t,e,n,r,r,r,s,0);return i.contentDOM&&i.updateChildren(s,0),i}class $g extends Pa{constructor(e,n,r,s,i,o,a){super(e,n,r,s,i,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,s){return this.dirty==xo||this.dirty!=Si&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=Si||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=Si,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let s=this.node.cut(e,n),i=document.createTextNode(s.text);return new $g(this.parent,s,this.outerDeco,this.innerDeco,i,i,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=xo)}get domAtom(){return!1}isText(e){return this.node.text==e}}class SM extends Qf{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Si&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class ZH extends Pa{constructor(e,n,r,s,i,o,a,l,u,d){super(e,n,r,s,i,o,a,u,d),this.spec=l}update(e,n,r,s){if(this.dirty==xo)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,n,r);return i&&this.updateInner(e,n,r,s),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,s){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function _M(t,e,n){let r=t.firstChild,s=!1;for(let i=0;i<e.length;i++){let o=e[i],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=Q_(r),s=!0;r=r.nextSibling}else s=!0,t.insertBefore(a,r);if(o instanceof Xl){let l=r?r.previousSibling:t.lastChild;_M(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=Q_(r),s=!0;s&&n.trackWrites==t&&(n.trackWrites=null)}const Dd=function(t){t&&(this.nodeName=t)};Dd.prototype=Object.create(null);const Il=[new Dd];function z1(t,e,n){if(t.length==0)return Il;let r=n?Il[0]:new Dd,s=[r];for(let i=0;i<t.length;i++){let o=t[i].type.attrs;if(o){o.nodeName&&s.push(r=new Dd(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&s.length==1&&s.push(r=new Dd(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return s}function TM(t,e,n,r){if(n==Il&&r==Il)return e;let s=e;for(let i=0;i<r.length;i++){let o=r[i],a=n[i];if(i){let l;a&&a.nodeName==o.nodeName&&s!=t&&(l=s.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(s),a=Il[0]),s=l}eV(s,a||Il[0],o)}return s}function eV(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],s=n.class?n.class.split(" ").filter(Boolean):[];for(let i=0;i<r.length;i++)s.indexOf(r[i])==-1&&t.classList.remove(r[i]);for(let i=0;i<s.length;i++)r.indexOf(s[i])==-1&&t.classList.add(s[i]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,s;for(;s=r.exec(e.style);)t.style.removeProperty(s[1])}n.style&&(t.style.cssText+=n.style)}}function CM(t,e,n){return TM(t,t,Il,z1(e,n,t.nodeType!=1))}function xm(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function Q_(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class tV{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=nV(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let s=0,i=this.stack.length>>1,o=Math.min(i,e.length);for(;s<o&&(s==i-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&e[s].type.spec.spanning!==!1;)s++;for(;s<i;)this.destroyRest(),this.top.dirty=Si,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let u=this.top.children[l];if(u.matchesMark(e[i])&&!this.isLocked(u.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=Xl.create(this.top,e[i],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,i++}}findNodeMatch(e,n,r,s){let i=-1,o;if(s>=this.preMatch.index&&(o=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))i=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let u=this.top.children[a];if(u.matchesNode(e,n,r)&&!this.preMatch.matched.has(u)){i=a;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,n,r,s,i){let o=this.top.children[s];return o.dirty==xo&&o.dom==o.contentDOM&&(o.dirty=jl),o.update(e,n,r,i)?(this.destroyBetween(this.index,s),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let s=this.index;s<this.top.children.length;s++)if(this.top.children[s]==r)return s}return-1}e=n}}updateNextNode(e,n,r,s,i,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof Pa){let u=this.preMatch.matched.get(l);if(u!=null&&u!=i)return!1;let d=l.dom,f,h=this.isLocked(d)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=xo&&xm(n,l.outerDeco));if(!h&&l.update(e,n,r,s))return this.destroyBetween(this.index,a),l.dom!=d&&(this.changed=!0),this.index++,!0;if(!h&&(f=this.recreateWrapper(l,e,n,r,s,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=f,f.contentDOM&&(f.dirty=jl,f.updateChildren(s,o+1),f.dirty=Si),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,s,i,o){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!xm(r,e.outerDeco)||!s.eq(e.innerDeco))return null;let a=Pa.create(this.top,n,r,s,i,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,n,r,s,i){let o=Pa.create(this.top,e,n,r,s,i);o.contentDOM&&o.updateChildren(s,i+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,n,r){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(s&&s.matchesWidget(e)&&(e==s.widget||!s.widget.type.toDOM.parentNode))this.index++;else{let i=new kM(this.top,e,n,r);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof Xl;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof $g)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((hs||zr)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let s=new SM(this.top,[],r,null);n!=this.top?n.children.push(s):n.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function nV(t,e){let n=e,r=n.children.length,s=t.childCount,i=new Map,o=[];e:for(;s>0;){let a;for(;;)if(r){let u=n.children[r-1];if(u instanceof Xl)n=u,r=u.children.length;else{a=u,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(s-1))break;--s,i.set(a,s),o.push(a)}}return{index:s,matched:i,matches:o.reverse()}}function rV(t,e){return t.type.side-e.type.side}function sV(t,e,n,r){let s=e.locals(t),i=0;if(s.length==0){for(let u=0;u<t.childCount;u++){let d=t.child(u);r(d,s,e.forChild(i,d),u),i+=d.nodeSize}return}let o=0,a=[],l=null;for(let u=0;;){let d,f;for(;o<s.length&&s[o].to==i;){let x=s[o++];x.widget&&(d?(f||(f=[d])).push(x):d=x)}if(d)if(f){f.sort(rV);for(let x=0;x<f.length;x++)n(f[x],u,!!l)}else n(d,u,!!l);let h,p;if(l)p=-1,h=l,l=null;else if(u<t.childCount)p=u,h=t.child(u++);else break;for(let x=0;x<a.length;x++)a[x].to<=i&&a.splice(x--,1);for(;o<s.length&&s[o].from<=i&&s[o].to>i;)a.push(s[o++]);let m=i+h.nodeSize;if(h.isText){let x=m;o<s.length&&s[o].from<x&&(x=s[o].from);for(let g=0;g<a.length;g++)a[g].to<x&&(x=a[g].to);x<m&&(l=h.cut(x-i),h=h.cut(0,x-i),m=x,p=-1)}else for(;o<s.length&&s[o].to<m;)o++;let y=h.isInline&&!h.isLeaf?a.filter(x=>!x.inline):a.slice();r(h,y,e.forChild(i,h),p),i=m}}function iV(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function oV(t,e,n,r){for(let s=0,i=0;s<t.childCount&&i<=r;){let o=t.child(s++),a=i;if(i+=o.nodeSize,!o.isText)continue;let l=o.text;for(;s<t.childCount;){let u=t.child(s++);if(i+=u.nodeSize,!u.isText)break;l+=u.text}if(i>=n){if(i>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let u=a<r?l.lastIndexOf(e,r-a-1):-1;if(u>=0&&u+e.length+a>=n)return a+u;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function F1(t,e,n,r,s){let i=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],u=a,d=a+=l.size;u>=n||d<=e?i.push(l):(u<e&&i.push(l.slice(0,e-u,r)),s&&(i.push(s),s=void 0),d>n&&i.push(l.slice(n-u,l.size,r)))}return i}function hv(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let s=t.docView.nearestDesc(n.focusNode),i=s&&s.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,u;if(Lg(n)){for(l=o;s&&!s.node;)s=s.parent;let f=s.node;if(s&&f.isAtom&&Kt.isSelectable(f)&&s.parent&&!(f.isInline&&MH(n.focusNode,n.focusOffset,s.dom))){let h=s.posBefore;u=new Kt(o==h?a:r.resolve(h))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let f=o,h=o;for(let p=0;p<n.rangeCount;p++){let m=n.getRangeAt(p);f=Math.min(f,t.docView.posFromDOM(m.startContainer,m.startOffset,1)),h=Math.max(h,t.docView.posFromDOM(m.endContainer,m.endOffset,-1))}if(f<0)return null;[l,o]=h==t.state.selection.anchor?[h,f]:[f,h],a=r.resolve(o)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let d=r.resolve(l);if(!u){let f=e=="pointer"||t.state.selection.head<a.pos&&!i?1:-1;u=pv(t,d,a,f)}return u}function EM(t){return t.editable?t.hasFocus():jM(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Bo(t,e=!1){let n=t.state.selection;if(NM(t,n),!!EM(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&zr){let r=t.domSelectionRange(),s=t.domObserver.currentSelection;if(r.anchorNode&&s.anchorNode&&Yl(r.anchorNode,r.anchorOffset,s.anchorNode,s.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)lV(t);else{let{anchor:r,head:s}=n,i,o;Z_&&!(n instanceof nn)&&(n.$from.parent.inlineContent||(i=eT(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=eT(t,n.to))),t.docView.setSelection(r,s,t,e),Z_&&(i&&tT(i),o&&tT(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&aV(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const Z_=hs||zr&&pM<63;function eT(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),s=r<n.childNodes.length?n.childNodes[r]:null,i=r?n.childNodes[r-1]:null;if(hs&&s&&s.contentEditable=="false")return uy(s);if((!s||s.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(s)return uy(s);if(i)return uy(i)}}function uy(t){return t.contentEditable="true",hs&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function tT(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function aV(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,s=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=s)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!EM(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function lV(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,Xr(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&zs&&Oa<=11&&(n.disabled=!0,n.disabled=!1)}function NM(t,e){if(e instanceof Kt){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(nT(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else nT(t)}function nT(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function pv(t,e,n,r){return t.someProp("createSelectionBetween",s=>s(t,e,n))||nn.between(e,n,r)}function rT(t){return t.editable&&!t.hasFocus()?!1:jM(t)}function jM(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function cV(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return Yl(e.node,e.offset,n.anchorNode,n.anchorOffset)}function B1(t,e){let{$anchor:n,$head:r}=t.selection,s=e>0?n.max(r):n.min(r),i=s.parent.inlineContent?s.depth?t.doc.resolve(e>0?s.after():s.before()):null:s;return i&&ln.findFrom(i,e)}function da(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function sT(t,e,n){let r=t.state.selection;if(r instanceof nn)if(n.indexOf("s")>-1){let{$head:s}=r,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let o=t.state.doc.resolve(s.pos+i.nodeSize*(e<0?-1:1));return da(t,new nn(r.$anchor,o))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let s=B1(t.state,e);return s&&s instanceof Kt?da(t,s):!1}else if(!(di&&n.indexOf("m")>-1)){let s=r.$head,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter,o;if(!i||i.isText)return!1;let a=e<0?s.pos-i.nodeSize:s.pos;return i.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?Kt.isSelectable(i)?da(t,new Kt(e<0?t.state.doc.resolve(s.pos-i.nodeSize):s)):Xf?da(t,new nn(t.state.doc.resolve(e<0?a:a+i.nodeSize))):!1:!1}}else return!1;else{if(r instanceof Kt&&r.node.isInline)return da(t,new nn(e>0?r.$to:r.$from));{let s=B1(t.state,e);return s?da(t,s):!1}}}function bm(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Ad(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function gc(t,e){return e<0?uV(t):dV(t)}function uV(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s,i,o=!1;for(ki&&n.nodeType==1&&r<bm(n)&&Ad(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(Ad(a,-1))s=n,i=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(IM(n))break;{let a=n.previousSibling;for(;a&&Ad(a,-1);)s=n.parentNode,i=Xr(a),a=a.previousSibling;if(a)n=a,r=bm(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?U1(t,n,r):s&&U1(t,s,i)}function dV(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s=bm(n),i,o;for(;;)if(r<s){if(n.nodeType!=1)break;let a=n.childNodes[r];if(Ad(a,1))i=n,o=++r;else break}else{if(IM(n))break;{let a=n.nextSibling;for(;a&&Ad(a,1);)i=a.parentNode,o=Xr(a)+1,a=a.nextSibling;if(a)n=a,r=0,s=bm(n);else{if(n=n.parentNode,n==t.dom)break;r=s=0}}}i&&U1(t,i,o)}function IM(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function fV(t,e){for(;t&&e==t.childNodes.length&&!Yf(t);)e=Xr(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function hV(t,e){for(;t&&!e&&!Yf(t);)e=Xr(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function U1(t,e,n){if(e.nodeType!=3){let i,o;(o=fV(e,n))?(e=o,n=0):(i=hV(e,n))&&(e=i,n=i.nodeValue.length)}let r=t.domSelection();if(!r)return;if(Lg(r)){let i=document.createRange();i.setEnd(e,n),i.setStart(e,n),r.removeAllRanges(),r.addRange(i)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:s}=t;setTimeout(()=>{t.state==s&&Bo(t)},50)}function iT(t,e){let n=t.state.doc.resolve(e);if(!(zr||mM)&&n.parent.inlineContent){let s=t.coordsAtPos(e);if(e>n.start()){let i=t.coordsAtPos(e-1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left<s.left?"ltr":"rtl"}if(e<n.end()){let i=t.coordsAtPos(e+1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left>s.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function oT(t,e,n){let r=t.state.selection;if(r instanceof nn&&!r.empty||n.indexOf("s")>-1||di&&n.indexOf("m")>-1)return!1;let{$from:s,$to:i}=r;if(!s.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=B1(t.state,e);if(o&&o instanceof Kt)return da(t,o)}if(!s.parent.inlineContent){let o=e<0?s:i,a=r instanceof vi?ln.near(o,e):ln.findFrom(o,e);return a?da(t,a):!1}return!1}function aT(t,e){if(!(t.state.selection instanceof nn))return!0;let{$head:n,$anchor:r,empty:s}=t.state.selection;if(!n.sameParent(r))return!0;if(!s)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let o=t.state.tr;return e<0?o.delete(n.pos-i.nodeSize,n.pos):o.delete(n.pos,n.pos+i.nodeSize),t.dispatch(o),!0}return!1}function lT(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function pV(t){if(!hs||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;lT(t,r,"true"),setTimeout(()=>lT(t,r,"false"),20)}return!1}function mV(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function gV(t,e){let n=e.keyCode,r=mV(e);if(n==8||di&&n==72&&r=="c")return aT(t,-1)||gc(t,-1);if(n==46&&!e.shiftKey||di&&n==68&&r=="c")return aT(t,1)||gc(t,1);if(n==13||n==27)return!0;if(n==37||di&&n==66&&r=="c"){let s=n==37?iT(t,t.state.selection.from)=="ltr"?-1:1:-1;return sT(t,s,r)||gc(t,s)}else if(n==39||di&&n==70&&r=="c"){let s=n==39?iT(t,t.state.selection.from)=="ltr"?1:-1:1;return sT(t,s,r)||gc(t,s)}else{if(n==38||di&&n==80&&r=="c")return oT(t,-1,r)||gc(t,-1);if(n==40||di&&n==78&&r=="c")return pV(t)||oT(t,1,r)||gc(t,1);if(r==(di?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function mv(t,e){t.someProp("transformCopied",p=>{e=p(e,t)});let n=[],{content:r,openStart:s,openEnd:i}=e;for(;s>1&&i>1&&r.childCount==1&&r.firstChild.childCount==1;){s--,i--;let p=r.firstChild;n.push(p.type.name,p.attrs!=p.type.defaultAttrs?p.attrs:null),r=p.content}let o=t.someProp("clipboardSerializer")||nc.fromSchema(t.state.schema),a=PM(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let u=l.firstChild,d,f=0;for(;u&&u.nodeType==1&&(d=OM[u.nodeName.toLowerCase()]);){for(let p=d.length-1;p>=0;p--){let m=a.createElement(d[p]);for(;l.firstChild;)m.appendChild(l.firstChild);l.appendChild(m),f++}u=l.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${s} ${i}${f?` -${f}`:""} ${JSON.stringify(n)}`);let h=t.someProp("clipboardTextSerializer",p=>p(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:h,slice:e}}function DM(t,e,n,r,s){let i=s.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=!!e&&(r||i||!n);if(l){if(t.someProp("transformPastedText",h=>{e=h(e,i||r,t)}),i)return a=new Lt(kt.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",h=>{a=h(a,t,!0)}),a;let f=t.someProp("clipboardTextParser",h=>h(e,s,r,t));if(f)a=f;else{let h=s.marks(),{schema:p}=t.state,m=nc.fromSchema(p);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(y=>{let x=o.appendChild(document.createElement("p"));y&&x.appendChild(m.serializeNode(p.text(y,h)))})}}else t.someProp("transformPastedHTML",f=>{n=f(n,t)}),o=wV(n),Xf&&vV(o);let u=o&&o.querySelector("[data-pm-slice]"),d=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let f=+d[3];f>0;f--){let h=o.firstChild;for(;h&&h.nodeType!=1;)h=h.nextSibling;if(!h)break;o=h}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||Ra.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||d),context:s,ruleFromNode(h){return h.nodeName=="BR"&&!h.nextSibling&&h.parentNode&&!yV.test(h.parentNode.nodeName)?{ignore:!0}:null}})),d)a=kV(cT(a,+d[1],+d[2]),d[4]);else if(a=Lt.maxOpen(xV(a.content,s),!0),a.openStart||a.openEnd){let f=0,h=0;for(let p=a.content.firstChild;f<a.openStart&&!p.type.spec.isolating;f++,p=p.firstChild);for(let p=a.content.lastChild;h<a.openEnd&&!p.type.spec.isolating;h++,p=p.lastChild);a=cT(a,f,h)}return t.someProp("transformPasted",f=>{a=f(a,t,l)}),a}const yV=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function xV(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let s=e.node(n).contentMatchAt(e.index(n)),i,o=[];if(t.forEach(a=>{if(!o)return;let l=s.findWrapping(a.type),u;if(!l)return o=null;if(u=o.length&&i.length&&MM(l,i,a,o[o.length-1],0))o[o.length-1]=u;else{o.length&&(o[o.length-1]=RM(o[o.length-1],i.length));let d=AM(a,l);o.push(d),s=s.matchType(d.type),i=l}}),o)return kt.from(o)}return t}function AM(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,kt.from(t));return t}function MM(t,e,n,r,s){if(s<t.length&&s<e.length&&t[s]==e[s]){let i=MM(t,e,n,r.lastChild,s+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(s==t.length-1?n.type:t[s+1]))return r.copy(r.content.append(kt.from(AM(n,t,s+1))))}}function RM(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,RM(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(kt.empty,!0);return t.copy(n.append(r))}function H1(t,e,n,r,s,i){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(i=0),s<r-1&&(a=H1(a,e,n,r,s+1,i)),s>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,i<=s).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(kt.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function cT(t,e,n){return e<t.openStart&&(t=new Lt(H1(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new Lt(H1(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const OM={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let uT=null;function PM(){return uT||(uT=document.implementation.createHTMLDocument("title"))}let dy=null;function bV(t){let e=window.trustedTypes;return e?(dy||(dy=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),dy.createHTML(t)):t}function wV(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=PM().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),s;if((s=r&&OM[r[1].toLowerCase()])&&(t=s.map(i=>"<"+i+">").join("")+t+s.map(i=>"</"+i+">").reverse().join("")),n.innerHTML=bV(t),s)for(let i=0;i<s.length;i++)n=n.querySelector(s[i])||n;return n}function vV(t){let e=t.querySelectorAll(zr?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==""&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function kV(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:s,openStart:i,openEnd:o}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;s=kt.from(l.create(r[a+1],s)),i++,o++}return new Lt(s,i,o)}const ks={},Ss={},SV={touchstart:!0,touchmove:!0};class _V{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function TV(t){for(let e in ks){let n=ks[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{EV(t,r)&&!gv(t,r)&&(t.editable||!(r.type in Ss))&&n(t,r)},SV[e]?{passive:!0}:void 0)}hs&&t.dom.addEventListener("input",()=>null),V1(t)}function _a(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function CV(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function V1(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>gv(t,r))})}function gv(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function EV(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function NV(t,e){!gv(t,e)&&ks[e.type]&&(t.editable||!(e.type in Ss))&&ks[e.type](t,e)}Ss.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!$M(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(Lo&&zr&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),vu&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",s=>s(t,bl(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||gV(t,n)?n.preventDefault():_a(t,"key")};Ss.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Ss.keypress=(t,e)=>{let n=e;if($M(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||di&&n.metaKey)return;if(t.someProp("handleKeyPress",s=>s(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof nn)||!r.$from.sameParent(r.$to)){let s=String.fromCharCode(n.charCode),i=()=>t.state.tr.insertText(s).scrollIntoView();!/[\r\n]/.test(s)&&!t.someProp("handleTextInput",o=>o(t,r.$from.pos,r.$to.pos,s,i))&&t.dispatch(i()),n.preventDefault()}};function zg(t){return{left:t.clientX,top:t.clientY}}function jV(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function yv(t,e,n,r,s){if(r==-1)return!1;let i=t.state.doc.resolve(r);for(let o=i.depth+1;o>0;o--)if(t.someProp(e,a=>o>i.depth?a(t,n,i.nodeAfter,i.before(o),s,!0):a(t,n,i.node(o),i.before(o),s,!1)))return!0;return!1}function ou(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);n=="pointer"&&r.setMeta("pointer",!0),t.dispatch(r)}function IV(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&Kt.isSelectable(r)?(ou(t,new Kt(n),"pointer"),!0):!1}function DV(t,e){if(e==-1)return!1;let n=t.state.selection,r,s;n instanceof Kt&&(r=n.node);let i=t.state.doc.resolve(e);for(let o=i.depth+1;o>0;o--){let a=o>i.depth?i.nodeAfter:i.node(o);if(Kt.isSelectable(a)){r&&n.$from.depth>0&&o>=n.$from.depth&&i.before(n.$from.depth+1)==n.$from.pos?s=i.before(n.$from.depth):s=i.before(o);break}}return s!=null?(ou(t,Kt.create(t.state.doc,s),"pointer"),!0):!1}function AV(t,e,n,r,s){return yv(t,"handleClickOn",e,n,r)||t.someProp("handleClick",i=>i(t,e,r))||(s?DV(t,n):IV(t,n))}function MV(t,e,n,r){return yv(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",s=>s(t,e,r))}function RV(t,e,n,r){return yv(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",s=>s(t,e,r))||OV(t,n,r)}function OV(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(ou(t,nn.create(r,0,r.content.size),"pointer"),!0):!1;let s=r.resolve(e);for(let i=s.depth+1;i>0;i--){let o=i>s.depth?s.nodeAfter:s.node(i),a=s.before(i);if(o.inlineContent)ou(t,nn.create(r,a+1,a+1+o.content.size),"pointer");else if(Kt.isSelectable(o))ou(t,Kt.create(r,a),"pointer");else continue;return!0}}function xv(t){return wm(t)}const LM=di?"metaKey":"ctrlKey";ks.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=xv(t),s=Date.now(),i="singleClick";s-t.input.lastClick.time<500&&jV(n,t.input.lastClick)&&!n[LM]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?i="doubleClick":t.input.lastClick.type=="doubleClick"&&(i="tripleClick")),t.input.lastClick={time:s,x:n.clientX,y:n.clientY,type:i,button:n.button};let o=t.posAtCoords(zg(n));o&&(i=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new PV(t,o,n,!!r)):(i=="doubleClick"?MV:RV)(t,o.pos,o.inside,n)?n.preventDefault():_a(t,"pointer"))};class PV{constructor(e,n,r,s){this.view=e,this.pos=n,this.event=r,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[LM],this.allowDefault=r.shiftKey;let i,o;if(n.inside>-1)i=e.state.doc.nodeAt(n.inside),o=n.inside;else{let d=e.state.doc.resolve(n.pos);i=d.parent,o=d.depth?d.before():0}const a=s?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:u}=e.state;(r.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||u instanceof Kt&&u.from<=o&&u.to>o)&&(this.mightDrag={node:i,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&ki&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),_a(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Bo(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(zg(e))),this.updateAllowDefault(e),this.allowDefault||!n?_a(this.view,"pointer"):AV(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||hs&&this.mightDrag&&!this.mightDrag.node.isAtom||zr&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(ou(this.view,ln.near(this.view.state.doc.resolve(n.pos)),"pointer"),e.preventDefault()):_a(this.view,"pointer")}move(e){this.updateAllowDefault(e),_a(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}ks.touchstart=t=>{t.input.lastTouch=Date.now(),xv(t),_a(t,"pointer")};ks.touchmove=t=>{t.input.lastTouch=Date.now(),_a(t,"pointer")};ks.contextmenu=t=>xv(t);function $M(t,e){return t.composing?!0:hs&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const LV=Lo?5e3:-1;Ss.compositionstart=Ss.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof nn&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)||zr&&mM&&$V(t)))t.markCursor=t.state.storedMarks||n.marks(),wm(t,!0),t.markCursor=null;else if(wm(t,!e.selection.empty),ki&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let s=r.focusNode,i=r.focusOffset;s&&s.nodeType==1&&i!=0;){let o=i<0?s.lastChild:s.childNodes[i-1];if(!o)break;if(o.nodeType==3){let a=t.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else s=o,i=-1}}t.input.composing=!0}zM(t,LV)};function $V(t){let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(!e||e.nodeType!=1||n>=e.childNodes.length)return!1;let r=e.childNodes[n];return r.nodeType==1&&r.contentEditable=="false"}Ss.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,zM(t,20))};function zM(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>wm(t),e))}function FM(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=FV());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function zV(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=DH(e.focusNode,e.focusOffset),r=AH(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let s=r.pmViewDesc,i=t.domObserver.lastChangedTextNode;if(n==i||r==i)return i;if(!s||!s.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let o=n.pmViewDesc;if(!(!o||!o.isText(n.nodeValue)))return r}}return n||r}function FV(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function wm(t,e=!1){if(!(Lo&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),FM(t),e||t.docView&&t.docView.dirty){let n=hv(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function BV(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),s=document.createRange();s.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(s),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const Tf=zs&&Oa<15||vu&&PH<604;ks.copy=Ss.cut=(t,e)=>{let n=e,r=t.state.selection,s=n.type=="cut";if(r.empty)return;let i=Tf?null:n.clipboardData,o=r.content(),{dom:a,text:l}=mv(t,o);i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):BV(t,a),s&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function UV(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function HV(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let s=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?Cf(t,r.value,null,s,e):Cf(t,r.textContent,r.innerHTML,s,e)},50)}function Cf(t,e,n,r,s){let i=DM(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,s,i||Lt.empty)))return!0;if(!i)return!1;let o=UV(i),a=o?t.state.tr.replaceSelectionWith(o,r):t.state.tr.replaceSelection(i);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function BM(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Ss.paste=(t,e)=>{let n=e;if(t.composing&&!Lo)return;let r=Tf?null:n.clipboardData,s=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&Cf(t,BM(r),r.getData("text/html"),s,n)?n.preventDefault():HV(t,n)};class UM{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const VV=di?"altKey":"ctrlKey";function HM(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[VV]}ks.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let s=t.state.selection,i=s.empty?null:t.posAtCoords(zg(n)),o;if(!(i&&i.pos>=s.from&&i.pos<=(s instanceof Kt?s.to-1:s.to))){if(r&&r.mightDrag)o=Kt.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let f=t.docView.nearestDesc(n.target,!0);f&&f.node.type.spec.draggable&&f!=t.docView&&(o=Kt.create(t.state.doc,f.posBefore))}}let a=(o||t.state.selection).content(),{dom:l,text:u,slice:d}=mv(t,a);(!n.dataTransfer.files.length||!zr||pM>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(Tf?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",Tf||n.dataTransfer.setData("text/plain",u),t.dragging=new UM(d,HM(t,n),o)};ks.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Ss.dragover=Ss.dragenter=(t,e)=>e.preventDefault();Ss.drop=(t,e)=>{try{WV(t,e,t.dragging)}finally{t.dragging=null}};function WV(t,e,n){if(!e.dataTransfer)return;let r=t.posAtCoords(zg(e));if(!r)return;let s=t.state.doc.resolve(r.pos),i=n&&n.slice;i?t.someProp("transformPasted",p=>{i=p(i,t,!1)}):i=DM(t,BM(e.dataTransfer),Tf?null:e.dataTransfer.getData("text/html"),!1,s);let o=!!(n&&HM(t,e));if(t.someProp("handleDrop",p=>p(t,e,i||Lt.empty,o))){e.preventDefault();return}if(!i)return;e.preventDefault();let a=i?iM(t.state.doc,s.pos,i):s.pos;a==null&&(a=s.pos);let l=t.state.tr;if(o){let{node:p}=n;p?p.replace(l):l.deleteSelection()}let u=l.mapping.map(a),d=i.openStart==0&&i.openEnd==0&&i.content.childCount==1,f=l.doc;if(d?l.replaceRangeWith(u,u,i.content.firstChild):l.replaceRange(u,u,i),l.doc.eq(f))return;let h=l.doc.resolve(u);if(d&&Kt.isSelectable(i.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(i.content.firstChild))l.setSelection(new Kt(h));else{let p=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach((m,y,x,g)=>p=g),l.setSelection(pv(t,h,l.doc.resolve(p)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}ks.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&Bo(t)},20))};ks.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};ks.beforeinput=(t,e)=>{if(zr&&Lo&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",i=>i(t,bl(8,"Backspace")))))return;let{$cursor:s}=t.state.selection;s&&s.pos>0&&t.dispatch(t.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let t in Ss)ks[t]=Ss[t];function Ef(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class vm{constructor(e,n){this.toDOM=e,this.spec=n||Fl,this.side=this.spec.side||0}map(e,n,r,s){let{pos:i,deleted:o}=e.mapResult(n.from+s,this.side<0?-1:1);return o?null:new Os(i-r,i-r,this)}valid(){return!0}eq(e){return this==e||e instanceof vm&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Ef(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class La{constructor(e,n){this.attrs=e,this.spec=n||Fl}map(e,n,r,s){let i=e.map(n.from+s,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+s,this.spec.inclusiveEnd?1:-1)-r;return i>=o?null:new Os(i,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof La&&Ef(this.attrs,e.attrs)&&Ef(this.spec,e.spec)}static is(e){return e.type instanceof La}destroy(){}}class bv{constructor(e,n){this.attrs=e,this.spec=n||Fl}map(e,n,r,s){let i=e.mapResult(n.from+s,1);if(i.deleted)return null;let o=e.mapResult(n.to+s,-1);return o.deleted||o.pos<=i.pos?null:new Os(i.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:s}=e.content.findIndex(n.from),i;return s==n.from&&!(i=e.child(r)).isText&&s+i.nodeSize==n.to}eq(e){return this==e||e instanceof bv&&Ef(this.attrs,e.attrs)&&Ef(this.spec,e.spec)}destroy(){}}class Os{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new Os(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new Os(e,e,new vm(n,r))}static inline(e,n,r,s){return new Os(e,n,new La(r,s))}static node(e,n,r,s){return new Os(e,n,new bv(r,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof La}get widget(){return this.type instanceof vm}}const Tc=[],Fl={};class yr{constructor(e,n){this.local=e.length?e:Tc,this.children=n.length?n:Tc}static create(e,n){return n.length?km(n,e,0,Fl):as}find(e,n,r){let s=[];return this.findInner(e??0,n??1e9,s,0,r),s}findInner(e,n,r,s,i){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!i||i(a.spec))&&r.push(a.copy(a.from+s,a.to+s))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,r,s+a,i)}}map(e,n,r){return this==as||e.maps.length==0?this:this.mapInner(e,n,0,0,r||Fl)}mapInner(e,n,r,s,i){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,s);l&&l.type.valid(n,l)?(o||(o=[])).push(l):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?KV(this.children,o||[],e,n,r,s,i):o?new yr(o.sort(Bl),Tc):as}add(e,n){return n.length?this==as?yr.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let s,i=0;e.forEach((a,l)=>{let u=l+r,d;if(d=WM(n,a,u)){for(s||(s=this.children.slice());i<s.length&&s[i]<l;)i+=3;s[i]==l?s[i+2]=s[i+2].addInner(a,d,u+1):s.splice(i,0,l,l+a.nodeSize,km(d,a,u+1,Fl)),i+=3}});let o=VM(i?KM(n):n,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new yr(o.length?this.local.concat(o).sort(Bl):this.local,s||this.children)}remove(e){return e.length==0||this==as?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,s=this.local;for(let i=0;i<r.length;i+=3){let o,a=r[i]+n,l=r[i+1]+n;for(let d=0,f;d<e.length;d++)(f=e[d])&&f.from>a&&f.to<l&&(e[d]=null,(o||(o=[])).push(f));if(!o)continue;r==this.children&&(r=this.children.slice());let u=r[i+2].removeInner(o,a+1);u!=as?r[i+2]=u:(r.splice(i,3),i-=3)}if(s.length){for(let i=0,o;i<e.length;i++)if(o=e[i])for(let a=0;a<s.length;a++)s[a].eq(o,n)&&(s==this.local&&(s=this.local.slice()),s.splice(a--,1))}return r==this.children&&s==this.local?this:s.length||r.length?new yr(s,r):as}forChild(e,n){if(this==as)return this;if(n.isLeaf)return yr.empty;let r,s;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let i=e+1,o=i+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>i&&l.type instanceof La){let u=Math.max(i,l.from)-i,d=Math.min(o,l.to)-i;u<d&&(s||(s=[])).push(l.copy(u,d))}}if(s){let a=new yr(s.sort(Bl),Tc);return r?new xa([a,r]):a}return r||as}eq(e){if(this==e)return!0;if(!(e instanceof yr)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return wv(this.localsInner(e))}localsInner(e){if(this==as)return Tc;if(e.inlineContent||!this.local.some(La.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof La||n.push(this.local[r]);return n}forEachSet(e){e(this)}}yr.empty=new yr([],[]);yr.removeOverlap=wv;const as=yr.empty;class xa{constructor(e){this.members=e}map(e,n){const r=this.members.map(s=>s.map(e,n,Fl));return xa.from(r)}forChild(e,n){if(n.isLeaf)return yr.empty;let r=[];for(let s=0;s<this.members.length;s++){let i=this.members[s].forChild(e,n);i!=as&&(i instanceof xa?r=r.concat(i.members):r.push(i))}return xa.from(r)}eq(e){if(!(e instanceof xa)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let s=0;s<this.members.length;s++){let i=this.members[s].localsInner(e);if(i.length)if(!n)n=i;else{r&&(n=n.slice(),r=!1);for(let o=0;o<i.length;o++)n.push(i[o])}}return n?wv(r?n:n.sort(Bl)):Tc}static from(e){switch(e.length){case 0:return as;case 1:return e[0];default:return new xa(e.every(n=>n instanceof yr)?e:e.reduce((n,r)=>n.concat(r instanceof yr?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function KV(t,e,n,r,s,i,o){let a=t.slice();for(let u=0,d=i;u<n.maps.length;u++){let f=0;n.maps[u].forEach((h,p,m,y)=>{let x=y-m-(p-h);for(let g=0;g<a.length;g+=3){let v=a[g+1];if(v<0||h>v+d-f)continue;let w=a[g]+d-f;p>=w?a[g+1]=h<=w?-2:-1:h>=d&&x&&(a[g]+=x,a[g+1]+=x)}f+=x}),d=n.maps[u].map(d,-1)}let l=!1;for(let u=0;u<a.length;u+=3)if(a[u+1]<0){if(a[u+1]==-2){l=!0,a[u+1]=-1;continue}let d=n.map(t[u]+i),f=d-s;if(f<0||f>=r.content.size){l=!0;continue}let h=n.map(t[u+1]+i,-1),p=h-s,{index:m,offset:y}=r.content.findIndex(f),x=r.maybeChild(m);if(x&&y==f&&y+x.nodeSize==p){let g=a[u+2].mapInner(n,x,d+1,t[u]+i+1,o);g!=as?(a[u]=f,a[u+1]=p,a[u+2]=g):(a[u+1]=-2,l=!0)}else l=!0}if(l){let u=GV(a,t,e,n,s,i,o),d=km(u,r,0,o);e=d.local;for(let f=0;f<a.length;f+=3)a[f+1]<0&&(a.splice(f,3),f-=3);for(let f=0,h=0;f<d.children.length;f+=3){let p=d.children[f];for(;h<a.length&&a[h]<p;)h+=3;a.splice(h,0,d.children[f],d.children[f+1],d.children[f+2])}}return new yr(e.sort(Bl),a)}function VM(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let s=t[r];n.push(new Os(s.from+e,s.to+e,s.type))}return n}function GV(t,e,n,r,s,i,o){function a(l,u){for(let d=0;d<l.local.length;d++){let f=l.local[d].map(r,s,u);f?n.push(f):o.onRemove&&o.onRemove(l.local[d].spec)}for(let d=0;d<l.children.length;d+=3)a(l.children[d+2],l.children[d]+u+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+i+1);return n}function WM(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,s=null;for(let i=0,o;i<t.length;i++)(o=t[i])&&o.from>n&&o.to<r&&((s||(s=[])).push(o),t[i]=null);return s}function KM(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function km(t,e,n,r){let s=[],i=!1;e.forEach((a,l)=>{let u=WM(t,a,l+n);if(u){i=!0;let d=km(u,a,n+l+1,r);d!=as&&s.push(l,l+a.nodeSize,d)}});let o=VM(i?KM(t):t,-n).sort(Bl);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||s.length?new yr(o,s):as}function Bl(t,e){return t.from-e.from||t.to-e.to}function wv(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let s=n+1;s<e.length;s++){let i=e[s];if(i.from==r.from){i.to!=r.to&&(e==t&&(e=t.slice()),e[s]=i.copy(i.from,r.to),dT(e,s+1,i.copy(r.to,i.to)));continue}else{i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),dT(e,s,r.copy(i.from,r.to)));break}}}return e}function dT(t,e,n){for(;e<t.length&&Bl(n,t[e])>0;)e++;t.splice(e,0,n)}function fy(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=as&&e.push(r)}),t.cursorWrapper&&e.push(yr.create(t.state.doc,[t.cursorWrapper.deco])),xa.from(e)}const qV={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},JV=zs&&Oa<=11;class YV{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class XV{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new YV,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let s=0;s<r.length;s++)this.queue.push(r[s]);zs&&Oa<=11&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),JV&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,qV)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(rT(this.view)){if(this.suppressingSelectionUpdates)return Bo(this.view);if(zs&&Oa<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Yl(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let i=e.focusNode;i;i=wu(i))n.add(i);for(let i=e.anchorNode;i;i=wu(i))if(n.has(i)){r=i;break}let s=r&&this.view.docView.nearestDesc(r);if(s&&s.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&rT(e)&&!this.ignoreSelectionChange(r),i=-1,o=-1,a=!1,l=[];if(e.editable)for(let d=0;d<n.length;d++){let f=this.registerMutation(n[d],l);f&&(i=i<0?f.from:Math.min(f.from,i),o=o<0?f.to:Math.max(f.to,o),f.typeOver&&(a=!0))}if(ki&&l.length){let d=l.filter(f=>f.nodeName=="BR");if(d.length==2){let[f,h]=d;f.parentNode&&f.parentNode.parentNode==h.parentNode?h.remove():f.remove()}else{let{focusNode:f}=this.currentSelection;for(let h of d){let p=h.parentNode;p&&p.nodeName=="LI"&&(!f||e7(e,f)!=p)&&h.remove()}}}else if((zr||hs)&&l.some(d=>d.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let d of l)if(d.nodeName=="BR"&&d.parentNode){let f=d.nextSibling;f&&f.nodeType==1&&f.contentEditable=="false"&&d.parentNode.removeChild(d)}}let u=null;i<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Lg(r)&&(u=hv(e))&&u.eq(ln.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Bo(e),this.currentSelection.set(r),e.scrollToSelection()):(i>-1||s)&&(i>-1&&(e.docView.markDirty(i,o),QV(e)),this.handleDOMChange(i,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||Bo(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let d=0;d<e.addedNodes.length;d++){let f=e.addedNodes[d];n.push(f),f.nodeType==3&&(this.lastChangedTextNode=f)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let s=e.previousSibling,i=e.nextSibling;if(zs&&Oa<=11&&e.addedNodes.length)for(let d=0;d<e.addedNodes.length;d++){let{previousSibling:f,nextSibling:h}=e.addedNodes[d];(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(s=f),(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(i=h)}let o=s&&s.parentNode==e.target?Xr(s)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=i&&i.parentNode==e.target?Xr(i):e.target.childNodes.length,u=r.localPosFromDOM(e.target,l,1);return{from:a,to:u}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let fT=new WeakMap,hT=!1;function QV(t){if(!fT.has(t)&&(fT.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=ki,hT)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),hT=!0}}function pT(t,e){let n=e.startContainer,r=e.startOffset,s=e.endContainer,i=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return Yl(o.node,o.offset,s,i)&&([n,r,s,i]=[s,i,n,r]),{anchorNode:n,anchorOffset:r,focusNode:s,focusOffset:i}}function ZV(t,e){if(e.getComposedRanges){let s=e.getComposedRanges(t.root)[0];if(s)return pT(t,s)}let n;function r(s){s.preventDefault(),s.stopImmediatePropagation(),n=s.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?pT(t,n):null}function e7(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function t7(t,e,n){let{node:r,fromOffset:s,toOffset:i,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),u,d=l.anchorNode;if(d&&t.dom.contains(d.nodeType==1?d:d.parentNode)&&(u=[{node:d,offset:l.anchorOffset}],Lg(l)||u.push({node:l.focusNode,offset:l.focusOffset})),zr&&t.input.lastKeyCode===8)for(let x=i;x>s;x--){let g=r.childNodes[x-1],v=g.pmViewDesc;if(g.nodeName=="BR"&&!v){i=x;break}if(!v||v.size)break}let f=t.state.doc,h=t.someProp("domParser")||Ra.fromSchema(t.state.schema),p=f.resolve(o),m=null,y=h.parse(r,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:s,to:i,preserveWhitespace:p.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:n7,context:p});if(u&&u[0].pos!=null){let x=u[0].pos,g=u[1]&&u[1].pos;g==null&&(g=x),m={anchor:x+o,head:g+o}}return{doc:y,sel:m,from:o,to:a}}function n7(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(hs&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||hs&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const r7=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function s7(t,e,n,r,s){let i=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let R=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,C=hv(t,R);if(C&&!t.state.selection.eq(C)){if(zr&&Lo&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",_=>_(t,bl(13,"Enter"))))return;let T=t.state.tr.setSelection(C);R=="pointer"?T.setMeta("pointer",!0):R=="key"&&T.scrollIntoView(),i&&T.setMeta("composition",i),t.dispatch(T)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l=t.state.selection,u=t7(t,e,n),d=t.state.doc,f=d.slice(u.from,u.to),h,p;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(h=t.state.selection.to,p="end"):(h=t.state.selection.from,p="start"),t.input.lastKeyCode=null;let m=a7(f.content,u.doc.content,u.from,h,p);if(m&&t.input.domChangeCount++,(vu&&t.input.lastIOSEnter>Date.now()-225||Lo)&&s.some(R=>R.nodeType==1&&!r7.test(R.nodeName))&&(!m||m.endA>=m.endB)&&t.someProp("handleKeyDown",R=>R(t,bl(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!m)if(r&&l instanceof nn&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))m={start:l.from,endA:l.to,endB:l.to};else{if(u.sel){let R=mT(t,t.state.doc,u.sel);if(R&&!R.eq(t.state.selection)){let C=t.state.tr.setSelection(R);i&&C.setMeta("composition",i),t.dispatch(C)}}return}t.state.selection.from<t.state.selection.to&&m.start==m.endB&&t.state.selection instanceof nn&&(m.start>t.state.selection.from&&m.start<=t.state.selection.from+2&&t.state.selection.from>=u.from?m.start=t.state.selection.from:m.endA<t.state.selection.to&&m.endA>=t.state.selection.to-2&&t.state.selection.to<=u.to&&(m.endB+=t.state.selection.to-m.endA,m.endA=t.state.selection.to)),zs&&Oa<=11&&m.endB==m.start+1&&m.endA==m.start&&m.start>u.from&&u.doc.textBetween(m.start-u.from-1,m.start-u.from+1)==" "&&(m.start--,m.endA--,m.endB--);let y=u.doc.resolveNoCache(m.start-u.from),x=u.doc.resolveNoCache(m.endB-u.from),g=d.resolve(m.start),v=y.sameParent(x)&&y.parent.inlineContent&&g.end()>=m.endA;if((vu&&t.input.lastIOSEnter>Date.now()-225&&(!v||s.some(R=>R.nodeName=="DIV"||R.nodeName=="P"))||!v&&y.pos<u.doc.content.size&&(!y.sameParent(x)||!y.parent.inlineContent)&&y.pos<x.pos&&!/\S/.test(u.doc.textBetween(y.pos,x.pos,"","")))&&t.someProp("handleKeyDown",R=>R(t,bl(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>m.start&&o7(d,m.start,m.endA,y,x)&&t.someProp("handleKeyDown",R=>R(t,bl(8,"Backspace")))){Lo&&zr&&t.domObserver.suppressSelectionUpdates();return}zr&&m.endB==m.start&&(t.input.lastChromeDelete=Date.now()),Lo&&!v&&y.start()!=x.start()&&x.parentOffset==0&&y.depth==x.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==m.endA&&(m.endB-=2,x=u.doc.resolveNoCache(m.endB-u.from),setTimeout(()=>{t.someProp("handleKeyDown",function(R){return R(t,bl(13,"Enter"))})},20));let w=m.start,S=m.endA,I=R=>{let C=R||t.state.tr.replace(w,S,u.doc.slice(m.start-u.from,m.endB-u.from));if(u.sel){let T=mT(t,C.doc,u.sel);T&&!(zr&&t.composing&&T.empty&&(m.start!=m.endB||t.input.lastChromeDelete<Date.now()-100)&&(T.head==w||T.head==C.mapping.map(S)-1)||zs&&T.empty&&T.head==w)&&C.setSelection(T)}return i&&C.setMeta("composition",i),C.scrollIntoView()},k;if(v)if(y.pos==x.pos){zs&&Oa<=11&&y.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>Bo(t),20));let R=I(t.state.tr.delete(w,S)),C=d.resolve(m.start).marksAcross(d.resolve(m.endA));C&&R.ensureMarks(C),t.dispatch(R)}else if(m.endA==m.endB&&(k=i7(y.parent.content.cut(y.parentOffset,x.parentOffset),g.parent.content.cut(g.parentOffset,m.endA-g.start())))){let R=I(t.state.tr);k.type=="add"?R.addMark(w,S,k.mark):R.removeMark(w,S,k.mark),t.dispatch(R)}else if(y.parent.child(y.index()).isText&&y.index()==x.index()-(x.textOffset?0:1)){let R=y.parent.textBetween(y.parentOffset,x.parentOffset),C=()=>I(t.state.tr.insertText(R,w,S));t.someProp("handleTextInput",T=>T(t,w,S,R,C))||t.dispatch(C())}else t.dispatch(I());else t.dispatch(I())}function mT(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:pv(t,e.resolve(n.anchor),e.resolve(n.head))}function i7(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,s=n,i=r,o,a,l;for(let d=0;d<r.length;d++)s=r[d].removeFromSet(s);for(let d=0;d<n.length;d++)i=n[d].removeFromSet(i);if(s.length==1&&i.length==0)a=s[0],o="add",l=d=>d.mark(a.addToSet(d.marks));else if(s.length==0&&i.length==1)a=i[0],o="remove",l=d=>d.mark(a.removeFromSet(d.marks));else return null;let u=[];for(let d=0;d<e.childCount;d++)u.push(l(e.child(d)));if(kt.from(u).eq(t))return{mark:a,type:o}}function o7(t,e,n,r,s){if(n-e<=s.pos-r.pos||hy(r,!0,!1)<s.pos)return!1;let i=t.resolve(e);if(!r.parent.isTextblock){let a=i.nodeAfter;return a!=null&&n==e+a.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=t.resolve(hy(i,!0,!0));return!o.parent.isTextblock||o.pos>n||hy(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function hy(t,e,n){let r=t.depth,s=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,s++,e=!1;if(n){let i=t.node(r).maybeChild(t.indexAfter(r));for(;i&&!i.isLeaf;)i=i.firstChild,s++}return s}function a7(t,e,n,r,s){let i=t.findDiffStart(e,n);if(i==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(s=="end"){let l=Math.max(0,i-Math.min(o,a));r-=o+l-i}if(o<i&&t.size<e.size){let l=r<=i&&r>=o?i-r:0;i-=l,i&&i<e.size&&gT(e.textBetween(i-1,i+1))&&(i+=l?1:-1),a=i+(a-o),o=i}else if(a<i){let l=r<=i&&r>=a?i-r:0;i-=l,i&&i<t.size&&gT(t.textBetween(i-1,i+1))&&(i+=l?1:-1),o=i+(o-a),a=i}return{start:i,endA:o,endB:a}}function gT(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class GM{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new _V,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(vT),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=bT(this),xT(this),this.nodeViews=wT(this),this.docView=X_(this.state.doc,yT(this),fy(this),this.dom,this),this.domObserver=new XV(this,(r,s,i,o)=>s7(this,r,s,i,o)),this.domObserver.start(),TV(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&V1(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(vT),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let s=this.state,i=!1,o=!1;e.storedMarks&&this.composing&&(FM(this),o=!0),this.state=e;let a=s.plugins!=e.plugins||this._props.plugins!=n.plugins;if(a||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let p=wT(this);c7(p,this.nodeViews)&&(this.nodeViews=p,i=!0)}(a||n.handleDOMEvents!=this._props.handleDOMEvents)&&V1(this),this.editable=bT(this),xT(this);let l=fy(this),u=yT(this),d=s.plugins!=e.plugins&&!s.doc.eq(e.doc)?"reset":e.scrollToSelection>s.scrollToSelection?"to selection":"preserve",f=i||!this.docView.matchesNode(e.doc,u,l);(f||!e.selection.eq(s.selection))&&(o=!0);let h=d=="preserve"&&o&&this.dom.style.overflowAnchor==null&&zH(this);if(o){this.domObserver.stop();let p=f&&(zs||zr)&&!this.composing&&!s.selection.empty&&!e.selection.empty&&l7(s.selection,e.selection);if(f){let m=zr?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=zV(this)),(i||!this.docView.update(e.doc,u,l,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=X_(e.doc,u,l,this.dom,this)),m&&!this.trackWrites&&(p=!0)}p||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&cV(this))?Bo(this,p):(NM(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),!((r=this.dragging)===null||r===void 0)&&r.node&&!s.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,s),d=="reset"?this.dom.scrollTop=0:d=="to selection"?this.scrollToSelection():h&&FH(h)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof Kt){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&W_(this,n.getBoundingClientRect(),e)}else W_(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,s=-1;if(this.state.doc.nodeAt(r.from)==r.node)s=r.from;else{let i=r.from+(this.state.doc.content.size-n.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==r.node&&(s=i)}this.dragging=new UM(e.slice,e.move,s<0?void 0:Kt.create(this.state.doc,s))}someProp(e,n){let r=this._props&&this._props[e],s;if(r!=null&&(s=n?n(r):r))return s;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(s=n?n(a):a))return s}let i=this.state.plugins;if(i)for(let o=0;o<i.length;o++){let a=i[o].props[e];if(a!=null&&(s=n?n(a):a))return s}}hasFocus(){if(zs){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&BH(this.dom),Bo(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return KH(this,e)}coordsAtPos(e,n=1){return wM(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let s=this.docView.posFromDOM(e,n,r);if(s==null)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(e,n){return XH(this,n||this.state,e)}pasteHTML(e,n){return Cf(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return Cf(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return mv(this,e)}destroy(){this.docView&&(CV(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],fy(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,jH())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return NV(this,e)}domSelectionRange(){let e=this.domSelection();return e?hs&&this.root.nodeType===11&&RH(this.dom.ownerDocument)==this.dom&&ZV(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}GM.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function yT(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[Os.node(0,t.state.doc.content.size,e)]}function xT(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:Os.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function bT(t){return!t.someProp("editable",e=>e(t.state)===!1)}function l7(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function wT(t){let e=Object.create(null);function n(r){for(let s in r)Object.prototype.hasOwnProperty.call(e,s)||(e[s]=r[s])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function c7(t,e){let n=0,r=0;for(let s in t){if(t[s]!=e[s])return!0;n++}for(let s in e)r++;return n!=r}function vT(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Va={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Sm={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},u7=typeof navigator<"u"&&/Mac/.test(navigator.platform),d7=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Qr=0;Qr<10;Qr++)Va[48+Qr]=Va[96+Qr]=String(Qr);for(var Qr=1;Qr<=24;Qr++)Va[Qr+111]="F"+Qr;for(var Qr=65;Qr<=90;Qr++)Va[Qr]=String.fromCharCode(Qr+32),Sm[Qr]=String.fromCharCode(Qr);for(var py in Va)Sm.hasOwnProperty(py)||(Sm[py]=Va[py]);function f7(t){var e=u7&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||d7&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?Sm:Va)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const h7=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),p7=typeof navigator<"u"&&/Win/.test(navigator.platform);function m7(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,s,i,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))h7?o=!0:s=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),s&&(n="Ctrl-"+n),o&&(n="Meta-"+n),i&&(n="Shift-"+n),n}function g7(t){let e=Object.create(null);for(let n in t)e[m7(n)]=t[n];return e}function my(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function y7(t){return new Tr({props:{handleKeyDown:qM(t)}})}function qM(t){let e=g7(t);return function(n,r){let s=f7(r),i,o=e[my(s,r)];if(o&&o(n.state,n.dispatch,n))return!0;if(s.length==1&&s!=" "){if(r.shiftKey){let a=e[my(s,r,!1)];if(a&&a(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(p7&&r.ctrlKey&&r.altKey)&&(i=Va[r.keyCode])&&i!=s){let a=e[my(i,r)];if(a&&a(n.state,n.dispatch,n))return!0}}return!1}}const x7=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function JM(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const b7=(t,e,n)=>{let r=JM(t,n);if(!r)return!1;let s=vv(r);if(!s){let o=r.blockRange(),a=o&&Ou(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let i=s.nodeBefore;if(ZM(t,s,e,-1))return!0;if(r.parent.content.size==0&&(ku(i,"end")||Kt.isSelectable(i)))for(let o=r.depth;;o--){let a=Og(t.doc,r.before(o),r.after(o),Lt.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(ku(i,"end")?ln.findFrom(l.doc.resolve(l.mapping.map(s.pos,-1)),-1):Kt.create(l.doc,s.pos-i.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos-i.nodeSize,s.pos).scrollIntoView()),!0):!1},w7=(t,e,n)=>{let r=JM(t,n);if(!r)return!1;let s=vv(r);return s?YM(t,s,e):!1},v7=(t,e,n)=>{let r=XM(t,n);if(!r)return!1;let s=kv(r);return s?YM(t,s,e):!1};function YM(t,e,n){let r=e.nodeBefore,s=r,i=e.pos-1;for(;!s.isTextblock;i--){if(s.type.spec.isolating)return!1;let d=s.lastChild;if(!d)return!1;s=d}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let d=a.firstChild;if(!d)return!1;a=d}let u=Og(t.doc,i,l,Lt.empty);if(!u||u.from!=i||u instanceof $r&&u.slice.size>=l-i)return!1;if(n){let d=t.tr.step(u);d.setSelection(nn.create(d.doc,i)),n(d.scrollIntoView())}return!0}function ku(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const k7=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;i=vv(r)}let o=i&&i.nodeBefore;return!o||!Kt.isSelectable(o)?!1:(e&&e(t.tr.setSelection(Kt.create(t.doc,i.pos-o.nodeSize)).scrollIntoView()),!0)};function vv(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function XM(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const S7=(t,e,n)=>{let r=XM(t,n);if(!r)return!1;let s=kv(r);if(!s)return!1;let i=s.nodeAfter;if(ZM(t,s,e,1))return!0;if(r.parent.content.size==0&&(ku(i,"start")||Kt.isSelectable(i))){let o=Og(t.doc,r.before(),r.after(),Lt.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(ku(i,"start")?ln.findFrom(a.doc.resolve(a.mapping.map(s.pos)),1):Kt.create(a.doc,a.mapping.map(s.pos))),e(a.scrollIntoView())}return!0}}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos,s.pos+i.nodeSize).scrollIntoView()),!0):!1},_7=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;i=kv(r)}let o=i&&i.nodeAfter;return!o||!Kt.isSelectable(o)?!1:(e&&e(t.tr.setSelection(Kt.create(t.doc,i.pos)).scrollIntoView()),!0)};function kv(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const T7=(t,e)=>{let n=t.selection,r=n instanceof Kt,s;if(r){if(n.node.isTextblock||!Xa(t.doc,n.from))return!1;s=n.from}else if(s=Rg(t.doc,n.from,-1),s==null)return!1;if(e){let i=t.tr.join(s);r&&i.setSelection(Kt.create(i.doc,s-t.doc.resolve(s).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},C7=(t,e)=>{let n=t.selection,r;if(n instanceof Kt){if(n.node.isTextblock||!Xa(t.doc,n.to))return!1;r=n.to}else if(r=Rg(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},E7=(t,e)=>{let{$from:n,$to:r}=t.selection,s=n.blockRange(r),i=s&&Ou(s);return i==null?!1:(e&&e(t.tr.lift(s,i).scrollIntoView()),!0)},N7=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function QM(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const j7=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let s=n.node(-1),i=n.indexAfter(-1),o=QM(s.contentMatchAt(i));if(!o||!s.canReplaceWith(i,i,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(ln.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},I7=(t,e)=>{let n=t.selection,{$from:r,$to:s}=n;if(n instanceof vi||r.parent.inlineContent||s.parent.inlineContent)return!1;let i=QM(s.parent.contentMatchAt(s.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let o=(!r.parentOffset&&s.index()<s.parent.childCount?r:s).pos,a=t.tr.insert(o,i.createAndFill());a.setSelection(nn.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},D7=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let i=n.before();if(su(t.doc,i))return e&&e(t.tr.split(i).scrollIntoView()),!0}let r=n.blockRange(),s=r&&Ou(r);return s==null?!1:(e&&e(t.tr.lift(r,s).scrollIntoView()),!0)},A7=(t,e)=>{let{$from:n,to:r}=t.selection,s,i=n.sharedDepth(r);return i==0?!1:(s=n.before(i),e&&e(t.tr.setSelection(Kt.create(t.doc,s))),!0)};function M7(t,e,n){let r=e.nodeBefore,s=e.nodeAfter,i=e.index();return!r||!s||!r.type.compatibleContent(s.type)?!1:!r.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(s.isTextblock||Xa(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function ZM(t,e,n,r){let s=e.nodeBefore,i=e.nodeAfter,o,a,l=s.type.spec.isolating||i.type.spec.isolating;if(!l&&M7(t,e,n))return!0;let u=!l&&e.parent.canReplace(e.index(),e.index()+1);if(u&&(o=(a=s.contentMatchAt(s.childCount)).findWrapping(i.type))&&a.matchType(o[0]||i.type).validEnd){if(n){let p=e.pos+i.nodeSize,m=kt.empty;for(let g=o.length-1;g>=0;g--)m=kt.from(o[g].create(null,m));m=kt.from(s.copy(m));let y=t.tr.step(new Br(e.pos-1,p,e.pos,p,new Lt(m,1,0),o.length,!0)),x=y.doc.resolve(p+2*o.length);x.nodeAfter&&x.nodeAfter.type==s.type&&Xa(y.doc,x.pos)&&y.join(x.pos),n(y.scrollIntoView())}return!0}let d=i.type.spec.isolating||r>0&&l?null:ln.findFrom(e,1),f=d&&d.$from.blockRange(d.$to),h=f&&Ou(f);if(h!=null&&h>=e.depth)return n&&n(t.tr.lift(f,h).scrollIntoView()),!0;if(u&&ku(i,"start",!0)&&ku(s,"end")){let p=s,m=[];for(;m.push(p),!p.isTextblock;)p=p.lastChild;let y=i,x=1;for(;!y.isTextblock;y=y.firstChild)x++;if(p.canReplace(p.childCount,p.childCount,y.content)){if(n){let g=kt.empty;for(let w=m.length-1;w>=0;w--)g=kt.from(m[w].copy(g));let v=t.tr.step(new Br(e.pos-m.length,e.pos+i.nodeSize,e.pos+x,e.pos+i.nodeSize-x,new Lt(g,m.length,0),0,!0));n(v.scrollIntoView())}return!0}}return!1}function e5(t){return function(e,n){let r=e.selection,s=t<0?r.$from:r.$to,i=s.depth;for(;s.node(i).isInline;){if(!i)return!1;i--}return s.node(i).isTextblock?(n&&n(e.tr.setSelection(nn.create(e.doc,t<0?s.start(i):s.end(i)))),!0):!1}}const R7=e5(-1),O7=e5(1);function P7(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,o=s.blockRange(i),a=o&&uv(o,t,e);return a?(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function kT(t,e=null){return function(n,r){let s=!1;for(let i=0;i<n.selection.ranges.length&&!s;i++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[i];n.doc.nodesBetween(o,a,(l,u)=>{if(s)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)s=!0;else{let d=n.doc.resolve(u),f=d.index();s=d.parent.canReplaceWith(f,f+1,t)}})}if(!s)return!1;if(r){let i=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[o];i.setBlockType(a,l,t,e)}r(i.scrollIntoView())}return!0}}typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function L7(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,o=s.blockRange(i);if(!o)return!1;let a=r?n.tr:null;return $7(a,o,t,e)?(r&&r(a.scrollIntoView()),!0):!1}}function $7(t,e,n,r=null){let s=!1,i=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);i=new gm(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new gm(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),s=!0}let a=uv(i,n,r,e);return a?(t&&z7(t,e,a,s,n),!0):!1}function z7(t,e,n,r,s){let i=kt.empty;for(let d=n.length-1;d>=0;d--)i=kt.from(n[d].type.create(n[d].attrs,i));t.step(new Br(e.start-(r?2:0),e.end,e.start,e.end,new Lt(i,0,0),n.length,!0));let o=0;for(let d=0;d<n.length;d++)n[d].type==s&&(o=d+1);let a=n.length-o,l=e.start+n.length-(r?2:0),u=e.parent;for(let d=e.startIndex,f=e.endIndex,h=!0;d<f;d++,h=!1)!h&&su(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=u.child(d).nodeSize;return t}function F7(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,o=>o.childCount>0&&o.firstChild.type==t);return i?n?r.node(i.depth-1).type==t?B7(e,n,t,i):U7(e,n,i):!0:!1}}function B7(t,e,n,r){let s=t.tr,i=r.end,o=r.$to.end(r.depth);i<o&&(s.step(new Br(i-1,o,i,o,new Lt(kt.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new gm(s.doc.resolve(r.$from.pos),s.doc.resolve(o),r.depth));const a=Ou(r);if(a==null)return!1;s.lift(r,a);let l=s.doc.resolve(s.mapping.map(i,-1)-1);return Xa(s.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&s.join(l.pos),e(s.scrollIntoView()),!0}function U7(t,e,n){let r=t.tr,s=n.parent;for(let p=n.end,m=n.endIndex-1,y=n.startIndex;m>y;m--)p-=s.child(m).nodeSize,r.delete(p-1,p+1);let i=r.doc.resolve(n.start),o=i.nodeAfter;if(r.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==s.childCount,u=i.node(-1),d=i.index(-1);if(!u.canReplace(d+(a?0:1),d+1,o.content.append(l?kt.empty:kt.from(s))))return!1;let f=i.pos,h=f+o.nodeSize;return r.step(new Br(f-(a?1:0),h+(l?1:0),f+1,h-1,new Lt((a?kt.empty:kt.from(s.copy(kt.empty))).append(l?kt.empty:kt.from(s.copy(kt.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function H7(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,u=>u.childCount>0&&u.firstChild.type==t);if(!i)return!1;let o=i.startIndex;if(o==0)return!1;let a=i.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let u=l.lastChild&&l.lastChild.type==a.type,d=kt.from(u?t.create():null),f=new Lt(kt.from(t.create(null,kt.from(a.type.create(null,d)))),u?3:1,0),h=i.start,p=i.end;n(e.tr.step(new Br(h-(u?3:1),p,h,p,f,1,!0)).scrollIntoView())}return!0}}function Fg(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:s}=n,{storedMarks:i}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return r},get doc(){return s},get tr(){return r=n.selection,s=n.doc,i=n.storedMarks,n}}}class Bg{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:r}=this,{view:s}=n,{tr:i}=r,o=this.buildProps(i);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...d)=>{const f=l(...d)(o);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(i),f}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,a=[],l=!!e,u=e||i.tr,d=()=>(!l&&n&&!u.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(u),a.every(h=>h===!0)),f={...Object.fromEntries(Object.entries(r).map(([h,p])=>[h,(...y)=>{const x=this.buildProps(u,n),g=p(...y)(x);return a.push(g),f}])),run:d};return f}createCan(e){const{rawCommands:n,state:r}=this,s=!1,i=e||r.tr,o=this.buildProps(i,s);return{...Object.fromEntries(Object.entries(n).map(([l,u])=>[l,(...d)=>u(...d)({...o,dispatch:void 0})])),chain:()=>this.createChain(i,s)}}buildProps(e,n=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,a={tr:e,editor:s,view:o,state:Fg({state:i,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e,n),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([l,u])=>[l,(...d)=>u(...d)(a)]))}};return a}}class V7{constructor(){this.callbacks={}}on(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),this}emit(e,...n){const r=this.callbacks[e];return r&&r.forEach(s=>s.apply(this,n)),this}off(e,n){const r=this.callbacks[e];return r&&(n?this.callbacks[e]=r.filter(s=>s!==n):delete this.callbacks[e]),this}once(e,n){const r=(...s)=>{this.off(e,r),n.apply(this,s)};return this.on(e,r)}removeAllListeners(){this.callbacks={}}}function Ht(t,e,n){return t.config[e]===void 0&&t.parent?Ht(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?Ht(t.parent,e,n):null}):t.config[e]}function Ug(t){const e=t.filter(s=>s.type==="extension"),n=t.filter(s=>s.type==="node"),r=t.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function t5(t){const e=[],{nodeExtensions:n,markExtensions:r}=Ug(t),s=[...n,...r],i={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:s},l=Ht(o,"addGlobalAttributes",a);if(!l)return;l().forEach(d=>{d.types.forEach(f=>{Object.entries(d.attributes).forEach(([h,p])=>{e.push({type:f,name:h,attribute:{...i,...p}})})})})}),s.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=Ht(o,"addAttributes",a);if(!l)return;const u=l();Object.entries(u).forEach(([d,f])=>{const h={...i,...f};typeof(h==null?void 0:h.default)=="function"&&(h.default=h.default()),h!=null&&h.isRequired&&(h==null?void 0:h.default)===void 0&&delete h.default,e.push({type:o.name,name:d,attribute:h})})}),e}function Hr(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function kn(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([s,i])=>{if(!r[s]){r[s]=i;return}if(s==="class"){const a=i?String(i).split(" "):[],l=r[s]?r[s].split(" "):[],u=a.filter(d=>!l.includes(d));r[s]=[...l,...u].join(" ")}else if(s==="style"){const a=i?i.split(";").map(d=>d.trim()).filter(Boolean):[],l=r[s]?r[s].split(";").map(d=>d.trim()).filter(Boolean):[],u=new Map;l.forEach(d=>{const[f,h]=d.split(":").map(p=>p.trim());u.set(f,h)}),a.forEach(d=>{const[f,h]=d.split(":").map(p=>p.trim());u.set(f,h)}),r[s]=Array.from(u.entries()).map(([d,f])=>`${d}: ${f}`).join("; ")}else r[s]=i}),r},{})}function W1(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>kn(n,r),{})}function n5(t){return typeof t=="function"}function fn(t,e=void 0,...n){return n5(t)?e?t.bind(e)(...n):t(...n):t}function W7(t={}){return Object.keys(t).length===0&&t.constructor===Object}function K7(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function ST(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const s=e.reduce((i,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):K7(n.getAttribute(o.name));return a==null?i:{...i,[o.name]:a}},{});return{...r,...s}}}}function _T(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&W7(n)?!1:n!=null))}function G7(t,e){var n;const r=t5(t),{nodeExtensions:s,markExtensions:i}=Ug(t),o=(n=s.find(u=>Ht(u,"topNode")))===null||n===void 0?void 0:n.name,a=Object.fromEntries(s.map(u=>{const d=r.filter(g=>g.type===u.name),f={name:u.name,options:u.options,storage:u.storage,editor:e},h=t.reduce((g,v)=>{const w=Ht(v,"extendNodeSchema",f);return{...g,...w?w(u):{}}},{}),p=_T({...h,content:fn(Ht(u,"content",f)),marks:fn(Ht(u,"marks",f)),group:fn(Ht(u,"group",f)),inline:fn(Ht(u,"inline",f)),atom:fn(Ht(u,"atom",f)),selectable:fn(Ht(u,"selectable",f)),draggable:fn(Ht(u,"draggable",f)),code:fn(Ht(u,"code",f)),whitespace:fn(Ht(u,"whitespace",f)),linebreakReplacement:fn(Ht(u,"linebreakReplacement",f)),defining:fn(Ht(u,"defining",f)),isolating:fn(Ht(u,"isolating",f)),attrs:Object.fromEntries(d.map(g=>{var v;return[g.name,{default:(v=g==null?void 0:g.attribute)===null||v===void 0?void 0:v.default}]}))}),m=fn(Ht(u,"parseHTML",f));m&&(p.parseDOM=m.map(g=>ST(g,d)));const y=Ht(u,"renderHTML",f);y&&(p.toDOM=g=>y({node:g,HTMLAttributes:W1(g,d)}));const x=Ht(u,"renderText",f);return x&&(p.toText=x),[u.name,p]})),l=Object.fromEntries(i.map(u=>{const d=r.filter(x=>x.type===u.name),f={name:u.name,options:u.options,storage:u.storage,editor:e},h=t.reduce((x,g)=>{const v=Ht(g,"extendMarkSchema",f);return{...x,...v?v(u):{}}},{}),p=_T({...h,inclusive:fn(Ht(u,"inclusive",f)),excludes:fn(Ht(u,"excludes",f)),group:fn(Ht(u,"group",f)),spanning:fn(Ht(u,"spanning",f)),code:fn(Ht(u,"code",f)),attrs:Object.fromEntries(d.map(x=>{var g;return[x.name,{default:(g=x==null?void 0:x.attribute)===null||g===void 0?void 0:g.default}]}))}),m=fn(Ht(u,"parseHTML",f));m&&(p.parseDOM=m.map(x=>ST(x,d)));const y=Ht(u,"renderHTML",f);return y&&(p.toDOM=x=>y({mark:x,HTMLAttributes:W1(x,d)})),[u.name,p]}));return new qA({topNode:o,nodes:a,marks:l})}function gy(t,e){return e.nodes[t]||e.marks[t]||null}function TT(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function Sv(t,e){const n=nc.fromSchema(e).serializeFragment(t),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(n),s.innerHTML}const q7=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(s,i,o,a)=>{var l,u;const d=((u=(l=s.type.spec).toText)===null||u===void 0?void 0:u.call(l,{node:s,pos:i,parent:o,index:a}))||s.textContent||"%leaf%";n+=s.isAtom&&!s.isText?d:d.slice(0,Math.max(0,r-i))}),n};function _v(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class Hg{constructor(e){this.find=e.find,this.handler=e.handler}}const J7=(t,e)=>{if(_v(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function Mh(t){var e;const{editor:n,from:r,to:s,text:i,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const u=l.state.doc.resolve(r);if(u.parent.type.spec.code||!((e=u.nodeBefore||u.nodeAfter)===null||e===void 0)&&e.marks.find(h=>h.type.spec.code))return!1;let d=!1;const f=q7(u)+i;return o.forEach(h=>{if(d)return;const p=J7(f,h.find);if(!p)return;const m=l.state.tr,y=Fg({state:l.state,transaction:m}),x={from:r-(p[0].length-i.length),to:s},{commands:g,chain:v,can:w}=new Bg({editor:n,state:y});h.handler({state:y,range:x,match:p,commands:g,chain:v,can:w})===null||!m.steps.length||(m.setMeta(a,{transform:m,from:r,to:s,text:i}),l.dispatch(m),d=!0)}),d}function Y7(t){const{editor:e,rules:n}=t,r=new Tr({state:{init(){return null},apply(s,i,o){const a=s.getMeta(r);if(a)return a;const l=s.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:d}=l;typeof d=="string"?d=d:d=Sv(kt.from(d),o.schema);const{from:f}=l,h=f+d.length;Mh({editor:e,from:f,to:h,text:d,rules:n,plugin:r})}),s.selectionSet||s.docChanged?null:i}},props:{handleTextInput(s,i,o,a){return Mh({editor:e,from:i,to:o,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:i}=s.state.selection;i&&Mh({editor:e,from:i.pos,to:i.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(s,i){if(i.key!=="Enter")return!1;const{$cursor:o}=s.state.selection;return o?Mh({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function X7(t){return Object.prototype.toString.call(t).slice(8,-1)}function Rh(t){return X7(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function Vg(t,e){const n={...t};return Rh(t)&&Rh(e)&&Object.keys(e).forEach(r=>{Rh(e[r])&&Rh(t[r])?n[r]=Vg(t[r],e[r]):n[r]=e[r]}),n}class ei{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=fn(Ht(this,"addOptions",{name:this.name}))),this.storage=fn(Ht(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new ei(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>Vg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new ei(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=fn(Ht(n,"addOptions",{name:n.name})),n.storage=fn(Ht(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const o=s.marks();if(!!!o.find(u=>(u==null?void 0:u.type.name)===n.name))return!1;const l=o.find(u=>(u==null?void 0:u.type.name)===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",s.pos),e.view.dispatch(r),!0}return!1}}function Q7(t){return typeof t=="number"}class Z7{constructor(e){this.find=e.find,this.handler=e.handler}}const eW=(t,e,n)=>{if(_v(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(s=>{const i=[s.text];return i.index=s.index,i.input=t,i.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(s.replaceWith)),i}):[]};function tW(t){const{editor:e,state:n,from:r,to:s,rule:i,pasteEvent:o,dropEvent:a}=t,{commands:l,chain:u,can:d}=new Bg({editor:e,state:n}),f=[];return n.doc.nodesBetween(r,s,(p,m)=>{if(!p.isTextblock||p.type.spec.code)return;const y=Math.max(r,m),x=Math.min(s,m+p.content.size),g=p.textBetween(y-m,x-m,void 0,"");eW(g,i.find,o).forEach(w=>{if(w.index===void 0)return;const S=y+w.index+1,I=S+w[0].length,k={from:n.tr.mapping.map(S),to:n.tr.mapping.map(I)},R=i.handler({state:n,range:k,match:w,commands:l,chain:u,can:d,pasteEvent:o,dropEvent:a});f.push(R)})}),f.every(p=>p!==null)}let Oh=null;const nW=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)===null||e===void 0||e.setData("text/html",t),n};function rW(t){const{editor:e,rules:n}=t;let r=null,s=!1,i=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:d,from:f,to:h,rule:p,pasteEvt:m})=>{const y=d.tr,x=Fg({state:d,transaction:y});if(!(!tW({editor:e,state:x,from:Math.max(f-1,0),to:h.b-1,rule:p,pasteEvent:m,dropEvent:a})||!y.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,y}};return n.map(d=>new Tr({view(f){const h=m=>{var y;r=!((y=f.dom.parentElement)===null||y===void 0)&&y.contains(m.target)?f.dom.parentElement:null,r&&(Oh=e)},p=()=>{Oh&&(Oh=null)};return window.addEventListener("dragstart",h),window.addEventListener("dragend",p),{destroy(){window.removeEventListener("dragstart",h),window.removeEventListener("dragend",p)}}},props:{handleDOMEvents:{drop:(f,h)=>{if(i=r===f.dom.parentElement,a=h,!i){const p=Oh;p!=null&&p.isEditable&&setTimeout(()=>{const m=p.state.selection;m&&p.commands.deleteRange({from:m.from,to:m.to})},10)}return!1},paste:(f,h)=>{var p;const m=(p=h.clipboardData)===null||p===void 0?void 0:p.getData("text/html");return o=h,s=!!(m!=null&&m.includes("data-pm-slice")),!1}}},appendTransaction:(f,h,p)=>{const m=f[0],y=m.getMeta("uiEvent")==="paste"&&!s,x=m.getMeta("uiEvent")==="drop"&&!i,g=m.getMeta("applyPasteRules"),v=!!g;if(!y&&!x&&!v)return;if(v){let{text:I}=g;typeof I=="string"?I=I:I=Sv(kt.from(I),p.schema);const{from:k}=g,R=k+I.length,C=nW(I);return l({rule:d,state:p,from:k,to:{b:R},pasteEvt:C})}const w=h.doc.content.findDiffStart(p.doc.content),S=h.doc.content.findDiffEnd(p.doc.content);if(!(!Q7(w)||!S||w===S.b))return l({rule:d,state:p,from:w,to:S,pasteEvt:o})}}))}function sW(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}class qc{constructor(e,n){this.splittableMarks=[],this.editor=n,this.extensions=qc.resolve(e),this.schema=G7(this.extensions,n),this.setupExtensions()}static resolve(e){const n=qc.sort(qc.flatten(e)),r=sW(n.map(s=>s.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(s=>`'${s}'`).join(", ")}]. This can lead to issues.`),n}static flatten(e){return e.map(n=>{const r={name:n.name,options:n.options,storage:n.storage},s=Ht(n,"addExtensions",r);return s?[n,...this.flatten(s())]:n}).flat(10)}static sort(e){return e.sort((r,s)=>{const i=Ht(r,"priority")||100,o=Ht(s,"priority")||100;return i>o?-1:i<o?1:0})}get commands(){return this.extensions.reduce((e,n)=>{const r={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:gy(n.name,this.schema)},s=Ht(n,"addCommands",r);return s?{...e,...s()}:e},{})}get plugins(){const{editor:e}=this,n=qc.sort([...this.extensions].reverse()),r=[],s=[],i=n.map(o=>{const a={name:o.name,options:o.options,storage:o.storage,editor:e,type:gy(o.name,this.schema)},l=[],u=Ht(o,"addKeyboardShortcuts",a);let d={};if(o.type==="mark"&&Ht(o,"exitable",a)&&(d.ArrowRight=()=>ei.handleExit({editor:e,mark:o})),u){const y=Object.fromEntries(Object.entries(u()).map(([x,g])=>[x,()=>g({editor:e})]));d={...d,...y}}const f=y7(d);l.push(f);const h=Ht(o,"addInputRules",a);TT(o,e.options.enableInputRules)&&h&&r.push(...h());const p=Ht(o,"addPasteRules",a);TT(o,e.options.enablePasteRules)&&p&&s.push(...p());const m=Ht(o,"addProseMirrorPlugins",a);if(m){const y=m();l.push(...y)}return l}).flat();return[Y7({editor:e,rules:r}),...rW({editor:e,rules:s}),...i]}get attributes(){return t5(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:n}=Ug(this.extensions);return Object.fromEntries(n.filter(r=>!!Ht(r,"addNodeView")).map(r=>{const s=this.attributes.filter(l=>l.type===r.name),i={name:r.name,options:r.options,storage:r.storage,editor:e,type:Hr(r.name,this.schema)},o=Ht(r,"addNodeView",i);if(!o)return[];const a=(l,u,d,f,h)=>{const p=W1(l,s);return o()({node:l,view:u,getPos:d,decorations:f,innerDecorations:h,editor:e,extension:r,HTMLAttributes:p})};return[r.name,a]}))}setupExtensions(){this.extensions.forEach(e=>{var n;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:gy(e.name,this.schema)};e.type==="mark"&&(!((n=fn(Ht(e,"keepOnSplit",r)))!==null&&n!==void 0)||n)&&this.splittableMarks.push(e.name);const s=Ht(e,"onBeforeCreate",r),i=Ht(e,"onCreate",r),o=Ht(e,"onUpdate",r),a=Ht(e,"onSelectionUpdate",r),l=Ht(e,"onTransaction",r),u=Ht(e,"onFocus",r),d=Ht(e,"onBlur",r),f=Ht(e,"onDestroy",r);s&&this.editor.on("beforeCreate",s),i&&this.editor.on("create",i),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),u&&this.editor.on("focus",u),d&&this.editor.on("blur",d),f&&this.editor.on("destroy",f)})}}class Vr{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=fn(Ht(this,"addOptions",{name:this.name}))),this.storage=fn(Ht(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Vr(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>Vg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new Vr({...this.config,...e});return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=fn(Ht(n,"addOptions",{name:n.name})),n.storage=fn(Ht(n,"addStorage",{name:n.name,options:n.options})),n}}function r5(t,e,n){const{from:r,to:s}=e,{blockSeparator:i=`

`,textSerializers:o={}}=n||{};let a="";return t.nodesBetween(r,s,(l,u,d,f)=>{var h;l.isBlock&&u>r&&(a+=i);const p=o==null?void 0:o[l.type.name];if(p)return d&&(a+=p({node:l,pos:u,parent:d,index:f,range:e})),!1;l.isText&&(a+=(h=l==null?void 0:l.text)===null||h===void 0?void 0:h.slice(Math.max(r,u)-u,s-u))}),a}function s5(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}const iW=Vr.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Tr({key:new ns("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:s}=e,{ranges:i}=s,o=Math.min(...i.map(d=>d.$from.pos)),a=Math.max(...i.map(d=>d.$to.pos)),l=s5(n);return r5(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),oW=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window==null?void 0:window.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),aW=(t=!1)=>({commands:e})=>e.setContent("",t),lW=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:s}=r;return n&&s.forEach(({$from:i,$to:o})=>{t.doc.nodesBetween(i.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:u,mapping:d}=e,f=u.resolve(d.map(l)),h=u.resolve(d.map(l+a.nodeSize)),p=f.blockRange(h);if(!p)return;const m=Ou(p);if(a.type.isTextblock){const{defaultType:y}=f.parent.contentMatchAt(f.index());e.setNodeMarkup(p.start,y)}(m||m===0)&&e.lift(p,m)})}),!0},cW=t=>e=>t(e),uW=()=>({state:t,dispatch:e})=>I7(t,e),dW=(t,e)=>({editor:n,tr:r})=>{const{state:s}=n,i=s.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const o=r.mapping.map(e);return r.insert(o,i.content),r.setSelection(new nn(r.doc.resolve(Math.max(o-1,0)))),!0},fW=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const s=t.selection.$anchor;for(let i=s.depth;i>0;i-=1)if(s.node(i).type===r.type){if(e){const a=s.before(i),l=s.after(i);t.delete(a,l).scrollIntoView()}return!0}return!1},hW=t=>({tr:e,state:n,dispatch:r})=>{const s=Hr(t,n.schema),i=e.selection.$anchor;for(let o=i.depth;o>0;o-=1)if(i.node(o).type===s){if(r){const l=i.before(o),u=i.after(o);e.delete(l,u).scrollIntoView()}return!0}return!1},pW=t=>({tr:e,dispatch:n})=>{const{from:r,to:s}=t;return n&&e.delete(r,s),!0},mW=()=>({state:t,dispatch:e})=>x7(t,e),gW=()=>({commands:t})=>t.keyboardShortcut("Enter"),yW=()=>({state:t,dispatch:e})=>j7(t,e);function _m(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(s=>n.strict?e[s]===t[s]:_v(e[s])?e[s].test(t[s]):e[s]===t[s]):!0}function i5(t,e,n={}){return t.find(r=>r.type===e&&_m(Object.fromEntries(Object.keys(n).map(s=>[s,r.attrs[s]])),n))}function CT(t,e,n={}){return!!i5(t,e,n)}function Tv(t,e,n){var r;if(!t||!e)return;let s=t.parent.childAfter(t.parentOffset);if((!s.node||!s.node.marks.some(d=>d.type===e))&&(s=t.parent.childBefore(t.parentOffset)),!s.node||!s.node.marks.some(d=>d.type===e)||(n=n||((r=s.node.marks[0])===null||r===void 0?void 0:r.attrs),!i5([...s.node.marks],e,n)))return;let o=s.index,a=t.start()+s.offset,l=o+1,u=a+s.node.nodeSize;for(;o>0&&CT([...t.parent.child(o-1).marks],e,n);)o-=1,a-=t.parent.child(o).nodeSize;for(;l<t.parent.childCount&&CT([...t.parent.child(l).marks],e,n);)u+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:u}}function Za(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const xW=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const i=Za(t,r.schema),{doc:o,selection:a}=n,{$from:l,from:u,to:d}=a;if(s){const f=Tv(l,i,e);if(f&&f.from<=u&&f.to>=d){const h=nn.create(o,f.from,f.to);n.setSelection(h)}}return!0},bW=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function o5(t){return t instanceof nn}function Dl(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function a5(t,e=null){if(!e)return null;const n=ln.atStart(t),r=ln.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const s=n.from,i=r.to;return e==="all"?nn.create(t,Dl(0,s,i),Dl(t.content.size,s,i)):nn.create(t,Dl(e,s,i),Dl(e,s,i))}function l5(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Wg(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const wW=(t=null,e={})=>({editor:n,view:r,tr:s,dispatch:i})=>{e={scrollIntoView:!0,...e};const o=()=>{(Wg()||l5())&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e!=null&&e.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(i&&t===null&&!o5(n.state.selection))return o(),!0;const a=a5(s.doc,t)||n.state.selection,l=n.state.selection.eq(a);return i&&(l||s.setSelection(a),l&&s.storedMarks&&s.setStoredMarks(s.storedMarks),o()),!0},vW=(t,e)=>n=>t.every((r,s)=>e(r,{...n,index:s})),kW=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),c5=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&c5(r)}return t};function Ph(t){const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return c5(n)}function Nf(t,e,n){if(t instanceof Fo||t instanceof kt)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,s=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return kt.fromArray(t.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(i){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",i),Nf("",e,n)}if(s){if(n.errorOnInvalidContent){let o=!1,a="";const l=new qA({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(o=!0,a=typeof u=="string"?u:u.outerHTML,null)}]}})});if(n.slice?Ra.fromSchema(l).parseSlice(Ph(t),n.parseOptions):Ra.fromSchema(l).parse(Ph(t),n.parseOptions),n.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const i=Ra.fromSchema(e);return n.slice?i.parseSlice(Ph(t),n.parseOptions).content:i.parse(Ph(t),n.parseOptions)}return Nf("",e,n)}function SW(t,e,n){const r=t.steps.length-1;if(r<e)return;const s=t.steps[r];if(!(s instanceof $r||s instanceof Br))return;const i=t.mapping.maps[r];let o=0;i.forEach((a,l,u,d)=>{o===0&&(o=d)}),t.setSelection(ln.near(t.doc.resolve(o),n))}const _W=t=>!("type"in t),TW=(t,e,n)=>({tr:r,dispatch:s,editor:i})=>{var o;if(s){n={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=x=>{i.emit("contentError",{editor:i,error:x,disableCollaboration:()=>{i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{Nf(e,i.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(x){l(x)}try{a=Nf(e,i.schema,{parseOptions:u,errorOnInvalidContent:(o=n.errorOnInvalidContent)!==null&&o!==void 0?o:i.options.enableContentCheck})}catch(x){return l(x),!1}let{from:d,to:f}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},h=!0,p=!0;if((_W(a)?a:[a]).forEach(x=>{x.check(),h=h?x.isText&&x.marks.length===0:!1,p=p?x.isBlock:!1}),d===f&&p){const{parent:x}=r.doc.resolve(d);x.isTextblock&&!x.type.spec.code&&!x.childCount&&(d-=1,f+=1)}let y;if(h){if(Array.isArray(e))y=e.map(x=>x.text||"").join("");else if(e instanceof kt){let x="";e.forEach(g=>{g.text&&(x+=g.text)}),y=x}else typeof e=="object"&&e&&e.text?y=e.text:y=e;r.insertText(y,d,f)}else y=a,r.replaceWith(d,f,y);n.updateSelection&&SW(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:d,text:y}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:d,text:y})}return!0},CW=()=>({state:t,dispatch:e})=>T7(t,e),EW=()=>({state:t,dispatch:e})=>C7(t,e),NW=()=>({state:t,dispatch:e})=>b7(t,e),jW=()=>({state:t,dispatch:e})=>S7(t,e),IW=()=>({state:t,dispatch:e,tr:n})=>{try{const r=Rg(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},DW=()=>({state:t,dispatch:e,tr:n})=>{try{const r=Rg(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},AW=()=>({state:t,dispatch:e})=>w7(t,e),MW=()=>({state:t,dispatch:e})=>v7(t,e);function u5(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function RW(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,s,i,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))Wg()||u5()?o=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),s&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),i&&(n=`Shift-${n}`),n}const OW=t=>({editor:e,view:n,tr:r,dispatch:s})=>{const i=RW(t).split(/-(?!$)/),o=i.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",u=>u(n,a))});return l==null||l.steps.forEach(u=>{const d=u.map(r.mapping);d&&s&&r.maybeStep(d)}),!0};function jf(t,e,n={}){const{from:r,to:s,empty:i}=t.selection,o=e?Hr(e,t.schema):null,a=[];t.doc.nodesBetween(r,s,(f,h)=>{if(f.isText)return;const p=Math.max(r,h),m=Math.min(s,h+f.nodeSize);a.push({node:f,from:p,to:m})});const l=s-r,u=a.filter(f=>o?o.name===f.node.type.name:!0).filter(f=>_m(f.node.attrs,n,{strict:!1}));return i?!!u.length:u.reduce((f,h)=>f+h.to-h.from,0)>=l}const PW=(t,e={})=>({state:n,dispatch:r})=>{const s=Hr(t,n.schema);return jf(n,s,e)?E7(n,r):!1},LW=()=>({state:t,dispatch:e})=>D7(t,e),$W=t=>({state:e,dispatch:n})=>{const r=Hr(t,e.schema);return F7(r)(e,n)},zW=()=>({state:t,dispatch:e})=>N7(t,e);function Kg(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function ET(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,s)=>(n.includes(s)||(r[s]=t[s]),r),{})}const FW=(t,e)=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=Kg(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(i=Hr(t,r.schema)),a==="mark"&&(o=Za(t,r.schema)),s&&n.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(u,d)=>{i&&i===u.type&&n.setNodeMarkup(d,void 0,ET(u.attrs,e)),o&&u.marks.length&&u.marks.forEach(f=>{o===f.type&&n.addMark(d,d+u.nodeSize,o.create(ET(f.attrs,e)))})})}),!0):!1},BW=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),UW=()=>({tr:t,dispatch:e})=>{if(e){const n=new vi(t.doc);t.setSelection(n)}return!0},HW=()=>({state:t,dispatch:e})=>k7(t,e),VW=()=>({state:t,dispatch:e})=>_7(t,e),WW=()=>({state:t,dispatch:e})=>A7(t,e),KW=()=>({state:t,dispatch:e})=>O7(t,e),GW=()=>({state:t,dispatch:e})=>R7(t,e);function K1(t,e,n={},r={}){return Nf(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}const qW=(t,e=!1,n={},r={})=>({editor:s,tr:i,dispatch:o,commands:a})=>{var l,u;const{doc:d}=i;if(n.preserveWhitespace!=="full"){const f=K1(t,s.schema,n,{errorOnInvalidContent:(l=r.errorOnInvalidContent)!==null&&l!==void 0?l:s.options.enableContentCheck});return o&&i.replaceWith(0,d.content.size,f).setMeta("preventUpdate",!e),!0}return o&&i.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:d.content.size},t,{parseOptions:n,errorOnInvalidContent:(u=r.errorOnInvalidContent)!==null&&u!==void 0?u:s.options.enableContentCheck})};function d5(t,e){const n=Za(e,t.schema),{from:r,to:s,empty:i}=t.selection,o=[];i?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,s,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function JW(t,e){const n=new uM(t);return e.forEach(r=>{r.steps.forEach(s=>{n.step(s)})}),n}function Cv(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function xp(t,e){const n=[];return t.descendants((r,s)=>{e(r)&&n.push({node:r,pos:s})}),n}function YW(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(s,i)=>{n(s)&&r.push({node:s,pos:i})}),r}function XW(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function Pu(t){return e=>XW(e.$from,t)}function QW(t,e){const n={from:0,to:t.content.size};return r5(t,n,e)}function ZW(t,e){const n=Hr(e,t.schema),{from:r,to:s}=t.selection,i=[];t.doc.nodesBetween(r,s,a=>{i.push(a)});const o=i.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function f5(t,e){const n=Kg(typeof e=="string"?e:e.name,t.schema);return n==="node"?ZW(t,e):n==="mark"?d5(t,e):{}}function eK(t,e=JSON.stringify){const n={};return t.filter(r=>{const s=e(r);return Object.prototype.hasOwnProperty.call(n,s)?!1:n[s]=!0})}function tK(t){const e=eK(t);return e.length===1?e:e.filter((n,r)=>!e.filter((i,o)=>o!==r).some(i=>n.oldRange.from>=i.oldRange.from&&n.oldRange.to<=i.oldRange.to&&n.newRange.from>=i.newRange.from&&n.newRange.to<=i.newRange.to))}function nK(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((s,i)=>{const o=[];if(s.ranges.length)s.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=n[i];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const u=e.slice(i).map(a,-1),d=e.slice(i).map(l),f=e.invert().map(u,-1),h=e.invert().map(d);r.push({oldRange:{from:f,to:h},newRange:{from:u,to:d}})})}),tK(r)}function Ev(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(s=>{const i=n.resolve(t),o=Tv(i,s.type);o&&r.push({mark:s,...o})}):n.nodesBetween(t,e,(s,i)=>{!s||(s==null?void 0:s.nodeSize)===void 0||r.push(...s.marks.map(o=>({from:i,to:i+s.nodeSize,mark:o})))}),r}function bp(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const s=t.find(i=>i.type===e&&i.name===r);return s?s.attribute.keepOnSplit:!1}))}function G1(t,e,n={}){const{empty:r,ranges:s}=t.selection,i=e?Za(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(f=>i?i.name===f.type.name:!0).find(f=>_m(f.attrs,n,{strict:!1}));let o=0;const a=[];if(s.forEach(({$from:f,$to:h})=>{const p=f.pos,m=h.pos;t.doc.nodesBetween(p,m,(y,x)=>{if(!y.isText&&!y.marks.length)return;const g=Math.max(p,x),v=Math.min(m,x+y.nodeSize),w=v-g;o+=w,a.push(...y.marks.map(S=>({mark:S,from:g,to:v})))})}),o===0)return!1;const l=a.filter(f=>i?i.name===f.mark.type.name:!0).filter(f=>_m(f.mark.attrs,n,{strict:!1})).reduce((f,h)=>f+h.to-h.from,0),u=a.filter(f=>i?f.mark.type!==i&&f.mark.type.excludes(i):!0).reduce((f,h)=>f+h.to-h.from,0);return(l>0?l+u:l)>=o}function h5(t,e,n={}){if(!e)return jf(t,null,n)||G1(t,null,n);const r=Kg(e,t.schema);return r==="node"?jf(t,e,n):r==="mark"?G1(t,e,n):!1}function NT(t,e){const{nodeExtensions:n}=Ug(e),r=n.find(o=>o.name===t);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},i=fn(Ht(r,"group",s));return typeof i!="string"?!1:i.split(" ").includes("list")}function Nv(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!==null&&r!==void 0?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let s=!0;return t.content.forEach(i=>{s!==!1&&(Nv(i,{ignoreWhitespace:n,checkChildren:e})||(s=!1))}),s}return!1}function rK(t){return t instanceof Kt}function sK(t,e,n){var r;const{selection:s}=e;let i=null;if(o5(s)&&(i=s.$cursor),i){const a=(r=t.storedMarks)!==null&&r!==void 0?r:i.marks();return!!n.isInSet(a)||!a.some(l=>l.type.excludes(n))}const{ranges:o}=s;return o.some(({$from:a,$to:l})=>{let u=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(d,f,h)=>{if(u)return!1;if(d.isInline){const p=!h||h.type.allowsMarkType(n),m=!!n.isInSet(d.marks)||!d.marks.some(y=>y.type.excludes(n));u=p&&m}return!u}),u})}const iK=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const{selection:i}=n,{empty:o,ranges:a}=i,l=Za(t,r.schema);if(s)if(o){const u=d5(r,l);n.addStoredMark(l.create({...u,...e}))}else a.forEach(u=>{const d=u.$from.pos,f=u.$to.pos;r.doc.nodesBetween(d,f,(h,p)=>{const m=Math.max(p,d),y=Math.min(p+h.nodeSize,f);h.marks.find(g=>g.type===l)?h.marks.forEach(g=>{l===g.type&&n.addMark(m,y,l.create({...g.attrs,...e}))}):n.addMark(m,y,l.create(e))})});return sK(r,n,l)},oK=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),aK=(t,e={})=>({state:n,dispatch:r,chain:s})=>{const i=Hr(t,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),i.isTextblock?s().command(({commands:a})=>kT(i,{...o,...e})(n)?!0:a.clearNodes()).command(({state:a})=>kT(i,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},lK=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,s=Dl(t,0,r.content.size),i=Kt.create(r,s);e.setSelection(i)}return!0},cK=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:s,to:i}=typeof t=="number"?{from:t,to:t}:t,o=nn.atStart(r).from,a=nn.atEnd(r).to,l=Dl(s,o,a),u=Dl(i,o,a),d=nn.create(r,l,u);e.setSelection(d)}return!0},uK=t=>({state:e,dispatch:n})=>{const r=Hr(t,e.schema);return H7(r)(e,n)};function jT(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(s=>e==null?void 0:e.includes(s.type.name));t.tr.ensureMarks(r)}}const dK=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:s})=>{const{selection:i,doc:o}=e,{$from:a,$to:l}=i,u=s.extensionManager.attributes,d=bp(u,a.node().type.name,a.node().attrs);if(i instanceof Kt&&i.node.isBlock)return!a.parentOffset||!su(o,a.pos)?!1:(r&&(t&&jT(n,s.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const f=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:Cv(a.node(-1).contentMatchAt(a.indexAfter(-1)));let p=f&&h?[{type:h,attrs:d}]:void 0,m=su(e.doc,e.mapping.map(a.pos),1,p);if(!p&&!m&&su(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(m=!0,p=h?[{type:h,attrs:d}]:void 0),r){if(m&&(i instanceof nn&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,p),h&&!f&&!a.parentOffset&&a.parent.type!==h)){const y=e.mapping.map(a.before()),x=e.doc.resolve(y);a.node(-1).canReplaceWith(x.index(),x.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}t&&jT(n,s.extensionManager.splittableMarks),e.scrollIntoView()}return m},fK=(t,e={})=>({tr:n,state:r,dispatch:s,editor:i})=>{var o;const a=Hr(t,r.schema),{$from:l,$to:u}=r.selection,d=r.selection.node;if(d&&d.isBlock||l.depth<2||!l.sameParent(u))return!1;const f=l.node(-1);if(f.type!==a)return!1;const h=i.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(s){let g=kt.empty;const v=l.index(-1)?1:l.index(-2)?2:3;for(let C=l.depth-v;C>=l.depth-3;C-=1)g=kt.from(l.node(C).copy(g));const w=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,S={...bp(h,l.node().type.name,l.node().attrs),...e},I=((o=a.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(S))||void 0;g=g.append(kt.from(a.createAndFill(null,I)||void 0));const k=l.before(l.depth-(v-1));n.replace(k,l.after(-w),new Lt(g,4-v,0));let R=-1;n.doc.nodesBetween(k,n.doc.content.size,(C,T)=>{if(R>-1)return!1;C.isTextblock&&C.content.size===0&&(R=T+1)}),R>-1&&n.setSelection(nn.near(n.doc.resolve(R))),n.scrollIntoView()}return!0}const p=u.pos===l.end()?f.contentMatchAt(0).defaultType:null,m={...bp(h,f.type.name,f.attrs),...e},y={...bp(h,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,u.pos);const x=p?[{type:a,attrs:m},{type:p,attrs:y}]:[{type:a,attrs:m}];if(!su(n.doc,l.pos,2))return!1;if(s){const{selection:g,storedMarks:v}=r,{splittableMarks:w}=i.extensionManager,S=v||g.$to.parentOffset&&g.$from.marks();if(n.split(l.pos,2,x).scrollIntoView(),!S||!s)return!0;const I=S.filter(k=>w.includes(k.type.name));n.ensureMarks(I)}return!0},yy=(t,e)=>{const n=Pu(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&Xa(t.doc,n.pos)&&t.join(n.pos),!0},xy=(t,e)=>{const n=Pu(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&Xa(t.doc,r)&&t.join(r),!0},hK=(t,e,n,r={})=>({editor:s,tr:i,state:o,dispatch:a,chain:l,commands:u,can:d})=>{const{extensions:f,splittableMarks:h}=s.extensionManager,p=Hr(t,o.schema),m=Hr(e,o.schema),{selection:y,storedMarks:x}=o,{$from:g,$to:v}=y,w=g.blockRange(v),S=x||y.$to.parentOffset&&y.$from.marks();if(!w)return!1;const I=Pu(k=>NT(k.type.name,f))(y);if(w.depth>=1&&I&&w.depth-I.depth<=1){if(I.node.type===p)return u.liftListItem(m);if(NT(I.node.type.name,f)&&p.validContent(I.node.content)&&a)return l().command(()=>(i.setNodeMarkup(I.pos,p),!0)).command(()=>yy(i,p)).command(()=>xy(i,p)).run()}return!n||!S||!a?l().command(()=>d().wrapInList(p,r)?!0:u.clearNodes()).wrapInList(p,r).command(()=>yy(i,p)).command(()=>xy(i,p)).run():l().command(()=>{const k=d().wrapInList(p,r),R=S.filter(C=>h.includes(C.type.name));return i.ensureMarks(R),k?!0:u.clearNodes()}).wrapInList(p,r).command(()=>yy(i,p)).command(()=>xy(i,p)).run()},pK=(t,e={},n={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:i=!1}=n,o=Za(t,r.schema);return G1(r,o,e)?s.unsetMark(o,{extendEmptyMarkRange:i}):s.setMark(o,e)},mK=(t,e,n={})=>({state:r,commands:s})=>{const i=Hr(t,r.schema),o=Hr(e,r.schema),a=jf(r,i,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?s.setNode(o,l):s.setNode(i,{...l,...n})},gK=(t,e={})=>({state:n,commands:r})=>{const s=Hr(t,n.schema);return jf(n,s,e)?r.lift(s):r.wrapIn(s,e)},yK=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const s=n[r];let i;if(s.spec.isInputRules&&(i=s.getState(t))){if(e){const o=t.tr,a=i.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(i.text){const l=o.doc.resolve(i.from).marks();o.replaceWith(i.from,i.to,t.schema.text(i.text,l))}else o.delete(i.from,i.to)}return!0}}return!1},xK=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:s}=n;return r||e&&s.forEach(i=>{t.removeMark(i.$from.pos,i.$to.pos)}),!0},bK=(t,e={})=>({tr:n,state:r,dispatch:s})=>{var i;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=Za(t,r.schema),{$from:u,empty:d,ranges:f}=a;if(!s)return!0;if(d&&o){let{from:h,to:p}=a;const m=(i=u.marks().find(x=>x.type===l))===null||i===void 0?void 0:i.attrs,y=Tv(u,l,m);y&&(h=y.from,p=y.to),n.removeMark(h,p,l)}else f.forEach(h=>{n.removeMark(h.$from.pos,h.$to.pos,l)});return n.removeStoredMark(l),!0},wK=(t,e={})=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=Kg(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(i=Hr(t,r.schema)),a==="mark"&&(o=Za(t,r.schema)),s&&n.selection.ranges.forEach(l=>{const u=l.$from.pos,d=l.$to.pos;let f,h,p,m;n.selection.empty?r.doc.nodesBetween(u,d,(y,x)=>{i&&i===y.type&&(p=Math.max(x,u),m=Math.min(x+y.nodeSize,d),f=x,h=y)}):r.doc.nodesBetween(u,d,(y,x)=>{x<u&&i&&i===y.type&&(p=Math.max(x,u),m=Math.min(x+y.nodeSize,d),f=x,h=y),x>=u&&x<=d&&(i&&i===y.type&&n.setNodeMarkup(x,void 0,{...y.attrs,...e}),o&&y.marks.length&&y.marks.forEach(g=>{if(o===g.type){const v=Math.max(x,u),w=Math.min(x+y.nodeSize,d);n.addMark(v,w,o.create({...g.attrs,...e}))}}))}),h&&(f!==void 0&&n.setNodeMarkup(f,void 0,{...h.attrs,...e}),o&&h.marks.length&&h.marks.forEach(y=>{o===y.type&&n.addMark(p,m,o.create({...y.attrs,...e}))}))}),!0):!1},vK=(t,e={})=>({state:n,dispatch:r})=>{const s=Hr(t,n.schema);return P7(s,e)(n,r)},kK=(t,e={})=>({state:n,dispatch:r})=>{const s=Hr(t,n.schema);return L7(s,e)(n,r)};var SK=Object.freeze({__proto__:null,blur:oW,clearContent:aW,clearNodes:lW,command:cW,createParagraphNear:uW,cut:dW,deleteCurrentNode:fW,deleteNode:hW,deleteRange:pW,deleteSelection:mW,enter:gW,exitCode:yW,extendMarkRange:xW,first:bW,focus:wW,forEach:vW,insertContent:kW,insertContentAt:TW,joinBackward:NW,joinDown:EW,joinForward:jW,joinItemBackward:IW,joinItemForward:DW,joinTextblockBackward:AW,joinTextblockForward:MW,joinUp:CW,keyboardShortcut:OW,lift:PW,liftEmptyBlock:LW,liftListItem:$W,newlineInCode:zW,resetAttributes:FW,scrollIntoView:BW,selectAll:UW,selectNodeBackward:HW,selectNodeForward:VW,selectParentNode:WW,selectTextblockEnd:KW,selectTextblockStart:GW,setContent:qW,setMark:iK,setMeta:oK,setNode:aK,setNodeSelection:lK,setTextSelection:cK,sinkListItem:uK,splitBlock:dK,splitListItem:fK,toggleList:hK,toggleMark:pK,toggleNode:mK,toggleWrap:gK,undoInputRule:yK,unsetAllMarks:xK,unsetMark:bK,updateAttributes:wK,wrapIn:vK,wrapInList:kK});const _K=Vr.create({name:"commands",addCommands(){return{...SK}}}),TK=Vr.create({name:"drop",addProseMirrorPlugins(){return[new Tr({key:new ns("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),CK=Vr.create({name:"editable",addProseMirrorPlugins(){return[new Tr({key:new ns("editable"),props:{editable:()=>this.editor.options.editable}})]}}),EK=new ns("focusEvents"),NK=Vr.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Tr({key:EK,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),jK=Vr.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:u}=a,{empty:d,$anchor:f}=l,{pos:h,parent:p}=f,m=f.parent.isTextblock&&h>0?a.doc.resolve(h-1):f,y=m.parent.type.spec.isolating,x=f.pos-f.parentOffset,g=y&&m.parent.childCount===1?x===f.pos:ln.atStart(u).from===h;return!d||!p.type.isTextblock||p.textContent.length||!g||g&&f.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...r},i={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Wg()||u5()?i:s},addProseMirrorPlugins(){return[new Tr({key:new ns("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(y=>y.getMeta("composition")))return;const r=t.some(y=>y.docChanged)&&!e.doc.eq(n.doc),s=t.some(y=>y.getMeta("preventClearDocument"));if(!r||s)return;const{empty:i,from:o,to:a}=e.selection,l=ln.atStart(e.doc).from,u=ln.atEnd(e.doc).to;if(i||!(o===l&&a===u)||!Nv(n.doc))return;const h=n.tr,p=Fg({state:n,transaction:h}),{commands:m}=new Bg({editor:this.editor,state:p});if(m.clearNodes(),!!h.steps.length)return h}})]}}),IK=Vr.create({name:"paste",addProseMirrorPlugins(){return[new Tr({key:new ns("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),DK=Vr.create({name:"tabindex",addProseMirrorPlugins(){return[new Tr({key:new ns("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class wl{get name(){return this.node.type.name}constructor(e,n,r=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=s}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new wl(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new wl(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new wl(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const s=n.isBlock&&!n.isTextblock,i=n.isAtom&&!n.isText,o=this.pos+r+(i?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!s&&a.depth<=this.depth)return;const l=new wl(a,this.editor,s,s?n:null);s&&(l.actualDepth=this.depth+1),e.push(new wl(a,this.editor,s,s?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,s=this.parent;for(;s&&!r;){if(s.node.type.name===e)if(Object.keys(n).length>0){const i=s.node.attrs,o=Object.keys(n);for(let a=0;a<o.length;a+=1){const l=o[a];if(i[l]!==n[l])break}}else r=s;s=s.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let s=[];if(!this.children||this.children.length===0)return s;const i=Object.keys(n);return this.children.forEach(o=>{r&&s.length>0||(o.node.type.name===e&&i.every(l=>n[l]===o.node.attrs[l])&&s.push(o),!(r&&s.length>0)&&(s=s.concat(o.querySelectorAll(e,n,r))))}),s}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}}const AK=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function MK(t,e,n){const r=document.querySelector(`style[data-tiptap-style${n?`-${n}`:""}]`);if(r!==null)return r;const s=document.createElement("style");return e&&s.setAttribute("nonce",e),s.setAttribute(`data-tiptap-style${n?`-${n}`:""}`,""),s.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(s),s}let RK=class extends V7{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:r,moved:s})=>this.options.onDrop(n,r,s)),this.on("paste",({event:n,slice:r})=>this.options.onPaste(n,r)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=MK(AK,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,n){const r=n5(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let r=n;if([].concat(e).forEach(i=>{const o=typeof i=="string"?`${i}$`:i.key;r=r.filter(a=>!a.key.startsWith(o))}),n.length===r.length)return;const s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}createExtensionManager(){var e,n;const s=[...this.options.enableCoreExtensions?[CK,iW.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||n===void 0?void 0:n.blockSeparator}),_K,NK,jK,DK,TK,IK].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i==null?void 0:i.type));this.extensionManager=new qc(s,this)}createCommandManager(){this.commandManager=new Bg({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let n;try{n=K1(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>a.name!=="collaboration"),this.createExtensionManager()}}),n=K1(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const r=a5(n,this.options.autofocus);this.view=new GM(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:Gc.create({doc:n,selection:r||void 0})});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(o)});return}const n=this.state.apply(e),r=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const s=e.getMeta("focus"),i=e.getMeta("blur");s&&this.emit("focus",{editor:this,event:s.event,transaction:e}),i&&this.emit("blur",{editor:this,event:i.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return f5(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,s=typeof e=="string"?n:e;return h5(this.state,r,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Sv(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return QW(this.state.doc,{blockSeparator:n,textSerializers:{...s5(this.schema),...r}})}get isEmpty(){return Nv(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelector(e,n))||null}$nodes(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new wl(n,this)}get $doc(){return this.$pos(0)}};function Ql(t){return new Hg({find:t.find,handler:({state:e,range:n,match:r})=>{const s=fn(t.getAttributes,void 0,r);if(s===!1||s===null)return null;const{tr:i}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),u=n.from+a.indexOf(o),d=u+o.length;if(Ev(n.from,n.to,e.doc).filter(p=>p.mark.type.excluded.find(y=>y===t.type&&y!==p.mark.type)).filter(p=>p.to>u).length)return null;d<n.to&&i.delete(d,n.to),u>n.from&&i.delete(n.from+l,u);const h=n.from+l+o.length;i.addMark(n.from+l,h,t.type.create(s||{})),i.removeStoredMark(t.type)}}})}function OK(t){return new Hg({find:t.find,handler:({state:e,range:n,match:r})=>{const s=fn(t.getAttributes,void 0,r)||{},{tr:i}=e,o=n.from;let a=n.to;const l=t.type.create(s);if(r[1]){const u=r[0].lastIndexOf(r[1]);let d=o+u;d>a?d=a:a=d+r[1].length;const f=r[0][r[0].length-1];i.insertText(f,o+r[0].length-1),i.replaceWith(d,a,l)}else if(r[0]){const u=t.type.isInline?o:o-1;i.insert(u,t.type.create(s)).delete(i.mapping.map(o),i.mapping.map(a))}i.scrollIntoView()}})}function q1(t){return new Hg({find:t.find,handler:({state:e,range:n,match:r})=>{const s=e.doc.resolve(n.from),i=fn(t.getAttributes,void 0,r)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,i)}})}function Su(t){return new Hg({find:t.find,handler:({state:e,range:n,match:r,chain:s})=>{const i=fn(t.getAttributes,void 0,r)||{},o=e.tr.delete(n.from,n.to),l=o.doc.resolve(n.from).blockRange(),u=l&&uv(l,t.type,i);if(!u)return null;if(o.wrap(l,u),t.keepMarks&&t.editor){const{selection:f,storedMarks:h}=e,{splittableMarks:p}=t.editor.extensionManager,m=h||f.$to.parentOffset&&f.$from.marks();if(m){const y=m.filter(x=>p.includes(x.type.name));o.ensureMarks(y)}}if(t.keepAttributes){const f=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(f,i).run()}const d=o.doc.resolve(n.from-1).nodeBefore;d&&d.type===t.type&&Xa(o.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,d))&&o.join(n.from-1)}})}class pr{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=fn(Ht(this,"addOptions",{name:this.name}))),this.storage=fn(Ht(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new pr(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>Vg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new pr(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=fn(Ht(n,"addOptions",{name:n.name})),n.storage=fn(Ht(n,"addStorage",{name:n.name,options:n.options})),n}}class PK{constructor(e,n,r){this.isDragging=!1,this.component=e,this.editor=n.editor,this.options={stopEvent:null,ignoreMutation:null,...r},this.extension=n.extension,this.node=n.node,this.decorations=n.decorations,this.innerDecorations=n.innerDecorations,this.view=n.view,this.HTMLAttributes=n.HTMLAttributes,this.getPos=n.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(e){var n,r,s,i,o,a,l;const{view:u}=this.editor,d=e.target,f=d.nodeType===3?(n=d.parentElement)===null||n===void 0?void 0:n.closest("[data-drag-handle]"):d.closest("[data-drag-handle]");if(!this.dom||!((r=this.contentDOM)===null||r===void 0)&&r.contains(d)||!f)return;let h=0,p=0;if(this.dom!==f){const v=this.dom.getBoundingClientRect(),w=f.getBoundingClientRect(),S=(s=e.offsetX)!==null&&s!==void 0?s:(i=e.nativeEvent)===null||i===void 0?void 0:i.offsetX,I=(o=e.offsetY)!==null&&o!==void 0?o:(a=e.nativeEvent)===null||a===void 0?void 0:a.offsetY;h=w.x-v.x+S,p=w.y-v.y+I}const m=this.dom.cloneNode(!0);(l=e.dataTransfer)===null||l===void 0||l.setDragImage(m,h,p);const y=this.getPos();if(typeof y!="number")return;const x=Kt.create(u.state.doc,y),g=u.state.tr.setSelection(x);u.dispatch(g)}stopEvent(e){var n;if(!this.dom)return!1;if(typeof this.options.stopEvent=="function")return this.options.stopEvent({event:e});const r=e.target;if(!(this.dom.contains(r)&&!(!((n=this.contentDOM)===null||n===void 0)&&n.contains(r))))return!1;const i=e.type.startsWith("drag"),o=e.type==="drop";if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(r.tagName)||r.isContentEditable)&&!o&&!i)return!0;const{isEditable:l}=this.editor,{isDragging:u}=this,d=!!this.node.type.spec.draggable,f=Kt.isSelectable(this.node),h=e.type==="copy",p=e.type==="paste",m=e.type==="cut",y=e.type==="mousedown";if(!d&&f&&i&&e.target===this.dom&&e.preventDefault(),d&&i&&!u&&e.target===this.dom)return e.preventDefault(),!1;if(d&&l&&!u&&y){const x=r.closest("[data-drag-handle]");x&&(this.dom===x||this.dom.contains(x))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!(u||o||h||p||m||y&&f)}ignoreMutation(e){return!this.dom||!this.contentDOM?!0:typeof this.options.ignoreMutation=="function"?this.options.ignoreMutation({mutation:e}):this.node.isLeaf||this.node.isAtom?!0:e.type==="selection"||this.dom.contains(e.target)&&e.type==="childList"&&(Wg()||l5())&&this.editor.isFocused&&[...Array.from(e.addedNodes),...Array.from(e.removedNodes)].every(r=>r.isContentEditable)?!1:this.contentDOM===e.target&&e.type==="attributes"?!0:!this.contentDOM.contains(e.target)}updateAttributes(e){this.editor.commands.command(({tr:n})=>{const r=this.getPos();return typeof r!="number"?!1:(n.setNodeMarkup(r,void 0,{...this.node.attrs,...e}),!0)})}deleteNode(){const e=this.getPos();if(typeof e!="number")return;const n=e+this.node.nodeSize;this.editor.commands.deleteRange({from:e,to:n})}}function Wa(t){return new Z7({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:s})=>{const i=fn(t.getAttributes,void 0,r,s);if(i===!1||i===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let u=n.to;if(a){const d=l.search(/\S/),f=n.from+l.indexOf(a),h=f+a.length;if(Ev(n.from,n.to,e.doc).filter(m=>m.mark.type.excluded.find(x=>x===t.type&&x!==m.mark.type)).filter(m=>m.to>f).length)return null;h<n.to&&o.delete(h,n.to),f>n.from&&o.delete(n.from+d,f),u=n.from+d+a.length,o.addMark(n.from+d,u,t.type.create(i||{})),o.removeStoredMark(t.type)}}})}function LK(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof Kt){const i=r.index();return r.parent.canReplaceWith(i,i+1,e)}let s=r.depth;for(;s>=0;){const i=r.index(s);if(r.node(s).contentMatchAt(i).matchType(e))return!0;s-=1}return!1}function $K(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}const zK=(...t)=>e=>{t.forEach(n=>{typeof n=="function"?n(e):n&&(n.current=e)})},FK=({renderers:t})=>An.createElement(An.Fragment,null,Object.entries(t).map(([e,n])=>x4.createPortal(n.reactElement,n.element,e)));class BK extends An.Component{constructor(e){super(e),this.editorContentRef=An.createRef(),this.initialized=!1,this.state={renderers:{}}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const{editor:e}=this.props;if(e&&e.options.element){if(e.contentComponent)return;const n=this.editorContentRef.current;n.append(...e.options.element.childNodes),e.setOptions({element:n}),e.contentComponent=this,e.createNodeViews(),this.initialized=!0}}maybeFlushSync(e){this.initialized?er.flushSync(e):e()}setRenderer(e,n){this.maybeFlushSync(()=>{this.setState(({renderers:r})=>({renderers:{...r,[e]:n}}))})}removeRenderer(e){this.maybeFlushSync(()=>{this.setState(({renderers:n})=>{const r={...n};return delete r[e],{renderers:r}})})}componentWillUnmount(){const{editor:e}=this.props;if(!e||(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),e.contentComponent=null,!e.options.element.firstChild))return;const n=document.createElement("div");n.append(...e.options.element.childNodes),e.setOptions({element:n})}render(){const{editor:e,innerRef:n,...r}=this.props;return An.createElement(An.Fragment,null,An.createElement("div",{ref:zK(n,this.editorContentRef),...r}),An.createElement(FK,{renderers:this.state.renderers}))}}const UK=b.forwardRef((t,e)=>{const n=An.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return An.createElement(BK,{key:n,innerRef:e,...t})}),HK=An.memo(UK);class VK extends RK{constructor(){super(...arguments),this.contentComponent=null}}const WK=(t={},e=[])=>{const n=b.useRef(null),[,r]=b.useState({}),{onBeforeCreate:s,onBlur:i,onCreate:o,onDestroy:a,onFocus:l,onSelectionUpdate:u,onTransaction:d,onUpdate:f}=t,h=b.useRef(s),p=b.useRef(i),m=b.useRef(o),y=b.useRef(a),x=b.useRef(l),g=b.useRef(u),v=b.useRef(d),w=b.useRef(f);return b.useEffect(()=>{n.current&&(s&&(n.current.off("beforeCreate",h.current),n.current.on("beforeCreate",s),h.current=s),i&&(n.current.off("blur",p.current),n.current.on("blur",i),p.current=i),o&&(n.current.off("create",m.current),n.current.on("create",o),m.current=o),a&&(n.current.off("destroy",y.current),n.current.on("destroy",a),y.current=a),l&&(n.current.off("focus",x.current),n.current.on("focus",l),x.current=l),u&&(n.current.off("selectionUpdate",g.current),n.current.on("selectionUpdate",u),g.current=u),d&&(n.current.off("transaction",v.current),n.current.on("transaction",d),v.current=d),f&&(n.current.off("update",w.current),n.current.on("update",f),w.current=f))},[s,i,o,a,l,u,d,f,n.current]),b.useEffect(()=>{let S=!0;return n.current=new VK(t),n.current.on("transaction",()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{S&&r({})})})}),()=>{S=!1}},e),b.useEffect(()=>()=>{var S;return(S=n.current)===null||S===void 0?void 0:S.destroy()},[]),n.current},KK=b.createContext({editor:null});KK.Consumer;const p5=b.createContext({onDragStart:void 0}),GK=()=>b.useContext(p5);An.forwardRef((t,e)=>{const{onDragStart:n}=GK(),r=t.as||"div";return An.createElement(r,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:n,style:{whiteSpace:"normal",...t.style}})});function qK(t){return!!(typeof t=="function"&&t.prototype&&t.prototype.isReactComponent)}function JK(t){var e;return typeof t=="object"&&((e=t.$$typeof)===null||e===void 0?void 0:e.toString())==="Symbol(react.forward_ref)"}class YK{constructor(e,{editor:n,props:r={},as:s="div",className:i="",attrs:o}){this.ref=null,this.id=Math.floor(Math.random()*4294967295).toString(),this.component=e,this.editor=n,this.props=r,this.element=document.createElement(s),this.element.classList.add("react-renderer"),i&&this.element.classList.add(...i.split(" ")),o&&Object.keys(o).forEach(a=>{this.element.setAttribute(a,o[a])}),this.render()}render(){var e,n;const r=this.component,s=this.props;(qK(r)||JK(r))&&(s.ref=i=>{this.ref=i}),this.reactElement=An.createElement(r,{...s}),(n=(e=this.editor)===null||e===void 0?void 0:e.contentComponent)===null||n===void 0||n.setRenderer(this.id,this)}updateProps(e={}){this.props={...this.props,...e},this.render()}destroy(){var e,n;(n=(e=this.editor)===null||e===void 0?void 0:e.contentComponent)===null||n===void 0||n.removeRenderer(this.id)}}class XK extends PK{mount(){const e={editor:this.editor,node:this.node,decorations:this.decorations,selected:!1,extension:this.extension,getPos:()=>this.getPos(),updateAttributes:(i={})=>this.updateAttributes(i),deleteNode:()=>this.deleteNode()};if(!this.component.displayName){const i=o=>o.charAt(0).toUpperCase()+o.substring(1);this.component.displayName=i(this.extension.name)}const n=i=>{const o=this.component,a=this.onDragStart.bind(this),l=u=>{u&&this.contentDOMElement&&u.firstChild!==this.contentDOMElement&&u.appendChild(this.contentDOMElement)};return An.createElement(An.Fragment,null,An.createElement(p5.Provider,{value:{onDragStart:a,nodeViewContentRef:l}},An.createElement(o,{...i})))};n.displayName="ReactNodeView",this.node.isLeaf?this.contentDOMElement=null:this.options.contentDOMElementTag?this.contentDOMElement=document.createElement(this.options.contentDOMElementTag):this.contentDOMElement=document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.style.whiteSpace="inherit");let r=this.node.isInline?"span":"div";this.options.as&&(r=this.options.as);const{className:s=""}=this.options;this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.editor.on("selectionUpdate",this.handleSelectionUpdate),this.renderer=new YK(n,{editor:this.editor,props:e,as:r,className:`node-${this.node.type.name} ${s}`.trim(),attrs:this.options.attrs})}get dom(){var e;if(this.renderer.element.firstElementChild&&!(!((e=this.renderer.element.firstElementChild)===null||e===void 0)&&e.hasAttribute("data-node-view-wrapper")))throw Error("Please use the NodeViewWrapper component for your node view.");return this.renderer.element}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){const{from:e,to:n}=this.editor.state.selection;if(e<=this.getPos()&&n>=this.getPos()+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(e,n){const r=s=>{this.renderer.updateProps(s)};if(e.type!==this.node.type)return!1;if(typeof this.options.update=="function"){const s=this.node,i=this.decorations;return this.node=e,this.decorations=n,this.options.update({oldNode:s,oldDecorations:i,newNode:e,newDecorations:n,updateProps:()=>r({node:e,decorations:n})})}return e===this.node&&this.decorations===n||(this.node=e,this.decorations=n,r({node:e,decorations:n})),!0}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.element.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.element.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}}function QK(t,e){return n=>n.editor.contentComponent?new XK(t,n,e):{}}const ZK=/^\s*>\s$/,eG=pr.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Su({find:ZK,type:this.type})]}}),tG=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,nG=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,rG=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,sG=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,iG=ei.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Ql({find:tG,type:this.type}),Ql({find:rG,type:this.type})]},addPasteRules(){return[Wa({find:nG,type:this.type}),Wa({find:sG,type:this.type})]}}),oG="listItem",IT="textStyle",DT=/^\s*([-+*])\s$/,aG=pr.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(oG,this.editor.getAttributes(IT)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=Su({find:DT,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=Su({find:DT,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(IT),editor:this.editor})),[t]}}),lG=/(^|[^`])`([^`]+)`(?!`)/,cG=/(^|[^`])`([^`]+)`(?!`)/g,uG=ei.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Ql({find:lG,type:this.type})]},addPasteRules(){return[Wa({find:cG,type:this.type})]}}),dG=/^```([a-z]+)?[\s\n]$/,fG=/^~~~([a-z]+)?[\s\n]$/,hG=pr.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,i=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",kn(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:s}=n;if(!s||r.parent.type!==this.type)return!1;const i=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!i||!o?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:s,empty:i}=n;if(!i||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const a=s.after();return a===void 0?!1:r.nodeAt(a)?t.commands.command(({tr:u})=>(u.setSelection(ln.near(r.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[q1({find:dG,type:this.type,getAttributes:t=>({language:t[1]})}),q1({find:fG,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Tr({key:new ns("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,i=s==null?void 0:s.mode;if(!n||!i)return!1;const{tr:o,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:i},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(nn.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),pG=pr.create({name:"doc",topNode:!0,content:"block+"});function mG(t={}){return new Tr({view(e){return new gG(e,t)}})}class gG{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let i=o=>{this[s](o)};return e.dom.addEventListener(s,i),{name:s,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,s=this.editorView.dom,i=s.getBoundingClientRect(),o=i.width/s.offsetWidth,a=i.height/s.offsetHeight;if(n){let f=e.nodeBefore,h=e.nodeAfter;if(f||h){let p=this.editorView.nodeDOM(this.cursorPos-(f?f.nodeSize:0));if(p){let m=p.getBoundingClientRect(),y=f?m.bottom:m.top;f&&h&&(y=(y+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let x=this.width/2*a;r={left:m.left,right:m.right,top:y-x,bottom:y+x}}}}if(!r){let f=this.editorView.coordsAtPos(this.cursorPos),h=this.width/2*o;r={left:f.left-h,right:f.left+h,top:f.top,bottom:f.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let u,d;if(!l||l==document.body&&getComputedStyle(l).position=="static")u=-pageXOffset,d=-pageYOffset;else{let f=l.getBoundingClientRect(),h=f.width/l.offsetWidth,p=f.height/l.offsetHeight;u=f.left-l.scrollLeft*h,d=f.top-l.scrollTop*p}this.element.style.left=(r.left-u)/o+"px",this.element.style.top=(r.top-d)/a+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),s=r&&r.type.spec.disableDropCursor,i=typeof s=="function"?s(this.editorView,n,e):s;if(n&&!i){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=iM(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const yG=Vr.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[mG(this.options)]}});class Qn extends ln{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return Qn.valid(r)?new Qn(r):ln.near(r)}content(){return Lt.empty}eq(e){return e instanceof Qn&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Qn(e.resolve(n.pos))}getBookmark(){return new jv(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!xG(e)||!bG(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let s=n.contentMatchAt(e.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&Qn.valid(e))return e;let s=e.pos,i=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){i=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;s+=n;let l=e.doc.resolve(s);if(Qn.valid(l))return l}for(;;){let o=n>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!Kt.isSelectable(i)){e=e.doc.resolve(s+i.nodeSize*n),r=!1;continue e}break}i=o,s+=n;let a=e.doc.resolve(s);if(Qn.valid(a))return a}return null}}}Qn.prototype.visible=!1;Qn.findFrom=Qn.findGapCursorFrom;ln.jsonID("gapcursor",Qn);class jv{constructor(e){this.pos=e}map(e){return new jv(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return Qn.valid(n)?new Qn(n):ln.near(n)}}function m5(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function xG(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n-1);;s=s.lastChild){if(s.childCount==0&&!s.inlineContent||m5(s.type))return!0;if(s.inlineContent)return!1}}return!0}function bG(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n);;s=s.firstChild){if(s.childCount==0&&!s.inlineContent||m5(s.type))return!0;if(s.inlineContent)return!1}}return!0}function wG(){return new Tr({props:{decorations:_G,createSelectionBetween(t,e,n){return e.pos==n.pos&&Qn.valid(n)?new Qn(n):null},handleClick:kG,handleKeyDown:vG,handleDOMEvents:{beforeinput:SG}}})}const vG=qM({ArrowLeft:Lh("horiz",-1),ArrowRight:Lh("horiz",1),ArrowUp:Lh("vert",-1),ArrowDown:Lh("vert",1)});function Lh(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,s,i){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof nn){if(!i.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let u=Qn.findGapCursorFrom(a,e,l);return u?(s&&s(r.tr.setSelection(new Qn(u))),!0):!1}}function kG(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!Qn.valid(r))return!1;let s=t.posAtCoords({left:n.clientX,top:n.clientY});return s&&s.inside>-1&&Kt.isSelectable(t.state.doc.nodeAt(s.inside))?!1:(t.dispatch(t.state.tr.setSelection(new Qn(r))),!0)}function SG(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof Qn))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let s=kt.empty;for(let o=r.length-1;o>=0;o--)s=kt.from(r[o].createAndFill(null,s));let i=t.state.tr.replace(n.pos,n.pos,new Lt(s,0,0));return i.setSelection(nn.near(i.doc.resolve(n.pos+1))),t.dispatch(i),!1}function _G(t){if(!(t.selection instanceof Qn))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",yr.create(t.doc,[Os.widget(t.selection.head,e,{key:"gapcursor"})])}const TG=Vr.create({name:"gapCursor",addProseMirrorPlugins(){return[wG()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=fn(Ht(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),CG=pr.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",kn(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:s,storedMarks:i}=n;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=i||s.$to.parentOffset&&s.$from.marks();return e().insertContent({type:this.name}).command(({tr:u,dispatch:d})=>{if(d&&l&&o){const f=l.filter(h=>a.includes(h.type.name));u.ensureMarks(f)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),EG=pr.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,kn(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>q1({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var Tm=200,Ur=function(){};Ur.prototype.append=function(e){return e.length?(e=Ur.from(e),!this.length&&e||e.length<Tm&&this.leafAppend(e)||this.length<Tm&&e.leafPrepend(this)||this.appendInner(e)):this};Ur.prototype.prepend=function(e){return e.length?Ur.from(e).append(this):this};Ur.prototype.appendInner=function(e){return new NG(this,e)};Ur.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?Ur.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};Ur.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Ur.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};Ur.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var s=[];return this.forEach(function(i,o){return s.push(e(i,o))},n,r),s};Ur.from=function(e){return e instanceof Ur?e:e&&e.length?new g5(e):Ur.empty};var g5=function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(s,i){return s==0&&i==this.length?this:new e(this.values.slice(s,i))},e.prototype.getInner=function(s){return this.values[s]},e.prototype.forEachInner=function(s,i,o,a){for(var l=i;l<o;l++)if(s(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(s,i,o,a){for(var l=i-1;l>=o;l--)if(s(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(s){if(this.length+s.length<=Tm)return new e(this.values.concat(s.flatten()))},e.prototype.leafPrepend=function(s){if(this.length+s.length<=Tm)return new e(s.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(Ur);Ur.empty=new g5([]);var NG=function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,s,i,o){var a=this.left.length;if(s<a&&this.left.forEachInner(r,s,Math.min(i,a),o)===!1||i>a&&this.right.forEachInner(r,Math.max(s-a,0),Math.min(this.length,i)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,s,i,o){var a=this.left.length;if(s>a&&this.right.forEachInvertedInner(r,s-a,Math.max(i,a)-a,o+a)===!1||i<a&&this.left.forEachInvertedInner(r,Math.min(s,a),i,o)===!1)return!1},e.prototype.sliceInner=function(r,s){if(r==0&&s==this.length)return this;var i=this.left.length;return s<=i?this.left.slice(r,s):r>=i?this.right.slice(r-i,s-i):this.left.slice(r,i).append(this.right.slice(0,s-i))},e.prototype.leafAppend=function(r){var s=this.right.leafAppend(r);if(s)return new e(this.left,s)},e.prototype.leafPrepend=function(r){var s=this.left.leafPrepend(r);if(s)return new e(s,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(Ur);const jG=500;class Wi{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let s,i;n&&(s=this.remapping(r,this.items.length),i=s.maps.length);let o=e.tr,a,l,u=[],d=[];return this.items.forEach((f,h)=>{if(!f.step){s||(s=this.remapping(r,h+1),i=s.maps.length),i--,d.push(f);return}if(s){d.push(new eo(f.map));let p=f.step.map(s.slice(i)),m;p&&o.maybeStep(p).doc&&(m=o.mapping.maps[o.mapping.maps.length-1],u.push(new eo(m,void 0,void 0,u.length+d.length))),i--,m&&s.appendMap(m,i)}else o.maybeStep(f.step);if(f.selection)return a=s?f.selection.map(s.slice(i)):f.selection,l=new Wi(this.items.slice(0,r).append(d.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,r,s){let i=[],o=this.eventCount,a=this.items,l=!s&&a.length?a.get(a.length-1):null;for(let d=0;d<e.steps.length;d++){let f=e.steps[d].invert(e.docs[d]),h=new eo(e.mapping.maps[d],f,n),p;(p=l&&l.merge(h))&&(h=p,d?i.pop():a=a.slice(0,a.length-1)),i.push(h),n&&(o++,n=void 0),s||(l=h)}let u=o-r.depth;return u>DG&&(a=IG(a,u),o-=u),new Wi(a.append(i),o)}remapping(e,n){let r=new Sf;return this.items.forEach((s,i)=>{let o=s.mirrorOffset!=null&&i-s.mirrorOffset>=e?r.maps.length-s.mirrorOffset:void 0;r.appendMap(s.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new Wi(this.items.append(e.map(n=>new eo(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],s=Math.max(0,this.items.length-n),i=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(h=>{h.selection&&a--},s);let l=n;this.items.forEach(h=>{let p=i.getMirror(--l);if(p==null)return;o=Math.min(o,p);let m=i.maps[p];if(h.step){let y=e.steps[p].invert(e.docs[p]),x=h.selection&&h.selection.map(i.slice(l+1,p));x&&a++,r.push(new eo(m,y,x))}else r.push(new eo(m))},s);let u=[];for(let h=n;h<o;h++)u.push(new eo(i.maps[h]));let d=this.items.slice(0,s).append(u).append(r),f=new Wi(d,a);return f.emptyItemCount()>jG&&(f=f.compress(this.items.length-r.length)),f}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,s=[],i=0;return this.items.forEach((o,a)=>{if(a>=e)s.push(o),o.selection&&i++;else if(o.step){let l=o.step.map(n.slice(r)),u=l&&l.getMap();if(r--,u&&n.appendMap(u,r),l){let d=o.selection&&o.selection.map(n.slice(r));d&&i++;let f=new eo(u.invert(),l,d),h,p=s.length-1;(h=s.length&&s[p].merge(f))?s[p]=h:s.push(f)}}else o.map&&r--},this.items.length,0),new Wi(Ur.from(s.reverse()),i)}}Wi.empty=new Wi(Ur.empty,0);function IG(t,e){let n;return t.forEach((r,s)=>{if(r.selection&&e--==0)return n=s,!1}),t.slice(n)}class eo{constructor(e,n,r,s){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new eo(n.getMap().invert(),n,this.selection)}}}class fa{constructor(e,n,r,s,i){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=s,this.prevComposition=i}}const DG=20;function AG(t,e,n,r){let s=n.getMeta(Ul),i;if(s)return s.historyState;n.getMeta(OG)&&(t=new fa(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(Ul))return o.getMeta(Ul).redo?new fa(t.done.addTransform(n,void 0,r,wp(e)),t.undone,AT(n.mapping.maps),t.prevTime,t.prevComposition):new fa(t.done,t.undone.addTransform(n,void 0,r,wp(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!MG(n,t.prevRanges)),u=o?by(t.prevRanges,n.mapping):AT(n.mapping.maps);return new fa(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,wp(e)),Wi.empty,u,n.time,a??t.prevComposition)}else return(i=n.getMeta("rebased"))?new fa(t.done.rebased(n,i),t.undone.rebased(n,i),by(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new fa(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),by(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function MG(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,s)=>{for(let i=0;i<e.length;i+=2)r<=e[i+1]&&s>=e[i]&&(n=!0)}),n}function AT(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,s,i,o)=>e.push(i,o));return e}function by(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let s=e.map(t[r],1),i=e.map(t[r+1],-1);s<=i&&n.push(s,i)}return n}function RG(t,e,n){let r=wp(e),s=Ul.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,r);if(!i)return null;let o=i.selection.resolve(i.transform.doc),a=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),s,r),l=new fa(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(o).setMeta(Ul,{redo:n,historyState:l})}let wy=!1,MT=null;function wp(t){let e=t.plugins;if(MT!=e){wy=!1,MT=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){wy=!0;break}}return wy}const Ul=new ns("history"),OG=new ns("closeHistory");function PG(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Tr({key:Ul,state:{init(){return new fa(Wi.empty,Wi.empty,null,0,-1)},apply(e,n,r){return AG(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,s=r=="historyUndo"?x5:r=="historyRedo"?b5:null;return!s||!e.editable?!1:(n.preventDefault(),s(e.state,e.dispatch))}}}})}function y5(t,e){return(n,r)=>{let s=Ul.getState(n);if(!s||(t?s.undone:s.done).eventCount==0)return!1;if(r){let i=RG(s,n,t);i&&r(e?i.scrollIntoView():i)}return!0}}const x5=y5(!1,!0),b5=y5(!0,!0),LG=Vr.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>x5(t,e),redo:()=>({state:t,dispatch:e})=>b5(t,e)}},addProseMirrorPlugins(){return[PG(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),$G=pr.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",kn(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!LK(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$from:r,$to:s}=n,i=t();return r.parentOffset===0?i.insertContentAt({from:Math.max(r.pos-1,0),to:s.pos},{type:this.name}):rK(n)?i.insertContentAt(s.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({tr:o,dispatch:a})=>{var l;if(a){const{$to:u}=o.selection,d=u.end();if(u.nodeAfter)u.nodeAfter.isTextblock?o.setSelection(nn.create(o.doc,u.pos+1)):u.nodeAfter.isBlock?o.setSelection(Kt.create(o.doc,u.pos)):o.setSelection(nn.create(o.doc,u.pos));else{const f=(l=u.parent.type.contentMatch.defaultType)===null||l===void 0?void 0:l.create();f&&(o.insert(d,f),o.setSelection(nn.create(o.doc,d+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[OK({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),zG=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,FG=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,BG=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,UG=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,HG=ei.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Ql({find:zG,type:this.type}),Ql({find:BG,type:this.type})]},addPasteRules(){return[Wa({find:FG,type:this.type}),Wa({find:UG,type:this.type})]}}),VG=pr.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",kn(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),WG="listItem",RT="textStyle",OT=/^(\d+)\.\s$/,KG=pr.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",kn(this.options.HTMLAttributes,n),0]:["ol",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(WG,this.editor.getAttributes(RT)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=Su({find:OT,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=Su({find:OT,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(RT)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),GG=pr.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),qG=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,JG=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,YG=ei.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Ql({find:qG,type:this.type})]},addPasteRules(){return[Wa({find:JG,type:this.type})]}}),XG=pr.create({name:"text",group:"inline"}),QG=Vr.create({name:"starterKit",addExtensions(){var t,e,n,r,s,i,o,a,l,u,d,f,h,p,m,y,x,g;const v=[];return this.options.blockquote!==!1&&v.push(eG.configure((t=this.options)===null||t===void 0?void 0:t.blockquote)),this.options.bold!==!1&&v.push(iG.configure((e=this.options)===null||e===void 0?void 0:e.bold)),this.options.bulletList!==!1&&v.push(aG.configure((n=this.options)===null||n===void 0?void 0:n.bulletList)),this.options.code!==!1&&v.push(uG.configure((r=this.options)===null||r===void 0?void 0:r.code)),this.options.codeBlock!==!1&&v.push(hG.configure((s=this.options)===null||s===void 0?void 0:s.codeBlock)),this.options.document!==!1&&v.push(pG.configure((i=this.options)===null||i===void 0?void 0:i.document)),this.options.dropcursor!==!1&&v.push(yG.configure((o=this.options)===null||o===void 0?void 0:o.dropcursor)),this.options.gapcursor!==!1&&v.push(TG.configure((a=this.options)===null||a===void 0?void 0:a.gapcursor)),this.options.hardBreak!==!1&&v.push(CG.configure((l=this.options)===null||l===void 0?void 0:l.hardBreak)),this.options.heading!==!1&&v.push(EG.configure((u=this.options)===null||u===void 0?void 0:u.heading)),this.options.history!==!1&&v.push(LG.configure((d=this.options)===null||d===void 0?void 0:d.history)),this.options.horizontalRule!==!1&&v.push($G.configure((f=this.options)===null||f===void 0?void 0:f.horizontalRule)),this.options.italic!==!1&&v.push(HG.configure((h=this.options)===null||h===void 0?void 0:h.italic)),this.options.listItem!==!1&&v.push(VG.configure((p=this.options)===null||p===void 0?void 0:p.listItem)),this.options.orderedList!==!1&&v.push(KG.configure((m=this.options)===null||m===void 0?void 0:m.orderedList)),this.options.paragraph!==!1&&v.push(GG.configure((y=this.options)===null||y===void 0?void 0:y.paragraph)),this.options.strike!==!1&&v.push(YG.configure((x=this.options)===null||x===void 0?void 0:x.strike)),this.options.text!==!1&&v.push(XG.configure((g=this.options)===null||g===void 0?void 0:g.text)),v}}),ZG="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",eq="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",J1="numeric",Y1="ascii",X1="alpha",Md="asciinumeric",hd="alphanumeric",Q1="domain",w5="emoji",tq="scheme",nq="slashscheme",vy="whitespace";function rq(t,e){return t in e||(e[t]=[]),e[t]}function Al(t,e,n){e[J1]&&(e[Md]=!0,e[hd]=!0),e[Y1]&&(e[Md]=!0,e[X1]=!0),e[Md]&&(e[hd]=!0),e[X1]&&(e[hd]=!0),e[hd]&&(e[Q1]=!0),e[w5]&&(e[Q1]=!0);for(const r in e){const s=rq(r,n);s.indexOf(t)<0&&s.push(t)}}function sq(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function As(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}As.groups={};As.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const s=e.jr[r][0],i=e.jr[r][1];if(i&&s.test(t))return i}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let s=0;s<t.length;s++)this.tt(t[s],e,n,r)},tr(t,e,n,r){r=r||As.groups;let s;return e&&e.j?s=e:(s=new As(e),n&&r&&Al(e,n,r)),this.jr.push([t,s]),s},ts(t,e,n,r){let s=this;const i=t.length;if(!i)return s;for(let o=0;o<i-1;o++)s=s.tt(t[o]);return s.tt(t[i-1],e,n,r)},tt(t,e,n,r){r=r||As.groups;const s=this;if(e&&e.j)return s.j[t]=e,e;const i=e;let o,a=s.go(t);if(a?(o=new As,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new As,i){if(r)if(o.t&&typeof o.t=="string"){const l=Object.assign(sq(o.t,r),n);Al(i,l,r)}else n&&Al(i,n,r);o.t=i}return s.j[t]=o,o}};const un=(t,e,n,r,s)=>t.ta(e,n,r,s),ur=(t,e,n,r,s)=>t.tr(e,n,r,s),PT=(t,e,n,r,s)=>t.ts(e,n,r,s),St=(t,e,n,r,s)=>t.tt(e,n,r,s),jo="WORD",Z1="UWORD",v5="ASCIINUMERICAL",k5="ALPHANUMERICAL",If="LOCALHOST",eb="TLD",tb="UTLD",vp="SCHEME",Cc="SLASH_SCHEME",Iv="NUM",nb="WS",Dv="NL",Rd="OPENBRACE",Od="CLOSEBRACE",Cm="OPENBRACKET",Em="CLOSEBRACKET",Nm="OPENPAREN",jm="CLOSEPAREN",Im="OPENANGLEBRACKET",Dm="CLOSEANGLEBRACKET",Am="FULLWIDTHLEFTPAREN",Mm="FULLWIDTHRIGHTPAREN",Rm="LEFTCORNERBRACKET",Om="RIGHTCORNERBRACKET",Pm="LEFTWHITECORNERBRACKET",Lm="RIGHTWHITECORNERBRACKET",$m="FULLWIDTHLESSTHAN",zm="FULLWIDTHGREATERTHAN",Fm="AMPERSAND",Bm="APOSTROPHE",Um="ASTERISK",ha="AT",Hm="BACKSLASH",Vm="BACKTICK",Wm="CARET",ba="COLON",Av="COMMA",Km="DOLLAR",to="DOT",Gm="EQUALS",Mv="EXCLAMATION",ui="HYPHEN",Pd="PERCENT",qm="PIPE",Jm="PLUS",Ym="POUND",Ld="QUERY",Rv="QUOTE",S5="FULLWIDTHMIDDLEDOT",Ov="SEMI",no="SLASH",$d="TILDE",Xm="UNDERSCORE",_5="EMOJI",Qm="SYM";var T5=Object.freeze({__proto__:null,ALPHANUMERICAL:k5,AMPERSAND:Fm,APOSTROPHE:Bm,ASCIINUMERICAL:v5,ASTERISK:Um,AT:ha,BACKSLASH:Hm,BACKTICK:Vm,CARET:Wm,CLOSEANGLEBRACKET:Dm,CLOSEBRACE:Od,CLOSEBRACKET:Em,CLOSEPAREN:jm,COLON:ba,COMMA:Av,DOLLAR:Km,DOT:to,EMOJI:_5,EQUALS:Gm,EXCLAMATION:Mv,FULLWIDTHGREATERTHAN:zm,FULLWIDTHLEFTPAREN:Am,FULLWIDTHLESSTHAN:$m,FULLWIDTHMIDDLEDOT:S5,FULLWIDTHRIGHTPAREN:Mm,HYPHEN:ui,LEFTCORNERBRACKET:Rm,LEFTWHITECORNERBRACKET:Pm,LOCALHOST:If,NL:Dv,NUM:Iv,OPENANGLEBRACKET:Im,OPENBRACE:Rd,OPENBRACKET:Cm,OPENPAREN:Nm,PERCENT:Pd,PIPE:qm,PLUS:Jm,POUND:Ym,QUERY:Ld,QUOTE:Rv,RIGHTCORNERBRACKET:Om,RIGHTWHITECORNERBRACKET:Lm,SCHEME:vp,SEMI:Ov,SLASH:no,SLASH_SCHEME:Cc,SYM:Qm,TILDE:$d,TLD:eb,UNDERSCORE:Xm,UTLD:tb,UWORD:Z1,WORD:jo,WS:nb});const Co=/[a-z]/,Qu=/\p{L}/u,ky=/\p{Emoji}/u,Eo=/\d/,Sy=/\s/,LT="\r",_y=`
`,iq="",oq="",Ty="";let $h=null,zh=null;function aq(t=[]){const e={};As.groups=e;const n=new As;$h==null&&($h=$T(ZG)),zh==null&&(zh=$T(eq)),St(n,"'",Bm),St(n,"{",Rd),St(n,"}",Od),St(n,"[",Cm),St(n,"]",Em),St(n,"(",Nm),St(n,")",jm),St(n,"<",Im),St(n,">",Dm),St(n,"",Am),St(n,"",Mm),St(n,"",Rm),St(n,"",Om),St(n,"",Pm),St(n,"",Lm),St(n,"",$m),St(n,"",zm),St(n,"&",Fm),St(n,"*",Um),St(n,"@",ha),St(n,"`",Vm),St(n,"^",Wm),St(n,":",ba),St(n,",",Av),St(n,"$",Km),St(n,".",to),St(n,"=",Gm),St(n,"!",Mv),St(n,"-",ui),St(n,"%",Pd),St(n,"|",qm),St(n,"+",Jm),St(n,"#",Ym),St(n,"?",Ld),St(n,'"',Rv),St(n,"/",no),St(n,";",Ov),St(n,"~",$d),St(n,"_",Xm),St(n,"\\",Hm),St(n,"",S5);const r=ur(n,Eo,Iv,{[J1]:!0});ur(r,Eo,r);const s=ur(r,Co,v5,{[Md]:!0}),i=ur(r,Qu,k5,{[hd]:!0}),o=ur(n,Co,jo,{[Y1]:!0});ur(o,Eo,s),ur(o,Co,o),ur(s,Eo,s),ur(s,Co,s);const a=ur(n,Qu,Z1,{[X1]:!0});ur(a,Co),ur(a,Eo,i),ur(a,Qu,a),ur(i,Eo,i),ur(i,Co),ur(i,Qu,i);const l=St(n,_y,Dv,{[vy]:!0}),u=St(n,LT,nb,{[vy]:!0}),d=ur(n,Sy,nb,{[vy]:!0});St(n,Ty,d),St(u,_y,l),St(u,Ty,d),ur(u,Sy,d),St(d,LT),St(d,_y),ur(d,Sy,d),St(d,Ty,d);const f=ur(n,ky,_5,{[w5]:!0});St(f,"#"),ur(f,ky,f),St(f,iq,f);const h=St(f,oq);St(h,"#"),ur(h,ky,f);const p=[[Co,o],[Eo,s]],m=[[Co,null],[Qu,a],[Eo,i]];for(let y=0;y<$h.length;y++)ta(n,$h[y],eb,jo,p);for(let y=0;y<zh.length;y++)ta(n,zh[y],tb,Z1,m);Al(eb,{tld:!0,ascii:!0},e),Al(tb,{utld:!0,alpha:!0},e),ta(n,"file",vp,jo,p),ta(n,"mailto",vp,jo,p),ta(n,"http",Cc,jo,p),ta(n,"https",Cc,jo,p),ta(n,"ftp",Cc,jo,p),ta(n,"ftps",Cc,jo,p),Al(vp,{scheme:!0,ascii:!0},e),Al(Cc,{slashscheme:!0,ascii:!0},e),t=t.sort((y,x)=>y[0]>x[0]?1:-1);for(let y=0;y<t.length;y++){const x=t[y][0],v=t[y][1]?{[tq]:!0}:{[nq]:!0};x.indexOf("-")>=0?v[Q1]=!0:Co.test(x)?Eo.test(x)?v[Md]=!0:v[Y1]=!0:v[J1]=!0,PT(n,x,x,v)}return PT(n,"localhost",If,{ascii:!0}),n.jd=new As(Qm),{start:n,tokens:Object.assign({groups:e},T5)}}function C5(t,e){const n=lq(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=n.length,s=[];let i=0,o=0;for(;o<r;){let a=t,l=null,u=0,d=null,f=-1,h=-1;for(;o<r&&(l=a.go(n[o]));)a=l,a.accepts()?(f=0,h=0,d=a):f>=0&&(f+=n[o].length,h++),u+=n[o].length,i+=n[o].length,o++;i-=f,o-=h,u-=f,s.push({t:d.t,v:e.slice(i-u,i),s:i-u,e:i})}return s}function lq(t){const e=[],n=t.length;let r=0;for(;r<n;){let s=t.charCodeAt(r),i,o=s<55296||s>56319||r+1===n||(i=t.charCodeAt(r+1))<56320||i>57343?t[r]:t.slice(r,r+2);e.push(o),r+=o.length}return e}function ta(t,e,n,r,s){let i;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];t.j[l]?i=t.j[l]:(i=new As(r),i.jr=s.slice(),t.j[l]=i),t=i}return i=new As(n),i.jr=s.slice(),t.j[e[o-1]]=i,i}function $T(t){const e=[],n=[];let r=0,s="0123456789";for(;r<t.length;){let i=0;for(;s.indexOf(t[r+i])>=0;)i++;if(i>0){e.push(n.join(""));for(let o=parseInt(t.substring(r,r+i),10);o>0;o--)n.pop();r+=i}else n.push(t[r]),r++}return e}const Df={defaultProtocol:"http",events:null,format:zT,formatHref:zT,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Pv(t,e=null){let n=Object.assign({},Df);t&&(n=Object.assign(n,t instanceof Pv?t.o:t));const r=n.ignoreTags,s=[];for(let i=0;i<r.length;i++)s.push(r[i].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=s}Pv.prototype={o:Df,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let s=this.o[t];return s&&(typeof s=="object"?(s=n.t in s?s[n.t]:Df[t],typeof s=="function"&&r&&(s=s(e,n))):typeof s=="function"&&r&&(s=s(e,n.t,n)),s)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function zT(t){return t}function E5(t,e){this.t="token",this.v=t,this.tk=e}E5.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=Df.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),s=t.get("tagName",n,e),i=this.toFormattedString(t),o={},a=t.get("className",n,e),l=t.get("target",n,e),u=t.get("rel",n,e),d=t.getObj("attributes",n,e),f=t.getObj("events",n,e);return o.href=r,a&&(o.class=a),l&&(o.target=l),u&&(o.rel=u),d&&Object.assign(o,d),{tagName:s,attributes:o,content:i,eventListeners:f}}};function Gg(t,e){class n extends E5{constructor(s,i){super(s,i),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const FT=Gg("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),BT=Gg("text"),cq=Gg("nl"),Fh=Gg("url",{isLink:!0,toHref(t=Df.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==If&&t[1].t===ba}}),li=t=>new As(t);function uq({groups:t}){const e=t.domain.concat([Fm,Um,ha,Hm,Vm,Wm,Km,Gm,ui,Iv,Pd,qm,Jm,Ym,no,Qm,$d,Xm]),n=[Bm,ba,Av,to,Mv,Pd,Ld,Rv,Ov,Im,Dm,Rd,Od,Em,Cm,Nm,jm,Am,Mm,Rm,Om,Pm,Lm,$m,zm],r=[Fm,Bm,Um,Hm,Vm,Wm,Km,Gm,ui,Rd,Od,Pd,qm,Jm,Ym,Ld,no,Qm,$d,Xm],s=li(),i=St(s,$d);un(i,r,i),un(i,t.domain,i);const o=li(),a=li(),l=li();un(s,t.domain,o),un(s,t.scheme,a),un(s,t.slashscheme,l),un(o,r,i),un(o,t.domain,o);const u=St(o,ha);St(i,ha,u),St(a,ha,u),St(l,ha,u);const d=St(i,to);un(d,r,i),un(d,t.domain,i);const f=li();un(u,t.domain,f),un(f,t.domain,f);const h=St(f,to);un(h,t.domain,f);const p=li(FT);un(h,t.tld,p),un(h,t.utld,p),St(u,If,p);const m=St(f,ui);St(m,ui,m),un(m,t.domain,f),un(p,t.domain,f),St(p,to,h),St(p,ui,m);const y=St(p,ba);un(y,t.numeric,FT);const x=St(o,ui),g=St(o,to);St(x,ui,x),un(x,t.domain,o),un(g,r,i),un(g,t.domain,o);const v=li(Fh);un(g,t.tld,v),un(g,t.utld,v),un(v,t.domain,o),un(v,r,i),St(v,to,g),St(v,ui,x),St(v,ha,u);const w=St(v,ba),S=li(Fh);un(w,t.numeric,S);const I=li(Fh),k=li();un(I,e,I),un(I,n,k),un(k,e,I),un(k,n,k),St(v,no,I),St(S,no,I);const R=St(a,ba),C=St(l,ba),T=St(C,no),_=St(T,no);un(a,t.domain,o),St(a,to,g),St(a,ui,x),un(l,t.domain,o),St(l,to,g),St(l,ui,x),un(R,t.domain,I),St(R,no,I),St(R,Ld,I),un(_,t.domain,I),un(_,e,I),St(_,no,I);const N=[[Rd,Od],[Cm,Em],[Nm,jm],[Im,Dm],[Am,Mm],[Rm,Om],[Pm,Lm],[$m,zm]];for(let j=0;j<N.length;j++){const[O,P]=N[j],G=St(I,O);St(k,O,G),St(G,P,I);const A=li(Fh);un(G,e,A);const M=li();un(G,n),un(A,e,A),un(A,n,M),un(M,e,A),un(M,n,M),St(A,P,I),St(M,P,I)}return St(s,If,v),St(s,Dv,cq),{start:s,tokens:T5}}function dq(t,e,n){let r=n.length,s=0,i=[],o=[];for(;s<r;){let a=t,l=null,u=null,d=0,f=null,h=-1;for(;s<r&&!(l=a.go(n[s].t));)o.push(n[s++]);for(;s<r&&(u=l||a.go(n[s].t));)l=null,a=u,a.accepts()?(h=0,f=a):h>=0&&h++,s++,d++;if(h<0)s-=d,s<r&&(o.push(n[s]),s++);else{o.length>0&&(i.push(Cy(BT,e,o)),o=[]),s-=h,d-=h;const p=f.t,m=n.slice(s-d,s);i.push(Cy(p,e,m))}}return o.length>0&&i.push(Cy(BT,e,o)),i}function Cy(t,e,n){const r=n[0].s,s=n[n.length-1].e,i=e.slice(r,s);return new t(i,n)}const fq=typeof console<"u"&&console&&console.warn||(()=>{}),hq="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Wn={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function pq(){return As.groups={},Wn.scanner=null,Wn.parser=null,Wn.tokenQueue=[],Wn.pluginQueue=[],Wn.customSchemes=[],Wn.initialized=!1,Wn}function UT(t,e=!1){if(Wn.initialized&&fq(`linkifyjs: already initialized - will not register custom scheme "${t}" ${hq}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Wn.customSchemes.push([t,e])}function mq(){Wn.scanner=aq(Wn.customSchemes);for(let t=0;t<Wn.tokenQueue.length;t++)Wn.tokenQueue[t][1]({scanner:Wn.scanner});Wn.parser=uq(Wn.scanner.tokens);for(let t=0;t<Wn.pluginQueue.length;t++)Wn.pluginQueue[t][1]({scanner:Wn.scanner,parser:Wn.parser});return Wn.initialized=!0,Wn}function N5(t){return Wn.initialized||mq(),dq(Wn.parser.start,t,C5(Wn.scanner.start,t))}N5.scan=C5;function Lv(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new Pv(n),s=N5(t),i=[];for(let o=0;o<s.length;o++){const a=s[o];a.isLink&&(!e||a.t===e)&&r.check(a)&&i.push(a.toFormattedObject(r))}return i}function gq(t){return new Tr({key:new ns("autolink"),appendTransaction:(e,n,r)=>{const s=e.some(u=>u.docChanged)&&!n.doc.eq(r.doc),i=e.some(u=>u.getMeta("preventAutolink"));if(!s||i)return;const{tr:o}=r,a=JW(n.doc,[...e]);if(nK(a).forEach(({newRange:u})=>{const d=YW(r.doc,u,p=>p.isTextblock);let f,h;if(d.length>1?(f=d[0],h=r.doc.textBetween(f.pos,f.pos+f.node.nodeSize,void 0," ")):d.length&&r.doc.textBetween(u.from,u.to," "," ").endsWith(" ")&&(f=d[0],h=r.doc.textBetween(f.pos,u.to,void 0," ")),f&&h){const p=h.split(" ").filter(x=>x!=="");if(p.length<=0)return!1;const m=p[p.length-1],y=f.pos+h.lastIndexOf(m);if(!m)return!1;Lv(m).filter(x=>x.isLink).map(x=>({...x,from:y+x.start+1,to:y+x.end+1})).filter(x=>r.schema.marks.code?!r.doc.rangeHasMark(x.from,x.to,r.schema.marks.code):!0).filter(x=>t.validate?t.validate(x.value):!0).forEach(x=>{Ev(x.from,x.to,r.doc).some(g=>g.mark.type===t.type)||o.addMark(x.from,x.to,t.type.create({href:x.href}))})}}),!!o.steps.length)return o}})}function yq(t){return new Tr({key:new ns("handleClickLink"),props:{handleClick:(e,n,r)=>{var s,i;if(r.button!==0)return!1;let o=r.target;const a=[];for(;o.nodeName!=="DIV";)a.push(o),o=o.parentNode;if(!a.find(h=>h.nodeName==="A"))return!1;const l=f5(e.state,t.type.name),u=r.target,d=(s=u==null?void 0:u.href)!==null&&s!==void 0?s:l.href,f=(i=u==null?void 0:u.target)!==null&&i!==void 0?i:l.target;return u&&d?(window.open(d,f),!0):!1}}})}function xq(t){return new Tr({key:new ns("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{state:s}=e,{selection:i}=s,{empty:o}=i;if(o)return!1;let a="";r.content.forEach(u=>{a+=u.textContent});const l=Lv(a).find(u=>u.isLink&&u.value===a);return!a||!l?!1:(t.editor.commands.setMark(t.type,{href:l.href}),!0)}}})}const bq=ei.create({name:"link",priority:1e3,keepOnSplit:!1,onCreate(){this.options.protocols.forEach(t=>{if(typeof t=="string"){UT(t);return}UT(t.scheme,t.optionalSlashes)})},onDestroy(){pq()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},validate:void 0}},addAttributes(){return{href:{default:null},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:'a[href]:not([href *= "javascript:" i])'}]},renderHTML({HTMLAttributes:t}){var e;return!((e=t.href)===null||e===void 0)&&e.startsWith("javascript:")?["a",kn(this.options.HTMLAttributes,{...t,href:""}),0]:["a",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setLink:t=>({chain:e})=>e().setMark(this.name,t).setMeta("preventAutolink",!0).run(),toggleLink:t=>({chain:e})=>e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run(),unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Wa({find:t=>{const e=[];if(t){const n=Lv(t).filter(r=>r.isLink);n.length&&n.forEach(r=>e.push({text:r.value,data:{href:r.href},index:r.start}))}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[];return this.options.autolink&&t.push(gq({type:this.type,validate:this.options.validate})),this.options.openOnClick&&t.push(yq({type:this.type})),this.options.linkOnPaste&&t.push(xq({editor:this.editor,type:this.type})),t}}),wq=Vr.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,considerAnyAsEmpty:!1,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new Tr({key:new ns("placeholder"),props:{decorations:({doc:t,selection:e})=>{var n;const r=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:s}=e,i=[];if(!r)return null;const{firstChild:o}=t.content,a=o&&o.type.isLeaf,l=o&&o.isAtom,u=this.options.considerAnyAsEmpty?!0:o&&o.type.name===((n=t.type.contentMatch.defaultType)===null||n===void 0?void 0:n.name),d=t.content.childCount<=1&&o&&u&&o.nodeSize<=2&&(!a||!l);return t.descendants((f,h)=>{const p=s>=h&&s<=h+f.nodeSize,m=!f.isLeaf&&!f.childCount;if((p||!this.options.showOnlyCurrent)&&m){const y=[this.options.emptyNodeClass];d&&y.push(this.options.emptyEditorClass);const x=Os.node(h,h+f.nodeSize,{class:y.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:f,pos:h,hasAnchor:p}):this.options.placeholder});i.push(x)}return this.options.includeChildren}),yr.create(t,i)}}})]}}),vq=pr.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",kn(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}}),kq=/^\s*(\[([( |x])?\])\s$/,Sq=pr.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList"}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>t.getAttribute("data-checked")==="true",renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",kn(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:n,editor:r})=>{const s=document.createElement("li"),i=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div");return i.contentEditable="false",a.type="checkbox",a.addEventListener("change",u=>{if(!r.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:d}=u.target;r.isEditable&&typeof n=="function"&&r.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:f})=>{const h=n(),p=f.doc.nodeAt(h);return f.setNodeMarkup(h,void 0,{...p==null?void 0:p.attrs,checked:d}),!0}).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,d)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([u,d])=>{s.setAttribute(u,d)}),s.dataset.checked=t.attrs.checked,t.attrs.checked&&a.setAttribute("checked","checked"),i.append(a,o),s.append(i,l),Object.entries(e).forEach(([u,d])=>{s.setAttribute(u,d)}),{dom:s,contentDOM:l,update:u=>u.type!==this.type?!1:(s.dataset.checked=u.attrs.checked,u.attrs.checked?a.setAttribute("checked","checked"):a.removeAttribute("checked"),!0)}}},addInputRules(){return[Su({find:kq,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),_q=t=>{if(!t.children.length)return;const e=t.querySelectorAll("span");e&&e.forEach(n=>{var r,s;const i=n.getAttribute("style"),o=(s=(r=n.parentElement)===null||r===void 0?void 0:r.closest("span"))===null||s===void 0?void 0:s.getAttribute("style");n.setAttribute("style",`${o};${i}`)})},Tq=ei.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{},mergeNestedSpanStyles:!1}},parseHTML(){return[{tag:"span",getAttrs:t=>t.hasAttribute("style")?(this.options.mergeNestedSpanStyles&&_q(t),{}):!1}]},renderHTML({HTMLAttributes:t}){return["span",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{removeEmptyTextStyle:()=>({tr:t})=>{const{selection:e}=t;return t.doc.nodesBetween(e.from,e.to,(n,r)=>{if(n.isTextblock)return!0;n.marks.filter(s=>s.type===this.type).some(s=>Object.values(s.attrs).some(i=>!!i))||t.removeMark(r,r+n.nodeSize,this.type)}),!0}}}}),Cq=Vr.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:t=>{var e;return(e=t.style.color)===null||e===void 0?void 0:e.replace(/['"]+/g,"")},renderHTML:t=>t.color?{style:`color: ${t.color}`}:{}}}}]},addCommands(){return{setColor:t=>({chain:e})=>e().setMark("textStyle",{color:t}).run(),unsetColor:()=>({chain:t})=>t().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}),Eq=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))$/,Nq=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))/g,jq=ei.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setHighlight:t=>({commands:e})=>e.setMark(this.name,t),toggleHighlight:t=>({commands:e})=>e.toggleMark(this.name,t),unsetHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[Ql({find:Eq,type:this.type})]},addPasteRules(){return[Wa({find:Nq,type:this.type})]}}),Zm=(t,e)=>e.view.domAtPos(t).node.offsetParent!==null,Iq=(t,e,n)=>{for(let r=t.depth;r>0;r-=1){const s=t.node(r),i=e(s),o=Zm(t.start(r),n);if(i&&o)return{pos:r>0?t.before(r):0,start:t.start(r),depth:r,node:s}}},HT=(t,e)=>{const{state:n,view:r,extensionManager:s}=t,{schema:i,selection:o}=n,{empty:a,$anchor:l}=o,u=!!s.extensions.find(g=>g.name==="gapCursor");if(!a||l.parent.type!==i.nodes.detailsSummary||!u||e==="right"&&l.parentOffset!==l.parent.nodeSize-2)return!1;const d=Pu(g=>g.type===i.nodes.details)(o);if(!d)return!1;const f=xp(d.node,g=>g.type===i.nodes.detailsContent);if(!f.length||Zm(d.start+f[0].pos+1,t))return!1;const p=n.doc.resolve(d.pos+d.node.nodeSize),m=Qn.findFrom(p,1,!1);if(!m)return!1;const{tr:y}=n,x=new Qn(m);return y.setSelection(x),y.scrollIntoView(),r.dispatch(y),!0},Dq=pr.create({name:"details",content:"detailsSummary detailsContent",group:"block",defining:!0,isolating:!0,allowGapCursor:!1,addOptions(){return{persist:!1,openClassName:"is-open",HTMLAttributes:{}}},addAttributes(){return this.options.persist?{open:{default:!1,parseHTML:t=>t.hasAttribute("open"),renderHTML:({open:t})=>t?{open:""}:{}}}:[]},parseHTML(){return[{tag:"details"}]},renderHTML({HTMLAttributes:t}){return["details",kn(this.options.HTMLAttributes,t),0]},addNodeView(){return({editor:t,getPos:e,node:n,HTMLAttributes:r})=>{const s=document.createElement("div"),i=kn(this.options.HTMLAttributes,r,{"data-type":this.name});Object.entries(i).forEach(([u,d])=>s.setAttribute(u,d));const o=document.createElement("button");o.type="button",s.append(o);const a=document.createElement("div");s.append(a);const l=u=>{if(u!==void 0)if(u){if(s.classList.contains(this.options.openClassName))return;s.classList.add(this.options.openClassName)}else{if(!s.classList.contains(this.options.openClassName))return;s.classList.remove(this.options.openClassName)}else s.classList.toggle(this.options.openClassName);const d=new Event("toggleDetailsContent"),f=a.querySelector(':scope > div[data-type="detailsContent"]');f==null||f.dispatchEvent(d)};return n.attrs.open&&setTimeout(()=>l()),o.addEventListener("click",()=>{if(l(),!this.options.persist){t.commands.focus(void 0,{scrollIntoView:!1});return}if(t.isEditable&&typeof e=="function"){const{from:u,to:d}=t.state.selection;t.chain().command(({tr:f})=>{const h=e(),p=f.doc.nodeAt(h);return(p==null?void 0:p.type)!==this.type?!1:(f.setNodeMarkup(h,void 0,{open:!p.attrs.open}),!0)}).setTextSelection({from:u,to:d}).focus(void 0,{scrollIntoView:!1}).run()}}),{dom:s,contentDOM:a,ignoreMutation(u){return u.type==="selection"?!1:!s.contains(u.target)||s===u.target},update:u=>u.type!==this.type?!1:(u.attrs.open!==void 0&&l(u.attrs.open),!0)}}},addCommands(){return{setDetails:()=>({state:t,chain:e})=>{var n;const{schema:r,selection:s}=t,{$from:i,$to:o}=s,a=i.blockRange(o);if(!a)return!1;const l=t.doc.slice(a.start,a.end);if(!r.nodes.detailsContent.contentMatch.matchFragment(l.content))return!1;const d=((n=l.toJSON())===null||n===void 0?void 0:n.content)||[];return e().insertContentAt({from:a.start,to:a.end},{type:this.name,content:[{type:"detailsSummary"},{type:"detailsContent",content:d}]}).setTextSelection(a.start+2).run()},unsetDetails:()=>({state:t,chain:e})=>{const{selection:n,schema:r}=t,s=Pu(g=>g.type===this.type)(n);if(!s)return!1;const i=xp(s.node,g=>g.type===r.nodes.detailsSummary),o=xp(s.node,g=>g.type===r.nodes.detailsContent);if(!i.length||!o.length)return!1;const a=i[0],l=o[0],u=s.pos,d=t.doc.resolve(u),f=u+s.node.nodeSize,h={from:u,to:f},p=l.node.content.toJSON()||[],m=d.parent.type.contentMatch.defaultType,x=[m==null?void 0:m.create(null,a.node.content).toJSON(),...p];return e().insertContentAt(h,x).setTextSelection(u+1).run()}}},addKeyboardShortcuts(){return{Backspace:()=>{const{schema:t,selection:e}=this.editor.state,{empty:n,$anchor:r}=e;return!n||r.parent.type!==t.nodes.detailsSummary?!1:r.parentOffset!==0?this.editor.commands.command(({tr:s})=>{const i=r.pos-1,o=r.pos;return s.delete(i,o),!0}):this.editor.commands.unsetDetails()},Enter:({editor:t})=>{const{state:e,view:n}=t,{schema:r,selection:s}=e,{$head:i}=s;if(i.parent.type!==r.nodes.detailsSummary)return!1;const o=Zm(i.after()+1,t),a=o?e.doc.nodeAt(i.after()):i.node(-2);if(!a)return!1;const l=o?0:i.indexAfter(-1),u=Cv(a.contentMatchAt(l));if(!u||!a.canReplaceWith(l,l,u))return!1;const d=u.createAndFill();if(!d)return!1;const f=o?i.after()+1:i.after(-1),h=e.tr.replaceWith(f,f,d),p=h.doc.resolve(f),m=ln.near(p,1);return h.setSelection(m),h.scrollIntoView(),n.dispatch(h),!0},ArrowRight:({editor:t})=>HT(t,"right"),ArrowDown:({editor:t})=>HT(t,"down")}},addProseMirrorPlugins(){return[new Tr({key:new ns("detailsSelection"),appendTransaction:(t,e,n)=>{const{editor:r,type:s}=this;if(!t.some(x=>x.selectionSet)||!e.selection.empty||!n.selection.empty||!h5(n,s.name))return;const{$from:a}=n.selection;if(Zm(a.pos,r))return;const u=Iq(a,x=>x.type===s,r);if(!u)return;const d=xp(u.node,x=>x.type===n.schema.nodes.detailsSummary);if(!d.length)return;const f=d[0],p=(e.selection.from<n.selection.from?"forward":"backward")==="forward"?u.start+f.pos:u.pos+f.pos+f.node.nodeSize,m=nn.create(n.doc,p);return n.tr.setSelection(m)}})]}}),Aq=pr.create({name:"detailsSummary",content:"text*",defining:!0,selectable:!1,isolating:!0,addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"summary"}]},renderHTML({HTMLAttributes:t}){return["summary",kn(this.options.HTMLAttributes,t),0]}}),Mq=pr.create({name:"detailsContent",content:"block+",defining:!0,selectable:!1,addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:`div[data-type="${this.name}"]`}]},renderHTML({HTMLAttributes:t}){return["div",kn(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},addNodeView(){return({HTMLAttributes:t})=>{const e=document.createElement("div"),n=kn(this.options.HTMLAttributes,t,{"data-type":this.name,hidden:"hidden"});return Object.entries(n).forEach(([r,s])=>e.setAttribute(r,s)),e.addEventListener("toggleDetailsContent",()=>{e.toggleAttribute("hidden")}),{dom:e,contentDOM:e,ignoreMutation(r){return r.type==="selection"?!1:!e.contains(r.target)||e===r.target},update:r=>r.type===this.type}}},addKeyboardShortcuts(){return{Enter:({editor:t})=>{const{state:e,view:n}=t,{selection:r}=e,{$from:s,empty:i}=r,o=Pu(N=>N.type===this.type)(r);if(!i||!o||!o.node.childCount)return!1;const a=s.index(o.depth),{childCount:l}=o.node;if(!(l===a+1))return!1;const d=o.node.type.contentMatch.defaultType,f=d==null?void 0:d.createAndFill();if(!f)return!1;const h=e.doc.resolve(o.pos+1),p=l-1,m=o.node.child(p),y=h.posAtIndex(p,o.depth);if(!m.eq(f))return!1;const g=s.node(-3);if(!g)return!1;const v=s.indexAfter(-3),w=Cv(g.contentMatchAt(v));if(!w||!g.canReplaceWith(v,v,w))return!1;const S=w.createAndFill();if(!S)return!1;const{tr:I}=e,k=s.after(-2);I.replaceWith(k,k,S);const R=I.doc.resolve(k),C=ln.near(R,1);I.setSelection(C);const T=y,_=y+m.nodeSize;return I.delete(T,_),I.scrollIntoView(),n.dispatch(I),!0}}}});function Rq(t){var e;const{char:n,allowSpaces:r,allowToIncludeChar:s,allowedPrefixes:i,startOfLine:o,$position:a}=t,l=r&&!s,u=$K(n),d=new RegExp(`\\s${u}$`),f=o?"^":"",h=s?"":u,p=l?new RegExp(`${f}${u}.*?(?=\\s${h}|$)`,"gm"):new RegExp(`${f}(?:^)?${u}[^\\s${h}]*`,"gm"),m=((e=a.nodeBefore)===null||e===void 0?void 0:e.isText)&&a.nodeBefore.text;if(!m)return null;const y=a.pos-m.length,x=Array.from(m.matchAll(p)).pop();if(!x||x.input===void 0||x.index===void 0)return null;const g=x.input.slice(Math.max(0,x.index-1),x.index),v=new RegExp(`^[${i==null?void 0:i.join("")}\0]?$`).test(g);if(i!==null&&!v)return null;const w=y+x.index;let S=w+x[0].length;return l&&d.test(m.slice(S-1,S+1))&&(x[0]+=" ",S+=1),w<a.pos&&S>=a.pos?{range:{from:w,to:S},query:x[0].slice(n.length),text:x[0]}:null}const Oq=new ns("suggestion");function Pq({pluginKey:t=Oq,editor:e,char:n="@",allowSpaces:r=!1,allowToIncludeChar:s=!1,allowedPrefixes:i=[" "],startOfLine:o=!1,decorationTag:a="span",decorationClass:l="suggestion",decorationContent:u="",decorationEmptyClass:d="is-empty",command:f=()=>null,items:h=()=>[],render:p=()=>({}),allow:m=()=>!0,findSuggestionMatch:y=Rq}){let x;const g=p==null?void 0:p(),v=new Tr({key:t,view(){return{update:async(w,S)=>{var I,k,R,C,T,_,N;const j=(I=this.key)===null||I===void 0?void 0:I.getState(S),O=(k=this.key)===null||k===void 0?void 0:k.getState(w.state),P=j.active&&O.active&&j.range.from!==O.range.from,G=!j.active&&O.active,A=j.active&&!O.active,M=!G&&!A&&j.query!==O.query,Q=G||P&&M,X=M||P,D=A||P&&M;if(!Q&&!X&&!D)return;const Te=D&&!Q?j:O,xe=w.dom.querySelector(`[data-decoration-id="${Te.decorationId}"]`);x={editor:e,range:Te.range,query:Te.query,text:Te.text,items:[],command:U=>f({editor:e,range:Te.range,props:U}),decorationNode:xe,clientRect:xe?()=>{var U;const{decorationId:z}=(U=this.key)===null||U===void 0?void 0:U.getState(e.state),ie=w.dom.querySelector(`[data-decoration-id="${z}"]`);return(ie==null?void 0:ie.getBoundingClientRect())||null}:null},Q&&((R=g==null?void 0:g.onBeforeStart)===null||R===void 0||R.call(g,x)),X&&((C=g==null?void 0:g.onBeforeUpdate)===null||C===void 0||C.call(g,x)),(X||Q)&&(x.items=await h({editor:e,query:Te.query})),D&&((T=g==null?void 0:g.onExit)===null||T===void 0||T.call(g,x)),X&&((_=g==null?void 0:g.onUpdate)===null||_===void 0||_.call(g,x)),Q&&((N=g==null?void 0:g.onStart)===null||N===void 0||N.call(g,x))},destroy:()=>{var w;x&&((w=g==null?void 0:g.onExit)===null||w===void 0||w.call(g,x))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(w,S,I,k){const{isEditable:R}=e,{composing:C}=e.view,{selection:T}=w,{empty:_,from:N}=T,j={...S};if(j.composing=C,R&&(_||e.view.composing)){(N<S.range.from||N>S.range.to)&&!C&&!S.composing&&(j.active=!1);const O=y({char:n,allowSpaces:r,allowToIncludeChar:s,allowedPrefixes:i,startOfLine:o,$position:T.$from}),P=`id_${Math.floor(Math.random()*4294967295)}`;O&&m({editor:e,state:k,range:O.range,isActive:S.active})?(j.active=!0,j.decorationId=S.decorationId?S.decorationId:P,j.range=O.range,j.query=O.query,j.text=O.text):j.active=!1}else j.active=!1;return j.active||(j.decorationId=null,j.range={from:0,to:0},j.query=null,j.text=null),j}},props:{handleKeyDown(w,S){var I;const{active:k,range:R}=v.getState(w.state);return k&&((I=g==null?void 0:g.onKeyDown)===null||I===void 0?void 0:I.call(g,{view:w,event:S,range:R}))||!1},decorations(w){const{active:S,range:I,decorationId:k,query:R}=v.getState(w);if(!S)return null;const C=!(R!=null&&R.length),T=[l];return C&&T.push(d),yr.create(w.doc,[Os.inline(I.from,I.to,{nodeName:a,class:T.join(" "),"data-decoration-id":k,"data-decoration-content":u})])}}});return v}function Lq({editor:t,overrideSuggestionOptions:e,extensionName:n,char:r="@"}){const s=new ns;return{editor:t,char:r,pluginKey:s,command:({editor:i,range:o,props:a})=>{var l,u,d;const f=i.view.state.selection.$to.nodeAfter;((l=f==null?void 0:f.text)===null||l===void 0?void 0:l.startsWith(" "))&&(o.to+=1),i.chain().focus().insertContentAt(o,[{type:n,attrs:{...a,mentionSuggestionChar:r}},{type:"text",text:" "}]).run(),(d=(u=i.view.dom.ownerDocument.defaultView)===null||u===void 0?void 0:u.getSelection())===null||d===void 0||d.collapseToEnd()},allow:({state:i,range:o})=>{const a=i.doc.resolve(o.from),l=i.schema.nodes[n];return!!a.parent.type.contentMatch.matchType(l)},...e}}function j5(t){return(t.options.suggestions.length?t.options.suggestions:[t.options.suggestion]).map(e=>Lq({editor:t.editor,overrideSuggestionOptions:e,extensionName:t.name,char:e.char}))}function VT(t,e){const n=j5(t),r=n.find(s=>s.char===e);return r||(n.length?n[0]:null)}const $q=pr.create({name:"mention",priority:101,addOptions(){return{HTMLAttributes:{},renderText({node:t,suggestion:e}){var n,r;return`${(n=e==null?void 0:e.char)!==null&&n!==void 0?n:"@"}${(r=t.attrs.label)!==null&&r!==void 0?r:t.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:t,node:e,suggestion:n}){var r,s;return["span",kn(this.HTMLAttributes,t.HTMLAttributes),`${(r=n==null?void 0:n.char)!==null&&r!==void 0?r:"@"}${(s=e.attrs.label)!==null&&s!==void 0?s:e.attrs.id}`]},suggestions:[],suggestion:{}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}},mentionSuggestionChar:{default:"@",parseHTML:t=>t.getAttribute("data-mention-suggestion-char"),renderHTML:t=>({"data-mention-suggestion-char":t.mentionSuggestionChar})}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:e}){const n=VT(this,t.attrs.mentionSuggestionChar);if(this.options.renderLabel!==void 0)return console.warn("renderLabel is deprecated use renderText and renderHTML instead"),["span",kn({"data-type":this.name},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:t,suggestion:n})];const r={...this.options};r.HTMLAttributes=kn({"data-type":this.name},this.options.HTMLAttributes,e);const s=this.options.renderHTML({options:r,node:t,suggestion:n});return typeof s=="string"?["span",kn({"data-type":this.name},this.options.HTMLAttributes,e),s]:s},renderText({node:t}){const e={options:this.options,node:t,suggestion:VT(this,t.attrs.mentionSuggestionChar)};return this.options.renderLabel!==void 0?(console.warn("renderLabel is deprecated use renderText and renderHTML instead"),this.options.renderLabel(e)):this.options.renderText(e)},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:t,state:e})=>{let n=!1;const{selection:r}=e,{empty:s,anchor:i}=r;if(!s)return!1;e.doc.nodesBetween(i-1,i,(l,u)=>{if(l.type.name===this.name)return n=!0,t.insertText(this.options.deleteTriggerWithBackspace?"":this.options.suggestion.char||"",u,u+l.nodeSize),!1});let o=new Fo,a=0;return e.doc.nodesBetween(i-1,i,(l,u)=>{if(l.type.name===this.name)return n=!0,o=l,a=u,!1}),n&&t.insertText(this.options.deleteTriggerWithBackspace?"":o.attrs.mentionSuggestionChar,a,a+o.nodeSize),n})}},addProseMirrorPlugins(){return j5(this).map(Pq)}}),zq=(t,e)=>Vr.create({name:"keyboardNavigation",addKeyboardShortcuts(){return{Enter:()=>(e&&e(),!1),Tab:({editor:n})=>{var a;if(n.isEmpty)return!1;const{state:r}=n,{selection:s}=r,{$from:i}=s;return((a=i.node(-1))==null?void 0:a.type.name)==="listItem"?n.commands.sinkListItem("listItem"):n.commands.insertContent("")},"Shift-Tab":({editor:n})=>{var a;if(n.isEmpty)return!1;const{state:r}=n,{selection:s}=r,{$from:i}=s;if(((a=i.node(-1))==null?void 0:a.type.name)==="listItem")return n.commands.liftListItem("listItem");{const{$anchor:l}=s,d=l.parent.textContent.substring(0,l.parentOffset).match(/[\u00A0 ]{1,4}$/);if(d){const f=l.pos-d[0].length,h=l.pos;return n.commands.deleteRange({from:f,to:h}),!0}}return!0},"Mod-Enter":()=>t?(t(),!0):!1,Escape:()=>!1,"Mod-Alt-5":({editor:n})=>n.chain().focus().toggleBulletList().run(),"Mod-Alt-6":({editor:n})=>n.chain().focus().toggleOrderedList().run(),"Mod-Alt-7":({editor:n})=>n.isActive("details")?n.chain().focus().unsetDetails().run():n.chain().focus().setDetails().run()}}}),Fq=ei.create({name:"timestamp",inclusive:!1,excludes:"",addAttributes(){return{time:{default:0,parseHTML:t=>parseInt(t.getAttribute("data-time")||"0",10),renderHTML:t=>t.time?{"data-time":t.time}:{}},recordingId:{default:null,parseHTML:t=>t.getAttribute("data-recording-id"),renderHTML:t=>t.recordingId?{"data-recording-id":t.recordingId,class:"timestamp-marker cursor-pointer hover:bg-indigo-100/50 hover:text-indigo-800 transition-colors rounded-sm px-[1px]",title:`Jump to ${Math.floor(t.time/1e3)}s`}:{}}}},parseHTML(){return[{tag:"span[data-time]"}]},renderHTML({HTMLAttributes:t}){return["span",kn(t),0]}}),Bq=pr.create({name:"paragraph",priority:1e3,group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",kn(t),0]},addAttributes(){return{"data-paragraph-id":{default:null,parseHTML:t=>t.getAttribute("data-paragraph-id"),renderHTML:t=>t["data-paragraph-id"]?{"data-paragraph-id":t["data-paragraph-id"]}:{}},"data-timestamp":{default:null,parseHTML:t=>t.getAttribute("data-timestamp"),renderHTML:t=>t["data-timestamp"]?{"data-timestamp":t["data-timestamp"],class:"cursor-pointer hover:bg-indigo-50/50 transition-colors rounded px-1 -mx-1",title:"Click to play audio"}:{}}}}}),Uq=ei.create({name:"attachmentLink",addAttributes(){return{attachmentUrls:{default:[],parseHTML:t=>{const e=t.getAttribute("data-attachment-urls");return e?JSON.parse(e):[]},renderHTML:t=>!t.attachmentUrls||t.attachmentUrls.length===0?{}:{"data-attachment-urls":JSON.stringify(t.attachmentUrls)}}}},parseHTML(){return[{tag:"span[data-attachment-link]"}]},renderHTML({HTMLAttributes:t}){return["span",kn(t,{"data-attachment-link":"true",class:"attachment-link-text cursor-pointer"}),0]}}),Hq=({node:t})=>null,Vq=pr.create({name:"audioMarker",group:"inline",inline:!0,atom:!0,addAttributes(){return{id:{default:null},time:{default:null},label:{default:"0:00"},fileName:{default:null}}},parseHTML(){return[{tag:'span[data-type="audio-marker"]'}]},renderHTML({HTMLAttributes:t}){return["span",kn(t,{"data-type":"audio-marker"})]},addNodeView(){return QK(Hq)}}),$v=b.forwardRef(({initialContent:t,onChange:e,onExit:n,onPolish:r,onEditorReady:s,editable:i=!0,className:o="",placeholder:a="",textSizeClass:l="text-base",descFontClass:u="font-normal",autoFocus:d=!1,onAudioMarkerClick:f,activeMarkerIds:h,onMarkersChange:p,attachments:m=[],taskColor:y="#6366f1",availableTags:x=[],onCreateTag:g},v)=>{const{t:w}=b.useContext(_n),[S,I]=b.useState(!1),[k,R]=b.useState({top:0,left:0}),C=b.useRef(null),T=b.useRef(x),_=b.useRef(g),N=b.useRef(!1),j=b.useRef(e);b.useEffect(()=>{T.current=x},[x]),b.useEffect(()=>{_.current=g},[g]),b.useEffect(()=>{j.current=e},[e]);const[O,P]=b.useState(!1),[G,A]=b.useState({top:0,left:0}),[M,Q]=b.useState(null),[X,D]=b.useState([]),[Te,xe]=b.useState(!1),[U,z]=b.useState({top:0,left:0}),[ie,Be]=b.useState([]);b.useImperativeHandle(v,()=>({toggleRecording:()=>{},chain:()=>{var V;return(V=_e.current)==null?void 0:V.chain()},focus:()=>{var V;return(V=_e.current)==null?void 0:V.commands.focus()},insertContent:V=>{var re;return(re=_e.current)==null?void 0:re.commands.insertContent(V)},getEditor:()=>_e.current}));const{isRecording:st,recordingTime:ae,addMarker:Z,currentRecordingId:K}=b.useContext(Iu),de=b.useRef(ae),ce=b.useRef(K),ke=b.useRef(st);b.useEffect(()=>{de.current=ae,ce.current=K,ke.current=st},[ae,K,st]);const _e=b.useRef(null);b.useEffect(()=>{window.__activeMarkerIds=h,window.dispatchEvent(new CustomEvent("active-markers-change",{detail:{ids:h}}))},[h]),b.useEffect(()=>{const V=re=>{var se;f&&((se=re.detail)==null?void 0:se.time)!==void 0&&f(re.detail.time)};return window.addEventListener("audio-marker-click",V),()=>{window.removeEventListener("audio-marker-click",V)}},[f]);const ve=V=>{const re=Math.floor(V/1e3),se=Math.floor(re/60),ne=re%60;return`${se.toString().padStart(2,"0")}:${ne.toString().padStart(2,"0")}`},Ke=()=>{if(st&&_e.current){const V=Z();if(V){const{id:re,time:se}=V;console.log("Enter pressed during recording at:",se);const ne=ve(se);_e.current.chain().insertContent({type:"audioMarker",attrs:{id:re,time:se,label:ne}}).insertContent(" ").run()}}},je=WK({extensions:[QG.configure({paragraph:!1,bulletList:{keepMarks:!0,keepAttributes:!1},orderedList:{keepMarks:!0,keepAttributes:!1}}),Bq,Fq,Vq,Tq,Cq,jq.configure({multicolor:!0}),bq.configure({openOnClick:!1,autolink:!0}),wq.configure({placeholder:a||w("addNotePlaceholder"),emptyEditorClass:"is-editor-empty before:content-[attr(data-placeholder)] before:text-slate-300 before:float-left before:pointer-events-none before:h-0"}),vq,Sq.configure({nested:!0}),Dq.configure({persist:!0,HTMLAttributes:{class:"details"}}),Aq,Mq,Uq,$q.configure({HTMLAttributes:{class:"tag-mention"},renderLabel({node:V}){return V.attrs.label??V.attrs.id},suggestion:{char:"@",allowSpaces:!1,items:({query:V})=>{const re=T.current;if(!V)return re.slice(0,10);const se=V.toLowerCase();return re.filter(pe=>pe.name.toLowerCase().includes(se)).slice(0,10)},render:()=>{let V=null,re=0,se=[],ne=null;return{onStart:pe=>{var ye;N.current=!0,se=pe.items,re=0,V=document.createElement("div"),V.className="mention-suggestion-popup fixed z-[99999] bg-white dark:bg-gray-800 shadow-lg rounded-lg border border-gray-200 dark:border-gray-700 py-1 min-w-[200px] max-w-[300px] max-h-[300px] overflow-y-auto",document.body.appendChild(V),ne={command:pe.command,query:pe.query,range:pe.range,onKeyDown:({event:Pe})=>{if(Pe.key==="ArrowDown"){Pe.preventDefault();const me=se.length>0?se.length:0,qe=(ne==null?void 0:ne.query)&&ne.query.trim().length>0?me+1:me;return re=(re+1)%qe,ne==null||ne.updateItems(se,ne.query),!0}if(Pe.key==="ArrowUp"){Pe.preventDefault();const Me=(ne==null?void 0:ne.query)&&ne.query.trim().length>0?se.length+1:se.length;return re=(re-1+Me)%Me,ne==null||ne.updateItems(se,ne.query),!0}return Pe.key==="Enter"?(Pe.preventDefault(),ne==null||ne.selectItem(re),!0):Pe.key==="Escape"?(Pe.preventDefault(),!0):!1},updateItems:(Pe,me)=>{if(se=Pe,!V)return;const Me=me&&me.trim().length>0&&!Pe.some(qe=>qe.name.toLowerCase()===me.toLowerCase());if(V.innerHTML="",Pe.length===0&&!Me){V.innerHTML='<div class="px-3 py-2 text-sm text-gray-400"></div>';return}if(Pe.forEach((qe,ht)=>{const wt=document.createElement("div");wt.className=`px-3 py-2 cursor-pointer flex items-center gap-2 text-sm ${ht===re?"bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,wt.innerHTML=`
                                                <span class="w-2 h-2 rounded-full" style="background-color: ${qe.color||"#6366f1"}"></span>
                                                <span class="truncate">${qe.name}</span>
                                            `,wt.addEventListener("mouseenter",()=>{re=ht,ne==null||ne.updateItems(se,me)}),wt.addEventListener("mousedown",ge=>{ge.preventDefault(),ne==null||ne.selectItem(ht)}),V.appendChild(wt)}),Me){const qe=Pe.length,ht=document.createElement("div");ht.className=`px-3 py-2 cursor-pointer flex items-center gap-2 text-sm border-t border-gray-100 dark:border-gray-700 ${re===qe?"bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,ht.innerHTML=`
                                                <span class="text-green-500">+</span>
                                                <span> "<strong>${me}</strong>"</span>
                                            `,ht.addEventListener("mouseenter",()=>{re=qe,ne==null||ne.updateItems(se,me)}),ht.addEventListener("mousedown",wt=>{wt.preventDefault(),ne==null||ne.selectItem(qe)}),V.appendChild(ht)}},selectItem:async Pe=>{const me=(ne==null?void 0:ne.query)&&ne.query.trim().length>0&&!se.some(wt=>wt.name.toLowerCase()===ne.query.toLowerCase()),Me=ne==null?void 0:ne.command,qe=ne==null?void 0:ne.range,ht=_e.current;if(Pe<se.length){const wt=se[Pe];Me&&Me({id:wt.id,label:wt.name})}else if(me&&_.current&&qe&&ht){const wt=ne.query.trim(),{from:ge,to:Le}=qe;V&&(V.remove(),V=null),N.current=!1;const Ue=await _.current(wt);Ue&&_e.current&&_e.current.chain().focus().deleteRange({from:ge,to:Le}).insertContentAt(ge,{type:"mention",attrs:{id:Ue.id,label:Ue.name}}).run()}}},ne.updateItems(se,pe.query);const ee=(ye=pe.clientRect)==null?void 0:ye.call(pe);ee&&V&&(V.style.left=`${ee.left}px`,V.style.top=`${ee.bottom+5}px`)},onUpdate:pe=>{var ye;se=pe.items,ne&&(ne.query=pe.query,ne.range=pe.range,re=0,ne.updateItems(se,pe.query));const ee=(ye=pe.clientRect)==null?void 0:ye.call(pe);ee&&V&&(V.style.left=`${ee.left}px`,V.style.top=`${ee.bottom+5}px`)},onKeyDown:pe=>(ne==null?void 0:ne.onKeyDown(pe))??!1,onExit:()=>{N.current=!1,V&&(V.remove(),V=null),ne=null}}}}}),zq(n,Ke)],content:t,editable:i,editorProps:{attributes:{class:`prose prose-sm max-w-none focus:outline-none min-h-[100px] text-theme-secondary ${l} ${u} leading-relaxed custom-scrollbar selection:bg-indigo-100`,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"}},onUpdate:({editor:V})=>{if(!window.__imeComposing){if(e){const re=V.getHTML();e(V.isEmpty?"":re)}if(p){const re=[];V.state.doc.descendants(se=>{se.type.name==="audioMarker"&&se.attrs.id&&re.push({id:se.attrs.id,time:se.attrs.time||0})}),p(re)}}},onCreate:({editor:V})=>{if(s&&s(V),p){const re=[];V.state.doc.descendants(se=>{se.type.name==="audioMarker"&&se.attrs.id&&re.push({id:se.attrs.id,time:se.attrs.time||0})}),p(re)}},onSelectionUpdate:({editor:V})=>{if(window.__imeComposing)return;C.current&&clearTimeout(C.current);const{from:re,to:se}=V.state.selection;re!==se&&i?C.current=setTimeout(()=>{const ne=window.getSelection();if(ne&&ne.rangeCount>0){const ee=ne.getRangeAt(0).getBoundingClientRect(),ye={top:ee.bottom+5,left:ee.left+ee.width/2};R(ye),A(ye),I(!0)}},500):(I(!1),P(!1))}});return b.useEffect(()=>{if(!je)return;const V=({transaction:ee})=>{if(!window.__imeComposing&&ke.current&&de.current>=0&&ee.docChanged){const ye=de.current,{selection:Pe}=je.state;if(!Pe.empty)return;const me=Pe.$from,Me=me.parent.textContent.substring(0,me.parentOffset),qe=Me.lastIndexOf("@");if(qe!==-1&&!Me.substring(qe+1).includes(" ")||N.current)return;const wt=me.marks().find(Le=>Le.type.name==="timestamp");let ge=!0;if(wt){const Le=wt.attrs.time;ye-Le<2e3&&(ge=!1)}if(ge){const Le=ce.current;je.commands.setMark("timestamp",{time:ye,recordingId:Le})}else wt&&je.commands.setMark("timestamp",wt.attrs)}};let re=null;const se=()=>{window.__imeComposing=!0,je&&(re=je.state.selection.from)},ne=()=>{if(window.__imeComposing=!1,ke.current&&de.current>=0&&je&&re!==null){const ee=de.current,ye=ce.current,Pe=re;re=null,setTimeout(()=>{if(!je)return;const{selection:me}=je.state,Me=me.from;if(Me>Pe){const qe=me.$from,ht=qe.parent.textContent.substring(0,qe.parentOffset),wt=ht.lastIndexOf("@");if(wt!==-1&&!ht.substring(wt+1).includes(" ")){if(j.current){const Le=je.getHTML();j.current(je.isEmpty?"":Le)}return}try{je.chain().setTextSelection({from:Pe,to:Me}).setMark("timestamp",{time:ee,recordingId:ye}).setTextSelection(Me).run()}catch(ge){console.warn("Failed to apply timestamp mark:",ge)}}if(j.current){const qe=je.getHTML();j.current(je.isEmpty?"":qe)}},50)}else re=null,je&&j.current&&setTimeout(()=>{if(je&&j.current){const ee=je.getHTML();j.current(je.isEmpty?"":ee)}},50)},pe=je.view.dom;return pe.addEventListener("compositionstart",se),pe.addEventListener("compositionend",ne),je.on("selectionUpdate",V),je.on("update",V),()=>{je.off("update",V),je.off("selectionUpdate",V),pe.removeEventListener("compositionstart",se),pe.removeEventListener("compositionend",ne),window.__imeComposing=!1}},[je,st]),b.useEffect(()=>{if(je&&t!==void 0){const V=je.getHTML(),re=se=>se==="<p></p>"||se==="";if(re(V)&&re(t)||je.isFocused)return;V!==t&&je.commands.setContent(t,!1)}},[t,je]),b.useEffect(()=>{je&&(_e.current=je,je.toggleRecording=()=>{},je.isRecording=!1,je.scrollToParagraph=V=>{if(!V)return;let re=null,se=null,ne=null;je.state.doc.descendants((ye,Pe)=>{if(ye.type.name==="audioMarker"&&ye.attrs.id===V)return re=Pe,!1}),re!==null&&je.state.doc.descendants((ye,Pe)=>{if(ye.type.name==="audioMarker"&&Pe>re&&se===null)return se=Pe,ne=ye.attrs.id,!1});const pe=se!==null?se:re,ee=ne!==null?ne:V;pe!==null&&(je.chain().setTextSelection(pe).scrollIntoView().focus().run(),setTimeout(()=>{const ye=document.querySelector(`[data-id="${ee}"]`);ye&&(ye.style.transition="all 0.3s ease",ye.style.backgroundColor="#fef08a",ye.style.color="#854d0e",ye.style.borderColor="#fbbf24",ye.style.transform="scale(1.2)",setTimeout(()=>{ye.style.transition="all 1s ease",ye.style.backgroundColor="",ye.style.color="",ye.style.borderColor="",ye.style.transform=""},2e3))},50))})},[je]),b.useEffect(()=>{je&&d&&je.commands.focus("end")},[je,d]),b.useEffect(()=>{je&&s&&s(je)},[je,s]),je?c.jsxs("div",{className:`note-editor-wrapper ${o} relative bg-transparent border-none`,style:{"--attachment-link-color":y},onClickCapture:V=>{const re=V.target,se=re.closest("[data-time]");if(se){const ee=se.getAttribute("data-time"),ye=se.getAttribute("data-recording-id")||void 0,Pe=parseInt(ee||"0",10);if(!isNaN(Pe)&&f){f(Pe,ye);return}}const ne=re.closest("[data-timestamp]");if(ne){const ee=parseInt(ne.getAttribute("data-timestamp")||"0",10);if(!isNaN(ee)&&f){f(ee);return}}const pe=re.closest("[data-attachment-link]");if(pe){V.preventDefault(),V.stopPropagation();const ee=pe.getAttribute("data-attachment-urls");if(ee)try{const ye=JSON.parse(ee);if(Array.isArray(ye)&&ye.length>0){const Pe=pe.getBoundingClientRect();z({top:Pe.bottom+5,left:Math.min(Pe.left,window.innerWidth-340)}),Be(ye),xe(!0)}}catch(ye){console.error("Failed to parse attachment URLs",ye)}}else re.closest(".attachment-popup")||xe(!1)},children:[c.jsx(HK,{editor:je}),S&&c.jsxs("div",{className:"fixed z-50 bg-white rounded-lg shadow-2xl border border-gray-200 p-2 flex gap-1.5 animate-in fade-in zoom-in-95 duration-200 items-center",style:{top:`${k.top}px`,left:`${k.left}px`,transform:"translateX(-50%)"},children:[c.jsx("button",{type:"button",onMouseDown:V=>{V.preventDefault(),V.stopPropagation();const{from:re,to:se}=je.state.selection,ne=je.state.doc.textBetween(re,se," ");r==null||r(ne,{from:re,to:se},k),I(!1)},className:"w-8 h-8 rounded-lg bg-indigo-50 hover:bg-indigo-100 text-indigo-600 shadow-sm hover:scale-105 hover:ring-2 hover:ring-indigo-300 transition-all active:scale-95 flex items-center justify-center cursor-pointer",title:"AI  (Polish Selection)",children:c.jsx(js,{size:16})}),m.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"h-4 w-[1px] bg-gray-200 mx-1"}),c.jsx("button",{type:"button",onMouseDown:V=>{V.preventDefault(),V.stopPropagation();const{from:re,to:se}=je.state.selection;if(re!==se){Q({from:re,to:se});const ne=je.getAttributes("attachmentLink");D((ne==null?void 0:ne.attachmentUrls)||[]),P(!0),I(!1)}},className:"w-8 h-8 rounded-lg bg-amber-50 hover:bg-amber-100 text-amber-600 shadow-sm hover:scale-105 hover:ring-2 hover:ring-amber-300 transition-all active:scale-95 flex items-center justify-center cursor-pointer",title:" (Alt+A)",children:c.jsx(co,{size:16})})]}),c.jsx("div",{className:"h-4 w-[1px] bg-gray-200 mx-1"}),[{color:"#000000",label:""},{color:"#ef4444",label:""},{color:"#f97316",label:""},{color:"#f59e0b",label:""},{color:"#10b981",label:""},{color:"#3b82f6",label:""},{color:"#8b5cf6",label:""},{color:"#ec4899",label:""},{color:"#64748b",label:""}].map(({color:V,label:re})=>c.jsx("button",{type:"button",onMouseDown:se=>{se.preventDefault(),se.stopPropagation(),je==null||je.chain().focus().setColor(V).run(),I(!1)},className:"w-7 h-7 rounded-full border-2 border-white shadow-md hover:scale-110 hover:ring-2 hover:ring-indigo-300 transition-all active:scale-95 cursor-pointer",style:{backgroundColor:V},title:re},V))]}),O&&m.length>0&&c.jsxs("div",{className:"fixed z-[99999] bg-white rounded-xl shadow-2xl border border-gray-100 p-3 min-w-[220px] max-w-[300px] animate-in fade-in zoom-in-95 duration-150",style:{top:G.top,left:G.left},children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("span",{className:"text-xs font-bold text-gray-600",children:""}),c.jsx("button",{type:"button",onClick:()=>{P(!1),D([])},className:"p-0.5 text-gray-400 hover:text-gray-600",children:c.jsx(on,{size:14})})]}),c.jsx("div",{className:"space-y-1 max-h-[200px] overflow-y-auto mb-2",children:m.map((V,re)=>{const se=X.includes(V.url);return c.jsxs("button",{type:"button",onClick:()=>{D(se?ne=>ne.filter(pe=>pe!==V.url):ne=>[...ne,V.url])},className:`w-full text-left px-2 py-1.5 rounded-lg flex items-center gap-2 text-xs transition-colors ${se?"bg-indigo-50 text-indigo-700 border border-indigo-200":"hover:bg-gray-50 text-gray-600"}`,children:[c.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center flex-shrink-0 ${se?"bg-indigo-500 border-indigo-500 text-white":"border-gray-300"}`,children:se&&c.jsx(tr,{size:12})}),c.jsx(co,{size:12,className:se?"text-indigo-400":"text-gray-400"}),c.jsx("span",{className:"truncate",children:V.name})]},re)})}),c.jsxs("div",{className:"flex gap-2 pt-2 border-t border-gray-100",children:[c.jsx("button",{type:"button",onClick:()=>{P(!1),D([])},className:"flex-1 px-3 py-1.5 text-xs text-gray-500 hover:bg-gray-50 rounded-lg transition-colors",children:""}),c.jsxs("button",{type:"button",onClick:()=>{M&&je&&(X.length>0?je.chain().focus().setTextSelection(M).setMark("attachmentLink",{attachmentUrls:X}).run():je.chain().focus().setTextSelection(M).unsetMark("attachmentLink").run(),P(!1),Q(null),D([]))},className:"flex-1 px-3 py-1.5 text-xs bg-indigo-500 text-white hover:bg-indigo-600 rounded-lg transition-colors font-medium",children:[" ",X.length>0&&`(${X.length})`]})]})]}),Te&&ie.length>0&&c.jsxs("div",{className:"fixed z-[99999] bg-white rounded-xl shadow-2xl border border-gray-100 p-3 min-w-[220px] max-w-[320px] animate-in fade-in zoom-in-95 duration-150",style:{top:U.top,left:U.left},children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("span",{className:"text-xs font-bold text-gray-600",children:""}),c.jsx("button",{type:"button",onClick:()=>xe(!1),className:"p-0.5 text-gray-400 hover:text-gray-600",children:c.jsx(on,{size:14})})]}),c.jsx("div",{className:"space-y-1.5",children:ie.map((V,re)=>{const se=m.find(ne=>ne.url===V);return se?c.jsxs("div",{className:"flex items-center justify-between gap-2 px-2 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[c.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[c.jsx(co,{size:12,className:"text-gray-400 flex-shrink-0"}),c.jsx("span",{className:"text-xs text-gray-600 truncate",children:se.name})]}),c.jsx("button",{type:"button",onClick:()=>{fetch(V).then(ne=>ne.blob()).then(ne=>{const pe=window.URL.createObjectURL(ne),ee=document.createElement("a");ee.href=pe,ee.download=se.name,document.body.appendChild(ee),ee.click(),document.body.removeChild(ee),window.URL.revokeObjectURL(pe)})},className:"p-1 text-indigo-500 hover:text-indigo-700 hover:bg-indigo-50 rounded transition-colors",title:"",children:c.jsx(nu,{size:14})})]},re):null})})]}),c.jsx("style",{dangerouslySetInnerHTML:{__html:`
                .ProseMirror p.is-editor-empty:first-child::before {
                    content: attr(data-placeholder);
                    float: left;
                    color: #cbd5e1;
                    pointer-events: none;
                    height: 0;
                }
                .ProseMirror {
                    word-break: break-word;
                    max-height: calc(30 * 1.625em);
                    overflow-y: auto;
                }
                .note-editor-wrapper.h-full .ProseMirror {
                    height: 100%;
                    max-height: 100%;
                }
                .ProseMirror h1 { font-size: 1.25rem; font-weight: 700; margin-top: 0.5rem; margin-bottom: 0.5rem; color: #334155; }
                .ProseMirror h2 { font-size: 1.1rem; font-weight: 700; margin-top: 0.5rem; margin-bottom: 0.5rem; color: #475569; }
                .ProseMirror ul { list-style-type: disc; list-style-position: outside; padding-left: 2rem; margin-top: 0.25rem; margin-left: 0; }
                .ProseMirror ol { list-style-type: decimal; list-style-position: outside; padding-left: 2rem; margin-top: 0.25rem; margin-left: 0; }
                .ProseMirror li { padding-left: 0.25rem; }
            `}})]}):null});var WT;(function(t){t.STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object"})(WT||(WT={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var KT;(function(t){t.LANGUAGE_UNSPECIFIED="language_unspecified",t.PYTHON="python"})(KT||(KT={}));var GT;(function(t){t.OUTCOME_UNSPECIFIED="outcome_unspecified",t.OUTCOME_OK="outcome_ok",t.OUTCOME_FAILED="outcome_failed",t.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(GT||(GT={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qT=["user","model","function","system"];var JT;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(JT||(JT={}));var YT;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(YT||(YT={}));var XT;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(XT||(XT={}));var QT;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER"})(QT||(QT={}));var zd;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.OTHER="OTHER"})(zd||(zd={}));var ZT;(function(t){t.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",t.RETRIEVAL_QUERY="RETRIEVAL_QUERY",t.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",t.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",t.CLASSIFICATION="CLASSIFICATION",t.CLUSTERING="CLUSTERING"})(ZT||(ZT={}));var eC;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(eC||(eC={}));var tC;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(tC||(tC={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cs extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class yc extends cs{constructor(e,n){super(e),this.response=n}}class I5 extends cs{constructor(e,n,r,s){super(e),this.status=n,this.statusText=r,this.errorDetails=s}}class $a extends cs{}class D5 extends cs{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wq="https://generativelanguage.googleapis.com",Kq="v1beta",Gq="0.24.1",qq="genai-js";var Zl;(function(t){t.GENERATE_CONTENT="generateContent",t.STREAM_GENERATE_CONTENT="streamGenerateContent",t.COUNT_TOKENS="countTokens",t.EMBED_CONTENT="embedContent",t.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Zl||(Zl={}));class Jq{constructor(e,n,r,s,i){this.model=e,this.task=n,this.apiKey=r,this.stream=s,this.requestOptions=i}toString(){var e,n;const r=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||Kq;let i=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||Wq}/${r}/${this.model}:${this.task}`;return this.stream&&(i+="?alt=sse"),i}}function Yq(t){const e=[];return t!=null&&t.apiClient&&e.push(t.apiClient),e.push(`${qq}/${Gq}`),e.join(" ")}async function Xq(t){var e;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",Yq(t.requestOptions)),n.append("x-goog-api-key",t.apiKey);let r=(e=t.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(s){throw new $a(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${s.message}`)}for(const[s,i]of r.entries()){if(s==="x-goog-api-key")throw new $a(`Cannot set reserved header name ${s}`);if(s==="x-goog-api-client")throw new $a(`Header name ${s} can only be set using the apiClient field`);n.append(s,i)}}return n}async function Qq(t,e,n,r,s,i){const o=new Jq(t,e,n,r,i);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},nJ(i)),{method:"POST",headers:await Xq(o),body:s})}}async function Zf(t,e,n,r,s,i={},o=fetch){const{url:a,fetchOptions:l}=await Qq(t,e,n,r,s,i);return Zq(a,l,o)}async function Zq(t,e,n=fetch){let r;try{r=await n(t,e)}catch(s){eJ(s,t)}return r.ok||await tJ(r,t),r}function eJ(t,e){let n=t;throw n.name==="AbortError"?(n=new D5(`Request aborted when fetching ${e.toString()}: ${t.message}`),n.stack=t.stack):t instanceof I5||t instanceof $a||(n=new cs(`Error fetching from ${e.toString()}: ${t.message}`),n.stack=t.stack),n}async function tJ(t,e){let n="",r;try{const s=await t.json();n=s.error.message,s.error.details&&(n+=` ${JSON.stringify(s.error.details)}`,r=s.error.details)}catch{}throw new I5(`Error fetching from ${e.toString()}: [${t.status} ${t.statusText}] ${n}`,t.status,t.statusText,r)}function nJ(t){const e={};if((t==null?void 0:t.signal)!==void 0||(t==null?void 0:t.timeout)>=0){const n=new AbortController;(t==null?void 0:t.timeout)>=0&&setTimeout(()=>n.abort(),t.timeout),t!=null&&t.signal&&t.signal.addEventListener("abort",()=>{n.abort()}),e.signal=n.signal}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zv(t){return t.text=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),kp(t.candidates[0]))throw new yc(`${pa(t)}`,t);return rJ(t)}else if(t.promptFeedback)throw new yc(`Text not available. ${pa(t)}`,t);return""},t.functionCall=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),kp(t.candidates[0]))throw new yc(`${pa(t)}`,t);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),nC(t)[0]}else if(t.promptFeedback)throw new yc(`Function call not available. ${pa(t)}`,t)},t.functionCalls=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),kp(t.candidates[0]))throw new yc(`${pa(t)}`,t);return nC(t)}else if(t.promptFeedback)throw new yc(`Function call not available. ${pa(t)}`,t)},t}function rJ(t){var e,n,r,s;const i=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const o of(s=(r=t.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)o.text&&i.push(o.text),o.executableCode&&i.push("\n```"+o.executableCode.language+`
`+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&i.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}function nC(t){var e,n,r,s;const i=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const o of(s=(r=t.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)o.functionCall&&i.push(o.functionCall);if(i.length>0)return i}const sJ=[zd.RECITATION,zd.SAFETY,zd.LANGUAGE];function kp(t){return!!t.finishReason&&sJ.includes(t.finishReason)}function pa(t){var e,n,r;let s="";if((!t.candidates||t.candidates.length===0)&&t.promptFeedback)s+="Response was blocked",!((e=t.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${t.promptFeedback.blockReason}`),!((n=t.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(s+=`: ${t.promptFeedback.blockReasonMessage}`);else if(!((r=t.candidates)===null||r===void 0)&&r[0]){const i=t.candidates[0];kp(i)&&(s+=`Candidate was blocked due to ${i.finishReason}`,i.finishMessage&&(s+=`: ${i.finishMessage}`))}return s}function Af(t){return this instanceof Af?(this.v=t,this):new Af(t)}function iJ(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),s,i=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(h){r[h]&&(s[h]=function(p){return new Promise(function(m,y){i.push([h,p,m,y])>1||a(h,p)})})}function a(h,p){try{l(r[h](p))}catch(m){f(i[0][3],m)}}function l(h){h.value instanceof Af?Promise.resolve(h.value.v).then(u,d):f(i[0][2],h)}function u(h){a("next",h)}function d(h){a("throw",h)}function f(h,p){h(p),i.shift(),i.length&&a(i[0][0],i[0][1])}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rC=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function oJ(t){const e=t.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=cJ(e),[r,s]=n.tee();return{stream:lJ(r),response:aJ(s)}}async function aJ(t){const e=[],n=t.getReader();for(;;){const{done:r,value:s}=await n.read();if(r)return zv(uJ(e));e.push(s)}}function lJ(t){return iJ(this,arguments,function*(){const n=t.getReader();for(;;){const{value:r,done:s}=yield Af(n.read());if(s)break;yield yield Af(zv(r))}})}function cJ(t){const e=t.getReader();return new ReadableStream({start(r){let s="";return i();function i(){return e.read().then(({value:o,done:a})=>{if(a){if(s.trim()){r.error(new cs("Failed to parse stream"));return}r.close();return}s+=o;let l=s.match(rC),u;for(;l;){try{u=JSON.parse(l[1])}catch{r.error(new cs(`Error parsing JSON response: "${l[1]}"`));return}r.enqueue(u),s=s.substring(l[0].length),l=s.match(rC)}return i()}).catch(o=>{let a=o;throw a.stack=o.stack,a.name==="AbortError"?a=new D5("Request aborted when reading from the stream"):a=new cs("Error reading from the stream"),a})}}})}function uJ(t){const e=t[t.length-1],n={promptFeedback:e==null?void 0:e.promptFeedback};for(const r of t){if(r.candidates){let s=0;for(const i of r.candidates)if(n.candidates||(n.candidates=[]),n.candidates[s]||(n.candidates[s]={index:s}),n.candidates[s].citationMetadata=i.citationMetadata,n.candidates[s].groundingMetadata=i.groundingMetadata,n.candidates[s].finishReason=i.finishReason,n.candidates[s].finishMessage=i.finishMessage,n.candidates[s].safetyRatings=i.safetyRatings,i.content&&i.content.parts){n.candidates[s].content||(n.candidates[s].content={role:i.content.role||"user",parts:[]});const o={};for(const a of i.content.parts)a.text&&(o.text=a.text),a.functionCall&&(o.functionCall=a.functionCall),a.executableCode&&(o.executableCode=a.executableCode),a.codeExecutionResult&&(o.codeExecutionResult=a.codeExecutionResult),Object.keys(o).length===0&&(o.text=""),n.candidates[s].content.parts.push(o)}s++}r.usageMetadata&&(n.usageMetadata=r.usageMetadata)}return n}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function A5(t,e,n,r){const s=await Zf(e,Zl.STREAM_GENERATE_CONTENT,t,!0,JSON.stringify(n),r);return oJ(s)}async function M5(t,e,n,r){const i=await(await Zf(e,Zl.GENERATE_CONTENT,t,!1,JSON.stringify(n),r)).json();return{response:zv(i)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R5(t){if(t!=null){if(typeof t=="string")return{role:"system",parts:[{text:t}]};if(t.text)return{role:"system",parts:[t]};if(t.parts)return t.role?t:{role:"system",parts:t.parts}}}function Mf(t){let e=[];if(typeof t=="string")e=[{text:t}];else for(const n of t)typeof n=="string"?e.push({text:n}):e.push(n);return dJ(e)}function dJ(t){const e={role:"user",parts:[]},n={role:"function",parts:[]};let r=!1,s=!1;for(const i of t)"functionResponse"in i?(n.parts.push(i),s=!0):(e.parts.push(i),r=!0);if(r&&s)throw new cs("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!s)throw new cs("No content is provided for sending chat message.");return r?e:n}function fJ(t,e){var n;let r={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(n=e==null?void 0:e.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const s=t.generateContentRequest!=null;if(t.contents){if(s)throw new $a("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=t.contents}else if(s)r=Object.assign(Object.assign({},r),t.generateContentRequest);else{const i=Mf(t);r.contents=[i]}return{generateContentRequest:r}}function sC(t){let e;return t.contents?e=t:e={contents:[Mf(t)]},t.systemInstruction&&(e.systemInstruction=R5(t.systemInstruction)),e}function hJ(t){return typeof t=="string"||Array.isArray(t)?{content:Mf(t)}:t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iC=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],pJ={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function mJ(t){let e=!1;for(const n of t){const{role:r,parts:s}=n;if(!e&&r!=="user")throw new cs(`First content should be with role 'user', got ${r}`);if(!qT.includes(r))throw new cs(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(qT)}`);if(!Array.isArray(s))throw new cs("Content should have 'parts' property with an array of Parts");if(s.length===0)throw new cs("Each Content should have at least one part");const i={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const a of s)for(const l of iC)l in a&&(i[l]+=1);const o=pJ[r];for(const a of iC)if(!o.includes(a)&&i[a]>0)throw new cs(`Content with role '${r}' can't contain '${a}' part`);e=!0}}function oC(t){var e;if(t.candidates===void 0||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;if(n===void 0||n.parts===void 0||n.parts.length===0)return!1;for(const r of n.parts)if(r===void 0||Object.keys(r).length===0||r.text!==void 0&&r.text==="")return!1;return!0}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aC="SILENT_ERROR";class gJ{constructor(e,n,r,s={}){this.model=n,this.params=r,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,r!=null&&r.history&&(mJ(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,n={}){var r,s,i,o,a,l;await this._sendPromise;const u=Mf(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,u]},f=Object.assign(Object.assign({},this._requestOptions),n);let h;return this._sendPromise=this._sendPromise.then(()=>M5(this._apiKey,this.model,d,f)).then(p=>{var m;if(oC(p.response)){this._history.push(u);const y=Object.assign({parts:[],role:"model"},(m=p.response.candidates)===null||m===void 0?void 0:m[0].content);this._history.push(y)}else{const y=pa(p.response);y&&console.warn(`sendMessage() was unsuccessful. ${y}. Inspect response object for details.`)}h=p}).catch(p=>{throw this._sendPromise=Promise.resolve(),p}),await this._sendPromise,h}async sendMessageStream(e,n={}){var r,s,i,o,a,l;await this._sendPromise;const u=Mf(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,u]},f=Object.assign(Object.assign({},this._requestOptions),n),h=A5(this._apiKey,this.model,d,f);return this._sendPromise=this._sendPromise.then(()=>h).catch(p=>{throw new Error(aC)}).then(p=>p.response).then(p=>{if(oC(p)){this._history.push(u);const m=Object.assign({},p.candidates[0].content);m.role||(m.role="model"),this._history.push(m)}else{const m=pa(p);m&&console.warn(`sendMessageStream() was unsuccessful. ${m}. Inspect response object for details.`)}}).catch(p=>{p.message!==aC&&console.error(p)}),h}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yJ(t,e,n,r){return(await Zf(e,Zl.COUNT_TOKENS,t,!1,JSON.stringify(n),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xJ(t,e,n,r){return(await Zf(e,Zl.EMBED_CONTENT,t,!1,JSON.stringify(n),r)).json()}async function bJ(t,e,n,r){const s=n.requests.map(o=>Object.assign(Object.assign({},o),{model:e}));return(await Zf(e,Zl.BATCH_EMBED_CONTENTS,t,!1,JSON.stringify({requests:s}),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lC{constructor(e,n,r={}){this.apiKey=e,this._requestOptions=r,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=R5(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(e,n={}){var r;const s=sC(e),i=Object.assign(Object.assign({},this._requestOptions),n);return M5(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}async generateContentStream(e,n={}){var r;const s=sC(e),i=Object.assign(Object.assign({},this._requestOptions),n);return A5(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}startChat(e){var n;return new gJ(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},e),this._requestOptions)}async countTokens(e,n={}){const r=fJ(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),n);return yJ(this.apiKey,this.model,r,s)}async embedContent(e,n={}){const r=hJ(e),s=Object.assign(Object.assign({},this._requestOptions),n);return xJ(this.apiKey,this.model,r,s)}async batchEmbedContents(e,n={}){const r=Object.assign(Object.assign({},this._requestOptions),n);return bJ(this.apiKey,this.model,e,r)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wJ{constructor(e){this.apiKey=e}getGenerativeModel(e,n){if(!e.model)throw new cs("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new lC(this.apiKey,e,n)}getGenerativeModelFromCachedContent(e,n,r){if(!e.name)throw new $a("Cached content must contain a `name` field.");if(!e.model)throw new $a("Cached content must contain a `model` field.");const s=["model","systemInstruction"];for(const o of s)if(n!=null&&n[o]&&e[o]&&(n==null?void 0:n[o])!==e[o]){if(o==="model"){const a=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,l=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(a===l)continue}throw new $a(`Different value for "${o}" specified in modelParams (${n[o]}) and cachedContent (${e[o]})`)}const i=Object.assign(Object.assign({},n),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new lC(this.apiKey,i,r)}}const vJ="AIzaSyBbGFzQkwhEmNQduYxaZnnxxHR-DlQjj98",Fv=()=>({provider:localStorage.getItem("ai_provider")||"gemini",googleKey:localStorage.getItem("google_ai_key")||vJ,openaiKey:localStorage.getItem("openai_api_key")||"",baseUrl:localStorage.getItem("ai_base_url")||"https://api.openai.com/v1",modelName:localStorage.getItem("ai_model")||"gpt-3.5-turbo"}),kJ=()=>{const{googleKey:t}=Fv();if(!t)throw new Error("Google API Key is missing. Please set it in Settings.");return new wJ(t)},SJ=async(t,e=!0)=>{var a,l;const{openaiKey:n,baseUrl:r,modelName:s}=Fv();if(!n)throw new Error("API Key is missing. Please set it in Settings.");let i=r.trim();i.endsWith("/")&&(i=i.slice(0,-1));const o=`${i}/chat/completions`;console.log(`Using OpenAI-compatible provider: ${i}, model: ${s}`);try{const u=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:s,messages:[{role:"system",content:e?"You are a helpful assistant. Output valid JSON only.":"You are a helpful assistant."},{role:"user",content:t}],temperature:.7})});if(!u.ok){const h=await u.text();throw new Error(`API Error: ${u.status} ${u.statusText} - ${h}`)}const f=((l=(a=(await u.json()).choices[0])==null?void 0:a.message)==null?void 0:l.content)||"";if(console.log("AI Raw Response:",f),!e)return f;try{let h=f;const p=f.match(/\{[\s\S]*\}/);p&&(h=p[0]);const m=h.replace(/```json/g,"").replace(/```/g,"").trim();try{return JSON.parse(m)}catch(y){if(m.includes('"fullResponse": "')){const x='"fullResponse": "',g=m.indexOf(x)+x.length,v=m.lastIndexOf('"');if(g>x.length-1&&v>g)return{fullResponse:m.substring(g,v).replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")}}throw y}}catch(h){throw console.warn("OpenAI JSON Parse failed"),h}}catch(u){throw console.error("OpenAI Provider Error:",u),u}},_J=async t=>{const e=kJ(),n=["gemini-1.5-flash","gemini-2.0-flash-001","gemini-2.0-flash-lite-preview-02-05","gemini-1.5-pro","gemini-pro"];let r;for(const s of n)try{console.log(`[SimpleAI] Attempting to use model: ${s}`);const l=(await(await e.getGenerativeModel({model:s}).generateContent(t)).response).text();if(l)return l.trim()}catch(i){console.warn(`[SimpleAI] Model ${s} failed:`,i),r=i;continue}throw r||new Error("All AI models failed to respond")},rc=async t=>{const{provider:e}=Fv();if(e==="openai"){const n=await SJ(t,!1);return typeof n=="string"?n:JSON.stringify(n)}return await _J(t)},O5=async(t,e,n)=>{const r=` AI 
  
  ${e}
  ${t}
  
  `,s=n&&n.trim()?n:r,i=(n==null?void 0:n.includes(""))||(n==null?void 0:n.includes("")),o=e.trim()?`
"${e}"

`:"",a=!!(n&&n.trim()),l=["1. Traditional Chinese","2.  JSON "];i?(l.push("3. "),l.push("4. ")):a?(l.push("3. "),l.push("4. ......"),l.push("5.  Markdown ")):(l.push("3. "),l.push("4.  Markdown ****"),l.push("5. "));const u=`
${s}

${o}
"${t}"


${l.join(`
`)}`;try{if(!t.trim())throw new Error("");return{fullResponse:await rc(u)}}catch(d){throw console.error("AI Assistant Error:",d),d}},P5=async t=>{const e=` AI Prompt 10 

  
  "${t}"`;try{return(await rc(e)).trim().replace(/^"|"$/g,"")}catch(n){return console.error("Generate Prompt Title Error:",n),t.slice(0,15)+(t.length>15?"...":"")}},TJ=async(t,e)=>{const n=t.length>3e3?t.slice(0,3e3)+"...":t;let r;e?r=`${e}

  
  ---
    ${n}
  ---

    `:r=`SEOSEO

  
  1. 
  2. 15 - 30
  3. 
  4. 
  5. 
  6. 
  7. 

  
  - "5"
    - "90%"
    - ""

  
  ---
    ${n}
  ---

    SEO`,console.log("Generating SEO title for content length:",t.length);try{const s=await rc(r);return console.log("SEO Title AI result:",s),s.trim().replace(/^["]/g,"").replace(/["]$/g,"").replace(/^\d+[\.\s]+/,"").replace(/^[:]\s*/i,"").trim()||s.trim()}catch(s){throw console.error("Generate SEO Title Error:",s),s}},CJ=async(t,e)=>{const n=t.length>3e3?t.slice(0,3e3)+"...":t,s=`SEO


(SEO)

${e.length>0?`
${e.join(", ")}`:""}


1. ---
2. 
3.  3-7 
4.  10 
5. 
6. 
7. 


---
${n}
---

`;console.log("Generating SEO keywords for content length:",t.length),console.log("Content preview:",t.slice(0,200));try{const i=await rc(s);return console.log("SEO Keywords AI result:",i),i.split(/[,\n]/).map(a=>a.trim()).filter(a=>a.length>0&&a.length<=20).slice(0,7)}catch(i){throw console.error("Generate SEO Keywords Error:",i),i}},EJ=async(t,e,n,r,s,i)=>{const o=s.existingSchedule&&s.existingSchedule.length>0?`
Existing Schedule (Potential Conflicts):
${s.existingSchedule.join(`
`)}`:"",a=s.pastExperiences&&s.pastExperiences.length>0?`
Relevant Past Experience:
${s.pastExperiences.join(`
`)}`:"",l=`
Role:  AI (Chief Administrative Officer)

Source Task:
- : "${t}"
- /: "${e||"()"}"
- : ${n||""}
- : ${r||""}
- : ${s.today}
${i?`
: "${i}"`:""}
${o}
${a}

Instructions:
1. 
2.  (Relevant Past Experience)() 
3.  (Existing Schedule)() description 
4. 
5. 
   - "title": 
   - "description": 
   - "start_date": YYYY-MM-DD 
   - "due_date": YYYY-MM-DD 
6. "subtasks": 

Output Rules:
-  JSON 
-  Markdown... JSON
- 
- description  title 

JSON Format:
[
  {
    "title": "",
    "description": "...",
    "start_date": "YYYY-MM-DD",
    "due_date": "YYYY-MM-DD",
    "subtasks": []
  }
]
`;try{const u=await rc(l);console.log("Mission 72 Raw Output:",u);let d=u;const f=u.match(/\[[\s\S]*\]/);return f&&(d=f[0]),d=d.replace(/```json/g,"").replace(/```/g,"").trim(),JSON.parse(d)}catch(u){throw console.error("Mission 72 Planning Error:",u),new Error("AI ")}},NJ=async(t,e)=>{if(e.length===0)return null;const n=e.map(s=>`- ${s.name} (ID: ${s.id}, : ${s.depth})`).join(`
`),r=`${t}


${n}


1. 
2. 
3.  "NONE"
4. 

 ID "NONE"`;try{const i=(await rc(r)).trim().replace(/["""'']/g,"");if(i==="NONE"||i.toLowerCase()==="none")return null;const o=e.find(l=>l.id===i);if(o)return o.id;const a=e.find(l=>i.toLowerCase().includes(l.name.toLowerCase())||l.name.toLowerCase().includes(i.toLowerCase()));return a?a.id:null}catch(s){return console.error("Find Best Parent Keyword Error:",s),null}},jJ=async(t,e,n,r=[])=>{const s=`
 GTD (Getting Things Done) **** GTD 



- ${t.title}
- ${t.description||"()"}
- ${t.status}
- ${t.created_at}
- ${t.due_date||""}
- ()${t.start_date||""}
- ${t.tags.join(", ")||""}
- ${t.project_title||" ()"}

 ()
${e.length>0?e.join(`
`):"()"}


${r.map(i=>`${i.role==="user"?"":"GTD"}: ${i.content}`).join(`
`)}


"${n}"

GTD  (current_stage)
1. capture (): 
2. clarify (): 
3. organize (): ** (start_date) start_time (HH:MM) (due_date)**
4. engage (): 


1. ******** \`actions\` JSON
2. ****
3. **** \`start_date\`
4. ************ \`actions\` JSON reminder_minutes

 (JSON Only)
{
  "reply": "...",
  "current_stage": "capture" | "clarify" | "organize" | "engage",
  "actions": [
    { "type": "update_task", "params": { "start_date": "YYYY-MM-DD", "start_time": "09:00", "reminder_minutes": 0 } },
    { "type": "add_subtasks", "params": { "tasks": [{ "title": "...", "start_date": "...", "reminder_minutes": 10 }] } }
  ]
}
* \`actions\` 

 JSON
`;try{const i=await rc(s);let o=i;const a=i.match(/\{[\s\S]*\}/);return a&&(o=a[0]),o=o.replace(/```json/g,"").replace(/```/g,"").trim(),JSON.parse(o)}catch(i){return console.error("GTD Coach Error:",i),{reply:"",current_stage:"capture",actions:[]}}};function IJ(t,e){const n=e||{};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const DJ=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,AJ=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,MJ={};function cC(t,e){return((e||MJ).jsx?AJ:DJ).test(t)}const RJ=/[ \t\n\f\r]/g;function OJ(t){return typeof t=="object"?t.type==="text"?uC(t.value):!1:uC(t)}function uC(t){return t.replace(RJ,"")===""}class eh{constructor(e,n,r){this.normal=n,this.property=e,r&&(this.space=r)}}eh.prototype.normal={};eh.prototype.property={};eh.prototype.space=void 0;function L5(t,e){const n={},r={};for(const s of t)Object.assign(n,s.property),Object.assign(r,s.normal);return new eh(n,r,e)}function rb(t){return t.toLowerCase()}class Us{constructor(e,n){this.attribute=n,this.property=e}}Us.prototype.attribute="";Us.prototype.booleanish=!1;Us.prototype.boolean=!1;Us.prototype.commaOrSpaceSeparated=!1;Us.prototype.commaSeparated=!1;Us.prototype.defined=!1;Us.prototype.mustUseProperty=!1;Us.prototype.number=!1;Us.prototype.overloadedBoolean=!1;Us.prototype.property="";Us.prototype.spaceSeparated=!1;Us.prototype.space=void 0;let PJ=0;const cn=sc(),wr=sc(),sb=sc(),Tt=sc(),zn=sc(),au=sc(),Ws=sc();function sc(){return 2**++PJ}const ib=Object.freeze(Object.defineProperty({__proto__:null,boolean:cn,booleanish:wr,commaOrSpaceSeparated:Ws,commaSeparated:au,number:Tt,overloadedBoolean:sb,spaceSeparated:zn},Symbol.toStringTag,{value:"Module"})),Ey=Object.keys(ib);class Bv extends Us{constructor(e,n,r,s){let i=-1;if(super(e,n),dC(this,"space",s),typeof r=="number")for(;++i<Ey.length;){const o=Ey[i];dC(this,Ey[i],(r&ib[o])===ib[o])}}}Bv.prototype.defined=!0;function dC(t,e,n){n&&(t[e]=n)}function Lu(t){const e={},n={};for(const[r,s]of Object.entries(t.properties)){const i=new Bv(r,t.transform(t.attributes||{},r),s,t.space);t.mustUseProperty&&t.mustUseProperty.includes(r)&&(i.mustUseProperty=!0),e[r]=i,n[rb(r)]=r,n[rb(i.attribute)]=r}return new eh(e,n,t.space)}const $5=Lu({properties:{ariaActiveDescendant:null,ariaAtomic:wr,ariaAutoComplete:null,ariaBusy:wr,ariaChecked:wr,ariaColCount:Tt,ariaColIndex:Tt,ariaColSpan:Tt,ariaControls:zn,ariaCurrent:null,ariaDescribedBy:zn,ariaDetails:null,ariaDisabled:wr,ariaDropEffect:zn,ariaErrorMessage:null,ariaExpanded:wr,ariaFlowTo:zn,ariaGrabbed:wr,ariaHasPopup:null,ariaHidden:wr,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:zn,ariaLevel:Tt,ariaLive:null,ariaModal:wr,ariaMultiLine:wr,ariaMultiSelectable:wr,ariaOrientation:null,ariaOwns:zn,ariaPlaceholder:null,ariaPosInSet:Tt,ariaPressed:wr,ariaReadOnly:wr,ariaRelevant:null,ariaRequired:wr,ariaRoleDescription:zn,ariaRowCount:Tt,ariaRowIndex:Tt,ariaRowSpan:Tt,ariaSelected:wr,ariaSetSize:Tt,ariaSort:null,ariaValueMax:Tt,ariaValueMin:Tt,ariaValueNow:Tt,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function z5(t,e){return e in t?t[e]:e}function F5(t,e){return z5(t,e.toLowerCase())}const LJ=Lu({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:au,acceptCharset:zn,accessKey:zn,action:null,allow:null,allowFullScreen:cn,allowPaymentRequest:cn,allowUserMedia:cn,alt:null,as:null,async:cn,autoCapitalize:null,autoComplete:zn,autoFocus:cn,autoPlay:cn,blocking:zn,capture:null,charSet:null,checked:cn,cite:null,className:zn,cols:Tt,colSpan:null,content:null,contentEditable:wr,controls:cn,controlsList:zn,coords:Tt|au,crossOrigin:null,data:null,dateTime:null,decoding:null,default:cn,defer:cn,dir:null,dirName:null,disabled:cn,download:sb,draggable:wr,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:cn,formTarget:null,headers:zn,height:Tt,hidden:sb,high:Tt,href:null,hrefLang:null,htmlFor:zn,httpEquiv:zn,id:null,imageSizes:null,imageSrcSet:null,inert:cn,inputMode:null,integrity:null,is:null,isMap:cn,itemId:null,itemProp:zn,itemRef:zn,itemScope:cn,itemType:zn,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:cn,low:Tt,manifest:null,max:null,maxLength:Tt,media:null,method:null,min:null,minLength:Tt,multiple:cn,muted:cn,name:null,nonce:null,noModule:cn,noValidate:cn,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:cn,optimum:Tt,pattern:null,ping:zn,placeholder:null,playsInline:cn,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:cn,referrerPolicy:null,rel:zn,required:cn,reversed:cn,rows:Tt,rowSpan:Tt,sandbox:zn,scope:null,scoped:cn,seamless:cn,selected:cn,shadowRootClonable:cn,shadowRootDelegatesFocus:cn,shadowRootMode:null,shape:null,size:Tt,sizes:null,slot:null,span:Tt,spellCheck:wr,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Tt,step:null,style:null,tabIndex:Tt,target:null,title:null,translate:null,type:null,typeMustMatch:cn,useMap:null,value:wr,width:Tt,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:zn,axis:null,background:null,bgColor:null,border:Tt,borderColor:null,bottomMargin:Tt,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:cn,declare:cn,event:null,face:null,frame:null,frameBorder:null,hSpace:Tt,leftMargin:Tt,link:null,longDesc:null,lowSrc:null,marginHeight:Tt,marginWidth:Tt,noResize:cn,noHref:cn,noShade:cn,noWrap:cn,object:null,profile:null,prompt:null,rev:null,rightMargin:Tt,rules:null,scheme:null,scrolling:wr,standby:null,summary:null,text:null,topMargin:Tt,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Tt,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:cn,disableRemotePlayback:cn,prefix:null,property:null,results:Tt,security:null,unselectable:null},space:"html",transform:F5}),$J=Lu({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Ws,accentHeight:Tt,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Tt,amplitude:Tt,arabicForm:null,ascent:Tt,attributeName:null,attributeType:null,azimuth:Tt,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Tt,by:null,calcMode:null,capHeight:Tt,className:zn,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Tt,diffuseConstant:Tt,direction:null,display:null,dur:null,divisor:Tt,dominantBaseline:null,download:cn,dx:null,dy:null,edgeMode:null,editable:null,elevation:Tt,enableBackground:null,end:null,event:null,exponent:Tt,externalResourcesRequired:null,fill:null,fillOpacity:Tt,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:au,g2:au,glyphName:au,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Tt,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Tt,horizOriginX:Tt,horizOriginY:Tt,id:null,ideographic:Tt,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Tt,k:Tt,k1:Tt,k2:Tt,k3:Tt,k4:Tt,kernelMatrix:Ws,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Tt,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Tt,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Tt,overlineThickness:Tt,paintOrder:null,panose1:null,path:null,pathLength:Tt,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:zn,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Tt,pointsAtY:Tt,pointsAtZ:Tt,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Ws,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Ws,rev:Ws,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Ws,requiredFeatures:Ws,requiredFonts:Ws,requiredFormats:Ws,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Tt,specularExponent:Tt,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Tt,strikethroughThickness:Tt,string:null,stroke:null,strokeDashArray:Ws,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Tt,strokeOpacity:Tt,strokeWidth:null,style:null,surfaceScale:Tt,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Ws,tabIndex:Tt,tableValues:null,target:null,targetX:Tt,targetY:Tt,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Ws,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Tt,underlineThickness:Tt,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Tt,values:null,vAlphabetic:Tt,vMathematical:Tt,vectorEffect:null,vHanging:Tt,vIdeographic:Tt,version:null,vertAdvY:Tt,vertOriginX:Tt,vertOriginY:Tt,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Tt,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:z5}),B5=Lu({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),U5=Lu({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:F5}),H5=Lu({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),zJ={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},FJ=/[A-Z]/g,fC=/-[a-z]/g,BJ=/^data[-\w.:]+$/i;function UJ(t,e){const n=rb(e);let r=e,s=Us;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&BJ.test(e)){if(e.charAt(4)==="-"){const i=e.slice(5).replace(fC,VJ);r="data"+i.charAt(0).toUpperCase()+i.slice(1)}else{const i=e.slice(4);if(!fC.test(i)){let o=i.replace(FJ,HJ);o.charAt(0)!=="-"&&(o="-"+o),e="data"+o}}s=Bv}return new s(r,e)}function HJ(t){return"-"+t.toLowerCase()}function VJ(t){return t.charAt(1).toUpperCase()}const WJ=L5([$5,LJ,B5,U5,H5],"html"),Uv=L5([$5,$J,B5,U5,H5],"svg");function KJ(t){return t.join(" ").trim()}var Hv={},hC=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,GJ=/\n/g,qJ=/^\s*/,JJ=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,YJ=/^:\s*/,XJ=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,QJ=/^[;\s]*/,ZJ=/^\s+|\s+$/g,eY=`
`,pC="/",mC="*",vl="",tY="comment",nY="declaration";function rY(t,e){if(typeof t!="string")throw new TypeError("First argument must be a string");if(!t)return[];e=e||{};var n=1,r=1;function s(m){var y=m.match(GJ);y&&(n+=y.length);var x=m.lastIndexOf(eY);r=~x?m.length-x:r+m.length}function i(){var m={line:n,column:r};return function(y){return y.position=new o(m),u(),y}}function o(m){this.start=m,this.end={line:n,column:r},this.source=e.source}o.prototype.content=t;function a(m){var y=new Error(e.source+":"+n+":"+r+": "+m);if(y.reason=m,y.filename=e.source,y.line=n,y.column=r,y.source=t,!e.silent)throw y}function l(m){var y=m.exec(t);if(y){var x=y[0];return s(x),t=t.slice(x.length),y}}function u(){l(qJ)}function d(m){var y;for(m=m||[];y=f();)y!==!1&&m.push(y);return m}function f(){var m=i();if(!(pC!=t.charAt(0)||mC!=t.charAt(1))){for(var y=2;vl!=t.charAt(y)&&(mC!=t.charAt(y)||pC!=t.charAt(y+1));)++y;if(y+=2,vl===t.charAt(y-1))return a("End of comment missing");var x=t.slice(2,y-2);return r+=2,s(x),t=t.slice(y),r+=2,m({type:tY,comment:x})}}function h(){var m=i(),y=l(JJ);if(y){if(f(),!l(YJ))return a("property missing ':'");var x=l(XJ),g=m({type:nY,property:gC(y[0].replace(hC,vl)),value:x?gC(x[0].replace(hC,vl)):vl});return l(QJ),g}}function p(){var m=[];d(m);for(var y;y=h();)y!==!1&&(m.push(y),d(m));return m}return u(),p()}function gC(t){return t?t.replace(ZJ,vl):vl}var sY=rY,iY=Tp&&Tp.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Hv,"__esModule",{value:!0});Hv.default=aY;const oY=iY(sY);function aY(t,e){let n=null;if(!t||typeof t!="string")return n;const r=(0,oY.default)(t),s=typeof e=="function";return r.forEach(i=>{if(i.type!=="declaration")return;const{property:o,value:a}=i;s?e(o,a,i):a&&(n=n||{},n[o]=a)}),n}var qg={};Object.defineProperty(qg,"__esModule",{value:!0});qg.camelCase=void 0;var lY=/^--[a-zA-Z0-9_-]+$/,cY=/-([a-z])/g,uY=/^[^-]+$/,dY=/^-(webkit|moz|ms|o|khtml)-/,fY=/^-(ms)-/,hY=function(t){return!t||uY.test(t)||lY.test(t)},pY=function(t,e){return e.toUpperCase()},yC=function(t,e){return"".concat(e,"-")},mY=function(t,e){return e===void 0&&(e={}),hY(t)?t:(t=t.toLowerCase(),e.reactCompat?t=t.replace(fY,yC):t=t.replace(dY,yC),t.replace(cY,pY))};qg.camelCase=mY;var gY=Tp&&Tp.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},yY=gY(Hv),xY=qg;function ob(t,e){var n={};return!t||typeof t!="string"||(0,yY.default)(t,function(r,s){r&&s&&(n[(0,xY.camelCase)(r,e)]=s)}),n}ob.default=ob;var bY=ob;const wY=sg(bY),V5=W5("end"),Vv=W5("start");function W5(t){return e;function e(n){const r=n&&n.position&&n.position[t]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function vY(t){const e=Vv(t),n=V5(t);if(e&&n)return{start:e,end:n}}function Fd(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?xC(t.position):"start"in t||"end"in t?xC(t):"line"in t||"column"in t?ab(t):""}function ab(t){return bC(t&&t.line)+":"+bC(t&&t.column)}function xC(t){return ab(t&&t.start)+"-"+ab(t&&t.end)}function bC(t){return t&&typeof t=="number"?t:1}class ms extends Error{constructor(e,n,r){super(),typeof n=="string"&&(r=n,n=void 0);let s="",i={},o=!1;if(n&&("line"in n&&"column"in n?i={place:n}:"start"in n&&"end"in n?i={place:n}:"type"in n?i={ancestors:[n],place:n.position}:i={...n}),typeof e=="string"?s=e:!i.cause&&e&&(o=!0,s=e.message,i.cause=e),!i.ruleId&&!i.source&&typeof r=="string"){const l=r.indexOf(":");l===-1?i.ruleId=r:(i.source=r.slice(0,l),i.ruleId=r.slice(l+1))}if(!i.place&&i.ancestors&&i.ancestors){const l=i.ancestors[i.ancestors.length-1];l&&(i.place=l.position)}const a=i.place&&"start"in i.place?i.place.start:i.place;this.ancestors=i.ancestors||void 0,this.cause=i.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file="",this.message=s,this.line=a?a.line:void 0,this.name=Fd(i.place)||"1:1",this.place=i.place||void 0,this.reason=this.message,this.ruleId=i.ruleId||void 0,this.source=i.source||void 0,this.stack=o&&i.cause&&typeof i.cause.stack=="string"?i.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}ms.prototype.file="";ms.prototype.name="";ms.prototype.reason="";ms.prototype.message="";ms.prototype.stack="";ms.prototype.column=void 0;ms.prototype.line=void 0;ms.prototype.ancestors=void 0;ms.prototype.cause=void 0;ms.prototype.fatal=void 0;ms.prototype.place=void 0;ms.prototype.ruleId=void 0;ms.prototype.source=void 0;const Wv={}.hasOwnProperty,kY=new Map,SY=/[A-Z]/g,_Y=new Set(["table","tbody","thead","tfoot","tr"]),TY=new Set(["td","th"]),K5="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function CY(t,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=e.filePath||void 0;let r;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=RY(n,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=MY(n,e.jsx,e.jsxs)}const s={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:r,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?Uv:WJ,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},i=G5(s,t,void 0);return i&&typeof i!="string"?i:s.create(t,s.Fragment,{children:i||void 0},void 0)}function G5(t,e,n){if(e.type==="element")return EY(t,e,n);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return NY(t,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return IY(t,e,n);if(e.type==="mdxjsEsm")return jY(t,e);if(e.type==="root")return DY(t,e,n);if(e.type==="text")return AY(t,e)}function EY(t,e,n){const r=t.schema;let s=r;e.tagName.toLowerCase()==="svg"&&r.space==="html"&&(s=Uv,t.schema=s),t.ancestors.push(e);const i=J5(t,e.tagName,!1),o=OY(t,e);let a=Gv(t,e);return _Y.has(e.tagName)&&(a=a.filter(function(l){return typeof l=="string"?!OJ(l):!0})),q5(t,o,i,e),Kv(o,a),t.ancestors.pop(),t.schema=r,t.create(e,i,o,n)}function NY(t,e){if(e.data&&e.data.estree&&t.evaluater){const r=e.data.estree.body[0];return r.type,t.evaluater.evaluateExpression(r.expression)}Rf(t,e.position)}function jY(t,e){if(e.data&&e.data.estree&&t.evaluater)return t.evaluater.evaluateProgram(e.data.estree);Rf(t,e.position)}function IY(t,e,n){const r=t.schema;let s=r;e.name==="svg"&&r.space==="html"&&(s=Uv,t.schema=s),t.ancestors.push(e);const i=e.name===null?t.Fragment:J5(t,e.name,!0),o=PY(t,e),a=Gv(t,e);return q5(t,o,i,e),Kv(o,a),t.ancestors.pop(),t.schema=r,t.create(e,i,o,n)}function DY(t,e,n){const r={};return Kv(r,Gv(t,e)),t.create(e,t.Fragment,r,n)}function AY(t,e){return e.value}function q5(t,e,n,r){typeof n!="string"&&n!==t.Fragment&&t.passNode&&(e.node=r)}function Kv(t,e){if(e.length>0){const n=e.length>1?e:e[0];n&&(t.children=n)}}function MY(t,e,n){return r;function r(s,i,o,a){const u=Array.isArray(o.children)?n:e;return a?u(i,o,a):u(i,o)}}function RY(t,e){return n;function n(r,s,i,o){const a=Array.isArray(i.children),l=Vv(r);return e(s,i,o,a,{columnNumber:l?l.column-1:void 0,fileName:t,lineNumber:l?l.line:void 0},void 0)}}function OY(t,e){const n={};let r,s;for(s in e.properties)if(s!=="children"&&Wv.call(e.properties,s)){const i=LY(t,s,e.properties[s]);if(i){const[o,a]=i;t.tableCellAlignToStyle&&o==="align"&&typeof a=="string"&&TY.has(e.tagName)?r=a:n[o]=a}}if(r){const i=n.style||(n.style={});i[t.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return n}function PY(t,e){const n={};for(const r of e.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&t.evaluater){const i=r.data.estree.body[0];i.type;const o=i.expression;o.type;const a=o.properties[0];a.type,Object.assign(n,t.evaluater.evaluateExpression(a.argument))}else Rf(t,e.position);else{const s=r.name;let i;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&t.evaluater){const a=r.value.data.estree.body[0];a.type,i=t.evaluater.evaluateExpression(a.expression)}else Rf(t,e.position);else i=r.value===null?!0:r.value;n[s]=i}return n}function Gv(t,e){const n=[];let r=-1;const s=t.passKeys?new Map:kY;for(;++r<e.children.length;){const i=e.children[r];let o;if(t.passKeys){const l=i.type==="element"?i.tagName:i.type==="mdxJsxFlowElement"||i.type==="mdxJsxTextElement"?i.name:void 0;if(l){const u=s.get(l)||0;o=l+"-"+u,s.set(l,u+1)}}const a=G5(t,i,o);a!==void 0&&n.push(a)}return n}function LY(t,e,n){const r=UJ(t.schema,e);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?IJ(n):KJ(n)),r.property==="style"){let s=typeof n=="object"?n:$Y(t,String(n));return t.stylePropertyNameCase==="css"&&(s=zY(s)),["style",s]}return[t.elementAttributeNameCase==="react"&&r.space?zJ[r.property]||r.property:r.attribute,n]}}function $Y(t,e){try{return wY(e,{reactCompat:!0})}catch(n){if(t.ignoreInvalidStyle)return{};const r=n,s=new ms("Cannot parse `style` attribute",{ancestors:t.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw s.file=t.filePath||void 0,s.url=K5+"#cannot-parse-style-attribute",s}}function J5(t,e,n){let r;if(!n)r={type:"Literal",value:e};else if(e.includes(".")){const s=e.split(".");let i=-1,o;for(;++i<s.length;){const a=cC(s[i])?{type:"Identifier",name:s[i]}:{type:"Literal",value:s[i]};o=o?{type:"MemberExpression",object:o,property:a,computed:!!(i&&a.type==="Literal"),optional:!1}:a}r=o}else r=cC(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(r.type==="Literal"){const s=r.value;return Wv.call(t.components,s)?t.components[s]:s}if(t.evaluater)return t.evaluater.evaluateExpression(r);Rf(t)}function Rf(t,e){const n=new ms("Cannot handle MDX estrees without `createEvaluater`",{ancestors:t.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=t.filePath||void 0,n.url=K5+"#cannot-handle-mdx-estrees-without-createevaluater",n}function zY(t){const e={};let n;for(n in t)Wv.call(t,n)&&(e[FY(n)]=t[n]);return e}function FY(t){let e=t.replace(SY,BY);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function BY(t){return"-"+t.toLowerCase()}const Ny={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},UY={};function HY(t,e){const n=e||UY,r=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,s=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return Y5(t,r,s)}function Y5(t,e,n){if(VY(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return wC(t.children,e,n)}return Array.isArray(t)?wC(t,e,n):""}function wC(t,e,n){const r=[];let s=-1;for(;++s<t.length;)r[s]=Y5(t[s],e,n);return r.join("")}function VY(t){return!!(t&&typeof t=="object")}const vC=document.createElement("i");function qv(t){const e="&"+t+";";vC.innerHTML=e;const n=vC.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===e?!1:n}function bo(t,e,n,r){const s=t.length;let i=0,o;if(e<0?e=-e>s?0:s+e:e=e>s?s:e,n=n>0?n:0,r.length<1e4)o=Array.from(r),o.unshift(e,n),t.splice(...o);else for(n&&t.splice(e,n);i<r.length;)o=r.slice(i,i+1e4),o.unshift(e,0),t.splice(...o),i+=1e4,e+=1e4}function pi(t,e){return t.length>0?(bo(t,t.length,0,e),t):e}const kC={}.hasOwnProperty;function WY(t){const e={};let n=-1;for(;++n<t.length;)KY(e,t[n]);return e}function KY(t,e){let n;for(n in e){const s=(kC.call(t,n)?t[n]:void 0)||(t[n]={}),i=e[n];let o;if(i)for(o in i){kC.call(s,o)||(s[o]=[]);const a=i[o];GY(s[o],Array.isArray(a)?a:a?[a]:[])}}}function GY(t,e){let n=-1;const r=[];for(;++n<e.length;)(e[n].add==="after"?t:r).push(e[n]);bo(t,0,0,r)}function X5(t,e){const n=Number.parseInt(t,e);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function lu(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const oo=el(/[A-Za-z]/),Xs=el(/[\dA-Za-z]/),qY=el(/[#-'*+\--9=?A-Z^-~]/);function lb(t){return t!==null&&(t<32||t===127)}const cb=el(/\d/),JY=el(/[\dA-Fa-f]/),YY=el(/[!-/:-@[-`{-~]/);function tn(t){return t!==null&&t<-2}function Fs(t){return t!==null&&(t<0||t===32)}function Cn(t){return t===-2||t===-1||t===32}const XY=el(/\p{P}|\p{S}/u),QY=el(/\s/);function el(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function $u(t){const e=[];let n=-1,r=0,s=0;for(;++n<t.length;){const i=t.charCodeAt(n);let o="";if(i===37&&Xs(t.charCodeAt(n+1))&&Xs(t.charCodeAt(n+2)))s=2;else if(i<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(i))||(o=String.fromCharCode(i));else if(i>55295&&i<57344){const a=t.charCodeAt(n+1);i<56320&&a>56319&&a<57344?(o=String.fromCharCode(i,a),s=1):o=""}else o=String.fromCharCode(i);o&&(e.push(t.slice(r,n),encodeURIComponent(o)),r=n+s+1,o=""),s&&(n+=s,s=0)}return e.join("")+t.slice(r)}function Bn(t,e,n,r){const s=r?r-1:Number.POSITIVE_INFINITY;let i=0;return o;function o(l){return Cn(l)?(t.enter(n),a(l)):e(l)}function a(l){return Cn(l)&&i++<s?(t.consume(l),a):(t.exit(n),e(l))}}const ZY={tokenize:eX};function eX(t){const e=t.attempt(this.parser.constructs.contentInitial,r,s);let n;return e;function r(a){if(a===null){t.consume(a);return}return t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),Bn(t,e,"linePrefix")}function s(a){return t.enter("paragraph"),i(a)}function i(a){const l=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=l),n=l,o(a)}function o(a){if(a===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(a);return}return tn(a)?(t.consume(a),t.exit("chunkText"),i):(t.consume(a),o)}}const tX={tokenize:nX},SC={tokenize:rX};function nX(t){const e=this,n=[];let r=0,s,i,o;return a;function a(w){if(r<n.length){const S=n[r];return e.containerState=S[1],t.attempt(S[0].continuation,l,u)(w)}return u(w)}function l(w){if(r++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,s&&v();const S=e.events.length;let I=S,k;for(;I--;)if(e.events[I][0]==="exit"&&e.events[I][1].type==="chunkFlow"){k=e.events[I][1].end;break}g(r);let R=S;for(;R<e.events.length;)e.events[R][1].end={...k},R++;return bo(e.events,I+1,0,e.events.slice(S)),e.events.length=R,u(w)}return a(w)}function u(w){if(r===n.length){if(!s)return h(w);if(s.currentConstruct&&s.currentConstruct.concrete)return m(w);e.interrupt=!!(s.currentConstruct&&!s._gfmTableDynamicInterruptHack)}return e.containerState={},t.check(SC,d,f)(w)}function d(w){return s&&v(),g(r),h(w)}function f(w){return e.parser.lazy[e.now().line]=r!==n.length,o=e.now().offset,m(w)}function h(w){return e.containerState={},t.attempt(SC,p,m)(w)}function p(w){return r++,n.push([e.currentConstruct,e.containerState]),h(w)}function m(w){if(w===null){s&&v(),g(0),t.consume(w);return}return s=s||e.parser.flow(e.now()),t.enter("chunkFlow",{_tokenizer:s,contentType:"flow",previous:i}),y(w)}function y(w){if(w===null){x(t.exit("chunkFlow"),!0),g(0),t.consume(w);return}return tn(w)?(t.consume(w),x(t.exit("chunkFlow")),r=0,e.interrupt=void 0,a):(t.consume(w),y)}function x(w,S){const I=e.sliceStream(w);if(S&&I.push(null),w.previous=i,i&&(i.next=w),i=w,s.defineSkip(w.start),s.write(I),e.parser.lazy[w.start.line]){let k=s.events.length;for(;k--;)if(s.events[k][1].start.offset<o&&(!s.events[k][1].end||s.events[k][1].end.offset>o))return;const R=e.events.length;let C=R,T,_;for(;C--;)if(e.events[C][0]==="exit"&&e.events[C][1].type==="chunkFlow"){if(T){_=e.events[C][1].end;break}T=!0}for(g(r),k=R;k<e.events.length;)e.events[k][1].end={..._},k++;bo(e.events,C+1,0,e.events.slice(R)),e.events.length=k}}function g(w){let S=n.length;for(;S-- >w;){const I=n[S];e.containerState=I[1],I[0].exit.call(e,t)}n.length=w}function v(){s.write([null]),i=void 0,s=void 0,e.containerState._closeFlow=void 0}}function rX(t,e,n){return Bn(t,t.attempt(this.parser.constructs.document,e,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function _C(t){if(t===null||Fs(t)||QY(t))return 1;if(XY(t))return 2}function Jv(t,e,n){const r=[];let s=-1;for(;++s<t.length;){const i=t[s].resolveAll;i&&!r.includes(i)&&(e=i(e,n),r.push(i))}return e}const ub={name:"attention",resolveAll:sX,tokenize:iX};function sX(t,e){let n=-1,r,s,i,o,a,l,u,d;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(r=n;r--;)if(t[r][0]==="exit"&&t[r][1].type==="attentionSequence"&&t[r][1]._open&&e.sliceSerialize(t[r][1]).charCodeAt(0)===e.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[r][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[r][1].end.offset-t[r][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;l=t[r][1].end.offset-t[r][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const f={...t[r][1].end},h={...t[n][1].start};TC(f,-l),TC(h,l),o={type:l>1?"strongSequence":"emphasisSequence",start:f,end:{...t[r][1].end}},a={type:l>1?"strongSequence":"emphasisSequence",start:{...t[n][1].start},end:h},i={type:l>1?"strongText":"emphasisText",start:{...t[r][1].end},end:{...t[n][1].start}},s={type:l>1?"strong":"emphasis",start:{...o.start},end:{...a.end}},t[r][1].end={...o.start},t[n][1].start={...a.end},u=[],t[r][1].end.offset-t[r][1].start.offset&&(u=pi(u,[["enter",t[r][1],e],["exit",t[r][1],e]])),u=pi(u,[["enter",s,e],["enter",o,e],["exit",o,e],["enter",i,e]]),u=pi(u,Jv(e.parser.constructs.insideSpan.null,t.slice(r+1,n),e)),u=pi(u,[["exit",i,e],["enter",a,e],["exit",a,e],["exit",s,e]]),t[n][1].end.offset-t[n][1].start.offset?(d=2,u=pi(u,[["enter",t[n][1],e],["exit",t[n][1],e]])):d=0,bo(t,r-1,n-r+3,u),n=r+u.length-d-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function iX(t,e){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,s=_C(r);let i;return o;function o(l){return i=l,t.enter("attentionSequence"),a(l)}function a(l){if(l===i)return t.consume(l),a;const u=t.exit("attentionSequence"),d=_C(l),f=!d||d===2&&s||n.includes(l),h=!s||s===2&&d||n.includes(r);return u._open=!!(i===42?f:f&&(s||!h)),u._close=!!(i===42?h:h&&(d||!f)),e(l)}}function TC(t,e){t.column+=e,t.offset+=e,t._bufferIndex+=e}const oX={name:"autolink",tokenize:aX};function aX(t,e,n){let r=0;return s;function s(p){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),i}function i(p){return oo(p)?(t.consume(p),o):p===64?n(p):u(p)}function o(p){return p===43||p===45||p===46||Xs(p)?(r=1,a(p)):u(p)}function a(p){return p===58?(t.consume(p),r=0,l):(p===43||p===45||p===46||Xs(p))&&r++<32?(t.consume(p),a):(r=0,u(p))}function l(p){return p===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.exit("autolink"),e):p===null||p===32||p===60||lb(p)?n(p):(t.consume(p),l)}function u(p){return p===64?(t.consume(p),d):qY(p)?(t.consume(p),u):n(p)}function d(p){return Xs(p)?f(p):n(p)}function f(p){return p===46?(t.consume(p),r=0,d):p===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.exit("autolink"),e):h(p)}function h(p){if((p===45||Xs(p))&&r++<63){const m=p===45?h:f;return t.consume(p),m}return n(p)}}const Jg={partial:!0,tokenize:lX};function lX(t,e,n){return r;function r(i){return Cn(i)?Bn(t,s,"linePrefix")(i):s(i)}function s(i){return i===null||tn(i)?e(i):n(i)}}const Q5={continuation:{tokenize:uX},exit:dX,name:"blockQuote",tokenize:cX};function cX(t,e,n){const r=this;return s;function s(o){if(o===62){const a=r.containerState;return a.open||(t.enter("blockQuote",{_container:!0}),a.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(o),t.exit("blockQuoteMarker"),i}return n(o)}function i(o){return Cn(o)?(t.enter("blockQuotePrefixWhitespace"),t.consume(o),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),e):(t.exit("blockQuotePrefix"),e(o))}}function uX(t,e,n){const r=this;return s;function s(o){return Cn(o)?Bn(t,i,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o):i(o)}function i(o){return t.attempt(Q5,e,n)(o)}}function dX(t){t.exit("blockQuote")}const Z5={name:"characterEscape",tokenize:fX};function fX(t,e,n){return r;function r(i){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(i),t.exit("escapeMarker"),s}function s(i){return YY(i)?(t.enter("characterEscapeValue"),t.consume(i),t.exit("characterEscapeValue"),t.exit("characterEscape"),e):n(i)}}const eR={name:"characterReference",tokenize:hX};function hX(t,e,n){const r=this;let s=0,i,o;return a;function a(f){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(f),t.exit("characterReferenceMarker"),l}function l(f){return f===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(f),t.exit("characterReferenceMarkerNumeric"),u):(t.enter("characterReferenceValue"),i=31,o=Xs,d(f))}function u(f){return f===88||f===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(f),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),i=6,o=JY,d):(t.enter("characterReferenceValue"),i=7,o=cb,d(f))}function d(f){if(f===59&&s){const h=t.exit("characterReferenceValue");return o===Xs&&!qv(r.sliceSerialize(h))?n(f):(t.enter("characterReferenceMarker"),t.consume(f),t.exit("characterReferenceMarker"),t.exit("characterReference"),e)}return o(f)&&s++<i?(t.consume(f),d):n(f)}}const CC={partial:!0,tokenize:mX},EC={concrete:!0,name:"codeFenced",tokenize:pX};function pX(t,e,n){const r=this,s={partial:!0,tokenize:I};let i=0,o=0,a;return l;function l(k){return u(k)}function u(k){const R=r.events[r.events.length-1];return i=R&&R[1].type==="linePrefix"?R[2].sliceSerialize(R[1],!0).length:0,a=k,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),d(k)}function d(k){return k===a?(o++,t.consume(k),d):o<3?n(k):(t.exit("codeFencedFenceSequence"),Cn(k)?Bn(t,f,"whitespace")(k):f(k))}function f(k){return k===null||tn(k)?(t.exit("codeFencedFence"),r.interrupt?e(k):t.check(CC,y,S)(k)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),h(k))}function h(k){return k===null||tn(k)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),f(k)):Cn(k)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),Bn(t,p,"whitespace")(k)):k===96&&k===a?n(k):(t.consume(k),h)}function p(k){return k===null||tn(k)?f(k):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),m(k))}function m(k){return k===null||tn(k)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),f(k)):k===96&&k===a?n(k):(t.consume(k),m)}function y(k){return t.attempt(s,S,x)(k)}function x(k){return t.enter("lineEnding"),t.consume(k),t.exit("lineEnding"),g}function g(k){return i>0&&Cn(k)?Bn(t,v,"linePrefix",i+1)(k):v(k)}function v(k){return k===null||tn(k)?t.check(CC,y,S)(k):(t.enter("codeFlowValue"),w(k))}function w(k){return k===null||tn(k)?(t.exit("codeFlowValue"),v(k)):(t.consume(k),w)}function S(k){return t.exit("codeFenced"),e(k)}function I(k,R,C){let T=0;return _;function _(G){return k.enter("lineEnding"),k.consume(G),k.exit("lineEnding"),N}function N(G){return k.enter("codeFencedFence"),Cn(G)?Bn(k,j,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(G):j(G)}function j(G){return G===a?(k.enter("codeFencedFenceSequence"),O(G)):C(G)}function O(G){return G===a?(T++,k.consume(G),O):T>=o?(k.exit("codeFencedFenceSequence"),Cn(G)?Bn(k,P,"whitespace")(G):P(G)):C(G)}function P(G){return G===null||tn(G)?(k.exit("codeFencedFence"),R(G)):C(G)}}}function mX(t,e,n){const r=this;return s;function s(o){return o===null?n(o):(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),i)}function i(o){return r.parser.lazy[r.now().line]?n(o):e(o)}}const jy={name:"codeIndented",tokenize:yX},gX={partial:!0,tokenize:xX};function yX(t,e,n){const r=this;return s;function s(u){return t.enter("codeIndented"),Bn(t,i,"linePrefix",4+1)(u)}function i(u){const d=r.events[r.events.length-1];return d&&d[1].type==="linePrefix"&&d[2].sliceSerialize(d[1],!0).length>=4?o(u):n(u)}function o(u){return u===null?l(u):tn(u)?t.attempt(gX,o,l)(u):(t.enter("codeFlowValue"),a(u))}function a(u){return u===null||tn(u)?(t.exit("codeFlowValue"),o(u)):(t.consume(u),a)}function l(u){return t.exit("codeIndented"),e(u)}}function xX(t,e,n){const r=this;return s;function s(o){return r.parser.lazy[r.now().line]?n(o):tn(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),s):Bn(t,i,"linePrefix",4+1)(o)}function i(o){const a=r.events[r.events.length-1];return a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):tn(o)?s(o):n(o)}}const bX={name:"codeText",previous:vX,resolve:wX,tokenize:kX};function wX(t){let e=t.length-4,n=3,r,s;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[e][1].type==="lineEnding"||t[e][1].type==="space")){for(r=n;++r<e;)if(t[r][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[e][1].type="codeTextPadding",n+=2,e-=2;break}}for(r=n-1,e++;++r<=e;)s===void 0?r!==e&&t[r][1].type!=="lineEnding"&&(s=r):(r===e||t[r][1].type==="lineEnding")&&(t[s][1].type="codeTextData",r!==s+2&&(t[s][1].end=t[r-1][1].end,t.splice(s+2,r-s-2),e-=r-s-2,r=s+2),s=void 0);return t}function vX(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function kX(t,e,n){let r=0,s,i;return o;function o(f){return t.enter("codeText"),t.enter("codeTextSequence"),a(f)}function a(f){return f===96?(t.consume(f),r++,a):(t.exit("codeTextSequence"),l(f))}function l(f){return f===null?n(f):f===32?(t.enter("space"),t.consume(f),t.exit("space"),l):f===96?(i=t.enter("codeTextSequence"),s=0,d(f)):tn(f)?(t.enter("lineEnding"),t.consume(f),t.exit("lineEnding"),l):(t.enter("codeTextData"),u(f))}function u(f){return f===null||f===32||f===96||tn(f)?(t.exit("codeTextData"),l(f)):(t.consume(f),u)}function d(f){return f===96?(t.consume(f),s++,d):s===r?(t.exit("codeTextSequence"),t.exit("codeText"),e(f)):(i.type="codeTextData",u(f))}}class SX{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,n){const r=n??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(e,r):e>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(e,n,r){const s=n||0;this.setCursor(Math.trunc(e));const i=this.right.splice(this.right.length-s,Number.POSITIVE_INFINITY);return r&&Zu(this.left,r),i.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),Zu(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),Zu(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const n=this.left.splice(e,Number.POSITIVE_INFINITY);Zu(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);Zu(this.left,n.reverse())}}}function Zu(t,e){let n=0;if(e.length<1e4)t.push(...e);else for(;n<e.length;)t.push(...e.slice(n,n+1e4)),n+=1e4}function tR(t){const e={};let n=-1,r,s,i,o,a,l,u;const d=new SX(t);for(;++n<d.length;){for(;n in e;)n=e[n];if(r=d.get(n),n&&r[1].type==="chunkFlow"&&d.get(n-1)[1].type==="listItemPrefix"&&(l=r[1]._tokenizer.events,i=0,i<l.length&&l[i][1].type==="lineEndingBlank"&&(i+=2),i<l.length&&l[i][1].type==="content"))for(;++i<l.length&&l[i][1].type!=="content";)l[i][1].type==="chunkText"&&(l[i][1]._isInFirstContentOfListItem=!0,i++);if(r[0]==="enter")r[1].contentType&&(Object.assign(e,_X(d,n)),n=e[n],u=!0);else if(r[1]._container){for(i=n,s=void 0;i--;)if(o=d.get(i),o[1].type==="lineEnding"||o[1].type==="lineEndingBlank")o[0]==="enter"&&(s&&(d.get(s)[1].type="lineEndingBlank"),o[1].type="lineEnding",s=i);else if(!(o[1].type==="linePrefix"||o[1].type==="listItemIndent"))break;s&&(r[1].end={...d.get(s)[1].start},a=d.slice(s,n),a.unshift(r),d.splice(s,n-s+1,a))}}return bo(t,0,Number.POSITIVE_INFINITY,d.slice(0)),!u}function _X(t,e){const n=t.get(e)[1],r=t.get(e)[2];let s=e-1;const i=[];let o=n._tokenizer;o||(o=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(o._contentTypeTextTrailing=!0));const a=o.events,l=[],u={};let d,f,h=-1,p=n,m=0,y=0;const x=[y];for(;p;){for(;t.get(++s)[1]!==p;);i.push(s),p._tokenizer||(d=r.sliceStream(p),p.next||d.push(null),f&&o.defineSkip(p.start),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(d),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),f=p,p=p.next}for(p=n;++h<a.length;)a[h][0]==="exit"&&a[h-1][0]==="enter"&&a[h][1].type===a[h-1][1].type&&a[h][1].start.line!==a[h][1].end.line&&(y=h+1,x.push(y),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(o.events=[],p?(p._tokenizer=void 0,p.previous=void 0):x.pop(),h=x.length;h--;){const g=a.slice(x[h],x[h+1]),v=i.pop();l.push([v,v+g.length-1]),t.splice(v,2,g)}for(l.reverse(),h=-1;++h<l.length;)u[m+l[h][0]]=m+l[h][1],m+=l[h][1]-l[h][0]-1;return u}const TX={resolve:EX,tokenize:NX},CX={partial:!0,tokenize:jX};function EX(t){return tR(t),t}function NX(t,e){let n;return r;function r(a){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),s(a)}function s(a){return a===null?i(a):tn(a)?t.check(CX,o,i)(a):(t.consume(a),s)}function i(a){return t.exit("chunkContent"),t.exit("content"),e(a)}function o(a){return t.consume(a),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,s}}function jX(t,e,n){const r=this;return s;function s(o){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),Bn(t,i,"linePrefix")}function i(o){if(o===null||tn(o))return n(o);const a=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):t.interrupt(r.parser.constructs.flow,n,e)(o)}}function nR(t,e,n,r,s,i,o,a,l){const u=l||Number.POSITIVE_INFINITY;let d=0;return f;function f(g){return g===60?(t.enter(r),t.enter(s),t.enter(i),t.consume(g),t.exit(i),h):g===null||g===32||g===41||lb(g)?n(g):(t.enter(r),t.enter(o),t.enter(a),t.enter("chunkString",{contentType:"string"}),y(g))}function h(g){return g===62?(t.enter(i),t.consume(g),t.exit(i),t.exit(s),t.exit(r),e):(t.enter(a),t.enter("chunkString",{contentType:"string"}),p(g))}function p(g){return g===62?(t.exit("chunkString"),t.exit(a),h(g)):g===null||g===60||tn(g)?n(g):(t.consume(g),g===92?m:p)}function m(g){return g===60||g===62||g===92?(t.consume(g),p):p(g)}function y(g){return!d&&(g===null||g===41||Fs(g))?(t.exit("chunkString"),t.exit(a),t.exit(o),t.exit(r),e(g)):d<u&&g===40?(t.consume(g),d++,y):g===41?(t.consume(g),d--,y):g===null||g===32||g===40||lb(g)?n(g):(t.consume(g),g===92?x:y)}function x(g){return g===40||g===41||g===92?(t.consume(g),y):y(g)}}function rR(t,e,n,r,s,i){const o=this;let a=0,l;return u;function u(p){return t.enter(r),t.enter(s),t.consume(p),t.exit(s),t.enter(i),d}function d(p){return a>999||p===null||p===91||p===93&&!l||p===94&&!a&&"_hiddenFootnoteSupport"in o.parser.constructs?n(p):p===93?(t.exit(i),t.enter(s),t.consume(p),t.exit(s),t.exit(r),e):tn(p)?(t.enter("lineEnding"),t.consume(p),t.exit("lineEnding"),d):(t.enter("chunkString",{contentType:"string"}),f(p))}function f(p){return p===null||p===91||p===93||tn(p)||a++>999?(t.exit("chunkString"),d(p)):(t.consume(p),l||(l=!Cn(p)),p===92?h:f)}function h(p){return p===91||p===92||p===93?(t.consume(p),a++,f):f(p)}}function sR(t,e,n,r,s,i){let o;return a;function a(h){return h===34||h===39||h===40?(t.enter(r),t.enter(s),t.consume(h),t.exit(s),o=h===40?41:h,l):n(h)}function l(h){return h===o?(t.enter(s),t.consume(h),t.exit(s),t.exit(r),e):(t.enter(i),u(h))}function u(h){return h===o?(t.exit(i),l(o)):h===null?n(h):tn(h)?(t.enter("lineEnding"),t.consume(h),t.exit("lineEnding"),Bn(t,u,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),d(h))}function d(h){return h===o||h===null||tn(h)?(t.exit("chunkString"),u(h)):(t.consume(h),h===92?f:d)}function f(h){return h===o||h===92?(t.consume(h),d):d(h)}}function Bd(t,e){let n;return r;function r(s){return tn(s)?(t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),n=!0,r):Cn(s)?Bn(t,r,n?"linePrefix":"lineSuffix")(s):e(s)}}const IX={name:"definition",tokenize:AX},DX={partial:!0,tokenize:MX};function AX(t,e,n){const r=this;let s;return i;function i(p){return t.enter("definition"),o(p)}function o(p){return rR.call(r,t,a,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(p)}function a(p){return s=lu(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),p===58?(t.enter("definitionMarker"),t.consume(p),t.exit("definitionMarker"),l):n(p)}function l(p){return Fs(p)?Bd(t,u)(p):u(p)}function u(p){return nR(t,d,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(p)}function d(p){return t.attempt(DX,f,f)(p)}function f(p){return Cn(p)?Bn(t,h,"whitespace")(p):h(p)}function h(p){return p===null||tn(p)?(t.exit("definition"),r.parser.defined.push(s),e(p)):n(p)}}function MX(t,e,n){return r;function r(a){return Fs(a)?Bd(t,s)(a):n(a)}function s(a){return sR(t,i,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(a)}function i(a){return Cn(a)?Bn(t,o,"whitespace")(a):o(a)}function o(a){return a===null||tn(a)?e(a):n(a)}}const RX={name:"hardBreakEscape",tokenize:OX};function OX(t,e,n){return r;function r(i){return t.enter("hardBreakEscape"),t.consume(i),s}function s(i){return tn(i)?(t.exit("hardBreakEscape"),e(i)):n(i)}}const PX={name:"headingAtx",resolve:LX,tokenize:$X};function LX(t,e){let n=t.length-2,r=3,s,i;return t[r][1].type==="whitespace"&&(r+=2),n-2>r&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(r===n-1||n-4>r&&t[n-2][1].type==="whitespace")&&(n-=r+1===n?2:4),n>r&&(s={type:"atxHeadingText",start:t[r][1].start,end:t[n][1].end},i={type:"chunkText",start:t[r][1].start,end:t[n][1].end,contentType:"text"},bo(t,r,n-r+1,[["enter",s,e],["enter",i,e],["exit",i,e],["exit",s,e]])),t}function $X(t,e,n){let r=0;return s;function s(d){return t.enter("atxHeading"),i(d)}function i(d){return t.enter("atxHeadingSequence"),o(d)}function o(d){return d===35&&r++<6?(t.consume(d),o):d===null||Fs(d)?(t.exit("atxHeadingSequence"),a(d)):n(d)}function a(d){return d===35?(t.enter("atxHeadingSequence"),l(d)):d===null||tn(d)?(t.exit("atxHeading"),e(d)):Cn(d)?Bn(t,a,"whitespace")(d):(t.enter("atxHeadingText"),u(d))}function l(d){return d===35?(t.consume(d),l):(t.exit("atxHeadingSequence"),a(d))}function u(d){return d===null||d===35||Fs(d)?(t.exit("atxHeadingText"),a(d)):(t.consume(d),u)}}const zX=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],NC=["pre","script","style","textarea"],FX={concrete:!0,name:"htmlFlow",resolveTo:HX,tokenize:VX},BX={partial:!0,tokenize:KX},UX={partial:!0,tokenize:WX};function HX(t){let e=t.length;for(;e--&&!(t[e][0]==="enter"&&t[e][1].type==="htmlFlow"););return e>1&&t[e-2][1].type==="linePrefix"&&(t[e][1].start=t[e-2][1].start,t[e+1][1].start=t[e-2][1].start,t.splice(e-2,2)),t}function VX(t,e,n){const r=this;let s,i,o,a,l;return u;function u(U){return d(U)}function d(U){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(U),f}function f(U){return U===33?(t.consume(U),h):U===47?(t.consume(U),i=!0,y):U===63?(t.consume(U),s=3,r.interrupt?e:D):oo(U)?(t.consume(U),o=String.fromCharCode(U),x):n(U)}function h(U){return U===45?(t.consume(U),s=2,p):U===91?(t.consume(U),s=5,a=0,m):oo(U)?(t.consume(U),s=4,r.interrupt?e:D):n(U)}function p(U){return U===45?(t.consume(U),r.interrupt?e:D):n(U)}function m(U){const z="CDATA[";return U===z.charCodeAt(a++)?(t.consume(U),a===z.length?r.interrupt?e:j:m):n(U)}function y(U){return oo(U)?(t.consume(U),o=String.fromCharCode(U),x):n(U)}function x(U){if(U===null||U===47||U===62||Fs(U)){const z=U===47,ie=o.toLowerCase();return!z&&!i&&NC.includes(ie)?(s=1,r.interrupt?e(U):j(U)):zX.includes(o.toLowerCase())?(s=6,z?(t.consume(U),g):r.interrupt?e(U):j(U)):(s=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(U):i?v(U):w(U))}return U===45||Xs(U)?(t.consume(U),o+=String.fromCharCode(U),x):n(U)}function g(U){return U===62?(t.consume(U),r.interrupt?e:j):n(U)}function v(U){return Cn(U)?(t.consume(U),v):_(U)}function w(U){return U===47?(t.consume(U),_):U===58||U===95||oo(U)?(t.consume(U),S):Cn(U)?(t.consume(U),w):_(U)}function S(U){return U===45||U===46||U===58||U===95||Xs(U)?(t.consume(U),S):I(U)}function I(U){return U===61?(t.consume(U),k):Cn(U)?(t.consume(U),I):w(U)}function k(U){return U===null||U===60||U===61||U===62||U===96?n(U):U===34||U===39?(t.consume(U),l=U,R):Cn(U)?(t.consume(U),k):C(U)}function R(U){return U===l?(t.consume(U),l=null,T):U===null||tn(U)?n(U):(t.consume(U),R)}function C(U){return U===null||U===34||U===39||U===47||U===60||U===61||U===62||U===96||Fs(U)?I(U):(t.consume(U),C)}function T(U){return U===47||U===62||Cn(U)?w(U):n(U)}function _(U){return U===62?(t.consume(U),N):n(U)}function N(U){return U===null||tn(U)?j(U):Cn(U)?(t.consume(U),N):n(U)}function j(U){return U===45&&s===2?(t.consume(U),A):U===60&&s===1?(t.consume(U),M):U===62&&s===4?(t.consume(U),Te):U===63&&s===3?(t.consume(U),D):U===93&&s===5?(t.consume(U),X):tn(U)&&(s===6||s===7)?(t.exit("htmlFlowData"),t.check(BX,xe,O)(U)):U===null||tn(U)?(t.exit("htmlFlowData"),O(U)):(t.consume(U),j)}function O(U){return t.check(UX,P,xe)(U)}function P(U){return t.enter("lineEnding"),t.consume(U),t.exit("lineEnding"),G}function G(U){return U===null||tn(U)?O(U):(t.enter("htmlFlowData"),j(U))}function A(U){return U===45?(t.consume(U),D):j(U)}function M(U){return U===47?(t.consume(U),o="",Q):j(U)}function Q(U){if(U===62){const z=o.toLowerCase();return NC.includes(z)?(t.consume(U),Te):j(U)}return oo(U)&&o.length<8?(t.consume(U),o+=String.fromCharCode(U),Q):j(U)}function X(U){return U===93?(t.consume(U),D):j(U)}function D(U){return U===62?(t.consume(U),Te):U===45&&s===2?(t.consume(U),D):j(U)}function Te(U){return U===null||tn(U)?(t.exit("htmlFlowData"),xe(U)):(t.consume(U),Te)}function xe(U){return t.exit("htmlFlow"),e(U)}}function WX(t,e,n){const r=this;return s;function s(o){return tn(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),i):n(o)}function i(o){return r.parser.lazy[r.now().line]?n(o):e(o)}}function KX(t,e,n){return r;function r(s){return t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),t.attempt(Jg,e,n)}}const GX={name:"htmlText",tokenize:qX};function qX(t,e,n){const r=this;let s,i,o;return a;function a(D){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(D),l}function l(D){return D===33?(t.consume(D),u):D===47?(t.consume(D),I):D===63?(t.consume(D),w):oo(D)?(t.consume(D),C):n(D)}function u(D){return D===45?(t.consume(D),d):D===91?(t.consume(D),i=0,m):oo(D)?(t.consume(D),v):n(D)}function d(D){return D===45?(t.consume(D),p):n(D)}function f(D){return D===null?n(D):D===45?(t.consume(D),h):tn(D)?(o=f,M(D)):(t.consume(D),f)}function h(D){return D===45?(t.consume(D),p):f(D)}function p(D){return D===62?A(D):D===45?h(D):f(D)}function m(D){const Te="CDATA[";return D===Te.charCodeAt(i++)?(t.consume(D),i===Te.length?y:m):n(D)}function y(D){return D===null?n(D):D===93?(t.consume(D),x):tn(D)?(o=y,M(D)):(t.consume(D),y)}function x(D){return D===93?(t.consume(D),g):y(D)}function g(D){return D===62?A(D):D===93?(t.consume(D),g):y(D)}function v(D){return D===null||D===62?A(D):tn(D)?(o=v,M(D)):(t.consume(D),v)}function w(D){return D===null?n(D):D===63?(t.consume(D),S):tn(D)?(o=w,M(D)):(t.consume(D),w)}function S(D){return D===62?A(D):w(D)}function I(D){return oo(D)?(t.consume(D),k):n(D)}function k(D){return D===45||Xs(D)?(t.consume(D),k):R(D)}function R(D){return tn(D)?(o=R,M(D)):Cn(D)?(t.consume(D),R):A(D)}function C(D){return D===45||Xs(D)?(t.consume(D),C):D===47||D===62||Fs(D)?T(D):n(D)}function T(D){return D===47?(t.consume(D),A):D===58||D===95||oo(D)?(t.consume(D),_):tn(D)?(o=T,M(D)):Cn(D)?(t.consume(D),T):A(D)}function _(D){return D===45||D===46||D===58||D===95||Xs(D)?(t.consume(D),_):N(D)}function N(D){return D===61?(t.consume(D),j):tn(D)?(o=N,M(D)):Cn(D)?(t.consume(D),N):T(D)}function j(D){return D===null||D===60||D===61||D===62||D===96?n(D):D===34||D===39?(t.consume(D),s=D,O):tn(D)?(o=j,M(D)):Cn(D)?(t.consume(D),j):(t.consume(D),P)}function O(D){return D===s?(t.consume(D),s=void 0,G):D===null?n(D):tn(D)?(o=O,M(D)):(t.consume(D),O)}function P(D){return D===null||D===34||D===39||D===60||D===61||D===96?n(D):D===47||D===62||Fs(D)?T(D):(t.consume(D),P)}function G(D){return D===47||D===62||Fs(D)?T(D):n(D)}function A(D){return D===62?(t.consume(D),t.exit("htmlTextData"),t.exit("htmlText"),e):n(D)}function M(D){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(D),t.exit("lineEnding"),Q}function Q(D){return Cn(D)?Bn(t,X,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(D):X(D)}function X(D){return t.enter("htmlTextData"),o(D)}}const Yv={name:"labelEnd",resolveAll:QX,resolveTo:ZX,tokenize:eQ},JX={tokenize:tQ},YX={tokenize:nQ},XX={tokenize:rQ};function QX(t){let e=-1;const n=[];for(;++e<t.length;){const r=t[e][1];if(n.push(t[e]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const s=r.type==="labelImage"?4:2;r.type="data",e+=s}}return t.length!==n.length&&bo(t,0,t.length,n),t}function ZX(t,e){let n=t.length,r=0,s,i,o,a;for(;n--;)if(s=t[n][1],i){if(s.type==="link"||s.type==="labelLink"&&s._inactive)break;t[n][0]==="enter"&&s.type==="labelLink"&&(s._inactive=!0)}else if(o){if(t[n][0]==="enter"&&(s.type==="labelImage"||s.type==="labelLink")&&!s._balanced&&(i=n,s.type!=="labelLink")){r=2;break}}else s.type==="labelEnd"&&(o=n);const l={type:t[i][1].type==="labelLink"?"link":"image",start:{...t[i][1].start},end:{...t[t.length-1][1].end}},u={type:"label",start:{...t[i][1].start},end:{...t[o][1].end}},d={type:"labelText",start:{...t[i+r+2][1].end},end:{...t[o-2][1].start}};return a=[["enter",l,e],["enter",u,e]],a=pi(a,t.slice(i+1,i+r+3)),a=pi(a,[["enter",d,e]]),a=pi(a,Jv(e.parser.constructs.insideSpan.null,t.slice(i+r+4,o-3),e)),a=pi(a,[["exit",d,e],t[o-2],t[o-1],["exit",u,e]]),a=pi(a,t.slice(o+1)),a=pi(a,[["exit",l,e]]),bo(t,i,t.length,a),t}function eQ(t,e,n){const r=this;let s=r.events.length,i,o;for(;s--;)if((r.events[s][1].type==="labelImage"||r.events[s][1].type==="labelLink")&&!r.events[s][1]._balanced){i=r.events[s][1];break}return a;function a(h){return i?i._inactive?f(h):(o=r.parser.defined.includes(lu(r.sliceSerialize({start:i.end,end:r.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(h),t.exit("labelMarker"),t.exit("labelEnd"),l):n(h)}function l(h){return h===40?t.attempt(JX,d,o?d:f)(h):h===91?t.attempt(YX,d,o?u:f)(h):o?d(h):f(h)}function u(h){return t.attempt(XX,d,f)(h)}function d(h){return e(h)}function f(h){return i._balanced=!0,n(h)}}function tQ(t,e,n){return r;function r(f){return t.enter("resource"),t.enter("resourceMarker"),t.consume(f),t.exit("resourceMarker"),s}function s(f){return Fs(f)?Bd(t,i)(f):i(f)}function i(f){return f===41?d(f):nR(t,o,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(f)}function o(f){return Fs(f)?Bd(t,l)(f):d(f)}function a(f){return n(f)}function l(f){return f===34||f===39||f===40?sR(t,u,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(f):d(f)}function u(f){return Fs(f)?Bd(t,d)(f):d(f)}function d(f){return f===41?(t.enter("resourceMarker"),t.consume(f),t.exit("resourceMarker"),t.exit("resource"),e):n(f)}}function nQ(t,e,n){const r=this;return s;function s(a){return rR.call(r,t,i,o,"reference","referenceMarker","referenceString")(a)}function i(a){return r.parser.defined.includes(lu(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(a):n(a)}function o(a){return n(a)}}function rQ(t,e,n){return r;function r(i){return t.enter("reference"),t.enter("referenceMarker"),t.consume(i),t.exit("referenceMarker"),s}function s(i){return i===93?(t.enter("referenceMarker"),t.consume(i),t.exit("referenceMarker"),t.exit("reference"),e):n(i)}}const sQ={name:"labelStartImage",resolveAll:Yv.resolveAll,tokenize:iQ};function iQ(t,e,n){const r=this;return s;function s(a){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(a),t.exit("labelImageMarker"),i}function i(a){return a===91?(t.enter("labelMarker"),t.consume(a),t.exit("labelMarker"),t.exit("labelImage"),o):n(a)}function o(a){return a===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(a):e(a)}}const oQ={name:"labelStartLink",resolveAll:Yv.resolveAll,tokenize:aQ};function aQ(t,e,n){const r=this;return s;function s(o){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(o),t.exit("labelMarker"),t.exit("labelLink"),i}function i(o){return o===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(o):e(o)}}const Iy={name:"lineEnding",tokenize:lQ};function lQ(t,e){return n;function n(r){return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),Bn(t,e,"linePrefix")}}const Sp={name:"thematicBreak",tokenize:cQ};function cQ(t,e,n){let r=0,s;return i;function i(u){return t.enter("thematicBreak"),o(u)}function o(u){return s=u,a(u)}function a(u){return u===s?(t.enter("thematicBreakSequence"),l(u)):r>=3&&(u===null||tn(u))?(t.exit("thematicBreak"),e(u)):n(u)}function l(u){return u===s?(t.consume(u),r++,l):(t.exit("thematicBreakSequence"),Cn(u)?Bn(t,a,"whitespace")(u):a(u))}}const Ns={continuation:{tokenize:hQ},exit:mQ,name:"list",tokenize:fQ},uQ={partial:!0,tokenize:gQ},dQ={partial:!0,tokenize:pQ};function fQ(t,e,n){const r=this,s=r.events[r.events.length-1];let i=s&&s[1].type==="linePrefix"?s[2].sliceSerialize(s[1],!0).length:0,o=0;return a;function a(p){const m=r.containerState.type||(p===42||p===43||p===45?"listUnordered":"listOrdered");if(m==="listUnordered"?!r.containerState.marker||p===r.containerState.marker:cb(p)){if(r.containerState.type||(r.containerState.type=m,t.enter(m,{_container:!0})),m==="listUnordered")return t.enter("listItemPrefix"),p===42||p===45?t.check(Sp,n,u)(p):u(p);if(!r.interrupt||p===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),l(p)}return n(p)}function l(p){return cb(p)&&++o<10?(t.consume(p),l):(!r.interrupt||o<2)&&(r.containerState.marker?p===r.containerState.marker:p===41||p===46)?(t.exit("listItemValue"),u(p)):n(p)}function u(p){return t.enter("listItemMarker"),t.consume(p),t.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||p,t.check(Jg,r.interrupt?n:d,t.attempt(uQ,h,f))}function d(p){return r.containerState.initialBlankLine=!0,i++,h(p)}function f(p){return Cn(p)?(t.enter("listItemPrefixWhitespace"),t.consume(p),t.exit("listItemPrefixWhitespace"),h):n(p)}function h(p){return r.containerState.size=i+r.sliceSerialize(t.exit("listItemPrefix"),!0).length,e(p)}}function hQ(t,e,n){const r=this;return r.containerState._closeFlow=void 0,t.check(Jg,s,i);function s(a){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,Bn(t,e,"listItemIndent",r.containerState.size+1)(a)}function i(a){return r.containerState.furtherBlankLines||!Cn(a)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,o(a)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,t.attempt(dQ,e,o)(a))}function o(a){return r.containerState._closeFlow=!0,r.interrupt=void 0,Bn(t,t.attempt(Ns,e,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a)}}function pQ(t,e,n){const r=this;return Bn(t,s,"listItemIndent",r.containerState.size+1);function s(i){const o=r.events[r.events.length-1];return o&&o[1].type==="listItemIndent"&&o[2].sliceSerialize(o[1],!0).length===r.containerState.size?e(i):n(i)}}function mQ(t){t.exit(this.containerState.type)}function gQ(t,e,n){const r=this;return Bn(t,s,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4+1);function s(i){const o=r.events[r.events.length-1];return!Cn(i)&&o&&o[1].type==="listItemPrefixWhitespace"?e(i):n(i)}}const jC={name:"setextUnderline",resolveTo:yQ,tokenize:xQ};function yQ(t,e){let n=t.length,r,s,i;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){r=n;break}t[n][1].type==="paragraph"&&(s=n)}else t[n][1].type==="content"&&t.splice(n,1),!i&&t[n][1].type==="definition"&&(i=n);const o={type:"setextHeading",start:{...t[r][1].start},end:{...t[t.length-1][1].end}};return t[s][1].type="setextHeadingText",i?(t.splice(s,0,["enter",o,e]),t.splice(i+1,0,["exit",t[r][1],e]),t[r][1].end={...t[i][1].end}):t[r][1]=o,t.push(["exit",o,e]),t}function xQ(t,e,n){const r=this;let s;return i;function i(u){let d=r.events.length,f;for(;d--;)if(r.events[d][1].type!=="lineEnding"&&r.events[d][1].type!=="linePrefix"&&r.events[d][1].type!=="content"){f=r.events[d][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||f)?(t.enter("setextHeadingLine"),s=u,o(u)):n(u)}function o(u){return t.enter("setextHeadingLineSequence"),a(u)}function a(u){return u===s?(t.consume(u),a):(t.exit("setextHeadingLineSequence"),Cn(u)?Bn(t,l,"lineSuffix")(u):l(u))}function l(u){return u===null||tn(u)?(t.exit("setextHeadingLine"),e(u)):n(u)}}const bQ={tokenize:wQ};function wQ(t){const e=this,n=t.attempt(Jg,r,t.attempt(this.parser.constructs.flowInitial,s,Bn(t,t.attempt(this.parser.constructs.flow,s,t.attempt(TX,s)),"linePrefix")));return n;function r(i){if(i===null){t.consume(i);return}return t.enter("lineEndingBlank"),t.consume(i),t.exit("lineEndingBlank"),e.currentConstruct=void 0,n}function s(i){if(i===null){t.consume(i);return}return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),e.currentConstruct=void 0,n}}const vQ={resolveAll:oR()},kQ=iR("string"),SQ=iR("text");function iR(t){return{resolveAll:oR(t==="text"?_Q:void 0),tokenize:e};function e(n){const r=this,s=this.parser.constructs[t],i=n.attempt(s,o,a);return o;function o(d){return u(d)?i(d):a(d)}function a(d){if(d===null){n.consume(d);return}return n.enter("data"),n.consume(d),l}function l(d){return u(d)?(n.exit("data"),i(d)):(n.consume(d),l)}function u(d){if(d===null)return!0;const f=s[d];let h=-1;if(f)for(;++h<f.length;){const p=f[h];if(!p.previous||p.previous.call(r,r.previous))return!0}return!1}}}function oR(t){return e;function e(n,r){let s=-1,i;for(;++s<=n.length;)i===void 0?n[s]&&n[s][1].type==="data"&&(i=s,s++):(!n[s]||n[s][1].type!=="data")&&(s!==i+2&&(n[i][1].end=n[s-1][1].end,n.splice(i+2,s-i-2),s=i+2),i=void 0);return t?t(n,r):n}}function _Q(t,e){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const r=t[n-1][1],s=e.sliceStream(r);let i=s.length,o=-1,a=0,l;for(;i--;){const u=s[i];if(typeof u=="string"){for(o=u.length;u.charCodeAt(o-1)===32;)a++,o--;if(o)break;o=-1}else if(u===-2)l=!0,a++;else if(u!==-1){i++;break}}if(e._contentTypeTextTrailing&&n===t.length&&(a=0),a){const u={type:n===t.length||l||a<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:i?o:r.start._bufferIndex+o,_index:r.start._index+i,line:r.end.line,column:r.end.column-a,offset:r.end.offset-a},end:{...r.end}};r.end={...u.start},r.start.offset===r.end.offset?Object.assign(r,u):(t.splice(n,0,["enter",u,e],["exit",u,e]),n+=2)}n++}return t}const TQ={42:Ns,43:Ns,45:Ns,48:Ns,49:Ns,50:Ns,51:Ns,52:Ns,53:Ns,54:Ns,55:Ns,56:Ns,57:Ns,62:Q5},CQ={91:IX},EQ={[-2]:jy,[-1]:jy,32:jy},NQ={35:PX,42:Sp,45:[jC,Sp],60:FX,61:jC,95:Sp,96:EC,126:EC},jQ={38:eR,92:Z5},IQ={[-5]:Iy,[-4]:Iy,[-3]:Iy,33:sQ,38:eR,42:ub,60:[oX,GX],91:oQ,92:[RX,Z5],93:Yv,95:ub,96:bX},DQ={null:[ub,vQ]},AQ={null:[42,95]},MQ={null:[]},RQ=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:AQ,contentInitial:CQ,disable:MQ,document:TQ,flow:NQ,flowInitial:EQ,insideSpan:DQ,string:jQ,text:IQ},Symbol.toStringTag,{value:"Module"}));function OQ(t,e,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const s={},i=[];let o=[],a=[];const l={attempt:R(I),check:R(k),consume:v,enter:w,exit:S,interrupt:R(k,{interrupt:!0})},u={code:null,containerState:{},defineSkip:y,events:[],now:m,parser:t,previous:null,sliceSerialize:h,sliceStream:p,write:f};let d=e.tokenize.call(u,l);return e.resolveAll&&i.push(e),u;function f(N){return o=pi(o,N),x(),o[o.length-1]!==null?[]:(C(e,0),u.events=Jv(i,u.events,u),u.events)}function h(N,j){return LQ(p(N),j)}function p(N){return PQ(o,N)}function m(){const{_bufferIndex:N,_index:j,line:O,column:P,offset:G}=r;return{_bufferIndex:N,_index:j,line:O,column:P,offset:G}}function y(N){s[N.line]=N.column,_()}function x(){let N;for(;r._index<o.length;){const j=o[r._index];if(typeof j=="string")for(N=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===N&&r._bufferIndex<j.length;)g(j.charCodeAt(r._bufferIndex));else g(j)}}function g(N){d=d(N)}function v(N){tn(N)?(r.line++,r.column=1,r.offset+=N===-3?2:1,_()):N!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===o[r._index].length&&(r._bufferIndex=-1,r._index++)),u.previous=N}function w(N,j){const O=j||{};return O.type=N,O.start=m(),u.events.push(["enter",O,u]),a.push(O),O}function S(N){const j=a.pop();return j.end=m(),u.events.push(["exit",j,u]),j}function I(N,j){C(N,j.from)}function k(N,j){j.restore()}function R(N,j){return O;function O(P,G,A){let M,Q,X,D;return Array.isArray(P)?xe(P):"tokenize"in P?xe([P]):Te(P);function Te(Be){return st;function st(ae){const Z=ae!==null&&Be[ae],K=ae!==null&&Be.null,de=[...Array.isArray(Z)?Z:Z?[Z]:[],...Array.isArray(K)?K:K?[K]:[]];return xe(de)(ae)}}function xe(Be){return M=Be,Q=0,Be.length===0?A:U(Be[Q])}function U(Be){return st;function st(ae){return D=T(),X=Be,Be.partial||(u.currentConstruct=Be),Be.name&&u.parser.constructs.disable.null.includes(Be.name)?ie():Be.tokenize.call(j?Object.assign(Object.create(u),j):u,l,z,ie)(ae)}}function z(Be){return N(X,D),G}function ie(Be){return D.restore(),++Q<M.length?U(M[Q]):A}}}function C(N,j){N.resolveAll&&!i.includes(N)&&i.push(N),N.resolve&&bo(u.events,j,u.events.length-j,N.resolve(u.events.slice(j),u)),N.resolveTo&&(u.events=N.resolveTo(u.events,u))}function T(){const N=m(),j=u.previous,O=u.currentConstruct,P=u.events.length,G=Array.from(a);return{from:P,restore:A};function A(){r=N,u.previous=j,u.currentConstruct=O,u.events.length=P,a=G,_()}}function _(){r.line in s&&r.column<2&&(r.column=s[r.line],r.offset+=s[r.line]-1)}}function PQ(t,e){const n=e.start._index,r=e.start._bufferIndex,s=e.end._index,i=e.end._bufferIndex;let o;if(n===s)o=[t[n].slice(r,i)];else{if(o=t.slice(n,s),r>-1){const a=o[0];typeof a=="string"?o[0]=a.slice(r):o.shift()}i>0&&o.push(t[s].slice(0,i))}return o}function LQ(t,e){let n=-1;const r=[];let s;for(;++n<t.length;){const i=t[n];let o;if(typeof i=="string")o=i;else switch(i){case-5:{o="\r";break}case-4:{o=`
`;break}case-3:{o=`\r
`;break}case-2:{o=e?" ":"	";break}case-1:{if(!e&&s)continue;o=" ";break}default:o=String.fromCharCode(i)}s=i===-2,r.push(o)}return r.join("")}function $Q(t){const r={constructs:WY([RQ,...(t||{}).extensions||[]]),content:s(ZY),defined:[],document:s(tX),flow:s(bQ),lazy:{},string:s(kQ),text:s(SQ)};return r;function s(i){return o;function o(a){return OQ(r,i,a)}}}function zQ(t){for(;!tR(t););return t}const IC=/[\0\t\n\r]/g;function FQ(){let t=1,e="",n=!0,r;return s;function s(i,o,a){const l=[];let u,d,f,h,p;for(i=e+(typeof i=="string"?i.toString():new TextDecoder(o||void 0).decode(i)),f=0,e="",n&&(i.charCodeAt(0)===65279&&f++,n=void 0);f<i.length;){if(IC.lastIndex=f,u=IC.exec(i),h=u&&u.index!==void 0?u.index:i.length,p=i.charCodeAt(h),!u){e=i.slice(f);break}if(p===10&&f===h&&r)l.push(-3),r=void 0;else switch(r&&(l.push(-5),r=void 0),f<h&&(l.push(i.slice(f,h)),t+=h-f),p){case 0:{l.push(65533),t++;break}case 9:{for(d=Math.ceil(t/4)*4,l.push(-2);t++<d;)l.push(-1);break}case 10:{l.push(-4),t=1;break}default:r=!0,t=1}f=h+1}return a&&(r&&l.push(-5),e&&l.push(e),l.push(null)),l}}const BQ=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function UQ(t){return t.replace(BQ,HQ)}function HQ(t,e,n){if(e)return e;if(n.charCodeAt(0)===35){const s=n.charCodeAt(1),i=s===120||s===88;return X5(n.slice(i?2:1),i?16:10)}return qv(n)||t}const aR={}.hasOwnProperty;function VQ(t,e,n){return typeof e!="string"&&(n=e,e=void 0),WQ(n)(zQ($Q(n).document().write(FQ()(t,e,!0))))}function WQ(t){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:i(re),autolinkProtocol:T,autolinkEmail:T,atxHeading:i(ve),blockQuote:i(K),characterEscape:T,characterReference:T,codeFenced:i(de),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:i(de,o),codeText:i(ce,o),codeTextData:T,data:T,codeFlowValue:T,definition:i(ke),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:i(_e),hardBreakEscape:i(Ke),hardBreakTrailing:i(Ke),htmlFlow:i(je,o),htmlFlowData:T,htmlText:i(je,o),htmlTextData:T,image:i(V),label:o,link:i(re),listItem:i(ne),listItemValue:h,listOrdered:i(se,f),listUnordered:i(se),paragraph:i(pe),reference:U,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:i(ve),strong:i(ee),thematicBreak:i(Pe)},exit:{atxHeading:l(),atxHeadingSequence:I,autolink:l(),autolinkEmail:Z,autolinkProtocol:ae,blockQuote:l(),characterEscapeValue:_,characterReferenceMarkerHexadecimal:ie,characterReferenceMarkerNumeric:ie,characterReferenceValue:Be,characterReference:st,codeFenced:l(x),codeFencedFence:y,codeFencedFenceInfo:p,codeFencedFenceMeta:m,codeFlowValue:_,codeIndented:l(g),codeText:l(G),codeTextData:_,data:_,definition:l(),definitionDestinationString:S,definitionLabelString:v,definitionTitleString:w,emphasis:l(),hardBreakEscape:l(j),hardBreakTrailing:l(j),htmlFlow:l(O),htmlFlowData:_,htmlText:l(P),htmlTextData:_,image:l(M),label:X,labelText:Q,lineEnding:N,link:l(A),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:z,resourceDestinationString:D,resourceTitleString:Te,resource:xe,setextHeading:l(C),setextHeadingLineSequence:R,setextHeadingText:k,strong:l(),thematicBreak:l()}};lR(e,(t||{}).mdastExtensions||[]);const n={};return r;function r(me){let Me={type:"root",children:[]};const qe={stack:[Me],tokenStack:[],config:e,enter:a,exit:u,buffer:o,resume:d,data:n},ht=[];let wt=-1;for(;++wt<me.length;)if(me[wt][1].type==="listOrdered"||me[wt][1].type==="listUnordered")if(me[wt][0]==="enter")ht.push(wt);else{const ge=ht.pop();wt=s(me,ge,wt)}for(wt=-1;++wt<me.length;){const ge=e[me[wt][0]];aR.call(ge,me[wt][1].type)&&ge[me[wt][1].type].call(Object.assign({sliceSerialize:me[wt][2].sliceSerialize},qe),me[wt][1])}if(qe.tokenStack.length>0){const ge=qe.tokenStack[qe.tokenStack.length-1];(ge[1]||DC).call(qe,void 0,ge[0])}for(Me.position={start:na(me.length>0?me[0][1].start:{line:1,column:1,offset:0}),end:na(me.length>0?me[me.length-2][1].end:{line:1,column:1,offset:0})},wt=-1;++wt<e.transforms.length;)Me=e.transforms[wt](Me)||Me;return Me}function s(me,Me,qe){let ht=Me-1,wt=-1,ge=!1,Le,Ue,De,Qe;for(;++ht<=qe;){const pt=me[ht];switch(pt[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{pt[0]==="enter"?wt++:wt--,Qe=void 0;break}case"lineEndingBlank":{pt[0]==="enter"&&(Le&&!Qe&&!wt&&!De&&(De=ht),Qe=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Qe=void 0}if(!wt&&pt[0]==="enter"&&pt[1].type==="listItemPrefix"||wt===-1&&pt[0]==="exit"&&(pt[1].type==="listUnordered"||pt[1].type==="listOrdered")){if(Le){let nt=ht;for(Ue=void 0;nt--;){const ut=me[nt];if(ut[1].type==="lineEnding"||ut[1].type==="lineEndingBlank"){if(ut[0]==="exit")continue;Ue&&(me[Ue][1].type="lineEndingBlank",ge=!0),ut[1].type="lineEnding",Ue=nt}else if(!(ut[1].type==="linePrefix"||ut[1].type==="blockQuotePrefix"||ut[1].type==="blockQuotePrefixWhitespace"||ut[1].type==="blockQuoteMarker"||ut[1].type==="listItemIndent"))break}De&&(!Ue||De<Ue)&&(Le._spread=!0),Le.end=Object.assign({},Ue?me[Ue][1].start:pt[1].end),me.splice(Ue||ht,0,["exit",Le,pt[2]]),ht++,qe++}if(pt[1].type==="listItemPrefix"){const nt={type:"listItem",_spread:!1,start:Object.assign({},pt[1].start),end:void 0};Le=nt,me.splice(ht,0,["enter",nt,pt[2]]),ht++,qe++,De=void 0,Qe=!0}}}return me[Me][1]._spread=ge,qe}function i(me,Me){return qe;function qe(ht){a.call(this,me(ht),ht),Me&&Me.call(this,ht)}}function o(){this.stack.push({type:"fragment",children:[]})}function a(me,Me,qe){this.stack[this.stack.length-1].children.push(me),this.stack.push(me),this.tokenStack.push([Me,qe||void 0]),me.position={start:na(Me.start),end:void 0}}function l(me){return Me;function Me(qe){me&&me.call(this,qe),u.call(this,qe)}}function u(me,Me){const qe=this.stack.pop(),ht=this.tokenStack.pop();if(ht)ht[0].type!==me.type&&(Me?Me.call(this,me,ht[0]):(ht[1]||DC).call(this,me,ht[0]));else throw new Error("Cannot close `"+me.type+"` ("+Fd({start:me.start,end:me.end})+"): its not open");qe.position.end=na(me.end)}function d(){return HY(this.stack.pop())}function f(){this.data.expectingFirstListItemValue=!0}function h(me){if(this.data.expectingFirstListItemValue){const Me=this.stack[this.stack.length-2];Me.start=Number.parseInt(this.sliceSerialize(me),10),this.data.expectingFirstListItemValue=void 0}}function p(){const me=this.resume(),Me=this.stack[this.stack.length-1];Me.lang=me}function m(){const me=this.resume(),Me=this.stack[this.stack.length-1];Me.meta=me}function y(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function x(){const me=this.resume(),Me=this.stack[this.stack.length-1];Me.value=me.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function g(){const me=this.resume(),Me=this.stack[this.stack.length-1];Me.value=me.replace(/(\r?\n|\r)$/g,"")}function v(me){const Me=this.resume(),qe=this.stack[this.stack.length-1];qe.label=Me,qe.identifier=lu(this.sliceSerialize(me)).toLowerCase()}function w(){const me=this.resume(),Me=this.stack[this.stack.length-1];Me.title=me}function S(){const me=this.resume(),Me=this.stack[this.stack.length-1];Me.url=me}function I(me){const Me=this.stack[this.stack.length-1];if(!Me.depth){const qe=this.sliceSerialize(me).length;Me.depth=qe}}function k(){this.data.setextHeadingSlurpLineEnding=!0}function R(me){const Me=this.stack[this.stack.length-1];Me.depth=this.sliceSerialize(me).codePointAt(0)===61?1:2}function C(){this.data.setextHeadingSlurpLineEnding=void 0}function T(me){const qe=this.stack[this.stack.length-1].children;let ht=qe[qe.length-1];(!ht||ht.type!=="text")&&(ht=ye(),ht.position={start:na(me.start),end:void 0},qe.push(ht)),this.stack.push(ht)}function _(me){const Me=this.stack.pop();Me.value+=this.sliceSerialize(me),Me.position.end=na(me.end)}function N(me){const Me=this.stack[this.stack.length-1];if(this.data.atHardBreak){const qe=Me.children[Me.children.length-1];qe.position.end=na(me.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(Me.type)&&(T.call(this,me),_.call(this,me))}function j(){this.data.atHardBreak=!0}function O(){const me=this.resume(),Me=this.stack[this.stack.length-1];Me.value=me}function P(){const me=this.resume(),Me=this.stack[this.stack.length-1];Me.value=me}function G(){const me=this.resume(),Me=this.stack[this.stack.length-1];Me.value=me}function A(){const me=this.stack[this.stack.length-1];if(this.data.inReference){const Me=this.data.referenceType||"shortcut";me.type+="Reference",me.referenceType=Me,delete me.url,delete me.title}else delete me.identifier,delete me.label;this.data.referenceType=void 0}function M(){const me=this.stack[this.stack.length-1];if(this.data.inReference){const Me=this.data.referenceType||"shortcut";me.type+="Reference",me.referenceType=Me,delete me.url,delete me.title}else delete me.identifier,delete me.label;this.data.referenceType=void 0}function Q(me){const Me=this.sliceSerialize(me),qe=this.stack[this.stack.length-2];qe.label=UQ(Me),qe.identifier=lu(Me).toLowerCase()}function X(){const me=this.stack[this.stack.length-1],Me=this.resume(),qe=this.stack[this.stack.length-1];if(this.data.inReference=!0,qe.type==="link"){const ht=me.children;qe.children=ht}else qe.alt=Me}function D(){const me=this.resume(),Me=this.stack[this.stack.length-1];Me.url=me}function Te(){const me=this.resume(),Me=this.stack[this.stack.length-1];Me.title=me}function xe(){this.data.inReference=void 0}function U(){this.data.referenceType="collapsed"}function z(me){const Me=this.resume(),qe=this.stack[this.stack.length-1];qe.label=Me,qe.identifier=lu(this.sliceSerialize(me)).toLowerCase(),this.data.referenceType="full"}function ie(me){this.data.characterReferenceType=me.type}function Be(me){const Me=this.sliceSerialize(me),qe=this.data.characterReferenceType;let ht;qe?(ht=X5(Me,qe==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):ht=qv(Me);const wt=this.stack[this.stack.length-1];wt.value+=ht}function st(me){const Me=this.stack.pop();Me.position.end=na(me.end)}function ae(me){_.call(this,me);const Me=this.stack[this.stack.length-1];Me.url=this.sliceSerialize(me)}function Z(me){_.call(this,me);const Me=this.stack[this.stack.length-1];Me.url="mailto:"+this.sliceSerialize(me)}function K(){return{type:"blockquote",children:[]}}function de(){return{type:"code",lang:null,meta:null,value:""}}function ce(){return{type:"inlineCode",value:""}}function ke(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function _e(){return{type:"emphasis",children:[]}}function ve(){return{type:"heading",depth:0,children:[]}}function Ke(){return{type:"break"}}function je(){return{type:"html",value:""}}function V(){return{type:"image",title:null,url:"",alt:null}}function re(){return{type:"link",title:null,url:"",children:[]}}function se(me){return{type:"list",ordered:me.type==="listOrdered",start:null,spread:me._spread,children:[]}}function ne(me){return{type:"listItem",spread:me._spread,checked:null,children:[]}}function pe(){return{type:"paragraph",children:[]}}function ee(){return{type:"strong",children:[]}}function ye(){return{type:"text",value:""}}function Pe(){return{type:"thematicBreak"}}}function na(t){return{line:t.line,column:t.column,offset:t.offset}}function lR(t,e){let n=-1;for(;++n<e.length;){const r=e[n];Array.isArray(r)?lR(t,r):KQ(t,r)}}function KQ(t,e){let n;for(n in e)if(aR.call(e,n))switch(n){case"canContainEols":{const r=e[n];r&&t[n].push(...r);break}case"transforms":{const r=e[n];r&&t[n].push(...r);break}case"enter":case"exit":{const r=e[n];r&&Object.assign(t[n],r);break}}}function DC(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+Fd({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+Fd({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+Fd({start:e.start,end:e.end})+") is still open")}function GQ(t){const e=this;e.parser=n;function n(r){return VQ(r,{...e.data("settings"),...t,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function qQ(t,e){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(e),!0)};return t.patch(e,n),t.applyData(e,n)}function JQ(t,e){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(e,n),[t.applyData(e,n),{type:"text",value:`
`}]}function YQ(t,e){const n=e.value?e.value+`
`:"",r={},s=e.lang?e.lang.split(/\s+/):[];s.length>0&&(r.className=["language-"+s[0]]);let i={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]};return e.meta&&(i.data={meta:e.meta}),t.patch(e,i),i=t.applyData(e,i),i={type:"element",tagName:"pre",properties:{},children:[i]},t.patch(e,i),i}function XQ(t,e){const n={type:"element",tagName:"del",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function QQ(t,e){const n={type:"element",tagName:"em",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function ZQ(t,e){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",r=String(e.identifier).toUpperCase(),s=$u(r.toLowerCase()),i=t.footnoteOrder.indexOf(r);let o,a=t.footnoteCounts.get(r);a===void 0?(a=0,t.footnoteOrder.push(r),o=t.footnoteOrder.length):o=i+1,a+=1,t.footnoteCounts.set(r,a);const l={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+s,id:n+"fnref-"+s+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};t.patch(e,l);const u={type:"element",tagName:"sup",properties:{},children:[l]};return t.patch(e,u),t.applyData(e,u)}function eZ(t,e){const n={type:"element",tagName:"h"+e.depth,properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function tZ(t,e){if(t.options.allowDangerousHtml){const n={type:"raw",value:e.value};return t.patch(e,n),t.applyData(e,n)}}function cR(t,e){const n=e.referenceType;let r="]";if(n==="collapsed"?r+="[]":n==="full"&&(r+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+r}];const s=t.all(e),i=s[0];i&&i.type==="text"?i.value="["+i.value:s.unshift({type:"text",value:"["});const o=s[s.length-1];return o&&o.type==="text"?o.value+=r:s.push({type:"text",value:r}),s}function nZ(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return cR(t,e);const s={src:$u(r.url||""),alt:e.alt};r.title!==null&&r.title!==void 0&&(s.title=r.title);const i={type:"element",tagName:"img",properties:s,children:[]};return t.patch(e,i),t.applyData(e,i)}function rZ(t,e){const n={src:$u(e.url)};e.alt!==null&&e.alt!==void 0&&(n.alt=e.alt),e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"img",properties:n,children:[]};return t.patch(e,r),t.applyData(e,r)}function sZ(t,e){const n={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};t.patch(e,n);const r={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(e,r),t.applyData(e,r)}function iZ(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return cR(t,e);const s={href:$u(r.url||"")};r.title!==null&&r.title!==void 0&&(s.title=r.title);const i={type:"element",tagName:"a",properties:s,children:t.all(e)};return t.patch(e,i),t.applyData(e,i)}function oZ(t,e){const n={href:$u(e.url)};e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"a",properties:n,children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function aZ(t,e,n){const r=t.all(e),s=n?lZ(n):uR(e),i={},o=[];if(typeof e.checked=="boolean"){const d=r[0];let f;d&&d.type==="element"&&d.tagName==="p"?f=d:(f={type:"element",tagName:"p",properties:{},children:[]},r.unshift(f)),f.children.length>0&&f.children.unshift({type:"text",value:" "}),f.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),i.className=["task-list-item"]}let a=-1;for(;++a<r.length;){const d=r[a];(s||a!==0||d.type!=="element"||d.tagName!=="p")&&o.push({type:"text",value:`
`}),d.type==="element"&&d.tagName==="p"&&!s?o.push(...d.children):o.push(d)}const l=r[r.length-1];l&&(s||l.type!=="element"||l.tagName!=="p")&&o.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:i,children:o};return t.patch(e,u),t.applyData(e,u)}function lZ(t){let e=!1;if(t.type==="list"){e=t.spread||!1;const n=t.children;let r=-1;for(;!e&&++r<n.length;)e=uR(n[r])}return e}function uR(t){const e=t.spread;return e??t.children.length>1}function cZ(t,e){const n={},r=t.all(e);let s=-1;for(typeof e.start=="number"&&e.start!==1&&(n.start=e.start);++s<r.length;){const o=r[s];if(o.type==="element"&&o.tagName==="li"&&o.properties&&Array.isArray(o.properties.className)&&o.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const i={type:"element",tagName:e.ordered?"ol":"ul",properties:n,children:t.wrap(r,!0)};return t.patch(e,i),t.applyData(e,i)}function uZ(t,e){const n={type:"element",tagName:"p",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function dZ(t,e){const n={type:"root",children:t.wrap(t.all(e))};return t.patch(e,n),t.applyData(e,n)}function fZ(t,e){const n={type:"element",tagName:"strong",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function hZ(t,e){const n=t.all(e),r=n.shift(),s=[];if(r){const o={type:"element",tagName:"thead",properties:{},children:t.wrap([r],!0)};t.patch(e.children[0],o),s.push(o)}if(n.length>0){const o={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},a=Vv(e.children[1]),l=V5(e.children[e.children.length-1]);a&&l&&(o.position={start:a,end:l}),s.push(o)}const i={type:"element",tagName:"table",properties:{},children:t.wrap(s,!0)};return t.patch(e,i),t.applyData(e,i)}function pZ(t,e,n){const r=n?n.children:void 0,i=(r?r.indexOf(e):1)===0?"th":"td",o=n&&n.type==="table"?n.align:void 0,a=o?o.length:e.children.length;let l=-1;const u=[];for(;++l<a;){const f=e.children[l],h={},p=o?o[l]:void 0;p&&(h.align=p);let m={type:"element",tagName:i,properties:h,children:[]};f&&(m.children=t.all(f),t.patch(f,m),m=t.applyData(f,m)),u.push(m)}const d={type:"element",tagName:"tr",properties:{},children:t.wrap(u,!0)};return t.patch(e,d),t.applyData(e,d)}function mZ(t,e){const n={type:"element",tagName:"td",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}const AC=9,MC=32;function gZ(t){const e=String(t),n=/\r?\n|\r/g;let r=n.exec(e),s=0;const i=[];for(;r;)i.push(RC(e.slice(s,r.index),s>0,!0),r[0]),s=r.index+r[0].length,r=n.exec(e);return i.push(RC(e.slice(s),s>0,!1)),i.join("")}function RC(t,e,n){let r=0,s=t.length;if(e){let i=t.codePointAt(r);for(;i===AC||i===MC;)r++,i=t.codePointAt(r)}if(n){let i=t.codePointAt(s-1);for(;i===AC||i===MC;)s--,i=t.codePointAt(s-1)}return s>r?t.slice(r,s):""}function yZ(t,e){const n={type:"text",value:gZ(String(e.value))};return t.patch(e,n),t.applyData(e,n)}function xZ(t,e){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(e,n),t.applyData(e,n)}const bZ={blockquote:qQ,break:JQ,code:YQ,delete:XQ,emphasis:QQ,footnoteReference:ZQ,heading:eZ,html:tZ,imageReference:nZ,image:rZ,inlineCode:sZ,linkReference:iZ,link:oZ,listItem:aZ,list:cZ,paragraph:uZ,root:dZ,strong:fZ,table:hZ,tableCell:mZ,tableRow:pZ,text:yZ,thematicBreak:xZ,toml:Bh,yaml:Bh,definition:Bh,footnoteDefinition:Bh};function Bh(){}const dR=-1,Yg=0,Ud=1,eg=2,Xv=3,Qv=4,Zv=5,ek=6,fR=7,hR=8,OC=typeof self=="object"?self:globalThis,wZ=(t,e)=>{const n=(s,i)=>(t.set(i,s),s),r=s=>{if(t.has(s))return t.get(s);const[i,o]=e[s];switch(i){case Yg:case dR:return n(o,s);case Ud:{const a=n([],s);for(const l of o)a.push(r(l));return a}case eg:{const a=n({},s);for(const[l,u]of o)a[r(l)]=r(u);return a}case Xv:return n(new Date(o),s);case Qv:{const{source:a,flags:l}=o;return n(new RegExp(a,l),s)}case Zv:{const a=n(new Map,s);for(const[l,u]of o)a.set(r(l),r(u));return a}case ek:{const a=n(new Set,s);for(const l of o)a.add(r(l));return a}case fR:{const{name:a,message:l}=o;return n(new OC[a](l),s)}case hR:return n(BigInt(o),s);case"BigInt":return n(Object(BigInt(o)),s);case"ArrayBuffer":return n(new Uint8Array(o).buffer,o);case"DataView":{const{buffer:a}=new Uint8Array(o);return n(new DataView(a),o)}}return n(new OC[i](o),s)};return r},PC=t=>wZ(new Map,t)(0),xc="",{toString:vZ}={},{keys:kZ}=Object,ed=t=>{const e=typeof t;if(e!=="object"||!t)return[Yg,e];const n=vZ.call(t).slice(8,-1);switch(n){case"Array":return[Ud,xc];case"Object":return[eg,xc];case"Date":return[Xv,xc];case"RegExp":return[Qv,xc];case"Map":return[Zv,xc];case"Set":return[ek,xc];case"DataView":return[Ud,n]}return n.includes("Array")?[Ud,n]:n.includes("Error")?[fR,n]:[eg,n]},Uh=([t,e])=>t===Yg&&(e==="function"||e==="symbol"),SZ=(t,e,n,r)=>{const s=(o,a)=>{const l=r.push(o)-1;return n.set(a,l),l},i=o=>{if(n.has(o))return n.get(o);let[a,l]=ed(o);switch(a){case Yg:{let d=o;switch(l){case"bigint":a=hR,d=o.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+l);d=null;break;case"undefined":return s([dR],o)}return s([a,d],o)}case Ud:{if(l){let h=o;return l==="DataView"?h=new Uint8Array(o.buffer):l==="ArrayBuffer"&&(h=new Uint8Array(o)),s([l,[...h]],o)}const d=[],f=s([a,d],o);for(const h of o)d.push(i(h));return f}case eg:{if(l)switch(l){case"BigInt":return s([l,o.toString()],o);case"Boolean":case"Number":case"String":return s([l,o.valueOf()],o)}if(e&&"toJSON"in o)return i(o.toJSON());const d=[],f=s([a,d],o);for(const h of kZ(o))(t||!Uh(ed(o[h])))&&d.push([i(h),i(o[h])]);return f}case Xv:return s([a,o.toISOString()],o);case Qv:{const{source:d,flags:f}=o;return s([a,{source:d,flags:f}],o)}case Zv:{const d=[],f=s([a,d],o);for(const[h,p]of o)(t||!(Uh(ed(h))||Uh(ed(p))))&&d.push([i(h),i(p)]);return f}case ek:{const d=[],f=s([a,d],o);for(const h of o)(t||!Uh(ed(h)))&&d.push(i(h));return f}}const{message:u}=o;return s([a,{name:l,message:u}],o)};return i},LC=(t,{json:e,lossy:n}={})=>{const r=[];return SZ(!(e||n),!!e,new Map,r)(t),r},tg=typeof structuredClone=="function"?(t,e)=>e&&("json"in e||"lossy"in e)?PC(LC(t,e)):structuredClone(t):(t,e)=>PC(LC(t,e));function _Z(t,e){const n=[{type:"text",value:""}];return e>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),n}function TZ(t,e){return"Back to reference "+(t+1)+(e>1?"-"+e:"")}function CZ(t){const e=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||_Z,r=t.options.footnoteBackLabel||TZ,s=t.options.footnoteLabel||"Footnotes",i=t.options.footnoteLabelTagName||"h2",o=t.options.footnoteLabelProperties||{className:["sr-only"]},a=[];let l=-1;for(;++l<t.footnoteOrder.length;){const u=t.footnoteById.get(t.footnoteOrder[l]);if(!u)continue;const d=t.all(u),f=String(u.identifier).toUpperCase(),h=$u(f.toLowerCase());let p=0;const m=[],y=t.footnoteCounts.get(f);for(;y!==void 0&&++p<=y;){m.length>0&&m.push({type:"text",value:" "});let v=typeof n=="string"?n:n(l,p);typeof v=="string"&&(v={type:"text",value:v}),m.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+h+(p>1?"-"+p:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(l,p),className:["data-footnote-backref"]},children:Array.isArray(v)?v:[v]})}const x=d[d.length-1];if(x&&x.type==="element"&&x.tagName==="p"){const v=x.children[x.children.length-1];v&&v.type==="text"?v.value+=" ":x.children.push({type:"text",value:" "}),x.children.push(...m)}else d.push(...m);const g={type:"element",tagName:"li",properties:{id:e+"fn-"+h},children:t.wrap(d,!0)};t.patch(u,g),a.push(g)}if(a.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:i,properties:{...tg(o),id:"footnote-label"},children:[{type:"text",value:s}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(a,!0)},{type:"text",value:`
`}]}}const pR=function(t){if(t==null)return IZ;if(typeof t=="function")return Xg(t);if(typeof t=="object")return Array.isArray(t)?EZ(t):NZ(t);if(typeof t=="string")return jZ(t);throw new Error("Expected function, string, or object as test")};function EZ(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=pR(t[n]);return Xg(r);function r(...s){let i=-1;for(;++i<e.length;)if(e[i].apply(this,s))return!0;return!1}}function NZ(t){const e=t;return Xg(n);function n(r){const s=r;let i;for(i in t)if(s[i]!==e[i])return!1;return!0}}function jZ(t){return Xg(e);function e(n){return n&&n.type===t}}function Xg(t){return e;function e(n,r,s){return!!(DZ(n)&&t.call(this,n,typeof r=="number"?r:void 0,s||void 0))}}function IZ(){return!0}function DZ(t){return t!==null&&typeof t=="object"&&"type"in t}const mR=[],AZ=!0,$C=!1,MZ="skip";function RZ(t,e,n,r){let s;typeof e=="function"&&typeof n!="function"?(r=n,n=e):s=e;const i=pR(s),o=r?-1:1;a(t,void 0,[])();function a(l,u,d){const f=l&&typeof l=="object"?l:{};if(typeof f.type=="string"){const p=typeof f.tagName=="string"?f.tagName:typeof f.name=="string"?f.name:void 0;Object.defineProperty(h,"name",{value:"node ("+(l.type+(p?"<"+p+">":""))+")"})}return h;function h(){let p=mR,m,y,x;if((!e||i(l,u,d[d.length-1]||void 0))&&(p=OZ(n(l,d)),p[0]===$C))return p;if("children"in l&&l.children){const g=l;if(g.children&&p[0]!==MZ)for(y=(r?g.children.length:-1)+o,x=d.concat(g);y>-1&&y<g.children.length;){const v=g.children[y];if(m=a(v,y,x)(),m[0]===$C)return m;y=typeof m[1]=="number"?m[1]:y+o}}return p}}}function OZ(t){return Array.isArray(t)?t:typeof t=="number"?[AZ,t]:t==null?mR:[t]}function gR(t,e,n,r){let s,i,o;typeof e=="function"&&typeof n!="function"?(i=void 0,o=e,s=n):(i=e,o=n,s=r),RZ(t,i,a,s);function a(l,u){const d=u[u.length-1],f=d?d.children.indexOf(l):void 0;return o(l,f,d)}}const db={}.hasOwnProperty,PZ={};function LZ(t,e){const n=e||PZ,r=new Map,s=new Map,i=new Map,o={...bZ,...n.handlers},a={all:u,applyData:zZ,definitionById:r,footnoteById:s,footnoteCounts:i,footnoteOrder:[],handlers:o,one:l,options:n,patch:$Z,wrap:BZ};return gR(t,function(d){if(d.type==="definition"||d.type==="footnoteDefinition"){const f=d.type==="definition"?r:s,h=String(d.identifier).toUpperCase();f.has(h)||f.set(h,d)}}),a;function l(d,f){const h=d.type,p=a.handlers[h];if(db.call(a.handlers,h)&&p)return p(a,d,f);if(a.options.passThrough&&a.options.passThrough.includes(h)){if("children"in d){const{children:y,...x}=d,g=tg(x);return g.children=a.all(d),g}return tg(d)}return(a.options.unknownHandler||FZ)(a,d,f)}function u(d){const f=[];if("children"in d){const h=d.children;let p=-1;for(;++p<h.length;){const m=a.one(h[p],d);if(m){if(p&&h[p-1].type==="break"&&(!Array.isArray(m)&&m.type==="text"&&(m.value=zC(m.value)),!Array.isArray(m)&&m.type==="element")){const y=m.children[0];y&&y.type==="text"&&(y.value=zC(y.value))}Array.isArray(m)?f.push(...m):f.push(m)}}}return f}}function $Z(t,e){t.position&&(e.position=vY(t))}function zZ(t,e){let n=e;if(t&&t.data){const r=t.data.hName,s=t.data.hChildren,i=t.data.hProperties;if(typeof r=="string")if(n.type==="element")n.tagName=r;else{const o="children"in n?n.children:[n];n={type:"element",tagName:r,properties:{},children:o}}n.type==="element"&&i&&Object.assign(n.properties,tg(i)),"children"in n&&n.children&&s!==null&&s!==void 0&&(n.children=s)}return n}function FZ(t,e){const n=e.data||{},r="value"in e&&!(db.call(n,"hProperties")||db.call(n,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function BZ(t,e){const n=[];let r=-1;for(e&&n.push({type:"text",value:`
`});++r<t.length;)r&&n.push({type:"text",value:`
`}),n.push(t[r]);return e&&t.length>0&&n.push({type:"text",value:`
`}),n}function zC(t){let e=0,n=t.charCodeAt(e);for(;n===9||n===32;)e++,n=t.charCodeAt(e);return t.slice(e)}function FC(t,e){const n=LZ(t,e),r=n.one(t,void 0),s=CZ(n),i=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return s&&i.children.push({type:"text",value:`
`},s),i}function UZ(t,e){return t&&"run"in t?async function(n,r){const s=FC(n,{file:r,...e});await t.run(s,r)}:function(n,r){return FC(n,{file:r,...t||e})}}function BC(t){if(t)throw t}var _p=Object.prototype.hasOwnProperty,yR=Object.prototype.toString,UC=Object.defineProperty,HC=Object.getOwnPropertyDescriptor,VC=function(e){return typeof Array.isArray=="function"?Array.isArray(e):yR.call(e)==="[object Array]"},WC=function(e){if(!e||yR.call(e)!=="[object Object]")return!1;var n=_p.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&_p.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!r)return!1;var s;for(s in e);return typeof s>"u"||_p.call(e,s)},KC=function(e,n){UC&&n.name==="__proto__"?UC(e,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):e[n.name]=n.newValue},GC=function(e,n){if(n==="__proto__")if(_p.call(e,n)){if(HC)return HC(e,n).value}else return;return e[n]},HZ=function t(){var e,n,r,s,i,o,a=arguments[0],l=1,u=arguments.length,d=!1;for(typeof a=="boolean"&&(d=a,a=arguments[1]||{},l=2),(a==null||typeof a!="object"&&typeof a!="function")&&(a={});l<u;++l)if(e=arguments[l],e!=null)for(n in e)r=GC(a,n),s=GC(e,n),a!==s&&(d&&s&&(WC(s)||(i=VC(s)))?(i?(i=!1,o=r&&VC(r)?r:[]):o=r&&WC(r)?r:{},KC(a,{name:n,newValue:t(d,o,s)})):typeof s<"u"&&KC(a,{name:n,newValue:s}));return a};const Dy=sg(HZ);function fb(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function VZ(){const t=[],e={run:n,use:r};return e;function n(...s){let i=-1;const o=s.pop();if(typeof o!="function")throw new TypeError("Expected function as last argument, not "+o);a(null,...s);function a(l,...u){const d=t[++i];let f=-1;if(l){o(l);return}for(;++f<s.length;)(u[f]===null||u[f]===void 0)&&(u[f]=s[f]);s=u,d?WZ(d,a)(...u):o(null,...u)}}function r(s){if(typeof s!="function")throw new TypeError("Expected `middelware` to be a function, not "+s);return t.push(s),e}}function WZ(t,e){let n;return r;function r(...o){const a=t.length>o.length;let l;a&&o.push(s);try{l=t.apply(this,o)}catch(u){const d=u;if(a&&n)throw d;return s(d)}a||(l&&l.then&&typeof l.then=="function"?l.then(i,s):l instanceof Error?s(l):i(l))}function s(o,...a){n||(n=!0,e(o,...a))}function i(o){s(null,o)}}const ro={basename:KZ,dirname:GZ,extname:qZ,join:JZ,sep:"/"};function KZ(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');th(t);let n=0,r=-1,s=t.length,i;if(e===void 0||e.length===0||e.length>t.length){for(;s--;)if(t.codePointAt(s)===47){if(i){n=s+1;break}}else r<0&&(i=!0,r=s+1);return r<0?"":t.slice(n,r)}if(e===t)return"";let o=-1,a=e.length-1;for(;s--;)if(t.codePointAt(s)===47){if(i){n=s+1;break}}else o<0&&(i=!0,o=s+1),a>-1&&(t.codePointAt(s)===e.codePointAt(a--)?a<0&&(r=s):(a=-1,r=o));return n===r?r=o:r<0&&(r=t.length),t.slice(n,r)}function GZ(t){if(th(t),t.length===0)return".";let e=-1,n=t.length,r;for(;--n;)if(t.codePointAt(n)===47){if(r){e=n;break}}else r||(r=!0);return e<0?t.codePointAt(0)===47?"/":".":e===1&&t.codePointAt(0)===47?"//":t.slice(0,e)}function qZ(t){th(t);let e=t.length,n=-1,r=0,s=-1,i=0,o;for(;e--;){const a=t.codePointAt(e);if(a===47){if(o){r=e+1;break}continue}n<0&&(o=!0,n=e+1),a===46?s<0?s=e:i!==1&&(i=1):s>-1&&(i=-1)}return s<0||n<0||i===0||i===1&&s===n-1&&s===r+1?"":t.slice(s,n)}function JZ(...t){let e=-1,n;for(;++e<t.length;)th(t[e]),t[e]&&(n=n===void 0?t[e]:n+"/"+t[e]);return n===void 0?".":YZ(n)}function YZ(t){th(t);const e=t.codePointAt(0)===47;let n=XZ(t,!e);return n.length===0&&!e&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),e?"/"+n:n}function XZ(t,e){let n="",r=0,s=-1,i=0,o=-1,a,l;for(;++o<=t.length;){if(o<t.length)a=t.codePointAt(o);else{if(a===47)break;a=47}if(a===47){if(!(s===o-1||i===1))if(s!==o-1&&i===2){if(n.length<2||r!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(l=n.lastIndexOf("/"),l!==n.length-1){l<0?(n="",r=0):(n=n.slice(0,l),r=n.length-1-n.lastIndexOf("/")),s=o,i=0;continue}}else if(n.length>0){n="",r=0,s=o,i=0;continue}}e&&(n=n.length>0?n+"/..":"..",r=2)}else n.length>0?n+="/"+t.slice(s+1,o):n=t.slice(s+1,o),r=o-s-1;s=o,i=0}else a===46&&i>-1?i++:i=-1}return n}function th(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const QZ={cwd:ZZ};function ZZ(){return"/"}function hb(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function eee(t){if(typeof t=="string")t=new URL(t);else if(!hb(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(t.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return tee(t)}function tee(t){if(t.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=t.pathname;let n=-1;for(;++n<e.length;)if(e.codePointAt(n)===37&&e.codePointAt(n+1)===50){const r=e.codePointAt(n+2);if(r===70||r===102){const s=new TypeError("File URL path must not include encoded / characters");throw s.code="ERR_INVALID_FILE_URL_PATH",s}}return decodeURIComponent(e)}const Ay=["history","path","basename","stem","extname","dirname"];class xR{constructor(e){let n;e?hb(e)?n={path:e}:typeof e=="string"||nee(e)?n={value:e}:n=e:n={},this.cwd="cwd"in n?"":QZ.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<Ay.length;){const i=Ay[r];i in n&&n[i]!==void 0&&n[i]!==null&&(this[i]=i==="history"?[...n[i]]:n[i])}let s;for(s in n)Ay.includes(s)||(this[s]=n[s])}get basename(){return typeof this.path=="string"?ro.basename(this.path):void 0}set basename(e){Ry(e,"basename"),My(e,"basename"),this.path=ro.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?ro.dirname(this.path):void 0}set dirname(e){qC(this.basename,"dirname"),this.path=ro.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?ro.extname(this.path):void 0}set extname(e){if(My(e,"extname"),qC(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=ro.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){hb(e)&&(e=eee(e)),Ry(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?ro.basename(this.path,this.extname):void 0}set stem(e){Ry(e,"stem"),My(e,"stem"),this.path=ro.join(this.dirname||"",e+(this.extname||""))}fail(e,n,r){const s=this.message(e,n,r);throw s.fatal=!0,s}info(e,n,r){const s=this.message(e,n,r);return s.fatal=void 0,s}message(e,n,r){const s=new ms(e,n,r);return this.path&&(s.name=this.path+":"+s.name,s.file=this.path),s.fatal=!1,this.messages.push(s),s}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function My(t,e){if(t&&t.includes(ro.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+ro.sep+"`")}function Ry(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function qC(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}function nee(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const ree=function(t){const r=this.constructor.prototype,s=r[t],i=function(){return s.apply(i,arguments)};return Object.setPrototypeOf(i,r),i},see={}.hasOwnProperty;class tk extends ree{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=VZ()}copy(){const e=new tk;let n=-1;for(;++n<this.attachers.length;){const r=this.attachers[n];e.use(...r)}return e.data(Dy(!0,{},this.namespace)),e}data(e,n){return typeof e=="string"?arguments.length===2?(Ly("data",this.frozen),this.namespace[e]=n,this):see.call(this.namespace,e)&&this.namespace[e]||void 0:e?(Ly("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const s=n.call(e,...r);typeof s=="function"&&this.transformers.use(s)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=Hh(e),r=this.parser||this.Parser;return Oy("parse",r),r(String(n),n)}process(e,n){const r=this;return this.freeze(),Oy("process",this.parser||this.Parser),Py("process",this.compiler||this.Compiler),n?s(void 0,n):new Promise(s);function s(i,o){const a=Hh(e),l=r.parse(a);r.run(l,a,function(d,f,h){if(d||!f||!h)return u(d);const p=f,m=r.stringify(p,h);aee(m)?h.value=m:h.result=m,u(d,h)});function u(d,f){d||!f?o(d):i?i(f):n(void 0,f)}}}processSync(e){let n=!1,r;return this.freeze(),Oy("processSync",this.parser||this.Parser),Py("processSync",this.compiler||this.Compiler),this.process(e,s),YC("processSync","process",n),r;function s(i,o){n=!0,BC(i),r=o}}run(e,n,r){JC(e),this.freeze();const s=this.transformers;return!r&&typeof n=="function"&&(r=n,n=void 0),r?i(void 0,r):new Promise(i);function i(o,a){const l=Hh(n);s.run(e,l,u);function u(d,f,h){const p=f||e;d?a(d):o?o(p):r(void 0,p,h)}}}runSync(e,n){let r=!1,s;return this.run(e,n,i),YC("runSync","run",r),s;function i(o,a){BC(o),s=a,r=!0}}stringify(e,n){this.freeze();const r=Hh(n),s=this.compiler||this.Compiler;return Py("stringify",s),JC(e),s(e,r)}use(e,...n){const r=this.attachers,s=this.namespace;if(Ly("use",this.frozen),e!=null)if(typeof e=="function")l(e,n);else if(typeof e=="object")Array.isArray(e)?a(e):o(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function i(u){if(typeof u=="function")l(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[d,...f]=u;l(d,f)}else o(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function o(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(u.plugins),u.settings&&(s.settings=Dy(!0,s.settings,u.settings))}function a(u){let d=-1;if(u!=null)if(Array.isArray(u))for(;++d<u.length;){const f=u[d];i(f)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function l(u,d){let f=-1,h=-1;for(;++f<r.length;)if(r[f][0]===u){h=f;break}if(h===-1)r.push([u,...d]);else if(d.length>0){let[p,...m]=d;const y=r[h][1];fb(y)&&fb(p)&&(p=Dy(!0,y,p)),r[h]=[u,p,...m]}}}}const iee=new tk().freeze();function Oy(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function Py(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function Ly(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function JC(t){if(!fb(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function YC(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function Hh(t){return oee(t)?t:new xR(t)}function oee(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function aee(t){return typeof t=="string"||lee(t)}function lee(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const cee="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",XC=[],QC={allowDangerousHtml:!0},uee=/^(https?|ircs?|mailto|xmpp)$/i,dee=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function nk(t){const e=fee(t),n=hee(t);return pee(e.runSync(e.parse(n),n),t)}function fee(t){const e=t.rehypePlugins||XC,n=t.remarkPlugins||XC,r=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...QC}:QC;return iee().use(GQ).use(n).use(UZ,r).use(e)}function hee(t){const e=t.children||"",n=new xR;return typeof e=="string"&&(n.value=e),n}function pee(t,e){const n=e.allowedElements,r=e.allowElement,s=e.components,i=e.disallowedElements,o=e.skipHtml,a=e.unwrapDisallowed,l=e.urlTransform||mee;for(const d of dee)Object.hasOwn(e,d.from)&&(""+d.from+(d.to?"use `"+d.to+"` instead":"remove it")+cee+d.id,void 0);return gR(t,u),CY(t,{Fragment:c.Fragment,components:s,ignoreInvalidStyle:!0,jsx:c.jsx,jsxs:c.jsxs,passKeys:!0,passNode:!0});function u(d,f,h){if(d.type==="raw"&&h&&typeof f=="number")return o?h.children.splice(f,1):h.children[f]={type:"text",value:d.value},f;if(d.type==="element"){let p;for(p in Ny)if(Object.hasOwn(Ny,p)&&Object.hasOwn(d.properties,p)){const m=d.properties[p],y=Ny[p];(y===null||y.includes(d.tagName))&&(d.properties[p]=l(String(m||""),p,d))}}if(d.type==="element"){let p=n?!n.includes(d.tagName):i?i.includes(d.tagName):!1;if(!p&&r&&typeof f=="number"&&(p=!r(d,f,h)),p&&h&&typeof f=="number")return a&&d.children?h.children.splice(f,1,...d.children):h.children.splice(f,1),f}}}function mee(t){const e=t.indexOf(":"),n=t.indexOf("?"),r=t.indexOf("#"),s=t.indexOf("/");return e===-1||s!==-1&&e>s||n!==-1&&e>n||r!==-1&&e>r||uee.test(t.slice(0,e))?t:""}const gee=[{label:"",value:null},{label:"",value:0},{label:"5 ",value:5},{label:"15 ",value:15},{label:"30 ",value:30},{label:"1 ",value:60},{label:"2 ",value:120},{label:"1 ",value:1440}],yee=({value:t,onChange:e})=>{const[n,r]=b.useState(!1),[s,i]=b.useState(""),[o,a]=b.useState("minutes"),l=()=>t==null?"":t===0?"":t<60?`${t} `:t<1440?`${t/60} `:`${t/1440} `,u=()=>{const f=parseInt(s);if(isNaN(f)||f<=0)return;let h=f;o==="hours"&&(h=f*60),o==="days"&&(h=f*1440),e(h),r(!1),i("")},d=t!=null;return c.jsxs("div",{className:"relative",children:[c.jsxs("button",{type:"button",onClick:()=>r(!n),className:`flex items-center gap-1.5 px-2 py-1 rounded-lg text-xs transition-colors ${d?"bg-orange-100 text-orange-600 hover:bg-orange-200":"bg-gray-100 text-gray-500 hover:bg-gray-200"}`,title:"",children:[d?c.jsx(Ba,{size:12}):c.jsx(Qx,{size:12}),c.jsx("span",{children:l()}),c.jsx(ds,{size:10})]}),n&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>r(!1)}),c.jsxs("div",{className:"absolute left-0 top-full mt-1 w-48 bg-white rounded-lg shadow-xl border border-gray-200 z-50 overflow-hidden",children:[gee.map(f=>c.jsxs("button",{type:"button",onClick:()=>{e(f.value),r(!1)},className:`w-full px-3 py-2 text-left text-sm hover:bg-orange-50 transition-colors flex items-center gap-2 ${t===f.value?"bg-orange-100 text-orange-700 font-medium":"text-gray-700"}`,children:[f.value===null?c.jsx(Qx,{size:12}):c.jsx(Ba,{size:12}),f.label]},f.value??"null")),c.jsxs("div",{className:"border-t border-gray-100 p-2",children:[c.jsx("div",{className:"text-[10px] text-gray-400 mb-1.5",children:""}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("input",{type:"number",value:s,onChange:f=>i(f.target.value),placeholder:"",className:"flex-1 px-2 py-1 text-xs border rounded w-14",min:1}),c.jsxs("select",{value:o,onChange:f=>a(f.target.value),className:"px-1 py-1 text-xs border rounded",children:[c.jsx("option",{value:"minutes",children:""}),c.jsx("option",{value:"hours",children:""}),c.jsx("option",{value:"days",children:""})]}),c.jsx("button",{type:"button",onClick:u,className:"px-2 py-1 text-xs bg-orange-500 text-white rounded hover:bg-orange-600",children:""})]})]}),d&&c.jsxs("button",{type:"button",onClick:()=>{e(null),r(!1)},className:"w-full px-3 py-2 text-left text-xs text-red-500 hover:bg-red-50 border-t border-gray-100 flex items-center gap-2",children:[c.jsx(on,{size:12}),""]})]})]})]})},ZC=t=>{if(!t)return"";let e=t;e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/^### (.*$)/gm,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gm,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gm,"<h1>$1</h1>");const n=e.split(`
`);let r=!1,s=[];for(let i=0;i<n.length;i++){const o=n[i];if(/^[*-] /.test(o)||/^\d+\. /.test(o)){r||(s.push("<ul>"),r=!0);const l=o.replace(/^[*-] |^\d+\. /,"");s.push(`<li>${l}</li>`)}else r&&(s.push("</ul>"),r=!1),o.trim()===""||(o.startsWith("<h")?s.push(o):s.push(`<p>${o}</p>`))}return r&&s.push("</ul>"),s.join("")},eE=t=>{if(!t)return"";if(!t.includes("<")||!t.includes(">"))return t;let e=t;return e=e.replace(/<\/p>/gi,`
`),e=e.replace(/<br\s*\/?>/gi,`
`),e=e.replace(/<\/div>/gi,`
`),e=e.replace(/<[^>]+>/g,""),e=e.replace(/&nbsp;/g," "),e=e.replace(/&amp;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e.trim()},xee="",Ro=({initialData:t,onClose:e,isQuickAdd:n=!1,isEmbedded:r=!1})=>{var ak,lk,ck;const{addTask:s,updateTask:i,tags:o,tasks:a,addTag:l,deleteTag:u,setFocusedTaskId:d,themeSettings:f,toggleExpansion:h,setSelectedTaskIds:p,deleteTask:m,visibleTasks:y,user:x,setToast:g,t:v,navigateToTask:w}=b.useContext(_n),[S,I]=b.useState((t==null?void 0:t.title)||""),[k,R]=b.useState((t==null?void 0:t.description)||""),[C,T]=b.useState((t==null?void 0:t.due_date)||null),[_,N]=b.useState((t==null?void 0:t.start_date)||null),[j,O]=b.useState((t==null?void 0:t.tags)||[]),[P,G]=b.useState((t==null?void 0:t.images)||[]),[A,M]=b.useState((t==null?void 0:t.attachments)||[]),[Q,X]=b.useState(!1),[D,Te]=b.useState((t==null?void 0:t.parent_id)||null),[xe,U]=b.useState([]),[z,ie]=b.useState((t==null?void 0:t.is_project)||!1),[Be,st]=b.useState((t==null?void 0:t.color)||"gray"),[ae,Z]=b.useState((t==null?void 0:t.importance)||"unplanned"),[K,de]=b.useState((t==null?void 0:t.is_all_day)!==void 0?t.is_all_day:!0),[ce,ke]=b.useState(()=>{if(t!=null&&t.start_time)return t.start_time;if(t!=null&&t.start_date&&!(t!=null&&t.is_all_day)){const E=new Date(t.start_date);return`${String(E.getHours()).padStart(2,"0")}:${String(E.getMinutes()).padStart(2,"0")}`}return"09:00"}),[_e,ve]=b.useState(()=>{if(t!=null&&t.end_time)return t.end_time;if(t!=null&&t.start_date&&!(t!=null&&t.is_all_day)){const E=new Date(t.start_date),H=typeof t.duration=="number"?t.duration:60;return E.setMinutes(E.getMinutes()+H),`${String(E.getHours()).padStart(2,"0")}:${String(E.getMinutes()).padStart(2,"0")}`}return"10:00"}),[Ke,je]=b.useState((t==null?void 0:t.duration)||""),[V,re]=b.useState((t==null?void 0:t.repeat_rule)||null),[se,ne]=b.useState(!1),[pe,ee]=b.useState(()=>{if(t!=null&&t.id)try{const E=localStorage.getItem(`task_reminder_${t.id}`);if(E!==null)return JSON.parse(E)}catch{}return(t==null?void 0:t.reminder_minutes)??null});b.useEffect(()=>{if(t!=null&&t.id)try{pe!==null?localStorage.setItem(`task_reminder_${t.id}`,JSON.stringify(pe)):localStorage.removeItem(`task_reminder_${t.id}`)}catch{}},[pe,t==null?void 0:t.id]);const[ye,Pe]=b.useState(!1),[me,Me]=b.useState(!1),[qe,ht]=b.useState(!1),[wt,ge]=b.useState(null),Le=b.useRef(null),Ue=b.useRef(null),De=b.useRef(null),Qe=b.useRef(null),[pt,nt]=b.useState(null),ut=b.useRef(null),he=b.useRef(null),[we,Xe]=b.useState(null),[Ze,lt]=b.useState(null),[Ge,Ct]=b.useState(null),[Y,q]=b.useState(null),[oe,Ce]=b.useState(null),[dt,xt]=b.useState(new Set),[it,Rt]=b.useState(!1),[Ot,Nn]=b.useState(!1),[$t,an]=b.useState(""),[Tn,Ie]=b.useState(!1),[Dt,zt]=b.useState(!1),[Ft,qt]=b.useState(""),[mn,Cr]=b.useState(""),[gs,bn]=b.useState(0),[gn,Er]=b.useState(0),[Pn,Jn]=b.useState(!1),[En,Or]=b.useState({isOpen:!1,title:"",content:"",history:[],historyIndex:-1}),[Ei,tl]=b.useState(!1),[Qo,hn]=b.useState(!1),[ko,Zo]=b.useState([]),{isRecording:si,startRecording:nl,stopRecording:rl,recordingTaskId:So,recordingTime:ys}=b.useContext(Iu),_o=E=>{const H=Math.floor(E/1e3),ue=Math.floor(H/60),Se=H%60;return`${ue}:${Se.toString().padStart(2,"0")}`},sl=async(E,H,ue)=>{if(console.log("TaskInput handleSaveAudio called with:",E.name,H,ue),!Ne)return;const Se=`${Date.now()}_${crypto.randomUUID()}.${E.name.split(".").pop()}`,ot=`${(x==null?void 0:x.id)||"anonymous"}/${Se}`;try{const{error:It}=await Ne.storage.from("attachments").upload(ot,E,{contentType:E.type,upsert:!1});if(It){console.error("Upload voice error:",It),g==null||g({msg:"",type:"error"});return}const{data:Wt}=Ne.storage.from("attachments").getPublicUrl(ot);if(Wt){const Gt={name:E.name,url:Wt.publicUrl,size:E.size,type:E.type,markers:H,recordingId:ue},en=[...A,Gt];M(en),t&&i(t.id,{attachments:en},[],{skipHistory:!0}),g==null||g({msg:"",type:"info"})}}catch(It){console.error(It),g==null||g({msg:"",type:"error"})}};b.useEffect(()=>{const E=H=>{const ue=H.detail;ue&&ue.taskId===(t==null?void 0:t.id)&&ue.attachment&&(console.log("[TaskInput] Recording saved event - updating local attachments state"),M(Se=>Se.some(ot=>ot.url===ue.attachment.url)?Se:[...Se,ue.attachment]))};return window.addEventListener("recording-saved",E),()=>window.removeEventListener("recording-saved",E)},[t==null?void 0:t.id]);const[Yn,Pr]=b.useState((t==null?void 0:t.ai_history)||[]),[Un,Ni]=b.useState(t!=null&&t.ai_history?t.ai_history.length-1:-1),[ic,ii]=b.useState(""),[Nr,le]=b.useState(!1),[vt,At]=b.useState(!1),[Mt,Et]=b.useState(!1),[Zt,vn]=b.useState(0),[rr,Mn]=b.useState((t==null?void 0:t.attachment_links)||[]),[yn,dn]=b.useState(!1),Hn=b.useMemo(()=>{const E=o.find(H=>H.name.trim().toLowerCase()==="prompt");return E?a.filter(H=>H.tags.includes(E.id)&&H.status!=="deleted"&&H.status!=="logged").sort((H,ue)=>ue.created_at.localeCompare(H.created_at)):[]},[a,o]),sr=b.useMemo(()=>{if(!mn.trim())return Hn;const E=mn.toLowerCase();return Hn.filter(H=>H.title.toLowerCase().includes(E)||H.description&&H.description.toLowerCase().includes(E))},[Hn,mn]),ji=b.useMemo(()=>Hn.slice(0,5),[Hn]);b.useEffect(()=>{if(!mn.trim()){Er(0),bn(0);return}let E=0;sr.forEach(H=>{const ue=(H.title.match(new RegExp(mn,"gi"))||[]).length,Se=H.description?(H.description.match(new RegExp(mn,"gi"))||[]).length:0;E+=ue+Se}),Er(E),bn(0)},[mn,sr]);const oi=E=>{Or(H=>{const ue={title:H.title,content:E},Se=[...H.history.slice(0,H.historyIndex+1),ue];return{...H,content:E,history:Se,historyIndex:Se.length-1}})},jn=E=>{Or(H=>{const ue={title:E,content:H.content},Se=[...H.history.slice(0,H.historyIndex+1),ue];return{...H,title:E,history:Se,historyIndex:Se.length-1}})},Ln=()=>{Or(E=>{if(E.historyIndex<=0)return E;const H=E.historyIndex-1;return{...E,title:E.history[H].title,content:E.history[H].content,historyIndex:H}})},mr=()=>{Or(E=>{if(E.historyIndex>=E.history.length-1)return E;const H=E.historyIndex+1;return{...E,title:E.history[H].title,content:E.history[H].content,historyIndex:H}})},$=t?!!t.completed_at:!1,F=b.useRef(null),L=b.useRef(null),W=b.useRef(null),B=b.useRef(null),J=b.useRef(null),fe=b.useRef(null),Re=b.useRef(null),ze=b.useRef(null),[We,et]=b.useState([]),[mt,tt]=b.useState(!1),[ct,He]=b.useState(-1);b.useEffect(()=>{const E=setTimeout(()=>{if(t&&!n){const H={};let ue=!1;if(S!==(t.title||"")&&(H.title=S,ue=!0),k!==(t.description||"")&&(H.description=k,ue=!0),ce&&ce!==(t.start_time||"")&&(H.start_time=ce,ue=!0),_e&&_e!==(t.end_time||"")&&(H.end_time=_e,ue=!0),Ke&&String(Ke)!==String(t.duration||60)&&(H.duration=Number(Ke),ue=!0),K!==(t.is_all_day??!0)&&(H.is_all_day=K,ue=!0),_&&_!==t.start_date&&(H.start_date=_,ue=!0),ue){if((H.start_time||H.start_date)&&!K){const Se=H.start_date||_||t.start_date,at=H.start_time||ce||t.start_time||"00:00";if(Se){const ot=new Date(Se),[It,Wt]=at.split(":").map(Number);!isNaN(It)&&!isNaN(Wt)&&(ot.setHours(It,Wt,0,0),H.start_date=ot.toISOString())}}i(t.id,H,[],{skipHistory:!0})}}},800);return()=>clearTimeout(E)},[S,k,ce,_e,Ke,_,K,t,i,n]),b.useEffect(()=>{const E=H=>{(H.metaKey||H.ctrlKey)&&H.shiftKey&&(H.key==="v"||H.key==="V")&&(H.preventDefault(),H.stopPropagation(),si?rl():nl(t==null?void 0:t.id))};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[si,nl,rl,t==null?void 0:t.id]),b.useEffect(()=>{L.current},[k]),b.useEffect(()=>{if(!Ge||!ut.current)return;const E=()=>{const ue=ut.current;ue&&Ge&&(ue.chain().setTextSelection({from:Ge.from,to:Ge.to}).unsetHighlight().setTextSelection(ue.state.selection.to).run(),Ct(null))},H=setTimeout(()=>{document.addEventListener("click",E,{once:!0})},100);return()=>{clearTimeout(H),document.removeEventListener("click",E)}},[Ge]);const Ee=b.useRef(t);b.useEffect(()=>{const E=Ee.current;if(!t||!E){Ee.current=t;return}t.id!==E.id?(I(t.title||""),R(t.description||""),N(t.start_date||""),ke(t.start_time||""),ve(t.end_time||""),je(t.duration||60),de(t.is_all_day??!0),O(t.tags||[]),G(t.images||[]),Te(t.parent_id||null),ie(t.is_project||!1),st(t.color||"gray"),Z(t.importance||"unplanned")):(t.title!==E.title&&I(t.title||""),t.description!==E.description&&R(t.description||""),t.start_date!==E.start_date&&N(t.start_date||""),t.start_time!==E.start_time&&ke(t.start_time||""),t.end_time!==E.end_time&&ve(t.end_time||""),t.duration!==E.duration&&je(t.duration||60),t.is_all_day!==E.is_all_day&&de(t.is_all_day??!0),JSON.stringify(t.tags)!==JSON.stringify(E.tags)&&O(t.tags||[])),Ee.current=t},[t]);const $e=async E=>{let H;if(we&&ut.current?H=ut.current.state.doc.textBetween(we.from,we.to," "):ut.current?H=ut.current.getText():H=k.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),!H||!H.trim()){g==null||g({msg:"Please enter or select some content first.",type:"error"});return}Rt(!0),zt(!1),At(!0);try{if(Pn&&Ft.trim()){let It=o.find(Gt=>Gt.name.trim().toLowerCase()==="prompt"),Wt=It==null?void 0:It.id;if(Wt||(Wt=await l("prompt")||void 0),Wt){const Gt=await P5(Ft);await s({title:Gt,description:Ft,tags:[Wt],status:"active"})}}const Se=await O5(H,we?"":S,E),at={id:crypto.randomUUID(),role:"assistant",content:Se.fullResponse,created_at:new Date().toISOString(),prompt:E||"AI Analysis",model:"gemini"},ot=[...Yn,at];Pr(ot),Ni(ot.length-1),ii(Se.fullResponse),le(!1),qt(""),t&&i(t.id,{ai_history:ot},[],{skipHistory:!0})}catch(ue){console.error(ue);let Se=ue.message||"";(Se.includes("429")||Se.includes("quota"))&&(Se="AI  1-2  API Key"),alert(`AI ${Se}`),At(!1)}finally{Rt(!1)}},be=()=>{if(document.activeElement instanceof HTMLElement&&(he.current=document.activeElement),!k||!k.trim()){g==null||g({msg:"Please enter some content first.",type:"error"});return}if(vt){At(!1);return}if(Yn.length>0){At(!0);return}qt(""),zt(!0)},Ae=()=>{zt(!1),Xe(null)},[Fe,bt]=b.useState(!1),rt=b.useMemo(()=>{const E=o.find(H=>H.name.trim().toLowerCase().includes("for"));return E?a.filter(H=>H.tags.includes(E.id)&&H.status!=="deleted"&&H.status!=="logged").sort((H,ue)=>ue.created_at.localeCompare(H.created_at)):[]},[a,o]),gt=async E=>{document.activeElement instanceof HTMLElement&&(he.current=document.activeElement);let H;if(ut.current?H=ut.current.getText():H=k.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),console.log("Note content for title generation:",H.substring(0,200)+"..."),console.log("Content length:",H.length),!H||!H.trim()){g==null||g({msg:"",type:"error"});return}Nn(!0),bt(!1);try{const ue=await TJ(H,E);console.log("Generated SEO title:",ue),an(ue),Ie(!0)}catch(ue){console.error("Generate title error:",ue),g==null||g({msg:"",type:"error"})}finally{Nn(!1)}},Ve=async()=>{let E;if(ut.current?E=ut.current.getText():E=k.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),!E||!E.trim()){g==null||g({msg:"",type:"error"});return}rt.length>0?bt(!0):(console.log("No custom title prompts found. Using default."),gt())},te=()=>{I($t),Ie(!1),an(""),g==null||g({msg:" SEO ",type:"info"})},Oe=()=>{Ie(!1),an("")},Je=b.useMemo(()=>{var E;return(E=t==null?void 0:t.dependencies)!=null&&E.length?a.filter(H=>{var ue;return((ue=t.dependencies)==null?void 0:ue.includes(H.id))&&!H.completed_at}):[]},[t==null?void 0:t.dependencies,a]),Ye=b.useMemo(()=>o.filter(E=>E.name.startsWith("#")).map(E=>E.name.slice(1)),[o]),ft=async()=>{let E="";if(ut.current&&typeof ut.current.getText=="function"&&(E=ut.current.getText()),(!E||!E.trim())&&(E=k.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim()),!E||!E.trim()){g==null||g({msg:"",type:"error"});return}console.log("Generating keywords for current task content:",E.slice(0,100)+(E.length>100?"...":"")),tl(!0);try{const H=await CJ(E,Ye);Zo(H),hn(!0),console.log("Generated keywords:",H)}catch(H){console.error("Generate keywords error:",H),g==null||g({msg:"",type:"error"})}finally{tl(!1)}},Nt=async E=>{const H=`#${E}`;let ue=o.find(Se=>Se.name.toLowerCase()===H.toLowerCase());try{if(ue)j.includes(ue.id)?g==null||g({msg:` ${H} `,type:"info"}):(O(Se=>[...Se,ue.id]),g==null||g({msg:`: ${H}`,type:"info"}));else{let Se=o.find(en=>en.name==="#"),at;if(Se)at=Se.id;else{const en=await l("#");if(!en)throw new Error("Failed to create root keyword tag");at=en}const ot=(en,pn=0)=>{const Pt=o.find(wn=>wn.id===en);return!Pt||!Pt.parent_id||Pt.parent_id===at?pn:ot(Pt.parent_id,pn+1)},It=o.filter(en=>{if(en.parent_id===at)return!0;let pn=en;const Pt=new Set;for(;pn.parent_id&&!Pt.has(pn.id);){if(Pt.add(pn.id),pn.parent_id===at)return!0;const wn=o.find(br=>br.id===pn.parent_id);if(!wn)break;pn=wn}return!1}).map(en=>({id:en.id,name:en.name.replace(/^#/,""),parentId:en.parent_id,depth:ot(en.id)}));let Wt=at;if(It.length>0){g==null||g({msg:"...",type:"info"});const en=await NJ(E,It);if(en){Wt=en;const pn=o.find(Pt=>Pt.id===en);console.log(`AI suggested parent for "${E}": ${pn==null?void 0:pn.name}`)}}const Gt=await l(H,Wt);if(Gt){j.includes(Gt)||O(Pt=>[...Pt,Gt]);const en=o.find(Pt=>Pt.id===Wt),pn=(en==null?void 0:en.name)||"#";g==null||g({msg:`: ${H} ( ${pn})`,type:"info"})}else throw new Error("Failed to create tag")}Zo(Se=>Se.filter(at=>at!==E))}catch(Se){console.error("Error adding keyword tag:",Se),g==null||g({msg:"",type:"error"})}},jt=async()=>{const E=[...ko];let H=0,ue=o.find(at=>at.name==="#"),Se=null;if(ue)Se=ue.id;else{const at=await l("#");at&&(Se=at)}for(const at of E){const ot=`#${at}`;let It=o.find(Wt=>Wt.name.toLowerCase()===ot.toLowerCase());try{if(It)j.includes(It.id)||(O(Wt=>[...Wt,It.id]),H++);else{const Wt=await l(ot,Se);Wt&&!j.includes(Wt)&&(O(Gt=>[...Gt,Wt]),H++)}}catch(Wt){console.error("Error adding keyword tag:",at,Wt)}}Zo([]),hn(!1),H>0?g==null||g({msg:` ${H}  #`,type:"info"}):g==null||g({msg:"",type:"info"})},Bt=E=>{Zo(H=>H.filter(ue=>ue!==E))},Xt=E=>{if(!E)return Be;let H=a.find(Se=>Se.id===E);const ue=new Set;for(;H&&H.parent_id&&!ue.has(H.id);){ue.add(H.id);const Se=a.find(at=>at.id===H.parent_id);if(Se)H=Se;else break}return(H==null?void 0:H.color)||"blue"},rn=b.useMemo(()=>Xt(D),[D,a,Be]),sn=Kn[rn]||Kn.blue;i1(Le,E=>{if(n||Dt||vt&&Ze||Tn||Fe||Qo||E&&si&&So===(t==null?void 0:t.id)&&E.target.closest("[data-recording-capsule]"))return;const H=E==null?void 0:E.target;if(!(H&&H.closest('[data-app-header="true"]')))if(t&&e)if(S.trim())Xn();else{const ue=y.findIndex(at=>at.data.id===t.id),Se=y[ue-1];m(t.id),e(Se?Se.data.id:null)}else e&&(S.trim()||k.replace(/<[^>]*>/g,"").trim()?Xn():e(null))});const Rn=b.useMemo(()=>{if(!(t!=null&&t.id))return a.filter(ue=>ue.status!=="deleted");const E=new Set,H=[t.id];for(;H.length>0;){const ue=H.shift();for(const Se of a)Se.parent_id===ue&&!E.has(Se.id)&&(E.add(Se.id),H.push(Se.id))}return a.filter(ue=>ue.id!==t.id&&!E.has(ue.id)&&ue.status!=="deleted")},[a,t]),gr=b.useMemo(()=>{const E=(H=null,ue=0,Se=null)=>{const at=o.filter(It=>It.parent_id===H);let ot=[];return at.forEach(It=>{ot.push({...It,depth:ue,parentName:Se}),ot=[...ot,...E(It.id,ue+1,It.name)]}),ot};return E()},[o]);b.useEffect(()=>{if(t!=null&&t.id){const E=a.filter(H=>H.parent_id===t.id).map(H=>H.id);U(E)}},[t,a]),b.useEffect(()=>{const E=!t||!t.title;if(S.length>=2&&E){const H=a.filter(ue=>ue.title.toLowerCase().includes(S.toLowerCase())&&ue.id!==(t==null?void 0:t.id));et(H.slice(0,5)),tt(H.length>0),He(-1)}else tt(!1)},[S,a,t]),b.useEffect(()=>{!t&&F.current&&F.current.focus()},[t]);const Xn=async()=>{let E=S.trim();const H=k.replace(/<[^>]*>/g,"").trim();if(!E&&H&&(E=H.split(`
`)[0].substring(0,30)||"Untitled Note"),!E)return;let ue=_;if(_&&!K&&ce){const at=new Date(_),[ot,It]=ce.split(":").map(Number);at.setHours(ot,It,0,0),ue=at.toISOString()}else if(_&&K){const at=new Date(_);at.setHours(12,0,0,0),ue=at.toISOString()}const Se={title:E,description:k,due_date:C,start_date:ue,parent_id:D,is_project:z||xe.length>0,tags:j,status:(t==null?void 0:t.status)||"inbox",color:rn,importance:ae,images:P,is_all_day:K,duration:Ke?Number(Ke):null,attachments:A,attachment_links:rr,ai_history:Yn,repeat_rule:V,reminder_minutes:pe};if(e?e((t==null?void 0:t.id)||null):oc(),t&&t.id&&t.id!=="new")await i(t.id,Se,xe);else{const at=await s(Se,xe);d(at),p([at])}},oc=()=>{I(""),R(""),T(null),N(null),O([]),G([]),M([]),Te(null),U([]),ie(!1),de(!0),ke("09:00"),ve("10:00"),je(""),re(null),ee(null)},Xi=async E=>{if(!(E.length===0||!Ne)){ht(!0);try{const H=[],ue=[];for(const It of E){if(It.size>104857600){g==null||g({msg:`: ${It.name} ( 100MB)`,type:"error"});continue}const Wt=It.type.startsWith("image/");let Gt=It;if(Wt&&It.size>2*1024*1024)try{Gt=await is(It,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0})}catch(xs){console.warn("Compression failed, using original file:",xs)}const en=It.name.split(".").pop()||(Wt?"jpg":"bin"),pn=`${Date.now()}_${crypto.randomUUID()}.${en}`,wn=`${(x==null?void 0:x.id)||"anonymous"}/${pn}`,{error:br}=await Ne.storage.from("attachments").upload(wn,Gt,{contentType:It.type,upsert:!1});if(br){console.error("Upload error:",br);continue}const{data:Cs}=Ne.storage.from("attachments").getPublicUrl(wn);if(Cs){const xs={name:It.name,url:Cs.publicUrl,size:It.size,type:It.type};ue.push(xs),Wt&&H.push(Cs.publicUrl)}}const at=[...P,...H],ot=[...A,...ue];G(at),M(ot),t&&(H.length>0||ue.length>0)&&i(t.id,{images:at,attachments:ot},[],{skipHistory:!0})}catch(H){console.error("Error uploading files:",H)}finally{ht(!1),Ue.current&&(Ue.current.value="")}}},zu=async E=>{const H=E.target;if(H.tagName==="INPUT"||H.tagName==="TEXTAREA"||H.isContentEditable){if(E.clipboardData.files.length>0){E.preventDefault();const ue=Array.from(E.clipboardData.files);await Xi(ue);return}return}if(E.clipboardData.files.length>0){E.preventDefault();const ue=Array.from(E.clipboardData.files);await Xi(ue)}},ac=async E=>{let H=[];"files"in E.target&&E.target.files?H=Array.from(E.target.files):"dataTransfer"in E&&E.dataTransfer.files&&(H=Array.from(E.dataTransfer.files)),await Xi(H)},il=async E=>{const H=P.filter(Se=>Se!==E),ue=A.filter(Se=>Se.url!==E);if(G(H),M(ue),t&&i(t.id,{images:H,attachments:ue},[],{skipHistory:!0}),Ne)try{const at=new URL(E).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(at){const ot=at[1];await Ne.storage.from("attachments").remove([ot])}}catch(Se){console.warn("Failed to delete image from storage:",Se)}},PR=async E=>{const H=E.target.files;if(!(!H||H.length===0||!Ne)){ht(!0);try{const ue=[],Se=[];for(const It of Array.from(H)){const Wt=It.name.split(".").pop()||"bin",Gt=`${Date.now()}_${crypto.randomUUID()}.${Wt}`,en=`${x.id}/${Gt}`,{error:pn}=await Ne.storage.from("attachments").upload(en,It,{contentType:It.type,upsert:!1});if(pn){console.error("Upload error:",pn),g==null||g({msg:`: ${It.name}`,type:"error"});continue}const{data:Pt}=Ne.storage.from("attachments").getPublicUrl(en);if(Pt){const wn=It.type.startsWith("image/"),br={name:It.name,url:Pt.publicUrl,size:It.size,type:It.type};ue.push(br),wn&&Se.push(Pt.publicUrl)}}const at=[...A,...ue],ot=[...P,...Se];M(at),G(ot),t&&(ue.length>0||Se.length>0)&&i(t.id,{attachments:at,images:ot},[],{skipHistory:!0}),ue.length>0&&nt(ue[ue.length-1].url),g==null||g({msg:` ${ue.length} `,type:"info"})}catch(ue){console.error("Error uploading attachments:",ue),g==null||g({msg:"",type:"error"})}finally{ht(!1),De.current&&(De.current.value="")}}},ai=b.useRef(null),LR=async E=>{const H=A.find(It=>It.url===E);if(!H)return;ai.current&&(clearTimeout(ai.current.timeoutId),Zg(ai.current.url));const ue=A.filter(It=>It.url!==E),Se=P.filter(It=>It!==E);M(ue),G(Se),t&&i(t.id,{attachments:ue,images:Se},[],{skipHistory:!0});const at=setTimeout(()=>{Zg(E),nh.current.push({type:"delete",attachment:H}),rh.current=[],ai.current=null},1e4);ai.current={url:E,attachment:H,timeoutId:at};const ot=H.name||"";g==null||g({msg:`: ${ot.length>20?ot.slice(0,20)+"...":ot}`,type:"info",undo:()=>{var It,Wt;if(ai.current&&ai.current.url===E){if(clearTimeout(ai.current.timeoutId),ai.current=null,M(Gt=>[...Gt,H]),(It=H.type)!=null&&It.startsWith("image/")&&G(Gt=>[...Gt,H.url]),t){const Gt=[...ue,H],en=(Wt=H.type)!=null&&Wt.startsWith("image/")?[...Se,H.url]:Se;i(t.id,{attachments:Gt,images:en},[],{skipHistory:!0})}g==null||g({msg:"",type:"info"})}}})},Zg=async E=>{if(Ne)try{const ue=new URL(E).pathname.match(/\/storage\/v1\/object\/public\/attachments\/(.+)$/);if(ue){const Se=ue[1];await Ne.storage.from("attachments").remove([Se]),console.log("[TaskInput] Attachment deleted from storage:",Se)}}catch(H){console.warn("Failed to delete attachment from storage:",H)}},nh=b.useRef([]),rh=b.useRef([]),$R=()=>{var E,H;if(ai.current){const{attachment:ue,timeoutId:Se}=ai.current;if(clearTimeout(Se),ai.current=null,M(at=>at.some(It=>It.url===ue.url)?at:[...at,ue]),(E=ue.type)!=null&&E.startsWith("image/")&&G(at=>at.includes(ue.url)?at:[...at,ue.url]),t){const ot=[...A,ue];i(t.id,{attachments:ot},[],{skipHistory:!0})}return g==null||g({msg:"",type:"info"}),!0}if(nh.current.length>0){const ue=nh.current.pop();return rh.current.push(ue),ue.type==="delete"&&(M(Se=>[...Se,ue.attachment]),(H=ue.attachment.type)!=null&&H.startsWith("image/")&&G(Se=>[...Se,ue.attachment.url]),t&&i(t.id,{attachments:[...A,ue.attachment]},[],{skipHistory:!0}),g==null||g({msg:"",type:"info"})),!0}return!1},zR=()=>{if(rh.current.length>0){const E=rh.current.pop();return nh.current.push(E),E.type==="delete"&&(M(H=>H.filter(ue=>ue.url!==E.attachment.url)),G(H=>H.filter(ue=>ue!==E.attachment.url)),t&&i(t.id,{attachments:A.filter(H=>H.url!==E.attachment.url),images:P.filter(H=>H!==E.attachment.url)},[],{skipHistory:!0}),Zg(E.attachment.url),g==null||g({msg:"",type:"info"})),!0}return!1};b.useEffect(()=>{const E=H=>{var ue;(ue=Le.current)!=null&&ue.contains(document.activeElement)&&((H.ctrlKey||H.metaKey)&&H.key==="z"&&!H.shiftKey&&$R()&&(H.preventDefault(),H.stopPropagation()),(H.ctrlKey||H.metaKey)&&H.key==="z"&&H.shiftKey&&zR()&&(H.preventDefault(),H.stopPropagation()))};return window.addEventListener("keydown",E,!0),()=>window.removeEventListener("keydown",E,!0)},[A,P,t]);const FR=E=>E<1024?E+" B":E<1024*1024?(E/1024).toFixed(1)+" KB":(E/(1024*1024)).toFixed(1)+" MB",Fu=E=>{var at,ot,It,Wt,Gt,en,pn,Pt,wn,br,Cs,xs,Ii,uk,dk,fk,hk,pk,mk,gk,yk;E.preventDefault();const H=document.activeElement,ue=E.shiftKey,Se=(at=Le.current)==null?void 0:at.querySelector(".ProseMirror");ue?H===F.current?(Cs=ze.current)==null||Cs.focus():H!=null&&H.classList.contains("ProseMirror")?(xs=F.current)==null||xs.focus():ze.current&&(H===ze.current||(Ii=ze.current.parentElement)!=null&&Ii.contains(H))?K&&B.current?B.current.focus():!K&&Re.current?setTimeout(()=>{var Wr,Es;(Wr=Re.current)==null||Wr.focus(),(Es=Re.current)==null||Es.select()},0):(uk=W.current)==null||uk.focus():H===B.current?(dk=W.current)==null||dk.focus():H===Re.current?fe.current?setTimeout(()=>{var Wr,Es;(Wr=fe.current)==null||Wr.focus(),(Es=fe.current)==null||Es.select()},0):(fk=W.current)==null||fk.focus():H===fe.current?J.current?setTimeout(()=>{var Wr,Es;(Wr=J.current)==null||Wr.focus(),(Es=J.current)==null||Es.select()},0):(hk=W.current)==null||hk.focus():H===J.current?(pk=W.current)==null||pk.focus():W.current&&(H===W.current||(mk=W.current.parentElement)!=null&&mk.contains(H))?Se?Se.focus():(gk=F.current)==null||gk.focus():(yk=ze.current)==null||yk.focus():H===F.current?Se&&Se.focus():H!=null&&H.classList.contains("ProseMirror")?(ot=W.current)==null||ot.focus():H===W.current||W.current&&((It=W.current.parentElement)!=null&&It.contains(H))?K&&B.current?B.current.focus():!K&&J.current?(J.current.focus(),J.current.select()):(Wt=ze.current)==null||Wt.focus():H===B.current?(Gt=ze.current)==null||Gt.focus():H===J.current?fe.current?setTimeout(()=>{var Wr,Es;(Wr=fe.current)==null||Wr.focus(),(Es=fe.current)==null||Es.select()},0):(en=ze.current)==null||en.focus():H===fe.current?Re.current?setTimeout(()=>{var Wr,Es;(Wr=Re.current)==null||Wr.focus(),(Es=Re.current)==null||Es.select()},0):(pn=ze.current)==null||pn.focus():H===Re.current?setTimeout(()=>{var Wr;(Wr=ze.current)==null||Wr.focus()},0):ze.current&&(H===ze.current||(Pt=ze.current.parentElement)!=null&&Pt.contains(H))?(wn=F.current)==null||wn.focus():(br=F.current)==null||br.focus()},rk=()=>{t&&i(t.id,{completed_at:$?null:new Date().toISOString(),reminder_minutes:pe})},sk=E=>{var at,ot,It,Wt,Gt,en,pn;if((E.ctrlKey||E.metaKey)&&E.key==="z"){E.stopPropagation();return}if(E.shiftKey){if(E.key==="S"||E.key==="s"){E.preventDefault(),(at=W.current)==null||at.focus();return}if(E.key==="T"||E.key==="t"){E.preventDefault(),(ot=ze.current)==null||ot.focus();return}}if(E.ctrlKey&&E.key==="."){E.preventDefault(),E.stopPropagation(),rk();return}if(Mt&&document.activeElement===F.current){if(E.key==="ArrowLeft"){E.preventDefault();const Pt=Zt-1;vn(Pt);const wn=new Date;wn.setDate(wn.getDate()+Pt);const br=wn.toLocaleDateString("sv-SE"),xs=["","","","","","",""][wn.getDay()].replace("","");I(Ii=>Ii.replace(/\d{4}-\d{2}-\d{2}[]$/,`${br}${xs}`));return}if(E.key==="ArrowRight"){E.preventDefault();const Pt=Zt+1;vn(Pt);const wn=new Date;wn.setDate(wn.getDate()+Pt);const br=wn.toLocaleDateString("sv-SE"),xs=["","","","","","",""][wn.getDay()].replace("","");I(Ii=>Ii.replace(/\d{4}-\d{2}-\d{2}[]$/,`${br}${xs}`));return}if(E.key==="Enter"){E.preventDefault(),Et(!1),vn(0);return}if(E.key==="Escape"){E.preventDefault(),Et(!1),vn(0),I(Pt=>Pt.replace(/\d{4}-\d{2}-\d{2}[]$/,""));return}}const H=document.activeElement,ue=(H==null?void 0:H.classList.contains("ProseMirror"))||(H==null?void 0:H.closest(".ProseMirror")),Se=k&&k.trim()&&k!=="<p></p>";if(E.key==="Tab"&&!ue){Fu(E);return}if(E.key==="Tab"&&ue&&!Se){Fu(E);return}if(mt){if(E.key==="ArrowDown"){E.preventDefault(),He(Pt=>Pt===-1?0:(Pt+1)%We.length);return}if(E.key==="ArrowUp"){E.preventDefault(),He(Pt=>Pt<=0?We.length-1:Pt-1);return}if((E.ctrlKey||E.metaKey)&&E.key==="Enter"&&ct>=0&&(E.preventDefault(),I(We[ct].title),tt(!1)),E.key==="Escape"){E.preventDefault(),tt(!1);return}}if(!E.nativeEvent.isComposing){if((E.ctrlKey||E.metaKey)&&E.key==="Enter"&&!ue){E.preventDefault(),E.stopPropagation(),Xn();return}if((E.ctrlKey||E.metaKey)&&E.key==="Enter"&&ue){E.preventDefault(),E.stopPropagation(),(It=F.current)==null||It.focus();return}if(E.key==="Enter"&&!E.shiftKey){if(E.target.tagName==="TEXTAREA"||E.target.isContentEditable)return;E.preventDefault(),E.stopPropagation(),Xn()}if(E.key==="Escape"){if(vt){E.preventDefault(),E.stopPropagation(),At(!1),(Wt=he.current)==null||Wt.focus();return}if(Tn){E.preventDefault(),E.stopPropagation(),Ie(!1),(Gt=he.current)==null||Gt.focus();return}if(mt){E.preventDefault(),E.stopPropagation(),tt(!1);return}if(Dt){E.preventDefault(),E.stopPropagation(),zt(!1),(en=he.current)==null||en.focus();return}if(En.isOpen){E.preventDefault(),E.stopPropagation(),Or(Pt=>({...Pt,isOpen:!1}));return}if(Mt){E.preventDefault(),E.stopPropagation(),Et(!1);return}if(ue){E.preventDefault(),E.stopPropagation(),(pn=F.current)==null||pn.focus();return}}if(E.key==="Escape"&&e)if(E.preventDefault(),t&&!S.trim()){const Pt=y.findIndex(br=>br.data.id===t.id),wn=y[Pt-1];m(t.id),e(wn?wn.data.id:null)}else Xn()}},ik=E=>{if(ke(E),E&&_e){const[H,ue]=E.split(":").map(Number),[Se,at]=_e.split(":").map(Number);if(!isNaN(H)&&!isNaN(ue)&&!isNaN(Se)&&!isNaN(at)){const ot=H*60+ue,It=Se*60+at;if(ot<It)je((It-ot).toString());else{const Wt=Number(Ke)||60,Gt=ot+Wt,en=Math.floor(Gt/60)%24,pn=Gt%60;ve(`${String(en).padStart(2,"0")}:${String(pn).padStart(2,"0")}`)}}}},BR=E=>{if(ve(E),E&&ce){const[H,ue]=ce.split(":").map(Number),[Se,at]=E.split(":").map(Number);let ot=Se*60+at-(H*60+ue);ot<0&&(ot+=1440),je(ot.toString())}},UR=E=>{if(je(E),E&&!isNaN(Number(E))&&ce){const H=Number(E),[ue,Se]=ce.split(":").map(Number),at=new Date;at.setHours(ue,Se+H),ve(`${String(at.getHours()).padStart(2,"0")}:${String(at.getMinutes()).padStart(2,"0")}`)}},HR=f.fontWeight==="thin"?"font-extralight":"font-medium",VR=f.fontWeight==="thin"?"font-extralight":"font-normal",ok={small:"text-sm",normal:"text-base",large:"text-lg"}[f.fontSize]||"text-base",WR=t?`border-${rn}-200`:"border-gray-100/50",KR=()=>{const E=Ze?Math.max(10,Math.min(Ze.top,window.innerHeight-500)):0,H=Ze?Math.max(220,Math.min(Ze.left,window.innerWidth-220)):0,ue=c.jsxs(Rr.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:Ze?"fixed bg-white rounded-xl shadow-2xl border border-gray-100 p-4 flex flex-col gap-4 overflow-hidden w-[400px]":"absolute top-[30px] right-0 w-[400px] bg-white rounded-xl shadow-2xl border border-gray-100 z-[100] p-4 flex flex-col gap-4 overflow-hidden",style:Ze?{top:E,left:H,transform:"translateX(-50%)",zIndex:99999}:{},children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("h3",{className:"text-sm font-bold text-slate-800 flex items-center gap-2",children:[c.jsx(js,{className:"text-indigo-500",size:16}),"AI "]}),c.jsx("button",{onClick:Ae,className:"text-slate-400 hover:text-slate-600 transition-colors p-1 hover:bg-slate-100 rounded-full",children:c.jsx(on,{size:16})})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("input",{type:"text",placeholder:"...",className:"w-full px-3 py-2 text-xs bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none transition-all",value:mn,onChange:Se=>Cr(Se.target.value)}),!mn&&ji.length>0&&c.jsxs("div",{children:[c.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2",children:""}),c.jsx("div",{className:"flex flex-wrap gap-1.5",children:ji.map(Se=>c.jsx("button",{type:"button",onClick:()=>{qt(Se.description||Se.title),Cr("")},className:"text-[10px] px-2 py-1 rounded-full bg-indigo-50 text-indigo-600 hover:bg-indigo-100 transition-all border border-indigo-100 font-medium",title:Se.description||Se.title,children:Se.title},Se.id))})]}),c.jsx("textarea",{className:"w-full h-32 p-3 text-sm bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none resize-none transition-all placeholder:text-slate-300",placeholder:"...",value:Ft,onChange:Se=>qt(Se.target.value)}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"checkbox",id:"saveToLib",checked:Pn,onChange:Se=>Jn(Se.target.checked),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-slate-300"}),c.jsx("label",{htmlFor:"saveToLib",className:"text-xs text-slate-500 cursor-pointer select-none",children:""})]}),c.jsxs("div",{className:"flex gap-2 justify-end",children:[c.jsxs("button",{onClick:()=>$e(xee),className:"flex-1 py-2.5 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 rounded-xl text-[10px] font-bold transition-all border border-indigo-200 shadow-sm active:scale-95 flex flex-col items-center justify-center gap-0.5",title:"",children:[c.jsx(js,{size:12}),c.jsx("span",{children:""})]}),c.jsxs("button",{onClick:()=>$e(),className:"flex-1 py-2.5 bg-slate-50 hover:bg-slate-100 text-slate-600 rounded-xl text-[10px] font-bold transition-all border border-slate-200 shadow-sm active:scale-95 flex flex-col items-center justify-center gap-0.5",children:[c.jsx(ld,{size:12}),c.jsx("span",{children:""})]}),c.jsx("button",{onClick:()=>$e(Ft),disabled:!Ft.trim(),className:"flex-[2] py-2 bg-slate-800 hover:bg-slate-900 text-white rounded-xl text-xs font-bold transition-all shadow-md shadow-slate-200 disabled:opacity-50 disabled:grayscale active:scale-95",children:""})]})]}),sr.length>0&&c.jsxs("div",{className:"border-t border-gray-50 pt-3 mt-1",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest",children:mn?"":""}),mn&&gn>0&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:"text-[10px] text-gray-500",children:[gs+1," / ",gn]}),c.jsxs("div",{className:"flex gap-0.5",children:[c.jsx("button",{onClick:()=>{bn(Se=>Se>0?Se-1:gn-1)},className:"p-1 hover:bg-gray-100 rounded text-gray-400 hover:text-gray-600",title:" (Cmd+Shift+G)",children:c.jsx($0,{size:12})}),c.jsx("button",{onClick:()=>{bn(Se=>Se<gn-1?Se+1:0)},className:"p-1 hover:bg-gray-100 rounded text-gray-400 hover:text-gray-600",title:" (Cmd+G)",children:c.jsx(ds,{size:12})})]})]})]}),c.jsx("div",{className:"flex flex-col gap-1.5 max-h-[160px] overflow-y-auto custom-scrollbar pr-1",onKeyDown:Se=>{(Se.metaKey||Se.ctrlKey)&&Se.key==="g"&&(Se.preventDefault(),Se.shiftKey?bn(at=>at>0?at-1:gn-1):bn(at=>at<gn-1?at+1:0))},children:sr.map((Se,at)=>{const ot=eE(Se.description||""),It=(Wt,Gt,en)=>{if(!Gt.trim())return Wt;const pn=Wt.split(new RegExp(`(${Gt})`,"gi"));let Pt=0;for(let wn=0;wn<at;wn++){const br=sr[wn],Cs=eE(br.description||""),xs=(br.title.match(new RegExp(Gt,"gi"))||[]).length,Ii=Cs?(Cs.match(new RegExp(Gt,"gi"))||[]).length:0;Pt+=xs+Ii}if(!en){const wn=(Se.title.match(new RegExp(Gt,"gi"))||[]).length;Pt+=wn}return pn.map((wn,br)=>{if(wn.toLowerCase()===Gt.toLowerCase()){const Cs=Pt===gs,xs=c.jsx("mark",{className:`${Cs?"bg-orange-400 text-white ring-2 ring-orange-500":"bg-yellow-200 text-slate-900"} font-bold px-0.5 rounded`,ref:Cs?Ii=>{Ii&&Ii.scrollIntoView({behavior:"smooth",block:"center"})}:void 0,children:wn},br);return Pt++,xs}return wn})};return c.jsxs("button",{type:"button",onClick:()=>{qt(ot||Se.title),Cr(""),bn(0)},className:"flex-shrink-0 text-left text-[11px] p-2 rounded-xl hover:bg-indigo-50 text-slate-600 hover:text-indigo-700 transition-all border border-slate-100 hover:border-indigo-100 shadow-sm bg-white active:scale-[0.98]",title:ot||Se.title,children:[c.jsx("div",{className:"font-medium",children:It(Se.title,mn,!0)}),ot&&ot!==Se.title&&c.jsx("div",{className:"text-[10px] text-gray-400 mt-0.5 whitespace-pre-wrap line-clamp-3",children:It(ot,mn,!1)})]},Se.id)})})]})]},"prompt-modal");return Ze?er.createPortal(c.jsx(go,{children:Dt&&ue}),document.body):c.jsx(go,{children:Dt&&ue})};return c.jsxs("div",{ref:Le,className:`group transition-all w-full relative ${n||r?"bg-transparent":`mb-3 bg-white rounded-xl border ${WR} shadow-[0_4px_8px_rgba(0,0,0,0.08)]`} ${Q?"ring-2 ring-indigo-400 border-indigo-400 bg-indigo-50/10":""}`,onKeyDown:sk,onPaste:zu,onDragOver:E=>{E.preventDefault(),E.stopPropagation(),X(!0)},onDragLeave:E=>{E.preventDefault(),E.stopPropagation(),X(!1)},onDrop:E=>{E.preventDefault(),E.stopPropagation(),X(!1),ac(E)},children:[Q&&c.jsx("div",{className:"absolute inset-0 bg-indigo-500/10 backdrop-blur-[1px] z-[50] flex items-center justify-center rounded-xl pointer-events-none",children:c.jsxs("div",{className:"bg-white px-4 py-2 rounded-full shadow-lg border border-indigo-200 flex items-center gap-2",children:[c.jsx(nm,{className:"text-indigo-500 animate-bounce",size:20}),c.jsx("span",{className:"text-sm font-bold text-indigo-600",children:""})]})}),t&&!r&&c.jsx("button",{onClick:E=>{E.stopPropagation(),window.open(`${window.location.origin}/share/${t.id}`,"_blank")},className:"absolute top-4 right-4 md:opacity-0 group-hover:opacity-100 transition-opacity p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg z-20",title:" (Share Task)",children:c.jsx(R6,{size:16})}),c.jsxs("div",{className:`flex gap-4 ${t?"pl-5":"pl-6"} py-6`,children:[t?c.jsxs("div",{className:"mb-0.5",children:[" ",c.jsx(wA,{checked:$,onChange:E=>{E.stopPropagation(),rk()},size:20,color:rn,isRoot:!D})," "]}):c.jsx("button",{type:"button",tabIndex:-1,onClick:()=>ie(!z),className:`mb-0.5 h-6 w-6 flex items-center justify-center transition-all ${z?sn.accent:"text-gray-300 hover:text-gray-400"}`,children:z?c.jsx(NI,{size:18}):c.jsx(e6,{size:18})}),c.jsxs("div",{className:"flex-1 space-y-4 relative pr-6",children:[c.jsx("div",{className:"flex items-end justify-between",children:c.jsxs("div",{className:"flex-1 relative space-y-2",children:[D&&(()=>{const E=a.find(H=>H.id===D);return E?c.jsxs("button",{type:"button",onClick:H=>{H.stopPropagation(),t&&S.trim()&&Xn(),w(D,!0,"allview")},className:"flex items-center gap-1.5 text-xs text-theme-tertiary hover:text-indigo-600 transition-colors group/parent",children:[c.jsx($0,{size:12,className:"opacity-50 group-hover/parent:opacity-100"}),c.jsx("span",{className:"truncate max-w-[200px] group-hover/parent:underline",children:E.title||""})]}):null})(),Je.length>0&&c.jsxs("div",{className:"flex items-center gap-2 text-xs text-amber-600 bg-amber-50 p-2 rounded-lg mb-2",children:[c.jsx(Vf,{size:14,className:"shrink-0"}),c.jsxs("span",{children:["",Je.map((E,H)=>c.jsxs("span",{children:[H>0&&", ",c.jsx("button",{type:"button",onClick:ue=>{ue.stopPropagation(),w(E.id,!0)},className:"hover:underline font-medium",children:E.title})]},E.id))]})]}),c.jsxs("div",{className:"flex items-center relative gap-2",children:[c.jsx("input",{ref:F,autoFocus:!0,type:"text",name:"data_task_input",autoComplete:"off",autoCorrect:"off",spellCheck:"false",value:S,onKeyDown:E=>{E.key==="Enter"&&console.log("[TaskInputDebug] Enter pressed",{isComposing:E.nativeEvent.isComposing,titleLen:S.length}),sk(E)},onFocus:()=>ne(S.length>0),onBlur:()=>setTimeout(()=>ne(!1),200),onChange:E=>{const H=E.target.value;if(ne(H.length>0),H.endsWith("@ ")&&!Mt){Et(!0),vn(0);const ue=new Date,Se=ue.toLocaleDateString("sv-SE"),ot=["","","","","","",""][ue.getDay()].replace("","");I(H.slice(0,-2)+`${Se}${ot}`)}else Mt&&!H.match(/\d{4}-\d{2}-\d{2}[]$/)&&Et(!1),I(H)},placeholder:"...",className:`flex-1 ${ok} ${HR} transition-all duration-300 placeholder:font-light placeholder-gray-300 border-none bg-transparent focus:ring-0 outline-none p-0 leading-tight ${$?"opacity-30":Mt?"text-slate-400":"text-slate-800"}`}),se&&S.length>0&&(()=>{const E=a.filter(H=>H.id!==(t==null?void 0:t.id)&&H.title&&H.title.toLowerCase().includes(S.toLowerCase())&&H.title.toLowerCase()!==S.toLowerCase()).map(H=>H.title).filter((H,ue,Se)=>Se.indexOf(H)===ue).slice(0,5);return E.length===0?null:c.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 z-50 overflow-hidden animate-in slide-in-from-top-2 fade-in duration-200",children:E.map((H,ue)=>c.jsxs("button",{type:"button",onMouseDown:Se=>{Se.preventDefault(),I(H),ne(!1)},className:"w-full text-left px-4 py-2.5 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700/50 border-b border-slate-100 dark:border-slate-700/50 last:border-b-0 transition-colors flex items-center gap-2 group",children:[c.jsx("span",{className:"text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity",children:""}),c.jsx("span",{className:"truncate",children:H})]},ue))})})(),S.trim()&&c.jsx("button",{type:"button",onClick:E=>{E.preventDefault(),E.stopPropagation(),console.log("[TaskInput] Manual Button Submit"),Xn()},className:"p-1.5 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition-colors shadow-sm active:scale-95 flex-shrink-0 animate-in fade-in zoom-in duration-200",children:c.jsx(qz,{size:18})})]}),Fe&&er.createPortal(c.jsx("div",{className:"fixed inset-0 z-[9999999] flex items-center justify-center bg-black/20 backdrop-blur-sm",onClick:()=>bt(!1),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl border border-slate-200 p-4 w-[400px] max-w-[90vw] animate-in fade-in zoom-in-95 duration-200",onClick:E=>E.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between mb-3 border-b border-slate-100 pb-2",children:[c.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[c.jsx(js,{size:16,className:"text-amber-500"}),c.jsx("h3",{className:"font-bold text-sm",children:" AI "})]}),c.jsx("button",{onClick:()=>bt(!1),className:"text-slate-400 hover:text-slate-600",children:c.jsx(on,{size:16})})]}),c.jsxs("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:[c.jsxs("button",{onClick:()=>gt(),className:"w-full text-left p-3 rounded-lg border border-slate-100 hover:border-indigo-300 hover:bg-indigo-50 transition-all group",children:[c.jsx("div",{className:"font-medium text-sm text-slate-700 group-hover:text-indigo-700",children:" SEO "}),c.jsx("div",{className:"text-xs text-slate-500 mt-1",children:" SEO "})]}),rt.map(E=>c.jsxs("button",{onClick:()=>gt(E.description||""),className:"w-full text-left p-3 rounded-lg border border-slate-100 hover:border-amber-300 hover:bg-amber-50 transition-all group",children:[c.jsx("div",{className:"font-medium text-sm text-slate-700 group-hover:text-amber-700",children:E.title}),c.jsx("div",{className:"text-xs text-slate-500 mt-1 line-clamp-2",children:(E.description||"").replace(/<[^>]+>/g,"")})]},E.id))]})]})}),document.body),Tn&&er.createPortal(c.jsxs("div",{className:"fixed bg-theme-card rounded-xl shadow-2xl border border-theme p-4 animate-in fade-in zoom-in-95 duration-200",style:{top:F.current?F.current.getBoundingClientRect().bottom+8:100,left:F.current?F.current.getBoundingClientRect().left:100,width:F.current?F.current.getBoundingClientRect().width:300,zIndex:99999},children:[c.jsxs("div",{className:"flex items-center gap-2 text-indigo-400 mb-3",children:[c.jsx(s1,{size:14}),c.jsx("span",{className:"text-xs font-bold",children:"AI "})]}),c.jsx("input",{type:"text",autoFocus:!0,value:$t,onChange:E=>an(E.target.value),className:"w-full px-3 py-2 text-sm bg-theme-main border border-theme rounded-lg focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500/50 outline-none text-theme-primary",placeholder:"..."}),c.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[c.jsx("button",{type:"button",onClick:Oe,className:"px-3 py-1.5 text-xs text-theme-tertiary hover:bg-theme-hover rounded-lg transition-colors",children:""}),c.jsx("button",{type:"button",onClick:te,className:"px-3 py-1.5 text-xs bg-indigo-600 text-white hover:bg-indigo-700 rounded-lg transition-colors font-medium",children:""})]})]}),document.body),Qo&&er.createPortal(c.jsx("div",{className:"fixed inset-0 z-[9999999] flex items-center justify-center bg-black/20 backdrop-blur-sm",onClick:E=>{E.stopPropagation(),hn(!1)},onMouseDown:E=>E.stopPropagation(),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl border border-slate-200 p-5 w-[450px] max-w-[90vw] animate-in fade-in zoom-in-95 duration-200",onClick:E=>E.stopPropagation(),onMouseDown:E=>E.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between mb-4 border-b border-slate-100 pb-3",children:[c.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[c.jsx(Ol,{size:16,className:"text-emerald-500"}),c.jsx("h3",{className:"font-bold text-sm",children:"AI "})]}),c.jsx("button",{onClick:E=>{E.stopPropagation(),hn(!1)},onMouseDown:E=>E.stopPropagation(),className:"text-slate-400 hover:text-slate-600",children:c.jsx(on,{size:16})})]}),ko.length>0&&c.jsxs("div",{className:"mb-4",children:[c.jsx("p",{className:"text-xs text-slate-500 mb-2",children:" SEO   "}),c.jsx("div",{className:"flex flex-wrap gap-2",children:ko.map((E,H)=>c.jsxs("div",{className:"group flex items-center gap-1 px-3 py-1.5 bg-emerald-50 text-emerald-700 rounded-full text-xs font-medium border border-emerald-200 hover:bg-emerald-100 transition-all",onClick:ue=>ue.stopPropagation(),onMouseDown:ue=>ue.stopPropagation(),children:[c.jsx("span",{className:"text-emerald-500",children:"#"}),c.jsx("span",{children:E}),c.jsx("button",{onClick:ue=>{ue.stopPropagation(),Nt(E)},onMouseDown:ue=>ue.stopPropagation(),className:"ml-1 text-emerald-600 hover:text-emerald-800 p-0.5 hover:bg-emerald-200 rounded",title:"",children:c.jsx(tr,{size:12})}),c.jsx("button",{onClick:ue=>{ue.stopPropagation(),Bt(E)},onMouseDown:ue=>ue.stopPropagation(),className:"text-slate-400 hover:text-red-500 p-0.5 hover:bg-red-100 rounded",title:"",children:c.jsx(on,{size:12})})]},H))})]}),Ei&&c.jsxs("div",{className:"flex items-center justify-center py-6 text-slate-500",children:[c.jsx(Hi,{size:20,className:"animate-spin mr-2"}),c.jsx("span",{className:"text-sm",children:"..."})]}),c.jsxs("div",{className:"flex gap-2 justify-end mt-4 pt-3 border-t border-slate-100",children:[c.jsx("button",{onClick:E=>{E.stopPropagation(),hn(!1)},onMouseDown:E=>E.stopPropagation(),className:"px-4 py-2 text-xs text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:""}),c.jsxs("button",{onClick:E=>{E.stopPropagation(),ft()},onMouseDown:E=>E.stopPropagation(),disabled:Ei,className:"px-4 py-2 text-xs bg-indigo-600 text-white hover:bg-indigo-700 rounded-lg transition-colors font-medium disabled:opacity-50 flex items-center gap-1",children:[Ei?c.jsx(Hi,{size:12,className:"animate-spin"}):c.jsx(js,{size:12}),""]}),ko.length>0&&c.jsxs("button",{onClick:E=>{E.stopPropagation(),jt()},onMouseDown:E=>E.stopPropagation(),className:"px-4 py-2 text-xs bg-emerald-600 text-white hover:bg-emerald-700 rounded-lg transition-colors font-medium flex items-center gap-1",children:[c.jsx(tr,{size:12}),""]})]})]})}),document.body),mt&&c.jsx("div",{className:"w-full mt-1 mb-2",children:c.jsx("div",{className:"bg-theme-hover rounded-lg overflow-hidden border border-theme",children:We.map((E,H)=>c.jsxs("div",{className:`px-3 py-1.5 text-xs cursor-pointer transition-colors flex justify-between items-center ${H===ct?"bg-theme-selection text-theme-primary font-medium":"text-theme-secondary hover:bg-theme-hover"}`,onClick:()=>{I(E.title),tt(!1)},children:[c.jsx("span",{children:E.title}),H===ct&&c.jsx("span",{className:"text-[9px] text-indigo-400 font-normal",children:"Ctrl+Enter"})]},E.id))})}),c.jsxs("div",{className:"flex justify-end mb-1 gap-2",children:[c.jsxs("button",{type:"button",onClick:()=>{be(),lt(null)},disabled:it,className:`flex items-center gap-1.5 text-xs transition-colors disabled:opacity-50 px-2 py-0.5 rounded-full ${vt?"bg-indigo-500/20 text-indigo-400 font-bold shadow-sm ring-1 ring-indigo-500/30":"text-indigo-500 hover:text-indigo-400 hover:bg-indigo-500/10 font-medium"}`,title:"AI Assistant Brain",children:[it?c.jsx(Hi,{size:12,className:"animate-spin"}):c.jsx(js,{size:12}),c.jsx("span",{children:"AI "})]}),c.jsxs("button",{type:"button",onClick:Ve,disabled:Ot,className:`flex items-center gap-1.5 text-xs transition-colors disabled:opacity-50 px-2 py-0.5 rounded-full ${Ot?"bg-amber-500/20 text-amber-400 font-bold shadow-sm ring-1 ring-amber-500/30":"text-amber-500 hover:text-amber-400 hover:bg-amber-500/10 font-medium"}`,title:" SEO ",children:[Ot?c.jsx(Hi,{size:12,className:"animate-spin"}):c.jsx(s1,{size:12}),c.jsx("span",{children:"AI "})]}),c.jsxs("button",{type:"button",onClick:()=>{hn(!0),ft()},disabled:Ei,className:`flex items-center gap-1.5 text-xs transition-colors disabled:opacity-50 px-2 py-0.5 rounded-full ${Ei?"bg-emerald-500/20 text-emerald-400 font-bold shadow-sm ring-1 ring-emerald-500/30":"text-emerald-500 hover:text-emerald-400 hover:bg-emerald-500/10 font-medium"}`,title:" SEO ",children:[Ei?c.jsx(Hi,{size:12,className:"animate-spin"}):c.jsx(Ol,{size:12}),c.jsx("span",{children:"AI "})]}),KR()]}),c.jsxs("div",{className:"flex flex-col md:flex-row gap-4 transition-all duration-300 items-stretch h-full",children:[c.jsxs("div",{className:"flex-1 transition-all duration-300 overflow-y-auto max-h-[55vh] flex flex-col no-scrollbar",children:[Y&&c.jsx(T9,{url:Y.url,fileName:Y.name,autoPlay:!0,markers:(ak=Y.markers)==null?void 0:ak.filter(E=>dt.has(E.id)),seekToTime:oe,onClose:()=>{q(null),Ce(null)},onMarkerClick:E=>{ut.current&&ut.current.scrollToParagraph&&ut.current.scrollToParagraph(E.id)}}),c.jsx($v,{onEditorReady:E=>{ut.current=E},onPolish:(E,H,ue)=>{Xe(H),ue&&lt(ue),zt(!0),qt("")},initialContent:k,onChange:R,onExit:()=>{var E;return(E=W.current)==null?void 0:E.focus()},textSizeClass:ok,descFontClass:VR,className:"h-full",onSaveAudio:sl,onAudioMarkerClick:(E,H)=>{if(H){const Se=A.find(at=>at.recordingId===H);if(Se){q({url:Se.url,name:Se.name,markers:Se.markers}),Ce(Math.max(0,E-4e3));return}}if(Y){Ce(Math.max(0,E-4e3));return}const ue=A.find(Se=>{var at,ot;return Se.recordingId||((at=Se.type)==null?void 0:at.startsWith("audio/"))||((ot=Se.url)==null?void 0:ot.match(/\.(mp3|wav|webm|m4a|ogg)$/i))});ue&&(q({url:ue.url,name:ue.name,markers:ue.markers}),Ce(Math.max(0,E-4e3)))},activeMarkerIds:((lk=Y==null?void 0:Y.markers)==null?void 0:lk.filter(E=>dt.has(E.id)).map(E=>E.id))||null,onMarkersChange:E=>{xt(new Set(E.map(H=>H.id)))},attachments:A,taskColor:rn,availableTags:o.map(E=>({id:E.id,name:E.name,color:E.color,parent_id:E.parent_id,order_index:E.order_index})),onCreateTag:async E=>{if(!l)return null;try{const H=await l(E,null);if(H)return{id:H,name:E,color:"#6366f1"}}catch(H){console.error("Failed to create tag from editor",H),g==null||g({msg:"",type:"error"})}return null}})]}),vt&&(()=>{var Se,at;const E=Ze?Math.max(10,Math.min(Ze.top,window.innerHeight-500)):0,H=Ze?Math.min(Ze.left+220,window.innerWidth-360):0,ue=c.jsx("div",{className:Ze?"fixed w-[340px] shrink-0 animate-in slide-in-from-right-4 fade-in duration-300 flex flex-col max-h-[80vh] overflow-hidden bg-white rounded-2xl shadow-2xl":"w-full md:w-[340px] shrink-0 animate-in slide-in-from-right-4 md:slide-in-from-bottom-4 fade-in duration-500 border-l border-indigo-50 pl-0 md:pl-4 flex flex-col h-full overflow-hidden",style:Ze?{top:E,left:H,zIndex:99998}:{},children:it?c.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400 gap-4 bg-slate-50/50 rounded-2xl border border-dashed border-slate-200",children:[c.jsxs("div",{className:"relative",children:[c.jsx(ld,{size:32,className:"text-indigo-400 animate-pulse"}),c.jsx(js,{size:16,className:"absolute -top-1 -right-1 text-amber-400 animate-bounce"})]}),c.jsxs("div",{className:"flex flex-col items-center gap-1",children:[c.jsx("span",{className:"text-[11px] font-bold text-slate-500",children:"..."}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("div",{className:"w-1 h-1 bg-indigo-400 rounded-full animate-bounce [animation-delay:-0.3s]"}),c.jsx("div",{className:"w-1 h-1 bg-indigo-400 rounded-full animate-bounce [animation-delay:-0.15s]"}),c.jsx("div",{className:"w-1 h-1 bg-indigo-400 rounded-full animate-bounce"})]})]})]}):Yn.length>0?c.jsxs("div",{className:"flex flex-col gap-2 h-full",children:[c.jsxs("div",{className:"flex items-center justify-between px-2 pt-2",children:[c.jsxs("span",{className:"text-xs font-bold text-slate-400 ml-1",children:[" ",Un+1," / ",Yn.length]}),c.jsxs("div",{className:"flex items-center gap-1 bg-slate-100 rounded-lg p-0.5",children:[c.jsx("button",{onClick:()=>{const ot=Math.max(0,Un-1);Ni(ot),ii(Yn[ot].content)},disabled:Un===0,className:"p-1 hover:bg-white rounded-md disabled:opacity-30 transition-all text-slate-600",title:"",children:c.jsx(Du,{size:12})}),c.jsx("button",{onClick:()=>{const ot=Math.min(Yn.length-1,Un+1);Ni(ot),ii(Yn[ot].content)},disabled:Un===Yn.length-1,className:"p-1 hover:bg-white rounded-md disabled:opacity-30 transition-all text-slate-600",title:"",children:c.jsx(ts,{size:12})}),c.jsx("div",{className:"w-px h-3 bg-slate-300 mx-0.5"}),c.jsx("button",{onClick:()=>{const ot=Yn.filter((It,Wt)=>Wt!==Un);if(Pr(ot),ot.length!==0){const It=Math.min(Un,ot.length-1);Ni(It),ii(ot[It].content)}t&&i(t.id,{ai_history:ot},[],{skipHistory:!0})},className:"p-1 hover:bg-red-50 text-slate-400 hover:text-red-500 rounded-md transition-all",title:"",children:c.jsx(Ar,{size:12})})]})]}),c.jsxs("div",{className:"bg-white rounded-2xl shadow-xl shadow-indigo-100/20 border border-indigo-50 overflow-hidden flex flex-col animate-in zoom-in-95 duration-300 flex-1",children:[c.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 p-3 shrink-0",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2 text-white",children:[c.jsx(ld,{size:16,className:"animate-pulse"}),c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-xs font-bold tracking-wider",children:"AI "}),c.jsx("span",{className:"text-[10px] text-indigo-100 opacity-80 truncate max-w-[200px]",children:(Se=Yn[Un])==null?void 0:Se.prompt})]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:()=>{qt(""),zt(!0)},className:"p-1 text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-colors",title:"",children:c.jsx(js,{size:14})}),c.jsx("button",{onClick:()=>{At(!1),Xe(null)},className:"p-1 text-white/60 hover:text-white transition-colors",children:c.jsx(on,{size:14})})]})]})}),c.jsxs("div",{className:"p-4 flex flex-col gap-3 overflow-hidden flex-1",children:[Nr?c.jsx("textarea",{value:ic,onChange:ot=>ii(ot.target.value),className:"w-full h-full min-h-[200px] p-3 text-[13px] text-slate-700 leading-relaxed border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none resize-none"}):c.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar pr-1",children:c.jsx("div",{className:"markdown-content text-[13px] text-slate-700 leading-relaxed prose prose-sm prose-indigo max-w-none",children:c.jsx(nk,{children:((at=Yn[Un])==null?void 0:at.content)||""})})}),c.jsx("div",{className:"flex flex-col gap-2 pt-2 border-t border-slate-50 shrink-0",children:Nr?c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:()=>{const ot=[...Yn];ot[Un]={...ot[Un],content:ic},Pr(ot),t&&i(t.id,{ai_history:ot},[],{skipHistory:!0}),le(!1)},className:"flex-1 flex items-center justify-center gap-2 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-indigo-200 active:scale-95",children:[c.jsx(tr,{size:14}),""]}),c.jsx("button",{onClick:()=>{var ot;ii(((ot=Yn[Un])==null?void 0:ot.content)||""),le(!1)},className:"px-3 py-2 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-xl text-xs font-bold transition-all active:scale-95",children:""})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("button",{onClick:()=>{var ot;ii(((ot=Yn[Un])==null?void 0:ot.content)||""),le(!0)},className:"flex items-center justify-center gap-1.5 py-2 bg-slate-50 hover:bg-slate-100 text-slate-600 rounded-xl text-[11px] font-bold transition-all border border-slate-200 active:scale-95",children:[c.jsx(Tw,{size:13}),""]}),c.jsxs("button",{onClick:async()=>{var It,Wt;const ot=((It=o.find(Gt=>Gt.name.includes("")))==null?void 0:It.id)||await l("");ot&&(await s({title:` ${S||""}`,description:((Wt=Yn[Un])==null?void 0:Wt.content)||"",tags:[ot],status:"active",color:"purple"}),g==null||g({msg:"",type:"info"}))},className:"flex items-center justify-center gap-1.5 py-2 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-xl text-[11px] font-bold transition-all border border-purple-200 shadow-sm active:scale-95",children:[c.jsx(nu,{size:13}),""]})]}),c.jsxs("button",{onClick:()=>{var en,pn;const ot=((en=Yn[Un])==null?void 0:en.content)||"",It=((pn=Yn[Un])==null?void 0:pn.prompt)||"",Wt=ZC(ot);let Gt="AI ";if(It){const Pt=It.replace(/<[^>]*>/g,"").trim();Pt.includes("")||Pt.includes("")||Pt.includes("")?Gt="AI ":Pt.includes("")||Pt.includes("")||Pt.includes("")?Gt="AI ":Pt.includes("")||Pt.includes("")||Pt.includes("")?Gt="AI ":Pt.includes("")||Pt.includes("")?Gt="AI ":Pt.includes("")||Pt.includes("")||Pt.includes("translate")?Gt="AI ":Pt.includes("")||Pt.includes("")||Pt.includes("")?Gt="AI ":Pt.includes("")||Pt.includes("")?Gt="AI ":Pt.includes("")||Pt.includes("")?Gt="AI ":Pt.includes("")||Pt.includes("")?Gt="AI ":Pt.length>0&&(Gt="AI "+Pt.slice(0,6).replace(/[]/g,""))}R(Pt=>Pt+`<p><br><strong>--- ${Gt} ---</strong></p>`+Wt),g==null||g({msg:"",type:"info"}),At(!1)},className:"flex items-center justify-center gap-2 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-indigo-200 active:scale-95",children:[c.jsx(wI,{size:14}),""]}),we&&c.jsxs("button",{onClick:()=>{var ot;if(ut.current){const It=ut.current,Wt=we.from,Gt=((ot=Yn[Un])==null?void 0:ot.content)||"",en=ZC(Gt),pn=Wt;It.commands.insertContentAt(we,en),setTimeout(()=>{It.chain().setTextSelection({from:Wt,to:pn}).setHighlight({color:"#fef08a"}).setTextSelection(pn).focus().run(),Ct({from:Wt,to:pn})},50),Xe(null),lt(null),At(!1),g==null||g({msg:"",type:"info"})}},className:"flex items-center justify-center gap-2 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-xl text-xs font-bold transition-all border border-green-200 shadow-sm active:scale-95",children:[c.jsx(tr,{size:14}),""]})]})})]})]})]}):c.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400 gap-4 bg-slate-50/50 rounded-2xl border border-dashed border-slate-200",children:[c.jsx(ld,{size:32,className:"text-slate-300"}),c.jsx("span",{className:"text-xs text-slate-400",children:" AI "})]})});return Ze?er.createPortal(ue,document.body):ue})()]}),P.length>0&&c.jsx("div",{className:"grid grid-cols-4 gap-2 mt-2",children:P.map((E,H)=>{var ot;const ue=A.find(It=>It.url===E),Se=E.match(/\.(jpg|jpeg|png|gif|webp|avif)/i)||((ot=ue==null?void 0:ue.type)==null?void 0:ot.startsWith("image/")),at=(ue==null?void 0:ue.name)||"Image";return c.jsxs("div",{className:"relative group aspect-square rounded-lg overflow-hidden border border-gray-100 shadow-sm cursor-pointer bg-gray-50 flex items-center justify-center",onClick:()=>Se?ge(E):window.open(E,"_blank"),children:[Se?c.jsx("img",{src:E,alt:at,className:"w-full h-full object-cover transition-transform group-hover:scale-105"}):c.jsxs("div",{className:"flex flex-col items-center gap-1 p-2",children:[c.jsx("div",{className:"w-8 h-8 rounded bg-white border border-gray-200 flex items-center justify-center shadow-sm",children:c.jsx(co,{size:16,className:"text-gray-400"})}),c.jsx("span",{className:"text-[9px] text-gray-500 truncate w-full px-1 text-center font-medium leading-tight",children:at})]}),c.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors"}),c.jsx("button",{type:"button",onClick:It=>{It.stopPropagation(),il(E)},className:"absolute top-1 right-1 p-1 bg-black/50 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-500 z-10",children:c.jsx(on,{size:10})})]},H)})}),A.length>0&&c.jsxs("div",{className:"mt-2",children:[c.jsxs("button",{type:"button",onClick:()=>dn(!yn),className:`w-full flex items-center justify-between gap-2 px-2.5 py-1.5 rounded-lg border transition-all ${yn?"bg-indigo-50 border-indigo-200":"bg-gray-50 border-gray-100 hover:bg-gray-100"}`,children:[c.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[c.jsx(co,{size:12,className:yn?"text-indigo-500":"text-gray-400"}),c.jsxs("span",{className:`text-xs font-medium ${yn?"text-indigo-700":"text-gray-600"}`,children:[A.length," "]}),A.filter(E=>{var H;return((H=E.type)==null?void 0:H.startsWith("audio/"))||E.name.match(/\.(mp3|wav|ogg|m4a|webm)$/i)}).length>0&&c.jsxs("span",{className:"text-[10px] text-indigo-500 bg-indigo-50 px-1.5 py-0.5 rounded-full flex items-center gap-1",children:[c.jsx(r1,{size:9}),A.filter(E=>{var H;return((H=E.type)==null?void 0:H.startsWith("audio/"))||E.name.match(/\.(mp3|wav|ogg|m4a|webm)$/i)}).length]}),!yn&&c.jsx("span",{className:"text-[10px] text-gray-400 truncate max-w-[200px]",children:A.map(E=>E.name.split(".")[0]).join(", ")})]}),c.jsx(ds,{size:14,className:`text-gray-400 transition-transform ${yn?"rotate-180":""}`})]}),yn&&c.jsx("div",{className:"mt-1.5 space-y-1 animate-in slide-in-from-top-2 duration-200",children:A.map(E=>{var H;return c.jsxs("div",{className:`group flex items-center gap-2 px-2 py-1 rounded-md border transition-colors ${(Y==null?void 0:Y.url)===E.url?"bg-indigo-50 border-indigo-200 ring-1 ring-indigo-300/50":"bg-theme-card border-theme hover:border-theme"}`,children:[(H=E.type)!=null&&H.startsWith("audio/")||E.name.match(/\.(mp3|wav|ogg|m4a|webm|mp4)$/i)?c.jsx("button",{type:"button",onClick:ue=>{ue.preventDefault(),q({url:E.url,name:E.name,markers:E.markers})},className:"p-0.5 text-indigo-500 bg-indigo-50 rounded-full hover:bg-indigo-100",children:c.jsx(r1,{size:10})}):c.jsx(co,{size:10,className:"text-gray-400 flex-shrink-0"}),c.jsx("input",{ref:ue=>{ue&&pt===E.url&&(ue.focus(),nt(null))},type:"text",value:E.name,onChange:ue=>{const Se=ue.target.value;M(at=>at.map(ot=>ot.url===E.url?{...ot,name:Se}:ot))},onBlur:()=>{t&&i(t.id,{attachments:A},[],{skipHistory:!0})},onKeyDown:ue=>{var Se;ue.key==="Enter"&&(ue.preventDefault(),ue.stopPropagation(),ue.target.blur(),(Se=Qe.current)==null||Se.focus())},className:"flex-1 text-[11px] text-theme-secondary bg-transparent border-none focus:outline-none focus:bg-indigo-50/50 rounded px-1 truncate min-w-0"}),c.jsx("button",{type:"button",onClick:ue=>{ue.preventDefault(),fetch(E.url).then(Se=>Se.blob()).then(Se=>{const at=window.URL.createObjectURL(Se),ot=document.createElement("a");ot.href=at,ot.download=E.name,document.body.appendChild(ot),ot.click(),window.URL.revokeObjectURL(at),document.body.removeChild(ot)}).catch(Se=>console.error("Download failed:",Se))},className:"p-0.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors opacity-0 group-hover:opacity-100",title:"",children:c.jsx(nu,{size:10})}),c.jsx("span",{className:"text-[9px] text-gray-400 flex-shrink-0",children:FR(E.size)}),c.jsx("button",{type:"button",onClick:()=>LR(E.url),className:"opacity-0 group-hover:opacity-100 p-0.5 hover:bg-red-50 rounded transition-all",children:c.jsx(on,{size:10,className:"text-gray-400 hover:text-red-500"})})]},E.url)})})]})]})}),c.jsxs("div",{className:"flex items-center justify-between pt-1 flex-col items-start gap-2",children:[j.length>0&&(()=>{const E=j.filter(ue=>{const Se=o.find(at=>at.id===ue);return Se&&!Se.name.startsWith("#")}),H=j.filter(ue=>{const Se=o.find(at=>at.id===ue);return Se&&Se.name.startsWith("#")});return c.jsxs("div",{className:"flex flex-col gap-2 px-1 w-full",children:[E.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1",children:E.map(ue=>{const Se=o.find(at=>at.id===ue);return Se?c.jsx(vA,{tag:Se,onRemove:()=>O(at=>at.filter(ot=>ot!==ue))},ue):null})}),H.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1 pt-1 border-t border-emerald-100",children:H.map(ue=>{const Se=o.find(at=>at.id===ue);return Se?c.jsxs("div",{className:"flex items-center gap-1 h-5 px-2 rounded-full text-[10px] font-medium bg-emerald-50 text-emerald-700 border border-emerald-200",children:[c.jsx("span",{children:Se.name}),c.jsx("button",{type:"button",onClick:()=>O(at=>at.filter(ot=>ot!==ue)),className:"hover:text-red-500 transition-colors",children:c.jsx(on,{size:10})})]},ue):null})})]})})(),c.jsxs("div",{className:"flex flex-col gap-3 w-full border-t border-gray-100 pt-3 mt-1",children:[c.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[!_&&c.jsxs("button",{type:"button",onClick:()=>N(new Date().toISOString()),className:"flex items-center gap-1 px-2 py-1.5 rounded-md bg-indigo-500/10 text-indigo-500 text-[10px] font-bold border border-indigo-500/20 hover:bg-indigo-500/20 transition-all animate-pulse hover:animate-none",title:"",children:[c.jsx(js,{size:11})," "]}),c.jsx(k_,{innerRef:W,label:"",value:_||void 0,onChange:N,theme:sn,tasks:a}),_&&c.jsx("div",{className:"flex items-center gap-2 bg-transparent rounded-md px-2 py-1 border border-theme",children:c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{ref:B,type:"checkbox",checked:K,onChange:E=>{const H=E.target.checked;de(H),H||setTimeout(()=>{var ue,Se;(ue=J.current)==null||ue.focus(),(Se=J.current)==null||Se.select()},50)},className:"w-3 h-3 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-tighter",children:""})]})}),_&&c.jsx(yee,{value:pe,onChange:ee}),c.jsx(k_,{tabIndex:-1,label:"",value:C||void 0,onChange:T,colorClass:"text-red-500",tasks:a,theme:sn}),c.jsx(N1,{innerRef:ze,icon:Ol,label:"",items:gr,selectedIds:j,placeholder:"...",allowAdd:!0,onDeleteItem:u,multiSelect:!0,theme:sn,onSelect:async(E,H,ue)=>{if(E)O(Se=>Se.includes(E)?Se.filter(at=>at!==E):[...Se,E]);else if(H){const Se=await l(H,ue??null);Se&&O(at=>[...at,Se])}}}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{type:"button",onClick:()=>Pe(!ye),className:`flex items-center gap-1 px-2 py-1.5 rounded-md text-[10px] font-bold border transition-all ${V?"bg-purple-50 text-purple-600 border-purple-200 hover:bg-purple-100":"bg-transparent text-theme-tertiary border-theme hover:bg-theme-hover"}`,title:"",children:[c.jsx(RI,{size:12}),V&&V.originalText||""]}),ye&&c.jsxs("div",{className:"absolute top-full left-0 mt-1 z-50 bg-white rounded-lg shadow-xl border border-gray-200 p-4 min-w-[280px]",children:[c.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-3",children:""}),c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsx("div",{className:"grid grid-cols-4 gap-1",children:[{type:"daily",label:""},{type:"weekly",label:""},{type:"monthly",label:""},{type:"yearly",label:""}].map(E=>c.jsx("button",{type:"button",onClick:()=>{re(H=>({...H,type:E.type,interval:(H==null?void 0:H.interval)||1,originalText:`${(H==null?void 0:H.interval)||1}${E.type==="daily"?"":E.type==="weekly"?"":E.type==="monthly"?"":""}`,triggerMode:(H==null?void 0:H.triggerMode)||"on_complete"}))},className:`px-2 py-1.5 rounded text-xs font-medium transition-colors ${(V==null?void 0:V.type)===E.type?"bg-purple-500 text-white":"bg-gray-100 text-gray-600 hover:bg-purple-100"}`,children:E.label},E.type))})]}),V&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-sm text-gray-600",children:""}),c.jsx("input",{type:"number",min:1,max:365,value:V.interval,onChange:E=>{const H=Math.max(1,parseInt(E.target.value)||1);re(ue=>ue?{...ue,interval:H,originalText:`${H}${ue.type==="daily"?"":ue.type==="weekly"?"":ue.type==="monthly"?"":""}`}:null)},className:"w-16 px-2 py-1 border border-gray-300 rounded text-sm text-center focus:border-purple-400 focus:outline-none"}),c.jsx("span",{className:"text-sm text-gray-600",children:V.type==="daily"?"":V.type==="weekly"?"":V.type==="monthly"?"":""})]})]}),(V==null?void 0:V.type)==="monthly"&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-sm text-gray-600",children:""}),c.jsx("input",{type:"number",min:1,max:31,value:V.monthDay||1,onChange:E=>{const H=Math.min(31,Math.max(1,parseInt(E.target.value)||1));re(ue=>ue?{...ue,monthDay:H,originalText:`${ue.interval}${H}`}:null)},className:"w-16 px-2 py-1 border border-gray-300 rounded text-sm text-center focus:border-purple-400 focus:outline-none"}),c.jsx("span",{className:"text-sm text-gray-600",children:""})]})]}),V&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:""}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-gray-50",children:[c.jsx("input",{type:"radio",name:"triggerMode",checked:V.triggerMode!=="on_schedule",onChange:()=>re(E=>E?{...E,triggerMode:"on_complete"}:null),className:"text-purple-500"}),c.jsxs("div",{children:[c.jsx("div",{className:"text-xs font-medium text-gray-700",children:""}),c.jsx("div",{className:"text-[10px] text-gray-400",children:""})]})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-gray-50",children:[c.jsx("input",{type:"radio",name:"triggerMode",checked:V.triggerMode==="on_schedule",onChange:()=>re(E=>E?{...E,triggerMode:"on_schedule"}:null),className:"text-purple-500"}),c.jsxs("div",{children:[c.jsx("div",{className:"text-xs font-medium text-gray-700",children:""}),c.jsx("div",{className:"text-[10px] text-gray-400",children:""})]})]})]})]}),V&&c.jsx("div",{className:"mb-3",children:c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-gray-50",children:[c.jsx("input",{type:"checkbox",checked:V.copyDescription!==!1,onChange:E=>re(H=>H?{...H,copyDescription:E.target.checked}:null),className:"w-3.5 h-3.5 text-purple-600 rounded border-gray-300 focus:ring-purple-500"}),c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-xs font-medium text-gray-700",children:""}),c.jsx("span",{className:"text-[10px] text-gray-400",children:""})]})]})}),V&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-1",children:" ()"}),c.jsx("input",{type:"date",value:V.endDate||"",onChange:E=>re(H=>H?{...H,endDate:E.target.value||void 0}:null),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:border-purple-400 focus:outline-none",placeholder:""}),V.endDate&&c.jsx("button",{type:"button",onClick:()=>re(E=>E?{...E,endDate:void 0}:null),className:"text-[10px] text-red-500 hover:underline mt-1",children:""})]}),c.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-100",children:[c.jsx("button",{type:"button",onClick:()=>{re(null),Pe(!1)},className:"text-xs text-red-500 hover:text-red-600 font-medium",children:""}),c.jsx("button",{type:"button",onClick:()=>Pe(!1),className:"px-3 py-1 bg-purple-500 text-white text-xs font-medium rounded hover:bg-purple-600 transition-colors",children:""})]})]})]})]}),c.jsx(go,{children:!K&&_&&c.jsxs(Rr.div,{initial:{height:0,opacity:0,marginTop:0},animate:{height:"auto",opacity:1,marginTop:0},exit:{height:0,opacity:0,marginTop:0},className:"overflow-hidden flex items-center gap-3 px-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Yi,{size:12,className:"text-theme-tertiary"}),c.jsxs("div",{className:"flex items-center bg-transparent border border-theme rounded-md px-2 py-0.5",children:[c.jsx("input",{ref:J,type:"text",value:ce,onChange:E=>ik(E.target.value),onKeyDown:E=>{E.key==="Tab"?Fu(E):E.stopPropagation()},placeholder:"09:00",className:"bg-transparent border-none text-[11px] font-medium text-theme-primary focus:ring-0 outline-none p-0 w-12 placeholder:text-theme-tertiary"}),f.timeFormat==="12h"&&c.jsx("button",{onClick:()=>{const[E,H]=ce.split(" ");H&&ik(`${E} ${H==="AM"?"PM":"AM"}`)},className:"text-[10px] font-bold text-theme-tertiary hover:text-theme-secondary ml-1",children:ce.includes("PM")?"PM":"AM"})]}),c.jsx("span",{className:"text-theme-tertiary text-xs",children:""}),c.jsxs("div",{className:"flex items-center bg-transparent border border-theme rounded-md px-2 py-0.5",children:[c.jsx("input",{ref:fe,type:"text",value:_e,onChange:E=>BR(E.target.value),onKeyDown:E=>{E.key==="Tab"?Fu(E):E.stopPropagation()},placeholder:"10:00",className:"bg-transparent border-none text-[11px] font-medium text-theme-primary focus:ring-0 outline-none p-0 w-12 placeholder:text-theme-tertiary"}),f.timeFormat==="12h"&&c.jsx("span",{className:"text-[9px] font-bold text-indigo-400 ml-1",children:(()=>{const E=_e.split(":");if(E.length!==2)return"";const H=parseInt(E[0]),ue=parseInt(E[1]);return isNaN(H)||isNaN(ue)?"":`${H%12||12}:${String(ue).padStart(2,"0")}${H<12?"AM":"PM"}`})()})]})]}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsxs("div",{className:"relative",children:[c.jsx("input",{ref:Re,type:"text",placeholder:"",value:Ke,onChange:E=>UR(E.target.value),onKeyDown:E=>{E.key==="Tab"?Fu(E):E.stopPropagation()},className:"w-14 bg-transparent border border-theme rounded-md px-2 py-0.5 text-[11px] font-medium text-theme-primary focus:ring-1 focus:ring-indigo-100 outline-none placeholder:text-theme-tertiary"}),c.jsx("span",{className:"absolute right-2 top-1.5 text-[8px] text-gray-400 font-bold pointer-events-none",children:"MIN"})]})})]})}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"file",ref:Ue,className:"hidden",multiple:!0,accept:"image/*",onChange:ac}),c.jsxs("button",{type:"button",tabIndex:-1,onClick:()=>{var E;return(E=Ue.current)==null?void 0:E.click()},className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border border-transparent hover:border-theme hover:bg-theme-hover text-theme-tertiary hover:text-theme-secondary focus:outline-none focus:bg-white focus:ring-1 ${(sn==null?void 0:sn.buttonRing)||"focus:ring-indigo-300"} focus:border-theme text-xs ${f.fontWeight==="thin"?"font-light":"font-medium"}`,children:[qe?c.jsx(Hi,{size:13,className:"animate-spin"}):c.jsx(nm,{size:13}),c.jsx("span",{children:""})]}),c.jsx("input",{ref:De,type:"file",multiple:!0,className:"hidden",onChange:PR}),c.jsxs("button",{ref:Qe,type:"button",tabIndex:-1,onClick:()=>{var E;return(E=De.current)==null?void 0:E.click()},className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border border-transparent hover:border-theme hover:bg-theme-hover text-theme-tertiary hover:text-theme-secondary focus:outline-none focus:bg-white focus:ring-1 ${(sn==null?void 0:sn.buttonRing)||"focus:ring-indigo-300"} focus:border-theme text-xs ${f.fontWeight==="thin"?"font-light":"font-medium"}`,children:[qe?c.jsx(Hi,{size:13,className:"animate-spin"}):c.jsx(co,{size:13}),c.jsx("span",{children:v("attachFiles")})]}),c.jsxs("button",{type:"button",tabIndex:-1,onMouseDown:E=>E.preventDefault(),onClick:()=>{si?So===(t==null?void 0:t.id)?rl():g==null||g({msg:"",type:"warning"}):t!=null&&t.id?nl(t.id):g==null||g({msg:"",type:"warning"})},className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md transition-all border border-transparent hover:border-theme hover:bg-theme-hover text-theme-tertiary hover:text-theme-secondary focus:outline-none focus:bg-theme-card focus:ring-1 ${(sn==null?void 0:sn.buttonRing)||"focus:ring-indigo-300"} focus:border-theme text-xs ${f.fontWeight==="thin"?"font-light":"font-medium"} ${si&&So===(t==null?void 0:t.id)?"text-red-500 animate-pulse":""}`,title:si?"":"",children:[c.jsx(II,{size:13,strokeWidth:si&&So===(t==null?void 0:t.id)?3:2}),c.jsx("span",{children:si&&So===(t==null?void 0:t.id)?_o(ys):""})]}),c.jsx(N1,{tabIndex:-1,icon:$0,label:"",items:Rn,allowAdd:!0,selectedIds:D?[D]:[],placeholder:"...",theme:sn,onSelect:async(E,H)=>{let ue=E;if(!ue&&H&&(ue=await s({title:H,is_project:!0,status:"inbox"})),!ue&&!E)return;const Se=ue===D?null:ue;Te(Se),t&&(Se&&h(Se,!0),await i(t.id,{parent_id:Se},[]))}})]}),!D&&c.jsxs("div",{className:"relative",children:[c.jsxs("button",{type:"button",onClick:()=>Me(!me),className:"flex items-center gap-1.5 px-2 py-1.5 rounded-md border border-transparent hover:border-theme hover:bg-theme-hover transition-all group",title:"",children:[c.jsx("div",{className:`w-3 h-3 rounded-full ${((ck=Kn[Be])==null?void 0:ck.dot)||"bg-gray-400"} group-hover:scale-110 transition-transform`}),c.jsx("span",{className:"text-xs text-theme-tertiary group-hover:text-theme-secondary",children:""})]}),me&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>Me(!1)}),c.jsxs("div",{className:"absolute bottom-full left-0 mb-2 p-3 bg-white rounded-xl shadow-xl border border-gray-200 z-50 min-w-[200px] animate-in zoom-in-95 duration-100",children:[c.jsxs("div",{className:"text-xs font-semibold text-gray-500 mb-2 px-1 flex items-center gap-2",children:[c.jsx(_w,{size:12}),""]}),c.jsx("div",{className:"grid grid-cols-6 gap-2",children:Object.keys(Kn).map(E=>c.jsx("button",{type:"button",onClick:()=>{st(E),Me(!1)},className:`w-5 h-5 rounded-full ${Kn[E].dot} ${Be===E?"ring-2 ring-offset-2 ring-gray-400 scale-110":"hover:scale-125 opacity-80 hover:opacity-100"} transition-all shadow-sm`,title:E},E))})]})]})]}),c.jsx("div",{className:"flex gap-1 p-1 bg-theme-hover rounded-lg border border-theme",title:"",children:[{level:"urgent",color:"bg-red-500",label:"",icon:""},{level:"planned",color:"bg-yellow-400",label:"",icon:""},{level:"delegated",color:"bg-green-500",label:"",icon:""},{level:"optional",color:"bg-gray-400",label:"",icon:""}].map(({level:E,color:H,label:ue})=>c.jsx("button",{tabIndex:-1,type:"button",onClick:()=>Z(ae===E?void 0:E),title:ue,className:`w-4 h-4 rounded-full ${H} ${ae===E?"ring-2 ring-offset-1 ring-gray-500 scale-110":"opacity-50 hover:opacity-100 hover:scale-105"} transition-all`},E))})]})]})]})]})]}),wt&&c.jsx("div",{className:"fixed inset-0 z-[100] bg-black/90 flex items-center justify-center p-4",onClick:()=>ge(null),children:c.jsxs("div",{className:"relative max-w-full max-h-full",onClick:E=>E.stopPropagation(),children:[c.jsx("img",{src:wt,alt:"Preview",className:"max-w-full max-h-[90vh] rounded-lg shadow-2xl"}),c.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[c.jsx("a",{href:wt,download:`attachment-${Date.now()}`,target:"_blank",rel:"noopener noreferrer",onClick:E=>E.stopPropagation(),className:"p-2 bg-black/50 hover:bg-black/70 text-white rounded-full backdrop-blur-sm transition-colors",title:"Download",children:c.jsx(nu,{size:20})}),c.jsx("button",{onClick:()=>ge(null),className:"p-2 bg-black/50 hover:bg-black/70 text-white rounded-full backdrop-blur-sm transition-colors",children:c.jsx(on,{size:20})})]})]})}),En.isOpen&&c.jsx("div",{className:"fixed inset-0 z-[150] flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm",onClick:()=>Or({...En,isOpen:!1}),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 max-w-lg w-full animate-in zoom-in duration-200",onClick:E=>E.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[c.jsx(js,{size:18,className:"text-indigo-500"}),c.jsx("span",{children:v("aiPolishSuggestions")})]}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("button",{onClick:Ln,disabled:En.historyIndex<=0,className:"p-1.5 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors disabled:opacity-30 disabled:hover:bg-transparent disabled:hover:text-gray-500",title:v("undo"),children:c.jsx(Cw,{size:16})}),c.jsx("button",{onClick:mr,disabled:En.historyIndex>=En.history.length-1,className:"p-1.5 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors disabled:opacity-30 disabled:hover:bg-transparent disabled:hover:text-gray-500",title:v("redo"),children:c.jsx(MI,{size:16})})]})]}),c.jsxs("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2",children:v("suggestedTitle")}),c.jsx("input",{className:"w-full p-2 mb-3 bg-white border border-gray-200 rounded-lg text-sm text-gray-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none shadow-sm transition-all font-medium",value:En.title,onChange:E=>jn(E.target.value),onKeyDown:E=>{(E.ctrlKey||E.metaKey)&&E.key==="z"?(E.preventDefault(),E.stopPropagation(),E.shiftKey?mr():Ln()):(E.ctrlKey||E.metaKey)&&E.key==="y"&&(E.preventDefault(),E.stopPropagation(),mr())}}),c.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2",children:v("suggestedContent")}),c.jsx("textarea",{className:"w-full h-40 p-3 bg-white border border-gray-200 rounded-lg text-sm text-gray-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none resize-none leading-relaxed shadow-sm transition-all",value:En.content,onChange:E=>oi(E.target.value),onKeyDown:E=>{(E.ctrlKey||E.metaKey)&&E.key==="z"?(E.preventDefault(),E.stopPropagation(),E.shiftKey?mr():Ln()):(E.ctrlKey||E.metaKey)&&E.key==="y"&&(E.preventDefault(),E.stopPropagation(),mr())}})]}),c.jsxs("div",{className:"flex gap-3 justify-end",children:[c.jsx("button",{onClick:()=>Or({...En,isOpen:!1}),className:"px-4 py-1.5 text-gray-600 hover:bg-gray-100 rounded text-sm font-medium transition-colors",children:v("cancel")}),c.jsxs("button",{onClick:()=>{I(En.title),R(En.content),Or({...En,isOpen:!1,history:[],historyIndex:-1}),g({msg:v("aiPolishApplied"),type:"info"})},className:"px-4 py-1.5 bg-[#2563EB] hover:bg-[#1d4ed8] text-white rounded text-sm font-medium shadow-sm transition-colors flex items-center gap-1.5",children:[c.jsx(tr,{size:14,strokeWidth:3}),v("confirmReplace")]})]})]})})]})},bee=["gray","blue","indigo","red","orange","amber","green","teal","cyan","sky","purple","fuchsia","pink","rose"],tE={gray:"bg-gray-400",blue:"bg-blue-500",indigo:"bg-indigo-500",red:"bg-red-500",orange:"bg-orange-500",amber:"bg-amber-500",green:"bg-green-500",teal:"bg-teal-500",cyan:"bg-cyan-500",sky:"bg-sky-500",purple:"bg-purple-500",fuchsia:"bg-fuchsia-500",pink:"bg-pink-500",rose:"bg-rose-500"},nE=({text:t,query:e})=>{if(!e.trim()||!t)return c.jsx(c.Fragment,{children:t});try{const n=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp(`(${n})`,"gi"),s=t.split(r);return c.jsx(c.Fragment,{children:s.map((i,o)=>i.toLowerCase()===e.toLowerCase()?c.jsx("mark",{className:"bg-yellow-200 text-yellow-900 px-0.5 rounded",children:i},o):c.jsx("span",{children:i},o))})}catch{return c.jsx(c.Fragment,{children:t})}},wee=({isOpen:t,onClose:e})=>{const{tasks:n,tags:r,searchHistory:s,addSearchHistory:i,deleteSearchHistory:o,setEditingTaskId:a,editingTaskId:l,navigateToTask:u,verifyTaskPassword:d,temporarilyUnlockTask:f,setToast:h}=b.useContext(_n),[p,m]=b.useState(""),[y,x]=b.useState({tags:[],startDate:null,endDate:null,colors:[]}),[g,v]=b.useState("or"),[w,S]=b.useState(""),[I,k]=b.useState(!1),[R,C]=b.useState(""),[T,_]=b.useState(!1),N=b.useRef(null),[j,O]=b.useState(!1),[P,G]=b.useState(""),[A,M]=b.useState(null),[Q,X]=b.useState(null);b.useEffect(()=>{t&&N.current&&N.current.focus()},[t]);const D=b.useMemo(()=>!p.trim()&&y.tags.length===0&&!y.startDate&&!y.endDate&&y.colors.length===0?[]:n.filter(ae=>{if(ae.status==="deleted")return!1;const Z=p.toLowerCase(),K=!p.trim()||ae.title.toLowerCase().includes(Z)||ae.description&&ae.description.toLowerCase().includes(Z);let de=!0;if(y.tags.length>0){const _e=ae.tags||[];g==="and"?de=y.tags.every(ve=>_e.includes(ve)):de=y.tags.some(ve=>_e.includes(ve))}let ce=!0;if(y.startDate||y.endDate){const _e=ae.start_date||ae.due_date;if(!_e)ce=!1;else{const ve=je=>{const V=new Date(je);return isNaN(V.getTime())?NaN:V.setHours(0,0,0,0)},Ke=ve(_e);if(isNaN(Ke))ce=!1;else{if(y.startDate){const je=ve(y.startDate);!isNaN(je)&&Ke<je&&(ce=!1)}if(y.endDate){const je=ve(y.endDate);!isNaN(je)&&Ke>je&&(ce=!1)}}}}const ke=y.colors.length===0||y.colors.includes(ae.color);return K&&de&&ce&&ke}),[n,p,y,g]),Te=()=>{(p.trim()||y.tags.length>0||y.startDate||y.endDate||y.colors.length>0)&&i(p,y)},xe=()=>{R.trim()&&(i(p,y,R.trim()),C(""),_(!1))},U=ae=>{m(ae.query),x(ae.filters)},z=ae=>{x(Z=>({...Z,tags:Z.tags.includes(ae)?Z.tags.filter(K=>K!==ae):[...Z.tags,ae]}))},ie=ae=>{x(Z=>({...Z,colors:Z.colors.includes(ae)?Z.colors.filter(K=>K!==ae):[...Z.colors,ae]}))},Be=()=>{x({tags:[],startDate:null,endDate:null,colors:[]})},st=y.tags.length>0||y.startDate||y.endDate||y.colors.length>0;return b.useEffect(()=>{if(!t)return;const ae=Z=>{var K,de,ce;if(Z.key===" "&&((K=document.activeElement)!=null&&K.closest("[data-search-modal]"))&&((de=document.activeElement)==null?void 0:de.tagName)!=="INPUT"&&((ce=document.activeElement)==null?void 0:ce.tagName)!=="TEXTAREA"&&Z.stopPropagation(),Z.key==="Escape"){if(l)return;e()}};return window.addEventListener("keydown",ae,!0),()=>window.removeEventListener("keydown",ae,!0)},[t,e,l]),t?c.jsxs(c.Fragment,{children:[er.createPortal(c.jsx(go,{children:c.jsx(Rr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-start justify-center pt-20",onClick:e,"data-search-modal":!0,children:c.jsxs(Rr.div,{initial:{opacity:0,scale:.95,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20},transition:{duration:.2},className:"w-full max-w-2xl bg-theme-card rounded-2xl shadow-2xl overflow-hidden",onClick:ae=>ae.stopPropagation(),children:[c.jsxs("div",{className:"p-4 border-b border-theme",children:[c.jsxs("div",{className:"flex items-center gap-3 bg-theme-hover rounded-xl px-4 py-3",children:[c.jsx(Fc,{size:20,className:"text-theme-tertiary"}),c.jsx("input",{ref:N,type:"text",value:p,onChange:ae=>m(ae.target.value),onKeyDown:ae=>{ae.key==="Enter"&&Te()},placeholder:"...",className:"flex-1 bg-transparent outline-none text-theme-primary placeholder-theme-tertiary"}),p&&c.jsx("button",{onClick:()=>m(""),className:"text-theme-tertiary hover:text-theme-primary",children:c.jsx(on,{size:18})})]}),c.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[c.jsxs("button",{onClick:()=>k(!I),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors ${I||st?"bg-indigo-100 text-indigo-700":"bg-theme-hover text-theme-secondary hover:bg-theme-hover/80"}`,children:[I?c.jsx(ds,{size:14}):c.jsx(ts,{size:14}),"",st&&c.jsx("span",{className:"ml-1 w-5 h-5 bg-indigo-500 text-white rounded-full flex items-center justify-center text-[10px]",children:y.tags.length+(y.startDate||y.endDate?1:0)+y.colors.length})]}),c.jsxs("button",{onClick:()=>{m(""),x({tags:[],startDate:null,endDate:null,colors:[]})},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium bg-theme-hover text-theme-secondary hover:bg-theme-hover/80 transition-colors",children:[c.jsx(Yi,{size:14}),"",s.length>0&&c.jsx("span",{className:"ml-1 w-5 h-5 bg-gray-500 text-white rounded-full flex items-center justify-center text-[10px]",children:s.length})]}),st&&c.jsx("button",{onClick:Be,className:"text-xs text-theme-tertiary hover:text-theme-primary",children:""})]}),c.jsx(go,{children:I&&c.jsxs(Rr.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-3 space-y-4 overflow-hidden",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary",children:[c.jsx(Ol,{size:12}),"",y.tags.length>0&&c.jsx("span",{className:"px-1.5 py-0.5 bg-indigo-100 text-indigo-600 rounded-full text-[10px]",children:y.tags.length})]}),y.tags.length>1&&c.jsxs("div",{className:"flex items-center bg-theme-hover rounded-lg p-0.5",children:[c.jsx("button",{onClick:()=>v("or"),className:`px-2 py-0.5 text-[10px] font-bold rounded-md transition-all ${g==="or"?"bg-theme-card text-indigo-600 shadow-sm":"text-theme-tertiary"}`,children:" OR"}),c.jsx("button",{onClick:()=>v("and"),className:`px-2 py-0.5 text-[10px] font-bold rounded-md transition-all ${g==="and"?"bg-theme-card text-indigo-600 shadow-sm":"text-theme-tertiary"}`,children:" AND"})]})]}),c.jsxs("div",{className:"relative mb-2",children:[c.jsx("input",{type:"text",value:w,onChange:ae=>S(ae.target.value),placeholder:"...",className:"w-full px-3 py-1.5 bg-theme-hover rounded-lg text-xs border-0 focus:ring-2 focus:ring-indigo-500 pl-8 text-theme-primary"}),c.jsx(Fc,{size:12,className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-theme-tertiary"})]}),y.tags.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1.5 mb-2 p-2 bg-indigo-50 rounded-lg",children:y.tags.map(ae=>{const Z=r.find(K=>K.id===ae);return Z?c.jsxs("button",{onClick:()=>z(Z.id),className:"flex items-center gap-1.5 px-2 py-1 bg-indigo-500 text-white rounded-full text-xs font-medium hover:bg-indigo-600 transition-colors",children:[c.jsx("span",{children:Z.name}),c.jsx(on,{size:10})]},Z.id):null})}),c.jsxs("div",{className:"max-h-32 overflow-y-auto",children:[c.jsx("div",{className:"grid grid-cols-3 gap-1",children:r.filter(ae=>!y.tags.includes(ae.id)).filter(ae=>!w||ae.name.toLowerCase().includes(w.toLowerCase())).map(ae=>c.jsxs("button",{onClick:()=>z(ae.id),className:"flex items-center gap-1.5 px-2 py-1.5 bg-theme-hover hover:bg-theme-hover/80 rounded-lg text-xs text-theme-secondary transition-colors text-left",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-400 flex-shrink-0"}),c.jsx("span",{className:"truncate",children:ae.name})]},ae.id))}),r.filter(ae=>!y.tags.includes(ae.id)).filter(ae=>!w||ae.name.toLowerCase().includes(w.toLowerCase())).length===0&&c.jsx("div",{className:"text-center text-xs text-theme-tertiary py-2",children:""})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary",children:[c.jsx(Go,{size:12}),"",(y.startDate||y.endDate)&&c.jsx("span",{className:"px-1.5 py-0.5 bg-indigo-100 text-indigo-600 rounded-full text-[10px]",children:""})]}),(y.startDate||y.endDate)&&c.jsxs("button",{onClick:()=>x(ae=>({...ae,startDate:null,endDate:null})),className:"text-[10px] text-red-500 hover:text-red-600 flex items-center gap-1 z-10",children:[c.jsx(on,{size:10}),""]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"date",value:y.startDate||"",onChange:ae=>x(Z=>({...Z,startDate:ae.target.value||null})),className:"px-3 py-1.5 rounded-lg bg-theme-hover text-xs border-0 focus:ring-2 focus:ring-indigo-500 text-theme-primary"}),c.jsx("span",{className:"text-theme-tertiary",children:""}),c.jsx("input",{type:"date",value:y.endDate||"",onChange:ae=>x(Z=>({...Z,endDate:ae.target.value||null})),className:"px-3 py-1.5 rounded-lg bg-theme-hover text-xs border-0 focus:ring-2 focus:ring-indigo-500 text-theme-primary"}),(y.startDate||y.endDate)&&c.jsx("button",{onClick:()=>x(ae=>({...ae,startDate:null,endDate:null})),className:"p-1.5 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-colors",title:"",children:c.jsx(on,{size:14})})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary mb-2",children:[c.jsx(_w,{size:12}),""]}),c.jsx("div",{className:"flex flex-wrap gap-2",children:bee.map(ae=>c.jsx("button",{onClick:()=>ie(ae),className:`w-6 h-6 rounded-full ${tE[ae]} transition-transform ${y.colors.includes(ae)?"ring-2 ring-offset-2 ring-indigo-500 scale-110":"hover:scale-110"}`},ae))})]})]})})]}),c.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:D.length>0?c.jsxs("div",{className:"p-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("span",{className:"text-xs font-medium text-theme-secondary",children:[" ",D.length," "]}),T?c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"text",value:R,onChange:ae=>C(ae.target.value),placeholder:"...",className:"px-2 py-1 text-xs border rounded-lg w-32 bg-theme-hover text-theme-primary border-theme",autoFocus:!0}),c.jsx("button",{onClick:xe,className:"p-1 text-green-600 hover:text-green-700",children:c.jsx(tr,{size:14})}),c.jsx("button",{onClick:()=>{_(!1),C("")},className:"p-1 text-theme-tertiary hover:text-theme-primary",children:c.jsx(on,{size:14})})]}):c.jsxs("button",{onClick:()=>_(!0),className:"flex items-center gap-1 text-xs text-indigo-600 hover:text-indigo-700",children:[c.jsx(PI,{size:12}),""]})]}),c.jsx("div",{className:"space-y-1",children:D.map(ae=>{const Z=ae.start_date||ae.due_date,K=Z?new Date(Z).toLocaleDateString("zh-TW",{year:"numeric",month:"short",day:"numeric"}):null,de=l===ae.id,ce=!!ae.is_locked,ke=ce&&!ae.lock_password,_e=Ke=>{Ke.stopPropagation(),ce?(M(ae.id),X("edit"),G(""),O(!0)):a(ae.id)},ve=Ke=>{Ke==null||Ke.stopPropagation(),ce?(M(ae.id),X("navigate"),G(""),O(!0)):(a(null),u(ae.id,!0),e())};return c.jsx("div",{className:"rounded-xl hover:bg-theme-hover transition-colors border border-transparent hover:border-theme",children:de?c.jsx("div",{onClick:Ke=>Ke.stopPropagation(),onMouseDown:Ke=>Ke.stopPropagation(),children:c.jsx(Ro,{initialData:ae,onClose:()=>a(null)})}):c.jsx("div",{className:"p-3",children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("div",{className:`w-3 h-3 rounded-full mt-1 flex-shrink-0 ${tE[ae.color]}`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:`font-medium text-theme-primary flex items-center gap-1.5 ${ke?"blur-[4px] select-none":""}`,children:[ce&&c.jsx(Ma,{size:12,className:"text-amber-500 flex-shrink-0"}),c.jsx(nE,{text:ae.title,query:p})]}),ae.description&&!ke&&c.jsx("div",{className:"text-sm text-theme-secondary mt-1 max-h-20 overflow-y-auto",children:c.jsx(nE,{text:ae.description.replace(/<[^>]*>/g,""),query:p})}),ae.tags.length>0&&!ke&&c.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:ae.tags.map(Ke=>{const je=r.find(V=>V.id===Ke);return je?c.jsx("span",{className:"px-2 py-0.5 bg-theme-hover text-theme-secondary rounded-full text-[10px]",children:je.name},Ke):null})})]}),c.jsxs("div",{className:"flex flex-col items-end gap-1 flex-shrink-0",children:[K&&c.jsx("span",{className:"text-xs text-theme-tertiary",children:K}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:_e,className:"p-1 text-theme-tertiary hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors",title:ce?"":"",children:c.jsx(tr,{size:14})}),c.jsx("button",{onClick:ve,className:"p-1 text-theme-tertiary hover:text-emerald-600 hover:bg-emerald-50 rounded transition-colors",title:ce?"":"",children:c.jsx(_I,{size:14})})]})]})]})})},ae.id)})})]}):p||st?c.jsxs("div",{className:"p-8 text-center text-theme-tertiary",children:[c.jsx(Fc,{size:32,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{children:""})]}):s.length>0?c.jsxs("div",{className:"p-4",children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-theme-secondary mb-3",children:[c.jsx(Yi,{size:12}),""]}),c.jsx("div",{className:"space-y-1",children:s.map(ae=>c.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-theme-hover group",children:[c.jsxs("button",{onClick:()=>U(ae),className:"flex-1 text-left",children:[c.jsx("div",{className:"font-medium text-theme-primary text-sm",children:ae.name||ae.query||"()"}),c.jsxs("div",{className:"text-xs text-theme-tertiary mt-0.5",children:[new Date(ae.created_at).toLocaleDateString(),ae.filters.tags.length>0&&`  ${ae.filters.tags.length} `,ae.filters.colors.length>0&&`  ${ae.filters.colors.length} `]})]}),c.jsx("button",{onClick:()=>o(ae.id),className:"p-1 text-theme-tertiary hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:c.jsx(Ar,{size:14})})]},ae.id))})]}):c.jsxs("div",{className:"p-8 text-center text-theme-tertiary",children:[c.jsx(Fc,{size:32,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{children:""})]})}),c.jsx("div",{className:"p-3 border-t border-theme bg-theme-hover flex justify-between items-center text-xs text-theme-tertiary",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("span",{children:[c.jsx("kbd",{className:"px-1.5 py-0.5 bg-theme-card border border-theme rounded text-theme-primary",children:"Enter"})," "]}),c.jsxs("span",{children:[c.jsx("kbd",{className:"px-1.5 py-0.5 bg-theme-card border border-theme rounded text-theme-primary",children:"Esc"})," "]})]})})]})})}),document.body),j&&er.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999]",onClick:()=>{O(!1),M(null),X(null)},children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-80 max-w-[90vw]",onClick:ae=>ae.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[c.jsx(Ma,{size:20,className:"text-amber-500"}),c.jsx("h3",{className:"text-lg font-bold",children:""})]}),c.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["",Q==="edit"?"":"",""]}),c.jsx("input",{type:"password",placeholder:"",value:P,onChange:ae=>G(ae.target.value),onKeyDown:ae=>{ae.key==="Enter"&&A&&(d(A,P)?(f(A),Q==="edit"?a(A):(a(null),u(A,!0),e()),O(!1),M(null),X(null)):h({msg:"",type:"error"})),ae.key==="Escape"&&(O(!1),M(null),X(null))},autoFocus:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-amber-500"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:()=>{O(!1),M(null),X(null)},className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:""}),c.jsx("button",{onClick:()=>{A&&(d(A,P)?(f(A),Q==="edit"?a(A):(a(null),u(A,!0),e()),O(!1),M(null),X(null)):h({msg:"",type:"error"}))},className:"flex-1 px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors",children:""})]})]})}),document.body)]}):null},vee=({current:t,total:e})=>{const n=e>0?Math.round(t/e*100):0;return er.createPortal(c.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm",children:c.jsxs("div",{className:"bg-[#1e1e1e] p-6 rounded-xl shadow-2xl w-80 border border-white/10 text-center",children:[c.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Importing Calendar..."}),c.jsx("div",{className:"w-full bg-gray-700 h-2 rounded-full mb-2 overflow-hidden",children:c.jsx("div",{className:"bg-indigo-500 h-full transition-all duration-200",style:{width:`${n}%`}})}),c.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-2",children:[c.jsxs("span",{children:[t," / ",e]}),c.jsxs("span",{children:[n,"%"]})]})]})}),document.body)},kee=["#6366f1","#f43f5e","#10b981","#f59e0b","#64748b"],See=({id:t,label:e,active:n,overdueCount:r,normalCount:s,icon:i,color:o,acceptsDrop:a,isEditing:l,editingViewName:u,setEditingViewName:d,setEditingViewId:f,saveViewName:h,setHoveredDropTarget:p,sidebarCollapsed:m,sidebarTextClass:y,sidebarFontClass:x,setView:g,setTagFilter:v,onEditFilter:w})=>{const{dragState:S,updateGhostPosition:I,endDrag:k,selectedTaskIds:R,moveTaskToView:C}=b.useContext(_n),T=o||(n?"var(--accent-color)":void 0),_=b.useRef(!1),[N,j]=b.useState(!1),O=A=>{a&&(A.preventDefault(),A.stopPropagation(),_.current||(_.current=!0,j(!0),p(t)),I(A.clientX,A.clientY))},P=A=>{A.preventDefault(),_.current=!1,j(!1),p(null)},G=async A=>{if(A.preventDefault(),A.stopPropagation(),_.current=!1,j(!1),p(null),!a){k();return}const M=R.length>0?R:S!=null&&S.draggedId?[S.draggedId]:[];M.length>0&&await C(M,t),k()};return c.jsx("div",{className:`relative group/nav-wrapper transition-all ${N?"ring-2 ring-indigo-500 ring-inset rounded-lg bg-indigo-50 dark:bg-indigo-900/40":""}`,onDragOver:O,onDragLeave:P,onDrop:G,children:c.jsxs("button",{onClick:()=>{!l&&g&&(g(t),v&&v(null))},onDoubleClick:A=>{A.stopPropagation(),w&&w(t)},style:{pointerEvents:a&&(S!=null&&S.isDragging)?"none":"auto"},className:`w-full flex items-center ${m?"justify-center px-1":"justify-between px-3"} py-3 md:py-1 rounded-lg mb-1 md:mb-0 transition-colors touch-manipulation ${y} ${x} ${n?"bg-theme-hover text-theme-primary font-bold":"text-theme-secondary font-medium hover:bg-theme-hover hover:text-theme-primary active:bg-theme-hover"}`,title:m?e:"",children:[c.jsxs("div",{className:`flex items-center gap-2 ${m?"justify-center w-full":""}`,children:[i&&c.jsx(i,{size:16,style:{color:T},className:!o&&!n?"text-theme-tertiary":""}),!m&&(l?c.jsx("input",{autoFocus:!0,value:u,onChange:A=>d(A.target.value),onKeyDown:A=>{A.stopPropagation(),A.key==="Enter"?h(t,u):A.key==="Escape"&&f(null)},onBlur:()=>h(t,u),onClick:A=>A.stopPropagation(),className:"bg-theme-card border border-indigo-300 rounded px-1 py-0.5 text-xs outline-none focus:ring-1 focus:ring-indigo-500 w-20 text-theme-primary"}):c.jsx("span",{children:e}))]}),!m&&c.jsxs("div",{className:"flex gap-2 items-center",children:[r>0&&c.jsx("span",{className:"text-[11px] font-semibold text-white bg-rose-400 rounded-full px-3.5 py-0.5 min-w-[26px] text-center shadow-sm",children:r}),s>0&&(t==="matrix"?c.jsx("span",{className:"text-[11px] font-semibold text-white bg-yellow-400 rounded-full px-3.5 py-0.5 min-w-[26px] text-center shadow-sm",children:s}):c.jsx("span",{className:"text-[11px] text-gray-400 font-medium",children:s}))]})]})})},rE=({view:t,setView:e,tagFilter:n,setTagFilter:r})=>{const[s,i]=b.useState(null),{tasks:o,tags:a,themeSettings:l,setThemeSettings:u,deleteTag:d,updateTag:f,addTag:h,clearAllTasks:p,exportData:m,importData:y,syncGoogleToApp:x,expandedTags:g,setExpandedTags:v,sidebarCollapsed:w,toggleSidebar:S,tagsWithResolvedColors:I,t:k,language:R,setLanguage:C,setAdvancedFilters:T,viewTagFilters:_,updateViewTagFilter:N,visibleTasks:j,setFocusedTaskId:O,moveTaskToView:P,selectedTaskIds:G,dragState:A,updateGhostPosition:M,endDrag:Q,addTask:X,batchAddTasks:D,updateTask:Te,batchUpdateTasks:xe,setToast:U,deleteTask:z,batchDeleteTasks:ie,batchImportTasks:Be,user:st,searchOpen:ae,setSearchOpen:Z,lockedGoogleTagIds:K,toggleGoogleTagLock:de}=b.useContext(_n),[ce,ke]=b.useState(!1),[_e,ve]=b.useState(null),[Ke,je]=b.useState(null),[V,re]=b.useState(""),[se,ne]=b.useState(()=>{try{return JSON.parse(localStorage.getItem("custom_view_names")||"{}")}catch{return{}}}),[pe,ee]=b.useState(""),[ye,Pe]=b.useState(!1),[me,Me]=b.useState(null),[qe,ht]=b.useState(""),wt=b.useRef(null),[ge,Le]=b.useState({provider:localStorage.getItem("ai_provider")||"gemini",googleKey:localStorage.getItem("google_ai_key")||"",openaiKey:localStorage.getItem("openai_api_key")||"",baseUrl:localStorage.getItem("ai_base_url")||"https://api.openai.com/v1",modelName:localStorage.getItem("ai_model")||"gpt-3.5-turbo"}),[Ue,De]=b.useState(null),[Qe,pt]=b.useState(null),[nt,ut]=b.useState(null),[he,we]=b.useState(""),[Xe,Ze]=b.useState(null),[lt,Ge]=b.useState(null),[Ct,Y]=b.useState(()=>{const le=localStorage.getItem("sidebar_tags_expanded");return le!==null?le==="true":!0}),q=b.useRef(null),oe=b.useRef(null),[Ce,dt]=b.useState(!1),[xt,it]=b.useState(localStorage.getItem("google_client_id")||""),[Rt,Ot]=b.useState({start:new Date().toISOString().split("T")[0],end:new Date(new Date().setMonth(new Date().getMonth()+1)).toISOString().split("T")[0]}),[Nn,$t]=b.useState("date"),[an,Tn]=b.useState([]),[Ie,Dt]=b.useState(new Set),[zt,Ft]=b.useState(null),qt=b.useRef(null),mn=b.useRef(null),Cr=b.useRef(null);i1(qt,()=>ke(!1)),i1(mn,()=>Ze(null)),b.useEffect(()=>{const le=vt=>{vt.key==="Escape"&&_e&&ve(null)};return window.addEventListener("keydown",le),()=>window.removeEventListener("keydown",le)},[_e]),b.useEffect(()=>{_e&&ee(se[_e]||"")},[_e,se]);const gs=async()=>{const le=o.filter(Mt=>Mt.tags.some(Et=>{const Zt=a.find(vn=>vn.id===Et);return Zt&&Zt.name.startsWith("Google:")}));if(le.length===0){alert(R==="zh"?" Google ":"No Google Calendar tasks found to delete");return}if(!confirm(R==="zh"?` ${le.length}  Google 
( App  Google )`:`Delete ${le.length} Google Calendar tasks?
(This will only delete local tasks, NOT Google Calendar events)`))return;const vt=JSON.parse(localStorage.getItem("task_google_map")||"{}"),At=le.map(Mt=>Mt.id);At.forEach(Mt=>{delete vt[Mt]}),localStorage.setItem("task_google_map",JSON.stringify(vt)),localStorage.removeItem("google_sync_tokens"),await ie(At,!0),U({msg:` ${le.length}  Google `,type:"success"}),ke(!1)};b.useEffect(()=>{const le=vt=>{(vt.metaKey||vt.ctrlKey)&&vt.shiftKey&&(vt.key==="f"||vt.key==="F"||vt.key==="s"||vt.key==="S")&&(vt.preventDefault(),vt.stopPropagation(),Z(!0)),vt.key==="Escape"&&(Xe?Ze(null):ae&&Z(!1))};return window.addEventListener("keydown",le),()=>window.removeEventListener("keydown",le)},[ae,Xe]),b.useEffect(()=>{ye&&wt.current&&wt.current.focus(),nt?Cr.current=nt:Cr.current&&setTimeout(()=>{const le=document.querySelector(`[data-tag-id="${Cr.current}"]`);le&&le.focus(),Cr.current=null},50)},[ye,nt]);const bn=async()=>{if(!xt.trim()){alert(R==="zh"?" Settings  Google Client ID":"Please set Google Client ID in settings"),ke(!0);return}localStorage.setItem("google_client_id",xt.trim());try{await pI(),oe.current||(oe.current=window.google.accounts.oauth2.initTokenClient({client_id:xt,scope:"https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar.readonly",callback:async le=>{if(le.error){console.error(le);return}await Er(le.access_token)}})),$t("date"),dt(!0)}catch{alert("Failed to load Google Sign-In script")}},gn=()=>{oe.current&&oe.current.requestAccessToken({prompt:""})},Er=async le=>{Ft(le),localStorage.setItem("google_access_token",le);try{const vt=await xl(le);Tn(vt);const At=vt.find(Mt=>Mt.primary);At&&Dt(new Set([At.id])),$t("select")}catch(vt){alert("Failed to fetch calendars: "+vt),dt(!1)}},Pn=async()=>{var le,vt;if(zt){dt(!1);try{i({current:0,total:0,importing:!0});let At=[],Mt=[];const Et=R==="zh"?"":"Schedule";let Zt=(le=a.find(yn=>yn.name.toLowerCase()==="schedule"||yn.name===""))==null?void 0:le.id;Zt||(Zt=await h(Et,null));for(const yn of Array.from(Ie)){const dn=an.find(jn=>jn.id===yn),Hn=`Google:${(dn==null?void 0:dn.summary)||"Calendar"}`;let sr=(vt=a.find(jn=>jn.name===Hn))==null?void 0:vt.id;sr||(sr=await h(Hn,null));const ji=await mI(zt,yn,Rt.start,Rt.end),oi=JSON.parse(localStorage.getItem("task_google_map")||"{}");ji.forEach(jn=>{const Ln=!jn.start.dateTime;let mr=jn.start.date,$=null,F=null;if(!Ln&&jn.start.dateTime){const J=new Date(jn.start.dateTime),fe=J.getFullYear(),Re=String(J.getMonth()+1).padStart(2,"0"),ze=String(J.getDate()).padStart(2,"0");mr=`${fe}-${Re}-${ze}`;const We=String(J.getHours()).padStart(2,"0"),et=String(J.getMinutes()).padStart(2,"0");if($=`${We}:${et}`,jn.end.dateTime){const mt=new Date(jn.end.dateTime),tt=String(mt.getHours()).padStart(2,"0"),ct=String(mt.getMinutes()).padStart(2,"0");F=`${tt}:${ct}`}}else mr=jn.start.date;const L={title:jn.summary||"(No Title)",description:jn.description||"",status:"active",tags:[Zt,sr].filter(Boolean),start_date:mr,start_time:$,end_time:F,is_all_day:Ln,color:"blue",google_event_id:jn.id,google_calendar_id:yn},W=Object.keys(oi).find(J=>oi[J].evtId===jn.id);let B=W?o.find(J=>J.id===W):null;B||(B=o.find(J=>J.title===(jn.summary||"(No Title)")&&J.start_date===mr&&!Object.keys(oi).includes(J.id))),B?Mt.push({id:B.id,data:L}):At.push(L)})}const vn=At.length+Mt.length;D&&At.length>0&&await D(At,null,(yn,dn)=>i({current:yn,total:vn,importing:!0})),xe&&Mt.length>0&&await xe(Mt);const rr=an.filter(yn=>!Ie.has(yn.id));let Mn=0;for(const yn of rr){const dn=`Google:${yn.summary}`,Hn=a.find(sr=>sr.name===dn);Hn&&(await d(Hn.id),Mn++,console.log(`[Import] Removed tag for unselected calendar: ${dn}`))}if(U){let yn=`Synced ${vn} events (Added: ${At.length}, Updated: ${Mt.length})`;Mn>0&&(yn+=`. Stopped sync for ${Mn} unselected calendars.`),U({msg:yn,type:"info"})}vn===0&&alert("No events found")}catch(At){console.error(At),alert("Import Error: "+At.message)}finally{i(null)}}},Jn=async(le,vt=null)=>{le==null||le.preventDefault(),qe.trim()?(await h(qe.trim(),vt),ht(""),Pe(!1),Me(null),vt&&!g.includes(vt)&&v(At=>[...At,vt])):(Pe(!1),Me(null))},En=b.useMemo(()=>{const le=["prompt",""],vt=["journal","note","",""],At=["someday","inspiration","","/"],Mt=["note","journal","",""],Et=["project",""],Zt=["schedule",""],vn=a.find(L=>le.some(W=>L.name.trim().toLowerCase()===W)),rr=a.find(L=>vt.some(W=>L.name.trim().toLowerCase()===W)),Mn=a.find(L=>At.some(W=>L.name.trim().toLowerCase()===W)),yn=a.find(L=>Mt.some(W=>L.name.trim().toLowerCase()===W)),dn=a.find(L=>Et.some(W=>L.name.trim().toLowerCase()===W)),Hn=a.find(L=>L.name==="#prompt"),sr=a.find(L=>Zt.some(W=>L.name.toLowerCase()===W)),ji=vn==null?void 0:vn.id,oi=rr==null?void 0:rr.id,jn=Mn==null?void 0:Mn.id,Ln=yn==null?void 0:yn.id,mr=dn==null?void 0:dn.id,$=Hn==null?void 0:Hn.id,F=sr==null?void 0:sr.id;return{inbox:o.filter(L=>{if(L.parent_id||L.status==="deleted"||L.status==="logged")return!1;if(!L.start_date&&!L.due_date&&(!L.tags||L.tags.length===0))return!0;const B=!!L.completed_at;return!(!(L.status==="inbox")&&!B||ji&&L.tags.includes(ji)||oi&&L.tags.includes(oi)||jn&&L.tags.includes(jn)||Ln&&L.tags.includes(Ln)||$&&L.tags.includes($)||mr&&L.tags.includes(mr)&&o.some(Re=>Re.parent_id===L.id&&Re.status!=="deleted")||!B&&(L.start_date||L.due_date))}).length,todayOverdue:(()=>o.filter(L=>!(L.status==="completed"||L.status==="deleted"||L.status==="logged"||L.status==="waiting"||L.status==="someday"||!Yx(L.start_date||L.due_date)||F&&L.tags.includes(F)||Ln&&L.tags.includes(Ln)||mr&&L.tags.includes(mr))).length)(),todayScheduled:(()=>o.filter(L=>!(L.status==="completed"||L.status==="deleted"||L.status==="logged"||L.status==="waiting"||L.status==="someday"||Yx(L.start_date||L.due_date)||!kw(L.start_date||L.due_date)||F&&L.tags.includes(F)||Ln&&L.tags.includes(Ln)||mr&&L.tags.includes(mr))).length)(),prompt:o.filter(L=>L.status!=="deleted"&&L.status!=="logged"&&ji&&L.tags.includes(ji)&&!L.reviewed_at).length,logbook:o.filter(L=>L.status==="logged"&&!L.reviewed_at).length,waiting:o.filter(L=>L.status==="deleted"||L.status==="logged"?!1:(L.status==="waiting"||jn&&L.tags.includes(jn))&&!L.reviewed_at).length,trash:o.filter(L=>L.status==="deleted").length,note:o.filter(L=>L.status==="deleted"||L.status==="logged"?!1:Ln&&L.tags.includes(Ln)).length,matrixUrgent:o.filter(L=>L.parent_id||L.status==="deleted"||L.status==="logged"||L.status==="completed"||F&&L.tags.includes(F)?!1:L.importance==="urgent").length,matrixPlanned:o.filter(L=>L.parent_id||L.status==="deleted"||L.status==="logged"||L.status==="completed"||F&&L.tags.includes(F)?!1:L.importance==="important").length}},[o,a]),Or={small:"text-xs",normal:"text-sm",large:"text-base"}[l.fontSize]||"text-sm",Ei={small:"text-xs",normal:"text-sm",large:"text-base"}[l.fontSize]||"text-sm",tl=l.fontWeight==="thin"?"font-normal":"",Qo=(le,vt)=>{const At={...se,[le]:vt};ne(At),localStorage.setItem("custom_view_names",JSON.stringify(At)),je(null)},[hn,ko]=b.useState(null),Zo=async le=>{if(console.log("[Sidebar Drop] hoveredDropTarget:",hn),!hn||!A.isDragging)return;le.preventDefault(),le.stopPropagation();const vt=G.length>0?G:A.draggedId?[A.draggedId]:[];console.log("[Sidebar Drop] Moving tasks:",vt,"to:",hn),vt.length>0&&await P(vt,hn),ko(null),Q()},si=b.useMemo(()=>{const le=(vt,At)=>a.filter(Mt=>Mt.parent_id===vt).sort((Mt,Et)=>(Mt.order_index||0)-(Et.order_index||0)).map(Mt=>({id:Mt.id,name:Mt.name,depth:At,parent_id:Mt.parent_id,data:Mt,isExpanded:g.includes(Mt.id),children:le(Mt.id,At+1)}));return le(null,0)},[a,g]),nl=(le,vt)=>{vt.stopPropagation(),v(At=>At.includes(le)?At.filter(Mt=>Mt!==le):[...At,le])},rl=(le,vt)=>{le.dataTransfer.setData("tag_id",vt),De(vt)},So=(le,vt)=>{if(le.preventDefault(),Ue===vt)return;const At=le.currentTarget.getBoundingClientRect(),Mt=le.clientY-At.top,Et=At.height;let Zt="inside";Mt<Et*.25?Zt="top":Mt>Et*.75&&(Zt="bottom"),pt({id:vt,position:Zt})},ys=async(le,vt)=>{le.preventDefault();const At=le.dataTransfer.getData("tag_id");if(!At||At===vt){pt(null),De(null);return}const Mt=a.find(Mn=>Mn.id===At),Et=a.find(Mn=>Mn.id===vt);if(!Mt||!Et)return;let Zt=Et;for(;Zt.parent_id;){if(Zt.parent_id===At){pt(null),De(null);return}const Mn=a.find(yn=>yn.id===Zt.parent_id);if(!Mn)break;Zt=Mn}let vn=Mt.parent_id,rr=Mt.order_index||0;if((Qe==null?void 0:Qe.position)==="inside")vn=vt,rr=a.filter(dn=>dn.parent_id===vt).reduce((dn,Hn)=>Math.max(dn,Hn.order_index||0),0)+1e4,g.includes(vt)||v(dn=>[...dn,vt]);else{vn=Et.parent_id;const Mn=a.filter(dn=>dn.parent_id===Et.parent_id).sort((dn,Hn)=>(dn.order_index||0)-(Hn.order_index||0)),yn=Mn.findIndex(dn=>dn.id===vt);if((Qe==null?void 0:Qe.position)==="top"){const dn=Mn[yn-1],Hn=(dn==null?void 0:dn.order_index)||0,sr=Et.order_index||0;rr=dn?(Hn+sr)/2:sr-1e4}else{const dn=Mn[yn+1],Hn=(dn==null?void 0:dn.order_index)||0,sr=Et.order_index||0;rr=dn?(sr+Hn)/2:sr+1e4}}await f(At,{parent_id:vn,order_index:rr}),pt(null),De(null)},_o=async le=>{n===le&&r(null),await d(le)},sl=le=>{ut(le.id),we(le.name),Ze(null)},Yn=async()=>{nt&&he.trim()&&(await f(nt,{name:he}),ut(null))},Pr=()=>{localStorage.setItem("ai_provider",ge.provider),localStorage.setItem("google_ai_key",ge.googleKey.trim()),localStorage.setItem("openai_api_key",ge.openaiKey.trim()),localStorage.setItem("ai_base_url",ge.baseUrl.trim()),localStorage.setItem("ai_model",ge.modelName.trim()),alert("AI Settings Saved!")},Un=le=>{le.target.files&&le.target.files[0]&&(y(le.target.files[0]),ke(!1))},Ni=le=>{nt||(r(le),e("inbox"),T({additionalTags:[],startDate:null,dueDate:null,color:null}),O(null))},ic=(le,vt)=>{if(nt!==vt){if(le.key==="ArrowRight"){le.preventDefault();const At=a.find(Mt=>Mt.id===vt);At&&a.some(Mt=>Mt.parent_id===vt)&&(g.includes(vt)||v(Mt=>[...Mt,At.id]))}if(le.key==="ArrowLeft"){le.preventDefault();const At=a.find(Mt=>Mt.id===vt);if(At)g.includes(vt)&&v(Mt=>Mt.filter(Et=>Et!==vt));else if(At.parent_id){const Mt=document.querySelector(`[data-tag-id="${At.parent_id}"]`);Mt&&(Mt.focus(),Ni(At.parent_id))}}if(le.key==="ArrowDown"||le.key==="ArrowUp"){le.preventDefault();const At=Array.from(document.querySelectorAll("[data-tag-id]")),Mt=At.findIndex(rr=>rr.getAttribute("data-tag-id")===vt);if(Mt===-1)return;const Et=le.key==="ArrowDown"?(Mt+1)%At.length:(Mt-1+At.length)%At.length,Zt=At[Et];Zt.focus();const vn=Zt.getAttribute("data-tag-id");vn&&Ni(vn)}if(le.key==="Tab"&&(le.preventDefault(),j.length>0&&O(j[0].data.id)),le.key==="Enter"){le.preventDefault();const At=a.find(Mt=>Mt.id===vt);At&&sl(At)}if(le.key==="Delete"||le.key==="Backspace"){le.preventDefault(),le.stopPropagation();const At=vt;setTimeout(()=>{confirm(k("deleteTagConfirm"))&&_o(At)},10)}}},ii=le=>{const vt=(Qe==null?void 0:Qe.id)===le.id;let At="border-transparent";vt&&((Qe==null?void 0:Qe.position)==="top"?At="border-t-2 border-t-indigo-500":(Qe==null?void 0:Qe.position)==="bottom"?At="border-b-2 border-b-indigo-500":At="bg-indigo-50 ring-1 ring-indigo-500");const Mt=nt===le.id;return c.jsxs("div",{className:"relative",children:[c.jsxs("div",{"data-tag-id":le.id,draggable:!Mt,onDragStart:Et=>rl(Et,le.id),onDragOver:Et=>So(Et,le.id),onDrop:Et=>ys(Et,le.id),onDragLeave:()=>pt(null),className:`relative group flex items-center gap-0.5 py-0.5 rounded pr-1 transition-all select-none outline-none ${Ei} ${tl} ${n===le.id?"bg-theme-hover text-indigo-600 font-bold":"text-theme-secondary font-medium hover:text-theme-primary hover:bg-theme-hover"} ${At} ${w?"justify-center pl-0":""}`,style:{paddingLeft:w?"0":`${le.depth*6+6}px`},onClick:()=>{Mt||Ni(le.id)},onDoubleClick:Et=>{Et.stopPropagation(),sl(le)},tabIndex:0,onKeyDown:Et=>ic(Et,le.id),children:[le.children.length>0?c.jsx("button",{onClick:Et=>nl(le.id,Et),className:"p-0 hover:bg-theme-hover rounded text-theme-tertiary",children:le.isExpanded?c.jsx(ds,{size:10}):c.jsx(ts,{size:10})}):c.jsx("div",{className:"w-[10px]"}),Mt?c.jsxs("div",{className:"flex items-center flex-1 gap-1",children:[c.jsx("input",{autoFocus:!0,className:"flex-1 min-w-0 bg-theme-card border border-indigo-500/50 rounded px-1 py-0.5 text-xs outline-none focus:ring-1 focus:ring-indigo-500 text-theme-primary",value:he,onChange:Et=>we(Et.target.value),onKeyDown:Et=>{Et.key==="Enter"?Yn():Et.key==="Escape"&&ut(null)},onClick:Et=>Et.stopPropagation()}),c.jsx("button",{onClick:Et=>{Et.stopPropagation(),Yn()},className:"text-green-600 hover:bg-green-100 p-0.5 rounded",children:c.jsx(tr,{size:12})}),c.jsx("button",{onClick:Et=>{Et.stopPropagation(),ut(null)},className:"text-red-500 hover:bg-red-100 p-0.5 rounded",children:c.jsx(on,{size:12})})]}):c.jsxs(c.Fragment,{children:[!w&&c.jsxs("span",{className:"truncate flex-1 text-left flex items-center gap-1",style:I[le.id]?{color:I[le.id],opacity:.5}:void 0,children:[le.name.startsWith("#")?le.name.slice(1):le.name,le.name.startsWith("Google:")&&K.includes(le.id)&&c.jsx(Ma,{size:9,className:"text-amber-500 flex-shrink-0"})]}),!w&&c.jsxs("div",{className:"flex items-center opacity-0 group-hover:opacity-100 transition-opacity",children:[c.jsx("button",{onClick:Et=>{Et.stopPropagation(),Me(le.id),ht(""),le.isExpanded||v(Zt=>[...Zt,le.id])},className:"p-0.5 hover:bg-gray-200 rounded text-gray-400",title:k("addSubTag"),children:c.jsx(Ki,{size:10})}),c.jsx("button",{onMouseDown:Et=>{Et.stopPropagation()},onClick:Et=>{Et.stopPropagation();const Zt=Et.currentTarget.getBoundingClientRect(),vn=180,rr=window.innerHeight,yn=Zt.bottom+4+vn>rr?Zt.top-vn-4:Zt.bottom+4;Ge({top:Math.max(8,yn),left:Math.max(8,Zt.right-208)}),Ze(Xe===le.id?null:le.id)},className:"p-0.5 hover:bg-gray-200 rounded text-gray-400",children:c.jsx(T6,{size:10})})]}),Xe===le.id&&lt&&er.createPortal(c.jsxs("div",{ref:mn,className:"fixed bg-theme-card rounded-xl shadow-2xl border border-theme p-3 w-52 animate-in fade-in slide-in-from-top-1 duration-200",style:{top:lt.top,left:Math.max(8,lt.left),zIndex:99999},onClick:Et=>Et.stopPropagation(),children:[c.jsxs("div",{className:"mb-3",children:[c.jsx("p",{className:"text-[9px] font-bold text-gray-400 mb-2 uppercase",children:k("tagStyle")}),c.jsx("div",{className:"grid grid-cols-5 gap-1.5 focus:outline-none",children:kee.map(Et=>c.jsx("button",{className:`w-6 h-6 rounded-full hover:scale-110 transition-transform ${le.data.color===Et?"ring-2 ring-offset-1 ring-indigo-500 shadow-sm":""}`,style:{backgroundColor:Et},onClick:Zt=>{Zt.stopPropagation(),f(le.id,{color:Et}),Ze(null)},title:k("selectTagColor")},Et))})]}),c.jsxs("div",{className:"space-y-0.5",children:[c.jsxs("button",{onClick:()=>{Me(le.id),ht(""),Ze(null),le.isExpanded||v(Et=>[...Et,le.id])},className:"w-full flex items-center gap-2 px-2 py-1 hover:bg-theme-hover rounded text-[11px] text-theme-secondary font-medium",children:[c.jsx(Ki,{size:11})," ",k("addSubTag")]}),c.jsxs("button",{onClick:()=>sl(le),className:"w-full flex items-center gap-2 px-2 py-1 hover:bg-theme-hover rounded text-[11px] text-theme-secondary font-medium",children:[c.jsx(Eg,{size:11})," ",k("rename")]}),le.name.startsWith("Google:")&&c.jsx("button",{onClick:Et=>{Et.stopPropagation(),de(le.id),Ze(null)},className:`w-full flex items-center gap-2 px-2 py-1 hover:bg-theme-hover rounded text-[11px] font-medium ${K.includes(le.id)?"text-amber-600":"text-theme-secondary"}`,children:K.includes(le.id)?c.jsxs(c.Fragment,{children:[c.jsx(n1,{size:11})," "]}):c.jsxs(c.Fragment,{children:[c.jsx(Ma,{size:11})," "]})}),c.jsxs("button",{onClick:Et=>{Et.stopPropagation();const Zt=le.id;Ze(null),setTimeout(()=>{confirm(k("deleteTagConfirm"))&&_o(Zt)},10)},className:"w-full flex items-center gap-2 px-2 py-1 hover:bg-red-50 rounded text-[11px] text-red-600 font-medium",children:[c.jsx(Ar,{size:11})," ",k("deleteTag")]})]})]}),document.body)]})]}),me===le.id&&c.jsx("div",{className:"px-1 mb-0.5",style:{paddingLeft:`${(le.depth+1)*6+6}px`},children:c.jsx("form",{onSubmit:Et=>Jn(Et,le.id),className:"relative",children:c.jsx("input",{autoFocus:!0,value:qe,onChange:Et=>ht(Et.target.value),onKeyDown:Et=>{Et.key==="Escape"&&Me(null),Et.stopPropagation()},onBlur:()=>{qe.trim()||Me(null)},placeholder:k("subTagPlaceholder"),className:"w-full text-[10px] py-1 px-2 bg-indigo-50/30 border border-indigo-100/50 rounded outline-none focus:ring-1 focus:ring-indigo-200 transition-all font-medium text-gray-700 placeholder:text-gray-300"})})}),le.isExpanded&&le.children.map(Et=>ii(Et))]},le.id)},Nr=le=>{const vt=Ke===le.id,At=["logbook","recent","trash","worklog"].includes(le.id),Mt=se[le.id]||le.label;return c.jsx(See,{...le,label:Mt,isEditing:vt,editingViewName:V,setEditingViewName:re,setEditingViewId:je,saveViewName:Qo,setHoveredDropTarget:ko,sidebarCollapsed:w,sidebarTextClass:Or,sidebarFontClass:tl,setView:e,setTagFilter:r,onEditFilter:At?void 0:Et=>ve(Et)})};return c.jsxs("aside",{className:"w-full bg-theme-sidebar border-r border-theme h-screen flex flex-col p-5 sticky top-0 overflow-hidden",onDragOver:le=>{A.isDragging&&(le.preventDefault(),M(le.clientX,le.clientY))},onDrop:Zo,children:[c.jsxs("div",{className:`mb-8 flex items-center ${w?"justify-center flex-col gap-4":"justify-between px-1"} opacity-60`,children:[!w&&c.jsxs("div",{className:"flex items-center gap-2 text-theme-secondary",children:[c.jsx(e1,{size:18})," ",c.jsx("span",{className:"text-xs font-bold tracking-widest uppercase text-theme-tertiary",children:k("appearance")})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:()=>Z(!0),className:"hover:bg-theme-hover p-1 rounded transition-colors text-theme-secondary",title:" (K)",children:c.jsx(Fc,{size:18})}),c.jsx("button",{onClick:S,className:"hover:bg-theme-hover p-1 rounded transition-colors text-theme-secondary",children:w?c.jsx(N6,{size:18}):c.jsx(E6,{size:18})})]})]}),c.jsxs("nav",{className:"flex-1 overflow-y-auto no-scrollbar py-2",children:[c.jsx("div",{className:"mb-6",children:c.jsx(Nr,{id:"inbox",label:k("inbox"),normalCount:En.inbox,active:t==="inbox"&&!n,icon:Zx,color:"#1badf8"})}),c.jsxs("div",{className:"mb-6",children:[c.jsx(Nr,{id:"today",label:k("today"),overdueCount:En.todayOverdue,normalCount:En.todayScheduled,active:t==="today"&&!n,icon:$I,color:"#f5c94c",acceptsDrop:!0}),c.jsx(Nr,{id:"allview",label:"",active:t==="allview"&&!n,icon:NI,color:"#10b981"}),c.jsx(Nr,{id:"matrix",label:"",normalCount:En.matrixUrgent,active:t==="matrix",icon:e1,color:"#6366f1"})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx(Nr,{id:"focus",label:"",active:t==="focus",icon:zI,color:"#ef4444"}),c.jsx(Nr,{id:"project",label:"",active:t==="project",icon:c6,color:"#f97316",acceptsDrop:!0}),c.jsx(Nr,{id:"annualplan",label:"",active:t==="annualplan",icon:o6,color:"#eab308"})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx(Nr,{id:"waiting",label:"/",active:t==="waiting"&&!n,icon:Yi,color:"#a855f7",acceptsDrop:!0}),c.jsx(Nr,{id:"journal",label:"",active:t==="journal"&&!n,icon:Yz,color:"#34d399",acceptsDrop:!0}),c.jsx(Nr,{id:"prompt",label:k("prompt"),normalCount:En.prompt,active:t==="prompt",icon:y6,color:"#fbbf24",acceptsDrop:!0}),c.jsx(Nr,{id:"worklog",label:"",active:t==="worklog",icon:Wf,color:"#0ea5e9"})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx(Nr,{id:"logbook",label:k("logbook"),normalCount:En.logbook,active:t==="logbook",icon:em,color:"#a16207"}),c.jsx(Nr,{id:"recent",label:"",active:t==="recent",icon:m6,color:"#0891b2"}),c.jsx(Nr,{id:"trash",label:k("trash"),normalCount:En.trash>1e3?En.trash:void 0,active:t==="trash",icon:Ar,color:"#9ca3af"})]}),!w&&c.jsxs("div",{className:"mt-2",children:[c.jsxs("div",{className:"flex items-center justify-between px-3 mb-2 group/tagheader cursor-pointer select-none",onClick:()=>{const le=!Ct;Y(le),localStorage.setItem("sidebar_tags_expanded",String(le))},children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("p",{className:"text-[10px] font-bold text-gray-300 uppercase tracking-wider",children:"TAGS"}),c.jsx("span",{className:"text-gray-300 transition-transform duration-200",style:{transform:Ct?"rotate(0deg)":"rotate(-90deg)"},children:c.jsx(ds,{size:10})})]}),c.jsx("button",{onClick:le=>{le.stopPropagation(),Pe(!0),Ct||Y(!0)},className:"opacity-0 group-hover/tagheader:opacity-100 p-0.5 hover:bg-gray-100 rounded text-gray-400 hover:text-gray-600 transition-all flex items-center justify-center",title:"",children:c.jsx(Ki,{size:10})})]}),Ct&&c.jsxs("div",{className:"overflow-hidden",children:[ye&&c.jsx("div",{className:"px-3 overflow-hidden mb-2",children:c.jsxs("form",{onSubmit:Jn,className:"relative",children:[c.jsx("input",{ref:wt,value:qe,onChange:le=>ht(le.target.value),onKeyDown:le=>{le.key==="Escape"&&Pe(!1),le.stopPropagation()},onBlur:()=>{qe.trim()||Pe(!1)},placeholder:"...",className:"w-full text-xs py-1.5 px-2 bg-indigo-50/50 border border-indigo-100 rounded-md outline-none focus:ring-1 focus:ring-indigo-300 transition-all font-medium text-gray-700 placeholder:text-gray-300"}),c.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1",children:qe.trim()&&c.jsx("button",{type:"submit",className:"text-indigo-500 hover:text-indigo-600",children:c.jsx(tr,{size:12})})})]})}),c.jsxs("div",{className:"space-y-0",children:[si.map(le=>ii(le)),!ye&&c.jsxs("button",{onClick:()=>Pe(!0),className:"w-full group flex items-center gap-1.5 px-3 py-1 text-gray-300 hover:text-gray-400 text-xs transition-colors transition-opacity opacity-0 hover:opacity-100",children:[c.jsx(Ki,{size:10}),c.jsx("span",{className:"font-medium",children:k("addTagPlaceholder")})]})]})]})]})]}),c.jsxs("div",{className:"mt-auto pt-4 border-t border-gray-200 relative",children:[c.jsxs("div",{className:`flex ${w?"justify-center flex-col gap-2":"justify-between"} items-center`,children:[!w&&c.jsxs("div",{className:"text-[10px] text-gray-400 flex items-center gap-1",children:[c.jsx(EI,{size:10})," ",$z]}),c.jsx("button",{onClick:()=>ke(!ce),"aria-label":"Settings",className:"text-gray-400 hover:text-gray-600 p-1 rounded hover:bg-gray-100 transition-colors",children:c.jsx(LI,{size:14})})]}),ce&&c.jsx("div",{ref:qt,className:"absolute bottom-full left-0 mb-2 w-full bg-white rounded-lg shadow-xl border border-gray-200 z-50 animate-in fade-in zoom-in duration-100 max-h-[60vh] overflow-y-auto",children:c.jsxs("div",{className:"p-3",children:[c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider",children:k("appearance")}),c.jsxs("div",{className:"space-y-3 mb-4",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:k("language")})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>C("zh"),className:`flex-1 text-[10px] py-1 rounded ${R==="zh"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:R==="zh"?"":"Chinese"}),c.jsx("button",{onClick:()=>C("en"),className:`flex-1 text-[10px] py-1 rounded ${R==="en"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:R==="zh"?"":"English"})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:R==="zh"?"":"Color Theme"})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>u(le=>({...le,themeMode:"light"})),className:`flex-1 text-[10px] py-1 rounded ${l.themeMode==="light"||!l.themeMode?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:R==="zh"?"":"Light"}),c.jsx("button",{onClick:()=>u(le=>({...le,themeMode:"dark"})),className:`flex-1 text-[10px] py-1 rounded ${l.themeMode==="dark"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:R==="zh"?"":"Dark"}),c.jsx("button",{onClick:()=>u(le=>({...le,themeMode:"programmer"})),className:`flex-1 text-[10px] py-1 rounded ${l.themeMode==="programmer"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:R==="zh"?"":"Dev"})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:k("fontSize")})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>u(le=>({...le,fontSize:"small"})),className:`flex-1 text-[10px] py-1 rounded ${l.fontSize==="small"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:k("sizeSmall")}),c.jsx("button",{onClick:()=>u(le=>({...le,fontSize:"normal"})),className:`flex-1 text-[10px] py-1 rounded ${l.fontSize==="normal"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:k("sizeNormal")}),c.jsx("button",{onClick:()=>u(le=>({...le,fontSize:"large"})),className:`flex-1 text-[10px] py-1 rounded ${l.fontSize==="large"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:k("sizeLarge")})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[" ",c.jsx("span",{className:"flex items-center gap-1",children:k("timeFormat")})," "]}),c.jsxs("div",{className:"flex bg-gray-100 rounded p-0.5",children:[c.jsx("button",{onClick:()=>u(le=>({...le,timeFormat:"24h"})),className:`flex-1 text-[10px] py-1 rounded ${l.timeFormat==="24h"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:"24H"}),c.jsx("button",{onClick:()=>u(le=>({...le,timeFormat:"12h"})),className:`flex-1 text-[10px] py-1 rounded ${l.timeFormat==="12h"?"bg-white shadow-sm font-bold text-indigo-600":"text-gray-500"}`,children:"12H"})]})]})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:k("calendarSettings")}),c.jsxs("div",{className:"mb-4 space-y-2",children:[c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showLunar,onChange:le=>u({...l,showLunar:le.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:k("showLunar")})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showTaiwanHolidays,onChange:le=>u({...l,showTaiwanHolidays:le.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:k("showTaiwanHolidays")})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showRelationshipLines!==!1,onChange:le=>u({...l,showRelationshipLines:le.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:""})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:l.showImportedGoogleEvents!==!1,onChange:le=>u({...l,showImportedGoogleEvents:le.target.checked}),className:"w-3.5 h-3.5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"text-xs font-medium text-gray-600",children:R==="zh"?" Google ":"Show Google Events"})]})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:"Google Calendar"}),c.jsxs("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"Client ID"}),c.jsx("input",{type:"text",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"your-client-id.apps.googleusercontent.com",value:xt,onChange:le=>it(le.target.value)})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:k("aiSettings")}),c.jsxs("div",{className:"mb-4 space-y-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] font-bold text-gray-400 uppercase mb-1",children:k("provider")}),c.jsxs("select",{value:ge.provider,onChange:le=>Le(vt=>({...vt,provider:le.target.value})),className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",children:[c.jsx("option",{value:"gemini",children:"Google Gemini"}),c.jsx("option",{value:"openai",children:"OpenAI Compatible (DeepSeek/Moonshot)"})]})]}),ge.provider==="gemini"?c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsx("span",{className:"text-xs text-gray-600",children:"Gemini API Key"}),c.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-indigo-500 hover:underline",children:"Get Key"})]}),c.jsx("input",{type:"password",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"AIza...",value:ge.googleKey,onChange:le=>Le(vt=>({...vt,googleKey:le.target.value}))})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"Base URL"}),c.jsx("input",{type:"text",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"https://api.deepseek.com",value:ge.baseUrl,onChange:le=>Le(vt=>({...vt,baseUrl:le.target.value}))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"API Key"}),c.jsx("input",{type:"password",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"sk-...",value:ge.openaiKey,onChange:le=>Le(vt=>({...vt,openaiKey:le.target.value}))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] text-gray-600 mb-1",children:"Model Name"}),c.jsx("input",{type:"text",className:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"e.g. deepseek-chat",value:ge.modelName,onChange:le=>Le(vt=>({...vt,modelName:le.target.value}))})]})]}),c.jsx("button",{onClick:Pr,className:"w-full bg-indigo-600 text-white px-2 py-1.5 rounded text-xs hover:bg-indigo-700 transition-colors font-medium",children:"Save Settings"})]}),c.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider border-t border-gray-100 pt-3",children:"Data"}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("button",{onClick:()=>{confirm(R==="zh"?"":"Are you sure you want to delete all tasks? A backup will be downloaded first.")&&p()},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(Ar,{size:12})," ",R==="zh"?"":"Delete All Tasks"]}),c.jsxs("button",{onClick:m,className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(nu,{size:12})," ",R==="zh"?"":"Backup Data"]}),c.jsxs("button",{onClick:()=>{var le;return(le=q.current)==null?void 0:le.click()},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(L6,{size:12})," ",R==="zh"?"":"Import Data"]}),c.jsxs("button",{onClick:bn,className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(Go,{size:12})," ",R==="zh"?" Google ":"Import Google Calendar"]}),c.jsxs("button",{onClick:()=>x&&x(),className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-gray-600",children:[c.jsx(t1,{size:12})," ",R==="zh"?" Google ":"Sync Google Calendar"]}),c.jsxs("button",{onClick:()=>{localStorage.removeItem("google_sync_tokens"),U({msg:"Sync tokens ...",type:"info"}),x&&x()},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-amber-50 rounded text-xs text-amber-600",children:[c.jsx(t1,{size:12})," ",R==="zh"?"":"Force Full Sync"]}),c.jsxs("button",{onClick:gs,className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-red-600",children:[c.jsx(Ar,{size:12})," ",R==="zh"?"":"Clear Imported Calendar"]}),c.jsxs("button",{onClick:async()=>{if(!confirm("Google:( Google )"))return;const le=JSON.parse(localStorage.getItem("task_google_map")||"{}"),vt=o.filter(Mt=>Mt.tags.some(Et=>{const Zt=a.find(vn=>vn.id===Et);return Zt&&Zt.name.includes("")&&Zt.name.toLowerCase().includes("google")}));let At=0;vt.forEach(Mt=>{le[Mt.id]&&delete le[Mt.id]}),localStorage.setItem("task_google_map",JSON.stringify(le));for(const Mt of vt)await z(Mt.id),At++;U({msg:` ${At} `,type:"success"})},className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 rounded text-xs text-orange-600",children:[c.jsx(Ar,{size:12})," ",R==="zh"?" ()":"Clean CiXing Tasks (Local)"]}),c.jsx("input",{type:"file",ref:q,className:"hidden",accept:".json",onChange:Un})]})]})})]}),_e&&er.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-[9999] flex items-center justify-center",onClick:()=>ve(null),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-80 max-h-[80vh] flex flex-col overflow-hidden",onClick:le=>le.stopPropagation(),children:[c.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h3",{className:"font-bold text-gray-700 text-sm",children:""}),c.jsx("button",{onClick:()=>ve(null),className:"text-gray-400 hover:text-gray-600",children:c.jsx(on,{size:16})})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-xs text-gray-500",children:""}),c.jsx("input",{type:"text",value:pe,onChange:le=>ee(le.target.value),onBlur:()=>{const le={...se};pe.trim()?le[_e]=pe:delete le[_e],ne(le),localStorage.setItem("custom_view_names",JSON.stringify(le))},onKeyDown:le=>{le.key==="Enter"&&le.target.blur()},className:"flex-1 px-2 py-1 text-sm border border-gray-200 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:k(_e)||_e})]})]}),c.jsxs("div",{className:"p-2 overflow-y-auto flex-1 text-sm",children:[c.jsx("p",{className:"px-2 py-2 text-xs text-gray-500 mb-2 bg-yellow-50 rounded border border-yellow-100",children:" () /  () / "}),c.jsx("div",{className:"space-y-1",children:a.map(le=>{const vt=_[_e]||{include:[],exclude:[]},{include:At,exclude:Mt}=Array.isArray(vt)?{include:vt,exclude:[]}:vt,Et=At.includes(le.id),Zt=Mt.includes(le.id);return c.jsxs("div",{className:"flex items-center gap-2 px-2 py-2 hover:bg-gray-50 rounded cursor-pointer select-none",onClick:()=>{let vn=[...At],rr=[...Mt];Et?(vn=vn.filter(Mn=>Mn!==le.id),rr.push(le.id)):Zt?rr=rr.filter(Mn=>Mn!==le.id):vn.push(le.id),N(_e,{include:vn,exclude:rr})},children:[c.jsxs("div",{className:"w-5 h-5 flex items-center justify-center",children:[Et&&c.jsx(Cg,{size:16,className:"text-green-500"}),Zt&&c.jsx(F6,{size:16,className:"text-red-500"}),!Et&&!Zt&&c.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300"})]}),c.jsx("span",{style:{color:I[le.id]},children:le.name.startsWith("#")?le.name.slice(1):le.name})]},le.id)})})]}),c.jsx("div",{className:"p-3 border-t border-gray-100 flex justify-end",children:c.jsx("button",{onClick:()=>ve(null),className:"px-4 py-1.5 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700",children:""})})]})}),document.body),Ce&&er.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-[9999] flex items-center justify-center",onClick:()=>dt(!1),children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-96 p-4 max-h-[80vh] flex flex-col",onClick:le=>le.stopPropagation(),children:[c.jsx("h3",{className:"font-bold text-gray-700 text-sm mb-4",children:Nn==="date"?R==="zh"?"":"Select Date Range":R==="zh"?"":"Select Calendars"}),Nn==="date"?c.jsxs("div",{className:"space-y-3 mb-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Start Date"}),c.jsx("input",{type:"date",className:"w-full border border-gray-200 rounded px-2 py-1 text-sm outline-none focus:ring-1 focus:ring-indigo-500",value:Rt.start,onChange:le=>Ot(vt=>({...vt,start:le.target.value}))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"End Date"}),c.jsx("input",{type:"date",className:"w-full border border-gray-200 rounded px-2 py-1 text-sm outline-none focus:ring-1 focus:ring-indigo-500",value:Rt.end,onChange:le=>Ot(vt=>({...vt,end:le.target.value}))})]}),c.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[c.jsx("button",{onClick:()=>dt(!1),className:"px-3 py-1.5 text-gray-500 hover:bg-gray-100 rounded text-xs",children:"Cancel"}),c.jsx("button",{onClick:gn,className:"px-3 py-1.5 bg-indigo-600 text-white rounded text-xs font-medium hover:bg-indigo-700",children:"Next"})]})]}):c.jsxs("div",{className:"mb-4 flex flex-col flex-1 overflow-hidden",children:[c.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 mb-4 border border-gray-100 rounded p-2",children:an.map(le=>c.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer hover:bg-gray-50 p-1 rounded",children:[c.jsx("input",{type:"checkbox",checked:Ie.has(le.id),onChange:vt=>{const At=new Set(Ie);vt.target.checked?At.add(le.id):At.delete(le.id),Dt(At)},className:"rounded text-indigo-600 focus:ring-indigo-500"}),c.jsx("span",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:le.backgroundColor||"#ccc"}}),c.jsx("span",{className:"truncate",children:le.summary})]},le.id))}),c.jsxs("div",{className:"flex justify-end gap-2 mt-auto",children:[c.jsx("button",{onClick:()=>$t("date"),className:"px-3 py-1.5 text-gray-500 hover:bg-gray-100 rounded text-xs",children:"Back"}),c.jsx("button",{onClick:Pn,disabled:Ie.size===0,className:"px-3 py-1.5 bg-indigo-600 text-white rounded text-xs font-medium hover:bg-indigo-700 disabled:opacity-50",children:"Import"})]})]})]})}),document.body),s&&c.jsx(vee,{current:s.current,total:s.total}),c.jsx(wee,{isOpen:ae,onClose:()=>Z(!1)})]})},_ee=({initialTitle:t,onSave:e,onCancel:n,onSwitchToFull:r,className:s,fontClass:i})=>{const[o,a]=b.useState(t),l=b.useRef(null);b.useEffect(()=>{const d=setTimeout(()=>{if(l.current){l.current.focus();const f=l.current.value.length;l.current.setSelectionRange(f,f)}},50);return()=>clearTimeout(d)},[]);const u=d=>{d.stopPropagation(),d.key==="Enter"&&(d.preventDefault(),d.metaKey||d.ctrlKey?r(o):e(o)),d.key==="Escape"&&(d.preventDefault(),n())};return c.jsx("input",{ref:l,autoFocus:!0,value:o,onChange:d=>a(d.target.value),onBlur:()=>e(o),onKeyDown:u,onClick:d=>d.stopPropagation(),className:`bg-transparent outline-none border-none p-0 m-0 w-full text-gray-900 dark:text-gray-100 caret-gray-900 dark:caret-gray-100 font-normal ${i}`})},pl=({flatTask:t,isFocused:e,onEdit:n,onSelect:r,backgroundColor:s})=>{const{updateTask:i,setFocusedTaskId:o,editingTaskId:a,setEditingTaskId:l,inlineEditingTaskId:u,setInlineEditingTaskId:d,addTask:f,toggleExpansion:h,startDrag:p,keyboardMove:m,tasks:y,tags:x,dragState:g,navigateBack:v,view:w,canNavigateBack:S,smartReschedule:I,lockTask:k,unlockTask:R,verifyTaskPassword:C,temporarilyUnlockTask:T,selectedTaskIds:_,handleSelection:N,themeSettings:j,pendingFocusTaskId:O,setPendingFocusTaskId:P,setSelectedTaskIds:G,visibleTasks:A,t:M,language:Q,batchDeleteTasks:X,batchUpdateTasks:D,setToast:Te,tagFilter:xe}=b.useContext(_n),{recordingTaskId:U}=b.useContext(Iu),z=t.data,ie=b.useRef(null),Be=b.useRef(null),st=b.useRef(null),[ae,Z]=b.useState(!1),[K,de]=b.useState(null),ce=typeof window<"u"&&window.innerWidth<768,[ke,_e]=b.useState(!1),[ve,Ke]=b.useState("lock"),[je,V]=b.useState(""),[re,se]=b.useState(null),ne=t.isExpanded,pe=t.hasChildren,ee=!!z.completed_at&&(z.status==="completed"||z.status==="logged"),ye=z.status==="canceled",Pe=ee||ye,me=_.includes(z.id),Me=!!z.is_locked;Me&&z.lock_password;const qe=Me&&!z.lock_password,ht=Ie=>{if(!Ie)return null;switch(Ie){case"urgent":return"red";case"planned":return"amber";case"delegated":return"green";case"unplanned":return"gray";default:return null}},wt=Ie=>{const Dt=ht(Ie.importance);if(Dt)return Dt;let zt=Ie;const Ft=new Set;for(;zt.parent_id&&!Ft.has(zt.id);){Ft.add(zt.id);const qt=y.find(mn=>mn.id===zt.parent_id);if(!qt)break;zt=qt}return zt.color||"blue"},ge=!1;b.useEffect(()=>{e&&ie.current&&ie.current.focus({preventScroll:!0})},[e]),b.useEffect(()=>{O===z.id&&(P(null),o(z.id),setTimeout(()=>{d(z.id)},50))},[O,z.id,P,o,d]);const Le=Ie=>{Ie?z.status===Ie?i(z.id,{status:"active",completed_at:null}):i(z.id,{status:Ie,completed_at:new Date().toISOString()}):ee||ye?i(z.id,{status:"active",completed_at:null}):i(z.id,{status:"completed",completed_at:new Date().toISOString()})},Ue=Ie=>Ie.start_date?new Date(Ie.start_date).toISOString().split("T")[0]:Ie.due_date?new Date(Ie.due_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],De=Ie=>{if(w!=="today")return!1;const zt=(_.includes(z.id)?_:[z.id]).map(Ft=>A.findIndex(qt=>qt.data.id===Ft)).filter(Ft=>Ft!==-1).sort((Ft,qt)=>Ft-qt);if(zt.length===0)return!1;if(Ie==="up"){const Ft=zt[0];if(Ft===0)return!0;const qt=A[Ft].data,mn=A[Ft-1].data;return Ue(mn)!==Ue(qt)}else{const Ft=zt[zt.length-1];if(Ft===A.length-1)return!0;const qt=A[Ft].data,mn=A[Ft+1].data;return Ue(mn)!==Ue(qt)}},Qe=Ie=>{const Dt=_.includes(z.id)?_:[z.id],zt=Dt.map(gn=>y.find(Er=>Er.id===gn)).filter(gn=>gn!==void 0).sort((gn,Er)=>{var En,Or;const Pn=((En=gn.view_orders)==null?void 0:En.today)??0,Jn=((Or=Er.view_orders)==null?void 0:Or.today)??0;return Pn-Jn});if(zt.length===0)return;const Ft=zt[0],qt=Ft.start_date?new Date(Ft.start_date):new Date,mn=new Date(qt);mn.setDate(mn.getDate()+(Ie==="up"?-1:1));const Cr=mn.toISOString().split("T")[0],gs=y.filter(gn=>{var Pn,Jn;return(((Pn=gn.start_date)==null?void 0:Pn.split("T")[0])||((Jn=gn.due_date)==null?void 0:Jn.split("T")[0]))===Cr&&!Dt.includes(gn.id)}).sort((gn,Er)=>{var En,Or;const Pn=((En=gn.view_orders)==null?void 0:En.today)??0,Jn=((Or=Er.view_orders)==null?void 0:Or.today)??0;return Pn-Jn});let bn;Ie==="up"?bn=gs.reduce((Er,Pn)=>{var Jn;return Math.max(Er,((Jn=Pn.view_orders)==null?void 0:Jn.today)??0)},0)+1e4:bn=gs.reduce((Er,Pn)=>{var Jn;return Math.min(Er,((Jn=Pn.view_orders)==null?void 0:Jn.today)??9e8)},9e8)-(zt.length+1)*1e4,D(zt.map((gn,Er)=>({id:gn.id,data:{start_date:Cr,is_all_day:!0,view_orders:{...gn.view_orders||{},today:bn+Er*1e4}}})))},pt=Ie=>{if(Ie.altKey&&!Ie.ctrlKey&&!Ie.metaKey){if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(Ie.key)&&(Ie.preventDefault(),Ie.stopPropagation()),w==="focus"||w==="recent"||ge||w==="allview"&&z.status==="logged")return;if(w==="today"){if(Ie.key==="ArrowUp"){if(De("up")){Qe("up");return}m(z.id,"up");return}if(Ie.key==="ArrowDown"){if(De("down")){Qe("down");return}m(z.id,"down");return}if(Ie.key==="ArrowRight"){m(z.id,"right");return}if(Ie.key==="ArrowLeft"){S?v():m(z.id,"left");return}}if(w==="upcoming"){if(Ie.key==="ArrowUp"){m(z.id,"up");return}if(Ie.key==="ArrowDown"){m(z.id,"down");return}return}if(Ie.key==="ArrowUp"){m(z.id,"up");return}if(Ie.key==="ArrowDown"){m(z.id,"down");return}if(Ie.key==="ArrowRight"){m(z.id,"right");return}if(Ie.key==="ArrowLeft"){S?v():m(z.id,"left");return}}if(Ie.key==="Tab"){if(Ie.preventDefault(),Ie.stopPropagation(),w==="focus"||w==="upcoming"||ge||w==="allview"&&z.status==="logged")return;if(Ie.shiftKey){if(t.depth===0&&xe){const Dt=document.querySelector(`[data-tag-id="${xe}"]`);if(Dt){Dt.focus(),o(null),G([]);return}}S?v():m(z.id,"left")}else m(z.id,"right");return}if(Ie.key==="Delete"||Ie.key==="Backspace"&&!Ie.target.matches("input, textarea")){Ie.preventDefault(),Ie.stopPropagation();const Dt=_.includes(z.id)?_:[z.id],zt=A.findIndex(qt=>qt.data.id===z.id);let Ft=null;for(let qt=zt+1;qt<A.length;qt++)if(!Dt.includes(A[qt].data.id)){Ft=A[qt];break}if(!Ft){for(let qt=zt-1;qt>=0;qt--)if(!Dt.includes(A[qt].data.id)){Ft=A[qt];break}}X(Dt,w==="trash"),Ft&&(o(Ft.data.id),G([Ft.data.id]));return}if((Ie.ctrlKey||Ie.metaKey)&&Ie.key==="."){Ie.preventDefault(),Ie.stopPropagation(),Ie.shiftKey?Le("canceled"):Le("completed");return}if(Ie.key==="Enter"&&(Ie.preventDefault(),Ie.stopPropagation(),Me?(V(""),Ke("verify"),Ie.metaKey||Ie.ctrlKey?se(()=>()=>n()):se(()=>()=>d(z.id)),_e(!0)):Ie.metaKey||Ie.ctrlKey?n():d(z.id)),Ie.key===" "&&(w==="inbox"||w==="today"||w==="schedule"||w==="waiting"||w==="focus")){Ie.preventDefault(),Ie.stopPropagation();const Dt=A.findIndex(bn=>bn.data.id===z.id),zt=bn=>bn.view_orders&&bn.view_orders[w]!==void 0?bn.view_orders[w]:w==="today"?9e8+new Date(bn.created_at).getTime()/1e3:bn.order_index||0,Ft=zt(z),qt=w==="today"?null:z.parent_id;let mn=null;for(let bn=Dt+1;bn<A.length;bn++){const gn=A[bn];if(w==="today"){mn=zt(gn.data);break}else{if(gn.depth<=t.depth&&gn.data.parent_id!==qt)break;if(gn.data.parent_id===qt){mn=zt(gn.data);break}}}let Cr=Ft+1e4;mn!==null&&(Cr=(Ft+mn)/2);const gs={title:"",status:w==="waiting"?"someday":"inbox",parent_id:qt,order_index:Cr,view_orders:{[w]:Cr}};if(w==="today"){const bn=Ue(z);gs.start_date=bn,gs.status="active",gs.is_all_day=!0}else if(w==="waiting"){const bn=x.find(gn=>gn.name.toLowerCase()==="someday");bn&&(gs.tags=[bn.id])}f(gs,[],void 0).then(bn=>{bn&&(P(bn),G([]))})}if(Ie.ctrlKey){if(Ie.key==="t"&&(Ie.preventDefault(),Ie.stopPropagation(),i(z.id,{start_date:new Date().toISOString(),is_all_day:!0})),Ie.key==="]"){Ie.preventDefault(),Ie.stopPropagation();const Dt=z.start_date?new Date(z.start_date):new Date;Dt.setDate(Dt.getDate()+1),i(z.id,{start_date:Dt.toISOString(),is_all_day:!0})}if(Ie.key==="["){Ie.preventDefault(),Ie.stopPropagation();const Dt=z.start_date?new Date(z.start_date):new Date;Dt.setDate(Dt.getDate()-1),i(z.id,{start_date:Dt.toISOString(),is_all_day:!0})}}Ie.altKey&&(Ie.metaKey||Ie.ctrlKey)&&Ie.key==="r"&&(Ie.preventDefault(),Ie.stopPropagation(),I(z.id)),!Ie.altKey&&!Ie.ctrlKey&&!Ie.metaKey&&Ie.key!==" "&&(Ie.key==="ArrowRight"&&(Ie.preventDefault(),pe&&!ne&&h(z.id,!0)),Ie.key==="ArrowLeft"&&(Ie.preventDefault(),ne?h(z.id,!1):z.parent_id&&o(z.parent_id)))},nt=w==="focus",ut=w!=="focus"&&(g.draggedId===z.id||g.isDragging&&me),Y=`group relative ${nt?"mb-0":"mb-1 md:mb-0.5"} rounded-lg outline-none select-none cursor-default ${nt?"py-0.5":"py-2 md:py-1.5"} ${me?"bg-theme-selection":""} ${!me&&!ut&&(e&&!me&&!ut?"bg-theme-hover":"")} ${Pe&&w!=="logbook"&&w!=="trash"?"bg-emerald-50/30":Pe?"opacity-60 grayscale":""} ${ut?"opacity-40 scale-[0.98] blur-[0.5px] transition-all duration-200":"opacity-100 scale-100 transition-all duration-200"} transition-all duration-200 ease-in-out hover-effect active:bg-theme-hover touch-manipulation`,q=()=>{const Ie=[];if(z.repeat_rule&&Ie.push(c.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-50 text-purple-600 flex items-center gap-0.5",title:z.repeat_rule.originalText||"",children:c.jsx(RI,{size:10})},"repeat")),z.start_date){const Dt=kw(z.start_date),zt=Yx(z.start_date)&&!Pe;let Ft="bg-theme-hover text-theme-secondary";Dt?Ft="bg-yellow-50 text-yellow-600 font-medium":zt&&(Ft="bg-red-50 text-red-600 font-medium"),Ie.push(c.jsxs("span",{className:`text-[10px] px-1.5 py-0.5 rounded border border-transparent ${Ft} flex items-center gap-1`,children:[c.jsx(Go,{size:10})," ",hI(z.start_date,!z.is_all_day,Q)]},"date"))}return Ie.length===0?null:c.jsx(c.Fragment,{children:Ie})},oe=nt||j.fontWeight==="thin"?"font-extralight":"font-semibold",Ce={small:"text-sm",normal:"text-base",large:"text-lg"}[j.fontSize]||"text-base",xt=(()=>{if(w!=="focus"&&w!=="today"||!z.parent_id)return null;const Ie=[];let Dt=y.find(qt=>qt.id===z.parent_id),zt="blue";const Ft=new Set;for(;Dt&&!Ft.has(Dt.id);)Ft.add(Dt.id),Ie.unshift({title:Dt.title||"Untitled"}),Dt.parent_id||(zt=Dt.color||"blue"),Dt=y.find(qt=>qt.id===Dt.parent_id);return Ie.length===0?null:{items:Ie,rootColor:zt}})(),it=nt?"text-[10px]":Ce,Rt=nt?12:14,Ot=nt?12:16,Nn=nt?"text-[8px]":"text-[10px]",$t=b.useCallback(Ie=>{if(!ce)return;const Dt=Ie.touches[0];Be.current={x:Dt.clientX,y:Dt.clientY,time:Date.now()},st.current=setTimeout(()=>{Z(!0),navigator.vibrate&&navigator.vibrate(50)},500)},[ce]),an=b.useCallback(Ie=>{if(!Be.current)return;const Dt=Ie.touches[0],zt=Math.abs(Dt.clientX-Be.current.x),Ft=Math.abs(Dt.clientY-Be.current.y);(zt>10||Ft>10)&&st.current&&(clearTimeout(st.current),st.current=null)},[]),Tn=b.useCallback(()=>{st.current&&(clearTimeout(st.current),st.current=null),Z(!1),Be.current=null},[]);return c.jsxs(Rr.div,{layout:!0,transition:{layout:{duration:.2,ease:"easeInOut"}},ref:ie,"data-task-id":z.id,"data-task-index":t.index,draggable:!ce&&w!=="schedule"&&w!=="focus"&&!ge&&!(w==="allview"&&z.status==="logged"),onDragStart:Ie=>{if(w==="focus"||ge||w==="allview"&&z.status==="logged"){Ie.preventDefault();return}p(Ie,t)},className:`${Y} ${ae?"scale-[1.02] shadow-lg z-50":""}`,style:{marginLeft:`${w==="today"?0:t.depth*up}px`,backgroundColor:s||"transparent"},tabIndex:0,onKeyDown:pt,onClick:Ie=>{Ie.stopPropagation(),Ie.preventDefault(),ce?a||(Me?(V(""),Ke("verify"),se(()=>()=>setTimeout(()=>l(z.id),50)),_e(!0)):setTimeout(()=>l(z.id),50)):(r||N)(Ie,z.id)},onDoubleClick:Ie=>{Ie.stopPropagation(),ce||(Me?(V(""),Ke("verify"),se(()=>()=>n()),_e(!0)):n())},onTouchStart:$t,onTouchMove:an,onTouchEnd:Tn,children:[c.jsx("div",{className:`flex flex-col ${nt?"px-1":"px-3"}`,children:c.jsxs("div",{className:"flex items-center gap-3",children:[w==="recent"&&c.jsx("span",{className:"text-[10px] text-gray-300 font-light w-14 flex-shrink-0 tabular-nums",children:z.updated_at?new Date(z.updated_at).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"}):""}),w==="trash"?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-[18px] flex justify-center",children:c.jsx(Ar,{size:14,className:"text-gray-300"})}),c.jsx("span",{className:"flex-1 text-gray-400 line-through truncate select-text",children:z.title}),c.jsx("button",{onClick:Ie=>{Ie.stopPropagation();const Dt=_.includes(z.id)?_:[z.id];D(Dt.map(zt=>({id:zt,data:{status:"inbox"}}))),Te({msg:" Inbox",type:"info"})},className:"px-2 py-1 bg-white border border-gray-200 text-indigo-600 text-[10px] font-medium rounded hover:bg-indigo-50 hover:border-indigo-200 transition-colors shadow-sm whitespace-nowrap",children:M("putBack")})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex items-center gap-1",children:[pe&&w!=="today"?c.jsx("button",{onClick:Ie=>{Ie.stopPropagation(),h(z.id)},className:"text-slate-400 hover:text-slate-800 transition-transform",children:ne?c.jsx(ds,{size:Rt}):c.jsx(ts,{size:Rt})}):c.jsx("div",{className:`${nt?"w-[12px]":"w-[16px]"}`}),c.jsx(wA,{checked:ee,isCanceled:ye,onChange:Ie=>{Ie.stopPropagation(),Ie.altKey?Le("canceled"):Le()},color:wt(z),isRoot:!z.parent_id,size:nt?14:18})]}),c.jsxs("div",{className:"flex-1 min-w-0 cursor-text flex items-center overflow-hidden relative min-h-[1.5em]",children:[Me&&c.jsx(Ma,{size:12,className:"text-amber-500 mr-1.5 flex-shrink-0"}),U===z.id&&c.jsx("div",{className:"mr-2 flex-shrink-0 w-2 h-2 rounded-full bg-red-500 animate-pulse shadow-[0_0_6px_rgba(239,68,68,0.6)]",title:"Recording..."}),c.jsx("span",{className:`${it} ${oe} transition-all duration-300 ${Pe?"opacity-30":"text-theme-primary"} ${ye?"line-through decoration-gray-400":""} mr-2 truncate block flex-shrink ${u===z.id?"opacity-0":""} ${qe?"blur-[4px] select-none":""}`,children:z.title}),u===z.id&&c.jsx("div",{className:"absolute inset-0 bg-white dark:bg-gray-800 z-50 flex items-center pr-2",children:c.jsx(_ee,{initialTitle:z.title,className:`${it} ${oe}`,fontClass:"",onSave:Ie=>{Ie!==z.title&&i(z.id,{title:Ie}),d(null),ie.current&&ie.current.focus()},onCancel:()=>{d(null),ie.current&&ie.current.focus()},onSwitchToFull:async Ie=>{await i(z.id,{title:Ie}),d(null),n()}})}),xt&&c.jsx("div",{className:"flex items-center gap-0.5 mr-2 flex-shrink-0",children:xt.items.map((Ie,Dt)=>{var zt,Ft;return c.jsxs(An.Fragment,{children:[Dt>0&&c.jsx(ts,{size:10,className:"text-gray-300 flex-shrink-0",strokeWidth:1.5}),c.jsx("span",{className:`${nt?"text-[8px]":"text-[9px]"} font-semibold px-1.5 py-[1px] rounded transition-colors duration-200 truncate max-w-[150px]`,style:{backgroundColor:(((zt=Kn[xt.rootColor])==null?void 0:zt.color)||"#6366f1")+"15",color:((Ft=Kn[xt.rootColor])==null?void 0:Ft.color)||"#6366f1"},title:Ie.title,children:Ie.title})]},Dt)})}),(z.tags||[]).length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"hidden md:flex items-center gap-1 mr-2 flex-shrink-0",children:(z.tags||[]).map(Ie=>{var Ft;const Dt=(Ft=x.find(qt=>qt.id===Ie))==null?void 0:Ft.name;if(!Dt)return null;const zt=Dt.startsWith("#");return c.jsx("div",{className:"relative flex-shrink-0",children:c.jsx("span",{className:`${Nn} border rounded-md px-1.5 py-px whitespace-nowrap ${zt?"bg-emerald-50 text-emerald-700 border-emerald-200":`border-theme ${ee?"text-theme-tertiary bg-theme-hover":"text-theme-secondary bg-theme-hover"}`}`,children:Dt})},Ie)})}),c.jsxs("div",{className:"md:hidden flex items-center mr-2 text-slate-400 flex-shrink-0",children:[c.jsx(Ol,{size:Ot}),(z.tags||[]).length>1&&c.jsx("span",{className:`${nt?"text-[8px]":"text-[9px]"} ml-0.5`,children:(z.tags||[]).length})]})]}),z.description&&c.jsx(Wf,{size:12,className:"text-slate-400 mr-2 flex-shrink-0"}),z.attachments&&z.attachments.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"mr-2 flex-shrink-0 cursor-pointer",onMouseEnter:Ie=>{const Dt=Ie.currentTarget.getBoundingClientRect();de({visible:!0,x:Dt.left+Dt.width/2,y:Dt.top-8,attachments:z.attachments||[]})},onMouseLeave:()=>de(null),children:c.jsx(co,{size:12,className:"text-slate-400"})}),(K==null?void 0:K.visible)&&K.attachments===z.attachments&&er.createPortal(c.jsx("div",{className:"fixed z-[99999] pointer-events-none",style:{left:K.x,top:K.y,transform:"translate(-50%, -100%)"},children:c.jsxs("div",{className:"bg-gray-800 text-white text-[10px] px-2.5 py-2 rounded-lg shadow-2xl max-w-[220px]",children:[c.jsxs("div",{className:"font-semibold mb-1 text-[11px]",children:[z.attachments.length," "]}),z.attachments.slice(0,5).map((Ie,Dt)=>c.jsx("div",{className:"truncate opacity-80 py-0.5",children:Ie.name},Dt)),z.attachments.length>5&&c.jsxs("div",{className:"opacity-60 pt-1",children:["... ",z.attachments.length-5," "]})]})}),document.body)]}),c.jsxs("div",{className:`ml-auto ${Pe?"opacity-50":"opacity-100"} flex-shrink-0`,children:[" ",q()," "]})]}),c.jsxs("div",{className:"opacity-100 md:opacity-0 md:group-hover:opacity-100 flex items-center gap-1 pl-2",children:[c.jsx("button",{onClick:Ie=>{Ie.stopPropagation(),V(""),Ke(Me?"unlock":"lock"),_e(!0)},className:`p-1 transition-colors ${Me?"text-amber-500 hover:text-amber-600":"text-slate-300 hover:text-amber-500"}`,title:Me?"":"",children:Me?c.jsx(n1,{size:Ot}):c.jsx(Ma,{size:Ot})}),c.jsx("button",{onClick:Ie=>{Ie.stopPropagation();const Dt=_.includes(z.id)?_:[z.id];X(Dt,w==="trash")},className:"p-1 hover:text-red-500 text-slate-300 transition-colors",children:c.jsx(Ar,{size:Ot})})]})]})]})}),ke&&er.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999]",onClick:()=>{_e(!1),se(null)},children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-80 max-w-[90vw]",onClick:Ie=>Ie.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[ve==="lock"?c.jsx(Ma,{size:20,className:"text-amber-500"}):c.jsx(n1,{size:20,className:"text-emerald-500"}),c.jsx("h3",{className:"text-lg font-bold",children:ve==="lock"?"":ve==="verify"?"":""})]}),c.jsx("p",{className:"text-sm text-gray-500 mb-4",children:ve==="lock"?"":ve==="verify"?"":""}),c.jsx("input",{type:"password",placeholder:"",value:je,onChange:Ie=>V(Ie.target.value),onKeyDown:Ie=>{Ie.key==="Enter"&&(ve==="lock"?je.length>=1&&(k(z.id,je),_e(!1)):ve==="verify"?C(z.id,je)?(T(z.id),_e(!1),re&&re(),se(null)):Te({msg:"",type:"error"}):R(z.id,je).then(Dt=>{Dt&&_e(!1)})),Ie.key==="Escape"&&(_e(!1),se(null))},autoFocus:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-amber-500"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:()=>{_e(!1),se(null)},className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:""}),c.jsx("button",{onClick:()=>{ve==="lock"?je.length>=1&&(k(z.id,je),_e(!1)):ve==="verify"?C(z.id,je)?(T(z.id),_e(!1),re&&re(),se(null)):Te({msg:"",type:"error"}):R(z.id,je).then(Ie=>{Ie&&_e(!1)})},className:`flex-1 px-4 py-2 rounded-lg transition-colors ${ve==="lock"?"bg-amber-500 text-white hover:bg-amber-600":"bg-emerald-500 text-white hover:bg-emerald-600"}`,children:ve==="lock"?"":ve==="verify"?"":""})]})]})}),document.body)]})},Tee=({show:t,top:e,left:n,width:r,color:s})=>{if(!t)return null;const i=Kn[s]||Kn.blue;return c.jsx("div",{className:"absolute pointer-events-none z-10 transition-all duration-100 ease-out",style:{top:`${e}px`,left:`${n}px`,width:`${r}px`},children:c.jsx("div",{className:`h-0.5 ${i.indicator} rounded-full shadow-sm relative`,children:c.jsx("div",{className:`absolute -left-1.5 -top-[3px] w-2 h-2 ${i.indicator} rounded-full shadow-md`})})})},Cee={red:"#ef4444",orange:"#f97316",yellow:"#eab308",green:"#22c55e",blue:"#3b82f6",purple:"#a855f7",pink:"#ec4899",gray:"#9ca3af"},Eee=({containerRef:t,tasks:e})=>{const[n,r]=b.useState([]),s=b.useRef(null),i=b.useRef(null),o=b.useCallback(()=>{if(!t.current)return;const a=t.current.getBoundingClientRect(),l=t.current.querySelectorAll("[data-task-id]"),u=new Map;l.forEach(g=>{const v=g.getAttribute("data-task-id");if(v){const w=g.getBoundingClientRect();u.set(v,{top:w.top-a.top,height:w.height})}});const d=new Map(e.map(g=>[g.data.id,g.data])),f=new Set(e.map(g=>g.data.id)),h=g=>{let v=g,w=0;const S=new Set,I=[];for(;w<50&&!S.has(v);){S.add(v);const R=d.get(v);if(!R)break;if(I.push(v),!R.parent_id||!f.has(R.parent_id))return{rootId:v,color:R.color||"gray",depth:I.length-1};v=R.parent_id,w++}const k=d.get(g);return{rootId:g,color:(k==null?void 0:k.color)||"gray",depth:0}},p=new Map;e.forEach(g=>{const v=u.get(g.data.id);if(!v)return;const w=h(g.data.id);if(!p.has(w.rootId)){const I=u.get(w.rootId);p.set(w.rootId,{rootId:w.rootId,color:Cee[w.color]||w.color,rootTop:(I==null?void 0:I.top)||v.top,rootHeight:(I==null?void 0:I.height)||v.height,minTop:v.top,maxBottom:v.top+v.height,tasks:[],offsetX:0})}const S=p.get(w.rootId);S.minTop=Math.min(S.minTop,v.top),S.maxBottom=Math.max(S.maxBottom,v.top+v.height),w.depth>0&&S.tasks.push({taskId:g.data.id,rootId:w.rootId,rootColor:S.color,depth:w.depth,top:v.top,height:v.height})});const m=Array.from(p.values()).filter(g=>g.tasks.length>0);m.sort((g,v)=>g.rootTop-v.rootTop);const y=8,x=8;m.forEach((g,v)=>{g.offsetX=y+v*x}),r(m)},[t,e]);return b.useEffect(()=>{o();const a=t.current;a&&a.addEventListener("scroll",o),i.current=new ResizeObserver(o),a&&i.current.observe(a),window.addEventListener("resize",o);const l=setInterval(o,100);return()=>{a&&a.removeEventListener("scroll",o),i.current&&i.current.disconnect(),window.removeEventListener("resize",o),clearInterval(l)}},[o]),b.useEffect(()=>{const a=setTimeout(o,50);return()=>clearTimeout(a)},[e,o]),n.length===0?null:c.jsxs("svg",{ref:s,className:"absolute top-0 left-0 w-full h-full pointer-events-none z-10",style:{overflow:"visible"},children:[c.jsx("defs",{children:c.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[c.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),c.jsxs("feMerge",{children:[c.jsx("feMergeNode",{in:"coloredBlur"}),c.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),n.map((a,l)=>{const u=a.offsetX,d=a.rootTop+a.rootHeight/2,f=a.maxBottom-6;return c.jsxs("g",{children:[c.jsx("path",{d:`M ${u} ${d} L ${u} ${f}`,fill:"none",stroke:a.color,strokeWidth:"2",strokeOpacity:"0.3",strokeLinecap:"round"}),c.jsx("circle",{cx:u,cy:d,r:"4",fill:a.color,opacity:"0.9",filter:"url(#glow)"}),a.tasks.map((h,p)=>c.jsx("rect",{x:u-1.5,y:h.top+8,width:3,height:h.height-16,rx:1.5,ry:1.5,fill:h.rootColor,opacity:.6-(h.depth-1)*.1},`bar-${p}`))]},`group-${l}`)})]})},sE={"zh-TW":["","","","","","",""],en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},iE={"zh-TW":["1","2","3","4","5","6","7","8","9","10","11","12"],en:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},Nee=({date:t,isToday:e,isTomorrow:n,taskCount:r,language:s="zh-TW"})=>{var p,m;const i=new Date(t+"T12:00:00"),o=i.getDate(),a=((p=iE[s])==null?void 0:p[i.getMonth()])||iE.en[i.getMonth()],l=((m=sE[s])==null?void 0:m[i.getDay()])||sE.en[i.getDay()],u=i.getDay()===0||i.getDay()===6;let d="",f="";e?(d=s==="zh-TW"?"":"Today",f=`${a}${o}`):n?(d=s==="zh-TW"?"":"Tomorrow",f=`${a}${o}`):(d=`${a}${o}`,f=l);const h=()=>e?"text-blue-600":n?"text-orange-500":u?"text-purple-500":"text-gray-500";return c.jsxs("div",{className:"flex items-center gap-3 pt-6 pb-2 px-1 select-none","data-date-separator":t,children:[c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsx("span",{className:`text-[13px] font-semibold ${h()}`,children:d}),f&&c.jsx("span",{className:"text-[11px] text-gray-400 font-normal",children:f})]}),c.jsx("div",{className:"flex-1 h-[1px] bg-gray-200"}),r>0&&c.jsx("span",{className:"text-[10px] text-gray-400 tabular-nums",children:r})]})},jee=(t,e)=>{const n=[];for(let r=0;r<e;r++){const s=new Date(t);s.setDate(s.getDate()+r);const i=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),a=String(s.getDate()).padStart(2,"0");n.push(`${i}-${o}-${a}`)}return n},Iee=t=>{const e=new Date,n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=`${n}-${r}-${s}`;return t===i},Dee=t=>{const e=new Date;e.setDate(e.getDate()+1);const n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=`${n}-${r}-${s}`;return t===i},bR=({rootParentId:t})=>{const{visibleTasks:e,focusedTaskId:n,setFocusedTaskId:r,editingTaskId:s,setEditingTaskId:i,expandedTaskIds:o,endDrag:a,dragState:l,updateDropState:u,updateGhostPosition:d,selectedTaskIds:f,setSelectedTaskIds:h,handleSelection:p,selectionAnchor:m,tasks:y,tags:x,pendingFocusTaskId:g,setPendingFocusTaskId:v,view:w,addTask:S,reviewTask:I,emptyTrash:k,restoreTrash:R,t:C,archivedTasks:T,restoreArchivedTask:_,deleteArchivedTask:N,updateArchivedTask:j,batchDeleteArchivedTasks:O,batchDeleteTasks:P,batchUpdateTasks:G,duplicateTasks:A,leavingTaskIds:M,dismissLeavingTasks:Q,themeSettings:X}=b.useContext(_n),D=b.useRef(null),Te=b.useRef(null),xe=b.useRef(null),[U,z]=b.useState(new Date);b.useEffect(()=>{const he=()=>{const Xe=new Date;Xe.getDate()!==U.getDate()&&z(Xe)},we=setInterval(he,6e4);return window.addEventListener("focus",he),()=>{clearInterval(we),window.removeEventListener("focus",he)}},[U]);const ie=b.useRef(null),[Be,st]=b.useState("none"),ae=b.useMemo(()=>{if(!t)return e;const he=lt=>{const Ge=w==="allview"||w==="project"?"all":w;return lt.view_orders&&lt.view_orders[Ge]!==void 0?lt.view_orders[Ge]:lt.order_index||0},we=y.filter(lt=>lt.parent_id===t&&lt.status!=="deleted"&&lt.status!=="logged").sort((lt,Ge)=>he(lt)-he(Ge)||(lt.created_at||"").localeCompare(Ge.created_at||""));let Xe=0;const Ze=(lt,Ge=0,Ct=[])=>{let Y=[];return lt.forEach(q=>{const oe=y.filter(it=>it.parent_id===q.id&&it.status!=="logged"&&it.status!=="deleted").sort((it,Rt)=>he(it)-he(Rt)||(it.created_at||"").localeCompare(Rt.created_at||"")),Ce=oe.length>0,dt=o.includes(q.id),xt=[...Ct,q.id];Y.push({data:q,depth:Ge,hasChildren:Ce,isExpanded:dt,path:xt,index:Xe++}),Ce&&dt&&(Y=[...Y,...Ze(oe,Ge+1,xt)])}),Y};return Ze(we)},[e,t,y,o,w]);let Z=t?ae:e;const K=b.useMemo(()=>{if(Be==="none"||Z.length===0)return null;let he=Date.now(),we=0;return Z.forEach(Xe=>{const Ze=Xe.data.updated_at?new Date(Xe.data.updated_at).getTime():0;Ze>0&&(Ze<he&&(he=Ze),Ze>we&&(we=Ze))}),we===he&&(we=he+1),{minTime:he,maxTime:we}},[Be,Z]),de=he=>{if(!K||Be==="none")return;const we=he.updated_at?new Date(he.updated_at).getTime():0;if(we===0)return;const Xe=(we-K.minTime)/(K.maxTime-K.minTime),Ze=Math.max(0,Math.min(1,Xe));return Be==="recent"?`rgba(255, 0, 0, ${.02+Ze*.18})`:`rgba(250, 204, 21, ${.02+Ze*.18})`},ce=b.useRef(null),ke=b.useCallback((he,we)=>{r(we);const Xe=he.shiftKey||he.shiftKey,Ze=he.ctrlKey||he.metaKey;if(Xe){const lt=ce.current||n||we;ce.current=lt;const Ge=Z.findIndex(Y=>Y.data.id===lt),Ct=Z.findIndex(Y=>Y.data.id===we);if(Ge!==-1&&Ct!==-1){const[Y,q]=Ge<Ct?[Ge,Ct]:[Ct,Ge],oe=Z.slice(Y,q+1).map(Ce=>Ce.data.id);h(oe)}}else Ze?(ce.current=we,h(lt=>lt.includes(we)?lt.filter(Ge=>Ge!==we):[...lt,we])):(ce.current=we,h([we]))},[Z,n,r,h]),_e=w==="upcoming"?ke:p;b.useEffect(()=>{const he=we=>{var lt;if(s)return;const Xe=document.activeElement;if((Xe==null?void 0:Xe.tagName)==="INPUT"||(Xe==null?void 0:Xe.tagName)==="TEXTAREA"||Xe!=null&&Xe.isContentEditable||Xe!=null&&Xe.closest("[data-tag-id]")||document.querySelector("[data-search-modal]"))return;if((we.metaKey||we.ctrlKey)&&(we.key==="a"||we.key==="A")){we.preventDefault();const Ge=Z.map(Ct=>Ct.data.id);h(Ge);return}if((we.metaKey||we.ctrlKey)&&(we.key==="t"||we.key==="T")){we.preventDefault();const Ge=f.length>0?f:n?[n]:[];if(Ge.length>0){const Ct=new Date().toISOString().split("T")[0];G(Ge.map(Y=>({id:Y,data:{start_date:Ct,status:"active"}})))}return}if((we.metaKey||we.ctrlKey)&&(we.key==="d"||we.key==="D")){we.preventDefault();const Ge=f.length>0?f:n?[n]:[];Ge.length>0&&A(Ge);return}const Ze=Z.findIndex(Ge=>Ge.data.id===n);if(we.metaKey||we.ctrlKey){if(we.key==="ArrowUp"){if(we.preventDefault(),Z.length>0){const Ge=Z[0];r(Ge.data.id),_e({shiftKey:!1,ctrlKey:!1},Ge.data.id)}return}if(we.key==="ArrowDown"){if(we.preventDefault(),Z.length>0){const Ge=Z[Z.length-1];r(Ge.data.id),_e({shiftKey:!1,ctrlKey:!1},Ge.data.id)}return}}if(we.shiftKey&&(we.key==="ArrowDown"||we.key==="ArrowUp")){we.preventDefault();let Ge=Ze;we.key==="ArrowDown"&&(Ge=Math.min(Ze+1,Z.length-1)),we.key==="ArrowUp"&&(Ge=Math.max(Ze-1,0));const Ct=Z[Ge];Ct&&(r(Ct.data.id),_e({shiftKey:!0,preventDefault:()=>{}},Ct.data.id));return}if(we.key==="ArrowDown"&&!we.altKey){we.preventDefault();const Ge=Ze+1;if(Ge<Z.length){const Ct=Z[Ge];r(Ct.data.id),_e({shiftKey:!1,ctrlKey:!1},Ct.data.id)}}else if(we.key==="ArrowUp"&&!we.altKey){we.preventDefault();const Ge=Ze-1;if(Ge>=0){const Ct=Z[Ge];r(Ct.data.id),_e({shiftKey:!1,ctrlKey:!1},Ct.data.id)}}else if(we.key==="Enter")Ze!==-1&&!s&&!we.altKey&&w!=="trash"&&(we.preventDefault(),i(Z[Ze].data.id));else if(we.key===" "&&!s&&w!=="trash")if(we.preventDefault(),Ze!==-1){ie.current=n;const Ge=Z[Ze],Ct=Ge.data.parent_id,Y=it=>it.view_orders&&it.view_orders[w]!==void 0?it.view_orders[w]:w==="today"?9e8+new Date(it.created_at).getTime()/1e3:it.order_index||0,q=Y(Ge.data);let oe=null;for(let it=Ze+1;it<Z.length;it++){const Rt=Z[it];if(Rt.depth<=Ge.depth&&Rt.data.parent_id!==Ct)break;if(Rt.data.parent_id===Ct){oe=Y(Rt.data);break}}let Ce;oe!==null?Ce=(q+oe)/2:Ce=q+1e4;const dt=x.find(it=>it.name.toLowerCase()==="prompt"),xt={title:"",parent_id:Ct,status:Ge.data.status,tags:w==="prompt"&&dt?[dt.id]:Ge.data.tags,color:Ge.data.color,start_date:Ge.data.start_date,order_index:Ce,view_orders:{[w]:Ce}};S(xt).then(it=>{v(it),h([])})}else{const Ge=new Date().toISOString().split("T")[0],Ct=x.find(it=>it.name.toLowerCase()==="prompt"),Y=x.find(it=>it.name.toLowerCase()==="note"),q=x.find(it=>it.name.toLowerCase()==="journal"),oe=x.find(it=>it.name.includes("")),Ce=it=>it.view_orders&&it.view_orders[w]!==void 0?it.view_orders[w]:w==="today"?9e8+new Date(it.created_at).getTime()/1e3:it.order_index||0;let dt=1e4;if(Z.length>0){const it=Z.filter(Rt=>!Rt.data.parent_id);if(it.length>0){const Rt=it[it.length-1];dt=Ce(Rt.data)+1e4}else{const Rt=Z[Z.length-1];dt=Ce(Rt.data)+1e4}}const xt={title:"",parent_id:null,status:"inbox",tags:[],order_index:dt,view_orders:{[w]:dt}};if(w==="today")xt.start_date=Ge,xt.status="active";else if(w==="prompt")xt.status="active",Ct&&(xt.tags=[Ct.id]);else if(w==="journal")xt.status="active",Y?xt.tags=[Y.id]:q&&(xt.tags=[q.id]);else if(w==="waiting")xt.status="waiting",oe&&(xt.tags=[oe.id]);else if(w==="focus")xt.status="active";else if(w==="upcoming"){const it=new Date;it.setDate(it.getDate()+1),xt.start_date=it.toISOString().split("T")[0],xt.status="active"}S(xt).then(it=>{v(it),h([])})}else if((we.key==="Delete"||we.key==="Backspace")&&!s){if(["INPUT","TEXTAREA"].includes(((lt=document.activeElement)==null?void 0:lt.tagName)||""))return;const Ge=f.length>0?f:n?[n]:[];Ge.length>0&&(we.preventDefault(),P(Ge,w==="trash"),n&&Ge.includes(n))}};return window.addEventListener("keydown",he),()=>window.removeEventListener("keydown",he)},[Z,n,o,s,m,S,i,r,_e,w,x,f,P,G,A]);const ve=!1,Ke=he=>{var Dt;if(w==="focus"||w==="upcoming"||w==="recent"||(he.preventDefault(),!l.isDragging||!D.current))return;if(d(he.clientX,he.clientY),xe.current){u({dropIndex:null,indicatorTop:0});return}const we=D.current.getBoundingClientRect(),Xe=he.clientX,Ze=he.clientY,lt=Xe-we.left,Ge=100,Ct=10,Y=window.innerHeight,q=document.querySelector("main");q&&(Ze<Ge?Te.current||(Te.current=setInterval(()=>{q.scrollTop-=Ct},16)):Ze>Y-Ge?Te.current||(Te.current=setInterval(()=>{q.scrollTop+=Ct},16)):Te.current&&(clearInterval(Te.current),Te.current=null));let oe=-1,Ce=null,dt=document.elementFromPoint(Xe,Ze);for(;dt&&dt!==D.current&&dt!==document.body;){if(dt.hasAttribute("data-task-index")){oe=parseInt(dt.getAttribute("data-task-index")||"-1"),Ce=dt.getBoundingClientRect();break}dt=dt.parentElement}if(oe===-1&&Z.length>0&&D.current){const zt=D.current.querySelector("[data-task-index]:last-child");if(zt){const Ft=zt.getBoundingClientRect();Ze>Ft.bottom&&(oe=parseInt(zt.getAttribute("data-task-index")||"-1")+1,Ce=Ft)}}if(oe===-1){const zt=(Dt=D.current)==null?void 0:Dt.querySelector("[data-task-index]:first-child");if(zt){const Ft=zt.getBoundingClientRect();Ze<Ft.top&&(oe=0,Ce=Ft)}if(oe===-1)return}let xt=oe,it=oe;if(Ce){const zt=Ce.top+Ce.height/2;Ze>zt&&oe<Z.length&&(xt=oe+1)}const Rt=lt-l.dragOffsetX+l.originalDepth*up;let Ot=Math.floor(Rt/up);Ot<0&&(Ot=0);const Nn=Z[xt-1],$t=Nn?Nn.depth+1:0;Ot>$t&&(Ot=$t);let an=0;Ce?xt===oe?an=Ce.top-we.top:an=Ce.bottom-we.top:xt===0&&(an=0);let Tn=Ot*up+40,Ie=we.width-Tn-20;w==="today"&&(Ot=0,Tn=40,Ie=we.width-60),u({dropIndex:xt,dropDepth:Ot,indicatorTop:an,indicatorLeft:Tn,indicatorWidth:Ie,anchorTaskIndex:it})},je=()=>{Te.current&&(clearInterval(Te.current),Te.current=null),a(Z)},V=he=>{const we=he||ie.current||n;i(null),we&&(r(we),h([we]),setTimeout(()=>{var Ze;const Xe=(Ze=D.current)==null?void 0:Ze.querySelector(`[data-task-id="${we}"]`);Xe&&(Xe.focus(),Xe.scrollIntoView({block:"nearest",behavior:"smooth"}))},100)),ie.current=null,g&&v(null)},re=()=>{if(l.dropIndex===null||l.dropIndex===0)return"blue";const he=Z[l.dropIndex-1];return(he==null?void 0:he.data.color)||"blue"},se=Z,ne=b.useMemo(()=>w!=="inbox"||M.length===0?[]:M.map(he=>y.find(we=>we.id===he)).filter(Boolean).map((he,we)=>({data:he,depth:0,hasChildren:!1,isExpanded:!1,path:[he.id],index:we})),[w,M,y]),[pe,ee]=b.useState(!0),ye=Z,Pe=b.useMemo(()=>{if(w!=="allview"&&w!=="logbook")return[];const he=new Map(T.map(lt=>[lt.id,lt])),we=T.filter(lt=>!lt.parent_id||!he.has(lt.parent_id)).sort((lt,Ge)=>new Date(Ge.archived_at||Ge.completed_at||0).getTime()-new Date(lt.archived_at||lt.completed_at||0).getTime()),Xe=[],Ze=(lt,Ge,Ct)=>{const Y=T.filter(q=>q.parent_id===lt.id);Xe.push({data:lt,depth:Ge,hasChildren:Y.length>0,isExpanded:!0,path:[...Ct,lt.id],index:Xe.length}),Y.forEach(q=>Ze(q,Ge+1,[...Ct,lt.id]))};return we.forEach(lt=>Ze(lt,0,[])),Xe},[T,w]),[me,Me]=b.useState(null),[qe,ht]=b.useState(""),[wt,ge]=b.useState([]),Le=b.useRef(null),Ue=he=>{if(!he)return"";const we=new Date(he);return`${we.getFullYear()}-${String(we.getMonth()+1).padStart(2,"0")}-${String(we.getDate()).padStart(2,"0")}`},De=he=>{if(qe){const we=new Date(qe);isNaN(we.getTime())||j(he,{completed_at:we.toISOString()})}Me(null)},Qe=(he,we)=>{if(he.stopPropagation(),he.shiftKey&&Le.current){const Xe=Pe.findIndex(lt=>lt.data.id===Le.current),Ze=Pe.findIndex(lt=>lt.data.id===we);if(Xe!==-1&&Ze!==-1){const[lt,Ge]=Xe<Ze?[Xe,Ze]:[Ze,Xe],Ct=Pe.slice(lt,Ge+1).map(Y=>Y.data.id);ge(Ct)}}else he.metaKey||he.ctrlKey?(Le.current=we,ge(Xe=>Xe.includes(we)?Xe.filter(Ze=>Ze!==we):[...Xe,we])):(Le.current=we,ge([we]))};if(w==="logbook")return Pe.length===0?c.jsxs("div",{className:"text-center py-20 opacity-20",children:[c.jsx(Zx,{size:48,className:"mx-auto"}),c.jsx("p",{className:"text-xs mt-2",children:""})]}):c.jsxs("div",{className:"pb-20 relative min-h-[500px]",onClick:()=>ge([]),children:[c.jsxs("div",{className:"flex items-center gap-2 mb-6 px-2",children:[c.jsx(em,{size:16,className:"text-gray-400"}),c.jsx("span",{className:"text-[13px] font-bold text-gray-500",children:""}),c.jsx("span",{className:"text-[11px] font-medium px-1.5 py-0.5 rounded-full bg-gray-100 text-gray-500",children:Pe.length}),c.jsx("div",{className:"flex-1 h-[2px] rounded-full bg-gradient-to-r from-gray-200 to-transparent"}),wt.length>0&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:"text-[11px] text-indigo-600 font-medium",children:[" ",wt.length," "]}),c.jsxs("button",{onClick:he=>{he.stopPropagation(),confirm(` ${wt.length} `)&&(O(wt),ge([]))},className:"px-2 py-1 bg-red-50 text-red-600 text-[10px] font-medium rounded hover:bg-red-100 transition-colors flex items-center gap-1",children:[c.jsx(Ar,{size:12}),""]}),c.jsx("button",{onClick:he=>{he.stopPropagation(),ge([])},className:"px-2 py-1 bg-gray-100 text-gray-600 text-[10px] font-medium rounded hover:bg-gray-200 transition-colors",children:""})]})]}),Pe.map(he=>{const we=wt.includes(he.data.id);return c.jsx("div",{className:`relative group mb-1 py-2 px-3 rounded-lg transition-colors cursor-pointer ${we?"bg-indigo-50 border border-indigo-200":"hover:bg-theme-hover"}`,style:{marginLeft:`${he.depth*24}px`},onClick:Xe=>Qe(Xe,he.data.id),children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:`w-[18px] h-[18px] rounded-full border-2 flex items-center justify-center flex-shrink-0 ${we?"border-indigo-500 bg-indigo-500":"border-emerald-500 bg-emerald-500"}`,children:c.jsx(tr,{size:12,className:"text-white"})}),c.jsx("span",{className:"flex-1 text-theme-primary opacity-70 truncate",children:he.data.title}),c.jsxs("div",{className:"flex items-center gap-1 text-[11px] text-gray-400",children:[c.jsx(Go,{size:12}),me===he.data.id?c.jsx("input",{type:"date",autoFocus:!0,value:qe,onChange:Xe=>ht(Xe.target.value),onBlur:()=>De(he.data.id),onKeyDown:Xe=>{Xe.key==="Enter"&&De(he.data.id),Xe.key==="Escape"&&Me(null)},onClick:Xe=>Xe.stopPropagation(),className:"bg-white border border-gray-300 rounded px-1 py-0.5 text-[11px] w-28"}):c.jsx("span",{className:"cursor-pointer hover:text-indigo-500 transition-colors",onDoubleClick:Xe=>{Xe.stopPropagation(),Me(he.data.id),ht(Ue(he.data.completed_at))},title:"",children:Ue(he.data.completed_at)||""})]}),c.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[c.jsx("button",{onClick:Xe=>{Xe.stopPropagation(),_(he.data.id)},className:"px-2 py-1 bg-emerald-50 text-emerald-600 text-[10px] font-medium rounded hover:bg-emerald-100 transition-colors",children:""}),c.jsx("button",{onClick:Xe=>{Xe.stopPropagation(),confirm("")&&N(he.data.id)},className:"p-1 text-gray-400 hover:text-red-500 transition-colors",title:"",children:c.jsx(Ar,{size:14})})]})]})},he.data.id)})]});if(Z.length===0&&(w!=="allview"||Pe.length===0))return c.jsxs("div",{className:"text-center py-20 opacity-20",children:[c.jsx(Zx,{size:48,className:"mx-auto"}),c.jsx("p",{className:"text-xs mt-2",children:"No tasks"})]});const pt=he=>he.start_date?new Date(he.start_date).toISOString().split("T")[0]:he.due_date?new Date(he.due_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],nt=()=>{const he=jee(U,8),we=new Map,Xe=[],Ze=[],lt=U.getFullYear(),Ge=String(U.getMonth()+1).padStart(2,"0"),Ct=String(U.getDate()).padStart(2,"0"),Y=`${lt}-${Ge}-${Ct}`;return Z.forEach(q=>{const oe=pt(q.data);oe<Y?Xe.push(q):he.includes(oe)?(we.has(oe)||we.set(oe,[]),we.get(oe).push(q)):Ze.push(q)}),c.jsxs(c.Fragment,{children:[Xe.length>0&&c.jsxs("div",{"data-date-group":"overdue",children:[c.jsxs("div",{className:"flex items-center gap-3 pt-2 pb-2 px-1 select-none",children:[c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsx("span",{className:"text-[13px] font-semibold text-red-500",children:""}),c.jsxs("span",{className:"text-[11px] text-red-400 font-normal",children:[Xe.length," "]})]}),c.jsx("div",{className:"flex-1 h-[1px] bg-red-200"})]}),Xe.map(q=>c.jsx(An.Fragment,{children:s===q.data.id?c.jsx(Ro,{initialData:q.data,onClose:V},q.data.id):c.jsx("div",{className:"relative group",children:c.jsx(pl,{flatTask:q,isFocused:n===q.data.id,onEdit:()=>i(q.data.id)},q.data.id)})},q.data.id))]}),he.map(q=>{const oe=we.get(q)||[];return c.jsxs("div",{"data-date-group":q,children:[c.jsx(Nee,{date:q,isToday:Iee(q),isTomorrow:Dee(q),taskCount:oe.length}),oe.length===0?c.jsx("div",{className:"h-12 mx-2 mb-2 border-2 border-dashed border-gray-200 rounded-lg flex items-center justify-center text-gray-300 text-xs transition-all hover:border-gray-300 hover:bg-gray-50","data-empty-drop-zone":q,onDragEnter:Ce=>{Ce.preventDefault(),xe.current=q,Ce.currentTarget.classList.add("border-blue-400","bg-blue-50","text-blue-400")},onDragOver:Ce=>{Ce.preventDefault(),Ce.dataTransfer.dropEffect="move",xe.current=q,d(Ce.clientX,Ce.clientY)},onDragLeave:Ce=>{xe.current=null,Ce.currentTarget.classList.remove("border-blue-400","bg-blue-50","text-blue-400")},onDrop:Ce=>{Ce.preventDefault(),Ce.stopPropagation(),Ce.currentTarget.classList.remove("border-blue-400","bg-blue-50","text-blue-400");const dt=xe.current||q;xe.current=null;let xt=[];try{const it=Ce.dataTransfer.getData("application/json");it&&(xt=JSON.parse(it))}catch{}if(xt.length===0){const it=Ce.dataTransfer.getData("text/plain");it&&(xt=[it])}xt.length===0&&l.draggedId&&(xt=f.includes(l.draggedId)?f:[l.draggedId]),xt.length>0&&G(xt.map(it=>({id:it,data:{start_date:dt,is_all_day:!0}}))),a()},children:""}):oe.map(Ce=>c.jsx(An.Fragment,{children:s===Ce.data.id?c.jsx(Ro,{initialData:Ce.data,onClose:V},Ce.data.id):c.jsx("div",{className:"relative group",children:c.jsx(pl,{flatTask:Ce,isFocused:n===Ce.data.id,onEdit:()=>i(Ce.data.id)},Ce.data.id)})},Ce.data.id))]},q)}),Ze.length>0&&(()=>{const q=new Map;return Ze.forEach(Ce=>{const dt=pt(Ce.data),xt=new Date(dt+"T12:00:00"),it=`${xt.getFullYear()}-${String(xt.getMonth()+1).padStart(2,"0")}`;q.has(it)||q.set(it,[]),q.get(it).push(Ce)}),Array.from(q.keys()).sort().map(Ce=>{const[dt,xt]=Ce.split("-"),it=["1","2","3","4","5","6","7","8","9","10","11","12"][parseInt(xt)-1],Rt=q.get(Ce),Ot=new Date().getFullYear(),Nn=parseInt(dt)!==Ot;return c.jsxs("div",{"data-date-group":Ce,children:[c.jsxs("div",{className:"flex items-center gap-3 pt-6 pb-2 px-1 select-none",children:[c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsx("span",{className:"text-[13px] font-semibold text-gray-400",children:it}),Nn&&c.jsx("span",{className:"text-[11px] text-gray-300 font-normal",children:dt})]}),c.jsx("div",{className:"flex-1 h-[1px] bg-gray-200"}),c.jsx("span",{className:"text-[10px] text-gray-400 tabular-nums",children:Rt.length})]}),Rt.map($t=>c.jsx(An.Fragment,{children:s===$t.data.id?c.jsx(Ro,{initialData:$t.data,onClose:V},$t.data.id):c.jsx("div",{className:"relative group",children:c.jsx(pl,{flatTask:$t,isFocused:n===$t.data.id,onEdit:()=>i($t.data.id)},$t.data.id)})},$t.data.id))]},Ce)})})()]})},ut=he=>he.map(we=>c.jsx(An.Fragment,{children:s===we.data.id?c.jsx(Ro,{initialData:we.data,onClose:V},we.data.id):c.jsx("div",{className:"relative group",children:c.jsx(pl,{flatTask:we,isFocused:n===we.data.id,onEdit:()=>i(we.data.id),backgroundColor:de(we.data)},we.data.id)})},we.data.id));return c.jsx(c.Fragment,{children:c.jsxs("div",{ref:D,className:"pb-20 relative min-h-[500px]",onDragOver:Ke,onDragLeave:he=>{var we;(we=D.current)!=null&&we.contains(he.relatedTarget)||u({dropIndex:null})},onDrop:he=>{he.preventDefault(),je()},onDragEnd:je,children:[(w==="allview"||w==="project"||w==="inbox")&&c.jsx("div",{className:"flex justify-end px-4 py-2 border-b border-gray-100/50 mb-2 sticky top-0 bg-white/95 backdrop-blur z-20",children:c.jsxs("div",{className:"flex items-center gap-2 bg-gray-50/80 p-1 rounded-lg border border-gray-100",children:[c.jsx("span",{className:"text-[9px] text-gray-400 font-bold uppercase tracking-wider px-1",children:"Mark:"}),c.jsxs("div",{className:"flex gap-0.5",children:[c.jsx("button",{onClick:()=>st("none"),className:`px-2 py-0.5 text-[10px] rounded transition-all ${Be==="none"?"bg-white shadow-sm text-gray-800 font-bold":"text-gray-400 hover:text-gray-600"}`,children:"Off"}),c.jsxs("button",{onClick:()=>st("recent"),className:`px-2 py-0.5 text-[10px] rounded transition-all flex items-center gap-1 ${Be==="recent"?"bg-red-50 text-red-600 shadow-sm font-bold ring-1 ring-red-100":"text-gray-400 hover:text-red-500"}`,children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),"Recent"]}),c.jsxs("button",{onClick:()=>st("frequent"),className:`px-2 py-0.5 text-[10px] rounded transition-all flex items-center gap-1 ${Be==="frequent"?"bg-amber-50 text-amber-600 shadow-sm font-bold ring-1 ring-amber-100":"text-gray-400 hover:text-amber-500"}`,children:[c.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-amber-500"}),"Frequent"]})]})]})}),w==="today"&&X.showRelationshipLines!==!1&&c.jsx(Eee,{containerRef:D,tasks:Z.map(he=>({data:{id:he.data.id,parent_id:he.data.parent_id,color:he.data.color}}))}),c.jsx(Tee,{show:l.isDragging&&l.dropIndex!==null,top:l.indicatorTop,left:l.indicatorLeft,width:l.indicatorWidth,depth:l.dropDepth,color:re()}),w==="trash"&&c.jsxs("div",{className:"flex items-center justify-between mb-6 px-4 py-3 bg-gray-50 rounded-lg border border-dashed border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ar,{className:"text-gray-400",size:18}),c.jsx("span",{className:"font-medium text-gray-500 text-sm",children:C("trashEmptyTitle")})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[Z.length>0&&c.jsxs("button",{onClick:()=>{confirm(C("restoreTrashConfirm")||"Are you sure?")&&R()},className:"px-3 py-1.5 bg-white border border-gray-200 text-indigo-500 text-xs font-medium rounded hover:bg-indigo-50 hover:border-indigo-200 transition-colors shadow-sm flex items-center gap-1",children:[c.jsx(Cw,{size:12}),C("restoreTrash")||"Restore All"]}),Z.length>0&&c.jsx("button",{onClick:()=>{confirm(C("emptyTrashConfirm"))&&k()},className:"px-3 py-1.5 bg-white border border-gray-200 text-red-500 text-xs font-medium rounded hover:bg-red-50 hover:border-red-200 transition-colors shadow-sm",children:C("emptyTrash")})]})]}),w==="today"?nt():w==="upcoming"?Z.map((he,we)=>c.jsx(An.Fragment,{children:s===he.data.id?c.jsx(Ro,{initialData:he.data,onClose:V},he.data.id):c.jsxs("div",{className:"relative group",children:[c.jsx("span",{className:"absolute -left-6 top-1/2 -translate-y-1/2 text-[9px] font-mono text-gray-300 select-none",children:we+1}),c.jsx(pl,{flatTask:he,isFocused:n===he.data.id,onEdit:()=>i(he.data.id),onSelect:ke},he.data.id)]})},he.data.id)):w==="allview"?c.jsxs(c.Fragment,{children:[ut(ye),Pe.length>0&&c.jsxs("div",{className:"mt-12",children:[c.jsxs("button",{onClick:()=>ee(!pe),className:"flex items-center gap-2 mb-4 px-2 w-full text-left group",children:[pe?c.jsx(ts,{size:14,className:"text-gray-400"}):c.jsx(ds,{size:14,className:"text-gray-400"}),c.jsx(em,{size:14,className:"text-gray-400"}),c.jsx("span",{className:"text-[13px] font-bold text-gray-400",children:""}),c.jsx("span",{className:"text-[11px] font-medium px-1.5 py-0.5 rounded-full bg-gray-100 text-gray-500",children:Pe.length}),c.jsx("div",{className:"flex-1 h-[2px] rounded-full bg-gradient-to-r from-gray-200 to-transparent"})]}),!pe&&c.jsx("div",{className:"opacity-60",children:Pe.map(he=>c.jsxs("div",{className:"relative group",style:{marginLeft:`${he.depth*24}px`},children:[c.jsx(pl,{flatTask:he,isFocused:!1,onEdit:()=>{}}),c.jsx("button",{onClick:we=>{we.stopPropagation(),_(he.data.id)},className:"absolute right-2 top-2 z-10 opacity-0 group-hover:opacity-100 px-3 py-1 bg-emerald-600 text-white text-[10px] font-bold rounded-full shadow-lg hover:bg-emerald-700 transition-all flex items-center gap-1",children:""})]},he.data.id))})]})]}):ut(se),ve,w==="inbox"&&ne.length>0&&c.jsxs("div",{className:"mt-8 border-2 border-dashed border-amber-200 rounded-xl p-4 bg-amber-50/50",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(C6,{size:16,className:"text-amber-500"}),c.jsxs("span",{className:"text-[13px] font-semibold text-amber-700",children:[ne.length," "]})]}),c.jsx("button",{onClick:Q,className:"px-3 py-1 text-xs font-medium bg-amber-100 hover:bg-amber-200 text-amber-700 rounded-full transition-colors",children:""})]}),c.jsx("div",{className:"space-y-1 opacity-70",children:ne.map(he=>{const we=x.find(oe=>["project",""].includes(oe.name.trim().toLowerCase())),Xe=x.find(oe=>oe.name.includes("")||["someday","inspiration","/"].includes(oe.name.trim().toLowerCase())),Ze=x.find(oe=>["note","journal","",""].includes(oe.name.trim().toLowerCase())),lt=x.find(oe=>["prompt",""].includes(oe.name.trim().toLowerCase())),Ge=Ze,Ct=Xe,Y=he.data.tags||[];let q="";return he.data.start_date?q="":he.data.status==="someday"||he.data.status==="waiting"||Ct&&Y.includes(Ct.id)?q="/":he.data.parent_id||we&&Y.includes(we.id)?q="":Xe&&Y.includes(Xe.id)?q="/":Ze&&Y.includes(Ze.id)||Ge&&Y.includes(Ge.id)?q="":lt&&Y.includes(lt.id)&&(q=""),c.jsxs("div",{className:"flex items-center justify-between p-2 bg-white/80 rounded-lg",children:[c.jsx("span",{className:"text-sm text-theme-primary truncate flex-1",children:he.data.title||"()"}),c.jsxs("span",{className:"text-[10px] text-amber-600 bg-amber-100 px-2 py-0.5 rounded-full ml-2",children:[" ",q]})]},he.data.id)})})]})]})})},Aee=()=>{const{tasks:t,tags:e,addTask:n,addTag:r,user:s,t:i}=b.useContext(_n),[o,a]=b.useState(null),[l,u]=b.useState(null),[d,f]=b.useState(()=>{const T=localStorage.getItem(`note_view_expanded_${s==null?void 0:s.id}`);return T?JSON.parse(T):{}});b.useEffect(()=>{s!=null&&s.id&&localStorage.setItem(`note_view_expanded_${s.id}`,JSON.stringify(d))},[d,s==null?void 0:s.id]);const h=b.useMemo(()=>{const T=e.find(_=>_.name.trim().toLowerCase()==="note");return T?T.id:null},[e]),p=b.useMemo(()=>e.filter(T=>T.name.startsWith("#")),[e]),m=b.useMemo(()=>{if(!h)return[];let T=t.filter(_=>_.status!=="deleted"&&_.tags.includes(h));return l&&(T=T.filter(_=>_.tags.includes(l))),T.sort((_,N)=>new Date(N.created_at).getTime()-new Date(_.created_at).getTime())},[t,h,l]),y=b.useMemo(()=>{const T={},_=[];return m.forEach(N=>{const j=N.tags.filter(O=>{if(O===h)return!1;const P=e.find(G=>G.id===O);return P&&!P.name.startsWith("#")});if(j.length===0)_.push(N);else{const O=j[0];if(!T[O]){const P=e.find(G=>G.id===O);T[O]={tag:P,tasks:[]}}T[O].tasks.push(N)}}),{categories:T,uncategorized:_}},[m,h,e]),x=T=>T.tags.map(_=>e.find(N=>N.id===_)).filter(_=>_&&_.name.startsWith("#")),g=T=>{f(_=>({..._,[T]:!_[T]}))},v=T=>d[T]!==!1,w=async()=>{let T=h;if(T||(T=await r("note")),T){const _=await n({title:"",tags:[T],is_project:!1,status:"active"});setTimeout(()=>{a({id:_})},100)}},S=T=>{a(T)},I=()=>{a(null)},k=T=>{u(l===T?null:T)},R=T=>{const _=x(T);return c.jsxs("div",{onClick:()=>S(T),className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden cursor-pointer group hover:shadow-md transition-all hover:-translate-y-0.5",children:[T.images&&T.images.length>0&&c.jsx("div",{className:"aspect-[16/9] bg-gray-100 relative overflow-hidden",children:c.jsx("img",{src:T.images[0],alt:T.title,className:"w-full h-full object-cover transition-transform group-hover:scale-105"})}),c.jsxs("div",{className:"p-4",children:[_.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:_.map(N=>N&&c.jsx("button",{onClick:j=>{j.stopPropagation(),k(N.id)},className:`text-[10px] px-2 py-0.5 rounded-full font-medium transition-all ${l===N.id?"bg-emerald-500 text-white":"bg-emerald-50 text-emerald-600 hover:bg-emerald-100"}`,children:N.name},N.id))}),c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(Wf,{size:14,className:"text-indigo-400 mt-1 flex-shrink-0"}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h3",{className:`font-medium text-gray-800 line-clamp-2 text-sm ${T.title?"":"italic text-gray-400"}`,children:T.title||""}),T.description&&c.jsx("p",{className:"text-xs text-gray-500 line-clamp-2 mt-1",children:T.description.replace(/<[^>]*>/g,"").slice(0,100)})]})]}),c.jsxs("div",{className:"flex items-center justify-between mt-3 pt-2 border-t border-gray-50",children:[c.jsx("span",{className:"text-[10px] text-gray-400",children:new Date(T.created_at).toLocaleDateString()}),c.jsx("div",{className:"flex flex-wrap gap-1",children:T.tags.filter(N=>{if(N===h)return!1;const j=e.find(O=>O.id===N);return j&&!j.name.startsWith("#")}).slice(0,2).map(N=>{const j=e.find(O=>O.id===N);return j?c.jsx(vA,{tag:j,size:"small"},N):null})})]})]})]},T.id)},C=(T,_)=>{var j,O;const N=v(T);return c.jsxs("div",{className:"mb-6",children:[c.jsxs("button",{onClick:()=>g(T),className:"flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-gray-100 transition-colors w-full text-left group",children:[N?c.jsx(ds,{size:16,className:"text-gray-400"}):c.jsx(ts,{size:16,className:"text-gray-400"}),c.jsx("span",{className:"font-bold text-sm",style:{color:((j=_.tag)==null?void 0:j.color)||"#6366f1"},children:((O=_.tag)==null?void 0:O.name)||""}),c.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(",_.tasks.length,")"]})]}),N&&c.jsx("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pl-6",children:_.tasks.map(R)})]},T)};return c.jsxs("div",{className:"h-full flex flex-col bg-white overflow-hidden relative",children:[c.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-white z-10",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("h2",{className:"font-bold text-gray-700 flex items-center gap-2",children:[c.jsx(pf,{size:18}),i("journal")]}),p.length>0&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(l6,{size:14,className:"text-gray-400"}),c.jsxs("div",{className:"flex flex-wrap gap-1",children:[p.slice(0,5).map(T=>c.jsx("button",{onClick:()=>k(T.id),className:`text-[10px] px-2 py-0.5 rounded-full font-medium transition-all ${l===T.id?"bg-emerald-500 text-white":"bg-gray-100 text-gray-600 hover:bg-emerald-50 hover:text-emerald-600"}`,children:T.name},T.id)),l&&c.jsxs("button",{onClick:()=>u(null),className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-red-50 text-red-500 hover:bg-red-100 flex items-center gap-1",children:[c.jsx(on,{size:10}),""]})]})]})]}),c.jsxs("button",{onClick:w,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors shadow-sm",children:[c.jsx(Ki,{size:16})," "]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-gray-50/50",children:m.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx(pf,{size:48,className:"mb-4 opacity-20"}),c.jsx("p",{className:"text-sm",children:l?"":""}),c.jsx("p",{className:"text-xs mt-1",children:l?"":"note"})]}):c.jsxs("div",{children:[Object.entries(y.categories).map(([T,_])=>C(T,_)),y.uncategorized.length>0&&c.jsxs("div",{className:"mb-6",children:[c.jsxs("button",{onClick:()=>g("_uncategorized"),className:"flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-gray-100 transition-colors w-full text-left group",children:[v("_uncategorized")?c.jsx(ds,{size:16,className:"text-gray-400"}):c.jsx(ts,{size:16,className:"text-gray-400"}),c.jsx("span",{className:"font-bold text-sm text-gray-500",children:""}),c.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(",y.uncategorized.length,")"]})]}),v("_uncategorized")&&c.jsx("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pl-6",children:y.uncategorized.map(R)})]})]})}),o&&c.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm",onClick:I,children:c.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-2xl shadow-2xl max-h-[90vh] overflow-y-auto",onClick:T=>T.stopPropagation(),children:[c.jsx("div",{className:"p-2 border-b border-gray-100 flex justify-end",children:c.jsx("button",{onClick:I,className:"p-2 hover:bg-gray-100 rounded-full text-gray-500",children:c.jsx(on,{size:20})})}),c.jsx("div",{className:"p-4",children:c.jsx(Ro,{initialData:t.find(T=>T.id===o.id),onClose:I})})]})})]})},Mee={"2024-01-01":"","2024-02-08":"","2024-02-09":"","2024-02-10":"","2024-02-11":"","2024-02-12":"","2024-02-13":"","2024-02-14":"","2024-02-28":"228","2024-04-04":"","2024-04-05":"","2024-06-10":"","2024-09-17":"","2024-10-10":"","2026-01-01":"","2026-02-16":"","2026-02-17":"","2026-02-18":"","2026-02-19":"","2026-02-28":"228","2026-04-04":"","2026-04-05":"","2026-06-19":"","2026-09-25":"","2026-10-10":""},wR=t=>{const e=t.toISOString().split("T")[0];return Mee[e]||null},vR=t=>{const e=t.getFullYear(),n=t.getMonth()+1,r=t.getDate();if(e===2025){if(n===12)return r===24?"":r===21?"":r===1?"":`${(r+10)%30||30}`;if(n===11)return`${(r+9)%30||30}`;if(n===1){if(r===1)return"";if(r===27)return"";if(r===28)return""}return`N${r%30||30}`}if(e===2026){if(n===1)return`${(r+12)%30||28}`;if(n===2){if(r===17)return"";if(r===16)return"";const s=r-17;return s>0?`${s+1}`:`${29+s}`}return`L${n}.${r}`}return""},Mi=120,bc=52,Ree=({onDateClick:t,filterTags:e=[],filterTagsExclude:n=[],filterColors:r=[],filterProjects:s=[]})=>{const{tasks:i,tags:o,batchUpdateTasks:a,addTask:l,setEditingTaskId:u,editingTaskId:d,selectedTaskIds:f,setSelectedTaskIds:h,constructionModeEnabled:p,setConstructionModeEnabled:m,setCalendarDate:y,view:x,viewTagFilters:g,themeSettings:v,tagsWithResolvedColors:w}=b.useContext(_n),[S,I]=b.useState(null),k=b.useRef(new Map),R=b.useRef(new Map);b.useEffect(()=>{I(null)},[d]);const C=se=>{var ee;if(se.tags&&se.tags.length>0){const ye=se.tags.find(Pe=>{const me=o.find(Me=>Me.id===Pe);return me&&me.name.toLowerCase().includes("google")});if(ye){if(w&&w[ye])return w[ye];const Pe=o.find(me=>me.id===ye);if(Pe!=null&&Pe.color)return Pe.color}for(const Pe of se.tags){if(w&&w[Pe])return w[Pe];const me=o.find(Me=>Me.id===Pe);if(me!=null&&me.color)return me.color}}const ne=cp(se,i);if(ne&&ne.color&&ne.color!=="gray"){const ye=Kn[ne.color];if(ye)return ye.color}const pe=se.color||"blue";return((ee=Kn[pe])==null?void 0:ee.color)||Kn.blue.color},T=b.useRef(null),_=b.useRef(null),N=b.useRef(!1),j=b.useRef(null),[O,P]=b.useState([]),[G,A]=b.useState(null),[M,Q]=b.useState(null),[X,D]=b.useState(new Date),[Te,xe]=b.useState(null),[U,z]=b.useState(null),[ie,Be]=b.useState({start:0,end:200}),st=An.useMemo(()=>{let se=i.filter(ne=>ne.status!=="deleted");if(x==="focus"){const ne=g.focus||{include:[],exclude:[]},{include:pe,exclude:ee}=Array.isArray(ne)?{include:ne,exclude:[]}:ne;pe.length>0&&(se=se.filter(ye=>ye.tags.some(Pe=>pe.includes(Pe)))),ee.length>0&&(se=se.filter(ye=>!ye.tags.some(Pe=>ee.includes(Pe))))}return e.length>0&&(se=se.filter(ne=>ne.tags.some(pe=>e.includes(pe)))),n.length>0&&(se=se.filter(ne=>!ne.tags.some(pe=>n.includes(pe)))),r.length>0&&(se=se.filter(ne=>r.includes(ne.color))),s.length>0&&(se=se.filter(ne=>{if(s.includes(ne.id)||ne.parent_id&&s.includes(ne.parent_id))return!0;let pe=i.find(ee=>ee.id===ne.parent_id);for(;pe;){if(s.includes(pe.id))return!0;pe=i.find(ee=>ee.id===(pe==null?void 0:pe.parent_id))}return!1})),se},[i,x,g,e,n,r,s]),ae=se=>{const ne=se.getDay(),pe=new Date(se);pe.setDate(se.getDate()-ne),pe.setHours(0,0,0,0);const ee=[];for(let ye=0;ye<7;ye++){const Pe=new Date(pe);Pe.setDate(pe.getDate()+ye),ee.push({date:Pe,isCurrentMonth:!0,isToday:yi(Pe,new Date)})}return{id:pe.toDateString(),days:ee,firstDate:pe}},Z=An.useMemo(()=>{const se=new Map;return st.forEach(ne=>{if(ne.status==="deleted"||ne.status==="logged")return;const pe=ne.start_date||ne.due_date;if(pe){const ee=new Date(pe),ye=`${ee.getFullYear()}-${ee.getMonth()}-${ee.getDate()}`;se.has(ye)||se.set(ye,[]),se.get(ye).push(ne)}}),se},[st]),K=b.useCallback(se=>{const ne=`${se.getFullYear()}-${se.getMonth()}-${se.getDate()}`;return(Z.get(ne)||[]).slice().sort((ee,ye)=>ee.is_all_day&&!ye.is_all_day?-1:!ee.is_all_day&&ye.is_all_day?1:!ee.is_all_day&&!ye.is_all_day?(ee.start_time||"").localeCompare(ye.start_time||""):(ee.order_index||0)-(ye.order_index||0))},[Z]);b.useEffect(()=>{const se=new Date,ne=[],pe=-bc,ee=bc;for(let ye=pe;ye<=ee;ye++){const Pe=new Date(se);Pe.setDate(se.getDate()+ye*7),ne.push(ae(Pe))}P(ne),setTimeout(()=>{if(T.current){const Pe=bc*Mi-T.current.clientHeight/2+Mi/2;T.current.scrollTop=Pe}},100)},[]),b.useLayoutEffect(()=>{if(N.current&&T.current){const se=4*Mi;T.current.scrollTop+=se,N.current=!1}},[O]);const de=b.useCallback(()=>{const se=T.current;if(!se)return;const{scrollTop:ne,clientHeight:pe,scrollHeight:ee}=se;ee-ne-pe<500&&P(ht=>{const wt=ht[ht.length-1],ge=[];for(let Le=1;Le<=4;Le++){const Ue=new Date(wt.firstDate);Ue.setDate(Ue.getDate()+Le*7),ge.push(ae(Ue))}return[...ht,...ge]}),ne<200&&!N.current&&(N.current=!0,P(ht=>{const wt=ht[0],ge=[];for(let Le=4;Le>=1;Le--){const Ue=new Date(wt.firstDate);Ue.setDate(Ue.getDate()-Le*7),ge.push(ae(Ue))}return[...ge,...ht]}));const ye=Math.floor((ne+100)/Mi),Pe=O[ye];if(Pe){const ht=Pe.days[3].date;D(ht)}const me=6,Me=Math.floor(ne/Mi)-me,qe=Math.ceil((ne+pe)/Mi)+me;Be(ht=>ht.start===Me&&ht.end===qe?ht:{start:Math.max(0,Me),end:qe})},[O]),ce=async(se,ne)=>{const pe=se.toDateString();if(p&&f.length>0){const ee=[...f];if(ne.altKey)for(const ye of ee){const Pe=i.find(me=>me.id===ye);Pe&&await l({...Pe,id:void 0,start_date:se.toISOString()})}else{const ye=ee.map(Pe=>({id:Pe,data:{start_date:se.toISOString()}}));await a(ye),h([]),m(!1)}A(pe),setTimeout(()=>A(null),600)}else xe(se)},ke=(se,ne)=>{ne.stopPropagation(),t&&t(se)},_e=async()=>{if(f.length===0)return;const se=o.find(ee=>ee.name.toLowerCase()==="schedule"||ee.name==="");if(!se)return;const ne=f.every(ee=>{var Pe;const ye=i.find(me=>me.id===ee);return(Pe=ye==null?void 0:ye.tags)==null?void 0:Pe.includes(se.id)}),pe=f.map(ee=>{const ye=i.find(me=>me.id===ee);if(!ye)return null;let Pe=[...ye.tags||[]];return ne?Pe=Pe.filter(me=>me!==se.id):Pe.includes(se.id)||Pe.push(se.id),{id:ee,data:{tags:Pe}}}).filter(Boolean);pe.length>0&&await a(pe)},ve=(se,ne)=>{ne.stopPropagation(),z({date:se,title:""}),setTimeout(()=>{var pe;return(pe=j.current)==null?void 0:pe.focus()},50)},Ke=async()=>{U&&(U.title.trim()&&await l({title:U.title.trim(),start_date:U.date.toISOString(),is_all_day:!0,status:"inbox",color:"gray"}),z(null))},je=["","","","","","",""],V=`${X.getFullYear()} ${X.getMonth()+1}`,re=b.useCallback(()=>{const se=new Date;y(se);const ne=[];for(let pe=-bc;pe<=bc;pe++){const ee=new Date(se);ee.setDate(se.getDate()+pe*7),ne.push(ae(ee))}if(P(ne),T.current){const ee=bc*Mi-T.current.clientHeight/2+Mi/2;T.current.scrollTop=ee}},[ae,y,P]);return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main relative",children:[c.jsx("div",{className:"absolute top-12 left-1/2 -translate-x-1/2 z-40 pointer-events-none opacity-0 transition-opacity duration-300 data-[visible=true]:opacity-100","data-visible":!0,children:c.jsxs("div",{className:"bg-theme-header backdrop-blur-md shadow-lg border border-theme px-4 py-1.5 rounded-full text-sm font-bold text-theme-primary flex items-center gap-2",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-500"}),V]})}),c.jsxs("div",{ref:T,className:"flex-1 overflow-y-auto overflow-x-hidden relative",onScroll:de,style:{scrollBehavior:"auto"},children:[c.jsx("div",{className:"flex border-b border-theme bg-theme-sidebar z-30 sticky top-0 shadow-sm min-h-[32px]",children:je.map((se,ne)=>c.jsx("div",{className:`flex-1 text-center py-2 text-xs font-bold ${ne===0?"text-red-500":ne===6?"text-green-600":"text-theme-tertiary"}`,children:se},se))}),c.jsx("div",{className:"relative",style:{height:O.length*Mi},children:O.map((se,ne)=>ne<ie.start||ne>ie.end||!T.current?null:c.jsx("div",{className:"flex w-full absolute left-0 right-0 border-b border-theme",style:{height:Mi,top:ne*Mi},children:se.days.map((pe,ee)=>{const ye=pe.date.getDate()===1,Pe=K(pe.date),me=G===pe.date.toDateString(),Me=p&&f.length>0,qe=Te&&yi(pe.date,Te),ht=wR(pe.date),wt=vR(pe.date),ge=pe.date.getDay()===0||pe.date.getDay()===6,Le=pe.date.getDay()===0,Ue=pe.date.getDay()===6;return c.jsxs("div",{className:`
                                                flex-1 min-w-0 h-full border-r border-theme relative group
                                                ${qe?"bg-indigo-500/10":""}
                                                ${pe.isToday&&!qe?"bg-indigo-500/5":ge&&!qe?"bg-theme-sidebar":pe.date.getMonth()%2===0&&!qe?"bg-theme-main":qe?"":"bg-theme-hover/30"}
                                                ${me?"ring-4 ring-green-400 bg-green-50 animate-pulse z-20":""}
                                                ${M===pe.date.toDateString()?"bg-indigo-500/20 ring-inset ring-2 ring-indigo-400 z-10 transition-colors duration-150":""}
                                                ${Me?"cursor-pointer hover:ring-[1.5px] hover:ring-indigo-500 hover:shadow-sm hover:z-30 z-10":""}
                                                ${!pe.isToday&&!me&&M!==pe.date.toDateString()&&!qe?"hover:bg-theme-hover":""}
                                            `,onDragEnter:()=>Q(pe.date.toDateString()),onDragOver:De=>{De.preventDefault(),De.dataTransfer.dropEffect="move"},onDrop:De=>{De.preventDefault(),Q(null);try{const Qe=De.dataTransfer.getData("application/json"),pt=JSON.parse(Qe);if(Array.isArray(pt)&&pt.length>0){const nt=new Date(pe.date);nt.setHours(9,0,0,0);const ut=De.currentTarget.getBoundingClientRect(),we=De.clientY-ut.top<ut.height*.35,Xe=pt.map(Ze=>({id:Ze,data:{start_date:nt.toISOString(),is_all_day:we,...we?{start_time:null,end_time:null}:{start_time:"09:00",end_time:"10:00"}}}));a(Xe)}}catch(Qe){console.error("Failed to parse drag data",Qe)}},onClick:De=>ce(pe.date,De),onDoubleClick:De=>ve(pe.date,De),children:[ye&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"absolute top-0 left-0 w-full border-t-2 border-indigo-500 z-10 shadow-sm"}),c.jsxs("div",{className:"absolute -top-3 left-2 bg-indigo-600 text-white text-xs font-bold px-2 py-0.5 rounded-full z-20 shadow-md",children:[pe.date.getFullYear()," ",pe.date.getMonth()+1,""]}),c.jsx("div",{className:"absolute top-2 left-2 text-6xl font-black text-indigo-500/5 pointer-events-none -z-10 select-none",children:pe.date.getMonth()+1})]}),c.jsxs("div",{className:"p-1 h-full flex flex-col gap-0.5 overflow-hidden",onDoubleClick:De=>ke(pe.date,De),children:[c.jsxs("div",{className:"flex items-start justify-between min-w-0 pointer-events-none",children:[c.jsxs("div",{className:"flex flex-col leading-none pt-0.5 pl-0.5 max-w-[70%] text-left",children:[v.showTaiwanHolidays&&ht&&c.jsx("span",{className:"text-[9px] font-bold truncate text-red-500",children:ht}),v.showLunar&&c.jsx("span",{className:`text-[8px] truncate ${ht?"text-gray-400":"text-gray-300"}`,children:wt})]}),c.jsx("div",{className:`
                                                        text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-full ml-auto flex-shrink-0
                                                        ${pe.isToday?"bg-indigo-600 text-white":Le?"text-red-500":Ue?"text-green-600":"text-theme-tertiary group-hover:text-theme-secondary"}
                                                    `,children:pe.date.getDate()})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden space-y-0.5 no-scrollbar",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:[Pe.map(De=>{var Ge,Ct;const Qe=C(De),pt=De.is_all_day,nt=f.includes(De.id),ut=(Ge=o.find(Y=>Y.name.toLowerCase()==="schedule"||Y.name===""))==null?void 0:Ge.id,he=ut&&((Ct=De.tags)==null?void 0:Ct.includes(ut)),we=pt?{backgroundColor:Qe,color:"white",boxShadow:"0 1px 1px rgba(0,0,0,0.1)",border:nt?"2px solid white":`1px solid ${Qe}40`}:{backgroundColor:nt?Qe+"30":Qe+"1A",color:Qe,borderLeft:`3px solid ${Qe}`},Xe=Y=>Y?Y.replace(":",""):"",Ze=Y=>{Y&&k.current.set(De.id,Y)},lt=Y=>{Y&&R.current.set(De.id,Y)};return c.jsxs("div",{ref:lt,id:`task-bubble-${De.id}`,draggable:!0,onDragStart:Y=>{let q=[De.id];if(f.includes(De.id)&&(q=f),Y.dataTransfer.setData("application/json",JSON.stringify(q)),Y.dataTransfer.effectAllowed="move",I(null),_.current){const oe=_.current.querySelector("#drag-ghost-count"),Ce=_.current.querySelector("#drag-ghost-title"),dt=_.current.querySelector("#drag-ghost-stack-1"),xt=_.current.querySelector("#drag-ghost-stack-2");oe&&(oe.textContent=q.length.toString()),Ce&&(Ce.textContent=q.length>1?`${q.length} Tasks Selected`:De.title),dt&&(dt.style.opacity=q.length>1?"1":"0"),xt&&(xt.style.opacity=q.length>2?"1":"0"),Y.dataTransfer.setDragImage(_.current,0,0)}},onDragEnd:()=>Q(null),onClick:Y=>{Y.stopPropagation(),Y.metaKey||Y.ctrlKey||Y.shiftKey?f.includes(De.id)?h(q=>q.filter(oe=>oe!==De.id)):h(q=>[...q,De.id]):h([De.id])},onDoubleClick:Y=>{Y.stopPropagation(),u(De.id)},onMouseEnter:()=>{const Y=k.current.get(De.id),q=R.current.get(De.id);if(Y&&q&&Y.scrollWidth>Y.clientWidth){const oe=q.getBoundingClientRect();I({taskId:De.id,title:De.title,x:oe.left,y:oe.top-8})}},onMouseLeave:()=>I(null),className:`
                                                                    relative text-[9.5px] px-1.5 rounded-md cursor-pointer hover:brightness-95 transition-all mb-0.5
                                                                    flex items-center justify-between gap-1
                                                                    ${nt&&pt?"ring-2 ring-indigo-400 z-10":""}
                                                                    ${nt&&!pt?"z-10":""}
                                                                `,style:{...we,height:"auto",minHeight:"22px",lineHeight:"1.2",...he?{backgroundImage:"repeating-linear-gradient(45deg, rgba(255,255,255,0.1) 0px, rgba(255,255,255,0.1) 4px, transparent 4px, transparent 8px)"}:{}},children:[c.jsx("span",{ref:Ze,className:"truncate flex-1 font-medium select-none",children:De.title||""}),!pt&&(De.start_time||De.end_time)&&c.jsxs("div",{className:"flex flex-col items-end leading-none shrink-0 opacity-80",style:{fontSize:"7px",transform:"scale(0.95)",transformOrigin:"right center"},children:[De.start_time&&c.jsx("span",{children:Xe(De.start_time)}),De.end_time&&c.jsx("span",{children:Xe(De.end_time)})]})]},De.id)}),U&&U.date.toDateString()===pe.date.toDateString()&&c.jsx("div",{className:"px-1.5 py-0.5 rounded-md border-2 border-dashed border-indigo-400 bg-indigo-50/50",children:c.jsx("input",{ref:j,type:"text",value:U.title,onChange:De=>z({...U,title:De.target.value}),onKeyDown:De=>{De.key==="Enter"&&Ke(),De.key==="Escape"&&z(null)},onBlur:Ke,placeholder:"...",className:"w-full text-[9.5px] bg-transparent outline-none text-indigo-400 font-medium",autoFocus:!0})})]})]})]},ee)})},se.id))})]}),f.length>0&&c.jsx("button",{onClick:_e,className:`absolute bottom-6 right-24 w-10 h-10 border rounded-full shadow-lg flex items-center justify-center transition-all z-30
                        ${f.every(se=>{var ee;const ne=i.find(ye=>ye.id===se),pe=o.find(ye=>ye.name.toLowerCase()==="schedule"||ye.name==="");return pe&&((ee=ne==null?void 0:ne.tags)==null?void 0:ee.includes(pe.id))})?"bg-indigo-100 text-indigo-700 border-indigo-200":"bg-theme-card border-theme text-theme-secondary hover:text-indigo-600 hover:border-indigo-300"}`,title:" Schedule  ()",children:c.jsx(vI,{size:20})}),c.jsx("button",{onClick:re,className:"absolute bottom-4 right-4 bg-indigo-600 text-white px-3 py-1.5 rounded-full shadow-lg text-xs font-bold hover:apply-indigo-700 transition-transform active:scale-95 flex items-center gap-1",children:"Today"}),c.jsx("div",{ref:_,className:"fixed top-[-1000px] left-[-1000px] z-50 pointer-events-none",children:c.jsxs("div",{className:"bg-theme-card backdrop-blur-xl border border-theme p-3 rounded-xl shadow-2xl flex items-center gap-3 w-48 relative overflow-hidden ring-1 ring-black/5",children:[c.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-50/50 to-purple-50/50 -z-10"}),c.jsx("div",{className:"absolute right-0 top-0 w-16 h-16 bg-indigo-500/10 rounded-full blur-2xl -mr-8 -mt-8"}),c.jsx("div",{id:"drag-ghost-count",className:"flex-shrink-0 w-8 h-8 bg-indigo-600 text-white rounded-lg flex items-center justify-center font-black text-sm shadow-indigo-200 shadow-lg transform rotate-[-6deg]",children:"1"}),c.jsxs("div",{className:"flex flex-col min-w-0",children:[c.jsx("span",{className:"text-[10px] uppercase tracking-wider text-indigo-500 font-bold",children:"Moving"}),c.jsx("span",{id:"drag-ghost-title",className:"text-sm font-bold text-gray-700 truncate leading-tight",children:"Task Title"})]}),c.jsx("div",{id:"drag-ghost-stack-1",className:"absolute top-1 left-1 w-full h-full bg-white/50 border border-gray-200/50 rounded-xl -z-20 transform rotate-2 scale-95 origin-center transition-opacity"}),c.jsx("div",{id:"drag-ghost-stack-2",className:"absolute top-2 left-2 w-full h-full bg-white/30 border border-gray-200/30 rounded-xl -z-30 transform rotate-4 scale-90 origin-center transition-opacity"})]})}),S&&er.createPortal(c.jsxs("div",{className:"fixed z-[9999] w-max max-w-[300px] bg-white/95 backdrop-blur-xl text-slate-800 text-base px-4 py-2.5 rounded-xl shadow-2xl break-words whitespace-normal leading-relaxed font-medium tracking-normal animate-in fade-in zoom-in-95 duration-150 pointer-events-none border border-slate-200/80 ring-1 ring-black/5",style:{left:S.x,top:S.y,transform:"translateY(-100%)"},children:[S.title,c.jsx("div",{className:"absolute left-4 top-full w-0 h-0 border-[6px] border-transparent border-t-white/95"})]}),document.body)]})},oE=60,ra=40,Oee=200,Vh=15,aE=500,Pee=["","","","","","",""],Lee=({filterTags:t=[],filterTagsExclude:e=[],filterColors:n=[],filterProjects:r=[]})=>{const{tasks:s,tags:i,calendarDate:o,setCalendarDate:a,editingTaskId:l,setEditingTaskId:u,addTask:d,handleSelection:f,selectedTaskIds:h,setSelectedTaskIds:p,batchDeleteTasks:m,batchUpdateTasks:y,tagsWithResolvedColors:x}=b.useContext(_n),g=(ge,Le)=>{var De;if(ge.tags&&ge.tags.length>0){const Qe=ge.tags.find(ut=>{const he=i.find(we=>we.id===ut);return he&&he.name.toLowerCase().includes("google")});if(Qe){if(x&&x[Qe])return x[Qe];const ut=i.find(he=>he.id===Qe);if(ut!=null&&ut.color)return ut.color}const pt=ge.tags[0];if(x&&x[pt])return x[pt];const nt=i.find(ut=>ut.id===pt);if(nt!=null&&nt.color)return nt.color}const Ue=Le.color||ge.color||"blue";return((De=Kn[Ue])==null?void 0:De.color)||Kn.blue.color},v=b.useRef(null),w=b.useRef(null),[S,I]=b.useState([]),[k,R]=b.useState(new Date),C=b.useRef(!1),T=b.useRef(0),_=b.useRef(0),N=b.useRef(null),[j,O]=b.useState(Oee),[P,G]=b.useState(null),[A,M]=b.useState(72),[Q,X]=b.useState(null),[D,Te]=b.useState(null),xe=b.useRef(null),[U,z]=b.useState(null),[ie,Be]=b.useState(null),st=b.useRef(null),ae=b.useMemo(()=>{const ge=new Map;let Le=s.filter(Ue=>Ue.status!=="deleted"&&Ue.status!=="logged");return t.length>0&&(Le=Le.filter(Ue=>Ue.tags.some(De=>t.includes(De)))),e.length>0&&(Le=Le.filter(Ue=>!Ue.tags.some(De=>e.includes(De)))),n.length>0&&(Le=Le.filter(Ue=>n.includes(Ue.color))),r.length>0&&(Le=Le.filter(Ue=>{if(r.includes(Ue.id)||Ue.parent_id&&r.includes(Ue.parent_id))return!0;let De=s.find(Qe=>Qe.id===Ue.parent_id);for(;De;){if(r.includes(De.id))return!0;De=s.find(Qe=>Qe.id===(De==null?void 0:De.parent_id))}return!1})),Le.forEach(Ue=>{const De=Ue.start_date||Ue.due_date;if(De){const Qe=new Date(De),pt=`${Qe.getFullYear()}-${Qe.getMonth()}-${Qe.getDate()}`;ge.has(pt)||ge.set(pt,[]),ge.get(pt).push(Ue)}}),ge},[s,t,e,n,r]),[Z,K]=b.useState(!1),de=9,ce=18,ke=20,_e=ge=>Z?ge>=de&&ge<ce?oE:ke:oE,ve=ge=>{let Le=0;const Ue=Math.floor(ge/60);for(let Qe=0;Qe<Ue;Qe++)Le+=_e(Qe);const De=ge%60;return Le+=De/60*_e(Ue),Le},Ke=ge=>{let Le=0;for(let Ue=0;Ue<24;Ue++){const De=_e(Ue);if(ge<=Le+De){const Qe=(ge-Le)/De;return Ue*60+Qe*60}Le+=De}return 24*60},je=()=>{let ge=0;for(let Le=0;Le<24;Le++)ge+=_e(Le);return ge},V=ge=>{if(!ge)return 0;const[Le,Ue]=ge.split(":").map(Number);return Le*60+Ue},re=ge=>{const Le=Math.floor(ge/60),Ue=Math.floor(ge%60);return`${String(Le).padStart(2,"0")}:${String(Ue).padStart(2,"0")}`};b.useEffect(()=>{const ge=new Date(o);ge.setHours(0,0,0,0);const Le=[];for(let Ue=-Vh;Ue<=Vh;Ue++){const De=new Date(ge);De.setDate(ge.getDate()+Ue),Le.push(De)}I(Le),setTimeout(()=>{if(w.current){const Ue=Le.length*j/2-w.current.clientWidth/2;w.current.scrollLeft=Ue}},0)},[]),b.useEffect(()=>{const ge=setInterval(()=>R(new Date),6e4);return()=>clearInterval(ge)},[]),b.useEffect(()=>{const ge=Le=>{var Ue;if((Le.key==="Delete"||Le.key==="Backspace")&&h.length>0&&!l){if(["INPUT","TEXTAREA"].includes(((Ue=document.activeElement)==null?void 0:Ue.tagName)||""))return;Le.preventDefault(),m(h,!1)}};return window.addEventListener("keydown",ge),()=>window.removeEventListener("keydown",ge)},[h,m,l]);const se=()=>{const ge=new Date;ge.setHours(0,0,0,0);const Le=S.findIndex(Ue=>yi(Ue,ge));if(Le!==-1&&w.current){const Ue=Le*j-w.current.clientWidth/2+j/2;w.current.scrollTo({left:Ue,behavior:"smooth"});const De=ve(k.getHours()*60+k.getMinutes()),Qe=ra+A+4,pt=Math.max(0,De+Qe-w.current.clientHeight/3);setTimeout(()=>{var nt;(nt=w.current)==null||nt.scrollTo({top:pt,behavior:"smooth"})},300)}else{a(ge);const Ue=[];for(let De=-Vh;De<=Vh;De++){const Qe=new Date(ge);Qe.setDate(ge.getDate()+De),Ue.push(Qe)}I(Ue),setTimeout(()=>{if(w.current){const De=Ue.length*j/2-w.current.clientWidth/2;w.current.scrollLeft=De}},0)}},ne=async()=>{if(h.length===0)return;const ge=i.find(De=>De.name.toLowerCase()==="schedule"||De.name==="");if(!ge){console.warn("Schedule tag not found");return}const Le=h.every(De=>{var pt;const Qe=s.find(nt=>nt.id===De);return(pt=Qe==null?void 0:Qe.tags)==null?void 0:pt.includes(ge.id)}),Ue=h.map(De=>{const Qe=s.find(nt=>nt.id===De);if(!Qe)return null;let pt=[...Qe.tags||[]];return Le?pt=pt.filter(nt=>nt!==ge.id):pt.includes(ge.id)||pt.push(ge.id),{id:De,data:{tags:pt}}}).filter(Boolean);Ue.length>0&&await y(Ue)};b.useEffect(()=>{setTimeout(()=>se(),100)},[]);const pe=()=>{const ge=w.current;if(!ge)return;const{scrollLeft:Le,scrollWidth:Ue,clientWidth:De}=ge,Qe=Le<T.current;T.current=Le,Le<aE&&!C.current&&Qe&&(C.current=!0,I(pt=>{const nt=pt[0],ut=[];for(let he=1;he<=7;he++){const we=new Date(nt);we.setDate(nt.getDate()-he),ut.unshift(we)}return[...ut,...pt]})),Ue-(Le+De)<aE&&I(pt=>{const nt=pt[pt.length-1],ut=[];for(let he=1;he<=7;he++){const we=new Date(nt);we.setDate(nt.getDate()+he),ut.push(we)}return[...pt,...ut]})};b.useLayoutEffect(()=>{if(C.current&&w.current){const ge=7*j;w.current.scrollLeft+=ge,C.current=!1}},[S,j]),b.useEffect(()=>{if(!P)return;const ge=Ue=>{const De=Ue.clientX-P.initialMouseX,Qe=Math.max(120,Math.min(400,P.initialWidth+De)),pt=Qe-P.initialWidth,ut=P.columnIndex*pt;w.current&&(w.current.scrollLeft=P.initialScrollLeft+ut),O(Qe)},Le=()=>{G(null)};return window.addEventListener("mousemove",ge),window.addEventListener("mouseup",Le),()=>{window.removeEventListener("mousemove",ge),window.removeEventListener("mouseup",Le)}},[P]);const ee=(ge,Le)=>{var Ue;ge.preventDefault(),ge.stopPropagation(),G({initialWidth:j,initialMouseX:ge.clientX,columnIndex:Le,initialScrollLeft:((Ue=w.current)==null?void 0:Ue.scrollLeft)||0})};b.useEffect(()=>{if(!Q)return;const ge=Ue=>{const De=Ue.clientY-Q.initialMouseY,Qe=Math.max(30,Math.min(200,Q.initialHeight+De));M(Qe)},Le=()=>{X(null)};return window.addEventListener("mousemove",ge),window.addEventListener("mouseup",Le),()=>{window.removeEventListener("mousemove",ge),window.removeEventListener("mouseup",Le)}},[Q]);const ye=ge=>{ge.preventDefault(),ge.stopPropagation(),X({initialHeight:A,initialMouseY:ge.clientY})};b.useEffect(()=>{const ge=()=>{_.current!==0&&w.current?(w.current.scrollLeft+=_.current,N.current=requestAnimationFrame(ge)):N.current=null},Le=De=>{if(st.current&&!ie){const{initialMouseX:Qe,initialMouseY:pt}=st.current;if(Math.abs(De.clientX-Qe)>3||Math.abs(De.clientY-pt)>3){const nt=st.current.task;Be({...st.current,originalStartMin:V(nt.start_time),originalDuration:nt.duration||60,currentDate:st.current.originalDate,currentStartMin:V(nt.start_time)||540,currentDuration:nt.duration||60,currentSection:st.current.originalType,startOffsetMin:st.current.startOffsetMin})}}if(ie){if(De.preventDefault(),w.current){const{left:Ge,width:Ct}=w.current.getBoundingClientRect(),Y=Ge+Ct,q=120;let oe=0;const Ce=25;if(De.clientX<Ge+q){const xt=1-Math.max(0,De.clientX-Ge)/q;oe=-Math.max(2,Math.round(Ce*xt))}else if(De.clientX>Y-q){const xt=1-Math.max(0,Y-De.clientX)/q;oe=Math.max(2,Math.round(Ce*xt))}oe!==_.current&&(_.current=oe,oe!==0&&!N.current&&ge())}const Qe=document.elementsFromPoint(De.clientX,De.clientY);let pt=ie.currentSection,nt=ie.currentDate,ut=ie.currentStartMin,he=ie.currentDuration;const we=Qe.find(Ge=>Ge.getAttribute("data-drop-zone")==="allday"),Xe=Qe.find(Ge=>Ge.getAttribute("data-drop-zone")==="grid"),Ze=Qe.find(Ge=>Ge.getAttribute("data-date")),lt=Ze==null?void 0:Ze.getAttribute("data-date");if(lt&&(nt=new Date(lt)),we?pt="allday":Xe&&(pt="grid"),pt==="grid"&&Xe){const Ge=Xe.getBoundingClientRect();let Ct=De.clientY-Ge.top,Y=Ke(Ct);if(ie.type==="move")Y=Y-ie.startOffsetMin,ut=Math.round(Y/15)*15,ut=Math.max(0,Math.min(1425,ut));else if(ie.type==="resize-bottom"){const q=Math.round(Y/15)*15,oe=Math.max(15,q-ie.originalStartMin);ie.currentDuration=oe,he=oe,ut=ie.originalStartMin}else if(ie.type==="resize-top"){let q=Math.round(Y/15)*15;const oe=ie.originalStartMin+ie.originalDuration;let Ce=oe-q;Ce<15&&(Ce=15,q=oe-15),he=Ce,ut=q}}Be(Ge=>Ge?{...Ge,currentDate:nt,currentSection:pt,currentStartMin:ut,currentDuration:he}:null)}},Ue=async()=>{if(_.current=0,N.current&&(cancelAnimationFrame(N.current),N.current=null),ie){const{task:De,currentDate:Qe,currentSection:pt,currentStartMin:nt,currentDuration:ut,originalType:he,type:we}=ie,Xe=h.includes(De.id)?h:[De.id],Ze=[],lt=Qe.getTime()-ie.originalDate.getTime(),Ge=Math.round(lt/864e5),Ct=nt-ie.originalStartMin;for(const Y of Xe){const q=s.find(Ce=>Ce.id===Y);if(!q)continue;const oe={};if(q.start_date){const Ce=new Date(q.start_date);Ce.setDate(Ce.getDate()+Ge),oe.start_date=Ce.toISOString()}else oe.start_date=Qe.toISOString();if(pt==="allday")oe.is_all_day=!0;else if(oe.is_all_day=!1,he==="grid"){let dt=V(q.start_time)+Ct;if(dt<0&&(dt=0),oe.start_time=re(dt),oe.start_date){const xt=new Date(oe.start_date);xt.setHours(Math.floor(dt/60)),xt.setMinutes(dt%60),oe.start_date=xt.toISOString()}we==="resize-bottom"||we==="resize-top"?oe.duration=ut:oe.duration=q.duration||60,oe.end_time=re((V(oe.start_time)||0)+(oe.duration||60))}else oe.start_time=re(nt),oe.duration=60,oe.end_time=re(nt+60);Ze.push({id:Y,data:oe})}Ze.length>0&&await y(Ze)}Be(null),st.current=null};return window.addEventListener("mousemove",Le),window.addEventListener("mouseup",Ue),()=>{window.removeEventListener("mousemove",Le),window.removeEventListener("mouseup",Ue)}},[ie,s,h,y]);const Pe=(ge,Le,Ue,De,Qe)=>{if(ge.button!==0)return;ge.preventDefault(),ge.stopPropagation(),f(ge,Le.id);let pt=0,nt=200;const ut=ge.currentTarget;if(nt=ut.getBoundingClientRect().width,!Qe){const we=ut.closest(".schedule-body");if(we){const Xe=we.getBoundingClientRect(),Ze=ge.clientY-Xe.top;pt=Ke(Ze)-V(Le.start_time)}else pt=0}st.current={task:Le,initialMouseX:ge.clientX,initialMouseY:ge.clientY,originalDate:Ue,type:De,originalType:Qe?"allday":"grid",startOffsetMin:pt,colWidth:nt}},me=async(ge,Le)=>{ge.stopPropagation(),p([]);const Ue=await d({title:"",start_date:Le.toISOString(),is_all_day:!0,status:"inbox"});u(Ue)},Me=(ge,Le)=>{if(ge.button!==0)return;p([]);const Ue=ge.currentTarget.getBoundingClientRect(),De=ge.clientY-Ue.top,Qe=Math.floor(Ke(De)/15)*15;Te({date:Le,startMin:Qe,duration:60,title:""}),setTimeout(()=>{var pt;return(pt=xe.current)==null?void 0:pt.focus()},50)},qe=async()=>{D&&D.title.trim()&&await d({title:D.title,start_date:D.date.toISOString(),start_time:re(D.startMin),duration:D.duration,status:"inbox",is_all_day:!1}),Te(null)},ht=(ge,Le)=>{if(ge.button!==0||ge.target.closest("[data-task-id]"))return;p([]);const De=ge.currentTarget.getBoundingClientRect(),Qe=ge.clientY-De.top,pt=Math.floor(Ke(Qe)/15)*15;z({date:Le,startMin:pt,endMin:pt,initialY:ge.clientY})};b.useEffect(()=>{if(!U)return;const ge=Ue=>{if(!w.current)return;const Qe=document.querySelector(`div[data-date="${U.date.toISOString()}"]`);if(!Qe)return;const pt=Qe.querySelector(".schedule-body");if(!pt)return;const nt=pt.getBoundingClientRect(),ut=Ue.clientY-nt.top,he=Math.floor(Ke(ut)/15)*15,we=Math.max(0,Math.min(24*60-15,he));z(Xe=>Xe?{...Xe,endMin:we}:null)},Le=()=>{if(U){const{date:Ue,startMin:De,endMin:Qe}=U,pt=Math.min(De,Qe),ut=Math.max(De,Qe)-pt;ut>=15&&(Te({date:Ue,startMin:pt,duration:Math.max(15,ut),title:""}),setTimeout(()=>{var he;return(he=xe.current)==null?void 0:he.focus()},50))}z(null)};return window.addEventListener("mousemove",ge),window.addEventListener("mouseup",Le),()=>{window.removeEventListener("mousemove",ge),window.removeEventListener("mouseup",Le)}},[U]);const wt=ge=>{if(ge.length===0)return{};const Le=ge.map(nt=>({id:nt.id,start:V(nt.start_time),end:V(nt.start_time)+(nt.duration||60)})).sort((nt,ut)=>nt.start-ut.start),Ue=[];let De=[],Qe=-1;Le.forEach(nt=>{De.length===0?(De.push(nt),Qe=nt.end):nt.start<Qe?(De.push(nt),Qe=Math.max(Qe,nt.end)):(Ue.push(De),De=[nt],Qe=nt.end)}),De.length>0&&Ue.push(De);const pt={};return Ue.forEach(nt=>{const ut=[];nt.forEach(lt=>{let Ge=!1;for(let Ct=0;Ct<ut.length;Ct++){const Y=ut[Ct],q=Y[Y.length-1];if(lt.start>=q.end){Y.push(lt),Ge=!0;break}}Ge||ut.push([lt])});const we=90/ut.length,Xe={},Ze=[];nt.forEach(lt=>{let Ge=!1;for(let Ct=0;Ct<Ze.length;Ct++){const Y=Ze[Ct],q=Y[Y.length-1];if(lt.start>=q.end){Y.push(lt),Xe[lt.id]=Ct,Ge=!0;break}}Ge||(Ze.push([lt]),Xe[lt.id]=Ze.length-1)}),nt.forEach(lt=>{const Ge=Xe[lt.id];pt[lt.id]={left:`${Ge*we+2}%`,width:`${we}%`}})}),pt};return c.jsxs("div",{ref:v,className:"h-full flex flex-col bg-theme-main overflow-hidden",children:[c.jsxs("div",{className:"flex bg-theme-header border-b border-theme p-2 items-center flex-shrink-0 z-40 shadow-sm justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Yi,{size:16,className:"text-theme-primary"}),c.jsx("span",{className:"font-bold text-theme-primary text-sm",children:"Schedule"})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-[10px] text-theme-tertiary font-medium",children:"WIDTH"}),c.jsx("input",{type:"range",min:"120",max:"400",value:j,onChange:ge=>O(Number(ge.target.value)),className:"w-20 h-1 bg-theme-hover rounded-lg appearance-none cursor-pointer accent-indigo-500"})]}),h.length>0&&c.jsxs("button",{onClick:ne,className:`px-3 py-1 border rounded-md text-xs font-bold shadow-sm flex items-center gap-1 transition-all
                                ${h.every(ge=>{var De;const Le=s.find(Qe=>Qe.id===ge),Ue=i.find(Qe=>Qe.name.toLowerCase()==="schedule"||Qe.name==="");return Ue&&((De=Le==null?void 0:Le.tags)==null?void 0:De.includes(Ue.id))})?"bg-indigo-100 text-indigo-700 border-indigo-200":"bg-theme-card border-theme text-theme-secondary hover:bg-theme-hover"}`,title:" Schedule ",children:[c.jsx(vI,{size:14}),h.length>1?`(${h.length})`:""]}),c.jsx("button",{onClick:se,className:"px-3 py-1 bg-theme-card border border-theme rounded-md text-xs font-bold shadow-sm hover:bg-theme-hover text-theme-primary",children:"Today"}),c.jsx("button",{onClick:()=>K(!Z),className:`px-3 py-1 border rounded-md text-xs font-bold shadow-sm transition-colors
                            ${Z?"bg-indigo-600 text-white border-indigo-600":"bg-theme-card border-theme text-theme-tertiary hover:bg-theme-hover"}`,children:Z?"Work Hours":"Full Day"})]})]}),c.jsxs("div",{ref:w,className:"flex-1 overflow-auto flex relative",onScroll:pe,children:[c.jsxs("div",{className:"sticky left-0 z-30 bg-theme-sidebar border-r border-theme flex-shrink-0 w-14 flex flex-col pointer-events-none select-none h-min relative",children:[c.jsx("div",{className:"sticky top-0 bg-theme-sidebar z-40 border-b border-theme flex-shrink-0",style:{height:ra+A+4}}),Array.from({length:24}).map((ge,Le)=>c.jsx("div",{className:"text-[10px] text-theme-tertiary font-extralight text-center relative box-border",style:{height:_e(Le)},children:c.jsxs("span",{className:"absolute -top-1.5 left-0 right-0",children:[Le,":00"]})},Le)),c.jsx("div",{className:"absolute right-0 flex items-center z-50",style:{top:ra+A+4+ve(k.getHours()*60+k.getMinutes())-8},children:c.jsx("div",{className:"bg-red-500 text-white text-[9px] font-bold px-1 py-0.5 rounded-sm shadow-sm",children:k.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})})}),c.jsx("div",{className:"h-20"})]}),S.map((ge,Le)=>{const Ue=yi(ge,k),De=`${ge.getFullYear()}-${ge.getMonth()}-${ge.getDate()}`,Qe=ae.get(De)||[],pt=Qe.filter(he=>!he.is_all_day&&he.start_time&&he.start_date),nt=Qe.filter(he=>he.is_all_day||!he.start_time),ut=wt(pt);return c.jsxs("div",{"data-date":ge.toISOString(),className:"flex-shrink-0 flex flex-col border-r border-theme bg-theme-main relative group h-min",style:{minWidth:j,width:j},children:[c.jsxs("div",{className:`sticky top-0 z-20 border-b border-theme px-1 py-0.5 text-center flex flex-col justify-start select-none shadow-sm relative
                                ${Ue?"bg-indigo-500/10 backdrop-blur-sm":"bg-theme-header backdrop-blur-sm"}
                            `,style:{height:ra+A+4},children:[c.jsx("div",{className:"absolute top-0 right-0 w-2 h-full cursor-col-resize z-30 hover:bg-indigo-400/30 transition-colors group-hover:opacity-100 opacity-0",onMouseDown:he=>ee(he,Le)}),c.jsxs("div",{className:"flex items-center justify-center gap-1 flex-shrink-0",style:{height:ra-4},children:[c.jsxs("span",{className:`text-[10px] font-extralight ${Ue?"text-indigo-500":"text-theme-tertiary"}`,children:["",Pee[ge.getDay()]]}),c.jsx("span",{className:`text-lg font-extralight ${Ue?"text-indigo-500":"text-theme-primary"}`,children:ge.getDate()})]}),c.jsx("div",{"data-drop-zone":"allday",className:"overflow-y-auto space-y-1 py-1 border-t border-dashed border-theme custom-scrollbar px-1 cursor-cell transition-colors relative",style:{height:A},onDoubleClick:he=>me(he,ge),children:nt.map(he=>{var Y,q;const we=cp(he,s),Xe=g(he,we),Ze=h.includes(he.id),lt=(ie==null?void 0:ie.task.id)===he.id,Ge=(Y=i.find(oe=>oe.name.toLowerCase()==="schedule"||oe.name===""))==null?void 0:Y.id,Ct=Ge&&((q=he.tags)==null?void 0:q.includes(Ge));return c.jsxs("div",{onMouseDown:oe=>Pe(oe,he,ge,"move",!0),onDoubleClick:oe=>{oe.stopPropagation(),p([]),u(he.id)},className:`group/allday text-[10px] px-2 py-1 rounded-lg border text-center font-extralight transition-all w-full relative overflow-hidden cursor-grab active:cursor-grabbing
                                                    ${Ze?"ring-2 ring-offset-1":""}
                                                    ${lt?"opacity-30":""}
                                                `,style:{backgroundColor:Ct?`${Xe}10`:Ze?Xe+"40":Xe+"18",backgroundImage:Ct?`repeating-linear-gradient(45deg, ${Xe}20 0px, ${Xe}20 4px, transparent 4px, transparent 8px)`:void 0,color:Xe,borderColor:Ze?Xe+"80":Xe+"60",boxShadow:Ze?"2px 2px 4px rgba(0,0,0,0.12)":"2px 2px 3px rgba(0,0,0,0.08)","--tw-ring-color":Ze?Xe+"60":void 0,...Ct?{fontWeight:"bold"}:{}},children:[c.jsx("div",{className:"absolute inset-0 opacity-0 group-hover/allday:opacity-100 transition-opacity pointer-events-none",style:{backgroundColor:Xe+"15"}}),c.jsx("div",{className:"truncate pointer-events-none relative z-10",children:he.title||"Untitled"})]},he.id)})}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-2 cursor-ns-resize hover:bg-indigo-400/30 transition-colors z-30",onMouseDown:ye})]}),c.jsxs("div",{"data-drop-zone":"grid",className:"flex-1 relative overflow-hidden schedule-body",style:{height:je()},onDoubleClick:he=>Me(he,ge),onMouseDown:he=>ht(he,ge),children:[Array.from({length:24}).map((he,we)=>c.jsx("div",{className:"border-t border-theme box-border w-full pointer-events-none opacity-20",style:{height:_e(we)}},we)),U&&yi(U.date,ge)&&(()=>{const he=Math.min(U.startMin,U.endMin),we=Math.max(U.startMin,U.endMin);if(we-he<15)return null;const Ze=ve(he),lt=ve(we);return c.jsx("div",{className:"absolute left-1 right-1 rounded-xl border-2 border-dashed border-indigo-400 bg-indigo-50/50 pointer-events-none z-40 flex items-center justify-center",style:{top:Ze,height:lt-Ze},children:c.jsxs("span",{className:"text-xs font-extralight text-indigo-600",children:[re(he)," - ",re(we)]})})})(),Ue&&c.jsxs("div",{className:"absolute w-full flex items-center z-10 pointer-events-none",style:{top:ve(k.getHours()*60+k.getMinutes())},children:[c.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 -ml-1"}),c.jsx("div",{className:"flex-1 border-t-2 border-red-500"})]}),pt.map(he=>{var oe,Ce;const we=ut[he.id];if(!we||ie&&ie.task.id===he.id)return null;const Xe=V(he.start_time),Ze=he.duration||60,lt=cp(he,s),Ge=g(he,lt),Ct=h.includes(he.id),Y=(oe=i.find(dt=>dt.name.toLowerCase()==="schedule"||dt.name===""))==null?void 0:oe.id,q=Y&&((Ce=he.tags)==null?void 0:Ce.includes(Y));return c.jsxs("div",{"data-task-id":he.id,onMouseDown:dt=>Pe(dt,he,ge,"move",!1),onDoubleClick:dt=>{dt.stopPropagation(),p([]),u(he.id)},className:`absolute rounded-xl border px-2 py-1.5 overflow-hidden select-none cursor-pointer hover:brightness-98 transition-all flex flex-col
                                                ${Ct?"ring-2 ring-offset-1":""}
                                            `,style:{top:ve(Xe),height:ve(Xe+Ze)-ve(Xe),left:we.left,width:we.width,backgroundColor:q?`${Ge}10`:Ct?Ge+"40":Ge+"15",backgroundImage:q?`repeating-linear-gradient(45deg, ${Ge}20 0px, ${Ge}20 4px, transparent 4px, transparent 8px)`:void 0,borderColor:Ge+"50",color:Ge,zIndex:10,boxShadow:"2px 2px 3px rgba(0,0,0,0.06)","--tw-ring-color":Ct?Ge+"60":void 0,...q?{fontWeight:"bold"}:{}},children:[c.jsx("div",{className:"font-extralight text-[11px] truncate leading-normal pointer-events-none",children:he.title||""}),Ze>30&&c.jsxs("div",{className:"text-[9px] opacity-80 font-extralight mt-0.5 leading-normal pointer-events-none",children:[he.start_time," - ",he.end_time]}),c.jsx("div",{className:"absolute top-0 left-0 w-full h-3 cursor-ns-resize z-50 hover:bg-black/5 transition-colors",onMouseDown:dt=>Pe(dt,he,ge,"resize-top",!1)}),c.jsx("div",{className:"absolute bottom-0 left-0 w-full h-3 cursor-ns-resize z-50 hover:bg-black/5 transition-colors",onMouseDown:dt=>Pe(dt,he,ge,"resize-bottom",!1)})]},he.id)}),D&&yi(D.date,ge)&&c.jsx("div",{className:"absolute z-50 rounded-xl border border-indigo-500 bg-theme-card shadow-xl overflow-hidden px-3 flex items-center",style:{top:ve(D.startMin),height:Math.max(44,ve(D.startMin+D.duration)-ve(D.startMin)),left:"5%",width:"90%"},children:c.jsx("input",{ref:xe,value:D.title,onChange:he=>Te({...D,title:he.target.value}),onKeyDown:he=>{he.key==="Enter"&&qe(),he.key==="Escape"&&Te(null)},onBlur:qe,className:"w-full text-[12px] font-extralight bg-transparent outline-none text-indigo-400 leading-normal",placeholder:"New Task...",autoFocus:!0})})]})]},ge.toISOString())}),ie&&(()=>{var Qe,pt,nt;const ge=cp(ie.task,s),Le=g(ie.task,ge);let Ue=0;const De=Array.from(document.querySelectorAll("div[data-date]")).find(ut=>ut.getAttribute("data-date")===ie.currentDate.toISOString());if(De?Ue=De.getBoundingClientRect().left:Ue=ie.initialMouseX,ie.currentSection==="allday"){const he=(((Qe=w.current)==null?void 0:Qe.getBoundingClientRect().top)||0)+ra+2;return c.jsx("div",{className:"fixed z-[100] pointer-events-none rounded-lg border px-2 py-1 text-[10px] font-extralight text-center shadow-xl cursor-grabbing flex items-center justify-center bg-white",style:{left:Ue+4,top:he,width:(ie.colWidth||200)-8,height:A-4,backgroundColor:Le+"40",borderColor:Le,color:Le},children:ie.task.title||"Untitled"})}else{const ut=((pt=w.current)==null?void 0:pt.getBoundingClientRect())||{top:0,left:0},he=((nt=w.current)==null?void 0:nt.scrollTop)||0,we=ve(ie.currentStartMin),Xe=ve(ie.currentStartMin+ie.currentDuration)-we,Ze=ut.top+ra+A+4+we-he;return c.jsxs("div",{className:`fixed rounded-xl border px-2 py-1.5 shadow-2xl overflow-hidden select-none flex flex-col z-[100] bg-white ring-2 ring-indigo-400/50 ${ie.type.startsWith("resize")?"cursor-ns-resize":"cursor-grabbing"}`,style:{top:Math.max(ut.top+ra+A+4,Ze),height:Xe,left:Ue+4,width:(ie.colWidth||190)-8,backgroundColor:"var(--bg-card)",borderColor:Le,color:Le,opacity:.95},children:[c.jsx("div",{className:"font-extralight text-[11px] truncate leading-normal",children:ie.task.title||""}),c.jsxs("div",{className:"text-[9px] font-extralight mt-0.5 opacity-80 leading-normal",children:[re(ie.currentStartMin)," - ",re(ie.currentStartMin+ie.currentDuration)]})]})}})()]})]})},$ee=Object.keys(Kn),zee=()=>{const{tasks:t,updateTask:e,selectedTaskIds:n,viewTagFilters:r,setEditingTaskId:s,focusSplitWidth:i,setFocusSplitWidth:o,themeSettings:a,setSelectedTaskIds:l,constructionModeEnabled:u,setConstructionModeEnabled:d,deleteTask:f,editingTaskId:h,batchDeleteTasks:p,setCalendarDate:m,tags:y,tagsWithResolvedColors:x}=b.useContext(_n),g=b.useRef(null),[v,w]=b.useState(!1),[S,I]=b.useState(()=>localStorage.getItem("focus_calendar_mode")||"calendar"),[k,R]=b.useState(null),[C,T]=b.useState(()=>{try{const V=localStorage.getItem("focus_filter_tags_include");return V?JSON.parse(V):[]}catch{return[]}}),[_,N]=b.useState(()=>{try{const V=localStorage.getItem("focus_filter_tags_exclude");return V?JSON.parse(V):[]}catch{return[]}}),[j,O]=b.useState(()=>{try{const V=localStorage.getItem("focus_filter_colors");return V?JSON.parse(V):[]}catch{return[]}}),[P,G]=b.useState(()=>{try{const V=localStorage.getItem("focus_filter_projects");return V?JSON.parse(V):[]}catch{return[]}}),[A,M]=b.useState(!1),[Q,X]=b.useState(!1),[D,Te]=b.useState(!1),xe=b.useRef(null),U=b.useRef(null),z=b.useRef(null);b.useEffect(()=>{localStorage.setItem("focus_filter_tags_include",JSON.stringify(C))},[C]),b.useEffect(()=>{localStorage.setItem("focus_filter_tags_exclude",JSON.stringify(_))},[_]),b.useEffect(()=>{localStorage.setItem("focus_filter_colors",JSON.stringify(j))},[j]),b.useEffect(()=>{localStorage.setItem("focus_filter_projects",JSON.stringify(P))},[P]);const ie=b.useMemo(()=>t.filter(V=>V.is_project&&V.status!=="deleted"),[t]),Be=C.length>0||_.length>0||j.length>0||P.length>0,st=()=>{T([]),N([]),O([]),G([])},ae=V=>{C.includes(V)?(T(re=>re.filter(se=>se!==V)),N(re=>[...re,V])):_.includes(V)?N(re=>re.filter(se=>se!==V)):T(re=>[...re,V])};b.useEffect(()=>{const V=re=>{xe.current&&!xe.current.contains(re.target)&&M(!1),U.current&&!U.current.contains(re.target)&&X(!1),z.current&&!z.current.contains(re.target)&&Te(!1)};return document.addEventListener("mousedown",V),()=>document.removeEventListener("mousedown",V)},[]),b.useEffect(()=>{localStorage.setItem("focus_calendar_mode",S)},[S]);const Z=n.length>0&&n.some(V=>{const re=t.find(se=>se.id===V);return re&&!re.start_date}),K=u&&Z,de=n.length>0&&n.some(V=>{const re=t.find(se=>se.id===V);return re&&re.start_date}),ce=u&&de&&!Z,ke=b.useMemo(()=>{const V=r.focus||{include:[],exclude:[]},{include:re,exclude:se}=Array.isArray(V)?{include:V,exclude:[]}:V,ne=new Set(t.filter(ee=>ee.status==="deleted").map(ee=>ee.id));let pe=t.filter(ee=>ee.status==="inbox"&&!ee.start_date&&!ee.completed_at&&(!ee.parent_id||!ne.has(ee.parent_id)));return re.length>0&&(pe=pe.filter(ee=>ee.tags.some(ye=>re.includes(ye)))),se.length>0&&(pe=pe.filter(ee=>!ee.tags.some(ye=>se.includes(ye)))),pe.sort((ee,ye)=>(ee.order_index||0)-(ye.order_index||0))},[t,r]);b.useEffect(()=>{const V=re=>{var se,ne,pe;if(re.key==="Escape"&&(K||ce)&&(d(!1),l([])),(re.key==="Delete"||re.key==="Backspace")&&!h){if(["INPUT","TEXTAREA"].includes(((se=document.activeElement)==null?void 0:se.tagName)||""))return;n.length>0&&(re.preventDefault(),p(n,!1),l([]))}if(re.key==="Enter"&&!h&&n.length>0){if(["INPUT","TEXTAREA"].includes(((ne=document.activeElement)==null?void 0:ne.tagName)||""))return;re.preventDefault(),s(n[0])}if((re.key==="ArrowUp"||re.key==="ArrowDown")&&!h){if(["INPUT","TEXTAREA"].includes(((pe=document.activeElement)==null?void 0:pe.tagName)||"")||(re.preventDefault(),ke.length===0))return;let ee=-1;n.length>0&&(ee=ke.findIndex(me=>n.includes(me.id)));let ye=0;re.key==="ArrowDown"?ee===-1?ye=0:ye=Math.min(ke.length-1,ee+1):ee===-1?ye=ke.length-1:ye=Math.max(0,ee-1);const Pe=ke[ye];Pe&&(l([Pe.id]),ve(ye),setTimeout(()=>{const me=document.getElementById(`focus-task-${Pe.id}`);me==null||me.scrollIntoView({block:"nearest"})},0))}};return window.addEventListener("keydown",V),()=>window.removeEventListener("keydown",V)},[K,ce,l,d,n,f,h,ke]),b.useEffect(()=>{n.length===0&&d(!1)},[n]),b.useEffect(()=>{const V=se=>{if(!v||!g.current)return;const ne=g.current.getBoundingClientRect();let pe=se.clientX-ne.left;const ee=ne.width*.9;pe<100&&(pe=100),pe>ee&&(pe=ee),o(pe)},re=()=>{w(!1),document.body.style.cursor="default"};return v&&(window.addEventListener("mousemove",V),window.addEventListener("mouseup",re),document.body.style.cursor="col-resize"),()=>{window.removeEventListener("mousemove",V),window.removeEventListener("mouseup",re)}},[v]);const[_e,ve]=b.useState(null),Ke=(V,re,se)=>{if(se.shiftKey&&_e!==null){const ne=Math.min(_e,re),pe=Math.max(_e,re),ee=ke.slice(ne,pe+1).map(ye=>ye.id);l(ee)}else se.metaKey||se.ctrlKey?n.includes(V)?l(n.filter(ne=>ne!==V)):l([...n,V]):l([V]);ve(re)},je=(V,re)=>{const se=n.includes(V.id),ne={small:"text-xs",normal:"text-sm",large:"text-base"}[a.fontSize]||"text-sm",pe=a.fontFamily==="things"?"font-things":"font-sans",ee=V.color||"blue",ye=Kn[ee]||Kn.blue;return c.jsxs("div",{id:`focus-task-${V.id}`,onClick:Pe=>Ke(V.id,re,Pe),onDoubleClick:Pe=>{Pe.stopPropagation(),s(V.id)},className:`
                    group relative flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer
                    transition-all duration-150 ease-out
                    ${se?`bg-indigo-50 ring-2 shadow-sm ${K||ce?"construction-glow ring-transparent":"ring-indigo-400"}`:"hover:bg-theme-hover active:bg-theme-hover"}
                `,style:se&&(K||ce)?{"--glow-color":ye.color,"--tw-ring-color":ye.color}:{},children:[c.jsx("div",{className:`flex-shrink-0 w-4 h-4 rounded-full border-2 transition-colors ${se?`${ye.border} ${ye.bg}`:"border-gray-300 group-hover:border-gray-400"}`,onClick:Pe=>{Pe.stopPropagation(),e(V.id,{status:"completed"})}}),c.jsxs("div",{className:"flex-1 min-w-0",children:[V.parent_id&&(()=>{const Pe=t.find(me=>me.id===V.parent_id);return Pe?c.jsxs("div",{className:"text-[9px] text-gray-400 truncate mb-0.5 flex items-center gap-1",children:[c.jsx("span",{className:"w-1 h-1 rounded-full bg-gray-300"}),Pe.title]}):null})(),c.jsx("div",{className:`${ne} ${pe} font-extralight text-theme-secondary truncate leading-tight`,children:V.title||c.jsx("span",{className:"text-theme-tertiary italic",children:""})})]})]},V.id)};return c.jsxs("div",{ref:g,className:"flex h-full w-full overflow-hidden bg-theme-main",children:[c.jsx("div",{style:{width:i},className:"flex flex-col h-full border-r border-theme flex-shrink-0 bg-theme-sidebar",children:c.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar px-2 py-3 space-y-4",children:[ke.length>0&&c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between px-2 mb-1",children:[c.jsxs("span",{className:`text-[9px] text-gray-400 ${a.fontFamily==="things"?"font-things":"font-sans"}`,children:[" (",ke.length,")"]}),n.length>0&&c.jsxs("button",{onClick:()=>d(!u),className:`flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] font-medium transition-all ${u?"bg-amber-100 text-amber-700 ring-1 ring-amber-300":"bg-gray-100 text-gray-500 hover:bg-gray-200"}`,title:u?"":"",children:[c.jsx(p6,{size:10}),u?"":""]})]}),c.jsx("div",{className:"space-y-1",children:ke.slice(0,50).map((V,re)=>je(V,re))})]}),ke.length===0&&c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx(Cg,{size:32,className:"mb-2 opacity-30"}),c.jsx("p",{className:"text-sm",children:""})]})]})}),c.jsx("div",{onMouseDown:()=>w(!0),className:`w-1 cursor-col-resize hover:bg-indigo-400 group relative z-30 transition-colors flex items-center justify-center ${v?"bg-indigo-400":"bg-transparent"}`,children:c.jsx("div",{className:`absolute opacity-0 group-hover:opacity-100 transition-opacity p-0.5 bg-white border border-gray-200 rounded-md shadow-sm text-gray-400 ${v?"opacity-100":""}`,children:c.jsx(CI,{size:10})})}),c.jsxs("div",{className:"flex-1 h-full min-w-0 relative overflow-hidden flex flex-col",children:[c.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-theme bg-theme-header flex-shrink-0",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[k&&c.jsxs("button",{onClick:()=>{R(null),I("calendar")},className:"flex items-center gap-1 px-2 py-1.5 rounded-md text-xs font-medium text-theme-secondary hover:text-theme-primary hover:bg-theme-hover transition-all",title:"",children:[c.jsx(bI,{size:14}),""]}),c.jsxs("div",{className:"flex items-center gap-1 bg-theme-hover p-0.5 rounded-lg",children:[c.jsxs("button",{onClick:()=>{I("calendar"),R(null)},className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${S==="calendar"&&!k?"bg-theme-card text-indigo-500 shadow-sm":"text-theme-tertiary hover:text-theme-secondary"}`,children:[c.jsx(Go,{size:14}),""]}),c.jsxs("button",{onClick:()=>{I("schedule"),R(null)},className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${S==="schedule"||k?"bg-theme-card text-indigo-500 shadow-sm":"text-theme-tertiary hover:text-theme-secondary"}`,children:[c.jsx(Yi,{size:14}),""]})]}),k&&c.jsxs("span",{className:"text-sm font-medium text-indigo-600",children:[k.getMonth()+1,"",k.getDate()," (",["","","","","","",""][k.getDay()],")"]})]}),c.jsx("div",{className:"text-[10px] text-gray-400",children:k?"":S==="schedule"?" 1-9 ":""})]}),c.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 border-b border-theme bg-theme-card/50 flex-shrink-0",children:[c.jsx("span",{className:"text-[9px] font-bold text-gray-400 uppercase tracking-wider",children:":"}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>M(!A),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-medium transition-all border ${C.length>0||_.length>0?"bg-indigo-50 text-indigo-600 border-indigo-200":"bg-theme-hover text-theme-tertiary border-transparent hover:text-theme-secondary"}`,children:[c.jsx(Ol,{size:11}),"",C.length+_.length>0&&c.jsx("span",{className:"ml-0.5 px-1 bg-indigo-500 text-white rounded-full text-[9px]",children:C.length+_.length}),c.jsx(ds,{size:10})]}),A&&c.jsxs("div",{ref:xe,className:"absolute top-full left-0 mt-1 w-56 bg-theme-card rounded-lg shadow-xl border border-theme z-50 p-1 max-h-64 overflow-y-auto",children:[c.jsxs("div",{className:"text-[9px] text-theme-tertiary px-2 py-1 border-b border-theme mb-1",children:[":   ",c.jsx("span",{className:"text-green-600",children:""}),"  ",c.jsx("span",{className:"text-red-500",children:""}),"  "]}),y.map(V=>{const re=C.includes(V.id),se=_.includes(V.id);return c.jsxs("button",{onClick:()=>ae(V.id),className:`w-full flex items-center justify-between px-2 py-1.5 text-xs rounded hover:bg-theme-hover transition-colors ${re?"bg-green-50":se?"bg-red-50":""}`,children:[c.jsxs("div",{className:"flex items-center gap-1.5",children:[c.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:x[V.id]||"#6366f1"}}),c.jsx("span",{className:"text-theme-secondary",children:V.name})]}),re&&c.jsx(tr,{size:12,className:"text-green-600"}),se&&c.jsx(on,{size:12,className:"text-red-500"})]},V.id)}),y.length===0&&c.jsx("div",{className:"text-xs text-theme-tertiary p-2",children:""})]})]}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>X(!Q),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-medium transition-all border ${j.length>0?"bg-indigo-50 text-indigo-600 border-indigo-200":"bg-theme-hover text-theme-tertiary border-transparent hover:text-theme-secondary"}`,children:[c.jsx(_w,{size:11}),"",j.length>0&&c.jsx("span",{className:"ml-0.5 px-1 bg-indigo-500 text-white rounded-full text-[9px]",children:j.length}),c.jsx(ds,{size:10})]}),Q&&c.jsx("div",{ref:U,className:"absolute top-full left-0 mt-1 w-48 bg-theme-card rounded-lg shadow-xl border border-theme z-50 p-2",children:c.jsx("div",{className:"grid grid-cols-7 gap-1",children:$ee.map(V=>{var re;return c.jsx("button",{onClick:()=>{O(se=>se.includes(V)?se.filter(ne=>ne!==V):[...se,V])},className:`w-5 h-5 rounded-full transition-transform ${j.includes(V)?"ring-2 ring-offset-1 ring-indigo-500 scale-110":"hover:scale-110"}`,style:{backgroundColor:((re=Kn[V])==null?void 0:re.color)||"#6366f1"},title:V},V)})})})]}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>Te(!D),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-medium transition-all border ${P.length>0?"bg-indigo-50 text-indigo-600 border-indigo-200":"bg-theme-hover text-theme-tertiary border-transparent hover:text-theme-secondary"}`,children:[c.jsx(u6,{size:11}),"",P.length>0&&c.jsx("span",{className:"ml-0.5 px-1 bg-indigo-500 text-white rounded-full text-[9px]",children:P.length}),c.jsx(ds,{size:10})]}),D&&c.jsxs("div",{ref:z,className:"absolute top-full left-0 mt-1 w-56 bg-theme-card rounded-lg shadow-xl border border-theme z-50 p-1 max-h-64 overflow-y-auto",children:[ie.map(V=>{var re;return c.jsxs("button",{onClick:()=>{G(se=>se.includes(V.id)?se.filter(ne=>ne!==V.id):[...se,V.id])},className:`w-full flex items-center justify-between px-2 py-1.5 text-xs rounded hover:bg-theme-hover transition-colors ${P.includes(V.id)?"bg-indigo-50":""}`,children:[c.jsxs("div",{className:"flex items-center gap-1.5",children:[c.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:((re=Kn[V.color])==null?void 0:re.color)||"#6366f1"}}),c.jsx("span",{className:"text-theme-secondary truncate",children:V.title})]}),P.includes(V.id)&&c.jsx(tr,{size:12,className:"text-indigo-600"})]},V.id)}),ie.length===0&&c.jsx("div",{className:"text-xs text-theme-tertiary p-2",children:""})]})]}),Be&&c.jsxs("button",{onClick:st,className:"flex items-center gap-1 text-[10px] text-red-500 hover:text-red-600 ml-auto",children:[c.jsx(on,{size:11})," "]})]}),c.jsx("div",{className:"flex-1 relative z-10 h-full overflow-hidden",children:S==="calendar"&&!k?c.jsx(Ree,{onDateClick:V=>{R(V),m(V)},filterTags:C,filterTagsExclude:_,filterColors:j,filterProjects:P}):c.jsx(Lee,{filterTags:C,filterTagsExclude:_,filterColors:j,filterProjects:P})}),(K||ce)&&c.jsxs("div",{className:"absolute bottom-0 left-0 right-0 z-20",children:[c.jsx("div",{className:`h-12 opacity-45 transition-colors ${ce?"opacity-30":"opacity-45"}`,style:{backgroundImage:K?`repeating-linear-gradient(
                                    45deg,
                                    #fbbf24 0px,
                                    #fbbf24 10px,
                                    #1f2937 10px,
                                    #1f2937 20px
                                )`:`repeating-linear-gradient(
                                    45deg,
                                    #818cf8 0px,
                                    #818cf8 10px,
                                    #312e81 10px,
                                    #312e81 20px
                                )`,backgroundSize:"28px 28px"}}),c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:c.jsx("div",{className:`bg-white/95 backdrop-blur-sm px-4 py-2 rounded-lg shadow-lg border ${K?"border-amber-200":"border-indigo-200"}`,children:c.jsxs("span",{className:`text-sm font-bold ${K?"text-amber-700":"text-indigo-700"}`,children:[K?" ":" "," ",n.length,"    ESC "]})})})]})]})]})},Ri=40,$y=50,Oi=40,zy=250,kR=({plan:t,onUpdatePlan:e,onEditTask:n})=>{const[r,s]=b.useState(null),[i,o]=b.useState(null),[a,l]=b.useState(null),[u,d]=b.useState(null),[f,h]=b.useState(0),[p,m]=b.useState(0),[y,x]=b.useState(0),[g,v]=b.useState({x:0,y:0}),[w,S]=b.useState(null),I=b.useRef(null),k=b.useRef(null),R=b.useRef(null);R.current=w,b.useEffect(()=>{S(null)},[t]);const C=(K,de=0,ce=[],ke=null)=>{let _e=[];return K.forEach((ve,Ke)=>{const je=[...ce,Ke];_e.push({...ve,depth:de,path:je,parentId:ke}),ve.subtasks&&ve.subtasks.length>0&&(_e=[..._e,...C(ve.subtasks,de+1,je,ve.id||null)])}),_e},T=w||t,_=b.useMemo(()=>C(T),[T]),N=K=>_.find(de=>de.id===K),j=K=>{if(!K)return null;const de=new Date(K);return isNaN(de.getTime())?null:de},{minDate:O,totalDays:P}=b.useMemo(()=>{let K=new Date,de=new Date;de.setDate(K.getDate()+14);let ce=!1;C(t).forEach(Ke=>{const je=j(Ke.start_date),V=j(Ke.due_date);je&&((!ce||je<K)&&(K=je),ce=!0),V&&((!ce||V>de||V>de)&&(de=V),ce=!0)}),K.setDate(K.getDate()-2),de.setDate(de.getDate()+5);const _e=Math.abs(de.getTime()-K.getTime()),ve=Math.ceil(_e/(1e3*60*60*24));return{minDate:K,maxDate:de,totalDays:ve}},[t,w]),G=(K,de)=>{const ce=K.getTime()-de.getTime();return Math.ceil(ce/(1e3*60*60*24))},A=(K,de)=>{const ce=new Date(de);return ce.setDate(ce.getDate()+K),ce.toISOString().split("T")[0]},M=(K,de,ce)=>K.map(ke=>ke.id===de?{...ke,...ce}:ke.subtasks?{...ke,subtasks:M(ke.subtasks,de,ce)}:ke),Q=(K,de)=>{let ce=JSON.parse(JSON.stringify(K));if(!de)return ce;const ke=[de],_e=new Set;for(;ke.length>0;){const ve=ke.shift();if(_e.has(ve))continue;_e.add(ve);const Ke=(se,ne)=>{for(const pe of se){if(pe.id===ne)return pe;if(pe.subtasks){const ee=Ke(pe.subtasks,ne);if(ee)return ee}}return null},je=Ke(ce,ve);if(!je||!je.due_date)continue;const V=new Date(je.due_date),re=se=>{for(let ne=0;ne<se.length;ne++){const pe=se[ne];if(pe.dependencies&&pe.dependencies.includes(ve)){const ee=pe.start_date?new Date(pe.start_date):null,ye=new Date(V);if(ye.setDate(ye.getDate()+1),!ee||ee<ye){const Pe=pe.start_date&&pe.due_date?new Date(pe.due_date).getTime()-new Date(pe.start_date).getTime():864e5,me=ye.toISOString().split("T")[0],qe=new Date(ye.getTime()+Pe).toISOString().split("T")[0];se[ne]={...pe,start_date:me,due_date:qe},pe.id&&ke.push(pe.id)}}pe.subtasks&&re(pe.subtasks)}};re(ce)}return ce},X=(K,de)=>{if(K.preventDefault(),K.stopPropagation(),!de.id)return;s(de.id),o(de.id);const ce=de.start_date?G(new Date(de.start_date),O):0,ke=de.due_date?G(new Date(de.due_date),O):ce+1;m(ce),x(ke-ce),h(K.clientX),S(t)},D=(K,de,ce)=>{if(K.preventDefault(),K.stopPropagation(),!de.id)return;l({id:de.id,dir:ce}),h(K.clientX);const ke=de.start_date?G(new Date(de.start_date),O):0,_e=de.due_date?G(new Date(de.due_date),O):ke+1;m(ke),x(_e-ke),S(t)},Te=(K,de)=>{var ke;if(K.preventDefault(),K.stopPropagation(),!de.id)return;d(de.id);const ce=(ke=I.current)==null?void 0:ke.getBoundingClientRect();ce&&v({x:K.clientX-ce.left,y:K.clientY-ce.top})},xe=K=>{if(u&&I.current){const ke=I.current.getBoundingClientRect();v({x:K.clientX-ke.left,y:K.clientY-ke.top});return}if(!i&&!a||!I.current||!w)return;const de=K.clientX-f,ce=Math.round(de/Ri);if(i){if(!N(i))return;const _e=p+ce;if(_e<0)return;const ve=A(_e,O),Ke=A(_e+y,O),je=M(w,i,{start_date:ve,due_date:Ke});S(je)}if(a){let ke=p,_e=y;if(a.dir==="end")_e=Math.max(1,y+ce);else{const V=y-1,re=Math.min(ce,V);ke=p+re,_e=y-re}if(ke<0)return;const ve=A(ke,O),Ke=A(ke+_e,O),je=M(w,a.id,{start_date:ve,due_date:Ke});S(je)}},U=()=>{const K=R.current;if(i&&K){const de=Q(K,i);e(de)}else if(a&&K){const de=Q(K,a.id);e(de)}o(null),l(null),d(null),S(null)},z=(K,de)=>{var ce;if(K.stopPropagation(),u&&de.id&&u!==de.id){if((ce=de.dependencies)!=null&&ce.includes(u))return;const ke=[...de.dependencies||[],u],_e=M(t,de.id,{dependencies:ke}),ve=Q(_e,u);e(ve)}d(null)};b.useEffect(()=>{const K=()=>{(i||a||u)&&U()},de=ce=>{if(u&&I.current){const ke=I.current.getBoundingClientRect();v({x:ce.clientX-ke.left,y:ce.clientY-ke.top})}};return window.addEventListener("mouseup",K),window.addEventListener("mousemove",de),()=>{window.removeEventListener("mouseup",K),window.removeEventListener("mousemove",de)}},[i,a,u,t]);const ie=()=>{const K=[],de=[];for(let ce=0;ce<P;ce++){const ke=new Date(O);ke.setDate(ke.getDate()+ce);const _e=ke.getDay()===0||ke.getDay()===6;K.push(c.jsx("line",{x1:ce*Ri,y1:0,x2:ce*Ri,y2:_.length*Oi,stroke:_e?"#f3f4f6":"#e5e7eb",strokeWidth:1},`line - ${ce} `)),ce%1===0&&de.push(c.jsxs("div",{className:"absolute top-0 flex flex-col items-center justify-end pb-2 text-xs text-gray-500 border-r border-gray-100",style:{left:ce*Ri,width:Ri,height:$y},children:[c.jsx("span",{className:"font-bold",children:ke.getDate()}),c.jsx("span",{className:"text-[10px]",children:["","","","","","",""][ke.getDay()]})]},`head - ${ce} `))}return{lines:K,days:de}},Be=()=>{var de,ce;const K=[];if(_.forEach(ke=>{ke.dependencies&&ke.dependencies.forEach(_e=>{const ve=N(_e);if(ve){const Ke=ve.due_date?G(new Date(ve.due_date),O):0,je=ke.start_date?G(new Date(ke.start_date),O):0,V=_.findIndex(Pe=>Pe.id===ve.id),re=_.findIndex(Pe=>Pe.id===ke.id),se=(Ke+1)*Ri,ne=V*Oi+Oi/2,pe=je*Ri,ee=re*Oi+Oi/2,ye=`M ${se} ${ne} C ${se+20} ${ne}, ${pe-20} ${ee}, ${pe} ${ee} `;K.push(c.jsx("g",{className:"group cursor-pointer pointer-events-auto",onClick:Pe=>{var Me;if(Pe.stopPropagation(),window.confirm(`Remove dependency: ${ve.title} -> ${ke.title}?`)&&ke.id){const qe=(Me=ke.dependencies)==null?void 0:Me.filter(wt=>wt!==ve.id),ht=M(t,ke.id,{dependencies:qe});e(ht)}},children:c.jsx("path",{d:ye,fill:"none",stroke:"#94a3b8",strokeWidth:"2",markerEnd:"url(#arrowhead)",className:"group-hover:stroke-red-500"})},`${ve.id} -${ke.id} `))}})}),u){const ke=N(u);if(ke&&I.current){const _e=ke.due_date?G(new Date(ke.due_date),O):0,ve=_.findIndex(ee=>ee.id===ke.id),Ke=((de=k.current)==null?void 0:de.scrollLeft)||0,je=((ce=k.current)==null?void 0:ce.scrollTop)||0,V=(_e+1)*Ri,re=ve*Oi+Oi/2,se=g.x+Ke-zy,ne=g.y+je-$y,pe=`M ${V} ${re} L ${se} ${ne} `;K.push(c.jsx("path",{d:pe,stroke:"#6366f1",strokeWidth:"2",strokeDasharray:"5,5"},"drawing"))}}return K},{lines:st,days:ae}=ie(),Z=Be();return c.jsxs("div",{className:"flex flex-col h-full border rounded-lg overflow-hidden bg-white select-none",ref:I,onMouseMove:xe,children:[c.jsxs("div",{className:"flex border-b",children:[c.jsx("div",{style:{width:zy},className:"flex-shrink-0 border-r bg-gray-50 flex items-center px-4 font-bold text-gray-700",children:""}),c.jsx("div",{className:"flex-1 overflow-hidden relative",style:{height:$y},children:c.jsx("div",{className:"absolute inset-0",ref:K=>{K&&k.current&&(K.scrollLeft=k.current.scrollLeft)},children:ae})})]}),c.jsxs("div",{className:"flex flex-1 overflow-auto",ref:k,children:[c.jsx("div",{style:{width:zy},className:"flex-shrink-0 border-r bg-white sticky left-0 z-10",children:_.map((K,de)=>c.jsxs("div",{style:{height:Oi,paddingLeft:K.depth*20},className:`flex flex-col justify-center px-4 border-b border-gray-50 bg-white cursor-pointer hover:bg-gray-50 transition-colors ${r===K.id?"!bg-indigo-50 border-l-4 border-l-indigo-500":""}`,onClick:()=>K.id&&s(K.id),onDoubleClick:()=>K.id&&(n==null?void 0:n(K.id)),children:[c.jsx("span",{className:"truncate text-sm text-gray-700 font-medium",children:K.title}),c.jsxs("span",{className:"text-[10px] text-gray-400",children:[K.start_date?K.start_date.split("T")[0].slice(5).replace("-","/"):"",K.start_date&&K.due_date&&K.start_date.split("T")[0]!==K.due_date.split("T")[0]?` - ${K.due_date.split("T")[0].slice(5).replace("-","/")}`:""]})]},de))}),c.jsxs("div",{className:"relative",style:{width:P*Ri,height:_.length*Oi},children:[c.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",children:[c.jsx("defs",{children:c.jsx("marker",{id:"arrowhead",markerWidth:"5",markerHeight:"3.5",refX:"4",refY:"1.75",orient:"auto",children:c.jsx("polygon",{points:"0 0, 5 1.75, 0 3.5",fill:"#94a3b8"})})}),st,Z]}),_.map((K,de)=>{const ce=K.start_date?G(new Date(K.start_date),O):-1;if(ce<0)return null;const ke=K.due_date?Math.max(1,G(new Date(K.due_date),O)-ce+1):1,_e=ce*Ri,ve=ke*Ri;return c.jsxs("div",{className:`absolute rounded-md shadow-sm border border-indigo-600 bg-indigo-500 hover:bg-indigo-600 group flex items-center justify-between px-2 transition-colors ${u&&u!==K.id?"ring-2 ring-indigo-300 ring-offset-1 z-20 cursor-crosshair":""} ${r===K.id?"ring-2 ring-white ring-offset-2 ring-offset-indigo-500":""}`,style:{left:_e,top:de*Oi+6,width:ve,height:Oi-12,cursor:u?"crosshair":"grab"},onMouseDown:Ke=>X(Ke,K),onMouseUp:Ke=>{u&&(Ke.stopPropagation(),z(Ke,K))},onDoubleClick:Ke=>{Ke.stopPropagation(),n&&K.id&&n(K.id)},children:[c.jsx("div",{className:`w-4 h-4 bg-white border-2 border-indigo-500 rounded-full cursor-cell absolute -left-2 top-1/2 -translate-y-1/2 hover:scale-125 transition-transform z-30 shadow-sm flex items-center justify-center ${u&&u!==K.id?"opacity-100 animate-pulse scale-110":"opacity-0"}`,onMouseUp:Ke=>z(Ke,K),children:c.jsx("div",{className:"w-1.5 h-1.5 bg-indigo-500 rounded-full"})}),c.jsx("span",{className:"text-xs text-white font-medium truncate pointer-events-none select-none drop-shadow-sm",children:ve>30&&K.title}),c.jsx("div",{className:`w-4 h-4 bg-indigo-500 border-2 border-white rounded-full cursor-crosshair absolute -right-2 top-1/2 -translate-y-1/2 hover:scale-125 transition-transform z-30 shadow-sm ${u?"opacity-0":"opacity-0 group-hover:opacity-100"}`,onMouseDown:Ke=>Te(Ke,K)}),c.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-3 cursor-ew-resize hover:bg-black/10 z-40 rounded-l-md",onMouseDown:Ke=>D(Ke,K,"start")}),c.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-3 cursor-ew-resize hover:bg-black/10 z-40 rounded-r-md",onMouseDown:Ke=>D(Ke,K,"end")})]},K.id)})]})]}),c.jsxs("div",{className:"h-6 bg-gray-50 border-t flex items-center px-4 text-xs text-gray-400 gap-4",children:[c.jsx("span",{children:""}),c.jsx("span",{children:""}),c.jsx("span",{children:""}),c.jsx("span",{children:""})]})]})},Fee="",Bee=({isOpen:t,onClose:e,position:n,customPrompt:r,setCustomPrompt:s,onRun:i,prompts:o,saveToLibrary:a,setSaveToLibrary:l,isLoading:u,history:d,historyIndex:f,setHistoryIndex:h,onDeleteHistory:p,onUpdateHistory:m,onReplace:y,onInsert:x})=>{const[g,v]=b.useState(""),[w,S]=b.useState("prompt"),[I,k]=b.useState(!1),[R,C]=b.useState("");b.useEffect(()=>{u?S("result"):d.length>0&&f>=0?(S("result"),C(d[f].content)):S("prompt")},[u,d.length,f]);const T=o.filter(O=>O.title.toLowerCase().includes(g.toLowerCase())||O.description&&O.description.toLowerCase().includes(g.toLowerCase()));if(!t)return null;const _=n?Math.max(10,Math.min(n.top,window.innerHeight-500)):100,N=n?Math.min(n.left,window.innerWidth-420):window.innerWidth/2-200,j=d[f];return er.createPortal(c.jsx(go,{children:c.jsxs(Rr.div,{initial:{opacity:0,y:10,left:N,top:_},animate:{opacity:1,y:0,left:N,top:_},exit:{opacity:0,scale:.95},drag:!0,dragMomentum:!1,className:"fixed w-[400px] bg-white rounded-xl shadow-2xl border border-gray-100 flex flex-col overflow-hidden z-[99999]",style:{position:"fixed"},children:[c.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-100 bg-white cursor-move",children:[c.jsxs("h3",{className:"text-sm font-bold text-slate-800 flex items-center gap-2 pointer-events-none",children:[c.jsx(js,{className:"text-indigo-500",size:16}),"AI "]}),c.jsxs("div",{className:"flex items-center gap-1",children:[w==="result"&&!u&&c.jsx("button",{onClick:()=>S("prompt"),className:"p-1 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"",children:c.jsx(js,{size:14})}),c.jsx("button",{onClick:O=>{O.stopPropagation(),e()},className:"text-slate-400 hover:text-slate-600 transition-colors p-1 hover:bg-slate-100 rounded-full",children:c.jsx(on,{size:16})})]})]}),c.jsx("div",{className:"flex-1 overflow-hidden flex flex-col bg-slate-50/50",children:w==="prompt"?c.jsxs("div",{className:"p-4 space-y-4",children:[c.jsx("input",{type:"text",placeholder:"...",className:"w-full px-3 py-2 text-xs bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-100 outline-none",value:g,onChange:O=>v(O.target.value),onKeyDown:O=>O.stopPropagation(),autoFocus:!0}),!g&&T.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1.5",children:T.slice(0,5).map(O=>c.jsx("button",{onClick:()=>{s(O.description||O.title),v("")},className:"text-[10px] px-2 py-1 rounded-full bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-100 font-medium",children:O.title},O.id))}),c.jsx("textarea",{className:"w-full h-32 p-3 text-sm bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-100 outline-none resize-none",placeholder:"...",value:r,onChange:O=>s(O.target.value),onKeyDown:O=>O.stopPropagation()}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"checkbox",id:"saveToLib",checked:a,onChange:O=>l(O.target.checked),className:"w-3.5 h-3.5 rounded text-indigo-600"}),c.jsx("label",{htmlFor:"saveToLib",className:"text-xs text-slate-500 select-none",children:""})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:()=>i(Fee),className:"flex-1 py-2 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 rounded-xl text-xs font-bold border border-indigo-200 flex items-center justify-center gap-1",children:[c.jsx(js,{size:14})," "]}),c.jsx("button",{onClick:()=>i(r),disabled:!r.trim(),className:"flex-[2] py-2 bg-slate-800 hover:bg-slate-900 text-white rounded-xl text-xs font-bold disabled:opacity-50",children:""})]})]}):c.jsx("div",{className:"flex flex-col h-auto max-h-[60vh]",children:u?c.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-4 text-slate-400",children:[c.jsx(ld,{size:32,className:"text-indigo-400 animate-pulse"}),c.jsx("span",{className:"text-xs font-bold",children:"..."})]}):j?c.jsxs(c.Fragment,{children:[d.length>1&&c.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-white border-b border-gray-50",children:[c.jsxs("span",{className:"text-[10px] font-bold text-gray-400",children:[f+1," / ",d.length]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:()=>h(Math.max(0,f-1)),disabled:f===0,className:"p-1 hover:bg-gray-100 rounded disabled:opacity-30",children:c.jsx(Du,{size:14})}),c.jsx("button",{onClick:()=>h(Math.min(d.length-1,f+1)),disabled:f===d.length-1,className:"p-1 hover:bg-gray-100 rounded disabled:opacity-30",children:c.jsx(ts,{size:14})}),c.jsx("div",{className:"w-px h-3 bg-gray-200 mx-1"}),c.jsx("button",{onClick:()=>p(f),className:"p-1 hover:bg-red-50 text-gray-400 hover:text-red-500 rounded",children:c.jsx(Ar,{size:14})})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar bg-white",children:I?c.jsx("textarea",{className:"w-full h-full min-h-[150px] p-2 text-sm border border-indigo-200 rounded-lg focus:ring-2 focus:ring-indigo-100 outline-none resize-none",value:R,onChange:O=>C(O.target.value),onKeyDown:O=>O.stopPropagation()}):c.jsx("div",{className:"prose prose-sm max-w-none prose-indigo",children:c.jsx(nk,{children:j.content})})}),c.jsx("div",{className:"p-3 bg-gray-50 border-t border-gray-100 space-y-2",children:I?c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:()=>{m(f,R),k(!1)},className:"flex-1 py-1.5 bg-indigo-600 text-white rounded-lg text-xs font-bold flex items-center justify-center gap-1",children:[c.jsx(tr,{size:12})," "]}),c.jsx("button",{onClick:()=>k(!1),className:"px-3 py-1.5 bg-gray-200 text-gray-600 rounded-lg text-xs font-bold",children:""})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("button",{onClick:()=>y(j.content),className:"py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-xs font-bold shadow-sm active:scale-95 flex items-center justify-center gap-1.5",children:[c.jsx(t1,{size:12})," "]}),c.jsxs("button",{onClick:()=>x(j.content),className:"py-2 bg-white hover:bg-gray-50 text-gray-700 border border-gray-200 rounded-lg text-xs font-bold shadow-sm active:scale-95 flex items-center justify-center gap-1.5",children:[c.jsx(Wf,{size:12})," "]})]}),c.jsxs("div",{className:"flex gap-2 justify-end",children:[c.jsxs("button",{onClick:()=>{C(j.content),k(!0)},className:"px-2 py-1 text-[10px] text-gray-500 hover:text-indigo-600 flex items-center gap-1",children:[c.jsx(Tw,{size:10})," "]}),c.jsxs("button",{onClick:()=>navigator.clipboard.writeText(j.content),className:"px-2 py-1 text-[10px] text-gray-500 hover:text-indigo-600 flex items-center gap-1",children:[c.jsx(kI,{size:10})," "]})]})]})})]}):null})})]},"ai-assistant-modal")}),document.body)},Uee=()=>{const{tasks:t,tags:e,themeSettings:n,updateTask:r,setEditingTaskId:s,editingTaskId:i,addTask:o,addTag:a,setView:l,batchUpdateTasks:u,batchDeleteTasks:d}=b.useContext(_n),[f,h]=b.useState(null),[p,m]=b.useState(null),[y,x]=b.useState(null),[g,v]=b.useState("list"),[w,S]=b.useState(()=>{const q=localStorage.getItem("projectCardSize");return q?parseInt(q):280}),[I,k]=b.useState(()=>{const q=localStorage.getItem("projectOrder");return q?JSON.parse(q):[]});b.useEffect(()=>{const q=localStorage.getItem("openProjectId"),oe=localStorage.getItem("previousView");q&&(h(q),localStorage.removeItem("openProjectId")),oe&&(x(oe),localStorage.removeItem("previousView"))},[]);const R=b.useMemo(()=>e.find(q=>q.name.toLowerCase()==="project"),[e]),C=b.useMemo(()=>R?t.filter(oe=>!oe.tags.includes(R.id)||oe.status==="deleted"||oe.status==="logged"?!1:t.some(dt=>dt.parent_id===oe.id&&dt.status!=="deleted")).map(oe=>{const Ce=t.filter(xt=>xt.parent_id===oe.id&&xt.status!=="deleted").length,dt=t.filter(xt=>xt.parent_id===oe.id&&xt.status==="completed").length;return{id:oe.id,title:oe.title,description:oe.description,color:oe.color||"blue",tags:oe.tags,start_date:oe.start_date,due_date:oe.due_date,childCount:Ce,completedCount:dt,coverImage:oe.images&&oe.images.length>0?oe.images[0]:oe.cover_image,order:oe.project_order||0}}):[],[t,R]),T=b.useMemo(()=>e.filter(q=>q.name.includes("")).map(q=>q.id),[e]),_=b.useMemo(()=>I.length===0?[...C].sort((q,oe)=>{const Ce=q.tags.some(xt=>T.includes(xt)),dt=oe.tags.some(xt=>T.includes(xt));return Ce&&!dt?-1:!Ce&&dt?1:0}):[...C].sort((q,oe)=>{const Ce=I.indexOf(q.id),dt=I.indexOf(oe.id);return Ce===-1&&dt===-1?0:Ce===-1?1:dt===-1?-1:Ce-dt}),[C,I,T]);b.useEffect(()=>{localStorage.setItem("projectCardSize",w.toString())},[w]);const N=b.useCallback(q=>{const oe=q.map(Ce=>Ce.id);k(oe),localStorage.setItem("projectOrder",JSON.stringify(oe))},[]),[j,O]=b.useState(null),[P,G]=b.useState(null),A=b.useRef(new Map),M=b.useCallback((q,oe)=>{oe?A.current.set(q,oe):A.current.delete(q)},[]),Q=b.useCallback((q,oe,Ce)=>{let dt=null,xt=1/0;return A.current.forEach((it,Rt)=>{if(Rt===Ce)return;const Ot=it.getBoundingClientRect(),Nn=Ot.left+Ot.width/2,$t=Ot.top+Ot.height/2,an=Math.sqrt(Math.pow(q-Nn,2)+Math.pow(oe-$t,2));an<xt&&(xt=an,dt=Rt)}),dt},[]),X=b.useCallback(q=>{if(q.preventDefault(),!j)return;const oe=Q(q.clientX,q.clientY,j);G(oe)},[j,Q]),D=b.useCallback(q=>{if(q.preventDefault(),!j||!P||j===P){O(null),G(null);return}const oe=_.findIndex(Rt=>Rt.id===j),Ce=_.findIndex(Rt=>Rt.id===P);if(oe===-1||Ce===-1){O(null),G(null);return}const dt=[..._],[xt]=dt.splice(oe,1),it=dt.findIndex(Rt=>Rt.id===P);dt.splice(it+1,0,xt),N(dt),O(null),G(null)},[j,P,_,N]),Te=b.useCallback(()=>{O(null),G(null)},[]),xe=async q=>{window.confirm(`
`)&&(await r(q,{status:"deleted"}),p===q&&m(null))},U=async()=>{let q=R==null?void 0:R.id;if(q||(q=await a("project")||void 0),!q){console.error("Failed to create project tag");return}const oe=await o({title:"",tags:[q],status:"todo"});oe&&(await o({title:"",parent_id:oe,status:"todo"}),h(oe))},z=f?t.find(q=>q.id===f):null,ie=n.fontFamily==="things"?"font-things":"font-sans",Be=b.useRef(null),[st,ae]=b.useState(null),[Z,K]=b.useState(null),[de,ce]=b.useState(!1),[ke,_e]=b.useState(""),[ve,Ke]=b.useState(!1),[je,V]=b.useState(!1),[re,se]=b.useState([]),[ne,pe]=b.useState(-1);b.useEffect(()=>{z!=null&&z.ai_history?(se(z.ai_history),pe(z.ai_history.length-1)):(se([]),pe(-1))},[z==null?void 0:z.id,z==null?void 0:z.ai_history]);const ee=b.useMemo(()=>{if(!f)return[];t.filter(dt=>dt.parent_id===f&&dt.status!=="deleted").sort((dt,xt)=>(dt.order_index||0)-(xt.order_index||0));const oe=dt=>t.filter(it=>it.parent_id===dt&&it.status!=="deleted").sort((it,Rt)=>(it.order_index||0)-(Rt.order_index||0)).map(it=>({id:it.id,title:it.title,description:it.description||void 0,start_date:it.start_date,due_date:it.due_date,dependencies:it.dependencies||[],subtasks:oe(it.id)}));return[{id:f,title:(z==null?void 0:z.title)||"Project",start_date:z==null?void 0:z.start_date,due_date:z==null?void 0:z.due_date,description:(z==null?void 0:z.description)||void 0,dependencies:[],subtasks:oe(f)}]},[f,t,z]),ye=async q=>{const oe=$t=>{let an=[];return $t.forEach(Tn=>{an.push(Tn),Tn.subtasks&&(an=an.concat(oe(Tn.subtasks)))}),an},Ce=oe(q),dt=new Set(Ce.map($t=>$t.id).filter(Boolean)),xt=$t=>{const an=t.filter(Ie=>Ie.parent_id===$t&&Ie.status!=="deleted");let Tn=[...an];return an.forEach(Ie=>{Tn=Tn.concat(xt(Ie.id))}),Tn},Rt=xt(f).filter($t=>!dt.has($t.id)).map($t=>$t.id);Rt.length>0&&await d(Rt);const Ot=[];for(const $t of Ce){if(!$t.id||$t.id===f)continue;const an=t.find(mn=>mn.id===$t.id);if(!an)continue;const Tn={};let Ie=!1;$t.start_date!==an.start_date&&(Tn.start_date=$t.start_date,Ie=!0),$t.due_date!==an.due_date&&(Tn.due_date=$t.due_date,Ie=!0);const Dt=$t.dependencies||[],zt=an.dependencies||[],Ft=[...Dt].sort(),qt=[...zt].sort();(Ft.length!==qt.length||!Ft.every((mn,Cr)=>mn===qt[Cr]))&&(Tn.dependencies=$t.dependencies,Ie=!0),Ie&&Ot.push({id:$t.id,data:Tn})}Ot.length>0&&await u(Ot);const Nn=Ce.filter($t=>!$t.id);for(const $t of Nn)await o({title:$t.title||"New Task",parent_id:f,start_date:$t.start_date,due_date:$t.due_date,status:"todo"})},Pe=b.useMemo(()=>{const q=e.find(oe=>oe.name.toLowerCase()==="prompt");return q?t.filter(oe=>oe.tags.includes(q.id)&&oe.status!=="deleted"):[]},[t,e]),me=async q=>{let oe="";if(st&&Be.current?oe=Be.current.state.doc.textBetween(st.from,st.to," "):Be.current?oe=Be.current.getText():oe=((z==null?void 0:z.description)||"").replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),!oe.trim()){alert("");return}V(!0),ce(!0);try{if(ve&&ke.trim()){const it=e.find(Ot=>Ot.name.trim().toLowerCase()==="prompt");let Rt=it==null?void 0:it.id;if(Rt||(Rt=await a("prompt")||void 0),Rt){const Ot=await P5(ke);await o({title:Ot,description:ke,tags:[Rt],status:"active"})}}const Ce=await O5(oe,(z==null?void 0:z.title)||"",q),dt={id:crypto.randomUUID(),role:"assistant",content:Ce.fullResponse,created_at:new Date().toISOString(),prompt:q||"AI Analysis",model:"gemini"},xt=[...re,dt];se(xt),pe(xt.length-1),f&&r(f,{ai_history:xt},[],{skipHistory:!0}),_e("")}catch(Ce){console.error(Ce),alert("AI Error: "+(Ce.message||"Unknown error"))}finally{V(!1)}},Me=q=>{if(Be.current&&st){Be.current.chain().setTextSelection({from:st.from,to:st.to}).unsetHighlight().insertContent(q).run();const oe=Be.current.getHTML();ut(oe),ae(null),ce(!1)}else Be.current&&alert("")},qe=q=>{if(Be.current){Be.current.commands.insertContent(q);const oe=Be.current.getHTML();ut(oe),ce(!1)}},ht=q=>{const oe=re.filter((Ce,dt)=>dt!==q);se(oe),oe.length===0?pe(-1):pe(Math.min(ne,oe.length-1)),f&&r(f,{ai_history:oe},[],{skipHistory:!0})},wt=(q,oe)=>{const Ce=[...re];Ce[q]={...Ce[q],content:oe},se(Ce),f&&r(f,{ai_history:Ce},[],{skipHistory:!0})},[ge,Le]=b.useState(!1),[Ue,De]=b.useState(350),[Qe,pt]=b.useState(!1),[nt,ut]=b.useState(""),[he,we]=b.useState(!1),[Xe,Ze]=b.useState(""),lt=b.useRef(null),Ge=b.useRef(z==null?void 0:z.description);b.useEffect(()=>{if(f){const q=localStorage.getItem(`projectNotesHeight_${f}`);De(q?parseInt(q):350)}},[f]),b.useEffect(()=>{(z==null?void 0:z.description)!==void 0&&z.description!==Ge.current&&(ut(z.description||""),Ge.current=z.description)},[z==null?void 0:z.description]),b.useEffect(()=>{ut((z==null?void 0:z.description)||""),Ge.current=z==null?void 0:z.description,z!=null&&z.description&&Le(!0)},[f]),b.useEffect(()=>{const q=setTimeout(()=>{f&&z&&nt!==z.description&&r(f,{description:nt})},500);return()=>clearTimeout(q)},[nt,f]),b.useEffect(()=>{if(!Qe)return;const q=Ce=>{const dt=Math.max(100,Math.min(800,Ce.clientY-200));De(dt)},oe=()=>{pt(!1),f&&localStorage.setItem(`projectNotesHeight_${f}`,Ue.toString())};return window.addEventListener("mousemove",q),window.addEventListener("mouseup",oe),()=>{window.removeEventListener("mousemove",q),window.removeEventListener("mouseup",oe)}},[Qe,Ue,f]);const[Ct,Y]=b.useState(null);if(b.useEffect(()=>{if(!z){Y(null);return}const q=z.images&&z.images.length>0?z.images[0]:z.cover_image;if(!q){Y(null);return}const oe=new window.Image;oe.crossOrigin="Anonymous",oe.src=q,oe.onload=()=>{try{const Ce=document.createElement("canvas"),dt=Ce.getContext("2d");if(!dt)return;Ce.width=50,Ce.height=50,dt.drawImage(oe,0,0,50,50);const xt=dt.getImageData(0,0,50,50).data,it={};for(let Ot=0;Ot<xt.length;Ot+=4){const Nn=xt[Ot],$t=xt[Ot+1],an=xt[Ot+2];if(xt[Ot+3]<200||Nn>240&&$t>240&&an>240)continue;const Ie=20,Dt=Math.floor(Nn/Ie)*Ie,zt=Math.floor($t/Ie)*Ie,Ft=Math.floor(an/Ie)*Ie,qt=`${Dt},${zt},${Ft}`;it[qt]=(it[qt]||0)+1}const Rt=Object.entries(it).sort(([,Ot],[,Nn])=>Nn-Ot).map(([Ot])=>Ot);if(Rt.length>0){const Ot=Ie=>{const[Dt,zt,Ft]=Ie.split(",").map(Number);return Math.max(Dt,zt,Ft)-Math.min(Dt,zt,Ft)},$t=Rt.slice(0,15).sort((Ie,Dt)=>Ot(Dt)-Ot(Ie)),an=$t[0],Tn=$t[1]||an;Y(`linear-gradient(135deg, rgba(${an}, 0.25) 0%, rgba(${Tn}, 0.2) 100%)`)}else Y(null)}catch(Ce){console.warn("Gradient extraction failed:",Ce),Y(null)}},oe.onerror=()=>Y(null)},[z]),f&&z){const q=Kn[z.color]||Kn.blue,oe=C.find(Ce=>Ce.id===f);return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main",children:[c.jsxs("div",{className:"flex items-center gap-4 px-6 py-4 border-b relative transition-[background] duration-500 bg-theme-header",style:{borderBottomColor:q.color+"30",backgroundImage:Ct||"none"},children:[c.jsx("button",{onClick:()=>{y?(l(y),x(null)):h(null)},className:"p-2 rounded-lg bg-transparent hover:bg-theme-hover text-theme-secondary hover:text-theme-primary transition-colors",title:y?"":"",children:c.jsx(bI,{size:20})}),c.jsx("div",{className:"flex-1 min-w-0",children:he?c.jsx("input",{ref:lt,type:"text",value:Xe,onChange:Ce=>Ze(Ce.target.value),onKeyDown:Ce=>{Ce.key==="Enter"?(Ce.preventDefault(),Xe.trim()&&f&&r(f,{title:Xe.trim()}),we(!1)):Ce.key==="Escape"&&(we(!1),Ze(z.title))},onBlur:()=>{Xe.trim()&&Xe!==z.title&&f&&r(f,{title:Xe.trim()}),we(!1)},className:`text-xl font-bold text-theme-primary ${ie} w-full bg-transparent border-b-2 border-indigo-400 outline-none`,autoFocus:!0}):c.jsx("h1",{className:`text-xl font-bold text-theme-primary ${ie} truncate cursor-pointer hover:text-indigo-600 transition-colors`,onClick:()=>{Ze(z.title),we(!0),setTimeout(()=>{var Ce;return(Ce=lt.current)==null?void 0:Ce.select()},0)},title:"",children:z.title})}),c.jsxs("div",{className:"px-3 py-1 rounded-full text-xs font-bold flex-shrink-0",style:{backgroundColor:q.color+"20",color:q.color},children:[(oe==null?void 0:oe.childCount)||0," "]}),c.jsxs("button",{onClick:()=>s(f),className:"flex items-center gap-1.5 px-3 py-1.5 bg-theme-hover hover:bg-theme-card rounded-lg text-sm text-theme-secondary hover:text-theme-primary transition-colors",title:"",children:[c.jsx(Tw,{size:14}),""]}),c.jsxs("div",{className:"flex items-center gap-1 bg-theme-hover p-0.5 rounded-lg ml-2",children:[c.jsx("button",{onClick:()=>v("list"),className:`p-1.5 rounded-md transition-all ${g==="list"?"bg-white shadow-sm text-indigo-500":"text-gray-400 hover:text-gray-600"}`,title:"",children:c.jsx(w6,{size:16})}),c.jsx("button",{onClick:()=>v("gantt"),className:`p-1.5 rounded-md transition-all ${g==="gantt"?"bg-white shadow-sm text-indigo-500":"text-gray-400 hover:text-gray-600"}`,title:"",children:c.jsx(h6,{size:16})})]})]}),z.description&&c.jsxs("div",{className:"border-b bg-theme-hover",style:{borderBottomColor:q.color+"30"},children:[c.jsx("div",{className:"flex items-center gap-2 px-6 py-1 cursor-pointer hover:bg-theme-card transition-colors",onClick:()=>Le(!ge),children:c.jsx(Rr.div,{animate:{rotate:ge?90:0},transition:{duration:.15},children:c.jsx(ts,{size:16,className:"text-gray-400"})})}),ge&&c.jsxs("div",{className:"relative",children:[c.jsxs("div",{className:"px-6 pb-3 overflow-y-auto custom-scrollbar transition-all duration-200 relative group",style:{height:Ue},onKeyDown:Ce=>Ce.stopPropagation(),children:[c.jsx($v,{onEditorReady:Ce=>{Be.current=Ce},onPolish:(Ce,dt,xt)=>{ae(dt),xt&&K(xt),ce(!0),_e("")},initialContent:nt,onChange:ut,editable:!0,descFontClass:"font-extralight",textSizeClass:"text-sm",className:"min-h-full pb-8 text-theme-secondary"}),c.jsx("button",{onClick:Ce=>{Ce.stopPropagation(),Le(!1)},className:"absolute bottom-2 right-6 p-1.5 rounded-full bg-theme-main/80 hover:bg-theme-hover text-gray-400 hover:text-theme-secondary transition-all opacity-0 group-hover:opacity-100 flex items-center gap-1 text-xs font-medium backdrop-blur-sm z-10 border border-theme shadow-sm",title:"",children:c.jsx(ts,{size:14,className:"-rotate-90"})})]}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1.5 cursor-ns-resize hover:bg-indigo-200 transition-colors group",onMouseDown:()=>pt(!0),children:c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-0 w-8 h-1 rounded-full bg-gray-300 group-hover:bg-indigo-400 transition-colors"})})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden relative",children:g==="list"?c.jsx(bR,{rootParentId:f}):c.jsx("div",{className:"h-full w-full",children:c.jsx(kR,{plan:ee,onUpdatePlan:ye,onEditTask:Ce=>s(Ce)})})}),i===f&&z&&c.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center bg-theme-main/95 backdrop-blur-sm overflow-y-auto pt-20",children:[c.jsx("div",{className:"w-full max-w-3xl px-4 pb-20",children:c.jsx(Ro,{initialData:z,onClose:()=>s(null)})}),c.jsx("button",{onClick:()=>s(null),className:"absolute top-6 right-6 p-2 text-gray-400 hover:text-theme-secondary rounded-full hover:bg-theme-hover transition-colors",children:c.jsx(on,{size:24})})]}),c.jsx(Bee,{isOpen:de,onClose:()=>ce(!1),position:Z||void 0,customPrompt:ke,setCustomPrompt:_e,onRun:me,prompts:Pe,saveToLibrary:ve,setSaveToLibrary:Ke,isLoading:je,history:re,historyIndex:ne,setHistoryIndex:pe,onDeleteHistory:ht,onUpdateHistory:wt,onReplace:Me,onInsert:qe})]})}return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main",children:[c.jsxs("div",{className:"flex items-center justify-between px-6 py-4 bg-theme-header backdrop-blur-sm border-b border-gray-200/50",children:[c.jsxs("div",{children:[c.jsx("h1",{className:`text-xl font-bold text-theme-primary ${ie}`,children:""}),c.jsxs("p",{className:"text-xs text-theme-secondary mt-0.5",children:[C.length," "]})]}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("button",{onClick:U,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg text-sm font-medium transition-colors shadow-sm",children:[c.jsx(d6,{size:16}),""]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(A6,{size:14,className:"text-gray-400"}),c.jsx("input",{type:"range",min:180,max:400,value:w,onChange:q=>S(parseInt(q.target.value)),className:"w-24 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"}),c.jsxs("span",{className:"text-xs text-theme-secondary w-12",children:[w,"px"]})]})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6",onClick:()=>m(null),children:C.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx("div",{className:"w-24 h-24 bg-theme-hover rounded-2xl flex items-center justify-center mb-4",children:c.jsx(nm,{size:40,className:"opacity-30"})}),c.jsx("p",{className:"text-lg font-medium",children:""}),c.jsx("p",{className:"text-sm mt-1",children:"project"})]}):c.jsx(qB,{children:c.jsx("div",{className:"flex flex-wrap gap-5",style:{display:"flex",flexWrap:"wrap",gap:"20px"},onDragOver:X,onDrop:D,children:_.map(q=>c.jsx(Hee,{project:q,size:w,tags:e,isSelected:p===q.id,isDragging:j===q.id,isDropTarget:P===q.id,onSelect:()=>m(q.id),onDoubleClick:()=>h(q.id),onDelete:()=>xe(q.id),onDragStart:()=>O(q.id),onDragEnd:Te,registerRef:M,fontFamilyClass:ie},q.id))})})})]})},Hee=({project:t,size:e,tags:n,isSelected:r,isDragging:s,isDropTarget:i,onSelect:o,onDoubleClick:a,onDragStart:l,onDragEnd:u,registerRef:d,fontFamilyClass:f})=>{const h=Kn[t.color]||Kn.blue,p=b.useMemo(()=>t.tags.some(w=>{const S=n.find(I=>I.id===w);return S&&S.name.includes("")}),[t.tags,n]),m=t.childCount>0?t.completedCount/t.childCount:0,y=10,x=2*Math.PI*y,g=x-m*x,v=w=>{w.dataTransfer.effectAllowed="move",w.dataTransfer.setData("text/plain",t.id),l()};return c.jsx(Rr.div,{layout:!0,layoutId:t.id,transition:{layout:{type:"spring",stiffness:350,damping:25,mass:.8}},ref:w=>d(t.id,w),draggable:!0,onDragStart:v,onDragEnd:u,className:`relative transition-opacity duration-200 ${s?"opacity-50 scale-95":""}`,style:{width:e,...i&&{marginRight:"8px",borderRight:"4px solid #6366f1"}},onDoubleClick:w=>{w.stopPropagation(),a()},children:c.jsx(Rr.div,{onClick:w=>{w.stopPropagation(),s||o()},className:`
                    relative rounded-[20px] overflow-hidden cursor-pointer group flex flex-col
                    bg-white dark:bg-gray-800 
                    shadow-[0_2px_8px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)]
                    border border-gray-100 dark:border-gray-700
                    transition-all duration-300 ease-out
                    ${r?"ring-2 ring-indigo-500 shadow-md":""}
                    ${s?"ring-2 ring-indigo-400":""}
                    ${p?"ring-1 ring-yellow-400/50":""}
                `,style:{height:e*.75},whileHover:s?{}:{y:-4,scale:1.01},children:c.jsxs("div",{className:"p-5 flex flex-col h-full bg-gradient-to-br from-white to-gray-50/50 dark:from-gray-800 dark:to-gray-800/50",children:[c.jsxs("div",{className:"flex justify-between items-start mb-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-lg font-bold shadow-sm",style:{backgroundColor:p?"#fefce8":h.color+"15",color:p?"#ca8a04":h.color},children:p?c.jsx(P6,{size:18}):t.title.charAt(0).toUpperCase()}),c.jsx("div",{className:"relative w-8 h-8 flex items-center justify-center",children:c.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[c.jsx("circle",{cx:"16",cy:"16",r:y,stroke:"currentColor",strokeWidth:"2.5",fill:"none",className:"text-gray-100 dark:text-gray-700"}),c.jsx("circle",{cx:"16",cy:"16",r:y,stroke:h.color,strokeWidth:"2.5",fill:"none",strokeDasharray:x,strokeDashoffset:g,strokeLinecap:"round",className:"transition-all duration-1000 ease-out"})]})})]}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:`font-bold text-[17px] text-gray-800 dark:text-gray-100 leading-tight mb-1 truncate ${f}`,children:t.title}),c.jsxs("p",{className:"text-[11px] font-medium text-gray-400 dark:text-gray-500 uppercase tracking-wide",children:[t.completedCount," / ",t.childCount," Completed"]})]}),c.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:c.jsx("div",{className:"p-1 rounded text-gray-300 hover:text-gray-500",children:c.jsx(CI,{size:14})})})]})})})},Fy=[{id:"learning",label:"",icon:pf,row:0,col:0,color:"from-blue-500 to-cyan-400"},{id:"experience",label:"",icon:s6,row:0,col:1,color:"from-purple-500 to-pink-400"},{id:"leisure",label:"",icon:r6,row:0,col:2,color:"from-green-500 to-emerald-400"},{id:"work",label:"",icon:Qz,row:1,col:0,color:"from-orange-500 to-amber-400"},{id:"core",label:"",icon:$I,row:1,col:1,color:"from-yellow-500 to-orange-400",isCenter:!0},{id:"family",label:"",icon:g6,row:1,col:2,color:"from-rose-500 to-pink-400"},{id:"social",label:"",icon:$6,row:2,col:0,color:"from-indigo-500 to-blue-400"},{id:"finance",label:"",icon:z6,row:2,col:1,color:"from-emerald-500 to-teal-400"},{id:"health",label:"",icon:tm,row:2,col:2,color:"from-red-500 to-rose-400"}],Vee=()=>{const{tasks:t,tags:e,themeSettings:n,setView:r}=b.useContext(_n),[s,i]=b.useState(null),o=b.useMemo(()=>e.filter(h=>h.name.includes("")).map(h=>h.id),[e]),a=b.useMemo(()=>{const h={};return Fy.forEach(p=>{h[p.id]=e.filter(m=>m.name.includes(p.label)).map(m=>m.id)}),h},[e]),l=b.useMemo(()=>{const h=e.find(p=>p.name.toLowerCase()==="project");return h?t.filter(p=>{var m,y;return p.status!=="deleted"&&((m=p.tags)==null?void 0:m.includes(h.id))&&((y=p.tags)==null?void 0:y.some(x=>o.includes(x)))}).map(p=>({id:p.id,title:p.title,color:p.color||"blue",tags:p.tags||[]})):[]},[t,e,o]),u=b.useMemo(()=>{const h={};return Fy.forEach(p=>{h[p.id]=l.filter(m=>m.tags.some(y=>{var x;return(x=a[p.id])==null?void 0:x.includes(y)}))}),h},[l,a]),d=n.fontFamily==="things"?"font-things":"font-sans",f=h=>{localStorage.setItem("openProjectId",h),localStorage.setItem("previousView","annualplan"),r("project")};return c.jsxs("div",{className:"flex flex-col h-full bg-theme-main",children:[c.jsx("div",{className:"flex items-center justify-between px-6 py-4 bg-theme-header backdrop-blur-sm border-b border-gray-200/50",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-xl shadow-lg",children:c.jsx(zI,{size:24,className:"text-white"})}),c.jsxs("div",{children:[c.jsx("h1",{className:`text-xl font-bold text-theme-primary ${d}`,children:""}),c.jsxs("p",{className:"text-xs text-theme-tertiary",children:[l.length," "]})]})]})}),c.jsx("div",{className:"flex-1 p-6 overflow-auto",onClick:()=>i(null),children:c.jsx("div",{className:"grid grid-cols-3 gap-4 h-full max-w-5xl mx-auto",children:Fy.map(h=>{const p=h.icon,m=u[h.id]||[];return c.jsxs(Rr.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:h.row*.1+h.col*.05},className:`
                                    relative rounded-2xl overflow-hidden
                                    bg-theme-card shadow-lg
                                    border border-gray-200/50 dark:border-gray-700/50
                                    ${h.isCenter?"ring-2 ring-yellow-400/50 shadow-yellow-100/30":""}
                                `,children:[c.jsxs("div",{className:`
                                    px-3 py-2 bg-gradient-to-r ${h.color}
                                    flex items-center gap-2
                                `,children:[c.jsx(p,{size:16,className:"text-white/90"}),c.jsx("span",{className:"text-sm font-bold text-white/95 drop-shadow-sm",children:h.label})]}),c.jsx("div",{className:"p-2 space-y-1 max-h-[calc(100%-40px)] overflow-y-auto",children:m.length===0?c.jsx("div",{className:"text-center py-4 text-theme-tertiary text-xs",children:""}):m.map(y=>{const x=Kn[y.color]||Kn.blue,g=s===y.id;return c.jsx(Rr.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:v=>{v.stopPropagation(),i(y.id)},onDoubleClick:v=>{v.stopPropagation(),f(y.id)},className:`
                                                        px-3 py-2 rounded-lg cursor-pointer
                                                        transition-all duration-150
                                                        ${g?"bg-indigo-100 dark:bg-indigo-900/30 ring-2 ring-indigo-500":"hover:bg-theme-hover"}
                                                    `,style:{borderLeft:`3px solid ${x.color}`},children:c.jsx("p",{className:`text-sm font-medium text-theme-primary line-clamp-2 ${d}`,children:y.title})},y.id)})}),m.length>0&&c.jsx("div",{className:"absolute top-2 right-2 px-2 py-0.5 bg-white/90 dark:bg-gray-800/90 rounded-full text-[10px] font-bold text-gray-600 dark:text-gray-300 shadow-sm",children:m.length})]},h.id)})})})]})},Wee=()=>{const{advancedFilters:t,setAdvancedFilters:e,tags:n,tagFilter:r}=b.useContext(_n);if(!r)return null;const s=n.filter(l=>{let u=l;for(;u.parent_id;){if(u.parent_id===r)return!0;u=n.find(d=>d.id===u.parent_id)||{parent_id:null}}return!1}),i=l=>{l&&e(u=>({...u,additionalTags:u.additionalTags.includes(l)?u.additionalTags.filter(d=>d!==l):[...u.additionalTags,l]}))},o=()=>{e({additionalTags:[],startDate:null,dueDate:null,color:null})},a=t.additionalTags.length>0;return c.jsxs("div",{className:"px-8 py-3 border-b border-gray-50 bg-gray-50/30 flex items-center gap-4 relative z-20",children:[c.jsx("div",{className:"flex items-center gap-2",children:c.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Filters:"})}),c.jsx(N1,{icon:Ol,label:"Sub-tags",items:s,selectedIds:t.additionalTags,onSelect:i,multiSelect:!0,placeholder:"Filter by sub-tags..."}),a&&c.jsxs("button",{onClick:o,className:"ml-auto flex items-center gap-1 text-[10px] text-gray-400 hover:text-red-500 transition-colors",children:[c.jsx(on,{size:12})," Clear"]})]})},Kee=({toast:t,onClose:e})=>{const[n,r]=b.useState(!1);b.useEffect(()=>{requestAnimationFrame(()=>r(!0));const a=setTimeout(()=>{r(!1),setTimeout(e,300)},1e4);return()=>clearTimeout(a)},[t,e]);const s=()=>t.type==="error"?c.jsx(Vf,{size:16}):t.undo?c.jsx(Zz,{size:16}):c.jsx(EI,{size:16}),i=()=>{t.onClick&&(t.onClick(),e())},o=a=>{a.stopPropagation(),r(!1),setTimeout(e,300)};return c.jsx("div",{className:`
                fixed top-4 left-1/2 -translate-x-1/2 z-[9999]
                transition-all duration-300 ease-out
                ${n?"opacity-100 translate-y-0":"opacity-0 -translate-y-4"}
            `,children:c.jsxs("div",{className:`
                    px-4 py-2.5 rounded-full shadow-lg flex items-center gap-3 backdrop-blur-md
                    ${t.type==="error"?"bg-red-500/90 text-white":"bg-gray-900/90 text-white"}
                    ${t.onClick?"cursor-pointer hover:bg-gray-800/95 transition-colors":""}
                `,onClick:t.onClick?i:void 0,children:[c.jsxs("div",{className:"flex items-center gap-2",children:[s(),c.jsx("span",{className:"text-sm font-medium",children:t.msg})]}),t.onClick&&!t.undo&&c.jsxs("div",{className:"flex items-center gap-1 text-xs text-white/70",children:[c.jsx(_I,{size:12}),c.jsx("span",{children:t.actionLabel||""})]}),t.undo&&c.jsxs("button",{onClick:a=>{var l;a.stopPropagation(),(l=t.undo)==null||l.call(t),e()},className:"flex items-center gap-1 px-2.5 py-1 bg-white/20 hover:bg-white/30 rounded-full text-xs font-bold transition-colors",children:[c.jsx(OI,{size:12}),"Undo"]}),c.jsx("button",{onClick:o,className:"p-1 -mr-1.5 rounded-full hover:bg-white/20 transition-colors",title:"",children:c.jsx(on,{size:14})})]})})},SR=t=>t.map(e=>({...e,id:e.id||crypto.randomUUID(),subtasks:e.subtasks?SR(e.subtasks):[]})),Gee=({taskId:t,onClose:e})=>{const{tasks:n,tags:r,batchAddTasks:s,setToast:i}=b.useContext(_n),[o,a]=b.useState("prompt"),[l,u]=b.useState(null),[d,f]=b.useState(null),[h,p]=b.useState(!1),[m,y]=b.useState(""),[x,g]=b.useState(""),[v,w]=b.useState("list"),[S,I]=b.useState([]),[k,R]=b.useState(-1);b.useEffect(()=>{l&&S.length===0&&(I([l]),R(0))},[l]);const C=M=>{const Q=S.slice(0,k+1);Q.push(M),I(Q),R(Q.length-1),u(M)},T=()=>{if(k>0){const M=k-1;R(M),u(S[M])}},_=()=>{if(k<S.length-1){const M=k+1;R(M),u(S[M])}};b.useEffect(()=>{const M=Q=>{(Q.metaKey||Q.ctrlKey)&&Q.key==="z"&&(Q.preventDefault(),Q.stopPropagation(),Q.shiftKey?_():T())};return window.addEventListener("keydown",M,{capture:!0}),()=>window.removeEventListener("keydown",M,{capture:!0})},[k,S]);const N=n.find(M=>M.id===t),j=b.useMemo(()=>{const M=r.find(Q=>Q.name.trim().toLowerCase()==="prompt");return M?n.filter(Q=>Q.tags.includes(M.id)&&Q.status!=="deleted"&&Q.status!=="logged").sort((Q,X)=>X.created_at.localeCompare(Q.created_at)):[]},[n,r]),O=b.useMemo(()=>{if(!x.trim())return j.slice(0,10);const M=x.toLowerCase();return j.filter(Q=>Q.title.toLowerCase().includes(M)||(Q.description||"").toLowerCase().includes(M)).slice(0,10)},[j,x]),P=async()=>{if(!N){f("Task not found"),a("error");return}a("loading");try{const M=new Date().toISOString().split("T")[0],Q=new Date,X=new Date;X.setDate(X.getDate()+14);const D=n.filter(ie=>ie.status!=="deleted"&&ie.status!=="completed"&&ie.status!=="logged").filter(ie=>{const Be=ie.start_date||ie.due_date;if(!Be)return!1;const st=new Date(Be);return st>=Q&&st<=X}).map(ie=>{var Be,st;return`- ${((Be=ie.start_date)==null?void 0:Be.split("T")[0])||((st=ie.due_date)==null?void 0:st.split("T")[0])}: ${ie.title}`}).slice(0,20),Te=N.title.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g,"").match(/.{1,2}/g)||[],xe=n.filter(ie=>ie.status==="completed"||ie.status==="logged").map(ie=>{let Be=0;return Te.forEach(st=>{ie.title.includes(st)&&Be++}),{task:ie,score:Be}}).filter(ie=>ie.score>0).sort((ie,Be)=>Be.score-ie.score).slice(0,5).map(ie=>`- [] ${ie.task.title}: ${ie.task.description||"()"}`),U=await EJ(N.title,N.description||"",N.start_date||null,N.due_date||null,{today:M,existingSchedule:D,pastExperiences:xe},m||void 0),z=SR(U);u(z),I([z]),R(0),a("preview")}catch(M){console.error(M),f(M.message||"Failed to generate plan"),a("error")}},G=async()=>{if(l){p(!0);try{await s(l,t),i({msg:"72",type:"info"}),e()}catch(M){i({msg:""+M.message,type:"error"}),p(!1)}}},A=(M,Q,X)=>{if(!l)return;const D=JSON.parse(JSON.stringify(l));let Te=D;for(let xe=0;xe<M.length-1;xe++)Te=Te[M[xe]].subtasks;Te[M[M.length-1]][Q]=X,C(D)};return o==="prompt"?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-xl max-h-[80vh] flex flex-col animate-in slide-in-from-bottom-10 duration-200",children:[c.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-2xl",children:""}),c.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"72"})]}),c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 rounded-full p-1 hover:bg-gray-100",children:c.jsx(on,{size:20})})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-6 flex flex-col gap-4",children:[c.jsx("div",{className:"bg-indigo-50 p-3 rounded-lg border border-indigo-100",children:c.jsxs("p",{className:"text-sm text-indigo-700",children:["",c.jsx("strong",{children:N==null?void 0:N.title})]})}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),c.jsx("textarea",{value:m,onChange:M=>y(M.target.value),placeholder:"...",className:"w-full border border-gray-200 rounded-lg p-3 text-sm focus:ring-2 focus:ring-indigo-200 focus:border-indigo-400 resize-none",rows:3})]}),j.length>0&&c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),c.jsx("input",{type:"text",value:x,onChange:M=>g(M.target.value),placeholder:"...",className:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm mb-2 focus:ring-2 focus:ring-indigo-200 focus:border-indigo-400"}),c.jsx("div",{className:"flex flex-col gap-1 max-h-40 overflow-y-auto",children:O.map(M=>c.jsxs("button",{onClick:()=>y(M.description||M.title),className:"text-left p-2 rounded-lg hover:bg-gray-50 border border-gray-100 text-sm transition-colors",children:[c.jsx("span",{className:"font-medium text-gray-800",children:M.title}),M.description&&c.jsxs("p",{className:"text-xs text-gray-500 line-clamp-1 mt-0.5",children:[M.description.slice(0,80),"..."]})]},M.id))})]})]}),c.jsxs("div",{className:"px-6 py-4 border-t bg-white flex justify-end gap-3",children:[c.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:""}),c.jsxs("button",{onClick:P,className:"px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg flex items-center gap-2",children:[c.jsx(s1,{size:18}),""]})]})]})}):o==="loading"?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/30 backdrop-blur-sm",children:c.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 flex flex-col items-center gap-4 animate-in zoom-in duration-200",children:[c.jsx(Hi,{className:"w-12 h-12 text-indigo-600 animate-spin"}),c.jsx("p",{className:"text-lg font-medium text-gray-700",children:"72..."}),c.jsx("p",{className:"text-sm text-gray-500",children:""})]})}):o==="error"?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/30 backdrop-blur-sm",children:c.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 w-[400px] flex flex-col gap-4",children:[c.jsxs("div",{className:"flex items-center gap-3 text-red-600",children:[c.jsx(Vf,{size:24}),c.jsx("h3",{className:"text-lg font-bold",children:""})]}),c.jsx("p",{className:"text-gray-600",children:d}),c.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[c.jsx("button",{onClick:()=>a("prompt"),className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700",children:""}),c.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700",children:""})]})]})}):c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col animate-in slide-in-from-bottom-10 duration-200",children:[c.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between sticky top-0 bg-white rounded-t-xl z-10",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-2xl",children:""}),c.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"72"})]}),c.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg",children:[c.jsx("button",{onClick:()=>w("list"),className:`px-3 py-1.5 text-sm rounded-md transition-all ${v==="list"?"bg-white shadow-sm text-indigo-600 font-medium":"text-gray-500 hover:text-gray-700"}`,children:""}),c.jsx("button",{onClick:()=>w("gantt"),className:`px-3 py-1.5 text-sm rounded-md transition-all ${v==="gantt"?"bg-white shadow-sm text-indigo-600 font-medium":"text-gray-500 hover:text-gray-700"}`,children:""})]})]}),c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 rounded-full p-1 hover:bg-gray-100",children:c.jsx(on,{size:20})})]}),c.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50/50 flex flex-col",children:v==="list"?c.jsxs("div",{className:"p-6",children:[c.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg border border-indigo-100 mb-4",children:[c.jsx("h3",{className:"font-bold text-indigo-900 mb-1",children:N==null?void 0:N.title}),c.jsx("p",{className:"text-sm text-indigo-700",children:"AI"})]}),c.jsx("div",{className:"flex flex-col gap-3",children:l==null?void 0:l.map((M,Q)=>c.jsx(_R,{item:M,path:[Q],onUpdate:A},Q))})]}):c.jsx("div",{className:"flex-1 min-h-[500px] flex flex-col",children:l&&c.jsx(kR,{plan:l,onUpdatePlan:C})})}),c.jsxs("div",{className:"px-6 py-4 border-t bg-white rounded-b-xl flex justify-between sticky bottom-0 z-10",children:[c.jsxs("button",{onClick:()=>a("prompt"),className:"px-4 py-2 text-gray-500 hover:bg-gray-100 rounded-lg flex items-center gap-1",children:[c.jsx(Eg,{size:16})," "]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:e,className:"px-5 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",disabled:h,children:""}),c.jsxs("button",{onClick:G,disabled:h,className:"px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg shadow-sm flex items-center gap-2 disabled:opacity-70",children:[h?c.jsx(Hi,{className:"animate-spin",size:18}):c.jsx(tr,{size:18}),h?"...":""]})]})]})]})})},_R=({item:t,path:e,depth:n=0,onUpdate:r})=>{const[s,i]=b.useState(!0),o=t.subtasks&&t.subtasks.length>0;return c.jsxs("div",{className:"flex flex-col",children:[c.jsx("div",{className:`p-3 bg-white rounded-lg border border-gray-100 shadow-sm ${n>0?"ml-6":""}`,children:c.jsxs("div",{className:"flex items-start gap-2",children:[o?c.jsx("button",{onClick:()=>i(!s),className:"mt-1 text-gray-400 hover:text-gray-600",children:s?c.jsx(ds,{size:14}):c.jsx(ts,{size:14})}):c.jsx("div",{className:"w-[14px] mt-1"}),c.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[c.jsx("input",{type:"text",value:t.title,onChange:a=>r(e,"title",a.target.value),className:"font-medium text-gray-800 bg-transparent border-b border-transparent hover:border-gray-200 focus:border-indigo-400 focus:outline-none px-1 py-0.5 w-full",placeholder:""}),c.jsxs("div",{className:"flex items-start gap-1",children:[c.jsx(Wf,{size:12,className:"text-gray-400 mt-1 flex-shrink-0"}),c.jsx("textarea",{value:t.description||"",onChange:a=>r(e,"description",a.target.value),placeholder:"...",className:"text-sm text-gray-600 bg-gray-50 border border-gray-100 rounded px-2 py-1 w-full resize-none focus:border-indigo-300 focus:outline-none",rows:2})]}),c.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(Go,{size:12,className:"text-gray-400"}),c.jsx("span",{className:"text-gray-500",children:":"}),c.jsx("input",{type:"date",value:t.start_date||"",onChange:a=>r(e,"start_date",a.target.value),className:"border border-gray-200 rounded px-1 py-0.5 text-xs focus:border-indigo-400 focus:outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("span",{className:"text-gray-500",children:":"}),c.jsx("input",{type:"date",value:t.due_date||"",onChange:a=>r(e,"due_date",a.target.value),className:"border border-gray-200 rounded px-1 py-0.5 text-xs focus:border-indigo-400 focus:outline-none"})]})]})]})]})}),o&&s&&c.jsx("div",{className:"flex flex-col gap-2 mt-2 pl-6 relative",children:t.subtasks.map((a,l)=>c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"absolute left-[-12px] top-[-14px] bottom-[20px] w-px bg-gray-200 -z-10"}),c.jsx("div",{className:"absolute left-[-12px] top-[26px] w-[12px] h-px bg-gray-200 -z-10"}),c.jsx(_R,{item:a,path:[...e,l],depth:n+1,onUpdate:r})]},l))})]})},pb=({onClose:t,initialData:e})=>{const n=!!e,[r,s]=An.useState({});return An.useEffect(()=>{if(!window.visualViewport)return;const i=()=>{window.visualViewport&&(window.innerWidth<768?s({height:`${window.visualViewport.height}px`,top:`${window.visualViewport.offsetTop}px`,position:"fixed",bottom:"auto"}):s({}))};return window.visualViewport.addEventListener("resize",i),window.visualViewport.addEventListener("scroll",i),i(),()=>{var o,a;(o=window.visualViewport)==null||o.removeEventListener("resize",i),(a=window.visualViewport)==null||a.removeEventListener("scroll",i)}},[]),c.jsx("div",{className:"fixed inset-0 z-[60] flex items-end md:items-center justify-center pointer-events-auto bg-black/20 md:bg-transparent",onClick:t,style:r,children:c.jsxs(Rr.div,{onClick:i=>i.stopPropagation(),drag:window.innerWidth>=768,dragMomentum:!1,dragElastic:.1,initial:{opacity:0,scale:.95,y:50},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:50},transition:{type:"spring",stiffness:300,damping:30},className:"bg-theme-card backdrop-blur-xl rounded-t-2xl md:rounded-2xl shadow-2xl w-full md:max-w-[600px] overflow-visible border border-theme ring-1 ring-black/5 flex flex-col max-h-[90vh] md:max-h-none",children:[c.jsx("div",{className:"md:hidden flex justify-center pt-2 pb-1",children:c.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full"})}),c.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-theme-header border-b border-theme cursor-grab active:cursor-grabbing backdrop-blur-sm select-none md:rounded-t-2xl",onPointerDown:i=>i.preventDefault(),children:[c.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[c.jsx(TI,{size:14,className:"text-gray-300 hidden md:block"}),c.jsx("span",{className:"text-xs md:text-[10px] font-bold uppercase tracking-widest text-theme-tertiary",children:n?"Edit Task":"New Task"})]}),c.jsxs("button",{onClick:t,className:"w-8 h-8 md:w-7 md:h-7 flex items-center justify-center hover:bg-gray-200/80 rounded-full text-gray-400 hover:text-gray-600 transition-colors bg-gray-100/50",onPointerDown:i=>i.stopPropagation(),children:[c.jsx(on,{size:16,className:"md:hidden"}),c.jsx(on,{size:14,className:"hidden md:block"})]})]}),c.jsx("div",{className:"p-0 overflow-auto",children:c.jsx(Ro,{initialData:e,onClose:t,isQuickAdd:!n,autoFocus:!n,isEmbedded:!0})})]})})},lE=({taskId:t,onClose:e})=>{const{tasks:n,tags:r,updateTask:s,addTask:i,addTag:o,deleteTask:a,toggleExpansion:l,setToast:u,user:d}=b.useContext(_n),{isRecording:f,startRecording:h,stopRecording:p,recordingTaskId:m}=b.useContext(Iu),y=n.find(Y=>Y.id===t),[x,g]=b.useState((y==null?void 0:y.title)||""),[v,w]=b.useState((y==null?void 0:y.description)||""),[S,I]=b.useState((y==null?void 0:y.start_date)||""),[k,R]=b.useState((y==null?void 0:y.due_date)||""),[C,T]=b.useState((y==null?void 0:y.tags)||[]),[_,N]=b.useState((y==null?void 0:y.parent_id)||null),[j,O]=b.useState((y==null?void 0:y.color)||"blue"),[P,G]=b.useState((y==null?void 0:y.importance)||"unplanned"),[A,M]=b.useState((y==null?void 0:y.repeat_rule)||null),[Q,X]=b.useState((y==null?void 0:y.images)||[]),[D,Te]=b.useState((y==null?void 0:y.attachments)||[]),[xe,U]=b.useState((y==null?void 0:y.is_all_day)!==!1),[z,ie]=b.useState(()=>{if(y!=null&&y.start_time)return y.start_time;if(y!=null&&y.start_date&&!(y!=null&&y.is_all_day)){const Y=new Date(y.start_date);return`${String(Y.getHours()).padStart(2,"0")}:${String(Y.getMinutes()).padStart(2,"0")}`}return"09:00"}),[Be,st]=b.useState(()=>{if(t)try{const Y=localStorage.getItem(`task_reminder_${t}`);if(Y!==null)return JSON.parse(Y)}catch{}return(y==null?void 0:y.reminder_minutes)??null}),[ae,Z]=b.useState(null),[K,de]=b.useState(!1),[ce,ke]=b.useState(!1),[_e,ve]=b.useState(!1),[Ke,je]=b.useState(!1),[V,re]=b.useState(""),[se,ne]=b.useState(!1),pe=b.useRef(null),[ee,ye]=b.useState(!1),[Pe,me]=b.useState(null),[Me,qe]=b.useState(()=>{if(S){const Y=new Date(S);return new Date(Y.getFullYear(),Y.getMonth(),1)}return new Date(new Date().getFullYear(),new Date().getMonth(),1)}),[ht,wt]=b.useState(null),ge=b.useRef(null),Le=b.useRef(null),Ue=b.useRef(null),De=b.useRef(null),Qe=b.useRef(null);if(b.useEffect(()=>{const Y=setTimeout(()=>ke(!0),100);return()=>clearTimeout(Y)},[]),b.useEffect(()=>{y?(g(y.title||""),w((y==null?void 0:y.description)||""),I(y.start_date||""),R(y.due_date||""),T(y.tags||[]),N(y.parent_id||null),O(y.color||"blue"),G(y.importance||"unplanned"),M(y.repeat_rule||null),X(y.images||[]),Te(y.attachments||[])):t||(g(""),w(""),I(""),R(""),T([]),N(null),O("blue"),G("unplanned"),M(null),X([]),Te([]))},[y,t]),b.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]),b.useEffect(()=>{if(!t&&ce&&Le.current){const Y=()=>{if(Le.current){window.scrollTo(0,0);const q=document.querySelector(".mobile-task-editor-content");q&&(q.scrollTop=0),Le.current.focus({preventScroll:!0}),Le.current.click()}};Y(),setTimeout(Y,100),setTimeout(Y,300)}},[t,ce]),t&&!y)return null;const pt=async()=>{if(console.log("[MobileTaskEditor] handleSave called, title:",x),!x.trim()){u==null||u({msg:"",type:"error"});return}try{let Y=S||null;S&&!xe&&z&&(Y=`${S.split("T")[0]}T${z}:00`);const q={title:x.trim(),description:v,start_date:Y,due_date:k||null,tags:C,parent_id:_,color:_?void 0:j,importance:P,repeat_rule:A,images:Q,attachments:D,is_all_day:xe,start_time:xe?null:z,reminder_minutes:Be};if(console.log("[MobileTaskEditor] taskData:",q),console.log("[MobileTaskEditor] taskId:",t),console.log("[MobileTaskEditor] addTask function:",typeof i),t)await s(t,q),_&&l(_,!0);else{const oe=await i({...q,status:"inbox"},[]);if(console.log("[MobileTaskEditor] addTask returned:",oe),!oe){console.error("[MobileTaskEditor] addTask returned empty - check supabaseClient"),u==null||u({msg:"",type:"error"});return}}u==null||u({msg:"",type:"info"}),e()}catch(Y){console.error("[MobileTaskEditor] Save failed:",Y),console.error("[MobileTaskEditor] Error details:",Y==null?void 0:Y.message,Y==null?void 0:Y.stack),u==null||u({msg:`: ${(Y==null?void 0:Y.message)||""}`,type:"error"})}},nt=()=>{t&&(a(t),u==null||u({msg:"",type:"info"})),e()},ut=Y=>{if(!Y)return"";const q=new Date(Y),oe=new Date,Ce=new Date(oe);return Ce.setDate(Ce.getDate()+1),q.toDateString()===oe.toDateString()?"":q.toDateString()===Ce.toDateString()?"":q.toLocaleDateString("zh-TW",{month:"short",day:"numeric",weekday:"short"})},he=Y=>{const q=Y.getFullYear(),oe=String(Y.getMonth()+1).padStart(2,"0"),Ce=String(Y.getDate()).padStart(2,"0");return`${q}-${oe}-${Ce}`},we={urgent:{label:"",color:"bg-red-500",text:"text-red-600",bg:"bg-red-50"},planned:{label:"",color:"bg-amber-500",text:"text-amber-600",bg:"bg-amber-50"},delegated:{label:"",color:"bg-green-500",text:"text-green-600",bg:"bg-green-50"},unplanned:{label:"",color:"bg-gray-400",text:"text-gray-500",bg:"bg-gray-50"}},Xe=Y=>{ce&&Ue.current&&!Ue.current.contains(Y.target)&&e()},Ze=async(Y,q)=>{const oe=Y.target.files;if(!oe||oe.length===0||!d||!Ne)return;ve(!0);const Ce=oe[0];try{const dt=`${Date.now()}_${Iz()}.${Ce.name.split(".").pop()}`,it=`${d.id}/${dt}`,{error:Rt}=await Ne.storage.from("attachments").upload(it,Ce,{contentType:Ce.type,upsert:!1});if(Rt)throw Rt;const{data:Ot}=Ne.storage.from("attachments").getPublicUrl(it);if(Ot){const Nn={name:Ce.name,url:Ot.publicUrl,size:Ce.size,type:Ce.type};if(q){if(X($t=>[...$t,Ot.publicUrl]),t){const $t=(y==null?void 0:y.images)||[];await s(t,{images:[...$t,Ot.publicUrl]},[],{skipHistory:!0})}u==null||u({msg:"",type:"info"})}else{if(Te($t=>[...$t,Nn]),t){const $t=(y==null?void 0:y.attachments)||[];await s(t,{attachments:[...$t,Nn]},[],{skipHistory:!0})}u==null||u({msg:"",type:"info"})}}}catch(dt){console.error(dt),u==null||u({msg:"",type:"error"})}finally{ve(!1),Y.target&&(Y.target.value="")}},lt=async(Y,q)=>{if(confirm("")){if(q){if(X(oe=>oe.filter(Ce=>Ce!==Y)),t){const oe=(y==null?void 0:y.images)||[];await s(t,{images:oe.filter(Ce=>Ce!==Y)},[],{skipHistory:!0})}}else if(Te(oe=>oe.filter(Ce=>Ce.url!==Y)),t){const oe=(y==null?void 0:y.attachments)||[];await s(t,{attachments:oe.filter(Ce=>Ce.url!==Y)},[],{skipHistory:!0})}}},Ge=Y=>{if(ht===Y&&ge.current)ge.current.paused?ge.current.play():(ge.current.pause(),wt(null));else{ge.current&&ge.current.pause();const q=new Audio(Y);q.onended=()=>wt(null),ge.current=q,q.play(),wt(Y)}},Ct=c.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-end justify-center",onMouseDown:Xe,style:{touchAction:"none"},children:[c.jsx("div",{className:"absolute inset-0 bg-black/40"}),c.jsxs(Rr.div,{ref:Ue,initial:{y:"100%"},animate:{y:0},transition:{type:"spring",damping:25,stiffness:300},onMouseDown:Y=>Y.stopPropagation(),onTouchStart:Y=>Y.stopPropagation(),className:"relative w-full bg-white rounded-t-3xl max-h-[95vh] flex flex-col overflow-hidden shadow-2xl",children:[c.jsx("div",{className:"flex justify-center pt-3 pb-2 flex-shrink-0",children:c.jsx("div",{className:"w-10 h-1.5 bg-gray-300 rounded-full"})}),c.jsxs("div",{className:"flex items-center justify-between px-5 pb-3 border-b border-gray-100 flex-shrink-0",children:[c.jsx("button",{type:"button",onClick:e,className:"text-gray-500 p-2 -ml-2 active:bg-gray-100 rounded-full",children:c.jsx(on,{size:24})}),f&&m===t?c.jsxs("div",{className:"flex items-center gap-2 text-red-500 animate-pulse font-medium",children:[c.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),"..."]}):c.jsx("h2",{className:"text-lg font-bold text-gray-800",children:t?"":""}),c.jsx("button",{type:"button",onClick:pt,className:"px-4 py-2 bg-indigo-600 text-white rounded-full font-bold text-sm active:bg-indigo-700",children:""})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-5 scroll-smooth mobile-task-editor-content pb-24",children:[c.jsxs("div",{className:"mb-6 relative",children:[c.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 block",children:""}),c.jsx("textarea",{ref:Le,autoFocus:!t,rows:1,name:`task_title_no_autofill_${Math.random()}`,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",value:x,onChange:Y=>{g(Y.target.value),ne(Y.target.value.length>0),Y.target.style.height="auto",Y.target.style.height=Y.target.scrollHeight+"px"},onKeyDown:Y=>{var q;Y.key==="Enter"&&(Y.preventDefault(),(q=Le.current)==null||q.blur())},onFocus:()=>ne(x.length>0),onBlur:()=>setTimeout(()=>ne(!1),200),placeholder:"...",className:"w-full text-xl font-medium text-gray-800 border-none outline-none bg-transparent placeholder-gray-300 p-0 resize-none overflow-hidden",style:{minHeight:"28px"}}),se&&x.length>0&&(()=>{const Y=n.filter(q=>q.id!==t&&q.title&&q.title.toLowerCase().includes(x.toLowerCase())&&q.title.toLowerCase()!==x.toLowerCase()).map(q=>q.title).filter((q,oe,Ce)=>Ce.indexOf(q)===oe).slice(0,5);return Y.length===0?null:c.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white rounded-xl shadow-lg border border-gray-200 z-50 overflow-hidden",children:Y.map((q,oe)=>c.jsx("button",{type:"button",onMouseDown:Ce=>{Ce.preventDefault(),g(q),ne(!1)},className:"w-full text-left px-4 py-3 text-gray-700 hover:bg-indigo-50 border-b border-gray-100 last:border-b-0 transition-colors",children:q},oe))})})()]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-6",children:[c.jsxs("button",{type:"button",onClick:()=>Z(ae==="date"?null:"date"),className:`flex flex-col items-center justify-center p-3 rounded-2xl border transition-all ${ae==="date"||S?"border-indigo-500 bg-indigo-50":"border-gray-200 bg-white"}`,children:[c.jsx(Go,{size:20,className:S?"text-indigo-600":"text-gray-400"}),c.jsx("span",{className:`text-[10px] mt-1.5 font-bold truncate w-full ${S?"text-indigo-600":"text-gray-500"}`,children:S?ut(S):""})]}),c.jsxs("button",{type:"button",onClick:()=>je(!0),className:`flex flex-col items-center justify-center p-3 rounded-2xl border transition-all ${Ke||C.length>0?"border-purple-500 bg-purple-50":"border-gray-200 bg-white"}`,children:[c.jsx(Jz,{size:20,className:C.length>0?"text-purple-600":"text-gray-400"}),c.jsx("span",{className:`text-[10px] mt-1.5 font-bold truncate w-full ${C.length>0?"text-purple-600":"text-gray-500"}`,children:C.length>0?`${C.length} `:""})]})]}),ae==="date"&&c.jsxs("div",{className:"bg-gray-50 rounded-2xl p-4 space-y-4 mb-6 animate-in slide-in-from-top-2",children:[c.jsxs("div",{className:"flex gap-2 flex-wrap",children:[c.jsx("button",{type:"button",onClick:()=>I(he(new Date)),className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${S===he(new Date)?"bg-indigo-600 text-white":"bg-white border border-gray-200 text-gray-700"}`,children:""}),c.jsx("button",{type:"button",onClick:()=>{const Y=new Date;Y.setDate(Y.getDate()+1),I(he(Y))},className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${(()=>{const Y=new Date;return Y.setDate(Y.getDate()+1),S===he(Y)})()?"bg-indigo-600 text-white":"bg-white border border-gray-200 text-gray-700"}`,children:""}),c.jsx("button",{type:"button",onClick:()=>I(""),className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${S?"bg-white border border-gray-200 text-gray-700":"bg-gray-600 text-white"}`,children:""})]}),c.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[c.jsxs("div",{className:"flex items-center justify-between p-2 border-b border-gray-100",children:[c.jsx("button",{type:"button",onClick:()=>qe(new Date(Me.getFullYear(),Me.getMonth()-1,1)),className:"p-2 hover:bg-gray-100 rounded-lg",children:c.jsx(Du,{size:18,className:"text-gray-600"})}),c.jsxs("span",{className:"text-sm font-bold text-gray-700",children:[Me.getFullYear()," ",Me.getMonth()+1,""]}),c.jsx("button",{type:"button",onClick:()=>qe(new Date(Me.getFullYear(),Me.getMonth()+1,1)),className:"p-2 hover:bg-gray-100 rounded-lg",children:c.jsx(ts,{size:18,className:"text-gray-600"})})]}),c.jsx("div",{className:"grid grid-cols-7 text-center text-[10px] font-bold text-gray-400 py-1 border-b border-gray-50",children:"".split("").map(Y=>c.jsx("div",{children:Y},Y))}),c.jsx("div",{className:"grid grid-cols-7 gap-px bg-gray-100 p-px",children:(()=>{const Y=new Date(Me.getFullYear(),Me.getMonth(),1),q=new Date(Me.getFullYear(),Me.getMonth()+1,0),oe=Y.getDay(),Ce=[];for(let it=0;it<oe;it++)Ce.push(null);for(let it=1;it<=q.getDate();it++)Ce.push(new Date(Me.getFullYear(),Me.getMonth(),it));const dt=he(new Date),xt=S?S.split("T")[0]:"";return Ce.map((it,Rt)=>{if(!it)return c.jsx("div",{className:"bg-white"},`pad-${Rt}`);const Ot=he(it),Nn=Ot===dt,$t=Ot===xt,an=wR(it),Tn=vR(it),Ie=it.getDay()===0||it.getDay()===6,Dt=n.filter(zt=>zt.id===t||!zt.start_date?!1:zt.start_date.split("T")[0]===Ot).length;return c.jsxs("button",{type:"button",onClick:()=>I(Ot),className:`relative bg-white p-1 min-h-[52px] flex flex-col items-center transition-all ${$t?"ring-2 ring-indigo-500 ring-inset":""} ${Nn?"bg-indigo-50":""}`,children:[c.jsx("span",{className:`text-sm font-bold ${$t?"text-indigo-600":an?"text-red-500":Ie?"text-red-400":"text-gray-700"}`,children:it.getDate()}),an?c.jsx("span",{className:"text-[8px] text-red-400 font-medium leading-tight truncate w-full text-center",children:an}):Tn?c.jsx("span",{className:"text-[8px] text-gray-400 leading-tight truncate w-full text-center",children:Tn.slice(-2)}):null,Dt>0&&c.jsx("span",{className:"absolute bottom-0.5 right-0.5 w-4 h-4 bg-amber-500 text-white text-[9px] font-bold rounded-full flex items-center justify-center",children:Dt>9?"9+":Dt})]},Ot)})})()})]}),c.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-xl border border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Yi,{size:18,className:"text-gray-500"}),c.jsx("span",{className:"text-sm font-medium text-gray-700",children:""})]}),c.jsx("button",{type:"button",onClick:()=>U(!xe),className:`w-12 h-7 rounded-full transition-all ${xe?"bg-indigo-600":"bg-gray-300"}`,children:c.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transition-transform ${xe?"translate-x-6":"translate-x-1"}`})})]}),!xe&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Yi,{size:18,className:"text-gray-500"}),c.jsx("input",{type:"time",value:z,onChange:Y=>ie(Y.target.value),className:"flex-1 p-3 bg-white rounded-xl border border-gray-200"})]}),c.jsxs("div",{className:"p-3 bg-white rounded-xl border border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(Ba,{size:18,className:"text-gray-500"}),c.jsx("span",{className:"text-sm font-medium text-gray-700",children:""})]}),c.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"",value:null},{label:"",value:0},{label:"5",value:5},{label:"15",value:15},{label:"30",value:30},{label:"1",value:60}].map(Y=>c.jsx("button",{type:"button",onClick:()=>{st(Y.value),t&&(Y.value!==null?localStorage.setItem(`task_reminder_${t}`,JSON.stringify(Y.value)):localStorage.removeItem(`task_reminder_${t}`))},className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${Be===Y.value?"bg-indigo-600 text-white":"bg-gray-100 text-gray-600"}`,children:Y.label},Y.label))})]}),S&&(()=>{const Y=S.split("T")[0],q=n.filter(oe=>oe.id===t||!oe.start_date?!1:oe.start_date.split("T")[0]===Y).sort((oe,Ce)=>{const dt=oe.start_time||(oe.is_all_day===!1&&oe.start_date?new Date(oe.start_date).toTimeString().slice(0,5):"99:99"),xt=Ce.start_time||(Ce.is_all_day===!1&&Ce.start_date?new Date(Ce.start_date).toTimeString().slice(0,5):"99:99");return dt.localeCompare(xt)});return q.length===0?null:c.jsxs("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-xl",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(Go,{size:14,className:"text-amber-600"}),c.jsxs("span",{className:"text-xs font-bold text-amber-700",children:[" ",q.length," "]})]}),c.jsx("div",{className:"space-y-1.5 max-h-32 overflow-y-auto",children:q.map(oe=>c.jsxs("div",{className:"flex items-center gap-2 text-xs text-amber-800 bg-white/60 rounded-lg px-2 py-1.5",children:[c.jsx("span",{className:"font-medium text-amber-600 w-12 flex-shrink-0",children:oe.is_all_day!==!1?"":oe.start_time||(oe.start_date?new Date(oe.start_date).toTimeString().slice(0,5):"--:--")}),c.jsx("span",{className:"truncate",children:oe.title})]},oe.id))})]})})()]}),ae==="importance"&&c.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 mb-6 grid grid-cols-2 gap-3 animate-in slide-in-from-top-2",children:Object.keys(we).map(Y=>c.jsxs("button",{onClick:()=>G(Y),className:`flex items-center gap-2 p-3 rounded-xl border transition-all ${P===Y?"border-gray-400 bg-white shadow-sm":"border-transparent hover:bg-white/50"}`,children:[c.jsx("div",{className:`w-3 h-3 rounded-full ${we[Y].color}`}),c.jsx("span",{className:"text-sm font-bold text-gray-700",children:we[Y].label}),P===Y&&c.jsx(tr,{size:16,className:"ml-auto text-gray-400"})]},Y))}),ae==="repeat"&&c.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 mb-6 space-y-2 animate-in slide-in-from-top-2",children:[null,"daily","weekly","monthly"].map(Y=>c.jsxs("button",{onClick:()=>M(Y?{type:Y,interval:1}:null),className:`w-full flex items-center justify-between p-3 rounded-xl ${(A==null?void 0:A.type)===Y||!A&&!Y?"bg-white shadow-sm border border-gray-200":"hover:bg-white/50"}`,children:[c.jsx("span",{className:"text-sm font-medium text-gray-700",children:{null:"",daily:"",weekly:"",monthly:""}[Y]}),((A==null?void 0:A.type)===Y||!A&&!Y)&&c.jsx(tr,{size:16,className:"text-blue-500"})]},Y||"none"))}),ae==="tags"&&c.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 space-y-3 max-h-[40vh] overflow-y-auto mb-6 animate-in slide-in-from-top-2",children:r.map(Y=>{const q=C.includes(Y.id);return c.jsxs("button",{onClick:()=>T(oe=>q?oe.filter(Ce=>Ce!==Y.id):[...oe,Y.id]),className:`w-full flex items-center justify-between p-3 rounded-xl transition-all ${q?"bg-white shadow-sm border border-purple-200":"bg-white border border-gray-200"}`,children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Y.color||"#6366f1"}}),c.jsx("span",{className:"text-sm font-medium",children:Y.name})]}),q&&c.jsx(tr,{size:18,className:"text-purple-600"})]},Y.id)})}),(D&&D.length>0||Q&&Q.length>0)&&c.jsxs("div",{className:"mb-6",children:[c.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 block",children:""}),c.jsxs("div",{className:"space-y-2",children:[Q.map((Y,q)=>c.jsxs("div",{className:"relative group rounded-xl overflow-hidden border border-gray-200",children:[c.jsx("img",{src:Y,alt:"Attachment",className:"w-full h-32 object-cover"}),c.jsx("button",{onClick:()=>lt(Y,!0),className:"absolute top-2 right-2 p-1.5 bg-black/50 text-white rounded-full",children:c.jsx(on,{size:14})})]},Y+q)),D.map((Y,q)=>{var oe;return c.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl border border-gray-200",children:[c.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[(oe=Y.type)!=null&&oe.startsWith("audio/")?c.jsx("button",{onClick:()=>Ge(Y.url),className:`p-2 rounded-full ${ht===Y.url?"bg-indigo-100 text-indigo-600":"bg-gray-200 text-gray-600"}`,children:ht===Y.url?c.jsx(DI,{size:16}):c.jsx(AI,{size:16})}):c.jsx("div",{className:"p-2 bg-gray-200 rounded-lg text-gray-500",children:c.jsx(co,{size:16})}),c.jsxs("div",{className:"flex flex-col overflow-hidden",children:[c.jsx("span",{className:"text-sm font-medium text-gray-700 truncate",children:Y.name}),c.jsxs("span",{className:"text-[10px] text-gray-400",children:[Math.round((Y.size||0)/1024)," KB"]})]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("a",{href:Y.url,download:!0,target:"_blank",rel:"noreferrer",className:"p-2 text-gray-400 hover:text-indigo-600",children:c.jsx(nu,{size:16})}),c.jsx("button",{onClick:()=>lt(Y.url,!1),className:"p-2 text-gray-400 hover:text-red-500",children:c.jsx(Ar,{size:16})})]})]},Y.url+q)})]})]}),c.jsxs("div",{className:"mb-6 min-h-[150px]",children:[c.jsx("div",{className:"flex items-center justify-between mb-2",children:c.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:""})}),c.jsx("div",{className:"bg-gray-50 rounded-xl px-1 py-1 focus-within:ring-2 focus-within:ring-indigo-100 border border-transparent",children:c.jsx($v,{ref:pe,initialContent:v||"",onChange:w,placeholder:"...",className:"min-h-[120px]",availableTags:r.map(Y=>({...Y,parent_id:Y.parent_id||void 0})),onTagClick:()=>{}})})]}),Ke&&c.jsxs("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center",onClick:()=>je(!1),children:[c.jsx("div",{className:"absolute inset-0 bg-black/40"}),c.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-[90%] max-w-sm max-h-[60vh] flex flex-col overflow-hidden",onClick:Y=>Y.stopPropagation(),children:[c.jsxs("div",{className:"p-4 border-b border-gray-100",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h3",{className:"font-bold text-gray-800",children:""}),c.jsx("button",{onClick:()=>je(!1),className:"p-1 text-gray-400 hover:text-gray-600",children:c.jsx(on,{size:20})})]}),c.jsxs("div",{className:"relative",children:[c.jsx(Fc,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),c.jsx("input",{type:"text",inputMode:"text",name:`tag_search_no_autofill_${Math.random()}`,autoComplete:"one-time-code",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",value:V,onChange:Y=>re(Y.target.value),placeholder:"...",className:"w-full pl-9 pr-4 py-2.5 bg-gray-100 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200 appearance-none",autoFocus:!0})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[V.trim()&&!r.some(Y=>Y.name.toLowerCase()===V.toLowerCase())&&c.jsx("div",{className:"mb-2 border-b border-gray-100 pb-2",children:ee?c.jsxs("div",{className:"p-3 bg-indigo-50 rounded-xl space-y-3",children:[c.jsxs("div",{className:"text-sm font-bold text-indigo-700",children:[": ",V]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:" ()"}),c.jsxs("select",{value:Pe||"",onChange:Y=>me(Y.target.value||null),className:"w-full p-2 bg-white border border-gray-200 rounded-lg text-sm",children:[c.jsx("option",{value:"",children:" ()"}),r.filter(Y=>!Y.parent_id).map(Y=>c.jsx("option",{value:Y.id,children:Y.name},Y.id))]})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{type:"button",onClick:()=>{ye(!1),me(null)},className:"flex-1 py-2 text-sm font-medium text-gray-600 bg-gray-200 rounded-lg",children:""}),c.jsx("button",{type:"button",onClick:async()=>{if(!V.trim())return;const Y=V.trim();try{const q=await o(Y,Pe);if(q&&pe.current){const oe=pe.current;oe&&oe.chain&&oe.chain().focus().insertContent([{type:"mention",attrs:{id:q,label:Y}},{type:"text",text:" "}]).run()}u==null||u({msg:` "${Y}"`,type:"info"}),je(!1),re(""),ye(!1),me(null)}catch(q){console.error("Failed to create tag:",q),u==null||u({msg:"",type:"error"})}},className:"flex-1 py-2 text-sm font-medium text-white bg-indigo-600 rounded-lg",children:""})]})]}):c.jsxs("button",{type:"button",onClick:()=>ye(!0),className:"w-full flex items-center gap-3 p-3 bg-indigo-50 hover:bg-indigo-100 rounded-xl transition-colors text-left",children:[c.jsx("div",{className:"w-5 h-5 rounded-full bg-indigo-500 flex items-center justify-center text-white text-xs font-bold",children:"+"}),c.jsxs("span",{className:"text-sm font-medium text-indigo-700",children:[' "',V,'"']})]})}),r.filter(Y=>Y.name.toLowerCase().includes(V.toLowerCase())).map(Y=>{var q;return c.jsxs("button",{type:"button",onClick:()=>{if(pe.current){const oe=pe.current;oe&&oe.chain&&oe.chain().focus().insertContent([{type:"mention",attrs:{id:Y.id,label:Y.name}},{type:"text",text:" "}]).run()}je(!1),re("")},className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50 rounded-xl transition-colors text-left",children:[c.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:Y.color||"#6366f1"}}),c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-sm font-medium text-gray-700",children:Y.name}),Y.parent_id&&c.jsx("span",{className:"text-[10px] text-gray-400",children:((q=r.find(oe=>oe.id===Y.parent_id))==null?void 0:q.name)||""})]})]},Y.id)}),r.filter(Y=>Y.name.toLowerCase().includes(V.toLowerCase())).length===0&&!V.trim()&&c.jsx("div",{className:"p-4 text-center text-gray-400 text-sm",children:""})]})]})]}),c.jsx("div",{className:"pt-4 border-t border-gray-100 pb-4",children:K?c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:()=>de(!1),className:"flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-bold",children:""}),c.jsx("button",{onClick:nt,className:"flex-1 py-3 rounded-xl bg-red-500 text-white font-bold",children:""})]}):c.jsx("button",{onClick:()=>de(!0),className:"w-full py-3 text-red-500 font-bold bg-red-50 rounded-xl",children:""})})]}),c.jsxs("div",{className:"flex-shrink-0 border-t border-gray-100 p-3 bg-white/80 backdrop-blur-md pb-6 flex items-center justify-around",children:[c.jsx("input",{type:"file",ref:Qe,accept:"image/*",className:"hidden",onChange:Y=>Ze(Y,!0)}),c.jsx("input",{type:"file",ref:De,className:"hidden",onChange:Y=>Ze(Y,!1)}),c.jsxs("button",{onClick:()=>{var Y;return(Y=Qe.current)==null?void 0:Y.click()},disabled:_e,className:"p-3 text-gray-500 active:bg-gray-100 rounded-full flex flex-col items-center gap-1",children:[c.jsx(nm,{size:24}),c.jsx("span",{className:"text-[10px]",children:""})]}),c.jsxs("button",{onClick:()=>{var Y;return(Y=De.current)==null?void 0:Y.click()},disabled:_e,className:"p-3 text-gray-500 active:bg-gray-100 rounded-full flex flex-col items-center gap-1",children:[c.jsx(co,{size:24}),c.jsx("span",{className:"text-[10px]",children:""})]}),c.jsx("button",{onClick:async()=>{if(f)m===t||!t&&!m?p():u==null||u({msg:"",type:"error"});else{if(!t){u==null||u({msg:"",type:"error"});return}try{await h(t),u==null||u({msg:"",type:"info"})}catch(Y){console.error("[MobileTaskEditor] Recording error:",Y),u==null||u({msg:"",type:"error"})}}},className:`p-4 rounded-full transition-all flex items-center justify-center -mt-8 shadow-lg ${f&&m===t?"bg-red-500 text-white scale-110":"bg-indigo-600 text-white active:scale-95"}`,children:f&&m===t?c.jsx("div",{className:"w-6 h-6 bg-white rounded-sm"}):c.jsx(II,{size:24})}),c.jsxs("button",{onClick:()=>Z(ae==="importance"?null:"importance"),className:`p-3 rounded-full flex flex-col items-center gap-1 ${P!=="unplanned"?"text-rose-600":"text-gray-500 active:bg-gray-100"}`,children:[c.jsx(Vf,{size:24}),c.jsx("span",{className:"text-[10px]",children:we[P].label})]}),c.jsxs("button",{onClick:()=>Z(ae==="repeat"?null:"repeat"),className:`p-3 rounded-full flex flex-col items-center gap-1 ${A?"text-blue-600":"text-gray-500 active:bg-gray-100"}`,children:[c.jsx(j6,{size:24}),c.jsx("span",{className:"text-[10px]",children:""})]})]})]})]});return er.createPortal(Ct,document.body)},Wh=({title:t,importance:e,tasks:n,onDrop:r,onAddTask:s,bgColor:i,borderColor:o,titleColor:a,infoText:l})=>{const{updateGhostPosition:u,endDrag:d}=b.useContext(_n),[f,h]=b.useState(!1),p=g=>{g.preventDefault(),h(!0),u(g.clientX,g.clientY)},m=()=>{h(!1)},y=g=>{g.preventDefault(),h(!1);const v=g.clientY,w=Array.from(g.currentTarget.querySelectorAll("[data-task-id]"));let S=null,I=Number.POSITIVE_INFINITY;w.forEach((R,C)=>{const T=R.getBoundingClientRect(),_=v-(T.top+T.height/2);Math.abs(_)<Math.abs(I)&&(I=_,S={element:R,offset:_,index:C})});let k;if(S){const R=S.index,C=n[R];if(C)if(S.offset<0){const T=n[R-1];T?k=((T.order_index||0)+(C.order_index||0))/2:k=(C.order_index||0)-1e4}else{const T=n[R+1];T?k=((C.order_index||0)+(T.order_index||0))/2:k=(C.order_index||0)+1e4}}else n.length>0?k=(n[n.length-1].order_index||0)+1e4:k=void 0;r(g,e,k)},x=()=>{h(!1),d()};return c.jsxs("div",{className:`flex flex-col h-full rounded-xl border-2 transition-all p-3 overflow-hidden ${f?"bg-indigo-50 border-indigo-400 scale-[1.01]":`${i} ${o}`}`,onDragOver:p,onDragLeave:m,onDrop:y,onDragEnd:x,children:[c.jsxs("div",{className:"flex justify-between items-center mb-3 flex-shrink-0",children:[c.jsxs("div",{className:"flex flex-col",children:[c.jsx("h3",{className:`font-bold text-lg ${a}`,children:t}),l&&c.jsx("span",{className:"text-[10px] text-gray-400 font-medium",children:l})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-xs font-medium text-gray-400 bg-white/50 px-2 py-0.5 rounded-full",children:n.length}),c.jsx("button",{onClick:()=>s(e),className:`p-1 rounded-full hover:bg-black/5 transition-colors ${a}`,children:c.jsx(Ki,{size:16})})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar space-y-2 pr-1 pb-10",children:[n.map((g,v)=>c.jsx("div",{children:c.jsx(pl,{flatTask:{data:g,depth:0,hasChildren:!1,isExpanded:!1,path:[g.id],index:v},isFocused:!1,onEdit:()=>{}})},g.id)),n.length===0&&c.jsxs("div",{className:"h-full flex flex-col items-center justify-center opacity-30 text-center",children:[c.jsx("div",{className:`p-4 rounded-full bg-current mb-2 opacity-10 ${a}`,children:c.jsx(jI,{size:24})}),c.jsx("span",{className:`text-sm font-medium ${a}`,children:""})]})]})]})},qee=()=>{const{tasks:t,tags:e,viewTagFilters:n,updateTask:r,addTask:s,setEditingTaskId:i,endDrag:o}=b.useContext(_n),a=b.useMemo(()=>{var y;const f=(y=e.find(x=>["schedule",""].includes(x.name.trim().toLowerCase())))==null?void 0:y.id,h=n.matrix||{include:[],exclude:[]},{include:p,exclude:m}=Array.isArray(h)?{include:h,exclude:[]}:h;return t.filter(x=>!(x.status==="deleted"||x.status==="logged"||x.status==="completed"||x.parent_id||f&&x.tags.includes(f)||x.tags.some(v=>{const w=e.find(S=>S.id===v);return w&&["schedule",""].includes(w.name.trim().toLowerCase())})||p.length>0&&!x.tags.some(v=>p.includes(v))||m.length>0&&x.tags.some(v=>m.includes(v))))},[t,e,n]),l={urgent:a.filter(f=>f.importance==="urgent"),planned:a.filter(f=>f.importance==="planned"),delegated:a.filter(f=>f.importance==="delegated"),unplanned:a.filter(f=>!f.importance||f.importance==="unplanned"||f.importance==="optional")},u=async(f,h,p)=>{const m=f.dataTransfer.getData("text/plain");if(m){const y={importance:h};p!==void 0&&(y.order_index=p),await r(m,y),await o()}},d=async f=>{const h=await s({title:"",importance:f,status:"inbox"});h&&i(h)};return c.jsxs("div",{className:"h-full p-6 flex flex-col overflow-hidden bg-white",children:[c.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[c.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[c.jsx(jI,{className:"text-indigo-600"}),"Eisenhower Matrix"]}),c.jsx("div",{className:"text-xs text-gray-400 font-medium bg-gray-100 px-3 py-1 rounded-full",children:"Shift+Alt inside tasks to move"})]}),c.jsxs("div",{className:"flex-1 grid grid-cols-2 grid-rows-2 gap-4 min-h-0",children:[c.jsx(Wh,{title:" (Do Now)",infoText:"Urgent & Important",importance:"urgent",tasks:l.urgent,onDrop:u,onAddTask:d,bgColor:"bg-red-50/50",borderColor:"border-red-100",titleColor:"text-red-600"}),c.jsx(Wh,{title:" (Plan)",infoText:"Not Urgent but Important",importance:"planned",tasks:l.planned,onDrop:u,onAddTask:d,bgColor:"bg-amber-50/50",borderColor:"border-amber-100",titleColor:"text-amber-600"}),c.jsx(Wh,{title:" (Delegate)",infoText:"Urgent but Not Important",importance:"delegated",tasks:l.delegated,onDrop:u,onAddTask:d,bgColor:"bg-green-50/50",borderColor:"border-green-100",titleColor:"text-green-600"}),c.jsx(Wh,{title:" (Unplanned)",infoText:"Neither Urgent nor Important",importance:"unplanned",tasks:l.unplanned,onDrop:u,onAddTask:d,bgColor:"bg-gray-50/50",borderColor:"border-gray-200",titleColor:"text-gray-500"})]})]})},Jee=()=>{const{user:t,setToast:e}=b.useContext(_n),[n,r]=b.useState(()=>{const _=localStorage.getItem(`work_logs_${t==null?void 0:t.id}`);return _?JSON.parse(_):[]}),[s,i]=b.useState(()=>new Date().toISOString().split("T")[0]),[o,a]=b.useState(!1),[l,u]=b.useState(""),[d,f]=b.useState(!1),h=_=>{localStorage.setItem(`work_logs_${t==null?void 0:t.id}`,JSON.stringify(_)),r(_)},p=b.useMemo(()=>n.find(_=>_.date===s),[n,s]),m=()=>{const _=new Date(s);_.setDate(_.getDate()-1),i(_.toISOString().split("T")[0])},y=()=>{const _=new Date(s);_.setDate(_.getDate()+1),i(_.toISOString().split("T")[0])},x=()=>{i(new Date().toISOString().split("T")[0])},g=_=>{const N=new Date(_),j=["","","","","","",""],O=N.getFullYear(),P=N.getMonth()+1,G=N.getDate(),A=j[N.getDay()];return`${O}${P}${G}${A}`},v=()=>`## ${g(s)}

### 

#### [/]
1. []
2. []

#### [/]
1. []
2. []

### 

|  |  |  |  |
|-------|------|------|------|
| 1 | [] | [] |  |
| 2 | [] | [] |  |

### 
- []
`,w=()=>{const _=v(),N={id:crypto.randomUUID(),date:s,content:_,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};h([...n,N]),u(_),a(!0)},S=()=>{u((p==null?void 0:p.content)||""),a(!0)},I=()=>{if(p){const _=n.map(N=>N.id===p.id?{...N,content:l,updated_at:new Date().toISOString()}:N);h(_)}a(!1),e==null||e({msg:"",type:"info"})},k=()=>{if(p&&confirm("")){const _=n.filter(N=>N.id!==p.id);h(_),a(!1),e==null||e({msg:"",type:"info"})}},R=async()=>{const N=((p==null?void 0:p.content)||"").replace(/^## /gm,"").replace(/^### /gm,"").replace(/^#### /gm,"").replace(/\*\*/g,"").replace(/\|/g,"	").replace(/-{3,}/g,"");try{await navigator.clipboard.writeText(N),f(!0),setTimeout(()=>f(!1),2e3),e==null||e({msg:"",type:"info"})}catch{e==null||e({msg:"",type:"error"})}},C=_=>_.split(`
`).map((N,j)=>{if(N.startsWith("## "))return c.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4 mt-6 first:mt-0",children:N.slice(3)},j);if(N.startsWith("### "))return c.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-3 mt-5",children:N.slice(4)},j);if(N.startsWith("#### "))return c.jsx("h4",{className:"text-base font-semibold text-gray-600 mb-2 mt-4",children:N.slice(5)},j);if(N.startsWith("| ")){const O=N.split("|").filter(G=>G.trim());return N.includes("---")?null:c.jsx("div",{className:"grid grid-cols-4 gap-2 px-2 py-1 text-sm border-b border-gray-100",children:O.map((G,A)=>c.jsx("span",{className:A===0?"font-medium":"text-gray-600",children:G.trim()},A))},j)}return N.match(/^\d+\. /)?c.jsx("p",{className:"text-sm text-gray-700 ml-6 mb-1",children:N},j):N.startsWith("- ")?c.jsxs("p",{className:"text-sm text-gray-700 ml-4 mb-1",children:[" ",N.slice(2)]},j):N.trim()===""?c.jsx("div",{className:"h-2"},j):c.jsx("p",{className:"text-sm text-gray-700 mb-1",children:N},j)}),T=s===new Date().toISOString().split("T")[0];return c.jsxs("div",{className:"h-full flex flex-col bg-white overflow-hidden",children:[c.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-white z-10",children:[c.jsx("div",{className:"flex items-center gap-4",children:c.jsxs("h2",{className:"font-bold text-gray-700 flex items-center gap-2",children:[c.jsx(pf,{size:18}),""]})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:m,className:"p-1.5 rounded hover:bg-gray-100 text-gray-500",children:c.jsx(Du,{size:18})}),c.jsx("span",{className:"font-medium text-gray-700 min-w-[180px] text-center",children:g(s)}),c.jsx("button",{onClick:y,className:"p-1.5 rounded hover:bg-gray-100 text-gray-500",children:c.jsx(ts,{size:18})}),!T&&c.jsx("button",{onClick:x,className:"ml-2 px-2 py-1 text-xs bg-indigo-50 text-indigo-600 rounded hover:bg-indigo-100",children:""})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[p&&!o&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:R,className:"flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[d?c.jsx(tr,{size:14}):c.jsx(kI,{size:14}),d?"":""]}),c.jsxs("button",{onClick:S,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 text-sm font-medium transition-colors",children:[c.jsx(Eg,{size:14}),""]}),c.jsx("button",{onClick:k,className:"flex items-center gap-1 px-3 py-1.5 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 text-sm font-medium transition-colors",children:c.jsx(Ar,{size:14})})]}),o&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:()=>a(!1),className:"flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[c.jsx(on,{size:14}),""]}),c.jsxs("button",{onClick:I,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors",children:[c.jsx(PI,{size:14}),""]})]}),!p&&!o&&c.jsxs("button",{onClick:w,className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors shadow-sm",children:[c.jsx(Ki,{size:16}),""]})]})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-gray-50/50",children:o?c.jsx("div",{className:"max-w-3xl mx-auto",children:c.jsx("textarea",{value:l,onChange:_=>u(_.target.value),className:"w-full h-[calc(100vh-200px)] p-4 bg-white rounded-xl border border-gray-200 focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 outline-none font-mono text-sm resize-none",placeholder:"..."})}):p?c.jsx("div",{className:"max-w-3xl mx-auto bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:C(p.content)}):c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[c.jsx(pf,{size:48,className:"mb-4 opacity-20"}),c.jsx("p",{className:"text-sm",children:""}),c.jsxs("button",{onClick:w,className:"mt-4 flex items-center gap-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors",children:[c.jsx(Ki,{size:16}),""]})]})})]})},Yee=({task:t,position:e,count:n})=>{const r=b.useRef(null);if(b.useLayoutEffect(()=>{e&&r.current&&(r.current.style.left=`${e.x}px`,r.current.style.top=`${e.y}px`)},[]),!e)return null;const s=c.jsxs("div",{ref:r,id:"drag-ghost",className:"fixed pointer-events-none rounded-lg border-2 border-indigo-500/50 p-3 w-64 flex items-center gap-3",style:{transform:"translate(16px, 16px) rotate(2deg)",zIndex:99999,backgroundColor:"#ffffff",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",opacity:1,isolation:"isolate"},children:[c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h4",{className:"font-medium text-sm text-gray-900 dark:text-gray-100 truncate",children:t.title||"()"}),n>1&&c.jsxs("p",{className:"text-xs text-indigo-500 font-medium",children:["+ ",n-1," "]})]}),c.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-pulse"})]});return er.createPortal(s,document.body)},Xee=t=>{switch(t){case"inbox":return"";case"waiting":return"";case"active":return"";case"someday":return"/";case"reference":return"";case"completed":return"";case"archived":return"";case"logged":return"";default:return t}},Qee=({onClose:t})=>{const{tasks:e,selectedTaskIds:n,updateTask:r,setToast:s,tags:i}=b.useContext(_n),[o,a]=b.useState(""),[l,u]=b.useState(0),d=b.useRef(null);b.useEffect(()=>{d.current&&d.current.focus()},[]),b.useEffect(()=>{u(0)},[o]);const f=y=>{y.key==="Escape"&&t()};b.useEffect(()=>(window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)),[]);const h=b.useMemo(()=>{if(!o.trim())return[];const y=o.toLowerCase();return e.filter(x=>{if(x.status==="deleted"||x.status==="archived"||x.status==="logged"||!x.title.toLowerCase().includes(y)||n.includes(x.id))return!1;for(const g of n)if(Sw(g,x.id,e))return!1;return!0}).slice(0,10)},[e,o,n]),p=async y=>{const x=e.find(g=>g.id===y);if(x)try{await Promise.all(n.map(g=>r(g,{parent_id:y}))),s({type:"success",msg:` ${n.length}  "${x.title}" `}),t()}catch(g){console.error(g),s({type:"error",msg:""})}},m=y=>{y.key==="ArrowDown"?(y.preventDefault(),u(x=>(x+1)%h.length)):y.key==="ArrowUp"?(y.preventDefault(),u(x=>(x-1+h.length)%h.length)):y.key==="Enter"&&(y.preventDefault(),h.length>0&&p(h[l].id))};return er.createPortal(c.jsx(go,{children:c.jsx(Rr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-[99999] flex items-start justify-center pt-[20vh]",onClick:t,children:c.jsxs(Rr.div,{initial:{opacity:0,scale:.95,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20},transition:{duration:.15},className:"w-full max-w-xl bg-white rounded-xl shadow-2xl overflow-hidden border border-gray-200",onClick:y=>y.stopPropagation(),children:[c.jsxs("div",{className:"p-3 border-b border-gray-100 flex items-center gap-3",children:[c.jsx(i6,{className:"text-gray-400",size:20}),c.jsx("input",{ref:d,type:"text",value:o,onChange:y=>a(y.target.value),onKeyDown:m,placeholder:` ${n.length} ...`,className:"flex-1 bg-transparent border-none outline-none text-base text-gray-800 placeholder:text-gray-400"}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-500 px-1.5 py-0.5 rounded border border-gray-200",children:"ESC"})})]}),c.jsxs("div",{className:"max-h-[300px] overflow-y-auto",children:[h.length===0&&o.trim()!==""&&c.jsx("div",{className:"p-8 text-center text-gray-400 text-sm",children:""}),h.length===0&&o.trim()===""&&c.jsx("div",{className:"p-8 text-center text-gray-400 text-sm",children:"..."}),h.map((y,x)=>{var v;const g=x===l;return c.jsxs("button",{onClick:()=>p(y.id),onMouseEnter:()=>u(x),className:`w-full text-left p-3 flex items-center gap-3 transition-colors ${g?"bg-indigo-50":"hover:bg-gray-50"}`,children:[c.jsx("div",{className:`w-1 h-8 rounded-full ${g?"bg-indigo-500":"bg-transparent"}`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:`font-medium truncate ${g?"text-indigo-900":"text-gray-700"}`,children:y.title}),c.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1.5 text-xs",children:[c.jsx("span",{className:"px-1.5 py-0.5 rounded-md bg-gray-100 border border-gray-200 text-gray-500 font-medium",children:Xee(y.status)}),y.parent_id?c.jsxs("span",{className:"flex items-center gap-1 text-indigo-600 bg-indigo-50 border border-indigo-100 px-1.5 py-0.5 rounded-md",children:[c.jsx(SI,{size:10}),c.jsx("span",{className:"max-w-[100px] truncate",children:((v=e.find(w=>w.id===y.parent_id))==null?void 0:v.title)||""})]}):c.jsx("span",{className:"text-gray-400 border border-gray-200 px-1.5 py-0.5 rounded-md",children:""}),y.tags&&y.tags.length>0&&c.jsx("div",{className:"flex gap-1 items-center",children:y.tags.map(w=>{const S=i.find(I=>I.id===w);return S?c.jsxs("span",{className:"px-1.5 py-0.5 rounded-md border text-[10px]",style:{backgroundColor:`${S.color}15`,borderColor:`${S.color}30`,color:S.color},children:["#",S.name]},w):null})})]})]}),g&&c.jsx("span",{className:"text-[10px] text-indigo-400 font-medium px-2 flex-shrink-0",children:"Enter "})]},y.id)})]})]})})}),document.body)},Zee={gray:"bg-gray-400",blue:"bg-blue-500",indigo:"bg-indigo-500",red:"bg-red-500",orange:"bg-orange-500",amber:"bg-amber-500",green:"bg-green-500",teal:"bg-teal-500",cyan:"bg-cyan-500",sky:"bg-sky-500",purple:"bg-purple-500",fuchsia:"bg-fuchsia-500",pink:"bg-pink-500",rose:"bg-rose-500"},ete=[{label:"5 ",minutes:5},{label:"30 ",minutes:30},{label:"1 ",minutes:60},{label:"2 ",minutes:120}],tte=({reminder:t,onSnooze:e,onMarkSeen:n,onSelect:r,onEdit:s})=>{const[i,o]=b.useState(!1),[a,l]=b.useState(""),[u,d]=b.useState({top:0,left:0}),[f,h]=b.useState(null),p=b.useRef(null),m=b.useRef(null);b.useEffect(()=>{if(!t.snoozed_until){h(null);return}const w=()=>{const I=Date.now(),R=new Date(t.snoozed_until).getTime()-I;if(R<=0){h(null);return}const C=Math.floor(R/1e3),T=Math.floor(C/60),_=Math.floor(T/60);_>0?h(`${_}${T%60}`):T>0?h(`${T}${C%60}`):h(`${C}`)};w();const S=setInterval(w,1e3);return()=>clearInterval(S)},[t.snoozed_until]);const y=()=>{p.current?(clearTimeout(p.current),p.current=null,s()):p.current=setTimeout(()=>{p.current=null,r()},250)},x=w=>{const S=new Date(w),k=new Date().getTime()-S.getTime(),R=Math.floor(k/6e4),C=Math.floor(k/36e5),T=Math.floor(k/864e5);return R<1?"":R<60?`${R} `:C<24?`${C} `:`${T} `},g=w=>new Date(w).toLocaleString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),v=()=>{const w=parseInt(a);w>0&&(e(w),o(!1),l(""))};return c.jsx("div",{className:`p-3 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer ${t.seen?"opacity-60":""}`,onClick:y,children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("div",{className:`w-2 h-2 mt-2 rounded-full ${Zee[t.task_color]} flex-shrink-0`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:"font-medium text-gray-800 truncate",children:t.task_title}),c.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500 flex-wrap",children:[c.jsx(Yi,{size:10}),c.jsxs("span",{children:["",g(t.due_time)]}),c.jsx("span",{className:"text-gray-300",children:""}),c.jsx("span",{children:x(t.triggered_at)}),f&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"text-gray-300",children:""}),c.jsxs("span",{className:"text-orange-500 font-medium",children:[" ",f]})]})]})]}),c.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",onClick:w=>w.stopPropagation(),children:[c.jsx("button",{onClick:n,className:`p-1.5 rounded-lg transition-colors ${t.seen?"bg-green-100 text-green-600":"hover:bg-gray-100 text-gray-400 hover:text-green-600"}`,title:t.seen?"":"",children:t.seen?c.jsx(tr,{size:14}):c.jsx(a6,{size:14})}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{ref:m,onClick:()=>{if(!i&&m.current){const w=m.current.getBoundingClientRect();d({top:w.bottom+4,left:w.right-160})}o(!i)},className:"p-1.5 rounded-lg hover:bg-gray-100 text-gray-400 hover:text-orange-500 transition-colors flex items-center gap-0.5",title:"",children:[c.jsx(Ba,{size:14}),c.jsx(ds,{size:10})]}),i&&er.createPortal(c.jsxs("div",{className:"fixed w-40 bg-white rounded-lg shadow-xl border border-gray-200 z-[10001] overflow-hidden",style:{top:u.top,left:u.left},"data-snooze-menu":"true",children:[ete.map(w=>c.jsxs("button",{onClick:()=>{e(w.minutes),o(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-orange-50 text-gray-700 hover:text-orange-600 transition-colors",children:[w.label,""]},w.minutes)),c.jsx("div",{className:"border-t border-gray-100 p-2",children:c.jsxs("div",{className:"flex gap-1",children:[c.jsx("input",{type:"number",value:a,onChange:w=>l(w.target.value),placeholder:"",className:"flex-1 px-2 py-1 text-xs border rounded w-16",min:1}),c.jsx("span",{className:"text-xs text-gray-500 self-center",children:""}),c.jsx("button",{onClick:v,className:"px-2 py-1 text-xs bg-orange-500 text-white rounded hover:bg-orange-600",children:""})]})})]}),document.body)]})]})]})})},nte=()=>{const{reminders:t,markAsSeen:e,snoozeReminder:n,clearAllSeen:r,clearAllUnseen:s,clearAll:i,unseenCount:o,isReminderPanelOpen:a,setIsReminderPanelOpen:l}=b.useContext(xI),{setFocusedTaskId:u,setSelectedTaskIds:d,navigateToTask:f}=b.useContext(_n),h=b.useRef(null);b.useEffect(()=>{const x=g=>{const v=g.target;if(h.current&&h.current.contains(v))return;const w=document.querySelector('[data-snooze-menu="true"]');w&&w.contains(v)||l(!1)};return a&&document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[a,l]);const p=x=>{u(x),d([x]),f(x,!1,"allview"),l(!1),setTimeout(()=>{const g=document.querySelector(`[data-task-id="${x}"]`);g&&g.scrollIntoView({behavior:"smooth",block:"center"})},300)},m=x=>{f(x,!0,"allview"),l(!1)},y=[...t].sort((x,g)=>x.seen!==g.seen?x.seen?1:-1:new Date(g.triggered_at).getTime()-new Date(x.triggered_at).getTime());return c.jsxs("div",{className:"relative",ref:h,children:[c.jsxs("button",{onClick:()=>l(!a),className:`relative p-1.5 rounded-lg transition-colors ${a?"bg-orange-100 text-orange-600":"hover:bg-gray-100 text-gray-500 hover:text-orange-500"}`,title:"",children:[c.jsx(Ba,{size:18}),o>0&&c.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center animate-pulse",children:o>9?"9+":o})]}),c.jsx(go,{children:a&&c.jsxs(Rr.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15},className:"absolute right-0 top-full mt-2 w-80 md:w-96 bg-white rounded-xl shadow-2xl border border-gray-200 z-[9999] overflow-hidden",children:[c.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 flex items-center justify-between bg-gradient-to-r from-orange-50 to-amber-50",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ba,{size:16,className:"text-orange-500"}),c.jsx("span",{className:"font-bold text-gray-800",children:""}),o>0&&c.jsxs("span",{className:"px-1.5 py-0.5 bg-red-500 text-white text-[10px] font-bold rounded-full",children:[o," "]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[o>0&&c.jsx("button",{onClick:s,className:"px-2 py-1 rounded-lg text-[10px] font-bold bg-red-100 text-red-600 hover:bg-red-200 transition-colors",title:"",children:""}),t.some(x=>x.seen)&&c.jsx("button",{onClick:r,className:"p-1.5 rounded-lg hover:bg-white/50 text-gray-400 hover:text-red-500 transition-colors",title:"",children:c.jsx(Ar,{size:14})}),t.length>0&&c.jsx("button",{onClick:i,className:"p-1.5 rounded-lg hover:bg-white/50 text-gray-400 hover:text-red-500 transition-colors",title:"",children:c.jsx(on,{size:14})})]})]}),c.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:y.length===0?c.jsxs("div",{className:"py-12 text-center text-gray-400",children:[c.jsx(Qx,{size:32,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{className:"text-sm",children:""})]}):y.map(x=>c.jsx(tte,{reminder:x,onSnooze:g=>n(x.id,g),onMarkSeen:()=>e(x.id),onSelect:()=>p(x.task_id),onEdit:()=>m(x.task_id)},x.id))}),c.jsx("div",{className:"px-4 py-2 border-t border-gray-100 bg-gray-50 text-[10px] text-gray-400",children:c.jsx("span",{children:"  "})})]})})]})},rte={capture:{label:"",icon:"",color:"bg-gray-100 text-gray-600"},clarify:{label:"",icon:"",color:"bg-yellow-100 text-yellow-600"},organize:{label:"",icon:"",color:"bg-blue-100 text-blue-600"},engage:{label:"",icon:"",color:"bg-green-100 text-green-600"}},ste=({taskId:t,onClose:e})=>{const{tasks:n,tags:r,updateTask:s,batchAddTasks:i}=b.useContext(_n),[o,a]=b.useState(""),[l,u]=b.useState([]),[d,f]=b.useState(!1),h=b.useRef(null),p=b.useRef(!1),[m,y]=b.useState("capture"),[x,g]=b.useState([]),v=n.find(_=>_.id===t),w=()=>{setTimeout(()=>{var _;(_=h.current)==null||_.scrollIntoView({behavior:"smooth"})},100)};b.useEffect(()=>{w()},[l,x]),b.useEffect(()=>{if(v&&!p.current)if(p.current=!0,v.ai_history&&v.ai_history.length>0){const _=v.ai_history.map(N=>({id:N.id,role:N.role,content:N.content,timestamp:new Date(N.created_at).getTime()}));_.sort((N,j)=>N.timestamp-j.timestamp),u(_)}else I("",!0)},[v]);const S=async _=>{if(!v)return;const N={id:_.id,role:_.role,content:_.content,created_at:new Date(_.timestamp).toISOString()},j=v.ai_history||[];j.some(O=>O.id===_.id)||await s(v.id,{ai_history:[...j,N]},void 0,{skipHistory:!0})},I=async(_,N=!1)=>{if(!v||!_.trim()&&!N)return;g([]);let j=null;N||(j={id:crypto.randomUUID(),role:"user",content:_,timestamp:Date.now()},u(O=>[...O,j]),S(j),a("")),f(!0);try{const O=v.parent_id?n.find(xe=>xe.id===v.parent_id):null,P=v.tags.map(xe=>{var U;return((U=r.find(z=>z.id===xe))==null?void 0:U.name)||xe}),G={title:v.title,description:v.description||"",status:v.status,created_at:v.created_at,due_date:v.due_date,start_date:v.start_date,tags:P,project_title:O==null?void 0:O.title},A=new Date,M=new Date;M.setDate(A.getDate()+14);const Q=n.filter(xe=>{if(xe.status==="completed"||xe.status==="deleted")return!1;const U=xe.start_date||xe.due_date;if(!U)return!1;const z=new Date(U);return z>=A&&z<=M}).sort((xe,U)=>(xe.start_date||xe.due_date||"").localeCompare(U.start_date||U.due_date||"")).map(xe=>{var U,z;return`[${((U=xe.start_date)==null?void 0:U.split("T")[0])||((z=xe.due_date)==null?void 0:z.split("T")[0])}] ${xe.title}`}).slice(0,30),X=l.filter(xe=>xe.role!=="system").map(xe=>({role:xe.role,content:xe.content}));j&&X.push({role:"user",content:j.content});const D=await jJ(G,Q,N?" GTD ":_,X);D.current_stage&&y(D.current_stage),D.actions&&D.actions.length>0&&g(D.actions);const Te={id:crypto.randomUUID(),role:"assistant",content:D.reply,timestamp:Date.now()};u(xe=>[...xe,Te]),S(Te)}catch(O){console.error(O);const P={id:crypto.randomUUID(),role:"assistant",content:"",timestamp:Date.now()};u(G=>[...G,P])}finally{f(!1)}},k=async()=>{if(!v)return;const _=[];try{for(const N of x)if(N.type==="update_task"){const j={};if(N.params.title&&(j.title=N.params.title),N.params.description&&(j.description=N.params.description),N.params.due_date&&(j.due_date=N.params.due_date),N.params.start_date&&(j.start_date=N.params.start_date),N.params.start_time&&(j.start_time=N.params.start_time),N.params.reminder_minutes!==void 0&&(j.reminder_minutes=N.params.reminder_minutes),N.params.tags&&N.params.tags.length>0){const O=N.params.tags.map(P=>{const G=r.find(A=>A.name.toLowerCase()===P.toLowerCase());return G?G.id:null}).filter(Boolean);O.length>0&&(j.tags=O)}Object.keys(j).length>0&&(await s(v.id,j),_.push(""))}else N.type==="add_subtasks"&&N.params.tasks&&N.params.tasks.length>0&&(await i(N.params.tasks.map(j=>({...j,status:"todo",start_date:j.start_date,start_time:j.start_time,reminder_minutes:j.reminder_minutes,due_date:j.due_date})),v.id),_.push(` ${N.params.tasks.length} `));if(_.length>0){const N={id:crypto.randomUUID(),role:"system",content:_.map(j=>` ${j}`).join(`
`),timestamp:Date.now()};u(j=>[...j,N]),S(N)}g([])}catch(N){console.error("Action execution failed:",N),alert("")}},R=(_,N,j,O)=>{g(P=>{const G=[...P],A={...G[_]};if(A.type==="update_task")A.params={...A.params,[N]:j};else if(A.type==="add_subtasks"&&typeof O=="number"){const M=[...A.params.tasks];M[O]={...M[O],[N]:j},A.params={...A.params,tasks:M}}return G[_]=A,G})},C=_=>{g(N=>N.filter((j,O)=>O!==_))},T=(_,N)=>{g(j=>{const O=[...j],P=O[_];if(P.type==="add_subtasks"){const G=[...P.params.tasks];if(G.splice(N,1),G.length===0)return j.filter((A,M)=>M!==_);O[_]={...P,params:{...P.params,tasks:G}}}return O})};return v?c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:c.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md h-[700px] flex flex-col animate-in slide-in-from-bottom-5 duration-200 overflow-hidden border border-indigo-100 font-sans",children:[c.jsxs("div",{className:"px-4 py-3 border-b bg-gradient-to-r from-indigo-50 to-white",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600",children:c.jsx(js,{size:16})}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-sm font-bold text-gray-900",children:"GTD "}),c.jsx("p",{className:"text-xs text-indigo-600 flex items-center gap-1",children:v.title.length>10?v.title.slice(0,10)+"...":v.title})]})]}),c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 p-1.5 rounded-full transition-colors",children:c.jsx(on,{size:18})})]}),c.jsxs("div",{className:"flex justify-between items-center px-2 py-1 bg-gray-50 rounded-lg relative overflow-hidden",children:[Object.entries(rte).map(([_,N],j)=>{const O=m===_;return c.jsxs("div",{className:`flex flex-col items-center z-10 transition-all duration-300 ${O?"scale-110 opacity-100":"opacity-40 scale-90"}`,children:[c.jsx("span",{className:"text-base mb-0.5",children:N.icon}),c.jsx("span",{className:`text-[10px] font-bold ${O?"text-indigo-600":"text-gray-500"}`,children:N.label})]},_)}),c.jsx("div",{className:"absolute top-1/2 left-0 w-full h-0.5 bg-gray-200 -z-0 transform -translate-y-1/2"})]})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50/50 space-y-4",children:[l.map(_=>c.jsxs("div",{className:`flex gap-3 ${_.role==="user"?"flex-row-reverse":""}`,children:[c.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${_.role==="user"?"bg-gray-200":_.role==="system"?"bg-green-100 text-green-600":"bg-indigo-600 text-white"}`,children:_.role==="user"?c.jsx(FI,{size:14,className:"text-gray-600"}):_.role==="system"?c.jsx(Cg,{size:14}):c.jsx(Xz,{size:14})}),c.jsxs("div",{className:`max-w-[90%] rounded-2xl px-4 py-2.5 text-sm shadow-sm ${_.role==="user"?"bg-white text-gray-800 border border-gray-100 rounded-tr-none":_.role==="system"?"bg-green-50 text-green-800 border border-green-100":"bg-white text-gray-800 border border-indigo-100 rounded-tl-none"}`,children:[c.jsx("div",{className:"prose prose-sm prose-indigo max-w-none",children:c.jsx(nk,{children:_.content})}),c.jsx("span",{className:"text-[10px] text-gray-400 mt-1 block text-right",children:new Date(_.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},_.id)),x.length>0&&c.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-0 overflow-hidden shadow-sm animate-in fade-in slide-in-from-bottom-2",children:[c.jsx("div",{className:"px-3 py-2 bg-amber-100/50 border-b border-amber-200 flex items-center justify-between",children:c.jsxs("div",{className:"flex items-center gap-1.5 text-amber-800",children:[c.jsx(Gz,{size:14}),c.jsx("span",{className:"text-xs font-bold",children:" ()"})]})}),c.jsx("div",{className:"p-3 space-y-3",children:x.map((_,N)=>c.jsxs("div",{className:"bg-white rounded-lg border border-amber-100 p-2 shadow-sm relative group",children:[c.jsx("button",{onClick:()=>C(N),className:"absolute right-2 top-2 text-gray-300 hover:text-red-500 hover:bg-gray-100 p-1 rounded transition-all z-10",title:"",children:c.jsx(on,{size:14})}),_.type==="update_task"&&c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500 font-bold uppercase tracking-wider mb-1",children:[c.jsx(Eg,{size:12})," "]}),c.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[_.params.title!==void 0&&c.jsx("input",{type:"text",value:_.params.title||"",onChange:j=>R(N,"title",j.target.value),className:"w-full text-xs font-bold border border-gray-200 rounded px-1.5 py-1 focus:ring-1 focus:ring-amber-300 outline-none",placeholder:""}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded border border-gray-100 flex-1",children:[c.jsx("span",{className:"text-[10px] text-gray-400",children:""}),c.jsx("input",{type:"date",value:_.params.start_date||"",onChange:j=>R(N,"start_date",j.target.value),className:"flex-1 text-xs bg-transparent outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded border border-gray-100 w-24",children:[c.jsx(Yi,{size:10,className:"text-gray-400"}),c.jsx("input",{type:"time",value:_.params.start_time||"",onChange:j=>R(N,"start_time",j.target.value),className:"flex-1 text-xs bg-transparent outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded border border-gray-100 w-28",children:[c.jsx(Ba,{size:10,className:"text-gray-400"}),c.jsxs("select",{value:_.params.reminder_minutes??-1,onChange:j=>{const O=parseInt(j.target.value);R(N,"reminder_minutes",O===-1?null:O)},className:"flex-1 text-xs bg-transparent outline-none",children:[c.jsx("option",{value:-1,children:""}),c.jsx("option",{value:0,children:""}),c.jsx("option",{value:10,children:"10"}),c.jsx("option",{value:30,children:"30"}),c.jsx("option",{value:60,children:"1"})]})]})]}),_.params.description!==void 0&&c.jsx("textarea",{value:_.params.description||"",onChange:j=>R(N,"description",j.target.value),className:"w-full text-xs border border-gray-200 rounded px-1.5 py-1 focus:ring-1 focus:ring-amber-300 outline-none resize-none h-16",placeholder:""})]})]}),_.type==="add_subtasks"&&c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500 mb-2 font-bold uppercase tracking-wider",children:[c.jsx(b6,{size:12})," "]}),c.jsx("ul",{className:"space-y-2",children:_.params.tasks.map((j,O)=>c.jsxs("li",{className:"flex flex-col gap-1.5 bg-gray-50 p-2 rounded relative group/item border border-transparent hover:border-gray-200 transition-colors",children:[c.jsxs("div",{className:"flex gap-2 w-full pr-5",children:[c.jsx("input",{type:"text",value:j.title,onChange:P=>R(N,"title",P.target.value,O),className:"flex-1 bg-white text-xs border border-gray-200 rounded px-1.5 py-1 focus:ring-1 focus:ring-amber-300 outline-none",placeholder:""}),c.jsx("button",{onClick:()=>T(N,O),className:"absolute right-1 top-1 text-gray-300 hover:text-red-500 p-1 opacity-0 group-hover/item:opacity-100 transition-opacity",title:"",children:c.jsx(Ar,{size:12})})]}),c.jsxs("div",{className:"flex flex-wrap gap-2 text-[10px]",children:[c.jsxs("div",{className:"flex items-center gap-1 bg-white rounded border border-gray-200 px-1 py-0.5 min-w-[100px]",children:[c.jsx("span",{className:"text-gray-400",children:""}),c.jsx("input",{type:"date",value:j.start_date||"",onChange:P=>R(N,"start_date",P.target.value,O),className:"flex-1 outline-none min-w-0 bg-transparent"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-white rounded border border-gray-200 px-1 py-0.5 w-[80px]",children:[c.jsx(Yi,{size:10,className:"text-gray-400"}),c.jsx("input",{type:"time",value:j.start_time||"",onChange:P=>R(N,"start_time",P.target.value,O),className:"flex-1 outline-none min-w-0 bg-transparent"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-white rounded border border-gray-200 px-1 py-0.5 w-[85px]",children:[c.jsx(Ba,{size:10,className:"text-gray-400"}),c.jsxs("select",{value:j.reminder_minutes??-1,onChange:P=>{const G=parseInt(P.target.value);R(N,"reminder_minutes",G===-1?null:G,O)},className:"flex-1 outline-none bg-transparent",children:[c.jsx("option",{value:-1,children:""}),c.jsx("option",{value:0,children:""}),c.jsx("option",{value:10,children:"10"}),c.jsx("option",{value:60,children:"1hr"})]})]})]})]},O))})]})]},N))}),c.jsxs("div",{className:"p-2 border-t border-amber-200/50 flex gap-2",children:[c.jsx("button",{onClick:()=>g([]),className:"flex-1 py-1.5 text-xs text-gray-500 hover:bg-gray-100 rounded-lg transition-colors",children:""}),c.jsxs("button",{onClick:k,className:"flex-1 py-1.5 bg-amber-500 hover:bg-amber-600 text-white rounded-lg text-sm font-bold shadow-sm transition-colors flex items-center justify-center gap-1.5",children:[" (",x.length,")"]})]})]}),d&&c.jsxs("div",{className:"flex gap-3",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-600 text-white flex items-center justify-center flex-shrink-0",children:c.jsx(Hi,{size:14,className:"animate-spin"})}),c.jsxs("div",{className:"bg-white px-4 py-3 rounded-2xl rounded-tl-none shadow-sm border border-indigo-100 flex items-center gap-2",children:[c.jsx("span",{className:"w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),c.jsx("span",{className:"w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),c.jsx("span",{className:"w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]}),c.jsx("div",{ref:h})]}),c.jsxs("div",{className:"p-3 bg-white border-t border-gray-100",children:[c.jsxs("form",{onSubmit:_=>{_.preventDefault(),I(o)},className:"relative",children:[c.jsxs("div",{className:"relative flex items-end gap-2 bg-gray-50 border border-gray-200 rounded-2xl p-2 focus-within:ring-2 focus-within:ring-indigo-100 focus-within:border-indigo-300 transition-all",children:[c.jsx("textarea",{value:o,onChange:_=>{a(_.target.value),_.target.style.height="auto",_.target.style.height=_.target.scrollHeight+"px"},onKeyDown:_=>{_.key==="Enter"&&(_.metaKey||_.ctrlKey)&&(_.preventDefault(),I(o))},placeholder:" GTD ... (Cmd + Enter )",className:"flex-1 bg-transparent border-none focus:ring-0 text-sm resize-none max-h-32 min-h-[24px] py-1 px-1 custom-scrollbar leading-relaxed outline-none",disabled:d,rows:1,style:{height:"auto",minHeight:"24px"}}),c.jsx("button",{type:"submit",disabled:!o.trim()||d,className:"p-1.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors self-end mb-0.5",title:"Cmd + Enter ",children:c.jsx(D6,{size:16})})]}),c.jsx("div",{className:"text-[10px] text-gray-400 text-right mt-1 pr-1",children:"Cmd + Enter  / Enter "})]}),c.jsx("div",{className:"mt-2 flex gap-2 overflow-x-auto pb-1 no-scrollbar",children:["","","",""].map(_=>c.jsx("button",{onClick:()=>I(_),disabled:d,className:"px-2.5 py-1 bg-gray-50 hover:bg-indigo-50 text-gray-600 hover:text-indigo-600 border border-gray-100 hover:border-indigo-100 rounded-full text-xs whitespace-nowrap transition-colors",children:_},_))})]})]})}):null},TR=6048e5,ite=864e5,CR=6e4,ER=36e5,cE=Symbol.for("constructDateFrom");function wo(t,e){return typeof t=="function"?t(e):t&&typeof t=="object"&&cE in t?t[cE](e):t instanceof Date?new t.constructor(e):new Date(e)}function Bs(t,e){return wo(e||t,t)}function NR(t,e,n){const r=Bs(t,n==null?void 0:n.in);return isNaN(e)?wo((n==null?void 0:n.in)||t,NaN):(e&&r.setDate(r.getDate()+e),r)}let ote={};function Qg(){return ote}function Of(t,e){var a,l,u,d;const n=Qg(),r=(e==null?void 0:e.weekStartsOn)??((l=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:l.weekStartsOn)??n.weekStartsOn??((d=(u=n.locale)==null?void 0:u.options)==null?void 0:d.weekStartsOn)??0,s=Bs(t,e==null?void 0:e.in),i=s.getDay(),o=(i<r?7:0)+i-r;return s.setDate(s.getDate()-o),s.setHours(0,0,0,0),s}function ng(t,e){return Of(t,{...e,weekStartsOn:1})}function jR(t,e){const n=Bs(t,e==null?void 0:e.in),r=n.getFullYear(),s=wo(n,0);s.setFullYear(r+1,0,4),s.setHours(0,0,0,0);const i=ng(s),o=wo(n,0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);const a=ng(o);return n.getTime()>=i.getTime()?r+1:n.getTime()>=a.getTime()?r:r-1}function uE(t){const e=Bs(t),n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),+t-+n}function IR(t,...e){const n=wo.bind(null,t||e.find(r=>typeof r=="object"));return e.map(n)}function rg(t,e){const n=Bs(t,e==null?void 0:e.in);return n.setHours(0,0,0,0),n}function ate(t,e,n){const[r,s]=IR(n==null?void 0:n.in,t,e),i=rg(r),o=rg(s),a=+i-uE(i),l=+o-uE(o);return Math.round((a-l)/ite)}function lte(t,e){const n=jR(t,e),r=wo((e==null?void 0:e.in)||t,0);return r.setFullYear(n,0,4),r.setHours(0,0,0,0),ng(r)}function By(t,e,n){const[r,s]=IR(n==null?void 0:n.in,t,e);return+rg(r)==+rg(s)}function cte(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function ute(t){return!(!cte(t)&&typeof t!="number"||isNaN(+Bs(t)))}function dte(t,e){const n=Bs(t,e==null?void 0:e.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}const fte={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},hte=(t,e,n)=>{let r;const s=fte[t];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",e.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function cu(t){return(e={})=>{const n=e.width?String(e.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const pte={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},mte={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},gte={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},yte={date:cu({formats:pte,defaultWidth:"full"}),time:cu({formats:mte,defaultWidth:"full"}),dateTime:cu({formats:gte,defaultWidth:"full"})},xte={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},bte=(t,e,n,r)=>xte[t];function ao(t){return(e,n)=>{const r=n!=null&&n.context?String(n.context):"standalone";let s;if(r==="formatting"&&t.formattingValues){const o=t.defaultFormattingWidth||t.defaultWidth,a=n!=null&&n.width?String(n.width):o;s=t.formattingValues[a]||t.formattingValues[o]}else{const o=t.defaultWidth,a=n!=null&&n.width?String(n.width):t.defaultWidth;s=t.values[a]||t.values[o]}const i=t.argumentCallback?t.argumentCallback(e):e;return s[i]}}const wte={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},vte={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},kte={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Ste={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},_te={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Tte={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Cte=(t,e)=>{const n=Number(t),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},Ete={ordinalNumber:Cte,era:ao({values:wte,defaultWidth:"wide"}),quarter:ao({values:vte,defaultWidth:"wide",argumentCallback:t=>t-1}),month:ao({values:kte,defaultWidth:"wide"}),day:ao({values:Ste,defaultWidth:"wide"}),dayPeriod:ao({values:_te,defaultWidth:"wide",formattingValues:Tte,defaultFormattingWidth:"wide"})};function lo(t){return(e,n={})=>{const r=n.width,s=r&&t.matchPatterns[r]||t.matchPatterns[t.defaultMatchWidth],i=e.match(s);if(!i)return null;const o=i[0],a=r&&t.parsePatterns[r]||t.parsePatterns[t.defaultParseWidth],l=Array.isArray(a)?jte(a,f=>f.test(o)):Nte(a,f=>f.test(o));let u;u=t.valueCallback?t.valueCallback(l):l,u=n.valueCallback?n.valueCallback(u):u;const d=e.slice(o.length);return{value:u,rest:d}}}function Nte(t,e){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return n}function jte(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return n}function DR(t){return(e,n={})=>{const r=e.match(t.matchPattern);if(!r)return null;const s=r[0],i=e.match(t.parsePattern);if(!i)return null;let o=t.valueCallback?t.valueCallback(i[0]):i[0];o=n.valueCallback?n.valueCallback(o):o;const a=e.slice(s.length);return{value:o,rest:a}}}const Ite=/^(\d+)(th|st|nd|rd)?/i,Dte=/\d+/i,Ate={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Mte={any:[/^b/i,/^(a|c)/i]},Rte={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Ote={any:[/1/i,/2/i,/3/i,/4/i]},Pte={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Lte={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},$te={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},zte={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Fte={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Bte={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Ute={ordinalNumber:DR({matchPattern:Ite,parsePattern:Dte,valueCallback:t=>parseInt(t,10)}),era:lo({matchPatterns:Ate,defaultMatchWidth:"wide",parsePatterns:Mte,defaultParseWidth:"any"}),quarter:lo({matchPatterns:Rte,defaultMatchWidth:"wide",parsePatterns:Ote,defaultParseWidth:"any",valueCallback:t=>t+1}),month:lo({matchPatterns:Pte,defaultMatchWidth:"wide",parsePatterns:Lte,defaultParseWidth:"any"}),day:lo({matchPatterns:$te,defaultMatchWidth:"wide",parsePatterns:zte,defaultParseWidth:"any"}),dayPeriod:lo({matchPatterns:Fte,defaultMatchWidth:"any",parsePatterns:Bte,defaultParseWidth:"any"})},Hte={code:"en-US",formatDistance:hte,formatLong:yte,formatRelative:bte,localize:Ete,match:Ute,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Vte(t,e){const n=Bs(t,e==null?void 0:e.in);return ate(n,dte(n))+1}function Wte(t,e){const n=Bs(t,e==null?void 0:e.in),r=+ng(n)-+lte(n);return Math.round(r/TR)+1}function AR(t,e){var d,f,h,p;const n=Bs(t,e==null?void 0:e.in),r=n.getFullYear(),s=Qg(),i=(e==null?void 0:e.firstWeekContainsDate)??((f=(d=e==null?void 0:e.locale)==null?void 0:d.options)==null?void 0:f.firstWeekContainsDate)??s.firstWeekContainsDate??((p=(h=s.locale)==null?void 0:h.options)==null?void 0:p.firstWeekContainsDate)??1,o=wo((e==null?void 0:e.in)||t,0);o.setFullYear(r+1,0,i),o.setHours(0,0,0,0);const a=Of(o,e),l=wo((e==null?void 0:e.in)||t,0);l.setFullYear(r,0,i),l.setHours(0,0,0,0);const u=Of(l,e);return+n>=+a?r+1:+n>=+u?r:r-1}function Kte(t,e){var a,l,u,d;const n=Qg(),r=(e==null?void 0:e.firstWeekContainsDate)??((l=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:l.firstWeekContainsDate)??n.firstWeekContainsDate??((d=(u=n.locale)==null?void 0:u.options)==null?void 0:d.firstWeekContainsDate)??1,s=AR(t,e),i=wo((e==null?void 0:e.in)||t,0);return i.setFullYear(s,0,r),i.setHours(0,0,0,0),Of(i,e)}function Gte(t,e){const n=Bs(t,e==null?void 0:e.in),r=+Of(n,e)-+Kte(n,e);return Math.round(r/TR)+1}function In(t,e){const n=t<0?"-":"",r=Math.abs(t).toString().padStart(e,"0");return n+r}const sa={y(t,e){const n=t.getFullYear(),r=n>0?n:1-n;return In(e==="yy"?r%100:r,e.length)},M(t,e){const n=t.getMonth();return e==="M"?String(n+1):In(n+1,2)},d(t,e){return In(t.getDate(),e.length)},a(t,e){const n=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(t,e){return In(t.getHours()%12||12,e.length)},H(t,e){return In(t.getHours(),e.length)},m(t,e){return In(t.getMinutes(),e.length)},s(t,e){return In(t.getSeconds(),e.length)},S(t,e){const n=e.length,r=t.getMilliseconds(),s=Math.trunc(r*Math.pow(10,n-3));return In(s,e.length)}},wc={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},dE={G:function(t,e,n){const r=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(t,e,n){if(e==="yo"){const r=t.getFullYear(),s=r>0?r:1-r;return n.ordinalNumber(s,{unit:"year"})}return sa.y(t,e)},Y:function(t,e,n,r){const s=AR(t,r),i=s>0?s:1-s;if(e==="YY"){const o=i%100;return In(o,2)}return e==="Yo"?n.ordinalNumber(i,{unit:"year"}):In(i,e.length)},R:function(t,e){const n=jR(t);return In(n,e.length)},u:function(t,e){const n=t.getFullYear();return In(n,e.length)},Q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return In(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return In(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(t,e,n){const r=t.getMonth();switch(e){case"M":case"MM":return sa.M(t,e);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(t,e,n){const r=t.getMonth();switch(e){case"L":return String(r+1);case"LL":return In(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(t,e,n,r){const s=Gte(t,r);return e==="wo"?n.ordinalNumber(s,{unit:"week"}):In(s,e.length)},I:function(t,e,n){const r=Wte(t);return e==="Io"?n.ordinalNumber(r,{unit:"week"}):In(r,e.length)},d:function(t,e,n){return e==="do"?n.ordinalNumber(t.getDate(),{unit:"date"}):sa.d(t,e)},D:function(t,e,n){const r=Vte(t);return e==="Do"?n.ordinalNumber(r,{unit:"dayOfYear"}):In(r,e.length)},E:function(t,e,n){const r=t.getDay();switch(e){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(t,e,n,r){const s=t.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return In(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(s,{width:"short",context:"formatting"});case"eeee":default:return n.day(s,{width:"wide",context:"formatting"})}},c:function(t,e,n,r){const s=t.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return In(i,e.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(s,{width:"narrow",context:"standalone"});case"cccccc":return n.day(s,{width:"short",context:"standalone"});case"cccc":default:return n.day(s,{width:"wide",context:"standalone"})}},i:function(t,e,n){const r=t.getDay(),s=r===0?7:r;switch(e){case"i":return String(s);case"ii":return In(s,e.length);case"io":return n.ordinalNumber(s,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(t,e,n){const s=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(t,e,n){const r=t.getHours();let s;switch(r===12?s=wc.noon:r===0?s=wc.midnight:s=r/12>=1?"pm":"am",e){case"b":case"bb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(t,e,n){const r=t.getHours();let s;switch(r>=17?s=wc.evening:r>=12?s=wc.afternoon:r>=4?s=wc.morning:s=wc.night,e){case"B":case"BB":case"BBB":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(t,e,n){if(e==="ho"){let r=t.getHours()%12;return r===0&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return sa.h(t,e)},H:function(t,e,n){return e==="Ho"?n.ordinalNumber(t.getHours(),{unit:"hour"}):sa.H(t,e)},K:function(t,e,n){const r=t.getHours()%12;return e==="Ko"?n.ordinalNumber(r,{unit:"hour"}):In(r,e.length)},k:function(t,e,n){let r=t.getHours();return r===0&&(r=24),e==="ko"?n.ordinalNumber(r,{unit:"hour"}):In(r,e.length)},m:function(t,e,n){return e==="mo"?n.ordinalNumber(t.getMinutes(),{unit:"minute"}):sa.m(t,e)},s:function(t,e,n){return e==="so"?n.ordinalNumber(t.getSeconds(),{unit:"second"}):sa.s(t,e)},S:function(t,e){return sa.S(t,e)},X:function(t,e,n){const r=t.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return hE(r);case"XXXX":case"XX":return ml(r);case"XXXXX":case"XXX":default:return ml(r,":")}},x:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"x":return hE(r);case"xxxx":case"xx":return ml(r);case"xxxxx":case"xxx":default:return ml(r,":")}},O:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+fE(r,":");case"OOOO":default:return"GMT"+ml(r,":")}},z:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+fE(r,":");case"zzzz":default:return"GMT"+ml(r,":")}},t:function(t,e,n){const r=Math.trunc(+t/1e3);return In(r,e.length)},T:function(t,e,n){return In(+t,e.length)}};function fE(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),s=Math.trunc(r/60),i=r%60;return i===0?n+String(s):n+String(s)+e+In(i,2)}function hE(t,e){return t%60===0?(t>0?"-":"+")+In(Math.abs(t)/60,2):ml(t,e)}function ml(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),s=In(Math.trunc(r/60),2),i=In(r%60,2);return n+s+e+i}const pE=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},MR=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},qte=(t,e)=>{const n=t.match(/(P+)(p+)?/)||[],r=n[1],s=n[2];if(!s)return pE(t,e);let i;switch(r){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",pE(r,e)).replace("{{time}}",MR(s,e))},Jte={p:MR,P:qte},Yte=/^D+$/,Xte=/^Y+$/,Qte=["D","DD","YY","YYYY"];function Zte(t){return Yte.test(t)}function ene(t){return Xte.test(t)}function tne(t,e,n){const r=nne(t,e,n);if(console.warn(r),Qte.includes(t))throw new RangeError(r)}function nne(t,e,n){const r=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${r} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const rne=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,sne=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ine=/^'([^]*?)'?$/,one=/''/g,ane=/[a-zA-Z]/;function Uy(t,e,n){var d,f,h,p,m,y,x,g;const r=Qg(),s=(n==null?void 0:n.locale)??r.locale??Hte,i=(n==null?void 0:n.firstWeekContainsDate)??((f=(d=n==null?void 0:n.locale)==null?void 0:d.options)==null?void 0:f.firstWeekContainsDate)??r.firstWeekContainsDate??((p=(h=r.locale)==null?void 0:h.options)==null?void 0:p.firstWeekContainsDate)??1,o=(n==null?void 0:n.weekStartsOn)??((y=(m=n==null?void 0:n.locale)==null?void 0:m.options)==null?void 0:y.weekStartsOn)??r.weekStartsOn??((g=(x=r.locale)==null?void 0:x.options)==null?void 0:g.weekStartsOn)??0,a=Bs(t,n==null?void 0:n.in);if(!ute(a))throw new RangeError("Invalid time value");let l=e.match(sne).map(v=>{const w=v[0];if(w==="p"||w==="P"){const S=Jte[w];return S(v,s.formatLong)}return v}).join("").match(rne).map(v=>{if(v==="''")return{isToken:!1,value:"'"};const w=v[0];if(w==="'")return{isToken:!1,value:lne(v)};if(dE[w])return{isToken:!0,value:v};if(w.match(ane))throw new RangeError("Format string contains an unescaped latin alphabet character `"+w+"`");return{isToken:!1,value:v}});s.localize.preprocessor&&(l=s.localize.preprocessor(a,l));const u={firstWeekContainsDate:i,weekStartsOn:o,locale:s};return l.map(v=>{if(!v.isToken)return v.value;const w=v.value;(!(n!=null&&n.useAdditionalWeekYearTokens)&&ene(w)||!(n!=null&&n.useAdditionalDayOfYearTokens)&&Zte(w))&&tne(w,e,String(t));const S=dE[w[0]];return S(a,w,s.localize,u)}).join("")}function lne(t){const e=t.match(ine);return e?e[1].replace(one,"'"):t}function cne(t,e,n){return NR(t,-e,n)}function td(t,e){const n=()=>wo(e==null?void 0:e.in,NaN),r=(e==null?void 0:e.additionalDigits)??2,s=hne(t);let i;if(s.date){const u=pne(s.date,r);i=mne(u.restDateString,u.year)}if(!i||isNaN(+i))return n();const o=+i;let a=0,l;if(s.time&&(a=gne(s.time),isNaN(a)))return n();if(s.timezone){if(l=yne(s.timezone),isNaN(l))return n()}else{const u=new Date(o+a),d=Bs(0,e==null?void 0:e.in);return d.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),d.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),d}return Bs(o+a+l,e==null?void 0:e.in)}const Kh={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},une=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,dne=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,fne=/^([+-])(\d{2})(?::?(\d{2}))?$/;function hne(t){const e={},n=t.split(Kh.dateTimeDelimiter);let r;if(n.length>2)return e;if(/:/.test(n[0])?r=n[0]:(e.date=n[0],r=n[1],Kh.timeZoneDelimiter.test(e.date)&&(e.date=t.split(Kh.timeZoneDelimiter)[0],r=t.substr(e.date.length,t.length))),r){const s=Kh.timezone.exec(r);s?(e.time=r.replace(s[1],""),e.timezone=s[1]):e.time=r}return e}function pne(t,e){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),r=t.match(n);if(!r)return{year:NaN,restDateString:""};const s=r[1]?parseInt(r[1]):null,i=r[2]?parseInt(r[2]):null;return{year:i===null?s:i*100,restDateString:t.slice((r[1]||r[2]).length)}}function mne(t,e){if(e===null)return new Date(NaN);const n=t.match(une);if(!n)return new Date(NaN);const r=!!n[4],s=nd(n[1]),i=nd(n[2])-1,o=nd(n[3]),a=nd(n[4]),l=nd(n[5])-1;if(r)return kne(e,a,l)?xne(e,a,l):new Date(NaN);{const u=new Date(0);return!wne(e,i,o)||!vne(e,s)?new Date(NaN):(u.setUTCFullYear(e,i,Math.max(s,o)),u)}}function nd(t){return t?parseInt(t):1}function gne(t){const e=t.match(dne);if(!e)return NaN;const n=Hy(e[1]),r=Hy(e[2]),s=Hy(e[3]);return Sne(n,r,s)?n*ER+r*CR+s*1e3:NaN}function Hy(t){return t&&parseFloat(t.replace(",","."))||0}function yne(t){if(t==="Z")return 0;const e=t.match(fne);if(!e)return 0;const n=e[1]==="+"?-1:1,r=parseInt(e[2]),s=e[3]&&parseInt(e[3])||0;return _ne(r,s)?n*(r*ER+s*CR):NaN}function xne(t,e,n){const r=new Date(0);r.setUTCFullYear(t,0,4);const s=r.getUTCDay()||7,i=(e-1)*7+n+1-s;return r.setUTCDate(r.getUTCDate()+i),r}const bne=[31,null,31,30,31,30,31,31,30,31,30,31];function RR(t){return t%400===0||t%4===0&&t%100!==0}function wne(t,e,n){return e>=0&&e<=11&&n>=1&&n<=(bne[e]||(RR(t)?29:28))}function vne(t,e){return e>=1&&e<=(RR(t)?366:365)}function kne(t,e,n){return e>=1&&e<=53&&n>=0&&n<=6}function Sne(t,e,n){return t===24?e===0&&n===0:n>=0&&n<60&&e>=0&&e<60&&t>=0&&t<25}function _ne(t,e){return e>=0&&e<=59}const Tne={lessThanXSeconds:{one:" 1 ",other:" {{count}} "},xSeconds:{one:"1 ",other:"{{count}} "},halfAMinute:"",lessThanXMinutes:{one:" 1 ",other:" {{count}} "},xMinutes:{one:"1 ",other:"{{count}} "},xHours:{one:"1 ",other:"{{count}} "},aboutXHours:{one:" 1 ",other:" {{count}} "},xDays:{one:"1 ",other:"{{count}} "},aboutXWeeks:{one:" 1 ",other:" {{count}} "},xWeeks:{one:"1 ",other:"{{count}} "},aboutXMonths:{one:" 1 ",other:" {{count}} "},xMonths:{one:"1 ",other:"{{count}} "},aboutXYears:{one:" 1 ",other:" {{count}} "},xYears:{one:"1 ",other:"{{count}} "},overXYears:{one:" 1 ",other:" {{count}} "},almostXYears:{one:" 1 ",other:" {{count}} "}},Cne=(t,e,n)=>{let r;const s=Tne[t];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",String(e)),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?r+"":r+"":r},Ene={full:"y''M''d'' EEEE",long:"y''M''d''",medium:"yyyy-MM-dd",short:"yy-MM-dd"},Nne={full:"zzzz a h:mm:ss",long:"z a h:mm:ss",medium:"a h:mm:ss",short:"a h:mm"},jne={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},Ine={date:cu({formats:Ene,defaultWidth:"full"}),time:cu({formats:Nne,defaultWidth:"full"}),dateTime:cu({formats:jne,defaultWidth:"full"})},Dne={lastWeek:"''eeee p",yesterday:"'' p",today:"'' p",tomorrow:"'' p",nextWeek:"''eeee p",other:"P"},Ane=(t,e,n,r)=>Dne[t],Mne={narrow:["",""],abbreviated:["",""],wide:["",""]},Rne={narrow:["1","2","3","4"],abbreviated:["","","",""],wide:["","","",""]},One={narrow:["","","","","","","","","","","",""],abbreviated:["1","2","3","4","5","6","7","8","9","10","11","12"],wide:["","","","","","","","","","","",""]},Pne={narrow:["","","","","","",""],short:["","","","","","",""],abbreviated:["","","","","","",""],wide:["","","","","","",""]},Lne={narrow:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},abbreviated:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},wide:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""}},$ne={narrow:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},abbreviated:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},wide:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""}},zne=(t,e)=>{const n=Number(t);switch(e==null?void 0:e.unit){case"date":return n+"";case"hour":return n+"";case"minute":return n+"";case"second":return n+"";default:return" "+n}},Fne={ordinalNumber:zne,era:ao({values:Mne,defaultWidth:"wide"}),quarter:ao({values:Rne,defaultWidth:"wide",argumentCallback:t=>t-1}),month:ao({values:One,defaultWidth:"wide"}),day:ao({values:Pne,defaultWidth:"wide"}),dayPeriod:ao({values:Lne,defaultWidth:"wide",formattingValues:$ne,defaultFormattingWidth:"wide"})},Bne=/^(\s*)?\d+(|||)?/i,Une=/\d+/i,Hne={narrow:/^()/i,abbreviated:/^()/i,wide:/^(|)/i},Vne={any:[/^()/i,/^()/i]},Wne={narrow:/^[1234]/i,abbreviated:/^[]/i,wide:/^[]/i},Kne={any:[/(1|)/i,/(2|)/i,/(3|)/i,/(4|)/i]},Gne={narrow:/^(|||||||||[])/i,abbreviated:/^(|||||||||[]|\d|1[12])/i,wide:/^(|||||||||[])/i},qne={narrow:[/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^(?!(|))/i,/^/i,/^/i],any:[/^|1/i,/^|2/i,/^|3/i,/^|4/i,/^|5/i,/^|6/i,/^|7/i,/^|8/i,/^|9/i,/^(?!(|))|10/i,/^|11/i,/^|12/i]},Jne={narrow:/^[]/i,short:/^[]/i,abbreviated:/^[]/i,wide:/^[]/i},Yne={any:[//i,//i,//i,//i,//i,//i,//i]},Xne={any:/^(?|?||[]|?||?|)/i},Qne={any:{am:/^?/i,pm:/^?/i,midnight:/^/i,noon:/^[]/i,morning:/^/i,afternoon:/^/i,evening:/^?/i,night:/^/i}},Zne={ordinalNumber:DR({matchPattern:Bne,parsePattern:Une,valueCallback:t=>parseInt(t,10)}),era:lo({matchPatterns:Hne,defaultMatchWidth:"wide",parsePatterns:Vne,defaultParseWidth:"any"}),quarter:lo({matchPatterns:Wne,defaultMatchWidth:"wide",parsePatterns:Kne,defaultParseWidth:"any",valueCallback:t=>t+1}),month:lo({matchPatterns:Gne,defaultMatchWidth:"wide",parsePatterns:qne,defaultParseWidth:"any"}),day:lo({matchPatterns:Jne,defaultMatchWidth:"wide",parsePatterns:Yne,defaultParseWidth:"any"}),dayPeriod:lo({matchPatterns:Xne,defaultMatchWidth:"any",parsePatterns:Qne,defaultParseWidth:"any"})},mE={code:"zh-TW",formatDistance:Cne,formatLong:Ine,formatRelative:Ane,localize:Fne,match:Zne,options:{weekStartsOn:1,firstWeekContainsDate:4}},Hs=64,OR=({onClose:t,isStandalone:e=!1})=>{const n=b.useContext(_n),{tasks:r,tags:s,updateTask:i,addTask:o,user:a,setEditingTaskId:l,editingTaskId:u}=n,[d,f]=b.useState(new Date),[h,p]=b.useState(()=>{const Z=localStorage.getItem("heart_schedule_tags");return Z?JSON.parse(Z):[]}),[m,y]=b.useState(!1),[x,g]=b.useState(!1),[v,w]=b.useState([]),[S,I]=b.useState(!1),[k,R]=b.useState(null),[C,T]=b.useState(null),[_,N]=b.useState(null),[j,O]=b.useState([]),P=S?j:s,G=b.useRef(null);b.useEffect(()=>{G.current&&(G.current.scrollTop=8*Hs-20)},[e]),b.useEffect(()=>{const Z=new URLSearchParams(window.location.search),K=Z.get("d"),de=Z.get("date"),ce=Z.get("tags");if(de&&f(td(de)),ce)try{const ke=JSON.parse(decodeURIComponent(ce));Array.isArray(ke)&&O(ke)}catch(ke){console.error("Failed to parse tags",ke)}if(K)try{const ke=decodeURIComponent(K);let _e;try{_e=JSON.parse(ke)}catch{console.warn("Direct JSON parse failed")}_e&&Array.isArray(_e)&&(w(_e),I(!0))}catch(ke){console.error("Failed to parse snapshot data",ke)}},[]),b.useEffect(()=>{if(!S||!Ne)return;const Z=window.location.pathname.split("/"),K=Z.indexOf("heart");if(K===-1||!Z[K+1])return;const de=Z[K+1];if(de==="share")return;const ce=Ne.channel(`guest-sync-${de}`).on("postgres_changes",{event:"*",schema:"public",table:"tasks",filter:`user_id=eq.${de}`},ke=>{const{eventType:_e,new:ve,old:Ke}=ke;w(je=>_e==="INSERT"?je.some(V=>V.id===ve.id)?je:[...je,ve]:_e==="UPDATE"?je.map(V=>V.id===ve.id?{...V,...ve}:V):_e==="DELETE"?je.filter(V=>V.id!==Ke.id):je)}).subscribe();return()=>{Ne.removeChannel(ce)}},[S]),b.useEffect(()=>{S&&v.length>0&&r.length>0&&w(Z=>Z.map(K=>{const de=r.find(ce=>ce.id===K.id);return de?{...K,...de}:K}))},[r]);const A=b.useMemo(()=>{if(!S)return null;const Z=window.location.pathname.split("/"),K=Z.indexOf("heart");if(K!==-1&&Z[K+1]){const de=Z[K+1];return de==="share"?null:de}return null},[S]),M=b.useMemo(()=>{const Z=K=>{if(K.start_date&&!K.is_all_day&&(!K.start_time||!K.end_time)){const de={...K},ce=new Date(K.start_date),ke=ce.getHours()*60+ce.getMinutes();if(de.start_time||(de.start_time=Te(ke)),!de.end_time&&(de.duration||K.duration)){const _e=Number(de.duration||K.duration);de.end_time=Te(ke+_e)}return de}return K};return{...n,tags:P,updateTask:async(K,de,ce)=>{if(K==="new"){T(_e=>({..._e,...de}));return}const ke=Z(de);S&&A&&Ne?await Ne.from("tasks").update(ke).eq("id",K):await i(K,ke,ce),S&&w(_e=>_e.map(ve=>ve.id===K?{...ve,...ke}:ve))},addTask:async(K,de)=>{const ce=Z(K);let ke=K.id||`guest-${Date.now()}`;K.id||(ke=crypto.randomUUID?crypto.randomUUID():`guest-${Date.now()}`);try{if(S&&A&&Ne){const _e={...ce,id:ke,user_id:A,created_at:new Date().toISOString(),status:"todo"},{error:ve}=await Ne.from("tasks").insert([_e]);if(ve)throw ve}else ke=await o(ce,de)}catch(_e){if(console.warn("Guest addTask failed",_e),!S)return""}if(S){const _e={id:ke,...ce,user_id:A};w(ve=>[...ve,_e])}return ke},deleteTask:async K=>{S&&A&&Ne?await Ne.from("tasks").delete().eq("id",K):await n.deleteTask(K),S&&(w(de=>de.filter(ce=>ce.id!==K)),_===K&&N(null))}}},[n,S,P,A,_]),Q=Z=>{p(K=>{if(K.includes(Z))return K.filter(ce=>ce!==Z);const de=[...K,Z];return localStorage.setItem("heart_schedule_tags",JSON.stringify(de)),de})};b.useEffect(()=>{const Z=async K=>{var ce;if(!_||u)return;const de=(ce=document.activeElement)==null?void 0:ce.tagName;if(!(de==="INPUT"||de==="TEXTAREA"||document.activeElement.isContentEditable)&&(K.key==="Delete"||K.key==="Backspace")&&(K.preventDefault(),window.confirm(""))){const ke=_;await M.deleteTask(ke),N(null)}};return window.addEventListener("keydown",Z),()=>window.removeEventListener("keydown",Z)},[_,u,M]);const X=b.useMemo(()=>{if(S)return v;const K=!r.some(ce=>{const ke=ce.start_date?td(ce.start_date):ce.due_date?td(ce.due_date):null;return ke&&By(ke,d)&&ce.status!=="deleted"})&&v.length>0;return(K?v:r).filter(ce=>{if(ce.status==="deleted")return!1;let ke=null;return ce.start_date?ke=td(ce.start_date):ce.due_date&&(ke=td(ce.due_date)),!ke||!By(ke,d)?!1:K||h.length===0?!0:!ce.tags||ce.tags.length===0?!1:ce.tags.some(_e=>h.includes(_e))})},[r,d,h,v,S]),D=Z=>{if(!Z)return 0;const[K,de]=Z.split(":").map(Number);return K*60+de},Te=Z=>{const K=Math.floor(Z/60),de=Math.floor(Z%60);return`${String(K).padStart(2,"0")}:${String(de).padStart(2,"0")}`},xe=Z=>{const K=D(Z.start_time);let de=Z.duration||60;const ce=K/60*Hs,ke=de/60*Hs;return{top:`${ce}px`,height:`${Math.max(24,ke)}px`}},U=Z=>{if(Z.length===0)return{};const K=Z.map(ve=>({id:ve.id,start:D(ve.start_time),end:D(ve.start_time)+(ve.duration||60)})).sort((ve,Ke)=>ve.start-Ke.start),de=[];let ce=[],ke=-1;K.forEach(ve=>{ce.length===0?(ce.push(ve),ke=ve.end):ve.start<ke?(ce.push(ve),ke=Math.max(ke,ve.end)):(de.push(ce),ce=[ve],ke=ve.end)}),ce.length>0&&de.push(ce);const _e={};return de.forEach(ve=>{const Ke=[];ve.forEach(ne=>{let pe=!1;for(let ee=0;ee<Ke.length;ee++){const ye=Ke[ee],Pe=ye[ye.length-1];if(ne.start>=Pe.end){ye.push(ne),pe=!0;break}}pe||Ke.push([ne])});const V=100/Ke.length,re={},se=[];ve.forEach(ne=>{let pe=!1;for(let ee=0;ee<se.length;ee++){const ye=se[ee],Pe=ye[ye.length-1];if(ne.start>=Pe.end){ye.push(ne),re[ne.id]=ee,pe=!0;break}}pe||(se.push([ne]),re[ne.id]=se.length-1)}),ve.forEach(ne=>{const pe=re[ne.id];_e[ne.id]={left:`${pe*V}%`,width:`${V}%`}})}),_e},[z,ie]=b.useState(null),Be=(Z,K,de)=>{Z.stopPropagation(),Z.preventDefault();const ce=D(K.start_time);ie({taskId:K.id,initialY:Z.clientY,originalStartMin:ce,originalDuration:K.duration||60,type:de,currentStartMin:ce,currentDuration:K.duration||60})},st=Z=>{N(null);const K=Z.currentTarget.getBoundingClientRect(),de=Z.clientY-K.top,ce=Math.floor(de/Hs*60/15)*15;R({startY:Z.clientY,startMin:ce,currentDuration:60})};b.useEffect(()=>{if(!z&&!k)return;const Z=de=>{if(z){const ce=de.clientY-z.initialY,ke=Math.round(ce/Hs*60/15)*15;if(z.type==="move"){let _e=z.originalStartMin+ke;_e=Math.max(0,Math.min(1440-z.currentDuration,_e)),ie(ve=>ve?{...ve,currentStartMin:_e}:null)}else{let _e=z.originalDuration+ke;_e=Math.max(15,_e),ie(ve=>ve?{...ve,currentDuration:_e}:null)}}else if(k){const ce=de.clientY-k.startY;let _e=60+Math.round(ce/Hs*60/15)*15;_e<15&&(_e=15),R(ve=>ve?{...ve,currentDuration:_e}:null)}},K=()=>{if(z){const{taskId:de,currentStartMin:ce,currentDuration:ke}=z,_e=Te(ce),ve=Te(ce+ke),Ke=new Date(d);Ke.setHours(Math.floor(ce/60)),Ke.setMinutes(ce%60);const je={start_time:_e,duration:ke,end_time:ve,start_date:Ke.toISOString()};i(de,je),S&&w(V=>V.map(re=>re.id===de?{...re,...je}:re)),ie(null)}else if(k){const de=new Date(d);de.setHours(Math.floor(k.startMin/60)),de.setMinutes(k.startMin%60);let ce=P.find(_e=>{const ve=_e.name.toLowerCase();return S?ve.includes("wei"):ve.includes("google")&&ve.includes("")});const ke={id:"new",title:"",start_time:Te(k.startMin),duration:k.currentDuration,end_time:Te(k.startMin+k.currentDuration),start_date:de.toISOString(),is_all_day:!1,tags:ce?[ce.id]:[]};T(ke),l("new"),R(null)}};return window.addEventListener("mousemove",Z),window.addEventListener("mouseup",K),()=>{window.removeEventListener("mousemove",Z),window.removeEventListener("mouseup",K)}},[z,k,d,i,S,s]);const ae=()=>{const Z=X;if(Z.length===0&&!confirm(""))return;const K=Z.map(re=>({id:re.id,title:re.title,start_time:re.start_time,end_time:re.end_time,status:re.status,tags:re.tags,duration:re.duration,start_date:re.start_date})),de=new Set(K.flatMap(re=>re.tags||[])),ce=s.filter(re=>de.has(re.id)).map(re=>({id:re.id,name:re.name,color:re.color})),ke=JSON.stringify(ce),_e=encodeURIComponent(ke),ve=JSON.stringify(K),Ke=encodeURIComponent(ve),je=Uy(d,"yyyy-MM-dd"),V=`${window.location.origin}/share/heart/${(a==null?void 0:a.id)||"share"}?date=${je}&d=${Ke}&tags=${_e}`;navigator.clipboard.writeText(V),alert(`( ${K.length} )`),g(!1)};return c.jsxs("div",{className:"fixed inset-0 z-[1000] bg-white/95 backdrop-blur-xl flex flex-col overflow-hidden font-sans text-gray-800",children:[c.jsx("div",{className:"absolute top-0 right-0 w-[50vh] h-[50vh] bg-pink-200/20 rounded-full blur-[100px] pointer-events-none"}),c.jsx("div",{className:"absolute bottom-0 left-0 w-[50vh] h-[50vh] bg-purple-200/20 rounded-full blur-[100px] pointer-events-none"}),c.jsxs("header",{className:"flex-shrink-0 px-6 py-4 flex items-center justify-between relative z-10 bg-white/50 backdrop-blur-sm border-b border-pink-100",children:[!e&&t&&c.jsx("button",{onClick:t,className:"p-2 rounded-full hover:bg-gray-100 text-gray-500",children:c.jsx(on,{size:20})}),e&&c.jsx("div",{className:"w-10"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(tm,{className:"text-pink-500 fill-pink-500 animate-pulse",size:24}),c.jsx("span",{className:"text-lg font-bold tracking-wide bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent",children:"Our Time"})]}),c.jsxs("div",{className:"flex gap-2",children:[S&&c.jsx("button",{onClick:()=>{I(!1),window.history.replaceState({},"",window.location.pathname)},className:"text-xs bg-amber-100 text-amber-700 px-3 py-1 rounded-full font-medium",children:" ()"}),c.jsx("button",{onClick:()=>y(!m),className:`p-2 rounded-full transition-colors ${m?"bg-pink-100 text-pink-600":"hover:bg-gray-100 text-gray-500"}`,children:c.jsx(LI,{size:20})}),c.jsx("button",{onClick:()=>g(!0),className:"p-2 rounded-full bg-pink-50 text-pink-500 hover:bg-pink-100",children:c.jsx(M6,{size:20})})]})]}),c.jsxs("div",{className:"flex items-center justify-between px-6 py-3 relative z-10 bg-white/30 backdrop-blur-sm border-b border-gray-100",children:[c.jsx("button",{onClick:()=>f(cne(d,1)),className:"p-1 text-gray-400 hover:text-pink-500",children:c.jsx(Du,{})}),c.jsxs("div",{className:"text-center cursor-pointer",onClick:()=>f(new Date),children:[c.jsx("div",{className:"text-xl font-bold text-gray-800",children:Uy(d,"M d",{locale:mE})}),c.jsx("div",{className:"text-xs text-pink-500 font-medium tracking-widest uppercase",children:Uy(d,"EEEE",{locale:mE})})]}),c.jsx("button",{onClick:()=>f(NR(d,1)),className:"p-1 text-gray-400 hover:text-pink-500",children:c.jsx(ts,{})})]}),c.jsx(go,{children:m&&c.jsx(Rr.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"overflow-hidden border-b border-gray-100 bg-gray-50/80 backdrop-blur",children:c.jsxs("div",{className:"p-4",children:[c.jsx("div",{className:"text-xs text-gray-500 mb-2 font-medium",children:""}),c.jsx("div",{className:"flex flex-wrap gap-2",children:P.map(Z=>c.jsx("button",{onClick:()=>Q(Z.id),className:`px-3 py-1 rounded-full text-xs transition-all border ${h.includes(Z.id)?"bg-pink-500 text-white border-pink-500 shadow-md transform scale-105":"bg-white text-gray-600 border-gray-200"}`,children:Z.name},Z.id))})]})})}),c.jsx("div",{ref:G,className:"flex-1 overflow-y-auto relative z-0 hide-scrollbar scroll-smooth",children:c.jsxs("div",{className:"relative min-h-[1536px] w-full bg-white/40 cursor-crosshair",onMouseDown:st,children:[Array.from({length:24}).map((Z,K)=>c.jsxs("div",{className:"absolute w-full border-t border-gray-100 flex pointer-events-none",style:{top:K*Hs,height:Hs},children:[c.jsxs("div",{className:"w-14 text-[10px] text-gray-400 font-mono text-right pr-2 -mt-2 select-none",children:[K.toString().padStart(2,"0"),":00"]}),c.jsx("div",{className:"flex-1 border-l border-gray-50 h-full relative",children:c.jsx("div",{className:"absolute top-1/2 w-full border-t border-gray-50 border-dashed"})})]},K)),By(new Date,d)&&c.jsx("div",{className:"absolute left-14 right-0 border-t-2 border-red-400 z-20 pointer-events-none flex items-center",style:{top:(new Date().getHours()*60+new Date().getMinutes())/60*Hs},children:c.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full -ml-1"})}),k&&c.jsx("div",{className:"absolute left-16 right-2 bg-pink-100/50 border-2 border-pink-400 border-dashed rounded-xl z-30 pointer-events-none",style:{top:`${k.startMin/60*Hs}px`,height:`${k.currentDuration/60*Hs}px`},children:c.jsxs("div",{className:"p-2 text-xs font-bold text-pink-600",children:[Te(k.startMin)," - ",Te(k.startMin+k.currentDuration)," ..."]})}),c.jsx("div",{className:"absolute top-0 right-2 left-16 bottom-0 pointer-events-none",children:X.map(Z=>{const K=(z==null?void 0:z.taskId)===Z.id,de=K?null:U(X)[Z.id],ce=K?{top:`${z.currentStartMin/60*Hs}px`,height:`${z.currentDuration/60*Hs}px`,left:"0%",width:"100%",zIndex:50}:{...xe(Z),left:(de==null?void 0:de.left)||"0%",width:(de==null?void 0:de.width)||"100%"};let ke="#ec4899";if(Z.tags&&Z.tags.length>0){const ve=P.filter(je=>Z.tags.includes(je.id)),Ke=ve.find(je=>je.name.toLowerCase().includes("google"))||ve[0];Ke&&Ke.color&&(ke=Ke.color)}const _e=Z.status==="completed"?{}:{borderColor:ke,backgroundColor:`${ke}1A`,borderLeftWidth:"4px",borderLeftColor:ke};return c.jsxs("div",{style:{...ce,..._e},className:`absolute w-full rounded-r-xl rounded-l-md border p-2 text-xs flex flex-col overflow-hidden transition-all shadow-sm group pointer-events-auto
                                        ${Z.status==="completed"?"bg-gray-50 border-gray-200 opacity-60":"hover:shadow-md"}
                                        ${K?"shadow-xl ring-2 ring-pink-400 opacity-90 cursor-grabbing":"cursor-grab"}
                                        ${_===Z.id?"ring-2 ring-pink-500 z-10 shadow-md":""}
                                    `,onClick:ve=>{ve.stopPropagation(),K||N(Z.id)},onDoubleClick:ve=>{ve.stopPropagation(),K||(l(Z.id),T(null))},onMouseDown:ve=>Be(ve,Z,"move"),children:[_===Z.id&&c.jsx("div",{className:"absolute top-1 right-1 p-1.5 bg-red-500 text-white rounded-full shadow-lg z-50 cursor-pointer transform hover:scale-110 active:scale-95 transition-all",onClick:ve=>{ve.stopPropagation(),window.confirm("")&&(M.deleteTask(Z.id),N(null))},children:c.jsx(Ar,{size:14})}),c.jsxs("div",{className:"flex items-center gap-1 font-bold text-gray-800 shrink-0",children:[c.jsx("div",{className:"w-2 h-2 rounded-full mb-0.5",style:{backgroundColor:Z.status==="completed"?"#9ca3af":ke}}),c.jsx("span",{className:"truncate",children:Z.title}),Z.status==="completed"&&c.jsx(Cg,{size:12,className:"text-gray-400"})]}),c.jsx("div",{className:"text-[10px] text-gray-500 truncate shrink-0 font-mono",children:K?`${Te(z.currentStartMin)} - ${Te(z.currentStartMin+z.currentDuration)}`:`${Z.start_time} - ${Z.end_time||Te(D(Z.start_time)+(Z.duration||60))}`}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-3 cursor-ns-resize flex items-center justify-center opacity-0 group-hover:opacity-100 hover:bg-black/5",onMouseDown:ve=>Be(ve,Z,"resize"),children:c.jsx(TI,{size:12,className:"text-gray-400"})})]},Z.id)})}),X.length===0&&!k&&c.jsxs("div",{className:"absolute top-1/3 left-0 right-0 text-center text-gray-400 pointer-events-none",children:[c.jsx(tm,{size:48,className:"mx-auto mb-2 opacity-20"}),c.jsxs("p",{children:["",c.jsx("br",{}),c.jsx("span",{className:"text-xs opacity-50",children:""})]})]})]})}),c.jsx(go,{children:x&&c.jsx("div",{className:"fixed inset-0 z-[1100] bg-black/40 backdrop-blur-sm flex items-center justify-center p-4",children:c.jsxs(Rr.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl",children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsx("h3",{className:"text-xl font-bold",children:""}),c.jsx("button",{onClick:()=>g(!1),children:c.jsx(on,{size:20})})]}),c.jsx("div",{className:"bg-pink-50 rounded-xl p-4 flex flex-col items-center mb-6",children:c.jsxs("p",{className:"text-center text-sm text-gray-600",children:["",c.jsx("br",{}),""]})}),c.jsxs("button",{onClick:ae,className:"w-full py-3 bg-gray-900 text-white rounded-xl font-medium flex items-center justify-center gap-2",children:[c.jsx(x6,{size:18}),""]})]})})}),u&&c.jsx(_n.Provider,{value:M,children:c.jsx("div",{className:"absolute inset-0 z-[1200]",children:c.jsx(pb,{initialData:u==="new"?C:S?v.find(Z=>Z.id===u):r.find(Z=>Z.id===u),onClose:()=>{l(null),T(null)}})})})]})},ere=()=>{const{user:t,logout:e,syncStatus:n,view:r,setView:s,tagFilter:i,setTagFilter:o,tasks:a,tags:l,toast:u,setToast:d,undo:f,redo:h,canUndo:p,canRedo:m,canNavigateBack:y,navigateBack:x,archiveCompletedTasks:g,editingTaskId:v,setEditingTaskId:w,themeSettings:S,sidebarWidth:I,setSidebarWidth:k,sidebarCollapsed:R,selectedTaskIds:C,dragState:T}=b.useContext(_n),[_,N]=b.useState(!1),[j,O]=b.useState(!1),[P,G]=b.useState(!1),[A,M]=b.useState(!1),[Q,X]=b.useState(!1),[D,Te]=b.useState(!1),[xe,U]=b.useState(!1),[z,ie]=b.useState(typeof window<"u"&&window.innerWidth<768);b.useEffect(()=>{const V=()=>ie(window.innerWidth<768);return window.addEventListener("resize",V),()=>window.removeEventListener("resize",V)},[]);const[Be,st]=b.useState(()=>{const V=localStorage.getItem("fabPosition");return V?JSON.parse(V):{x:window.innerWidth-80,y:window.innerHeight-80}}),[ae,Z]=b.useState(!1),K=b.useRef({x:0,y:0});b.useEffect(()=>{const V=se=>{if(ae){const ne=Math.max(20,Math.min(window.innerWidth-70,se.clientX-K.current.x)),pe=Math.max(20,Math.min(window.innerHeight-70,se.clientY-K.current.y));st({x:ne,y:pe})}},re=()=>{ae&&(Z(!1),localStorage.setItem("fabPosition",JSON.stringify(Be)))};return window.addEventListener("mousemove",V),window.addEventListener("mouseup",re),()=>{window.removeEventListener("mousemove",V),window.removeEventListener("mouseup",re)}},[ae,Be]);const de={small:"text-sm",normal:"text-base",large:"text-lg"}[S.fontSize]||"text-base",ce=S.fontWeight==="thin"?"font-light":"font-bold",ke=S.fontFamily==="things"?"font-things":"font-sans",_e=v?a.find(V=>V.id===v):null;b.useEffect(()=>{const V=re=>{re.key==="k"&&(re.metaKey||re.ctrlKey)&&(re.preventDefault(),N(se=>!se)),re.key==="Escape"&&(v?w(null):D?Te(!1):N(!1)),(re.metaKey||re.ctrlKey)&&re.shiftKey&&re.code==="KeyM"&&C.length>0&&(re.preventDefault(),Te(!0))};return window.addEventListener("keydown",V),()=>window.removeEventListener("keydown",V)},[v,w,C,D]),b.useEffect(()=>{const V=se=>{if(!j)return;let ne=se.clientX;ne<150&&(ne=150),ne>400&&(ne=400),k(ne)},re=()=>{O(!1),document.body.style.cursor="default"};return j&&(window.addEventListener("mousemove",V),window.addEventListener("mouseup",re),document.body.style.cursor="col-resize"),()=>{window.removeEventListener("mousemove",V),window.removeEventListener("mouseup",re)}},[j]);const ve=()=>{var V;return i?((V=l.find(re=>re.id===i))==null?void 0:V.name)||"Tags":r==="focus"?"Focus":r.charAt(0).toUpperCase()+r.slice(1)},Ke=T!=null&&T.draggedId?a.find(V=>V.id===T.draggedId):null,je=C.includes((T==null?void 0:T.draggedId)||"")?C.length:1;return c.jsxs("div",{"data-theme":S.themeMode&&S.themeMode!=="light"?S.themeMode:void 0,className:`flex h-screen bg-theme-main text-theme-primary ${ke} selection:bg-indigo-50 selection:text-indigo-900`,children:[(T==null?void 0:T.isDragging)&&Ke&&c.jsx(Yee,{task:Ke,position:T.ghostPosition,count:je}),c.jsxs("div",{style:{width:R?64:I},className:`relative flex-shrink-0 hidden md:block transition-all duration-300 ease-in-out ${T!=null&&T.isDragging,"z-10"}`,children:[c.jsx(rE,{view:r,setView:s,tagFilter:i,setTagFilter:o}),!R&&!(T!=null&&T.isDragging)&&c.jsx("div",{className:"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-theme-main/10 transition-colors z-50",onMouseDown:()=>O(!0)})]}),P&&c.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 md:hidden",onClick:()=>G(!1),children:c.jsx("div",{className:"absolute left-0 top-0 h-full w-[280px] bg-theme-sidebar shadow-2xl animate-in slide-in-from-left duration-200",onClick:V=>V.stopPropagation(),children:c.jsx(rE,{view:r,setView:V=>{s(V),G(!1)},tagFilter:i,setTagFilter:V=>{o(V),G(!1)}})})}),c.jsxs("main",{className:"flex-1 flex flex-col relative overflow-hidden bg-theme-main",children:[c.jsxs("header",{"data-app-header":"true",className:"h-14 flex items-center justify-between px-4 md:px-8 border-b border-theme z-30 sticky top-0 bg-theme-header backdrop-blur-sm",children:[c.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[c.jsx("button",{className:"md:hidden p-1 -ml-2 text-theme-secondary hover:bg-theme-hover rounded",onClick:()=>G(!0),children:c.jsx(_6,{size:20})}),y&&c.jsxs("button",{onClick:x,className:"p-1 hover:bg-theme-hover rounded text-theme-secondary flex items-center gap-1 text-sm font-medium transition-colors",title:" (Alt + Left)",children:[c.jsx(SI,{size:16}),c.jsx("span",{className:"hidden md:inline",children:""})]}),y&&c.jsx("span",{className:"text-theme-secondary",children:"|"}),c.jsx("h2",{className:`${de} ${ce} tracking-tight text-theme-primary`,children:ve()})]}),c.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[C.length===1&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:()=>M(!0),className:"p-1.5 rounded hover:bg-indigo-500/10 text-indigo-400 transition-colors animate-in zoom-in duration-200 flex items-center gap-1",title:"72 (Mission 72 Transformations)",children:[c.jsx("span",{className:"text-xl leading-none filter drop-shadow-sm",children:""}),c.jsx("span",{className:"hidden lg:inline text-xs font-bold text-indigo-400",children:"72"})]}),c.jsxs("button",{onClick:()=>X(!0),className:"p-1.5 rounded hover:bg-amber-500/10 text-amber-500 transition-colors animate-in zoom-in duration-200 flex items-center gap-1",title:"GTD ",children:[c.jsx("span",{className:"text-xl leading-none filter drop-shadow-sm",children:""}),c.jsx("span",{className:"hidden lg:inline text-xs font-bold text-amber-600",children:""})]})]}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1"}),c.jsxs("button",{onClick:g,className:"p-1.5 rounded hover:bg-theme-hover text-theme-tertiary hover:text-emerald-500 transition-colors",title:" (Archive Completed)",children:[" ",c.jsx(em,{size:16})," "]}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1"}),c.jsx("button",{disabled:!p,onClick:f,className:`p-1 rounded hover:bg-theme-hover ${p?"opacity-100":"opacity-30"}`,title:" (Ctrl+Z)",children:c.jsx(Cw,{size:14})}),c.jsx("button",{disabled:!m,onClick:h,className:`p-1 rounded hover:bg-theme-hover ${m?"opacity-100":"opacity-30"}`,title:" (Ctrl+Shift+Z)",children:c.jsx(MI,{size:14})}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1"}),(t==null?void 0:t.email)==="bibo1243@gmail.com"&&c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:()=>U(!0),className:"p-1.5 rounded-full hover:bg-pink-50 text-pink-400 hover:text-pink-600 transition-colors",title:" (Shared Schedule)",children:c.jsx(tm,{size:18,className:xe?"fill-pink-500 text-pink-500":""})}),c.jsx("div",{className:"w-px h-4 bg-theme-hover mx-1"})]}),c.jsx(nte,{})]}),c.jsxs("div",{className:"flex items-center gap-1.5 pl-2 border-l border-theme ml-1",children:[c.jsxs("div",{className:"hidden md:flex flex-col items-end group relative",children:[c.jsx("span",{className:"text-[9px] text-theme-tertiary uppercase tracking-wider font-bold leading-none mb-0.5",children:"User"}),c.jsx("span",{className:"text-[10px] font-mono text-theme-secondary leading-none cursor-help",title:t==null?void 0:t.id,children:t!=null&&t.email?t.email:(t==null?void 0:t.id)==="00000000-0000-0000-0000-000000000000"?"Demo":t!=null&&t.id?`ID: ${t.id.slice(0,6)}...`:"Guest"})]}),c.jsxs("div",{className:"w-6 h-6 rounded-full bg-indigo-500/20 text-indigo-400 flex items-center justify-center border border-indigo-500/30 relative group cursor-pointer",title:" (Logout)",onClick:e,children:[c.jsx(FI,{size:12,className:"group-hover:hidden"}),c.jsx(k6,{size:12,className:"hidden group-hover:block text-red-500"})]})]}),c.jsxs("div",{className:`flex items-center gap-1 text-[10px] ml-1 ${n==="synced"?"text-green-500":n==="error"?"text-red-500":"text-orange-400"}`,children:[n==="synced"?c.jsx(n6,{size:12}):c.jsx(t6,{size:12,className:"animate-pulse"}),c.jsx("span",{className:"uppercase tracking-wider hidden lg:inline",children:n==="synced"?"Synced":n==="error"?"Error":"Syncing..."})]}),n==="error"&&c.jsx("div",{className:"text-[10px] text-red-500 flex items-center gap-1",children:c.jsx(Vf,{size:12})})]})]}),c.jsx(Wee,{}),c.jsx("div",{className:`flex-1 overflow-y-auto scroll-smooth no-scrollbar prevent-pull-refresh ${r!=="focus"&&r!=="project"&&r!=="annualplan"?"p-2 md:p-4":""}`,children:r==="journal"?c.jsx(Aee,{}):r==="focus"?c.jsx(zee,{}):r==="project"?c.jsx(Uee,{}):r==="annualplan"?c.jsx(Vee,{}):r==="matrix"?c.jsx(qee,{}):r==="worklog"?c.jsx(Jee,{}):c.jsx("div",{className:"w-full md:w-[calc(100%-100px)] mx-auto mt-2 md:mt-8",children:c.jsx(bR,{})})}),v&&(r==="calendar"||r==="journal"||r==="focus")&&_e&&c.jsx(pb,{initialData:_e,onClose:()=>w(null)}),c.jsx("button",{onMouseDown:V=>{K.current={x:V.clientX-Be.x,y:V.clientY-Be.y};const re=V.clientX,se=V.clientY,ne=pe=>{(Math.abs(pe.clientX-re)>5||Math.abs(pe.clientY-se)>5)&&(Z(!0),window.removeEventListener("mousemove",ne))};window.addEventListener("mousemove",ne),window.addEventListener("mouseup",()=>window.removeEventListener("mousemove",ne),{once:!0})},onClick:()=>{ae||N(!0)},style:{left:Be.x,top:Be.y},className:`fixed z-40 h-14 w-14 rounded-full bg-indigo-600 text-white shadow-xl hover:bg-indigo-700 transition-all flex items-center justify-center group fab-mobile md:fab-desktop ${ae?"cursor-grabbing scale-110":"cursor-grab hover:scale-105 active:scale-95"}`,title:"Create New Task (Drag to move)",children:c.jsx(Ki,{size:28,className:"group-hover:rotate-90 transition-transform duration-200"})}),_&&!z&&c.jsx(pb,{onClose:()=>N(!1)}),_&&z&&c.jsx(lE,{taskId:void 0,onClose:()=>N(!1)}),A&&C.length===1&&c.jsx(Gee,{taskId:C[0],onClose:()=>M(!1)}),Q&&C.length===1&&c.jsx(ste,{taskId:C[0],onClose:()=>X(!1)}),u&&c.jsx(Kee,{toast:u,onClose:()=>d(null)}),v&&z&&c.jsx(lE,{taskId:v,onClose:()=>w(null)}),D&&c.jsx(Qee,{onClose:()=>Te(!1)}),xe&&c.jsx(OR,{onClose:()=>U(!1)})]})]})},tre=()=>{const[t,e]=b.useState(!1),[n,r]=b.useState(""),[s,i]=b.useState(""),[o,a]=b.useState("signin"),[l,u]=b.useState(null),[d,f]=b.useState(null),h=async p=>{p.preventDefault(),e(!0),u(null),f(null);let m=n,y=s;n.toLowerCase()==="demo"&&s.toLowerCase()==="demo"&&(m="demo@demo.com",y="demodemo");try{if(!Ne)throw new Error("Supabase client not initialized");if(o==="signup"){const{data:x,error:g}=await Ne.auth.signUp({email:m,password:y});if(g)throw g;x.session?(f("..."),setTimeout(()=>{window.location.reload()},500)):x.user&&!x.session&&f("")}else{const{error:x}=await Ne.auth.signInWithPassword({email:m,password:y});if(x)throw x;window.location.reload()}}catch(x){u(x.message)}finally{e(!1)}};return c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:c.jsxs("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[c.jsxs("div",{className:"flex flex-col items-center mb-8",children:[c.jsx("div",{className:"w-12 h-12 bg-indigo-600 rounded-xl flex items-center justify-center text-white mb-4 shadow-lg shadow-indigo-200",children:c.jsx(e1,{size:24})}),c.jsx("h1",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:"Things Clone"}),c.jsx("p",{className:"text-sm text-gray-500 mt-2",children:""})]}),l&&c.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-600 text-sm rounded-lg border border-red-100",children:l}),d&&c.jsx("div",{className:"mb-4 p-3 bg-green-50 text-green-600 text-sm rounded-lg border border-green-100",children:d}),c.jsxs("form",{onSubmit:h,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1 ml-1",children:"Email"}),c.jsxs("div",{className:"relative",children:[c.jsx(S6,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),c.jsx("input",{type:"text",required:!0,value:n,onChange:p=>r(p.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-100 focus:border-indigo-400 outline-none transition-all text-sm",placeholder:"name@example.com  demo"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1 ml-1",children:"Password"}),c.jsxs("div",{className:"relative",children:[c.jsx(Ma,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),c.jsx("input",{type:"password",required:!0,value:s,onChange:p=>i(p.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-100 focus:border-indigo-400 outline-none transition-all text-sm",placeholder:"",minLength:6})]})]}),c.jsx("button",{type:"submit",disabled:t,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2.5 rounded-lg transition-all flex items-center justify-center gap-2 shadow-lg shadow-indigo-100 disabled:opacity-70 disabled:cursor-not-allowed",children:t?c.jsx(Hi,{className:"animate-spin",size:18}):c.jsxs(c.Fragment,{children:[o==="signin"?"":"",c.jsx(wI,{size:16})]})})]}),c.jsx("div",{className:"mt-6 text-center",children:c.jsx("button",{type:"button",onClick:()=>a(o==="signin"?"signup":"signin"),className:"text-sm text-indigo-600 hover:text-indigo-500 font-medium",children:o==="signin"?"":""})}),c.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-100",children:[c.jsx("p",{className:"text-xs text-gray-400 text-center mb-3",children:" Demo "}),c.jsx("button",{type:"button",onClick:async()=>{e(!0),u(null);try{if(!Ne)throw new Error("Supabase client not initialized");const{error:p}=await Ne.auth.signInWithPassword({email:"demo@demo.com",password:"demodemo"});if(p)throw p;window.location.reload()}catch(p){u("Demo : "+p.message)}finally{e(!1)}},disabled:t,className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 rounded-lg transition-all flex items-center justify-center gap-2 text-sm disabled:opacity-70",children:" Demo "}),c.jsxs("p",{className:"text-[10px] text-gray-400 text-center mt-2",children:[" ",c.jsx("span",{className:"font-mono font-bold",children:"demo"})," "]})]})]})})},nre=()=>{const{isRecording:t,recordingTime:e,stopRecording:n,analyser:r,recordingTaskId:s}=b.useContext(Iu),{setFocusedTaskId:i,tasks:o,setView:a,setExpandedTaskIds:l,setEditingTaskId:u}=b.useContext(_n),[d,f]=b.useState(!1),h=b.useRef(null),p=b.useRef(),m=()=>{if(!s)return;a("allview");const x=o.find(g=>g.id===s);if(x){let g=x;const v=[];for(;g.parent_id;){v.push(g.parent_id);const w=o.find(S=>S.id===g.parent_id);if(!w)break;g=w}v.length>0&&l(w=>[...new Set([...w,...v])])}i(s),u(s),f(!1)};if(b.useEffect(()=>{if(!t||!r||!h.current)return;const x=h.current,g=x.getContext("2d");if(!g)return;const v=r.frequencyBinCount,w=new Uint8Array(v),S=()=>{if(!r)return;p.current=requestAnimationFrame(S),r.getByteTimeDomainData(w),g.clearRect(0,0,x.width,x.height),g.lineWidth=2,g.strokeStyle="rgba(255, 255, 255, 0.8)",g.beginPath();const I=x.width/v;let k=0;for(let R=0;R<v;R++){const T=w[R]/128*x.height/2;R===0?g.moveTo(k,T):g.lineTo(k,T),k+=I}g.lineTo(x.width,x.height/2),g.stroke()};return S(),()=>{p.current&&cancelAnimationFrame(p.current)}},[t,r]),!t)return null;const y=x=>{const g=Math.floor(x/1e3),v=Math.floor(g/60),w=g%60;return`${v.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`};return d?c.jsx("div",{className:"fixed bottom-6 left-6 z-[99999] animate-in fade-in zoom-in duration-300 cursor-pointer group",onClick:m,title:"Recording in progress. Click to locate task.",children:c.jsxs("div",{className:"bg-black/80 backdrop-blur-md border border-emerald-500/30 rounded-full p-2.5 shadow-2xl flex items-center justify-center relative hover:bg-black/90 transition-all hover:scale-110",children:[c.jsx("div",{className:"w-2.5 h-2.5 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_10px_rgba(16,185,129,0.8)]"}),c.jsx("div",{className:"absolute left-full ml-3 bg-black/90 text-white text-[10px] px-2 py-1 rounded-md whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none border border-white/10 shadow-xl font-mono",children:y(e)})]})}):c.jsx("div",{className:"fixed bottom-6 left-1/2 transform -translate-x-1/2 z-[99999] animate-in fade-in slide-in-from-bottom-4 duration-300","data-recording-capsule":!0,children:c.jsxs("div",{className:"bg-black/90 backdrop-blur-xl text-white rounded-full flex items-center p-2 pl-4 pr-3 shadow-2xl border border-white/10 gap-3 min-w-[200px] hover:scale-[1.01] transition-transform",children:[c.jsx("button",{onClick:x=>{x.stopPropagation(),x.preventDefault(),n()},className:"w-8 h-8 rounded-full bg-red-500/20 text-red-400 flex items-center justify-center hover:bg-red-500 hover:text-white transition-all cursor-pointer",title:"Stop Recording",children:c.jsx(O6,{size:12,fill:"currentColor"})}),c.jsx("div",{className:"flex flex-col items-center min-w-[50px] cursor-pointer hover:opacity-80 transition-opacity",onClick:m,title:"Click to locate task",children:c.jsx("span",{className:"font-mono text-sm font-medium tabular-nums tracking-wider text-white",children:y(e)})}),c.jsx("div",{className:"w-20 h-8 relative opacity-80 flex items-center cursor-pointer",onClick:m,title:"Click to locate task",children:c.jsx("canvas",{ref:h,width:80,height:32,className:"w-full h-full"})}),c.jsx("div",{className:"h-6 w-[1px] bg-white/10 mx-1"}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:m,className:"p-1.5 text-gray-400 hover:text-white hover:bg-white/10 rounded-full transition-colors",title:"Locate Recording Task",children:c.jsx(v6,{size:14})}),c.jsx("button",{onClick:()=>f(!0),className:"p-1.5 text-gray-400 hover:text-white hover:bg-white/10 rounded-full transition-colors",title:"Minimize",children:c.jsx(ds,{size:16})})]})]})})},rre=()=>c.jsx("div",{className:"w-full h-screen bg-gray-100 flex items-center justify-center",children:c.jsx("div",{className:"w-full h-full md:max-w-[430px] md:h-[90vh] md:rounded-[3rem] md:border-8 md:border-gray-900 bg-white relative shadow-2xl overflow-hidden",children:c.jsx(OR,{isStandalone:!0})})}),sre=()=>{const{user:t,loading:e}=b.useContext(_n);if(e)return c.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:c.jsxs("div",{className:"flex flex-col items-center gap-3",children:[c.jsx("div",{className:"w-8 h-8 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"}),c.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"Loading workspace..."})]})});const n=t&&t.aud==="authenticated";return c.jsxs(y3,{children:[c.jsx(ip,{path:"/share/heart/:userId",element:c.jsx(rre,{})}),c.jsx(ip,{path:"/login",element:n?c.jsx(MS,{to:"/",replace:!0}):c.jsx(tre,{})}),c.jsx(ip,{path:"/*",element:n?c.jsx(ere,{}):c.jsx(MS,{to:"/login",replace:!0})})]})};function ire(){return c.jsx(U3,{basename:"/ai_completion/",children:c.jsx(Fz,{children:c.jsx(Bz,{children:c.jsxs(Hz,{children:[c.jsx(sre,{}),c.jsx(nre,{})]})})})})}Vy.createRoot(document.getElementById("root")).render(c.jsx(ire,{}));
